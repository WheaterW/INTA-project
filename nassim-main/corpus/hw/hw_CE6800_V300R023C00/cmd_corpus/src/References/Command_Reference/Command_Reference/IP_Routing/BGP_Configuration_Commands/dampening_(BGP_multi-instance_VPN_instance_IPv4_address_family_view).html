
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="cliref">
<meta name="DC.Title" content="dampening (BGP multi-instance VPN instance IPv4 address family view)">
<meta name="DC.subject" content="dampening (BGP multi-instance VPN instance IPv4 address family view)">
<meta name="keywords" content="dampening (BGP multi-instance VPN instance IPv4 address family view)">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../v3r23c00/dc_BGP_Configuration_Commands_title.html">
<meta name="DC.Relation" scheme="URI" content="../v3r23c00/CONSTRAINT-RT-FILTER(BGPVPNTARGET).html">
<meta name="DC.Relation" scheme="URI" content="../v3r23c00/BGP-MULI-DEFAULT-LOCAL-PREFERENCE-VRF(BGPOM).html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing">
<meta name="DC.Audience.Job" content="Reference">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing">
<meta name="featuretype" content="IP Routing">
<meta name="featuretype" content="IP Routing">
<meta name="DC.Creator" content="SUBSYS_ID_BGPOM">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_CLIREF_0000001942844365">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="../public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="../public_sys-resources/browseVersion.js"></script>
<title>dampening (BGP multi-instance VPN instance IPv4 address family view)</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_CLIREF_0000001942844365"></a><a name="EN-US_CLIREF_0000001942844365"></a>

<div class="articleBoxWithoutHead">

<h1 class="topicTitle-h1">dampening (BGP multi-instance VPN instance IPv4 address family view)</h1>


<div>
<div class="clifunc"><a name="EN-US_CLIREF_0000001942844365__1.3.1"></a><a name="1.3.1"></a><h2 class="sectiontitle">Function</h2>
<div class="clifuncbody">
<p><p>The <b><span class="cmdname">dampening</span></b> command enables route flapping dampening for EBGP peers or modifies route flapping dampening parameters for EBGP peers.</p>
<p>The <b><span class="cmdname">undo dampening</span></b> command cancels the dampening on the flapping of EBGP routes.</p>
<p>The <b><span class="cmdname">dampening ibgp</span></b> command enables IBGP peer route flapping dampening or modifies various IBGP peer route flapping dampening parameters.</p>
<p>The <b><span class="cmdname">undo dampening ibgp</span></b> command disables IBGP route flapping dampening.</p>
</p>
<p>By default, BGP route flapping suppression is disabled.</p>

</div></div>

<div class="cliformat"><a name="EN-US_CLIREF_0000001942844365__1.3.2"></a><a name="1.3.2"></a><h2 class="sectiontitle">Format</h2>
<div class="cliformatbody">

<p><b><span class="cmdname">dampening </span></b>[ <i><span class="varname">half-life-reach</span></i> <i><span class="varname">reuse</span></i> <i><span class="varname">suppress</span></i> <i><span class="varname">ceiling</span></i> | [ <strong><span>route-policy</span></strong> <i><span class="varname">route-policy-name</span></i> ] ] <sup>*</sup> [ <strong><span>update-standard</span></strong> ]</p>


<p><b><span class="cmdname">dampening ibgp </span></b>[ <i><span class="varname">half-life-reach</span></i> <i><span class="varname">reuse</span></i> <i><span class="varname">suppress</span></i> <i><span class="varname">ceiling</span></i> | [ <strong><span>route-policy</span></strong> <i><span class="varname">route-policy-name</span></i> ] ] <sup>*</sup> [ <strong><span>update-standard</span></strong> ]</p>

<p><b><span class="cmdname">undo dampening</span></b></p>

<p><b><span class="cmdname">undo dampening ibgp</span></b></p>

</div></div>

<div class="cliparam"><a name="EN-US_CLIREF_0000001942844365__1.3.3"></a><a name="1.3.3"></a><h2 class="sectiontitle">Parameters</h2>
<div class="cliparambody">
<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="">
<tr>
<th valign="bottom" align="left" id="mcps1.3.3.1.1.1">Parameter</th>
<th valign="bottom" align="left" id="mcps1.3.3.1.1.2">Description</th>
<th valign="bottom" align="left" id="mcps1.3.3.1.1.3">Value</th>
</tr>
<tr>
<td valign="top" headers="mcps1.3.3.1-type"><i><span class="varname">half-life-reach</span></i></td>
<td valign="top" headers="mcps1.3.3.1-desc">
<p><p>Specifies the half life of a reachable route.</p>
</p>

</td>
<td valign="top" headers="mcps1.3.3.1-value"><p>The value is an integer ranging from 1 to 45, in minutes. The default value is 15.</p>
</td>
</tr>

<tr>
<td valign="top" headers="mcps1.3.3.1-type"><i><span class="varname">reuse</span></i></td>
<td valign="top" headers="mcps1.3.3.1-desc">
<p><p>Specifies a Reuse value. If the penalty value of a route falls below the Reuse value, the route is reused.</p>
</p>

</td>
<td valign="top" headers="mcps1.3.3.1-value"><p>The value is an integer ranging from 1 to 20000. The default value is 750.</p>
</td>
</tr>

<tr>
<td valign="top" headers="mcps1.3.3.1-type"><i><span class="varname">suppress</span></i></td>
<td valign="top" headers="mcps1.3.3.1-desc">
<p><p>Specifies a Suppress value. If the penalty value of a route exceeds the Suppress value, the route is dampened.</p>
</p>

</td>
<td valign="top" headers="mcps1.3.3.1-value"><p>The value is an integer ranging from 1 to 20000 and must be greater than the value of reuse. The default value is 2000.</p>
</td>
</tr>

<tr>
<td valign="top" headers="mcps1.3.3.1-type"><i><span class="varname">ceiling</span></i></td>
<td valign="top" headers="mcps1.3.3.1-desc">
<p><p>Specifies a penalty ceiling.</p>
</p>

</td>
<td valign="top" headers="mcps1.3.3.1-value"><p>The value is an integer ranging from 1001 to 20000. The configured value must be greater than the value of suppress. The default value is 16000.</p>
</td>
</tr>

<tr>
<td valign="top" headers="mcps1.3.3.1-type"><strong><span>route-policy</span></strong> <i><span class="varname">route-policy-name</span></i></td>
<td valign="top" headers="mcps1.3.3.1-desc">
<p><p>Specifies the name of a route-policy.</p>
</p>

</td>
<td valign="top" headers="mcps1.3.3.1-value"><p>The name is a string of 1 to 200 case-sensitive characters, with spaces not supported. When double quotation marks are used around the string, spaces are allowed in the string.</p>
</td>
</tr>


<tr>
<td valign="top" headers="mcps1.3.3.1-type"><strong><span>update-standard</span></strong></td>
<td valign="top" headers="mcps1.3.3.1-desc">
<p><p>Enables BGP to add a penalty value (500) to the route carried in each received Update message (excluding Withdraw message).</p>
</p>

</td>
<td valign="top" headers="mcps1.3.3.1-value"><p>-</p>
</td>
</tr>

</table></div>

</div></div>

<div class="cliview"><a name="EN-US_CLIREF_0000001942844365__1.3.4"></a><a name="1.3.4"></a><h2 class="sectiontitle">Views</h2>
<div class="cliviewbody">
<p><span>BGP multi-instance VPN instance IPv4 address family view</span></p>

</div></div>

<div class="clidefaultlevel"><a name="EN-US_CLIREF_0000001942844365__1.3.5"></a><a name="1.3.5"></a><h2 class="sectiontitle">Default Level</h2>
<div class="clidefaultlevelbody">
<p>2: Configuration level</p>

</div></div>


<div class="clidesc"><a name="EN-US_CLIREF_0000001942844365__1.3.6"></a><a name="1.3.6"></a><h2 class="sectiontitle">Usage Guidelines</h2>
<div class="clidescbody">
<p><strong>Usage Scenario</strong></p>
<div class="p"><p>When a dampening policy is configured for routes, routes preferentially match the dampening parameters of the dampening policy.<p></p>
<span>If no parameter is set</span>, the default value of each parameter is used. The four parameters of attenuation are interdependent. Therefore, if any of the preceding parameters is used, all parameters must be specified.<p></p>
<span>BGP route flapping suppression measures the stability</span> of a route by using a penalty value. The greater the penalty value, the less stable the route. Each time route flapping occurs, that is, when a device receives a Withdraw message for a route, BGP adds a penalty value (1000) to the route.<p></p>
<span>When the penalty value of a route exceeds the suppression</span> threshold, the route is suppressed. The device does not add the route to the IP routing table or advertise Update messages to other BGP peers. BGP removes the best flag of the route. If the last message received by the device is an Update message, the route is marked with the d flag. If the last message received by the device is a Withdraw message, the route is marked with the h flag. The route can have both the d and h flags. In this case, the d flag takes effect. When the penalty value reaches a certain value, the penalty value does not increase any more. This value is called the penalty upper limit.<p></p>
<span>At the same time</span>, the penalty value of the suppressed route decreases by half each time the route passes through a period of time. This period is called half-life. If the last route received by a device is an Update message, when the penalty value of the route falls below the reuse threshold, the device removes the d flag from the route. The route becomes available and is preferentially selected. Then, the device adds the route to the IP routing table and advertises an Update message to other BGP peers. If the last message received by a device is a Withdraw message and the penalty value of the route decreases to 0, the device deletes the route from the BGP routing table or BGP labeled routing table.<p></p>
<span>After BGP route flapping suppression is configured</span>, any parameter in the command can be used to suppress flapping routes. The purpose of adjusting parameters is to adjust the suppression time as required. To increase the suppression time of flapping routes, perform the following operations (or reduce the suppression time):</p>

<ul><li>The value of ceiling is increased.</li><li>The value half-life-reach is increased.</li><li>The value of reuse is decreased.</li></ul>
</div>
<p><strong>Configuration Impact</strong></p>
<p><p>If the <b><span class="cmdname">dampening</span></b> command is run more than once, the latest configuration overrides the previous one.<p></p>
<span>After the</span> <b><span class="cmdname">dampening</span></b> command is run, the system dampens unstable routes. Specifically, the system does not add unstable routes to the BGP routing table or BGP labeled routing table or advertise them to other BGP peers.</p>
</p>
<p><strong>Precautions</strong></p>
<div class="p"><p>Note the following items when configuring BGP route flap dampening:</p>

<ul><li>The values of reuse, suppress, and ceiling are in ascending order.</li><li>According to the formula MaxSuppressTime=half-life-reachÃ60Ã(ln(ceiling/reuse)/ln(2)), if the value of MaxSuppressTime is smaller than 1, dampening cannot be performed. Therefore, the value of the ceiling/reuse must be great enough so that the value of MaxSuppressTime can be equal to or greater than 1.</li></ul>
</div>

</div></div>

<div class="cliexample"><a name="EN-US_CLIREF_0000001942844365__1.3.7"></a><a name="1.3.7"></a><h2 class="sectiontitle">Example</h2>
<div class="cliexamplebody">

<div class="p"># Enable EBGP peer route dampening and configure EBGP peer route dampening parameters.<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>ip vpn-instance vpna</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-vpn-instance-vpna] <strong>ipv4-family</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-vpn-instance-vpna-af-ipv4] <strong>route-distinguisher 100:1</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-vpn-instance-vpna-af-ipv4] <strong>vpn-target 111:1 both</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-vpn-instance-vpna-af-ipv4] <strong>quit</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-instance-vpna] <strong>quit</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>bgp 100 instance a</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-bgp-instance-a] <strong>ipv4-family vpn-instance vrf1</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-bgp-instance-a-vrf1] <strong>dampening 10 1000 2000 5000</strong>
</pre>
</div>

<div class="p"># Enable IBGP peer route dampening and configure IBGP peer route dampening parameters.<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>ip vpn-instance vpna</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-vpn-instance-vpna] <strong>ipv4-family</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-vpn-instance-vpna-af-ipv4] <strong>route-distinguisher 100:1</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-vpn-instance-vpna-af-ipv4] <strong>vpn-target 111:1 both</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-vpn-instance-vpna-af-ipv4] <strong>quit</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-instance-vpna] <strong>quit</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>bgp 100 instance a</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-bgp-instance-a] <strong>ipv4-family vpn-instance vrf1</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-bgp-instance-a-vrf1] <strong>dampening ibgp 10 1000 2000 5000</strong>
</pre>
</div>

</div></div>

</div>


</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../v3r23c00/dc_BGP_Configuration_Commands_title.html">BGP Configuration Commands
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../v3r23c00/CONSTRAINT-RT-FILTER(BGPVPNTARGET).html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../v3r23c00/BGP-MULI-DEFAULT-LOCAL-PREFERENCE-VRF(BGPOM).html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>