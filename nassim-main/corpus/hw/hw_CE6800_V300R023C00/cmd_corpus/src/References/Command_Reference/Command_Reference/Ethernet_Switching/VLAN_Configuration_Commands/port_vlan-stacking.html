
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="cliref">
<meta name="DC.Title" content="port vlan-stacking">
<meta name="DC.subject" content="port vlan-stacking">
<meta name="keywords" content="port vlan-stacking">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../v3r23c00/dc_VLAN_Configuration_Commands_title.html">
<meta name="DC.Relation" scheme="URI" content="../v3r23c00/PORTVLANMAPPING(ETHBASEOM).html">
<meta name="DC.Relation" scheme="URI" content="../v3r23c00/PORTSWITCH(VLANOM).html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="VLAN">
<meta name="featuretype" content="Ethernet Switching">
<meta name="DC.Audience.Job" content="Reference">
<meta name="featurename" content="VLAN">
<meta name="featuretype" content="Ethernet Switching">
<meta name="featurename" content="VLAN">
<meta name="featuretype" content="Ethernet Switching">
<meta name="featuretype" content="Ethernet Switching">
<meta name="featuretype" content="Ethernet Switching">
<meta name="DC.Creator" content="SUBSYS_ID_ETHBASEOM">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_CLIREF_0000001907761836">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="../public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="../public_sys-resources/browseVersion.js"></script>
<title>port vlan-stacking</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_CLIREF_0000001907761836"></a><a name="EN-US_CLIREF_0000001907761836"></a>

<div class="articleBoxWithoutHead">

<h1 class="topicTitle-h1">port vlan-stacking</h1>


<div>
<div class="clifunc"><a name="EN-US_CLIREF_0000001907761836__1.3.1"></a><a name="1.3.1"></a><h2 class="sectiontitle">Function</h2>
<div class="clifuncbody">
<p><p>The <b><span class="cmdname">port vlan-stacking vlan</span></b> command enables VLAN stacking on an interface. That is, it configures the interface to add a VLAN tag to each received single-tagged packet.</p>
<p>The <b><span class="cmdname">port vlan-stacking untagged</span></b> command configures a device to add double VLAN tags to an untagged packet.</p>
<p>The <b><span class="cmdname">undo port vlan-stacking</span></b> command restores the default configuration.</p>
<p>The <b><span class="cmdname">undo port vlan-stacking untagged</span></b> command cancels the configuration of adding double VLAN tags to an untagged packet.</p>
</p>
<p>By default, VLAN stacking is not configured on interfaces.</p>
<div class="note"><img src="../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>This command is supported only on the CE6863H, CE6863H-K, CE6860-SAN, CE6866K, CE6866, CE6860-HAM, CE6855-48XS8CQ, CE6885-SAN, CE8850-SAN, CE8855, CE8851-32CQ4BQ, CE8851K, CE8851-32CQ8DQ-P, CE8850-HAM, CE6881H, CE6881H-K, CE6820H, CE6820H-K, CE6820S, CE6885, CE6885-T, CE6885-LL (standard forwarding mode) and CE6863E-48S8CQ.</p>
</div></div>

</div></div>

<div class="cliformat"><a name="EN-US_CLIREF_0000001907761836__1.3.2"></a><a name="1.3.2"></a><h2 class="sectiontitle">Format</h2>
<div class="cliformatbody">
<p><b><span class="cmdname">port vlan-stacking vlan </span></b><i><span class="varname">vlan-id1</span></i> [ <strong><span>to</span></strong> <i><span class="varname">vlan-id2</span></i> ] <strong><span>stack-vlan</span></strong> <i><span class="varname">vlan-id3</span></i></p>

<p><b><span class="cmdname">port vlan-stacking vlan </span></b><i><span class="varname">vlan-id1</span></i> [ <strong><span>to</span></strong> <i><span class="varname">vlan-id2</span></i> ] <strong><span>stack-vlan</span></strong> <i><span class="varname">vlan-id3</span></i> <strong><span>remark-8021p</span></strong> <i><span class="varname">8021p-value3</span></i></p>

<p><b><span class="cmdname">port vlan-stacking untagged stack-vlan </span></b><i><span class="varname">vlan-id3</span></i> <strong><span>stack-inner-vlan</span></strong> <i><span class="varname">stackInnerVid</span></i></p>



<p><b><span class="cmdname">undo port vlan-stacking vlan </span></b><i><span class="varname">vlan-id1</span></i> [ <strong><span>to</span></strong> <i><span class="varname">vlan-id2</span></i> ] [ <strong><span>stack-vlan</span></strong> <i><span class="varname">vlan-id3</span></i> ]</p>

<p><b><span class="cmdname">undo port vlan-stacking untagged </span></b>[ <strong><span>stack-vlan</span></strong> <i><span class="varname">vlan-id3</span></i> <strong><span>stack-inner-vlan</span></strong> <i><span class="varname">stackInnerVid</span></i> ]</p>

<p><b><span class="cmdname">undo port vlan-stacking vlan </span></b><i><span class="varname">vlan-id1</span></i> [ <strong><span>to</span></strong> <i><span class="varname">vlan-id2</span></i> ] <strong><span>stack-vlan</span></strong> <i><span class="varname">vlan-id3</span></i> <strong><span>remark-8021p</span></strong> <i><span class="varname">8021p-value3</span></i></p>


<p><b><span class="cmdname">undo port vlan-stacking all</span></b></p>


</div></div>

<div class="cliparam"><a name="EN-US_CLIREF_0000001907761836__1.3.3"></a><a name="1.3.3"></a><h2 class="sectiontitle">Parameters</h2>
<div class="cliparambody">
<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="">
<tr>
<th valign="bottom" align="left" id="mcps1.3.3.1.1.1">Parameter</th>
<th valign="bottom" align="left" id="mcps1.3.3.1.1.2">Description</th>
<th valign="bottom" align="left" id="mcps1.3.3.1.1.3">Value</th>
</tr>
<tr>
<td valign="top" headers="mcps1.3.3.1-type"><i><span class="varname">vlan-id1</span></i></td>
<td valign="top" headers="mcps1.3.3.1-desc">
<p><p>Indicates the start value of the inner VLAN range.</p>
</p>

</td>
<td valign="top" headers="mcps1.3.3.1-value"><p>The value is an integer ranging from 1 to 4094.</p>
</td>
</tr>

<tr>
<td valign="top" headers="mcps1.3.3.1-type"><i><span class="varname">vlan-id2</span></i></td>
<td valign="top" headers="mcps1.3.3.1-desc">
<p><p>Indicates the end value of the inner VLAN range.</p>
</p>

</td>
<td valign="top" headers="mcps1.3.3.1-value"><p>The value is an integer ranging from 1 to 4094.</p>
</td>
</tr>

<tr>
<td valign="top" headers="mcps1.3.3.1-type"><strong><span>stack-vlan</span></strong> <i><span class="varname">vlan-id3</span></i></td>
<td valign="top" headers="mcps1.3.3.1-desc">
<p><p>Specifies the VLAN ID in the outer tag to be added to a packet.</p>
</p>

</td>
<td valign="top" headers="mcps1.3.3.1-value"><p>The value is an integer ranging from 1 to 4094.</p>
</td>
</tr>

<tr>
<td valign="top" headers="mcps1.3.3.1-type"><strong><span>remark-8021p</span></strong> <i><span class="varname">8021p-value3</span></i></td>
<td valign="top" headers="mcps1.3.3.1-desc">
<p><p>Specifies the VLAN priority.</p>
</p>

</td>
<td valign="top" headers="mcps1.3.3.1-value"><p>The value is an integer ranging from 0 to 7.</p>
</td>
</tr>

<tr>
<td valign="top" headers="mcps1.3.3.1-type"><strong><span>untagged</span></strong></td>
<td valign="top" headers="mcps1.3.3.1-desc">
<p><p>Specifies the untagged packet type.</p>
</p>

</td>
<td valign="top" headers="mcps1.3.3.1-value"><p>-</p>
</td>
</tr>

<tr>
<td valign="top" headers="mcps1.3.3.1-type"><strong><span>stack-inner-vlan</span></strong> <i><span class="varname">stackInnerVid</span></i></td>
<td valign="top" headers="mcps1.3.3.1-desc">
<p><p>Specifies the inner VLAN tag added to an untagged frame.</p>
</p>

</td>
<td valign="top" headers="mcps1.3.3.1-value"><p>The value is an integer ranging from 1 to 4094.</p>
</td>
</tr>




<tr>
<td valign="top" headers="mcps1.3.3.1-type"><strong><span>all</span></strong></td>
<td valign="top" headers="mcps1.3.3.1-desc">
<p><p>Deletes all non-untagged VLAN stacking configurations on the interface.</p>
</p>

</td>
<td valign="top" headers="mcps1.3.3.1-value"><p>-</p>
</td>
</tr>

</table></div>

</div></div>

<div class="cliview"><a name="EN-US_CLIREF_0000001907761836__1.3.4"></a><a name="1.3.4"></a><h2 class="sectiontitle">Views</h2>
<div class="cliviewbody">
<p><span>Layer 2 100GE interface view,</span><span>Layer 2 10GE interface view,</span><span>Layer 2 200GE interface view,</span><span>25GE-L2 view,</span><span>400GE-L2 view,</span><span>Layer 2 50GE interface view,</span><span>Layer 2 Eth-Trunk interface view,</span><span>Layer 2 GE interface view,</span><span>Interface group view</span></p>

</div></div>

<div class="clidefaultlevel"><a name="EN-US_CLIREF_0000001907761836__1.3.5"></a><a name="1.3.5"></a><h2 class="sectiontitle">Default Level</h2>
<div class="clidefaultlevelbody">
<p>2: Configuration level</p>

</div></div>


<div class="clidesc"><a name="EN-US_CLIREF_0000001907761836__1.3.6"></a><a name="1.3.6"></a><h2 class="sectiontitle">Usage Guidelines</h2>
<div class="clidescbody">
<p><strong>Usage Scenario</strong></p>
<div class="p"><p>VLAN stacking, also known as selective QinQ, is a Layer 2 technology that adds outer VLAN tags to packets based on their VLAN IDs.<p></p>
<span>On access networks of carriers</span>, users must be differentiated based on their applications and access locations or devices.  After VLAN stacking is configured on an interface, the interface adds different outer VLAN tags to packets based on their VLAN IDs to differentiate users.<p></p>
<span>A VLAN stacking interface has the following features</span>:</p>

<ul><li>The interface can be configured with multiple outer VLAN tags. Therefore, the interface can add different outer VLAN tags to frames from different VLANs.</li><li>When receiving a frame, the interface adds an outer tag to the frame. When sending a frame, the interface removes the outer tag from the frame.</li></ul>

<p>VLSN-Stacking untagged enables a Layer 2 port to add double tags to received untagged packets according to actual services or users. In this manner, services or users can be differentiated according to the added tags.<p></p>
<span>For a sent packet</span>:</p>

<ul><li>The VLAN tag of a packet is removed and the packet becomes untagged only when the VLAN of the packet matches both the outer and inner VLAN tags.</li><li>If only the outer VLAN ID is matched and the outer VLAN is configured for the interface in untagged mode, the outer VLAN ID is removed and the inner VLAN ID is retained.</li></ul>
</div>
<p><strong>Prerequisites</strong></p>
<div class="p"><p>Before you run the <b><span class="cmdname">port vlan-stacking</span></b> command:</p>

<ul><li>If the interface is a Layer 3 interface, it has been switched to a Layer 2 interface using the <b><span class="cmdname">portswitch</span></b> command.</li><li>You must run the port link-type { hybrid | trunk } command to set the link type of an Ethernet interface to hybrid or trunk.<p></p>
<span>By default</span>, the link type of an Ethernet interface is hybrid.</li></ul>
</div>
<p><strong>Precautions</strong></p>
<div class="p"><p>When configuring VLAN stacking, pay attention to the following points:</p>

<ul><li>It is recommended that the interface type be hybrid or trunk and take effect only in the inbound direction.</li><li>The interface must be added to the outer stack VLAN in hybrid or trunk mode.</li><li>After VLAN stacking is configured on an interface, if the interface needs to remove the outer tag from a frame, the interface must be added to the stack VLAN in untagged mode. If the interface does not need to remove the outer tag from a frame, the interface must be added to the stack VLAN in tagged mode.</li><li>If the PVID of an interface is not VLAN 1, restore the PVID to the default value before running the <b><span class="cmdname">port vlan-stacking untagged</span></b> command.</li><li>Adding double VLAN tags to untagged packets belongs to interface-based VLAN assignment. The priorities of different VLAN assignment modes are as follows: Policy-VLAN &gt; MAC-VLAN &gt; IP-Subnet-VLAN &gt; Protocol-VLAN &gt; Interface-based VLAN assignment.</li><li>If the <b><span class="cmdname">port vlan-stacking untagged</span></b> command is run on an interface, the interface processes the received packets tagged with VLAN 0 as untagged packets.</li><li>VLAN segments cannot be split.</li><li>An IP address cannot be configured on the VLANIF interface of the outer VLAN of VLAN stacking to access IP services.</li><li>The VLAN specified by stack-vlan takes effect only after being created.</li></ul>
</div>

</div></div>

<div class="cliexample"><a name="EN-US_CLIREF_0000001907761836__1.3.7"></a><a name="1.3.7"></a><h2 class="sectiontitle">Example</h2>
<div class="cliexamplebody">



<div class="p"># Add double VLAN tags to untagged packets received on <span>100GE</span> <span>1/0/1</span>.<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>vlan 100</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>q</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>interface <span>100GE</span> <span>1/0/1</span></strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-<span>100GE</span><span>1/0/1</span>] <strong>portswitch</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-<span>100GE</span><span>1/0/1</span>] <strong>port link-type hybrid</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-<span>100GE</span><span>1/0/1</span>] <strong>port hybrid untagged vlan 100</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-<span>100GE</span><span>1/0/1</span>] <strong>port vlan-stacking untagged stack-vlan 100 stack-inner-vlan 200</strong>
</pre>
</div>

<div class="p"># Enable VLAN stacking on <span>100GE</span> <span>1/0/1</span> and configure <span>100GE</span> <span>1/0/1</span> to add the outer VLAN ID 20 to packets carrying VLAN IDs 40 to 50.<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>vlan 20</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>q</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>interface <span>100GE</span> <span>1/0/1</span></strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-<span>100GE</span><span>1/0/1</span>] <strong>portswitch</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-<span>100GE</span><span>1/0/1</span>] <strong>port link-type trunk</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-<span>100GE</span><span>1/0/1</span>] <strong>port trunk allow-pass vlan 20</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-<span>100GE</span><span>1/0/1</span>] <strong>port vlan-stacking vlan 40 to 50 stack-vlan 20</strong>
</pre>
</div>

</div></div>

</div>


</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../v3r23c00/dc_VLAN_Configuration_Commands_title.html">VLAN Configuration Commands
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../v3r23c00/PORTVLANMAPPING(ETHBASEOM).html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../v3r23c00/PORTSWITCH(VLANOM).html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>