set master-key
==============

set master-key

Function
--------



The **set master-key** command sets the system master key.



By default, the system uses the default master key.



For devices running versions earlier than V300R023C00, the system master key is the automatically generated master key.

For devices running V300R023C00 and later, the system master key is the default master key.Configuration files can be shared between devices. Encrypted files can be copied from other devices to the current device.




Format
------

**set master-key**


Parameters
----------

None

Views
-----

User view


Default Level
-------------

3: Management level


Usage Guidelines
----------------

**Usage Scenario**

* In the actual network environment, networks and devices are provided and maintained by network providers, and data belongs to tenants. To provide secure data transmission and storage on the network, ensure that keys are under complete control of the specific tenant and cannot be obtained by network providers or other tenants. To be specific, tenants need to have their own key management schemes. Tenants can run this command to manually change the system master key as required to improve data security and reliability.
* There are three types of system master keys: default master key, automatically generated master key, and user-defined master key.
* Default master key: a fixed binary number generated by the system. The length is 32 bytes.
* Automatically generated master key: a random number generated by the system, which may contain letters and special characters. It is secure and does not need to be changed frequently.
* User-defined master key: a user-defined string of 20 to 32 characters and must contain uppercase letters, lowercase letters, digits, and special characters.

**Precautions**

* The interval between two master key settings must be at least 3 minutes.
* After the system master key is changed, the ciphertext is automatically updated to ensure that the ciphertext encrypted using the original master key can be used properly.
* Pay attention to the following points when changing the master key:
  + Enter the password of the current login user for identity authentication.
  + Read the risk prompt. If you want to continue the modification, enter Y on the terminal interface. If you do not want to modify the master key, enter N on the terminal interface. The system exits the modification.
  + Select the key generation mode. If the user needs to enter the master key, enter Y on the terminal screen. If the system automatically generates a master key, enter N on the terminal screen. If the system automatically switches to the default master key, enter D on the terminal screen.
  + If the user needs to enter the master key, enter the new master key twice. The system proceeds to the next step only when the two new master keys are the same.
* The default master key has no validity period and will not be automatically updated and no alarm will be reported when the master key expires.
* Master keys automatically generated by the system and user-defined master keys have validity periods. The value is specified by the **set master-key update-days** command in the diagnostic view. The default value is 1825, in days. You can also run the display master-key configuration command to query the validity period of the current system master key. After the automatically generated master key and user-defined master key expire, the device performs the following operations:
  + If the system master key is automatically generated, it is automatically updated when it expires.
  + If the system master key is a user-defined master key and expires, it will not be automatically updated and an expiration alarm will be reported.
* Configuration files can be shared between devices when the following conditions are met:
  + The two devices use the same system master key.
  + If the system master keys used by the two devices are different, ensure that the historical master keys of the current device contain the system master key used by the other device. In this case, you need to save the historical user-defined master keys that have been configured on the two devices locally.
* If the master key of another device does not exist on the current device, the configuration file cannot be shared between the devices. If the configuration file of another device is copied to the current device as the configuration file for next startup, the configuration fails. You can use either of the following methods to rectify the fault:
  + Change the master key of the device to be configured to be the same as that of the device that provides the configuration file.
  + Change the master key of the device that provides the configuration file to be the same as that of the device to be configured. Then, run the save [ < configuration-file > ] command to save and export the configuration file, upload the configuration file to the device to be configured, and run the startup saved-configuration < configuration-file > command to specify the configuration file for next startup.
* If an error occurs when you change the master key, the system displays a message indicating that the master key fails to be changed. If the failure persists, contact technical support.
* During the execution of this command, if you run system diagnosis commands in other views at the same time, frame freezing may occur for 3 to 4 seconds.


Example
-------

# Change the system master key to the automatically generated master key.
```
<HUAWEI> set master-key
Enter the user password:
Warning: This operation will automatically save configurations. Are you sure you want to perform it? [Y/N]:y
Do you want to enter the master key? (If you enter Y, you need to manually enter the master key and automatic key update stops. If you enter N, the system automatically generates a master key. If you enter D, the system will change the current master key to the default master key.) [Y/N/D]:n
Info: Operating, please wait for a moment......done.
Info: Operation succeeded.

```

# Change the system master key to a user-defined master key.
```
<HUAWEI> set master-key
Enter the user password:
Warning: This operation will automatically save configurations. Are you sure you want to perform it? [Y/N]:y
Do you want to enter the master key? (If you enter Y, you need to manually enter the master key and automatic key update stops. If you enter N, the system automatically generates a master key. If you enter D, the system will change the current master key to the default master key.) [Y/N/D]:y
Info: Enter a new master key:
Info: Confirm the new master key:
Warning: Keep the new master key well.
Info: Operating, please wait for a moment......done.
Info: Operation succeeded.

```

# Change the system master key to the default master key.
```
<HUAWEI> set master-key
Enter the user password:
Warning: This operation will automatically save configurations. Are you sure you want to perform it? [Y/N]:y
Do you want to enter the master key? (If you enter Y, you need to manually enter the master key and automatic key update stops. If you enter N, the system automatically generates a master key. If you enter D, the system will change the current master key to the default master key.) [Y/N/D]:d
Info: Operating, please wait for a moment......done.
Info: Operation succeeded.

```