default-route-advertise (OSPF view)
===================================

default-route-advertise (OSPF view)

Function
--------



The **default-route-advertise** command advertises default routes to a common OSPF area.

The **undo default-route-advertise** command disables advertisement of default routes to a common OSPF area.



By default, default routes are not advertised to a common OSPF area.


Format
------

**default-route-advertise** [ [ **always** | **permit-calculate-other** ] | **cost** *costvalue* | **type** *typevalue* | { **route-policy** *route-policy-name* } | **distribute-delay** *delaytimer* | **tag** *tagvalue* ] \*

**default-route-advertise summary cost** *costvalue*

**default-route-advertise** [ **permit-calculate-other** | **cost** *costvalue* | **type** *typevalue* | { **route-policy** *route-policy-name* } | **distribute-delay** *delaytimer* | **permit-ibgp** | **tag** *tagvalue* | **permit-preference-less-than** *preference-val* ] \*

**undo default-route-advertise**


Parameters
----------

| Parameter | Description | Value |
| --- | --- | --- |
| **always** | Generates and advertises an LSA that describes a default route, regardless of whether the local device has active default routes from processes other than the local OSPF process. | - |
| **permit-calculate-other** | Configures the device to calculate default Type 5 LSAs from other devices if this parameter is specified and the OSPF process has advertised Type 5 LSAs that describe a default route. If this parameter is not specified, the OSPF process does not calculate default Type 5 LSAs from other devices.  If an OSPF process does not advertise Type 5 LSAs that describe a default route, the OSPF process calculates the default Type 5 LSAs from other devices, regardless of whether this parameter is specified. | - |
| **cost** *costvalue* | Specifies the cost of external routes.   * Cost of a Type 1 external route = Cost of the route from the Router to the related ASBR + Cost of the route from the ASBR to the destination. * Cost of a Type 2 external route = Cost of the route from the ASBR to the destination. | The value is an integer ranging from 0 to 16777214. The default value is 1. |
| **type** *typevalue* | Specifies the type of the external routes. | The value is 1 or 2.   * 1: Type 1 external route * 2: Type 2 external route   The default value is 2. |
| **route-policy** *route-policy-name* | Specifies the name of a route-policy. When a device's routing table contains matching default routes that are generated from processes other than the local OSPF process, a device advertises the default routes based on the route-policy configuration. | The value is a string of 1 to 200 case-sensitive characters without spaces. The character string can contain spaces if it is enclosed with double quotation marks ("). |
| **distribute-delay** *delaytimer* | Specifies the delay timer for advertising the default route. | The value is an integer ranging from 1 to 65535, in seconds. |
| **tag** *tagvalue* | Specifies the tag of the routes imported into VPN. | The value is an integer ranging from 0 to 4294967295. The default value is 1. |
| **summary** | Advertises the Type 3 summary LSA of the specified default route. Before specifying this parameter, ensure that VPN is enabled. Otherwise, routes cannot be advertised. | - |
| **permit-ibgp** | Imports IBGP routes. | - |
| **permit-preference-less-than** *preference-val* | Allows the device to import the default route whose preference value is smaller than the configured value. | The value is an integer ranging from 1 to 256. |



Views
-----

OSPF view


Default Level
-------------

2: Configuration level


Usage Guidelines
----------------

**Usage Scenario**

The import-route (OSPF) command cannot be used to import external default routes. To import the default route generated by other protocols, you must run the **default-route-advertise** command on the ASBR to advertise the default route to the entire common OSPF area.If the ASBR already has a default route, running the **default-route-advertise** command will advertise the default route 0.0.0.0 in the entire OSPF area.If the ASBR does not have a default route, run the **default-route-advertise** command with always specified.

* If always is configured, the ASBR advertises the default route 0.0.0.0 in the entire OSPF area regardless of whether the ASBR has a default route, and does not calculate the default routes from other devices.
* If always is not configured, the LSA that describes the default route is generated only when there are active default routes of other OSPF processes (except BGP) in the routing table of the local device.

When there are active BGP default routes in the routing table of the local device:

* If the **ospf process-id vpn-instance vpn-instance-name** command is not run, the active default EBGP route in the routing table can be imported to OSPF after the **default-route-advertise** command is run. In this case, the OSPF process cannot import IBGP routes. To import active default IBGP routes in the routing table to OSPF, run the **default-route-advertise permit-ibgp** command.
* If the **ospf process-id vpn-instance vpn-instance-name** command is configured:
* In addition, the **vpn-instance-capability simple** command is run. After the **default-route-advertise** command is run, the active default EBGP route in the routing table can be imported to OSPF. In this case, the OSPF process cannot import IBGP default routes. To import active default IBGP routes in the routing table to OSPF, run the **default-route-advertise permit-ibgp** command.
* If the **vpn-instance-capability simple** command is not run and the **default-route-advertise** command is run, active BGP (including EBGP and IBGP) default routes in the routing table can be imported to OSPF.

Importing IBGP routes may cause routing loops. Therefore, exercise caution when performing this operation.In a primary/backup path scenario, packets may get lost after traffic switches back to the primary path from the backup path. The severity of packet loss is proportional to the number of routes stored on the intermediate device. To solve this problem, run the **default-route-advertise distribute-delay delaytimer** command on the device on the primary path to delay sending the OSPF default route. This ensures that traffic is switched back after the device on the primary path completes updating forwarding entries.

**Configuration Impact**

After the **default-route-advertise** command is configured on the ASBR, the ASBR will generate a Type 5 ASE LSA with link state ID 0.0.0.0 and mask 0.0.0.0. In addition, it will advertise the ASE LSA in an entire OSPF area.If a route-policy is configured, default routes are advertised based on the following principles:

* If a default route matches the route-policy, a new default route is generated on an OSPF device based on the parameters configured in the route-policy. Parameters such as cost, tag, and type can be configured in the route-policy.
* If the default route does not match the route-policy, and always is configured, the default route is still advertised.
* If always is not configured, the OSPF device will not advertise the default route.
* If always is configured, OSPF devices will advertise the default route. In addition, only always configured in the **default-route-advertise** command takes effect on advertisement of default routes.

**Precautions**

* The OSPF default route advertisement mode depends on the type of the area where the default route is imported. This command is used only to advertise the default route to a common OSPF area. For stub areas, totally stub areas, and totally NSSAs, default routes are automatically advertised. In an NSSA, to advertise default routes, run the **nssa default-route-advertise** command.
* If the **default-route-advertise** command is run in an OSPF process and always is not specified, the default LSA is advertised based on the active default route of a non-local OSPF process in the IP routing table. The priority of the depended default route must be higher than that of the OSPF route; otherwise, OSPF may fail to advertise the default LSA or a loop may occur. To prevent loops, you are advised to specify permit-preference-less-than to prevent low-priority active default routes from being imported. This parameter is used only when always is not specified.
* After always is configured, the device advertises default routes unconditionally. Therefore, if some route sources are unreachable due to faults, route blackholes may occur. You are advised to select always based on the networking plan.
* If permit-calculate-other is not specified and OSPF advertises default routes first, the device does not calculate default routes from other devices. Conversely, if OSPF learns the default route first and the default route is active, OSPF does not advertise the default route. When a device restarts or route flapping occurs, the sequence in which OSPF learns and advertises default routes may change. As a result, service traffic changes. Therefore, you are advised to configure permit-calculate-other to prevent this problem.

Example
-------

# Advertise the ASE LSA of the default route to the OSPF area, with no default route on the local device.
```
<HUAWEI> system-view
[~HUAWEI] ospf 1
[*HUAWEI-ospf-1] default-route-advertise always

```