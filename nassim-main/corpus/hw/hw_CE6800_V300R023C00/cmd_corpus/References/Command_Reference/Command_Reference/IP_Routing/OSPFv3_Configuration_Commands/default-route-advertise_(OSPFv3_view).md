default-route-advertise (OSPFv3 view)
=====================================

default-route-advertise (OSPFv3 view)

Function
--------



The **default-route-advertise** command advertises the default route to a common OSPFv3 area.

The **undo default-route-advertise** command disables advertisement of default routes to a common OSPFv3 area.



By default, the OSPFv3 devices in common OSPFv3 areas do not generate default routes.

![](../public_sys-resources/note_3.0-en-us.png) 

This command is supported only on the CE6863H, CE6863H-K, CE6860-SAN, CE6866K, CE6866, CE6860-HAM, CE6855-48XS8CQ, CE6885-SAN, CE8850-SAN, CE8855, CE8851-32CQ4BQ, CE8851K, CE8851-32CQ8DQ-P, CE8850-HAM, CE6881H, CE6881H-K, CE6820H, CE6820H-K, CE6820S, CE6885, CE6885-T, CE6885-LL (standard forwarding mode) and CE6863E-48S8CQ.



Format
------

**default-route-advertise** [ [ **always** | **permit-calculate-other** ] | **cost** *cost* | **type** *type* | **tag** *tag* | **distribute-delay** *delay* | { **route-policy** *route-policy-name* } ] \*

**default-route-advertise** [ **permit-calculate-other** | **cost** *cost* | **type** *type* | **tag** *tag* | **distribute-delay** *delay* | { **route-policy** *route-policy-name* } | **permit-preference-less-than** *preference-value* ] \*

**undo default-route-advertise**


Parameters
----------

| Parameter | Description | Value |
| --- | --- | --- |
| **always** | Generates and advertises an LSA that describes a default route, regardless of whether the local device has active default routes from processes other than the local OSPFv3 process. The device that is configured with always does not calculate default routes of other devices. If this keyword is not specified, the LSA for a default route is generated only when the routing table of the local device has active default routes from processes other than the local OSPFv3 process. | - |
| **permit-calculate-other** | Configures the device to calculate default Type 5 LSAs from other devices if this parameter is specified and the OSPFv3 process has advertised Type 5 LSAs that describe default routes. If this parameter is not specified, the OSPFv3 process does not calculate default Type 5 LSAs from other devices.  If an OSPFv3 process does not advertise Type 5 LSAs that describe a default route, the OSPFv3 process calculates the default Type 5 LSAs from other devices, regardless of whether this parameter is specified. | - |
| **cost** *cost* | Specifies the cost of the external routes.   * The cost of a Type 1 external route equals the cost of the route from the Router to the related ASBR plus the cost of the route from the ASBR to the destination. * The cost of a Type 2 external route equals the cost of the route from the ASBR to the destination. | The value is an integer ranging from 0 to 16777214. The default value is 1. |
| **type** *type* | Specifies the type of the external routes. | The value is 1 or 2.   * 1: Type 1 external route * 2: Type 2 external route   The default value is 2. |
| **tag** *tag* | Specifies the tag of the routes imported into VPN. | The value is an integer ranging from 0 to 4294967295. The default value is 1. |
| **distribute-delay** *delay* | Specifies the delay timer for advertising the default route. | The value is an integer ranging from 1 to 65535. |
| **route-policy** *route-policy-name* | Specifies the name of a route-policy. When a device's routing table contains matching default routes that are generated from processes other than the local OSPFv3 process, a device advertises the default routes based on the route-policy configuration. | The value is a string of 1 to 200 case-sensitive characters without spaces. The character string can contain spaces if it is enclosed with double quotation marks ("). |
| **permit-preference-less-than** *preference-value* | Allows the device to import the default route whose preference value is smaller than the configured value. | The value is an integer ranging from 1 to 256. |



Views
-----

OSPFv3 view


Default Level
-------------

2: Configuration level


Usage Guidelines
----------------

**Usage Scenario**

The import-route (OSPFv3) command cannot import external default routes. To import the default routes generated by other protocols, you must run the **default-route-advertise** command on the ASBR to advertise the default routes to the entire common OSPFv3 areas.If the ASBR already has a default route, running the **default-route-advertise** command will advertise the default route 0.0.0.0 in the entire OSPF areas.If the ASBR does not have a default route, determine whether to specify always when running the **default-route-advertise** command.

* If always is configured, the ASBR advertises the default route 0.0.0.0 in the entire OSPF areas regardless of whether the ASBR has a default route, and does not calculate the default routes from other devices.
* If always is not specified, the LSA of the default route is generated only when there are active default routes of other OSPF processes in the routing table of the local device.

In a primary/backup path scenario, packets may get lost after traffic switches back to the primary path from the backup path. The severity of packet loss is proportional to the number of routes. To solve this problem, run the **default-route-advertise distribute-delay delaytimer** command on the device on the primary path to delay sending OSPFv3 default routes. This ensures that traffic is switched back after the device on the primary path completes updating forwarding entries.

**Implementation Procedure**

When you use the route-policy, note the following:

* If the default route matches the route-policy, a new default route is generated according to the parameters configured in the route-policy. The parameters that can be configured through the route-policy include the cost, tag, and type.
* If the default route does not match the route-policy and always is not configured, no new default route is generated.
* If the default route does not match the route-policy and always is configured, a new default route is generated. The parameters configured using the **default-route-advertise** command take effect.

**Configuration Impact**

The default route can be advertised through Type 3 LSAs. The PE then advertises the default route to its connected CE.

**Precautions**

* The priority of the default route parameter configured in a route-policy is higher than that of the parameter in the **default-route-advertise** command. Therefore, before running the **default-route-advertise** command, you can run the **display route-policy** command to view the configured route-policy.
* After the **default-route-advertise** command is run, all active EBGP and IBGP default routes in the routing table can be imported to OSPFv3. In this case, routing loops may occur. Therefore, exercise caution when performing this operation.
* If there is no default route in the routing table initially, the local OSPFv3 process calculates the default route learned from neighbors and delivers it to the routing table. As a result, the default route learned from other protocols (such as BGP) may be inactive. Therefore, the default route learned by OSPFv3 is displayed in the routing table. In addition, OSPFv3 does not advertise default routes.
* When the tag value of default-route-advertise is not configured:
* The tag value of the public network is the value of default-tag. The default value is 1. You can run the default (OSPFv3 view) command to change the tag value.
* The tag value of a private network is the route tag value. By default, the first two bytes of the tag value are 0xD000, and the last two bytes are the AS number of the local BGP. For example, if the AS number of the local BGP is 100, the default tag value in decimal notation is 3489661028. If the BGP AS number is greater than 65535, the tag value is 0. You can manually set the tag value. If BGP is not configured, the default value is 0. In this case, you can run the **route-tag** command to change the tag value.
* If the **default-route-advertise** command is run for an OSPFv3 process and always is not specified, the default LSA is advertised based on the active default route that does not belong to the current OSPFv3 process in the IP routing table. The priority of this default route must be higher than that of OSPFv3 routes; otherwise, OSPFv3 may fail to advertise the default LSA, or a routing loop may occur. To prevent loops, you are advised to specify permit-preference-less-than to prevent low-priority active default routes from being imported. This parameter is used only when always is not specified.
* If always is specified, the default route is advertised unconditionally. In some fault scenarios, route blackholes may occur when the route source is unreachable. Therefore, you are advised to set always according to the networking plan.
* If permit-calculate-other is not specified and OSPFv3 advertises default routes first, the device does not calculate default routes from other devices. Conversely, if OSPFv3 learns the default route first and the route is active, OSPFv3 does not advertise the default route. When a device restarts or route flapping occurs, the sequence in which OSPFv3 learns and advertises default routes may change, causing service traffic changes. Therefore, you are advised to configure permit-calculate-other to prevent this problem.

Example
-------

# Advertise the ASE LSA which generates the default route to the OSPFv3 area. The local device does not have a default route.
```
<HUAWEI> system-view
[~HUAWEI] ospfv3 1
[*HUAWEI-ospfv3-1] default-route-advertise always

```