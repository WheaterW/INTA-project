Configuration Precautions for DCB
=================================

Configuration Precautions for DCB

#### Licensing Requirements

DCB is not under license control.


#### Hardware Requirements

**Table 1** Hardware requirements
| Series | Models |
| --- | --- |
| CE6800 series | CE6855-48XS8CQ/CE6860-HAM/CE6860-SAN/CE6866-48S8CQ-K/CE6866-48S8CQ-P/CE6885-48YS8CQ/CE6863E-48S8CQ/CE6885-LL-56F (standard forwarding mode)/CE6885-48YS8CQ-T/CE6885-SAN-56F/CE6885-LL-56F (low latency mode) |
| CE8800 series | CE8850-HAM/CE8850-SAN/CE8851-32CQ8DQ-K/CE8851-32CQ8DQ-P/CE8855-32CQ4BQ/CE8851-32CQ4BQ |



#### Feature Requirements

**Table 2** Feature requirements
| Feature | Feature Requirements | Series | Models |
| --- | --- | --- | --- |
| ETS | The default scheduling mode of the CIR token bucket based on priority groups is PQ scheduling and the rate is not limited by default. The default scheduling mode of the CIR token bucket based on interface queues is DRR scheduling and the default rate limit is 0.  The priority groupâ and interface queueâbased scheduling modes configured for the CIR token bucket both do not take effect. The configured scheduling mode and the default configuration of PG0 and PG1 using DRR scheduling with their respective weight being 50 take effect only for the EIR (EIR = PIR â CIR) token bucket.  The default scheduling mode of interface queues is PQ. Therefore, unicast and multicast traffic in priority queues 0, 1, 2, 4, and 5 is scheduled in PQ mode. In queues of the same priority, unicast traffic is scheduled prior to multicast traffic. To ensure fair scheduling for unicast and multicast traffic in queues 0, 1, 2, 4, and 5, set a proper CIR value to ensure the bandwidth for multicast traffic scheduling, or configure a separate priority group for queues with specified priorities and change the scheduling mode to DRR. | CE6800 series  CE8800 series | CE6855-48XS8CQ/CE6885-48YS8CQ/CE6863E-48S8CQ/CE6885-LL-56F (standard forwarding mode)/CE6885-48YS8CQ-T/CE6885-SAN-56F  CE8855-32CQ4BQ/CE8851-32CQ4BQ |
| ETS | Queue scheduling in an ETS profile and QoS queue scheduling cannot be configured together. | CE6800 series  CE8800 series | CE6855-48XS8CQ/CE6860-HAM/CE6860-SAN/CE6866-48S8CQ-K/CE6866-48S8CQ-P/CE6885-48YS8CQ/CE6863E-48S8CQ/CE6885-LL-56F (standard forwarding mode)/CE6885-48YS8CQ-T/CE6885-SAN-56F  CE8850-HAM/CE8850-SAN/CE8851-32CQ8DQ-K/CE8851-32CQ8DQ-P/CE8855-32CQ4BQ/CE8851-32CQ4BQ |
| ETS | Queue rate limiting in an ETS profile and QoS queue rate limiting cannot be configured together. | CE6800 series  CE8800 series | CE6855-48XS8CQ/CE6860-HAM/CE6860-SAN/CE6866-48S8CQ-K/CE6866-48S8CQ-P/CE6885-48YS8CQ/CE6863E-48S8CQ/CE6885-LL-56F (standard forwarding mode)/CE6885-48YS8CQ-T/CE6885-SAN-56F  CE8850-HAM/CE8850-SAN/CE8851-32CQ8DQ-K/CE8851-32CQ8DQ-P/CE8855-32CQ4BQ/CE8851-32CQ4BQ |
| ETS | 1. After the scheduling mode and weight are configured for a priority in a PG, the configuration is delivered to the unicast and multicast queues with the priority, and the scheduling mode and weight of the unicast and multicast queues are the same as those of the priority. If SP scheduling is configured for a priority, unicast and multicast traffic with the priority is not scheduled in 1:1 mode in the case of congestion.  2. When the configurations of PG members are modified during traffic transmission, transient packet loss (millisecond-level) may occur. | CE6800 series  CE8800 series | CE6855-48XS8CQ/CE6860-HAM/CE6860-SAN/CE6866-48S8CQ-K/CE6866-48S8CQ-P/CE6885-48YS8CQ/CE6863E-48S8CQ/CE6885-LL-56F (standard forwarding mode)/CE6885-48YS8CQ-T/CE6885-SAN-56F  CE8850-HAM/CE8850-SAN/CE8851-32CQ8DQ-K/CE8851-32CQ8DQ-P/CE8855-32CQ4BQ/CE8851-32CQ4BQ |
| ETS | After rate limiting is configured for a priority in a PG, the configuration takes effect on the unicast and multicast queues with the priority, and the rate limit for the unicast and multicast queues are the same as that of the priority. If the rate limit for a priority is 1 Mbit/s, the rate limit is 2 Mbit/s for traffic with the priority during congestion (1 Mbit/s for the unicast queue and 1 Mbit/s for the multicast queue; 1M = 1024K, 1K = 1024). | CE6800 series  CE8800 series | CE6855-48XS8CQ/CE6860-HAM/CE6860-SAN/CE6866-48S8CQ-K/CE6866-48S8CQ-P/CE6885-48YS8CQ/CE6863E-48S8CQ/CE6885-LL-56F (standard forwarding mode)/CE6885-48YS8CQ-T/CE6885-SAN-56F  CE8850-HAM/CE8850-SAN/CE8851-32CQ8DQ-K/CE8851-32CQ8DQ-P/CE8855-32CQ4BQ/CE8851-32CQ4BQ |
| ETS | The scheduling between priorities in a PG takes effect on the unicast and multicast queues with the priorities. As a result, the scheduling between priorities is inaccurate. For example, traffic with some priorities cannot obtain bandwidth resources.  For example, priorities 1 and 2 exist in a PG, priority 2 is higher than priority 1, and the rate limit for priority 2 is set to 2 Mbit/s. Assume that the device receives 1.5 Mbit/s unicast traffic with priority 2, 1.5 Mbit/s multicast traffic with priority 2, and 1 Mbit/s traffic with priority 1, and the rate limit for the PG is 3 Mbit/s. In this case, traffic with priority 1 is not forwarded. (In ideal conditions, only 2 Mbit/s traffic with priority 2 is forwarded, and 1 Mbit/s traffic with priority 1 is forwarded.) | CE6800 series  CE8800 series | CE6855-48XS8CQ/CE6860-HAM/CE6860-SAN/CE6866-48S8CQ-K/CE6866-48S8CQ-P/CE6885-48YS8CQ/CE6863E-48S8CQ/CE6885-LL-56F (standard forwarding mode)/CE6885-48YS8CQ-T/CE6885-SAN-56F  CE8850-HAM/CE8850-SAN/CE8851-32CQ8DQ-K/CE8851-32CQ8DQ-P/CE8855-32CQ4BQ/CE8851-32CQ4BQ |
| PFC | When both lossless and lossy queues with the same priority are deployed and traffic congestion in the lossless queue triggers internal backpressure, the traffic forwarding performance of the lossy queue deteriorates and even packet loss occurs. | CE6800 series  CE8800 series | CE6860-HAM/CE6860-SAN/CE6866-48S8CQ-K/CE6866-48S8CQ-P  CE8850-HAM/CE8850-SAN/CE8851-32CQ8DQ-K/CE8851-32CQ8DQ-P |
| PFC | If a loopback interface is used to transmit service traffic and traffic congestion occurs on the loopback interface, the PFC function does not take effect on the device because the loopback interface does not support the PFC function, and the loopback interface cannot send or respond to PFC frames. | CE6800 series  CE8800 series | CE6855-48XS8CQ/CE6860-HAM/CE6860-SAN/CE6866-48S8CQ-K/CE6866-48S8CQ-P/CE6885-48YS8CQ/CE6863E-48S8CQ/CE6885-LL-56F (standard forwarding mode)/CE6885-48YS8CQ-T/CE6885-LL-56F (low latency mode)/CE6885-SAN-56F  CE8850-HAM/CE8850-SAN/CE8851-32CQ8DQ-K/CE8851-32CQ8DQ-P/CE8855-32CQ4BQ/CE8851-32CQ4BQ |
| PFC | Currently, the headroom buffer of the device is simulated (including the headroom buffer size on ports and global headroom buffer size). The device does not have real resources to indicate the headroom buffer usage. Therefore, the global headroom buffer usage and the headroom buffer usage on ports cannot be queried. | CE6800 series  CE8800 series | CE6860-HAM/CE6860-SAN/CE6866-48S8CQ-K/CE6866-48S8CQ-P  CE8850-HAM/CE8850-SAN/CE8851-32CQ8DQ-K/CE8851-32CQ8DQ-P |
| PFC | Currently, the headroom buffer of an interface is simulated and is not the actual one. Therefore, the headroom buffer cannot be configured. (The headroom buffer can be dynamically occupied through simulation to prevent packet loss.)  Guaranteed resources cannot be adjusted through configuration. (They are set during device initialization.) | CE6800 series  CE8800 series | CE6860-HAM/CE6860-SAN/CE6866-48S8CQ-K/CE6866-48S8CQ-P  CE8850-HAM/CE8850-SAN/CE8851-32CQ8DQ-K/CE8851-32CQ8DQ-P |
| PFC | The headroom buffer configured for a device is used only when CoS-level backpressure is triggered. This is because the PFC mechanism is triggered by software PFC. Before the remote device responds to PFC frames and reduces its packet sending rate, transmitted traffic uses the outbound buffer of the device. If the used outbound buffer size reaches the internal priority threshold and CoS-level backpressure is triggered, the configured headroom buffer resources are used. | CE6800 series  CE8800 series | CE6860-HAM/CE6860-SAN/CE6866-48S8CQ-K/CE6866-48S8CQ-P  CE8850-HAM/CE8850-SAN/CE8851-32CQ8DQ-K/CE8851-32CQ8DQ-P |
| PFC | When BUM traffic is congested, PFC is not triggered and no PFC frame is sent to the upstream device. When unicast and multicast hybrid traffic exists in the same lossless queue, multicast traffic is directly discarded after the threshold for discarding packets is reached. | CE6800 series  CE8800 series | CE6855-48XS8CQ/CE6860-HAM/CE6860-SAN/CE6866-48S8CQ-K/CE6866-48S8CQ-P/CE6885-48YS8CQ/CE6863E-48S8CQ/CE6885-LL-56F (standard forwarding mode)/CE6885-48YS8CQ-T/CE6885-LL-56F (low latency mode)/CE6885-SAN-56F  CE8850-HAM/CE8850-SAN/CE8851-32CQ8DQ-K/CE8851-32CQ8DQ-P/CE8855-32CQ4BQ/CE8851-32CQ4BQ |
| PFC | When PFC is enabled, traffic is also discarded on the outbound interface upon congestion in some scenarios.  Scenario description: A device sends PFC frames to an upstream device, but the upstream device does not respond or responds slowly. As a result, traffic continuously enters the device, and consumes buffer resources on the outbound interface. If the used buffer size exceeds the buffer usage threshold of the outbound interface and does not reach the threshold for triggering CoS-level backpressure, the outbound interface discards the traffic that causes congestion.  Solution: Locate the cause of the upstream device's failure to respond to PFC frames or slow response and rectify the fault. (In this scenario, packet loss due to congestion cannot be resolved. If the traffic volume exceeds the buffering capability of the device, the packets are discarded. The discarding location varies according to the device model. For example, some devices discard packets on the inbound interface, some devices discard packets on the outbound interface, and some devices discard packets on both the inbound and outbound interfaces. For details, see the PFC limitations.) | CE6800 series  CE8800 series | CE6860-HAM/CE6860-SAN/CE6866-48S8CQ-K/CE6866-48S8CQ-P  CE8850-HAM/CE8850-SAN/CE8851-32CQ8DQ-K/CE8851-32CQ8DQ-P |
| PFC | If the total buffer usage is too high after dynamic PFC thresholds are configured, all PFC-enabled interfaces are triggered to send PFC frames. (For example, when PFC is enabled or triggered in the case of congestion and the sender does not decrease its traffic sending rate or decreases the rate too slowly, the total buffer consumption increases continuously, resulting in high total buffer usage.) | CE6800 series  CE8800 series | CE6860-HAM/CE6860-SAN/CE6866-48S8CQ-K/CE6866-48S8CQ-P  CE8850-HAM/CE8850-SAN/CE8851-32CQ8DQ-K/CE8851-32CQ8DQ-P |
| PFC | Before running the dcb pfc enable command, run the qos buffer headroom-pool command to configure the chip-level headroom buffer size. | CE6800 series  CE8800 series | CE6855-48XS8CQ/CE6885-48YS8CQ/CE6863E-48S8CQ/CE6885-LL-56F (standard forwarding mode)/CE6885-48YS8CQ-T/CE6885-LL-56F (low latency mode)/CE6885-SAN-56F  CE8855-32CQ4BQ/CE8851-32CQ4BQ |
| PFC | If the forwarding behavior of the upstream device is set to forward during the recovery period for hardware-based deadlock detection, device-level backpressure is triggered because the local device does not process PFC in a timely manner during the recovery period for hardware-based deadlock detection. As a result, all PFC-enabled interfaces send backpressure frames or the buffer of the device is exhausted. To avoid this, you need to configure all devices on the network to discard packets during the recovery period for hardware-based deadlock detection. | CE6800 series  CE8800 series | CE6860-HAM/CE6860-SAN/CE6866-48S8CQ-K/CE6866-48S8CQ-P  CE8850-HAM/CE8850-SAN/CE8851-32CQ8DQ-K/CE8851-32CQ8DQ-P |
| PFC | For the CE8800 Series:  PFC and antilocking PFC cannot be both enabled on an interface.  For the CE8850-HAM/CE8850-SAN/CE8851-32CQ8DQ-K/CE8851-32CQ8DQ-P:  PFC and dragonfly antilocking PFC are mutually exclusive on an interface.  For the CE6800 Series:  PFC and antilocking PFC cannot be both enabled on an interface. | CE6800 series  CE8800 series | CE6860-SAN/CE6885-SAN-56F  CE8850-HAM/CE8850-SAN/CE8851-32CQ8DQ-K/CE8851-32CQ8DQ-P |
| PFC | PFC for priority 1 and differentiated flow scheduling cannot be enabled simultaneously on an interface. | CE6800 series  CE8800 series | CE6860-HAM/CE6860-SAN/CE6866-48S8CQ-K/CE6866-48S8CQ-P  CE8850-HAM/CE8850-SAN/CE8851-32CQ8DQ-K/CE8851-32CQ8DQ-P |
| PFC | For the CE6800 Series:  PFC enabling scope limitation  For the CE6860-HAM/CE6860-SAN/CE6866-48S8CQ-K/CE6866-48S8CQ-P:  PFC can be enabled for a maximum of three priorities at the same time. The priority for which PFC can be enabled ranges from 0 to 5.  For the CE6855-48XS8CQ/CE6885-48YS8CQ/CE6863E-48S8CQ/CE6885-LL-56F (standard forwarding mode)/CE6885-48YS8CQ-T/CE6885-LL-56F (low latency mode)/CE6885-SAN-56F:  The priority for which PFC can be enabled ranges from 0 to 7. PFC can be enabled for a maximum of four priorities at the same time.  For the CE8800 Series:  PFC enabling scope limitation  For the CE8850-HAM/CE8850-SAN/CE8851-32CQ8DQ-K/CE8851-32CQ8DQ-P:  PFC can be enabled for a maximum of three priorities at the same time. The priority for which PFC can be enabled ranges from 0 to 5.  For the CE8855-32CQ4BQ/CE8851-32CQ4BQ:  The priority for which PFC can be enabled ranges from 0 to 7. PFC can be enabled for a maximum of four priorities at the same time. | CE6800 series  CE8800 series | CE6855-48XS8CQ/CE6860-HAM/CE6860-SAN/CE6866-48S8CQ-K/CE6866-48S8CQ-P/CE6885-48YS8CQ/CE6863E-48S8CQ/CE6885-LL-56F (standard forwarding mode)/CE6885-48YS8CQ-T/CE6885-LL-56F (low latency mode)/CE6885-SAN-56F  CE8850-HAM/CE8850-SAN/CE8851-32CQ8DQ-K/CE8851-32CQ8DQ-P/CE8855-32CQ4BQ/CE8851-32CQ4BQ |
| PFC | An interface cannot have both PFC and flow control enabled. | CE6800 series  CE8800 series | CE6855-48XS8CQ/CE6885-48YS8CQ/CE6863E-48S8CQ/CE6885-LL-56F (standard forwarding mode)/CE6885-48YS8CQ-T/CE6885-LL-56F (low latency mode)/CE6885-SAN-56F  CE8855-32CQ4BQ/CE8851-32CQ4BQ |
| PFC | For the CE6800 Series:  1. PFC is not processed in a timely manner on a device. As a result, internal device-level backpressure is triggered, and all PFC-enabled interfaces are triggered to send PFC frames.  You are advised to enable PFC in a maximum of two priority queues. For example, when PFC is enabled in more than 256 priority queues (128 x 2: 128 PFC-enabled interfaces, each of which with PFC enabled in two priority queues), the preceding problem occurs. As a result, the overall throughput of the device decreases.  2. The default PFC profile cannot be deleted.  For the CE8800 Series:  1. PFC is not processed in a timely manner on a device. As a result, internal device-level backpressure is triggered, and all PFC-enabled interfaces are triggered to send PFC frames.  You are advised to enable PFC in a maximum of two priority queues. For example, when PFC is enabled in more than 256 priority queues (128 x 2: 128 PFC-enabled interfaces, each of which with PFC enabled in two priority queues), the preceding problem occurs. As a result, the overall throughput of the device decreases.  2. The default PFC profile cannot be deleted.  For the CE8850-HAM/CE8850-SAN/CE8851-32CQ8DQ-K/CE8851-32CQ8DQ-P:  PFC and dragonfly antilocking PFC are mutually exclusive on an interface. | CE6800 series  CE8800 series | CE6860-HAM/CE6860-SAN/CE6866-48S8CQ-K/CE6866-48S8CQ-P  CE8850-HAM/CE8850-SAN/CE8851-32CQ8DQ-K/CE8851-32CQ8DQ-P |
| PFC | The device responds to PFC frames based on priorities. When the device receives PFC frames with a priority, both unicast and multicast queues with the priority respond to PFC frames and the device stops sending traffic in the queues. | CE6800 series  CE8800 series | CE6855-48XS8CQ/CE6860-HAM/CE6860-SAN/CE6866-48S8CQ-K/CE6866-48S8CQ-P/CE6885-48YS8CQ/CE6863E-48S8CQ/CE6885-LL-56F (standard forwarding mode)/CE6885-48YS8CQ-T/CE6885-LL-56F (low latency mode)/CE6885-SAN-56F  CE8850-HAM/CE8850-SAN/CE8851-32CQ8DQ-K/CE8851-32CQ8DQ-P/CE8855-32CQ4BQ/CE8851-32CQ4BQ |