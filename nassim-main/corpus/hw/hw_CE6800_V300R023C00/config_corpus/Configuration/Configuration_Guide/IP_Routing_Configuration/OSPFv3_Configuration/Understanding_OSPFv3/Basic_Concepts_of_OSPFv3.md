Basic Concepts of OSPFv3
========================

Based on OSPFv2, OSPFv3 is an independent routing protocol intended for IPv6.

* OSPFv3 and OSPFv2 are the same in terms of working principles, which include Hello packet, state machine, link-state database (LSDB), flooding mechanism, and route calculation.
* OSPFv3 packets are encapsulated into IPv6 packets and can be transmitted in unicast or multicast mode.

#### OSPFv3 Packet Types

| Packet Type | Function |
| --- | --- |
| Hello packet | Hello packets are sent periodically to discover and maintain OSPFv3 neighbor relationships. |
| Database description (DD) packet | DD packets contain a summary of the local LSDB and are exchanged between OSPFv3 devices to synchronize their LSDBs. |
| Link state request (LSR) packet | An OSPFv3 device sends LSR packets to its neighbors to request desired link state advertisements (LSAs).  An OSPFv3 device sends LSR packets to its neighbor only after DD packets have been successfully exchanged between them. |
| Link state update (LSU) packet | LSU packets carry the LSAs required by neighbors. |
| Link state acknowledgment (LSAck) packet | LSAck packets are used to acknowledge received LSAs. |



#### LSA Types

| LSA Type | Function |
| --- | --- |
| Router-LSA (Type 1) | A device generates a router-LSA for the area in which each OSPFv3 interface resides, and advertises the LSA within the area. This LSA describes the link status and cost of the device. |
| Network-LSA (Type 2) | Describes the link status of all devices attached to the local link. Network-LSAs are generated by a designated router (DR) and advertised within the area to which the DR belongs. |
| Inter-area-prefix-LSA (Type 3) | Originated by an area border router (ABR), an inter-area-prefix-LSA describes routes to an IPv6 address prefix and is advertised to other related areas. |
| Inter-area-router-LSA (Type 4) | Generated by an ABR, this type of LSA describes the route to an autonomous system boundary router (ASBR), and is advertised to areas excluding that to which the ASBR belongs. |
| AS-external-LSA (Type 5) | Originated by ASBRs, and flooded throughout the AS, excluding stub areas and Not-So-Stubby Areas (NSSAs). Each AS-external-LSA describes a route to another AS. |
| NSSA-LSA (Type 7) | Originated by ASBRs and flooded throughout a single NSSA. NSSA-LSAs describe routes to other ASs. |
| Link-LSA (Type 8) | A device originates a separate link-LSA for each attached link. Link LSAs have scope for link-local flooding, and offer a number of functions which include providing the device's link-local address to all other devices attached to the link, informing other devices attached to the link of a list of IPv6 address prefixes to associate with the link, and allowing the device to advertise a collection of link Options bits in network-LSAs. |
| Intra-area-prefix-LSA (Type 9) | Each device and DR generate one or more intra-area-prefix-LSAs and transmit them in the areas to which the device and DR belong:   * Such LSAs generated by a device describe the IPv6 address prefixes associated with router LSAs. * Such LSAs generated by a DR describe the IPv6 address prefixes associated with network-LSAs. |
| Grace-LSA (Type 11) | During the GR process, each device that supports the GR service advertises this type of LSA to each interface. Such LSAs are advertised by specified interfaces. |
| OSPFv3 Router Information (RI) LSA (Type 12) | LSAs of this type are generated when a device needs to advertise its extension information. LSAs of this type are classified into the following types:   * Area Router Information LSA: Such types of LSAs are transmitted in the area to which the device belongs when TLVs such as the SR-Algorithm TLV and Dynamic Hostname TLV need to be advertised. * AS Router Information LSA Such types of LSAs are transmitted in all areas when TLVs such as the Dynamic Hostname TLV need to be advertised. |
| E-Router-LSA (Type 33) | When a device needs to advertise link extension TLVs, such as the End.X SID Sub-TLV and Local Interface IPv6 Address Sub-TLV, it generates LSAs of this type and advertises them in the area to which the device belongs. |
| E-AS-External-LSA (Type 37) | Such types of LSAs describe extended TLVs associated with AS-external routes, are generated by an ASBR, and advertised to all areas. |



#### Device Roles

Devices are classified into internal routers, ABRs, backbone routers, and ASBRs by location in an AS. [Figure 1](#EN-US_CONCEPT_0000001176742691__fig_dc_vrp_ospfv3_feature_200401) shows the layout of the four device roles, and [Table 1](#EN-US_CONCEPT_0000001176742691__tab_dc_vrp_ospfv3_feature_200403) lists their descriptions.

**Figure 1** Device roles in an AS  
![](figure/en-us_image_0000001176662875.png)

**Table 1** Device roles and descriptions
| Device Role | Description |
| --- | --- |
| Internal router | All interfaces on an internal router belong to the same OSPFv3 area. |
| ABR | An ABR is a device that can belong to two or more areas, one of which must be the backbone area.  An ABR connects the backbone area and non-backbone areas, and it can connect to the backbone area either physically or logically. |
| Backbone router | A backbone router is a device that has at least one interface belonging to the backbone area.  Internal routers in area 0 and all ABRs are backbone routers. |
| ASBR | An ASBR exchanges routing information with other ASs.  As an ASBR may be an internal router or an ABR, it may not necessarily reside at the border of an AS. If an OSPFv3 device has imported external routing information, the device is an ASBR. |



#### Types of OSPFv3 Routes

Routes are classified into intra-area, inter-area, and AS external routes. Intra-area and inter-area routes describe the network structure of an AS, and AS external routes describe how to select routes to destinations outside an AS. AS external routes imported by OSPFv3 are classified as Type 1 or Type 2 external routes.

[Table 2](#EN-US_CONCEPT_0000001176742691__tab_dc_vrp_ospfv3_feature_200404) describes OSPFv3 routes in descending order of priority.

**Table 2** Types of OSPFv3 routes
| Route Type | Description |
| --- | --- |
| Intra-area route | Intra-area route. |
| Inter-area route | Inter-area route. |
| Type 1 external route | As Type 1 external routes offer higher reliability than Type 2, their costs are approximately the same as those of AS internal routes and are comparable with the costs of routes generated by OSPFv3.  Cost of a Type 1 external route = Cost of the route from the local device to an ASBR + Cost of the route from the ASBR to the destination |
| Type 2 external route | Because a Type 2 external route offers low reliability, its cost is considered to be much greater than the cost of any internal route to an ASBR.  Cost of a Type 2 external route = Cost of the route from an ASBR to the destination |



#### Areas

When a large number of devices run OSPFv3, LSDBs increase in size and often require a significant amount of storage space. Large LSDBs also complicate shortest path first (SPF) computation and can overload the devices. As the network scale expands, the probability of changes to network topology increases, which causes the network to continuously change. In such cases, large numbers of OSPFv3 packets are transmitted on the network, leading to a decrease in bandwidth utilization efficiency. Every time the topology changes, each device on the network must recalculate routes.

OSPFv3 resolves this problem by partitioning an AS into different areas, each of which is regarded as a logical group and identified by an area ID. A device, not a link, resides at the border of an area, and a network segment or link can belong to only one area. An area must be specified for each OSPFv3 interface.

OSPFv3 areas include common areas, stub areas, and NSSAs. [Table 3](#EN-US_CONCEPT_0000001176742691__tab_dc_vrp_ospfv3_feature_200405) describes these in more detail.

**Table 3** Area types
| Area Type | Function | Description |
| --- | --- | --- |
| Common area | By default, OSPFv3 areas are defined as common areas, and these include:   * Standard area: transmits intra-area, inter-area, and external routes. * Backbone area: **area 0**, which connects to all other OSPFv3 areas and transmits inter-area routes. Routes between non-backbone areas must be forwarded through the backbone area. | * The backbone area must have all its devices connected. * All non-backbone areas must remain connected to the backbone area. |
| Stub area | A stub area is a non-backbone area with only one ABR, and generally resides at the border of an AS. The ABR in a stub area does not transmit received AS external routes, significantly decreasing the number of entries in the routing table on the ABR and the amount of routing information to be transmitted. To ensure the reachability of AS external routes, the ABR in the stub area generates a default route and advertises it to non-ABR devices in the stub area.  A totally stubby area allows only Type 3 LSAs carrying the default route information to be advertised within the area, and does not allow AS external routes or inter-area routes to be advertised. | * The backbone area cannot be configured as a stub area. * An ASBR cannot exist in a stub area. As such, AS external routes cannot be advertised within the stub area. |
| NSSA | An NSSA is similar to a stub area. An NSSA does not advertise Type 5 LSAs but can import AS external routes. ASBRs in an NSSA generate Type 7 LSAs to carry information about the AS external routes, and these Type 7 LSAs are advertised only within the NSSA. When the Type 7 LSAs reach an ABR in the NSSA, the ABR translates them into Type 5 LSAs, which are then flooded to all the other OSPFv3 areas.  A totally NSSA allows only intra-area routes to be advertised. Specifically, AS external routes or inter-area routes cannot be advertised in a totally NSSA. | * ABRs in an NSSA advertise Type 3 LSAs carrying the default route information within the NSSA, and all inter-area routes can be advertised only through ABRs. |



#### OSPFv3 Route Summarization

Routes with the same IPv6 prefix can be summarized into a single route. On a large OSPFv3 network, the OSPFv3 routing table often includes a large number of routing entries. The size of such routing tables can be reduced through route summarization, which accelerates route lookup and simplifies management. Route summarization also prevents route flapping and improves network stability. If a link associated with a summarized IPv6 address prefix frequently alternates between up and down, this function prevents the changes in state from being advertised to devices whose IPv6 addresses do not belong to the prefix of the summary route.

OSPFv3 route summarization can be carried out on an ABR or ASBR.

* ABR summarization
  
  An ABR can summarize routes with the same prefix into a single route, and then advertise this summary route to other areas.
  
  When advertising routing information to other areas, the ABR generates Type 3 LSAs based on IPv6 prefixes. If route summarization is enabled on the ABR of an area in which consecutive IPv6 prefixes exist, the IPv6 prefixes can be summarized into one prefix. If there are multiple LSAs that have the same prefix, the ABR summarizes these LSAs into one LSA. It then advertises the summary LSA, rather than specific LSAs of the specified network segments.
* ASBR summarization
  
  An ASBR can summarize imported routes with the same prefix into one route and then advertise this summary route to other areas.
  
  If route summarization is enabled, an ASBR summarizes imported Type 5 LSAs within the summary address range. After route summarization, the ASBR generates a Type 5 LSA only for the summary prefix, and not for any specific prefixes within the summary address range. In an NSSA, an ASBR summarizes multiple imported Type 7 LSAs within the summary address range into one Type 7 LSA.

#### OSPFv3 Multi-process

OSPFv3 multi-process allows multiple OSPFv3 processes to independently run on the same device. Route exchange between different OSPFv3 processes is similar to that between different routing protocols.