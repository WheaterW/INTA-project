Configuration Precautions for Differentiated Flow Scheduling
============================================================

Configuration Precautions for Differentiated Flow Scheduling

#### Licensing Requirements

Differentiated flow scheduling is not under license control.


#### Hardware Requirements

**Table 1** Hardware requirements
| Series | Models |
| --- | --- |
| CE6800 series | CE6820H-48S6CQ/CE6820S-48S6CQ/CE6820H-48S6CQ-K/CE6855-48XS8CQ/CE6860-HAM/CE6860-SAN/CE6863H-48S6CQ/CE6863H-48S6CQ-K/CE6866-48S8CQ-K/CE6866-48S8CQ-P/CE6881H-48S6CQ/CE6881H-48S6CQ-K/CE6881H-48T6CQ/CE6881H-48T6CQ-K/CE6885-48YS8CQ/CE6863E-48S8CQ/CE6885-LL-56F (standard forwarding mode)/CE6885-48YS8CQ-T/CE6885-SAN-56F |
| CE8800 series | CE8850-HAM/CE8850-SAN/CE8851-32CQ8DQ-K/CE8851-32CQ8DQ-P/CE8855-32CQ4BQ/CE8851-32CQ4BQ |



#### Feature Requirements

**Table 2** Feature requirements
| Feature Requirements | Series | Models |
| --- | --- | --- |
| For the CE6820H-48S6CQ/CE6820S-48S6CQ/CE6820H-48S6CQ-K/CE6863H-48S6CQ/CE6863H-48S6CQ-K/CE6881H-48S6CQ/CE6881H-48S6CQ-K/CE6881H-48T6CQ/CE6881H-48T6CQ-K:  1. Differentiated flow scheduling can be configured only when the system resource mode is balance. If the function is configured when the system resource mode is balance, disable it before switching the system resource mode.  2. PQ scheduling must be configured for mice-flow queues and queues with higher priorities than mice flows on interfaces where differentiated flow scheduling is enabled.  3. By default, the accurate flow table on the control plane in differentiated flow scheduling is aged based on the 3s aging period. The aging time of the flow table cannot be configured. Within the 3s aging period, the queue for the traffic matching the flow table is not changed.  4. Differentiated flow scheduling takes effect only for TCP packets. It takes effect for VXLAN packets only when the inner packets are TCP packets.  5. Differentiated flow scheduling takes effect on the outbound interface, and the priority of queue switching for differentiated flow scheduling is higher than that of re-marking.  6. The VPN in a flow entry generated for differentiated flow scheduling is the VPN of the inbound interface. (Special scenario: In the VPN communication scenario where the ip route-static vpn-instance vpna x.x.x.x/xx vpnb command is configured, the VPNs in a flow entry are the VPNs that require communication.)  7. Differentiated flow scheduling can be configured only on physical interfaces.  8. If there are too many packets in mice-flow queues, congestion may occur in queues whose priorities are lower than mice-flow queues.  9. When the configuration of differentiated flow scheduling is modified during traffic transmission, millisecond-level packet loss may occur.  10. Some fields (except the 5-tuple, VNI, and VRF fields) may be inaccurate when you query the flow table for differentiated flow scheduling. For example, if packets with the same 5-tuple are received from multiple inbound interfaces, only one inbound interface can be displayed. Only one flow table is generated for traffic with the same 5-tuple, VNI, and VRF on a chip.  11. For IPv4 fragmented packets whose length is greater than or equal to 1024 bytes, only the first fragment is sent to the CPU to create a flow table. Subsequent fragments of IPv4 fragmented packets cannot be identified. After a flow table is created for IPv4 fragmented packets with the length greater than or equal to 1024 bytes, the fragmented and non-fragmented packets with the same 5-tuple, VNI, and VRF are placed into the elephant-flow queue.  12. For IPv4 packets, the device cannot identify packets with options. For IPv6 packets, the device can identify only packets with TCP extension headers and VXLAN UDP extension headers.  13. Differentiated flow scheduling does not support packets with more than three outer tags. It also does not support VXLAN packets with more than two inner tags, or with more than four inner and outer tags and either inner or outer tag being IPv6, or with more than three inner and outer tags and both inner and outer tags being IPv6.  14. Differentiated flow scheduling does not support mirrored packet.  15. If packets of 1024 bytes or a larger size and packets of a size smaller than 1024 bytes both exist in flows with the same 5-tuple, VNI, and VRF, the traffic is transmitted in both the high-priority and low-priority queues.  For the CE6855-48XS8CQ/CE6885-48YS8CQ/CE6863E-48S8CQ/CE6885-LL-56F (standard forwarding mode)/CE6885-48YS8CQ-T/CE6885-SAN-56F:  1. After differentiated flow scheduling is enabled on an interface, ETS cannot be configured on the interface.  2. When you run the display qos queue statistics command to view queue-based traffic statistics on an interface, the Passed field in the command output displays the number of forwarded packets and bytes based on the original internal priorities of packets. For example, after differentiated flow scheduling is enabled for queue 2, the number of forwarded packets in elephant and mice flows is still counted in the Passed field of queue 2.  3. The number of discarded packets in mice flows after scheduling can be queried using both the display qos queue statistics and display mice-elephant-flow statistics commands.  4. When differentiated flow scheduling is enabled for a queue, the static delay of elephant flows in the queue increases by about 100 ns. (After differentiated flow scheduling is disabled, this limitation still exists.)  5. By default, the aging time of flow entries for differentiated flow scheduling is 10 ms.  6. Assume that differentiated flow scheduling is enabled and the length of packets for differentiated scheduling is less than 2048 bytes. After packets in mice flows are scheduled, the instantaneous bandwidth may exceed the interface bandwidth when scheduling of packets in elephant flows starts. As a result, congestion occurs and packets are discarded.  7. When both iNOF zone isolation and differentiated flow scheduling are configured, statistics about forwarded packets displayed in the display mice-elephant-flow statistics command output include the number of mice-flow packets that are discarded due to iNOF zone isolation.  8. Differentiated flow scheduling takes effect only for unicast TCP packets.  For the CE6860-HAM/CE6860-SAN/CE6866-48S8CQ-K/CE6866-48S8CQ-P:  1. After differentiated flow scheduling is enabled on an interface, it is recommended that SP scheduling be used for queues 6 and 7. If WDRR or LPQ scheduling is configured, packets in queues 6 and 7 are scheduled after packets in mice-flow queues.  2. After differentiated flow scheduling is enabled on an interface, ETS cannot be configured on the interface.  3. PFC and differentiated flow scheduling cannot be both configured for the same priority queue on an interface.  4. When you run the display qos queue statistics command to view queue-based traffic statistics on an interface, the Passed field in the command output displays the number of forwarded packets and bytes based on the original internal priorities of packets. For example, after differentiated flow scheduling is enabled for queue 2, the number of forwarded packets in elephant and mice flows is still counted in the Passed field of queue 2.  5. The number of discarded packets in mice flows after scheduling cannot be queried using the display qos queue statistics command, but can be queried using the display mice-elephant-flow statistics command.  6. When differentiated flow scheduling is enabled for a queue, the static delay of elephant flows in the queue increases by about 100 ns. (After differentiated flow scheduling is enabled, this limitation still exists.)  7. By default, the aging time of flow entries for differentiated flow scheduling is 10 ms. If you run the hardware aging-time command to change the aging time after the AnyFlow function is enabled, the flow entries for differentiated flow scheduling are aged based on the newly configured aging time.  8. When mice flows are scheduled to a high-priority PQ queue, their scheduling priorities are lower than queues 7 and 6 (PQ queues by default) but higher than queues 0 to 5. If there are too many packets in the mice flow queue, congestion may occur in queues 0 to 5.  9. Assume that differentiated flow scheduling is enabled and the length of packets for differentiated scheduling is less than 2048 bytes. After packets in mice flows are scheduled, the instantaneous bandwidth may exceed the interface bandwidth when scheduling of packets in elephant flows starts. As a result, congestion occurs and packets are discarded.  10. When the configuration of differentiated flow scheduling is modified during traffic transmission, millisecond-level packet loss may occur.  11. Differentiated flow scheduling and PFC for priority queue 1 cannot be both enabled on an interface.  12. When both iNOF zone isolation and differentiated flow scheduling are configured, statistics about forwarded packets displayed in the display mice-elephant-flow statistics command output include the number of mice-flow packets that are discarded due to iNOF zone isolation.  13. Differentiated flow scheduling takes effect only for known unicast TCP packets.  For the CE8855-32CQ4BQ/CE8851-32CQ4BQ:  1. After differentiated flow scheduling is enabled on an interface, ETS cannot be configured on the interface.  2. When you run the display qos queue statistics command to view queue-based traffic statistics on an interface, the Passed field in the command output displays the number of forwarded packets and bytes based on the original internal priorities of packets. For example, after differentiated flow scheduling is enabled for queue 2, the number of forwarded packets in elephant and mice flows is still counted in the Passed field of queue 2.  3. The number of discarded packets in mice flows after scheduling can be queried using both the display qos queue statistics and display mice-elephant-flow statistics commands.  4. When differentiated flow scheduling is enabled for a queue, the static delay of elephant flows in the queue increases by about 100 ns. (After differentiated flow scheduling is disabled, this limitation still exists.)  5. By default, the aging time of flow entries for differentiated flow scheduling is 10 ms.  6. Assume that differentiated flow scheduling is enabled and the length of packets for differentiated scheduling is less than 2048 bytes. After packets in mice flows are scheduled, the instantaneous bandwidth may exceed the interface bandwidth when scheduling of packets in elephant flows starts. As a result, congestion occurs and packets are discarded.  7. When both iNOF zone isolation and differentiated flow scheduling are configured, statistics about forwarded packets displayed in the display mice-elephant-flow statistics command output include the number of mice-flow packets that are discarded due to iNOF zone isolation.  8. Differentiated flow scheduling takes effect only for unicast TCP packets.  For the CE8850-HAM/CE8850-SAN/CE8851-32CQ8DQ-K/CE8851-32CQ8DQ-P:  1. After differentiated flow scheduling is enabled on an interface, it is recommended that SP scheduling be used for queues 6 and 7. If WDRR or LPQ scheduling is configured, packets in queues 6 and 7 are scheduled after packets in mice-flow queues.  2. After differentiated flow scheduling is enabled on an interface, ETS cannot be configured on the interface.  3. PFC and differentiated flow scheduling cannot be both configured for the same priority queue on an interface.  4. When you run the display qos queue statistics command to view queue-based traffic statistics on an interface, the Passed field in the command output displays the number of forwarded packets and bytes based on the original internal priorities of packets. For example, after differentiated flow scheduling is enabled for queue 2, the number of forwarded packets in elephant and mice flows is still counted in the Passed field of queue 2.  5. The number of discarded packets in mice flows after scheduling cannot be queried using the display qos queue statistics command, but can be queried using the display mice-elephant-flow statistics command.  6. When differentiated flow scheduling is enabled for a queue, the static delay of elephant flows in the queue increases by about 100 ns. (After differentiated flow scheduling is enabled, this limitation still exists.)  7. By default, the aging time of flow entries for differentiated flow scheduling is 10 ms. If you run the hardware aging-time command to change the aging time after the AnyFlow function is enabled, the flow entries for differentiated flow scheduling are aged based on the newly configured aging time.  8. When mice flows are scheduled to a high-priority PQ queue, their scheduling priorities are lower than queues 7 and 6 (PQ queues by default) but higher than queues 0 to 5. If there are too many packets in the mice flow queue, congestion may occur in queues 0 to 5.  9. Assume that differentiated flow scheduling is enabled and the length of packets for differentiated scheduling is less than 2048 bytes. After packets in mice flows are scheduled, the instantaneous bandwidth may exceed the interface bandwidth when scheduling of packets in elephant flows starts. As a result, congestion occurs and packets are discarded.  10. When the configuration of differentiated flow scheduling is modified during traffic transmission, millisecond-level packet loss may occur.  11. Differentiated flow scheduling and PFC for priority queue 1 cannot be both enabled on an interface.  12. When both iNOF zone isolation and differentiated flow scheduling are configured, statistics about forwarded packets displayed in the display mice-elephant-flow statistics command output include the number of mice-flow packets that are discarded due to iNOF zone isolation.  13. Differentiated flow scheduling takes effect only for known unicast TCP packets. | CE6800 series  CE8800 series | CE6820H-48S6CQ/CE6820S-48S6CQ/CE6820H-48S6CQ-K/CE6855-48XS8CQ/CE6860-HAM/CE6860-SAN/CE6863H-48S6CQ/CE6863H-48S6CQ-K/CE6866-48S8CQ-K/CE6866-48S8CQ-P/CE6881H-48S6CQ/CE6881H-48S6CQ-K/CE6881H-48T6CQ/CE6881H-48T6CQ-K/CE6885-48YS8CQ/CE6863E-48S8CQ/CE6885-LL-56F (standard forwarding mode)/CE6885-48YS8CQ-T/CE6885-SAN-56F  CE8850-HAM/CE8850-SAN/CE8851-32CQ8DQ-K/CE8851-32CQ8DQ-P/CE8855-32CQ4BQ/CE8851-32CQ4BQ |