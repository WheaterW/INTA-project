Configuring an RSA/SM2 Key Pair
===============================

Configuring an RSA/SM2 Key Pair

#### Context

Local certificates are signed and issued by the CA. A local certificate is a bundle of a public key and a PKI entity. As such, before applying for a local certificate, you must configure the RSA/SM2 key pair to generate public and private keys. The public key is sent by the PKI entity to the CA, and the peer uses this key to encrypt clear text. In contrast, the private key is retained by the PKI entity, which uses it to digitally sign and decrypt the peer's ciphertext.

You can configure an RSA/SM2 key pair using either of the following methods:

* Create an RSA/SM2 key pair.
  
  You can directly create an RSA/SM2 key pair on the device, without the need to import it to the device memory. During RSA/SM2 key pair creation, the system prompts you to enter the number of bits for the public key, which ranges from 2048 to 4096. A longer public key indicates higher security but slower calculation.
* Import an RSA/SM2 key pair.
  
  To use the RSA/SM2 key pair generated by another PKI entity, upload the RSA/SM2 key pair to the device through FTP or SFTP and then import it to the device memory. Otherwise, the RSA/SM2 key pair does not take effect on the device.

#### Procedure

1. Enter the system view.
   
   
   ```
   [system-view](cmdqueryname=system-view)
   ```
2. Configure an RSA/SM2 key pair using either of the following methods.
   
   
   
   **Table 1** 
   | Operation | Command | Description |
   | --- | --- | --- |
   | Create an RSA/SM2 key pair. | [**pki rsa local-key-pair create**](cmdqueryname=pki+rsa+local-key-pair+create) *key-name* [ **modulus** *modulus-size* ] [ [**exportable**](cmdqueryname=exportable) ] | The created RSA key pair can be exported only when the [**exportable**](cmdqueryname=exportable) parameter is specified in the command. |
   | [**pki sm2 local-key-pair create**](cmdqueryname=pki+sm2+local-key-pair+create) *key-name* [ **exportable** ] | The created SM2 key pair can be exported only when the [**exportable**](cmdqueryname=exportable) parameter is specified in the command. |
   | Import an RSA/SM2 key pair. | [**pki import rsa-key-pair**](cmdqueryname=pki+import+rsa-key-pair) *keyname* [ **exclude-cert** ] { [**pem**](cmdqueryname=pem) | [**pkcs12**](cmdqueryname=pkcs12) } *filename* [ **exportable** ] [ [**password**](cmdqueryname=password) *password* ] | If the **exclude-cert** parameter is specified in the command, the certificate in the file will not be imported to the device. |
   | [**pki import sm2-key-pair**](cmdqueryname=pki+import+sm2-key-pair) *keyname* **pem** *filename* [ **exportable** ] **signkey** *signkey-name* [ **certificate** *certificate-name* ] | The imported SM2 key pair can be exported only when the [**exportable**](cmdqueryname=exportable) parameter is specified in the command. |
3. Commit the configuration.
   
   
   ```
   [commit](cmdqueryname=commit)
   ```

#### Verifying the Configuration

* Run the [**display pki rsa local-key-pair**](cmdqueryname=display+pki+rsa+local-key-pair) { **pem** | **pkcs12** } *file-name* [ **password** *password* ] command to check the RSA key pair information.
* Run the [**display pki rsa local-key-pair**](cmdqueryname=display+pki+rsa+local-key-pair) [ **name** *key-name* ] **public** command to check the RSA public key information.
* Run the [**display pki sm2 local-key-pair**](cmdqueryname=display+pki+sm2+local-key-pair) [ **name** *key-name* ] **public** command to check information about SM2 key pairs and public keys.

#### Follow-up Procedure

**Table 2** 
| Operation | Command | Description |
| --- | --- | --- |
| Export the specified RSA/SM2 key pair | [**pki export rsa-key-pair**](cmdqueryname=pki+export+rsa-key-pair) *key-name* [ [**and-certificate**](cmdqueryname=and-certificate) *certificate-name* ] { [**pem**](cmdqueryname=pem) *filename* [ [**aes**](cmdqueryname=aes) ] | [**pkcs12**](cmdqueryname=pkcs12) *filename* } [**password**](cmdqueryname=password) *password* | To back up RSA key pairs or use them on other devices, run this command in the system view to export the specified RSA key pair to the device memory. In addition to the RSA key pair, its associated certificate and certificate chain will also be exported. You can then obtain the RSA key pair using FTP or SFTP. |
| [**pki export sm2-key-pair**](cmdqueryname=pki+export+sm2-key-pair) *keyname* **pem** *filename* [ **password** *password* ] | To back up SM2 key pairs or use them on other devices, run this command in the system view to export the specified SM2 key pair to the device memory. You can then obtain the SM2 key pair using FTP or SFTP. |
| Destroy a specified RSA/SM2 key pair | [**pki rsa local-key-pair destroy**](cmdqueryname=pki+rsa+local-key-pair+destroy) *key-name* | When RSA key pairs are leaked, damaged, lost, or unused, run this command in the system view to destroy a specified RSA key pair. After this command is executed, the system deletes the specified RSA key pair. |
| [**pki sm2 local-key-pair destroy**](cmdqueryname=pki+sm2+local-key-pair+destroy) *key-name* | When SM2 key pairs are leaked, damaged, lost, or unused, run this command in the system view to destroy a specified RSA key pair. After this command is executed, the system deletes the specified SM2 key pair. |
| Search for the RSA/SM2 key pair associated with a specific certificate | [**pki match-rsa-key**](cmdqueryname=pki+match-rsa-key) **certificate-filename** *file-name* | To check the RSA key pair corresponding to a certificate, run this command in the system view to configure a device to search for the RSA key pair associated with a specific certificate. |
| [**pki match-sm2-key certificate-filename**](cmdqueryname=pki+match-sm2-key+certificate-filename) *file-name* | To check the SM2 key pair corresponding to a certificate, run this command in the system view to configure a device to search for the SM2 key pair associated with a specific certificate. |