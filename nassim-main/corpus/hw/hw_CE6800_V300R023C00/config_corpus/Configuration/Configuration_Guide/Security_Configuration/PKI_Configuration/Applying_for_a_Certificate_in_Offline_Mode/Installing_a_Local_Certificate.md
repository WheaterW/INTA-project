Installing a Local Certificate
==============================

Installing a Local Certificate

#### Context

After obtaining a local certificate in out-of-band mode (for example, by disk or email), you need to upload the local certificate to the specified storage directory on the device. Before installing a local certificate, you need to upload the certificate to **flash:/pki/public**.

The device automatically saves the local certificate that has been downloaded using LDAP to **flash:/pki/public**.

After the local certificate is saved to the specified directory, you also need to import it into the device memory. After the device restarts, the system automatically loads the certificate.

![](public_sys-resources/note_3.0-en-us.png) 

To prevent a certificate installation failure, ensure that the local certificate file size does not exceed 1 MB.

By default, the public system has a PKI realm named **default**. The initial local certificate on the device is stored in the **default** realm by default. The **default** realm can be modified but cannot be deleted.

The initial local certificate that identifies a Huawei device provides certificate authentication for user login services of the device by default.



#### Procedure

1. **Optional:** Enter the user view and download the local certificate to the **flash:/pki/public** directory.
   
   
   
   To obtain the local certificate in out-of-band mode and upload it to the device storage through FTP or SFTP (SFTP is recommended because it is more secure than FTP), perform this step. If you obtain the local certificate using LDAP, skip this step.
   
   
   
   ```
   [cd pki](cmdqueryname=cd+pki)
   [cd public](cmdqueryname=cd+public)/
   [ftp 172.16.104.110](cmdqueryname=ftp+172.16.104.110)
   Trying 172.16.104.110...
   Press CTRL+K to abort
   Connected to 172.16.104.110.
   220 FTP service ready.
   User(172.16.104.110:(none)):ftpuser
   331 Password required for ftpuser
   Enter password:
   230 User logged in.
   [get device.cer](cmdqueryname=get+device.cer)
   200 Port command okay.
   150 Opening ASCII mode data connection for temp1.c.
   226 Transfer complete.
   FTP: 4 byte(s) received in 8.190 second(s) .48byte(s)/sec.
   ```
2. Enter the system view.
   
   
   ```
   [system-view](cmdqueryname=system-view)
   ```
3. **Optional:** Load the initial local certificate to the **default** realm.
   
   
   ```
   [pki import-certificate](cmdqueryname=pki+import-certificate) default_local realm default
   ```
   
   The initial local certificate can be deleted. To restore the initial local certificate after it is deleted, run this command to load the certificate from the NVRAM to the **default** realm.
4. Create a PKI realm.
   
   
   ```
   [pki realm](cmdqueryname=pki+realm) realm-name
   quit
   ```
5. In the system view, import the local certificate into the device memory.
   
   
   * When applying for a local certificate from the CA based on the PKI entity information and RSA key pair created in the local PKI entity, you only need to run the following command to import the local certificate into the device memory. The RSA key pair has been imported into the device memory by default during the creation of the RSA key pair.
     ```
     [pki import-certificate](cmdqueryname=pki+import-certificate) local [ [ realm realm-name ] { der | pkcs12 | pem } ] filename file-name [ cert-name cert-name ] [ no-check-hash-alg ] [ no-check-same-name ]
     ```
   * If you need to use the key pair generated by another PKI entity and the certificate of another PKI entity, you need to import both the certificate and key pair. A key pair file can either be included in a certificate file or exist independently of the certificate file. The methods of importing a key pair file vary accordingly. Select a method of importing a key pair file accordingly.
     + If the key pair file is included in a certificate file:
       ```
       [pki import rsa-key-pair](cmdqueryname=pki+import+rsa-key-pair) keyname { [pem](cmdqueryname=pem) | [pkcs12](cmdqueryname=pkcs12) } file-name [ exportable ] [ [password](cmdqueryname=password) password ]
       ```
     + If the key pair file exists independently of the certificate file:# Import the certificate file.
       ```
       [pki import-certificate](cmdqueryname=pki+import-certificate) local [ [ realm realm-name ] { der | pkcs12 | pem } ] filename file-name [ cert-name cert-name ] [ no-check-hash-alg ] [ no-check-same-name ]
       ```
       
       # Import the key pair file.
       ```
       [pki import rsa-key-pair](cmdqueryname=pki+import+rsa-key-pair) keyname exclude-cert { [pem](cmdqueryname=pem) | [pkcs12](cmdqueryname=pkcs12) } file-name [ exportable ] [ [password](cmdqueryname=password) password ]
       ```
   
   ![](public_sys-resources/note_3.0-en-us.png) 
   
   If no certificate format is specified, the system automatically detects the certificate format and imports the certificate.
6. **Optional:** Set the number of days in advance you are notified that the local certificate in the memory is about to expire.
   
   
   ```
   [pki set-certificate expire-prewarning](cmdqueryname=pki+set-certificate+expire-prewarning) day
   ```
7. Commit the configuration.
   
   
   ```
   [commit](cmdqueryname=commit)
   ```

#### Verifying the Configuration

Run the [**display pki certificate**](cmdqueryname=display+pki+certificate) **local** [ **realm** *realm-name* | **filename** *filename* ] command to check the local certificate that has been loaded on the device.