Configuration Precautions for IP multicast over VXLAN
=====================================================

Configuration Precautions for IP multicast over VXLAN

#### Licensing Requirements

VXLAN must have been deployed on the network before you deploy IPv4 multicast over VXLAN. The VXLAN function license has been installed and activated before delivery. You do not need to manually activate it.


#### Hardware Requirements

**Table 1** Hardware requirements
| Series | Models |
| --- | --- |
| CE6800 series | CE6855-48XS8CQ/CE6860-HAM/CE6860-SAN/CE6863H-48S6CQ/CE6863H-48S6CQ-K/CE6866-48S8CQ-K/CE6866-48S8CQ-P/CE6881H-48S6CQ/CE6881H-48S6CQ-K/CE6881H-48T6CQ/CE6881H-48T6CQ-K/CE6885-48YS8CQ/CE6863E-48S8CQ/CE6885-LL-56F (standard forwarding mode)/CE6885-48YS8CQ-T/CE6885-SAN-56F |
| CE8800 series | CE8850-HAM/CE8850-SAN/CE8851-32CQ8DQ-K/CE8851-32CQ8DQ-P/CE8855-32CQ4BQ/CE8851-32CQ4BQ |



#### Feature Requirements

**Table 2** Feature requirements
| Feature | Feature Requirements | Series | Models |
| --- | --- | --- | --- |
| IPv4 multicast over VXLAN | IPv4 multicast over VXLAN does not support Register message sending when the inbound interface of a tunnel is a VBDIF member interface. | CE6800 series  CE8800 series | CE6855-48XS8CQ/CE6860-HAM/CE6860-SAN/CE6863H-48S6CQ/CE6863H-48S6CQ-K/CE6866-48S8CQ-K/CE6866-48S8CQ-P/CE6881H-48S6CQ/CE6881H-48S6CQ-K/CE6881H-48T6CQ/CE6881H-48T6CQ-K/CE6885-48YS8CQ/CE6863E-48S8CQ/CE6885-LL-56F (standard forwarding mode)/CE6885-48YS8CQ-T/CE6885-SAN-56F  CE8850-HAM/CE8850-SAN/CE8851-32CQ8DQ-K/CE8851-32CQ8DQ-P/CE8855-32CQ4BQ/CE8851-32CQ4BQ |
| IPv4 multicast over VXLAN | This function depends on the VXLAN feature and can be used only on VXLAN-enabled devices. | CE6800 series  CE8800 series | CE6855-48XS8CQ/CE6860-HAM/CE6860-SAN/CE6863H-48S6CQ/CE6863H-48S6CQ-K/CE6866-48S8CQ-K/CE6866-48S8CQ-P/CE6881H-48S6CQ/CE6881H-48S6CQ-K/CE6881H-48T6CQ/CE6881H-48T6CQ-K/CE6885-48YS8CQ/CE6863E-48S8CQ/CE6885-LL-56F (standard forwarding mode)/CE6885-48YS8CQ-T/CE6885-SAN-56F  CE8850-HAM/CE8850-SAN/CE8851-32CQ8DQ-K/CE8851-32CQ8DQ-P/CE8855-32CQ4BQ/CE8851-32CQ4BQ |
| IPv4 multicast over VXLAN | IPv4 multicast over VXLAN can only be configured to run both Layer 2 and Layer 3 IPv4 multicast services on a VBDIF interface, and PIM (PIM-SM) and IGMP must be enabled on the VBDIF interface. | CE6800 series  CE8800 series | CE6855-48XS8CQ/CE6860-HAM/CE6860-SAN/CE6863H-48S6CQ/CE6863H-48S6CQ-K/CE6866-48S8CQ-K/CE6866-48S8CQ-P/CE6881H-48S6CQ/CE6881H-48S6CQ-K/CE6881H-48T6CQ/CE6881H-48T6CQ-K/CE6885-48YS8CQ/CE6863E-48S8CQ/CE6885-LL-56F (standard forwarding mode)/CE6885-48YS8CQ-T/CE6885-SAN-56F  CE8850-HAM/CE8850-SAN/CE8851-32CQ8DQ-K/CE8851-32CQ8DQ-P/CE8855-32CQ4BQ/CE8851-32CQ4BQ |
| IPv4 multicast over VXLAN | IPv4 multicast over VXLAN is not supported in active-active gateway scenarios. | CE6800 series  CE8800 series | CE6855-48XS8CQ/CE6860-HAM/CE6860-SAN/CE6863H-48S6CQ/CE6863H-48S6CQ-K/CE6866-48S8CQ-K/CE6866-48S8CQ-P/CE6881H-48S6CQ/CE6881H-48S6CQ-K/CE6881H-48T6CQ/CE6881H-48T6CQ-K/CE6885-48YS8CQ/CE6863E-48S8CQ/CE6885-LL-56F (standard forwarding mode)/CE6885-48YS8CQ-T/CE6885-SAN-56F  CE8850-HAM/CE8850-SAN/CE8851-32CQ8DQ-K/CE8851-32CQ8DQ-P/CE8855-32CQ4BQ/CE8851-32CQ4BQ |
| IPv4 multicast over VXLAN | IPv4 multicast over VXLAN cannot be associated with segment VXLAN (VXLAN mapping). | CE6800 series  CE8800 series | CE6855-48XS8CQ/CE6860-HAM/CE6860-SAN/CE6863H-48S6CQ/CE6863H-48S6CQ-K/CE6866-48S8CQ-K/CE6866-48S8CQ-P/CE6881H-48S6CQ/CE6881H-48S6CQ-K/CE6881H-48T6CQ/CE6881H-48T6CQ-K/CE6885-48YS8CQ/CE6863E-48S8CQ/CE6885-LL-56F (standard forwarding mode)/CE6885-48YS8CQ-T/CE6885-SAN-56F  CE8850-HAM/CE8850-SAN/CE8851-32CQ8DQ-K/CE8851-32CQ8DQ-P/CE8855-32CQ4BQ/CE8851-32CQ4BQ |
| IPv4 multicast over VXLAN | Restrictions on IPv4 multicast over VXLAN on the underlay network:  1. The underlay multicast outbound interface cannot be configured to forward multicast packets in untagged mode. Layer 3 main interfaces are recommended.  2. For IPv4 Layer 3 multicast on distributed VXLAN gateways, underlay multicast takes effect only in PIM-SM (SSM and ASM models) and does not take effect in PIM-DM or Bidir-PIM scenarios. | CE6800 series  CE8800 series | CE6855-48XS8CQ/CE6860-HAM/CE6860-SAN/CE6863H-48S6CQ/CE6863H-48S6CQ-K/CE6866-48S8CQ-K/CE6866-48S8CQ-P/CE6881H-48S6CQ/CE6881H-48S6CQ-K/CE6881H-48T6CQ/CE6881H-48T6CQ-K/CE6885-48YS8CQ/CE6863E-48S8CQ/CE6885-LL-56F (standard forwarding mode)/CE6885-48YS8CQ-T/CE6885-SAN-56F  CE8850-HAM/CE8850-SAN/CE8851-32CQ8DQ-K/CE8851-32CQ8DQ-P/CE8855-32CQ4BQ/CE8851-32CQ4BQ |
| IPv4 multicast over VXLAN | Restrictions on IPv4 multicast over VXLAN and overlay:  1. IPv4 multicast over VXLAN takes effect only when the overlay network is an IPv4 network.  2. For IPv4 multicast over VXLAN, only PIM SM (SSM and ASM models) takes effect. PIM DM does not take effect in Bidir-PIM scenarios.  3. The RP must be reachable in the local VRF or in the local VRF.  4. This function does not take effect when a multicast source is multi-homed to different VTEPs. In this case, the multicast source can be dual-homed to VXLAN active-active devices.  5. Local reserved multicast groups cannot be used for IPv4 Layer 3 multicast on distributed VXLAN gateways.  6. NG MVPN uses BGP to transmit signaling, which does not take effect in NG MVPN extranet scenarios.  7. The configured route-import local-admin-id must be unique in the VRF.  8. For NG MVPN, only I-PMSI tunnels take effect. S-PMSI tunnels and wildcard tunnels do not take effect.  9. NG MVPN and Rosen MVPN are mutually exclusive.  10. When IGMP snooping is configured for a BD on a VTEP, the multicast source and multicast group must connect to the BD through Layer 2 sub-interfaces, but cannot connect to the BD through binding between VLANs and BDs.  11. After IGMP snooping is enabled in a BD, the traffic encapsulation type of the Layer 2 sub-interface bound to the BD cannot be changed and cannot be default. You can shut down the Layer 2 sub-interface, disable IGMP snooping in the BD, and change the sub-interface type. After the sub-interface status is restored, users need to order programs again.  12. Unknown multicast flows are multicast data packets that do not match any entry in the multicast forwarding table. By default, a switch broadcasts unknown multicast flows in a BD in a distributed VXLAN gateway IPv4 Layer 3 multicast scenario. After a multicast flow triggers the generation of a multicast forwarding table (S, G), on-demand forwarding is not broadcast in the BD. | CE6800 series  CE8800 series | CE6855-48XS8CQ/CE6860-HAM/CE6860-SAN/CE6863H-48S6CQ/CE6863H-48S6CQ-K/CE6866-48S8CQ-K/CE6866-48S8CQ-P/CE6881H-48S6CQ/CE6881H-48S6CQ-K/CE6881H-48T6CQ/CE6881H-48T6CQ-K/CE6885-48YS8CQ/CE6863E-48S8CQ/CE6885-LL-56F (standard forwarding mode)/CE6885-48YS8CQ-T/CE6885-SAN-56F  CE8850-HAM/CE8850-SAN/CE8851-32CQ8DQ-K/CE8851-32CQ8DQ-P/CE8855-32CQ4BQ/CE8851-32CQ4BQ |
| IPv4 multicast over VXLAN | 1. VXLAN active-active gateways run the IPv4 multicast over VXLAN function. In an M-LAG active-active scenario, a bypass tunnel needs to be configured.  2. VXLAN active-active devices must be configured with the same root IP address (using the multicast mvpn X.X.X.X command). The root IP address must be a VTEP IP address.  3. To enable IPv4 multicast over VXLAN on VXLAN active-active gateways, you need to perform the same configurations on the M-LAG master and backup devices: global multicast enabling, VPN multicast configuration (including the RD value of the IPv4 address family), and VBDIF multicast configuration.  4. In distributed VXLAN active-active gateways for Layer 3 multicast, VXLAN gateways cannot be used as isolated Layer 3 nodes. It is strongly recommended that leaf nodes be connected to spine nodes through multiple ECMP links and inter-card reliability be enhanced.  Other reliability enhancement solutions when all upstream Layer 3 networks of distributed VXLAN gateways are disconnected:  Alternative solution 1: Configure a Monitor Link group to associate downlink interfaces. When all uplinks are faulty, set the downlink interfaces and peer-link interfaces to Down.  Alternative solution 2: Add Layer 3 links between active-active devices and configure routes with lower priorities as backup links (only public links can be used).  Note: When the M-LAG heartbeat uses the management network, if the uplink of the M-LAG master device is faulty and the peer-link goes Down through the monitor-link, the M-LAG link of the M-LAG backup device enters the error-down state. In this scenario, solution 1 cannot be used, and solution 2 can be used.  5. When a multicast source is dual-homed to M-LAG devices through the underlay network, Layer 3 cables must be added and multicast PIM must be enabled.  Note: When an M-LAG device has multicast services in N VPNs, you need to configure N Layer 3 sub-interfaces for the Layer 3 link and then bind the Layer 3 link to the VPNs.  6. A multicast source can be dual-homed to M-LAG member interfaces, and dual-homing can be changed to single-homing upon a link failure.  7. When a multicast receiver is dual-homed to two M-LAG member interfaces in active/standby mode and the active network adapter is faulty, the standby network adapter is activated and sends IGMP Report messages again to order programs. | CE6800 series  CE8800 series | CE6855-48XS8CQ/CE6860-HAM/CE6860-SAN/CE6863H-48S6CQ/CE6863H-48S6CQ-K/CE6866-48S8CQ-K/CE6866-48S8CQ-P/CE6881H-48S6CQ/CE6881H-48S6CQ-K/CE6881H-48T6CQ/CE6881H-48T6CQ-K/CE6885-48YS8CQ/CE6863E-48S8CQ/CE6885-LL-56F (standard forwarding mode)/CE6885-48YS8CQ-T/CE6885-SAN-56F  CE8850-HAM/CE8850-SAN/CE8851-32CQ8DQ-K/CE8851-32CQ8DQ-P/CE8855-32CQ4BQ/CE8851-32CQ4BQ |
| IPv4 multicast over VXLAN | The same VXLAN tunnel (that is, the same VNI and multicast group) must be configured for the same VPN in IPv4 multicast over VXLAN scenarios. | CE6800 series  CE8800 series | CE6855-48XS8CQ/CE6860-HAM/CE6860-SAN/CE6863H-48S6CQ/CE6863H-48S6CQ-K/CE6866-48S8CQ-K/CE6866-48S8CQ-P/CE6881H-48S6CQ/CE6881H-48S6CQ-K/CE6881H-48T6CQ/CE6881H-48T6CQ-K/CE6885-48YS8CQ/CE6863E-48S8CQ/CE6885-LL-56F (standard forwarding mode)/CE6885-48YS8CQ-T/CE6885-SAN-56F  CE8850-HAM/CE8850-SAN/CE8851-32CQ8DQ-K/CE8851-32CQ8DQ-P/CE8855-32CQ4BQ/CE8851-32CQ4BQ |
| IPv4 multicast over VXLAN | IPv4 Layer 3 multicast on distributed VXLAN gateways:  1. When a multicast source is connected to a VTEP and only local users order programs, multicast traffic is not forwarded to the VXLAN tunnel.  Note: Unknown multicast flows are broadcast in the BD (including the inbound tunnel). After multicast entries are generated, unknown multicast flows are not forwarded to the VXLAN tunnel.  2. A multicast source is connected to a VTEP. As long as a remote multicast user orders a program, the traffic is sent to the VXLAN tunnel. Because the VXLAN tunnel is a static multicast tunnel, all VTEPs that join the multicast group can receive the traffic. However, the VTEPs that receive the traffic can forward the traffic to the user side on demand.  3. For non-multicast source VTEPs, multicast receivers are not deployed. In network planning, VXLAN VNIs can be not bound to multicast groups to prevent multicast traffic from being received. | CE6800 series  CE8800 series | CE6855-48XS8CQ/CE6860-HAM/CE6860-SAN/CE6863H-48S6CQ/CE6863H-48S6CQ-K/CE6866-48S8CQ-K/CE6866-48S8CQ-P/CE6881H-48S6CQ/CE6881H-48S6CQ-K/CE6881H-48T6CQ/CE6881H-48T6CQ-K/CE6885-48YS8CQ/CE6863E-48S8CQ/CE6885-LL-56F (standard forwarding mode)/CE6885-48YS8CQ-T/CE6885-SAN-56F  CE8850-HAM/CE8850-SAN/CE8851-32CQ8DQ-K/CE8851-32CQ8DQ-P/CE8855-32CQ4BQ/CE8851-32CQ4BQ |
| IPv4 multicast over VXLAN | IGMP snooping over VXLAN and IPv4 multicast over VXLAN cannot be used together, and the commands are not mutually exclusive.  If MVPN is configured on the device, traffic is not forwarded through the IGMP snooping over VXLAN tunnel. | CE6800 series  CE8800 series | CE6855-48XS8CQ/CE6860-HAM/CE6860-SAN/CE6863H-48S6CQ/CE6863H-48S6CQ-K/CE6866-48S8CQ-K/CE6866-48S8CQ-P/CE6881H-48S6CQ/CE6881H-48S6CQ-K/CE6881H-48T6CQ/CE6881H-48T6CQ-K/CE6885-48YS8CQ/CE6863E-48S8CQ/CE6885-LL-56F (standard forwarding mode)/CE6885-48YS8CQ-T/CE6885-SAN-56F  CE8850-HAM/CE8850-SAN/CE8851-32CQ8DQ-K/CE8851-32CQ8DQ-P/CE8855-32CQ4BQ/CE8851-32CQ4BQ |
| IPv4 multicast over VXLAN | IPv4 multicast over VXLAN uses the multicast replication mode. The time during which excess packets are generated depends on the convergence time of the BUM multicast replication function.  (1) IPv4 multicast over VXLAN uses the multicast replication mode. BUM multicast replication generates excess packets during revertive switchover of ECMP links. For the revertive switchover performance, see "Multicast Route Link Fault".  You can run the rpf ecmp non-reverse enable command to disable the ECMP non-revertive function.  (2) Delete the IP address of the Layer 3 interface of the ECMP link on the VTEP node. When BUM multicast replication is enabled, excess packets are generated during multicast route convergence. The convergence time depends on the aging time of the outbound interface of the multicast route. The convergence time can reach 2 to 4 minutes. Do not delete the IP address.  To change the IP address of a Layer 3 interface or loopback interface, shut down the interface first. | CE6800 series  CE8800 series | CE6855-48XS8CQ/CE6860-HAM/CE6860-SAN/CE6863H-48S6CQ/CE6863H-48S6CQ-K/CE6866-48S8CQ-K/CE6866-48S8CQ-P/CE6881H-48S6CQ/CE6881H-48S6CQ-K/CE6881H-48T6CQ/CE6881H-48T6CQ-K/CE6885-48YS8CQ/CE6863E-48S8CQ/CE6885-LL-56F (standard forwarding mode)/CE6885-48YS8CQ-T/CE6885-SAN-56F  CE8850-HAM/CE8850-SAN/CE8851-32CQ8DQ-K/CE8851-32CQ8DQ-P/CE8855-32CQ4BQ/CE8851-32CQ4BQ |
| IPv4 multicast over VXLAN | For the CE6800 Series:  1. The border leaf function is available in standalone, stack, M-LAG, and external PIM neighbor scenarios.  2. Restrictions on border leaf nodes when Layer 3 multicast is enabled on distributed VXLAN gateways: When two fabrics and two border leaf nodes are deployed, only the active and standby border nodes with only one active routing path are available.  For the CE6855-48XS8CQ/CE6860-HAM/CE6860-SAN/CE6863H-48S6CQ/CE6863H-48S6CQ-K/CE6866-48S8CQ-K/CE6866-48S8CQ-P/CE6881H-48S6CQ/CE6881H-48S6CQ-K/CE6881H-48T6CQ/CE6881H-48T6CQ-K/CE6885-48YS8CQ/CE6863E-48S8CQ/CE6885-LL-56F (standard forwarding mode)/CE6885-48YS8CQ-T/CE6885-SAN-56F:  1. The border leaf function is available in standalone, M-LAG, and external PIM neighbor scenarios.  2. Restrictions on border leaf nodes when Layer 3 multicast is enabled on distributed VXLAN gateways:  When two fabrics and two border leaf nodes are deployed, only the active and standby border nodes with only one active routing path are available.  For the CE8800 Series:  1. The border leaf function is available in standalone, stack, M-LAG, and external PIM neighbor scenarios.  2. Restrictions on border leaf nodes when Layer 3 multicast is enabled on distributed VXLAN gateways: When two fabrics and two border leaf nodes are deployed, only the active and standby border nodes with only one active routing path are available.  For the CE8850-HAM/CE8850-SAN/CE8851-32CQ8DQ-K/CE8851-32CQ8DQ-P/CE8855-32CQ4BQ/CE8851-32CQ4BQ:  1. The border leaf function is available in standalone, M-LAG, and external PIM neighbor scenarios.  2. Restrictions on border leaf nodes when Layer 3 multicast is enabled on distributed VXLAN gateways:  When two fabrics and two border leaf nodes are deployed, only the active and standby border nodes with only one active routing path are available. | CE6800 series  CE8800 series | CE6855-48XS8CQ/CE6860-HAM/CE6860-SAN/CE6863H-48S6CQ/CE6863H-48S6CQ-K/CE6866-48S8CQ-K/CE6866-48S8CQ-P/CE6881H-48S6CQ/CE6881H-48S6CQ-K/CE6881H-48T6CQ/CE6881H-48T6CQ-K/CE6885-48YS8CQ/CE6863E-48S8CQ/CE6885-LL-56F (standard forwarding mode)/CE6885-48YS8CQ-T/CE6885-SAN-56F  CE8850-HAM/CE8850-SAN/CE8851-32CQ8DQ-K/CE8851-32CQ8DQ-P/CE8855-32CQ4BQ/CE8851-32CQ4BQ |
| IPv4 multicast over VXLAN | When IPv4 multicast over VXLAN is used in M-LAG networking, the two devices that form an M-LAG must be of the same type. It is recommended that the two devices be of the same model and version. | CE6800 series  CE8800 series | CE6855-48XS8CQ/CE6860-HAM/CE6860-SAN/CE6863H-48S6CQ/CE6863H-48S6CQ-K/CE6866-48S8CQ-K/CE6866-48S8CQ-P/CE6881H-48S6CQ/CE6881H-48S6CQ-K/CE6881H-48T6CQ/CE6881H-48T6CQ-K/CE6885-48YS8CQ/CE6863E-48S8CQ/CE6885-LL-56F (standard forwarding mode)/CE6885-48YS8CQ-T/CE6885-SAN-56F  CE8850-HAM/CE8850-SAN/CE8851-32CQ8DQ-K/CE8851-32CQ8DQ-P/CE8855-32CQ4BQ/CE8851-32CQ4BQ |
| IPv4 multicast over VXLAN | When IPv4 multicast over VXLAN is used to forward multicast traffic between VTEP leaf nodes, the receiver VTEP must have specific routes to the multicast source.  If the multicast source does not send ARP packets, configure static ARP on the VTEP where the multicast source resides. | CE6800 series  CE8800 series | CE6855-48XS8CQ/CE6860-HAM/CE6860-SAN/CE6863H-48S6CQ/CE6863H-48S6CQ-K/CE6866-48S8CQ-K/CE6866-48S8CQ-P/CE6881H-48S6CQ/CE6881H-48S6CQ-K/CE6881H-48T6CQ/CE6881H-48T6CQ-K/CE6885-48YS8CQ/CE6863E-48S8CQ/CE6885-LL-56F (standard forwarding mode)/CE6885-48YS8CQ-T/CE6885-SAN-56F  CE8850-HAM/CE8850-SAN/CE8851-32CQ8DQ-K/CE8851-32CQ8DQ-P/CE8855-32CQ4BQ/CE8851-32CQ4BQ |
| IPv4 multicast over VXLAN | The multicast group address bound to the VNI of the IPv4 multicast over VXLAN function cannot be the same as the multicast group IP address bound to the VNI of the VXLAN BUM packet multicast replication function. The conflict check is not performed on the command lines. Therefore, you need to avoid this problem during network planning. | CE6800 series  CE8800 series | CE6855-48XS8CQ/CE6860-HAM/CE6860-SAN/CE6863H-48S6CQ/CE6863H-48S6CQ-K/CE6866-48S8CQ-K/CE6866-48S8CQ-P/CE6881H-48S6CQ/CE6881H-48S6CQ-K/CE6881H-48T6CQ/CE6881H-48T6CQ-K/CE6885-48YS8CQ/CE6863E-48S8CQ/CE6885-LL-56F (standard forwarding mode)/CE6885-48YS8CQ-T/CE6885-SAN-56F  CE8850-HAM/CE8850-SAN/CE8851-32CQ8DQ-K/CE8851-32CQ8DQ-P/CE8855-32CQ4BQ/CE8851-32CQ4BQ |