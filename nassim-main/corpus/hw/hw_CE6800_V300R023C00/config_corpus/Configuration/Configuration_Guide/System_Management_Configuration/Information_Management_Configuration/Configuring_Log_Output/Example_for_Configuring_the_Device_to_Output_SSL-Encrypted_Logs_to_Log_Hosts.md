Example for Configuring the Device to Output SSL-Encrypted Logs to Log Hosts
============================================================================

Example for Configuring the Device to Output SSL-Encrypted Logs to Log Hosts

#### Networking Requirements

As shown in [Figure 1](#EN-US_TASK_0000001563999625__fig1056353520414), DeviceA is connected to four log hosts and has reachable routes to the log hosts. Different log hosts are expected to reliably receive logs of different types and severities so that the network administrator can monitor information generated by different modules in real time.

**Figure 1** Networking diagram of outputting SSL-encrypted logs to log hosts  
![](figure/en-us_image_0000001512680266.png)
![](public_sys-resources/note_3.0-en-us.png) 

In this example, interface1 represents 100GE1/0/1.



#### Configuration Roadmap

The configuration roadmap is as follows:

1. Configure a client SSL policy to authenticate log hosts and ensure log transmission security.
   
   Assume that each log host has obtained a certificate from the CA, and the corresponding trusted CA files **1\_cacert\_pem\_rsa.pem** and **1\_rootcert\_pem\_rsa.pem** have been uploaded to the **security** sub-directory of DeviceA.
2. Enable the IM function.
3. Configure channels and rules for outputting logs to the log hosts.
4. Configure the source interface used to send logs to the log hosts.
5. Configure the log hosts.

#### Procedure

1. Configure an IP address and a routing protocol to ensure that there is a reachable route between DeviceA and each log host. For details, see Configuration Scripts.
2. Configure a client SSL policy.
   
   
   ```
   <HUAWEI> system-view
   [~HUAWEI] sysname DeviceA
   [*HUAWEI] commit
   [~DeviceA] ssl policy syslog_client
   [*DeviceA-ssl-policy-syslog_client] trusted-ca load pem-ca 1_cacert_pem_rsa.pem
   [*DeviceA-ssl-policy-syslog_client] trusted-ca load pem-ca 1_rootcert_pem_rsa.pem
   [*DeviceA-ssl-policy-syslog_client] commit
   [~DeviceA-ssl-policy-syslog_client] quit
   ```
   
   You can run the **display ssl policy** command on DeviceA to display detailed information about the trusted CA file in the command output.
   
   ```
   [~DeviceA] display ssl policy
          SSL Policy Name: syslog_client 
        Policy Applicants: 
            Key-pair Type:
    Certificate File Type:
         Certificate Type:
     Certificate Filename:
        Key-file Filename:
                 CRL File:
          Trusted-CA File:
        Trusted-CA File 1: Format = PEM, Filename = 1_cacert_pem_rsa.pem
        Trusted-CA File 2: Format = PEM, Filename = 1_rootcert_pem_rsa.pem
   ```
3. Enable the IM function.
   
   
   ```
   [~DeviceA] info-center enable
   ```
4. Configure channels and rules for outputting logs to the log hosts.
   
   
   
   Configure DeviceA to send notification logs generated by the CLI module to Server1, and specify Server3 as the backup of Server1.
   
   Configure DeviceA to send warning logs generated by the AAA module to Server2, and specify Server4 as the backup of Server2.
   
   # Configure the information channel.
   
   ```
   [*DeviceA] info-center channel 6 name loghost1
   [*DeviceA] info-center channel 7 name loghost2
   [*DeviceA] commit
   ```
   
   # Configure information channels for outputting logs to the log hosts.
   
   ```
   [~DeviceA] info-center loghost 10.1.1.1 channel loghost1 transport tcp ssl-policy syslog_client
   [*DeviceA] info-center loghost 10.1.1.2 channel loghost1 transport tcp ssl-policy syslog_client
   [*DeviceA] info-center loghost 10.2.1.1 channel loghost2 transport tcp ssl-policy syslog_client
   [*DeviceA] info-center loghost 10.2.1.2 channel loghost2 transport tcp ssl-policy syslog_client
   [*DeviceA] commit
   ```
   
   # Configure rules for outputting logs to the log hosts.
   
   ```
   [~DeviceA] info-center source cli channel loghost1 log level notification
   [*DeviceA] info-center source aaa channel loghost2 log level warning
   [*DeviceA] commit
   ```
5. Configure the source interface used to send logs to the log hosts.
   
   
   ```
   [~DeviceA] info-center loghost source 100ge 1/0/1
   [*DeviceA] commit
   ```
6. Configure the log hosts.
   
   
   
   The log hosts can run the Unix or Linux operating system or third-party log software. For details about the configuration procedure, see the relevant documentation.

#### Verifying the Configuration

# Check recorded information related to IM.

```
[~DeviceA] display info-center
Information Center:enabled
Log host:
        10.1.1.1, channel number 6, channel name loghost1,
language English , host facility local7, transport tcp ssl-policy syslog_client
        10.1.1.2, channel number 6, channel name loghost1,
language English , host facility local7, transport tcp ssl-policy syslog_client
        10.2.1.1, channel number 7, channel name loghost2,
language English , host facility local7, transport tcp ssl-policy syslog_client
        10.2.1.2, channel number 7, channel name loghost2,
language English , host facility local7, transport tcp ssl-policy syslog_client
Console:
        channel number : 0, channel name : console
Monitor:
        channel number : 1, channel name : monitor
SNMP Agent:
        channel number : 5, channel name : snmpagent
Log buffer:
        enabled,max buffer size 10240, current buffer size 512,
current messages 316, channel number : 4, channel name : logbuffer
dropped messages 0, overwritten messages 53
Trap buffer:
        enabled,max buffer size 1024, current buffer size 256,
current messages 256, channel number:3, channel name:trapbuffer
dropped messages 0, overwritten messages 0
logfile:
        channel number : 9, channel name : channel9, language : English
Information timestamp setting:
        log - date, trap - date, debug - date millisecond

```

#### Configuration Scripts

```
#
sysname DeviceA
#
ssl policy syslog_client
 trusted-ca load pem-ca 1_cacert_pem_rsa.pem
 trusted-ca load pem-ca 1_rootcert_pem_rsa.pem
#
info-center channel 6 name loghost1
info-center channel 7 name loghost2
info-center source cli channel 6 log level notification
info-center source aaa channel 7 log level warning
info-center loghost source 100GE1/0/1
info-center loghost 10.1.1.1 channel 6 transport tcp ssl-policy syslog_client
info-center loghost 10.1.1.2 channel 6 transport tcp ssl-policy syslog_client
info-center loghost 10.2.1.1 channel 7 transport tcp ssl-policy syslog_client
info-center loghost 10.2.1.2 channel 7 transport tcp ssl-policy syslog_client
#
interface 100GE1/0/1
 undo portswitch
 ip address 10.3.1.1 255.255.0.0
#
ip route-static 10.1.1.0 255.255.255.0 172.16.0.2
ip route-static 10.2.1.0 255.255.255.0 172.16.0.2
#
return
```