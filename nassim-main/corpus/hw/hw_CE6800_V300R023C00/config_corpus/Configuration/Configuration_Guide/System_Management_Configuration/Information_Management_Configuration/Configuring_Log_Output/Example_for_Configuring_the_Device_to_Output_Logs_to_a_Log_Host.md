Example for Configuring the Device to Output Logs to a Log Host
===============================================================

Example for Configuring the Device to Output Logs to a Log Host

#### Networking Requirements

DeviceA generates a large amount of information, but the storage space available on DeviceA is limited. To avoid any storage-related issues, you can configure DeviceA to output information to a log host, which will then collect information about DeviceA. As shown in [Figure 1](#EN-US_TASK_0000001563879357__fig1056353520414), DeviceA is connected to four log hosts through a network. The network administrator requires different log hosts to receive logs of different types and severities so that the information generated by various modules can be monitored in real time.

* DeviceA sends notification logs generated by the CLI and IM modules to the log host Server1. Server3 functions as the backup server of Server1.
* DeviceA sends warning logs generated by the PP4 and AAA modules to the log host Server2. Server4 functions as the backup server of Server2.

To implement this function, you need to perform the configuration on both DeviceA and the log host.

![](public_sys-resources/note_3.0-en-us.png) 

In this example, interface1 represents 100GE1/0/1.

When configuring the device to output logs to a log host, you are advised to use SSL encryption by reference to [Example for Configuring the Device to Output SSL-Encrypted Logs to Log Hosts](vrp_info-center_cfg_0046.html).


**Figure 1** Networking diagram of outputting logs to a log host  
![](figure/en-us_image_0000001563879433.png)

#### Configuration Roadmap

The configuration roadmap is as follows:

1. Enable the IM function.
2. Configure a channel and rules for outputting logs to a log host.
3. Configure the source interface used to send logs to a log host.
4. Configure the device to output logs to a specified log host.
5. Configure the log host.

#### Procedure

1. Configure an IP address and a routing protocol to ensure that there is a reachable route between DeviceA and the log host. For details, see Configuration Scripts.
2. Enable the IM function.
   
   
   ```
   <HUAWEI> system-view
   [~HUAWEI] sysname DeviceA
   [*HUAWEI] commit
   [~DeviceA] info-center enable
   ```
3. Configure a channel and rules for outputting logs to a log host.
   
   
   
   # Configure the information channel.
   
   By default, the names of channel 2 and channel 6 are loghost and channel6, respectively. Set the name of channel 6 to loghost1.
   
   ```
   [*DeviceA] info-center channel 6 name loghost1
   [*DeviceA] commit
   ```
   
   # Configure rules for outputting logs to the log hosts.
   
   The CLI and IM modules output logs of the notification level or higher to the log host through the loghost channel.
   
   ```
   [~DeviceA] info-center source cli channel loghost log level notification
   [*DeviceA] info-center source im channel loghost log level notification
   [*DeviceA] commit
   ```
   
   The PP4 and AAA modules output logs of the warning level or higher to the log host through the loghost1 channel.
   
   ```
   [~DeviceA] info-center source pp4 channel loghost1 log level warning
   [*DeviceA] info-center source aaa channel loghost1 log level warning
   [*DeviceA] commit
   ```
4. Configure the source interface used to send logs to a log host.
   
   
   ```
   [~DeviceA] info-center loghost source 100ge 1/0/1
   [*DeviceA] *commit
   ```
5. Configure the device to output logs to a specified log host.
   
   # Specify Server1 as the log host and Server3 as the backup log host for receiving logs from CLI and IM modules, and Local2 as the log recording tool.
   ```
   [~DeviceA] info-center loghost 10.1.1.1 channel loghost facility local2
   [*DeviceA] info-center loghost 10.1.1.2 channel loghost facility local2
   [*DeviceA] commit
   ```
   
   # Specify Server2 as the log host and Server4 as the backup log host for receiving logs from PP4 and AAA modules, and Local4 as the log recording tool.
   ```
   [~DeviceA] info-center loghost 10.2.1.1 channel loghost1 facility local4
   [*DeviceA] info-center loghost 10.2.1.2 channel loghost1 facility local4
   [*DeviceA] commit
   ```
6. Configure the log host.
   
   
   
   The log host can run the Unix or Linux operating system or third-party log software. For details about the configuration procedure, see the relevant documentation.

#### Verifying the Configuration

# Check recorded information related to IM.

```
[~DeviceA] display info-center
Information Center:enabled
Log host:
        10.1.1.1, channel number 2, channel name loghost,
language English , host facility local2
        10.1.1.2, channel number 2, channel name loghost,
language English , host facility local2
        10.2.1.1, channel number 6, channel name loghost1,
language English , host facility local4
        10.2.1.2, channel number 6, channel name loghost1,
language English , host facility local4
Console:
        channel number : 0, channel name : console
Monitor:
        channel number : 1, channel name : monitor
SNMP Agent:
        channel number : 5, channel name : snmpagent
Log buffer:
        enabled,max buffer size 10240, current buffer size 512,
current messages 10, channel number : 4, channel name : logbuffer
dropped messages 0, overwritten messages 0
Trap buffer:
        enabled,max buffer size 1024, current buffer size 256,
current messages 3, channel number:3, channel name:trapbuffer
dropped messages 0, overwritten messages 0
logfile:
        channel number : 9, channel name : logfile, language : English
Information timestamp setting:
        log - date, trap - date, debug - date millisecond

```

#### Configuration Scripts

```
#
sysname DeviceA
#
info-center channel 6 name loghost1
info-center source cli channel 2 log level notification
info-center source im channel 2 log level notification
info-center source pp4 channel 6 log level warning
info-center source aaa channel 6 log level warning
info-center loghost source 100GE1/0/1
info-center loghost 10.1.1.1 facility local2
info-center loghost 10.1.1.2 facility local2
info-center loghost 10.2.1.1 channel 6 facility local4
info-center loghost 10.2.1.2 channel 6 facility local4
#
interface 100GE1/0/1
 undo portswitch
 ip address 10.3.1.1 255.255.0.0
#
ip route-static 10.1.1.0 255.255.255.0 172.16.0.2
ip route-static 10.2.1.0 255.255.255.0 172.16.0.2
#
return
```