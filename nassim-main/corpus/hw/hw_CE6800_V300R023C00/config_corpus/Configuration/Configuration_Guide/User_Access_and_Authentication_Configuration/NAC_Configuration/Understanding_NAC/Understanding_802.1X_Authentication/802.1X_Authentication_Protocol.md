802.1X Authentication Protocol
==============================

802.1X Authentication Protocol

#### Overview

In the 802.1X authentication system, the client, access device, and authentication server exchange information using the Extensible Authentication Protocol (EAP). EAP runs at the data link layer without requiring any IP address, offering great flexibility for 802.1X authentication.

* The EAP packets transmitted between the client and access device are encapsulated in EAPoL format and transmitted on the LAN.
* You can determine to use either of the following authentication modes between the access device and authentication server based on the client support and network security requirements:
  + EAP relay mode: The access device directly encapsulates the received EAP packets into RADIUS packets using EAP over RADIUS (EAPoR), and then transmits them over a complex network to the authentication server.
  + EAP termination mode: The access device terminates EAP packets and encapsulates them into RADIUS packets. The authentication server then uses the standard RADIUS protocol to carry out authentication, authorization, and accounting.


#### Authentication Mode Selection

* EAP relay mode: The authentication methods include EAP-TLS, EAP-TTLS, EAP-PEAP, EAP-CHAP, EAP\_FAST. This mode simplifies processing on the access device and supports multiple authentication methods. However, the authentication server must support EAP and have high processing capability. The most commonly used authentication modes include EAP-TLS, EAP-TTLS, and EAP-PEAP, of which EAP-TLS is the most secure because it requires certificates to be loaded on both the client and authentication server. EAP-TTLS and EAP-PEAP are easier to deploy but less secure than EAP-TLS since certificates need to be loaded only on the authentication server and not the client.
* EAP termination mode: The authentication methods include EAP-CHAP and EAP-PAP. This mode is advantageous in that mainstream RADIUS servers support Password Authentication Protocol (PAP) and Challenge Handshake Authentication Protocol (CHAP) authentication, eliminating the need for server upgrade. However, the workload on the access device is heavy because it needs to extract client authentication information from the EAP packets sent by the client and encapsulate this information using the standard RADIUS protocol. Furthermore, the access device does not support other EAP authentication methods except MD5-Challenge. In PAP authentication, passwords are transmitted in clear text, whereas in CHAP authentication, passwords are transmitted in cipher text. As such, CHAP is highly recommended thanks to its high security.

#### EAP Packets

**Figure 1** EAP packets  
![](figure/en-us_image_0000001563760881.png)

**Table 1** Fields in an EAP packet
| Field | Bytes | Description |
| --- | --- | --- |
| Code | 1 | Type of an EAP data packet:   * 1: Request * 2: Response * 3: Success * 4: Failure |
| ID | 1 | Used to match a Response packet with the corresponding Request packet. |
| Length | 2 | Length of an EAP data packet, including the **Code**, **ID**, **Length**, and **Data** fields. Bytes beyond the range of the **Length** field are treated as padding at the data link layer and ignored on reception. |
| Data | Zero or multiple bytes | The format of the **Data** field is determined by the **Code** field.   * When the value of the **Code** field is 1 or 2, the EAP data packet is a Request or Response packet, and the **Data** field contains the **Type** and **Type Data** fields, as shown in the preceding figure. The **Type** field is 1 byte long and indicates the type of the Request or Response packet. The **Type Data** field can be multiple bytes in length and its value is determined by the **Type** field. * When the value of the **Code** field is 3 or 4, the EAP data packet is a Success or Failure packet and does not have the **Data** field. |


**Table 2** Common values of the **Type** field
| Type Field Value | Packet Type | Description |
| --- | --- | --- |
| 1 | Identity | Requests or returns the user name information entered by a user. |
| 2 | Notification | Transmits notification information about some events, such as password expiry and account lockout. Such notifications are optional. |
| 3 | NAK | Indicates negative acknowledgment and is used only in a Response packet. For example, if the access device uses an authentication method that is not supported by the client to initiate a request, the client can send a Response/NAK packet to notify the access device of the authentication methods supported by the client. |
| 4 | MD5-Challenge | Indicates that the authentication method is MD5-Challenge. |
| 5 | OTP | Indicates that the authentication method is One-Time Password (OTP). For example, during e-banking payment, the system sends a one-time password through an SMS message. |
| 6 | GTC | Indicates that the authentication method is Generic Token Card (GTC). A GTC is similar to an OTP except that a GTC usually corresponds to a real device. For example, many banks in China provide a dynamic token for users who apply for e-banking. This token is known as a GTC. |
| 13 | EAP-TLS | Indicates that the authentication method is EAP-Transport Layer Security (EAP-TLS). |
| 21 | EAP-TTLS | Indicates that the authentication method is EAP-Tunneled Transport Layer Security (EAP-TTLS). |
| 25 | EAP-PEAP | Indicates that the authentication method is EAP-Protected Extensible Authentication Protocol (EAP-PEAP). |
| 254 | Expanded Types | Indicates an expanded type, which can be customized by vendors. |
| 255 | Experimental use | Indicates a type for experimental use. |



#### EAPoL

EAPoL is a packet encapsulation format defined by the 802.1X protocol and is mainly used to transmit EAP packets over a LAN between the client and access device. The following figure shows the format of an EAPoL packet.

**Figure 2** EAPoL packet  
![](figure/en-us_image_0000001564120601.png "Click to enlarge")

**Table 3** Fields in an EAPoL packet
| Field | Bytes | Description |
| --- | --- | --- |
| PAE Ethernet Type | 2 | Protocol type. The value is fixed at 0x888E. |
| Protocol Version | 1 | Protocol version number supported by the EAPoL packet sender:   * 0x01: 802.1X-2001 * 0x02: 802.1X-2004 * 0x03: 802.1X-2010 |
| Type | 1 | Type of an EAPoL packet:   * 00: EAP-Packet, which is an authentication packet that carries authentication information. * 01: EAPoL-Start, which is an authentication start packet sent by a client to initiate authentication. * 02: EAPoL-Logoff, which is a logout request packet initiated by a client. * 03: EAPoL-Key, which carries key information.   The EAPoL-Start, EAPoL-Logoff, and EAPoL-Key packets are transmitted only between the client and access device. |
| Length | 2 | Data length, that is, the length of the **Packet Body** field, in bytes. The value 0 indicates that the **Packet Body** field does not exist. For the EAPoL-Start and EAPoL-Logoff packets, the value of the **Length** field is 0. |
| Packet Body | Variable | Data content. This field exists when the **Type** field displays **EAP-Packet** or **EAPOL-Key**. Additionally, the maximum length of the field is limited by the data link layer protocol. |



#### EAPoR

In EAP relay scenarios, EAP packets are encapsulated into RADIUS packets in EAP over RADIUS (EAPoR) format. Therefore, two attributes are added to RADIUS packets: EAP-Message (EAP message) and Message-Authenticator (message authentication code), which are used to encapsulate EAP packets and authenticate and verify authentication packets to protect against spoofing of invalid packets, respectively. The following figure shows the format of an EAPoR packet.

**Figure 3** EAPoR packet  
![](figure/en-us_image_0000001563880501.png "Click to enlarge")

**Table 4** Fields in an EAPoR packet
| Field | Bytes | Description |
| --- | --- | --- |
| Code | 1 | Indicates the type of a RADIUS packet. |
| Identifier | 1 | Is used to match a Response packet with the corresponding Request packet, and to detect the Request packet retransmitted within a certain period. After the client sends a Request packet, the authentication server sends a Response packet with the same Identifier value as the Request packet. |
| Length | 2 | Indicates the length of a RADIUS packet. Bytes beyond the **Length** field must be treated as padding and ignored on reception. If the length of a received packet is less than the value of the **Length** field, the packet is discarded. |
| Response Authenticator | 16 | Is used to verify the Response packet sent by the RADIUS server and encrypt the user password. |
| Attributes | Variable length | Indicates the packet content body, which carries authentication, authorization, and accounting information as well as providing configuration details of the Request and Response packets. The **Attributes** field may contain multiple attributes, each of which consists of Type, Length, and Value.   * Type: indicates the attribute type. The length is 1 byte and the value ranges from 1 to 255. * Length: indicates the length of an attribute, including Type, Length, and Value, in bytes. * Value: indicates the attribute information. The format and content are dependent on Type and Length. The maximum length is 253 bytes. |