Configuring the DAD Delay
=========================

Configuring the DAD Delay

#### Context

If the peer-link fails but the DAD heartbeat status is normal, accelerated DAD is triggered immediately and three DAD packets are separately sent at intervals of 200 ms. As a result, exceptions occur in the following scenarios:

* If the peer-link fails because one M-LAG device restarts unexpectedly, interfaces on the other M-LAG device are triggered to enter the error-down state. As a result, both the master and backup devices are abnormal.
* In an M-LAG double-fault failure recovery scenario, if interfaces on one M-LAG device enter the error-down state due to a peer-link fault and then the other M-LAG device fails, the interfaces in the error-down state on the first M-LAG device go up and start to forward traffic. After the other M-LAG device is restarted, the heartbeat status of the M-LAG device becomes normal first. Before the peer-link interface on the M-LAG device recovers, the peer-link fails but the DAD heartbeat status is normal, triggering accelerated DAD. As a result, interfaces on the M-LAG device enter the error-down state.

To solve the preceding problems, the device supports the following functions:

* If the peer-link fails when the DAD heartbeat status is normal, three DAD packets are separately sent at intervals of 200 milliseconds after the DAD delay, which is 3 seconds by default.
* When the peer-link fails and the DAD heartbeat status is abnormal, if the DAD heartbeat status becomes normal, three DAD packets are separately sent at intervals of 200 milliseconds after the DAD delay, which is 3 seconds by default.

#### Procedure

1. Enter the system view.
   
   
   ```
   [system-view](cmdqueryname=system-view)
   ```
2. Enter the DFS group view.
   
   
   ```
   [dfs-group](cmdqueryname=dfs-group) dfs-group-id
   ```
3. Configure the DAD delay upon failure of the peer-link.
   
   
   ```
   [dual-active detection delay](cmdqueryname=dual-active+detection+delay) delaytime
   ```
   
   By default, the DAD delay upon failure of the peer-link is 3 seconds.
   
   ![](../public_sys-resources/note_3.0-en-us.png) 
   * When both M-LAG and BFD are configured, set *delaytime* to a value less than 1 second to prevent BFD session flapping upon failure of the peer-link.
   * In an M-LAG multicast traffic forwarding scenario, set *delaytime* to a value less than 1 second to reduce excess multicast packets upon failure of the peer-link.
   * If the DFS configuration exists and the [**dual-active detection delay**](cmdqueryname=dual-active+detection+delay) command is not supported before an upgrade, a configuration with *delaytime* being 3000 is generated by default after the upgrade.
4. Configure the DAD delay upon M-LAG heartbeat recovery.
   
   
   ```
   [dual-active detection hold-time](cmdqueryname=dual-active+detection+hold-time) holdtime
   ```
   
   By default, the DAD delay upon M-LAG heartbeat recovery is 3 seconds.
   
   ![](../public_sys-resources/note_3.0-en-us.png) 
   
   To prevent interfaces on one M-LAG device from entering the error-down state incorrectly, you are advised to set the DAD delay upon M-LAG heartbeat recovery to 3 seconds or longer and set the delay for network-side interfaces of M-LAG devices to go up to be at least 3 seconds longer than the delay for peer-link interfaces to go up.
5. Commit the configuration.
   
   
   ```
   [commit](cmdqueryname=commit)
   ```