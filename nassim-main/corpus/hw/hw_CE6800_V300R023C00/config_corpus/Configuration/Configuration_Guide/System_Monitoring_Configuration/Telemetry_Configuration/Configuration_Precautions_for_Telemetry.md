Configuration Precautions for Telemetry
=======================================

Configuration Precautions for Telemetry

#### Licensing Requirements

Telemetry is under license control (CE-LIC-TLM).


#### Hardware Requirements

**Table 1** Hardware requirements
| Series | Models |
| --- | --- |
| CE6800 series | CE6820H-48S6CQ/CE6820S-48S6CQ/CE6820H-48S6CQ-K/CE6855-48XS8CQ/CE6860-SAN/CE6863H-48S6CQ/CE6863H-48S6CQ-K/CE6866-48S8CQ-K/CE6866-48S8CQ-P/CE6860-HAM/CE6881H-48S6CQ/CE6881H-48S6CQ-K/CE6881H-48T6CQ/CE6881H-48T6CQ-K/CE6885-48YS8CQ/CE6863E-48S8CQ/CE6885-48YS8CQ-T/CE6885-SAN-56F/CE6885-LL-56F (standard forwarding mode)/CE6885-LL-56F (low latency mode) |
| CE8800 series | CE8850-SAN/CE8851-32CQ8DQ-K/CE8851-32CQ8DQ-P/CE8850-HAM/CE8855-32CQ4BQ/CE8851-32CQ4BQ |



#### Feature Requirements

**Table 2** Feature requirements
| Feature Requirements | Series | Models |
| --- | --- | --- |
| The telemetry sampling period is implemented by a software timer and is affected by the system running environment. In extreme scenarios (for example, the CPU usage is high), the sampling period has a 10 ms-level delay. | CE6800 series  CE8800 series | CE6820H-48S6CQ/CE6820S-48S6CQ/CE6820H-48S6CQ-K/CE6855-48XS8CQ/CE6860-SAN/CE6863H-48S6CQ/CE6863H-48S6CQ-K/CE6866-48S8CQ-K/CE6866-48S8CQ-P/CE6860-HAM/CE6881H-48S6CQ/CE6881H-48S6CQ-K/CE6881H-48T6CQ/CE6881H-48T6CQ-K/CE6885-48YS8CQ/CE6863E-48S8CQ/CE6885-48YS8CQ-T/CE6885-SAN-56F/CE6885-LL-56F (standard forwarding mode)/CE6885-LL-56F (low latency mode)  CE8850-SAN/CE8851-32CQ8DQ-K/CE8851-32CQ8DQ-P/CE8850-HAM/CE8855-32CQ4BQ/CE8851-32CQ4BQ |
| The telemetry function is included in the basic software package by default and cannot be uninstalled. This feature can be upgraded. To upgrade it, log in to Huawei technical support website, search for the corresponding product and version in the software download area, and download the telemetry feature package. For details on how to install and upgrade the feature package, see "Upgrade Maintenance Configuration" in CLI Configuration Guide > System Management Configuration. | CE6800 series  CE8800 series | CE6820H-48S6CQ/CE6820S-48S6CQ/CE6820H-48S6CQ-K/CE6860-SAN/CE6863H-48S6CQ/CE6863H-48S6CQ-K/CE6866-48S8CQ-K/CE6866-48S8CQ-P/CE6860-HAM/CE6881H-48S6CQ/CE6881H-48S6CQ-K/CE6881H-48T6CQ/CE6881H-48T6CQ-K/CE6885-48YS8CQ/CE6863E-48S8CQ/CE6885-48YS8CQ-T/CE6885-SAN-56F/CE6885-LL-56F (standard forwarding mode)  CE8850-SAN/CE8851-32CQ8DQ-K/CE8851-32CQ8DQ-P/CE8850-HAM |
| When the weak security protocol feature package is not installed:  1. For static subscription, unencrypted gRPC channels cannot be configured.  2. For dynamic subscription, if no SSL policy is bound to the gRPC server, the gRPC service cannot be enabled on the device.  When the weak security protocol feature package is installed:  1. For static subscription, unencrypted gRPC channels can be configured.  2. For dynamic subscription, if no SSL policy is bound to the gRPC server, the gRPC service function can be enabled on the device.  To uninstall the weak security protocol feature package:  1. For static subscription, if an unencrypted gRPC channel is configured, the weak security protocol feature package cannot be uninstalled.  2. For dynamic subscription, if the gRPC service is enabled on the device but no SSL policy is bound, the weak security protocol feature package cannot be uninstalled.  For security purposes, you are not advised to use weak security protocols.  By default, the device provides the weak security protocol feature package WEAKEA. If you need to use it, run the install feature-software WEAKEA command to install the weak security protocol feature package WEAKEA. | CE6800 series  CE8800 series | CE6820H-48S6CQ/CE6820S-48S6CQ/CE6820H-48S6CQ-K/CE6855-48XS8CQ/CE6860-SAN/CE6863H-48S6CQ/CE6863H-48S6CQ-K/CE6866-48S8CQ-K/CE6866-48S8CQ-P/CE6860-HAM/CE6881H-48S6CQ/CE6881H-48S6CQ-K/CE6881H-48T6CQ/CE6881H-48T6CQ-K/CE6885-48YS8CQ/CE6863E-48S8CQ/CE6885-48YS8CQ-T/CE6885-SAN-56F/CE6885-LL-56F (standard forwarding mode)/CE6885-LL-56F (low latency mode)  CE8850-SAN/CE8851-32CQ8DQ-K/CE8851-32CQ8DQ-P/CE8850-HAM/CE8855-32CQ4BQ/CE8851-32CQ4BQ |
| â¢ Number of sampling instances: You can run the display telemetry sensor-path command to check the minimum sampling interval of each sampling path and the number of instances that can be sampled at the minimum sampling interval. The sampling interval that takes effect can be calculated as follows: (Minimum sampling interval x Actual number of instances on the device)/Number of instances that can be sampled at the minimum sampling interval.  â¢ Sampling intervals of data sources: Some data sources have their own sampling intervals. If the sampling interval of a data source is different from the sampling interval configured in telemetry, the effective sampling interval of the data source is affected by half of the telemetry sampling interval. For example, if the telemetry sampling interval is 5 minutes and the data source sampling interval is 1 minute, then the effective sampling interval is 3 minutes. The reason is explained as follows: To avoid sending too much or little data, telemetry suppresses the sampling interval for each instance based on half of the configured telemetry sampling interval. In this way, the same sampled data of an instance is not sent repeatedly within half of the telemetry sampling interval, and can only be sent again in the next half of the telemetry sampling interval. In this example, repeated data is not sent within half of the telemetry sampling interval, that is, 2 minutes and 30 seconds. As the sampling interval of the data source is 1 minute, repeated data is not sent for additional 30 seconds. Therefore, the effective sampling interval is 3 minutes. In this case, you can change the telemetry sampling interval or the data source sampling interval ensure that the two sampling intervals are the same.  â¢ CPU usage: When the system CPU is busy, the telemetry sampling interval is prolonged. | CE6800 series  CE8800 series | CE6820H-48S6CQ/CE6820S-48S6CQ/CE6820H-48S6CQ-K/CE6855-48XS8CQ/CE6860-SAN/CE6863H-48S6CQ/CE6863H-48S6CQ-K/CE6866-48S8CQ-K/CE6866-48S8CQ-P/CE6860-HAM/CE6881H-48S6CQ/CE6881H-48S6CQ-K/CE6881H-48T6CQ/CE6881H-48T6CQ-K/CE6885-48YS8CQ/CE6863E-48S8CQ/CE6885-48YS8CQ-T/CE6885-SAN-56F/CE6885-LL-56F (standard forwarding mode)/CE6885-LL-56F (low latency mode)  CE8850-SAN/CE8851-32CQ8DQ-K/CE8851-32CQ8DQ-P/CE8850-HAM/CE8855-32CQ4BQ/CE8851-32CQ4BQ |
| 1. When data is sampled in service sampling mode, the generated UDP packets are split by 1500 bytes. When the YANG model is used to sample data, the same batch of data is sent in one packet. If a large number of UDP packets are transmitted on the network, you can set the threshold for UDP packets using commands, for example, protocol udp packet-max-size 1472.  2. A single packet can be encapsulated to ensure the integrity of data instances. When data is sampled in service sampling mode and the size of the data instance is large, the length of the generated UDP packet exceeds 1500 bytes. When the YANG model is used to sample multiple layers of data, Telemetry splits the data based on the top-level instance. If the encapsulated data exceeds 64 KB, the packet cannot be sent due to the limitation that the maximum size of UDP packets that can be sent is 64 KB. Typically, when huawei-network-instance:network-instance/instances/instance is sampled, the size of a single instance exceeds 64 KB because various protocol data on the device is mounted to the network instance (for example, a public network instance). In this case, if the draft-ietf-netconf-udp-notif-08 draft is used to encapsulate packets, the packets are split based on 60 KB. When the draft-ietf-netconf-udp-pub-channel-01 draft is used to encapsulate packets, the data cannot be sent.  3. When the draft-ietf-netconf-udp-notif-08 draft is used, the value of the Observation-Domain-ID field in the message header is the generated according to the structure code of the chassis ID, board number, and process number. | CE6800 series  CE8800 series | CE6820H-48S6CQ/CE6820S-48S6CQ/CE6820H-48S6CQ-K/CE6855-48XS8CQ/CE6860-SAN/CE6863H-48S6CQ/CE6863H-48S6CQ-K/CE6866-48S8CQ-K/CE6866-48S8CQ-P/CE6860-HAM/CE6881H-48S6CQ/CE6881H-48S6CQ-K/CE6881H-48T6CQ/CE6881H-48T6CQ-K/CE6885-48YS8CQ/CE6863E-48S8CQ/CE6885-48YS8CQ-T/CE6885-SAN-56F/CE6885-LL-56F (standard forwarding mode)/CE6885-LL-56F (low latency mode)  CE8850-SAN/CE8851-32CQ8DQ-K/CE8851-32CQ8DQ-P/CE8850-HAM/CE8855-32CQ4BQ/CE8851-32CQ4BQ |
| If the telemetry function is used, 20% extra CPU resources may be consumed. | CE6800 series  CE8800 series | CE6820H-48S6CQ/CE6820S-48S6CQ/CE6820H-48S6CQ-K/CE6855-48XS8CQ/CE6860-SAN/CE6863H-48S6CQ/CE6863H-48S6CQ-K/CE6866-48S8CQ-K/CE6866-48S8CQ-P/CE6860-HAM/CE6881H-48S6CQ/CE6881H-48S6CQ-K/CE6881H-48T6CQ/CE6881H-48T6CQ-K/CE6885-48YS8CQ/CE6863E-48S8CQ/CE6885-48YS8CQ-T/CE6885-SAN-56F/CE6885-LL-56F (standard forwarding mode)/CE6885-LL-56F (low latency mode)  CE8850-SAN/CE8851-32CQ8DQ-K/CE8851-32CQ8DQ-P/CE8850-HAM/CE8855-32CQ4BQ/CE8851-32CQ4BQ |
| Restrictions on any sampling path:  1. The maximum query depth of any path sampling is three layers (that is, the layer where the sampling path is located, its sublayer, and its grandchild layer).  2. After the CPU usage of a sampling task exceeds 90%, the sampling task stops (excluding memory and CPU sampling).  3. If there are a large number of sampling tasks and the sampling period is short, about 20% of CPU resources are consumed.  Suggestions:  1. Reduce the number of sampling tasks on any path.  2. Configure a long sampling interval. | CE6800 series  CE8800 series | CE6820H-48S6CQ/CE6820S-48S6CQ/CE6820H-48S6CQ-K/CE6855-48XS8CQ/CE6860-SAN/CE6863H-48S6CQ/CE6863H-48S6CQ-K/CE6866-48S8CQ-K/CE6866-48S8CQ-P/CE6860-HAM/CE6881H-48S6CQ/CE6881H-48S6CQ-K/CE6881H-48T6CQ/CE6881H-48T6CQ-K/CE6885-48YS8CQ/CE6863E-48S8CQ/CE6885-48YS8CQ-T/CE6885-SAN-56F/CE6885-LL-56F (standard forwarding mode)/CE6885-LL-56F (low latency mode)  CE8850-SAN/CE8851-32CQ8DQ-K/CE8851-32CQ8DQ-P/CE8850-HAM/CE8855-32CQ4BQ/CE8851-32CQ4BQ |
| The restrictions on fuzzy match of interface names are as follows:  1. Only the interface name supports fuzzy match.  2. Fuzzy match is marked with an asterisk (\*), which can only be at the end of the matched field.  3. An interface name consists of the interface type and interface number. The asterisk (\*) can appear only once at the end of the interface number.  4. The interface type part needs to be checked (case insensitive) and partial matching is supported.  5. Spaces are not allowed between the interface type and interface number.  In this case, only some sampling paths support fuzzy match of interface names. | CE6800 series  CE8800 series | CE6820H-48S6CQ/CE6820S-48S6CQ/CE6820H-48S6CQ-K/CE6855-48XS8CQ/CE6860-SAN/CE6863H-48S6CQ/CE6863H-48S6CQ-K/CE6866-48S8CQ-K/CE6866-48S8CQ-P/CE6860-HAM/CE6881H-48S6CQ/CE6881H-48S6CQ-K/CE6881H-48T6CQ/CE6881H-48T6CQ-K/CE6885-48YS8CQ/CE6863E-48S8CQ/CE6885-48YS8CQ-T/CE6885-SAN-56F/CE6885-LL-56F (standard forwarding mode)/CE6885-LL-56F (low latency mode)  CE8850-SAN/CE8851-32CQ8DQ-K/CE8851-32CQ8DQ-P/CE8850-HAM/CE8855-32CQ4BQ/CE8851-32CQ4BQ |
| 1. Low-speed sampling tasks are executed one by one on the MPU. Therefore, when multiple sampling tasks are executed concurrently, the actual sampling period is the sum of the time required for completing all sampling tasks.  2. High-speed sampling tasks are concurrently executed on LPUs. | CE6800 series  CE8800 series | CE6820H-48S6CQ/CE6820S-48S6CQ/CE6820H-48S6CQ-K/CE6855-48XS8CQ/CE6860-SAN/CE6863H-48S6CQ/CE6863H-48S6CQ-K/CE6866-48S8CQ-K/CE6866-48S8CQ-P/CE6860-HAM/CE6881H-48S6CQ/CE6881H-48S6CQ-K/CE6881H-48T6CQ/CE6881H-48T6CQ-K/CE6885-48YS8CQ/CE6863E-48S8CQ/CE6885-48YS8CQ-T/CE6885-SAN-56F/CE6885-LL-56F (standard forwarding mode)/CE6885-LL-56F (low latency mode)  CE8850-SAN/CE8851-32CQ8DQ-K/CE8851-32CQ8DQ-P/CE8850-HAM/CE8855-32CQ4BQ/CE8851-32CQ4BQ |
| Telemetry supports the configuration of IPv6 collectors. After IPv6 collectors are supported, both IPv4 and IPv6 addresses can be configured for a subscription. However, only one source IP address, IPv4 source address, or IPv6 source address can be configured.  1. If an IPv4 source address is configured, the IPv4 session uses the specified address as the source IP address. The source IP address of the IPv6 session is automatically selected by the system (the address of the outbound interface is used by default).  2. If an IPv6 source address is configured, the IPv6 session uses the specified address as the source IP address. The source IP address of the IPv4 session is automatically selected by the system (the address of the outbound interface is used by default).  If both IPv4 and IPv6 collectors are required and each collector uses a specified source address, you can create multiple subscriptions. Some subscriptions are configured with IPv4 destination and source addresses, and the other subscriptions are configured with IPv6 destination and source addresses. | CE6800 series  CE8800 series | CE6820H-48S6CQ/CE6820S-48S6CQ/CE6820H-48S6CQ-K/CE6855-48XS8CQ/CE6860-SAN/CE6863H-48S6CQ/CE6863H-48S6CQ-K/CE6866-48S8CQ-K/CE6866-48S8CQ-P/CE6860-HAM/CE6881H-48S6CQ/CE6881H-48S6CQ-K/CE6881H-48T6CQ/CE6881H-48T6CQ-K/CE6885-48YS8CQ/CE6863E-48S8CQ/CE6885-48YS8CQ-T/CE6885-SAN-56F/CE6885-LL-56F (standard forwarding mode)/CE6885-LL-56F (low latency mode)  CE8850-SAN/CE8851-32CQ8DQ-K/CE8851-32CQ8DQ-P/CE8850-HAM/CE8855-32CQ4BQ/CE8851-32CQ4BQ |
| 1. If the number of collected instances exceeds the device capability, the sampling interval is automatically prolonged. For example, if all interfaces are sampled every 100 ms and there are only 20 interfaces, all the interfaces can be sampled every 100 ms. If there are 200 interfaces, all the interfaces can be sampled every 1s.  2. Telemetry can be used to send data to the collector at a rate of 500 pps.  3. If the CPU usage of the MPU is higher than 90%, telemetry suspends all sampling tasks except CPU and memory sampling tasks.  You can reduce the number of sampling tasks or extend the sampling task period to prevent this problem. Otherwise, the data collection efficiency decreases. | CE6800 series  CE8800 series | CE6820H-48S6CQ/CE6820S-48S6CQ/CE6820H-48S6CQ-K/CE6855-48XS8CQ/CE6860-SAN/CE6863H-48S6CQ/CE6863H-48S6CQ-K/CE6866-48S8CQ-K/CE6866-48S8CQ-P/CE6860-HAM/CE6881H-48S6CQ/CE6881H-48S6CQ-K/CE6881H-48T6CQ/CE6881H-48T6CQ-K/CE6885-48YS8CQ/CE6863E-48S8CQ/CE6885-48YS8CQ-T/CE6885-SAN-56F/CE6885-LL-56F (standard forwarding mode)/CE6885-LL-56F (low latency mode)  CE8850-SAN/CE8851-32CQ8DQ-K/CE8851-32CQ8DQ-P/CE8850-HAM/CE8855-32CQ4BQ/CE8851-32CQ4BQ |
| 1. The sampled data can be reported through gRPC.  2. The source IP address for reporting the sampled data through gRPC can be configured.  3. Only one source IPv4 or IPv6 address can be configured for each subscription. | CE6800 series  CE8800 series | CE6820H-48S6CQ/CE6820S-48S6CQ/CE6820H-48S6CQ-K/CE6855-48XS8CQ/CE6860-SAN/CE6863H-48S6CQ/CE6863H-48S6CQ-K/CE6866-48S8CQ-K/CE6866-48S8CQ-P/CE6860-HAM/CE6881H-48S6CQ/CE6881H-48S6CQ-K/CE6881H-48T6CQ/CE6881H-48T6CQ-K/CE6885-48YS8CQ/CE6863E-48S8CQ/CE6885-48YS8CQ-T/CE6885-SAN-56F/CE6885-LL-56F (standard forwarding mode)/CE6885-LL-56F (low latency mode)  CE8850-SAN/CE8851-32CQ8DQ-K/CE8851-32CQ8DQ-P/CE8850-HAM/CE8855-32CQ4BQ/CE8851-32CQ4BQ |