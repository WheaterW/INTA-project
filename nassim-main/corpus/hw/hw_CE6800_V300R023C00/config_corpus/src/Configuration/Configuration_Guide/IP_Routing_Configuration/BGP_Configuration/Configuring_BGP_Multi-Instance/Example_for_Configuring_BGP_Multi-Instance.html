
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring BGP Multi-Instance">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="vrp_bgp_cfg_0155.html">
<meta name="DC.Relation" scheme="URI" content="vrp_bgp_cfg_0154.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing">
<meta name="featuretype" content="IP Routing">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001130783926">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring BGP Multi-Instance</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001130783926"></a><a name="EN-US_TASK_0000001130783926"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring BGP Multi-Instance</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001130783926__1.3.1"></a><a name="1.3.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>In <a href="#EN-US_TASK_0000001130783926__fig568519487491">Figure 1</a>, establish a public network BGP peer relationship in the BGP basic instance between DeviceA and DeviceB, and establish a BGP peer relationship in DeviceB's BGP multi-instance and DeviceC's BGP basic instance. In this manner, routes are separately managed and maintained on DeviceB.</p>
<div class="fignone" id="EN-US_TASK_0000001130783926__fig568519487491"><a name="EN-US_TASK_0000001130783926__fig568519487491"></a><a name="fig568519487491"></a><span class="figcap"><b>Figure 1 </b>BGP multi-instance networking</span><div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface 1 and interface 2 represent <span>100GE</span><span>1/0/1</span> and <span>100GE</span><span>1/0/2</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0000001176663757.png"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001130783926__1.3.2"></a><a name="1.3.2"></a>
<div class="p"><h4 class="sectiontitle">Precautions</h4><p>During the configuration, note the following:</p>
<ul><li>To improve security, you are advised to deploy BGP security measures. For details, see "Configuring BGP Authentication." Keychain authentication is used as an example. For details, see Example for Configuring Keychain Authentication for BGP.</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001130783926__1.3.3"></a><a name="1.3.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Assign an IP address to each interface. For detailed configurations, see <a href="#EN-US_TASK_0000001130783926__postreq1662236201619">Configuration Scripts</a>.</span></li><li><span>Establish a public network BGP peer relationship between DeviceA and DeviceB.</span><p><p># Configure DeviceA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA]<strong> bgp 100</strong>
[<span class="keyword">*</span>DeviceA-bgp]<strong> peer 10.1.1.2 as-number 100</strong>
[<span class="keyword">*</span>DeviceA-bgp] <strong>ipv4-family unicast</strong>
[<span class="keyword">*</span>DeviceA-bgp-af-ipv4] <strong>peer 10.1.1.2 enable</strong>
[<span class="keyword">*</span>DeviceA-bgp-af-ipv4] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA-bgp]<strong> quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>commit</strong></pre>
<p># Configure DeviceB.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB]<strong> bgp 100</strong>
[<span class="keyword">*</span>DeviceB-bgp]<strong> peer 10.1.1.1 as-number 100</strong>
[<span class="keyword">*</span>DeviceB-bgp] <strong>ipv4-family unicast</strong>
[<span class="keyword">*</span>DeviceB-bgp-af-ipv4] <strong>peer 10.1.1.1 enable</strong>
[<span class="keyword">*</span>DeviceB-bgp-af-ipv4] <strong>quit</strong>
[<span class="keyword">*</span>DeviceB-bgp]<strong> quit</strong>
[<span class="keyword">*</span>DeviceB] <strong>commit</strong></pre>
</p></li><li><span>Establish a VPN BGP peer relationship between DeviceB and DeviceC.</span><p><p># Configure DeviceB.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB] <strong>ip vpn-instance aa</strong> 
[<span class="keyword">*</span>DeviceB-vpn-instance-aa] <strong>ipv4-family</strong>
[<span class="keyword">*</span>DeviceB-vpn-instance-aa-af-ipv4]<strong> route-distinguisher 100:1</strong>    
[<span class="keyword">*</span>DeviceB-vpn-instance-aa-af-ipv4] <strong>vpn-target 1:1 export-extcommunity </strong>
[<span class="keyword">*</span>DeviceB-vpn-instance-aa-af-ipv4] <strong>vpn-target 1:1 import-extcommunity </strong>
[<span class="keyword">*</span>DeviceB-vpn-instance-aa-af-ipv4] <strong>quit</strong>
[<span class="keyword">*</span>DeviceB-vpn-instance-aa] <strong>quit</strong>
[<span class="keyword">*</span>DeviceB] <strong>bgp 200 instance aa</strong>
[<span class="keyword">*</span>DeviceB-bgp-instance-aa] <strong>ipv4-family vpn-instance aa</strong>
[<span class="keyword">*</span>DeviceB-bgp-instance-aa-aa] <strong>peer 10.1.2.2 as-number 200</strong>
[<span class="keyword">*</span>DeviceB-bgp-instance-aa-aa] <strong>quit</strong>
[<span class="keyword">*</span>DeviceB] <strong>commit</strong></pre>
<p># Configure DeviceC.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceC]<strong> bgp 200</strong>
[<span class="keyword">*</span>DeviceC-bgp]<strong> peer 10.1.2.1 as-number 200</strong>
[<span class="keyword">*</span>DeviceC-bgp]<strong> quit</strong>
[<span class="keyword">*</span>DeviceC] <strong>commit</strong></pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001130783926__1.3.4"></a><a name="1.3.4"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p># Run the <strong>display bgp peer</strong> command on DeviceB to check the status of the public network BGP connection.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB] <strong>display bgp peer</strong>

 BGP local router ID : 10.1.1.2
 Local AS number : 100 
 Total number of peers : 4                 Peers in established state : 3 

  Peer                             V          AS  MsgRcvd  MsgSent  OutQ  Up/Down       State  PrefRcv                              
  10.1.1.1                         4         100       25       25     0 00:19:48 Established        0  </pre>
<p>The command output shows that the BGP connection is established between DeviceB and DeviceA (the <strong>State</strong> field is displayed as <strong>Established</strong>).</p>
<p># Run the <strong>display bgp instance aa vpnv4 all peer</strong> command on DeviceB to check the status of the BGP multi-instance connection.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB] <strong>display bgp instance aa vpnv4 all peer</strong>

 BGP local router ID : 10.1.1.2
 Local AS number : 200       
 Total number of peers : 1                 Peers in established state : 1


  Peer of IPv4-family for vpn instance :

  VPN-Instance aa, Router ID 10.1.1.2:                                                                                              
  Peer                             V          AS  MsgRcvd  MsgSent  OutQ  Up/Down       State  PrefRcv
  10.1.2.2                         4         200        4        4     0 00:01:07 <strong>Established</strong>        0  </pre>
<p>The command output shows that the BGP multi-instance connection between DeviceB and DeviceC is in the Established state.</p>
</div>
<div class="postreq"><a name="EN-US_TASK_0000001130783926__postreq1662236201619"></a><a name="postreq1662236201619"></a><a name="EN-US_TASK_0000001130783926__1.3.5"></a><a name="1.3.5"></a><h4 class="sectiontitle">Configuration Scripts</h4><ul><li><p>DeviceA</p>
<pre class="screen">#
sysname DeviceA 
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 10.1.1.1 255.255.255.0
#
bgp 100
 peer 10.1.1.2 as-number 100
 #
 ipv4-family unicast
  undo synchronization
  peer 10.1.1.2 enable
#
return</pre>
</li><li><div class="p">DeviceB<pre class="screen">#
sysname DeviceB
#
ip vpn-instance aa
 ipv4-family
  route-distinguisher 100:1
  vpn-target 1:1 export-extcommunity 
  vpn-target 1:1 import-extcommunity
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 10.1.1.2 255.255.255.0
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ip binding vpn-instance aa 
 ip address 10.1.2.1 255.255.255.0
#
bgp 100
 peer 10.1.1.1 as-number 100
 #
 ipv4-family unicast
  undo synchronization
  peer 10.1.1.1 enable
bgp 200 instance aa
 ipv4-family vpn-instance aa        
  peer 10.1.2.2 as-number 200 
#
return</pre>
</div>
</li><li><div class="p">DeviceC<pre class="screen">#
sysname DeviceC
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ip binding vpn-instance aa 
 ip address 10.1.2.2 255.255.255.0
#
bgp 200
 peer 10.1.2.1 as-number 200 
 #
 ipv4-family unicast
   undo synchronization
   peer 10.1.2.1 enable
#
return</pre>
</div>
</li></ul>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="vrp_bgp_cfg_0155.html">Configuring BGP Multi-Instance
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="vrp_bgp_cfg_0154.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>
</body>
</html>