
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring BGP4+ RRs">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="vrp_bgp6_cfg_0037.html">
<meta name="DC.Relation" scheme="URI" content="vrp_bgp6_cfg_0043.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="BGP4+">
<meta name="featuretype" content="IP Routing">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP4+">
<meta name="featuretype" content="IP Routing">
<meta name="featurename" content="BGP4+">
<meta name="featuretype" content="IP Routing">
<meta name="featuretype" content="IP Routing">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001130782222">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>Configuring BGP4+ RRs</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001130782222"></a><a name="EN-US_TASK_0000001130782222"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring BGP4+ RRs</h1>
<div class="taskbody"><div class="prereq" style="margin-left:0"><a name="EN-US_TASK_0000001130782222__1.3.1"></a><a name="1.3.1"></a><h4 class="sectiontitle">Prerequisites</h4>
<div class="p"><p>Before configuring BGP4+ RRs, you have completed the following task:</p>
<ul><li><a href="vrp_bgp6_cfg_0006.html">Configure basic BGP4+ functions</a>.</li></ul>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001130782222__1.3.2"></a><a name="1.3.2"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>A full mesh of IBGP connections is needed to implement connectivity between IBGP peers within an AS. When there are many IBGP peers, it is costly to establish a fully-meshed network. An RR can be used to solve the problem.</p>
<p>Using RRs reduces the total number of IBGP connections to be established. On a large network, however, multiple RRs need to be configured to reduce the number of clients to be connected to each RR. Therefore, there are still a large number of IBGP connections on the network because a full mesh of connections needs to be established between the RRs. In this situation, configure hierarchical BGP4+ RRs to further reduce the number of IBGP connections to be established.</p>
<p><a href="#EN-US_TASK_0000001130782222__fig_dc_vrp_bgp6_cfg_004002">Figure 1</a> shows a typical hierarchical BGP4+ RR networking. DeviceA, DeviceB, DeviceC, and DeviceD function as level-2 RRs; DeviceE, DeviceF, DeviceG, and DeviceH function as level-1 RRs and level-2 RRs' clients. Level-2 RRs are not the clients of any RR and therefore must be fully meshed. Level-1 RRs function as the clients of level-2 RRs and do not need to be fully meshed.</p>
<div class="fignone" id="EN-US_TASK_0000001130782222__fig_dc_vrp_bgp6_cfg_004002"><a name="EN-US_TASK_0000001130782222__fig_dc_vrp_bgp6_cfg_004002"></a><a name="fig_dc_vrp_bgp6_cfg_004002"></a><span class="figcap"><b>Figure 1 </b>Network diagram of hierarchical BGP4+ RRs</span><br><span><img class="vsd" src="figure/en-us_image_0000001130782244.png" width="NaN" height="NaN"></span></div>
<p>The RR is simple to configure. You only need to configure the route reflection function on the BGP device that is to function as the RR. The clients do not need to know that they are clients of the RR.</p>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001130782222__1.3.3"></a><a name="1.3.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Enter the system view.</span><p><pre class="screen"><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></pre>
</p></li><li><span>Enter the BGP view.</span><p><pre class="screen"><a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></pre>
</p></li><li><span>Enter the IPv6 unicast address family view.</span><p><pre class="screen"><a href="cmdqueryname=ipv6-family+unicast"><b><span class="cmdname">ipv6-family</span></b></a> <strong><span>unicast</span></strong></pre>
</p></li><li><span>Specify an RR and its clients.</span><p><pre class="screen"><a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv6-address</span></i> | <i><span class="varname">group-name</span></i> | <i><span class="varname">ipv4-address</span></i> } <a href="cmdqueryname=reflect-client"><b><span class="cmdname">reflect-client</span></b></a></pre>
<p>The device with the <a href="cmdqueryname=peer+reflect-client"><b><span class="cmdname">peer reflect-client</span></b></a> command configuration functions as an RR, and the specified peer or peer group functions as a client.</p>
<div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The reflect-client configuration in an address family is valid only in this address family and cannot be inherited by other address families.</p>
</div></div>
</p></li><li><span>(Optional) Disable route reflection between clients through the RR.</span><p><pre class="screen"><a href="cmdqueryname=undo+reflect+between-clients"><b><span class="cmdname">undo reflect between-clients</span></b></a></pre>
<p>By default, route reflection between clients through an RR is enabled.</p>
<p>If the clients of an RR have established full-mesh connections with each other, you can run the <a href="cmdqueryname=undo+reflect+between-clients"><b><span class="cmdname">undo reflect between-clients</span></b></a> command to disable route reflection between clients through the RR to reduce the overhead. The <a href="cmdqueryname=undo+reflect+between-clients"><b><span class="cmdname">undo reflect between-clients</span></b></a> command is run only on RRs.</p>
</p></li><li><span>(Optional) Set the ID of a cluster where RRs belong.</span><p><pre class="screen"><a href="cmdqueryname=reflector+cluster-id"><b><span class="cmdname">reflector cluster-id</span></b></a> { <em>cluster-id-value</em> | <i><span class="varname">cluster-id-ipv4</span></i> }</pre>
<p>If a cluster has multiple RRs, you can use this command to set the same cluster ID for these RRs to prevent routing loops. </p>
<p>The <a href="cmdqueryname=reflector+cluster-id"><b><span class="cmdname">reflector cluster-id</span></b></a> command is run only on RRs.</p>
<div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>To prevent clients' failures to learn routes reflected by RRs, ensure that the cluster ID of the RRs is different from the router ID of any client. If the cluster ID of the RRs is the same as the router ID of a client, the client will discard received routes.</p>
</div></div>
</p></li><li><span>(Optional) Disable the RR from adding preferred BGP4+ routes to the IP routing table.</span><p><pre class="screen"><a href="cmdqueryname=routing-table+rib-only+route-policy"><b><span class="cmdname">routing-table rib-only</span></b></a> [ <strong><span>route-policy</span></strong> <i><span class="varname">route-policy-name</span></i> ]</pre>
<p>By default, preferred BGP4+ routes are added to the IP routing table. If the device is not required to forward packets, you can disable BGP4+ routes from being added to the IP routing table.</p>
<p>If the <strong><span>route-policy</span></strong> <i><span class="varname">route-policy-name</span></i> parameter is specified in the <a href="cmdqueryname=routing-table+rib-only"><b><span class="cmdname">routing-table rib-only</span></b></a> command, the routes that match the route-policy are not delivered to the IP routing table, and the routes that do not match the route-policy are delivered to the IP routing table with their route attributes unchanged.</p>
<p>Preventing a device from adding BGP4+ routes to the IP routing table is mainly used in RR scenarios. An RR transmits routes and forwards traffic within an AS. If the RR is connected to many clients and non-clients, route transmission will consume a lot of CPU resources of the RR and cause the RR to be unable to implement traffic forwarding. To improve route transmission efficiency, prevent the RR from adding BGP4+ routes to the IP routing table.</p>
</p></li><li><span>(Optional) Enable the RR to modify attributes of BGP4+ routes to be advertised based on the export route-policy.</span><p><pre class="screen"><a href="cmdqueryname=reflect+change-path-attribute"><b><span class="cmdname">reflect change-path-attribute</span></b></a></pre>
<p>By default, the RR cannot modify route attributes using an export route-policy.</p>
<p>The route attributes on the RR cannot be modified using the export route-policy because routing loops may occur. By default, the RR is disabled from modifying the route attributes based on the export route-policy. If you need to re-plan the network traffic, you can enable the RR to modify the route attributes based on the export route-policy.</p>
<div class="p">After the <a href="cmdqueryname=reflect+change-path-attribute"><b><span class="cmdname">reflect change-path-attribute</span></b></a> command is run on an RR, route attributes can be modified by performing the following operations:<ul><li>Run the <a href="cmdqueryname=apply+as-path"><b><span class="cmdname">apply as-path</span></b></a> command to modify the AS_Path attribute of BGP4+ routes.</li><li>Run the <a href="cmdqueryname=apply+comm-filter+delete"><b><span class="cmdname">apply comm-filter delete</span></b></a> command to delete all community attributes from BGP4+ routes.</li><li>Run the <a href="cmdqueryname=apply+community"><b><span class="cmdname">apply community</span></b></a> command to modify the community attribute of BGP4+ routes.</li><li>Run the <a href="cmdqueryname=apply+large-community"><b><span class="cmdname">apply large-community</span></b></a> command to modify the Large-Community attribute of BGP4+ routes.</li><li>Run the <a href="cmdqueryname=apply+cost"><b><span class="cmdname">apply cost</span></b></a> command to modify the MED (cost) values of BGP4+ routes.</li><li>Run the <a href="cmdqueryname=apply+ipv6+next-hop"><b><span class="cmdname">apply ipv6 next-hop</span></b></a> command to modify the next-hop IP addresses of BGP4+ routes.</li><li>Run the <a href="cmdqueryname=apply+local-preference"><b><span class="cmdname">apply local-preference</span></b></a> command to modify the local preferences of BGP4+ routes.</li><li>Run the <a href="cmdqueryname=apply+origin"><b><span class="cmdname">apply origin</span></b></a> command to modify the Origin attribute of BGP4+ routes.</li><li>Run the <a href="cmdqueryname=apply+extcommunity"><b><span class="cmdname">apply extcommunity</span></b></a> command to modify the VPN target extended community attribute of BGP4+ routes.</li></ul>
</div>
<ul><li>Run the <a href="cmdqueryname=apply+extcommunity+bandwidth"><b><span class="cmdname">apply extcommunity bandwidth</span></b></a> {<i><span class="varname"> extCmntyString</span></i> | <strong><span>none</span></strong> } or <a href="cmdqueryname=apply+extcommunity+bandwidth"><b><span class="cmdname">apply extcommunity bandwidth</span></b></a> <strong><span>aggregate</span></strong> [ <strong><span>limit</span></strong> <i><span class="varname">bandwidth-value</span></i> ] command to modify the Link Bandwidth extended community attribute of BGP4+ routes.</li></ul>
<div class="p"><div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>After the <a href="cmdqueryname=reflect+change-path-attribute"><b><span class="cmdname">reflect change-path-attribute</span></b></a> command is run on the RR, the <a href="cmdqueryname=peer+route-policy"><b><span class="cmdname">peer route-policy</span></b></a> <strong><span>export</span></strong> command takes precedence over the <a href="cmdqueryname=peer+next-hop-invariable"><b><span class="cmdname">peer next-hop-invariable</span></b></a> command and<a href="cmdqueryname=peer+next-hop-local"><b><span class="cmdname">peer next-hop-local</span></b></a> command.</p>
</div></div>
</div>
</p></li><li><span>Commit the configuration.</span><p><pre class="screen" id="EN-US_TASK_0000001130782222__en-us_task_0234857734_screen163801330213"><a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001130782222__en-us_task_0234857734_en-us_concept_0141113565_cmdname1667501373175340">commit</span></b></a></pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001130782222__1.3.4"></a><a name="1.3.4"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p>After completing the configuration, perform the following operations to verify it:</p>
<ul><li>Run the <a href="cmdqueryname=display+bgp"><b><span class="cmdname">display bgp</span></b></a> <strong><span>ipv6</span></strong> <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> [ <strong><span>verbose</span></strong> ] command to check information about BGP4+ peers and check whether the peer relationships with the RR are successfully established.</li><li>Run the <a href="cmdqueryname=display+bgp+ipv6+routing-table"><b><span class="cmdname">display bgp ipv6 routing-table</span></b></a> command to check information about BGP4+ routes reflected by the RR.</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="vrp_bgp6_cfg_0037.html">Configuring BGP4+ RRs
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="vrp_bgp6_cfg_0043.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>