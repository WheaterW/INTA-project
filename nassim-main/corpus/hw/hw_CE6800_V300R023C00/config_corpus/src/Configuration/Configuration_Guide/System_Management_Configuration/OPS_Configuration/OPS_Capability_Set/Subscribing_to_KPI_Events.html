
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="reference">
<meta name="DC.Title" content="Subscribing to KPI Events">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="vrp_ops_cfg_0018.html">
<meta name="DC.Relation" scheme="URI" content="vrp_ops_cfg_0026.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="OPS">
<meta name="featuretype" content="System Management">
<meta name="featurename" content="OPS">
<meta name="featuretype" content="System Management">
<meta name="featurename" content="OPS">
<meta name="featuretype" content="System Management">
<meta name="featuretype" content="System Management">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_REFERENCE_0000001563885001">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>Subscribing to KPI Events</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_REFERENCE_0000001563885001"></a><a name="EN-US_REFERENCE_0000001563885001"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Subscribing to KPI Events</h1>
<div><div class="section"><h4 class="sectiontitle">Application Phase</h4><p>Subscription phase</p>
</div>
<div class="section"><h4 class="sectiontitle">Function Prototype</h4><p>kpi_event = ops.kpi.event(tag)</p>
<p>ops.kpi.event.add_kpi(kpi_xpath)</p>
<p>ops.kpi.event.add_inner(cid, kid)</p>
<p>ops.kpi.event.set_threshold(relation, threshold)</p>
<p>ops.kpi.event.set_compute_rule(function, para = "")</p>
<p>result1_value, result2_description = ops.kpi.subscribe(kpi_event)</p>
</div>
<div class="section"><h4 class="sectiontitle">Parameter Description</h4>
<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" frame="border" border="1" rules="all"><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="33.33333333333333%" id="mcps1.3.3.2.1.4.1.1" liSelected="liSelected"><p>Parameter</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="33.33333333333333%" id="mcps1.3.3.2.1.4.1.2" liSelected="liSelected"><p>Description</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="33.33333333333333%" id="mcps1.3.3.2.1.4.1.3" liSelected="liSelected"><p>Value</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.3.2.1.4.1.1 "><p>tag</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.3.2.1.4.1.2 "><p>Specifies conditions.</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.3.2.1.4.1.3 "><p>The value is a string of 1 to 7 case-insensitive characters, consists of letters, digits, and underscores (_), and starts with a letter. The value of tag cannot be <strong>""</strong>, <strong>None</strong>, <strong>and</strong>, <strong>or</strong>, or <strong>andnot</strong>, and cannot contain the end character <strong>\0</strong>.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.3.2.1.4.1.1 "><p>kpi_xpath</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.3.2.1.4.1.2 "><p>Specifies the name of the KPI to be subscribed to.</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.3.2.1.4.1.3 "><p>The value is the sampling path XPath that can be configured for the telemetry function.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.3.2.1.4.1.1 "><p>cid</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.3.2.1.4.1.2 "><p>Specifies the ID of a component.</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.3.2.1.4.1.3 "><p>The value is an integer. You can run the <strong>display middleware litedb</strong><strong> </strong>{ <strong>slot</strong><em> slotId</em> [ <strong>cpu</strong><em> cpuId</em> ] } <strong>command</strong> "record kpimappingdata" command in the diagnostic view and obtain the component ID based on the <strong>componentID</strong> field in the command output.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.3.2.1.4.1.1 "><p>kid</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.3.2.1.4.1.2 "><p>Specifies the ID of a KPI.</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.3.2.1.4.1.3 "><p>The value is an integer. You can run the <strong>display middleware litedb</strong><strong> </strong>{ <strong>slot</strong><em> slotId</em> [ <strong>cpu</strong><em> cpuId</em> ] } <strong>command</strong> "record kpimappingdata" command in the diagnostic view and obtain the KPI ID based on the <strong>kpiID</strong> field in the command output.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.3.2.1.4.1.1 "><p>relation</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.3.2.1.4.1.2 "><p>Specifies the relational function used for triggering conditions.</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.3.2.1.4.1.3 "><p>The value is of the enumerated type:</p>
<ul><li>&gt;=: greater than or equal to</li><li>&gt;: greater than</li><li>&lt;=: less than or equal to</li><li>&lt;: less than</li><li>==: equal to</li><li>!=: not equal to</li></ul>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.3.2.1.4.1.1 "><p>threshold</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.3.2.1.4.1.2 "><p>Specifies a threshold.</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.3.2.1.4.1.3 "><p>The value is a string of 1 to 49 characters, excluding the end character <strong>\0</strong>.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.3.2.1.4.1.1 "><p>function</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.3.2.1.4.1.2 "><p>Specifies a preprocessing function.</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.3.2.1.4.1.3 "><p>The value is of the enumerated type. Five types of functions are supported: avg, max, min, minus, and roc.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.3.2.1.4.1.1 "><p>para</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.3.2.1.4.1.2 "><p>Specifies the parameters for the preprocessing function.</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.3.2.1.4.1.3 "><p>The value is an integer. If the preprocessing function is avg, max, or min, you need to set this parameter.</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section"><h4 class="sectiontitle">Return Values</h4><p>In the function prototype, <strong>kpi_event</strong> indicates the generated KPI event instance, which is used for setting event rules and subscribing to events.</p>
<p><strong>result1_value</strong> and <strong>result2_description</strong> in the function prototype indicate return values.</p>
<p><strong>result1_value</strong> is the first return value, with value 0 indicating a success, and value 1 indicating a failure.</p>
<p><strong>result2_description</strong> is the second return value, indicating the failure cause. It is returned only when the first return value is 1.</p>
</div>
<div class="section"><h4 class="sectiontitle">Usage Description</h4><p>By subscribing to KPI events, users can monitor important data such as the CPU usage and memory usage.</p>
<p>When the KPI event subscription interface (ops.kpi.subscribe) is used:</p>
<ul><li>The system automatically obtains the script name. Ensure that the script name ends with .py. Otherwise, event subscription fails.</li><li>If the KPI event creation interface (ops.kpi.event) is used to create multiple events in the same script, ensure that the event names (tags) are different.</li><li>When subscribing to KPI events, you do not need to enter the message type (message_type). The default message type is subscribe, indicating data subscription.</li><li>There are two enumerated values of the subscription type: inner and xpath. The inner type corresponds to an internal KPI. For example, the KPI name of the CPU usage is 167/0. The xpath type corresponds to the resource node path. The KPI name of the CPU usage is <span>huawei-cpu-memory:cpu-memory/board-cpu-infos/board-cpu-info</span>/system-cpu-usage.</li><li>If the subscription type is multiple, you need to specify the AND or OR relationship between multiple event subscriptions. If the relationship is not specified, the subscription fails.</li></ul>
</div>
<div class="section"><h4 class="sectiontitle">Usage Examples</h4><p>Create a script named test_inner.py, subscribe to KPI events of the inner type, and trigger an alarm when the CPU usage exceeds 90%.</p>
<pre class="screen">def ops_condition(_ops)
    e1 = _ops.kpi.event("cpu")
    e1.add_inner(10167, 0)
    e1. set_threshold("&gt;", 90)
    e1. set_compute_rule("avg", 5)
    _ops.kpi.subscribe(e1)</pre>
<p>Create a script named test_xpath.py, subscribe to XPath KPI events, and trigger an alarm when the CPU usage exceeds 90%.</p>
<pre class="screen">def ops_condition(_ops)
    e1 = _ops.kpi.event("cpu")
    e1.add_kpi("<span>huawei-cpu-memory:cpu-memory/board-cpu-infos/board-cpu-info</span>/system-cpu-usage")
    e1. set_threshold("&gt;", 90)
    e1. set_compute_rule("avg", 5)
    _ops.kpi.subscribe(e1)</pre>
<p>Subscribe to multiple KPI events at the same time and specify the OR relationship between the events.</p>
<pre class="screen">def ops_condition(_ops)
    e1 = _ops.kpi.event("cpu1")
    e1.add_inner(10167, 0)
    e1. set_threshold("&gt;", 90)
    e1. set_compute_rule("avg", 5)
    _ops.kpi.subscribe(e1)
 
    e2 = _ops.kpi.event("cpu2")
    e2.add_kpi("<span>huawei-cpu-memory:cpu-memory/board-cpu-infos/board-cpu-info</span>/system-cpu-usage")
    e2. set_threshold("&gt;", 90)
    e2. set_compute_rule("avg", 5)
    _ops.kpi.subscribe(e2)
 
    _ops.correlate("cpu1 and cpu2")</pre>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="vrp_ops_cfg_0018.html">OPS Capability Set
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="vrp_ops_cfg_0026.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>