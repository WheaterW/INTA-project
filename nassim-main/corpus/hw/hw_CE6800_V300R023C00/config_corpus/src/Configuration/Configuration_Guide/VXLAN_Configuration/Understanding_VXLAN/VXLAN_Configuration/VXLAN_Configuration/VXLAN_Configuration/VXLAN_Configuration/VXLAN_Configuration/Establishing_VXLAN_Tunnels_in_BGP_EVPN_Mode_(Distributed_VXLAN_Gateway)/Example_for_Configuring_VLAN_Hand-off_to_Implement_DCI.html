
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring VLAN Hand-off to Implement DCI">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../dc/dc_vrp_vxlan_cfg_1066.html">
<meta name="DC.Relation" scheme="URI" content="../dc/dc_cfg_vxlan_cfgcase_0010.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="VXLAN">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="VXLAN">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="VXLAN">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="VXLAN">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001589858129">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="../public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring VLAN Hand-off to Implement DCI</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001589858129"></a><a name="EN-US_TASK_0000001589858129"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring VLAN Hand-off to Implement DCI</h1>
<div class="taskbody" id="taskbody0000001589858129"><div class="context"><a name="EN-US_TASK_0000001589858129__1.3.1"></a><a name="1.3.1"></a>
<div class="p" id="EN-US_TASK_0000001589858129__context1363268974175357"><h4 class="sectiontitle">Networking Requirements</h4><p id="EN-US_TASK_0000001589858129__p725339178175357">On the network shown in <a href="#EN-US_TASK_0000001589858129__fig_dc_cfg_vxlan_cfgcase_001601">Figure 1</a>, <span>an enterprise has VMs deployed in different DCs. To allow VMs in the same DC to communication with each other, configure BGP EVPN in each DC to create a VXLAN tunnel in distributed gateway mode. Through a Layer 2 sub-interface, Leaf2 accesses DCI-VTEP1, and Leaf 3 accesses DCI-VTEP2. To allow VMs in different DCs to communicate with each other, create a VXLAN tunnel by configuring BGP EVPN in each DC. In inter-DC communication, Leaf2 and Leaf3 decapsulate the VXLAN packets they receive from their own DCs and send them to their connected DCI-VTEPs. Upon receipt, the local DCI-VTEP re-encapsulates the packets into VXLAN packets and sends them to the peer DCI-VTEP. This process allows the VXLAN tunnel to transmit inter-DC packets end to end and ensures that the VMs in different DCs can communicate with each other.</span></p>
<div class="fignone" id="EN-US_TASK_0000001589858129__fig_dc_cfg_vxlan_cfgcase_001601"><a name="EN-US_TASK_0000001589858129__fig_dc_cfg_vxlan_cfgcase_001601"></a><a name="fig_dc_cfg_vxlan_cfgcase_001601"></a><span class="figcap"><b>Figure 1 </b>Network diagram for configuring VLAN hand-off to implement DCI</span><div class="note" id="EN-US_TASK_0000001589858129__note1648475717209"><img src="../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0000001589858129__p7484457122017">In this example, interface1, interface2, and interface3 represent <span>100GE</span><span>1/0/1</span>, <span>100GE</span><span>1/0/2</span>, and <span>100GE</span><span>1/0/3</span>, respectively.</p>
</div></div>
<p id="EN-US_TASK_0000001589858129__p4631152134515"><span><img class="vsd" id="EN-US_TASK_0000001589858129__image1201021007175357" src="images/fig_dc_cfg_vxlan_cfgcase_001701dcf.png"></span></p>
</div>

<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" id="EN-US_TASK_0000001589858129__table_01" frame="border" border="1" rules="all"><caption><b>Table 1 </b>Interface IP addresses</caption><thead align="left"><tr id="EN-US_TASK_0000001589858129__row1744410268175357"><th align="left" class="cellrowborder" valign="top" width="11.42%" id="mcps1.3.1.4.2.7.1.1" liSelected="liSelected"><p id="EN-US_TASK_0000001589858129__p1272307310175357">Device</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="23.29%" id="mcps1.3.1.4.2.7.1.2" liSelected="liSelected"><p id="EN-US_TASK_0000001589858129__p1242681975175357">Interface</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="16.42%" id="mcps1.3.1.4.2.7.1.3" liSelected="liSelected"><p id="EN-US_TASK_0000001589858129__p1659237153175357">IP Address</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="11.4%" id="mcps1.3.1.4.2.7.1.4" liSelected="liSelected"><p id="EN-US_TASK_0000001589858129__p248546341175357">Device</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="21.18%" id="mcps1.3.1.4.2.7.1.5" liSelected="liSelected"><p id="EN-US_TASK_0000001589858129__p190569014175357">Interface</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="16.29%" id="mcps1.3.1.4.2.7.1.6" liSelected="liSelected"><p id="EN-US_TASK_0000001589858129__p883950771175357">IP Address</p>
</th>
</tr>
</thead>
<tbody><tr id="EN-US_TASK_0000001589858129__row1662569196175357"><td class="cellrowborder" rowspan="3" valign="middle" width="11.42%" headers="mcps1.3.1.4.2.7.1.1 "><p id="EN-US_TASK_0000001589858129__p32464257175357">Device1</p>
</td>
<td class="cellrowborder" valign="top" width="23.29%" headers="mcps1.3.1.4.2.7.1.2 "><p id="EN-US_TASK_0000001589858129__p1623168561175357"><span>100GE</span><span>1/0/1</span></p>
</td>
<td class="cellrowborder" valign="top" width="16.42%" headers="mcps1.3.1.4.2.7.1.3 "><p id="EN-US_TASK_0000001589858129__p1367185460175357">192.168.50.1/24</p>
</td>
<td class="cellrowborder" rowspan="3" valign="middle" width="11.4%" headers="mcps1.3.1.4.2.7.1.4 "><p id="EN-US_TASK_0000001589858129__p1273074903175357">Device2</p>
</td>
<td class="cellrowborder" valign="top" width="21.18%" headers="mcps1.3.1.4.2.7.1.5 "><p id="EN-US_TASK_0000001589858129__p449645290175357"><span>100GE</span><span>1/0/1</span></p>
</td>
<td class="cellrowborder" valign="top" width="16.29%" headers="mcps1.3.1.4.2.7.1.6 "><p id="EN-US_TASK_0000001589858129__p1239651283175357">192.168.60.1/24</p>
</td>
</tr>
<tr id="EN-US_TASK_0000001589858129__row1045874286175357"><td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.1 "><p id="EN-US_TASK_0000001589858129__p1822205006175357"><span>100GE</span><span>1/0/2</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.2 "><p id="EN-US_TASK_0000001589858129__p844969746175357">192.168.1.1/24</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.3 "><p id="EN-US_TASK_0000001589858129__p1018387073175357"><span>100GE</span><span>1/0/2</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.4 "><p id="EN-US_TASK_0000001589858129__p817300879175357">192.168.1.2/24</p>
</td>
</tr>
<tr id="EN-US_TASK_0000001589858129__row2092725097175357"><td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.1 "><p id="EN-US_TASK_0000001589858129__p395818094175357">Loopback0</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.2 "><p id="EN-US_TASK_0000001589858129__p66117265175357">1.1.1.1/32</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.3 "><p id="EN-US_TASK_0000001589858129__p675743646175357">Loopback0</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.4 "><p id="EN-US_TASK_0000001589858129__p825348004175357">2.2.2.2/32</p>
</td>
</tr>
<tr id="EN-US_TASK_0000001589858129__row208651306463"><td class="cellrowborder" rowspan="3" valign="top" width="11.42%" headers="mcps1.3.1.4.2.7.1.1 "><p id="EN-US_TASK_0000001589858129__p1805832603175357">DCI-VTEP1</p>
<p id="EN-US_TASK_0000001589858129__p3563144164619"></p>
<p id="EN-US_TASK_0000001589858129__p65631944104611"></p>
</td>
<td class="cellrowborder" valign="top" width="23.29%" headers="mcps1.3.1.4.2.7.1.2 "><p id="EN-US_TASK_0000001589858129__p1283370207175357"><span>100GE</span><span>1/0/1</span></p>
</td>
<td class="cellrowborder" valign="top" width="16.42%" headers="mcps1.3.1.4.2.7.1.3 "><p id="EN-US_TASK_0000001589858129__p1604544848175357">192.168.50.2/24</p>
</td>
<td class="cellrowborder" rowspan="3" valign="top" width="11.4%" headers="mcps1.3.1.4.2.7.1.4 "><p id="EN-US_TASK_0000001589858129__p455891202175357">DCI-VTEP2</p>
<p id="EN-US_TASK_0000001589858129__p195631544194618"></p>
<p id="EN-US_TASK_0000001589858129__p456220446467"></p>
</td>
<td class="cellrowborder" valign="top" width="21.18%" headers="mcps1.3.1.4.2.7.1.5 "><p id="EN-US_TASK_0000001589858129__p2018720243175357"><span>100GE</span><span>1/0/1</span></p>
</td>
<td class="cellrowborder" valign="top" width="16.29%" headers="mcps1.3.1.4.2.7.1.6 "><p id="EN-US_TASK_0000001589858129__p1650314559175357">192.168.60.2/24</p>
</td>
</tr>
<tr id="EN-US_TASK_0000001589858129__row2092523274613"><td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.1 "><p id="EN-US_TASK_0000001589858129__p131713591175357"><span>100GE</span><span>1/0/2</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.2 "><p id="EN-US_TASK_0000001589858129__p1907526493175357">-</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.3 "><p id="EN-US_TASK_0000001589858129__p1421472175175357"><span>100GE</span><span>1/0/2</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.4 "><p id="EN-US_TASK_0000001589858129__p1265431350175357">-</p>
</td>
</tr>
<tr id="EN-US_TASK_0000001589858129__row1186552817469"><td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.1 "><p id="EN-US_TASK_0000001589858129__p443517796175357">Loopback0</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.2 "><p id="EN-US_TASK_0000001589858129__p1386839503175357">9.9.9.9/32</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.3 "><p id="EN-US_TASK_0000001589858129__p16322687175357">Loopback0</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.4 "><p id="EN-US_TASK_0000001589858129__p1172300952175357">10.10.10.10/32</p>
</td>
</tr>
<tr id="EN-US_TASK_0000001589858129__row1970006042175357"><td class="cellrowborder" rowspan="3" valign="middle" width="11.42%" headers="mcps1.3.1.4.2.7.1.1 "><p id="EN-US_TASK_0000001589858129__p196649716175357">Spine1</p>
</td>
<td class="cellrowborder" valign="top" width="23.29%" headers="mcps1.3.1.4.2.7.1.2 "><p id="EN-US_TASK_0000001589858129__p399665682175357"><span>100GE</span><span>1/0/1</span></p>
</td>
<td class="cellrowborder" valign="top" width="16.42%" headers="mcps1.3.1.4.2.7.1.3 "><p id="EN-US_TASK_0000001589858129__p1663387857175357">192.168.10.1/24</p>
</td>
<td class="cellrowborder" rowspan="3" valign="middle" width="11.4%" headers="mcps1.3.1.4.2.7.1.4 "><p id="EN-US_TASK_0000001589858129__p113631086175357">Spine2</p>
</td>
<td class="cellrowborder" valign="top" width="21.18%" headers="mcps1.3.1.4.2.7.1.5 "><p id="EN-US_TASK_0000001589858129__p1255214524175357"><span>100GE</span><span>1/0/1</span></p>
</td>
<td class="cellrowborder" valign="top" width="16.29%" headers="mcps1.3.1.4.2.7.1.6 "><p id="EN-US_TASK_0000001589858129__p53321163175357">192.168.30.1/24</p>
</td>
</tr>
<tr id="EN-US_TASK_0000001589858129__row954044828175357"><td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.1 "><p id="EN-US_TASK_0000001589858129__p1394672641175357"><span>100GE</span><span>1/0/2</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.2 "><p id="EN-US_TASK_0000001589858129__p1685077648175357">192.168.20.1/24</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.3 "><p id="EN-US_TASK_0000001589858129__p1194979389175357"><span>100GE</span><span>1/0/2</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.4 "><p id="EN-US_TASK_0000001589858129__p881870224175357">192.168.40.1/24</p>
</td>
</tr>
<tr id="EN-US_TASK_0000001589858129__row1239015974175357"><td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.1 "><p id="EN-US_TASK_0000001589858129__p513383694175357">Loopback0</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.2 "><p id="EN-US_TASK_0000001589858129__p2105495446175357">3.3.3.3/32</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.3 "><p id="EN-US_TASK_0000001589858129__p154880160175357">Loopback0</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.4 "><p id="EN-US_TASK_0000001589858129__p1753044445175357">4.4.4.4/32</p>
</td>
</tr>
<tr id="EN-US_TASK_0000001589858129__row2076444755175357"><td class="cellrowborder" rowspan="3" valign="middle" width="11.42%" headers="mcps1.3.1.4.2.7.1.1 "><p id="EN-US_TASK_0000001589858129__p261911039175357">Leaf1</p>
</td>
<td class="cellrowborder" valign="top" width="23.29%" headers="mcps1.3.1.4.2.7.1.2 "><p id="EN-US_TASK_0000001589858129__p1266065458175357"><span>100GE</span><span>1/0/1</span></p>
</td>
<td class="cellrowborder" valign="top" width="16.42%" headers="mcps1.3.1.4.2.7.1.3 "><p id="EN-US_TASK_0000001589858129__p720313781175357">192.168.10.2/24</p>
</td>
<td class="cellrowborder" rowspan="3" valign="middle" width="11.4%" headers="mcps1.3.1.4.2.7.1.4 "><p id="EN-US_TASK_0000001589858129__p1464430428175357">Leaf4</p>
</td>
<td class="cellrowborder" valign="top" width="21.18%" headers="mcps1.3.1.4.2.7.1.5 "><p id="EN-US_TASK_0000001589858129__p2136560048175357"><span>100GE</span><span>1/0/1</span></p>
</td>
<td class="cellrowborder" valign="top" width="16.29%" headers="mcps1.3.1.4.2.7.1.6 "><p id="EN-US_TASK_0000001589858129__p1884569675175357">192.168.40.2/24</p>
</td>
</tr>
<tr id="EN-US_TASK_0000001589858129__row123871040175357"><td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.1 "><p id="EN-US_TASK_0000001589858129__p192916721175357"><span>100GE</span><span>1/0/2</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.2 "><p id="EN-US_TASK_0000001589858129__p1152960905175357">-</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.3 "><p id="EN-US_TASK_0000001589858129__p388328353175357"><span>100GE</span><span>1/0/2</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.4 "><p id="EN-US_TASK_0000001589858129__p715253324175357">-</p>
</td>
</tr>
<tr id="EN-US_TASK_0000001589858129__row883229135175357"><td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.1 "><p id="EN-US_TASK_0000001589858129__p265677010175357">Loopback0</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.2 "><p id="EN-US_TASK_0000001589858129__p1472159215175357">5.5.5.5/32</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.3 "><p id="EN-US_TASK_0000001589858129__p369520824175357">Loopback0</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.4 "><p id="EN-US_TASK_0000001589858129__p1451831414175357">8.8.8.8/32</p>
</td>
</tr>
<tr id="EN-US_TASK_0000001589858129__row1206258569175357"><td class="cellrowborder" rowspan="4" valign="middle" width="11.42%" headers="mcps1.3.1.4.2.7.1.1 "><p id="EN-US_TASK_0000001589858129__p1459783619175357">Leaf2</p>
</td>
<td class="cellrowborder" valign="top" width="23.29%" headers="mcps1.3.1.4.2.7.1.2 "><p id="EN-US_TASK_0000001589858129__p932094299175357"><span>100GE</span><span>1/0/1</span></p>
</td>
<td class="cellrowborder" valign="top" width="16.42%" headers="mcps1.3.1.4.2.7.1.3 "><p id="EN-US_TASK_0000001589858129__p432599811175357">192.168.20.2/24</p>
</td>
<td class="cellrowborder" rowspan="4" valign="middle" width="11.4%" headers="mcps1.3.1.4.2.7.1.4 "><p id="EN-US_TASK_0000001589858129__p827230518175357">Leaf3</p>
</td>
<td class="cellrowborder" valign="top" width="21.18%" headers="mcps1.3.1.4.2.7.1.5 "><p id="EN-US_TASK_0000001589858129__p454844102175357"><span>100GE</span><span>1/0/1</span></p>
</td>
<td class="cellrowborder" valign="top" width="16.29%" headers="mcps1.3.1.4.2.7.1.6 "><p id="EN-US_TASK_0000001589858129__p830867487175357">192.168.30.2/24</p>
</td>
</tr>
<tr id="EN-US_TASK_0000001589858129__row1661132064813"><td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.1 "><p id="EN-US_TASK_0000001589858129__p17507330144816"><span>100GE</span><span>1/0/2</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.2 "><p id="EN-US_TASK_0000001589858129__p5611720114818">-</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.3 "><p id="EN-US_TASK_0000001589858129__p17698531134814"><span>100GE</span><span>1/0/2</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.4 "><p id="EN-US_TASK_0000001589858129__p1061132014816">-</p>
</td>
</tr>
<tr id="EN-US_TASK_0000001589858129__row1124110592175357"><td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.1 "><p id="EN-US_TASK_0000001589858129__p109542154175357"><span>100GE</span><span>1/0/3</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.2 "><p id="EN-US_TASK_0000001589858129__p823084951175357">-</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.3 "><p id="EN-US_TASK_0000001589858129__p773858171175357"><span>100GE</span><span>1/0/3</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.4 "><p id="EN-US_TASK_0000001589858129__p470705174175357">-</p>
</td>
</tr>
<tr id="EN-US_TASK_0000001589858129__row326739962175357"><td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.1 "><p id="EN-US_TASK_0000001589858129__p560499488175357">Loopback0</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.2 "><p id="EN-US_TASK_0000001589858129__p245297996175357">6.6.6.6/32</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.3 "><p id="EN-US_TASK_0000001589858129__p485240542175357">Loopback0</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.4 "><p id="EN-US_TASK_0000001589858129__p1294730850175357">7.7.7.7/32</p>
</td>
</tr>
</tbody>
</table>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001589858129__1.3.2"></a><a name="1.3.2"></a>
<div class="p" id="EN-US_TASK_0000001589858129__context1791788686175357"><h4 class="sectiontitle">Configuration Roadmap</h4><p id="EN-US_TASK_0000001589858129__p1396786281175357">The configuration roadmap is as follows:</p>
<ol id="EN-US_TASK_0000001589858129__ol1957343450175357"><li id="EN-US_TASK_0000001589858129__li106330734175357"><p id="EN-US_TASK_0000001589858129__p394252034175357"><a name="EN-US_TASK_0000001589858129__li106330734175357"></a><a name="li106330734175357"></a>Configure interface IP addresses for devices.</p>
</li><li id="EN-US_TASK_0000001589858129__li379282537175357"><p id="EN-US_TASK_0000001589858129__p870135063175357"><a name="EN-US_TASK_0000001589858129__li379282537175357"></a><a name="li379282537175357"></a>Configure routing protocols to ensure that devices can communicate with each other.</p>
</li><li id="EN-US_TASK_0000001589858129__li511580928175357"><p id="EN-US_TASK_0000001589858129__p1763617955175357"><a name="EN-US_TASK_0000001589858129__li511580928175357"></a><a name="li511580928175357"></a>Configure BGP EVPN in DC A and DC B to create VXLAN tunnels and establish IBGP peer relationships in both DCs.</p>
</li><li id="EN-US_TASK_0000001589858129__li250655604175357"><p id="EN-US_TASK_0000001589858129__p1553304661175357"><a name="EN-US_TASK_0000001589858129__li250655604175357"></a><a name="li250655604175357"></a>Configure BGP EVPN on DCI-VTEPs to create a VXLAN tunnel between them.</p>
</li><li id="EN-US_TASK_0000001589858129__li1808077857175357"><p id="EN-US_TASK_0000001589858129__p1470937549175357"><a name="EN-US_TASK_0000001589858129__li1808077857175357"></a><a name="li1808077857175357"></a>Configure Layer 2 sub-interfaces on Leaf2, Leaf3, DCI-VTEP1, and DCI-VTEP2 for DCI tunnel access.</p>
</li></ol>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001589858129__1.3.3"></a><a name="1.3.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol id="EN-US_TASK_0000001589858129__steps1819348992175357"><li id="EN-US_TASK_0000001589858129__step575910134175357"><span id="EN-US_TASK_0000001589858129__cmd612825109175357">Configure interface IP addresses for devices.</span><p><p id="EN-US_TASK_0000001589858129__p190808623175357"># Configure Device1. The configurations of other devices are similar to the configuration of Device1. For detailed configurations, see Configuration Scripts.</p>
<pre class="screen" id="EN-US_TASK_0000001589858129__screen5314548485">&lt;<span class="keyword" id="EN-US_TASK_0000001589858129__keyword288825270175357">HUAWEI</span>&gt; <strong id="EN-US_TASK_0000001589858129__b421803293175357">system-view</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword141191035814"><font style="font-size:8pt" Face="Courier New" >~</font></span></span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword2104953449175357">HUAWEI</span>] <strong id="EN-US_TASK_0000001589858129__b1773368561175357">sysname Device1</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword1652188171019">*</span></span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword969690710175357">HUAWEI</span>] <strong id="EN-US_TASK_0000001589858129__b378765553175357">commit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword151761739155618"><font style="font-size:8pt" Face="Courier New" >~</font></span></span>Device1] <strong id="EN-US_TASK_0000001589858129__b641458871175357">interface loopback 0</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword310811813561">*</span></span>Device1-LoopBack0] <strong id="EN-US_TASK_0000001589858129__b1323277340175357">ip address 1.1.1.1 32</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword19305151035620">*</span></span>Device1-LoopBack0] <strong id="EN-US_TASK_0000001589858129__b1636218836175357">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword420161219561">*</span></span>Device1] <strong id="EN-US_TASK_0000001589858129__b123426997175357">interface <span>100ge</span> <span>1/0/1</span></strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword1059614205620">*</span></span>Device1-<span>100GE</span><span>1/0/1</span>] <strong id="EN-US_TASK_0000001589858129__b459067790175357">undo portswitch</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword58809152568">*</span></span>Device1-<span>100GE</span><span>1/0/1</span>] <strong id="EN-US_TASK_0000001589858129__b565238834175357">ip address 192.168.50.1 24</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword517912184561">*</span></span>Device1-<span>100GE</span><span>1/0/1</span>] <strong id="EN-US_TASK_0000001589858129__b146578016175357">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword42661220145613">*</span></span>Device1] <strong id="EN-US_TASK_0000001589858129__b1395170172175357">interface <span>100ge</span> <span>1/0/2</span></strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword787717233569">*</span></span>Device1-<span>100GE</span><span>1/0/2</span>] <strong id="EN-US_TASK_0000001589858129__b550402134175357">undo portswitch</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword11860123155613">*</span></span>Device1-<span>100GE</span><span>1/0/2</span>] <strong id="EN-US_TASK_0000001589858129__b852427692175357">ip address 192.168.1.1 24</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword1962133365612">*</span></span>Device1-<span>100GE</span><span>1/0/2</span>] <strong id="EN-US_TASK_0000001589858129__b1203603298175357">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword9340257548">*</span></span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword2092415151">Device1</span>] <strong id="EN-US_TASK_0000001589858129__b183403573417">commit</strong></pre>
</p></li><li id="EN-US_TASK_0000001589858129__step943710766175357"><span id="EN-US_TASK_0000001589858129__cmd1780111067175357">Configure a routing protocol to implement route reachability.</span><p><p id="EN-US_TASK_0000001589858129__p1527712241376"># Configure Spine1. The configurations of Spine2, Device1, and Device2 are similar to the configuration of Spine1. For detailed configurations, see Configuration Scripts.</p>
<pre class="screen" id="EN-US_TASK_0000001589858129__screen22771241375">&lt;<span class="keyword" id="EN-US_TASK_0000001589858129__keyword162779244714">HUAWEI</span>&gt; <strong id="EN-US_TASK_0000001589858129__b127713241078">system-view</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword12277324670"><font style="font-size:8pt" Face="Courier New" >~</font></span></span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword127742412713">HUAWEI</span>] <strong id="EN-US_TASK_0000001589858129__b1727717241072">sysname Spine1</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword10277152411717">*</span></span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword1527715242711">HUAWEI</span>] <strong id="EN-US_TASK_0000001589858129__b9277162414715">commit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword15277192412717"><font style="font-size:8pt" Face="Courier New" >~</font></span></span>Spine1] <strong id="EN-US_TASK_0000001589858129__b42771724876">ospf 1</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword112786249713">*</span></span>Spine1-ospf-1] <strong id="EN-US_TASK_0000001589858129__b1827814247710">area 0</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword172781124373">*</span></span>Spine1-ospf-1-area-0.0.0.0] <strong id="EN-US_TASK_0000001589858129__b1227819243711">network 3.3.3.3 0.0.0.0</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword1248718490818">*</span></span>Spine1-ospf-1-area-0.0.0.0] <strong id="EN-US_TASK_0000001589858129__b164871549481">network 192.168.10.0 0.0.0.255</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword132787243717">*</span></span>Spine1-ospf-1-area-0.0.0.0] <strong id="EN-US_TASK_0000001589858129__b327817241777">network 192.168.20.0 0.0.0.255</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword127892411717">*</span></span>Spine1-ospf-1-area-0.0.0.0] <strong id="EN-US_TASK_0000001589858129__b427813243719">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword22786241976">*</span></span>Spine1-ospf-1] <strong id="EN-US_TASK_0000001589858129__b927816241175">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword1227816247719">*</span></span>Spine1] <strong id="EN-US_TASK_0000001589858129__b182781242720">commit</strong></pre>
<p id="EN-US_TASK_0000001589858129__p1541768861175357"># Configure Leaf1. The configurations of Leaf2, Leaf3, Leaf4, DCI-VTEP1, and DCI-VTEP2 are similar to the configuration of Leaf1. For detailed configurations, see Configuration Scripts.</p>
<pre class="screen" id="EN-US_TASK_0000001589858129__screen396904651414">&lt;<span class="keyword" id="EN-US_TASK_0000001589858129__keyword996954610149">HUAWEI</span>&gt; <strong id="EN-US_TASK_0000001589858129__b4969144671419">system-view</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword79691446171413"><font style="font-size:8pt" Face="Courier New" >~</font></span></span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword99691246171413">HUAWEI</span>] <strong id="EN-US_TASK_0000001589858129__b296924614143">sysname Leaf1</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword10969124619149">*</span></span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword119691746171412">HUAWEI</span>] <strong id="EN-US_TASK_0000001589858129__b1969144619140">commit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword5540323151519"><font style="font-size:8pt" Face="Courier New" >~</font></span></span>Leaf1] <strong id="EN-US_TASK_0000001589858129__b8755002179">ospf 1</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword18918622121612">*</span></span>Leaf1-ospf-1] <strong id="EN-US_TASK_0000001589858129__b1246810919513">area 0</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword131811925171617">*</span></span>Leaf1-ospf-1-area-0.0.0.0] <strong id="EN-US_TASK_0000001589858129__b1346819920513">network 5.5.5.5 0.0.0.0</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword945771819174">*</span></span>Leaf1-ospf-1-area-0.0.0.0] <strong id="EN-US_TASK_0000001589858129__b18457718121718">network 192.168.10.0 0.0.0.255</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword912342781620">*</span></span>Leaf1-ospf-1-area-0.0.0.0] <strong id="EN-US_TASK_0000001589858129__b104681191454">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword13724113621814">*</span></span>Leaf1-ospf-1] <strong id="EN-US_TASK_0000001589858129__b2072413360187">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword15202153613120">*</span></span>Leaf1] <strong id="EN-US_TASK_0000001589858129__b16597181951114">bgp 100</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword1059819194112">*</span></span>Leaf1-bgp] <strong id="EN-US_TASK_0000001589858129__b559871951114">ipv4-family unicast</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword1159881911115">*</span></span>Leaf1-bgp-af-ipv4] <strong id="EN-US_TASK_0000001589858129__b18769202091211">peer 6.6.6.6 enable</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword14598121919114">*</span></span>Leaf1-bgp-af-ipv4] <strong id="EN-US_TASK_0000001589858129__b65989190111">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword1959891951114">*</span></span>Leaf1-bgp] <strong id="EN-US_TASK_0000001589858129__b10598121915112">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword165981419171118">*</span></span>Leaf1] <strong id="EN-US_TASK_0000001589858129__b959819198119">commit</strong></pre>
</p></li><li id="EN-US_TASK_0000001589858129__step452012171303"><span id="EN-US_TASK_0000001589858129__cmd14520111717301">Configure BGP EVPN to establish one VXLAN tunnel in DC A and another one in DC B.</span><ol type="a" id="EN-US_TASK_0000001589858129__substeps898018415312"><li class="substepexpand" id="EN-US_TASK_0000001589858129__substep15979134113117"><span id="EN-US_TASK_0000001589858129__cmd19979648318">Configure VXLAN service access points. </span><p><p id="EN-US_TASK_0000001589858129__p24543503115"># Configure Leaf1.</p>
<pre class="screen" id="EN-US_TASK_0000001589858129__screen345163553120">[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword545153593112"><font style="font-size:8pt" Face="Courier New" >~</font></span></span>Leaf1] <strong id="EN-US_TASK_0000001589858129__b34523523115">bridge-domain 10</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword1645335103110">*</span></span>Leaf1-bd10] <strong id="EN-US_TASK_0000001589858129__b1945163515318">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword16451935103110">*</span></span>Leaf1] <strong id="EN-US_TASK_0000001589858129__b34516357314">interface <span>100GE</span> <span>1/0/2</span>.1 mode l2</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword1745133563116">*</span></span>Leaf1-<span>100GE</span><span>1/0/2</span>.1] <strong id="EN-US_TASK_0000001589858129__b446123543115">encapsulation dot1q vid 10</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword946735203119">*</span></span>Leaf1-<span>100GE</span><span>1/0/2</span>.1] <strong id="EN-US_TASK_0000001589858129__b164612353317">bridge-domain 10</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword114618352314">*</span></span>Leaf1-<span>100GE</span><span>1/0/2</span>.1] <strong id="EN-US_TASK_0000001589858129__b846835113112">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword18466352318">*</span></span>Leaf1] <strong id="EN-US_TASK_0000001589858129__b04663523119">commit</strong></pre>
<p id="EN-US_TASK_0000001589858129__p146103523115">The configurations of Leaf2, Leaf3, and Leaf4 are similar to the configuration of Leaf1. For detailed configurations, see Configuration Scripts. </p>
</p></li><li class="substepexpand" id="EN-US_TASK_0000001589858129__substep11708110143319"><span id="EN-US_TASK_0000001589858129__cmd12708140123311">Configure EVPN as the VXLAN control plane on Leaf1, Leaf2, Leaf3, and Leaf4.</span><p><p id="EN-US_TASK_0000001589858129__p17708120183319"># Configure Leaf1.</p>
<pre class="screen" id="EN-US_TASK_0000001589858129__screen117081702333">[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword2708909337"><font style="font-size:8pt" Face="Courier New" >~</font></span></span>Leaf1] <strong id="EN-US_TASK_0000001589858129__b137081208332">evpn-overlay enable</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword2708200153317">*</span></span>Leaf1] <strong id="EN-US_TASK_0000001589858129__b1070818083318">commit</strong></pre>
<p id="EN-US_TASK_0000001589858129__p207082016334">The configurations of Leaf2, Leaf3, and Leaf4 are similar to the configuration of Leaf1. For detailed configurations, see Configuration Scripts. </p>
</p></li><li class="substepexpand" id="EN-US_TASK_0000001589858129__substep87081102332"><span id="EN-US_TASK_0000001589858129__cmd37081400334">Establish an IBGP EVPN peer relationship between Leaf1 and Leaf2, and another one between Leaf3 and Leaf4.</span><p><p id="EN-US_TASK_0000001589858129__p470813019333"># Configure Leaf1.</p>
<pre class="screen" id="EN-US_TASK_0000001589858129__screen177086013311">[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword1270815010331"><font style="font-size:8pt" Face="Courier New" >~</font></span></span>Leaf1] <strong id="EN-US_TASK_0000001589858129__b1970830173314">bgp 100</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword670940153317">*</span></span>Leaf1-bgp] <strong id="EN-US_TASK_0000001589858129__b67092009332">peer 6.6.6.6 as-number 100</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword157093073310">*</span></span>Leaf1-bgp] <strong id="EN-US_TASK_0000001589858129__b127091201335">peer 6.6.6.6 connect-interface LoopBack 0</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword187091700334">*</span></span>Leaf1-bgp] <strong id="EN-US_TASK_0000001589858129__b67097020334">l2vpn-family evpn</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword1570918011330">*</span></span>Leaf1-bgp-af-evpn] <strong id="EN-US_TASK_0000001589858129__b137094018331">peer 6.6.6.6 enable</strong>
Warning: This operation will reset the peer session. Continue? [Y/N]: <strong id="EN-US_TASK_0000001589858129__b87091600339">y</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword97091101337">*</span></span>Leaf1-bgp-af-evpn] <strong id="EN-US_TASK_0000001589858129__b8709190143313">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword117091404335">*</span></span>Leaf1-bgp] <strong id="EN-US_TASK_0000001589858129__b15709120183319">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword3709130133310">*</span></span>Leaf1] <strong id="EN-US_TASK_0000001589858129__b67091406331">commit</strong></pre>
<p id="EN-US_TASK_0000001589858129__p1954153914012">The configurations of Leaf2, Leaf3, and Leaf4 are similar to the configuration of Leaf1. For detailed configurations, see Configuration Scripts. </p>
</p></li><li class="substepexpand" id="EN-US_TASK_0000001589858129__substep471700163312"><span id="EN-US_TASK_0000001589858129__cmd97174019332">Configure EVPN instances.</span><p><p id="EN-US_TASK_0000001589858129__p37171102333"># Configure Leaf1.</p>
<pre class="screen" id="EN-US_TASK_0000001589858129__screen171790123312">[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword18970184052317"><font style="font-size:8pt" Face="Courier New" >~</font></span></span>Leaf1] <strong id="EN-US_TASK_0000001589858129__b47181014331">bridge-domain 10</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword859816431237"><font style="font-size:8pt" Face="Courier New" >~</font></span></span>Leaf1-bd10] <strong id="EN-US_TASK_0000001589858129__b177181604330">vxlan vni 10</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword6718150103317">*</span></span>Leaf1-bd10] <strong id="EN-US_TASK_0000001589858129__b1471919093315">evpn</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword57191807338">*</span></span>Leaf1-bd10-evpn] <strong id="EN-US_TASK_0000001589858129__b147191208335">route-distinguisher 10:1</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword1719110103312">*</span></span>Leaf1-bd10-evpn] <strong id="EN-US_TASK_0000001589858129__b127194053318">vpn-target 11:1</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword177196013317">*</span></span>Leaf1-bd10-evpn] <strong id="EN-US_TASK_0000001589858129__b87191900331">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword147193018333">*</span></span>Leaf1-bd10] <strong id="EN-US_TASK_0000001589858129__b17719130133314">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword207196043319">*</span></span>Leaf1] <strong id="EN-US_TASK_0000001589858129__b187201203335">commit</strong></pre>
<p id="EN-US_TASK_0000001589858129__p2720903333">The configurations of Leaf2, Leaf3, and Leaf4 are similar to the configuration of Leaf1. For detailed configurations, see Configuration Scripts. </p>
</p></li><li class="substepexpand" id="EN-US_TASK_0000001589858129__substep57201043313"><span id="EN-US_TASK_0000001589858129__cmd17720120183316">Enable ingress replication on leaf nodes.</span><p><p id="EN-US_TASK_0000001589858129__p16720200133310"># Configure Leaf1.</p>
<pre class="screen" id="EN-US_TASK_0000001589858129__screen1672019063310">[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword6720805339"><font style="font-size:8pt" Face="Courier New" >~</font></span></span>Leaf1] <strong id="EN-US_TASK_0000001589858129__b19720605335">interface nve 1</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword4720170103312">*</span></span>Leaf1-Nve1] <strong id="EN-US_TASK_0000001589858129__b67201303332">source 5.5.5.5</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword1772020173310">*</span></span>Leaf1-Nve1] <strong id="EN-US_TASK_0000001589858129__b16720170103310">vni 10 head-end peer-list protocol bgp</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword272090153315">*</span></span>Leaf1-Nve1] <strong id="EN-US_TASK_0000001589858129__b67204093316">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword107202007332">*</span></span>Leaf1] <strong id="EN-US_TASK_0000001589858129__b1720200332">commit</strong></pre>
<p id="EN-US_TASK_0000001589858129__p127207063310">The configurations of Leaf2, Leaf3, and Leaf4 are similar to the configuration of Leaf1. For detailed configurations, see Configuration Scripts. </p>
</p></li><li class="substepexpand" id="EN-US_TASK_0000001589858129__substep725127753175357"><span id="EN-US_TASK_0000001589858129__cmd252447946175357">Configure IRB route advertisement between Leaf1 and Leaf2, and between Leaf3 and Leaf4.</span><p><p id="EN-US_TASK_0000001589858129__p1582059367175357"># Configure Leaf1.</p>
<pre class="screen" id="EN-US_TASK_0000001589858129__screen1817539300175357">[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword7840173374212"><font style="font-size:8pt" Face="Courier New" >~</font></span></span>Leaf1] <strong id="EN-US_TASK_0000001589858129__b1548450967175357">bgp 100</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword41965244220"><font style="font-size:8pt" Face="Courier New" >~</font></span></span>Leaf1-bgp] <strong id="EN-US_TASK_0000001589858129__b2054695189175357">l2vpn-family evpn</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword112305734215"><font style="font-size:8pt" Face="Courier New" >~</font></span></span>Leaf1-bgp-af-evpn] <strong id="EN-US_TASK_0000001589858129__b1218922257175357">peer 6.6.6.6 advertise irb</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword157445416433">*</span></span>Leaf1-bgp-af-evpn] <strong id="EN-US_TASK_0000001589858129__b1035293589175357">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword154231476436">*</span></span>Leaf1-bgp] <strong id="EN-US_TASK_0000001589858129__b691618035175357">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword195020109436">*</span></span>Leaf1] <strong id="EN-US_TASK_0000001589858129__b1828330987175357">commit</strong></pre>
<p id="EN-US_TASK_0000001589858129__p1688020374438">The configurations of Leaf2, Leaf3, and Leaf4 are similar to the configuration of Leaf1. For detailed configurations, see Configuration Scripts. </p>
</p></li></ol>
</li><li id="EN-US_TASK_0000001589858129__step444448799175357"><span id="EN-US_TASK_0000001589858129__cmd902840527175357">Configure BGP EVPN on DCI-VTEPs to create a VXLAN tunnel between them.</span><ol type="a" id="EN-US_TASK_0000001589858129__substeps632581242175357"><li class="substepexpand" id="EN-US_TASK_0000001589858129__substep845114219175357"><span id="EN-US_TASK_0000001589858129__cmd377837475175357">Configure EVPN as the VXLAN control plane on DCI-VTEP1 and DCI-VTEP2.</span><p><p id="EN-US_TASK_0000001589858129__p1620003621175357"># Configure DCI-VTEP1.</p>
<pre class="screen" id="EN-US_TASK_0000001589858129__screen193832258175357">&lt;<span class="keyword" id="EN-US_TASK_0000001589858129__keyword1061911394619">HUAWEI</span>&gt; <strong id="EN-US_TASK_0000001589858129__b1361916364614">system-view</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword10620439460"><font style="font-size:8pt" Face="Courier New" >~</font></span></span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword16209317462">HUAWEI</span>] <strong id="EN-US_TASK_0000001589858129__b186209311466">sysname DCI-VTEP1</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword562063134610">*</span></span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword96204311461">HUAWEI</span>] <strong id="EN-US_TASK_0000001589858129__b86206319462">commit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword43161346134411"><font style="font-size:8pt" Face="Courier New" >~</font></span></span>DCI-VTEP1] <strong id="EN-US_TASK_0000001589858129__b1509079834175357">evpn-overlay enable</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword1066995914442">*</span></span>DCI-VTEP1] <strong id="EN-US_TASK_0000001589858129__b417889402175357">commit</strong></pre>
<p id="EN-US_TASK_0000001589858129__p515610314175357">The configuration of DCI-VTEP2 is similar to the configuration of DCI-VTEP1. For detailed configurations, see Configuration Scripts.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0000001589858129__substep726624033175357"><span id="EN-US_TASK_0000001589858129__cmd1778105789175357">Establish an EBGP EVPN peer relationship between DCI-VTEP1 and DCI-VTEP2.</span><p><p id="EN-US_TASK_0000001589858129__p1500444424175357"># Configure DCI-VTEP1.</p>
<pre class="screen" id="EN-US_TASK_0000001589858129__screen1642195996175357">[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword1383810507449"><font style="font-size:8pt" Face="Courier New" >~</font></span></span>DCI-VTEP1] <strong id="EN-US_TASK_0000001589858129__b450027098175357">bgp 100</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword1486620164516">*</span></span>DCI-VTEP1-bgp] <strong id="EN-US_TASK_0000001589858129__b1636544769175357">peer 10.10.10.10 as-number 200</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword1933417474517">*</span></span>DCI-VTEP1-bgp] <strong id="EN-US_TASK_0000001589858129__b1033941725175357">peer 10.10.10.10 connect-interface LoopBack 0</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword0123166134516">*</span></span>DCI-VTEP1-bgp] <strong id="EN-US_TASK_0000001589858129__b1016667678175357">peer 10.10.10.10 ebgp-max-hop 255</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword17799157184510">*</span></span>DCI-VTEP1-bgp] <strong id="EN-US_TASK_0000001589858129__b374316730175357">l2vpn-family evpn</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword2963196458">*</span></span>DCI-VTEP1-bgp-af-evpn] <strong id="EN-US_TASK_0000001589858129__b342001470175357">peer 10.10.10.10 enable</strong>
Warning: This operation will reset the peer session. Continue? [Y/N]: <strong id="EN-US_TASK_0000001589858129__b1998287200175357">y</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword1930281274513">*</span></span>DCI-VTEP1-bgp-af-evpn] <strong id="EN-US_TASK_0000001589858129__b214960703175357">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword2689201420458">*</span></span>DCI-VTEP1-bgp] <strong id="EN-US_TASK_0000001589858129__b1910160497175357">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword20590171610457">*</span></span>DCI-VTEP1] <strong id="EN-US_TASK_0000001589858129__b1172853175357">commit</strong></pre>
<p id="EN-US_TASK_0000001589858129__p2080809458175357">The configuration of DCI-VTEP2 is similar to the configuration of DCI-VTEP1. For detailed configurations, see Configuration Scripts.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0000001589858129__substep788304498175357"><span id="EN-US_TASK_0000001589858129__cmd1207079543175357">Configure EVPN instances on DCI-VTEPs.</span><p><p id="EN-US_TASK_0000001589858129__p1372342717175357"># Configure DCI-VTEP1.</p>
<pre class="screen" id="EN-US_TASK_0000001589858129__screen1220980058175357">[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword16951841154614"><font style="font-size:8pt" Face="Courier New" >~</font></span></span>DCI-VTEP1] <strong id="EN-US_TASK_0000001589858129__b1455136556175357">bridge-domain 10</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword10921206164710">*</span></span>DCI-VTEP1-bd10] <strong id="EN-US_TASK_0000001589858129__b2142283026175357">vxlan vni 10</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword6833118124716">*</span></span>DCI-VTEP1-bd10] <strong id="EN-US_TASK_0000001589858129__b1110253957175357">evpn</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword24652108475">*</span></span>DCI-VTEP1-bd10-evpn] <strong id="EN-US_TASK_0000001589858129__b1066911359175357">route-distinguisher 10:5</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword1926311120476">*</span></span>DCI-VTEP1-bd10-evpn] <strong id="EN-US_TASK_0000001589858129__b640150071175357">vpn-target 33:3</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword1733481424718">*</span></span>DCI-VTEP1-bd10-evpn] <strong id="EN-US_TASK_0000001589858129__b1837975382175357">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword1894614155471">*</span></span>DCI-VTEP1-bd10] <strong id="EN-US_TASK_0000001589858129__b1502629558175357">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword111125181479">*</span></span>DCI-VTEP1] <strong id="EN-US_TASK_0000001589858129__b1008305634175357">commit</strong></pre>
<p id="EN-US_TASK_0000001589858129__p965588641175357">The configuration of DCI-VTEP2 is similar to the configuration of DCI-VTEP1. For detailed configurations, see Configuration Scripts.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0000001589858129__substep79268395175357"><span id="EN-US_TASK_0000001589858129__cmd824053625175357">Enable ingress replication on DCI-VTEPs.</span><p><p id="EN-US_TASK_0000001589858129__p1757171209175357"># Configure DCI-VTEP1.</p>
<pre class="screen" id="EN-US_TASK_0000001589858129__screen473978183175357">[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword87462044154612"><font style="font-size:8pt" Face="Courier New" >~</font></span></span>DCI-VTEP1] <strong id="EN-US_TASK_0000001589858129__b347434482175357">interface nve 1</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword27218213472">*</span></span>DCI-VTEP1-Nve1] <strong id="EN-US_TASK_0000001589858129__b336871537175357">source 9.9.9.9</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword16511222134716">*</span></span>DCI-VTEP1-Nve1] <strong id="EN-US_TASK_0000001589858129__b279777064175357">vni 10 head-end peer-list protocol bgp</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword1536002464718">*</span></span>DCI-VTEP1-Nve1] <strong id="EN-US_TASK_0000001589858129__b1027716229175357">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword131741026194713">*</span></span>DCI-VTEP1] <strong id="EN-US_TASK_0000001589858129__b360739178175357">commit</strong></pre>
<p id="EN-US_TASK_0000001589858129__p1763216020175357">The configuration of DCI-VTEP2 is similar to the configuration of DCI-VTEP1. For detailed configurations, see Configuration Scripts.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0000001589858129__substep2070461340175357"><span id="EN-US_TASK_0000001589858129__cmd418725392175357">Configure IRB route advertisement between DCI-VTEP1 and DCI-VTEP2.</span><p><p id="EN-US_TASK_0000001589858129__p602364904175357"># Configure DCI-VTEP1.</p>
<pre class="screen" id="EN-US_TASK_0000001589858129__screen273225787175357">[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword1599524934620"><font style="font-size:8pt" Face="Courier New" >~</font></span></span>DCI-VTEP1] <strong id="EN-US_TASK_0000001589858129__b542107025175357">bgp 100</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword2438154520473"><font style="font-size:8pt" Face="Courier New" >~</font></span></span>DCI-VTEP1-bgp] <strong id="EN-US_TASK_0000001589858129__b195377536175357">l2vpn-family evpn</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword53774479477"><font style="font-size:8pt" Face="Courier New" >~</font></span></span>DCI-VTEP1-bgp-af-evpn] <strong id="EN-US_TASK_0000001589858129__b230031230175357">peer 10.10.10.10 advertise irb</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword06271633204711">*</span></span>DCI-VTEP1-bgp-af-evpn] <strong id="EN-US_TASK_0000001589858129__b1987760906175357">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword1035953574719">*</span></span>DCI-VTEP1-bgp] <strong id="EN-US_TASK_0000001589858129__b1128568338175357">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword12187183734718">*</span></span>DCI-VTEP1] <strong id="EN-US_TASK_0000001589858129__b1432593295175357">commit</strong></pre>
<p id="EN-US_TASK_0000001589858129__p280917472485">The configuration of DCI-VTEP2 is similar to the configuration of DCI-VTEP1. For detailed configurations, see Configuration Scripts.</p>
</p></li></ol>
</li><li id="EN-US_TASK_0000001589858129__step2013860758175357"><span id="EN-US_TASK_0000001589858129__cmd467999339175357">Configure VLAN access to a VXLAN tunnel.</span><p><p id="EN-US_TASK_0000001589858129__p1229299236175357"># Configure Leaf2.</p>
<pre class="screen" id="EN-US_TASK_0000001589858129__screen1008295370175357">[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword4276223204916"><font style="font-size:8pt" Face="Courier New" >~</font></span></span>Leaf2] <strong id="EN-US_TASK_0000001589858129__b1005673272175357">interface <span>100GE</span> <span>1/0/3</span>.1 mode l2</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword37737287490">*</span></span>Leaf2-<span>100GE</span><span>1/0/3</span>.1] <strong id="EN-US_TASK_0000001589858129__b1852627770175357">encapsulation dot1q vid 10</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword135503301495">*</span></span>Leaf2-<span>100GE</span><span>1/0/3</span>.1] <strong id="EN-US_TASK_0000001589858129__b2095874534175357">bridge-domain 10</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword184166322491">*</span></span>Leaf2-<span>100GE</span><span>1/0/3</span>.1] <strong id="EN-US_TASK_0000001589858129__b948538225175357">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword1245718347493">*</span></span>Leaf2] <strong id="EN-US_TASK_0000001589858129__b1531354667175357">commit</strong></pre>
<p id="EN-US_TASK_0000001589858129__p1188423499175357">The configurations of Leaf3, DCI-VTEP1, and DCI-VTEP2 are similar to the configuration of Leaf2. For detailed configurations, see Configuration Scripts.</p>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0000001589858129__example1272468428175357"><a name="EN-US_TASK_0000001589858129__1.3.4"></a><a name="1.3.4"></a><h4 class="sectiontitle">Verifying the Configuration</h4><div class="p" id="EN-US_TASK_0000001589858129__p724096425175357">After the configurations are complete, run the <a href="cmdqueryname=display+vxlan+tunnel"><b><span class="cmdname" id="EN-US_TASK_0000001589858129__cmdname1843517315175357">display vxlan tunnel</span></b></a> command on each leaf node to check information about the established VXLAN tunnels. The following example uses the command output on Leaf1.<pre class="screen" id="EN-US_TASK_0000001589858129__screen1659355377175357">[<span><span class="keyword" id="EN-US_TASK_0000001589858129__keyword260518547575"><font style="font-size:8pt" Face="Courier New" >~</font></span></span>Leaf1] <strong id="EN-US_TASK_0000001589858129__b1221778452175357">display vxlan tunnel</strong>
Number of vxlan tunnel : 1
Tunnel ID   Source                Destination           State  Type     Uptime
-----------------------------------------------------------------------------------
4026531842  5.5.5.5               8.8.8.8               up     dynamic  00:10:16</pre>
</div>
<p id="EN-US_TASK_0000001589858129__p1292262450175357">After the configurations are complete, VMa1 and VMb2 can communicate with each other.</p>
</div>
<div class="postreq"><a name="EN-US_TASK_0000001589858129__1.3.5"></a><a name="1.3.5"></a><h4 class="sectiontitle">Configuration Scripts</h4><ul id="EN-US_TASK_0000001589858129__ul512840946175357"><li id="EN-US_TASK_0000001589858129__li1516314493175357"><p id="EN-US_TASK_0000001589858129__p509244902175357"><a name="EN-US_TASK_0000001589858129__li1516314493175357"></a><a name="li1516314493175357"></a>Spine1</p>
<pre class="screen" id="EN-US_TASK_0000001589858129__screen69285242175357">#
sysname Spine1
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 192.168.10.1 255.255.255.0
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ip address 192.168.20.1 255.255.255.0
#
interface LoopBack0
 ip address 3.3.3.3 255.255.255.255
#
ospf 1
 area 0.0.0.0
  network 3.3.3.3 0.0.0.0
  network 192.168.10.0 0.0.0.255
  network 192.168.20.0 0.0.0.255
#
return </pre>
</li><li id="EN-US_TASK_0000001589858129__li2038899306175357"><p id="EN-US_TASK_0000001589858129__p384080763175357"><a name="EN-US_TASK_0000001589858129__li2038899306175357"></a><a name="li2038899306175357"></a>Leaf1</p>
<pre class="screen" id="EN-US_TASK_0000001589858129__screen753234419175357">#
sysname Leaf1
#
evpn-overlay enable
#
bridge-domain 10
 vxlan vni 10
 #
 evpn
  route-distinguisher 10:1
  vpn-target 11:1 export-extcommunity
  vpn-target 11:1 import-extcommunity
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 192.168.10.2 255.255.255.0
#
interface <span>100GE</span><span>1/0/2</span>.1 mode l2
 encapsulation dot1q vid 10
 bridge-domain 10
#
interface LoopBack0
 ip address 5.5.5.5 255.255.255.255
#
interface Nve1
 source 5.5.5.5
 vni 10 head-end peer-list protocol bgp
#
bgp 100
 peer 6.6.6.6 as-number 100
 peer 6.6.6.6 connect-interface LoopBack0
 #
 ipv4-family unicast
  peer 6.6.6.6 enable
 #
 l2vpn-family evpn
  policy vpn-target
  peer 6.6.6.6 enable
  peer 6.6.6.6 advertise irb
#
ospf 1
 area 0.0.0.0
  network 5.5.5.5 0.0.0.0
  network 192.168.10.0 0.0.0.255
#
return</pre>
</li><li id="EN-US_TASK_0000001589858129__li2112001844175357"><p id="EN-US_TASK_0000001589858129__p657790845175357"><a name="EN-US_TASK_0000001589858129__li2112001844175357"></a><a name="li2112001844175357"></a>Leaf2</p>
<pre class="screen" id="EN-US_TASK_0000001589858129__screen1744023661175357">#
sysname Leaf2
#
evpn-overlay enable
#
bridge-domain 10
 vxlan vni 10
 #
 evpn
  route-distinguisher 10:2
  vpn-target 11:1 export-extcommunity
  vpn-target 11:1 import-extcommunity
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 192.168.20.2 255.255.255.0
#               
interface <span>100GE</span><span>1/0/2</span>.1 mode l2
 encapsulation dot1q vid 10
 bridge-domain 10
#
interface <span>100GE</span><span>1/0/3</span>.1 mode l2
 encapsulation dot1q vid 10
 bridge-domain 10
#
interface LoopBack0
 ip address 6.6.6.6 255.255.255.255
#               
interface Nve1  
 source 6.6.6.6 
 vni 10 head-end peer-list protocol bgp
#
bgp 100
 peer 5.5.5.5 as-number 100
 peer 5.5.5.5 connect-interface LoopBack0 
 #
 ipv4-family unicast
  peer 5.5.5.5 enable
 #
 l2vpn-family evpn
  policy vpn-target
  peer 5.5.5.5 enable
  peer 5.5.5.5 advertise irb
#
ospf 1
 area 0.0.0.0
  network 6.6.6.6 0.0.0.0
  network 192.168.20.0 0.0.0.255
#
return</pre>
</li><li id="EN-US_TASK_0000001589858129__li1658043728175357"><p id="EN-US_TASK_0000001589858129__p993133024175357"><a name="EN-US_TASK_0000001589858129__li1658043728175357"></a><a name="li1658043728175357"></a>Spine2</p>
<pre class="screen" id="EN-US_TASK_0000001589858129__screen663344889175357">#
sysname Spine2
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 192.168.30.1 255.255.255.0
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ip address 192.168.40.1 255.255.255.0
#
interface LoopBack0
 ip address 4.4.4.4 255.255.255.255
#
ospf 1
 area 0.0.0.0
  network 4.4.4.4 0.0.0.0
  network 192.168.30.0 0.0.0.255
  network 192.168.40.0 0.0.0.255
#
return</pre>
</li><li id="EN-US_TASK_0000001589858129__li600766483175357"><p id="EN-US_TASK_0000001589858129__p1761655234175357"><a name="EN-US_TASK_0000001589858129__li600766483175357"></a><a name="li600766483175357"></a>Leaf3</p>
<pre class="screen" id="EN-US_TASK_0000001589858129__screen2042669162175357">#
sysname Leaf3
#
evpn-overlay enable
#
bridge-domain 10
 vxlan vni 10
 #
 evpn
  route-distinguisher 10:3
  vpn-target 22:2 export-extcommunity
  vpn-target 22:2 import-extcommunity
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 192.168.30.2 255.255.255.0
#               
interface <span>100GE</span><span>1/0/2</span>.1 mode l2
 encapsulation dot1q vid 10
 bridge-domain 10
#
interface <span>100GE</span><span>1/0/3</span>.1 mode l2
 encapsulation dot1q vid 10
 bridge-domain 10
#
interface LoopBack0
 ip address 7.7.7.7 255.255.255.255
#               
interface Nve1  
 source 7.7.7.7 
 vni 10 head-end peer-list protocol bgp
#
bgp 200
 peer 8.8.8.8 as-number 200
 peer 8.8.8.8 connect-interface LoopBack0
 #
 ipv4-family unicast
  peer 8.8.8.8 enable
 #
 l2vpn-family evpn
  policy vpn-target
  peer 8.8.8.8 enable
  peer 8.8.8.8 advertise irb
#
ospf 1
  area 0.0.0.0
  network 7.7.7.7 0.0.0.0
  network 192.168.30.0 0.0.0.255
#
return</pre>
</li><li id="EN-US_TASK_0000001589858129__li346845359175357"><p id="EN-US_TASK_0000001589858129__p1159330755175357"><a name="EN-US_TASK_0000001589858129__li346845359175357"></a><a name="li346845359175357"></a>Leaf4</p>
<pre class="screen" id="EN-US_TASK_0000001589858129__screen1717838014175357">#
sysname Leaf4
#
evpn-overlay enable
#
bridge-domain 10
 vxlan vni 10
 #
 evpn
  route-distinguisher 10:4
  vpn-target 22:2 export-extcommunity
  vpn-target 22:2 import-extcommunity
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 192.168.40.2 255.255.255.0
#
interface <span>100GE</span><span>1/0/2</span>.1 mode l2
 encapsulation dot1q vid 10
 bridge-domain 10
#
interface LoopBack0
 ip address 8.8.8.8 255.255.255.255
#
interface Nve1
 source 8.8.8.8
 vni 10 head-end peer-list protocol bgp
#
bgp 200 
 peer 7.7.7.7 as-number 200
 peer 7.7.7.7 connect-interface LoopBack0
 #
 ipv4-family unicast
  peer 7.7.7.7 enable
 # 
 l2vpn-family evpn
  policy vpn-target
  peer 7.7.7.7 enable
  peer 7.7.7.7 advertise irb
#
ospf 1
 area 0.0.0.0
  network 8.8.8.8 0.0.0.0
  network 192.168.40.0 0.0.0.255
#
return</pre>
</li><li id="EN-US_TASK_0000001589858129__li16675133411613">DCI-VTEP1<pre class="screen" id="EN-US_TASK_0000001589858129__screen1736910331712">#
sysname DCI-VTEP1
#
evpn-overlay enable
#
bridge-domain 10
 vxlan vni 10
 #
 evpn
  route-distinguisher 10:5
  vpn-target 33:3 export-extcommunity
  vpn-target 33:3 import-extcommunity
#               
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 192.168.50.2 255.255.255.0
#               
interface <span>100GE</span><span>1/0/2</span>.1 mode l2
 encapsulation dot1q vid 10
 bridge-domain 10
#               
interface LoopBack0
 ip address 9.9.9.9 255.255.255.255
#               
interface Nve1  
 source 9.9.9.9 
 vni 10 head-end peer-list protocol bgp
#               
bgp 100
 peer 10.10.10.10 as-number 200
 peer 10.10.10.10 connect-interface LoopBack0
 peer 10.10.10.10 ebgp-max-hop 255
 #
 ipv4-family unicast
  peer 10.10.10.10 enable
 #
 l2vpn-family evpn
  policy vpn-target
  peer 10.10.10.10 enable
  peer 10.10.10.10 advertise irb
#
ospf 1
 area 0.0.0.0
  network 9.9.9.9 0.0.0.0
  network 192.168.50.0 0.0.0.255
#
return</pre>
</li><li id="EN-US_TASK_0000001589858129__li28141512111818">DCI-VTEP2<pre class="screen" id="EN-US_TASK_0000001589858129__screen1372192591818">#
sysname DCI-VTEP2
#
evpn-overlay enable
#
bridge-domain 10
 vxlan vni 10
 #
 evpn
  route-distinguisher 11:6
  vpn-target 33:3 export-extcommunity
  vpn-target 33:3 import-extcommunity
#               
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 192.168.60.2 255.255.255.0
#               
interface <span>100GE</span><span>1/0/2</span>.1 mode l2
 encapsulation dot1q vid 10
 bridge-domain 10
#               
interface LoopBack0
 ip address 10.10.10.10 255.255.255.255
#               
interface Nve1  
 source 10.10.10.10 
 vni 10 head-end peer-list protocol bgp
#               
bgp 200
 peer 9.9.9.9 as-number 100
 peer 9.9.9.9 connect-interface LoopBack0
 peer 9.9.9.9 ebgp-max-hop 255
 #
 ipv4-family unicast
  peer 9.9.9.9 enable
 #
 l2vpn-family evpn
  policy vpn-target
  peer 9.9.9.9 enable
  peer 9.9.9.9 advertise irb
#
ospf 1
 area 0.0.0.0
  network 10.10.10.10 0.0.0.0
  network 192.168.60.0 0.0.0.255
#
return</pre>
</li><li id="EN-US_TASK_0000001589858129__li1488519849175357"><p id="EN-US_TASK_0000001589858129__p1516098240175357"><a name="EN-US_TASK_0000001589858129__li1488519849175357"></a><a name="li1488519849175357"></a>Device1</p>
<pre class="screen" id="EN-US_TASK_0000001589858129__screen209051537175357">#
sysname Device1
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 192.168.50.1 255.255.255.0
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ip address 192.168.1.1 255.255.255.0
#
interface LoopBack0
 ip address 1.1.1.1 255.255.255.255
#
ospf 1
 area 0.0.0.0
  network 1.1.1.1 0.0.0.0
  network 192.168.1.0 0.0.0.255
  network 192.168.50.0 0.0.0.255
#
return </pre>
</li><li id="EN-US_TASK_0000001589858129__li1810542810175357"><p id="EN-US_TASK_0000001589858129__p2097213327175357"><a name="EN-US_TASK_0000001589858129__li1810542810175357"></a><a name="li1810542810175357"></a>Device2</p>
<pre class="screen" id="EN-US_TASK_0000001589858129__screen639844529175357">#
sysname Device2
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 192.168.60.1 255.255.255.0
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ip address 192.168.1.2 255.255.255.0
#
interface LoopBack0
 ip address 2.2.2.2 255.255.255.255
#
ospf 1
 area 0.0.0.0
  network 2.2.2.2 0.0.0.0
  network 192.168.1.0 0.0.0.255
  network 192.168.60.0 0.0.0.255
#
return </pre>
</li></ul>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../dc/dc_vrp_vxlan_cfg_1066.html">Establishing VXLAN Tunnels in BGP EVPN Mode (Distributed VXLAN Gateway)
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../dc/dc_cfg_vxlan_cfgcase_0010.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>
</body>
</html>