
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring EVPN Route Flapping Suppression">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../toctopics/en-us_topic_0000001130784304.html">
<meta name="DC.Relation" scheme="URI" content="../dc/dc_vrp_evpn_cfg_0089.html">
<meta name="DC.Relation" scheme="URI" content="../vrp/dc_vrp_vxlan_cfg_1229.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="VXLAN">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="VXLAN">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="VXLAN">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001130784292">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="../public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="../public_sys-resources/browseVersion.js"></script>
<title>Configuring EVPN Route Flapping Suppression</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001130784292"></a><a name="EN-US_TASK_0000001130784292"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring EVPN Route Flapping Suppression</h1>
<div class="taskbody"><div class="prereq" style="margin-left:0"><a name="EN-US_TASK_0000001130784292__1.3.1"></a><a name="1.3.1"></a><h4 class="sectiontitle">Prerequisites</h4>
<div class="p"><p>Before configuring EVPN route flapping suppression, complete one of the following tasks:</p>
<ul><li><a href="../dc/dc_vrp_vxlan_cfg_1072.html">Establishing VXLAN Tunnels in BGP EVPN Mode (Centralized VXLAN Gateway)</a></li><li><a href="../dc/dc_vrp_vxlan_cfg_1066.html">Establishing VXLAN Tunnels in BGP EVPN Mode (Distributed VXLAN Gateway)</a></li></ul>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001130784292__1.3.2"></a><a name="1.3.2"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>Route flapping is a major symptom of EVPN route instability. When an EVPN route flaps, it repeatedly disappears from the routing table and then reappears. EVPN route flapping consumes lots of bandwidth and CPU resources and even affects the normal network operation in extreme cases. </p>
<p>EVPN supports EVPN route flapping suppression through route dampening, which uses a penalty value to reflect the stability of an EVPN route. When an EVPN route flaps, it is assigned a penalty value. A greater number of flapping times indicates a larger penalty value. If the penalty value exceeds the preset threshold, the EVPN route is not advertised. When the penalty value decreases to the reuse threshold after a period of time, the EVPN route is re-advertised.</p>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001130784292__1.3.3"></a><a name="1.3.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Enter the system view.</span><p><pre class="screen"><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></pre>
</p></li><li><span>Enable BGP, and enter the BGP<span> or BGP multi-instance</span> view.</span><p><pre class="screen"><a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i><span> [ <strong><span>instance</span></strong> <i><span class="varname">instance-name</span></i> ]</span></pre>
</p></li><li><span>Enter the BGP-EVPN address family view or BGP multi-instance EVPN address family view.</span><p><pre class="screen"><a href="cmdqueryname=l2vpn-family+evpn"><b><span class="cmdname">l2vpn-family evpn</span></b></a></pre>
</p></li><li><span>Enable EVPN route dampening and set route dampening parameters.</span><p><ul><li>Enable EBGP EVPN route dampening and set route dampening parameters.<pre class="screen"><a href="cmdqueryname=dampening"><b><span class="cmdname">dampening</span></b></a> [ <i><span class="varname">half-life-reach</span></i> <i><span class="varname">reuse suppress</span></i> <i><span class="varname">ceiling</span></i> | [ <strong><span>route-policy</span></strong> <i><span class="varname">route-policy-name</span></i> ] ]<sup>*</sup> [ <strong><span>update-standard</span></strong> ]</pre>
</li><li>Enable IBGP EVPN route dampening and set route dampening parameters.<pre class="screen"><a href="cmdqueryname=dampening"><b><span class="cmdname">dampening</span></b></a> <strong><span>ibgp</span></strong> [ <i><span class="varname">half-life-reach</span></i> <i><span class="varname">reuse suppress</span></i> <i><span class="varname">ceiling</span></i> | [ <strong><span>route-policy</span></strong> <i><span class="varname">route-policy-name</span></i> ] ]<sup>*</sup> [ <strong><span>update-standard</span></strong> ]</pre>
</li></ul>
</p><p><p>By default, the value is 15 minutes for <i><span class="varname">half-life-reach</span></i>, 750 for <i><span class="varname">reuse</span></i>, 2000 for <em>suppress</em>, and 16000 for <em>ceiling</em>.</p>
<p>The <em>reuse</em>, <em>suppress</em>, and <em>ceiling</em> values must meet the following requirement: <em>reuse</em> value &lt; <em>suppress</em> value &lt; <em>ceiling</em> value.</p>
<p>After a route-policy is specified, EVPN can use different route dampening parameters to suppress different routes.</p>
</p></li><li><span>Commit the configuration.</span><p><pre class="screen" id="EN-US_TASK_0000001130784292__en-us_task_0234857734_screen163801330213"><a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001130784292__en-us_task_0234857734_en-us_concept_0141113565_cmdname1667501373175340">commit</span></b></a></pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001130784292__1.3.4"></a><a name="1.3.4"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p>After configuring the function, verify the configuration.</p>
<ul><li>Run the <a href="cmdqueryname=display+bgp+evpn+all+routing-table+dampening+parameter"><b><span class="cmdname">display bgp</span></b></a> [ <strong><span>instance</span></strong> <i><span class="varname">instance-name</span></i> ] <strong><span>evpn all routing-table dampening parameter</span></strong> command to check the set route dampening parameters.</li><li>Run the <a href="cmdqueryname=display+bgp+evpn+routing-table+flap-info"><b><span class="cmdname">display bgp</span></b></a> [ <strong><span>instance</span></strong> <i><span class="varname">instance-name</span></i> ] <strong><span>evpn</span></strong> { <strong><span>all</span></strong> | <strong><span>route-distinguisher</span></strong> <i><span class="varname">route-distinguisher</span></i> } <strong><span>routing-table</span></strong> <strong><span>flap-info</span></strong> [ <strong><span>mac-route</span></strong> | <strong><span>prefix-route</span></strong> ] command to check statistics about EVPN route flapping.</li><li>Run the <a href="cmdqueryname=display+bgp+evpn+routing-table+dampened"><b><span class="cmdname">display bgp</span></b></a> [ <strong><span>instance</span></strong> <i><span class="varname">instance-name</span></i> ] <strong><span>evpn</span></strong> { <strong><span>all</span></strong> | <strong><span>route-distinguisher</span></strong> <i><span class="varname">route-distinguisher</span></i> } <strong><span>routing-table</span></strong> [ <strong><span>mac-route</span></strong> | <strong><span>prefix-route</span></strong> ] <strong><span>dampened</span></strong> command to check dampened EVPN routes.</li><li>Run the <a href="cmdqueryname=display+bgp+evpn+routing-table+dampened"><b><span class="cmdname">display bgp</span></b></a> [ <strong><span>instance</span></strong> <i><span class="varname">instance-name</span></i> ] <strong><span>evpn</span></strong> { <strong><span>all</span></strong> | <strong><span>route-distinguisher</span></strong> <i><span class="varname">route-distinguisher</span></i> } <strong><span>routing-table</span></strong> <strong><span>statistics</span></strong> <strong><span>dampened</span></strong> command to check statistics about dampened EVPN routes.</li></ul>
</div>
<div class="postreq"><a name="EN-US_TASK_0000001130784292__1.3.5"></a><a name="1.3.5"></a><h4 class="sectiontitle">Follow-up Procedure</h4>
<div class="p"><p>To clear the dampening information about EVPN routes and release suppressed EVPN routes, run either of the following commands as needed:</p>
<ul><li><a href="cmdqueryname=reset+bgp+evpn+dampening"><b><span class="cmdname">reset bgp</span></b></a> [ <strong><span>instance</span></strong> <i><span class="varname">instance-name</span></i> ] <strong><span>evpn dampening</span></strong></li><li><a href="cmdqueryname=reset+bgp+evpn+dampening"><b><span class="cmdname">reset bgp</span></b></a> [ <strong><span>instance</span></strong> <i><span class="varname">instance-name</span></i> ] <strong><span>evpn dampening</span></strong> { <strong><span>mac-route</span></strong> | <strong><span>prefix-route</span></strong> } <i><span class="varname">prefix</span></i></li></ul>
<p>To clear statistics about EVPN route flapping, run any of the following commands as needed:</p>
<ul><li><a href="cmdqueryname=reset+bgp+evpn+flap-info"><b><span class="cmdname">reset bgp</span></b></a> [ <strong><span>instance</span></strong> <i><span class="varname">instance-name</span></i> ] <strong><span>evpn flap-info</span></strong></li><li><a href="cmdqueryname=reset+bgp+evpn+flap-info"><b><span class="cmdname">reset bgp</span></b></a> [ <strong><span>instance</span></strong> <i><span class="varname">instance-name</span></i> ] <strong><span>evpn flap-info</span></strong> { <strong><span>mac-route</span></strong> | <strong><span>prefix-route</span></strong> } <i><span class="varname">prefix</span></i></li><li><a href="cmdqueryname=reset+bgp+evpn+flap-info"><b><span class="cmdname">reset bgp</span></b></a> [ <strong><span>instance</span></strong> <i><span class="varname">instance-name</span></i> ] <strong><span>evpn</span></strong> { <em>ip-address</em> | <em>peerIpv6Addr</em> } <strong><span>flap-info</span></strong></li></ul>
<div class="note"><img src="../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Cleared information cannot be restored. Exercise caution when performing this operation.</p>
</div></div>
</div></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../toctopics/en-us_topic_0000001130784304.html">VXLAN Configuration
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../dc/dc_vrp_evpn_cfg_0089.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../vrp/dc_vrp_vxlan_cfg_1229.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>