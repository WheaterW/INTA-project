
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring a BFD Session to Modify the PST">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="vrp_bfd_cfg_0072.html">
<meta name="DC.Relation" scheme="URI" content="vrp_bfd_cfg_0076.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="BFD">
<meta name="featuretype" content="High Availability">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BFD">
<meta name="featuretype" content="High Availability">
<meta name="featurename" content="BFD">
<meta name="featuretype" content="High Availability">
<meta name="featuretype" content="High Availability">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001621812918">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring a BFD Session to Modify the PST</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001621812918"></a><a name="EN-US_TASK_0000001621812918"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring a BFD Session to Modify the PST</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001621812918__1.3.1"></a><a name="1.3.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>If a BFD session is enabled to modify the port state table (PST) of an interface, the BFD session will modify the interface status in the PST when it detects that the interface goes down, allowing the underlying layer to detect the fault based on the PST change. In <a href="#EN-US_TASK_0000001621812918__fig_dc_vrp_bfd_cfg_200501">Figure 1</a>, a BFD session monitors the direct link between DeviceA and DeviceB in asynchronous mode.</p>
<div class="fignone" id="EN-US_TASK_0000001621812918__fig_dc_vrp_bfd_cfg_200501"><a name="EN-US_TASK_0000001621812918__fig_dc_vrp_bfd_cfg_200501"></a><a name="fig_dc_vrp_bfd_cfg_200501"></a><span class="figcap"><b>Figure 1 </b>Network diagram of configuring a BFD session to modify the PST</span><div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface 1 represents <span>100GE</span><span>1/0/1</span>.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0000001670572809.png"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001621812918__1.3.2"></a><a name="1.3.2"></a>
<div class="p"><h4 class="sectiontitle">Precautions</h4><p>A BFD session must be established on both ends.</p>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001621812918__1.3.3"></a><a name="1.3.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><div class="p">The configuration roadmap is as follows:<ol><li><p>Assign IP addresses to the interfaces connecting DeviceA and DeviceB.</p>
</li><li><p>Enable BFD globally and configure single-hop BFD on DeviceA and DeviceB.</p>
</li><li>Configure BFD sessions to modify the PST on DeviceA and DeviceB.</li></ol>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001621812918__1.3.4"></a><a name="1.3.4"></a>
<div class="p"><h4 class="sectiontitle">Procedure</h4><ol><li>Assign IP addresses to the interfaces connecting DeviceA and DeviceB.<p># Configure DeviceA.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname DeviceA</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>]<strong> commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>interface <span>100ge</span> <span>1/0/1</span></strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>undo portswitch</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>ip address 10.1.1.1 24</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>commit</strong></pre>
<p># Configure DeviceB.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname DeviceB</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>]<strong> commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB] <strong>interface <span>100ge</span> <span>1/0/1</span></strong>
[<span class="keyword">*</span>DeviceB-<span>100GE</span><span>1/0/1</span>] <strong>undo portswitch</strong>
[<span class="keyword">*</span>DeviceB-<span>100GE</span><span>1/0/1</span>] <strong>ip address 10.1.1.2 24</strong>
[<span class="keyword">*</span>DeviceB-<span>100GE</span><span>1/0/1</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceB] <strong>commit</strong></pre>
</li><li>Enable BFD globally and configure single-hop BFD on DeviceA and DeviceB.<p># Configure a BFD session between DeviceA and <span class="keyword">Device</span>B.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>bfd</strong>
[<span class="keyword">*</span>DeviceA-bfd] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>bfd pst bind peer-ip 10.1.1.2 interface <span>100ge</span> <span>1/0/1</span></strong>
[<span class="keyword">*</span>DeviceA-bfd-session-pst] <strong>discriminator local 1</strong>
[<span class="keyword">*</span>DeviceA-bfd-session-pst] <strong>discriminator remote 2</strong>
[<span class="keyword">*</span>DeviceA-bfd-session-pst] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>commit</strong></pre>
<p># Configure a BFD session between DeviceB and <span class="keyword">Device</span>A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB] <strong>bfd</strong>
[<span class="keyword">*</span>DeviceB-bfd] <strong>quit</strong>
[<span class="keyword">*</span>DeviceB] <strong>bfd pst bind peer-ip 10.1.1.1 interface <span>100ge</span> <span>1/0/1</span></strong>
[<span class="keyword">*</span>DeviceB-bfd-session-pst] <strong>discriminator local 2</strong>
[<span class="keyword">*</span>DeviceA-bfd-session-pst] <strong>discriminator remote 1</strong>
<span class="keyword">[</span><span class="keyword">*</span>DeviceB-bfd-session-pst] <strong>quit</strong>
[<span class="keyword">*</span>DeviceB] <strong>commit</strong></pre>
</li><li>Configure BFD sessions to modify the PST on DeviceA and DeviceB.<p># Configure DeviceA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>bfd pst</strong>
[<span class="keyword">*</span>DeviceA-bfd-session-pst] <strong>process-pst</strong>
[<span class="keyword">*</span>DeviceA-bfd-session-pst] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>commit</strong></pre>
<p># Configure DeviceB.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB] <strong>bfd pst</strong>
[<span class="keyword">*</span>DeviceB-bfd-session-pst] <strong>process-pst</strong>
[<span class="keyword">*</span>DeviceB-bfd-session-pst] <strong>quit</strong>
[<span class="keyword">*</span>DeviceB] <strong>commit</strong></pre>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001621812918__1.3.5"></a><a name="1.3.5"></a>
<div class="p"><h4 class="sectiontitle">Verifying the Configuration</h4><div class="p"># Check that DeviceA and DeviceB can ping each other. The command output on DeviceA is used as an example.<pre class="screen">&lt;DeviceA&gt; <strong>ping 10.1.1.2</strong>
PING 10.1.1.2 : 56  data bytes, press CTRL_C to break
    Reply from 10.1.1.2: bytes=56 Sequence=1 ttl=255 time=3 ms
    Reply from 10.1.1.2: bytes=56 Sequence=2 ttl=255 time=1 ms
    Reply from 10.1.1.2: bytes=56 Sequence=3 ttl=255 time=1 ms
    Reply from 10.1.1.2: bytes=56 Sequence=4 ttl=255 time=1 ms
    Reply from 10.1.1.2: bytes=56 Sequence=5 ttl=255 time=1 ms

  --- 10.1.1.2 ping statistics ---
    5 packet(s) transmitted
    5 packet(s) received
    0.00% packet loss
    round-trip min/avg/max = 1/1/3 ms          </pre>
</div>
<p># Run the <a href="cmdqueryname=display+bfd+session+all+verbose"><b><span class="cmdname">display bfd session all verbose</span></b></a> command on DeviceB to check the BFD session status.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB] <strong>display bfd session all verbose</strong>
<span>(w): State in WTR 
(*): State is invalid</span>
------------------------------------------------------------------------------
  (Single Hops)   State : Up                    Name : pst
------------------------------------------------------------------------------
  Local Discriminator    : 2                Remote Discriminator   : 1
  Session Detect Mode    : Asynchronous Mode Without Echo Function
  BFD Bind Type          : Interface(<span>100GE</span><span>1/0/1</span>)
  BFD Bind Type          :
Bind Session Type      : Static
  Bind Peer IP Address   : 10.1.1.1
  Bind Interface         : <span>100GE</span><span>1/0/1</span>
  Bind Interface         : 
  FSM Board ID           : 1               TOS-EXP                : 7
  Min Tx Interval (ms)   : 1000      Min Rx Interval (ms)   : 1000
  Actual Tx Interval (ms): 10               Actual Rx Interval (ms): 10
  WTR Interval (ms)      : 0                Detect Interval (ms)   : 30
  Local Detect Multi     : 3                Active Multi           : 3               
  Echo Passive           : Disable          Acl Number             : -
  Destination Port       : 3784             TTL                    : 255
  Proc Interface Status  : Disable          <strong>Process PST         : Enable</strong>
  Config PST             : Enable    
  Last Local Diagnostic  : No Diagnostic
  Bind Application       : No Application Bind
  Session TX TmrID       : 0                Session Detect TmrID   : 0
  Session Init TmrID     : -                Session WTR TmrID      : -
  Session Echo Tx TmrID  : -
  Session Description    : -
------------------------------------------------------------------------------

     Total UP/DOWN Session Number : 1/0</pre>
<p>The command output on DeviceB shows that a single-hop BFD session has been established on DeviceB and is in the up state, and <strong>Enable</strong> is displayed in the <strong>Process PST</strong> field.</p>
</div></div>
<div class="example"><a name="EN-US_TASK_0000001621812918__1.3.6"></a><a name="1.3.6"></a><h4 class="sectiontitle">Configuration Scripts</h4><ul><li><p>DeviceA</p>
<pre class="screen">#
sysname DeviceA
#
bfd
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 10.1.1.1 255.255.255.0
#
bfd pst bind peer-ip 10.1.1.2 interface <span>100GE</span><span>1/0/1</span>
 discriminator local 1
 discriminator remote 2
 process-pst
#
return</pre>
</li><li><p>DeviceB</p>
<pre class="screen">#
sysname DeviceB
#
bfd
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 10.1.1.2 255.255.255.0
#
bfd pst bind peer-ip 10.1.1.1 interface <span>100GE</span><span>1/0/1</span>
 discriminator local 2
 discriminator remote 1
 process-pst
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="vrp_bfd_cfg_0072.html">Configuring a BFD Session to Modify the PST
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="vrp_bfd_cfg_0076.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>
</body>
</html>