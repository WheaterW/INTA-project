
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring the Primary and Secondary HWTACACS Servers">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="galaxy_aaa_cfg_0056.html">
<meta name="DC.Relation" scheme="URI" content="galaxy_aaa_cfg_0060.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="AAA">
<meta name="featurename" content="HWTACACS">
<meta name="featuretype" content="User Access and Authentication">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="AAA">
<meta name="featurename" content="AD">
<meta name="featurename" content="HWTACACS">
<meta name="featurename" content="LDAP">
<meta name="featurename" content="RADIUS">
<meta name="featurename" content="Local User">
<meta name="featuretype" content="User Access and Authentication">
<meta name="featurename" content="AAA">
<meta name="featurename" content="AD">
<meta name="featurename" content="HWTACACS">
<meta name="featurename" content="LDAP">
<meta name="featurename" content="RADIUS">
<meta name="featurename" content="Local User">
<meta name="featuretype" content="User Access and Authentication">
<meta name="featuretype" content="User Access and Authentication">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001563875641">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<link rel="stylesheet" type="text/css" href="public_sys-resources/imagePopup.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/customQuery.js"></script>
<script language="javascript" type="text/javascript" src="public_sys-resources/imagePopup.js"></script>
<title>Example for Configuring the Primary and Secondary HWTACACS Servers</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001563875641"></a><a name="EN-US_TASK_0000001563875641"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring the Primary and Secondary HWTACACS Servers</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001563875641__1.3.1"></a><a name="1.3.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>In <a href="#EN-US_TASK_0000001563875641__fig_dc_cfg_aaa_103001">Figure 1</a>, two HWTACACS servers are deployed. The enterprise requires that the two HWTACACS servers back up each other to ensure user authentication if one server is faulty.</p>
<div class="fignone" id="EN-US_TASK_0000001563875641__fig_dc_cfg_aaa_103001"><a name="EN-US_TASK_0000001563875641__fig_dc_cfg_aaa_103001"></a><a name="fig_dc_cfg_aaa_103001"></a><span class="figcap"><b>Figure 1 </b>Configuring the primary and secondary HWTACACS servers</span><div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface 1, interface 2 and interface 3 represent <span>100GE</span> <span>1/0/1</span>, <span>100GE</span> <span>1/0/2</span>, and <span>100GE</span> <span>1/0/3</span> respectively.</p>
</div></div>
<br><span><img class="imgResize" src="figure/en-us_image_0000001513155842.png" width="516.109741875" title="Click to enlarge"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001563875641__1.3.2"></a><a name="1.3.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li>Configure an HWTACACS server template.</li><li>Configure authentication, authorization, and accounting schemes.</li><li>Apply the HWTACACS server template, authentication scheme, authorization scheme, and accounting scheme to a domain.</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001563875641__1.3.3"></a><a name="1.3.3"></a>
<div class="p"><h4 class="sectiontitle">Precautions</h4><ul><li>Ensure that there are reachable routes between devices before the configuration.</li><li><p>Ensure that the shared key in the HWTACACS server template is the same as that configured on the HWTACACS server.</p>
</li><li>After the domain is set as the global default domain, and the user name of a user contains the domain name or does not contain any domain name, the user uses AAA configuration in the global default domain.</li><li><p>If the HWTACACS server does not support the user name containing the domain name, run the <strong>undo hwtacacs-server user-name domain-included</strong> command in the HWTACACS server template view to configure the device to send packets that do not contain the domain name to the HWTACACS server.</p>
</li><li>After the <strong>undo hwtacacs-server user-name domain-included</strong> command is run, the device changes only the user name format in the sent packet, without affecting the domain to which the user belongs. For example, after this command is run, the user with the user name <strong>username@huawei.com</strong> still uses AAA configuration in the domain <strong>huawei.com</strong>.</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001563875641__1.3.4"></a><a name="1.3.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure IP addresses for interfaces.</span><p><pre class="screen">&lt;HUAWEI&gt; <strong>system-view</strong> 
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>HUAWEI] <strong>sysname DeviceA</strong> 
[*<span class="keyword">DeviceA</span>] <strong>commit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font><span class="keyword">DeviceA</span>] <strong>vlan batch 10 20 30</strong>
[*DeviceA] <strong>interface </strong><strong><span>100ge</span> </strong><strong><span>1/0/1</span></strong>
[*DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>portswitch</strong>
[*DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>port link-type trunk</strong>
[*DeviceA-<span>100GE</span><span>1/0/1</span>]<strong> port trunk allow-pass vlan 10</strong>
[*DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>quit</strong>
[*DeviceA] <strong>interface </strong><strong><span>100ge</span> </strong><strong><span>1/0/2</span></strong>
[*DeviceA-<span>100GE</span><span>1/0/2</span>] <strong>portswitch</strong>
[*DeviceA-<span>100GE</span><span>1/0/2</span>] <strong>port link-type trunk</strong>
[*DeviceA-<span>100GE</span><span>1/0/2</span>]<strong> port trunk allow-pass vlan 20</strong>
[*DeviceA-<span>100GE</span><span>1/0/2</span>] <strong>quit</strong>
[*DeviceA] <strong>interface </strong><strong><span>100ge</span> </strong><strong><span>1/0/3</span></strong>
[*DeviceA-<span>100GE</span><span>1/0/3</span>] <strong>portswitch</strong>
[*DeviceA-<span>100GE</span><span>1/0/3</span>] <strong>port link-type trunk</strong>
[*DeviceA-<span>100GE</span><span>1/0/3</span>]<strong> port trunk allow-pass vlan 30</strong>
[*DeviceA-<span>100GE</span><span>1/0/3</span>] <strong>quit</strong>
[*DeviceA] <strong>interface </strong><strong>vlanif 10</strong>
[*DeviceA-Vlanif10] <strong>ip address 10.1.1.2 255.255.255.0</strong>
[*DeviceA-Vlanif10] <strong>quit</strong>
[*DeviceA] <strong>interface </strong><strong>vlanif 20</strong>
[*DeviceA-Vlanif20] <strong>ip address 10.1.6.2 255.255.255.0</strong>
[*DeviceA-Vlanif20] <strong>quit</strong>
[*DeviceA] <strong>interface </strong><strong>vlanif 30</strong>
[*DeviceA-Vlanif30] <strong>ip address </strong><strong>10.1.5.2 255.255.255.0</strong>
[*DeviceA-Vlanif30] <strong>quit</strong>
[*<span class="keyword">DeviceA</span>] <strong>commit</strong></pre>
</p></li><li><span>Configure an HWTACACS server template.</span><p><p># Create an HWTACACS server template named <strong>ht</strong>.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>hwtacacs-server template ht</strong></pre>
<p># Configure IP addresses and port numbers for the primary HWTACACS authentication, authorization, and accounting servers.</p>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">DeviceA</span>-hwtacacs-ht] <strong>hwtacacs-server authentication 10.7.66.66 49</strong>
[<span class="keyword">*</span><span class="keyword">DeviceA</span>-hwtacacs-ht] <strong>hwtacacs-server authorization 10.7.66.66 49</strong>
[<span class="keyword">*</span><span class="keyword">DeviceA</span>-hwtacacs-ht] <strong>hwtacacs-server accounting 10.7.66.66 49</strong></pre>
<p># Configure IP addresses and port numbers for the secondary HWTACACS authentication, authorization, and accounting servers.</p>
<pre class="screen">[<span class="keyword"><span class="keyword">*</span>DeviceA</span>-hwtacacs-ht] <strong>hwtacacs-server authentication 10.7.66.67 49 secondary</strong>
[<span class="keyword"><span class="keyword">*</span>DeviceA</span>-hwtacacs-ht] <strong>hwtacacs-server authorization 10.7.66.67 49 secondary</strong>
[<span class="keyword"><span class="keyword">*</span>DeviceA</span>-hwtacacs-ht] <strong>hwtacacs-server accounting 10.7.66.67 49 secondary</strong></pre>
<p># Configure a shared key for the HWTACACS server.</p>
<pre class="screen">[<span class="keyword"><span class="keyword">*</span>DeviceA</span>-hwtacacs-ht] <strong>hwtacacs-server shared-key cipher YsHsjx_202206139</strong>
[<span class="keyword"><span class="keyword">*</span>DeviceA</span>-hwtacacs-ht] <strong>quit</strong>
[<span class="keyword">*DeviceA</span>] <strong>commit</strong></pre>
</p></li><li><span>Configure authentication, authorization, and accounting schemes.</span><p><p># Create an authentication scheme named <strong>l-h</strong>, and set the authentication mode to HWTACACS and local authentication.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">DeviceA</span>] <strong>aaa</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA-aaa] <strong>authentication-scheme l-h</strong>
[<span class="keyword"><span class="keyword">*</span>DeviceA</span>-aaa-authen-l-h] <strong>authentication-mode hwtacacs</strong><strong> local</strong>
[<span class="keyword"><span class="keyword">*</span>DeviceA</span>-aaa-authen-l-h] <strong>quit</strong></pre>
<p># Create an authorization scheme named <strong>hwtacacs</strong>, and set the authorization mode to HWTACACS and local authorization.</p>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">DeviceA</span>-aaa] <strong>authorization-scheme hwtacacs</strong>
[<span class="keyword"><span class="keyword">*</span>DeviceA</span>-aaa-author-hwtacacs] <strong>authorization-mode hwtacacs</strong><strong> local</strong>
[<span class="keyword"><span class="keyword">*</span>DeviceA</span>-aaa-author-hwtacacs] <strong>quit</strong></pre>
<p># Create an accounting scheme named <strong>hwtacacs</strong>, and set the accounting mode to HWTACACS accounting.<span> Configure a policy for the device to keep users online upon accounting-start failures.</span></p>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">DeviceA</span>-aaa] <strong>accounting-scheme hwtacacs</strong>
[<span class="keyword">*</span><span class="keyword">DeviceA</span>-aaa-accounting-hwtacacs] <strong>accounting-mode hwtacacs</strong><span> </span>
<span>[<span class="keyword"><span class="keyword">*</span>DeviceA</span>-aaa-accounting-hwtacacs] <strong>accounting start-fail online</strong></span></pre>
<p># Set the real-time accounting interval to 3 minutes.</p>
<pre class="screen">[<span class="keyword"><span class="keyword">*</span>DeviceA</span>-aaa-accounting-hwtacacs] <strong>accounting realtime 3</strong>
[<span class="keyword"><span class="keyword">*</span>DeviceA</span>-aaa-accounting-hwtacacs] <strong>quit</strong></pre>
</p></li><li><span>Create the domain <strong>huawei</strong>, and apply the authentication scheme <strong>l-h</strong>, authorization scheme <strong>hwtacacs</strong>, accounting scheme <strong>hwtacacs</strong>, and HWTACACS server template <strong>ht</strong> to the domain.</span><p><pre class="screen">[<span class="keyword">*</span><span class="keyword">DeviceA</span>-aaa] <strong>domain huawei</strong>
[<span class="keyword">*</span><span class="keyword">DeviceA</span>-aaa-domain-huawei] <strong>authentication-scheme l-h</strong>
[<span class="keyword"><span class="keyword">*</span>DeviceA</span>-aaa-domain-huawei] <strong>authorization-scheme hwtacacs</strong>
[<span class="keyword"><span class="keyword">*</span>DeviceA</span>-aaa-domain-huawei] <strong>accounting-scheme hwtacacs</strong>
[<span class="keyword"><span class="keyword">*</span>DeviceA</span>-aaa-domain-huawei] <strong>hwtacacs-server ht</strong>
[<span class="keyword"><span class="keyword">*</span>DeviceA</span>-aaa-domain-huawei] <strong>quit</strong>
[<span class="keyword"><span class="keyword">*</span>DeviceA</span>-aaa] <strong>quit</strong>
[<span class="keyword">*DeviceA</span>] <strong>commit</strong></pre>
</p></li><li><span>Configure the global default administrative domain.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>domain huawei admin</strong>
[<span class="keyword">*DeviceA</span>] <strong>commit</strong></pre>
</p></li><li><span>Configure AAA local authentication. Set the local user name to <strong>user1-huawei</strong>, password to <strong>YsHsjx_202206</strong>, and privilege level to 3.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>aaa</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA-aaa] <strong>local-user user1-huawei password irreversible-cipher </strong><strong>YsHsjx_202206</strong>
[<span class="keyword">*</span>DeviceA-aaa] <strong>local-user user1-huawei service-type ssh</strong>
[<span class="keyword">*</span>DeviceA-aaa] <strong>local-user user1-huawei privilege level 3</strong>
[<span class="keyword">*</span>DeviceA-aaa] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>commit</strong></pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001563875641__1.3.5"></a><a name="1.3.5"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p>Run the <strong>display hwtacacs-server template</strong> command on <span class="keyword">DeviceA</span>. The command output shows that the HWTACACS server template configuration meets the requirements.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>display hwtacacs-server template name ht</strong>
  ---------------------------------------------------------------------------
  HWTACACS-server template name        : ht
  HWTACACS-server template index       : 1
  Primary-authentication-server        : 10.7.66.66:49 Vrf:- Shared-key:- Status:UP
  Primary-authorization-server         : 10.7.66.66:49 Vrf:- Shared-key:- Status:UP
  Primary-accounting-server            : 10.7.66.66:49 Vrf:- Shared-key:- Status:UP
  Secondary-authentication-server      : 10.7.66.66:49 Vrf:- Shared-key:- Status:-
  Secondary-authorization-server       : 10.7.66.66:49 Vrf:- Shared-key:- Status:-
  Secondary-accounting-server          : 10.7.66.66:49 Vrf:- Shared-key:- Status:-
  Third-authentication-server          : -:0 Vrf:- Shared-key:- Status:-
  Third-authorization-server           : -:0 Vrf:- Shared-key:- Status:-
  Third-accounting-server              : -:0 Vrf:- Shared-key:- Status:-
  Fourth-authentication-server         : -:0 Vrf:- Shared-key:- Status:-
  Fourth-authorization-server          : -:0 Vrf:- Shared-key:- Status:-
  Fourth-accounting-server             : -:0 Vrf:- Shared-key:- Status:-
  Current-authentication-server        : 10.7.66.66:49 Vrf:- Shared-key:- Status:UP
  Current-authorization-server         : 10.7.66.66:49 Vrf:- Shared-key:- Status:UP
  Current-accounting-server            : 10.7.66.66:49 Vrf:- Shared-key:- Status:UP
  Source-IP-address                    : -
  Source-LoopBack                      : -
  Source-Vlanif                        : -
  Shared-key                           : ****************
  Quiet-interval(min)                  : 5
  Response-timeout-Interval(sec)       : 5
  Domain-included                      : Original
  Traffic-unit                         : B
  User name in authen-start message    : No
  ---------------------------------------------------------------------------</pre>
</div>
<div class="postreq"><a name="EN-US_TASK_0000001563875641__1.3.6"></a><a name="1.3.6"></a><h4 class="sectiontitle">Configuration Scripts</h4><p><span class="keyword">DeviceA</span></p>
<pre class="screen">#
sysname <span class="keyword">DeviceA</span>
#
hwtacacs-server template ht
 hwtacacs-server authentication 10.7.66.66
 hwtacacs-server authentication 10.7.66.67 secondary
 hwtacacs-server authorization 10.7.66.66
 hwtacacs-server authorization 10.7.66.67 secondary
 hwtacacs-server accounting 10.7.66.66
 hwtacacs-server accounting 10.7.66.67 secondary
 hwtacacs-server shared-key cipher %+%##!!!!!!!!!"!!!!"!!!!*!!!!SKvr${[Fs."u,S-6a-X1'[X=L"cpF!5Oz`1!!!!!2jp5!!!!!!A!!!!Ix&gt;cM8i{y6!);(8Dr9:dK`&amp;BHfE(H2=.:SH{@pT%+%#
#
aaa
 authentication-scheme l-h
  authentication-mode hwtacacs local
 authorization-scheme hwtacacs
  authorization-mode hwtacacs local
 accounting-scheme hwtacacs
  accounting-mode hwtacacs
  accounting realtime 3
 domain huawei
  authentication-scheme l-h
  accounting-scheme hwtacacs
  authorization-scheme hwtacacs
  hwtacacs-server ht
 local-user user1-huawei password irreversible-cipher $1d$OwseVRh@LH}ZeTBm$1nH4$ab&gt;d(N{-%0!ab48y=Ic*xEUR4pVhR2"9-<font style="font-size:8pt" Face="Courier New" >~</font>,$
 local-user user1-huawei privilege level 3
 local-user user1-huawei service-type ssh   
#
domain huawei admin
#
vlan batch 10 20 30
#
interface Vlanif10
 ip address 10.1.1.2 255.255.255.0
#
interface Vlanif20
 ip address 10.1.6.2 255.255.255.0
#
interface Vlanif30
 ip address 10.1.5.2 255.255.255.0
#
interface  <span>100GE</span><span>1/0/1</span> 
 port link-type trunk
 port trunk allow-pass vlan 10
#
interface <span>100GE</span><span>1/0/2</span> 
 port link-type trunk
 port trunk allow-pass vlan 20
#
interface <span>100GE</span><span>1/0/3</span> 
 port link-type trunk
 port trunk allow-pass vlan 30
#
return </pre>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="galaxy_aaa_cfg_0056.html">Configuration Examples for AAA
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="galaxy_aaa_cfg_0060.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>

<script language="JavaScript">
<!--
initImageViewer('.imgResize');
var msg_imageMax = "view original image";
var msg_imageClose = "close";
//--></script></body>
</html>