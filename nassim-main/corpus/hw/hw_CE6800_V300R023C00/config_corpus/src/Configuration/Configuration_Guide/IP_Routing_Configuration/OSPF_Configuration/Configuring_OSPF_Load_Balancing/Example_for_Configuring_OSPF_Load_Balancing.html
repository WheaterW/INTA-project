
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring OSPF Load Balancing">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../vrp/vrp_ospf_cfg_0095.html">
<meta name="DC.Relation" scheme="URI" content="../vrp/vrp_ospf_cfg_0042.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="OSPF">
<meta name="featuretype" content="IP Routing">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="OSPF">
<meta name="featuretype" content="IP Routing">
<meta name="featuretype" content="IP Routing">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001406663393">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="../public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="../public_sys-resources/browseVersion.js"></script>
<link rel="stylesheet" type="text/css" href="../public_sys-resources/imagePopup.css">
<script language="javascript" type="text/javascript" src="../public_sys-resources/customQuery.js"></script>
<script language="javascript" type="text/javascript" src="../public_sys-resources/imagePopup.js"></script>
<title>Example for Configuring OSPF Load Balancing</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001406663393"></a><a name="EN-US_TASK_0000001406663393"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring OSPF Load Balancing</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001406663393__1.3.1"></a><a name="1.3.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>As shown in <a href="vrp_ospf_cfg_0220.html">Example for Configuring OSPF Load Balancing</a>:</p>
<ul><li><p><span class="keyword">Device</span>A, <span class="keyword">Device</span>B, <span class="keyword">Device</span>C, <span class="keyword">Device</span>D, and <span class="keyword">Device</span>E run OSPF to implement IP network interworking.</p>
</li><li><p><span class="keyword">Device</span>A, <span class="keyword">Device</span>B, <span class="keyword">Device</span>C, <span class="keyword">Device</span>D, and <span class="keyword">Device</span>E belong to area 0.</p>
</li><li><p>Load balancing needs to be configured so that the traffic of <span class="keyword">Device</span>A can be sent to <span class="keyword">Device</span>E through <span class="keyword">Device</span>C and <span class="keyword">Device</span>D.</p>
</li></ul>
<div class="fignone"><span class="figcap"><b>Figure 1 </b>Configuring OSPF load balancing</span><div class="note"><img src="../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface1, interface2, interface3, and interface4 represent <span>100GE</span> <span>1/0/1</span>, <span>100GE</span> <span>1/0/2</span>, <span>100GE</span> <span>1/0/3</span>, and <span>100GE</span> <span>1/0/4</span>, respectively.</p>
</div></div>
<br><span><img class="imgResize" src="figure/en-us_image_0000001406664541.png" width="523.6875" height="287.096859" title="Click to enlarge"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001406663393__1.3.2"></a><a name="1.3.2"></a>
<div class="p"><h4 class="sectiontitle">Precautions</h4><p>To improve security, OSPF area authentication or interface authentication is recommended. For details, see "Improving OSPF Network Security." OSPF area authentication is used as an example. For details, see "Example for Configuring Basic OSPF Functions."</p>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001406663393__1.3.3"></a><a name="1.3.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure basic OSPF functions on each device to ensure routing reachability.</p>
</li><li><p># Configure load balancing on <span class="keyword">Device</span>A.</p>
</li><li><p>Set a weight for the next hop of each equal-cost route on <span class="keyword">Device</span>A.</p>
</li><li><p>Configure per-packet load balancing on <span class="keyword">Device</span>A.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001406663393__1.3.4"></a><a name="1.3.4"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>Data of <span class="keyword">Device</span>A, including the router ID (1.1.1.1), OSPF process ID (1), and network segments of area 0 (10.1.1.0/24, 10.1.2.0/24, and 10.1.3.0/24)</p>
</li><li><p>Data of <span class="keyword">Device</span>B, including the router ID (2.2.2.2), OSPF process ID (1), and network segments of area 0 (10.1.1.0/24 and 192.168.0.0/24)</p>
</li><li><p>Data of <span class="keyword">Device</span>C, including the router ID (3.3.3.3), OSPF process ID (1), and network segments of area 0 (10.1.2.0/24 and 192.168.1.0/24)</p>
</li><li><p>Data of <span class="keyword">Device</span>D, including the router ID (4.4.4.4), OSPF process ID (1), and network segments of area 0 (10.1.3.0/24 and 192.168.2.0/24)</p>
</li><li><p>Data of <span class="keyword">Device</span>E, including the router ID (5.5.5.5), OSPF process ID (1), and network segments of area 0 (192.168.0.0/24, 192.168.1.0/24, 192.168.2.0/24, and 172.17.1.0/24)</p>
</li><li><p>Number of routes for load balancing on <span class="keyword">Device</span>A: 2</p>
</li><li><p>Next hop weights of the routes from <span class="keyword">Device</span>A to <span class="keyword">Device</span>B, <span class="keyword">Device</span>C, and <span class="keyword">Device</span>D (2, 1, and 1, respectively)</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001406663393__1.3.5"></a><a name="1.3.5"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Assign an IP address to each interface. For detailed configurations, see Configuration Scripts.</span></li><li><span>Configure basic OSPF functions. For details, see <a href="vrp_ospf_cfg_0018.html">Example for Configuring Basic OSPF Functions</a>.</span></li><li><span>Check the routing table of <span class="keyword">Device</span>A.</span><p><p>The default maximum number of equal-cost routes is greater than 3. Therefore, <span class="keyword">Device</span>A has three valid next hops: <span class="keyword">Device</span>B (10.1.1.2), <span class="keyword">Device</span>C (10.1.2.2), and <span class="keyword">Device</span>D (10.1.3.2).</p>
</p><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>display ip routing-table</strong>
<span class="keyword">Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route</span>
----------------------------------------------------------------------------
Routing Table: _public_
         Destinations : 15       Routes : 15

Destination/Mask    Proto  Pre  Cost  Flags     NextHop         Interface

       10.1.1.0/24  Direct 0    0       D        10.1.1.1         <span>100GE</span><span>1/0/1</span>
       10.1.1.1/32  Direct 0    0       D        127.0.0.1        <span>100GE</span><span>1/0/1</span>
       10.1.1.2/32  Direct 0    0       D        10.1.1.2         <span>100GE</span><span>1/0/1</span>
       10.1.2.0/24  Direct 0    0       D        10.1.2.1         <span>100GE</span><span>1/0/2</span>
       10.1.2.1/32  Direct 0    0       D        127.0.0.1        <span>100GE</span><span>1/0/2</span>
       10.1.2.2/32  Direct 0    0       D        10.1.2.2         <span>100GE</span><span>1/0/2</span>
       10.1.3.0/24  Direct 0    0       D        10.1.2.1         <span>100GE</span><span>1/0/3</span>
       10.1.3.1/32  Direct 0    0       D        127.0.0.1        <span>100GE</span><span>1/0/3</span>
       10.1.3.2/32  Direct 0    0       D        10.1.2.2         <span>100GE</span><span>1/0/3</span>
    127.0.0.0/8     Direct 0    0       D        127.0.0.1        InLoopBack0
    127.0.0.1/32    Direct 0    0       D        127.0.0.1        InLoopBack0
    192.168.0.0/24  OSPF   10   2       D        10.1.1.2         <span>100GE</span><span>1/0/1</span>
    192.168.1.0/24  OSPF   10   2       D        10.1.2.2        <span>100GE</span><span>1/0/2</span>
    192.168.2.0/24  OSPF   10   2       D        10.1.2.2         <span>100GE</span><span>1/0/3</span>
<strong>     172.17.1.0/24  OSPF   10   3       D        10.1.1.2         <span>100GE</span><span>1/0/1</span></strong>
<strong>                    OSPF   10   3       D        10.1.2.2         <span>100GE</span><span>1/0/2</span></strong>
<strong>                    OSPF   10   3       D        10.1.3.2         <span>100GE</span><span>1/0/3</span></strong></pre>
</p></li><li><span>Set the maximum number of routes for load balancing to 2 on <span class="keyword">Device</span>A.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>ospf 1</strong>
[<span class="keyword">*</span>DeviceA-ospf-1] <strong>maximum load-balancing 2</strong>
[<span class="keyword">*</span>DeviceA-ospf-1] <strong>quit</strong>
<span>[<span class="keyword">*</span>DeviceA] <strong>commit</strong></span></pre>
</p><p><p># Check the routing table of <span class="keyword">Device</span>A. The command output shows that <span class="keyword">Device</span>A has two routes for load balancing. The maximum number of equal-cost routes is set to 2. Therefore, the next hops 10.1.1.2 (<span class="keyword">Device</span>B) and 10.1.2.2 (<span class="keyword">Device</span>C) are valid.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>display ip routing-table</strong>
<span class="keyword">Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route</span>
----------------------------------------------------------------------------
Routing Table: _public_
         Destinations : 15       Routes : 15

Destination/Mask    Proto  Pre  Cost  Flags     NextHop         Interface

       10.1.1.0/24  Direct 0    0       D        10.1.1.1         <span>100GE</span><span>1/0/1</span>
       10.1.1.1/32  Direct 0    0       D        127.0.0.1        <span>100GE</span><span>1/0/1</span>
       10.1.1.2/32  Direct 0    0       D        10.1.1.2         <span>100GE</span><span>1/0/1</span>
       10.1.2.0/24  Direct 0    0       D        10.1.2.1         <span>100GE</span><span>1/0/2</span>
       10.1.2.1/32  Direct 0    0       D        127.0.0.1        <span>100GE</span><span>1/0/2</span>
       10.1.2.2/32  Direct 0    0       D        10.1.2.2         <span>100GE</span><span>1/0/2</span>
       10.1.3.0/24  Direct 0    0       D        10.1.2.1         <span>100GE</span><span>1/0/3</span>
       10.1.3.1/32  Direct 0    0       D        127.0.0.1        <span>100GE</span><span>1/0/3</span>
       10.1.3.2/32  Direct 0    0       D        10.1.2.2         <span>100GE</span><span>1/0/3</span>
    127.0.0.0/8     Direct 0    0       D        127.0.0.1        InLoopBack0
    127.0.0.1/32    Direct 0    0       D        127.0.0.1        InLoopBack0
    192.168.0.0/24  OSPF   10   2       D        10.1.1.2         <span>100GE</span><span>1/0/1</span>
    192.168.1.0/24  OSPF   10   2       D        10.1.2.2         <span>100GE</span><span>1/0/2</span>
    192.168.2.0/24  OSPF   10   2       D        10.1.2.2         <span>100GE</span><span>1/0/3</span>
<strong>     172.17.1.0/24  OSPF   10   3       D        10.1.1.2         <span>100GE</span><span>1/0/1</span></strong>
<strong>                    OSPF   10   3       D        10.1.2.2         <span>100GE</span><span>1/0/2</span></strong></pre>
<p></p>
</p></li><li><span>Set a weight for the next hop of each equal-cost route on <span class="keyword">Device</span>A.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>ospf 1</strong>
[<span class="keyword">*</span>DeviceA-ospf-1] <strong>nexthop 10.1.1.2 weight 2</strong>
[<span class="keyword">*</span>DeviceA-ospf-1] <strong>nexthop 10.1.2.2 weight 1</strong>
[<span class="keyword">*</span>DeviceA-ospf-1] <strong>nexthop 10.1.3.2 weight 1</strong>
[<span class="keyword">*</span>DeviceA-ospf-1] <strong>quit</strong>
<span>[<span class="keyword">*</span>DeviceA] <strong>commit</strong></span></pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001406663393__1.3.6"></a><a name="1.3.6"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p># Check information about the routing table on <span class="keyword">Device</span>A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>display ip routing-table</strong>
<span class="keyword">Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route</span>
----------------------------------------------------------------------------
Routing Table: _public_
         Destinations : 15       Routes : 15

Destination/Mask    Proto  Pre  Cost  Flags     NextHop         Interface

       10.1.1.0/24  Direct 0    0       D        10.1.1.1         <span>100GE</span><span>1/0/1</span>
       10.1.1.1/32  Direct 0    0       D        127.0.0.1        <span>100GE</span><span>1/0/1</span>
       10.1.1.2/32  Direct 0    0       D        10.1.1.2         <span>100GE</span><span>1/0/1</span>
       10.1.2.0/24  Direct 0    0       D        10.1.2.1         <span>100GE</span><span>1/0/2</span>
       10.1.2.1/32  Direct 0    0       D        127.0.0.1        <span>100GE</span><span>1/0/2</span>
       10.1.2.2/32  Direct 0    0       D        10.1.2.2         <span>100GE</span><span>1/0/2</span>
       10.1.3.0/24  Direct 0    0       D        10.1.2.1         <span>100GE</span><span>1/0/3</span>
       10.1.3.1/32  Direct 0    0       D        127.0.0.1        <span>100GE</span><span>1/0/3</span>
       10.1.3.2/32  Direct 0    0       D        10.1.2.2         <span>100GE</span><span>1/0/3</span>
    127.0.0.0/8     Direct 0    0       D        127.0.0.1        InLoopBack0
    127.0.0.1/32    Direct 0    0       D        127.0.0.1        InLoopBack0
    192.168.0.0/24  OSPF   10   2       D        10.1.1.2         <span>100GE</span><span>1/0/1</span>
    192.168.1.0/24  OSPF   10   2       D        10.1.2.2         <span>100GE</span><span>1/0/2</span>
    192.168.2.0/24  OSPF   10   2       D        10.1.2.2         <span>100GE</span><span>1/0/3</span>
<strong>     172.17.1.0/24  OSPF   10   3       D        10.1.2.2         <span>100GE</span><span>1/0/2</span></strong>
<strong>                    </strong><strong>OSPF   10   3       D        10.1.3.2         <span>100GE</span><span>1/0/3</span></strong></pre>
<p>As shown in the routing table, as the priorities of the routes with next hop addresses 10.1.2.2 and 10.1.3.2 are higher than that of the route with next hop address 10.1.1.2, <span class="keyword">Device</span>A has only two valid next hops: 10.1.2.2 (<span class="keyword">Device</span>C) and 10.1.3.2 (<span class="keyword">Device</span>D).</p>
</div>
<div class="postreq"><a name="EN-US_TASK_0000001406663393__1.3.7"></a><a name="1.3.7"></a><h4 class="sectiontitle">Configuration Scripts</h4><ul><li><p>DeviceA</p>
<pre class="screen">#
sysname DeviceA
#
router id 1.1.1.1
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 10.1.1.1 255.255.255.0
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ip address 10.1.2.1 255.255.255.0
#
interface <span>100GE</span><span>1/0/3</span>
 undo portswitch
 ip address 10.1.3.1 255.255.255.0
#
ospf 1
 maximum load-balancing 2
 nexthop 10.1.1.2 weight 2
 nexthop 10.1.2.2 weight 1
 nexthop 10.1.3.2 weight 1
 area 0.0.0.0
  network 10.1.1.0 0.0.0.255
  network 10.1.2.0 0.0.0.255
  network 10.1.3.0 0.0.0.255
#
return</pre>
</li><li><p>DeviceB</p>
<pre class="screen">#
sysname DeviceB
#
router id 2.2.2.2
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 10.1.1.2 255.255.255.0
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ip address 192.168.0.1 255.255.255.0
#
ospf 1
 area 0.0.0.0
  network 10.1.1.0 0.0.0.255
  network 192.168.0.0 0.0.255.255
#
return</pre>
</li><li><p>DeviceC</p>
<pre class="screen">#
sysname DeviceC
#
router id 3.3.3.3
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 10.1.2.2 255.255.255.0
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ip address 192.168.1.1 255.255.255.0
#
ospf 1
 area 0.0.0.0
  network 10.1.2.0 0.0.0.255
  network 192.168.1.0 0.0.0.255
#
return</pre>
</li><li><p>DeviceD</p>
<pre class="screen">#
sysname DeviceD
#
router id 4.4.4.4
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 10.1.3.2 255.255.255.0
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ip address 192.168.2.1 255.255.255.0
#
ospf 1
 area 0.0.0.0
  network 10.1.3.0 0.0.0.255
  network 192.168.2.0 0.0.0.255
#
return</pre>
</li><li><p>DeviceE</p>
<pre class="screen">#
sysname DeviceE
#
router id 5.5.5.5
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 192.168.0.2 255.255.255.0
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ip address 192.168.1.2 255.255.255.0
#
interface <span>100GE</span><span>1/0/3</span>
 undo portswitch
 ip address 192.168.2.2 255.255.255.0
#
interface <span>100GE</span><span>1/0/4</span>
 undo portswitch
 ip address 172.17.1.1 255.255.255.0
#
ospf 1
 area 0.0.0.0
  network 192.168.0.0 0.0.255.255
  network 192.168.1.0 0.0.0.255
  network 192.168.2.0 0.0.0.255
  network 172.17.1.0 0.0.0.255
#
return</pre>
</li></ul>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../vrp/vrp_ospf_cfg_0095.html">Configuring OSPF Load Balancing
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../vrp/vrp_ospf_cfg_0042.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>

<script language="JavaScript">
<!--
initImageViewer('.imgResize');
var msg_imageMax = "view original image";
var msg_imageClose = "close";
//--></script></body>
</html>