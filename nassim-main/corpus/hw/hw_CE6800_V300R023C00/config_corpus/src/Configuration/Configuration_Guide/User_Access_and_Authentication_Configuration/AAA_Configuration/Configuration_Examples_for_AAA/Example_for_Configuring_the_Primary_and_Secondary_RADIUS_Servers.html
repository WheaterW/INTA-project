
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring the Primary and Secondary RADIUS Servers">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="galaxy_aaa_cfg_0056.html">
<meta name="DC.Relation" scheme="URI" content="toctopics/en-us_task_0000001945219498.html">
<meta name="DC.Relation" scheme="URI" content="galaxy_aaa_cfg_0061.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="AAA">
<meta name="featurename" content="RADIUS">
<meta name="featuretype" content="User Access and Authentication">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="AAA">
<meta name="featurename" content="AD">
<meta name="featurename" content="HWTACACS">
<meta name="featurename" content="LDAP">
<meta name="featurename" content="RADIUS">
<meta name="featurename" content="Local User">
<meta name="featuretype" content="User Access and Authentication">
<meta name="featurename" content="AAA">
<meta name="featurename" content="AD">
<meta name="featurename" content="HWTACACS">
<meta name="featurename" content="LDAP">
<meta name="featurename" content="RADIUS">
<meta name="featurename" content="Local User">
<meta name="featuretype" content="User Access and Authentication">
<meta name="featuretype" content="User Access and Authentication">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001564115729">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<link rel="stylesheet" type="text/css" href="public_sys-resources/imagePopup.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/customQuery.js"></script>
<script language="javascript" type="text/javascript" src="public_sys-resources/imagePopup.js"></script>
<title>Example for Configuring the Primary and Secondary RADIUS Servers</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001564115729"></a><a name="EN-US_TASK_0000001564115729"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring the Primary and Secondary RADIUS Servers</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001564115729__1.3.1"></a><a name="1.3.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>In <a href="#EN-US_TASK_0000001564115729__fig_dc_cfg_aaa_102901">Figure 1</a>, two RADIUS servers are deployed. The enterprise requires that the two RADIUS servers back up each other to ensure user authentication if one server is faulty.</p>
<div class="fignone" id="EN-US_TASK_0000001564115729__fig_dc_cfg_aaa_102901"><a name="EN-US_TASK_0000001564115729__fig_dc_cfg_aaa_102901"></a><a name="fig_dc_cfg_aaa_102901"></a><span class="figcap"><b>Figure 1 </b>Configuring the primary and secondary RADIUS servers</span><div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface 1, interface 2 and interface 3 represent <span>100GE</span> <span>1/0/1</span>, <span>100GE</span> <span>1/0/2</span>, and <span>100GE</span> <span>1/0/3</span> respectively.</p>
</div></div>
<br><span><img class="imgResize" src="figure/en-us_image_0000001513035854.png" width="518.7" title="Click to enlarge"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001564115729__1.3.2"></a><a name="1.3.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li>Configure a RADIUS server <span>template</span>.</li><li>Configure authentication and accounting schemes.</li><li>Apply the RADIUS server <span>template</span>, authentication scheme, and accounting scheme to a domain.</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001564115729__1.3.3"></a><a name="1.3.3"></a>
<div class="p"><h4 class="sectiontitle">Precautions</h4><ul><li>Ensure that there are reachable routes between devices before the configuration.</li><li><p>Ensure that the shared key in the RADIUS server template is the same as that configured on the RADIUS server.</p>
</li><li>After the domain is set as the global default domain and the user name of a user contains the domain name or does not contain any domain name, the user uses AAA configuration in the global default domain.</li><li><p>If the RADIUS server does not support the user name containing a domain name, run the <strong>undo radius-server user-name domain-included</strong> command in the RADIUS server template view to configure the device to send packets that do not contain a domain name to the RADIUS server.</p>
</li><li>After the <strong>undo radius-server user-name domain-included</strong> command is run, the device changes only the user name format in the sent packet, without affecting the domain to which the user belongs. For example, after this command is run, the user with the user name <strong>username@huawei.com</strong> still uses AAA configuration in the domain <strong>huawei.com</strong>.</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001564115729__1.3.4"></a><a name="1.3.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure IP addresses for interfaces.</span><p><pre class="screen">&lt;HUAWEI&gt; <strong>system-view</strong> 
[<font style="font-size:8pt" Face="Courier New" >~</font>HUAWEI] <strong>sysname DeviceA</strong> 
[*<span class="keyword">DeviceA</span>] <strong>commit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font><span class="keyword">DeviceA</span>] <strong>vlan batch 10 20 30</strong>
[*DeviceA] <strong>interface <span>100ge</span> </strong><strong><span>1/0/1</span></strong>
[*DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>portswitch</strong>
[*DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>port link-type trunk</strong>
[*DeviceA-<span>100GE</span><span>1/0/1</span>]<strong> port trunk allow-pass vlan 10</strong>
[*DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>quit</strong>
[*DeviceA] <strong>interface <span>100ge</span> </strong><strong><span>1/0/2</span></strong>
[*DeviceA-<span>100GE</span><span>1/0/2</span>] <strong>portswitch</strong>
[*DeviceA-<span>100GE</span><span>1/0/2</span>] <strong>port link-type trunk</strong>
[*DeviceA-<span>100GE</span><span>1/0/2</span>]<strong> port trunk allow-pass vlan 20</strong>
[*DeviceA-<span>100GE</span><span>1/0/2</span>] <strong>quit</strong>
[*DeviceA] <strong>interface <span>100ge</span> </strong><strong><span>1/0/3</span></strong>
[*DeviceA-<span>100GE</span><span>1/0/3</span>] <strong>portswitch</strong>
[*DeviceA-<span>100GE</span><span>1/0/3</span>] <strong>port link-type trunk</strong>
[*DeviceA-<span>100GE</span><span>1/0/3</span>]<strong> port trunk allow-pass vlan 30</strong>
[*DeviceA-<span>100GE</span><span>1/0/3</span>] <strong>quit</strong>
[*DeviceA] <strong>interface </strong><strong>vlanif 10</strong>
[*DeviceA-Vlanif10] <strong>ip address 10.1.1.2 255.255.255.0</strong>
[*DeviceA-Vlanif10] <strong>quit</strong>
[*DeviceA] <strong>interface </strong><strong>vlanif 20</strong>
[*DeviceA-Vlanif20] <strong>ip address 10.1.6.2 255.255.255.0</strong>
[*DeviceA-Vlanif20] <strong>quit</strong>
[*DeviceA] <strong>interface </strong><strong>vlanif 30</strong>
[*DeviceA-Vlanif30] <strong>ip address </strong><strong>10.1.5.2 255.255.255.0</strong>
[*DeviceA-Vlanif30] <strong>quit</strong>
[*<span class="keyword">DeviceA</span>] <strong>commit</strong></pre>
</p></li><li><span>Configure a RADIUS server <span>template</span>.</span><p><p># Configure a RADIUS <span>template</span> named <strong>shiva</strong>.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>radius-server template shiva</strong></pre>
<p># Configure IP addresses and port numbers for the primary RADIUS authentication and accounting server.</p>
<pre class="screen">[<span class="keyword"><span class="keyword">*</span>DeviceA</span>-radius-shiva] <strong>radius-server authentication 10.7.66.66 1812 weight 80</strong>
[<span class="keyword"><span class="keyword">*</span>DeviceA</span>-radius-shiva] <strong>radius-server accounting 10.7.66.66 1813 weight 80</strong></pre>
<p># Configure IP addresses and port numbers for the secondary RADIUS authentication and accounting server.</p>
<pre class="screen">[<span class="keyword"><span class="keyword">*</span>DeviceA</span>-radius-shiva] <strong>radius-server authentication 10.7.66.67 1812 weight 40</strong>
[<span class="keyword"><span class="keyword">*</span>DeviceA</span>-radius-shiva] <strong>radius-server accounting 10.7.66.67 1813 weight 40</strong></pre>
<p># Set the shared key and maximum number of retransmissions for the RADIUS server, and configure the device not to encapsulate the domain name in the user name when sending RADIUS packets to the RADIUS server.</p>
<pre class="screen">[<span class="keyword"><span class="keyword">*</span>DeviceA</span>-radius-shiva] <strong>radius-server shared-key cipher YsHsjx_202206139</strong>
[<span class="keyword">*</span><span class="keyword">DeviceA</span>-radius-shiva] <strong>radius-server retransmit 2</strong>
<span>[<span class="keyword"><span class="keyword">*</span>DeviceA</span>-radius-shiva] <strong>undo radius-server user-name domain-included</strong></span>
[<span class="keyword">*</span><span class="keyword">DeviceA</span>-radius-shiva] <strong>quit</strong>
[<span class="keyword">*DeviceA</span>] <strong>commit</strong></pre>
</p></li><li><span>Configure authentication and accounting schemes.</span><p><p># Create an authentication scheme named <strong>auth</strong><span> and set the authentication mode to RADIUS and local authentication</span>.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>aaa</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA-aaa] <strong>authentication-scheme auth</strong>
[<span class="keyword"><span class="keyword">*</span>DeviceA</span>-aaa-authen-auth] <strong>authentication-mode radius </strong><strong>local</strong>
[<span class="keyword">*</span><span class="keyword">DeviceA</span>-aaa-authen-auth] <strong>quit</strong></pre>
<p># Create an accounting scheme named <strong>abc</strong>, and set the accounting mode to RADIUS accounting.<span> Configure a policy for the device to keep users online upon accounting-start failures.</span></p>
<pre class="screen">[<span class="keyword"><span class="keyword">*</span>DeviceA</span>-aaa] <strong>accounting-scheme abc</strong>
[<span class="keyword"><span class="keyword">*</span>DeviceA</span>-aaa-accounting-abc] <strong>accounting-mode radius</strong>
<span>[<span class="keyword"><span class="keyword">*</span>DeviceA</span>-aaa-accounting-abc] <strong>accounting start-fail online</strong> </span>
[<span class="keyword"><span class="keyword">*</span>DeviceA</span>-aaa-accounting-abc] <strong>quit</strong></pre>
</p></li><li><span>Create the domain <strong>huawei</strong>, and apply the authentication scheme <strong>auth</strong>, accounting scheme <strong>abc</strong>, and RADIUS server <span>template</span> <strong>shiva</strong> to the domain.</span><p><pre class="screen">[<span class="keyword">*</span><span class="keyword">DeviceA</span>-aaa] <strong>domain huawei</strong>
[<span class="keyword">*</span><span class="keyword">DeviceA</span>-aaa-domain-huawei] <strong>authentication-scheme auth</strong>
[<span class="keyword"><span class="keyword">*</span>DeviceA</span>-aaa-domain-huawei] <strong>accounting-scheme abc</strong>
[<span class="keyword"><span class="keyword">*</span>DeviceA</span>-aaa-domain-huawei] <strong>radius-server shiva</strong>
[<span class="keyword"><span class="keyword">*</span>DeviceA</span>-aaa-domain-huawei] <strong>quit</strong>
[<span class="keyword">*</span><span class="keyword">DeviceA</span>-aaa] <strong>quit</strong>
[<span class="keyword">*DeviceA</span>] <strong>commit</strong></pre>
</p></li><li><span>Set the domain <strong>huawei</strong> as the global default administrative domain.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>domain huawei admin</strong>
[<span class="keyword">*DeviceA</span>] <strong>commit</strong></pre>
</p></li><li><span>Configure AAA local authentication. Set the local user name to <strong>user1-huawei</strong>, password to <strong>YsHsjx_202206</strong>, and privilege level to 3.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>aaa</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA-aaa] <strong>local-user user1-huawei password irreversible-cipher </strong><strong>YsHsjx_202206</strong>
[<span class="keyword">*</span>DeviceA-aaa] <strong>local-user user1-huawei service-type ssh</strong>
[<span class="keyword">*</span>DeviceA-aaa] <strong>local-user user1-huawei privilege level 3</strong>
[<span class="keyword">*</span>DeviceA-aaa] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>commit</strong></pre>
</p></li></ol></div>
<div class="postreq"><a name="EN-US_TASK_0000001564115729__1.3.5"></a><a name="1.3.5"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p>Run the <strong>display radius-server configuration template</strong> template-name command on DeviceA to check the RADIUS server template configuration.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">DeviceA</span>] <strong>display radius-server configuration template shiva</strong>
  ------------------------------------------------------------------------------
  Server-template-name          :  shiva
  Server-template-index         :  14                                      
  Protocol-version              :  standard
  Traffic-unit                  :  B
  Shared-secret-key             :  ****************
  Group-filter                  :  class  
  Timeout-interval(in second)   :  5
  Retransmission                :  2
  EndPacketSendTime             :  0
  Dead time(in minute)          :  5
  Domain-included               :  NO
  NAS-IP-Address                :  0.0.0.0
  Calling-station-id MAC-format :  xxxx-xxxx-xxxx
  Called-station-id MAC-format  :  XX-XX-XX-XX-XX-XX
<span>  NAS-Port-ID format            :  New </span>
  Service-type                  :  - 
<span>  NAS-IPv6-Address              :  ::</span>
  Server algorithm              :  master-backup           
  Detect-interval(in second)    :  60     
  Detect up-server(in second)   :  0              
  Detect timeout(in second)     :  3                               
  Chargeable-user-identity      :  Not Support             
  CUI Not reject                :  No               
  Force framed-ip-addr Attr     :  No 
  Detect-interval(in second)    :  60 
  Authentication Server 1       :  10.7.66.66     Port:1812  Weight:80  <span>[up]</span>
                                   Vrf:- 
                                   Source Interface:NULL                        
                                   Source IP: ::
                                   Shared-key: -
                                   Down time left: -
  Authentication Server 2       :  10.7.66.67     Port:1812  Weight:40  <span>[<span>up</span>]</span>
                                   Vrf:- 
                                   Source Interface:NULL                        
                                   Source IP: ::
                                   Shared-key: -
                                   Down time left: -
  Accounting Server     1       :  10.7.66.66     Port:1813  Weight:80  <span>[<span>up</span>]</span>
                                   Vrf:- 
                                   Source Interface:NULL                        
                                   Source IP: ::
                                   Shared-key: -
                                   Down time left: -
  Accounting Server     2       :  10.7.66.67     Port:1813  Weight:40  <span>[<span>up</span>]</span>
                                   Vrf:- 
                                   Source Interface:NULL                        
                                   Source IP: ::
                                   Shared-key: -
                                   Down time left: -
  ------------------------------------------------------------------------------ </pre>
<h4 class="sectiontitle">Configuration Scripts</h4><p><span class="keyword">DeviceA</span></p>
<pre class="screen">#
sysname <span class="keyword">DeviceA</span>
#
radius-server template shiva
 radius-server shared-key cipher %+%##!!!!!!!!!"!!!!"!!!!*!!!!SKvr${[Fs.3t@/5k|BENhEu&gt;W(3\<font style="font-size:8pt" Face="Courier New" >~</font>XG!!D;!!!!!2jp5!!!!!!A!!!!3"pK8qv!}9M#(4$jGWvQF/R[CNe/+:W^jk8HUe&amp;W%+%#
 radius-server authentication 10.7.66.66 1812 <span>weight 80</span>
 radius-server authentication 10.7.66.67 1812 <span>weight 40</span>
 radius-server accounting 10.7.66.66 1813 <span>weight 80</span>
 radius-server accounting 10.7.66.67 1813 <span>weight 40</span>
 radius-server retransmit 2
 <span>undo radius-server user-name domain-included </span>
#
aaa
 authentication-scheme auth
  authentication-mode radius local
 accounting-scheme abc
  accounting-mode radius
 domain huawei
  authentication-scheme auth
  accounting-scheme abc
  radius-server shiva
 local-user user1-huawei password irreversible-cipher $1d$OwseVRh@LH}ZeTBm$1nH4$ab&gt;d(N{-%0!ab48y=Ic*xEUR4pVhR2"9-<font style="font-size:8pt" Face="Courier New" >~</font>,$
 local-user user1-huawei privilege level 3
 local-user user1-huawei service-type ssh   
#
domain huawei admin
# 
vlan batch 10 20 30
#
interface Vlanif10
 ip address 10.1.1.2 255.255.255.0
#
interface Vlanif20
 ip address 10.1.6.2 255.255.255.0
#
interface Vlanif30
 ip address 10.1.5.2 255.255.255.0
#
interface <span>100GE</span><span>1/0/1</span> 
 port link-type trunk
 port trunk allow-pass vlan 10
#
interface <span>100GE</span><span>1/0/2</span> 
 port link-type trunk
 port trunk allow-pass vlan 20
#
interface <span>100GE</span><span>1/0/3</span> 
 port link-type trunk
 port trunk allow-pass vlan 30
#
return</pre>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="galaxy_aaa_cfg_0056.html">Configuration Examples for AAA
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="toctopics/en-us_task_0000001945219498.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="galaxy_aaa_cfg_0061.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>

<script language="JavaScript">
<!--
initImageViewer('.imgResize');
var msg_imageMax = "view original image";
var msg_imageClose = "close";
//--></script></body>
</html>