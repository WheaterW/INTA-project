
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Dynamic Subscription (IPv4 Collector)">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="galaxy_telemetry_cfg_0014_c.html">
<meta name="DC.Relation" scheme="URI" content="galaxy_telemetry_cfg_0016_c.html">
<meta name="DC.Relation" scheme="URI" content="galaxy_telemetry_cfg_0018_c.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="Telemetry">
<meta name="featuretype" content="System Monitoring">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="Telemetry">
<meta name="featuretype" content="System Monitoring">
<meta name="featurename" content="Telemetry">
<meta name="featuretype" content="System Monitoring">
<meta name="featurename" content="Telemetry">
<meta name="featuretype" content="System Monitoring">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001513154194">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring Dynamic Subscription (IPv4 Collector)</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001513154194"></a><a name="EN-US_TASK_0000001513154194"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Dynamic Subscription (IPv4 Collector)</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001513154194__1.3.1"></a><a name="1.3.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>As the network scale increases, you need to optimize networks and rectify faults based on device information in a timely manner. For example, if you want to monitor an interface for a period of time, configure dynamic telemetry subscription. To stop monitoring, tear down the connection. The subscription is then automatically canceled and cannot be restored. This mitigates loads on devices and simplifies the interaction between you and devices.</p>
<p>As shown in <a href="#EN-US_TASK_0000001513154194__en-us_task_0275777959_fig117736513266">Figure 1</a>, DeviceA supports telemetry and establishes a gRPC connection with the collector<span></span>. <span>Interface 1</span> of DeviceA needs to be monitored, and related data needs to be reported to the collector<span></span>.</p>
<div class="fignone" id="EN-US_TASK_0000001513154194__en-us_task_0275777959_fig117736513266"><a name="EN-US_TASK_0000001513154194__en-us_task_0275777959_fig117736513266"></a><a name="en-us_task_0275777959_fig117736513266"></a><span class="figcap"><b>Figure 1 </b>Network diagram of configuring gRPC-based dynamic subscription</span><div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface 1 represents <span>100GE</span> <span>1/0/1</span>.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0000001563874229.png" width="NaN" height="NaN"></span></div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001513154194__1.3.2"></a><a name="1.3.2"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure an SSL policy.</span><p><p id="EN-US_TASK_0000001513154194__en-us_task_0000001564006065_p67222495322"># Upload the obtained digital certificate to the <strong id="EN-US_TASK_0000001513154194__en-us_task_0000001564006065_b188121373137">/pki/public</strong> directory of the device through SFTP. For details about how to apply for a digital certificate in PKI mode, see <span>Configuration Guide</span> &gt; PKI Configuration.</p>
<p id="EN-US_TASK_0000001513154194__en-us_task_0000001564006065_p118431819195916"># Configure a PKI realm and import the local certificate and private key file.</p>
<pre class="screen" id="EN-US_TASK_0000001513154194__en-us_task_0000001564006065_screen27719172610">
[<span class="keyword" id="EN-US_TASK_0000001513154194__en-us_task_0000001564006065_keyword13131639182612"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong id="EN-US_TASK_0000001513154194__en-us_task_0000001564006065_b1914645211267">pki realm domain1</strong>
[<span class="keyword" id="EN-US_TASK_0000001513154194__en-us_task_0000001564006065_keyword0131039122615">*</span>DeviceA-pki-realm-domain1] <strong id="EN-US_TASK_0000001513154194__en-us_task_0000001564006065_b1213193914265">commit</strong>
[<span class="keyword" id="EN-US_TASK_0000001513154194__en-us_task_0000001564006065_keyword10502753172712"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA-pki-realm-domain1]<strong id="EN-US_TASK_0000001513154194__en-us_task_0000001564006065_b155022053112715"> quit</strong>
[<span class="keyword" id="EN-US_TASK_0000001513154194__en-us_task_0000001564006065_keyword177021231172713"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong id="EN-US_TASK_0000001513154194__en-us_task_0000001564006065_b18184302810">pki import-certificate local realm domain1 pem filename restconf_local.pem</strong>
[<span class="keyword" id="EN-US_TASK_0000001513154194__en-us_task_0000001564006065_keyword9100120867"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong id="EN-US_TASK_0000001513154194__en-us_task_0000001564006065_b610000960">pki import rsa-key-pair restconf-key pem restconf.pem</strong> //Skip this step if the private key file is generated on the local device.</pre>
<p id="EN-US_TASK_0000001513154194__en-us_task_0000001564006065_p119072265250"># Import the CA certificate of the peer collector to verify the validity of the local certificate for the collector.</p>
<pre class="screen" id="EN-US_TASK_0000001513154194__en-us_task_0000001564006065_screen396611120265">[<span class="keyword" id="EN-US_TASK_0000001513154194__en-us_task_0000001564006065_keyword125321713132612"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong id="EN-US_TASK_0000001513154194__en-us_task_0000001564006065_b653351313264">pki import-certificate ca realm domain1 pem filename restconf_ca.pem</strong></pre>
<p id="EN-US_TASK_0000001513154194__en-us_task_0000001564006065_p1194811111431"># Configure an SSL policy and bind it to the PKI realm.</p>
</p><p><pre class="screen" id="EN-US_TASK_0000001513154194__en-us_task_0000001564006065_screen131171871587">[<span class="keyword" id="EN-US_TASK_0000001513154194__en-us_task_0000001564006065_keyword1066452319582"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong id="EN-US_TASK_0000001513154194__en-us_task_0000001564006065_b142081814161110">ssl policy policy1</strong>
[<span class="keyword" id="EN-US_TASK_0000001513154194__en-us_task_0000001564006065_keyword526942712523">*</span>DeviceA-ssl-policy-policy1] <strong id="EN-US_TASK_0000001513154194__en-us_task_0000001564006065_b792118472182">pki-domain <strong id="EN-US_TASK_0000001513154194__en-us_task_0000001564006065_b17158558111113">domain1</strong></strong>
[<span class="keyword" id="EN-US_TASK_0000001513154194__en-us_task_0000001564006065_keyword118039507814">*</span>DeviceA-ssl-policy-policy1] <strong id="EN-US_TASK_0000001513154194__en-us_task_0000001564006065_b203691118171115">commit</strong>
[<span class="keyword" id="EN-US_TASK_0000001513154194__en-us_task_0000001564006065_keyword133962016445"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA-ssl-policy-policy1] <strong id="EN-US_TASK_0000001513154194__en-us_task_0000001564006065_b1296122020116">quit</strong></pre>
</p></li><li><span>Configure AAA authentication.</span><p><pre class="screen" id="EN-US_TASK_0000001513154194__en-us_task_0000001564006065_screen4598109387">[<span class="keyword" id="EN-US_TASK_0000001513154194__en-us_task_0000001564006065_keyword790418895818"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong id="EN-US_TASK_0000001513154194__en-us_task_0000001564006065_b11892105386">aaa</strong>
[<span class="keyword" id="EN-US_TASK_0000001513154194__en-us_task_0000001564006065_keyword178017108589"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA-aaa] <strong id="EN-US_TASK_0000001513154194__en-us_task_0000001564006065_b289141011386">local-user admin1234 password</strong>
Please configure the login password (8-128)
It is recommended that the password consist of four types of characters, including lowercase letters, uppercase letters, numerals and special characters. 
Please enter password:                                      
Please confirm password:                               
[<span class="keyword" id="EN-US_TASK_0000001513154194__en-us_task_0000001564006065_keyword2154151915813">*</span>DeviceA-aaa] <strong id="EN-US_TASK_0000001513154194__en-us_task_0000001564006065_b1489910123817">local-user admin1234 service-type http</strong>
[<span class="keyword" id="EN-US_TASK_0000001513154194__en-us_task_0000001564006065_keyword14824181925819">*</span>DeviceA-aaa] <strong id="EN-US_TASK_0000001513154194__en-us_task_0000001564006065_b1389121063819">local-user admin1234 user-group manage-ug</strong>
[<span class="keyword" id="EN-US_TASK_0000001513154194__en-us_task_0000001564006065_keyword189571209584">*</span>DeviceA-aaa]<strong id="EN-US_TASK_0000001513154194__en-us_task_0000001564006065_b158951063819"> quit</strong>
[<span class="keyword" id="EN-US_TASK_0000001513154194__en-us_task_0000001564006065_keyword1726517221586">*</span>DeviceA] <strong id="EN-US_TASK_0000001513154194__en-us_task_0000001564006065_b195493312421">commit</strong></pre>
</p></li><li><span>Configure a source IP address to be listened during dynamic subscription, and bind the source IP address to a VPN instance.</span><p><p># Enable the gRPC service on <span class="keyword">Device</span>A, set the source IP address to be listened during dynamic subscription to 192.168.1.1, and bind the source IP address to the VPN instance named <strong>vpn1</strong>.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>grpc</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-grpc] <strong>grpc server</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-grpc-server] <strong>source-ip 192.168.1.1 vpn-instance vpn1</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-grpc-server] <strong>commit</strong></pre>
</p></li><li><span>Configure the number of the port to be listened during dynamic subscription.</span><p><p># Configure port 20000 to be listened during dynamic subscription.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-gRPC-server] <strong>server-port 20000</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-gRPC-server] <strong>commit</strong></pre>
</p></li><li><span>Configure an SSL policy to be bound for dynamic telemetry subscription.</span><p><p># Bind the SSL policy <strong>policy1</strong> for dynamic telemetry subscription and perform SSL verification on the <span>collector</span>.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-grpc-server] <strong>ssl-policy policy1</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-grpc-server] <strong>ssl-verify peer</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-grpc-server] <strong>commit</strong></pre>
</p></li><li><span>Enable the gRPC service.</span><p><p># Enable the gRPC service on <span class="keyword">Device</span>A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-grpc-server] <strong>server enable</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-grpc-server] <strong>commit</strong></pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001513154194__1.3.3"></a><a name="1.3.3"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p>Check dynamic subscription information after completing the preceding configuration and setting parameters such as the sampling path on the <span>collector</span>.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A]<strong> display telemetry dynamic-subscription</strong>
------------------------------------------------------------------------------
Sub-name                    :_dyn_grpc_1_8001
Sub-id                      :32769
Request-id                  :0
Sample-interval(ms)         :60000
Heartbeat-interval(s)       :-
Suppress-redundant          :false
Delay-time(ms)              :1000
Originated-qos-marking      :0
Encoding                    :GPB 
------------------------------------------------------------------------------
SampleInterval(ms)  Depth  Sensor-path
60000               1      <span>huawei-cpu-memory:cpu-memory/board-cpu-infos/board-cpu-info</span>
60000               3      <span>huawei-cpu-memory:cpu-memory/board-memory-infos/board-memory-info</span>
------------------------------------------------------------------------------
Dest-ip           Dest-port Vpn-name                        Protocol 
192.168.1.1       20000     vpn1                            GRPC     
------------------------------------------------------------------------------
Sub-state:SUCCESS 
------------------------------------------------------------------------------</pre>
<h4 class="sectiontitle">Configuration Scripts</h4><div class="p"><span class="keyword">Device</span>A<pre class="screen">#
sysname DeviceA
#
pki realm domain1
#
ssl policy policy1
 pki-domain domain1
#
aaa
 local-user admin1234 password irreversible-cipher <span>$1d$g8wLJ`LjL!$CyE(V{3qg5DdU:PM[6=6O$UF-.fQ,Q}&gt;^)OBzgoU$</span>
 local-user admin1234 service-type http
 local-user admin1234 user-group manage-ug
#
gRPC
 #
 gRPC server
  source-ip 192.168.1.1 vpn-instance vpn1
  server-port 20000
  ssl-policy policy1
  ssl-verify peer
  server enable
#
return</pre>
</div>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="galaxy_telemetry_cfg_0014_c.html">Configuring Dynamic Subscription
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="galaxy_telemetry_cfg_0016_c.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="galaxy_telemetry_cfg_0018_c.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>