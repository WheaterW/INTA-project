
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring MAC Address Flapping Detection">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="vrp_mac_cfg_0030.html">
<meta name="DC.Relation" scheme="URI" content="vrp_mac_cfg_0044.html">
<meta name="DC.Relation" scheme="URI" content="vrp_mac_cfg_0033.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="MAC">
<meta name="featuretype" content="Ethernet Switching">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="MAC">
<meta name="featuretype" content="Ethernet Switching">
<meta name="featurename" content="MAC">
<meta name="featuretype" content="Ethernet Switching">
<meta name="featuretype" content="Ethernet Switching">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001176664485">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>Configuring MAC Address Flapping Detection</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001176664485"></a><a name="EN-US_TASK_0000001176664485"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring MAC Address Flapping Detection</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001176664485__1.3.1"></a><a name="1.3.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>MAC address flapping detection enables a device to check for MAC address flapping among all MAC addresses. If MAC address flapping occurs, the device will send a trap to the NMS. In addition, you can run the <strong><a href="cmdqueryname=display+mac-address+flapping+active-table"><b><span class="cmdname">display mac-address flapping active-table</span></b></a></strong> command to view MAC address flapping records and run the <strong><a href="cmdqueryname=display+mac-address+flapping+aged-table"><b><span class="cmdname">display mac-address flapping aged-table</span></b></a></strong> command to view MAC address flapping aging records.</p>
<div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><ul><li>When MAC address flapping occurs on a device's interface, the device suppresses broadcast, unknown-unicast, and multicast (BUM) traffic, and sets the outbound forwarding rate of the interface to 1% of the inbound bandwidth of the interface. You can run the <strong>storm suppression mac-address flapping</strong> command to configure the committed information rate (CIR) for traffic suppression triggered by MAC address flapping and enable the device to forward packets based on the specified CIR. In this case, you need to check whether a loop exists on the network. Packets are not suppressed due to MAC address flapping in the following scenarios:<ul><li>Storm control or traffic suppression is configured on an interface. For example, if you run the <strong>storm suppression broadcast</strong> command to set the maximum traffic rate of broadcast packets that can pass through an interface, broadcast traffic will not be automatically suppressed if MAC address flapping occurs on the interface.</li><li>If MAC address flapping occurs on a peer-link interface, traffic suppression associated with MAC address flapping does not take effect on that interface.</li></ul>
</li></ul>
</div></div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001176664485__1.3.2"></a><a name="1.3.2"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Enter the system view.</span><p><pre class="screen"><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></pre>
</p></li><li><span>Enable global MAC address flapping detection.</span><p><pre class="screen"><a href="cmdqueryname=mac-address+flapping+detection"><b><span class="cmdname">mac-address flapping detection</span></b></a> [ <strong><span>security-level</span></strong> { <strong><span>low</span></strong> | <strong><span>middle</span></strong> | <strong><span>high</span></strong> } | <strong><span>security-threshold</span></strong> <i><span class="varname">flapCnt</span></i> ]</pre>
<p>By default, the security level of MAC address flapping detection is middle. At this level, the system considers that MAC address flapping occurs when a MAC address changes 10 times between interfaces.</p>
</p></li><li><span>(Optional) Configure a VLAN whitelist for MAC address flapping detection, that is, specify the VLANs where MAC address flapping detection is not performed.</span><p><pre class="screen"><a href="cmdqueryname=mac-address+flapping+detection+exclude+vlan"><b><span class="cmdname">mac-address flapping detection exclude vlan</span></b></a> { <em>vlan-id1</em> [ <strong>to</strong> <em>vlan-id2</em> ] } &amp;&lt;1-10&gt;</pre>
</p></li><li><span>(Optional) Exclude a MAC address from MAC address flapping detection.</span><p><pre class="screen"><a href="cmdqueryname=mac-address+flapping+detection+exclude"><b><span class="cmdname">mac-address flapping detection exclude</span></b></a> <i><span class="varname">mac-address</span></i> <i><span class="varname">mac-address-mask</span></i></pre>
</p></li><li><span>(Optional) Set an aging time for flapping MAC addresses.</span><p><pre class="screen"><a href="cmdqueryname=mac-address+flapping+aging-time"><b><span class="cmdname">mac-address flapping aging-time</span></b></a> <em>aging-time</em></pre>
<p>By default, the aging time for flapping MAC addresses is 5 minutes.</p>
</p></li><li><span>(Optional) Set the interval for sending traps if MAC address flapping occurs.</span><ol type="a"><li class="substepexpand"><span>Enable the function of periodically reporting traps if MAC address flapping occurs.</span><p><pre class="screen"><a href="cmdqueryname=mac-address+flapping+periodical+trap+enable"><b><span class="cmdname">mac-address flapping periodical trap enable</span></b></a></pre>
<p>By default, the device is disabled from periodically sending traps if MAC address flapping occurs.</p>
</p></li><li class="substepexpand"><span>Set the interval for sending traps if MAC address flapping occurs.</span><p><pre class="screen"><a href="cmdqueryname=mac-address+flapping+periodical+trap+interval"><b><span class="cmdname">mac-address flapping periodical trap interval</span></b></a> <i><span class="varname">interval</span></i></pre>
<p>By default, a device sends traps at an interval of 2 minutes if MAC address flapping occurs.</p>
</p></li></ol>
</li><li><span>(Optional) Configure the action for the device to take after MAC address flapping is detected on an interface.</span><ol type="a"><li class="substepexpand"><span>Enter the interface view.</span><p><pre class="screen"><a href="cmdqueryname=interface"><b><span class="cmdname">interface</span></b></a> <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i></pre>
</p></li><li class="substepexpand"><span>Switch the interface working mode from Layer 3 to Layer 2. Determine whether to perform this step based on the current interface working mode.</span><p><pre class="screen"><a href="cmdqueryname=portswitch"><b><span class="cmdname">portswitch</span></b></a></pre>
</p></li><li class="substepexpand"><span>Configure the interface to enter the error-down state if MAC address flapping occurs on the interface.</span><p><pre class="screen"><a href="cmdqueryname=mac-address+flapping+trigger"><b><span class="cmdname">mac-address flapping trigger</span></b></a> <strong>error-down</strong></pre>
<p>By default, an interface will not enter the error-down state when MAC address flapping occurs.</p>
</p></li></ol>
</li><li><span>Commit the configuration.</span><p><pre class="screen" id="EN-US_TASK_0000001176664485__en-us_task_0234857734_screen163801330213"><a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001176664485__en-us_task_0234857734_en-us_concept_0141113565_cmdname1667501373175340">commit</span></b></a></pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001176664485__1.3.3"></a><a name="1.3.3"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p>Run the <a href="cmdqueryname=display+mac-address+flapping"><b><span class="cmdname">display mac-address flapping</span></b></a> [ <strong><span>slot</span></strong> <i><span class="varname">slot-id</span></i> ] [ <strong><span>begin</span></strong><em> </em><i><span class="varname">datetime</span></i> <i><span class="varname">hourtime</span></i> ] command to check MAC address flapping records.</p>
</div>
<div class="postreq"><a name="EN-US_TASK_0000001176664485__1.3.4"></a><a name="1.3.4"></a><h4 class="sectiontitle">Follow-up Procedure</h4>
<div class="p"><p>When the <strong>mac-address flapping trigger error-down</strong> command is run, the interface where MAC address flapping has occurred will enter the error-down state and sends a trap. The device sets an interface to the error-down state when it detects that MAC address flapping occurs on the interface. An interface in error-down state cannot receive or send packets and the interface indicator is off. You can run the <a href="cmdqueryname=display+error-down+recovery"><b><span class="cmdname">display error-down recovery</span></b></a> command to check information about all error-down interfaces on the device.</p>
<div class="p">If an interface is in error-down state, you are advised to determine the cause first. You can use either one of the following methods for interface recovery, depending on the number of error-down interfaces:<ul><li>Manually recover an error-down interface.<p>This method applies when only a few interfaces need to be recovered. Run either the <a href="cmdqueryname=shutdown"><b><span class="cmdname">shutdown</span></b></a> and <a href="cmdqueryname=undo+shutdown"><b><span class="cmdname">undo shutdown</span></b></a> commands, or the <a href="cmdqueryname=restart"><b><span class="cmdname">restart</span></b></a> command on an interface to recover it.</p>
</li><li>Enable automatic interface recovery before any interface enters the error-down state.<p>This method applies if a large number of interfaces may enter the error-down state. Manually recovering a large number of error-down interfaces is time-consuming and may not cover all the desired interfaces. To avoid this issue, you can run <a href="cmdqueryname=error-down+auto-recovery"><b><span class="cmdname">error-down auto-recovery</span></b></a> <strong><span>cause</span></strong> <strong><span>mac-address-flapping</span></strong> <strong><span>interval</span></strong> <i><span class="varname">interval-value</span></i> command to enable delayed automatic interface recovery to prevent interfaces from being stuck in the error-down state. You can run the <a href="cmdqueryname=display+error-down+recovery"><b><span class="cmdname">display error-down recovery</span></b></a> command to view information about automatic interface recovery.</p>
<div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>This method does not affect interfaces that are already in the error-down state. It affects only interfaces that enter the error-down state after the <a href="cmdqueryname=error-down+auto-recovery"><b><span class="cmdname">error-down auto-recovery</span></b></a> command is run.</p>
</div></div>
</li></ul>
</div>
</div></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="vrp_mac_cfg_0030.html">Configuring MAC Address Flapping Prevention and Detection
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="vrp_mac_cfg_0044.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="vrp_mac_cfg_0033.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>