
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Original Flow Statistics Export">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="galaxy_netstream_cfg_0054.html">
<meta name="DC.Relation" scheme="URI" content="galaxy_netstream_cfg_0056.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="NetStream">
<meta name="featuretype" content="System Monitoring">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="NetStream">
<meta name="featuretype" content="System Monitoring">
<meta name="featurename" content="NetStream">
<meta name="featuretype" content="System Monitoring">
<meta name="featurename" content="NetStream">
<meta name="featuretype" content="System Monitoring">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001563881205">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring Original Flow Statistics Export</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001563881205"></a><a name="EN-US_TASK_0000001563881205"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Original Flow Statistics Export</h1>
<div class="taskbody" id="taskbody1032119917175343"><div class="context"><a name="EN-US_TASK_0000001563881205__1.3.1"></a><a name="1.3.1"></a>
<div class="p" id="EN-US_TASK_0000001563881205__context2106012143175343"><h4 class="sectiontitle">Networking Requirements</h4><p id="EN-US_TASK_0000001563881205__p1842900438175343">On the network shown in <a href="#EN-US_TASK_0000001563881205__fig376535683313">Figure 1</a>, Host1 and Host2 communicate with DeviceA through DeviceB. To support network planning, the network administrator wants the NetStream server to collect statistics about the traffic transmitted between the hosts and DeviceA.</p>
<div class="fignone" id="EN-US_TASK_0000001563881205__fig376535683313"><a name="EN-US_TASK_0000001563881205__fig376535683313"></a><a name="fig376535683313"></a><span class="figcap"><b>Figure 1 </b>NetStream networking diagram</span><div class="note" id="EN-US_TASK_0000001563881205__note050610444417"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0000001563881205__p1850644414414">In this example, interface 1 and interface 2 represent <span>100GE</span> <span>1/0/1</span> and <span>100GE</span> <span>1/0/2</span>, respectively.</p>
</div></div>
<br><span><img id="EN-US_TASK_0000001563881205__image137651756123313" src="figure/en-us_image_0000002100034362.png" width="NaN" height="NaN"></span></div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001563881205__1.3.2"></a><a name="1.3.2"></a><h4 class="sectiontitle">Procedure</h4>
<ol id="EN-US_TASK_0000001563881205__steps1874173471175343"><li id="EN-US_TASK_0000001563881205__step19211221513"><span id="EN-US_TASK_0000001563881205__cmd5927224514">Configure IP addresses for interfaces on DeviceB according to <a href="#EN-US_TASK_0000001563881205__fig376535683313">Figure 1</a>.</span><p><pre class="screen" id="EN-US_TASK_0000001563881205__screen831179378175343">&lt;<span class="keyword" id="EN-US_TASK_0000001563881205__keyword512844822213">HUAWEI</span>&gt; <strong id="EN-US_TASK_0000001563881205__b23676313175343">system-view</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font><span class="keyword" id="EN-US_TASK_0000001563881205__keyword798281642518">HUAWEI</span>] <strong id="EN-US_TASK_0000001563881205__b20453424172520">sysname DeviceB</strong>
[*<span class="keyword" id="EN-US_TASK_0000001563881205__keyword897171302918">DeviceB</span>] <strong id="EN-US_TASK_0000001563881205__b236048766175343">commit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font><span class="keyword" id="EN-US_TASK_0000001563881205__keyword187001432285">DeviceB</span>] <strong id="EN-US_TASK_0000001563881205__b1582931237175343">vlan 110</strong>
[*<span class="keyword" id="EN-US_TASK_0000001563881205__keyword0575618162914">DeviceB</span>-vlan110] <strong id="EN-US_TASK_0000001563881205__b1432022719175343">quit</strong>
[*<span class="keyword" id="EN-US_TASK_0000001563881205__keyword1218714217294">DeviceB</span>] <strong id="EN-US_TASK_0000001563881205__b763601305175343">interface vlanif 110</strong>
[*<span class="keyword" id="EN-US_TASK_0000001563881205__keyword3505172322917">DeviceB</span>-Vlanif110] <strong id="EN-US_TASK_0000001563881205__b905954520175343">ip address 10.1.1.1 24</strong>
[*<span class="keyword" id="EN-US_TASK_0000001563881205__keyword47951728152912">DeviceB</span>-Vlanif110] <strong id="EN-US_TASK_0000001563881205__b1179947032175343">quit</strong>
[*<span class="keyword" id="EN-US_TASK_0000001563881205__keyword5721143010291">DeviceB</span>] <strong id="EN-US_TASK_0000001563881205__b1881132603018">interface <span>100ge</span><span>1/0/1</span></strong>
[*<span class="keyword" id="EN-US_TASK_0000001563881205__keyword17243193332917">DeviceB</span>-<span>100GE</span><span>1/0/1</span>] <strong id="EN-US_TASK_0000001563881205__b994536304175343">port link-type trunk</strong>
[*<span class="keyword" id="EN-US_TASK_0000001563881205__keyword118013356298">DeviceB</span>-<span>100GE</span><span>1/0/1</span>] <strong id="EN-US_TASK_0000001563881205__b1552816274175343">port trunk pvid vlan 110</strong>
[*<span class="keyword" id="EN-US_TASK_0000001563881205__keyword124171137162918">DeviceB</span>-<span>100GE</span><span>1/0/1</span>] <strong id="EN-US_TASK_0000001563881205__b83886811175343">port trunk allow-pass vlan 110</strong>
[*<span class="keyword" id="EN-US_TASK_0000001563881205__keyword8561839132916">DeviceB</span>-<span>100GE</span><span>1/0/1</span>] <strong id="EN-US_TASK_0000001563881205__b628137238175343">quit</strong>
[*<span class="keyword" id="EN-US_TASK_0000001563881205__keyword48334152910">DeviceB</span>] <strong id="EN-US_TASK_0000001563881205__b1148590290175343">vlan 120</strong>
[*<span class="keyword" id="EN-US_TASK_0000001563881205__keyword43901344122913">DeviceB</span>-vlan120] <strong id="EN-US_TASK_0000001563881205__b693090315175343">quit</strong>
[*<span class="keyword" id="EN-US_TASK_0000001563881205__keyword97793462293">DeviceB</span>] <strong id="EN-US_TASK_0000001563881205__b911134003175343">interface vlanif 120</strong>
[*<span class="keyword" id="EN-US_TASK_0000001563881205__keyword278113484296">DeviceB</span>-Vlanif120] <strong id="EN-US_TASK_0000001563881205__b2003034943175343">ip address 10.1.2.1 24</strong>
[*<span class="keyword" id="EN-US_TASK_0000001563881205__keyword9720750192912">DeviceB</span>-Vlanif120] <strong id="EN-US_TASK_0000001563881205__b657157549175343">quit</strong>
[*<span class="keyword" id="EN-US_TASK_0000001563881205__keyword18466526290">DeviceB</span>] <strong id="EN-US_TASK_0000001563881205__b46371627193410">interface <span>100ge</span></strong><strong id="EN-US_TASK_0000001563881205__b3986164982617"><span>1/0/2</span></strong>
[*<span class="keyword" id="EN-US_TASK_0000001563881205__keyword6628135517294">DeviceB</span>-<span>100GE</span><span>1/0/2</span>] <strong id="EN-US_TASK_0000001563881205__b1538820174175343">port link-type trunk</strong>
[*<span class="keyword" id="EN-US_TASK_0000001563881205__keyword831425822915">DeviceB</span>-<span>100GE</span><span>1/0/2</span>] <strong id="EN-US_TASK_0000001563881205__b1314919309175343">port trunk pvid vlan 120</strong>
[*<span class="keyword" id="EN-US_TASK_0000001563881205__keyword1064714013020">DeviceB</span>-<span>100GE</span><span>1/0/2</span>] <strong id="EN-US_TASK_0000001563881205__b1574170918175343">port trunk allow-pass vlan 120</strong>
[*<span class="keyword" id="EN-US_TASK_0000001563881205__keyword139771826308">DeviceB</span>-<span>100GE</span><span>1/0/2</span>] <strong id="EN-US_TASK_0000001563881205__b809857321175343">quit</strong></pre>
</p></li><li id="EN-US_TASK_0000001563881205__step37156140175343"><span id="EN-US_TASK_0000001563881205__cmd1712987350175343">Configure NetStream sampling.</span><p><p id="EN-US_TASK_0000001563881205__p130351822175343"># Configure NetStream sampling for the incoming and outgoing traffic on <span>100GE</span> <span>1/0/1</span> and set the sampling rate to 8192.</p>
<pre class="screen" id="EN-US_TASK_0000001563881205__screen942421071175343">[*<span class="keyword" id="EN-US_TASK_0000001563881205__keyword5411525122917">DeviceB</span>] <strong id="EN-US_TASK_0000001563881205__b1021531740175343">interface <span>100ge</span><span>1/0/1</span></strong>
[*<span class="keyword" id="EN-US_TASK_0000001563881205__keyword1154210261296">DeviceB</span>-<span>100GE</span><span>1/0/1</span>] <strong id="EN-US_TASK_0000001563881205__b150922601175343">netstream sampler random-packets 8192 inbound</strong>
[*<span class="keyword" id="EN-US_TASK_0000001563881205__keyword269582718296">DeviceB</span>-<span>100GE</span><span>1/0/1</span>] <strong id="EN-US_TASK_0000001563881205__b50837683175343">netstream sampler random-packets 8192 outbound</strong>
[*<span class="keyword" id="EN-US_TASK_0000001563881205__keyword1067117285291">DeviceB</span>-<span>100GE</span><span>1/0/1</span>] <strong id="EN-US_TASK_0000001563881205__b97218541175343">quit</strong></pre>
</p></li><li id="EN-US_TASK_0000001563881205__step1103402239175343"><span id="EN-US_TASK_0000001563881205__cmd1360139028175343">Configure NetStream flow aging.</span><p><p id="EN-US_TASK_0000001563881205__p1345252656175343"># Set the inactive flow aging time to 100 seconds, and enable FIN- and RST-based aging.</p>
<pre class="screen" id="EN-US_TASK_0000001563881205__screen1855339318175343">[*<span class="keyword" id="EN-US_TASK_0000001563881205__keyword1214023022913">DeviceB</span>] <strong id="EN-US_TASK_0000001563881205__b1960734446175343">netstream timeout ip inactive 100</strong>
[*<span class="keyword" id="EN-US_TASK_0000001563881205__keyword121371531112915">DeviceB</span>] <strong id="EN-US_TASK_0000001563881205__b1936212066175343">netstream timeout ip tcp-session</strong></pre>
</p></li><li id="EN-US_TASK_0000001563881205__step1079484835175343"><span id="EN-US_TASK_0000001563881205__cmd959771989175343">Configure NetStream original flow statistics export.</span><p><p id="EN-US_TASK_0000001563881205__p797320559175343"># Set the source IP address of the exported packets carrying original flow statistics to 10.1.2.1, destination IP address to 10.1.2.2, destination port number to 6000, and DSCP value to 0.</p>
<pre class="screen" id="EN-US_TASK_0000001563881205__screen1657713237175343">[*<span class="keyword" id="EN-US_TASK_0000001563881205__keyword7458193216294">DeviceB</span>] <strong id="EN-US_TASK_0000001563881205__b1499103663175343">netstream export ip source 10.1.2.1</strong>
[*<span class="keyword" id="EN-US_TASK_0000001563881205__keyword1043083318292">DeviceB</span>] <strong id="EN-US_TASK_0000001563881205__b583986190175343">netstream export ip host 10.1.2.2 6000</strong> <strong id="EN-US_TASK_0000001563881205__b395185814719">dscp 0</strong></pre>
</p></li><li id="EN-US_TASK_0000001563881205__step182477099175343"><span id="EN-US_TASK_0000001563881205__cmd285954977175343">Configure the version of exported packets.</span><p><p id="EN-US_TASK_0000001563881205__p1986888177175343">By default, the version of exported packets is V9.</p>
</p></li><li id="EN-US_TASK_0000001563881205__step1330451159175343"><span id="EN-US_TASK_0000001563881205__cmd1292896749175343">Enable original flow statistics collection on an interface.</span><p><p id="EN-US_TASK_0000001563881205__p1057096034175343"># Enable original flow statistics collection for incoming and outgoing packets on <span>100GE</span> <span>1/0/1</span>.</p>
<pre class="screen" id="EN-US_TASK_0000001563881205__screen475421477175343">[*<span class="keyword" id="EN-US_TASK_0000001563881205__keyword1181518397291">DeviceB</span>] <strong id="EN-US_TASK_0000001563881205__b1949277668175343">interface <span>100ge</span><span>1/0/1</span></strong>
[*<span class="keyword" id="EN-US_TASK_0000001563881205__keyword42771041172915">DeviceB</span>-<span>100GE</span><span>1/0/1</span>] <strong id="EN-US_TASK_0000001563881205__b616454879175343">netstream outbound ip</strong>
[*<span class="keyword" id="EN-US_TASK_0000001563881205__keyword1134815426292">DeviceB</span>-<span>100GE</span><span>1/0/1</span>] <strong id="EN-US_TASK_0000001563881205__b1664858038175343">netstream inbound ip</strong>
[*<span class="keyword" id="EN-US_TASK_0000001563881205__keyword528574352918">DeviceB</span>-<span>100GE</span><span>1/0/1</span>] <strong id="EN-US_TASK_0000001563881205__b641434868175343">quit</strong>
[*<span class="keyword" id="EN-US_TASK_0000001563881205__keyword142361344162910">DeviceB</span>] <strong id="EN-US_TASK_0000001563881205__b1674491864175343">commit</strong></pre>
</p></li><li id="EN-US_TASK_0000001563881205__step705110154175343"><span id="EN-US_TASK_0000001563881205__cmd971594132175343">Verify the configuration.</span><p><p id="EN-US_TASK_0000001563881205__p1756317784175343"># View flow statistics.</p>
<pre class="screen" id="EN-US_TASK_0000001563881205__screen1253845284175343">[<font style="font-size:8pt" Face="Courier New" >~</font><span class="keyword" id="EN-US_TASK_0000001563881205__keyword1466064522915">DeviceB</span>] <strong id="EN-US_TASK_0000001563881205__b212507984175343">display netstream statistics ip slot </strong><span>1</span>
 Last time when statistics were cleared: -
 -------------------------------------------------------------------------------
 Packet Length    : Number
 -------------------------------------------------------------------------------
 1      <font style="font-size:8pt" Face="Courier New" >~</font>    64   : 0
 65     <font style="font-size:8pt" Face="Courier New" >~</font>    128  : 14
 129    <font style="font-size:8pt" Face="Courier New" >~</font>    256  : 1
 257    <font style="font-size:8pt" Face="Courier New" >~</font>    512  : 0
 513    <font style="font-size:8pt" Face="Courier New" >~</font>    1024 : 0
 1025   <font style="font-size:8pt" Face="Courier New" >~</font>    1500 : 0
 longer than 1500 : 0
 -------------------------------------------------------------------------------
 StreamType
      Current           Aged        Created       Exported       Exported
      (streams)         (streams)   (streams)     (streams)      (Packets)
 -------------------------------------------------------------------------------
 origin
            0              0              0              0              0
 -------------------------------------------------------------------------------</pre>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0000001563881205__example1675836695175343"><a name="EN-US_TASK_0000001563881205__1.3.3"></a><a name="1.3.3"></a><h4 class="sectiontitle">Configuration Scripts</h4><p id="EN-US_TASK_0000001563881205__p1872035860175343">DeviceB</p>
<pre class="screen" id="EN-US_TASK_0000001563881205__screen334913207175343">#                                                                               
sysname DeviceB 
#
vlan batch 110 120 
# 
netstream timeout ip inactive 100                                               
netstream timeout ip tcp-session 
netstream export ip source 10.1.2.1
netstream export ip host 10.1.2.2 6000 dscp 0
#
interface Vlanif110                                                             
 ip address 10.1.1.1 255.255.255.0 
#                                                                               
interface Vlanif120                                                             
 ip address 10.1.2.1 255.255.255.0 
# 
interface <span>100GE</span><span>1/0/1</span>                                                  
 port link-type trunk                                                           
 port trunk pvid vlan 110                                                       
 port trunk allow-pass vlan 110 
 netstream inbound ip                                                           
 netstream outbound ip                                                          
 netstream sampler random-packets 8192 inbound
 netstream sampler random-packets 8192 outbound
# 
interface <span>100GE</span><span>1/0/2</span>                                                  
 port link-type trunk                                                           
 port trunk pvid vlan 120                                                       
 port trunk allow-pass vlan 120
# 
return</pre>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="galaxy_netstream_cfg_0054.html">NetStream Configuration Examples
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="galaxy_netstream_cfg_0056.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>