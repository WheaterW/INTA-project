
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring Distributed VXLAN Gateways to Function as DHCPv4 Relay Agents">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="galaxy_dhcpv4_cfg_0029.html">
<meta name="DC.Relation" scheme="URI" content="galaxy_dhcpv4_cfg_0030.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="DHCPv4">
<meta name="featuretype" content="IP Addresses and Services">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="DHCPv4">
<meta name="featuretype" content="IP Addresses and Services">
<meta name="featurename" content="DHCPv4">
<meta name="featuretype" content="IP Addresses and Services">
<meta name="featuretype" content="IP Addresses and Services">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001563886125">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>Configuring Distributed VXLAN Gateways to Function as DHCPv4 Relay Agents</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001563886125"></a><a name="EN-US_TASK_0000001563886125"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring Distributed VXLAN Gateways to Function as DHCPv4 Relay Agents</h1>
<div class="taskbody"><div class="prereq" style="margin-left:0"><a name="EN-US_TASK_0000001563886125__1.3.1"></a><a name="1.3.1"></a><h4 class="sectiontitle">Prerequisites</h4>
<div class="p"><div class="p">Before configuring distributed VXLAN gateways to function as DHCPv4 relay agents, you have completed the following tasks:<ol><li>Configure a device as a DHCPv4 relay agent. For details, see <a href="galaxy_dhcpv4_cfg_0022.html">Configuring a Device to Function as a DHCPv4 Relay Agent</a>.</li><li>Configure a device as a distributed VXLAN gateway. For details, see VXLAN Configuration.</li></ol>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001563886125__1.3.2"></a><a name="1.3.2"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>In a distributed VXLAN gateway scenario, DHCPv4 relay is configured on VBDIF interfaces of distributed gateways. The giaddr field carried in a request message sent from a DHCPv4 relay agent to a DHCPv4 server is the IPv4 address of a VBDIF interface. When the server returns a reply message, it determines the network segment of the client based on the giaddr field. However, the reply message from the DHCPv4 server may be forwarded to other distributed gateways (rather than the device that sends the request message), because the IPv4 addresses of VBDIF interfaces on distributed gateways are the same. As a result, users cannot obtain IPv4 addresses.</p>
<div class="p">The preceding issue can be resolved using the following methods:<ul><li><p>Method 1: Configure Option 82 to carry the return address.</p>
<p>The DHCPv4 relay agent still uses the IPv4 address of the VBDIF interface to communicate with the DHCPv4 server. When sending a request message, the relay agent uses the local VTEP IPv4 address as the return address in Option 82. This address is also carried in a reply message sent by the server. When processing a reply message from the DHCPv4 server, the DHCPv4 relay agent checks whether the reply message corresponds to the request message it sent based on the return address carried in the message. If it does, the relay agent forwards the message to the client. Otherwise, the relay agent performs rerouting based on the VTEP IPv4 address to forward the reply message to the corresponding distributed gateway through a VXLAN tunnel.</p>
</li><li><p>Method 2: Configure the functions to modify the giaddr field in DHCPv4 messages and to insert suboption 5 into Option 82.</p>
<p>Suboption 5: corresponds to the <strong>link-selection</strong> parameter, indicating the gateway IPv4 address of a DHCPv4 relay interface. In an inter-VPN scenario, the <a href="cmdqueryname=dhcp+relay+giaddr+source-interface"><b><span class="cmdname">dhcp relay giaddr source-interface</span></b></a> <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-num</span></i> or <a href="cmdqueryname=dhcp+relay+giaddr+outgoing-interface-address"><b><span class="cmdname">dhcp relay giaddr outgoing-interface-address</span></b></a> command generally needs to be run to modify the giaddr field in DHCPv4 messages. This ensures that reply messages from a DHCPv4 server can be successfully forwarded to a DHCPv4 relay agent. In this case, suboption 5 must be used to transmit the giaddr field to the DHCPv4 server. The server selects an address pool based on suboption 5 and then allocates an IPv4 address to a client.</p>
</li></ul>
The following table compares the two methods.
<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" frame="border" border="1" rules="all"><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="15.049999999999999%" id="mcps1.3.2.2.2.1.4.1.1" liSelected="liSelected"><p>Category</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="28.09%" id="mcps1.3.2.2.2.1.4.1.2" liSelected="liSelected"><p>IPv4 Address Used by the DHCPv4 Relay Agent to Communicate with the DHCPv4 Server</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="56.86%" id="mcps1.3.2.2.2.1.4.1.3" liSelected="liSelected"><p>Advantage and Disadvantage</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" valign="top" width="15.049999999999999%" headers="mcps1.3.2.2.2.1.4.1.1 "><p>Method 1</p>
</td>
<td class="cellrowborder" valign="top" width="28.09%" headers="mcps1.3.2.2.2.1.4.1.2 "><p>IPv4 address of the VBDIF interface</p>
</td>
<td class="cellrowborder" valign="top" width="56.86%" headers="mcps1.3.2.2.2.1.4.1.3 "><ul><li>The DHCPv4 server does not need to parse suboption 5.</li><li>Rerouting: A distributed gateway that does not send request messages may also receive reply messages.</li></ul>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="15.049999999999999%" headers="mcps1.3.2.2.2.1.4.1.1 "><p>Method 2</p>
</td>
<td class="cellrowborder" valign="top" width="28.09%" headers="mcps1.3.2.2.2.1.4.1.2 "><p>Primary IPv4 address of the source interface or outbound interface</p>
</td>
<td class="cellrowborder" valign="top" width="56.86%" headers="mcps1.3.2.2.2.1.4.1.3 "><ul><li>The DHCPv4 server must be able to parse suboption 5.</li><li>Precise return: Reply messages can be sent to a correct distributed gateway.</li></ul>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div></div>
<div class="steps-unordered"><a name="EN-US_TASK_0000001563886125__1.3.3"></a><a name="1.3.3"></a><h4 class="sectiontitle">Procedure</h4>
<ul><li><span><strong>Method 1: Configure Option 82 to carry the return address.</strong></span><ol><li class="substepexpand"><span>Enter the system view.</span><p><pre class="screen"><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></pre>
</p></li><li class="substepexpand"><span>Configure Option 82's suboption 2 (vendor-specific suboption) to carry the device's VTEP IPv4 address.</span><p><pre class="screen"><a href="cmdqueryname=dhcp+option82+vendor-specific+format"><b><span class="cmdname">dhcp option82 vendor-specific format</span></b></a> <strong><span>vendor-sub-option 2 ip-address</span></strong> <i><span class="varname">ip-address</span></i></pre>
<p>By default, Option 82's suboption 2 (vendor-specific suboption) does not carry a device's VTEP IPv4 address.</p>
</p></li><li class="substepexpand"><span>Enter the VBDIF interface view.</span><p><pre class="screen"><a href="cmdqueryname=interface+vbdif"><b><span class="cmdname">interface vbdif</span></b></a> <i><span class="varname">bd-id</span></i></pre>
<p>The number of the VBDIF interface must match an existing BD ID.</p>
</p></li><li class="substepexpand"><span>Enable the DHCPv4 relay agent to support Option 82.</span><p><pre class="screen"><a href="cmdqueryname=dhcp+relay+information+enable"><b><span class="cmdname">dhcp relay information enable</span></b></a></pre>
<p>By default, a DHCPv4 relay agent does not support Option 82.</p>
</p></li><li class="substepexpand"><span>Commit the configuration.</span><p><pre class="screen" id="EN-US_TASK_0000001563886125__en-us_task_0228023023_screen14848162118611"><a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001563886125__en-us_task_0228023023_cmdname1784862115612">commit</span></b></a></pre>
</p></li></ol>
</li><li><span><strong>Method 2: Configure the source interface of DHCPv4 relay messages and the function to insert suboption 5 into Option 82.</strong></span><ol><li class="substepexpand"><span>Enter the system view.</span><p><pre class="screen"><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></pre>
</p></li><li class="substepexpand"><span>Enter the VBDIF interface view.</span><p><pre class="screen"><a href="cmdqueryname=interface+vbdif"><b><span class="cmdname">interface vbdif</span></b></a> <i><span class="varname">bd-id</span></i></pre>
<p>The number of the VBDIF interface must match an existing BD ID.</p>
</p></li><li class="substepexpand"><span>Modify the information of the giaddr field.</span><p><p>Configure the source interface of DHCPv4 relay messages, and use the primary IPv4 address of the interface to fill in the giaddr field. The source interface must be able to communicate with a DHCPv4 server.</p>
<pre class="screen"><a href="cmdqueryname=dhcp+relay+giaddr+source-interface"><b><span class="cmdname">dhcp relay giaddr source-interface</span></b></a> <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-num</span></i></pre>
<p>Or configure the device to use the primary IPv4 address of the outbound interface to fill in the giaddr field.</p>
<pre class="screen"><a href="cmdqueryname=dhcp+relay+giaddr+outgoing-interface-address"><b><span class="cmdname">dhcp relay giaddr outgoing-interface-address</span></b></a></pre>
<p>By default, a device uses the IPv4 address of a DHCPv4 relay agent to fill in the giaddr field.</p>
<p>The <a href="cmdqueryname=dhcp+relay+source-ip-address"><b><span class="cmdname">dhcp relay source-ip-address</span></b></a> and <a href="cmdqueryname=dhcp+relay+gateway"><b><span class="cmdname">dhcp relay gateway</span></b></a> commands are mutually exclusive with the <a href="cmdqueryname=dhcp+relay+giaddr+source-interface"><b><span class="cmdname">dhcp relay giaddr source-interface</span></b></a> and <a href="cmdqueryname=dhcp+relay+giaddr+outgoing-interface-address"><b><span class="cmdname">dhcp relay giaddr outgoing-interface-address</span></b></a> commands.</p>
<p>The <a href="cmdqueryname=dhcp+relay+giaddr+source-interface"><b><span class="cmdname">dhcp relay giaddr source-interface</span></b></a> <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-num</span></i> command takes precedence over the <a href="cmdqueryname=dhcp+relay+giaddr+outgoing-interface-address"><b><span class="cmdname">dhcp relay giaddr outgoing-interface-address</span></b></a> command.</p>
</p></li><li class="substepexpand"><span>Enable the DHCPv4 relay interface to insert Option 82's suboption 5 into DHCPv4 messages.</span><p><pre class="screen"><a href="cmdqueryname=dhcp+option82"><b><span class="cmdname">dhcp option82</span></b></a> <strong><span>link-selection</span></strong> <strong><span>insert</span></strong> <strong><span>enable</span></strong></pre>
</p><p><p>By default, a DHCPv4 relay interface does not insert Option 82's suboption 5 into DHCPv4 messages.</p>
</p></li><li class="substepexpand"><span>Commit the configuration.</span><p><pre class="screen" id="EN-US_TASK_0000001563886125__en-us_task_0228023023_screen14848162118611_1"><a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001563886125__en-us_task_0228023023_cmdname1784862115612_1">commit</span></b></a></pre>
</p></li></ol>
</li></ul></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="galaxy_dhcpv4_cfg_0029.html">Configuring Distributed VXLAN Gateways to Function as DHCPv4 Relay Agents
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="galaxy_dhcpv4_cfg_0030.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>
</body>
</html>