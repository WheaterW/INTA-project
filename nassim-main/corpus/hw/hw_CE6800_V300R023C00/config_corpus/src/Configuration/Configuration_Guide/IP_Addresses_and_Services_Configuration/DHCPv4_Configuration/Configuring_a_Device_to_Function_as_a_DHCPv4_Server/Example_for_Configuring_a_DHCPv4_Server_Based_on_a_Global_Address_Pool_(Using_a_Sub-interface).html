
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring a DHCPv4 Server Based on a Global Address Pool (Using a Sub-interface)">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="galaxy_dhcpv4_cfg_0012.html">
<meta name="DC.Relation" scheme="URI" content="galaxy_dhcpv4_cfg_0019.html">
<meta name="DC.Relation" scheme="URI" content="toctopics/en-us_task_0000001513046146.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="DHCPv4">
<meta name="featuretype" content="IP Addresses and Services">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="DHCPv4">
<meta name="featuretype" content="IP Addresses and Services">
<meta name="featurename" content="DHCPv4">
<meta name="featuretype" content="IP Addresses and Services">
<meta name="featuretype" content="IP Addresses and Services">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001513046150">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring a DHCPv4 Server Based on a Global Address Pool (Using a Sub-interface)</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001513046150"></a><a name="EN-US_TASK_0000001513046150"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring a DHCPv4 Server Based on a Global Address Pool (Using a Sub-interface)</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001513046150__1.3.1"></a><a name="1.3.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>IPv4 addresses of different network segments need to be obtained for services such as VoIP on different user planes. DHCPv4 clients that support the services use one MAC address to apply for IPv4 addresses of different network segments and differentiate the services based on VLAN IDs. Therefore, the DHCPv4 server must be able to allocate IPv4 addresses to users with the same MAC address but different VLAN IDs.</p>
<p>As shown in <a href="#EN-US_TASK_0000001513046150__fig_dc_vrp_dhcp_server_cfg_002001">Figure 1</a>, DeviceA functions as a DHCPv4 server to dynamically allocate IPv4 addresses to clients. When DeviceA receives a user packet with the tag of 100, it selects the address pool <strong>huawei1</strong> based on the gateway address 10.10.10.1/24; when DeviceA receives a user packet with the tag of 200, it selects the address pool <strong>huawei2</strong> based on the gateway address 10.10.20.1/24.</p>
<div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Currently, the DHCPv4 server can allocate addresses to users with the same MAC address only from different address pools.</p>
</div></div>
<div class="fignone" id="EN-US_TASK_0000001513046150__fig_dc_vrp_dhcp_server_cfg_002001"><a name="EN-US_TASK_0000001513046150__fig_dc_vrp_dhcp_server_cfg_002001"></a><a name="fig_dc_vrp_dhcp_server_cfg_002001"></a><span class="figcap"><b>Figure 1 </b>Network diagram of configuring a DHCPv4 server based on a global address pool (using a sub-interface)</span><div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface 1, interface 1.1, and interface 1.2 represent <span>100GE</span> <span>1/0/1</span>, <span>100GE</span> <span>1/0/1</span>.1, and <span>100GE</span> <span>1/0/1</span>.2, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0000001513046194.png"></span></div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001513046150__1.3.2"></a><a name="1.3.2"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Enable DHCPv4.</span><p><pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font><span class="keyword">HUAWEI</span>] <strong>sysname <span class="keyword">DeviceA</span></strong>
[*<span class="keyword">HUAWEI</span>] <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a>
[<font style="font-size:8pt" Face="Courier New" >~</font><span class="keyword">DeviceA</span>] <strong>dhcp enable</strong>
[*<span class="keyword">DeviceA</span>] <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></pre>
</p></li><li><span>Configure global address pools.</span><p><p># Configure attributes for the address pool <strong>huawei1</strong>.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceA] <strong>ip pool huawei1</strong>
[*DeviceA-ip-pool-huawei1] <strong>network 10.10.10.0 mask 24</strong>
[*DeviceA-ip-pool-huawei1] <strong>gateway-list 10.10.10.1</strong>
[*DeviceA-ip-pool-huawei1] <strong>quit</strong>
[*<span class="keyword">DeviceA</span>] <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></pre>
<p># Configure attributes for the address pool <strong>huawei2</strong>.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceA] <strong>ip pool huawei2</strong>
[*DeviceA-ip-pool-huawei2] <strong>network 10.10.20.0 mask 24</strong>
[*DeviceA-ip-pool-huawei2] <strong>gateway-list 10.10.20.1</strong>
[*DeviceA-ip-pool-huawei2] <strong>quit</strong>
[*<span class="keyword">DeviceA</span>] <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></pre>
</p></li><li><span>Configure Layer 3 sub-interfaces.</span><p><p># Configure IPv4 addresses for Layer 3 sub-interfaces, and enable the DHCPv4 server function based on global address pools on the Layer 3 sub-interfaces.</p>
</p><p><pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceA] <strong>interface </strong><strong><span>100GE</span> <span>1/0/1</span></strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>undo portswitch</strong>
[*DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>quit</strong>
[*DeviceA] <strong>interface <span>100GE</span> <span>1/0/1</span>.1</strong>
[*DeviceA-<span>100GE</span><span>1/0/1</span>.1] <strong>ip address 10.10.10.1 24</strong>
[*DeviceA-<span>100GE</span><span>1/0/1</span>.1] <strong>dot1q termination vid 100</strong>
[*DeviceA-<span>100GE</span><span>1/0/1</span>.1] <strong>dhcp select global</strong>
[*DeviceA-<span>100GE</span><span>1/0/1</span>.1] <strong>quit</strong>
[*DeviceA] <strong>interface <span>100GE</span> <span>1/0/1</span>.2</strong>
[*DeviceA-<span>100GE</span><span>1/0/1</span>.2] <strong>ip address 10.10.20.1 24</strong>
[*DeviceA-<span>100GE</span><span>1/0/1</span>.2] <strong>dot1q termination vid 200</strong>
[*DeviceA-<span>100GE</span><span>1/0/1</span>.2] <strong>dhcp select global</strong>
[*DeviceA-<span>100GE</span><span>1/0/1</span>.2] <strong>quit</strong>
[*DeviceA] <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001513046150__1.3.3"></a><a name="1.3.3"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p># On DeviceA, run the <a href="cmdqueryname=display+ip+pool"><b><span class="cmdname">display ip pool</span></b></a> command to check IPv4 address configuration and allocation in address pools. The <strong>Used</strong> field displays the number of used IPv4 addresses in each address pool.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceA] <strong>display ip pool name huawei1</strong>

  Pool-name        : huawei1                                                                                                        
  Pool-No          : 0                                                                                                              
  Lease            : 1 Days 0 Hours 0 Minutes                                                                                       
  Domain-name      : -                                                                                                              
  DNS-server0      : -                                                                                                              
  NBNS-server0     : -                                                                                                              
  Netbios-type     : -                                                                                                              
  Position         : Local                                                                                                          
  Status           : Unlocked                                                                                                       
  Gateway-0        : 10.10.10.1                                                                                                     
  Network          : 10.10.10.0                                                                                                     
  Mask             : 255.255.255.0                                                                                                  
  VPN instance     : --                                                                                                             
  Logging          : Disable                                                                                                        
  Conflicted address recycle interval: -                                                                                            
  Address Statistic: Total       :253       Used        :0                                                                          
                     Idle        :253       Expired     :0                                                                          
                     Conflict    :0         Disabled    :0
                                                                            

 -------------------------------------------------------------------------------------                                              
  Network section                                                                                                                   
         Start           End       Total    Used Idle(Expired) Conflict Disabled                                                    
 -------------------------------------------------------------------------------------                                              
      10.10.10.1    10.10.10.254     253       0        253(0)       0     0                                                        
 ------------------------------------------------------------------------------------- </pre>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceA] <strong>display ip pool name huawei2</strong>

  Pool-name        : huawei2                                                                                                        
  Pool-No          : 1                                                                                                              
  Lease            : 1 Days 0 Hours 0 Minutes                                                                                       
  Domain-name      : -                                                                                                              
  DNS-server0      : -                                                                                                              
  NBNS-server0     : -                                                                                                              
  Netbios-type     : -                                                                                                              
  Position         : Local                                                                                                          
  Status           : Unlocked                                                                                                       
  Gateway-0        : 10.10.20.1                                                                                                     
  Network          : 10.10.20.0                                                                                                     
  Mask             : 255.255.255.0                                                                                                  
  VPN instance     : --                                                                                                             
  Logging          : Disable                                                                                                        
  Conflicted address recycle interval: -                                                                                            
  Address Statistic: Total       :253       Used        :0                                                                          
                     Idle        :253       Expired     :0                                                                          
                     Conflict    :0         Disabled    :0 
                                                                           

 -------------------------------------------------------------------------------------                                              
  Network section                                                                                                                   
         Start           End       Total    Used Idle(Expired) Conflict Disabled                                                    
 -------------------------------------------------------------------------------------                                              
      10.10.20.1    10.10.20.254     253       0        253(0)       0     0                                                        
 -------------------------------------------------------------------------------------    </pre>
<h4 class="sectiontitle">Configuration Scripts</h4><p>DeviceA</p>
<pre class="screen">#
sysname DeviceA
#
dhcp enable
#
ip pool huawei1
 gateway-list 10.10.10.1
 network 10.10.10.0 mask 255.255.255.0 
# 
ip pool huawei2
 gateway-list 10.10.20.1
 network 10.10.20.0 mask 255.255.255.0 
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
#
interface <span>100GE</span><span>1/0/1</span>.1
 ip address 10.10.10.1 255.255.255.0
 dot1q termination vid 100
 encapsulation dot1q-termination
 dhcp select global
#
interface <span>100GE</span><span>1/0/1</span>.2
 ip address 10.10.20.1 255.255.255.0
 dot1q termination vid 200
 encapsulation dot1q-termination
 dhcp select global
#
return</pre>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="galaxy_dhcpv4_cfg_0012.html">Configuring a Device to Function as a DHCPv4 Server
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="galaxy_dhcpv4_cfg_0019.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="toctopics/en-us_task_0000001513046146.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>