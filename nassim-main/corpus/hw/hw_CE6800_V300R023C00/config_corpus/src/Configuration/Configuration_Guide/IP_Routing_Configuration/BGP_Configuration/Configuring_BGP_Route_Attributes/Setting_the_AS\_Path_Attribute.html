
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Setting the AS_Path Attribute">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="vrp_bgp_cfg_0021.html">
<meta name="DC.Relation" scheme="URI" content="vrp_bgp_cfg_0027.html">
<meta name="DC.Relation" scheme="URI" content="vrp_bgp_cfg_0029.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing">
<meta name="featuretype" content="IP Routing">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001130783904">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>Setting the AS_Path Attribute</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001130783904"></a><a name="EN-US_TASK_0000001130783904"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Setting the AS_Path Attribute</h1>
<div class="taskbody"><div class="prereq" style="margin-left:0"><a name="EN-US_TASK_0000001130783904__1.3.1"></a><a name="1.3.1"></a><h4 class="sectiontitle">Prerequisites</h4>
<div class="p"><p>Before setting the AS_Path attribute, you have completed the following task:</p>
<ul><li><a href="vrp_bgp_cfg_0014.html">Configure basic BGP functions</a>.</li></ul>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001130783904__1.3.2"></a><a name="1.3.2"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>The AS_Path attribute is used to prevent routing loops and control route selection.</p>
</div></div>
<div class="steps-unordered"><a name="EN-US_TASK_0000001130783904__1.3.3"></a><a name="1.3.3"></a><h4 class="sectiontitle">Procedure</h4>
<ul><li><span>Enable BGP to accept routes that contain the local AS number, as long as the number of repetitions in each route is within a configured limit.</span><ol><li class="substepexpand"><span>Enter the system view.</span><p><pre class="screen"><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></pre>
</p></li><li class="substepexpand"><span>Enter the BGP view.</span><p><pre class="screen"><a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></pre>
</p></li><li class="substepexpand"><span>Enter the IPv4 unicast address family view.</span><p><pre class="screen"><a href="cmdqueryname=ipv4-family+unicast"><b><span class="cmdname">ipv4-family</span></b></a> <strong><span>unicast</span></strong></pre>
</p></li><li class="substepexpand"><span>Allow repetition of the local AS number.</span><p><pre class="screen"><a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> | <i><span class="varname">peerIpv6Addr</span></i> } <a href="cmdqueryname=allow-as-loop"><b><span class="cmdname">allow-as-loop</span></b></a> [ <i><span class="varname">number</span></i> ]</pre>
<p>Generally, BGP checks the AS_Path attribute of each route received from a peer. If the local AS number is carried in a route, BGP ignores this route to prevent routing loops.</p>
<p>However, you can use this command in some special applications to allow the AS_Path attribute of a route received from a peer to contain the local AS number. You can also set a limit on the number of repetitions for the local AS number.</p>
</p></li><li class="substepexpand"><span>Commit the configuration.</span><p><pre class="screen" id="EN-US_TASK_0000001130783904__en-us_task_0234857734_screen14848162118611"><a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001130783904__en-us_task_0234857734_cmdname1784862115612">commit</span></b></a></pre>
</p></li></ol>
</li><li><span>Disable BGP from comparing AS_Path attributes during route selection.</span><ol><li class="substepexpand"><span>Enter the system view.</span><p><pre class="screen"><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></pre>
</p></li><li class="substepexpand"><span>Enter the BGP view.</span><p><pre class="screen"><a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></pre>
</p></li><li class="substepexpand"><span>Enter the IPv4 unicast address family view.</span><p><pre class="screen"><a href="cmdqueryname=ipv4-family+unicast"><b><span class="cmdname">ipv4-family</span></b></a> <strong><span>unicast</span></strong></pre>
</p></li><li class="substepexpand"><span>Disable BGP from comparing AS_Path attributes during route selection.</span><p><pre class="screen"><a href="cmdqueryname=bestroute+as-path-ignore"><b><span class="cmdname">bestroute as-path-ignore</span></b></a></pre>
</p></li><li class="substepexpand"><span>Commit the configuration.</span><p><pre class="screen" id="EN-US_TASK_0000001130783904__en-us_task_0234857734_screen14848162118611_1"><a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001130783904__en-us_task_0234857734_cmdname1784862115612_1">commit</span></b></a></pre>
</p></li></ol>
</li><li><span>Configure the AS_Path attribute to carry only the public AS number.</span><ol><li class="substepexpand"><span>Enter the system view.</span><p><pre class="screen"><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></pre>
</p></li><li class="substepexpand"><span>Enter the BGP view.</span><p><pre class="screen"><a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></pre>
</p></li><li class="substepexpand"><span>Enter the IPv4 unicast address family view.</span><p><pre class="screen"><a href="cmdqueryname=ipv4-family+unicast"><b><span class="cmdname">ipv4-family</span></b></a> <strong><span>unicast</span></strong></pre>
</p></li><li class="substepexpand"><span>Configure the AS_Path attribute to carry only the public AS number.</span><p><pre class="screen"><a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> | <i><span class="varname">peerIpv6Addr</span></i> } <a href="cmdqueryname=public-as-only+force+replace+include-peer-as+limited+replace"><b><span class="cmdname">public-as-only</span></b></a><span> [ <strong><span>force</span></strong></span><span> [ <strong><span>replace</span></strong> ] [ <strong><span>include-peer-as</span></strong> ] | <strong><span>limited</span></strong> [ <strong><span>replace</span></strong> ] [ <strong><span>include-peer-as</span></strong> ]</span><span> ]</span></pre>
<p>Generally, AS numbers range from 1 to 4294967295, including public AS numbers, private AS numbers, and reserved AS numbers. Private AS numbers range from 64512 to 65534 and from 4200000000 to 4294967294 (or from 64086.59904 to 65535.65534). The AS numbers 65535 and 4294967295 are reserved for special applications. Other AS numbers are public AS numbers.</p>
<div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>If the 4-byte private AS number capability is disabled using the <a href="cmdqueryname=private-4-byte-as+disable"><b><span class="cmdname">private-4-byte-as disable</span></b></a> command, private AS numbers range from 64512 to 65534; the AS number 65535 is reserved, and others are public AS numbers.</p>
</div></div>
<p>Public AS numbers can be used on the Internet, and are assigned and managed by the Internet Assigned Number Authority (IANA). Private AS numbers cannot be advertised to the Internet, and are used only within ASs.</p>
<p>Generally, BGP routes to be advertised to peers carry either public or private AS numbers, or both. In certain cases, private AS numbers in BGP routes do not need to be advertised. To ensure this, run the <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <a href="cmdqueryname=public-as-only"><b><span class="cmdname">public-as-only</span></b></a> [ <strong><span>force</span></strong> [ <strong><span>replace</span></strong> ] [ <strong><span>include-peer-as</span></strong> ] | <strong><span>limited</span></strong> [ <strong><span>replace</span></strong> ] [ <strong><span>include-peer-as</span></strong> ] ] command.</p>
</p></li><li class="substepexpand"><span>Commit the configuration.</span><p><pre class="screen" id="EN-US_TASK_0000001130783904__en-us_task_0234857734_screen14848162118611_2"><a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001130783904__en-us_task_0234857734_cmdname1784862115612_2">commit</span></b></a></pre>
</p></li></ol>
</li><li><span>Set the maximum quantity of AS numbers allowed in the AS_Path attribute.</span><ol><li class="substepexpand"><span>Enter the system view.</span><p><pre class="screen"><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></pre>
</p></li><li class="substepexpand"><span>Enter the BGP view.</span><p><pre class="screen"><a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></pre>
</p></li><li class="substepexpand"><span>Set the maximum quantity of AS numbers allowed in the AS_Path attribute.</span><p><pre class="screen"><a href="cmdqueryname=as-path-limit"><b><span class="cmdname">as-path-limit</span></b></a> <i><span class="varname">limit</span></i></pre>
<p>By default, a maximum of 255 AS numbers are allowed in the AS_Path attribute.</p>
<p>After the <a href="cmdqueryname=as-path-limit"><b><span class="cmdname">as-path-limit</span></b></a> command is run, the device checks whether the quantity of AS numbers in the AS_Path attribute of each received route exceeds the maximum value, and discards the route if this is the case. As such, if the maximum value is set too low, routes may be discarded.</p>
</p></li><li class="substepexpand"><span>Commit the configuration.</span><p><pre class="screen" id="EN-US_TASK_0000001130783904__en-us_task_0234857734_screen14848162118611_3"><a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001130783904__en-us_task_0234857734_cmdname1784862115612_3">commit</span></b></a></pre>
</p></li></ol>
</li><li><span>Disable BGP from checking the first AS number in the AS_Path attribute of each Update message received from an EBGP peer.</span><ol><li class="substepexpand"><span>Enter the system view.</span><p><pre class="screen"><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></pre>
</p></li><li class="substepexpand"><span>Enter the BGP view.</span><p><pre class="screen"><a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></pre>
</p></li><li class="substepexpand"><span>Disable BGP from checking the first AS number in the AS_Path attribute of each Update message received from an EBGP peer.</span><p><pre class="screen"><a href="cmdqueryname=undo+check-first-as"><b><span class="cmdname">undo check-first-as</span></b></a></pre>
<p>By default, BGP checks whether the first AS number in the AS_Path attribute of an Update message received from an EBGP peer is the same as the number of the AS where the EBGP peer resides. If they are different, the Update message is rejected.</p>
<div class="notice"><span class="noticetitle"><img src="public_sys-resources/notice_3.0-en-us.png"> </span><div class="noticebody"><p>Exercise caution when running the <a href="cmdqueryname=undo+check-first-as"><b><span class="cmdname">undo check-first-as</span></b></a> command, as use of this command may result in routing loops.</p>
<p>After a configuration change, to allow the new configuration to take effect on the routes that have been received on the local device, run the <a href="cmdqueryname=refresh+bgp"><b><span class="cmdname">refresh bgp</span></b></a> command.</p>
</div></div>
</p></li><li class="substepexpand"><span>Commit the configuration.</span><p><pre class="screen" id="EN-US_TASK_0000001130783904__en-us_task_0234857734_screen14848162118611_4"><a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001130783904__en-us_task_0234857734_cmdname1784862115612_4">commit</span></b></a></pre>
</p></li></ol>
</li><li><span>Enable BGP to check, or disable BGP from checking, the first AS number in the AS_Path attribute of each Update message received from a specified EBGP peer or peer group.</span><ol><li class="substepexpand"><span>Enter the system view.</span><p><pre class="screen"><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></pre>
</p></li><li class="substepexpand"><span>Enter the BGP view.</span><p><pre class="screen"><a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></pre>
</p></li><li class="substepexpand"><span>Enable BGP to check, or disable BGP from checking, the first AS number in the AS_Path attribute of each Update message received from a specified EBGP peer or peer group.</span><p><pre class="screen"><a href="cmdqueryname=peer+check-first-as+enable+disable"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">group-name</span></i> | <i><span class="varname">ipv4-address</span></i> } <strong><span>check-first-as</span></strong> { <strong><span>enable</span></strong> | <strong><span>disable</span></strong> }</pre>
<p>If the <a href="cmdqueryname=peer+check-first-as"><b><span class="cmdname">peer check-first-as enable</span></b></a> command is run, BGP checks whether the first AS number in the AS_Path attribute of each Update message received from the specified EBGP peer or peer group is the same as the number of the AS where the EBGP peer or peer group resides. The two AS numbers must be the same. If the AS numbers are not the same, BGP rejects the Update message. After the <a href="cmdqueryname=peer+check-first-as+disable"><b><span class="cmdname">peer check-first-as disable</span></b></a> command is run, BGP no longer checks the first AS number in the AS_Path attribute of each Update message received from the specified EBGP peer or peer group. Even if the first AS number differs from the number of the AS where the specified EBGP peer or peer group resides, BGP still accepts the Update message. If the <a href="cmdqueryname=undo+peer"><b><span class="cmdname">undo peer</span></b></a> { <i><span class="varname">group-name</span></i> | <i><span class="varname">ipv4-address</span></i> } <strong><span>check-first-as</span></strong> { <strong><span>enable</span></strong> | <strong><span>disable</span></strong> } command is run, the related configuration for the specified EBGP peer or peer group will be deleted, and the default configuration will be used.</p>
<p>The check on the first AS number in the AS_Path attribute of each received Update message can be configured for a specified EBGP peer, the peer group that the EBGP peer belongs to, or the entire BGP process. The configuration takes effect in descending order of priority as follows: EBGP peer &gt; peer group &gt; entire BGP process.</p>
<p>After the configuration is modified, you can run the <a href="cmdqueryname=refresh+bgp"><b><span class="cmdname">refresh bgp</span></b></a> command to allow the new configuration to take effect immediately.</p>
</p></li><li class="substepexpand"><span>Commit the configuration.</span><p><pre class="screen" id="EN-US_TASK_0000001130783904__en-us_task_0234857734_screen14848162118611_5"><a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001130783904__en-us_task_0234857734_cmdname1784862115612_5">commit</span></b></a></pre>
</p></li></ol>
</li></ul></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="vrp_bgp_cfg_0021.html">Configuring BGP Route Attributes
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="vrp_bgp_cfg_0027.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="vrp_bgp_cfg_0029.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>