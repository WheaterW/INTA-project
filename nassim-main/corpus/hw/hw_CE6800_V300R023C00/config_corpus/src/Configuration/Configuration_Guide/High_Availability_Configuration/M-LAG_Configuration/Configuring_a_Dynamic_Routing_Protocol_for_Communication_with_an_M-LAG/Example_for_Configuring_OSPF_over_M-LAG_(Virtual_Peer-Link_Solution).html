
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring OSPF over M-LAG (Virtual Peer-Link Solution)">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../dc/dc_cfg_m-lag_0021.html">
<meta name="DC.Relation" scheme="URI" content="../dc/dc_cfg_ospf_cfgcase_0085_c.html">
<meta name="DC.Relation" scheme="URI" content="../dc/dc_cfg_ospf_cfgcase_1007.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="M-LAG">
<meta name="featuretype" content="High Availability">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="M-LAG">
<meta name="featuretype" content="High Availability">
<meta name="featurename" content="M-LAG">
<meta name="featuretype" content="High Availability">
<meta name="featuretype" content="High Availability">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001513048790">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="../public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring OSPF over M-LAG (Virtual Peer-Link Solution)</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001513048790"></a><a name="EN-US_TASK_0000001513048790"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring OSPF over M-LAG (Virtual Peer-Link Solution)</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001513048790__1.3.1"></a><a name="1.3.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><div class="note"><img src="../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>This configuration example is supported only by the <span>CE6866, CE6860-SAN, CE6866K, CE6860-HAM, CE8851-32CQ8DQ-P, CE8850-SAN, CE8851K, CE8850-HAM</span>, <span>CE8855, CE8851-32CQ4BQ, CE6855-48XS8CQ, CE6885, CE6885-SAN, CE6885-LL (standard forwarding mode), CE6885-T, and CE6863E-48S8CQ</span>.</p>
</div></div>
<p>On the network shown in <a href="#EN-US_TASK_0000001513048790__en-us_task_0241512178_en-us_task_0141119105_fig_dc_cfg_vxlan_cfgcase_000601">Figure 1</a>, DeviceA, DeviceB, and DeviceC constitute an M-LAG. The M-LAG member interfaces on DeviceB and DeviceC support OSPF. OSPF is configured on DeviceA so that it can communicate with the M-LAG through Layer 3 routes.</p>
<div class="fignone" id="EN-US_TASK_0000001513048790__en-us_task_0241512178_en-us_task_0141119105_fig_dc_cfg_vxlan_cfgcase_000601"><a name="EN-US_TASK_0000001513048790__en-us_task_0241512178_en-us_task_0141119105_fig_dc_cfg_vxlan_cfgcase_000601"></a><a name="en-us_task_0241512178_en-us_task_0141119105_fig_dc_cfg_vxlan_cfgcase_000601"></a><span class="figcap"><b>Figure 1 </b>Configuring OSPF over M-LAG (virtual peer-link solution)</span><div class="note"><img src="../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface 1 and interface 2 represent <span>100GE</span> <span>1/0/1</span> and <span>100GE</span> <span>1/0/2</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0000001513048830.png" width="NaN" height="NaN"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001513048790__1.3.2"></a><a name="1.3.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><div class="p">The configuration roadmap is as follows:<ol><li>Configure a routing protocol on DeviceB, DeviceC, and DeviceD to implement Layer 3 connectivity.</li><li>Create a bypass VXLAN tunnel between DeviceB and DeviceC.</li><li>Configure a routing policy to filter routing information of the bypass VXLAN tunnel on DeviceB and DeviceC, respectively.</li><li>Configure the uplink interface of the bypass VXLAN tunnel as an M-LAG reserved interface on DeviceB and DeviceC, respectively.</li><li><p>Configure V-STP.</p>
</li><li>Configure an M-LAG.<ol type="a"><li>Configure a DFS group on DeviceB and DeviceC, and bind IP addresses of their management interfaces to the DFS group.</li><li>Configure a virtual peer-link between DeviceB and DeviceC.</li><li>Configure a reserved VNI for the virtual peer-link solution on DeviceB and DeviceC, respectively.</li><li>Bind the user-side Eth-Trunk interface to the DFS group on DeviceB and DeviceC, respectively.</li></ol>
</li><li>Configure an IP address for OSPF over M-LAG.</li><li>Configure M-LAG member devices to use the specified IP address to establish OSPF neighbor relationships with DeviceA. Configure different OSPF areas for the access side and network side.</li></ol>
</div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001513048790__1.3.3"></a><a name="1.3.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure a routing protocol.</span><p><p># Configure DeviceB. The configurations of DeviceC and DeviceD are similar to the configuration of DeviceB. When configuring OSPF, configure the devices to advertise the 32-bit IP addresses of loopback interfaces.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname DeviceB</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB]<strong> interface <span>100ge</span> <span>1/0/1</span></strong>
[<span class="keyword">*</span>DeviceB-<span>100GE</span><span>1/0/1</span>]<strong> undo portswitch</strong>
[<span class="keyword">*</span>DeviceB-<span>100GE</span><span>1/0/1</span>]<strong> ip address 10.0.0.2 24</strong>
[<span class="keyword">*</span>DeviceB-<span>100GE</span><span>1/0/1</span>]<strong> quit</strong>
[<span class="keyword">*</span>DeviceB]<strong> interface loopback 0</strong>
[<span class="keyword">*</span>DeviceB-LoopBack0]<strong> ip address 10.5.5.5 32</strong>
[<span class="keyword">*</span>DeviceB-LoopBack0]<strong> quit</strong>
[<span class="keyword">*</span>DeviceB]<strong> commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB]<strong> ospf</strong> <strong>1 router-id 192.168.1.2</strong>
[<span class="keyword">*</span>DeviceB-ospf-1]<strong> area 0</strong>
[<span class="keyword">*</span>DeviceB-ospf-1-area-0.0.0.0]<strong> network 10.5.5.5 0.0.0.0</strong>
[<span class="keyword">*</span>DeviceB-ospf-1-area-0.0.0.0]<strong> network 10.0.0.0 0.0.0.255</strong>
[<span class="keyword">*</span>DeviceB-ospf-1-area-0.0.0.0]<strong> quit</strong>
[<span class="keyword">*</span>DeviceB-ospf-1]<strong> quit</strong>
[<span class="keyword">*</span>DeviceB]<strong> commit</strong></pre>
<p>After OSPF is configured successfully, DeviceB, DeviceC, and DeviceD can learn the IP address of each other's loopback interface through OSPF and successfully ping each other.</p>
</p></li><li><span>Create a static bypass VXLAN tunnel.</span><p><p># Configure DeviceB. The configuration of DeviceC is similar to that of DeviceB.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB]<strong> </strong><strong>interface nve 1</strong>
[<span class="keyword">*</span>DeviceB-Nve1]<strong> </strong><strong>pip-source 10.5.5.5 peer 10.6.6.6 bypass</strong>
[<span class="keyword">*</span>DeviceB-Nve1]<strong> </strong><strong>quit</strong>
[<span class="keyword">*</span>DeviceB]<strong> commit</strong></pre>
</p></li><li><span>Configure a routing policy to filter routing information of the bypass VXLAN tunnel.</span><p><p># Configure DeviceB. The configuration of DeviceC is similar to that of DeviceB.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB]<strong> ip ip-prefix </strong><strong>bypsssIp</strong><strong> index 10 permit 10.5.5.5 32</strong>
[<span class="keyword">*</span>DeviceB]<strong> </strong><strong>ip ip-prefix bypsssIp index 11 permit 10.6.6.6 32</strong>
[<span class="keyword">*</span>DeviceB]<strong> </strong><strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB]<strong> route-policy loopBackLimit deny node 10</strong>
[<span class="keyword">*</span>DeviceB-route-policy]<strong> </strong><strong>if-match ip-prefix bypsssIp</strong>
[<span class="keyword">*</span>DeviceB-route-policy]<strong> </strong><strong>quit</strong>
[<span class="keyword">*</span>DeviceB]<strong> route-policy loopBackLimit permit node 11</strong>
[<span class="keyword">*</span>DeviceB-route-policy]<strong> </strong><strong>quit</strong>
[<span class="keyword">*</span>DeviceB]<strong> </strong><strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB]<strong> ospf</strong> <strong>1</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB-ospf-1]<strong> area 0</strong>
[<span class="keyword">*</span>DeviceB-ospf-1-area-0.0.0.0]<strong> filter route-policy loopBackLimit</strong> <strong>export</strong>
[<span class="keyword">*</span>DeviceB-ospf-1-area-0.0.0.0]<strong> quit</strong>
[<span class="keyword">*</span>DeviceB-ospf-1]<strong> quit</strong>
[<span class="keyword">*</span>DeviceB]<strong> commit</strong></pre>
</p></li><li><span>Configure the uplink interface of the bypass VXLAN tunnel as an M-LAG reserved interface on DeviceB and DeviceC, respectively.</span><p><p># Configure DeviceB. The configuration of DeviceC is similar to that of DeviceB.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceB] <strong>interface <span>100ge</span> <span>1/0/1</span>    </strong>                                     
[*DeviceB-<span>100GE</span><span>1/0/1</span>] <strong>m-lag unpaired-port reserved</strong>
[*DeviceB-<span>100GE</span><span>1/0/1</span>] <strong>quit</strong>
[*DeviceB] <strong>commit</strong></pre>
</p></li><li><span>Configure V-STP.</span><p><p># Configure DeviceB. The configuration of DeviceC is similar to that of DeviceB.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB]<strong> stp mode rstp</strong>
[<span class="keyword">*</span>DeviceB]<strong> stp v-stp enable</strong>
[<span class="keyword">*</span>DeviceB]<strong> commit</strong></pre>
</p></li><li><span>Configure a DFS group on DeviceB and DeviceC, and bind IP addresses of their management interfaces to the DFS group. Ensure that DeviceB and DeviceC can communicate at Layer 3 through their management interfaces.</span><p><p># Configure DeviceB. The configuration of DeviceC is similar to that of DeviceB.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB]<strong> interface meth 0/0/0</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB-MEth0/0/0]<strong> ip address 10.200.1.1 24</strong>
[<span class="keyword">*</span>DeviceB-MEth0/0/0]<strong> quit</strong>
[<span class="keyword">*</span>DeviceB] <strong>dfs-group 1</strong>
[<span class="keyword">*</span>DeviceB-dfs-group-1] <strong>dual-active detection </strong><strong>source ip 10.200.1.1</strong><strong> peer </strong><strong>10.200.2.1</strong>
[<span class="keyword">*</span>DeviceB-dfs-group-1] <strong>authentication-mode hmac-sha256 password</strong> <strong>YsHsjx_202206</strong>
[<span class="keyword">*</span>DeviceB-dfs-group-1] <strong>quit</strong>
[<span class="keyword">*</span>DeviceB] <strong>commit</strong></pre>
</p></li><li><span>Configure a virtual peer-link between DeviceB and DeviceC.</span><p><p># Configure DeviceB. The configuration of DeviceC is similar to that of DeviceB.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB] <strong>interface eth-trunk 1</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB-Eth-Trunk1] <strong>peer-link 1</strong> <strong>virtual-link</strong>
[<span class="keyword">*</span>DeviceB-Eth-Trunk1] <strong>quit</strong>
[<span class="keyword">*</span>DeviceB] <strong>commit</strong></pre>
</p></li><li><span>Configure a reserved VNI for the virtual peer-link solution on DeviceB and DeviceC, respectively.</span><p><p># Configure DeviceB. The configuration of DeviceC is similar to that of DeviceB.</p>
</p><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB]<strong> </strong><strong>interface nve 1</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB-Nve1]<strong> </strong><strong>vni 10000 reserved for m-lag</strong>
[<span class="keyword">*</span>DeviceB-Nve1]<strong> </strong><strong>quit</strong>
[<span class="keyword">*</span>DeviceB]<strong> commit</strong></pre>
</p></li><li><span>Bind the user-side Eth-Trunk interface to the DFS group on DeviceB and DeviceC, respectively.</span><p><p># Configure DeviceB. The configuration of DeviceC is similar to that of DeviceB.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB] <strong>vlan batch 10</strong><strong>0</strong>
[<span class="keyword">*</span>DeviceB] <strong>interface eth-trunk 10</strong>
[<span class="keyword">*</span>DeviceB-Eth-Trunk10] <strong>mode lacp-static</strong>
[*DeviceB-Eth-Trunk10] <strong>port link-type trunk</strong> 
[*DeviceB-Eth-Trunk10] <strong>port trunk allow-pass vlan 10</strong><strong>0</strong>
[<span class="keyword">*</span>DeviceB-Eth-Trunk10] <strong>lacp mixed-rate link enable</strong>
[<span class="keyword">*</span>DeviceB-Eth-Trunk10] <strong>trunkport <span>100ge</span> <span>1/0/2</span></strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB-Eth-Trunk10] <strong>dfs-group 1 m-lag 1</strong>
[<span class="keyword">*</span>DeviceB-Eth-Trunk10] <strong>quit</strong>
[<span class="keyword">*</span>DeviceB] <strong>commit</strong></pre>
</p></li><li><span>Configure an Eth-Trunk interface on DeviceA.</span><p><p># Configure DeviceA.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname DeviceA</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>vlan batch 10</strong><strong>0</strong>
[<span class="keyword">*</span>DeviceA] <strong>interface eth-trunk 10</strong> 
[<span class="keyword">*</span>DeviceA-Eth-Trunk10] <strong>mode lacp-static</strong> 
[*DeviceA-Eth-Trunk10] <strong>port link-type trunk</strong> 
[*DeviceA-Eth-Trunk10] <strong>port trunk allow-pass vlan 10</strong><strong>0</strong>
[*DeviceA-Eth-Trunk10] <strong>trunkport <span>100ge</span> </strong><strong><span>1/0/1</span></strong>
[*DeviceA-Eth-Trunk10] <strong>trunkport <span>100ge</span> </strong><strong><span>1/0/2</span></strong>
[*DeviceA-Eth-Trunk10] <strong>quit</strong> 
[*DeviceA] <strong>commit</strong></pre>
</p></li><li><span>Configure an IP address for OSPF over M-LAG on DeviceB and DeviceC, respectively.</span><p><p># Configure DeviceB. The configuration of DeviceC is similar to that of DeviceB.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB] <strong>interface vlanif 10</strong><strong>0</strong>
[<span class="keyword">*</span>DeviceB-Vlanif100] <strong>ip address 10.100.0.1 255.255.255.0</strong>
[<span class="keyword">*</span>DeviceB-Vlanif100] <strong>ospf source sub-address 10.100.0.3</strong>
[<span class="keyword">*</span>DeviceB-Vlanif100] <strong>ospf enable 1 area 0.0.0.1</strong>
[<span class="keyword">*</span>DeviceB-Vlanif100] <strong>m-lag ip address 10.100.0.3 255.255.255.0</strong>
[<span class="keyword">*</span>DeviceB-Vlanif100] <strong>mac-address 0000-5e00-0101</strong>
[<span class="keyword">*</span>DeviceB-Vlanif100]<strong> arp proxy enable</strong>
[<span class="keyword">*</span>DeviceB-Vlanif100] <strong>quit</strong>
[<span class="keyword">*</span>DeviceB] <strong>commit</strong></pre>
</p></li><li><span>Configure M-LAG member devices to use the specified IP address to establish OSPF neighbor relationships with DeviceA. The ID of the OSPF area to which DeviceA, DeviceB, and DeviceC belong must be different from the ID of the OSPF area to which DeviceB, DeviceC, and DeviceD belong.</span><p><div class="p"># Configure DeviceB. The configuration of DeviceC is similar to that of DeviceB.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB]<strong> ospf</strong><strong> 1</strong>
[<span class="keyword">*</span>DeviceB-ospf-1]<strong> area 1</strong>
[<span class="keyword">*</span>DeviceB-ospf-1-area-0.0.0.1]<strong> network 10.100.0.0 0.0.0.255</strong>
[<span class="keyword">*</span>DeviceB-ospf-1-area-0.0.0.1]<strong> quit</strong>
[<span class="keyword">*</span>DeviceB-ospf-1]<strong> quit</strong>
[<span class="keyword">*</span>DeviceB]<strong> commit</strong></pre>
</div>
<p># Configure DeviceA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>interface vlanif 10</strong><strong>0</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA-Vlanif100] <strong>ip address 10.100.0.2 255.255.255.0</strong>
[<span class="keyword">*</span>DeviceA-Vlanif100] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>ospf</strong><strong> 1</strong>
[<span class="keyword">*</span>DeviceA-ospf-1]<strong> area 1</strong>
[<span class="keyword">*</span>DeviceA-ospf-1-area-0.0.0.1]<strong> network 10.100.0.0 0.0.0.255</strong>
[<span class="keyword">*</span>DeviceA-ospf-1-area-0.0.0.1]<strong> quit</strong>
[<span class="keyword">*</span>DeviceA-ospf-1]<strong> quit</strong>
[<span class="keyword">*</span>DeviceA]<strong> commit</strong></pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001513048790__1.3.4"></a><a name="1.3.4"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p># Run the <strong>display dfs-group 1 m-lag</strong> command to check M-LAG information.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB] <strong>display dfs-group 1 m-lag</strong>
*                     : Local node
Heart beat state      : OK
Node 1 *
  Dfs-Group ID        : 1
  Priority            : 100
  Dual-active Address : 10.200.1.1
  VPN-Instance        : public net
  State               : <strong>Master</strong>
  Causation           : -
  System ID           : 00e0-fc12-3457
  SysName             : DeviceB
  Version             : <span class="keyword">V300R023C00</span>
  Device Type         : <span>CE6860-SAN</span>
Node 2
  Dfs-Group ID        : 1
  Priority            : 100
  Dual-active Address : 10.200.2.1
  VPN-Instance        : public net
  State               : <strong>Backup</strong>
  Causation           : -
  System ID           : 00e0-fc12-3458
  SysName             : DeviceC
  Version             : <span class="keyword">V300R023C00</span>
  Device Type         : <span>CE6860-SAN</span></pre>
<p># Check M-LAG information on DeviceB.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB] <strong>display dfs-group 1 node 1 m-lag brief</strong>
* - Local node

M-Lag ID     Interface      Port State    Status                Consistency-check
       1     Eth-Trunk 10   <strong>Up</strong>            active(*)-active      --

Failed reason:
    1 -- Relationship between vlan and port is inconsistent
    2 -- STP configuration under the port is inconsistent
    3 -- STP port priority configuration is inconsistent
    4 -- LACP mode of M-LAG is inconsistent
    5 -- M-LAG configuration is inconsistent
    6 -- The number of M-LAG members is inconsistent
    7 -- LACP system-id of M-LAG is inconsistent
    8 -- LACP priority of M-LAG is inconsistent
    9 -- STP port edged configuration is inconsistent
    10 -- M-LAG mode configuration is inconsistent</pre>
<p># Check M-LAG information on DeviceC.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceC] <strong>display dfs-group 1 node 2 m-lag brief</strong>
* - Local node

M-Lag ID     Interface      Port State    Status                Consistency-check
       1     Eth-Trunk 10   <strong>Up</strong>            active-active(*)      --

Failed reason:
    1 -- Relationship between vlan and port is inconsistent
    2 -- STP configuration under the port is inconsistent
    3 -- STP port priority configuration is inconsistent
    4 -- LACP mode of M-LAG is inconsistent
    5 -- M-LAG configuration is inconsistent
    6 -- The number of M-LAG members is inconsistent
    7 -- LACP system-id of M-LAG is inconsistent
    8 -- LACP priority of M-LAG is inconsistent
    9 -- STP port edged configuration is inconsistent
    10 -- M-LAG mode configuration is inconsistent</pre>
<p>Run the <a href="cmdqueryname=display+ospf+peer+brief"><b><span class="cmdname">display ospf peer brief</span></b></a> command on DeviceB, DeviceC, and DeviceA to check OSPF neighbor information.</p>
<p># Check OSPF neighbor information on DeviceB.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB] <a href="cmdqueryname=display+ospf+peer+brief"><b><span class="cmdname">display ospf peer brief</span></b></a>
(M) Indicates MADJ interface
        OSPF Process 1 with Router ID 192.168.1.2                    
                  Peer Statistic Information   
  Total number of peer(s): 3                                                       
  Peer(s) in full state: 3   
  ----------------------------------------------------------------------------
  Area Id         Interface                  Neighbor id      State
  0.0.0.0         <span>100GE</span><span>1/0/1</span>                  192.168.1.1         Full
  0.0.0.1         Vlanif100                  192.168.1.3         Full  
  0.0.0.1         Vlanif100                  192.168.1.4         Full</pre>
<p># Check OSPF neighbor information on DeviceC.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceC] <a href="cmdqueryname=display+ospf+peer+brief"><b><span class="cmdname">display ospf peer brief</span></b></a>
(M) Indicates MADJ interface
        OSPF Process 1 with Router ID 192.168.1.3                    
                  Peer Statistic Information   
  Total number of peer(s): 3                                                       
  Peer(s) in full state: 3   
  ----------------------------------------------------------------------------
  Area Id         Interface                  Neighbor id      State
  0.0.0.0         <span>100GE</span><span>1/0/1</span>                  192.168.1.1         Full
  0.0.0.1         Vlanif100                  192.168.1.2         Full  
  0.0.0.1         Vlanif100                  192.168.1.4         Full</pre>
<p># Check OSPF neighbor information on DeviceA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <a href="cmdqueryname=display+ospf+peer+brief"><b><span class="cmdname">display ospf peer brief</span></b></a>
(M) Indicates MADJ interface
        OSPF Process 1 with Router ID 192.168.1.4                    
                  Peer Statistic Information   
  Total number of peer(s): 2                                                       
  Peer(s) in full state: 2   
  ----------------------------------------------------------------------------
  Area Id         Interface                  Neighbor id      State
  0.0.0.1         Vlanif100                  192.168.1.2         Full  
  0.0.0.1         Vlanif100                  192.168.1.3         Full</pre>
<p>After OSPF is configured successfully, run the <a href="cmdqueryname=display+ospf+peer+brief"><b><span class="cmdname">display ospf peer brief</span></b></a> command on DeviceD to check OSPF neighbor information.</p>
<p># Check OSPF neighbor information on DeviceD.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceD] <a href="cmdqueryname=display+ospf+peer+brief"><b><span class="cmdname">display ospf peer brief</span></b></a>
(M) Indicates MADJ interface
        OSPF Process 1 with Router ID 192.168.1.1                    
                  Peer Statistic Information   
  Total number of peer(s): 2                                                       
  Peer(s) in full state: 2   
  ----------------------------------------------------------------------------
  Area Id         Interface                  Neighbor id      State
  0.0.0.0         Vlanif100                  192.168.1.2         Full  
  0.0.0.0         Vlanif100                  192.168.1.3         Full</pre>
<p>After the bypass VXLAN tunnel is established successfully, check tunnel information. The command outputs on DeviceB and DeviceC are as follows:</p>
<p># Check bypass VXLAN tunnel information on DeviceB.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB] <strong><a href="cmdqueryname=display+vxlan+tunnel"><b><span class="cmdname">display vxlan tunnel</span></b></a></strong>  
                                                                                                           
Number of vxlan tunnel : 1                                                                                                          
Tunnel ID   Source                         Destination                    State  Type     Uptime

----------------------------------------------------------------------------------------------------                                
4026531844  10.5.5.5                       10.6.6.6                       up     static   00:30:48   </pre>
<p># Check bypass VXLAN tunnel information on DeviceC.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceC] <strong>display vxlan tunnel</strong>  
                                                                                                           
Number of vxlan tunnel : 1                                                                                                          
Tunnel ID   Source                         Destination                    State  Type     Uptime

----------------------------------------------------------------------------------------------------                                
4026531845  10.6.6.6                       10.5.5.5                       up     static   00:30:48   </pre>
</div>
<div class="postreq"><a name="EN-US_TASK_0000001513048790__1.3.5"></a><a name="1.3.5"></a><h4 class="sectiontitle">Configuration Scripts</h4><ul><li>DeviceA<pre class="screen">#
sysname DeviceA
#
vlan batch 100
#
interface Vlanif100
 ip address 10.100.0.2 255.255.255.0
#
interface Eth-Trunk10
 port link-type trunk
 port trunk allow-pass vlan 100
 mode lacp-static
#
interface <span>100GE</span><span>1/0/1</span>
 eth-trunk 10
#
interface <span>100GE</span><span>1/0/2</span>
 eth-trunk 10
#
ospf 1 router-id 192.168.1.4
 area 0.0.0.1
  network 10.100.0.0 0.0.0.255
#
return</pre>
</li><li><p>DeviceB</p>
<pre class="screen">#
sysname DeviceB
#
dfs-group 1
<strong> </strong>dual-active detection source ip 10.200.1.1 peer 10.200.2.1
 authentication-mode hmac-sha256 password %+%##!!!!!!!!!"!!!!"!!!!*!!!!C+tR0CW9x*eB&amp;pWp`t),Azgw-h\o8#4LZPD!!!!!!!!!!!!!!!9!!!!&gt;fwJ)I0E{=:%,*,XRhbH&amp;t0MCy_8=7!!!!!!!!!!%+%# 
#
vlan batch 100
#
stp mode rstp
stp v-stp enable
#
interface Vlanif100
 ip address 10.100.0.1 255.255.255.0
 ospf source sub-address 10.100.0.3
 ospf enable 1 area 0.0.0.1
 mac-address 0000-5e00-0101
 m-lag ip address 10.100.0.3 255.255.255.0
 arp proxy enable
#
interface Eth-Trunk1
  peer-link 1 virtual-link
#
interface Eth-Trunk10
 port link-type trunk
 port trunk allow-pass vlan 100
 mode lacp-static
 lacp mixed-rate link enable
 dfs-group 1 m-lag 1
#
interface MEth0/0/0
 ip address 10.200.1.1 255.255.255.0
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 10.0.0.2 255.255.255.0
 m-lag unpaired-port reserved
#
interface <span>100GE</span><span>1/0/2</span>
 eth-trunk 10
#
interface LoopBack0
 ip address 10.5.5.5 255.255.255.255
#
interface nve 1
 pip-source 10.5.5.5 peer 10.6.6.6 bypass
 vni 10000 reserved for m-lag
#
ip ip-prefix bypsssIp index 10 permit 10.5.5.5 32
ip ip-prefix bypsssIp index 11 permit 10.6.6.6 32
#
route-policy loopBackLimit deny node 10
 if-match ip-prefix bypsssIp
#
route-policy loopBackLimit permit node 11
#
ospf 1 router-id 192.168.1.2
 area 0.0.0.0
  filter route-policy loopBackLimit export
  network 10.5.5.5 0.0.0.0
  network 10.0.0.0 0.0.0.255
 area 0.0.0.1
  network 10.100.0.0 0.0.0.255
#
return</pre>
</li><li><p>DeviceC</p>
<pre class="screen">#
sysname DeviceC
#
dfs-group 1
 dual-active detection source ip 10.200.2.1 peer 10.200.1.1
 authentication-mode hmac-sha256 password %+%##!!!!!!!!!"!!!!"!!!!*!!!!=I9f8&gt;C{!P_bhB31@7r-=jrS8c|_"(Bn<font style="font-size:8pt" Face="Courier New" >~</font>#=!!!!!!!!!!!!!!!9!!!!kx-6@.tGA(wAt/IQXl6&gt;[g{6YlOi9$!!!!!!!!!!%+%#
#
vlan batch 100
#
stp mode rstp
stp v-stp enable
#
interface Vlanif100
 ip address 10.100.0.1 255.255.255.0
 ospf source sub-address 10.100.0.4
 ospf enable 1 area 0.0.0.1
 mac-address 0000-5e00-0101
 m-lag ip address 10.100.0.4 255.255.255.0
<strong> </strong>arp proxy enable
#
interface Eth-Trunk1
 peer-link 1 virtual-link
#
interface Eth-Trunk10
 port link-type trunk
 port trunk allow-pass vlan 100
 mode lacp-static
 lacp mixed-rate link enable
 dfs-group 1 m-lag 1
#
interface MEth0/0/0
 ip address 10.200.2.1 255.255.255.0
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 10.1.0.2 255.255.255.0
 m-lag unpaired-port reserved
#
interface <span>100GE</span><span>1/0/2</span>
 eth-trunk 10
#
interface LoopBack0
 ip address 10.6.6.6 255.255.255.255
#
interface nve 1
 pip-source 10.6.6.6 peer 10.5.5.5 bypass
<strong> </strong>vni 10000 reserved for m-lag
#
ip ip-prefix bypsssIp index 10 permit 10.6.6.6 32
ip ip-prefix bypsssIp index 11 permit 10.5.5.5 32
#
route-policy loopBackLimit deny node 10
 if-match ip-prefix bypsssIp
#
route-policy loopBackLimit permit node 11
#
ospf 1 router-id 192.168.1.3
 area 0.0.0.0
  filter route-policy loopBackLimit export
  network 10.6.6.6 0.0.0.0
  network 10.1.0.0 0.0.0.255
 area 0.0.0.1
  network 10.100.0.0 0.0.0.255
#
return</pre>
</li><li><p>DeviceD</p>
<pre class="screen">#
sysname DeviceD
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 10.0.0.1 255.255.255.0
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ip address 10.1.0.1 255.255.255.0
#
interface LoopBack1
 ip address 10.1.1.1 255.255.255.255
#
ospf 1 router-id 192.168.1.1
 area 0.0.0.0
  network 10.1.1.1 0.0.0.0
  network 10.0.0.0 0.0.0.255
  network 10.1.0.0 0.0.0.255
#
return</pre>
</li></ul>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../dc/dc_cfg_m-lag_0021.html">Configuring a Dynamic Routing Protocol for Communication with an M-LAG
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../dc/dc_cfg_ospf_cfgcase_0085_c.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../dc/dc_cfg_ospf_cfgcase_1007.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>