
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="concept">
<meta name="DC.Title" content="RADIUS CoA/DM">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="galaxy_aaa_cfg_0021.html">
<meta name="DC.Relation" scheme="URI" content="galaxy_aaa_cfg_0027.html">
<meta name="DC.Relation" scheme="URI" content="galaxy_aaa_cfg_0029.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="AAA">
<meta name="featurename" content="RADIUS">
<meta name="featuretype" content="User Access and Authentication">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="AAA">
<meta name="featurename" content="RADIUS">
<meta name="featuretype" content="User Access and Authentication">
<meta name="featurename" content="AAA">
<meta name="featurename" content="RADIUS">
<meta name="featuretype" content="User Access and Authentication">
<meta name="featurename" content="AAA">
<meta name="featurename" content="AD">
<meta name="featurename" content="HWTACACS">
<meta name="featurename" content="LDAP">
<meta name="featurename" content="RADIUS">
<meta name="featurename" content="Local User">
<meta name="featuretype" content="User Access and Authentication">
<meta name="featuretype" content="User Access and Authentication">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_CONCEPT_0000001513035594">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>RADIUS CoA/DM</title>
</head>
<body><a name="EN-US_CONCEPT_0000001513035594"></a><a name="EN-US_CONCEPT_0000001513035594"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">RADIUS CoA/DM</h1>
<div><p>The device supports the RADIUS Change of Authorization (CoA) and Disconnect Message (DM) functions.</p>
<ul><li>CoA provides a mechanism to change the rights of online users through RADIUS.</li><li>DM provides a mechanism to disconnect users. When a user needs to be disconnected, the RADIUS server sends a DM packet to the device.</li></ul>
<div class="section"><h4 class="sectiontitle">RADIUS CoA and DM Packets</h4><p><a href="#EN-US_CONCEPT_0000001513035594__tab-radius-3">Table 1</a> describes types of CoA and DM packets.</p>

<div class="tableBorder"><a name="EN-US_CONCEPT_0000001513035594__tab-radius-3"></a><a name="tab-radius-3"></a><table cellpadding="4" cellspacing="0" summary="" id="EN-US_CONCEPT_0000001513035594__tab-radius-3" frame="border" border="1" rules="all"><caption><b>Table 1 </b>RADIUS CoA and DM packets</caption><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="25%" id="mcps1.3.3.3.2.3.1.1" liSelected="liSelected"><p>Packet Name</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="75%" id="mcps1.3.3.3.2.3.1.2" liSelected="liSelected"><p>Description</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" valign="top" width="25%" headers="mcps1.3.3.3.2.3.1.1 "><p>CoA-Request</p>
</td>
<td class="cellrowborder" valign="top" width="75%" headers="mcps1.3.3.3.2.3.1.2 "><p>When an administrator needs to modify the rights of an online user (for example, prohibit the user from accessing a website), the RADIUS server sends this packet to the RADIUS client, requesting the client to modify the user rights.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="25%" headers="mcps1.3.3.3.2.3.1.1 "><p>CoA-ACK</p>
</td>
<td class="cellrowborder" valign="top" width="75%" headers="mcps1.3.3.3.2.3.1.2 "><p>If the RADIUS client successfully modifies the user rights, it returns this packet to the RADIUS server.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="25%" headers="mcps1.3.3.3.2.3.1.1 "><p>CoA-NAK</p>
</td>
<td class="cellrowborder" valign="top" width="75%" headers="mcps1.3.3.3.2.3.1.2 "><p>If the RADIUS client fails to modify the user rights, it returns this packet to the RADIUS server.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="25%" headers="mcps1.3.3.3.2.3.1.1 "><p>DM-Request</p>
</td>
<td class="cellrowborder" valign="top" width="75%" headers="mcps1.3.3.3.2.3.1.2 "><p>When an administrator needs to disconnect a user, the RADIUS server sends this packet to the RADIUS client, requesting the client to disconnect the user.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="25%" headers="mcps1.3.3.3.2.3.1.1 "><p>DM-ACK</p>
</td>
<td class="cellrowborder" valign="top" width="75%" headers="mcps1.3.3.3.2.3.1.2 "><p>If the RADIUS client has disconnected the user, it returns this packet to the RADIUS server.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="25%" headers="mcps1.3.3.3.2.3.1.1 "><p>DM-NAK</p>
</td>
<td class="cellrowborder" valign="top" width="75%" headers="mcps1.3.3.3.2.3.1.2 "><p>If the RADIUS client fails to disconnect the user, it returns this packet to the RADIUS server.</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section"><h4 class="sectiontitle">Exchange Procedure</h4><p><a href="#EN-US_CONCEPT_0000001513035594__fig_dc_fd_aaa_601901">Figure 1</a> shows the CoA exchange process.</p>
<div class="fignone" id="EN-US_CONCEPT_0000001513035594__fig_dc_fd_aaa_601901"><a name="EN-US_CONCEPT_0000001513035594__fig_dc_fd_aaa_601901"></a><a name="fig_dc_fd_aaa_601901"></a><span class="figcap"><b>Figure 1 </b>CoA exchange process</span><br><span><img class="vsd" src="figure/en-us_image_0000001563995929.png" width="NaN" height="NaN"></span></div>
<ol><li>The RADIUS server sends a CoA-Request packet to the device according to service information, requesting the device to modify user authorization information. This packet can contain authorization information including ACLs.</li><li>Upon receiving the CoA-Request packet, the device checks whether the attributes in the packet match user information on the device to identify the user. If the match is successful, the device modifies authorization information of the user. Otherwise, the device retains the original authorization information of the user.</li><li>The device returns a CoA-ACK or CoA-NAK packet:<ul><li>If authorization information is successfully modified, the device sends a CoA-ACK packet to the RADIUS server.</li><li>If authorization information fails to be modified, the device sends a CoA-NAK packet to the RADIUS server. If the user does not exist, the device does not respond.</li></ul>
</li></ol>
<p><a href="#EN-US_CONCEPT_0000001513035594__fig_dc_fd_aaa_601902">Figure 2</a> shows the DM exchange process.</p>
<div class="fignone" id="EN-US_CONCEPT_0000001513035594__fig_dc_fd_aaa_601902"><a name="EN-US_CONCEPT_0000001513035594__fig_dc_fd_aaa_601902"></a><a name="fig_dc_fd_aaa_601902"></a><span class="figcap"><b>Figure 2 </b>DM exchange process</span><br><span><img class="vsd" src="figure/en-us_image_0000001512676538.png" width="NaN" height="NaN"></span></div>
<ol><li>The administrator disconnects a user on the RADIUS server. The RADIUS server sends a DM-Request packet to the device, requesting the device to disconnect the user.</li><li>Upon receiving the DM-Request packet, the device checks whether the attributes in the packet match user information on the device to identify the user. If the match is successful, the device instructs the user to go offline. Otherwise, the user remains online.</li><li><p>The device returns a DM-ACK or DM-NAK packet:</p>
<ul><li>If the user successfully goes offline, the device sends a DM-ACK packet to the RADIUS server.</li><li>If the user remains online, the device sends a DM-NAK packet to the RADIUS server. If the user does not exist, the device does not respond.</li></ul>
</li></ol>
<p>In the CoA/DM process, the server sends a request packet to the device, which then sends a response packet. This process is different from the process in which authorization is performed for an online user or a user proactively goes offline. If the CoA/DM process is successful, the device returns an ACK packet. Otherwise, the device returns a NAK packet.</p>
</div>
<div class="section"><h4 class="sectiontitle">Session Identification</h4><div class="p">After the device receives a CoA-Request or DM-Request packet from the RADIUS server, it identifies the user based on some RADIUS attributes in the packet. The following RADIUS attributes can be used to identify users:<ul><li>Standard RADIUS attribute: User-Name (1)</li><li>Standard RADIUS attribute: Acct-Session-ID (44)</li><li>Standard RADIUS attribute: Framed-IP-Address (8)</li></ul>
</div>
<p>The match methods are as follows:</p>
<ul><li><p><strong>any</strong> method</p>
<p>The device checks whether a RADIUS attribute matches user information on the device. It identifies the RADIUS attributes used by the users in the sequence listed: Acct-Session-ID (44) &gt; Framed-IP-Address (8). The device then checks whether the first found attribute matches user information on the device. If the match is successful, the device responds with an ACK packet; otherwise, the device responds with a NAK packet.</p>
</li><li><p><strong>all</strong> method</p>
<p>The device checks whether all RADIUS attributes match user information on the device. It identifies the following RADIUS attributes used by the users in the sequence listed: Acct-Session-ID (44), Framed-IP-Address (8), and User-Name (1). The device then checks whether all the preceding attributes in the request packet match user information on the device. If the match is successful, the device responds with an ACK packet; otherwise, the device responds with a NAK packet.</p>
</li></ul>
</div>
<div class="section"><h4 class="sectiontitle">Error Codes</h4><p>When RADIUS attributes in the CoA-Request or DM-Request packet from the RADIUS server fail to match user information on the device, the device describes the failure causes using the error codes in the CoA-NAK or DM-NAK packet. For details about the error codes, see <a href="#EN-US_CONCEPT_0000001513035594__coa-err">Table 2</a> and <a href="#EN-US_CONCEPT_0000001513035594__dm-err">Table 3</a>.</p>

<div class="tableBorder"><a name="EN-US_CONCEPT_0000001513035594__coa-err"></a><a name="coa-err"></a><table cellpadding="4" cellspacing="0" summary="" id="EN-US_CONCEPT_0000001513035594__coa-err" frame="border" border="1" rules="all"><caption><b>Table 2 </b>Error codes in a CoA-NAK packet</caption><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="27.79%" id="mcps1.3.6.3.2.4.1.1" liSelected="liSelected"><p>Name</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="12.61%" id="mcps1.3.6.3.2.4.1.2" liSelected="liSelected"><p>Value</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="59.599999999999994%" id="mcps1.3.6.3.2.4.1.3" liSelected="liSelected"><p>Description</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" valign="top" width="27.79%" headers="mcps1.3.6.3.2.4.1.1 "><p>RD_DM_ERRCODE_MISSING_ATTRIBUTE</p>
</td>
<td class="cellrowborder" valign="top" width="12.61%" headers="mcps1.3.6.3.2.4.1.2 "><p>402</p>
</td>
<td class="cellrowborder" valign="top" width="59.599999999999994%" headers="mcps1.3.6.3.2.4.1.3 "><p>The request packet lacks key attributes, so the integrity check of RADIUS attributes fails.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="27.79%" headers="mcps1.3.6.3.2.4.1.1 "><p>RD_DM_ERRCODE_INVALID_REQUEST</p>
</td>
<td class="cellrowborder" valign="top" width="12.61%" headers="mcps1.3.6.3.2.4.1.2 "><p>404</p>
</td>
<td class="cellrowborder" valign="top" width="59.599999999999994%" headers="mcps1.3.6.3.2.4.1.3 "><p>Parsing the attributes in the request packet fails.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="27.79%" headers="mcps1.3.6.3.2.4.1.1 "><p>RD_DM_ERRCODE_INVALID_ATTRIBUTE_VALUE</p>
</td>
<td class="cellrowborder" valign="top" width="12.61%" headers="mcps1.3.6.3.2.4.1.2 "><p>407</p>
</td>
<td class="cellrowborder" valign="top" width="59.599999999999994%" headers="mcps1.3.6.3.2.4.1.3 "><p>The request packet contains the attributes that are not supported by the device or do not exist, so the attribute check fails.</p>
<p>The authorization check involves VLAN, ACL, CAR, number of the ACL used for redirection, and whether Huawei RADIUS extended attributes RD_hw_URL_Flag and RD_hw_Portal_URL can be authorized to the interface-based authenticated user.</p>
<p>Possible errors are as follows:</p>
<ul><li>The authorized service scheme does not exist.</li><li>The authorized QoS profile does not exist or no user queue is configured in the QoS profile.</li><li>The authorized values of upstream and downstream priorities exceed the maximum values.</li><li>The ISP VLAN and outbound interface information are incorrectly parsed.</li><li>Reauthentication attributes and other attributes are authorized simultaneously.</li></ul>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="27.79%" headers="mcps1.3.6.3.2.4.1.1 "><p>RD_DM_ERRCODE_SESSION_CONTEXT_NOT_FOUND</p>
</td>
<td class="cellrowborder" valign="top" width="12.61%" headers="mcps1.3.6.3.2.4.1.2 "><p>503</p>
</td>
<td class="cellrowborder" valign="top" width="59.599999999999994%" headers="mcps1.3.6.3.2.4.1.3 "><p>The session request fails:</p>
<ul><li>Authorization for the current user is being processed.</li><li>The temporary RADIUS table cannot be requested.</li><li>User information does not match or no user is found.</li><li>The user is a non-RADIUS authenticated user.</li></ul>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="27.79%" headers="mcps1.3.6.3.2.4.1.1 "><p>RD_DM_ERRCODE_RESOURCES_UNAVAILABLE</p>
</td>
<td class="cellrowborder" valign="top" width="12.61%" headers="mcps1.3.6.3.2.4.1.2 "><p>506</p>
</td>
<td class="cellrowborder" valign="top" width="59.599999999999994%" headers="mcps1.3.6.3.2.4.1.3 "><p>This error code is used for other authorization failures.</p>
</td>
</tr>
</tbody>
</table>
</div>

<div class="tableBorder"><a name="EN-US_CONCEPT_0000001513035594__dm-err"></a><a name="dm-err"></a><table cellpadding="4" cellspacing="0" summary="" id="EN-US_CONCEPT_0000001513035594__dm-err" frame="border" border="1" rules="all"><caption><b>Table 3 </b>Error codes in a DM-NAK packet</caption><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="27.79%" id="mcps1.3.6.4.2.4.1.1" liSelected="liSelected"><p>Name</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="12.61%" id="mcps1.3.6.4.2.4.1.2" liSelected="liSelected"><p>Value</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="59.599999999999994%" id="mcps1.3.6.4.2.4.1.3" liSelected="liSelected"><p>Description</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" valign="top" width="27.79%" headers="mcps1.3.6.4.2.4.1.1 "><p>RD_DM_ERRCODE_NAS_IDENTIFICATION_MISMATCH</p>
</td>
<td class="cellrowborder" valign="top" width="12.61%" headers="mcps1.3.6.4.2.4.1.2 "><p>403</p>
</td>
<td class="cellrowborder" valign="top" width="59.599999999999994%" headers="mcps1.3.6.4.2.4.1.3 "><p>The user information in the request packet does not match the user information on the device.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="27.79%" headers="mcps1.3.6.4.2.4.1.1 "><p>RD_DM_ERRCODE_INVALID_REQUEST</p>
</td>
<td class="cellrowborder" valign="top" width="12.61%" headers="mcps1.3.6.4.2.4.1.2 "><p>404</p>
</td>
<td class="cellrowborder" valign="top" width="59.599999999999994%" headers="mcps1.3.6.4.2.4.1.3 "><p>Parsing the attributes in the request packet fails.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="27.79%" headers="mcps1.3.6.4.2.4.1.1 "><p>RD_DM_ERRCODE_SESSION_CONTEXT_NOT_REMOVABLE</p>
</td>
<td class="cellrowborder" valign="top" width="12.61%" headers="mcps1.3.6.4.2.4.1.2 "><p>504</p>
</td>
<td class="cellrowborder" valign="top" width="59.599999999999994%" headers="mcps1.3.6.4.2.4.1.3 "><p>Failed to delete the user.</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="galaxy_aaa_cfg_0021.html">Understanding RADIUS-based AAA
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="galaxy_aaa_cfg_0027.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="galaxy_aaa_cfg_0029.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>