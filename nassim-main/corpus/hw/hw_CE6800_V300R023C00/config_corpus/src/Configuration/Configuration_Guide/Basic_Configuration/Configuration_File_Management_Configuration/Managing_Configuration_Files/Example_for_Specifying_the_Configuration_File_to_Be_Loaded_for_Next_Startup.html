
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Specifying the Configuration File to Be Loaded for Next Startup">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="vrp_cfgfile_cfg_0004.html">
<meta name="DC.Relation" scheme="URI" content="vrp_cfgfile_cfg_0026.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="Configuration File Management">
<meta name="featuretype" content="Basic Configuration">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="Configuration File Management">
<meta name="featuretype" content="Basic Configuration">
<meta name="featurename" content="Configuration File Management">
<meta name="featuretype" content="Basic Configuration">
<meta name="featuretype" content="Basic Configuration">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001563770617">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>Example for Specifying the Configuration File to Be Loaded for Next Startup</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001563770617"></a><a name="EN-US_TASK_0000001563770617"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Specifying the Configuration File to Be Loaded for Next Startup</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001563770617__1.3.1"></a><a name="1.3.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>As shown in <a href="#EN-US_TASK_0000001563770617__fig74331217517">Figure 1</a>, the current system software cannot meet user needs. The device must load new software version with more features. Then the device software needs to be upgraded remotely.</p>
<div class="fignone" id="EN-US_TASK_0000001563770617__fig74331217517"><a name="EN-US_TASK_0000001563770617__fig74331217517"></a><a name="fig74331217517"></a><span class="figcap"><b>Figure 1 </b>Network diagram of specifying the configuration file to be loaded for next startup</span><br><span><img src="figure/en-us_image_0000001927089573.png"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001563770617__1.3.2"></a><a name="1.3.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap </h4><p>The configuration roadmap is as follows:</p>
<ol><li>Upload the new system software to the root directory of the device.</li><li>Save the current configuration so that it remains effective after upgrade.</li><li>Specify the system software to be loaded for next startup.</li><li>Specify the configuration file to be loaded for next startup.</li><li>Restart the device to complete upgrade.</li></ol>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001563770617__1.3.3"></a><a name="1.3.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Upload the new system software to the root directory of the device.</span><p><ol type="a"><li>Before configuration, run the <a href="cmdqueryname=display+startup"><b><span class="cmdname">display startup</span></b></a> command to view the files for next startup. (The actual command output varies depending on the device. The following command output is only an example.)<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt;<strong> display startup</strong>
MainBoard:   
  Configured startup system software:        flash:/basicsoft.cc   
  Startup system software:                   flash:/basicsoft.cc   
  Next startup system software:              flash:/basicsoft.cc   
  Startup saved-configuration file:          flash:/vrpcfg.zip   
  Next startup saved-configuration file:     flash:/vrpcfg.zip   
  Startup paf file:                          default   
  Next startup paf file:                     default   
  Startup patch package:                     NULL   
  Next startup patch package:                NULL
  Startup feature software:                  NULL
  Next startup feature software:             NULL
  Startup extended-system software:          NULL
  Next startup extended-system software:     NULL</pre>
</li><li>Configure the device as an SFTP server.<p>Upload the new system software to the device. This example uses SFTP to transfer the system software. Configure the device as an SFTP server and upload the system software to the device from the SFTP client. Ensure that there is enough space in the storage medium before uploading files. If the space is insufficient, delete unnecessary files from the storage medium.</p>
<p># Configure an IP address for the SFTP server.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt;<strong> system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>]<strong> sysname SSH Server</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong>
[<span class="keyword">*</span>SSH Server] <strong>interface <span>100ge</span> <span>1/0/1</span></strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SSH Server-<span>100GE</span><span>1/0/1</span>] <strong>undo portswitch</strong>
[<span class="keyword">*</span>SSH Server-<span>100GE</span><span>1/0/1</span>] <strong>ip address 10.1.1.1 255.255.255.0</strong>
[<span class="keyword">*</span>SSH Server-<span>100GE</span><span>1/0/1</span>] <strong>quit</strong>
[<span class="keyword">*</span>SSH Server] <strong>commit</strong></pre>
<p># Configure the public key algorithm, encryption algorithm, key exchange algorithm list, HMAC authentication algorithm, and minimum key length on the SSH server.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SSH Server] <strong>ssh server cipher aes128_ctr aes256_ctr aes192_ctr aes128_gcm aes256_gcm</strong>
[<span class="keyword">*</span>SSH Server] <strong>ssh server hmac sha2_256 sha2_512</strong>
[<span class="keyword">*</span>SSH Server] <strong>ssh server key-exchange dh_group_exchange_sha256</strong> <strong>dh_group16_sha512</strong>
[<span class="keyword">*</span>SSH Server] <strong>ssh server publickey rsa_sha2_256 rsa_sha2_512</strong>
[<span class="keyword">*</span>SSH Server]<strong> ssh server dh-exchange min-len 3072</strong>
[<span class="keyword">*</span>SSH Server] <strong>commit</strong></pre>
<p># On the server, generate a local key pair and enable the SFTP server function.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SSH Server]<strong> sftp server enable</strong>
<span><span>[<span class="keyword">*</span>SSH Server]</span> <strong>ssh server-source all-interface</strong></span>
[<span class="keyword">*</span>SSH Server] <strong>commit</strong></pre>
<p># Configure SSH user information including the authentication mode<span>, service type, authorized directory</span>, user name, and password.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SSH Server]<strong> ssh user <span><strong>client</strong></span> authentication-type password</strong>
Info: Succeeded in adding a new SSH user. 
<span>[<span class="keyword">*</span>SSH Server]<strong> ssh user client service-type sftp</strong>
[<span class="keyword">*</span>SSH Server]<strong> ssh user <span><strong>client</strong></span> sftp-directory <span><span><span>flash</span></span>:</span> </strong></span>
<span>[<span class="keyword">*</span>SSH Server]</span> <span><strong>aaa</strong></span>
<span>[<span class="keyword">*</span>SSH Server-aaa]<strong> local-user client password</strong></span>
Please configure the login password (8-128)
It is recommended that the password consist of of four types of characters, including lowercase letters, uppercase letters, numerals and special characters. 
Please enter password:                                      
Please confirm password:                               
Info: Add a new user.
<span>[<span class="keyword">*</span>SSH Server-aaa] <strong>local-user client privilege level 3</strong></span>
<span>[<span class="keyword">*</span>SSH Server-aaa] <strong>local-user <span><strong>client</strong></span> service-type ssh</strong></span>
<span>[<span class="keyword">*</span>SSH Server-aaa] <strong>quit</strong></span>
[<span class="keyword">*</span>SSH Server] <strong>commit</strong></pre>
<p># Configure access permissions on the SSH server.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SSH Server] <strong>acl 2000</strong>
[<span class="keyword">*</span>SSH Server-acl4-basic-2000] <strong>rule permit source 10.1.1.0 24</strong>
[<span class="keyword">*</span>SSH Server-acl4-basic-2000] <strong>quit</strong>
[<span class="keyword">*</span>SSH Server] <strong>ssh server acl 2000</strong>
[<span class="keyword">*</span>SSH Server] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SSH Server] <strong>quit</strong></pre>
</li><li>Run the <strong>sftp 10.1.1.1</strong> command in the CLI window of the PC to set up an SFTP connection with the device. Run the <strong>put</strong> command to upload new system software <strong>newbasicsoft.cc</strong>.<div class="p">After the system software is successfully uploaded, run the <strong>dir</strong> command on the SSH server to view the uploaded system software.<pre class="screen">&lt;<span class="keyword">SSH Server</span>&gt; <strong>dir</strong>
Directory of <span><strong> <span><span><span>flash</span></span></span></strong></span>:/

  Idx  Attr     Size(Byte)  Date        Time       FileName
    0  drw-              -  Apr 16 2012 13:19:58   logfile
    1  -rw-     85,925,409  Apr 16 2012 13:18:02   basicsoft.cc
    2  -rw-              4  Oct 27 2011 17:25:22   snmpnotilog.txt
    3  -rw-          6,033  Jul 16 2012 16:40:02   private-data.txt
    4  -rw-          3,275  Jul 14 2012 14:18:08   vrpcfg.zip
    5  drw-              -  Nov 14 2011 19:14:26   sysdrv 
    6  drw-     88,239,759  Jul 16 2012 19:14:26   <strong>newbasicsoft.cc</strong>
...

670,092 KB total (569,904 KB free)</pre>
</div>
</li></ol>
</p></li><li><span>Save the current configuration.</span><p><pre class="screen"><span class="keyword">&lt;SSH Server&gt;</span> <strong>save</strong></pre>
<p>The system displays a message indicating that the current configuration will be saved and asks you whether to continue. Enter <strong>y</strong> and the configuration will be saved to the device.</p>
</p></li><li><span>Specify the system software to be loaded for next startup.</span><p><pre class="screen">&lt;SSH Server&gt; <strong>startup system-software newbasicsoft.cc</strong></pre>
</p></li><li><span>Specify the configuration file to be loaded for next startup.</span><p><pre class="screen">&lt;SSH Server&gt;<strong> startup saved-configuration vrpcfg.zip</strong></pre>
<div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In step 1, you can run the <a href="cmdqueryname=display+startup"><b><span class="cmdname">display startup</span></b></a> command to check the configuration file for next startup. The message "Next startup saved-configuration file: <span><span>flash</span></span>:/<strong>vrpcfg.zip</strong>" will be displayed. This means that the <strong>vrpcfg.zip</strong> configuration file has been specified for next startup, so skip this step. To specify another file for next startup, perform this step.</p>
</div></div>
</p></li><li><span>Verify the configuration.</span><p><p>Run the following command to view the system software and configuration file for next startup. (The actual command output varies depending on the device. The following command output is only an example.)</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt;<strong> display startup</strong>
MainBoard:   
  Configured startup system software:        flash:/basicsoft.cc   
  Startup system software:                   flash:/basicsoft.cc   
  Next startup system software:              flash:/<strong>newbasicsoft.cc</strong>   
  Startup saved-configuration file:          flash:/vrpcfg.zip   
  Next startup saved-configuration file:     flash:/<strong>vrpcfg</strong>.zip   
  Startup paf file:                          default   
  Next startup paf file:                     default   
  Startup patch package:                     NULL   
  Next startup patch package:                NULL
  Startup feature software:                  NULL
  Next startup feature software:             NULL
  Startup extended-system software:          NULL
  Next startup extended-system software:     NULL</pre>
</p></li><li><span>Restart the device.</span><p><p># Because the configuration file has been saved, run the following command to restart the device quickly.</p>
<pre class="screen">&lt;SSH Server&gt;<strong> reboot fast</strong></pre>
<p>When the system asks you whether to continue with a system restart, enter <strong>y</strong>.</p>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001563770617__1.3.4"></a><a name="1.3.4"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p># Wait for several minutes until the device restart is complete. Run the <strong>display version</strong> command to check the current system version. If the current system software is new, the upgrade has succeeded.</p>
</div>
<div class="postreq"><a name="EN-US_TASK_0000001563770617__1.3.5"></a><a name="1.3.5"></a><h4 class="sectiontitle">Configuration Scripts</h4><pre class="screen">#
sysname SSH Server
#
acl number 2000
 rule 5 permit source 10.1.1.0 0.0.0.255
#
aaa
 local-user <span>client</span> password irreversible-cipher $1d$+,JS+))\\2$KVNj(.3`_5x0FCKGv}H&amp;.kUTI`Ff&amp;H*eBqO.ua&gt;)$
 local-user <span>client</span> service-type ssh
 local-user client privilege level 3
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 10.1.1.1 255.255.255.0
#
sftp server enable
ssh server-source all-interface
ssh server acl 2000
ssh user <span>client</span>
ssh user <span>client</span> authentication-type password
ssh user <span>client</span> service-type sftp
ssh user <span>client</span> sftp-directory <span><span>flash</span></span>:
#
ssh server cipher aes128_ctr aes256_ctr aes192_ctr aes128_gcm aes256_gcm
ssh server hmac sha2_256 sha2_512
ssh server key-exchange dh_group_exchange_sha256 dh_group16_sha512
ssh server publickey rsa_sha2_256 rsa_sha2_512
ssh server dh-exchange min-len 3072
#
return</pre>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="vrp_cfgfile_cfg_0004.html">Managing Configuration Files
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="vrp_cfgfile_cfg_0026.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>
</body>
</html>