
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring a BGP RR">
<meta name="abstract" content="">
<meta name="description" content="">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="vrp_bgp_cfg_0073.html">
<meta name="DC.Relation" scheme="URI" content="vrp_bgp_cfg_0074.html">
<meta name="DC.Relation" scheme="URI" content="vrp_bgp_cfg_0076.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing">
<meta name="featuretype" content="IP Routing">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001130783898">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>Configuring a BGP RR</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001130783898"></a><a name="EN-US_TASK_0000001130783898"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring a BGP RR</h1>
<div class="taskbody"><p></p>
<div class="prereq" style="margin-left:0"><a name="EN-US_TASK_0000001130783898__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Prerequisites</h4>
<div class="p"><p>Before configuring a BGP RR, you have completed the following task:</p>
<ul><li><a href="vrp_bgp_cfg_0014.html">Configure basic BGP functions.</a></li></ul>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001130783898__1.4.2"></a><a name="1.4.2"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>In an AS, one BGP device functions as an RR, and the other BGP devices function as clients. The clients establish IBGP connections to the RR. The RR and its clients form a cluster. The RR reflects routes among the clients, and therefore the clients do not need to establish any IBGP connection.</p>
<p>The RR is simple to configure. You only need to configure the route reflection function on the BGP device that is to function as the RR. The clients do not need to know that they are clients of the RR.</p>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001130783898__1.4.3"></a><a name="1.4.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Enter the system view.</span><p><pre class="screen"><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></pre>
</p></li><li><span>Enter the BGP view.</span><p><pre class="screen"><a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></pre>
</p></li><li><span>Enter the BGP-IPv4 unicast address family view.</span><p><pre class="screen"><a href="cmdqueryname=ipv4-family+unicast"><b><span class="cmdname">ipv4-family</span></b></a> <strong><span>unicast</span></strong></pre>
</p></li><li><span>Specify an RR and its clients.</span><p><pre class="screen"><a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> | <i><span class="varname">ipv6-address</span></i> } <a href="cmdqueryname=reflect-client"><b><span class="cmdname">reflect-client</span></b></a></pre>
<p>The device with the <a href="cmdqueryname=peer+reflect-client"><b><span class="cmdname">peer reflect-client</span></b></a> command configuration functions as an RR, and the specified peer or peer group functions as a client.</p>
<div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The configuration of an RR and its clients in an address family is valid only in this address family and cannot be used in other address families. Therefore, configure RRs and clients in a required address family.</p>
</div></div>
</p></li><li><span>Disable route reflection between clients through the RR.</span><p><pre class="screen"><a href="cmdqueryname=undo+reflect+between-clients"><b><span class="cmdname">undo reflect between-clients</span></b></a></pre>
<p>By default, route reflection between clients through an RR is enabled.</p>
<p>If the clients of an RR have established full-mesh connections with each other, you can run the <a href="cmdqueryname=undo+reflect+between-clients"><b><span class="cmdname">undo reflect between-clients</span></b></a> command to disable route reflection between clients through the RR to reduce the overhead. The <a href="cmdqueryname=undo+reflect+between-clients"><b><span class="cmdname">undo reflect between-clients</span></b></a> command is run only on RRs.</p>
</p></li><li><span>(Optional) Set a cluster ID of the RR.</span><p><pre class="screen"><a href="cmdqueryname=reflector+cluster-id"><b><span class="cmdname">reflector cluster-id</span></b></a> { <em>cluster-id-value</em> | <i><span class="varname">cluster-id-ipv4</span></i> }</pre>
<p>If a cluster has multiple RRs, you can use this command to set the same cluster ID for these RRs to prevent routing loops. </p>
<p>The <a href="cmdqueryname=reflector+cluster-id"><b><span class="cmdname">reflector cluster-id</span></b></a> command is run only on RRs.</p>
<div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>To prevent clients' failures to learn routes reflected by RRs, ensure that the cluster ID of the RRs is different from the router ID of any client. If the cluster ID of the RRs is the same as the router ID of a client, the client will discard received routes.</p>
</div></div>
</p></li><li><span>(Optional) Disable the device from adding preferred BGP routes to the IP routing table.</span><p><pre class="screen"><a href="cmdqueryname=routing-table+rib-only+route-policy"><b><span class="cmdname">routing-table rib-only</span></b></a> [ <strong><span>route-policy</span></strong> <i><span class="varname">route-policy-name</span></i> ]</pre>
<p>By default, preferred BGP routes are added to the IP routing table. If the device is not required to forward packets, you can disable BGP routes from being added to the IP routing table.</p>
<p>If the <strong><span>route-policy</span></strong> <i><span class="varname">route-policy-name</span></i> parameter is specified in the <a href="cmdqueryname=routing-table+rib-only"><b><span class="cmdname">routing-table rib-only</span></b></a> command, the routes that match the route-policy are not delivered to the IP routing table, and the routes that do not match the route-policy are delivered to the IP routing table with their route attributes unchanged.</p>
<p>Preventing a device from adding BGP routes to the IP routing table is mainly used in RR scenarios. An RR transmits routes and forwards traffic within an AS. If an RR is connected to many clients and non-clients, route transmission will consume a lot of CPU resources of the RR and cause the RR to be unable to implement traffic forwarding. To improve route transmission efficiency, prevent the RR from adding BGP routes to the IP routing table.</p>
<div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The <a href="cmdqueryname=routing-table+rib-only"><b><span class="cmdname">routing-table rib-only</span></b></a> and <a href="cmdqueryname=active-route-advertise"><b><span class="cmdname">active-route-advertise</span></b></a> commands are mutually exclusive.</p>
</div></div>
</p></li><li><span>(Optional) Enable the RR to modify path attributes of routes to be advertised based on the export policy.</span><p><pre class="screen"><a href="cmdqueryname=reflect+change-path-attribute"><b><span class="cmdname">reflect change-path-attribute</span></b></a></pre>
<p>By default, an RR is disabled from modifying path attributes based on an export policy.</p>
<p>The route attributes on the RR cannot be modified using the export route-policy because routing loops may occur. By default, the RR is disabled from modifying the route attributes based on the export route-policy. If you need to re-plan the network traffic, you can enable the RR to modify the path attributes based on the export policy.</p>
<div class="p">After the <a href="cmdqueryname=reflect+change-path-attribute"><b><span class="cmdname">reflect change-path-attribute</span></b></a> command is run on an RR, path attributes can be modified by performing the following operations:<ul><li>Run the <a href="cmdqueryname=apply+as-path"><b><span class="cmdname">apply as-path</span></b></a> command to modify the AS_Path attribute of BGP routes.</li><li>Run the <a href="cmdqueryname=apply+comm-filter+delete"><b><span class="cmdname">apply comm-filter delete</span></b></a> command to delete community attributes from BGP routes.</li><li>Run the <a href="cmdqueryname=apply+community"><b><span class="cmdname">apply community</span></b></a> command to modify the community attribute of BGP routes.</li><li>Run the <a href="cmdqueryname=apply+large-community"><b><span class="cmdname">apply large-community</span></b></a> command to modify the Large-Community attribute of BGP routes.</li><li>Run the <a href="cmdqueryname=apply+cost"><b><span class="cmdname">apply cost</span></b></a> command to modify the MED value (cost) of BGP routes.</li><li>Run the <a href="cmdqueryname=apply+ip-address+next-hop"><b><span class="cmdname">apply ip-address next-hop</span></b></a> command to modify the next hops of BGP routes.</li><li>Run the <a href="cmdqueryname=apply+local-preference"><b><span class="cmdname">apply local-preference</span></b></a> command to modify the local preference value of BGP routes.</li><li>Run the <a href="cmdqueryname=apply+origin"><b><span class="cmdname">apply origin</span></b></a> command to modify the Origin attribute of BGP routes.</li><li>Run the <a href="cmdqueryname=apply+extcommunity"><b><span class="cmdname">apply extcommunity</span></b></a> command to modify the VPN target extended community attribute of BGP routes.</li><li><p>Run the <a href="cmdqueryname=apply+extcommunity+soo"><b><span class="cmdname">apply extcommunity soo</span></b></a> { <i><span class="varname">site-of-origin</span></i> } &amp;&lt;1-16&gt; <strong><span>additive</span></strong> command to modify the SoO extended community attribute of BGP routes.</p>
</li><li>Run the <a href="cmdqueryname=apply+extcommunity+bandwidth"><b><span class="cmdname">apply extcommunity bandwidth</span></b></a> {<i><span class="varname"> extCmntyString</span></i> | <strong><span>none</span></strong> } or <a href="cmdqueryname=apply+extcommunity+bandwidth"><b><span class="cmdname">apply extcommunity bandwidth</span></b></a> <strong><span>aggregate</span></strong> [ <strong><span>limit</span></strong> <i><span class="varname">bandwidth-value</span></i> ] command to modify the Link Bandwidth extended community attribute of BGP routes.</li></ul>
</div>
<div class="p"><div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>After the <a href="cmdqueryname=reflect+change-path-attribute"><b><span class="cmdname">reflect change-path-attribute</span></b></a> command is run on the RR, the <a href="cmdqueryname=peer+route-policy"><b><span class="cmdname">peer route-policy</span></b></a> <strong><span>export</span></strong> command takes precedence over the <a href="cmdqueryname=peer+next-hop-invariable"><b><span class="cmdname">peer next-hop-invariable</span></b></a> and <a href="cmdqueryname=peer+next-hop-local"><b><span class="cmdname">peer next-hop-local</span></b></a> commands.</p>
</div></div>
</div>
</p></li><li><span>Commit the configuration.</span><p><pre class="screen" id="EN-US_TASK_0000001130783898__en-us_task_0234857734_screen163801330213"><a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001130783898__en-us_task_0234857734_en-us_concept_0141113565_cmdname1667501373175340">commit</span></b></a></pre>
</p></li></ol></div>
<div class="postreq"><a name="EN-US_TASK_0000001130783898__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Verifying the Configuration</h4><ul><li>Run the <a href="cmdqueryname=display+bgp+group"><b><span class="cmdname">display bgp group</span></b></a> [ <i><span class="varname">group-name</span></i> ] command to check information about a specified peer group.</li><li>Run the <a href="cmdqueryname=display+bgp+routing-table"><b><span class="cmdname">display bgp routing-table</span></b></a> [ <i><span class="varname">network</span></i> ] [ <i><span class="varname">mask</span></i> | <i><span class="varname">mask-length</span></i> ] [ <strong><span>longer-prefixes</span></strong> ] command to check information about routes in the BGP routing table.</li></ul>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="vrp_bgp_cfg_0073.html">Configuring a BGP RR
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="vrp_bgp_cfg_0074.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="vrp_bgp_cfg_0076.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>