
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Keychain Authentication for BGP4+">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="vrp_bgp6_cfg_0169.html">
<meta name="DC.Relation" scheme="URI" content="vrp_bgp6_cfg_0069.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="BGP4+">
<meta name="featuretype" content="IP Routing">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP4+">
<meta name="featuretype" content="IP Routing">
<meta name="featurename" content="BGP4+">
<meta name="featuretype" content="IP Routing">
<meta name="featuretype" content="IP Routing">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001424086021">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring Keychain Authentication for BGP4+</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001424086021"></a><a name="EN-US_TASK_0000001424086021"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Keychain Authentication for BGP4+</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001424086021__1.3.1"></a><a name="1.3.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>In <a href="#EN-US_TASK_0000001424086021__fig168879525502">Figure 1</a>, DeviceA and DeviceB interwork through BGP4+.</p>
<p>To ensure the stability and security of BGP4+ connections, configure a keychain to provide dynamic security authentication for BGP4+ connections.</p>
<div class="fignone" id="EN-US_TASK_0000001424086021__fig168879525502"><a name="EN-US_TASK_0000001424086021__fig168879525502"></a><a name="fig168879525502"></a><span class="figcap"><b>Figure 1 </b>Keychain networking diagram</span><div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface 1 represents <span>100GE</span><span>1/0/1</span>.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0000001424205789.png" width="NaN" height="NaN"></span></div>
<p>Keychain authentication must be configured on both BGP4+ peers. The keychains configured at both ends must use the same encryption algorithm and password so that a TCP connection can be set up and BGP4+ messages can be exchanged properly.</p>
<p>To complete the configuration, you need the following data:</p>
<ul><li><p>Keychain name</p>
</li><li>Acceptance tolerance of a keychain</li><li>Values of TCP Kind and TCP Alg ID fields in the TCP Enhanced Authentication Option</li><li><p>ID of the key in the keychain</p>
</li><li><p>Key authentication algorithm and authentication key (encrypted character string)</p>
</li><li><p>Send lifetime and accept lifetime of a key</p>
</li></ul>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001424086021__1.3.2"></a><a name="1.3.2"></a>
<div class="p"><h4 class="sectiontitle">Precautions</h4><ul><li>NTP and BGP4+ have been configured.</li><li>The keychain names configured on DeviceA and DeviceB must be the same.</li><li>The time modes in the keychains configured on DeviceA and DeviceB must be the same.</li><li>The key IDs in the keychains configured on DeviceA and DeviceB must be the same. When multiple keys are configured, the key quantity and IDs must be the same as those on the other end, respectively.</li><li>For the same key, the same authentication algorithm and key string (encrypted character string) must be configured on DeviceA and DeviceB.</li><li>For the same key, the send lifetime and accept lifetime configured on DeviceA and DeviceB must match. For example, the accept lifetime configured on DeviceB must include the send lifetime configured on DeviceA to prevent packet loss. Similarly, the accept lifetime configured on DeviceA must also include the send lifetime configured on DeviceB.</li><li>If multiple keys are configured in a keychain, only one of them can be configured as the default send key.</li><li>For security purposes, HMAC-SHA-256 is not recommended. If HMAC-SHA-256 is required, run the <a href="cmdqueryname=install+feature-software+WEAKEA"><b><span class="cmdname">install feature-software WEAKEA</span></b></a> command first to install the weak security algorithm/protocol feature package WEAKEA.</li></ul>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001424086021__1.3.3"></a><a name="1.3.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><ol><li><p>Create a keychain.</p>
</li><li><p>Configure a key in the keychain.</p>
</li><li><p>Configure keychain authentication for BGP4+. Configure DeviceA and DeviceB to use the passwords encrypted using the HMAC-SHA256 algorithm for authentication.</p>
</li></ol>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001424086021__1.3.4"></a><a name="1.3.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Create a keychain.</span><p><p># Configure DeviceA.</p>
<pre class="screen">&lt;HUAWEI&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>HUAWEI] <strong>sysname DeviceA</strong>
[<span class="keyword">*</span>HUAWEI] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA]<strong> keychain huawei mode absolute</strong>
[<span class="keyword">*</span>DeviceA-keychain<span>-huawei</span>]<strong> receive-tolerance 10</strong>
[<span class="keyword">*</span>DeviceA-keychain<span>-huawei</span>]<strong> tcp-kind 182</strong>
[<span class="keyword">*</span>DeviceA-keychain<span>-huawei</span>]<strong> tcp-algorithm-id sha-256 17</strong>
[<span class="keyword">*</span>DeviceA-keychain<span>-huawei</span>] <strong>commit</strong></pre>
<p># Configure DeviceB.</p>
<pre class="screen">&lt;HUAWEI&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>HUAWEI] <strong>sysname DeviceB</strong>
[<span class="keyword">*</span>HUAWEI] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB]<strong> keychain huawei mode absolute</strong>
[<span class="keyword">*</span>DeviceB-keychain<span>-huawei</span>]<strong> receive-tolerance 10</strong>
[<span class="keyword">*</span>DeviceB-keychain<span>-huawei</span>]<strong> tcp-kind 182</strong>
[<span class="keyword">*</span>DeviceB-keychain<span>-huawei</span>]<strong> tcp-algorithm-id sha-256 17</strong>
[<span class="keyword">*</span>DeviceB-keychain<span>-huawei</span>] <strong>commit</strong></pre>
</p></li><li><span>Configure a key in the keychain.</span><p><p># Configure DeviceA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA-keychain<span>-huawei</span>]<strong> key-id 1</strong>
[<span class="keyword">*</span>DeviceA-keychain<span>-huawei</span>-keyid-1]<strong> algorithm sha-256</strong>
[<span class="keyword">*</span>DeviceA-keychain<span>-huawei</span>-keyid-1]<strong> key-string cipher </strong><strong>Keychain-13579</strong>
[<span class="keyword">*</span>DeviceA-keychain<span>-huawei</span>-keyid-1]<strong> send-time 12:00 2019-12-10 to 15:00 2019-12-10</strong>
[<span class="keyword">*</span>DeviceA-keychain<span>-huawei</span>-keyid-1]<strong> receive-time 12:00 2019-12-10 to 15:00 2019-12-10</strong>
[<span class="keyword">*</span>DeviceA-keychain<span>-huawei</span>-keyid-1]<strong> default send-key-id</strong>
[<span class="keyword">*</span>DeviceA-keychain<span>-huawei</span>-keyid-1]<strong> quit</strong>
[<span class="keyword">*</span>DeviceA-keychain<span>-huawei</span>]<strong> key-id 2</strong>
[<span class="keyword">*</span>DeviceA-keychain<span>-huawei</span>-keyid-2]<strong> algorithm sha-256</strong>
[<span class="keyword">*</span>DeviceA-keychain<span>-huawei</span>-keyid-2]<strong> key-string cipher Hello-246810</strong>
[<span class="keyword">*</span>DeviceA-keychain<span>-huawei</span>-keyid-2]<strong> send-time 15:00 2019-12-10 to 18:00 2019-12-10</strong>
[<span class="keyword">*</span>DeviceA-keychain<span>-huawei</span>-keyid-2]<strong> receive-time 15:00 2019-12-10 to 18:00 2019-12-10</strong>
[<span class="keyword">*</span>DeviceA-keychain<span>-huawei</span>-keyid-2]<strong> quit</strong>
[<span class="keyword">*</span>DeviceA-keychain<span>-huawei</span>]<strong> quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>commit</strong></pre>
<p># Configure DeviceB.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB-keychain<span>-huawei</span>]<strong> key-id 1</strong>
[<span class="keyword">*</span>DeviceB-keychain<span>-huawei</span>-keyid-1]<strong> algorithm sha-256</strong>
[<span class="keyword">*</span>DeviceB-keychain<span>-huawei</span>-keyid-1]<strong> key-string cipher</strong><strong> Keychain-13579</strong>
[<span class="keyword">*</span>DeviceB-keychain<span>-huawei</span>-keyid-1]<strong> send-time 12:00 2019-12-10 to 15:00 2019-12-10</strong>
[<span class="keyword">*</span>DeviceB-keychain<span>-huawei</span>-keyid-1]<strong> receive-time 12:00 2019-12-10 to 15:00 2019-12-10</strong>
[<span class="keyword">*</span>DeviceB-keychain<span>-huawei</span>-keyid-1]<strong> default send-key-id</strong>
[<span class="keyword">*</span>DeviceB-keychain<span>-huawei</span>-keyid-1]<strong> quit</strong>
[<span class="keyword">*</span>DeviceB-keychain<span>-huawei</span>]<strong> key-id 2</strong>
[<span class="keyword">*</span>DeviceB-keychain<span>-huawei</span>-keyid-2]<strong> algorithm sha-256</strong>
[<span class="keyword">*</span>DeviceB-keychain<span>-huawei</span>-keyid-2]<strong> key-string cipher Hello-246810</strong>
[<span class="keyword">*</span>DeviceB-keychain<span>-huawei</span>-keyid-2]<strong> send-time 15:00 2019-12-10 to 18:00 2019-12-10</strong>
[<span class="keyword">*</span>DeviceB-keychain<span>-huawei</span>-keyid-2]<strong> receive-time 15:00 2019-12-10 to 18:00 2019-12-10</strong>
[<span class="keyword">*</span>DeviceB-keychain<span>-huawei</span>-keyid-2]<strong> quit</strong>
[<span class="keyword">*</span>DeviceB-keychain<span>-huawei</span>]<strong> quit</strong>
[<span class="keyword">*</span>DeviceB] <strong>commit</strong></pre>
</p></li><li><span>Configure keychain authentication for BGP.</span><p><p># Configure DeviceA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>interface </strong><strong><span>100ge</span></strong> <strong><span>1/0/1</span></strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>undo portswitch</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>ipv6 enable</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>ipv6 address 2001:db8:1::1 64</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>bgp 1</strong>
[<span class="keyword">*</span>DeviceA-bgp] <strong>router-id 1.1.1.1</strong>
[<span class="keyword">*</span>DeviceA-bgp] <strong>peer 2001:db8:1::2 as-number 1</strong>
[<span class="keyword">*</span>DeviceA-bgp] <strong>peer 2001:db8:1::2 keychain huawei</strong>
[<span class="keyword">*</span>DeviceA-bgp] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>commit</strong></pre>
<p># Configure DeviceB.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB] <strong>interface </strong><strong><span>100ge</span></strong> <strong><span>1/0/1</span></strong>
[<span class="keyword">*</span>DeviceB-<span>100GE</span><span>1/0/1</span>] <strong>undo portswitch</strong>
[<span class="keyword">*</span>DeviceB-<span>100GE</span><span>1/0/1</span>]<strong> ipv6 enable</strong>
[<span class="keyword">*</span>DeviceB-<span>100GE</span><span>1/0/1</span>]<strong> ipv6 address 2001:db8:1::2 64</strong>
[<span class="keyword">*</span>DeviceB-<span>100GE</span><span>1/0/1</span>]<strong> quit</strong>
[<span class="keyword">*</span>DeviceB] <strong>bgp 1</strong>
[<span class="keyword">*</span>DeviceB-bgp] <strong>router-id 2.2.2.2</strong>
[<span class="keyword">*</span>DeviceB-bgp] <strong>peer 2001:db8:1::1 as-number 1</strong>
[<span class="keyword">*</span>DeviceB-bgp] <strong>peer 2001:db8:1::1 keychain huawei</strong>
[<span class="keyword">*</span>DeviceB-bgp] <strong>quit</strong>
[<span class="keyword">*</span>DeviceB] <strong>commit</strong></pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001424086021__1.3.5"></a><a name="1.3.5"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p>Take DeviceA as an example. Check whether keychain authentication is successfully configured for BGP.</p>
<ul><li>Run the <a href="cmdqueryname=display+keychain"><b><span class="cmdname">display keychain</span></b></a> <i><span class="varname">keychain-name</span></i> command to check the key ID in the <strong>Active</strong> state.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>display keychain huawei</strong>
 Keychain Information:                                                          
 ----------------------                                                         
 Keychain Name             : huawei                                             
   Timer Mode              : Absolute                                           
   Receive Tolerance(min)  : 10                                                 
   Digest Length           : 32                                                 
   Time Zone               : LMT                                                
   TCP Kind                : 182                                                
   TCP Algorithm IDs       :                                                    
     HMAC-MD5              : 5                                                  
     HMAC-SHA1-12          : 2                                                  
     HMAC-SHA1-20          : 6                                                  
     MD5                   : 3                                                  
     SHA1                  : 4                                                  
     HMAC-SHA-256          : 17                                                 
     SHA-256               : 8                                                  
     SM3                   : 9                                                  
 Number of Key IDs         : 2                                                  
 Active Send Key ID        : 1                                                  
 Active Receive Key IDs    : 01                                                 
 Default send Key ID       : 1                                                  

 Key ID Information:
 ----------------------                                                         
 Key ID                    : 1                                                  
   Key string              : ******                                             
   Algorithm               : HMAC-SHA-256                                       
   SEND TIMER              :                                                    
     Start time            : 2019-12-10 12:00                                   
     End time              : 2019-12-10 15:00                                   
     Status                : Active                                             
   RECEIVE TIMER           :                                                    
     Start time            : 2019-12-10 12:00                                   
     End time              : 2019-12-10 15:00                                   
     Status                : Active                                             

 Key ID                    : 2                                                  
   Key string              : ******                                             
   Algorithm               : HMAC-SHA-256                                       
   SEND TIMER              :                                                    
     Start time            : 2019-12-10 15:05                                   
     End time              : 2019-12-10 18:00                                   
     Status                : Inactive                                           
   RECEIVE TIMER           :                                                    
     Start time            : 2019-12-10 15:05                                   
     End time              : 2019-12-10 18:00                                   
     Status                : Inactive</pre>
</li><li>Run the <a href="cmdqueryname=display+bgp+ipv6+peer"><b><span class="cmdname">display bgp ipv6 peer</span></b></a> <i><span class="varname">ipv6-address</span></i> <strong><span>verbose</span></strong> command to verify that the authentication type configured for the BGP peer is <strong>Keychain(huawei)</strong>.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>display bgp ipv6 peer 2001:db8:1::2 verbose</strong>
         BGP Peer is 2001:db8:1::2,  remote AS 1                                  
         Type: IBGP link                                                        
         BGP version 4, Remote router ID 2.2.2.2                                
         Update-group ID: 3                                                     
         BGP current state: Established, Up for 00h27m26s                       
         BGP current event: RecvKeepalive                                       
         BGP last state: OpenConfirm                                            
         BGP Peer Up count: 2                                                   
         Received total routes: 0                                               
         Received active routes total: 0                                        
         Advertised total routes: 0                                             
         Port: Local - 58168        Remote - 179                                
         Configured: Connect-retry Time: 32 sec                                 
         Configured: Min Hold Time: 0 sec                                       
         Configured: Active Hold Time: 180 sec   Keepalive Time:60 sec          
         Received  : Active Hold Time: 180 sec                                  
         Negotiated: Active Hold Time: 180 sec   Keepalive Time:60 sec          
         Peer optional capabilities:                                            
         Peer supports bgp multi-protocol extension                             
         Peer supports bgp route refresh capability                             
         Peer supports bgp 4-byte-as capability                                 
         Address family IPv4 Unicast: advertised and received 
 Received: Total 34 messages                                                    
                  Update messages                1                              
                  Open messages                  1                              
                  KeepAlive messages             32                             
                  Notification messages          0                              
                  Refresh messages               0                              
 Sent: Total 33 messages                                                        
                  Update messages                1                              
                  Open messages                  1                              
                  KeepAlive messages             31                             
                  Notification messages          0                              
                  Refresh messages               0                              
 Authentication type configured: Keychain(huawei)                               
 Last keepalive received: 2019-12-10 10:12:29+00:00                             
 Last keepalive sent    : 2019-12-10 10:12:04+00:00                             
 Last update    received: 2019-12-10 09:45:14+00:00                             
 Last update    sent    : 2019-12-10 09:45:14+00:00                             
 No refresh received since peer has been configured                             
 No refresh sent since peer has been configured                                 
 Minimum route advertisement interval is 15 seconds                             
 Optional capabilities:                                                         
 Route refresh capability has been enabled                                      
 4-byte-as capability has been enabled                                          
 Peer Preferred Value: 0                                                        
 Routing policy configured:                                                     
 No routing policy is configured</pre>
</li></ul>
</div>
<div class="postreq"><a name="EN-US_TASK_0000001424086021__1.3.6"></a><a name="1.3.6"></a><h4 class="sectiontitle">Configuration Scripts</h4><ul><li><p>DeviceA</p>
<pre class="screen">#
 sysname DeviceA
#
keychain huawei mode absolute
 tcp-kind 182
 tcp-algorithm-id sha-256 17
 receive-tolerance 10
 key-id 1
  algorithm sha-256
  key-string cipher @%@%Hb'c;\@iU'@X,k6.E\Z,*.S#@%@%
  send-time 12:00 2019-12-10 to 15:00 2019-12-10
  receive-time 12:00 2019-12-10 to 15:00 2019-12-10
  default send-key-id
 key-id 2
  algorithm sha-256
  key-string cipher %+%#[aqxE3`@U8L*%n."1(&lt;$,]k_QrVTf1X;K+;My)k;%+%#
  send-time 15:00 2019-12-10 to 18:00 2019-12-10
  receive-time 15:00 2019-12-10 to 18:00 2019-12-10
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ipv6 enable
 ipv6 address 2001:db8:1::1 64
#
bgp 1
 router-id 1.1.1.1
 peer 2001:db8:1::2 as-number 1
 peer 2001:db8:1::2 keychain huawei
#
return</pre>
</li><li><p>DeviceB</p>
<pre class="screen">#
 sysname DeviceB
#
keychain huawei mode absolute
 receive-tolerance 10
 tcp-kind 182
 tcp-algorithm-id sha-256 17
 key-id 1
  algorithm sha-256
  key-string cipher @%@%;TYJ;\@iU'SGHRH.C\V,*.A#@%@%
  send-time 12:00 2019-12-10 to 15:00 2019-12-10
  receive-time 12:00 2019-12-10 to 15:00 2019-12-10
  default send-key-id
 key-id 2
  algorithm sha-256
  key-string cipher %+%#X=O%EC@ta4QKkn"ur<font style="font-size:8pt" Face="Courier New" >~</font>Y::h@#'6737A4eq&lt;W^<font style="font-size:8pt" Face="Courier New" >~</font>qn+%+%#
  send-time 15:00 2019-12-10 to 18:00 2019-12-10
  receive-time 15:00 2019-12-10 to 18:00 2019-12-10
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch 
 ipv6 enable
 ipv6 address 2001:db8:1::2 64
#
bgp 1
 router-id 2.2.2.2
 peer 2001:db8:1::1 as-number 1
 peer 2001:db8:1::1 keychain huawei
#
return</pre>
</li></ul>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="vrp_bgp6_cfg_0169.html">Configuring BGP4+ Authentication
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="vrp_bgp6_cfg_0069.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>
</body>
</html>