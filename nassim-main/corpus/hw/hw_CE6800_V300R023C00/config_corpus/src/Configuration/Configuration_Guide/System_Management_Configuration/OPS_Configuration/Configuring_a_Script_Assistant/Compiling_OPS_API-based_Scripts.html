
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Compiling OPS API-based Scripts">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="vrp_ops_cfg_0012.html">
<meta name="DC.Relation" scheme="URI" content="vrp_ops_cfg_0022.html">
<meta name="DC.Relation" scheme="URI" content="vrp_ops_cfg_0024.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="OPS">
<meta name="featuretype" content="System Management">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="OPS">
<meta name="featuretype" content="System Management">
<meta name="featurename" content="OPS">
<meta name="featuretype" content="System Management">
<meta name="featuretype" content="System Management">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001512845502">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>Compiling OPS API-based Scripts</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001512845502"></a><a name="EN-US_TASK_0000001512845502"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Compiling OPS API-based Scripts</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001512845502__1.3.1"></a><a name="1.3.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>In an OPS script file, you can define operations on YANG model nodes to manage services through OPS APIs.</p>
<p>The OPS API is a RESTful open and programmable interface. The following table lists the operations supported by the OPS, RESTCONF, and NETCONF.</p>

<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" frame="border" border="1" rules="all"><caption><b>Table 1 </b>Operations supported by the OPS, RESTCONF, and NETCONF</caption><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="33.33333333333333%" id="mcps1.3.1.3.2.4.1.1" liSelected="liSelected"><p>OPS</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="33.33333333333333%" id="mcps1.3.1.3.2.4.1.2" liSelected="liSelected"><p>RESTCONF</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="33.33333333333333%" id="mcps1.3.1.3.2.4.1.3" liSelected="liSelected"><p>NETCONF</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.1.3.2.4.1.1 "><p>create</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.1.3.2.4.1.2 "><p>POST</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.1.3.2.4.1.3 "><p>&lt;edit-config&gt; (nc:operation="create")</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.1.3.2.4.1.1 "><p>create</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.1.3.2.4.1.2 "><p>POST</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.1.3.2.4.1.3 "><p>rpc</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.1.3.2.4.1.1 "><p>delete</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.1.3.2.4.1.2 "><p>DELETE</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.1.3.2.4.1.3 "><p>&lt;edit-config&gt; (nc:operation="delete")</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.1.3.2.4.1.1 "><p>patch</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.1.3.2.4.1.2 "><p>PATCH</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.1.3.2.4.1.3 "><p>&lt;edit-config&gt; (nc:operation="merge")</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.1.3.2.4.1.1 "><p>get</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.1.3.2.4.1.2 "><p>GET</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.1.3.2.4.1.3 "><p>&lt;get-config&gt;, &lt;get&gt;</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.1.3.2.4.1.1 "><p>set</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.1.3.2.4.1.2 "><p>PUT</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.1.3.2.4.1.3 "><p>&lt;edit-config&gt; (nc:operation="replace")</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>Zero Touch Provisioning (ZTP) can invoke OPS scripts to implement automatic service deployment when a device starts without any configuration file.</p>
<p>You can compile Python scripts that are manually run and scripts defined in the ops_execute() function of the script assistant based on the following procedure and specifications.</p>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001512845502__1.3.2"></a><a name="1.3.2"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Run the import ops statement to invoke the OPSConnection(object) function to establish a connection to the OPS interface.</span></li><li><span>Compile the OPS script.</span><p><pre class="screen">import ops                                                       # Imports the OPS module. This is a fixed format.
import string                                                    # Fixed format.
uri = "/restconf/data/huawei-aaa:aaa/domains"                    # XPath based on the RESTCONF packet header and YANG model of the service module. For the create, delete, get, and set operations, the parameter in the path is fixed to <strong>data</strong>.
uri = "/restconf/operations/huawei-cfg:set-startup "             # XPath based on the RESTCONF packet header and YANG model of the service module. For RPC operations, the parameter in the path is fixed to <strong>operations</strong>.
host = "localhost"                                               # Fixed format.
req_data = None                                                  # Service body. Enter the data to be added in XML format. If no data is added, enter <strong>None</strong>.
opos_conn = ops.OPSConnection(host)                              # Interface function that triggers OPS connection establishment.
ret, _, rsp_data = ops_conn.create/delete/get/set(uri, req_data, timeout = <em>time-value</em>) # Triggers various operations. The <strong>timeout</strong> parameter specifies an OPS request timeout period. If the OPS request timeout period is reached, the OPS request is canceled, and a timeout error is returned. This parameter is optional. Its value is an integer ranging from 0 to 4294967295, in seconds. The default value is 0, indicating that there is no timeout period for OPS requests.</pre>

<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" frame="border" border="1" rules="all"><caption><b>Table 2 </b>Script compiling for various OPS operations</caption><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="13.051305130513052%" id="mcps1.3.2.2.2.2.2.4.1.1" liSelected="liSelected"><p>Operation</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="19.09190919091909%" id="mcps1.3.2.2.2.2.2.4.1.2" liSelected="liSelected"><p>Rule Description</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="67.85678567856786%" id="mcps1.3.2.2.2.2.2.4.1.3" liSelected="liSelected"><p>Script Example</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" valign="top" width="13.051305130513052%" headers="mcps1.3.2.2.2.2.2.4.1.1 "><p>create</p>
</td>
<td class="cellrowborder" valign="top" width="19.09190919091909%" headers="mcps1.3.2.2.2.2.2.4.1.2 "><p>Creates a node. The parameter in the URI is fixed to <strong>data</strong>.</p>
</td>
<td class="cellrowborder" valign="top" width="67.85678567856786%" headers="mcps1.3.2.2.2.2.2.4.1.3 "><pre class="screen">import ops
import string
import hashlib
uri = "/restconf/data/huawei-aaa:aaa/domains"
host = "localhost"
req_data = '''&lt;domain&gt;
        &lt;domainName&gt;test1&lt;/domainName&gt;
        &lt;authenSchemeName&gt;default&lt;/authenSchemeName&gt;
        &lt;acctSchemeName&gt;default&lt;/acctSchemeName&gt;
        &lt;authorSchemeName&gt;default&lt;/authorSchemeName&gt;
        &lt;domainState&gt;active&lt;/domainState&gt;
        &lt;accessLimit&gt;283648&lt;/accessLimit&gt;
        &lt;serviceTerminal&gt;true&lt;/serviceTerminal&gt;
        &lt;serviceTelnet&gt;true&lt;/serviceTelnet&gt;
        &lt;serviceFtp&gt;true&lt;/serviceFtp&gt;
        &lt;serviceSsh&gt;true&lt;/serviceSsh&gt;
        &lt;serviceSnmp&gt;true&lt;/serviceSnmp&gt;
        &lt;serviceDot1x&gt;true&lt;/serviceDot1x&gt;
        &lt;serviceHttp&gt;true&lt;/serviceHttp&gt;
    &lt;/domain&gt;'''
ops_conn = ops.OPSConnection(host)
ret, _, rsp_data = ops_conn.create(uri, req_data)
print(('install_ops_script ret {}, rsp_data {}'.format(ret, rsp_data)))</pre>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="13.051305130513052%" headers="mcps1.3.2.2.2.2.2.4.1.1 "><p>create</p>
</td>
<td class="cellrowborder" valign="top" width="19.09190919091909%" headers="mcps1.3.2.2.2.2.2.4.1.2 "><p>RPC operation. The parameter in the URI is fixed to <strong>operations</strong>.</p>
</td>
<td class="cellrowborder" valign="top" width="67.85678567856786%" headers="mcps1.3.2.2.2.2.2.4.1.3 "><pre class="screen">import ops
import string
import hashlib
uri = "/restconf/operations/huawei-cfg:set-startup"
host = "localhost"
req_data = '''&lt;input&gt;
    &lt;filename&gt;vrpcfg1.zip&lt;/filename&gt;
&lt;/input&gt;'''
ops_conn = ops.OPSConnection(host)
ret, _, rsp_data = ops_conn.create(uri, req_data)
print(('install_ops_script ret {}, rsp_data {}'.format(ret, rsp_data)))</pre>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="13.051305130513052%" headers="mcps1.3.2.2.2.2.2.4.1.1 "><p>delete</p>
</td>
<td class="cellrowborder" valign="top" width="19.09190919091909%" headers="mcps1.3.2.2.2.2.2.4.1.2 "><p>No service body is allowed.</p>
</td>
<td class="cellrowborder" valign="top" width="67.85678567856786%" headers="mcps1.3.2.2.2.2.2.4.1.3 "><pre class="screen">import ops
import string
import hashlib
uri = "/restconf/data/huawei-aaa:aaa/domains/domain=test1"
host = "localhost"
req_data = None
ops_conn = ops.OPSConnection(host)
ret, _, rsp_data = ops_conn.delete(uri, req_data)
print(('install_ops_script ret {}, rsp_data {}'.format(ret, rsp_data)))</pre>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="13.051305130513052%" headers="mcps1.3.2.2.2.2.2.4.1.1 "><p>patch</p>
</td>
<td class="cellrowborder" valign="top" width="19.09190919091909%" headers="mcps1.3.2.2.2.2.2.4.1.2 "><p>Modifies an existing service. A service that does not exist cannot be created.</p>
</td>
<td class="cellrowborder" valign="top" width="67.85678567856786%" headers="mcps1.3.2.2.2.2.2.4.1.3 "><pre class="screen">import ops
import string
import hashlib
uri = "/restconf/data/huawei-aaa:aaa/domains/domain"
host = "localhost"
req_data = '''&lt;domain&gt;
        &lt;domainName&gt;test1&lt;/domainName&gt;
        &lt;authenSchemeName&gt;default&lt;/authenSchemeName&gt;
        &lt;acctSchemeName&gt;default&lt;/acctSchemeName&gt;
        &lt;authorSchemeName&gt;default&lt;/authorSchemeName&gt;
        &lt;domainState&gt;active&lt;/domainState&gt;
        &lt;accessLimit&gt;283648&lt;/accessLimit&gt;
        &lt;serviceTerminal&gt;true&lt;/serviceTerminal&gt;
        &lt;serviceTelnet&gt;true&lt;/serviceTelnet&gt;
        &lt;serviceFtp&gt;true&lt;/serviceFtp&gt;
        &lt;serviceSsh&gt;true&lt;/serviceSsh&gt;
        &lt;serviceSnmp&gt;true&lt;/serviceSnmp&gt;
        &lt;serviceDot1x&gt;true&lt;/serviceDot1x&gt;
        &lt;serviceHttp&gt;true&lt;/serviceHttp&gt;
    &lt;/domain&gt;'''
ops_conn = ops.OPSConnection(host)
ret, _, rsp_data = ops_conn.patch(uri, req_data)
print(('install_ops_script ret {}, rsp_data {}'.format(ret, rsp_data)))</pre>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="13.051305130513052%" headers="mcps1.3.2.2.2.2.2.4.1.1 "><p>get</p>
</td>
<td class="cellrowborder" valign="top" width="19.09190919091909%" headers="mcps1.3.2.2.2.2.2.4.1.2 "><ul><li>No service body is allowed. </li><li>When querying a list node, you must specify a key node or filter criteria.</li></ul>
</td>
<td class="cellrowborder" valign="top" width="67.85678567856786%" headers="mcps1.3.2.2.2.2.2.4.1.3 "><pre class="screen">import ops
import string
import hashlib
print("hello")
print("world")
uri = "/restconf/data/huawei-aaa:aaa/domains/domain=test1"
host = "localhost"
req_data = None
ops_conn = ops.OPSConnection(host)
ret, _, rsp_data = ops_conn.get(uri, req_data)
print(('install_ops_script ret {}, rsp_data {}'.format(ret, rsp_data)))</pre>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="13.051305130513052%" headers="mcps1.3.2.2.2.2.2.4.1.1 "><p>set</p>
</td>
<td class="cellrowborder" valign="top" width="19.09190919091909%" headers="mcps1.3.2.2.2.2.2.4.1.2 "><p>N/A</p>
</td>
<td class="cellrowborder" valign="top" width="67.85678567856786%" headers="mcps1.3.2.2.2.2.2.4.1.3 "><pre class="screen">import ops
import string
import hashlib
uri = "/restconf/data/huawei-aaa:aaa/domains/domain"
host = "localhost"
req_data = '''&lt;domain&gt;
        &lt;domainName&gt;test1&lt;/domainName&gt;
        &lt;authenSchemeName&gt;default&lt;/authenSchemeName&gt;
        &lt;acctSchemeName&gt;default&lt;/acctSchemeName&gt;
        &lt;authorSchemeName&gt;default&lt;/authorSchemeName&gt;
        &lt;domainState&gt;active&lt;/domainState&gt;
        &lt;accessLimit&gt;283648&lt;/accessLimit&gt;
        &lt;serviceTerminal&gt;true&lt;/serviceTerminal&gt;
        &lt;serviceTelnet&gt;true&lt;/serviceTelnet&gt;
        &lt;serviceFtp&gt;true&lt;/serviceFtp&gt;
        &lt;serviceSsh&gt;true&lt;/serviceSsh&gt;
        &lt;serviceSnmp&gt;true&lt;/serviceSnmp&gt;
        &lt;serviceDot1x&gt;true&lt;/serviceDot1x&gt;
        &lt;serviceHttp&gt;true&lt;/serviceHttp&gt;
    &lt;/domain&gt;'''
ops_conn = ops.OPSConnection(host)
ret, _, rsp_data = ops_conn.set(uri, req_data)
print(('install_ops_script ret {}, rsp_data {}'.format(ret, rsp_data)))</pre>
</td>
</tr>
</tbody>
</table>
</div>
</p></li></ol></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="vrp_ops_cfg_0012.html">Configuring a Script Assistant
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="vrp_ops_cfg_0022.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="vrp_ops_cfg_0024.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>