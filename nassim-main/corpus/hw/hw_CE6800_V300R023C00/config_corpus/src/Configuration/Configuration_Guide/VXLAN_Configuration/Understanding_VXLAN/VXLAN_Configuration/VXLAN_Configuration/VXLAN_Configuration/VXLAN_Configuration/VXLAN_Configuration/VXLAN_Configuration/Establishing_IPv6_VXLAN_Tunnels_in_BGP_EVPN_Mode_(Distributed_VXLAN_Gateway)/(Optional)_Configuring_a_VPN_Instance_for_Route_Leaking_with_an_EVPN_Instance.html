
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="(Optional) Configuring a VPN Instance for Route Leaking with an EVPN Instance">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../dc/dc_vrp_vxlan6_cfg_1066.html">
<meta name="DC.Relation" scheme="URI" content="../dc/dc_vrp_vxlan6_cfg_1090.html">
<meta name="DC.Relation" scheme="URI" content="../dc/dc_vrp_vxlan6_cfg_1091.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="VXLAN">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="VXLAN">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="VXLAN">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="VXLAN">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001193876283">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="../public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="../public_sys-resources/browseVersion.js"></script>
<title>(Optional) Configuring a VPN Instance for Route Leaking with an EVPN Instance</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001193876283"></a><a name="EN-US_TASK_0000001193876283"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">(Optional) Configuring a VPN Instance for Route Leaking with an EVPN Instance</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001193876283__1.3.1"></a><a name="1.3.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>In a distributed IPv6 VXLAN gateway scenario, hosts on different network segments can communicate with one another only through Layer 3 forwarding. In this case, you must configure a VPN instance for route leaking with an EVPN instance. The VPN instance is used to store host routes or host network segment routes in order to distinguish tenants.</p>
<p>RDs are used to identify routes in EVPN and VPN instances. For multiple routes with the same prefix, the routes are considered the same if their RDs are the same or different if their RDs are different. When configuring RDs for an EVPN instance and a VPN instance, note the following points:</p>
<ul><li><p>If routes need to implement ECMP, different RDs must be configured. For example, when multiple border leaf nodes are deployed and send the same route to the DC, different RDs must be configured for the border leaf nodes.</p>
</li><li><p>When routes do not need to implement ECMP, the same RD can be configured. For example, when distributed gateways with the same address are deployed in different locations, and the network segment routes of the gateways do not need to implement ECMP, the same RD can be configured for server leaf nodes connected to the gateways.</p>
</li></ul>
</div></div>
<div class="steps-unordered"><a name="EN-US_TASK_0000001193876283__1.3.2"></a><a name="1.3.2"></a><h4 class="sectiontitle">Procedure</h4>
<ul><li><span>For an IPv4 overlay network, perform the following operations:</span><ol><li class="substepexpand"><span>Enter the system view.</span><p><pre class="screen"><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></pre>
</p></li><li class="substepexpand"><span>Create a VPN instance and enter the VPN instance view.</span><p><pre class="screen"><a href="cmdqueryname=ip+vpn-instance"><b><span class="cmdname">ip vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i></pre>
</p></li><li class="substepexpand"><span>Create a VNI and associate the VNI with the VPN instance.</span><p><pre class="screen"><a href="cmdqueryname=vxlan+vni"><b><span class="cmdname">vxlan vni</span></b></a> <i><span class="varname">vni-id</span></i></pre>
<p>By default, no VNI is associated with a VPN instance.</p>
</p></li><li class="substepexpand"><span>Enable the IPv4 address family for the VPN instance, and enter the VPN instance IPv4 address family view.</span><p><pre class="screen"><a href="cmdqueryname=ipv4-family"><b><span class="cmdname">ipv4-family</span></b></a></pre>
</p></li><li class="substepexpand"><span>Configure an RD for the VPN instance IPv4 address family.</span><p><pre class="screen"><a href="cmdqueryname=route-distinguisher"><b><span class="cmdname">route-distinguisher</span></b></a> <i><span class="varname">route-distinguisher</span></i></pre>
<p>By default, no RD is configured for the VPN instance IPv4 address family.</p>
</p></li><li class="substepexpand"><span>(Optional) Configure a VPN target for the VPN instance IPv4 address family.</span><p><pre class="screen"><a href="cmdqueryname=vpn-target"><b><span class="cmdname">vpn-target</span></b></a> <i><span class="varname">vpn-target</span></i> &amp;&lt;1-8&gt; [ <strong><span>both</span></strong> | <strong><span>export-extcommunity</span></strong> | <strong><span>import-extcommunity</span></strong> ]</pre>
</p><p><p>By default, no VPN target is configured for a VPN instance IPv4 address family.</p>
<p>If the current node needs to exchange L3VPN routes with other nodes in the same VPN instance, perform this step to configure VPN targets for the VPN instance.</p>
</p></li><li class="substepexpand"><span>Configure the VPN target extended community attribute of EVPN routes in the VPN instance IPv4 address family.</span><p><pre class="screen"><a href="cmdqueryname=vpn-target"><b><span class="cmdname">vpn-target</span></b></a> <i><span class="varname">vpn-target</span></i> &amp;&lt;1-8&gt; [ <strong><span>both</span></strong> | <strong><span>export-extcommunity</span></strong> | <strong><span>import-extcommunity</span></strong> ] <strong><span>evpn</span></strong></pre>
</p><p><p>When the local device advertises an EVPN IP prefix route to a peer, the route carries all the VPN targets in the export VPN target list configured for EVPN routes in this step. When the local device advertises an EVPN IRB route to a peer, the route carries all VPN targets in the export VPN target list of the EVPN instance in the BD.</p>
<p>The IRB route or IP prefix route received by the local device can be added to the routing table of the local VPN instance IPv4 address family only when the VPN targets carried in the route overlap those in the import VPN target list configured for EVPN routes in this step.</p>
</p></li><li class="substepexpand"><span>(Optional) Associate the VPN instance IPv4 address family with an import route-policy to filter EVPN routes imported to the VPN instance IPv4 address family.</span><p><pre class="screen"><a href="cmdqueryname=import+route-policy"><b><span class="cmdname">import route-policy</span></b></a> <i><span class="varname">policy-name</span></i> <strong><span>evpn</span></strong></pre>
<p>To control the EVPN routes that enter the current VPN instance IPv4 address family more precisely, you can specify an import route-policy to filter EVPN routes and set route attributes for the routes that match the filter criteria.</p>
</p></li><li class="substepexpand"><span>(Optional) Associate the VPN instance IPv4 address family with an export route-policy to filter EVPN routes to be advertised by the VPN instance IPv4 address family.</span><p><pre class="screen"><a href="cmdqueryname=export+route-policy"><b><span class="cmdname">export route-policy</span></b></a> <i><span class="varname">policy-name</span></i> <strong><span>evpn</span></strong></pre>
<p>Perform this step to apply an export route-policy to the VPN instance IPv4 address family and set attributes for eligible EVPN routes. This enables the device to control EVPN routes to be advertised more precisely.</p>
</p></li><li class="substepexpand"><span>Commit the configuration.</span><p><pre class="screen" id="EN-US_TASK_0000001193876283__en-us_task_0234857734_screen14848162118611"><a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001193876283__en-us_task_0234857734_cmdname1784862115612">commit</span></b></a></pre>
</p></li></ol>
</li><li><span>For an IPv6 overlay network, perform the following operations:</span><ol><li class="substepexpand"><span>Enter the system view.</span><p><pre class="screen"><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></pre>
</p></li><li class="substepexpand"><span>Create a VPN instance and enter the VPN instance view.</span><p><pre class="screen"><a href="cmdqueryname=ip+vpn-instance"><b><span class="cmdname">ip vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i></pre>
</p></li><li class="substepexpand"><span>Create a VNI and associate the VNI with the VPN instance.</span><p><pre class="screen"><a href="cmdqueryname=vxlan+vni"><b><span class="cmdname">vxlan vni</span></b></a> <i><span class="varname">vni-id</span></i></pre>
<p>By default, no VNI is associated with a VPN instance.</p>
</p></li><li class="substepexpand"><span>Enable the IPv6 address family for the VPN instance, and enter the VPN instance IPv6 address family view.</span><p><pre class="screen"><a href="cmdqueryname=ipv6-family"><b><span class="cmdname">ipv6-family</span></b></a></pre>
</p></li><li class="substepexpand"><span>Configure an RD for the VPN instance IPv6 address family.</span><p><pre class="screen"><a href="cmdqueryname=route-distinguisher"><b><span class="cmdname">route-distinguisher</span></b></a> <i><span class="varname">route-distinguisher</span></i></pre>
<p>By default, no RD is configured for the VPN instance IPv6 address family.</p>
</p></li><li class="substepexpand"><span>(Optional) Configure a VPN target for the VPN instance IPv6 address family.</span><p><pre class="screen"><a href="cmdqueryname=vpn-target"><b><span class="cmdname">vpn-target</span></b></a> <i><span class="varname">vpn-target</span></i> &amp;&lt;1-8&gt; [ <strong><span>both</span></strong> | <strong><span>export-extcommunity</span></strong> | <strong><span>import-extcommunity</span></strong> ]</pre>
</p><p><p>By default, no VPN target is configured for a VPN instance IPv4 address family.</p>
<p>If the current node needs to exchange L3VPN routes with other nodes in the same VPN instance, perform this step to configure VPN targets for the VPN instance.</p>
</p></li><li class="substepexpand"><span>Configure the VPN target extended community attribute of EVPN routes in the VPN instance IPv6 address family.</span><p><pre class="screen"><a href="cmdqueryname=vpn-target"><b><span class="cmdname">vpn-target</span></b></a> <i><span class="varname">vpn-target</span></i> &amp;&lt;1-8&gt; [ <strong><span>both</span></strong> | <strong><span>export-extcommunity</span></strong> | <strong><span>import-extcommunity</span></strong> ] <strong><span>evpn</span></strong></pre>
</p><p><p>When the local device advertises an EVPN IPv6 prefix route to a peer, the route carries all the VPN targets in the export VPN target list configured for EVPN routes in this step. When the local device advertises an EVPN IRBv6 route to a peer, the route carries all VPN targets in the export VPN target list of the EVPN instance in the BD.</p>
<p>The IRBv6 route or IPv6 prefix route received by the local device can be added to the routing table of the local VPN instance IPv6 address family only when the VPN targets carried in the route overlap those in the import VPN target list configured for EVPN routes in this step.</p>
</p></li><li class="substepexpand"><span>(Optional) Associate the VPN instance IPv6 address family with an import route-policy to filter EVPN routes imported to the VPN instance IPv6 address family.</span><p><pre class="screen"><a href="cmdqueryname=import+route-policy"><b><span class="cmdname">import route-policy</span></b></a> <i><span class="varname">policy-name</span></i> <strong><span>evpn</span></strong></pre>
<p>To control the EVPN routes that enter the current VPN instance IPv6 address family more precisely, you can specify an import route-policy to filter EVPN routes and set route attributes for the routes that match the filter criteria.</p>
</p></li><li class="substepexpand"><span>(Optional) Associate the VPN instance IPv6 address family with an export route-policy to filter EVPN routes to be advertised by the VPN instance IPv6 address family.</span><p><pre class="screen"><a href="cmdqueryname=export+route-policy"><b><span class="cmdname">export route-policy</span></b></a> <i><span class="varname">policy-name</span></i> <strong><span>evpn</span></strong></pre>
<p>Perform this step to apply an export route-policy to the VPN instance IPv6 address family and set attributes for eligible EVPN routes. This enables the device to control EVPN routes to be advertised more precisely.</p>
</p></li><li class="substepexpand"><span>Commit the configuration.</span><p><pre class="screen" id="EN-US_TASK_0000001193876283__en-us_task_0234857734_screen14848162118611_1"><a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001193876283__en-us_task_0234857734_cmdname1784862115612_1">commit</span></b></a></pre>
</p></li></ol>
</li></ul></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../dc/dc_vrp_vxlan6_cfg_1066.html">Establishing IPv6 VXLAN Tunnels in BGP EVPN Mode (Distributed VXLAN Gateway)
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../dc/dc_vrp_vxlan6_cfg_1090.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../dc/dc_vrp_vxlan6_cfg_1091.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>