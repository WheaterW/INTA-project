
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring a Static Bypass VXLAN Tunnel">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../dc/dc_cfg_m-lag_0015.html">
<meta name="DC.Relation" scheme="URI" content="../dc/dc_cfg_m-lag_0041.html">
<meta name="DC.Relation" scheme="URI" content="../dc/dc_cfg_m-lag_0017.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="M-LAG">
<meta name="featuretype" content="High Availability">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="M-LAG">
<meta name="featuretype" content="High Availability">
<meta name="featurename" content="M-LAG">
<meta name="featuretype" content="High Availability">
<meta name="featuretype" content="High Availability">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001638300640">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="../public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="../public_sys-resources/browseVersion.js"></script>
<title>Configuring a Static Bypass VXLAN Tunnel</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001638300640"></a><a name="EN-US_TASK_0000001638300640"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring a Static Bypass VXLAN Tunnel</h1>
<div class="taskbody"><div class="prereq" style="margin-left:0"><a name="EN-US_TASK_0000001638300640__1.3.1"></a><a name="1.3.1"></a><h4 class="sectiontitle">Prerequisites</h4>
<div class="p"><p id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_p1721514512517">You have completed the following tasks:</p>
<ul id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_ul1654483271814"><li id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_li9544143215186">Configure M-LAG active-active gateways.</li><li id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_li11948202013198">Configure VXLAN VNIs for the BDs corresponding to the active-active gateways' VBDIF interfaces.</li></ul>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001638300640__1.3.2"></a><a name="1.3.2"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>In a physical peer-link scenario where a device is dual-homed to a VXLAN network through an M-LAG and an access-side link fails, service traffic needs to be transmitted through the bypass VXLAN tunnel between M-LAG member devices. In this scenario, a static bypass VXLAN tunnel must be configured between M-LAG member devices.</p>
<p>In a virtual peer-link scenario, a static bypass VXLAN tunnel needs to be deployed between M-LAG member devices to replace the peer-link physical connection.</p>
<p>In a physical peer-link scenario, the traffic of the bypass VXLAN tunnel must traverse the peer-link physical connection. In a virtual peer-link scenario, the traffic of the bypass VXLAN tunnel can be forwarded based on routes.</p>
<div class="note"><img src="../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>For the <span>CE6820H, CE6820H-K, and CE6820S</span>: VXLAN-related configurations are not supported.</p>
<p>For the <span>CE6885-LL (low latency mode)</span>: VXLAN and IPv6-related configurations are not supported.</p>
<p>In a virtual peer-link scenario, if a bypass VXLAN tunnel already exists when you configure the peer-link, you do not need to configure the tunnel again.</p>
</div></div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001638300640__1.3.3"></a><a name="1.3.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_step19650459111912"><span id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_cmd18650175951911">Enter the system view.</span><p><pre class="screen" id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_screen1587313371855"><a href="cmdqueryname=system-view"><b><span class="cmdname" id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_cmdname40761576214036">system-view</span></b></a></pre>
</p></li><li id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_step128311320173513"><span id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_cmd283216209355">Enter the VLANIF interface view.</span><p><pre class="screen" id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_screen13200113313353"><a href="cmdqueryname=interface"><b><span class="cmdname" id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_cmdname112001233143516">interface</span></b></a> <strong><span id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_cmdparmname1629416388358">vlanif</span></strong> <i><span class="varname" id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_varname4481544173514">vlan-id</span></i></pre>
</p></li><li id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_step3707123111443"><span id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_cmd17707103174414">Configure an IP address for the VLANIF interface of the peer-link interface. This address is used as the source IP address of the static bypass VXLAN tunnel.</span><p><ul id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_ul312154152010"><li id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_li101234102016">In an underlay IPv4 VXLAN scenario, run the following commands:<pre class="screen" id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_screen103749144615"><a href="cmdqueryname=ip+address"><b><span class="cmdname" id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_cmdname170015717426">ip address</span></b></a> <i><span class="varname" id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_varname67017712429">ip-address</span></i> { <i><span class="varname" id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_varname1070210754214">mask</span></i> | <i><span class="varname" id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_varname770314774212">mask-length</span></i> } [ <strong><span id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_cmdparmname87042712422">sub</span></strong> ]</pre>
</li><li id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_li58981731192115">In an underlay IPv6 VXLAN scenario, run the following commands:<pre class="screen" id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_screen68424123234"><a href="cmdqueryname=ipv6+enable"><b><span class="cmdname" id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_cmdname863771414214031">ipv6 enable</span></b></a>
<a href="cmdqueryname=ipv6+address"><b><span class="cmdname" id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_cmdname1435966498214031">ipv6 address</span></b></a> { <i><span class="varname" id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_varname821548938214031">ipv6-address</span></i> <i><span class="varname" id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_varname2139918871214031">prefix-length</span></i> | <i><span class="varname" id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_varname2132852294214031">ipv6-address</span></i>/<i><span class="varname" id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_varname1722895494214031">prefix-length</span></i> } [ <strong><span id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_cmdparmname719748136214031">eui-64</span></strong> ]</pre>
<div class="note" id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_note16411919194115"><img src="../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_p13222039381">If the <a href="cmdqueryname=vxlan+tunnel-status+track+exact-route"><b><span class="cmdname" id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_cmdname19850101919426">vxlan tunnel-status track exact-route</span></b></a> command has been run on a device, subscription to the status of exact routes to the VXLAN tunnel destination is enabled. The tunnel status is up only when exact routes to the tunnel destination IP address are reachable. In this case, you are advised to use loopback addresses to establish a bypass VXLAN tunnel between M-LAG devices.</p>
</div></div>
</li></ul>
</p></li><li id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_step1174164034620"><span id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_cmd3174134014462">(Optional) Reserve the VLANIF interface IP address for the bypass VXLAN tunnel.</span><p><pre class="screen" id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_screen744571245513"><a href="cmdqueryname=reserved+for+vxlan+bypass"><b><span class="cmdname" id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_cmdname2445171214550">reserved for vxlan bypass</span></b></a></pre>
<p id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_p968210501412">By default, the IP address of a VLANIF interface is not reserved for exclusive use by the bypass VXLAN tunnel.</p>
<div class="note" id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_note193952051135217"><img src="../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_p1239565165211">If the M-LAG configuration consistency check is enabled by running the <a href="cmdqueryname=consistency-check+enable"><b><span class="cmdname" id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_cmdname966819236532">consistency-check enable</span></b></a> command on M-LAG member devices, the configurations of VLANIF interfaces for peer-link interfaces on the M-LAG master and backup devices are checked. If the configurations are inconsistent, an alarm is reported. In this case, you can run this command to configure the IP address of the VLANIF interface for a peer-link interface to be used exclusively by the bypass VXLAN tunnel, and then configure the system to perform any consistency check on VLANIF interfaces' IP and MAC addresses on the M-LAG master and backup devices. If they are consistent, the system reports an alarm.</p>
</div></div>
</p></li><li id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_step3492164110558"><span id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_cmd449234145513">Exit the VLANIF interface view.</span><p><pre class="screen" id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_screen22436149562"><strong id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_b26041320115615">quit</strong></pre>
</p></li><li id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_step47931232164116"><span id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_cmd1579383216413">Enter the NVE interface view.</span><p><pre class="screen" id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_screen19221356105618"><a href="cmdqueryname=interface"><b><span class="cmdname" id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_cmdname1766926211214031">interface</span></b></a> <strong><span id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_cmdparmname2056224747214031">nve</span></strong> <i><span class="varname" id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_varname992858317214031">nve-number</span></i></pre>
</p></li><li id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_step57634554211"><span id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_cmd57621054421">Create a static bypass VXLAN tunnel and specify the source and peer addresses.</span><p><pre class="screen" id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_screen18215422446"><a href="cmdqueryname=pip-source"><b><span class="cmdname" id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_cmdname1241341114411">pip-source</span></b></a> <i><span class="varname" id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_varname15873185634413">src-ip</span></i> <strong><span id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_cmdparmname9242134194516">peer</span></strong> <i><span class="varname" id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_varname290617817457">peer-ip</span></i> <strong><span id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_cmdparmname2661827164520">bypass</span></strong></pre>
<p id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_p474975814318">By default, no static bypass VXLAN tunnel is created between M-LAG devices.</p>
<div class="p" id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_p294201719247">The values of <i><span class="varname" id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_varname9596192102516">src-ip</span></i> and <i><span class="varname" id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_varname4218158102517">peer-ip</span></i> are IPv4 addresses in an underlay IPv4 VXLAN scenario, and IPv6 addresses in an underlay IPv6 VXLAN scenario.<div class="note" id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_note1851431616343"><img src="../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><ul id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_ul2024012223714"><li id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_li16240622163718">In a physical peer-link scenario, ensure that the outbound interface of the bypass VXLAN tunnel (the outbound interface of the route to <i><span class="varname" id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_varname1766916673714">peer-ip</span></i>) is the peer-link interface. Otherwise, the bypass VXLAN tunnel may fail to forward traffic.</li><li id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_li7754524123719">An IPv4 bypass VXLAN tunnel and an IPv6 bypass VXLAN tunnel are mutually exclusive.</li></ul>
</div></div>
</div>
</p></li><li id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_step139894716815"><span id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_en-us_task_0228023023_cmd10380203014117">Commit the configuration.</span><p><pre class="screen" id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_en-us_task_0228023023_screen163801330213"><a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001638300640__en-us_task_0000001130784306_en-us_task_0228023023_en-us_concept_0141113565_cmdname1667501373175340">commit</span></b></a></pre>
</p></li></ol></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../dc/dc_cfg_m-lag_0015.html">Configuring M-LAG Dual-Active Gateways
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../dc/dc_cfg_m-lag_0041.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../dc/dc_cfg_m-lag_0017.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>