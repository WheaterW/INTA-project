
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring BGP Route Processing">
<meta name="abstract" content="">
<meta name="description" content="">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="galaxy_adaptive_routing_cfg_0021.html">
<meta name="DC.Relation" scheme="URI" content="galaxy_adaptive_routing_cfg_0011.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="Dragonfly Adaptive Routing">
<meta name="featurename" content="Adaptive Routing">
<meta name="featuretype" content="Intelligent Lossless Network">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="Dragonfly Adaptive Routing">
<meta name="featurename" content="Adaptive Routing">
<meta name="featuretype" content="Intelligent Lossless Network">
<meta name="featurename" content="Dragonfly Adaptive Routing">
<meta name="featurename" content="Adaptive Routing">
<meta name="featuretype" content="Intelligent Lossless Network">
<meta name="featuretype" content="Intelligent Lossless Network">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001563990649">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>Configuring BGP Route Processing</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001563990649"></a><a name="EN-US_TASK_0000001563990649"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring BGP Route Processing</h1>
<div class="taskbody"><p></p>
<div class="context"><a name="EN-US_TASK_0000001563990649__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>The adaptive routing function can be used on a device only after specific BGP routes and the corresponding routing policies are correctly configured.</p>
<ul><li>Configure the device to import direct routes in the Mix VPN instance to the public network routing table.</li><li>Configure route advertisement and reception for the public network instance.</li><li>Configure route import, advertisement, and reception for the Non-min VPN instance.</li><li>Configure route import for the Mix VPN instance.</li><li>Configure load balancing.</li></ul>
<p>For details about how to configure BGP routes, see the operations of configuring BGP route processing in <a href="galaxy_adaptive_routing_cfg_0016.html">Example for Configuring Adaptive Routing</a>.</p>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001563990649__1.4.2"></a><a name="1.4.2"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Enter the system view.</span><p><pre class="screen"><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></pre>
</p></li><li><span>Configure the device to import direct routes in the Mix VPN instance to the public network routing table.</span><p><pre class="screen"><strong><a href="cmdqueryname=ip+import-rib+vpn-instance"><b><span class="cmdname">ip import-rib vpn-instance</span></b></a></strong> <em>vpn-instance-name</em> <strong><span>protocol</span></strong> <strong><span>direct</span></strong></pre>
</p></li><li><span>Configure route advertisement and reception for the public network instance.</span><p><ol type="a"><li>Start a BGP process.<ol class="substepthirdol"><li>Enable BGP (with a specified local AS number) and enter the BGP view.<pre class="screen"><strong><a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> </strong><em>as-number</em></pre>
<p>Devices in the same group must belong to the same AS, meaning they must have the same AS number. Devices in different groups must belong to different ASs, meaning they must have different AS numbers.</p>
<p>When global adaptive routing is enabled on a device, the AS number of the device ranges from 4200000000 to 4200000210. If a BGP AS number not in this range is configured, the configuration fails to be delivered.</p>
</li><li>Configure a router ID for BGP.<pre class="screen"><strong><a href="cmdqueryname=router-id"><b><span class="cmdname">router-id</span></b></a></strong> <em>ipv4-address</em></pre>
</li></ol>
</li><li>Configure a BGP peer.<ol class="substepthirdol"><li>Create a BGP peer group.<pre class="screen"><strong><a href="cmdqueryname=group"><b><span class="cmdname">group</span></b></a> </strong><em>group-name</em> { <strong>internal</strong> | <strong>external</strong> }</pre>
</li><li>Configure an IP address for the peer and the number of the AS where the peer resides.<pre class="screen"><strong><a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a></strong> { <em>ipv4-address</em> | <em>group-name</em> } <strong><strong><span>as-number</span></strong></strong> <em>as-number</em></pre>
</li><li>Add the peer to the peer group.<pre class="screen"><strong><a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a></strong> <em>ipv4-address</em> <strong><strong><span>group</span></strong></strong> <em>group-name</em></pre>
</li></ol>
</li><li>Configure BGP to import routes.<ol class="substepthirdol"><li>Enter the BGP-IPv4 unicast address family view.<pre class="screen"><strong><a href="cmdqueryname=ipv4-family+unicast"><b><span class="cmdname">ipv4-family unicast</span></b></a></strong></pre>
</li><li>Configure BGP to import local routes.<pre class="screen"><strong><a href="cmdqueryname=network"><b><span class="cmdname">network</span></b></a></strong> <em>ipv4-address</em> [ <em>mask</em> | <em>mask-length</em> ]</pre>
<p>Ensure that only the routes of the compute nodes in the Mix VPN instance are imported. The routes of the public network instance cannot be imported to BGP routes.</p>
</li></ol>
</li><li>Set the maximum number of BGP equal-cost routes that can participate in load balancing globally.<pre class="screen"><strong><a href="cmdqueryname=maximum+load-balancing"><b><span class="cmdname">maximum load-balancing</span></b></a></strong> <em>number</em></pre>
</li><li>Configure a BGP route reflector (RR).<ol class="substepthirdol"><li>Set a cluster ID for the RR.<pre class="screen"><strong><a href="cmdqueryname=reflector+cluster-id"><b><span class="cmdname">reflector cluster-id</span></b></a></strong> { <em>cluster-id-value</em> | <em>cluster-id-ipv4</em> }</pre>
<p>All devices on the network must be configured as RRs, and devices in the same group must have different RR cluster IDs.</p>
</li><li>Enable the RR to modify the path attributes of BGP routes using an export policy.<pre class="screen"><strong><a href="cmdqueryname=reflect+change-path-attribute"><b><span class="cmdname">reflect change-path-attribute</span></b></a></strong></pre>
</li><li>Configure an RR and its clients.<pre class="screen"><strong><a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a></strong> { <em>ipv4-address</em> | <em>group-name</em> } <strong><strong><span>reflect-client</span></strong></strong></pre>
</li></ol>
</li><li>Configure the device to filter the routes to be advertised to a specified peer or peer group.<pre class="screen"><strong><a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a></strong> { <em>ipv4-address</em> | <em>group-name</em> } <strong><strong><span>route-policy</span></strong></strong> <em>route-policy-name</em> <strong><strong><span>export</span></strong></strong></pre>
</li><li>Configure the device to filter the routes to be received from a specified peer or peer group.<pre class="screen"><strong><a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a></strong> { <em>ipv4-address</em> | <em>group-name</em> } <strong><strong><span>route-policy</span></strong></strong> <em>route-policy-name</em> <strong><strong><span>import</span></strong></strong></pre>
</li><li>Enable BGP Auto FRR for unicast routes.<pre class="screen"><strong><a href="cmdqueryname=auto-frr"><b><span class="cmdname">auto-frr</span></b></a></strong></pre>
</li><li>Exit the BGP-IPv4 unicast address family view.<pre class="screen"><strong><a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></strong></pre>
</li><li>Commit the configuration.<pre class="screen"><strong><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></strong></pre>
</li></ol>
</p></li><li><span>Configure route import, advertisement, and reception for the Non-min VPN instance.</span><p><ol type="a"><li>Enter the Non-min VPN instance IPv4 address family view.<pre class="screen"><strong><a href="cmdqueryname=ipv4-family+vpn-instance"><b><span class="cmdname">ipv4-family vpn-instance</span></b></a></strong> <em>vpn-instance-name</em></pre>
</li><li>Configure the device to import BGP routes from the routing table of the public network instance to the routing table of the Non-min VPN instance.<pre class="screen"><strong><a href="cmdqueryname=import-rib"><b><span class="cmdname">import-rib</span></b></a> public</strong> [ <strong>valid-route</strong> ] [ <strong>route-policy</strong> <em>route-policy-name</em> ]</pre>
</li><li>Set the maximum number of BGP equal-cost routes that can participate in load balancing globally.<pre class="screen"><strong><a href="cmdqueryname=maximum+load-balancing"><b><span class="cmdname">maximum load-balancing</span></b></a></strong> <em>number</em></pre>
</li><li>Create a BGP peer group.<pre class="screen"><strong><a href="cmdqueryname=group"><b><span class="cmdname">group</span></b></a> </strong><em>group-name</em> <strong>internal</strong></pre>
</li><li>Configure an IP address for the peer and the number of the AS where the peer resides.<pre class="screen"><strong><a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a></strong> { <em>ipv4-address</em> | <em>group-name</em> } <strong><strong><span>as-number</span></strong></strong> <em>as-number</em></pre>
</li><li>Add the peer to the peer group.<pre class="screen"><strong><a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a></strong> <em>ipv4-address</em> <strong><strong><span>group</span></strong></strong> <em>group-name</em></pre>
</li><li>Configure the device to filter the routes to be advertised to a specified peer or peer group.<pre class="screen"><strong><a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a></strong> { <em>ipv4-address</em> | <em>group-name</em> } <strong><strong><span>route-policy</span></strong></strong> <em>route-policy-name</em> <strong><strong><span>export</span></strong></strong></pre>
</li><li>Configure the device to filter the routes to be received from a specified peer or peer group.<pre class="screen"><strong><a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a></strong> { <em>ipv4-address</em> | <em>group-name</em> } <strong><strong><span>route-policy</span></strong></strong> <em>route-policy-name</em> <strong><strong><span>import</span></strong></strong></pre>
</li><li>Exit the Non-min VPN instance IPv4 address family view.<pre class="screen"><strong><a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></strong></pre>
</li><li>Commit the configuration.<pre class="screen"><strong><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></strong></pre>
</li></ol>
</p></li><li><span>Configure route import for the Mix VPN instance.</span><p><ol type="a"><li>Enter the Mix VPN instance IPv4 address family view.<pre class="screen"><strong><a href="cmdqueryname=ipv4-family+vpn-instance"><b><span class="cmdname">ipv4-family vpn-instance</span></b></a></strong> <em>vpn-instance-name</em></pre>
</li><li>Configure BGP load balancing.<ol class="substepthirdol"><li>Set the maximum number of BGP equal-cost routes that can participate in load balancing globally.<pre class="screen"><strong><a href="cmdqueryname=maximum+load-balancing"><b><span class="cmdname">maximum load-balancing</span></b></a></strong> <em>number</em></pre>
</li><li>Disable the device from comparing the AS-Path attributes of the routes for load balancing.<pre class="screen"><strong><a href="cmdqueryname=load-balancing+as-path-ignore"><b><span class="cmdname">load-balancing as-path-ignore</span></b></a></strong></pre>
</li><li>Disable the device from comparing the MED values of the routes for load balancing.<pre class="screen"><strong><a href="cmdqueryname=load-balancing+med-ignore"><b><span class="cmdname">load-balancing med-ignore</span></b></a></strong></pre>
</li><li>Enable load balancing among EBGP and IBGP routes.<pre class="screen"><strong><a href="cmdqueryname=load-balancing+eibgp"><b><span class="cmdname">load-balancing eibgp</span></b></a></strong></pre>
</li><li>Configure BGP adaptive routing to automatically adjust traffic forwarding paths based on network topology and traffic load changes.<pre class="screen"><strong><a href="cmdqueryname=load-balancing+adaptive-routing"><b><span class="cmdname">load-balancing adaptive-routing</span></b></a></strong></pre>
</li></ol>
</li><li>Configure the device to import BGP routes from the public network routing table to the routing table of the Mix VPN instance.<pre class="screen"><strong><a href="cmdqueryname=import-rib"><b><span class="cmdname">import-rib</span></b></a> <strong><span>public</span></strong></strong> [ <strong><strong><span>valid-route</span></strong></strong> ] [ <strong><strong><span>route-policy</span></strong></strong> <em>route-policy-name</em> ]</pre>
</li><li>Configure the device to import BGP routes from the routing table of the Non-min VPN instance to the routing table of the Mix VPN instance.<pre class="screen"><strong><a href="cmdqueryname=import-rib"><b><span class="cmdname">import-rib</span></b></a></strong> <strong><strong><span>vpn-instance</span></strong></strong> <em>vpn-instance-name</em> [ <strong><strong><span>valid-route</span></strong></strong> ] [ <strong><strong><span>route-policy</span></strong></strong> <em>route-policy-name</em> ]</pre>
</li><li>Exit the Mix VPN instance IPv4 address family view.<pre class="screen"><strong><a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></strong></pre>
</li><li>Exit the BGP view.<pre class="screen"><strong><a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></strong></pre>
</li><li>Commit the configuration.<pre class="screen"><strong><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></strong></pre>
</li></ol>
</p></li><li><span>Configure a dynamic load balancing mode for ECMP.</span><p><ol type="a"><li>Enter the ECMP view.<pre class="screen"><strong><a href="cmdqueryname=load-balance+ecmp"><b><span class="cmdname">load-balance ecmp</span></b></a></strong></pre>
</li><li>Enable the eligible ECMP dynamic load balancing mode.<pre class="screen"><strong><a href="cmdqueryname=ecmp+mode"><b><span class="cmdname">ecmp mode</span></b></a> <strong><span>eligible</span></strong> <strong><span>flowlet-gap-time</span></strong> </strong><em>flowlet-gap-time</em></pre>
<p>In eligible dynamic load balancing mode, based on the flowlet, the device selects a member link with the lightest load to forward data packets. Data packets in the same flowlet are forwarded through the same link.</p>
</li><li>Commit the configuration.<pre class="screen"><strong><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></strong></pre>
</li></ol>
</p></li></ol></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="galaxy_adaptive_routing_cfg_0021.html">Configuring Route Establishment Rules
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="galaxy_adaptive_routing_cfg_0011.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>
</body>
</html>