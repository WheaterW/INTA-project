
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring an ECMP Mode">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="galaxy_loadba_performance_cfg_0009.html">
<meta name="DC.Relation" scheme="URI" content="galaxy_loadba_performance_cfg_0010.html">
<meta name="DC.Relation" scheme="URI" content="galaxy_loadba_performance_cfg_0018.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="Load Balancing">
<meta name="featuretype" content="IP Addresses and Services">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="Load Balancing">
<meta name="featuretype" content="IP Addresses and Services">
<meta name="featurename" content="Load Balancing">
<meta name="featuretype" content="IP Addresses and Services">
<meta name="featuretype" content="IP Addresses and Services">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001564001393">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>Configuring an ECMP Mode</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001564001393"></a><a name="EN-US_TASK_0000001564001393"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring an ECMP Mode</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001564001393__1.3.1"></a><a name="1.3.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>Devices support load balancing for IP and tunnel packets.</p>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001564001393__1.3.2"></a><a name="1.3.2"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Enter the system view.</span><p><pre class="screen"><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></pre>
</p></li><li><span>Enter the ECMP view.</span><p><pre class="screen"><a href="cmdqueryname=load-balance+ecmp"><b><span class="cmdname">load-balance ecmp</span></b></a></pre>
</p></li><li><span>Configure an ECMP mode.</span><p>
<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" frame="border" border="1" rules="all"><caption><b>Table 1 </b>Configuring an ECMP mode</caption><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="28.000000000000004%" id="mcps1.3.2.3.2.1.2.4.1.1" liSelected="liSelected"><p>Operation</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="28.000000000000004%" id="mcps1.3.2.3.2.1.2.4.1.2" liSelected="liSelected"><p>Command</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="44%" id="mcps1.3.2.3.2.1.2.4.1.3" liSelected="liSelected"><p>Description</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" valign="top" width="28.000000000000004%" headers="mcps1.3.2.3.2.1.2.4.1.1 "><p>Configure a load balancing mode for IP packets.</p>
</td>
<td class="cellrowborder" valign="top" width="28.000000000000004%" headers="mcps1.3.2.3.2.1.2.4.1.2 "><p><a href="cmdqueryname=ip"><b><span class="cmdname">ip</span></b></a> <span>[ <strong>src-ip</strong> | <strong>dst-ip</strong> | <strong>vlan</strong> | <strong>l4-src-port</strong> | <strong>l4-dst-port</strong> | <strong>protocol </strong>| <strong>flow-label</strong> | <strong>src-interface</strong>] <sup>*</sup></span></p>
</td>
<td class="cellrowborder" valign="top" width="44%" headers="mcps1.3.2.3.2.1.2.4.1.3 "><p>IP packets can be balanced based on any combination of a source IP address, destination IP address, VLAN ID, transport-layer source port, transport-layer destination port, protocol, flow label, and physical source port. The device uses the hash algorithm to calculate a value based on the configured combination and selects a link to forward packets based on the value.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="28.000000000000004%" headers="mcps1.3.2.3.2.1.2.4.1.1 "><p>Configure a hash mode for load balancing for the <span>CE6866, CE6860-SAN, CE6866K, CE6860-HAM, CE8851-32CQ8DQ-P, CE8850-SAN, CE8851K, CE8850-HAM</span> .</p>
</td>
<td class="cellrowborder" valign="top" width="28.000000000000004%" headers="mcps1.3.2.3.2.1.2.4.1.2 "><p><a href="cmdqueryname=hashmode"><b><span class="cmdname">hashmode</span></b></a><i><span class="varname"> value1</span></i></p>
</td>
<td class="cellrowborder" valign="top" width="44%" headers="mcps1.3.2.3.2.1.2.4.1.3 "><p>You can select an appropriate algorithm for load balancing based on a traffic model.</p>
<div class="p">Different load balancing results will be achieved using different hash algorithms. You can select an appropriate hash mode for load balancing based on a traffic model. The polynomial calculation result is closely related to the change rules of packet characteristics, number of ECMP members, and number of packets. The following conclusions are for reference only:<ul><li>To configure distribution of packets with the same source and destination addresses, you are advised to set the hash mode to 1.</li><li>If the source IP address changes, you are advised to set the hash mode to 0 or 2.</li><li>If the source port changes, you are advised to set the hash mode to 0 or 2.</li><li>If the destination port changes, you are advised to set the hash mode to 0 or 2.</li><li>If the source and destination IP addresses change, you are advised to set the hash mode to 0 or 2.</li><li>If the source and destination ports change, you are advised to set the hash mode to 0 or 2.</li></ul>
</div>
<p>In conclusion, you are advised to set the hash mode to 0 or 2 unless you need to configure distribution of packets with the same source and destination addresses.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="28.000000000000004%" headers="mcps1.3.2.3.2.1.2.4.1.1 "><p>Configure a hash mode for load balancing <span>for the </span><span>CE6820H, CE6820H-K, CE6863H, CE6863H-K, CE6881H, CE6881H-K, CE6820S</span>.</p>
</td>
<td class="cellrowborder" valign="top" width="28.000000000000004%" headers="mcps1.3.2.3.2.1.2.4.1.2 "><p><a href="cmdqueryname=hashmode"><b><span class="cmdname">hashmode</span></b></a> <i><span class="varname">value2</span></i></p>
</td>
<td class="cellrowborder" valign="top" width="44%" headers="mcps1.3.2.3.2.1.2.4.1.3 "><p>You can select an appropriate algorithm for load balancing based on a traffic model.</p>
<div class="p">Different load balancing results will be achieved using different hash algorithms. You can select an appropriate hash mode for load balancing based on a traffic model. The polynomial calculation result is closely related to the change rules of packet characteristics, number of ECMP members, and number of packets. The following conclusions are for reference only:<ul><li>To configure distribution of packets with the same source and destination addresses, you are advised to set the hash mode to 1.</li><li>If per-packet load balancing is required, you are advised to set the hash mode to 2.</li></ul>
</div>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="28.000000000000004%" headers="mcps1.3.2.3.2.1.2.4.1.1 "><p>Configure a hash mode for load balancing<span> for the </span><span>CE8855, CE8851-32CQ4BQ, CE6855-48XS8CQ, CE6885, CE6885-SAN, CE6885-LL, CE6885-T, CE6863E-48S8CQ</span>.</p>
</td>
<td class="cellrowborder" valign="top" width="28.000000000000004%" headers="mcps1.3.2.3.2.1.2.4.1.2 "><p><a href="cmdqueryname=hashmode"><b><span class="cmdname">hashmode</span></b></a> <strong> { overlay|underlay } </strong><i><span class="varname">value3</span></i></p>
</td>
<td class="cellrowborder" valign="top" width="44%" headers="mcps1.3.2.3.2.1.2.4.1.3 "><p>In ECMP load balancing scenarios, if the hash result is uneven, you can run the <strong>hashmode</strong> command to change the hash mode, making the result more even. Different load balancing results will be achieved using different hash algorithms. You can select an appropriate hash mode for load balancing based on a traffic model.</p>
<p>Overlay load balancing:</p>
<p>If the destination IP address changes, you are advised to set the hash mode to 2 or 14.</p>
<p>If the source IP address changes, you are advised to set the hash mode to 4 or 15.</p>
<p>If the source port changes, you are advised to set the hash mode to 0.</p>
<p>If the destination port changes, you are advised to set the hash mode to 15.</p>
<p>If the source and destination IP addresses change, you are advised to set the hash mode to 1.</p>
<p>If the source and destination ports change, you are advised to set the hash mode to 15.</p>
<p>Underlay load balancing:</p>
<p>If the destination IP address changes, you are advised to set the hash mode to 3 or 15.</p>
<p>If the source IP address changes, you are advised to set the hash mode to 0 or 5.</p>
<p>If the source port changes, you are advised to set the hash mode to 1.</p>
<p>If the destination port changes, you are advised to set the hash mode to 0.</p>
<p>If the source and destination IP addresses change, you are advised to set the hash mode to 2.</p>
<p>If the source and destination ports change, you are advised to set the hash mode to 0.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="28.000000000000004%" headers="mcps1.3.2.3.2.1.2.4.1.1 "><p>Configure a start hash value for the seed hash algorithm for load balancing for the <span>CE6866, CE6860-SAN, CE6866K, CE6860-HAM, CE8851-32CQ8DQ-P, CE8850-SAN, CE8851K, CE8850-HAM</span> .</p>
</td>
<td class="cellrowborder" valign="top" width="28.000000000000004%" headers="mcps1.3.2.3.2.1.2.4.1.2 "><p><a href="cmdqueryname=ecmp+seed"><b><span class="cmdname">ecmp seed</span></b></a><i><span class="varname"> seed-data</span></i></p>
</td>
<td class="cellrowborder" valign="top" width="44%" headers="mcps1.3.2.3.2.1.2.4.1.3 "><p>If a lower-level device uses the same hash algorithm as an upper-level device, the hash results are uneven or the hash operation fails. To prevent this issue, configure a start hash value for the seed hash algorithm for ECMP on the lower-level device. This ensures that the lower-level device uses the start hash value to hash traffic in addition to the hash algorithm.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="28.000000000000004%" headers="mcps1.3.2.3.2.1.2.4.1.1 "><p>Configure a start hash value for the seed hash algorithm for load balancing<span> for the </span><span>CE8855, CE8851-32CQ4BQ, CE6855-48XS8CQ, CE6885, CE6885-SAN, CE6885-LL, CE6885-T, CE6863E-48S8CQ</span>.</p>
</td>
<td class="cellrowborder" valign="top" width="28.000000000000004%" headers="mcps1.3.2.3.2.1.2.4.1.2 "><p><a href="cmdqueryname=ecmp+%7B+overlay%7Cunderlay+%7D+seed"><b><span class="cmdname">ecmp { overlay|underlay } seed</span></b></a><i><span class="varname"> seed-data</span></i></p>
</td>
<td class="cellrowborder" valign="top" width="44%" headers="mcps1.3.2.3.2.1.2.4.1.3 "><p>If a lower-level device uses the same hash algorithm as an upper-level device, the hash results are uneven or the hash operation fails. To prevent this issue, configure a start hash value for the seed hash algorithm for ECMP on the lower-level device. This ensures that the lower-level device uses the start hash value to hash traffic in addition to the hash algorithm.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="28.000000000000004%" headers="mcps1.3.2.3.2.1.2.4.1.1 "><p>Configure a load balancing mode for tunnel packets for the <span>CE6866, CE6860-SAN, CE6866K, CE6860-HAM, CE8851-32CQ8DQ-P, CE8850-SAN, CE8851K, CE8850-HAM</span>, and <span>CE8855, CE8851-32CQ4BQ, CE6855-48XS8CQ, CE6885, CE6885-SAN, CE6885-LL, CE6885-T, CE6863E-48S8CQ</span>.</p>
</td>
<td class="cellrowborder" valign="top" width="28.000000000000004%" headers="mcps1.3.2.3.2.1.2.4.1.2 "><p><a href="cmdqueryname=ip-tunnel+inner-src-ip+inner-dst-ip+inner-l4-sport"><b><span class="cmdname">ip-tunnel</span></b></a> { <strong><span>inner-src-ip</span></strong> |<strong><span> inner-dst-ip</span></strong> |<strong><span> inner-l4-sport </span></strong>| <strong><span>inner-l4-dport</span></strong> | <strong><span>inner-protocol</span></strong> | <strong><span>src-interface</span></strong> | <strong><span>include-erspan</span></strong> } *</p>
</td>
<td class="cellrowborder" valign="top" width="44%" headers="mcps1.3.2.3.2.1.2.4.1.3 "><p>Tunnel packets can be balanced based on any combination of an inner source IP address, inner destination IP address, inner source port number, inner destination port number, and inbound interface number. The device uses the hash algorithm to calculate a value based on the configured combination and selects a link to forward packets based on the value.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="28.000000000000004%" headers="mcps1.3.2.3.2.1.2.4.1.1 "><p>Configure a load balancing mode for tunnel packets<span> for the </span><span>CE6820H, CE6820H-K, CE6863H, CE6863H-K, CE6881H, CE6881H-K, CE6820S</span>.</p>
</td>
<td class="cellrowborder" valign="top" width="28.000000000000004%" headers="mcps1.3.2.3.2.1.2.4.1.2 "><p><a href="cmdqueryname=ip-tunnel+inner-src-ip+inner-dst-ip+inner-l4-sport"><b><span class="cmdname">ip-tunnel</span></b></a> { <strong><span>inner-src-ip</span></strong> |<strong><span> inner-dst-ip</span></strong> |<strong><span> inner-l4-sport </span></strong>| <strong><span>inner-l4-dport</span></strong> | <strong><span>src-mac</span></strong> | <strong><span>dst-mac</span></strong> } *</p>
</td>
<td class="cellrowborder" valign="top" width="44%" headers="mcps1.3.2.3.2.1.2.4.1.3 "><p>Tunnel packets can be balanced based on any combination of an inner source IP address, inner destination IP address, inner source port number, inner destination port number, and inbound interface number. The device uses the hash algorithm to calculate a value based on the configured combination and selects a link to forward packets based on the value.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="28.000000000000004%" headers="mcps1.3.2.3.2.1.2.4.1.1 "><p>Configure a load balancing mode for GTP packets.</p>
</td>
<td class="cellrowborder" valign="top" width="28.000000000000004%" headers="mcps1.3.2.3.2.1.2.4.1.2 "><p><strong>gtp teid</strong></p>
</td>
<td class="cellrowborder" valign="top" width="44%" headers="mcps1.3.2.3.2.1.2.4.1.3 "><p>When GTP packets are forwarded based on the hash factors configured in the system, the packets may be unevenly load-balanced. To resolve this problem, run the <strong>gtp teid</strong> command to enable TEID-based hashing for GTP packets. (TEID is a field in GTP packets.)</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="28.000000000000004%" headers="mcps1.3.2.3.2.1.2.4.1.1 "><p>Configure a hash algorithm offset for ECMP load balancing<span> for the </span><span>CE6820H, CE6820H-K, CE6863H, CE6863H-K, CE6881H, CE6881H-K, CE6820S</span>.</p>
</td>
<td class="cellrowborder" valign="top" width="28.000000000000004%" headers="mcps1.3.2.3.2.1.2.4.1.2 "><p><a href="cmdqueryname=ecmp+universal-id"><b><span class="cmdname">ecmp universal-id</span></b></a> <i><span class="varname"> universal-id1</span></i></p>
</td>
<td class="cellrowborder" valign="top" width="44%" headers="mcps1.3.2.3.2.1.2.4.1.3 "><p>If there are multiple equal-cost routes to the same destination, a device uses the hash algorithm to select a forwarding path based on information such as the IP address, MAC address, and port number of received packets. If there are four equal-cost routes to the destination IP address on the device, all traffic destined for the IP address will be evenly balanced among the four forwarding paths. By default, if packets have the same information such as IP addresses, MAC addresses, and port numbers, the forwarding paths calculated using the hash algorithm are the same. The hash algorithm offset affects the forwarding path calculated by the hash algorithm. Specifically, if the hash algorithm offsets of two devices are different, the outbound interfaces calculated by the hash algorithm for the same traffic on the two devices are also different. If you want to select different forwarding paths for the same traffic on different devices, configure different hash algorithm offsets on the devices.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="28.000000000000004%" headers="mcps1.3.2.3.2.1.2.4.1.1 "><p>Configure a hash algorithm offset for ECMP load balancing for the <span>CE8855, CE8851-32CQ4BQ, CE6855-48XS8CQ, CE6885, CE6885-SAN, CE6885-LL, CE6885-T, CE6863E-48S8CQ</span>.</p>
<p></p>
</td>
<td class="cellrowborder" valign="top" width="28.000000000000004%" headers="mcps1.3.2.3.2.1.2.4.1.2 "><p><a href="cmdqueryname=ecmp+%7B+overlay%7Cunderlay+%7D+universal-id"><b><span class="cmdname">ecmp { overlay|underlay } universal-id</span></b></a> <i><span class="varname"> universal-id2</span></i></p>
</td>
<td class="cellrowborder" valign="top" width="44%" headers="mcps1.3.2.3.2.1.2.4.1.3 "><p>If there are multiple equal-cost routes to the same destination, a device uses the hash algorithm to select a forwarding path based on information such as the IP address, MAC address, and port number of received packets. If there are four equal-cost routes to the destination IP address on the device, all traffic destined for the IP address will be evenly balanced among the four forwarding paths. By default, if packets have the same information such as IP addresses, MAC addresses, and port numbers, the forwarding paths calculated using the hash algorithm are the same. The hash algorithm offset affects the forwarding path calculated by the hash algorithm. Specifically, if the hash algorithm offsets of two devices are different, the outbound interfaces calculated by the hash algorithm for the same traffic on the two devices are also different. If you want to select different forwarding paths for the same traffic on different devices, configure different hash algorithm offsets on the devices.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="28.000000000000004%" headers="mcps1.3.2.3.2.1.2.4.1.1 "><p>For the CE6863H, CE6863H-K, CE6881H, and CE6881H-K, enable traffic to be preferentially forwarded from a local chip.</p>
</td>
<td class="cellrowborder" valign="top" width="28.000000000000004%" headers="mcps1.3.2.3.2.1.2.4.1.2 "><p><a href="cmdqueryname=local-preference+enhanced"><b><span class="cmdname">local-preference enhanced</span></b></a></p>
</td>
<td class="cellrowborder" valign="top" width="44%" headers="mcps1.3.2.3.2.1.2.4.1.3 "><p>If a device has multiple chips for traffic forwarding, the hash algorithm may select an inter-chip outbound interface, increasing the consumption of inter-chip bandwidth resources. To resolve this issue, run this command so that traffic is preferentially forwarded from a local chip. Specifically, a chip preferentially forwards received traffic through its outbound interface. This effectively saves inter-chip bandwidth resources and improves the forwarding efficiency of traffic.</p>
</td>
</tr>
</tbody>
</table>
</div>
<p></p>
</p></li><li><span>Commit the configuration.</span><p><pre class="screen" id="EN-US_TASK_0000001564001393__en-us_task_0234857734_screen163801330213"><a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001564001393__en-us_task_0234857734_en-us_concept_0141113565_cmdname1667501373175340">commit</span></b></a></pre>
</p></li></ol></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="galaxy_loadba_performance_cfg_0009.html">Configuring ECMP
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="galaxy_loadba_performance_cfg_0010.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="galaxy_loadba_performance_cfg_0018.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>