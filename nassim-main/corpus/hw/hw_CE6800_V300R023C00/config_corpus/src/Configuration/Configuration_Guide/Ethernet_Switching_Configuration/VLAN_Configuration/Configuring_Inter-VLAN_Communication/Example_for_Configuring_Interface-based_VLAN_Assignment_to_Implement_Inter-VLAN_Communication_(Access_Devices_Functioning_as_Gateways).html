
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Interface-based VLAN Assignment to Implement Inter-VLAN Communication (Access Devices Functioning as Gateways)">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="vrp_vlan_cfg_0028.html">
<meta name="DC.Relation" scheme="URI" content="vrp_vlan_cfg_0034.html">
<meta name="DC.Relation" scheme="URI" content="vrp_vlan_cfg_0223.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="VLAN">
<meta name="featuretype" content="Ethernet Switching">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="VLAN">
<meta name="featuretype" content="Ethernet Switching">
<meta name="featurename" content="QinQ">
<meta name="featurename" content="VLAN">
<meta name="featurename" content="VLAN Mapping">
<meta name="featurename" content="VLAN Pool">
<meta name="featurename" content="Voice VLAN">
<meta name="featuretype" content="Ethernet Switching">
<meta name="featuretype" content="Ethernet Switching">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001611053957">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring Interface-based VLAN Assignment to Implement Inter-VLAN Communication (Access Devices Functioning as Gateways)</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001611053957"></a><a name="EN-US_TASK_0000001611053957"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Interface-based VLAN Assignment to Implement Inter-VLAN Communication (Access Devices Functioning as Gateways)</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001611053957__1.3.1"></a><a name="1.3.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>In <a href="#EN-US_TASK_0000001611053957__fig523919715818">Figure 1</a>, PC1 and PC2 belong to VLAN 2 and VLAN 3 respectively and are connected to DeviceA at the aggregation layer through DeviceB at the access layer. PC3 belongs to VLAN 4 and is connected to DeviceA through DeviceC at the access layer. DeviceB functions as the gateway of PC1 and PC2, and DeviceC functions as the gateway of PC3. Static routes are configured on the devices to allow PCs to communicate with each other and access the upper-layer device.</p>
<div class="fignone" id="EN-US_TASK_0000001611053957__fig523919715818"><a name="EN-US_TASK_0000001611053957__fig523919715818"></a><a name="fig523919715818"></a><span class="figcap"><b>Figure 1 </b>Network diagram for configuring access devices as gateways</span><div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface 1, interface 2, and interface 3 represent <span>100GE</span> <span>1/0/1</span>, <span>100GE</span> <span>1/0/2</span>, and <span>100GE</span> <span>1/0/3</span>, respectively.</p>
</div></div>
<br><span><img src="figure/en-us_image_0000001562064608.png"></span></div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001611053957__1.3.2"></a><a name="1.3.2"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure DeviceB at the access layer.</span><p><p># Create VLANs.</p>
</p><p><pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname DeviceB</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB] <strong>vlan batch 2 3</strong>
[<span class="keyword">*</span>DeviceB] <strong>commit</strong></pre>
<p># Add interfaces to corresponding VLANs.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB] <strong>interface <span>100ge</span> <span>1/0/2</span></strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB-<span>100GE</span><span>1/0/2</span>]<strong> portswitch</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB-<span>100GE</span><span>1/0/2</span>]<strong> port link-type access</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB-<span>100GE</span><span>1/0/2</span>]<strong> port default vlan 2</strong>
[<span class="keyword">*</span>DeviceB-<span>100GE</span><span>1/0/2</span>]<strong> quit</strong>
[<span class="keyword">*</span>DeviceB] <strong>interface <span>100ge</span> <span>1/0/3</span></strong>
[<span class="keyword">*</span>DeviceB-<span>100GE</span><span>1/0/3</span>]<strong> portswitch</strong>
[<span class="keyword">*</span>DeviceB-<span>100GE</span><span>1/0/3</span>]<strong> port link-type access</strong>
[<span class="keyword">*</span>DeviceB-<span>100GE</span><span>1/0/3</span>]<strong> port default vlan 3</strong>
[<span class="keyword">*</span>DeviceB-<span>100GE</span><span>1/0/3</span>]<strong> quit</strong>
[<span class="keyword">*</span>DeviceB] <strong>commit</strong></pre>
<p># Configure VLANIF interfaces as gateways of PCs.</p>
</p><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB] <strong>interface vlanif 2</strong>
[<span class="keyword">*</span>DeviceB-Vlanif2]<strong> ip address 192.168.2.1 24</strong>
[<span class="keyword">*</span>DeviceB-Vlanif2]<strong> quit</strong>
[<span class="keyword">*</span>DeviceB] <strong>interface vlanif 3</strong>
[<span class="keyword">*</span>DeviceB-Vlanif3]<strong> ip address 192.168.3.1 24</strong>
[<span class="keyword">*</span>DeviceB-Vlanif3]<strong> quit</strong>
[<span class="keyword">*</span>DeviceB] <strong>commit</strong></pre>
<p># Configure DeviceB for communication with DeviceA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB] <strong>vlan batch 5</strong>
[<span class="keyword">*</span>DeviceB] <strong>interface <span>100ge</span> <span>1/0/1</span></strong>
[<span class="keyword">*</span>DeviceB-<span>100GE</span><span>1/0/1</span>]<strong> portswitch</strong>
[<span class="keyword">*</span>DeviceB-<span>100GE</span><span>1/0/1</span>]<strong> port link-type access</strong>
[<span class="keyword">*</span>DeviceB-<span>100GE</span><span>1/0/1</span>]<strong> port default vlan 5</strong>
[<span class="keyword">*</span>DeviceB-<span>100GE</span><span>1/0/1</span>]<strong> quit</strong>
[<span class="keyword">*</span>DeviceB] <strong>interface</strong> <strong>Vlanif 5</strong>
[<span class="keyword">*</span>DeviceB-Vlanif5]<strong> ip address 192.168.5.2 24</strong>
[<span class="keyword">*</span>DeviceB-Vlanif5]<strong> quit</strong>
[<span class="keyword">*</span>DeviceB]<strong> ip route-static 0.0.0.0 0.0.0.0 192.168.5.1</strong>
[<span class="keyword">*</span>DeviceB] <strong>commit</strong></pre>
</p></li><li><span>Configure DeviceC at the access layer.</span><p><p># Create a VLAN.</p>
</p><p><pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname DeviceC</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceC] <strong>vlan batch 4</strong>
[<span class="keyword">*</span>DeviceC] <strong>commit</strong></pre>
<p># Add an interface to the VLAN.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceC] <strong>interface <span>100ge</span> <span>1/0/2</span></strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceC-<span>100GE</span><span>1/0/2</span>]<strong> portswitch</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceC-<span>100GE</span><span>1/0/2</span>]<strong> port link-type access</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceC-<span>100GE</span><span>1/0/2</span>]<strong> port default vlan 4</strong>
[<span class="keyword">*</span>DeviceC-<span>100GE</span><span>1/0/2</span>]<strong> quit</strong>
[<span class="keyword">*</span>DeviceC] <strong>commit</strong></pre>
<p># Configure a VLANIF interface as the gateway of a PC.</p>
</p><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceC] <strong>interface vlanif 4</strong>
[<span class="keyword">*</span>DeviceC-Vlanif4]<strong> ip address 192.168.4.1 24</strong>
[<span class="keyword">*</span>DeviceC-Vlanif4]<strong> quit</strong>
[<span class="keyword">*</span>DeviceC] <strong>commit</strong></pre>
<p># Configure DeviceC for communication with DeviceA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceC] <strong>vlan batch 5</strong>
[<span class="keyword">*</span>DeviceC] <strong>interface <span>100ge</span> <span>1/0/1</span></strong>
[<span class="keyword">*</span>DeviceC-<span>100GE</span><span>1/0/1</span>]<strong> portswitch</strong>
[<span class="keyword">*</span>DeviceC-<span>100GE</span><span>1/0/1</span>]<strong> port link-type access</strong>
[<span class="keyword">*</span>DeviceC-<span>100GE</span><span>1/0/1</span>]<strong> port default vlan 5</strong>
[<span class="keyword">*</span>DeviceC-<span>100GE</span><span>1/0/1</span>]<strong> quit</strong>
[<span class="keyword">*</span>DeviceC] <strong>interface</strong> <strong>Vlanif 5</strong>
[<span class="keyword">*</span>DeviceC-Vlanif5]<strong> ip address 192.168.5.3 24</strong>
[<span class="keyword">*</span>DeviceC-Vlanif5]<strong> quit</strong>
[<span class="keyword">*</span>DeviceC]<strong> ip route-static 0.0.0.0 0.0.0.0 192.168.5.1</strong>
[<span class="keyword">*</span>DeviceC] <strong>commit</strong></pre>
</p></li><li><span>Configure DeviceA at the aggregation layer.</span><p><p># Create a VLAN.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname DeviceA</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>vlan batch 5</strong>
[<span class="keyword">*</span>DeviceA] <strong>commit</strong></pre>
<p># Add interfaces to the VLAN.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>interface <span>100ge</span> <span>1/0/1</span></strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/1</span>]<strong> portswitch</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/1</span>]<strong> port link-type access</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/1</span>]<strong> port default vlan 5</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/1</span>]<strong> quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>interface <span>100ge</span> <span>1/0/2</span></strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/2</span>]<strong> portswitch</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/2</span>]<strong> port link-type access</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/2</span>]<strong> port default vlan 5</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/2</span>]<strong> quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>interface <span>100ge</span> <span>1/0/3</span></strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/3</span>]<strong> portswitch</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/3</span>]<strong> port link-type access</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/3</span>]<strong> port default vlan 5</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/3</span>]<strong> quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>commit</strong></pre>
<p># Configure a VLANIF interface for communication with the upper-layer device.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>interface vlanif 5</strong>
[<span class="keyword">*</span>DeviceA-Vlanif5]<strong> ip address 192.168.5.1 24</strong>
[<span class="keyword">*</span>DeviceA-Vlanif5]<strong> quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>commit</strong></pre>
<p># Configure return specific routes to implement mutual access between internal network segments.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>ip route-static 192.168.2.0 255.255.255.0 192.168.5.2</strong>
[<span class="keyword">*</span>DeviceA] <strong>ip route-static 192.168.3.0 255.255.255.0 192.168.5.2</strong> 
[<span class="keyword">*</span>DeviceA] <strong>ip route-static 192.168.4.0 255.255.255.0 192.168.5.3</strong>
[<span class="keyword">*</span>DeviceA] <strong>commit</strong></pre>
<p># Configure a default route to allow devices on internal network segments to access the upper-layer device.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>ip route-static 0.0.0.0 0.0.0.0 192.168.5.4</strong> 
[<span class="keyword">*</span>DeviceA] <strong>commit</strong></pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001611053957__1.3.3"></a><a name="1.3.3"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p># Run the <a href="cmdqueryname=display+vlan"><b><span class="cmdname">display vlan</span></b></a> command to check the VLAN status. The following example uses the command output on DeviceB.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB] <strong>display vlan 2</strong>
--------------------------------------------------------------------------------
U: Up;         D: Down;         TG: Tagged;         UT: Untagged;
MP: Vlan-mapping;               ST: Vlan-stacking;
#: ProtocolTransparent-vlan;    *: Management-vlan;
MAC-LRN: MAC-address learning;  STAT: Statistic;
BC: Broadcast; MC: Multicast;   UC: Unknown-unicast;
FWD: Forward;  DSD: Discard;
--------------------------------------------------------------------------------

VID          Ports
--------------------------------------------------------------------------------
   <strong>2</strong>         UT:<span>100GE</span><span>1/0/2</span>(U)   <span>100GE</span><span>1/0/3</span>(U)
             TG:<span>100GE</span><span>1/0/1</span>(U)

VID  Type     Status  Property  MAC-LRN STAT    BC  MC  UC  Description
--------------------------------------------------------------------------------
   2 common   enable  default   enable  disable FWD FWD FWD VLAN 0002</pre>
<p># Run the <a href="cmdqueryname=display+port+vlan"><b><span class="cmdname">display port vlan</span></b></a> command to check information about allowed VLANs on an interface. The following example uses the command output about <span>100GE</span> <span>1/0/1</span> on DeviceB.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB] <strong>display port vlan <span>100ge</span> <span>1/0/1</span></strong>
Port                    Link Type    PVID  Trunk VLAN List                      Port Description
---------------------------------------------------------------------------------------------------------------
<span>100GE</span><span>1/0/1</span>               access          1  2-3</pre>
</div>
<div class="postreq"><a name="EN-US_TASK_0000001611053957__1.3.4"></a><a name="1.3.4"></a><h4 class="sectiontitle">Configuration Scripts</h4><ul><li><p>DeviceA</p>
<pre class="screen">#
sysname DeviceA
#
vlan batch 5
#
interface Vlanif5
 ip address 192.168.5.1 255.255.255.0
#
interface <span>100GE</span><span>1/0/1</span>
 port default vlan 5
#
interface <span>100GE</span><span>1/0/2</span>
 port default vlan 5
#
interface <span>100GE</span><span>1/0/3</span>
 port default vlan 5
#
ip route-static 0.0.0.0 0.0.0.0 192.168.5.1
ip route-static 192.168.2.0 255.255.255.0 192.168.5.2
ip route-static 192.168.3.0 255.255.255.0 192.168.5.2
ip route-static 192.168.4.0 255.255.255.0 192.168.5.3
#
return</pre>
</li><li><p>DeviceB</p>
<pre class="screen">#
sysname DeviceB
#
vlan batch 2 to 3 5
#
interface Vlanif2
 ip address 192.168.2.1 255.255.255.0
#
interface Vlanif3
 ip address 192.168.3.1 255.255.255.0
#
interface Vlanif5
 ip address 192.168.5.2 255.255.255.0
#
interface <span>100GE</span><span>1/0/1</span>
 port default vlan 5
#
interface <span>100GE</span><span>1/0/2</span>
 port default vlan 2
#
interface <span>100GE</span><span>1/0/3</span>
 port default vlan 3
#
ip route-static 0.0.0.0 0.0.0.0 192.168.5.1
#
return</pre>
</li><li><div class="p">DeviceC<pre class="screen">#
sysname DeviceC
#
vlan batch 4 to 5
#
#
interface Vlanif4
 ip address 192.168.4.1 255.255.255.0
#
interface Vlanif5
 ip address 192.168.5.3 255.255.255.0
#
interface <span>100GE</span><span>1/0/1</span>
 port default vlan 5
#
interface <span>100GE</span><span>1/0/2</span>
 port default vlan 4
#
ip route-static 0.0.0.0 0.0.0.0 192.168.5.1
#
return</pre>
</div>
</li></ul>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="vrp_vlan_cfg_0028.html">Configuring Inter-VLAN Communication
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="vrp_vlan_cfg_0034.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="vrp_vlan_cfg_0223.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>