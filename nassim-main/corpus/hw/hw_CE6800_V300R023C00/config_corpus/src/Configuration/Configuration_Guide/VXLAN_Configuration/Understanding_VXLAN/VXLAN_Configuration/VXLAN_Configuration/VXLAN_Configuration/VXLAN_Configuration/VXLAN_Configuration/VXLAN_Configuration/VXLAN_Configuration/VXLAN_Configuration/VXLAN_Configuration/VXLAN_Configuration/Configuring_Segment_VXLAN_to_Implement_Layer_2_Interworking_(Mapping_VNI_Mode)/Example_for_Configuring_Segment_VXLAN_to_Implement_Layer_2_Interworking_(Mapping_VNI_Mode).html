
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Segment VXLAN to Implement Layer 2 Interworking (Mapping VNI Mode)">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../vrp/dc_vrp_vxlan_cfg_1241.html">
<meta name="DC.Relation" scheme="URI" content="../vrp/dc_vrp_vxlan_cfg_1241-dc3.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="VXLAN">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="VXLAN">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="VXLAN">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="VXLAN">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001259787949">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="../public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring Segment VXLAN to Implement Layer 2 Interworking (Mapping VNI Mode)</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001259787949"></a><a name="EN-US_TASK_0000001259787949"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Segment VXLAN to Implement Layer 2 Interworking (Mapping VNI Mode)</h1>
<div class="taskbody" id="taskbody0000001259787949"><div class="context"><a name="EN-US_TASK_0000001259787949__1.3.1"></a><a name="1.3.1"></a>
<div class="p" id="EN-US_TASK_0000001259787949__context1677625172748"><h4 class="sectiontitle">Networking Requirements</h4><p id="EN-US_TASK_0000001259787949__p1396625502175357">On the network shown in <a href="#EN-US_TASK_0000001259787949__fig_dc_cfg_vxlan_cfgcase_002101">Figure 1</a>, BGP EVPN is used to configure one VXLAN tunnel within DC A, one within DC B, and one between Leaf2 and Leaf3. To enable communication between VM1 and VM2, Layer 2 connectivity must be established between DC A and DC B. In this example, the VXLAN tunnel in DC A and that in DC B use VNI 10 and VNI 20, respectively. To establish a VXLAN tunnel between Leaf2 and Leaf3, segment VXLAN must be configured for VNI conversion.</p>
<div class="fignone" id="EN-US_TASK_0000001259787949__fig_dc_cfg_vxlan_cfgcase_002101"><a name="EN-US_TASK_0000001259787949__fig_dc_cfg_vxlan_cfgcase_002101"></a><a name="fig_dc_cfg_vxlan_cfgcase_002101"></a><span class="figcap"><b>Figure 1 </b>Configuring segment VXLAN for Layer 2 interworking</span><div class="note" id="EN-US_TASK_0000001259787949__note555116437108"><img src="../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0000001259787949__p255174321013">In this example, interface1 and interface2 represent <span>100GE</span><span>1/0/1</span> and <span>100GE</span><span>1/0/2</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" id="EN-US_TASK_0000001259787949__image1735927445175357" src="figure/en-us_image_0000001215311494.png" width="NaN" height="NaN"></span></div>

<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" id="EN-US_TASK_0000001259787949__table_01" frame="border" border="1" rules="all"><caption><b>Table 1 </b>Interface IP addresses</caption><thead align="left"><tr id="EN-US_TASK_0000001259787949__row498892194175357"><th align="left" class="cellrowborder" valign="top" width="11.4%" id="mcps1.3.1.4.2.7.1.1" liSelected="liSelected"><p id="EN-US_TASK_0000001259787949__p2121621550175357">Device</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="23.31%" id="mcps1.3.1.4.2.7.1.2" liSelected="liSelected"><p id="EN-US_TASK_0000001259787949__p1716124959175357">Interface</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="16.42%" id="mcps1.3.1.4.2.7.1.3" liSelected="liSelected"><p id="EN-US_TASK_0000001259787949__p1809199136175357">IP Address</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="11.4%" id="mcps1.3.1.4.2.7.1.4" liSelected="liSelected"><p id="EN-US_TASK_0000001259787949__p863697454175357">Device</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="21.18%" id="mcps1.3.1.4.2.7.1.5" liSelected="liSelected"><p id="EN-US_TASK_0000001259787949__p470400435175357">Interface</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="16.29%" id="mcps1.3.1.4.2.7.1.6" liSelected="liSelected"><p id="EN-US_TASK_0000001259787949__p1223202243175357">IP Address</p>
</th>
</tr>
</thead>
<tbody><tr id="EN-US_TASK_0000001259787949__row160274432175357"><td class="cellrowborder" rowspan="2" valign="middle" width="11.4%" headers="mcps1.3.1.4.2.7.1.1 "><p id="EN-US_TASK_0000001259787949__p1784528725175357">Spine1</p>
</td>
<td class="cellrowborder" valign="top" width="23.31%" headers="mcps1.3.1.4.2.7.1.2 "><p id="EN-US_TASK_0000001259787949__p305876305175357"><span>100GE</span><span>1/0/1</span></p>
</td>
<td class="cellrowborder" valign="top" width="16.42%" headers="mcps1.3.1.4.2.7.1.3 "><p id="EN-US_TASK_0000001259787949__p1375478761175357">192.168.10.1/24</p>
</td>
<td class="cellrowborder" rowspan="2" valign="middle" width="11.4%" headers="mcps1.3.1.4.2.7.1.4 "><p id="EN-US_TASK_0000001259787949__p409208533175357">Spine2</p>
</td>
<td class="cellrowborder" valign="top" width="21.18%" headers="mcps1.3.1.4.2.7.1.5 "><p id="EN-US_TASK_0000001259787949__p1384377805175357"><span>100GE</span><span>1/0/1</span></p>
</td>
<td class="cellrowborder" valign="top" width="16.29%" headers="mcps1.3.1.4.2.7.1.6 "><p id="EN-US_TASK_0000001259787949__p1922309576175357">192.168.30.1/24</p>
</td>
</tr>
<tr id="EN-US_TASK_0000001259787949__row1353150628175357"><td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.1 "><p id="EN-US_TASK_0000001259787949__p533330892175357"><span>100GE</span><span>1/0/2</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.2 "><p id="EN-US_TASK_0000001259787949__p2093046835175357">192.168.20.1/24</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.3 "><p id="EN-US_TASK_0000001259787949__p2136119148175357"><span>100GE</span><span>1/0/2</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.4 "><p id="EN-US_TASK_0000001259787949__p73886521175357">192.168.40.1/24</p>
</td>
</tr>
<tr id="EN-US_TASK_0000001259787949__row1297111704175357"><td class="cellrowborder" rowspan="3" valign="middle" width="11.4%" headers="mcps1.3.1.4.2.7.1.1 "><p id="EN-US_TASK_0000001259787949__p51257363175357">Leaf1</p>
</td>
<td class="cellrowborder" valign="top" width="23.31%" headers="mcps1.3.1.4.2.7.1.2 "><p id="EN-US_TASK_0000001259787949__p648536042175357"><span>100GE</span><span>1/0/1</span></p>
</td>
<td class="cellrowborder" valign="top" width="16.42%" headers="mcps1.3.1.4.2.7.1.3 "><p id="EN-US_TASK_0000001259787949__p473330409175357">192.168.10.2/24</p>
</td>
<td class="cellrowborder" rowspan="3" valign="middle" width="11.4%" headers="mcps1.3.1.4.2.7.1.4 "><p id="EN-US_TASK_0000001259787949__p1140808184175357">Leaf4</p>
</td>
<td class="cellrowborder" valign="top" width="21.18%" headers="mcps1.3.1.4.2.7.1.5 "><p id="EN-US_TASK_0000001259787949__p195314944175357"><span>100GE</span><span>1/0/1</span></p>
</td>
<td class="cellrowborder" valign="top" width="16.29%" headers="mcps1.3.1.4.2.7.1.6 "><p id="EN-US_TASK_0000001259787949__p1787181224175357">192.168.40.2/24</p>
</td>
</tr>
<tr id="EN-US_TASK_0000001259787949__row340830504175357"><td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.1 "><p id="EN-US_TASK_0000001259787949__p1693968518175357"><span>100GE</span><span>1/0/2</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.2 "><p id="EN-US_TASK_0000001259787949__p547328896175357">-</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.3 "><p id="EN-US_TASK_0000001259787949__p764323478175357"><span>100GE</span><span>1/0/2</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.4 "><p id="EN-US_TASK_0000001259787949__p36270116175357">-</p>
</td>
</tr>
<tr id="EN-US_TASK_0000001259787949__row1048570757175357"><td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.1 "><p id="EN-US_TASK_0000001259787949__p1475911593175357">LoopBack1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.2 "><p id="EN-US_TASK_0000001259787949__p1797010432175357">1.1.1.1/32</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.3 "><p id="EN-US_TASK_0000001259787949__p1513148319175357">LoopBack1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.4 "><p id="EN-US_TASK_0000001259787949__p277230530175357">4.4.4.4/32</p>
</td>
</tr>
<tr id="EN-US_TASK_0000001259787949__row338674847175357"><td class="cellrowborder" rowspan="3" valign="middle" width="11.4%" headers="mcps1.3.1.4.2.7.1.1 "><p id="EN-US_TASK_0000001259787949__p1904363979175357">Leaf2</p>
</td>
<td class="cellrowborder" valign="top" width="23.31%" headers="mcps1.3.1.4.2.7.1.2 "><p id="EN-US_TASK_0000001259787949__p426522052175357"><span>100GE</span><span>1/0/1</span></p>
</td>
<td class="cellrowborder" valign="top" width="16.42%" headers="mcps1.3.1.4.2.7.1.3 "><p id="EN-US_TASK_0000001259787949__p897777651175357">192.168.20.2/24</p>
</td>
<td class="cellrowborder" rowspan="3" valign="middle" width="11.4%" headers="mcps1.3.1.4.2.7.1.4 "><p id="EN-US_TASK_0000001259787949__p148336172175357">Leaf3</p>
</td>
<td class="cellrowborder" valign="top" width="21.18%" headers="mcps1.3.1.4.2.7.1.5 "><p id="EN-US_TASK_0000001259787949__p1840005788175357"><span>100GE</span><span>1/0/1</span></p>
</td>
<td class="cellrowborder" valign="top" width="16.29%" headers="mcps1.3.1.4.2.7.1.6 "><p id="EN-US_TASK_0000001259787949__p872115145175357">192.168.30.2/24</p>
</td>
</tr>
<tr id="EN-US_TASK_0000001259787949__row658607688175357"><td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.1 "><p id="EN-US_TASK_0000001259787949__p625703546175357"><span>100GE</span><span>1/0/2</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.2 "><p id="EN-US_TASK_0000001259787949__p1971110857175357">192.168.50.1/24</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.3 "><p id="EN-US_TASK_0000001259787949__p1285898568175357"><span>100GE</span><span>1/0/2</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.4 "><p id="EN-US_TASK_0000001259787949__p1832607835175357">192.168.50.2/24</p>
</td>
</tr>
<tr id="EN-US_TASK_0000001259787949__row615676655175357"><td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.1 "><p id="EN-US_TASK_0000001259787949__p578178436175357">LoopBack1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.2 "><p id="EN-US_TASK_0000001259787949__p2033008983175357">2.2.2.2/32</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.3 "><p id="EN-US_TASK_0000001259787949__p546550628175357">LoopBack1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.4 "><p id="EN-US_TASK_0000001259787949__p1363746725175357">3.3.3.3/32</p>
</td>
</tr>
</tbody>
</table>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001259787949__1.3.2"></a><a name="1.3.2"></a>
<div class="p" id="EN-US_TASK_0000001259787949__context1251121212569"><h4 class="sectiontitle">Configuration Roadmap</h4><div class="p" id="EN-US_TASK_0000001259787949__p1546337400175357">The configuration roadmap is as follows:<ol id="EN-US_TASK_0000001259787949__ol685164353175357"><li id="EN-US_TASK_0000001259787949__li1091272956175357"><p id="EN-US_TASK_0000001259787949__p1514226112175357"><a name="EN-US_TASK_0000001259787949__li1091272956175357"></a><a name="li1091272956175357"></a>Configure interface IP addresses on devices.</p>
</li><li id="EN-US_TASK_0000001259787949__li502280253175357"><p id="EN-US_TASK_0000001259787949__p65995814175357"><a name="EN-US_TASK_0000001259787949__li502280253175357"></a><a name="li502280253175357"></a>Configure routing protocols to ensure that devices can communicate with each other.</p>
</li><li id="EN-US_TASK_0000001259787949__li646378586175357"><p id="EN-US_TASK_0000001259787949__p1712608376175357"><a name="EN-US_TASK_0000001259787949__li646378586175357"></a><a name="li646378586175357"></a>Configure BGP EVPN to establish one VXLAN tunnel in DC A and another one in DC B.</p>
</li><li id="EN-US_TASK_0000001259787949__li1592128507175357"><p id="EN-US_TASK_0000001259787949__p1257575529175357"><a name="EN-US_TASK_0000001259787949__li1592128507175357"></a><a name="li1592128507175357"></a>Configure EBGP EVPN on Leaf2 and Leaf3 to establish an inter-DC VXLAN tunnel.</p>
</li><li id="EN-US_TASK_0000001259787949__li1663514603175357"><p id="EN-US_TASK_0000001259787949__p600332328175357"><a name="EN-US_TASK_0000001259787949__li1663514603175357"></a><a name="li1663514603175357"></a>Configure segment VXLAN on Leaf2 and Leaf3.</p>
</li></ol>
</div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001259787949__1.3.3"></a><a name="1.3.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol id="EN-US_TASK_0000001259787949__steps10132325172748"><li id="EN-US_TASK_0000001259787949__step1439286410175357"><span id="EN-US_TASK_0000001259787949__cmd830893062175357">Configure interface IP addresses on devices.</span><p><p id="EN-US_TASK_0000001259787949__p1074984632175357">Configure interface IP addresses on the involved devices according to <a href="#EN-US_TASK_0000001259787949__fig_dc_cfg_vxlan_cfgcase_002101">Figure 1</a>.</p>
</p></li><li id="EN-US_TASK_0000001259787949__step1300348759175357"><span id="EN-US_TASK_0000001259787949__cmd20516994175357">Configure a routing protocol.</span><p><p id="EN-US_TASK_0000001259787949__p10249118175357">Configure an IGP within DCs. OSPF is used in this example. Configure EBGP between DCs. For detailed configurations, see Configuration Scripts.</p>
</p></li><li id="EN-US_TASK_0000001259787949__step437759412175357"><span id="EN-US_TASK_0000001259787949__cmd143462862175357">Configure BGP EVPN to establish one VXLAN tunnel in DC A and another one in DC B.</span><ol type="a" id="EN-US_TASK_0000001259787949__substeps138580532175357"><li class="substepexpand" id="EN-US_TASK_0000001259787949__substep1415155796175357"><span id="EN-US_TASK_0000001259787949__cmd1142072847175357">Configure a service access point on Leaf1 and Leaf4.</span><p><p id="EN-US_TASK_0000001259787949__p2024517259175357"># Configure Leaf1. The configuration of Leaf4 is similar to the configuration of Leaf1. For detailed configurations, see Configuration Scripts.</p>
<pre class="screen" id="EN-US_TASK_0000001259787949__screen658258757175357">&lt;Leaf1&gt; <strong id="EN-US_TASK_0000001259787949__b1302531306175357">system-view</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword915511299213"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf1] <strong id="EN-US_TASK_0000001259787949__b1584447251175357">bridge-domain 10</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword1715514291029">*</span>Leaf1-bd10] <strong id="EN-US_TASK_0000001259787949__b1590374582175357">quit</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword1615514291526">*</span>Leaf1] <strong id="EN-US_TASK_0000001259787949__b1079482876175357">interface <span>100ge</span> <span>1/0/2</span>.1 mode l2</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword71556298218">*</span>Leaf1-<span>100GE</span><span>1/0/2</span>.1] <strong id="EN-US_TASK_0000001259787949__b1460854157175357">encapsulation dot1q vid 10</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword131552291125">*</span>Leaf1-<span>100GE</span><span>1/0/2</span>.1] <strong id="EN-US_TASK_0000001259787949__b1045767259175357">bridge-domain 10</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword1015592915220">*</span>Leaf1-<span>100GE</span><span>1/0/2</span>.1] <strong id="EN-US_TASK_0000001259787949__b1188689019175357">quit</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword171551029323">*</span>Leaf1] <strong id="EN-US_TASK_0000001259787949__b1706844762175357">commit</strong></pre>
</p></li><li class="substepexpand" id="EN-US_TASK_0000001259787949__substep567254371175357"><span id="EN-US_TASK_0000001259787949__cmd1164304364175357">Enable EVPN as the VXLAN control plane on each leaf.</span><p><p id="EN-US_TASK_0000001259787949__p317071062175357"># Configure Leaf1. The configurations of Leaf2, Leaf3, and Leaf4 are similar to the configuration of Leaf1. For detailed configurations, see Configuration Scripts.</p>
<pre class="screen" id="EN-US_TASK_0000001259787949__screen385870016175357">[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword11551729222"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf1] <strong id="EN-US_TASK_0000001259787949__b1597091077175357">evpn-overlay enable</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword21551529625">*</span>Leaf1] <strong id="EN-US_TASK_0000001259787949__b2123681010175357">commit</strong></pre>
</p></li><li class="substepexpand" id="EN-US_TASK_0000001259787949__substep858615555175357"><span id="EN-US_TASK_0000001259787949__cmd1809008692175357">Establish a BGP EVPN peer relationship between Leaf1 and Leaf2 in DC A and between Leaf3 and Leaf4 in DC B.</span><p><p id="EN-US_TASK_0000001259787949__p507807811175357"># Configure a BGP EVPN peer relationship on Leaf1. The configurations of Leaf2, Leaf3, and Leaf4 are similar to the configuration of Leaf1. For detailed configurations, see Configuration Scripts.</p>
<pre class="screen" id="EN-US_TASK_0000001259787949__screen559984287175357">[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword015512291927"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf1] <strong id="EN-US_TASK_0000001259787949__b231087897175357">bgp 100 instance evpn1</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword4155929627">*</span>Leaf1-bgp-instance-evpn1] <strong id="EN-US_TASK_0000001259787949__b1039549390175357">peer 2.2.2.2 as-number 100</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword0155152911218">*</span>Leaf1-bgp-instance-evpn1] <strong id="EN-US_TASK_0000001259787949__b1425511868175357">peer 2.2.2.2 connect-interface LoopBack1</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword2015572918215">*</span>Leaf1-bgp-instance-evpn1] <strong id="EN-US_TASK_0000001259787949__b1745089947175357">l2vpn-family evpn</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword1515592910215">*</span>Leaf1-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001259787949__b212469460175357">peer 2.2.2.2 enable</strong>
Warning: This operation will reset the peer session. Continue? [Y/N]: <strong id="EN-US_TASK_0000001259787949__b1674832642175357">y</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword131551629427">*</span>Leaf1-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001259787949__b1731010587175357">quit</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword17155529029">*</span>Leaf1-bgp-instance-evpn1] <strong id="EN-US_TASK_0000001259787949__b788571894175357">quit</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword1515515291426">*</span>Leaf1] <strong id="EN-US_TASK_0000001259787949__b1003437377175357">commit</strong></pre>
</p></li><li class="substepexpand" id="EN-US_TASK_0000001259787949__substep725784871175357"><span id="EN-US_TASK_0000001259787949__cmd559211937175357">Configure an EVPN instance on Leaf1 and Leaf4.</span><p><p id="EN-US_TASK_0000001259787949__p1456461230175357"># Configure Leaf1. The configuration of Leaf4 is similar to the configuration of Leaf1. For detailed configurations, see Configuration Scripts.</p>
<pre class="screen" id="EN-US_TASK_0000001259787949__screen1525734134175357">[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword201557291923"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf1] <strong id="EN-US_TASK_0000001259787949__b1802189005175357">bridge-domain 10</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword13155629021"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf1-bd10] <strong id="EN-US_TASK_0000001259787949__b1048908371175357">vxlan vni 10</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword415513291926">*</span>Leaf1-bd10] <strong id="EN-US_TASK_0000001259787949__b249470325175357">evpn</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword1515515291826">*</span>Leaf1-bd10-evpn] <strong id="EN-US_TASK_0000001259787949__b1860936345175357">route-distinguisher 10:1</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword3155172912216">*</span>Leaf1-bd10-evpn] <strong id="EN-US_TASK_0000001259787949__b1128608845175357">vpn-target 300:30</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword18155829722">*</span>Leaf1-bd10-evpn] <strong id="EN-US_TASK_0000001259787949__b1008434898175357">quit</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword17155829124">*</span>Leaf1-bd10] <strong id="EN-US_TASK_0000001259787949__b1540782262175357">quit</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword3155112914214">*</span>Leaf1] <strong id="EN-US_TASK_0000001259787949__b385286737175357">commit</strong></pre>
</p></li><li class="substepexpand" id="EN-US_TASK_0000001259787949__substep1617925582175357"><span id="EN-US_TASK_0000001259787949__cmd1037318360175357">Enable ingress replication on each leaf node.</span><p><p id="EN-US_TASK_0000001259787949__p1418662186175357"># Configure Leaf1. The configurations of Leaf2, Leaf3, and Leaf4 are similar to the configuration of Leaf1. For detailed configurations, see Configuration Scripts.</p>
<pre class="screen" id="EN-US_TASK_0000001259787949__screen147723472175357">[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword2015582911215"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf1] <strong id="EN-US_TASK_0000001259787949__b1977810893175357">interface nve 1</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword1215519291329">*</span>Leaf1-Nve1] <strong id="EN-US_TASK_0000001259787949__b1261228775175357">source 1.1.1.1</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword21550296218">*</span>Leaf1-Nve1] <strong id="EN-US_TASK_0000001259787949__b432684360175357">vni 10 head-end peer-list protocol bgp</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword315514297212">*</span>Leaf1-Nve1] <strong id="EN-US_TASK_0000001259787949__b319228803175357">quit</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword20155729627">*</span>Leaf1] <strong id="EN-US_TASK_0000001259787949__b1023713181175357">commit</strong></pre>
</p></li></ol>
</li><li id="EN-US_TASK_0000001259787949__step311602197175357"><span id="EN-US_TASK_0000001259787949__cmd1532993593175357">Configure an EBGP EVPN peer relationship between Leaf2 and Leaf3.</span><p><p id="EN-US_TASK_0000001259787949__p1432913883175357"># Configure Leaf2.</p>
<pre class="screen" id="EN-US_TASK_0000001259787949__screen1652393533175357">[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword61567291729"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf2] <strong id="EN-US_TASK_0000001259787949__b1932530097175357">bgp 100 instance evpn1</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword1215682916215">*</span>Leaf2-bgp-instance-evpn1] <strong id="EN-US_TASK_0000001259787949__b2135804370175357">peer 3.3.3.3 as-number 200</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword19156229523">*</span>Leaf2-bgp-instance-evpn1] <strong id="EN-US_TASK_0000001259787949__b1841979429175357">peer 3.3.3.3 connect-interface LoopBack1</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword9156172911219">*</span>Leaf2-bgp-instance-evpn1] <strong id="EN-US_TASK_0000001259787949__b1628597693175357">peer 3.3.3.3 ebgp-max-hop 255</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword915620292027">*</span>Leaf2-bgp-instance-evpn1] <strong id="EN-US_TASK_0000001259787949__b1622299519175357">l2vpn-family evpn</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword1515617294216">*</span>Leaf2-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001259787949__b2131851966175357">peer 3.3.3.3 enable</strong>
Warning: This operation will reset the peer session. Continue? [Y/N]: <strong id="EN-US_TASK_0000001259787949__b1377707441175357">y</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword1315613291522">*</span>Leaf2-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001259787949__b652317741175357">quit</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword815612919216">*</span>Leaf2-bgp-instance-evpn1] <strong id="EN-US_TASK_0000001259787949__b1691179690175357">quit</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword171561029325">*</span>Leaf2] <strong id="EN-US_TASK_0000001259787949__b878038943175357">commit</strong></pre>
<p id="EN-US_TASK_0000001259787949__p1000262707175357"># Configure Leaf3.</p>
<pre class="screen" id="EN-US_TASK_0000001259787949__screen87780475175357">[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword13156152919210"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf3] <strong id="EN-US_TASK_0000001259787949__b942859228175357">bgp 200 instance evpn1</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword2015616294210">*</span>Leaf3-bgp-instance-evpn1] <strong id="EN-US_TASK_0000001259787949__b365352658175357">peer 2.2.2.2 as-number 100</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword1515692914210">*</span>Leaf3-bgp-instance-evpn1] <strong id="EN-US_TASK_0000001259787949__b609569818175357">peer 2.2.2.2 connect-interface LoopBack1</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword15156172912218">*</span>Leaf3-bgp-instance-evpn1] <strong id="EN-US_TASK_0000001259787949__b2030872671175357">peer 2.2.2.2 ebgp-max-hop 255</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword16156192919216">*</span>Leaf3-bgp-instance-evpn1] <strong id="EN-US_TASK_0000001259787949__b997598996175357">l2vpn-family evpn</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword1915611293214">*</span>Leaf3-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001259787949__b309395813175357">peer 2.2.2.2 enable</strong>
Warning: This operation will reset the peer session. Continue? [Y/N]: <strong id="EN-US_TASK_0000001259787949__b2078032415175357">y</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword14156102915219">*</span>Leaf3-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001259787949__b2131352514175357">quit</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword1615632914214">*</span>Leaf3-bgp-instance-evpn1] <strong id="EN-US_TASK_0000001259787949__b1793710890175357">quit</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword51561929323">*</span>Leaf3] <strong id="EN-US_TASK_0000001259787949__b1248597135175357">commit</strong></pre>
</p></li><li id="EN-US_TASK_0000001259787949__step1475301550175357"><span id="EN-US_TASK_0000001259787949__cmd546962588175357">Configure segment VXLAN on Leaf2 and Leaf3.</span><ol type="a" id="EN-US_TASK_0000001259787949__substeps1147549150175357"><li class="substepexpand" id="EN-US_TASK_0000001259787949__substep2097169178175357"><span id="EN-US_TASK_0000001259787949__cmd473276435175357">Configure a split horizon group to which BGP EVPN peers belong.</span><p><p id="EN-US_TASK_0000001259787949__p749492777175357"># Configure Leaf2.</p>
<pre class="screen" id="EN-US_TASK_0000001259787949__screen248806039175357">[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword12751756103518"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf2] <strong id="EN-US_TASK_0000001259787949__b1675165614352">evpn</strong>
[*Leaf2-evpn] <strong id="EN-US_TASK_0000001259787949__b1575185617358">irb-reoriginated without-split-group disable</strong>
[*Leaf2-evpn] <strong id="EN-US_TASK_0000001259787949__b14751145618355">l3-reoriginate different-split-group</strong>
[*Leaf2-evpn] <strong id="EN-US_TASK_0000001259787949__b2075215560354">mac-duplication</strong>
[*Leaf2-evpn-mac-dup] <strong id="EN-US_TASK_0000001259787949__b12752105611357">quit</strong>
[*Leaf2-evpn] <strong id="EN-US_TASK_0000001259787949__b8752195610356">quit</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword1987317387439">*</span>Leaf2] <strong id="EN-US_TASK_0000001259787949__b1311470128175357">bgp 100 instance evpn1</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword141588297217"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf2-bgp-instance-evpn1] <strong id="EN-US_TASK_0000001259787949__b92650941175357">l2vpn-family evpn</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword81585291213"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf2-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001259787949__b1890232035175357">peer 3.3.3.3 split-group sg1</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword18158152915218">*</span>Leaf2-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001259787949__b762212297175357">commit</strong></pre>
<p id="EN-US_TASK_0000001259787949__p549114485175357"># Configure Leaf3.</p>
<pre class="screen" id="EN-US_TASK_0000001259787949__screen1705690077175357">[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword580871919442"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf3] <strong id="EN-US_TASK_0000001259787949__b380811190443">evpn</strong>
[*Leaf3-evpn] <strong id="EN-US_TASK_0000001259787949__b180814195446">irb-reoriginated without-split-group disable</strong>
[*Leaf3-evpn] <strong id="EN-US_TASK_0000001259787949__b78080192445">l3-reoriginate different-split-group</strong>
[*Leaf3-evpn] <strong id="EN-US_TASK_0000001259787949__b11808131919441">mac-duplication</strong>
[*Leaf3-evpn-mac-dup] <strong id="EN-US_TASK_0000001259787949__b1809619134412">quit</strong>
[*Leaf3-evpn] <strong id="EN-US_TASK_0000001259787949__b128091419184416">quit</strong>
[*Leaf3] <strong id="EN-US_TASK_0000001259787949__b1796516900175357">bgp 200 instance evpn1</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword1615852910210"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf3-bgp-instance-evpn1] <strong id="EN-US_TASK_0000001259787949__b1669183785175357">l2vpn-family evpn</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword10158192918211"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf3-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001259787949__b1863238899175357">peer 2.2.2.2 split-group sg1</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword12158429725">*</span>Leaf3-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001259787949__b1844949990175357">commit</strong></pre>
</p></li><li class="substepexpand" id="EN-US_TASK_0000001259787949__substep721359577175357"><span id="EN-US_TASK_0000001259787949__cmd1345223324175357">Configure the function to advertise re-originated MAC routes to BGP EVPN peers.</span><p><p id="EN-US_TASK_0000001259787949__p41019007175357"># Configure Leaf2.</p>
<pre class="screen" id="EN-US_TASK_0000001259787949__screen971970540175357">[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword3158329827"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf2-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001259787949__b851920168175357">peer 1.1.1.1 import reoriginate</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword6158629620">*</span>Leaf2-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001259787949__b861293602175357">peer 1.1.1.1 advertise route-reoriginated evpn mac</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword141587291420">*</span>Leaf2-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001259787949__b2015019096175357">peer 3.3.3.3 import reoriginate</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword815822915218">*</span>Leaf2-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001259787949__b233402701175357">peer 3.3.3.3 advertise route-reoriginated evpn mac</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword1715832917217">*</span>Leaf2-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001259787949__b464519066175357">quit</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword101589293219">*</span>Leaf2-bgp-instance-evpn1] <strong id="EN-US_TASK_0000001259787949__b1112613647175357">quit</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword81581429822">*</span>Leaf2] <strong id="EN-US_TASK_0000001259787949__b41378657175357">commit</strong></pre>
<p id="EN-US_TASK_0000001259787949__p975994310175357"># Configure Leaf3.</p>
<pre class="screen" id="EN-US_TASK_0000001259787949__screen1670131786175357">[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword131584295216"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf3-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001259787949__b2101196727175357">peer 4.4.4.4 import reoriginate</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword1158429626">*</span>Leaf3-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001259787949__b1080789685175357">peer 4.4.4.4 advertise route-reoriginated evpn mac</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword10158112911217">*</span>Leaf3-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001259787949__b1505425952175357">peer 2.2.2.2 import reoriginate</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword121582291324">*</span>Leaf3-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001259787949__b1236144985175357">peer 2.2.2.2 advertise route-reoriginated evpn mac</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword111586291225">*</span>Leaf3-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001259787949__b1501858494175357">quit</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword191588293219">*</span>Leaf3-bgp-instance-evpn1] <strong id="EN-US_TASK_0000001259787949__b1787524420175357">quit</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword1115817291728">*</span>Leaf3] <strong id="EN-US_TASK_0000001259787949__b107782391175357">commit</strong></pre>
</p></li><li class="substepexpand" id="EN-US_TASK_0000001259787949__substep1491960508175357"><span id="EN-US_TASK_0000001259787949__cmd1361195584175357">Configure a mapping VNI associated with a BD, and specify the split horizon group to which the mapping VNI belongs.</span><p><p id="EN-US_TASK_0000001259787949__p376274774175357"># Configure Leaf2.</p>
<pre class="screen" id="EN-US_TASK_0000001259787949__screen1086690629175357">[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword715818294214"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf2] <strong id="EN-US_TASK_0000001259787949__b753393282175357">bridge-domain 10</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword1215852918220"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf2-bd10] <strong id="EN-US_TASK_0000001259787949__b1151109981175357">vxlan vni 30 split-group sg1</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword61585297215">*</span>Leaf2-bd10] <strong id="EN-US_TASK_0000001259787949__b1148784782175357">quit</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword8158122919215">*</span>Leaf2] <strong id="EN-US_TASK_0000001259787949__b1475924842175357">commit</strong></pre>
<p id="EN-US_TASK_0000001259787949__p1664436211175357"># Configure Leaf3.</p>
<pre class="screen" id="EN-US_TASK_0000001259787949__screen1503952260175357">[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword315815291024"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf3] <strong id="EN-US_TASK_0000001259787949__b978328486175357">bridge-domain 10</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword1158192918216"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf3-bd10] <strong id="EN-US_TASK_0000001259787949__b1648945472175357">vxlan vni 30 split-group sg1</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword715882911215">*</span>Leaf3-bd10] <strong id="EN-US_TASK_0000001259787949__b1633688379175357">quit</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword10158182913210">*</span>Leaf3] <strong id="EN-US_TASK_0000001259787949__b1014030802175357">commit</strong></pre>
</p></li></ol>
</li><li id="EN-US_TASK_0000001259787949__step1953689505175357"><span id="EN-US_TASK_0000001259787949__cmd634547905175357">Configure an EVPN instance on Leaf2 and Leaf3.</span><p><p id="EN-US_TASK_0000001259787949__p730140930175357"># Configure Leaf2.</p>
<pre class="screen" id="EN-US_TASK_0000001259787949__screen2072309636175357">[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword015818291128"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf2] <strong id="EN-US_TASK_0000001259787949__b2013556199175357">bridge-domain 10</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword11585291219"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf2-bd10] <strong id="EN-US_TASK_0000001259787949__b1106765939175357">vxlan vni 10</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword4159152917213">*</span>Leaf2-bd10] <strong id="EN-US_TASK_0000001259787949__b1681298013175357">evpn</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword1315902915212">*</span>Leaf2-bd10-evpn] <strong id="EN-US_TASK_0000001259787949__b1401403531175357">route-distinguisher 10:2</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword515932911215">*</span>Leaf2-bd10-evpn] <strong id="EN-US_TASK_0000001259787949__b1525849941175357">vpn-target 300:30</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword20159112910216">*</span>Leaf2-bd10-evpn] <strong id="EN-US_TASK_0000001259787949__b1658053651175357">quit</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword8159192918211">*</span>Leaf2-bd10] <strong id="EN-US_TASK_0000001259787949__b267213469175357">quit</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword615916291622">*</span>Leaf2] <strong id="EN-US_TASK_0000001259787949__b1456965263175357">commit</strong></pre>
<p id="EN-US_TASK_0000001259787949__p207117251175357"># Configure Leaf3.</p>
<pre class="screen" id="EN-US_TASK_0000001259787949__screen177882484175357">[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword1115992912216"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf3] <strong id="EN-US_TASK_0000001259787949__b1618066344175357">bridge-domain 10</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword1115952916212"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf3-bd10] <strong id="EN-US_TASK_0000001259787949__b91243728175357">vxlan vni 20</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword015914291217">*</span>Leaf3-bd10] <strong id="EN-US_TASK_0000001259787949__b1927897844175357">evpn</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword1815917290211">*</span>Leaf3-bd10-evpn] <strong id="EN-US_TASK_0000001259787949__b774720144175357">route-distinguisher 10:3</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword1715913291028">*</span>Leaf3-bd10-evpn] <strong id="EN-US_TASK_0000001259787949__b1903610950175357">vpn-target 300:30</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword18159112916219">*</span>Leaf3-bd10-evpn] <strong id="EN-US_TASK_0000001259787949__b2016605238175357">quit</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword815915291729">*</span>Leaf3-bd10] <strong id="EN-US_TASK_0000001259787949__b1288855293175357">quit</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword915914297216">*</span>Leaf3] <strong id="EN-US_TASK_0000001259787949__b1880469659175357">commit</strong></pre>
</p></li><li id="EN-US_TASK_0000001259787949__step383097543175357"><span id="EN-US_TASK_0000001259787949__cmd564431495175357">Configure ingress replication for the mapping VNI on Leaf2 and Leaf3.</span><p><p id="EN-US_TASK_0000001259787949__p1381905097175357"># Configure Leaf2.</p>
<pre class="screen" id="EN-US_TASK_0000001259787949__screen1896545020175357">[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword515932912213"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf2] <strong id="EN-US_TASK_0000001259787949__b1335221079175357">interface nve 1</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword215912294210">*</span>Leaf2-Nve1] <strong id="EN-US_TASK_0000001259787949__b1274157355175357">vni 30 head-end peer-list protocol bgp</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword91596291726">*</span>Leaf2-Nve1] <strong id="EN-US_TASK_0000001259787949__b111124932175357">quit</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword715952917210">*</span>Leaf2] <strong id="EN-US_TASK_0000001259787949__b62824979175357">commit</strong></pre>
<p id="EN-US_TASK_0000001259787949__p1072004931175357"># Configure Leaf3.</p>
<pre class="screen" id="EN-US_TASK_0000001259787949__screen1078697240175357">[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword16159122919213"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf3] <strong id="EN-US_TASK_0000001259787949__b926554663175357">interface nve 1</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword41599292219">*</span>Leaf3-Nve1] <strong id="EN-US_TASK_0000001259787949__b253131294175357">vni 30 head-end peer-list protocol bgp</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword1915932915218">*</span>Leaf3-Nve1] <strong id="EN-US_TASK_0000001259787949__b444416600175357">quit</strong>
[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword1015902918217">*</span>Leaf3] <strong id="EN-US_TASK_0000001259787949__b519925212175357">commit</strong></pre>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0000001259787949__example121226172748"><a name="EN-US_TASK_0000001259787949__1.3.4"></a><a name="1.3.4"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p id="EN-US_TASK_0000001259787949__p165203214175357">After completing the configurations, run the <a href="cmdqueryname=display+vxlan+tunnel"><b><span class="cmdname" id="EN-US_TASK_0000001259787949__cmdname781044431175357">display vxlan tunnel</span></b></a> command on leaf nodes to check VXLAN tunnel information and run the <a href="cmdqueryname=display+vxlan+peer"><b><span class="cmdname" id="EN-US_TASK_0000001259787949__cmdname2006590247175357">display vxlan peer</span></b></a> command to check VXLAN peer information. The following uses the command output on Leaf2 as an example.</p>
<pre class="screen" id="EN-US_TASK_0000001259787949__screen210123341175357">[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword5605144715710"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf2] <strong id="EN-US_TASK_0000001259787949__b149992972175357">display vxlan tunnel</strong>
Number of vxlan tunnel : 2
Tunnel ID   Source                Destination           State  Type     Uptime
-----------------------------------------------------------------------------------
4026531924  2.2.2.2               1.1.1.1               up     dynamic  00:39:19
4026531925  2.2.2.2               3.3.3.3               up     dynamic  00:39:09</pre>
<pre class="screen" id="EN-US_TASK_0000001259787949__screen695099333175357">[<span class="keyword" id="EN-US_TASK_0000001259787949__keyword1160504716717"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf2] <strong id="EN-US_TASK_0000001259787949__b1675792314175357">display vxlan peer</strong>
Number of peers : 2
Vni ID    Source                  Destination            Type      Out Vni ID    Creation Mode
----------------------------------------------------------------------------------------------
10        2.2.2.2                 1.1.1.1                dynamic   10            implicit
30        2.2.2.2                 3.3.3.3                dynamic   30            implicit</pre>
<p id="EN-US_TASK_0000001259787949__p1302076093175357">After the configuration is complete, VM1 and VM2 can communicate at Layer 2.</p>
</div>
<div class="postreq"><a name="EN-US_TASK_0000001259787949__1.3.5"></a><a name="1.3.5"></a><h4 class="sectiontitle">Configuration Scripts</h4><ul id="EN-US_TASK_0000001259787949__ul462679508175357"><li id="EN-US_TASK_0000001259787949__li217944659175357"><p id="EN-US_TASK_0000001259787949__p1536265678175357"><a name="EN-US_TASK_0000001259787949__li217944659175357"></a><a name="li217944659175357"></a>Spine1</p>
<pre class="screen" id="EN-US_TASK_0000001259787949__screen610704939175357">#
sysname Spine1
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 192.168.10.1 255.255.255.0
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ip address 192.168.20.1 255.255.255.0
#
ospf 1
 area 0.0.0.0
  network 192.168.10.0 0.0.0.255
  network 192.168.20.0 0.0.0.255
#
return </pre>
</li><li id="EN-US_TASK_0000001259787949__li1803495196175357"><p id="EN-US_TASK_0000001259787949__p1759565414175357"><a name="EN-US_TASK_0000001259787949__li1803495196175357"></a><a name="li1803495196175357"></a>Leaf1</p>
<pre class="screen" id="EN-US_TASK_0000001259787949__screen1397527812175357">#
sysname Leaf1
#
evpn-overlay enable
#
bridge-domain 10
 vxlan vni 10
 #
 evpn
  route-distinguisher 10:1
  vpn-target 300:30 export-extcommunity
  vpn-target 300:30 import-extcommunity
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 192.168.10.2 255.255.255.0
#
interface <span>100GE</span><span>1/0/2</span>.1 mode l2
 encapsulation dot1q vid 10
 bridge-domain 10
#
interface LoopBack1
 ip address 1.1.1.1 255.255.255.255
#
interface Nve1
 source 1.1.1.1
 vni 10 head-end peer-list protocol bgp
#
bgp 100 instance evpn1
 peer 2.2.2.2 as-number 100
 peer 2.2.2.2 connect-interface LoopBack1
 #
 l2vpn-family evpn
  policy vpn-target
  peer 2.2.2.2 enable
#
ospf 1
 area 0.0.0.0
  network 1.1.1.1 0.0.0.0
  network 192.168.10.0 0.0.0.255
#
return</pre>
</li><li id="EN-US_TASK_0000001259787949__li1303155144175357"><p id="EN-US_TASK_0000001259787949__p2090273102175357"><a name="EN-US_TASK_0000001259787949__li1303155144175357"></a><a name="li1303155144175357"></a>Leaf2</p>
<pre class="screen" id="EN-US_TASK_0000001259787949__screen971167098175357">#
sysname Leaf2
#                                                                                                                                   
evpn                                                                                                                                
 irb-reoriginated without-split-group disable 
 l3-reoriginate different-split-group 
 mac-duplication
#
evpn-overlay enable
#
bridge-domain 10
 vxlan vni 10
 vxlan vni 30 split-group sg1
 #
 evpn
  route-distinguisher 10:2
  vpn-target 300:30 export-extcommunity
  vpn-target 300:30 import-extcommunity
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 192.168.20.2 255.255.255.0
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ip address 192.168.50.1 255.255.255.0
#
interface LoopBack1
 ip address 2.2.2.2 255.255.255.255
#
interface Nve1
 source 2.2.2.2
 vni 10 head-end peer-list protocol bgp
 vni 30 head-end peer-list protocol bgp
#
bgp 10
 peer 192.168.50.2 as-number 20
 #
 ipv4-family unicast
  network 2.2.2.2 255.255.255.255
  peer 192.168.50.2 enable
#
bgp 100 instance evpn1
 peer 1.1.1.1 as-number 100
 peer 1.1.1.1 connect-interface LoopBack1
 peer 3.3.3.3 as-number 200
 peer 3.3.3.3 ebgp-max-hop 255
 peer 3.3.3.3 connect-interface LoopBack1
 #
 l2vpn-family evpn
  policy vpn-target
  peer 1.1.1.1 enable
  peer 1.1.1.1 import reoriginate
  peer 1.1.1.1 advertise route-reoriginated evpn mac
  peer 3.3.3.3 enable
  peer 3.3.3.3 split-group sg1
  peer 3.3.3.3 import reoriginate
  peer 3.3.3.3 advertise route-reoriginated evpn mac
#
ospf 1
 area 0.0.0.0
  network 2.2.2.2 0.0.0.0
  network 192.168.20.0 0.0.0.255
#
return  </pre>
</li><li id="EN-US_TASK_0000001259787949__li1335114827175357"><p id="EN-US_TASK_0000001259787949__p218269886175357"><a name="EN-US_TASK_0000001259787949__li1335114827175357"></a><a name="li1335114827175357"></a>Spine2</p>
<pre class="screen" id="EN-US_TASK_0000001259787949__screen48750128175357">#
sysname Spine2
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 192.168.30.1 255.255.255.0
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ip address 192.168.40.1 255.255.255.0
#
ospf 1
 area 0.0.0.0
  network 192.168.30.0 0.0.0.255
  network 192.168.40.0 0.0.0.255
#
return
</pre>
</li><li id="EN-US_TASK_0000001259787949__li785756895175357"><p id="EN-US_TASK_0000001259787949__p1339188862175357"><a name="EN-US_TASK_0000001259787949__li785756895175357"></a><a name="li785756895175357"></a>Leaf3</p>
<pre class="screen" id="EN-US_TASK_0000001259787949__screen1746857458175357">#
sysname Leaf3
#                                                                                                                                   
evpn                                                                                                                                
 irb-reoriginated without-split-group disable 
 l3-reoriginate different-split-group 
 mac-duplication
#
evpn-overlay enable
#
bridge-domain 10
 vxlan vni 20
 vxlan vni 30 split-group sg1
 #
 evpn
  route-distinguisher 10:3
  vpn-target 300:30 export-extcommunity
  vpn-target 300:30 import-extcommunity
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 192.168.30.2 255.255.255.0
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ip address 192.168.50.2 255.255.255.0
#
interface LoopBack1
 ip address 3.3.3.3 255.255.255.255
#
interface Nve1
 source 3.3.3.3
 vni 20 head-end peer-list protocol bgp
 vni 30 head-end peer-list protocol bgp
#
bgp 20
 peer 192.168.50.1 as-number 10
 #
 ipv4-family unicast
  network 3.3.3.3 255.255.255.255
  peer 192.168.50.1 enable
#
bgp 200 instance evpn1
 peer 2.2.2.2 as-number 100
 peer 2.2.2.2 ebgp-max-hop 255
 peer 2.2.2.2 connect-interface LoopBack1
 peer 4.4.4.4 as-number 200
 peer 4.4.4.4 connect-interface LoopBack1
 #
 l2vpn-family evpn
  policy vpn-target
  peer 2.2.2.2 enable
  peer 2.2.2.2 split-group sg1
  peer 2.2.2.2 import reoriginate
  peer 2.2.2.2 advertise route-reoriginated evpn mac
  peer 4.4.4.4 enable
  peer 4.4.4.4 import reoriginate
  peer 4.4.4.4 advertise route-reoriginated evpn mac
#
ospf 1
 area 0.0.0.0
  network 3.3.3.3 0.0.0.0
  network 192.168.30.0 0.0.0.255
#
return</pre>
</li><li id="EN-US_TASK_0000001259787949__li715490911175357"><p id="EN-US_TASK_0000001259787949__p1494801624175357"><a name="EN-US_TASK_0000001259787949__li715490911175357"></a><a name="li715490911175357"></a>Leaf4</p>
<pre class="screen" id="EN-US_TASK_0000001259787949__screen716771723175357">#
sysname Leaf4
#
evpn-overlay enable
#
bridge-domain 10
 vxlan vni 20
 #
 evpn
  route-distinguisher 10:4
  vpn-target 300:30 export-extcommunity
  vpn-target 300:30 import-extcommunity
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 192.168.40.2 255.255.255.0
#
interface <span>100GE</span><span>1/0/2</span>.1 mode l2
 encapsulation dot1q vid 10
 bridge-domain 10
#
interface LoopBack1
 ip address 4.4.4.4 255.255.255.255
#
interface Nve1
 source 4.4.4.4
 vni 20 head-end peer-list protocol bgp
#
bgp 200 instance evpn1
 peer 3.3.3.3 as-number 200
 peer 3.3.3.3 connect-interface LoopBack1
 #
 l2vpn-family evpn
  policy vpn-target
  peer 3.3.3.3 enable
#
ospf 1
 area 0.0.0.0
  network 4.4.4.4 0.0.0.0
  network 192.168.40.0 0.0.0.255
#
return</pre>
</li></ul>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../vrp/dc_vrp_vxlan_cfg_1241.html">Configuring Segment VXLAN to Implement Layer 2 Interworking (Mapping VNI Mode)
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../vrp/dc_vrp_vxlan_cfg_1241-dc3.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>
</body>
</html>