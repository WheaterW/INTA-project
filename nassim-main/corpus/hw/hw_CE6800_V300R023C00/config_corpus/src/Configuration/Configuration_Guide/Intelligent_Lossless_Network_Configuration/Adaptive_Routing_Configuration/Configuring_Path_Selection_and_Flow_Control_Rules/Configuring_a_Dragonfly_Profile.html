
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring a Dragonfly Profile">
<meta name="abstract" content="">
<meta name="description" content="">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="galaxy_adaptive_routing_cfg_0022.html">
<meta name="DC.Relation" scheme="URI" content="galaxy_adaptive_routing_cfg_0023.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="Dragonfly Adaptive Routing">
<meta name="featurename" content="Adaptive Routing">
<meta name="featuretype" content="Intelligent Lossless Network">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="Dragonfly Adaptive Routing">
<meta name="featurename" content="Adaptive Routing">
<meta name="featuretype" content="Intelligent Lossless Network">
<meta name="featurename" content="Dragonfly Adaptive Routing">
<meta name="featurename" content="Adaptive Routing">
<meta name="featuretype" content="Intelligent Lossless Network">
<meta name="featuretype" content="Intelligent Lossless Network">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001512671266">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>Configuring a Dragonfly Profile</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001512671266"></a><a name="EN-US_TASK_0000001512671266"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring a Dragonfly Profile</h1>
<div class="taskbody"><p></p>
<div class="context"><a name="EN-US_TASK_0000001512671266__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>The adaptive routing relies on the dragonfly profile.</p>
<p>Currently, the device supports only the default dragonfly profile. You can enable adaptive routing globally and on an interface in sequence to make the configuration in the default dragonfly profile take effect.</p>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001512671266__1.4.2"></a><a name="1.4.2"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Enter the system view.</span><p><pre class="screen"><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></pre>
</p></li><li><span>Enter the dragonfly profile view.</span><p><pre class="screen"><strong><a href="cmdqueryname=dragonfly+profile"><b><span class="cmdname">dragonfly profile</span></b></a> default</strong></pre>
<p>By default, a dragonfly profile exists on the device. Currently, the device supports only the default dragonfly profile.</p>
</p></li><li><span>Set the upper and lower thresholds for the bandwidth utilization level.</span><p><pre class="screen"><strong><a href="cmdqueryname=adaptive-routing+bandwidth"><b><span class="cmdname">adaptive-routing bandwidth</span></b></a> high-threshold</strong> <em>high-threshold-value</em> <strong>low-threshold</strong> <em>low-threshold-value</em></pre>
<p>By default, the upper and lower thresholds for the bandwidth utilization level are 6 and 3, respectively.</p>
</p></li><li><span>Set the upper and lower thresholds for the queue depth level.</span><p><pre class="screen"><strong><a href="cmdqueryname=adaptive-routing+buffer"><b><span class="cmdname">adaptive-routing buffer</span></b></a> high-threshold</strong> <em>high-threshold-value</em> <strong>low-threshold</strong> <em>low-threshold-value</em></pre>
<p>By default, the upper and lower thresholds for the queue depth level are 6 and 3, respectively.</p>
</p></li><li><span>Set the interval for sending an ARN message about congestion.</span><p><pre class="screen"><strong><a href="cmdqueryname=adaptive-routing+congestion+notification"><b><span class="cmdname">adaptive-routing congestion notification</span></b></a> tx-interval</strong> <em>tx-interval-value</em></pre>
<p>By default, the interval for sending an ARN message about congestion is 500 ms.</p>
</p></li><li><span>For the CE8851-32CQ8DQ-P, CE8850-SAN, CE8851K and CE8850-HAM: Configure dragonfly antilocking PFC on interface queues. (The CE8855 and CE8851-32CQ4BQ do not support this command and need to be configured with PFC.)</span><p><pre class="screen"><strong><a href="cmdqueryname=abs-pfc+priority"><b><span class="cmdname">abs-pfc priority</span></b></a></strong> { <em>prioritynumber</em> } &amp;&lt;1-3&gt; <strong><strong><span>enable</span></strong></strong> [ <strong>threshold</strong> <em>threshold-value</em> ]</pre>
<p>By default, dragonfly antilocking PFC is disabled on interface queues.</p>
<div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><ul><li>If dragonfly antilocking PFC is enabled in the dragonfly profile, this function is enabled on the interface where the adaptive routing function is enabled.</li><li>If dragonfly antilocking PFC is enabled in the dragonfly profile and adaptive routing is enabled on an interface, you need to run the <strong><a href="cmdqueryname=qos+hpc+enhanced"><b><span class="cmdname">qos hpc enhanced</span></b></a></strong> command to ensure that the packets in queues 6 and 7 are not discarded.</li><li>If dragonfly antilocking PFC is enabled in the dragonfly profile, the interfaces where adaptive routing is enabled must have the same bandwidth.</li><li>Dragonfly antilocking PFC can be enabled for a maximum of three queues on an interface.</li><li>A maximum of 90 queues on all the interfaces of a device can have dragonfly antilocking PFC enabled.</li><li>If dragonfly deadlock prevention has been enabled for a priority queue, disable it before disabling dragonfly antilocking PFC in the queue.</li></ul>
</div></div>
</p></li><li><span>Enable dragonfly deadlock prevention and adjust the queue priority and DSCP value of packets in hook-shaped flows.</span><p><pre class="screen"><strong><a href="cmdqueryname=adjust+original-dscp"><b><span class="cmdname">adjust original-dscp</span></b></a></strong> <em>original-dscpvalue</em> <strong>to priority</strong> <em>prioritynumber</em> <strong>dscp</strong> <em>dscpvalue</em></pre>
<p>By default, dragonfly deadlock prevention is disabled, and there are no configurations for hook-shaped flows.</p>
<div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><ul><li>PFC deadlock prevention and dragonfly deadlock prevention cannot both be enabled.</li><li>The <strong>adjust original-dscp</strong> command can be run twice at most, with different values configured for <em>original-dscpvalue</em>, <em>prioritynumber</em>, and <em>dscpvalue</em> the second time. To modify the configuration, run the <strong>undo adjust original-dscp</strong> command to delete the original configuration first.</li></ul>
<p>For the CE8851-32CQ8DQ-P, CE8850-SAN, CE8851K, and CE8850-HAM:</p>
<ul><li>Before running the <strong><a href="cmdqueryname=adjust+original-dscp"><b><span class="cmdname">adjust original-dscp</span></b></a></strong> command to enable dragonfly deadlock prevention, you must run the <strong><a href="cmdqueryname=abs-pfc+priority+enable"><b><span class="cmdname">abs-pfc priority enable</span></b></a></strong> command to enable dragonfly antilocking PFC. In addition, the priority queue that <strong>original-dscp</strong> is mapped to and the priority queue specified by <strong>priority</strong> in the <strong><a href="cmdqueryname=adjust+original-dscp"><b><span class="cmdname">adjust original-dscp</span></b></a></strong> command must be within the range specified by <strong>priority</strong> in the <strong><a href="cmdqueryname=abs-pfc+priority+enable"><b><span class="cmdname">abs-pfc priority enable</span></b></a></strong> command.</li><li>If the priority queue that the <strong>original-dscp</strong> parameter is mapped to changes to a queue for which dragonfly antilocking PFC is not enabled due to the mapping change between DSCP values and priority queues, dragonfly deadlock prevention does not take effect for the priority queue that the <strong>original-dscp</strong> parameter is mapped to before and after the mapping change.</li><li>You need to enable dragonfly antilocking PFC for a specified queue and then enable dragonfly deadlock prevention.</li></ul>
<p>For the CE8855 and CE8851-32CQ4BQ:</p>
<ul><li>If the role of an interface has been configured for adaptive routing, you must enable PFC on the interface before running the <strong><a href="cmdqueryname=adjust+original-dscp"><b><span class="cmdname">adjust original-dscp</span></b></a></strong> command to enable dragonfly deadlock prevention. In addition, the priority queue that <strong>original-dscp</strong> is mapped to and the priority queue specified by <strong>priority</strong> in the <strong><a href="cmdqueryname=adjust+original-dscp"><b><span class="cmdname">adjust original-dscp</span></b></a></strong> command must be within the range of the priority queues where PFC has been enabled.</li><li>Before configuring the role of an interface for adaptive routing, you must enable PFC for the priority queue that <strong>original-dscp</strong> is mapped to and the priority queue specified by <strong>priority</strong> in the <strong><a href="cmdqueryname=adjust+original-dscp"><b><span class="cmdname">adjust original-dscp</span></b></a></strong> command.</li><li>If the priority queue that the <strong>original-dscp</strong> parameter is mapped to changes to a queue for which PFC is not enabled due to the mapping change between DSCP values and priority queues, dragonfly deadlock prevention does not take effect for the priority queue that the <strong>original-dscp</strong> parameter is mapped to before and after the mapping change.</li></ul>
</div></div>
</p></li><li><span>Exit the dragonfly profile view.</span><p><pre class="screen"><a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></pre>
</p></li><li><span>Commit the configuration.</span><p><pre class="screen" id="EN-US_TASK_0000001512671266__en-us_task_0228023023_screen163801330213"><a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001512671266__en-us_task_0228023023_en-us_concept_0141113565_cmdname1667501373175340">commit</span></b></a></pre>
</p></li></ol></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="galaxy_adaptive_routing_cfg_0022.html">Configuring Path Selection and Flow Control Rules
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="galaxy_adaptive_routing_cfg_0023.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>