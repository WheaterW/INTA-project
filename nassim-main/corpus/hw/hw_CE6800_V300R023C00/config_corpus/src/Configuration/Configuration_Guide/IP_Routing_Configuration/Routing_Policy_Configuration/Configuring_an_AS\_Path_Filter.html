
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring an AS_Path Filter">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="vrp_route-policy_cfg_0001.html">
<meta name="DC.Relation" scheme="URI" content="vrp_route-policy_cfg_0006.html">
<meta name="DC.Relation" scheme="URI" content="vrp_route-policy_cfg_0008.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="Routing Policy">
<meta name="featuretype" content="IP Routing">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="Routing Policy">
<meta name="featuretype" content="IP Routing">
<meta name="featuretype" content="IP Routing">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001130783786">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>Configuring an AS_Path Filter</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001130783786"></a><a name="EN-US_TASK_0000001130783786"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring an AS_Path Filter</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001130783786__1.3.1"></a><a name="1.3.1"></a>
<div class="p"><div class="p"><p>An AS_Path filter is used to filter BGP routes by matching against AS_Path attributes. The AS_Path attribute records the numbers of all ASs through which a BGP route passes from the local end to the destination in the distance-vector (DV) order. In this case, AS_Path attribute-based filtering rules can be defined to filter BGP routes.</p>
<div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The AS_Path filter takes effect only on BGP routes because the AS_Path attribute is a private attribute of BGP.</p>
</div></div>
<h4 class="sectiontitle">Introduction to the AS_Path Filter</h4><p>As shown in <a href="#EN-US_TASK_0000001130783786__fig12776193754218">Figure 1</a>, the AS_Path attribute of a BGP route can be considered as a string that may contain spaces. A regular expression can be used to search for matching characters in the AS_Path attribute.</p>
<div class="fignone" id="EN-US_TASK_0000001130783786__fig12776193754218"><a name="EN-US_TASK_0000001130783786__fig12776193754218"></a><a name="fig12776193754218"></a><span class="figcap"><b>Figure 1 </b>AS_Path attribute of BGP routes</span><br><span><img class="vsd" src="figure/en-us_image_0000001130624000.png"></span></div>
<p>A regular expression uses a specific string to describe a trait and is used to check whether another string has the trait. The BGP AS_Path filter defines an AS_Path-based regular expression and matches it against the AS_Path attributes of BGP routes to filter these routes.</p>
<p>For example, <strong>ip as-path-filter 1 permit 495</strong> defines AS_Path filter 1 and the regular expression <strong>495</strong>. This regular expression matches any string that contains <strong>495</strong>.</p>
<h4 class="sectiontitle">AS_Path Regular Expression Content</h4><p>Regular expressions are the core of the AS_Path filter and their content is complex. This section describes the regular expression content related only to the AS_Path filter.</p>
<p>Regular expressions are used by the AS_Path filter to define matching rules. A regular expression consists of the following parts:</p>
<ul><li><p>Metacharacter: defines a matching rule.</p>
</li><li><p>Literal character: defines a matching object.</p>
</li></ul>
<p><a href="#EN-US_TASK_0000001130783786__table6628143231313">Table 1</a> lists the metacharacters that can be used to match BGP AS_Path attributes.</p>

<div class="tableBorder"><a name="EN-US_TASK_0000001130783786__table6628143231313"></a><a name="table6628143231313"></a><table cellpadding="4" cellspacing="0" summary="" id="EN-US_TASK_0000001130783786__table6628143231313" frame="border" border="1" rules="all"><caption><b>Table 1 </b>Metacharacters supported by BGP AS_Path regular expressions</caption><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="9.790000000000001%" id="mcps1.3.1.13.2.4.1.1" liSelected="liSelected"><p>Metacharacter</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="23.14%" id="mcps1.3.1.13.2.4.1.2" liSelected="liSelected"><p>Meaning</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="67.07%" id="mcps1.3.1.13.2.4.1.3" liSelected="liSelected"><p>Example</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" valign="top" width="9.790000000000001%" headers="mcps1.3.1.13.2.4.1.1 "><p>.</p>
</td>
<td class="cellrowborder" valign="top" width="23.14%" headers="mcps1.3.1.13.2.4.1.2 "><p>Matches any single character (including a space) in an AS_Path, except "\n".</p>
</td>
<td class="cellrowborder" valign="top" width="67.07%" headers="mcps1.3.1.13.2.4.1.3 "><p>.* matches any string in an AS_Path, which is used to match any route.</p>
<div class="note"><span class="notetitle"> NOTE: </span><div class="notebody"><p>After multiple <strong>ip as-path-filter</strong> <strong>deny</strong> clauses are configured to reject matching routes, the <strong>ip as-path-filter</strong> <em>as-path-filter-name</em> <strong>permit</strong> .* command is usually run to permit other routes.</p>
</div></div>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="9.790000000000001%" headers="mcps1.3.1.13.2.4.1.1 "><p>*</p>
</td>
<td class="cellrowborder" valign="top" width="23.14%" headers="mcps1.3.1.13.2.4.1.2 "><p>Matches a string with zero or multiple consecutive occurrences of a character before the asterisk (*).</p>
</td>
<td class="cellrowborder" valign="top" width="67.07%" headers="mcps1.3.1.13.2.4.1.3 "><p>See the preceding example.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="9.790000000000001%" headers="mcps1.3.1.13.2.4.1.1 "><p>+</p>
</td>
<td class="cellrowborder" valign="top" width="23.14%" headers="mcps1.3.1.13.2.4.1.2 "><p>Matches a string with one or multiple consecutive occurrences of a character before the plus sign (+).</p>
</td>
<td class="cellrowborder" valign="top" width="67.07%" headers="mcps1.3.1.13.2.4.1.3 "><div class="p">65+ matches the string that begins with 65 and contains a single 5 or multiple occurrences of 5:<ul><li><p>Example of matching strings: 65, 655, 6559, 65259, and 65529</p>
</li><li><p>Examples of unmatching strings: 56, 556, 5669, 55269, and 56259</p>
</li></ul>
</div>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="9.790000000000001%" headers="mcps1.3.1.13.2.4.1.1 "><p>|</p>
</td>
<td class="cellrowborder" valign="top" width="23.14%" headers="mcps1.3.1.13.2.4.1.2 "><p>Matches any string with characters on either side of the vertical bar (|).</p>
</td>
<td class="cellrowborder" valign="top" width="67.07%" headers="mcps1.3.1.13.2.4.1.3 "><p>100|65002|65003 matches 100, 65002, or 65003.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="9.790000000000001%" headers="mcps1.3.1.13.2.4.1.1 "><p>^</p>
</td>
<td class="cellrowborder" valign="top" width="23.14%" headers="mcps1.3.1.13.2.4.1.2 "><p>Matches the string that follows the caret sign (^).</p>
</td>
<td class="cellrowborder" valign="top" width="67.07%" headers="mcps1.3.1.13.2.4.1.3 "><div class="p">^65 matches strings beginning with 65:<ul><li><p>Example of matching strings: 65, 651, 6501, and 65001</p>
</li><li><p>Example of unmatching strings: 165, 1650, 6650, and 60065</p>
</li></ul>
</div>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="9.790000000000001%" headers="mcps1.3.1.13.2.4.1.1 "><p>$</p>
</td>
<td class="cellrowborder" valign="top" width="23.14%" headers="mcps1.3.1.13.2.4.1.2 "><p>Matches the string that ends with characters displayed before the dollar sign ($).</p>
</td>
<td class="cellrowborder" valign="top" width="67.07%" headers="mcps1.3.1.13.2.4.1.3 "><div class="p">65$ matches strings ending with 65:<ul><li><p>Example of matching strings: 65, 165, 1065, 10065, and 60065</p>
</li><li><p>Example of unmatching strings: 651, 1650, 6650, 60650, and 65001</p>
</li></ul>
</div>
<div class="note"><span class="notetitle"> NOTE: </span><div class="notebody"><p>^$ matches an empty string (empty AS_Path) and is usually used to match against locally generated routes.</p>
</div></div>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="9.790000000000001%" headers="mcps1.3.1.13.2.4.1.1 "><p>( )</p>
</td>
<td class="cellrowborder" valign="top" width="23.14%" headers="mcps1.3.1.13.2.4.1.2 "><p>Functions as a sub-regular expression to match strings that contain the matching sub-string contained within the parenthesis.</p>
</td>
<td class="cellrowborder" valign="top" width="67.07%" headers="mcps1.3.1.13.2.4.1.3 "><p>100(200)+ matches 100200, 100200200, and so on.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="9.790000000000001%" headers="mcps1.3.1.13.2.4.1.1 "><p>[ ]</p>
</td>
<td class="cellrowborder" valign="top" width="23.14%" headers="mcps1.3.1.13.2.4.1.2 "><p>Matches any character in a string or in a specified range defined in square brackets.</p>
</td>
<td class="cellrowborder" valign="top" width="67.07%" headers="mcps1.3.1.13.2.4.1.3 "><p>[896] matches 8, 9, or 6.</p>
<div class="p">[2-4] matches any of 2, 3, or 4, and [0-9] matches any digit in the range of 0 to 9.<div class="note"><span class="notetitle"> NOTE: </span><div class="notebody"><p>The value in the square brackets ([]) must be a digit from 0 to 9. For example, to match a number ranging from 735 to 907, use the regular expression of (73[5-9]|7[4-9][0-9]|8[0-9][0-9]|90[0-7]).</p>
</div></div>
</div>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="9.790000000000001%" headers="mcps1.3.1.13.2.4.1.1 "><p>[^ ]</p>
</td>
<td class="cellrowborder" valign="top" width="23.14%" headers="mcps1.3.1.13.2.4.1.2 "><p>Matches any character other than the characters listed in the square brackets or any character that is not in the specified range.</p>
</td>
<td class="cellrowborder" valign="top" width="67.07%" headers="mcps1.3.1.13.2.4.1.3 "><p>[^2-4] matches strings without 2, 3, and 4, and [^0-9] matches strings without digits from 0 to 9.</p>
<p>[^896] matches any character, except 8, 9, and 6.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="9.790000000000001%" headers="mcps1.3.1.13.2.4.1.1 "><p>_</p>
</td>
<td class="cellrowborder" valign="top" width="23.14%" headers="mcps1.3.1.13.2.4.1.2 "><p>Matches a sign, such as a comma (,), left brace ({), right brace (}), left parenthesis ((), right parenthesis ()), and space. In addition, the underscore (_) can be used at the beginning of a regular expression with the same function as the caret sign (^) or at the end of a regular expression with the same function as the dollar sign ($).</p>
</td>
<td class="cellrowborder" valign="top" width="67.07%" headers="mcps1.3.1.13.2.4.1.3 "><ul><li><p>^65001_ matches the AS_Paths that begin with 65001 followed by a symbol. Specifically, ^65001_ matches AS_Paths with 65001 as the leftmost AS number (the number of the last AS through which a route passes) and the routes sent by peers in AS 65001.</p>
</li><li><p>_65001_ matches the strings (AS_Paths) that contain 65001, which is used to match the routes that pass through AS 65001.</p>
</li><li><p>_65001$ matches the AS_Paths that end with a sign followed by 65001. Specifically, _65001$ matches AS_Paths with 65001 as the rightmost AS number (the number of the first AS through which a route passes), which is used to match the routes that originate in AS 65001.</p>
</li></ul>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="9.790000000000001%" headers="mcps1.3.1.13.2.4.1.1 "><p>\</p>
</td>
<td class="cellrowborder" valign="top" width="23.14%" headers="mcps1.3.1.13.2.4.1.2 "><p>Defines an escape character.</p>
</td>
<td class="cellrowborder" valign="top" width="67.07%" headers="mcps1.3.1.13.2.4.1.3 "><div class="p">An AS_Confed_Sequence contains parentheses (()). The parentheses (()) in regular expressions provide special functions. To match such special characters by removing their special meanings, you can use the backslash (\). For example:<ul><li><p>\(65002_ matches the AS_Confed_Sequences that begin with (65002 followed by a special character. Specifically, \(65002_ matches AS_Confed_Sequences with 65002 as the leftmost AS number (the number of the last AS through which a route passes) and the routes sent by peers in AS 65002.</p>
</li><li><p>\(.*_65003_.*\) matches the AS_Confed_Sequence that contains AS number 65003 and the routes that pass through AS 65003 in a BGP confederation.</p>
</li><li><p>_65004\) matches a string that ends with 65004 and with a sign before 65004. That is, the leftmost AS number (start AS) of AS_Confed_Sequence is 65004. This string can also be used to match the routes originating from AS 65004 in a BGP confederation and the routes directly advertised by AS 65004 in the BGP confederation.</p>
</li></ul>
</div>
<p>Similarly, backslashes (\) can be used to remove the special meanings of the left bracket ([) and right bracket (]) used in an AS_Confed_Set and the left brace ({) and right brace (}) used in an AS_Set.</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>Multiple rules (each in permit or deny mode) can be specified in an AS_Path filter. The relationship between theses rules is "OR", which means that if a route meets one of the matching rules, the route matches the AS_Path filter.</p>
</div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001130783786__1.3.2"></a><a name="1.3.2"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Enter the system view.</span><p><pre class="screen"><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></pre>
</p></li><li><span>Configure an AS_Path filter.</span><p><pre class="screen"><a href="cmdqueryname=ip+as-path-filter"><b><span class="cmdname">ip as-path-filter</span></b></a> <span>{ <i><span class="varname">as-path-filter-number</span></i> | <i><span class="varname">as-path-filter-name</span></i> } </span><span>[ <strong><span>index</span></strong> <i><span class="varname">index-number</span></i> ]</span><i><span class="varname"> matchMode</span></i> <i><span class="varname">regular-expression</span></i> </pre>
<p>In the preceding command, <i><span class="varname">regular-expression</span></i> defines a matching rule for the AS_Path filter.</p>
</p></li><li><span>Commit the configuration.</span><p><pre class="screen" id="EN-US_TASK_0000001130783786__en-us_task_0234857734_screen163801330213"><a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001130783786__en-us_task_0234857734_en-us_concept_0141113565_cmdname1667501373175340">commit</span></b></a></pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001130783786__1.3.3"></a><a name="1.3.3"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p>Run the <a href="cmdqueryname=display+ip+as-path-filter"><b><span class="cmdname">display ip as-path-filter</span></b></a> <span>[ <i><span class="varname">as-path-filter-number</span></i> | <i><span class="varname">as-path-filter-name</span></i> ]</span> command to check information about the configured AS_Path filter.</p>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="vrp_route-policy_cfg_0001.html">Routing Policy Configuration
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="vrp_route-policy_cfg_0006.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="vrp_route-policy_cfg_0008.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>