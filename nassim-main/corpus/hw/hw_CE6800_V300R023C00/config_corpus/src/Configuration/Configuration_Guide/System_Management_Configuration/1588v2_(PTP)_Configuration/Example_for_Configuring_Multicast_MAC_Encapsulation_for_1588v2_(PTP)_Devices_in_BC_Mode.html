
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Multicast MAC Encapsulation for 1588v2 (PTP) Devices in BC Mode">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="galaxy_1588v2_cfg_0001.html">
<meta name="DC.Relation" scheme="URI" content="galaxy_1588v2_cfg_0023.html">
<meta name="DC.Relation" scheme="URI" content="galaxy_1588v2_cfg_0019.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="1588v2 (PTP)">
<meta name="featuretype" content="System Management">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="1588v2 (PTP)">
<meta name="featuretype" content="System Management">
<meta name="featuretype" content="System Management">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001563878917">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring Multicast MAC Encapsulation for 1588v2 (PTP) Devices in BC Mode</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001563878917"></a><a name="EN-US_TASK_0000001563878917"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Multicast MAC Encapsulation for 1588v2 (PTP) Devices in BC Mode</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001563878917__1.3.1"></a><a name="1.3.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>In <a href="#EN-US_TASK_0000001563878917__fig_dc_cfg_ptp_003401">Figure 1</a>, all devices are located on a Layer 2 network and support 1588v2, with DeviceA and DeviceB connected to two different PTP clock sources. After the grandmaster clock is determined between DeviceA and DeviceB through dynamic BMC selection, it transmits 1588v2 time signals to the entire network.</p>
<div class="fignone" id="EN-US_TASK_0000001563878917__fig_dc_cfg_ptp_003401"><a name="EN-US_TASK_0000001563878917__fig_dc_cfg_ptp_003401"></a><a name="fig_dc_cfg_ptp_003401"></a><span class="figcap"><b>Figure 1 </b>Networking diagram of clock synchronization</span><br><span><img src="figure/en-us_image_0000001921222822.png" width="NaN" height="NaN"></span></div>
<div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface 1, interface 2, and interface 3 represent <span>100GE</span> <span>1/0/1</span>, <span>100GE</span> <span>1/0/2</span>, and <span>100GE</span> <span>1/0/3</span>, respectively.</p>
</div></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001563878917__1.3.2"></a><a name="1.3.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Enable 1588v2 globally and set the device type to BC.</p>
</li><li><p>Configure 1588v2 devices to import time signals from PTP clock sources.</p>
</li><li><p>Enable 1588v2 on interfaces.</p>
</li><li><p>As the MAC addresses of interfaces are unknown on a Layer 2 network, 1588v2 messages are transmitted in multicast MAC encapsulation mode by default. You do not need to configure an encapsulation mode for 1588v2 messages.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001563878917__1.3.3"></a><a name="1.3.3"></a>
<div class="p"><h4 class="sectiontitle">Procedure</h4><ol><li>Enable 1588v2 globally and set the device type to BC.<p># Configure DeviceA. The configurations of DeviceB, DeviceC, and DeviceD are similar to the configuration of DeviceA.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname DeviceA</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>ptp enable</strong>
[<span class="keyword">*</span>DeviceA] <strong>ptp device-type bc</strong>
[<span class="keyword">*</span>DeviceA] <strong>commit</strong></pre>
</li><li>Configure 1588v2 devices to import time signals from PTP clock sources.<div class="p"># Configure DeviceA. The configurations of DeviceB, DeviceC, and DeviceD are similar to the configuration of DeviceA.<pre class="screen"><span>[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] </span><strong>clock</strong> <strong>source</strong> <strong>ptp</strong> <strong>synchronization</strong> <strong>enable</strong><span>
[<span class="keyword">*</span>DeviceA] <strong>clock</strong></span> <strong>source</strong> <strong>ptp</strong> <span><strong>priority 1</strong></span>
[<span class="keyword">*</span>DeviceA] <strong>commit</strong></pre>
</div>
</li><li>Enable 1588v2 on interfaces.<p># Configure DeviceA. The configurations of DeviceB, DeviceC, and DeviceD are similar to the configuration of DeviceA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>interface <span>100ge</span> <span>1/0/1</span></strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>ptp enable</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>interface <span>100ge</span> <span>1/0/2</span></strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/2</span>] <strong>ptp enable</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/2</span>] <strong>quit</strong>
<span>[<span class="keyword">*</span>DeviceA] <strong>interface <span>100ge</span> <span>1/0/3</span></strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/3</span>] <strong>ptp enable</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/3</span>] <strong>quit</strong></span>
[<span class="keyword">*</span>DeviceA] <strong>commit</strong></pre>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001563878917__1.3.4"></a><a name="1.3.4"></a>
<div class="p"><h4 class="sectiontitle">Verifying the Configuration</h4><p># Check that DeviceC and DeviceD can trace the time of DeviceA and DeviceB. The configuration on DeviceC is used as an example. Run the <strong>display ptp all</strong> command to check the PTP status of DeviceC.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceC] <strong>display ptp all</strong></pre>
<pre class="screen">  Device config info                                                            
  ------------------------------------------------------------------------------
  PTP state         :<strong>enabled</strong>            Domain  value      :0                 
  Slave only        :no                   Device type        :<strong>BC</strong>                
  Set port state    :no                   Local clock ID     :00259e1000000001  
  Acl               :no                   Virtual clock ID   :no               
  Acr               :no                   Time lock success  :<strong>yes</strong>               
  Asymmetry measure :disable              Passive measure    :disable           
                                                                                
  BMC run info                                                                  
  ------------------------------------------------------------------------------
  Grand clock ID    :00259e1000000002                                           
  Receive number    :<strong><span>100GE</span></strong><strong><span>1/0/2</span></strong>                                                  
  Parent clock ID   :00259e1000000002<strong></strong>                                           
  Parent portnumber :4126                                                       
  Priority1         :110                 Priority2           :110               
  Step removed      :1                   Clock accuracy      :0x31              
  Clock class       :6                   Time Source         :0xa0              
  UTC Offset        :35                  UTC Offset Valid    :False             
  Timescale         :ARB                 Time traceable      :False             
  Leap              :None                Frequency traceable :False             
  Offset scaled     :0xffff                                                     
                                                                                
  Port info                                                                     
  Name                        State        Delay-mech Ann-timeout Type   Domain 
  ------------------------------------------------------------------------------
  <span>100GE</span><span>1/0/1</span>                   master       <strong>delay</strong>      4           <strong>BC</strong>     0      
  <span>100GE</span><span>1/0/2</span>                   slave        <strong>delay</strong>      4           <strong>BC</strong>     0      
                                                                                  
  Time Performance Statistics(ns): Slot 1  Card 0  Port 1                       
  ------------------------------------------------------------------------------
  Realtime(T2-T1)   :140                     Pathdelay     :0                   
  Max(T2-T1)        :3510286792100                                              
  Min(T2-T1)        :-5715158684                                                
                                                                                
  Clock source info                                                             
  Clock       Pri1 Pri2 Accuracy Class TimeSrc Signal Switch Direction In-Status
  ------------------------------------------------------------------------------
  local       128  128  0x31     187   0xa0    -      -      -         -        </pre>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001563878917__1.3.5"></a><a name="1.3.5"></a>
<div class="p"><h4 class="sectiontitle">Configuration Scripts</h4><ul><li><p>DeviceA</p>
<pre class="screen">#
sysname DeviceA
#
clock source ptp synchronization enable
<span>clock</span> source ptp <span>priority 1</span>
ptp enable
ptp device-type bc
#
interface <span>100GE</span><span>1/0/1</span>
 ptp enable
#
interface <span>100GE</span><span>1/0/2</span>
 ptp enable
#<span>
interface <span>100GE</span><span>1/0/3</span>
 ptp enable 
#</span>
return
</pre>
</li><li><p>DeviceB</p>
<pre class="screen">#
sysname DeviceB
#
clock source ptp synchronization enable
<span>clock</span> source ptp <span>priority 1</span>
ptp enable
ptp device-type bc
#
interface <span>100GE</span><span>1/0/1</span>
 ptp enable
#
interface <span>100GE</span><span>1/0/2</span>
 ptp enable
#<span>
interface <span><span>100GE</span><span>1/0/3</span></span></span>
<span> ptp enable 
#</span>
return</pre>
</li><li><p>DeviceC</p>
<pre class="screen">#
sysname DeviceC
#
clock source ptp synchronization enable
<span>clock</span> source ptp <span>priority 1</span>
ptp enable
ptp device-type bc
#
interface <span>100GE</span><span>1/0/1</span>
 ptp enable
#
interface <span>100GE</span><span>1/0/2</span>
 ptp enable
#
return </pre>
</li><li><p>DeviceD</p>
<pre class="screen">#
sysname DeviceD
#
clock source ptp synchronization enable
<span>clock</span> source ptp <span>priority 1</span>
ptp enable
ptp device-type bc
#
interface <span>100GE</span><span>1/0/1</span>
 ptp enable
#
interface <span>100GE</span><span>1/0/2</span>
 ptp enable
#
return  </pre>
</li></ul>
</div></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="galaxy_1588v2_cfg_0001.html">1588v2 (PTP) Configuration
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="galaxy_1588v2_cfg_0023.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="galaxy_1588v2_cfg_0019.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>