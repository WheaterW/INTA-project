
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring a BGP Peer">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="vrp_bgp_cfg_0014.html">
<meta name="DC.Relation" scheme="URI" content="vrp_bgp_cfg_0015.html">
<meta name="DC.Relation" scheme="URI" content="vrp_bgp_cfg_0017.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing">
<meta name="featuretype" content="IP Routing">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001130624102">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>Configuring a BGP Peer</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001130624102"></a><a name="EN-US_TASK_0000001130624102"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring a BGP Peer</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001130624102__1.3.1"></a><a name="1.3.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>As BGP peer relationships are established over TCP connections, you need to specify the IP addresses of peers when configuring them. A BGP peer may not be a neighboring device, and BGP peer relationships can be established through logical links. To enhance the stability of BGP connections, using loopback interface addresses to establish connections is recommended.</p>
<p>Establish IBGP peer relationships between devices in the same AS and EBGP peer relationships between devices in different ASs.</p>
<div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>EBGP peers do not support the following features:</p>
<ul><li>RR</li><li>RPKI</li><li>Best-External</li><li>Add-Path</li></ul>
<p>IBGP peers do not support the following features:</p>
<ul><li>ebgp-max-hop</li><li>local-as</li></ul>
<p>The <strong>ebgp-max-hop</strong> and <strong>valid-ttl-hops</strong> functions are mutually exclusive.</p>
</div></div>
</div></div>
<div class="steps-unordered"><a name="EN-US_TASK_0000001130624102__1.3.2"></a><a name="1.3.2"></a><h4 class="sectiontitle">Procedure</h4>
<ul><li><span>Configure an IBGP peer.</span><ol><li class="substepexpand"><span>Enter the system view.</span><p><pre class="screen"><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></pre>
</p></li><li class="substepexpand"><span>Enter the BGP view.</span><p><pre class="screen"><a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></pre>
</p></li><li class="substepexpand"><span>Specify the IP address of a peer and the number of the AS where the peer resides.</span><p><pre class="screen"><a href="cmdqueryname=peer+as-number"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">ipv6-address</span></i> | <i><span class="varname">group-name</span></i> } <a href="cmdqueryname=as-number"><b><span class="cmdname">as-number</span></b></a> <i><span class="varname">as-number</span></i></pre>
<p>The number of the AS where the specified peer resides must be the same as that of the local AS.</p>
<p>The IP address of the peer can be one of the following types:</p>
<ul><li><p>IP address of an interface on a directly connected peer</p>
</li><li><p>IP address of a sub-interface on a directly connected peer</p>
</li><li><p>IP address of a routable loopback interface on the peer</p>
</li></ul>
</p></li><li class="substepexpand"><span>(Optional) Specify the source interface and source IP address for TCP connection establishment between BGP peers.</span><p><pre class="screen"><a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <a href="cmdqueryname=connect-interface"><b><span class="cmdname">connect-interface</span></b></a> { <i><span class="varname">interface-name</span></i> | <i><span class="varname">ipv4-source-address</span></i> | <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i> | <i><span class="varname">interface-name</span></i> <i><span class="varname">ipv4-source-address</span></i> | <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i> <i><span class="varname">ipv4-source-address</span></i> }
or
<a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">group-name</span></i> <a href="cmdqueryname=connect-interface"><b><span class="cmdname">connect-interface</span></b></a> { <i><span class="varname">interface-name</span></i> | <i><span class="varname">ipv4-source-addr</span></i> | <i><span class="varname">ipv6-source-addr</span></i>| <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i> | <i><span class="varname">interface-name</span></i> <i><span class="varname">ipv4-source-addr</span></i>| <i><span class="varname">interface-name</span></i> <i><span class="varname">ipv6-source-addr</span></i> | <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i> <i><span class="varname">ipv4-source-addr</span></i> | <i><span class="varname">interface-type interface-number ipv6-source-addr</span></i> }</pre>
<p>By default, BGP uses the physical interface directly connected to a peer as the local interface of a TCP connection.</p>
<div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>If the IP address of a loopback interface<span> or a sub-interface</span> is used to establish a BGP connection, you are advised to run the <a href="cmdqueryname=peer+connect-interface"><b><span class="cmdname">peer connect-interface</span></b></a> command at both ends of the connection to ensure that the connection is correctly established. If this command is run on only one end, the BGP connection may fail to be established.</p>
</div></div>
</p></li><li class="substepexpand"><span>(Optional) Set the TCP MSS value used when the local device establishes a TCP connection with the peer.</span><p><pre class="screen"><a href="cmdqueryname=peer+tcp-mss"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">ipv6-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>tcp-mss</span></strong> <i><span class="varname">tcp-mss-number</span></i></pre>
<p>This configuration ensures that TCP packets can still be fragmented properly based on the specified TCP MSS in cases where the path MTU is unavailable, thereby improving network performance.</p>
</p></li><li class="substepexpand"><span>Commit the configuration.</span><p><pre class="screen" id="EN-US_TASK_0000001130624102__en-us_task_0234857734_screen14848162118611"><a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001130624102__en-us_task_0234857734_cmdname1784862115612">commit</span></b></a></pre>
</p></li></ol>
</li><li><span>Configure an EBGP peer.</span><ol><li class="substepexpand"><span>Enter the system view.</span><p><pre class="screen"><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></pre>
</p></li><li class="substepexpand"><span>Enter the BGP view.</span><p><pre class="screen"><a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></pre>
</p></li><li class="substepexpand"><span>(Optional) Allow EBGP connections to be established between peers with the same router ID.</span><p><pre class="screen"><a href="cmdqueryname=router-id+allow-same+enable"><b><span class="cmdname">router-id allow-same enable</span></b></a></pre>
</p></li><li class="substepexpand"><span>Specify the IP address of a peer and the number of the AS where the peer resides.</span><p><pre class="screen"><a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <a href="cmdqueryname=as-number"><b><span class="cmdname">as-number</span></b></a> <i><span class="varname">as-number</span></i></pre>
<p>The number of the AS where the specified peer resides must be different from that of the local AS.</p>
<p>The IP address of the peer can be one of the following types:</p>
<ul><li><p>IP address of an interface on a directly connected peer</p>
</li><li><p>IP address of a sub-interface on a directly connected peer</p>
</li><li><p>IP address of a routable loopback interface on the peer</p>
</li></ul>
</p></li><li class="substepexpand"><span>(Optional) Specify the source interface and source IP address for TCP connection establishment between BGP peers.</span><p><pre class="screen"><a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <a href="cmdqueryname=connect-interface"><b><span class="cmdname">connect-interface</span></b></a> { <i><span class="varname">interface-name</span></i> | <i><span class="varname">ipv4-source-address</span></i> | <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i> | <i><span class="varname">interface-name</span></i> <i><span class="varname">ipv4-source-address</span></i> | <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i> <i><span class="varname">ipv4-source-address</span></i> }
or
<a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a>  <i><span class="varname">group-name</span></i> <a href="cmdqueryname=connect-interface"><b><span class="cmdname">connect-interface</span></b></a> { <i><span class="varname">interface-name</span></i> | <i><span class="varname">ipv4-source-address</span></i> | <i><span class="varname">ipv6-source-address</span></i>| <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i> | <i><span class="varname">interface-name</span></i> <i><span class="varname">ipv4-source-address</span></i>| <i><span class="varname">interface-name</span></i> <i><span class="varname">ipv6-source-address</span></i> | <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i> <i><span class="varname">ipv4-source-address | interface-type interface-number ipv6-source-address</span></i> }</pre>
<p>By default, BGP uses the physical interface directly connected to a peer as the local interface of a TCP connection.</p>
<div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>If the IP address of a loopback interface<span> or a sub-interface</span> is used to establish a BGP connection, you are advised to run the <a href="cmdqueryname=peer+connect-interface"><b><span class="cmdname">peer connect-interface</span></b></a> command at both ends of the connection to ensure that the connection is correctly established. If this command is run on only one end, the BGP connection may fail to be established.</p>
</div></div>
</p></li><li class="substepexpand"><span>(Optional) Set the maximum number of hops allowed over an EBGP connection.</span><p><pre class="screen"><a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <a href="cmdqueryname=ebgp-max-hop"><b><span class="cmdname">ebgp-max-hop</span></b></a> [ <i><span class="varname">hop-count</span></i> ]</pre>
<p>The default value of <i><span class="varname">hop-count</span></i> is 255.</p>
<p>In most cases, a directly connected physical link must be available between EBGP peers. If you want to establish an EBGP peer relationship between indirectly connected peers, run the <a href="cmdqueryname=peer+ebgp-max-hop"><b><span class="cmdname">peer ebgp-max-hop</span></b></a> command to set the maximum number of hops allowed over the EBGP connection.</p>
<div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>If loopback interfaces are used to establish an EBGP connection, run the <a href="cmdqueryname=peer+ebgp-max-hop"><b><span class="cmdname">peer ebgp-max-hop</span></b></a> command, where the value of <i><span class="varname">hop-count</span></i> must be greater than or equal to 2. Otherwise, the EBGP peer relationship cannot be established.</p>
</div></div>
</p></li><li class="substepexpand"><span>(Optional) Configure a description for the specified peer.</span><p><pre class="screen"><a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <a href="cmdqueryname=description"><b><span class="cmdname">description</span></b></a> <i><span class="varname">description-text</span></i></pre>
<p>To simplify network management, you can configure a description for a specified peer.</p>
</p></li><li class="substepexpand"><span>(Optional) Set the TCP MSS value used when the local device establishes a TCP connection with the peer.</span><p><pre class="screen"><a href="cmdqueryname=peer+tcp-mss"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>tcp-mss</span></strong> <i><span class="varname">tcp-mss-number</span></i></pre>
<p>This configuration ensures that TCP packets can still be fragmented properly based on the specified TCP MSS in cases where the path MTU is unavailable, thereby improving network performance.</p>
</p></li><li class="substepexpand"><span>Enter the IPv4 unicast address family view.</span><p><pre class="screen"><a href="cmdqueryname=ipv4-family+unicast"><b><span class="cmdname">ipv4-family</span></b></a> <strong><span>unicast</span></strong></pre>
</p></li><li class="substepexpand"><span>(Optional) Disable the device from advertising routes learned from an EBGP peer to the peers in the same AS with the EBGP peer.</span><p><pre class="screen"><a href="cmdqueryname=peer+peer-as-check"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">peerIpv4Addr</span></i> | <i><span class="varname">peerGroupName</span></i> } <strong><span>peer-as-check</span></strong></pre>
<p>By default, after receiving a route from an EBGP peer (for example, in AS 200), the local device (for example, in AS 100) advertises the route to other EBGP peers in AS 200. After the <a href="cmdqueryname=peer+peer-as-check"><b><span class="cmdname">peer peer-as-check</span></b></a> command is run on the device, the device does not advertise the routes received from an EBGP peer to other EBGP peers in the same AS with this EBGP peer. This reduces BGP memory and CPU consumption and speeds up route convergence in case of route flapping.</p>
</p></li><li class="substepexpand"><span>Commit the configuration.</span><p><pre class="screen" id="EN-US_TASK_0000001130624102__en-us_task_0234857734_screen14848162118611_1"><a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001130624102__en-us_task_0234857734_cmdname1784862115612_1">commit</span></b></a></pre>
</p></li></ol>
</li></ul></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="vrp_bgp_cfg_0014.html">Configuring Basic BGP Functions
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="vrp_bgp_cfg_0015.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="vrp_bgp_cfg_0017.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>