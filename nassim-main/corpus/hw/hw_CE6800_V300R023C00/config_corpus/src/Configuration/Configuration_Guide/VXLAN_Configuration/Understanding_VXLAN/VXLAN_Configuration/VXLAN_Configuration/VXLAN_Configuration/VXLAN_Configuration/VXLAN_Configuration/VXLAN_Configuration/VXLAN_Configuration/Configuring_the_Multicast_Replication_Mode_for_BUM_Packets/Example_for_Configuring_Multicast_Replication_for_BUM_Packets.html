
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Multicast Replication for BUM Packets">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../vrp/dc_vrp_vxlan_cfg_1200.html">
<meta name="DC.Relation" scheme="URI" content="../vrp/dc_vrp_vxlan_cfg_1200-3.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="VXLAN">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="VXLAN">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="VXLAN">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="VXLAN">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001214973548">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="../public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring Multicast Replication for BUM Packets</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001214973548"></a><a name="EN-US_TASK_0000001214973548"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Multicast Replication for BUM Packets</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001214973548__1.3.1"></a><a name="1.3.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0000001214973548__fig_dc_cfg_vxlan_cfgcase_001501">Figure 1</a>, an enterprise has VMs deployed in multiple data centers. The servers where the VMs reside all belong to VLAN 10, and VXLAN tunnels need to be deployed to enable these VMs to communicate with each other. Device1 and Device3 function as Layer 2 VXLAN gateways, Device2 functions as a Layer 3 VXLAN gateway, and Device4 is a non-gateway node on the VXLAN network. When the VMs communicate with each other, Layer 2 gateways are used to forward traffic. When the VMs need to access an external network, the Layer 3 gateway is used to forward traffic.</p>
<p>To reduce traffic flooding caused by BUM packet forwarding, configure multicast replication. Device 4 can function as a static multicast RP.</p>
<div class="fignone" id="EN-US_TASK_0000001214973548__fig_dc_cfg_vxlan_cfgcase_001501"><a name="EN-US_TASK_0000001214973548__fig_dc_cfg_vxlan_cfgcase_001501"></a><a name="fig_dc_cfg_vxlan_cfgcase_001501"></a><span class="figcap"><b>Figure 1 </b>Configuring multicast replication for BUM packets on a VXLAN network</span><div class="note"><img src="../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interfaces 1 to 3 represent <span>100GE</span><span>1/0/1</span>, <span>100GE</span><span>1/0/2</span>, and <span>100GE</span><span>1/0/3</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0000001215454980.png" width="NaN" height="NaN"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001214973548__1.3.2"></a><a name="1.3.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><div class="p">The configuration roadmap is as follows:<ol><li><p>Configure a routing protocol on the involved devices to ensure Layer 3 connectivity.</p>
</li><li><p>Configure service access points on Device1 and Device3 to differentiate service traffic.</p>
</li><li><p>Configure VXLAN tunnels on Device1, Device2, and Device3.</p>
</li><li><p>Configure Device2 as a Layer 3 VXLAN gateway to allow the VMs to access the external network.</p>
</li><li><p>Configure PIM-SM on the involved devices and configure Device4 as a static RP.</p>
</li><li><p>Enable multicast replication on Device1, Device2, and Device3.</p>
</li></ol>
</div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001214973548__1.3.3"></a><a name="1.3.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure interface IP addresses on devices.</span><p><p>Configure IP addresses for interfaces on the involved devices according to <a href="#EN-US_TASK_0000001214973548__fig_dc_cfg_vxlan_cfgcase_001501">Figure 1</a>.</p>
</p></li><li><span>Configure BGP EVPN to establish VXLAN tunnels.</span><p><p>For details about the configuration method, see <a href="../dc/dc_cfg_vxlan_cfgcase_0002.html">Example for Establishing VXLAN Tunnels in BGP EVPN Mode (Centralized VXLAN Gateway)</a>. For detailed configurations, see Configuration Scripts.</p>
</p></li><li><span>Configure PIM-SM on the involved devices and configure Device4 as a static RP.</span><p><div class="p"># Configure Device1.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Device1] <strong>multicast routing-enable</strong>
[<span><span class="keyword">*</span></span>Device1] <strong>pim</strong>
[<span><span class="keyword">*</span></span>Device1-pim] <strong>static-rp 4.4.4.4</strong>
[<span><span class="keyword">*</span></span>Device1-pim] <strong>quit</strong>
[<span><span class="keyword">*</span></span>Device1]<strong> interface <span>100ge</span> <span>1/0/1</span></strong>
[<span><span class="keyword">*</span></span>Device1-<span>100GE</span><span>1/0/1</span>]<strong> pim sm</strong>
[<span><span class="keyword">*</span></span>Device1-<span>100GE</span><span>1/0/1</span>]<strong> quit</strong>
[<span><span class="keyword">*</span></span>Device1] <strong>commit</strong></pre>
</div>
<div class="p"># Configure Device2.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Device2] <strong>multicast routing-enable</strong>
[<span><span class="keyword">*</span></span>Device2] <strong>pim</strong>
[<span><span class="keyword">*</span></span>Device2-pim] <strong>static-rp 4.4.4.4</strong>
[<span><span class="keyword">*</span></span>Device2-pim] <strong>quit</strong>
[<span><span class="keyword">*</span></span>Device2]<strong> interface <span>100ge</span> <span>1/0/1</span></strong>
[<span><span class="keyword">*</span></span>Device2-<span>100GE</span><span>1/0/1</span>]<strong> pim sm</strong>
[<span><span class="keyword">*</span></span>Device2-<span>100GE</span><span>1/0/1</span>]<strong> quit</strong>
[<span><span class="keyword">*</span></span>Device2] <strong>commit</strong></pre>
</div>
<div class="p"># Configure Device3.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Device3] <strong>multicast routing-enable</strong>
[<span><span class="keyword">*</span></span>Device3] <strong>pim</strong>
[<span><span class="keyword">*</span></span>Device3-pim] <strong>static-rp 4.4.4.4</strong>
[<span><span class="keyword">*</span></span>Device3-pim] <strong>quit</strong>
[<span><span class="keyword">*</span></span>Device3]<strong> interface <span>100ge</span> <span>1/0/1</span></strong>
[<span><span class="keyword">*</span></span>Device3-<span>100GE</span><span>1/0/1</span>]<strong> pim sm</strong>
[<span><span class="keyword">*</span></span>Device3-<span>100GE</span><span>1/0/1</span>]<strong> quit</strong>
[<span><span class="keyword">*</span></span>Device3] <strong>commit</strong></pre>
</div>
<div class="p"># Configure Device4.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Device4] <strong>multicast routing-enable</strong>
[<span><span class="keyword">*</span></span>Device4] <strong>pim</strong>
[<span><span class="keyword">*</span></span>Device4-pim] <strong>static-rp 4.4.4.4</strong>
[<span><span class="keyword">*</span></span>Device4-pim] <strong>quit</strong>
[<span><span class="keyword">*</span></span>Device4]<strong> interface <span>100ge</span> <span>1/0/1</span></strong>
[<span><span class="keyword">*</span></span>Device4-<span>100GE</span><span>1/0/1</span>]<strong> pim sm</strong>
[<span><span class="keyword">*</span></span>Device4-<span>100GE</span><span>1/0/1</span>]<strong> quit</strong>
[<span><span class="keyword">*</span></span>Device4]<strong> interface <span>100ge</span> <span>1/0/2</span></strong>
[<span><span class="keyword">*</span></span>Device4-<span>100GE</span><span>1/0/2</span>]<strong> pim sm</strong>
[<span><span class="keyword">*</span></span>Device4-<span>100GE</span><span>1/0/2</span>]<strong> quit</strong>
[<span><span class="keyword">*</span></span>Device4]<strong> interface <span>100ge</span> <span>1/0/3</span></strong>
[<span><span class="keyword">*</span></span>Device4-<span>100GE</span><span>1/0/3</span>]<strong> pim sm</strong>
[<span><span class="keyword">*</span></span>Device4-<span>100GE</span><span>1/0/3</span>]<strong> quit</strong>
[<span><span class="keyword">*</span></span>Device4] <strong>commit</strong></pre>
</div>
</p></li><li><span>Enable multicast replication on Device1, Device2, and Device3.</span><p><div class="p"># Configure Device1.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Device1] <strong>interface nve 1</strong>
[<span><span class="keyword">*</span></span>Device1-Nve1] <strong>vni 100 mcast-group 225.0.0.1</strong>
[<span><span class="keyword">*</span></span>Device1-Nve1] <strong>quit</strong>
[<span><span class="keyword">*</span></span>Device1] <strong>commit</strong></pre>
</div>
<div class="p"># Configure Device2.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Device2] <strong>interface nve 1</strong>
[<span><span class="keyword">*</span></span>Device2-Nve1] <strong>vni 100 mcast-group 225.0.0.1</strong>
[<span><span class="keyword">*</span></span>Device2-Nve1] <strong>quit</strong>
[<span><span class="keyword">*</span></span>Device2] <strong>commit</strong></pre>
</div>
<div class="p"># Configure Device3.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Device3] <strong>interface nve 1</strong>
[<span><span class="keyword">*</span></span>Device3-Nve1] <strong>vni 100 mcast-group 225.0.0.1</strong>
[<span><span class="keyword">*</span></span>Device3-Nve1] <strong>quit</strong>
[<span><span class="keyword">*</span></span>Device3] <strong>commit</strong></pre>
</div>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001214973548__1.3.4"></a><a name="1.3.4"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p>After completing the configurations, run the <a href="cmdqueryname=display+vxlan+tunnel"><b><span class="cmdname">display vxlan tunnel</span></b></a> command on Device1, Device2, and Device3 to check VXLAN tunnel information, including the VXLAN tunnel whose destination address is a multicast replication address. The command output shows that the status of all VXLAN tunnels is up. The following example uses the command output on Device1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Device1] <strong>display vxlan tunnel</strong></pre>
<pre class="screen">Number of vxlan tunnel : 3
Tunnel ID   Source                Destination           State  Type     Uptime
-----------------------------------------------------------------------------------
4026531845  1.1.1.1               2.2.2.2               up     dynamic  00:10:17
4026531846  1.1.1.1               3.3.3.3               up     dynamic  00:10:13
4026531847  1.1.1.1               225.0.0.1             up     static   00:07:56</pre>
<p>After completing the configurations, run the <a href="cmdqueryname=display+vxlan+vni+100+verbose"><b><span class="cmdname">display vxlan vni 100 verbose</span></b></a> command on Device1, Device2, and Device3 to check the detailed configuration of the VXLAN whose VNI is 100. The command output shows that the BUM mode is multicast replication. The following example uses the command output on Device1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Device1] <strong>display vxlan vni 100 verbose</strong></pre>
<pre class="screen">    BD ID                  : 10
    State                  : up
    NVE                    : 64
    Source Address         : 1.1.1.1
    Source IPv6 Address    : -
    UDP Port               : 4789
    BUM Mode               : multicast replication
    Group Address          : 225.0.0.1</pre>
</div>
<div class="postreq"><a name="EN-US_TASK_0000001214973548__1.3.5"></a><a name="1.3.5"></a><h4 class="sectiontitle">Configuration Scripts</h4><ul><li><p>Device1</p>
<pre class="screen">#
sysname Device1
#
evpn-overlay enable
#
multicast routing-enable
#
bridge-domain 10
 vxlan vni 100
 #
 evpn 
  route-distinguisher 10:1
  vpn-target 100:100 export-extcommunity
  vpn-target 100:100 import-extcommunity
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 10.1.1.1 255.255.255.0
 pim sm
#
interface <span>100GE</span><span>1/0/2</span>.1 mode l2
 encapsulation dot1q vid 10
 bridge-domain 10
#
interface LoopBack1
 ip address 1.1.1.1 255.255.255.255
#
interface Nve1
 source 1.1.1.1 
 vni 100 mcast-group 225.0.0.1
 vni 100 head-end peer-list protocol bgp
#
bgp 100
 private-4-byte-as enable
 peer 2.2.2.2 as-number 100
 peer 2.2.2.2 connect-interface LoopBack1
 peer 3.3.3.3 as-number 100
 peer 3.3.3.3 connect-interface LoopBack1
 #
 ipv4-family unicast
  peer 2.2.2.2 enable
  peer 3.3.3.3 enable
 #
 l2vpn-family evpn
  policy vpn-target
  peer 2.2.2.2 enable
  peer 3.3.3.3 enable
#
ospf 1          
 area 0.0.0.0   
  network 1.1.1.1 0.0.0.0
  network 10.1.1.0 0.0.0.255
#               
pim             
 static-rp 4.4.4.4
#
return</pre>
</li><li><p>Device2</p>
<pre class="screen">#
sysname Device2
#
evpn-overlay enable
#
multicast routing-enable
#
bridge-domain 10
 vxlan vni 100
 #
 evpn 
  route-distinguisher 10:2
  vpn-target 100:100 export-extcommunity
  vpn-target 100:100 import-extcommunity
#
interface Vbdif10
 ip address 192.168.10.1 255.255.255.0
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 10.1.2.1 255.255.255.0
 pim sm
#
interface LoopBack1
 ip address 2.2.2.2 255.255.255.255
#
interface Nve1
 source 2.2.2.2
 vni 100 mcast-group 225.0.0.1 
 vni 100 head-end peer-list protocol bgp
#
bgp 100
 private-4-byte-as enable
 peer 1.1.1.1 as-number 100
 peer 1.1.1.1 connect-interface LoopBack1
 peer 3.3.3.3 as-number 100
 peer 3.3.3.3 connect-interface LoopBack1
 #
 ipv4-family unicast
  peer 1.1.1.1 enable
  peer 3.3.3.3 enable
 #
 l2vpn-family evpn
  policy vpn-target
  peer 1.1.1.1 enable
  peer 3.3.3.3 enable
#
ospf 1          
 area 0.0.0.0   
  network 2.2.2.2 0.0.0.0
  network 10.1.2.0 0.0.0.255
#               
pim             
 static-rp 4.4.4.4
#
return</pre>
</li><li><p>Device3</p>
<pre class="screen">#
sysname Device3
#
evpn-overlay enable
#
multicast routing-enable
#
bridge-domain 10
 vxlan vni 100
 #
 evpn 
  route-distinguisher 10:3
  vpn-target 100:100 export-extcommunity
  vpn-target 100:100 import-extcommunity
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 10.1.3.1 255.255.255.0
 pim sm
#
interface <span>100GE</span><span>1/0/2</span>.1 mode l2
 encapsulation dot1q vid 10
 bridge-domain 10
#
interface LoopBack1
 ip address 3.3.3.3 255.255.255.255
#
interface Nve1
 source 3.3.3.3 
 vni 100 mcast-group 225.0.0.1
 vni 100 head-end peer-list protocol bgp
#               
bgp 100
 private-4-byte-as enable
 peer 1.1.1.1 as-number 100
 peer 1.1.1.1 connect-interface LoopBack1
 peer 2.2.2.2 as-number 100
 peer 2.2.2.2 connect-interface LoopBack1
 #
 ipv4-family unicast
  peer 1.1.1.1 enable
  peer 2.2.2.2 enable
 #
 l2vpn-family evpn
  policy vpn-target
  peer 1.1.1.1 enable
  peer 2.2.2.2 enable
# 
ospf 1          
 area 0.0.0.0   
  network 3.3.3.3 0.0.0.0
  network 10.1.3.0 0.0.0.255
#               
pim             
 static-rp 4.4.4.4
#
return</pre>
</li><li>Device4<pre class="screen">#
sysname Device4
#
multicast routing-enable
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 10.1.1.2 255.255.255.0
 pim sm
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ip address 10.1.2.2 255.255.255.0
 pim sm
#
interface <span>100GE</span><span>1/0/3</span>
 undo portswitch
 ip address 10.1.3.2 255.255.255.0
 pim sm
#
interface LoopBack1
 ip address 4.4.4.4 255.255.255.255
#
ospf 1          
 area 0.0.0.0   
  network 4.4.4.4 0.0.0.0
  network 10.1.1.0 0.0.0.255
  network 10.1.2.0 0.0.0.255
  network 10.1.3.0 0.0.0.255
#               
pim             
 static-rp 4.4.4.4
#
return</pre>
</li></ul>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../vrp/dc_vrp_vxlan_cfg_1200.html">Configuring the Multicast Replication Mode for BUM Packets
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../vrp/dc_vrp_vxlan_cfg_1200-3.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>
</body>
</html>