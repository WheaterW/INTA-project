
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring Flapping Suppression Involved in EVPN Next-Hop Recursion">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../toctopics/en-us_topic_0000001130784304.html">
<meta name="DC.Relation" scheme="URI" content="../vrp/dc_vrp_vxlan_cfg_1230.html">
<meta name="DC.Relation" scheme="URI" content="../vrp/dc_vrp_vxlan_cfg_1250.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="VXLAN">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="VXLAN">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="VXLAN">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001176664065">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="../public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="../public_sys-resources/browseVersion.js"></script>
<title>Configuring Flapping Suppression Involved in EVPN Next-Hop Recursion</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001176664065"></a><a name="EN-US_TASK_0000001176664065"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring Flapping Suppression Involved in EVPN Next-Hop Recursion</h1>
<div class="taskbody"><div class="prereq" style="margin-left:0"><a name="EN-US_TASK_0000001176664065__1.3.1"></a><a name="1.3.1"></a><h4 class="sectiontitle">Prerequisites</h4>
<div class="p"><p>Before configuring flapping suppression involved in EVPN next-hop recursion, complete either of the following tasks:</p>
<ul><li><a href="../dc/dc_vrp_vxlan_cfg_1072.html">Establishing VXLAN Tunnels in BGP EVPN Mode (Centralized VXLAN Gateway)</a></li><li><a href="../dc/dc_vrp_vxlan_cfg_1066.html">Establishing VXLAN Tunnels in BGP EVPN Mode (Distributed VXLAN Gateway)</a></li></ul>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001176664065__1.3.2"></a><a name="1.3.2"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>If a large number of EVPN routes recurse to the same next hop that flaps frequently, the system's workload increases as it needs to process changes of these routes, consuming excessive system resources and leading to high CPU usage. To address this issue, configure flapping suppression involved in EVPN next-hop recursion.</p>
<p>Flapping suppression involved in EVPN next-hop recursion is enabled by default. After flapping suppression involved in EVPN next-hop recursion is enabled, an EVPN device determines whether to increase, retain, or reduce the penalty value by comparing the flapping interval with the configured threshold. When the penalty value exceeds 10, the EVPN device suppresses route recursion flapping. For example, if the intervals for increasing, retaining, and clearing the penalty value are T1, T2, and T3, respectively, the device calculates the penalty value as follows:</p>
<ul><li>Increases the penalty value by 1 if the flapping interval is less than T1.</li><li>Retains the penalty value if the flapping interval is greater than or equal to T1, but less than T2.</li><li>Reduces the penalty value by 1 if the flapping interval is greater than or equal to T2, but less than T3.</li><li>Clears the penalty value if the flapping interval is greater than or equal to T3.</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001176664065__1.3.3"></a><a name="1.3.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Enter the system view.</span><p><pre class="screen"><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></pre>
</p></li><li><span>Enter the BGP view.</span><p><pre class="screen"><a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i><span> </span></pre>
</p></li><li><span>Set the intervals for increasing, retaining, and clearing the penalty value for suppressing next-hop recursion flapping.</span><p><pre class="screen"><a href="cmdqueryname=nexthop+recursive-lookup+restrain"><b><span class="cmdname">nexthop recursive-lookup restrain</span></b></a> <strong><span>suppress-interval</span></strong> <i><span class="varname">add-count-time</span></i> <strong><span>hold-interval</span></strong> <i><span class="varname">hold-count-time</span></i> <strong><span>clear-interval</span></strong> <i><span class="varname">clear-count-time</span></i></pre>
<p>By default, the intervals for increasing, retaining, and clearing the penalty value for suppressing next-hop recursion flapping are 60s, 120s, and 600s, respectively. </p>
</p></li><li><span>(Optional) Enter the BGP-EVPN address family view.</span><p><pre class="screen"><a href="cmdqueryname=l2vpn-family+evpn"><b><span class="cmdname">l2vpn-family evpn</span></b></a></pre>
</p></li><li><span>(Optional) Disable flapping suppression involved in EVPN next-hop recursion.</span><p><pre class="screen"><a href="cmdqueryname=nexthop+recursive-lookup+restrain+disable"><b><span class="cmdname">nexthop recursive-lookup restrain disable</span></b></a></pre>
<p>If high CPU usage due to route recursion change processing is not a concern and you do not want to slow down route recursion processing, you can disable flapping suppression involved in EVPN next-hop recursion. After this step is performed, flapping suppression involved in next-hop recursion does not take effect for public routes in the BGP-EVPN address family.</p>
</p></li><li><span>(Optional) Return to the BGP view.</span><p><pre class="screen"><a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></pre>
</p></li><li><span>(Optional) Return to the system view.</span><p><pre class="screen"><a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></pre>
</p></li><li><span>(Optional) Enter the BD view.</span><p><pre class="screen"><a href="cmdqueryname=bridge-domain"><b><span class="cmdname">bridge-domain</span></b></a> <i><span class="varname">bd-id</span></i></pre>
</p></li><li><span>(Optional) Enter the BD EVPN instance view.</span><p><pre class="screen"><a href="cmdqueryname=evpn"><b><span class="cmdname">evpn</span></b></a></pre>
</p></li><li><span>(Optional) Disable flapping suppression involved in EVPN next-hop recursion.</span><p><pre class="screen"><a href="cmdqueryname=nexthop+recursive-lookup+restrain+disable"><b><span class="cmdname">nexthop recursive-lookup restrain disable</span></b></a></pre>
<p>If high CPU usage due to route recursion change processing is not a concern and you do not want to slow down route recursion processing, you can disable flapping suppression involved in EVPN next-hop recursion. After this step is performed, flapping suppression involved in EVPN next-hop recursion does not take effect for the current BD EVPN instance route.</p>
</p></li><li><span>Commit the configuration.</span><p><pre class="screen" id="EN-US_TASK_0000001176664065__en-us_task_0234857734_screen163801330213"><a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001176664065__en-us_task_0234857734_en-us_concept_0141113565_cmdname1667501373175340">commit</span></b></a></pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001176664065__1.3.4"></a><a name="1.3.4"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p>Run the <a href="cmdqueryname=display+bgp"><b><span class="cmdname">display bgp</span></b></a> <strong><span>evpn</span></strong> <strong><span>all</span></strong> <strong><span>routing-table</span></strong> command to check EVPN route information.</p>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../toctopics/en-us_topic_0000001130784304.html">VXLAN Configuration
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../vrp/dc_vrp_vxlan_cfg_1230.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../vrp/dc_vrp_vxlan_cfg_1250.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>