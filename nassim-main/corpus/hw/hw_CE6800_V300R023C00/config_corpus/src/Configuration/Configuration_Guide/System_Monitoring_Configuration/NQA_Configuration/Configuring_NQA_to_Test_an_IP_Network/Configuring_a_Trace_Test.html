
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring a Trace Test">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../vrp/vrp_nqa_cfg_0009.html">
<meta name="DC.Relation" scheme="URI" content="../vrp/vrp_nqa_cfg_0010.html">
<meta name="DC.Relation" scheme="URI" content="../vrp/vrp_nqa_cfg_0012.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="NQA">
<meta name="featuretype" content="System Monitoring">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="NQA">
<meta name="featuretype" content="System Monitoring">
<meta name="featurename" content="NQA">
<meta name="featuretype" content="System Monitoring">
<meta name="featurename" content="NQA">
<meta name="featuretype" content="System Monitoring">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001130622300">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="../public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="../public_sys-resources/browseVersion.js"></script>
<title>Configuring a Trace Test</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001130622300"></a><a name="EN-US_TASK_0000001130622300"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring a Trace Test</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001130622300__1.3.1"></a><a name="1.3.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>A trace test monitors the forwarding path between a source and a destination and collects statistics such as delay about each hop on the forwarding path. The trace test functions similarly to the <strong>tracert</strong> command, but it provides more output information, including the average delay, packet loss rate, and time when the last packet is received for each hop. <a href="#EN-US_TASK_0000001130622300__fig_dc_vrp_network-monitor_feature_001801">Figure 1</a> shows a network on which a trace test is performed. The trace test process is as follows:</p>
<ol><li><p>DeviceA (source) sends a UDP packet with the time to live (TTL) value of 1 to DeviceB (destination).</p>
</li><li><p>DeviceC (first hop) receives the packet, discards the packet according to the TTL value, and sends an ICMP Time Exceeded message to DeviceA.</p>
</li><li><p>DeviceA receives the ICMP Time Exceeded message, records the first-hop IP address, and sends a UDP packet with the TTL value of 2.</p>
</li><li><p>DeviceD (second hop) receives the packet, discards the packet according to the TTL value, and sends an ICMP Time Exceeded message to DeviceA.</p>
</li><li><p>Similarly, a UDP packet will reach the destination DeviceB and DeviceB sends an ICMP Port Unreachable message to DeviceA.</p>
</li><li><p>Based on the ICMP message returned from each hop, DeviceA collects information about the forwarding path and statistics about each hop on the forwarding path.</p>
</li></ol>
<div class="fignone" id="EN-US_TASK_0000001130622300__fig_dc_vrp_network-monitor_feature_001801"><a name="EN-US_TASK_0000001130622300__fig_dc_vrp_network-monitor_feature_001801"></a><a name="fig_dc_vrp_network-monitor_feature_001801"></a><span class="figcap"><b>Figure 1 </b>Trace test networking</span><br><span><img class="vsd" src="figure/en-us_image_0000001176661857.png"></span></div>
<p>In addition, a trace test can be used to detect the maximum transmission unit (MTU) of the path from the source to the destination.</p>
<p>When creating an NQA trace test instance, you can disable packet fragmentation and set the packet payload size. After the test instance is started, test packets are sent based on the specified size without being fragmented. If the test is successful, the packet payload size is smaller than the path MTU. Then, keep increasing the packet payload size until the test fails. The test failure indicates that the packet payload size is greater than the path MTU. The maximum size of the packet that can be sent without being fragmented is used as the path MTU.</p>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001130622300__1.3.2"></a><a name="1.3.2"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Enter the system view.</span><p><pre class="screen"><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></pre>
</p></li><li><span>Create an NQA test instance and set the test instance type to trace.</span><ol type="a"><li class="substepexpand"><span>Create an NQA test instance and enter the view of the test instance.</span><p><pre class="screen"><a href="cmdqueryname=nqa"><b><span class="cmdname">nqa</span></b></a> <strong><span>test-instance</span></strong> <i><span class="varname">admin-name test-name</span></i></pre>
</p></li><li class="substepexpand"><span>Set the test instance type to trace.</span><p><pre class="screen"><a href="cmdqueryname=test-type"><b><span class="cmdname">test-type</span></b></a> <strong><span>trace</span></strong></pre>
</p></li><li class="substepexpand"><span>(Optional) Configure a description for the test instance.</span><p><pre class="screen"><a href="cmdqueryname=description"><b><span class="cmdname">description</span></b></a> <i><span class="varname">description</span></i></pre>
</p></li></ol>
</li><li><span>Configure the destination IP address and destination port number for the test instance.</span><p><ol type="a"><li>Set the destination IP address for test packets, that is, the IP address of the NQA server. <pre class="screen"><a href="cmdqueryname=destination-address"><b><span class="cmdname">destination-address</span></b></a> { <strong><span>ipv4</span></strong> <i><span class="varname">destAddress</span></i> | <strong><span>ipv6</span></strong> <i><span class="varname">destAddress6</span></i> }</pre>
</li><li><div class="p">(Optional) Specify the destination port number for test packets.<pre class="screen"><a href="cmdqueryname=destination-port"><b><span class="cmdname">destination-port</span></b></a> <i><span class="varname">port-number</span></i></pre>
</div>
<p>By default, the destination port number for a test packet is 33434.</p>
</li></ol>
</p></li><li><span>(Optional) Set optional parameters for the test instance to simulate packet transmission.</span><ol type="a"><li class="substepexpand"><span>Configure the aging time for the NQA test instance.</span><p><pre class="screen"><a href="cmdqueryname=agetime"><b><span class="cmdname">agetime</span></b></a> <span><i><span class="varname">ageTimeValue</span></i></span></pre>
</p></li><li class="substepexpand"><span>Configure padding characters in test packets.</span><p><pre class="screen"><a href="cmdqueryname=datafill"><b><span class="cmdname">datafill</span></b></a> <span><span><i><span class="varname">fill-string</span></i></span></span></pre>
</p></li><li class="substepexpand"><span>Set the packet payload size for the NQA test instance.</span><p><pre class="screen"><a href="cmdqueryname=datasize"><b><span class="cmdname">datasize</span></b></a> <span><i><span class="varname">datasizeValue</span></i></span></pre>
</p></li><li class="substepexpand"><span>Set the number of probes for each hop in a test.</span><p><pre class="screen"><a href="cmdqueryname=probe-count"><b><span class="cmdname">probe-count</span></b></a> <i><span class="varname">number</span></i></pre>
</p></li><li class="substepexpand"><span>Configure the NQA client to send packets without searching the routing table.</span><p><pre class="screen"><a href="cmdqueryname=sendpacket+passroute"><b><span class="cmdname">sendpacket passroute</span></b></a></pre>
</p></li><li class="substepexpand"><span>Configure the source IP address for test packets.</span><p><pre class="screen"><a href="cmdqueryname=source-address"><b><span class="cmdname">source-address</span></b></a> { <strong><span>ipv4</span></strong> <i><span class="varname">srcAddress</span></i> | <strong><span>ipv6</span></strong> <i><span class="varname">srcAddr6</span></i> }</pre>
</p></li><li class="substepexpand"><span>Set the source interface for test packets.</span><p><pre class="screen"><a href="cmdqueryname=source-interface"><b><span class="cmdname">source-interface</span></b></a> { <i><span class="varname">ifName</span></i> | <i><span class="varname">ifType</span></i> <i><span class="varname">ifNum</span></i> }</pre>
</p></li><li class="substepexpand"><span>Set the TTL of test packets.</span><p><pre class="screen"><a href="cmdqueryname=tracert-livetime"><b><span class="cmdname">tracert-livetime</span></b></a> <strong><span>first-ttl</span></strong> <i><span class="varname">first-ttl</span></i> <strong><span>max-ttl</span></strong> <i><span class="varname">max-ttl</span></i></pre>
</p></li><li class="substepexpand"><span>Set the next-hop IP address.</span><p><pre class="screen"><a href="cmdqueryname=nexthop"><b><span class="cmdname">nexthop</span></b></a> { <strong><span>ipv4</span></strong> <i><span class="varname">ipv4Address</span></i> | <strong><span>ipv6</span></strong> <i><span class="varname">ipv6Address</span></i> }</pre>
</p></li><li class="substepexpand"><span>Set the ToS value of test packets.</span><p><pre class="screen"><a href="cmdqueryname=tos"><b><span class="cmdname">tos</span></b></a> <i><span class="varname">tos-value</span></i> [ <strong><span>dscp</span></strong> ]</pre>
</p></li></ol>
</li><li><span>(Optional) Disable packet fragmentation.</span><p><pre class="screen"><a href="cmdqueryname=set-df"><b><span class="cmdname">set-df</span></b></a></pre>
</p></li><li><span>(Optional) Configure test failure conditions.</span><ol type="a"><li class="substepexpand"><span>Set the response timeout interval.</span><p><pre class="screen"><a href="cmdqueryname=timeout"><b><span class="cmdname">timeout</span></b></a> <i><span class="varname">time</span></i></pre>
</p></li><li class="substepexpand"><span>Set the maximum number of hop failures in a probe.</span><p><pre class="screen"><a href="cmdqueryname=tracert-hopfailtimes"><b><span class="cmdname">tracert-hopfailtimes</span></b></a> <i><span class="varname">hopFailTimes</span></i></pre>
</p></li></ol>
</li><li><span>(Optional) Set the maximum number of historical test records and the maximum number of test results that can be saved for the NQA test instance.</span><p><pre class="screen"><a href="cmdqueryname=records"><b><span class="cmdname">records</span></b></a> { <strong><span>history</span></strong> <i><span class="varname">history-number</span></i> | <strong><span>result</span></strong> <i><span class="varname">result-number</span></i> }</pre>
</p></li><li><span>(Optional) Configure the device to send traps.</span><ol type="a"><li class="substepexpand"><span>Configure the NQA client to send a trap to the NMS when the number of consecutive test failures reaches a specified value.</span><p><pre class="screen"><a href="cmdqueryname=test-failtimes"><b><span class="cmdname">test-failtimes</span></b></a> <span><i><span class="varname">failTimes</span></i></span></pre>
</p></li><li class="substepexpand"><span>Set the RTD threshold.</span><p><pre class="screen"><a href="cmdqueryname=threshold"><b><span class="cmdname">threshold</span></b></a> <strong><span>rtd</span></strong> <span><i><span class="varname">thresholdRtd</span></i></span></pre>
</p></li><li class="substepexpand"><span>Configure the condition for sending a trap.</span><p><pre class="screen"><a href="cmdqueryname=send-trap"><b><span class="cmdname">send-trap</span></b></a> { <strong><span>all</span></strong> | { <strong><span>rtd</span></strong> | <strong><span>testfailure</span></strong> | <strong><span>testcomplete</span></strong> | <strong><span>testresult-change</span></strong> } <sup>*</sup> }</pre>
</p></li></ol>
</li><li><span>(Optional) Configure the VPN instance name for the NQA test instance.</span><p><pre class="screen"><a href="cmdqueryname=vpn-instance"><b><span class="cmdname">vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i></pre>
</p></li><li><span>Schedule the NQA test instance.</span><ol type="a"><li class="substepexpand"><span>(Optional) Set the interval for performing NQA tests.</span><p><pre class="screen"><a href="cmdqueryname=frequency"><b><span class="cmdname">frequency</span></b></a> <i><span class="varname">frequencyValue</span></i></pre>
</p></li><li class="substepexpand"><span>Start the NQA test instance.</span><p><p>You can start an NQA test instance immediately, at a specified time, after a delay, or periodically.</p>
<ul><li><div class="p">Start the test instance immediately.<pre class="screen"><a href="cmdqueryname=start"><b><span class="cmdname">start</span></b></a> <strong><span>now</span></strong> [ <strong><span>end</span></strong> { <strong><span>at</span></strong> [ <i><span class="varname">yyyy/mm/dd</span></i> ] <i><span class="varname">hh:mm:ss</span></i> | <strong><span>delay</span></strong> { <strong><span>seconds</span></strong> <i><span class="varname">second</span></i> | <i><span class="varname">hh:mm:ss</span></i> } | <strong><span>lifetime</span></strong> { <strong><span>seconds</span></strong> <i><span class="varname">second</span></i> | <i><span class="varname">hh:mm:ss</span></i> } } ]</pre>
</div>
</li><li><div class="p">Start the test instance at a specified time.<pre class="screen"><a href="cmdqueryname=start"><b><span class="cmdname">start</span></b></a> <strong><span>at</span></strong> [ <i><span class="varname">yyyy/mm/dd</span></i> ] <i><span class="varname">hh:mm:ss</span></i> [ <strong><span>end</span></strong> { <strong><span>at</span></strong> [ <i><span class="varname">yyyy/mm/dd</span></i> ] <i><span class="varname">hh:mm:ss</span></i> | <strong><span>delay</span></strong> { <strong><span>seconds</span></strong> <i><span class="varname">second</span></i> | <i><span class="varname">hh:mm:ss</span></i> } | <strong><span>lifetime</span></strong> { <strong><span>seconds</span></strong> <i><span class="varname">second</span></i> | <i><span class="varname">hh:mm:ss</span></i> } } ]</pre>
</div>
</li><li><p>Start the test instance after a specified delay.</p>
<pre class="screen"><a href="cmdqueryname=start"><b><span class="cmdname">start</span></b></a> <strong><span>delay</span></strong> { <strong><span>seconds</span></strong> <i><span class="varname">second</span></i> | <i><span class="varname">hh:mm:ss</span></i> } [ <strong><span>end</span></strong> { <strong><span>at</span></strong> [ <i><span class="varname">yyyy/mm/dd</span></i> ] <i><span class="varname">hh:mm:ss</span></i> | <strong><span>delay</span></strong> { <strong><span>seconds</span></strong> <i><span class="varname">second</span></i> | <i><span class="varname">hh:mm:ss</span></i> } | <strong><span>lifetime</span></strong> { <strong><span>seconds</span></strong> <i><span class="varname">second</span></i> | <i><span class="varname">hh:mm:ss</span></i> } } ]</pre>
</li><li><p>Start the test instance at a specified time every day.</p>
<pre class="screen"><a href="cmdqueryname=start"><b><span class="cmdname">start</span></b></a> <strong><span>daily</span></strong> <i><span class="varname">hh:mm:ss</span></i> <strong><span>to</span></strong> <i><span class="varname">hh:mm:ss</span></i> [ <strong><span>begin</span></strong> <i><span class="varname">yyyy/mm/dd</span></i> ] [ <strong><span>end</span></strong> <i><span class="varname">yyyy/mm/dd</span></i> ]</pre>
</li></ul>
</p></li></ol>
</li><li><span>Commit the configuration.</span><p><pre class="screen" id="EN-US_TASK_0000001130622300__en-us_task_0234857734_screen163801330213"><a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001130622300__en-us_task_0234857734_en-us_concept_0141113565_cmdname1667501373175340">commit</span></b></a></pre>
</p></li></ol></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../vrp/vrp_nqa_cfg_0009.html">Configuring NQA to Test an IP Network
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../vrp/vrp_nqa_cfg_0010.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../vrp/vrp_nqa_cfg_0012.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>