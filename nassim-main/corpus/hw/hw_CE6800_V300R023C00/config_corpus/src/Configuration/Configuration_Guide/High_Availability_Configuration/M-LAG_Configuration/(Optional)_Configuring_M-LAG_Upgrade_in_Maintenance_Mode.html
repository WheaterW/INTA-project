
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="(Optional) Configuring M-LAG Upgrade in Maintenance Mode">
<meta name="abstract" content="">
<meta name="description" content="">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../dc/dc_cfg_m-lag_0001.html">
<meta name="DC.Relation" scheme="URI" content="../dc/dc_cfg_m-lag_0021.html">
<meta name="DC.Relation" scheme="URI" content="../dc/dc_cfg_m-lag_0033.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="M-LAG">
<meta name="featuretype" content="High Availability">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="M-LAG">
<meta name="featuretype" content="High Availability">
<meta name="featuretype" content="High Availability">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001564128873">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="../public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="../public_sys-resources/browseVersion.js"></script>
<title>(Optional) Configuring M-LAG Upgrade in Maintenance Mode</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001564128873"></a><a name="EN-US_TASK_0000001564128873"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">(Optional) Configuring M-LAG Upgrade in Maintenance Mode</h1>
<div class="taskbody"><p></p>
<div class="context"><a name="EN-US_TASK_0000001564128873__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>To implement the upgrade in maintenance mode on a device, you need to configure a routing protocol on the device to be upgraded, and enable the function of setting member interfaces of the Eth-Trunk interface that functions as the M-LAG member interface to down, to switch traffic to the backup link. After the device upgrade is complete, delete the traffic switching configuration to switch traffic back to the upgraded device.</p>
<p>M-LAG upgrade in maintenance mode supports the following network-side routing protocols: OSPF, OSPFv3, BGP, and BGP4+.</p>
<p>For the <span>CE6885-LL (low latency mode)</span>: IPv6-related configurations are not supported.</p>
<div class="note"><img src="../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The maintenance view is controlled by a license (CE-LIC-LU). You need to load the license before entering the maintenance view.</p>
</div></div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001564128873__1.4.2"></a><a name="1.4.2"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Enter the system view.</span><p><pre class="screen"><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></pre>
</p></li><li><span>Enter the maintenance view.</span><p><pre class="screen"><a href="cmdqueryname=maintenance"><b><span class="cmdname">maintenance</span></b></a></pre>
</p></li><li><span>Perform one of the following steps depending on the route type to implement network-side traffic switching:</span><p><ul><li>OSPF routes: Configure the device to change the costs of all its OSPF LSAs to be advertised to the maximum values.<pre class="screen"><a href="cmdqueryname=ospf+advertise+max-cost"><b><span class="cmdname">ospf advertise max-cost</span></b></a></pre>
<div class="note"><img src="../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The <span>CE6885-LL (low latency mode)</span> does not support this command.</p>
</div></div>
<p>By default, a device does not change the costs of any of its OSPF LSAs to be advertised to the maximum value.</p>
<div class="note"><img src="../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>After the <a href="cmdqueryname=ospf+advertise+max-cost"><b><span class="cmdname">ospf advertise max-cost</span></b></a> command is run, the device changes the costs of all its OSPF LSAs to be advertised to their maximum values. The costs of router-LSAs (Type 1) are increased to 65535, and the costs of summary-LSAs (Type 3 and Type 4), AS-external-LSAs (Type 5), and NSSA-LSAs (Type 7) are all increased to 16711680.</p>
</div></div>
</li><li>OSPFv3 routes: Configure the device to change the costs of all its OSPFv3 LSAs to be advertised to their maximum values.<pre class="screen"><a href="cmdqueryname=ospfv3+advertise+max-cost"><b><span class="cmdname">ospfv3 advertise max-cost</span></b></a></pre>
<p>By default, a device does not change the cost of any of its OSPFv3 LSAs to be advertised to the maximum value.</p>
<div class="note"><img src="../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>After the <a href="cmdqueryname=ospfv3+advertise+max-cost"><b><span class="cmdname">ospfv3 advertise max-cost</span></b></a> command is run, the device changes the costs of all its OSPFv3 LSAs to be advertised to their maximum values. The costs of router-LSAs (Type 1) are increased to 65535, and the costs of inter-area-prefix-LSAs (Type 3), inter-area-router-LSAs (Type 4), AS-external-LSAs (Type 5), and NSSA-LSAs (Type 7) are all increased to 16711680.</p>
</div></div>
</li><li>BGP-IPv4 unicast address family and BGP-VPN instance IPv4 address family routes: Enable BGP to set the priorities of BGP-IPv4 unicast address family and BGP-VPN instance IPv4 address family routes to be advertised to the lowest.<pre class="screen"><a href="cmdqueryname=advertise+bgp+ipv4-family+unicast+lowest-priority+enable"><b><span class="cmdname">advertise bgp ipv4-family unicast lowest-priority enable</span></b></a></pre>
<p>By default, BGP does not set the priorities of BGP routes to be advertised to the lowest.</p>
<div class="note"><img src="../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The <a href="cmdqueryname=advertise+bgp+ipv4-family+unicast+lowest-priority+enable"><b><span class="cmdname">advertise bgp ipv4-family unicast lowest-priority enable</span></b></a> and <a href="cmdqueryname=advertise+lowest-priority+all-address-family+peer-up"><b><span class="cmdname">advertise lowest-priority all-address-family peer-up</span></b></a> commands can be used to control route advertisement. Either command can enable BGP to set the priorities of routes to be advertised in the preceding address families to the lowest when BGP peers in these address families go from down to up.</p>
<p>After the <a href="cmdqueryname=advertise+bgp+ipv4-family+unicast+lowest-priority+enable"><b><span class="cmdname">advertise bgp ipv4-family unicast lowest-priority enable</span></b></a> command is run, the MED and Local_Pref attributes of BGP routes to be advertised cannot be modified through an export routing policy.</p>
</div></div>
</li><li>BGP-IPv6 unicast address family and BGP-VPN instance IPv6 address family routes: Enable BGP to set the priorities of BGP-IPv6 unicast address family and BGP-VPN instance IPv6 address family routes to be advertised to the lowest.<pre class="screen"><a href="cmdqueryname=advertise+bgp+ipv6-family+unicast+lowest-priority+enable"><b><span class="cmdname">advertise bgp ipv6-family unicast lowest-priority enable</span></b></a></pre>
<p>By default, BGP does not set the priorities of BGP routes to be advertised to the lowest.</p>
<div class="note"><img src="../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The <a href="cmdqueryname=advertise+bgp+ipv6-family+unicast+lowest-priority+enable"><b><span class="cmdname">advertise bgp ipv6-family unicast lowest-priority enable</span></b></a> and <a href="cmdqueryname=advertise+lowest-priority+all-address-family+peer-up"><b><span class="cmdname">advertise lowest-priority all-address-family peer-up</span></b></a> commands can be used to control route advertisement. Either command can enable BGP to set the priorities of routes to be advertised in the preceding address families to the lowest when BGP peers in these address families go from down to up.</p>
<p>After the <a href="cmdqueryname=advertise+bgp+ipv6-family+unicast+lowest-priority+enable"><b><span class="cmdname">advertise bgp ipv6-family unicast lowest-priority enable</span></b></a> command is run, the MED and Local_Pref attributes of BGP routes to be advertised cannot be modified through an export routing policy.</p>
</div></div>
</li><li>EVPN address family routes: Enable BGP to set the priorities of EVPN address family routes to be advertised to the lowest.<pre class="screen"><a href="cmdqueryname=advertise+bgp+l2vpn-family+evpn+lowest-priority+enable"><b><span class="cmdname">advertise bgp l2vpn-family evpn lowest-priority enable</span></b></a></pre>
<p>By default, BGP does not set the priorities of BGP routes to be advertised to the lowest.</p>
<div class="note"><img src="../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The <a href="cmdqueryname=advertise+bgp+l2vpn-family+evpn+lowest-priority+enable"><b><span class="cmdname">advertise bgp l2vpn-family evpn lowest-priority enable</span></b></a> and <a href="cmdqueryname=advertise+lowest-priority+all-address-family+peer-up"><b><span class="cmdname">advertise lowest-priority all-address-family peer-up</span></b></a> commands can be used to control route advertisement. Either command can enable BGP to set the priorities of routes to be advertised in the preceding address family to the lowest when BGP peers in the address family go from down to up.</p>
<p>After the <a href="cmdqueryname=advertise+bgp+l2vpn-family+evpn+lowest-priority+enable"><b><span class="cmdname">advertise bgp l2vpn-family evpn lowest-priority enable</span></b></a> command is run, the MED and Local_Pref attributes of BGP routes to be advertised cannot be modified through an export routing policy.</p>
</div></div>
</li></ul>
</p></li><li><span>Commit the configuration.</span><p><pre class="screen" id="EN-US_TASK_0000001564128873__en-us_task_0228023023_screen163801330213"><a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001564128873__en-us_task_0228023023_en-us_concept_0141113565_cmdname1667501373175340">commit</span></b></a></pre>
</p></li><li><span>Enable the function of setting member interfaces of the Eth-Trunk interface that functions as the M-LAG member interface to down to trigger user-side traffic switching. (This configuration does not take effect on M-LAG member interfaces in active/standby mode.)</span><p><pre class="screen"><a href="cmdqueryname=lacp+force-down"><b><span class="cmdname">lacp force-down</span></b></a></pre>
<p>By default, the function of forcibly setting member interfaces of the Eth-Trunk interface that functions as the M-LAG member interface to down is disabled.</p>
</p></li><li><span>Commit the configuration.</span><p><pre class="screen" id="EN-US_TASK_0000001564128873__en-us_task_0228023023_screen163801330213_1"><a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001564128873__en-us_task_0228023023_en-us_concept_0141113565_cmdname1667501373175340_1">commit</span></b></a></pre>
</p></li><li><span>Upgrade the device. After the upgrade is complete, perform the following steps to switch traffic back to the upgraded device.</span></li><li><span>Enter the system view.</span><p><pre class="screen"><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></pre>
</p></li><li><span>Enter the maintenance view.</span><p><pre class="screen"><a href="cmdqueryname=maintenance"><b><span class="cmdname">maintenance</span></b></a></pre>
</p></li><li><span>Disable the function of setting member interfaces of the Eth-Trunk interface that functions as the M-LAG member interface to down. This allows user-side traffic to be switched back to the upgraded device. (This configuration does not take effect on M-LAG member interfaces in active/standby mode.)</span><p><pre class="screen"><a href="cmdqueryname=undo+lacp+force-down"><b><span class="cmdname">undo lacp force-down</span></b></a></pre>
</p></li><li><span>Commit the configuration.</span><p><pre class="screen" id="EN-US_TASK_0000001564128873__en-us_task_0228023023_screen163801330213_2"><a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001564128873__en-us_task_0228023023_en-us_concept_0141113565_cmdname1667501373175340_2">commit</span></b></a></pre>
</p></li><li><span>Perform one of the following steps depending on the route type to switch network-side traffic back to the upgraded device:</span><p><ul><li>OSPF routes: Configure the device to restore the costs of all its OSPF LSAs to be advertised to the original values.<pre class="screen"><a href="cmdqueryname=undo+ospf+advertise+max-cost"><b><span class="cmdname">undo ospf advertise max-cost</span></b></a></pre>
</li><li>OSPFv3 routes: Configure the device to restore the costs of all its OSPFv3 LSAs to be advertised to the original values.<pre class="screen"><a href="cmdqueryname=undo+ospfv3+advertise+max-cost"><b><span class="cmdname">undo ospfv3 advertise max-cost</span></b></a></pre>
</li><li>BGP-IPv4 unicast address family and BGP-VPN instance IPv4 address family routes: Disable BGP from setting the priorities of BGP-IPv4 unicast address family and BGP-VPN instance IPv4 address family routes to be advertised to the lowest.<pre class="screen"><a href="cmdqueryname=undo+advertise+bgp+ipv4-family+unicast+lowest-priority+enable"><b><span class="cmdname">undo advertise bgp ipv4-family unicast lowest-priority enable</span></b></a></pre>
</li><li>BGP-IPv6 unicast address family and BGP-VPN instance IPv6 address family routes: Disable BGP from setting the priorities of BGP-IPv6 unicast address family and BGP-VPN instance IPv6 address family routes to be advertised to the lowest.<pre class="screen"><strong>undo advertise bgp ipv6-family unicast lowest-priority enable</strong></pre>
</li><li>EVPN address family routes: Disable BGP from setting the priorities of EVPN address family routes to be advertised to the lowest.<pre class="screen"><strong>undo advertise bgp l2vpn-family evpn lowest-priority enable</strong></pre>
</li></ul>
</p></li><li><span>Commit the configuration.</span><p><pre class="screen" id="EN-US_TASK_0000001564128873__en-us_task_0228023023_screen163801330213_3"><a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001564128873__en-us_task_0228023023_en-us_concept_0141113565_cmdname1667501373175340_3">commit</span></b></a></pre>
</p></li></ol></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../dc/dc_cfg_m-lag_0001.html">M-LAG Configuration
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../dc/dc_cfg_m-lag_0021.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../dc/dc_cfg_m-lag_0033.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>