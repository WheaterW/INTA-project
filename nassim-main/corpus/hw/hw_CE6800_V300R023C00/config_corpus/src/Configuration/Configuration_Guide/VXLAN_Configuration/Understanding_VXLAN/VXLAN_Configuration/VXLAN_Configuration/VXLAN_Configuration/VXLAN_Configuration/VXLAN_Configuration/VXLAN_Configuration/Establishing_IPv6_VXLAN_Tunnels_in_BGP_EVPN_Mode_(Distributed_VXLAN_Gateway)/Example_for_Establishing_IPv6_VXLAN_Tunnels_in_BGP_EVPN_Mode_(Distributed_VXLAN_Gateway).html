
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Establishing IPv6 VXLAN Tunnels in BGP EVPN Mode (Distributed VXLAN Gateway)">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../dc/dc_vrp_vxlan6_cfg_1066.html">
<meta name="DC.Relation" scheme="URI" content="../dc/dc_vrp_vxlan6_cfg_1053.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="VXLAN">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="VXLAN">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="VXLAN">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="VXLAN">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001193911169">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="../public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="../public_sys-resources/browseVersion.js"></script>
<title>Example for Establishing IPv6 VXLAN Tunnels in BGP EVPN Mode (Distributed VXLAN Gateway)</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001193911169"></a><a name="EN-US_TASK_0000001193911169"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Establishing IPv6 VXLAN Tunnels in BGP EVPN Mode (Distributed VXLAN Gateway)</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001193911169__1.3.1"></a><a name="1.3.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>IPv6 VXLAN distributed gateways can address issues with centralized gateway networking, such as sub-optimal forwarding paths and bottlenecks on Layer 3 gateways in terms of ARP or ND entry specifications.</p>
<p>On the network shown in <a href="#EN-US_TASK_0000001193911169__fig_dc_cfg_vxlan_cfgcase_000401">Figure 1</a>, an enterprise deploys IPv4 VMs in different areas of an IPv6 DC. IPv4 VM1 on Server1 belongs to VLAN 10, and IPv4 VM1 on Server2 belongs to VLAN 20. The two VMs belong to different network segments. IPv6 VXLAN in distributed gateway mode is required for communication between IPv4 VM1s on different servers.</p>
<div class="fignone" id="EN-US_TASK_0000001193911169__fig_dc_cfg_vxlan_cfgcase_000401"><a name="EN-US_TASK_0000001193911169__fig_dc_cfg_vxlan_cfgcase_000401"></a><a name="fig_dc_cfg_vxlan_cfgcase_000401"></a><span class="figcap"><b>Figure 1 </b>Configuring IPv6 VXLAN in distributed gateway mode</span><div class="note"><img src="../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface1 and interface2 represent <span>100GE</span><span>1/0/1</span> and <span>100GE</span><span>1/0/2</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0000001193991055.png"></span></div>

<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" frame="border" border="1" rules="all"><caption><b>Table 1 </b>Interface IP addresses</caption><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="33.223322332233224%" id="mcps1.3.1.5.2.4.1.1" liSelected="liSelected"><p>Device</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="33.55335533553355%" id="mcps1.3.1.5.2.4.1.2" liSelected="liSelected"><p>Interface</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="33.223322332233224%" id="mcps1.3.1.5.2.4.1.3" liSelected="liSelected"><p>IP Address</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" rowspan="3" valign="middle" width="33.223322332233224%" headers="mcps1.3.1.5.2.4.1.1 "><p>Device1</p>
</td>
<td class="cellrowborder" valign="top" width="33.55335533553355%" headers="mcps1.3.1.5.2.4.1.2 "><p><span>100GE</span><span>1/0/1</span></p>
</td>
<td class="cellrowborder" valign="top" width="33.223322332233224%" headers="mcps1.3.1.5.2.4.1.3 "><p>2001:DB8:3::2/64</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.3.1.5.2.4.1.1 "><p><span>100GE</span><span>1/0/2</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.5.2.4.1.2 "><p>2001:DB8:2::2/64</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.3.1.5.2.4.1.1 "><p>LoopBack0</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.5.2.4.1.2 "><p>2001:DB8:11::1/128</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="2" valign="middle" width="33.223322332233224%" headers="mcps1.3.1.5.2.4.1.1 "><p>Device2</p>
</td>
<td class="cellrowborder" valign="top" width="33.55335533553355%" headers="mcps1.3.1.5.2.4.1.2 "><p><span>100GE</span><span>1/0/1</span></p>
</td>
<td class="cellrowborder" valign="top" width="33.223322332233224%" headers="mcps1.3.1.5.2.4.1.3 "><p>2001:DB8:2::1/64</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.3.1.5.2.4.1.1 "><p>LoopBack0</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.5.2.4.1.2 "><p>2001:DB8:22::2/128</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="2" valign="middle" width="33.223322332233224%" headers="mcps1.3.1.5.2.4.1.1 "><p>Device3</p>
</td>
<td class="cellrowborder" valign="top" width="33.55335533553355%" headers="mcps1.3.1.5.2.4.1.2 "><p><span>100GE</span><span>1/0/1</span></p>
</td>
<td class="cellrowborder" valign="top" width="33.223322332233224%" headers="mcps1.3.1.5.2.4.1.3 "><p>2001:DB8:3::1/64</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.3.1.5.2.4.1.1 "><p>LoopBack0</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.5.2.4.1.2 "><p>2001:DB8:33::3/128</p>
</td>
</tr>
</tbody>
</table>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001193911169__1.3.2"></a><a name="1.3.2"></a>
<div class="p"><h4 class="sectiontitle">Precautions</h4><p><a href="#EN-US_TASK_0000001193911169__table1011135203114">Table 2</a> lists the RDs and RTs of EVPN and VPN instances.</p>

<div class="tableBorder"><a name="EN-US_TASK_0000001193911169__table1011135203114"></a><a name="table1011135203114"></a><table cellpadding="4" cellspacing="0" summary="" id="EN-US_TASK_0000001193911169__table1011135203114" frame="border" border="1" rules="all"><caption><b>Table 2 </b>RDs and RTs of devices</caption><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="33.33333333333333%" id="mcps1.3.2.3.2.4.1.1" liSelected="liSelected"><p>Device</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="33.33333333333333%" id="mcps1.3.2.3.2.4.1.2" liSelected="liSelected"><p>RD</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="33.33333333333333%" id="mcps1.3.2.3.2.4.1.3" liSelected="liSelected"><p>RT</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.2.3.2.4.1.1 "><p>Device2</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.2.3.2.4.1.2 "><p>EVPN instance: 10:2</p>
<p>VPN instance: 20:2</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.2.3.2.4.1.3 "><div class="p">EVPN instance:<ul><li>ERT/IRT: 100:10</li><li>ERT: 100:5010</li></ul>
</div>
<div class="p">VPN instance:<ul><li>ERT/IRT (EVPN): 100:5010</li></ul>
</div>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.2.3.2.4.1.1 "><p>Device3</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.2.3.2.4.1.2 "><p>EVPN instance: 10:3</p>
<p>VPN instance: 20:3</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.2.3.2.4.1.3 "><div class="p">EVPN instance:<ul><li>ERT/IRT: 100:20</li><li>ERT: 100:5010</li></ul>
</div>
<div class="p">VPN instance:<ul><li>ERT/IRT (EVPN): 100:5010</li></ul>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="fignone"><span class="figcap"><b>Figure 2 </b>Configuring RTs</span><br><span><img class="vsd" src="figure/en-us_image_0000001147871458.png"></span></div>
<div class="p">The RT configuration guidelines for VPN and EVPN instances are as follows:<ul><li>For VPN instances, specify the <strong>evpn</strong> keyword during the configuration of an ERT (such as ERT Y) and an IRT (such as IRT Y) to enable route leaking into peer EVPN instances for host route generation. If route leaking into common L3VPN instances is required, configure common RTs on demand.</li><li>In EVPN instances, in addition to ERTs (such as ERT A and ERT B) and IRTs (such as IRT A and IRT B) for different BDs, configure ERT Y that is used for route leaking into a peer VPN instance. Generally, IRT Y does not need to be configured, because doing so would cause MAC addresses to be advertised in EVPN instances of different BDs.</li><li>The ERT/IRT Y value of a VPN instance cannot be the same as the ERT/IRT A or ERT/IRT B value of an EVPN instance. It is recommended that the VPN and EVPN instances use different RT ranges for differentiation.</li></ul>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001193911169__1.3.3"></a><a name="1.3.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><div class="p">The configuration roadmap is as follows:<ol><li>Configure OSPFv3 to run between Device1 and Device2 and between Device1 and Device3.</li><li>Configure service access points on Device2 and Device3 to differentiate service traffic.</li><li>Configure Device2 and Device3 to establish BGP EVPN peer relationships with Device1.</li><li>Configure Device1 to establish BGP EVPN peer relationships with Device2 and Device3. Then, configure Device1 as the RR.</li><li>Configure VPN and EVPN instances on Device2 and Device3.</li><li>Enable ingress replication on Device2 and Device3.</li><li>Configure an IPv6 Layer 3 VXLAN gateway on Device2 and Device3, and configure an IPv4 address for the gateway interface.</li><li>Configure BGP to advertise IRB routes and IP prefix routes between Device1 and Device2 and between Device1 and Device3.</li></ol>
</div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001193911169__1.3.4"></a><a name="1.3.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Assign an IPv6 address for each interface.</span><p><p>Assign an IPv6 address to each interface on Device1, Device2, and Device3 according to <a href="#EN-US_TASK_0000001193911169__fig_dc_cfg_vxlan_cfgcase_000401">Figure 1</a>. For configuration details, see <a href="#EN-US_TASK_0000001193911169__postreq19133121341511">Configuration Scripts</a>.</p>
</p></li><li><span>Configure OSPFv3.</span><p><p># Configure Device1. The configurations of Device2 and Device3 are similar to the configuration of Device1.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname Device1</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Device1] <strong>ospfv3 1</strong>
[<span class="keyword">*</span>Device1-ospfv3-1] <strong>router-id 1.1.1.1</strong>
[<span class="keyword">*</span>Device1-ospfv3-1] <strong>area 0.0.0.0</strong>
[<span class="keyword">*</span>Device1-ospfv3-1-area-0.0.0.0] <strong>quit</strong>
[<span class="keyword">*</span>Device1-ospfv3-1] <strong>quit</strong>
[<span class="keyword">*</span>Device1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Device1] <strong>interface loopback 0</strong>
[<span class="keyword">*</span>Device1-LoopBack0] <strong>ospfv3 1 area 0.0.0.0</strong>
[<span class="keyword">*</span>Device1-LoopBack0] <strong>quit</strong>
[<span class="keyword">*</span>Device1] <strong>interface <span>100GE</span><span>1/0/1</span></strong>
[<span class="keyword">*</span>Device1-<span>100GE</span><span>1/0/1</span>] <strong>ospfv3 1 area 0.0.0.0</strong>
[<span class="keyword">*</span>Device1-<span>100GE</span><span>1/0/1</span>] <strong>quit</strong>
[<span class="keyword">*</span>Device1] <strong>interface <span>100GE</span><span>1/0/2</span></strong>
[<span class="keyword">*</span>Device1-<span>100GE</span><span>1/0/2</span>] <strong>ospfv3 1 area 0.0.0.0</strong>
[<span class="keyword">*</span>Device1-<span>100GE</span><span>1/0/2</span>] <strong>quit</strong>
[<span class="keyword">*</span>Device1] <strong>commit</strong></pre>
</p></li><li><span>Configure service access points on Device2 and Device3.</span><p><p># Configure Device2. The configuration of Device3 is similar to that of Device2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Device2] <strong>bridge-domain 10</strong>
[<span class="keyword">*</span>Device2-bd10] <strong>quit</strong>
[<span class="keyword">*</span>Device2] <strong>interface <span>100ge</span> <span>1/0/2</span>.1 mode l2</strong>
[<span class="keyword">*</span>Device2-<span>100GE</span><span>1/0/2</span>.1] <strong>encapsulation dot1q vid 10</strong>
[<span class="keyword">*</span>Device2-<span>100GE</span><span>1/0/2</span>.1] <strong>bridge-domain 10</strong>
[<span class="keyword">*</span>Device2-<span>100GE</span><span>1/0/2</span>.1] <strong>quit</strong>
[<span class="keyword">*</span>Device2] <strong>commit</strong></pre>
</p></li><li><span>Enable EVPN to function as the VXLAN control plane protocol.</span><p><p># Configure Device1. The configurations of Device2 and Device3 are similar to the configuration of Device1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Device1] <strong>evpn-overlay enable</strong>
[<span class="keyword">*</span>Device1] <strong>commit</strong></pre>
</p></li><li><span>Configure Device2 and Device3 to establish BGP EVPN peer relationships with Device1.</span><p><div class="p"># Configure a BGP EVPN peer relationship on Device2. The configuration of Device3 is similar to that of Device2.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Device2] <strong>bgp 100</strong>
[<span class="keyword">*</span>Device2-bgp] <strong>peer 2001:DB8:11::1 as-number 100</strong>
[<span class="keyword">*</span>Device2-bgp] <strong>peer 2001:DB8:11::1 connect-interface LoopBack0</strong>
[<span class="keyword">*</span>Device2-bgp] <strong>l2vpn-family evpn</strong>
[<span class="keyword">*</span>Device2-bgp-af-evpn] <strong>policy vpn-target</strong>
[<span class="keyword">*</span>Device2-bgp-af-evpn] <strong>peer 2001:DB8:11::1 enable</strong>
Warning: This operation will reset the peer session. Continue? [Y/N]: <strong>Y</strong>
[<span class="keyword">*</span>Device2-bgp-af-evpn] <strong>quit</strong>
[<span class="keyword">*</span>Device2-bgp] <strong>quit</strong>
[<span class="keyword">*</span>Device2] <strong>commit</strong></pre>
</div>
</p></li><li><span>Configure Device1 to establish BGP EVPN peer relationships with Device2 and Device3. Then configure Device1 as the RR and Device2 and Device3 as the RR clients.</span><p><div class="p"># Configure Device1.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Device1] <strong>bgp 100</strong>
[<span class="keyword">*</span>Device1-bgp] <strong>peer 2001:DB8:22::2 as-number 100</strong>
[<span class="keyword">*</span>Device1-bgp] <strong>peer 2001:DB8:22::2 connect-interface LoopBack0</strong>
[<span class="keyword">*</span>Device1-bgp] <strong>peer 2001:DB8:33::3 as-number 100</strong>
[<span class="keyword">*</span>Device1-bgp] <strong>peer 2001:DB8:33::3 connect-interface LoopBack0</strong>
[<span class="keyword">*</span>Device1-bgp] <strong>l2vpn-family evpn</strong>
[<span class="keyword">*</span>Device1-bgp-af-evpn] <strong>peer 2001:DB8:22::2 enable</strong>
Warning: This operation will reset the peer session. Continue? [Y/N]: <strong>Y</strong>
[<span class="keyword">*</span>Device1-bgp-af-evpn] <strong>peer 2001:DB8:22::2 reflect-client</strong>
[<span class="keyword">*</span>Device1-bgp-af-evpn] <strong>peer 2001:DB8:33::3 enable</strong>
Warning: This operation will reset the peer session. Continue? [Y/N]: <strong>Y</strong>
[<span class="keyword">*</span>Device1-bgp-af-evpn] <strong>peer 2001:DB8:33::3 reflect-client</strong>
[<span class="keyword">*</span>Device1-bgp-af-evpn] <strong>undo policy vpn-target</strong>
[<span class="keyword">*</span>Device1-bgp-af-evpn] <strong>quit</strong>
[<span class="keyword">*</span>Device1-bgp] <strong>quit</strong>
[<span class="keyword">*</span>Device1] <strong>commit</strong></pre>
</div>
</p></li><li><span>Configure VPN and EVPN instances on Device2 and Device3.</span><p><p># Configure Device2. The configuration of Device3 is similar to that of Device2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Device2] <strong>ip vpn-instance vpn1</strong>
[<span class="keyword">*</span>Device2-vpn-instance-vpn1] <strong>vxlan vni 5010</strong>
[<span class="keyword">*</span>Device2-vpn-instance-vpn1] <strong>ipv4-family</strong>
[<span class="keyword">*</span>Device2-vpn-instance-vpn1-af-ipv4] <strong>route-distinguisher 20:2</strong>
[<span class="keyword">*</span>Device2-vpn-instance-vpn1-af-ipv4] <strong>vpn-target </strong><strong>100:5010</strong><strong> evpn</strong>
[<span class="keyword">*</span>Device2-vpn-instance-vpn1-af-ipv4] <strong>quit</strong>
[<span class="keyword">*</span>Device2-vpn-instance-vpn1] <strong>quit</strong>
[<span class="keyword">*</span>Device2] <strong>bridge-domain 10</strong>
[<span class="keyword">*</span>Device2-bd10] <strong>vxlan vni 10</strong>
[<span class="keyword">*</span>Device2-bd10] <strong>evpn</strong>
[<span class="keyword">*</span>Device2-bd10-evpn] <strong>route-distinguisher 10:2</strong>
[<span class="keyword">*</span>Device2-bd10-evpn] <strong>vpn-target 100:10</strong>
[<span class="keyword">*</span>Device2-bd10-evpn] <strong>vpn-target 100:5010 export-extcommunity</strong>
[<span class="keyword">*</span>Device2-bd10-evpn] <strong>vpn-target 100:5010 import-extcommunity</strong>
[<span class="keyword">*</span>Device2-bd10-evpn] <strong>quit</strong>
[<span class="keyword">*</span>Device2-bd10] <strong>quit</strong>
[<span class="keyword">*</span>Device2] <strong>commit</strong></pre>
</p></li><li><span>Enable ingress replication on Device2 and Device3.</span><p><p># Configure Device2. The configuration of Device3 is similar to that of Device2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Device2] <strong>interface nve 1</strong>
[<span class="keyword">*</span>Device2-Nve1] <strong>source 2001:DB8:22::2</strong>
[<span class="keyword">*</span>Device2-Nve1] <strong>vni 10 head-end peer-list protocol bgp</strong>
[<span class="keyword">*</span>Device2-Nve1] <strong>quit</strong>
[<span class="keyword">*</span>Device2] <strong>commit</strong></pre>
</p></li><li><span>Configure Layer 3 VXLAN gateways on Device2 and Device3.</span><p><div class="p"># Configure a Layer 3 VXLAN gateway on Device2. The configuration of Device3 is similar to the configuration of Device2. Note that the IP addresses of VBDIF interfaces on Device2 and Device3 must belong to different network segments.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Device2] <strong>interface Vbdif10</strong>
[<span class="keyword">*</span>Device2-Vbdif10] <strong>ip binding vpn-instance vpn1</strong>
[<span class="keyword">*</span>Device2-Vbdif10] <strong>ip address 10.1.1.1 255.255.255.0</strong>
[<span class="keyword">*</span>Device2-Vbdif10] <strong>vxlan anycast-gateway enable</strong>
[<span class="keyword">*</span>Device2-Vbdif10] <strong>arp collect host enable</strong>
[<span class="keyword">*</span>Device2-Vbdif10] <strong>arp direct-route enable</strong>
[<span class="keyword">*</span>Device2-Vbdif10] <strong>quit</strong>
[<span class="keyword">*</span>Device2] <strong>commit</strong></pre>
</div>
</p></li><li><span>Configure BGP to advertise IRB routes between Device1 and Device2 and between Device1 and Device3.</span><p><p># Configure Device1. The configurations of Device2 and Device3 are similar to the configuration of Device1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Device1] <strong>bgp 100</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Device1-bgp] <strong>l2vpn-family evpn</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Device1-bgp-af-evpn] <strong>peer 2001:DB8:22::2 advertise irb</strong>
[<span class="keyword">*</span>Device1-bgp-af-evpn] <strong>peer 2001:DB8:33::3 advertise irb</strong>
[<span class="keyword">*</span>Device1-bgp-af-evpn] <strong>quit</strong>
[<span class="keyword">*</span>Device1-bgp] <strong>quit</strong>
[<span class="keyword">*</span>Device1] <strong>commit</strong></pre>
</p></li><li><span>Configure Device2 and Device3 to advertise IP prefix routes.</span><p><p># Configure Device2. The configuration of Device3 is similar to that of Device2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Device2] <strong>bgp 100</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Device2-bgp] <strong>ipv4-family vpn-instance vpn1</strong>
[<span class="keyword">*</span>Device2-bgp-vpn1]<strong> </strong><strong>import-route direct</strong>
[<span class="keyword">*</span>Device2-bgp-vpn1] <strong>advertise l2vpn evpn</strong>
[<span class="keyword">*</span>Device2-bgp-vpn1] <strong>quit</strong>
[<span class="keyword">*</span>Device2-bgp] <strong>quit</strong>
[<span class="keyword">*</span>Device2] <strong>commit</strong></pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001193911169__1.3.5"></a><a name="1.3.5"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p>After completing the configurations, run the <strong>display vxlan tunnel</strong> command on Device2 and Device3 to check IPv6 VXLAN tunnel information. The following example uses the command output on Device2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Device2] <strong>display vxlan tunnel</strong></pre>
<pre class="screen">Number of vxlan tunnel : 1
Tunnel ID   Source           Destination      State  Type     Uptime
--------------------------------------------------------------------
4026531919  2001:DB8:22::2   2001:DB8:33::3   up     dynamic  00:44:18</pre>
<p>VM1s on different servers can communicate. VM1 on Server2 can be pinged from the distributed gateway Device2.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>Device2] <strong>ping </strong><strong>-vpn-instance vpn1</strong> <strong>10.2.1.10 </strong>
  PING 10.2.1.10: 300  data bytes, press CTRL_C to break
    Reply from 10.2.1.10: bytes=300 Sequence=1 ttl=254 time=30 ms
    Reply from 10.2.1.10: bytes=300 Sequence=2 ttl=254 time=30 ms
    Reply from 10.2.1.10: bytes=300 Sequence=3 ttl=254 time=30 ms
    Reply from 10.2.1.10: bytes=300 Sequence=4 ttl=254 time=30 ms
    Reply from 10.2.1.10: bytes=300 Sequence=5 ttl=254 time=30 ms

  --- 10.2.1.10 ping statistics ---
    5 packet(s) transmitted
    5 packet(s) received
    0.00% packet loss
    round-trip min/avg/max = 30/30/30 ms</pre>
<div class="note"><img src="../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The tunnel goes up only after a Layer 2 sub-interface on Device2 or Device3 connects to a server. When there is no access server, the VXLAN tunnel state is not displayed because no IRB route is advertised.</p>
</div></div>
</div>
<div class="postreq"><a name="EN-US_TASK_0000001193911169__postreq19133121341511"></a><a name="postreq19133121341511"></a><a name="EN-US_TASK_0000001193911169__1.3.6"></a><a name="1.3.6"></a><h4 class="sectiontitle">Configuration Scripts</h4><ul><li><p>Device1</p>
<pre class="screen">#
sysname Device1
#
evpn-overlay enable                                                             
# 
ospfv3 1
 router-id 1.1.1.1
 area 0.0.0.0
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ipv6 enable
 ipv6 address 2001:DB8:3::2/64
 ospfv3 1 area 0.0.0.0
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ipv6 enable
 ipv6 address 2001:DB8:2::2/64
 ospfv3 1 area 0.0.0.0
#
interface LoopBack0
 ipv6 enable
 ipv6 address 2001:DB8:11::1/128
 ospfv3 1 area 0.0.0.0
#
bgp 100
 private-4-byte-as enable
 peer 2001:DB8:22::2 as-number 100
 peer 2001:DB8:22::2 connect-interface LoopBack0
 peer 2001:DB8:33::3 as-number 100
 peer 2001:DB8:33::3 connect-interface LoopBack0
 #
 ipv4-family unicast
 #
 l2vpn-family evpn
  undo policy vpn-target
  peer 2001:DB8:22::2 enable
  peer 2001:DB8:22::2 advertise irb
  peer 2001:DB8:22::2 reflect-client
  peer 2001:DB8:33::3 enable
  peer 2001:DB8:33::3 advertise irb
  peer 2001:DB8:33::3 reflect-client
#
return</pre>
</li><li><p>Device2</p>
<pre class="screen">#
sysname Device2
#
evpn-overlay enable                                                             
#
ip vpn-instance vpn1
 ipv4-family
  route-distinguisher 20:2
  vpn-target 100:5010 export-extcommunity evpn
  vpn-target 100:5010 import-extcommunity evpn
 vxlan vni 5010
#
bridge-domain 10
 vxlan vni 10
 #
 evpn
  route-distinguisher 10:2
  vpn-target 100:10 export-extcommunity
  vpn-target 100:5010 export-extcommunity
  vpn-target 100:10 import-extcommunity
#
ospfv3 1
 router-id 2.2.2.2
 area 0.0.0.0
#
interface Vbdif10
 ip binding vpn-instance vpn1
 ip address 10.1.1.1 255.255.255.0
 vxlan anycast-gateway enable
 arp collect host enable
 arp direct-route enable
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ipv6 enable
 ipv6 address 2001:DB8:2::1/64
 ospfv3 1 area 0.0.0.0
#
interface <span>100GE</span><span>1/0/2</span>.1 mode l2
 encapsulation dot1q vid 10
 bridge-domain 10
#
interface LoopBack0
 ipv6 enable
 ipv6 address 2001:DB8:22::2/128
 ospfv3 1 area 0.0.0.0
#
interface Nve1
 source 2001:DB8:22::2
 vni 10 head-end peer-list protocol bgp
#
bgp 100
 private-4-byte-as enable
 peer 2001:DB8:11::1 as-number 100
 peer 2001:DB8:11::1 connect-interface LoopBack0
 #
 ipv4-family unicast
 #
 ipv4-family vpn-instance vpn1
  import-route direct
  advertise l2vpn evpn
 #
 l2vpn-family evpn
  policy vpn-target
  peer 2001:DB8:11::1 enable
  peer 2001:DB8:11::1 advertise irb
#
return</pre>
</li><li><p>Device3</p>
<pre class="screen">#
sysname Device3
#
evpn-overlay enable                                                             
#
ip vpn-instance vpn1
 ipv4-family
  route-distinguisher 20:3
  vpn-target 100:5010 export-extcommunity evpn
  vpn-target 100:5010 import-extcommunity evpn
 vxlan vni 5010
#
bridge-domain 20
 vxlan vni 20
 #
 evpn
  route-distinguisher 10:3
  vpn-target 100:20 export-extcommunity
  vpn-target 100:5010 export-extcommunity
  vpn-target 100:20 import-extcommunity
  vpn-target 100:5010 import-extcommunity
#
ospfv3 1
 router-id 3.3.3.3
 area 0.0.0.0
#
interface Vbdif20
 ip binding vpn-instance vpn1
 ip address 10.2.1.1 255.255.255.0
 vxlan anycast-gateway enable
 arp collect host enable
 arp direct-route enable
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ipv6 enable
 ipv6 address 2001:DB8:3::1/64
 ospfv3 1 area 0.0.0.0
#
interface <span>100GE</span><span>1/0/2</span>.1 mode l2
 encapsulation dot1q vid 20
 bridge-domain 20
#
interface LoopBack0
 ipv6 enable
 ipv6 address 2001:DB8:33::3/128
 ospfv3 1 area 0.0.0.0
#
interface Nve1
 source 2001:DB8:33::3
 vni 20 head-end peer-list protocol bgp
#
bgp 100
 private-4-byte-as enable
 peer 2001:DB8:11::1 as-number 100
 peer 2001:DB8:11::1 connect-interface LoopBack0
 #
 ipv4-family unicast
 #
 ipv4-family vpn-instance vpn1
  import-route direct
  advertise l2vpn evpn
 #
 l2vpn-family evpn
  policy vpn-target
  peer 2001:DB8:11::1 enable
  peer 2001:DB8:11::1 advertise irb
#
return</pre>
</li></ul>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../dc/dc_vrp_vxlan6_cfg_1066.html">Establishing IPv6 VXLAN Tunnels in BGP EVPN Mode (Distributed VXLAN Gateway)
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../dc/dc_vrp_vxlan6_cfg_1053.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>
</body>
</html>