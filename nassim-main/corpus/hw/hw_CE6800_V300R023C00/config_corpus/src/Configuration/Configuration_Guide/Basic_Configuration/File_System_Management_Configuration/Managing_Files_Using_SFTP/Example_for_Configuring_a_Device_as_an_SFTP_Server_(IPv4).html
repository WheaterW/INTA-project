
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring a Device as an SFTP Server (IPv4)">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="vrp_file_cfg_0013.html">
<meta name="DC.Relation" scheme="URI" content="vrp_file_cfg_0015.html">
<meta name="DC.Relation" scheme="URI" content="vrp_file_cfg_0017.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="SFTP">
<meta name="featurename" content="File System Management">
<meta name="featuretype" content="Basic Configuration">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="SFTP">
<meta name="featurename" content="File System Management">
<meta name="featuretype" content="Basic Configuration">
<meta name="featurename" content="FTP">
<meta name="featurename" content="SCP">
<meta name="featurename" content="SFTP">
<meta name="featurename" content="TFTP">
<meta name="featurename" content="File System Management">
<meta name="featuretype" content="Basic Configuration">
<meta name="featuretype" content="Basic Configuration">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001513030650">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring a Device as an SFTP Server (IPv4)</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001513030650"></a><a name="EN-US_TASK_0000001513030650"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring a Device as an SFTP Server (IPv4)</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001513030650__1.3.1"></a><a name="1.3.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>In <a href="#EN-US_TASK_0000001513030650__fig12144153491016">Figure 1</a>, PC1 connects to the device at 10.1.1.5. Files need to be securely transferred between PC1 and the device. To ensure secure file transfer, the device needs to be configured as an SSH server to provide the SFTP service, so that the SSH server can authenticate the client (PC1) and bidirectional data is encrypted. In addition, an ACL policy needs to be configured so that only PC1 can access the SSH server.</p>
<div class="fignone" id="EN-US_TASK_0000001513030650__fig12144153491016"><a name="EN-US_TASK_0000001513030650__fig12144153491016"></a><a name="fig12144153491016"></a><span class="figcap"><b>Figure 1 </b>Network diagram for performing file operations using SFTP</span><div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface1 represents <span>100GE</span><span>1/0/1</span>.</p>
</div></div>
<br><span><img src="figure/en-us_image_0000001955564514.png"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001513030650__1.3.2"></a><a name="1.3.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Generate a local key pair and enable the SFTP server function on the SSH server so that the server and client can securely exchange data.</p>
</li><li><p>Configure SSH user information including the authentication mode<span>, service type, authorized directory</span>, user name, and password.</p>
</li><li>Configure access permissions on the SSH server to control access from SSH users.</li><li><p>Connect to the SSH server from the PC using the third-party software OpenSSH.</p>
</li></ol>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001513030650__1.3.3"></a><a name="1.3.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure an IP address for the SSH server.</span><p><pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt;<strong> system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>]<strong> sysname SSH Server</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong>
[<span class="keyword">*</span>SSH Server] <strong>interface <span>100ge</span> <span>1/0/1</span></strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SSH Server-<span>100GE</span><span>1/0/1</span>] <strong>undo portswitch</strong>
[<span class="keyword">*</span>SSH Server-<span>100GE</span><span>1/0/1</span>] <strong>ip address 10.1.1.5 255.255.255.0</strong>
[<span class="keyword">*</span>SSH Server-<span>100GE</span><span>1/0/1</span>] <strong>quit</strong>
[<span class="keyword">*</span>SSH Server] <strong>commit</strong></pre>
</p></li><li><span>On the SSH server, generate a local key pair and enable the SFTP server function.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SSH Server]<strong> rsa local-key-pair create</strong>
The key name will be:Host_Server 
The range of public key size is (2048, 4096). 
NOTE: Key pair generation will take a short while. 
Please input the modulus [default = 3072]:3072
[<span class="keyword">*</span>SSH Server]<strong> sftp server enable</strong>
<span><span>[<span class="keyword">*</span>SSH Server]</span> <strong>ssh server-source all-interface</strong></span>
[<span class="keyword">*</span>SSH Server] <strong>commit</strong></pre>
</p></li><li><span>Configure the public key algorithm, encryption algorithm, key exchange algorithm list, HMAC authentication algorithm, and minimum key length on the SSH server.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SSH Server]<strong> ssh server cipher aes128_ctr aes256_ctr aes192_ctr aes128_gcm aes256_gcm</strong>
[<span class="keyword">*</span>SSH Server]<strong> ssh server hmac sha2_256 sha2_512</strong>
[<span class="keyword">*</span>SSH Server]<strong> ssh server key-exchange dh_group_exchange_sha256</strong> <strong>dh_group16_sha512</strong>
[<span class="keyword">*</span>SSH Server]<strong> ssh server publickey rsa_sha2_256 rsa_sha2_512</strong>
[<span class="keyword">*</span>SSH Server]<strong> ssh server dh-exchange min-len 3072</strong>
[<span class="keyword">*</span>SSH Server] <strong>commit</strong></pre>
</p></li><li><span>Configure SSH user information including the authentication mode<span>, service type, authorized directory</span>, user name, and password.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SSH Server]<strong> ssh user client001 authentication-type password</strong>
Info: Succeeded in adding a new SSH user. 
<span>[<span class="keyword">*</span>SSH Server]<strong> ssh user client001 service-type sftp</strong>
[<span class="keyword">*</span>SSH Server]<strong> ssh user client001 sftp-directory <span><span><strong><span>flash</span></strong></span></span></strong></span><span><strong>:/</strong></span>
<span>[<span class="keyword">*</span>SSH Server]<strong> aaa</strong>
[<span class="keyword">*</span>SSH Server-aaa] <strong>local-user client001 password</strong></span>
Please configure the login password (8-128)
It is recommended that the password consist of four types of characters, including lowercase letters, uppercase letters, numerals and special characters. 
Please enter password:                                      
Please confirm password:                               
Info: Add a new user.
[<span class="keyword">*</span>SSH Server-aaa] <strong>local-user client001 privilege level 3</strong>
<span>[<span class="keyword">*</span>SSH Server-aaa] <strong>local-user client001 service-type ssh</strong></span>
<span>[<span class="keyword">*</span>SSH Server-aaa] <strong>quit</strong></span>
[<span class="keyword">*</span>SSH Server] <strong>commit</strong></pre>
</p></li><li><span>Configure access permissions on the SSH server.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SSH Server] <strong>acl 2001</strong>
[<span class="keyword">*</span>SSH Server-acl4-basic-2001] <strong>rule permit source 10.1.1.1 0</strong>
[<span class="keyword">*</span>SSH Server-acl4-basic-2001] <strong>rule deny source 10.1.1.2 0</strong>
[<span class="keyword">*</span>SSH Server-acl4-basic-2001] <strong>quit</strong>
[<span class="keyword">*</span>SSH Server] <strong>ssh server acl 2001</strong>
[<span class="keyword">*</span>SSH Server] <strong>commit</strong></pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001513030650__1.3.4"></a><a name="1.3.4"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p>Connect to the SSH server from the PC using the third-party software OpenSSH.</p>
<p>The Windows CLI can identify OpenSSH commands only when OpenSSH is installed on the terminal.</p>
<pre class="screen">C:/Documents and Settings/Administrator&gt; <strong>sftp client001@10.1.1.5</strong>
Connecting to 10.1.1.5...
The authenticity of host "10.1.1.5 (10.1.1.5)" can't be established.
DSA key fingerprint is 0d:48:82:fd:2f:52:1c:f0:c4:22:70:80:8f:7b:fd:78.
Are you sure you want to continue connecting (yes/no)? <strong>yes</strong>
Warning: Permanently added "10.1.1.5" (DSA) to the list of known hosts.
client001@10.1.1.5's password:
sftp&gt;</pre>
<p>After you connect to the SSH server using the third-party software, the SFTP view is displayed. You can then perform file operations in the SFTP view.</p>
</div>
<div class="postreq"><a name="EN-US_TASK_0000001513030650__1.3.5"></a><a name="1.3.5"></a><h4 class="sectiontitle">Configuration Scripts</h4><pre class="screen">#
sysname SSH Server
#
acl number 2001
 rule 5 permit source 10.1.1.1 0
 rule 10 deny source 10.1.1.2 0
#
aaa
 local-user client001 password irreversible-cipher $1d$v!=.5/:(q-$xL=\K+if"'S}&gt;k7vGP5$_ox0B@ys7.'DBHL<font style="font-size:8pt" Face="Courier New" >~</font>3*aN$
 local-user client001 service-type ssh
 local-user client001 privilege level 3
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 10.1.1.5 255.255.255.0
#
sftp server enable
ssh server-source all-interface
ssh server acl 2001
ssh user client001
ssh user client001 authentication-type password
ssh user client001 service-type sftp
ssh user client001 sftp-directory flash:
#
ssh server cipher aes128_ctr aes256_ctr aes192_ctr aes128_gcm aes256_gcm
ssh server hmac sha2_256 sha2_512
ssh server key-exchange dh_group_exchange_sha256 dh_group16_sha512
ssh server publickey rsa_sha2_256 rsa_sha2_512
ssh server dh-exchange min-len 3072
#
return</pre>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="vrp_file_cfg_0013.html">Managing Files Using SFTP
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="vrp_file_cfg_0015.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="vrp_file_cfg_0017.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>