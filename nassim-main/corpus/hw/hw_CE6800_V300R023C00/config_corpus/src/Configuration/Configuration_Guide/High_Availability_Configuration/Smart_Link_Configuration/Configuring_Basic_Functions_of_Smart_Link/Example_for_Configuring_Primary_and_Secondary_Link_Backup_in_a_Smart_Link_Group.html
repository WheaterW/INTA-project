
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Primary/Secondary Link Backup in a Smart Link Group">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="vrp_smlk_cfg_0005.html">
<meta name="DC.Relation" scheme="URI" content="vrp_smlk_cfg_018.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="Smart Link">
<meta name="featuretype" content="High Availability">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="Smart Link">
<meta name="featuretype" content="High Availability">
<meta name="featurename" content="Smart Link">
<meta name="featuretype" content="High Availability">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001176743179">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring Primary/Secondary Link Backup in a Smart Link Group</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001176743179"></a><a name="EN-US_TASK_0000001176743179"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Primary/Secondary Link Backup in a Smart Link Group</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001176743179__1.3.1"></a><a name="1.3.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>As shown in <a href="#EN-US_TASK_0000001176743179__fig_dc_vrp_bfd_cfg_200601">Figure 1</a>, dual-uplink networking is used on the user side of the network to enhance network reliability. The customer wants to eliminate loops on the network while implementing primary/secondary link redundancy and fast convergence.</p>
<div class="fignone" id="EN-US_TASK_0000001176743179__fig_dc_vrp_bfd_cfg_200601"><a name="EN-US_TASK_0000001176743179__fig_dc_vrp_bfd_cfg_200601"></a><a name="fig_dc_vrp_bfd_cfg_200601"></a><span class="figcap"><b>Figure 1 </b>Network diagram of primary/secondary link backup in a Smart Link group</span><div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface1 and interface2 represent <span>100GE</span><span>1/0/1</span> and <span>100GE</span><span>1/0/2</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0000001176743201.png"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001176743179__1.3.2"></a><a name="1.3.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><div class="p">The configuration roadmap is as follows:<ol><li><p>Create VLANs and configure interfaces to allow packets of these VLANs to pass through.</p>
</li><li><p>Create a Smart Link group on DeviceA and specify the master and slave interfaces.</p>
</li><li><p>Enable the switchback function of the Smart Link group on DeviceA so that traffic is switched back to the original primary link when the link recovers.</p>
</li><li><p>Configure DeviceA to send Flush packets.</p>
</li><li><p>Configure interfaces of DeviceB, DeviceC, and DeviceD to receive Flush packets.</p>
</li><li><p>Enable the Smart Link group on DeviceA.</p>
</li></ol>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001176743179__1.3.3"></a><a name="1.3.3"></a>
<div class="p"><div class="p"><h4 class="sectiontitle">Procedure</h4><ol><li>Configure VLANs.<p># Create VLANs on DeviceA and configure related interfaces to allow packets of these VLANs to pass through. The configurations of DeviceB, DeviceC, and DeviceD are similar to the configuration of DeviceA. For detailed configurations, see the Configuration Scripts.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view </strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname DeviceA </strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong> 
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>vlan batch 10 to 30</strong>  
[<span class="keyword">*</span>DeviceA] <strong>interface <span>100ge</span></strong><strong><span>1/0/1</span></strong> 
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>portswitch</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>port link-type trunk</strong> 
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>port trunk allow-pass vlan 10 to 30</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>stp disable</strong> 
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>quit</strong> 
[<span class="keyword">*</span>DeviceA] <strong>commit</strong> 
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>interface <span>100ge</span> <span>1/0/2</span></strong> 
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/2</span>] <strong>portswitch</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/2</span>] <strong>port link-type trunk</strong> 
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/2</span>] <strong>port trunk allow-pass vlan 10 to 30</strong> 
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/2</span>] <strong>stp disable</strong> 
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/2</span>] <strong>quit</strong> 
[<span class="keyword">*</span>DeviceA] <strong>commit</strong></pre>
</li><li>Create a Smart Link group on DeviceA and specify the master and slave interfaces.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA]<strong> smart-link group 1 </strong>
[<span class="keyword">*</span>DeviceA-smlk-group1] <strong>port <span>100ge</span> <span>1/0/1</span> master </strong>
[<span class="keyword">*</span>DeviceA-smlk-group1] <strong>port <span>100ge</span> <span>1/0/2</span> slave</strong> 
[<span class="keyword">*</span>DeviceA-smlk-group1] <strong>commit</strong></pre>
</li><li>Enable the switchback function on DeviceA and configure the WTR time.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA-smlk-group1]<strong> restore enable </strong>
[<span class="keyword">*</span>DeviceA-smlk-group1]<strong> timer wtr 120 </strong>
[<span class="keyword">*</span>DeviceA-smlk-group1] <strong>commit</strong></pre>
</li><li>Configure DeviceA to send Flush packets containing an HMAC-SHA256-encrypted password.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA-smlk-group1] <strong>flush send control-vlan 10 password hmac-sha256 123</strong> 
[<span class="keyword">*</span>DeviceA-smlk-group1] <strong>commit</strong></pre>
</li><li><p>Configure devices to receive Flush packets.</p>
<p># Configure DeviceB to receive Flush packets containing an HMAC-SHA256-encrypted password.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB] <strong>interface <span>100ge</span> <span>1/0/1</span> </strong>
[<span class="keyword">*</span>DeviceB-<span>100GE</span><span>1/0/1</span>] <strong>portswitch</strong>
[<span class="keyword">*</span>DeviceB-<span>100GE</span><span>1/0/1</span>] <strong>stp disable </strong>
[<span class="keyword">*</span>DeviceB-<span>100GE</span><span>1/0/1</span>] <strong>smart-link flush receive control-vlan 10 password hmac-sha256 123 </strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB-<span>100GE</span><span>1/0/1</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceB] <strong>commit</strong> <strong> </strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB] <strong>interface <span>100ge</span> <span>1/0/2</span> </strong>
[<span class="keyword">*</span>DeviceB-<span>100GE</span><span>1/0/2</span>] <strong>portswitch</strong>
[<span class="keyword">*</span>DeviceB-<span>100GE</span><span>1/0/2</span>] <strong>smart-link flush receive control-vlan 10 password hmac-sha256 123</strong>
[<span class="keyword">*</span>DeviceB-<span>100GE</span><span>1/0/2</span>] <strong>quit </strong>
[<span class="keyword">*</span>DeviceB] <strong>commit</strong></pre>
<p># Configure DeviceC to receive Flush packets containing an HMAC-SHA256-encrypted password.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceC] <strong>interface <span>100ge</span> <span>1/0/1</span></strong> 
[<span class="keyword">*</span>DeviceC-<span>100GE</span><span>1/0/1</span>] <strong>portswitch</strong>
[<span class="keyword">*</span>DeviceC-<span>100GE</span><span>1/0/1</span>] <strong>stp disable</strong> 
[<span class="keyword">*</span>DeviceC-<span>100GE</span><span>1/0/1</span>] <strong>smart-link flush receive control-vlan 10 password hmac-sha256 123</strong> 
[<span class="keyword">*</span>DeviceC-<span>100GE</span><span>1/0/1</span>] <strong>quit </strong> 
[<span class="keyword">*</span>DeviceC] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceC]<strong> interface <span>100ge</span> <span>1/0/2</span></strong>
[<span class="keyword">*</span>DeviceC-<span>100GE</span><span>1/0/2</span>] <strong>smart-link flush receive control-vlan 10 password hmac-sha256 123</strong>
[<span class="keyword">*</span>DeviceC-<span>100GE</span><span>1/0/2</span>] <strong>quit </strong>
[<span class="keyword">*</span>DeviceC]<strong> commit</strong></pre>
<p># Configure DeviceD to receive Flush packets containing an HMAC-SHA256-encrypted password.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceD] interface <strong><span>100ge</span></strong><strong> <span>1/0/1</span></strong>
[<span class="keyword">*</span>DeviceD-<span>100GE</span><span>1/0/1</span>] <strong>smart-link flush receive control-vlan 10 password hmac-sha256 123</strong>
[<span class="keyword">*</span>DeviceD-<span>100GE</span><span>1/0/1</span>] <strong>quit</strong> 
[<span class="keyword">*</span>DeviceD] <strong>commit</strong> 
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceD] <strong>interface <span>100ge</span> <span>1/0/2</span></strong>
[<span class="keyword">*</span>DeviceD-<span>100GE</span><span>1/0/2</span>] <strong>smart-link flush receive control-vlan 10 password hmac-sha256 123</strong>
[<span class="keyword">*</span>DeviceD-<span>100GE</span><span>1/0/2</span>]<strong> quit</strong> 
[<span class="keyword">*</span>DeviceD] <strong>commit</strong></pre>
</li><li><p>Enable the Smart Link group on DeviceA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA-smlk-group1] <strong>smart-link enable</strong> 
[<span class="keyword">*</span>DeviceA-smlk-group1] <strong>quit</strong> 
[<span class="keyword">*</span>DeviceA]<strong> commit</strong></pre>
</li></ol>
<h4 class="sectiontitle">Verifying the Configuration</h4><p># Run the <strong>display smart-link group</strong> command to view information about the Smart Link group on DeviceA. If the following information is displayed, the configuration is successful:</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA]<strong> display smart-link group 1 </strong>
Smart Link group 1 information :  
<strong>Smart Link group: enabled</strong>
<strong>Wtr-time is: 120 sec.</strong>
Load-Balance Instance: --   
Protected-VLAN reference-instance: --    
DeviceID: 00e0-fc12-3456  <strong>Control-VLAN ID: 10</strong>   
Member       Role    InstanceID  State      Flush Count  Last-Flush-Time   
-----------------------------------------------------------------------------------   
<span>100GE</span><span>1/0/1</span>    <strong>Master </strong>          0  <strong>Active</strong>              0   2020/03/22 00:00:00 UTC+00:00
<span>100GE</span><span>1/0/2</span>    <strong>Slave  </strong>          0  <strong>Inactiv</strong><strong>e</strong>            0   2020/03/22 00:00:00 UTC+00:00</pre>
<p># Run the <strong>shutdown</strong> command to shut down interface <span>100GE</span> <span>1/0/1</span>. The command output shows that interface <span>100GE</span> <span>1/0/1</span> is in the Inactive state, and interface <span>100GE</span> <span>1/0/2</span> is in the Active state.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA]<strong> interface <span>100ge</span> <span>1/0/1</span></strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>shutdown</strong> 
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>commit </strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>display smart-link group 1 </strong>
Smart Link group 1 information :   
Smart Link group: enabled   
Wtr-time is: 120 sec.   
Load-Balance Instance: --                                                                                                            
Protected-VLAN reference-instance: --   
DeviceID: 00e0-fc12-3456  
Control-VLAN ID: 10   
Member       Role    InstanceID  State      Flush Count  Last-Flush-Time   
------------------------------------------------------------------------------------   
<span>100GE</span><span>1/0/1</span>    <strong>Master</strong>          0  <strong>I</strong><strong>nactive </strong>           0   2020/03/22 00:00:00 UTC+00:00
<span>100GE</span><span>1/0/2</span>    <strong>Slave</strong>           0  <strong>Active</strong>              1    2020/03/22 10:34:46 UTC+00:00</pre>
<p># Run the <strong>undo shutdown</strong> command to enable interface <span>100GE</span> <span>1/0/1</span>.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>undo shutdown</strong> 
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>commit</strong></pre>
<p># Check the interface state after 120 seconds. The command output shows that interface <span>100GE</span> <span>1/0/1</span> is in the Active state, and interface <span>100GE</span> <span>1/0/2</span> is in the Inactive state.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>display smart-link group 1</strong> 
Smart Link group 1 information :   
Smart Link group: enabled   
Wtr-time is: 120 sec.   
Load-Balance Instance: --                                                                                                         
Protected-VLAN reference-instance: --   
DeviceID: 00e0-fc12-3456  
Control-VLAN ID: 10   
Member       Role    InstanceID  State      Flush Count  Last-Flush-Time   
-----------------------------------------------------------------------------------   
<span>100GE</span><span>1/0/1</span>    Master        0     <strong>A</strong><strong>ctive  </strong>            1   2020/03/22 10:35:46 UTC+00:00
<span>100GE</span><span>1/0/2</span>    Slave         0  <strong>   I</strong><strong>nactive </strong>           1   2020/03/22 10:34:46 UTC+00:00</pre>
</div>
</div></div>
<div class="example"><a name="EN-US_TASK_0000001176743179__1.3.4"></a><a name="1.3.4"></a><h4 class="sectiontitle">Configuration Scripts</h4><ul><li><p>DeviceA</p>
<pre class="screen"># 
sysname DeviceA 
# 
vlan batch 10 to 30 
# 
interface <span>100GE</span><span>1/0/1</span>
 port link-type trunk  
 port trunk allow-pass vlan 10 to 30  
 stp disable 
# 
interface <span>100GE</span><span>1/0/2</span>
 port link-type trunk  
 port trunk allow-pass vlan 10 to 30  
 stp disable 
# 
smart-link group 1  
 restore enable  
 smart-link enable  
 port <span>100GE</span><span>1/0/1</span> master  
 port <span>100GE</span><span>1/0/2</span> slave  
 timer wtr 120  
 flush send control-vlan 10 password hmac-sha256 %^%#c+p$W[eADi"zB!@-Nh"jtHO)L7YQ2VwcC27#D/%^%#
# 
return</pre>
</li><li><p>DeviceB</p>
<pre class="screen"># 
sysname DeviceB 
# 
vlan batch 10 to 30 
# 
interface <span>100GE</span><span>1/0/1</span>
 port link-type trunk  
 port trunk allow-pass vlan 10 to 30  
 stp disable  
 smart-link flush receive control-vlan 10 password hmac-sha256 %^%#Ep7t@o-'kXRUn$Lwgf22l+{8Ryqof3i+6z&amp;$V\&lt;/%^%# 
# 
interface <span>100GE</span><span>1/0/2</span>
 port link-type trunk  
 port trunk allow-pass vlan 10 to 30  
 smart-link flush receive control-vlan 10 password hmac-sha256 %^%#iu+l&amp;X\dP3}",:H'1F#PBIp`1a3GB'v0sUK]2zxO%^%# 
# 
return</pre>
</li><li>DeviceC<pre class="screen"># 
sysname DeviceC 
# 
vlan batch 10 to 30 
# 
interface <span>100GE</span><span>1/0/1</span>
 port link-type trunk  
 port trunk allow-pass vlan 10 to 30  
 stp disable  
 smart-link flush receive control-vlan 10 password hmac-sha256 %^%#[:95Guh"OENC;];s3nN8K++m=^Bg*ZtRBRO0ZV66%^%# 
# interface <span>100GE</span><span>1/0/2</span>
 port link-type trunk  
 port trunk allow-pass vlan 10 to 30  
 smart-link flush receive control-vlan 10 password hmac-sha256 %^%#yQWMQ1a{,`#C)IvAvt16MDIzYY!.\E#Q&gt;6qE=%^%# 
# 
return</pre>
</li><li>DeviceD<pre class="screen"># 
sysname DeviceD 
# 
vlan batch 10 to 30 
# 
interface <span>100GE</span><span>1/0/1</span>
 port link-type trunk  
 port trunk allow-pass vlan 10 to 30  
 smart-link flush receive control-vlan 10 password hmac-sha256 #;Bw$EMeC,".A@u1Xd%CO];DdK'+'Q*Xi,0'M%46+%^%# 
# 
interface <span>100GE</span><span>1/0/2</span>
 port link-type trunk  
 port trunk allow-pass vlan 10 to 30  
 smart-link flush receive control-vlan 10 password hmac-sha256 %^%#wT5!@We"Pj1w*Ch$%-27+B.YD&amp;+=H&gt;(%!{s\'%^%# 
# 
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="vrp_smlk_cfg_0005.html">Configuring Basic Functions of Smart Link
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="vrp_smlk_cfg_018.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>
</body>
</html>