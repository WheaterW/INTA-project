
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Association Between Redirection to a Next-Hop Address and NQA">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="galaxy_qos_redirect_cfg_0001.html">
<meta name="DC.Relation" scheme="URI" content="galaxy_qos_redirect_cfg_0007.html">
<meta name="DC.Relation" scheme="URI" content="galaxy_qos_redirect_cfg_0009.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="Redirection">
<meta name="featuretype" content="QoS">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="Redirection">
<meta name="featuretype" content="QoS">
<meta name="featuretype" content="QoS">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001564130229">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring Association Between Redirection to a Next-Hop Address and NQA</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001564130229"></a><a name="EN-US_TASK_0000001564130229"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Association Between Redirection to a Next-Hop Address and NQA</h1>
<div class="taskbody" id="taskbody1587385156061"><div class="context"><a name="EN-US_TASK_0000001564130229__1.3.1"></a><a name="1.3.1"></a>
<div class="p" id="EN-US_TASK_0000001564130229__context1141145180175348"><h4 class="sectiontitle">Networking Requirements</h4><p id="EN-US_TASK_0000001564130229__p611067204183249">In <a href="#EN-US_TASK_0000001564130229__fig391718398817">Figure 1</a>, <span class="keyword" id="EN-US_TASK_0000001564130229__keyword0812176113112">DeviceA</span> is the upper-layer device of <span class="keyword" id="EN-US_TASK_0000001564130229__keyword1588817103316">DeviceB</span> and <span class="keyword" id="EN-US_TASK_0000001564130229__keyword4194184220512">DeviceB</span> is the user gateway. There are reachable routes between <span class="keyword" id="EN-US_TASK_0000001564130229__keyword17361020456">DeviceA</span> and <span class="keyword" id="EN-US_TASK_0000001564130229__keyword659815366120">DeviceB</span>. <span class="keyword" id="EN-US_TASK_0000001564130229__keyword164271656131410">DeviceA</span> is connected to the Internet through two links: high-speed link with the gateway at 10.1.20.1/24 and low-speed link with the gateway at 10.1.30.1/24. A default route has been configured on <span class="keyword" id="EN-US_TASK_0000001564130229__keyword1464337101615">DeviceA</span> to ensure that traffic is transmitted through the high-speed link by default. The customer requirements are as follows:</p>
<ul id="EN-US_TASK_0000001564130229__ul1564856941183249"><li id="EN-US_TASK_0000001564130229__li1674223769183249">Packets from the network segment 192.168.101.0/24 are redirected to the low-speed link for transmission, alleviating the bandwidth pressure of the high-speed link.</li><li id="EN-US_TASK_0000001564130229__li862918807183249">If the low-speed link fails, packets from the network segment 192.168.101.0/24 can be rapidly switched back to the high-speed link to minimize communication interruption caused by the link fault.</li></ul>
<div class="fignone" id="EN-US_TASK_0000001564130229__fig391718398817"><a name="EN-US_TASK_0000001564130229__fig391718398817"></a><a name="fig391718398817"></a><span class="figcap"><b>Figure 1 </b>Network diagram of association between redirection to a next-hop address and NQA</span><div class="note" id="EN-US_TASK_0000001564130229__note163690483552"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0000001564130229__p113691482557">In this example, interface 1, interface 2, and interface 3 represent <span>100GE</span> <span>1/0/1</span>, <span>100GE</span> <span>1/0/2</span>, and <span>100GE</span> <span>1/0/3</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" id="EN-US_TASK_0000001564130229__image303815995175329" src="figure/en-us_image_0000001563890149.png"></span></div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001564130229__1.3.2"></a><a name="1.3.2"></a><h4 class="sectiontitle">Procedure</h4>
<ol id="EN-US_TASK_0000001564130229__steps796316206183249"><li id="EN-US_TASK_0000001564130229__step858559510183249"><span id="EN-US_TASK_0000001564130229__cmd867060377183249">Create VLANs and configure interfaces.</span><p><p id="EN-US_TASK_0000001564130229__p2138858161419"># Configure <span class="keyword" id="EN-US_TASK_0000001564130229__keyword141701819171417">DeviceA</span>.</p>
<pre class="screen" id="EN-US_TASK_0000001564130229__screen402924605183249">&lt;<span class="keyword" id="EN-US_TASK_0000001564130229__keyword17299145917166">HUAWEI</span>&gt; <strong id="EN-US_TASK_0000001564130229__b1484425534183249">system-view</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font><span class="keyword" id="EN-US_TASK_0000001564130229__keyword121931295166">HUAWEI</span>] <strong id="EN-US_TASK_0000001564130229__b1918269990183249">sysname <span class="keyword" id="EN-US_TASK_0000001564130229__keyword79624212160">DeviceA</span></strong>
[*<span class="keyword" id="EN-US_TASK_0000001564130229__keyword72963921711">HUAWEI</span>] <a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001564130229__cmdname12291039201715">commit</span></b></a>
[<font style="font-size:8pt" Face="Courier New" >~</font><span class="keyword" id="EN-US_TASK_0000001564130229__keyword6603132501610">DeviceA</span>] <strong id="EN-US_TASK_0000001564130229__b1020733635183249">vlan batch 10 20 30</strong>
[*<span class="keyword" id="EN-US_TASK_0000001564130229__keyword974017112314">DeviceA</span>] <strong id="EN-US_TASK_0000001564130229__b1831012164183249">interface </strong><strong id="EN-US_TASK_0000001564130229__b1943417321183249"><span>100ge</span> <span>1/0/1</span></strong>
[*<span class="keyword" id="EN-US_TASK_0000001564130229__keyword1850255842519">DeviceA</span>-<span>100GE</span><span>1/0/1</span>] <strong id="EN-US_TASK_0000001564130229__b350295892514">portswitch</strong>
[*<span class="keyword" id="EN-US_TASK_0000001564130229__keyword645532514286">DeviceA</span>-<span>100GE</span><span>1/0/1</span>] <strong id="EN-US_TASK_0000001564130229__b228789786183249">port link-type trunk</strong>
[*<span class="keyword" id="EN-US_TASK_0000001564130229__keyword873418282283">DeviceA</span>-<span>100GE</span><span>1/0/1</span>] <strong id="EN-US_TASK_0000001564130229__b514237214183249">port trunk allow-pass vlan 10</strong>
[*<span class="keyword" id="EN-US_TASK_0000001564130229__keyword17101113192816">DeviceA</span>-<span>100GE</span><span>1/0/1</span>] <strong id="EN-US_TASK_0000001564130229__b1914690927183249">quit</strong>
[*<span class="keyword" id="EN-US_TASK_0000001564130229__keyword1716693422815">DeviceA</span>] <strong id="EN-US_TASK_0000001564130229__b1451560145183249">interface </strong><strong id="EN-US_TASK_0000001564130229__b2042111518296"><span>100ge</span> <span>1/0/2</span></strong>
[*<span class="keyword" id="EN-US_TASK_0000001564130229__keyword1428135272717">DeviceA</span>-<span>100GE</span><span>1/0/2</span>] <strong id="EN-US_TASK_0000001564130229__b2281165212720">portswitch</strong>
[*<span class="keyword" id="EN-US_TASK_0000001564130229__keyword10906953162819">DeviceA</span>-<span>100GE</span><span>1/0/2</span>] <strong id="EN-US_TASK_0000001564130229__b575144456183249">port link-type trunk</strong>
[*<span class="keyword" id="EN-US_TASK_0000001564130229__keyword13798228172914">DeviceA</span>-<span>100GE</span><span>1/0/2</span>] <strong id="EN-US_TASK_0000001564130229__b1573622469183249">port trunk allow-pass vlan 20</strong>
[*<span class="keyword" id="EN-US_TASK_0000001564130229__keyword237033214297">DeviceA</span>-<span>100GE</span><span>1/0/2</span>] <strong id="EN-US_TASK_0000001564130229__b99260918183249">quit</strong>
[*<span class="keyword" id="EN-US_TASK_0000001564130229__keyword19255103832310">DeviceA</span>] <strong id="EN-US_TASK_0000001564130229__b173598341911">interface <span>100ge</span><span>1/0/3</span> </strong>
[*<span class="keyword" id="EN-US_TASK_0000001564130229__keyword18362191963410">DeviceA</span>-<span>100GE</span><span>1/0/3</span>] <strong id="EN-US_TASK_0000001564130229__b33605341390">portswitch</strong>
[*<span class="keyword" id="EN-US_TASK_0000001564130229__keyword11925012312">DeviceA</span>-<span>100GE</span><span>1/0/3</span>] <strong id="EN-US_TASK_0000001564130229__b17360153417918">port link-type trunk</strong>
[*<span class="keyword" id="EN-US_TASK_0000001564130229__keyword735675210238">DeviceA</span>-<span>100GE</span><span>1/0/3</span>] <strong id="EN-US_TASK_0000001564130229__b19360193419919">port trunk allow-pass vlan 30</strong>
[*<span class="keyword" id="EN-US_TASK_0000001564130229__keyword148221948135112">DeviceA</span>-<span>100GE</span><span>1/0/3</span>] <strong id="EN-US_TASK_0000001564130229__b33605344919">quit</strong>
[*<span class="keyword" id="EN-US_TASK_0000001564130229__keyword11937112119304">DeviceA</span>] <strong id="EN-US_TASK_0000001564130229__b623431143010">interface vlanif 10</strong>
[*<span class="keyword" id="EN-US_TASK_0000001564130229__keyword19162203153017">DeviceA</span>-Vlanif10] <strong id="EN-US_TASK_0000001564130229__b172349114308">ip address 10.1.20.2 24</strong>
[*<span class="keyword" id="EN-US_TASK_0000001564130229__keyword1363512375309">DeviceA</span>-Vlanif10] <strong id="EN-US_TASK_0000001564130229__b17235011103020">quit</strong>
[*<span class="keyword" id="EN-US_TASK_0000001564130229__keyword2211849203020">DeviceA</span>] <strong id="EN-US_TASK_0000001564130229__b15235131143017">interface vlanif 20</strong>
[*<span class="keyword" id="EN-US_TASK_0000001564130229__keyword42791255173010">DeviceA</span>-Vlanif20] <strong id="EN-US_TASK_0000001564130229__b142354112301">ip address 10.1.30.2 24</strong>
[*<span class="keyword" id="EN-US_TASK_0000001564130229__keyword616011319319">DeviceA</span>-Vlanif20] <strong id="EN-US_TASK_0000001564130229__b1623571110304">quit</strong>
[*<span class="keyword" id="EN-US_TASK_0000001564130229__keyword1253235218122">DeviceA</span>] <strong id="EN-US_TASK_0000001564130229__b353245281220">interface vlanif 30</strong>
[*<span class="keyword" id="EN-US_TASK_0000001564130229__keyword253225251213">DeviceA</span>-Vlanif30] <strong id="EN-US_TASK_0000001564130229__b1053275217123">ip address 10.1.10.2 24</strong>
[*<span class="keyword" id="EN-US_TASK_0000001564130229__keyword5532452121213">DeviceA</span>-Vlanif30] <strong id="EN-US_TASK_0000001564130229__b8532452191218">quit</strong>
[*<span class="keyword" id="EN-US_TASK_0000001564130229__keyword01660506316">DeviceA</span>] <a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001564130229__cmdname7166115013310">commit</span></b></a></pre>
<p id="EN-US_TASK_0000001564130229__p1909203327"># Configure <span class="keyword" id="EN-US_TASK_0000001564130229__keyword191451132141417">DeviceC</span>.</p>
<pre class="screen" id="EN-US_TASK_0000001564130229__screen150152063212">&lt;<span class="keyword" id="EN-US_TASK_0000001564130229__keyword0032053218">HUAWEI</span>&gt; <strong id="EN-US_TASK_0000001564130229__b60142073213">system-view</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font><span class="keyword" id="EN-US_TASK_0000001564130229__keyword903209322">HUAWEI</span>] <strong id="EN-US_TASK_0000001564130229__b1101220173215">sysname <span class="keyword" id="EN-US_TASK_0000001564130229__keyword12907971568">DeviceC</span></strong>
[*<span class="keyword" id="EN-US_TASK_0000001564130229__keyword2032016323">HUAWEI</span>] <a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001564130229__cmdname141720113218">commit</span></b></a>
[<font style="font-size:8pt" Face="Courier New" >~</font><span class="keyword" id="EN-US_TASK_0000001564130229__keyword13891211569">DeviceC</span>] <strong id="EN-US_TASK_0000001564130229__b14182014321">vlan batch 10</strong>
[*<span class="keyword" id="EN-US_TASK_0000001564130229__keyword1272541312614">DeviceC</span>] <strong id="EN-US_TASK_0000001564130229__b11520103217">interface </strong><strong id="EN-US_TASK_0000001564130229__b181520183214"><span>100ge</span> <span>1/0/1</span></strong>
[*<span class="keyword" id="EN-US_TASK_0000001564130229__keyword1535221820613">DeviceC</span>-<span>100GE</span><span>1/0/1</span>] <strong id="EN-US_TASK_0000001564130229__b1015206321">portswitch</strong>
[*<span class="keyword" id="EN-US_TASK_0000001564130229__keyword1961320201665">DeviceC</span>-<span>100GE</span><span>1/0/1</span>] <strong id="EN-US_TASK_0000001564130229__b51320103216">port link-type trunk</strong>
[*<span class="keyword" id="EN-US_TASK_0000001564130229__keyword106041822566">DeviceC</span>-<span>100GE</span><span>1/0/1</span>] <strong id="EN-US_TASK_0000001564130229__b18132011325">port trunk allow-pass vlan 10</strong>
[*<span class="keyword" id="EN-US_TASK_0000001564130229__keyword6489172512613">DeviceC</span>-<span>100GE</span><span>1/0/1</span>] <strong id="EN-US_TASK_0000001564130229__b17110203325">quit</strong>
[*<span class="keyword" id="EN-US_TASK_0000001564130229__keyword7587162710620">DeviceC</span>] <strong id="EN-US_TASK_0000001564130229__b12122017325">interface vlanif 10</strong>
[*<span class="keyword" id="EN-US_TASK_0000001564130229__keyword177212915615">DeviceC</span>-Vlanif10] <strong id="EN-US_TASK_0000001564130229__b10215201320">ip address 10.1.20.1 24</strong>
[*<span class="keyword" id="EN-US_TASK_0000001564130229__keyword17161131268">DeviceC</span>-Vlanif10] <strong id="EN-US_TASK_0000001564130229__b421320103210">quit</strong>
[*<span class="keyword" id="EN-US_TASK_0000001564130229__keyword92086351665">DeviceC</span>] <a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001564130229__cmdname183102073219">commit</span></b></a></pre>
<p id="EN-US_TASK_0000001564130229__p422810196362"># Configure <span class="keyword" id="EN-US_TASK_0000001564130229__keyword4131151419719">DeviceD</span>.</p>
<pre class="screen" id="EN-US_TASK_0000001564130229__screen722811973618">&lt;<span class="keyword" id="EN-US_TASK_0000001564130229__keyword11228161983616">HUAWEI</span>&gt; <strong id="EN-US_TASK_0000001564130229__b1122817196365">system-view</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font><span class="keyword" id="EN-US_TASK_0000001564130229__keyword1228191920363">HUAWEI</span>] <strong id="EN-US_TASK_0000001564130229__b1228181963616">sysname <span class="keyword" id="EN-US_TASK_0000001564130229__keyword224512173718">DeviceD</span></strong>
[*<span class="keyword" id="EN-US_TASK_0000001564130229__keyword122841912364">HUAWEI</span>] <a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001564130229__cmdname19228719203617">commit</span></b></a>
[<font style="font-size:8pt" Face="Courier New" >~</font><span class="keyword" id="EN-US_TASK_0000001564130229__keyword139151318379">DeviceD</span>] <strong id="EN-US_TASK_0000001564130229__b622881923613">vlan batch 20</strong>
[*<span class="keyword" id="EN-US_TASK_0000001564130229__keyword53591722675">DeviceD</span>] <strong id="EN-US_TASK_0000001564130229__b62281319123610">interface </strong><strong id="EN-US_TASK_0000001564130229__b5228131943619"><span>100ge</span> <span>1/0/1</span></strong>
[*<span class="keyword" id="EN-US_TASK_0000001564130229__keyword5361132513711">DeviceD</span>-<span>100GE</span><span>1/0/1</span>] <strong id="EN-US_TASK_0000001564130229__b1322811919366">portswitch</strong>
[*<span class="keyword" id="EN-US_TASK_0000001564130229__keyword0882527874">DeviceD</span>-<span>100GE</span><span>1/0/1</span>] <strong id="EN-US_TASK_0000001564130229__b22291619193616">port link-type trunk</strong>
[*<span class="keyword" id="EN-US_TASK_0000001564130229__keyword07072029378">DeviceD</span>-<span>100GE</span><span>1/0/1</span>] <strong id="EN-US_TASK_0000001564130229__b10229919193620">port trunk allow-pass vlan 20</strong>
[*<span class="keyword" id="EN-US_TASK_0000001564130229__keyword1455518311476">DeviceD</span>-<span>100GE</span><span>1/0/1</span>] <strong id="EN-US_TASK_0000001564130229__b022981903620">quit</strong>
[*<span class="keyword" id="EN-US_TASK_0000001564130229__keyword11777113315716">DeviceD</span>] <strong id="EN-US_TASK_0000001564130229__b14230161918363">interface vlanif 20</strong>
[*<span class="keyword" id="EN-US_TASK_0000001564130229__keyword1816015411279">DeviceD</span>-Vlanif20] <strong id="EN-US_TASK_0000001564130229__b17230181915367">ip address 10.1.30.1 24</strong>
[*<span class="keyword" id="EN-US_TASK_0000001564130229__keyword355513371272">DeviceD</span>-Vlanif20] <strong id="EN-US_TASK_0000001564130229__b152308193368">quit</strong>
[*<span class="keyword" id="EN-US_TASK_0000001564130229__keyword56716431779">DeviceD</span>] <a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001564130229__cmdname6230121913365">commit</span></b></a></pre>
</p></li><li id="EN-US_TASK_0000001564130229__step1210948868183249"><span id="EN-US_TASK_0000001564130229__cmd715101857183249">On <span class="keyword" id="EN-US_TASK_0000001564130229__keyword126841147153913">DeviceA</span>, configure an NQA test instance.</span><p><pre class="screen" id="EN-US_TASK_0000001564130229__screen1611528464183249">[<font style="font-size:8pt" Face="Courier New" >~</font><span class="keyword" id="EN-US_TASK_0000001564130229__keyword116141114505">DeviceA</span>]<strong id="EN-US_TASK_0000001564130229__b1314246238183249"> nqa test-instance user test</strong>
[*<span class="keyword" id="EN-US_TASK_0000001564130229__keyword369085215120">DeviceA</span>-nqa-user-test]<strong id="EN-US_TASK_0000001564130229__b99339455114"> test-type icmp</strong>
[*<span class="keyword" id="EN-US_TASK_0000001564130229__keyword5446654155317">DeviceA</span>-nqa-user-test]<strong id="EN-US_TASK_0000001564130229__b377008308183249"> destination-address ipv4 10.1.30.1</strong>
[*<span class="keyword" id="EN-US_TASK_0000001564130229__keyword1184235610533">DeviceA</span>-nqa-user-test]<strong id="EN-US_TASK_0000001564130229__b1577533362183249"> frequency 11</strong>
[*<span class="keyword" id="EN-US_TASK_0000001564130229__keyword1607185925316">DeviceA</span>-nqa-user-test]<strong id="EN-US_TASK_0000001564130229__b425784783183249"> probe-count 2</strong>
[*<span class="keyword" id="EN-US_TASK_0000001564130229__keyword914312295416">DeviceA</span>-nqa-user-test]<strong id="EN-US_TASK_0000001564130229__b1226320436183249"> interval seconds 5</strong>
[*<span class="keyword" id="EN-US_TASK_0000001564130229__keyword81076511543">DeviceA</span>-nqa-user-test]<strong id="EN-US_TASK_0000001564130229__b1867896030183249"> timeout 4</strong>
[*<span class="keyword" id="EN-US_TASK_0000001564130229__keyword749515725417">DeviceA</span>-nqa-user-test]<strong id="EN-US_TASK_0000001564130229__b1452253771183249"> start now</strong>
[*<span class="keyword" id="EN-US_TASK_0000001564130229__keyword1327561165411">DeviceA</span>-nqa-user-test]<strong id="EN-US_TASK_0000001564130229__b1282208867183249"> quit</strong>
[*<span class="keyword" id="EN-US_TASK_0000001564130229__keyword394714291544">DeviceA</span>] <a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001564130229__cmdname1494762915545">commit</span></b></a></pre>
</p></li><li id="EN-US_TASK_0000001564130229__step1211624724183249"><span id="EN-US_TASK_0000001564130229__cmd1336795414183249">Configure an ACL rule.</span><p><p id="EN-US_TASK_0000001564130229__p2116907788183249"># Create advanced ACL 3001 on <span class="keyword" id="EN-US_TASK_0000001564130229__keyword1741614273211">DeviceA</span> to allow packets from the network segment 192.168.101.0/24 to pass through.</p>
<pre class="screen" id="EN-US_TASK_0000001564130229__screen506757212183249">[<font style="font-size:8pt" Face="Courier New" >~</font><span class="keyword" id="EN-US_TASK_0000001564130229__keyword1647195620211">DeviceA</span>] <strong id="EN-US_TASK_0000001564130229__b294117982183249">acl 3001</strong>
[*<span class="keyword" id="EN-US_TASK_0000001564130229__keyword36331861435">DeviceA</span>-acl4-advance-3001] <strong id="EN-US_TASK_0000001564130229__b1596400932183249">rule permit ip source 192.168.101.0 0.0.0.255</strong>
[*<span class="keyword" id="EN-US_TASK_0000001564130229__keyword6252814539">DeviceA</span>-acl4-advance-3001] <strong id="EN-US_TASK_0000001564130229__b738417002183249">quit</strong>
[*<span class="keyword" id="EN-US_TASK_0000001564130229__keyword999414405416">DeviceA</span>] <a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001564130229__cmdname9994104012413">commit</span></b></a></pre>
</p></li><li id="EN-US_TASK_0000001564130229__step819947731183249"><span id="EN-US_TASK_0000001564130229__cmd458952118183249">Configure a traffic classifier.</span><p><p id="EN-US_TASK_0000001564130229__p1003404141183249"># Create a traffic classifier <strong id="EN-US_TASK_0000001564130229__b18343510122">c1</strong> on <span class="keyword" id="EN-US_TASK_0000001564130229__keyword71081411047">DeviceA</span> and reference ACL 3001.</p>
<pre class="screen" id="EN-US_TASK_0000001564130229__screen1379082451183249">[<font style="font-size:8pt" Face="Courier New" >~</font><span class="keyword" id="EN-US_TASK_0000001564130229__keyword195644521149">DeviceA</span>] <strong id="EN-US_TASK_0000001564130229__b181384602183249">traffic classifier c1</strong>
[*<span class="keyword" id="EN-US_TASK_0000001564130229__keyword138561258445">DeviceA</span>-classifier-c1] <strong id="EN-US_TASK_0000001564130229__b679991729183249">if-match acl 3001</strong>
[*<span class="keyword" id="EN-US_TASK_0000001564130229__keyword56381412512">DeviceA</span>-classifier-c1] <strong id="EN-US_TASK_0000001564130229__b1980955812183249">quit</strong>
[*<span class="keyword" id="EN-US_TASK_0000001564130229__keyword1653618461141">DeviceA</span>] <a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001564130229__cmdname13536114614417">commit</span></b></a></pre>
</p></li><li id="EN-US_TASK_0000001564130229__step1091616628183249"><span id="EN-US_TASK_0000001564130229__cmd847870475183249">Configure a traffic behavior.</span><p><p id="EN-US_TASK_0000001564130229__p456872015183249"># Create a traffic behavior <strong id="EN-US_TASK_0000001564130229__b1826316196128">b1</strong> on <span class="keyword" id="EN-US_TASK_0000001564130229__keyword15197141456">DeviceA</span> to redirect packets to the IP address 10.1.30.1, and associate NQA with redirection to a next-hop address.</p>
<pre class="screen" id="EN-US_TASK_0000001564130229__screen2044151247183249">[<font style="font-size:8pt" Face="Courier New" >~</font><span class="keyword" id="EN-US_TASK_0000001564130229__keyword124399428512">DeviceA</span>] <strong id="EN-US_TASK_0000001564130229__b231999893183249">traffic behavior b1</strong>
[*<span class="keyword" id="EN-US_TASK_0000001564130229__keyword121007489516">DeviceA</span>-behavior-b1] <strong id="EN-US_TASK_0000001564130229__b157902016183249">redirect nexthop 10.1.30.1 track nqa user test</strong>
[*<span class="keyword" id="EN-US_TASK_0000001564130229__keyword54111509520">DeviceA</span>-behavior-b1] <strong id="EN-US_TASK_0000001564130229__b1817054940183249">quit</strong>
[*<span class="keyword" id="EN-US_TASK_0000001564130229__keyword121091571158">DeviceA</span>] <a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001564130229__cmdname201093578514">commit</span></b></a></pre>
</p></li><li id="EN-US_TASK_0000001564130229__step1309825220183249"><span id="EN-US_TASK_0000001564130229__cmd377607143183249">Configure a traffic policy and apply it to an interface.</span><p><p id="EN-US_TASK_0000001564130229__p196996471668"># Create a traffic policy <strong id="EN-US_TASK_0000001564130229__b1986684201313">p1</strong> on <span class="keyword" id="EN-US_TASK_0000001564130229__keyword097512144612">DeviceA</span>, and bind the traffic classifier <strong id="EN-US_TASK_0000001564130229__b138717411310">c1</strong> and traffic behavior <strong id="EN-US_TASK_0000001564130229__b16871148134">b1</strong> to the traffic policy.</p>
<pre class="screen" id="EN-US_TASK_0000001564130229__screen472768152183249">[<font style="font-size:8pt" Face="Courier New" >~</font><span class="keyword" id="EN-US_TASK_0000001564130229__keyword23521332561">DeviceA</span>] <strong id="EN-US_TASK_0000001564130229__b609896791183249">traffic policy p1</strong>
[*<span class="keyword" id="EN-US_TASK_0000001564130229__keyword18204119572">DeviceA</span>-trafficpolicy-p1] <strong id="EN-US_TASK_0000001564130229__b961250514183249">classifier c1 behavior b1</strong>
[*<span class="keyword" id="EN-US_TASK_0000001564130229__keyword11401111120719">DeviceA</span>-trafficpolicy-p1] <strong id="EN-US_TASK_0000001564130229__b1728311360183249">quit</strong>
[*<span class="keyword" id="EN-US_TASK_0000001564130229__keyword563910189716">DeviceA</span>] <a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001564130229__cmdname9639118474">commit</span></b></a></pre>
<p id="EN-US_TASK_0000001564130229__p1110479949183249"># Apply traffic policy <strong id="EN-US_TASK_0000001564130229__b9688171921316">p1</strong> to the inbound direction of <span>100GE</span> <span>1/0/3</span>.</p>
<pre class="screen" id="EN-US_TASK_0000001564130229__screen356117790183249">[<font style="font-size:8pt" Face="Courier New" >~</font><span class="keyword" id="EN-US_TASK_0000001564130229__keyword5290140885">DeviceA</span>] <strong id="EN-US_TASK_0000001564130229__b781227083183249">interface </strong><strong id="EN-US_TASK_0000001564130229__b1376199110183249"><span>100ge</span> <span>1/0/3</span></strong>
[*<span class="keyword" id="EN-US_TASK_0000001564130229__keyword165445579121">DeviceA</span>-<span>100GE</span><span>1/0/3</span>] <strong id="EN-US_TASK_0000001564130229__b1245348616183249">traffic-policy p1 inbound</strong>
[*<span class="keyword" id="EN-US_TASK_0000001564130229__keyword101118112135">DeviceA</span>-<span>100GE</span><span>1/0/3</span>] <strong id="EN-US_TASK_0000001564130229__b738414712132">quit</strong>
[*<span class="keyword" id="EN-US_TASK_0000001564130229__keyword14851141471317">DeviceA</span>] <a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001564130229__cmdname16851914131314">commit</span></b></a>
[<font style="font-size:8pt" Face="Courier New" >~</font><span class="keyword" id="EN-US_TASK_0000001564130229__keyword194531538182319">DeviceA</span>] <strong id="EN-US_TASK_0000001564130229__b1681155811235">quit</strong></pre>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0000001564130229__example567395428175348"><a name="EN-US_TASK_0000001564130229__1.3.3"></a><a name="1.3.3"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p id="EN-US_TASK_0000001564130229__p12725545122018"># Check the ACL configuration.</p>
<pre class="screen" id="EN-US_TASK_0000001564130229__screen37259459207">&lt;<span class="keyword" id="EN-US_TASK_0000001564130229__keyword11531048112310">DeviceA</span>&gt; <strong id="EN-US_TASK_0000001564130229__b1972519454206">display acl 3001</strong>
Advanced ACL 3001, 1 rule                                                                                                           
ACL's step is 5                                                                                                                     
 rule 5 permit ip source 192.168.101.0 0.0.0.255 (0 times matched)</pre>
<p id="EN-US_TASK_0000001564130229__p983647611175348"># Check the traffic classifier configuration.</p>
<pre class="screen" id="EN-US_TASK_0000001564130229__screen1625033182914">&lt;<span class="keyword" id="EN-US_TASK_0000001564130229__keyword6223115182316">DeviceA</span>&gt; <strong id="EN-US_TASK_0000001564130229__b42507314291">display traffic classifier</strong>
  Traffic Classifier Information:
    Classifier: c1                               
      Type: OR                                   
      Rule(s):                                   
        if-match acl 3001

Total classifier number is 1</pre>
<p id="EN-US_TASK_0000001564130229__p485839082175348"># Check the traffic policy configuration.</p>
<pre class="screen" id="EN-US_TASK_0000001564130229__screen1739516180310">&lt;<span class="keyword" id="EN-US_TASK_0000001564130229__keyword385718537230">DeviceA</span>&gt; <strong id="EN-US_TASK_0000001564130229__b17395161817312">display traffic policy</strong>
  Traffic Policy Information:                                                                                                       
    Policy: p1                                                                                                                      
      Classifier: c1                                                                                                                
        Type: OR                                                                                                                    
      Behavior: b1                                                                                                                  
        Redirect:                                                                                                                   
          Redirect nexthop                                                                                                          
          10.1.30.1 track nqa user test

Total policy number is 1</pre>
<p id="EN-US_TASK_0000001564130229__p1249506835175348"># Check the traffic policy application records.</p>
<pre class="screen" id="EN-US_TASK_0000001564130229__screen742316760175348">&lt;<span class="keyword" id="EN-US_TASK_0000001564130229__keyword115962567237">DeviceA</span>&gt; <strong id="EN-US_TASK_0000001564130229__b1095114097175348">display traffic-policy applied-record</strong>
Total records : 1 
--------------------------------------------------------------------------------     
Policy Type/Name                     Apply Parameter             Slot State          
--------------------------------------------------------------------------------            
p1                                   <span>100GE</span><span>1/0/3</span>(IN)               <span>1</span>    success        
--------------------------------------------------------------------------------  </pre>
<p id="EN-US_TASK_0000001564130229__p1284982953419"># Check the NQA test result. If "Completion:success" and "Lost packet ratio: 0 %" are displayed, the NQA test succeeds and the link is normal.</p>
<pre class="screen" id="EN-US_TASK_0000001564130229__screen1284910296349">&lt;<span class="keyword" id="EN-US_TASK_0000001564130229__keyword1437965915236">DeviceA</span>&gt; <strong id="EN-US_TASK_0000001564130229__b2849192918349">display nqa results test-instance user test</strong>

 NQA entry(user, test) :test flag is active ,test type is ICMP 
  1 . Test 1 result The test is finished
   Send operation times: 2              Receive response times: 2          
   Completion:success                   RTD over thresholds number: 0       
   Attempts number:1                    Drop operation number:0            
   Disconnect operation number:0        Operation timeout number:0         
   System busy operation number:0       Connection fail number:0           
   Operation sequence errors number:0   RTT Status errors number:0         
   Destination IP address:10.1.30.1                                    
   Min/Max/Average completion time: <samp class="codeph" id="EN-US_TASK_0000001564130229__codeph384922914346">3/4/3</samp>                                
   Sum/Square-Sum  completion time: <samp class="codeph" id="EN-US_TASK_0000001564130229__codeph184922911348">7/25</samp>                                 
   Last response packet receiving tim: <samp class="codeph" id="EN-US_TASK_0000001564130229__codeph17849162918343">2020-04-09 09:55:38.2</samp>                           
   Lost packet ratio: 0 %</pre>
</div>
<div class="postreq"><a name="EN-US_TASK_0000001564130229__1.3.4"></a><a name="1.3.4"></a><h4 class="sectiontitle">Configuration Scripts</h4><ul id="EN-US_TASK_0000001564130229__ul1582465153515"><li id="EN-US_TASK_0000001564130229__li128241151173514"><span class="keyword" id="EN-US_TASK_0000001564130229__keyword442063823518">DeviceA</span><pre class="screen" id="EN-US_TASK_0000001564130229__screen2909656133510">#
sysname <span class="keyword" id="EN-US_TASK_0000001564130229__keyword7132141320467">DeviceA</span>
#
vlan batch 10 20 30
#
acl number 3001
 rule 5 permit ip source 192.168.101.0 0.0.0.255
#
traffic classifier c1 type or
 if-match acl 3001
#
traffic behavior b1
 redirect nexthop 10.1.30.1 track nqa user test
#
traffic policy p1
 classifier c1 behavior b1 precedence 5
#
interface Vlanif10
 ip address 10.1.20.2 255.255.255.0
#
interface Vlanif20
 ip address 10.1.30.2 255.255.255.0
#
interface Vlanif30
 ip address 10.1.10.2 255.255.255.0
#
interface <span>100GE</span><span>1/0/1</span>
 port link-type trunk
 port trunk allow-pass vlan 10
#
interface <span>100GE</span><span>1/0/2</span>
 port link-type trunk
 port trunk allow-pass vlan 20
#
interface <span>100GE</span><span>1/0/3</span>
 port link-type trunk
 port trunk allow-pass vlan 30
 traffic-policy p1 inbound 
#
nqa test-instance user test
 test-type icmp
 destination-address ipv4 10.1.30.1
 interval seconds 5
 timeout 4
 probe-count 2
 frequency 11
 start now
#
return</pre>
</li><li id="EN-US_TASK_0000001564130229__li16323183304511"><span class="keyword" id="EN-US_TASK_0000001564130229__keyword93769479612">DeviceC</span><pre class="screen" id="EN-US_TASK_0000001564130229__screen1547646530175348">#
sysname <span class="keyword" id="EN-US_TASK_0000001564130229__keyword49652447819">DeviceC</span>
#
vlan batch 10
#
interface Vlanif10
 ip address 10.1.20.1 255.255.255.0
#
interface <span>100GE</span><span>1/0/1</span>
 port link-type trunk
 port trunk allow-pass vlan 10
#
return</pre>
</li><li id="EN-US_TASK_0000001564130229__li1084925854514"><span class="keyword" id="EN-US_TASK_0000001564130229__keyword59711561278">DeviceD</span><pre class="screen" id="EN-US_TASK_0000001564130229__screen173911148509">#
sysname <span class="keyword" id="EN-US_TASK_0000001564130229__keyword1914611391885">DeviceD</span>
#
vlan batch 20
#
interface Vlanif20
 ip address 10.1.30.1 255.255.255.0
#
interface <span>100GE</span><span>1/0/1</span>
 port link-type trunk
 port trunk allow-pass vlan 20
#
return</pre>
</li></ul>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="galaxy_qos_redirect_cfg_0001.html">Redirection Configuration
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="galaxy_qos_redirect_cfg_0007.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="galaxy_qos_redirect_cfg_0009.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>