
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring OSPF Between an MCE and a PE">
<meta name="abstract" content="">
<meta name="description" content="">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="vrp_L3VPNv4_cfg_0016.html">
<meta name="DC.Relation" scheme="URI" content="vrp_L3VPNv4_cfg_0018.html">
<meta name="DC.Relation" scheme="URI" content="vrp_L3VPNv4_cfg_0021.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="IPv4 L3VPN">
<meta name="featuretype" content="VPN">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="IPv4 L3VPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="IPv4 L3VPN">
<meta name="featuretype" content="VPN">
<meta name="featuretype" content="VPN">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001130621680">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>Configuring OSPF Between an MCE and a PE</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001130621680"></a><a name="EN-US_TASK_0000001130621680"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring OSPF Between an MCE and a PE</h1>
<div class="taskbody"><p></p>
<div class="prereq" style="margin-left:0"><a name="EN-US_TASK_0000001130621680__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Prerequisites</h4>
<div class="p"><p id="EN-US_TASK_0000001130621680__en-us_task_0000001130781470_p382378817214050">Before configuring MCE, you have completed the following tasks:</p>
<ul id="EN-US_TASK_0000001130621680__en-us_task_0000001130781470_ul1763042272214050"><li id="EN-US_TASK_0000001130621680__en-us_task_0000001130781470_li1850663768214050"><p id="EN-US_TASK_0000001130621680__en-us_task_0000001130781470_p2100289275214050"><a name="EN-US_TASK_0000001130621680__en-us_task_0000001130781470_li1850663768214050"></a><a name="en-us_task_0000001130781470_li1850663768214050"></a>Configure a VPN instance for each service on the MCE and its connected PE. For details, see <a href="vrp_L3VPNv4_cfg_0007.html">Configuring an IPv4 VPN Instance on a PE</a>.</p>
</li><li id="EN-US_TASK_0000001130621680__en-us_task_0000001130781470_li1519591190214050"><p id="EN-US_TASK_0000001130621680__en-us_task_0000001130781470_p1893600206214050"><a name="EN-US_TASK_0000001130621680__en-us_task_0000001130781470_li1519591190214050"></a><a name="en-us_task_0000001130781470_li1519591190214050"></a>Configure link and network layer protocols for LAN interfaces, and connect the LAN interface for each type of service to the MCE.</p>
</li><li id="EN-US_TASK_0000001130621680__en-us_task_0000001130781470_li1638983767214050"><p id="EN-US_TASK_0000001130621680__en-us_task_0000001130781470_p627431900214050"><a name="EN-US_TASK_0000001130621680__en-us_task_0000001130781470_li1638983767214050"></a><a name="en-us_task_0000001130781470_li1638983767214050"></a>Bind each MCE interface and the PE interface connecting to the MCE to the VPN instance, and configure IP addresses for the interfaces. For detailed configurations, see <a href="vrp_L3VPNv4_cfg_0008.html">Binding an Interface to an IPv4 VPN Instance</a>.</p>
</li></ul>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001130621680__1.4.2"></a><a name="1.4.2"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>Deleting a VPN instance or disabling a VPN instance IPv4 address family will delete all the OSPF processes bound to the VPN instance and the VPN instance IPv4 address family.</p>
</div></div>
<div class="steps-unordered"><a name="EN-US_TASK_0000001130621680__1.4.3"></a><a name="1.4.3"></a><h4 class="sectiontitle">Procedure</h4>
<ul><li><span>Configure the PE.</span><ol><li class="substepexpand"><span>Enter the system view.</span><p><pre class="screen"><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></pre>
</p></li><li class="substepexpand"><span>Create an OSPF process and enter the OSPF view.</span><p><pre class="screen"><a href="cmdqueryname=ospf"><b><span class="cmdname">ospf</span></b></a> <i><span class="varname">process-id</span></i> [ <strong><span>router-id</span></strong> <i><span class="varname">router-id</span></i> ] <strong><span>vpn-instance</span></strong> <i><span class="varname">vpnname</span></i></pre>
<p>An OSPF process can be bound to only one VPN instance.</p>
<p>A router ID needs to be specified when an OSPF process is started after it is bound to a VPN instance. The router ID must be different from the public network router ID configured in the system view. If the router ID is not specified, OSPF selects the IP address of one of the interfaces bound to the VPN instance as the router ID based on a certain rule.</p>
</p></li><li class="substepexpand"><span>(Optional) Configure a domain ID.</span><p><pre class="screen"><a href="cmdqueryname=domain-id"><b><span class="cmdname">domain-id</span></b></a> <i><span class="varname">domain-id</span></i> [ <strong><span>secondary</span></strong> ]</pre>
<p>The domain ID can be an integer or in dotted decimal notation.</p>
<p>Two domain IDs can be configured for each OSPF process. Different processes can have the same domain ID. There are no restrictions on the domain IDs of the OSPF processes for different VPNs on a PE. The OSPF processes of the same VPN must be configured with the same domain ID to ensure correct route advertisement.</p>
<p>The domain ID of an OSPF process is contained in the routes generated by the process. When OSPF routes are imported into the BGP routing table, the domain ID is added to BGP VPN routes and advertised as a BGP extended community attribute.</p>
</p></li><li class="substepexpand"><span>Enter the OSPF area view.</span><p><pre class="screen"><a href="cmdqueryname=area"><b><span class="cmdname">area</span></b></a> <i><span class="varname">area-id</span></i></pre>
</p></li><li class="substepexpand"><span>Enable OSPF on the network segment where an interface bound to the VPN instance resides.</span><p><pre class="screen"><a href="cmdqueryname=network"><b><span class="cmdname">network</span></b></a> <i><span class="varname">address</span></i> <i><span class="varname">wildcard-mask</span></i></pre>
</p><p><p>A network segment can belong to only one area. In other words, you need to specify an area for each interface running OSPF.</p>
<p>OSPF can properly run on an interface only when both of the following conditions are met:</p>
<ul><li><p>The IP address mask length of the interface is longer than or equal to that specified in the <a href="cmdqueryname=network"><b><span class="cmdname">network</span></b></a> command.</p>
</li><li><p>The interface's primary IP address belongs to the network segment specified in the <a href="cmdqueryname=network"><b><span class="cmdname">network</span></b></a> command.</p>
</li></ul>
<p>On a loopback interface, by default, OSPF advertises its IP address in the form of a 32-bit host route, independent of the mask length of the IP address on the interface.</p>
</p></li><li class="substepexpand"><span>Return to the OSPF view.</span><p><pre class="screen"><a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></pre>
</p></li><li class="substepexpand"><span>Import BGP routes.</span><p><pre class="screen"><a href="cmdqueryname=import-route"><b><span class="cmdname">import-route</span></b></a> <strong><span>bgp</span></strong> [ <strong><span>cost</span></strong> <i><span class="varname">cost</span></i> | <strong><span>route-policy</span></strong> <i><span class="varname">route-policy-name</span></i> | <strong><span>tag</span></strong> <i><span class="varname">tag</span></i> | <strong><span>type</span></strong> <i><span class="varname">type</span></i> ] <sup>*</sup></pre>
</p></li><li class="substepexpand"><span>Return to the system view.</span><p><pre class="screen"><a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></pre>
</p></li><li class="substepexpand"><span>Enter the BGP view.</span><p><pre class="screen"><a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></pre>
</p></li><li class="substepexpand"><span>Enter the BGP VPN instance IPv4 address family view.</span><p><pre class="screen"><a href="cmdqueryname=ipv4-family"><b><span class="cmdname">ipv4-family</span></b></a> <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i></pre>
</p></li><li class="substepexpand"><span>Import OSPF routes into the routing table of the BGP VPN instance IPv4 address family.</span><p><pre class="screen"><a href="cmdqueryname=import-route"><b><span class="cmdname">import-route</span></b></a> <strong><span>ospf</span></strong> <i><span class="varname">process-id</span></i> [ <strong><span>med</span></strong> <i><span class="varname">med-value</span></i> | <strong><span>route-policy</span></strong> <i><span class="varname">route-policy-name</span></i> ] <sup>*</sup></pre>
</p></li><li class="substepexpand"><span>Commit the configuration.</span><p><pre class="screen" id="EN-US_TASK_0000001130621680__en-us_task_0234857734_screen14848162118611"><a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001130621680__en-us_task_0234857734_cmdname1784862115612">commit</span></b></a></pre>
</p></li></ol>
</li><li><span>Configure the MCE.</span><ol><li class="substepexpand"><span>Enter the system view.</span><p><pre class="screen"><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></pre>
</p></li><li class="substepexpand"><span>Create an OSPF process and enter the OSPF view.</span><p><pre class="screen"><a href="cmdqueryname=ospf"><b><span class="cmdname">ospf</span></b></a> <i><span class="varname">process-id</span></i> [ <strong><span>router-id</span></strong> <i><span class="varname">router-id</span></i> ] <strong><span>vpn-instance</span></strong> <i><span class="varname">vpnname</span></i></pre>
</p><p><p>An OSPF process can be bound to only one VPN instance. The same OSPF process must be configured on the MCE and its connected PE. </p>
<p>A router ID needs to be specified when an OSPF process is started after it is bound to a VPN instance. The router ID must be different from the public network router ID configured in the system view. If the router ID is not specified, OSPF selects the IP address of one of the interfaces bound to the VPN instance as the router ID based on a certain rule.</p>
</p></li><li class="substepexpand"><span>(Optional) Configure a domain ID.</span><p><pre class="screen"><a href="cmdqueryname=domain-id"><b><span class="cmdname">domain-id</span></b></a> <i><span class="varname">domain-idvalue</span></i> [ <strong><span>secondary</span></strong> ]</pre>
<p>The domain ID can be an integer or in dotted decimal notation.</p>
<p>Two domain IDs can be configured for each OSPF process. Different processes can have the same domain ID. There are no restrictions on the domain IDs of the OSPF processes for different VPNs on a PE. The OSPF processes of the same VPN must be configured with the same domain ID to ensure correct route advertisement.</p>
<p>The domain ID of an OSPF process is contained in the routes generated by the process. When OSPF routes are imported into the BGP routing table, the domain ID is added to BGP VPN routes and advertised as a BGP extended community attribute.</p>
</p></li><li class="substepexpand"><span>Disable routing loop detection.</span><p><pre class="screen"><a href="cmdqueryname=vpn-instance-capability+simple"><b><span class="cmdname">vpn-instance-capability simple</span></b></a></pre>
<p>If OSPF VPN multi-instance has been deployed on the MCE and PE, the PE sends the MCE a link-state advertisement (LSA) with the Down (DN) bit set to 1. Because VPN instances have been configured on the MCE, the MCE has routing loop detection enabled. If the MCE detects that the LSA contains the DN bit with value 1, this LSA cannot be used to calculate routes. Run the <a href="cmdqueryname=vpn-instance-capability+simple"><b><span class="cmdname">vpn-instance-capability simple</span></b></a> command to disable OSPF routing loop detection. When OSPF routing loop detection is disabled, the MCE calculates all OSPF routes without checking the DN bit or route tag.</p>
</p></li><li class="substepexpand"><span>Enter the OSPF area view.</span><p><pre class="screen"><a href="cmdqueryname=area"><b><span class="cmdname">area</span></b></a> <i><span class="varname">area-id</span></i></pre>
</p></li><li class="substepexpand"><span>Enable OSPF on the network segment where an interface bound to the VPN instance resides.</span><p><pre class="screen"><a href="cmdqueryname=network"><b><span class="cmdname">network</span></b></a> <i><span class="varname">address</span></i> <i><span class="varname">wildcard-mask</span></i></pre>
</p><p><p>A network segment can belong to only one area. In other words, you need to specify an area for each interface running OSPF.</p>
<p>OSPF can properly run on an interface only when both of the following conditions are met:</p>
<ul><li><p>The IP address mask length of the interface is longer than or equal to that specified in the <a href="cmdqueryname=network"><b><span class="cmdname">network</span></b></a> command.</p>
</li><li><p>The interface's primary IP address belongs to the network segment specified in the <a href="cmdqueryname=network"><b><span class="cmdname">network</span></b></a> command.</p>
</li></ul>
<p>On a loopback interface, by default, OSPF advertises its IP address in the form of a 32-bit host route, independent of the mask length of the IP address on the interface.</p>
</p></li><li class="substepexpand"><span>Commit the configuration.</span><p><pre class="screen" id="EN-US_TASK_0000001130621680__en-us_task_0234857734_screen14848162118611_1"><a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001130621680__en-us_task_0234857734_cmdname1784862115612_1">commit</span></b></a></pre>
</p></li></ol>
</li></ul></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="vrp_L3VPNv4_cfg_0016.html">Configuring the MCE Function
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="vrp_L3VPNv4_cfg_0018.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="vrp_L3VPNv4_cfg_0021.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>