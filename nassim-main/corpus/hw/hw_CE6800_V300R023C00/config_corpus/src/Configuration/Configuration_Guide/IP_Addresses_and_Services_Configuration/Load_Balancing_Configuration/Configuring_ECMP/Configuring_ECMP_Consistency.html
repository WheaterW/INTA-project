
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring ECMP Consistency">
<meta name="abstract" content="">
<meta name="description" content="">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="galaxy_loadba_performance_cfg_0009.html">
<meta name="DC.Relation" scheme="URI" content="galaxy_loadba_performance_cfg_0011.html">
<meta name="DC.Relation" scheme="URI" content="galaxy_loadba_performance_cfg_0016.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="Load Balancing">
<meta name="featuretype" content="IP Addresses and Services">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="Load Balancing">
<meta name="featuretype" content="IP Addresses and Services">
<meta name="featurename" content="Load Balancing">
<meta name="featuretype" content="IP Addresses and Services">
<meta name="featuretype" content="IP Addresses and Services">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001563881105">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>Configuring ECMP Consistency</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001563881105"></a><a name="EN-US_TASK_0000001563881105"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring ECMP Consistency</h1>
<div class="taskbody"><p></p>
<div class="context"><a name="EN-US_TASK_0000001563881105__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>If a path fails, ECMP re-hashes all traffic by default, which affects traffic forwarding on normal paths. To address this issue, configure ECMP consistency so that the device hashes the traffic only on the faulty path.</p>
<p>However, if a faulty member link recovers or a new link is added, ECMP consistency cannot ensure that the original forwarding path remains unchanged. ECMP consistency enhancement is implemented based on ECMP consistency. When a faulty link recovers, only traffic on the faulty link is re-hashed; when a new link is added, not all traffic needs to be re-hashed. This ensures link load balancing consistency.</p>
<p>The following is an example:</p>
<p>Assume that 12 data packets are forwarded through links A, B, C, and D. The initial packets allocated to the links are shown in the left part of <a href="#EN-US_TASK_0000001563881105__fig78111195547">Figure 1</a>. In this case, traffic is evenly distributed to each link. If ECMP consistency is configured and link D is disconnected, traffic on it is evenly distributed to the other three links, as shown in the right part of <a href="#EN-US_TASK_0000001563881105__fig78111195547">Figure 1</a>.</p>
<div class="fignone" id="EN-US_TASK_0000001563881105__fig78111195547"><a name="EN-US_TASK_0000001563881105__fig78111195547"></a><a name="fig78111195547"></a><span class="figcap"><b>Figure 1 </b>Configuring ECMP consistency</span><br><span><img class="vsd" src="figure/en-us_image_0000001563761541.png" width="NaN" height="NaN"></span></div>
<p>If link D recovers but ECMP consistency enhancement is not configured, traffic distribution remains unchanged, as shown in the left part of <a href="#EN-US_TASK_0000001563881105__fig013518491004">Figure 2</a>. In this case, link D does not participate in traffic forwarding. If link D recovers and ECMP consistency enhancement is configured, link D participates in traffic forwarding, as shown in the right part of <a href="#EN-US_TASK_0000001563881105__fig013518491004">Figure 2</a>.</p>
<div class="fignone" id="EN-US_TASK_0000001563881105__fig013518491004"><a name="EN-US_TASK_0000001563881105__fig013518491004"></a><a name="fig013518491004"></a><span class="figcap"><b>Figure 2 </b>Configuring ECMP consistency enhancement</span><br><span><img class="vsd" src="figure/en-us_image_0000001564121281.png" width="NaN" height="NaN"></span></div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001563881105__1.4.2"></a><a name="1.4.2"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Enter the system view.</span><p><pre class="screen"><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></pre>
</p></li><li><span>Configure ECMP consistency.</span><p><pre class="screen"><a href="cmdqueryname=load-balance+ecmp+stateful+enable"><b><span class="cmdname">load-balance ecmp stateful enable</span></b></a></pre>
</p></li><li><span>(Optional) Configure ECMP consistency enhancement.</span><p><pre class="screen"><a href="cmdqueryname=load-balance+ecmp+stateful+enhanced+enable"><b><span class="cmdname">load-balance ecmp stateful enhanced enable</span></b></a></pre>
<div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>This command does not take effect in scenarios where the next hop for load balancing involves VXLAN tunnel forwarding. To enable ECMP consistency enhancement in such scenarios, run the <strong>load-balance vxlan-overlay ecmp stateful</strong><strong> enable</strong> command. </p>
</div></div>
</p></li><li><span>Commit the configuration.</span><p><pre class="screen"><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></pre>
</p></li></ol></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="galaxy_loadba_performance_cfg_0009.html">Configuring ECMP
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="galaxy_loadba_performance_cfg_0011.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="galaxy_loadba_performance_cfg_0016.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>