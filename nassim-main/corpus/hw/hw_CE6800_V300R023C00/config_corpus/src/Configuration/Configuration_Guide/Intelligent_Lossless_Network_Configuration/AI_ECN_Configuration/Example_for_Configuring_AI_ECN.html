
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring AI ECN">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="galaxy_ai_aiecn_cfg_0001.html">
<meta name="DC.Relation" scheme="URI" content="galaxy_ai_aiecn_cfg_0005.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="AI ECN">
<meta name="featuretype" content="Intelligent Lossless Network">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="AI ECN">
<meta name="featuretype" content="Intelligent Lossless Network">
<meta name="featuretype" content="Intelligent Lossless Network">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001563872189">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring AI ECN</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001563872189"></a><a name="EN-US_TASK_0000001563872189"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring AI ECN</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001563872189__1.3.1"></a><a name="1.3.1"></a>
<div class="p" id="EN-US_TASK_0000001563872189__context1677625172748"><h4 class="sectiontitle">Networking Requirements</h4><p id="EN-US_TASK_0000001563872189__p1387218499510">In <a href="#EN-US_TASK_0000001563872189__fig19978171395514">Figure 1</a>, an AI service carried by RoCEv2 traffic is deployed on Host1 and Host2, and DeviceA is directly connected to both hosts. To achieve the optimal performance of the AI service, a network environment with low delay, zero packet loss, and high throughput is required. To meet this requirement, PFC, EAI, and AI ECN functions can be configured on DeviceA.</p>
<div class="fignone" id="EN-US_TASK_0000001563872189__fig19978171395514"><a name="EN-US_TASK_0000001563872189__fig19978171395514"></a><a name="fig19978171395514"></a><span class="figcap"><b>Figure 1 </b>Network diagram of AI ECN</span><div class="note" id="EN-US_TASK_0000001563872189__note8754152610354"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0000001563872189__p1217624616556">In this example, interface1 and interface2 represent <span>100GE</span><span>1/0/1</span> and <span>100GE</span><span>1/0/2</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" id="EN-US_TASK_0000001563872189__image188370411229" src="figure/en-us_image_0000001563992473.png" width="NaN" height="NaN"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001563872189__1.3.2"></a><a name="1.3.2"></a>
<div class="p" id="EN-US_TASK_0000001563872189__context168174584017"><h4 class="sectiontitle">Precautions</h4><ul id="EN-US_TASK_0000001563872189__ul86530812552"><li id="EN-US_TASK_0000001563872189__li18333154513517">NICs of the hosts must support RoCEv2 and DCQCN.</li><li id="EN-US_TASK_0000001563872189__li681171515513">The parameter settings in this example are for reference only. Configure each device based on the traffic model in the actual networking.</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001563872189__1.3.3"></a><a name="1.3.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol id="EN-US_TASK_0000001563872189__steps10132325172748"><li id="EN-US_TASK_0000001563872189__step5253145172748"><span id="EN-US_TASK_0000001563872189__cmd7907968172748">Configure DeviceA to implement PFC based on the DSCP value.</span><p><p id="EN-US_TASK_0000001563872189__p1206857539175352"># In this example, a queue with priority 4 is used to carry RoCEv2 traffic. Enable PFC for the queue with priority 4 on interfaces of DeviceA.</p>
<pre class="screen" id="EN-US_TASK_0000001563872189__screen609810174175352">&lt;<span class="keyword" id="EN-US_TASK_0000001563872189__keyword1517086799183309">HUAWEI</span>&gt; <strong id="EN-US_TASK_0000001563872189__b986302399175329">system-view</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font><span class="keyword" id="EN-US_TASK_0000001563872189__keyword9825182075710">HUAWEI</span>] <strong id="EN-US_TASK_0000001563872189__b651410215">sysname DeviceA</strong>
[*<span class="keyword" id="EN-US_TASK_0000001563872189__keyword12492125095720">HUAWEI</span>] <strong id="EN-US_TASK_0000001563872189__b136010313235">commit</strong>
[<span class="keyword" id="EN-US_TASK_0000001563872189__keyword1762323183719"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong id="EN-US_TASK_0000001563872189__b1568413217475">qos buffer headroom-pool size</strong><strong id="EN-US_TASK_0000001563872189__b7653121916571"> 4 mbytes slot <span>1</span></strong>      //This command is required only on the <span>CE6855-48XS8CQ, CE6863E-48S8CQ, CE6885, CE6885-LL, CE6885-SAN, CE6885-T, CE8851-32CQ4BQ, CE8855</span>.
[*DeviceA] <strong id="EN-US_TASK_0000001563872189__b834352884175412">dcb pfc</strong>
[*DeviceA-dcb-pfc-default] <strong id="EN-US_TASK_0000001563872189__b123291525153413">priority 4</strong>
[*DeviceA-dcb-pfc-default] <strong id="EN-US_TASK_0000001563872189__b162705449393">quit</strong>
[*DeviceA] <strong id="EN-US_TASK_0000001563872189__b770519313019">port-group all_using</strong>   
[*DeviceA-port-group-all_using] <strong id="EN-US_TASK_0000001563872189__b280820281215">group-member <span>100ge</span> <span>1/0/1</span> to <span>100ge</span> <span>1/0/2</span></strong>
[*DeviceA-port-group-all_using] <strong id="EN-US_TASK_0000001563872189__b1025802595116">dcb pfc enable mode manual</strong>
[*DeviceA-port-group-all_using] <strong id="EN-US_TASK_0000001563872189__b13729526">quit</strong>
[*DeviceA] <strong id="EN-US_TASK_0000001563872189__b1588835774175352">commit</strong></pre>
<p id="EN-US_TASK_0000001563872189__p8320145119521"># Configure DeviceA to implement PFC based on the priority after DSCP mapping. (Supported only by the <span>CE6855-48XS8CQ, CE6863E-48S8CQ, CE6885, CE6885-LL (standard forwarding mode), CE6885-SAN, CE6885-T, CE8851-32CQ4BQ, CE8855</span>.)</p>
<pre class="screen" id="EN-US_TASK_0000001563872189__screen832095117529">[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceA] <strong id="EN-US_TASK_0000001563872189__b26521260558">dcb pfc dscp-mapping enable slot 1</strong>
[*DeviceA] <strong id="EN-US_TASK_0000001563872189__b6322351115215">commit</strong></pre>
<p id="EN-US_TASK_0000001563872189__p563716432915"># In this example, the DSCP value of RoCEv2 packets is 24, and the DSCP value of CNPs is 25. Configure a priority mapping profile for the DiffServ domain <strong id="EN-US_TASK_0000001563872189__b1575275204313">ds1</strong> on DeviceA to map the DSCP value of RoCEv2 packets to the priority 4 and that of CNPs to the priority 6, ensuring that CNPs are transmitted through a queue with a higher priority. Then apply the DiffServ domain to interfaces.</p>
<pre class="screen" id="EN-US_TASK_0000001563872189__screen134599022911">[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceA] <strong id="EN-US_TASK_0000001563872189__b0396133992111">diffserv domain</strong><strong id="EN-US_TASK_0000001563872189__b123731625132211"> ds1</strong> 
[*DeviceA-dsdomain-ds1] <strong id="EN-US_TASK_0000001563872189__b3763201182419">ip-dscp-inbound 24 phb af4 green</strong>
[*DeviceA-dsdomain-ds1] <strong id="EN-US_TASK_0000001563872189__b1550517010250">ip-dscp-inbound 25 phb cs6 green</strong>
[*DeviceA-dsdomain-ds1] <strong id="EN-US_TASK_0000001563872189__b113045017252">quit</strong> 
[*DeviceA] <strong id="EN-US_TASK_0000001563872189__b8981139101710">port-group all_using</strong>
[*DeviceA-port-group-all_using] <strong id="EN-US_TASK_0000001563872189__b57531476168">trust dscp</strong>
[*DeviceA-port-group-all_using] <strong id="EN-US_TASK_0000001563872189__b1957715337267">trust upstream ds1</strong>
[*DeviceA-port-group-all_using] <strong id="EN-US_TASK_0000001563872189__b146180122911">quit</strong>
[*DeviceA] <strong id="EN-US_TASK_0000001563872189__b2461802291">commit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceA] <strong id="EN-US_TASK_0000001563872189__b2029510539146">quit</strong> </pre>
<div class="note" id="EN-US_TASK_0000001563872189__note1278314319311"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0000001563872189__p18783193115314">After the preceding PFC-related configurations are complete, RoCEv2 packets are transmitted through the queue with priority 4, which is a lossless queue.</p>
</div></div>
</p></li><li id="EN-US_TASK_0000001563872189__step159601345101718"><span id="EN-US_TASK_0000001563872189__cmd13960645181719">Configure EAI.</span><p><p id="EN-US_TASK_0000001563872189__p1896912151923"># Configure EAI on DeviceA and load the model file required by the AI ECN component. In this example, the model file has been uploaded to the device, and the full path is <strong id="EN-US_TASK_0000001563872189__b9336923175318">flash:/AI_ECN-1.0.0-1.0.2.zip</strong>. By default, a model file is preloaded on the device.</p>
<pre class="screen" id="EN-US_TASK_0000001563872189__screen1467971410501">&lt;DeviceA&gt;<strong id="EN-US_TASK_0000001563872189__b1952610193505"> </strong><strong id="EN-US_TASK_0000001563872189__b12526119175016">load ai-service model-file flash:/AI_ECN-1.0.0-1.0.2.zip all</strong></pre>
</p></li><li id="EN-US_TASK_0000001563872189__step789043619335"><span id="EN-US_TASK_0000001563872189__cmd789083623315">Configure AI ECN for a lossless queue.</span><p><p id="EN-US_TASK_0000001563872189__p67292246416"># Enable AI ECN for lossless queue 4 on DeviceA.</p>
<pre class="screen" id="EN-US_TASK_0000001563872189__screen289513683310">&lt;DeviceA&gt; <strong id="EN-US_TASK_0000001563872189__b344813479560">system-view</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceA] <strong id="EN-US_TASK_0000001563872189__b082801275417">ai-service</strong>
[*DeviceA-ai-service]<strong id="EN-US_TASK_0000001563872189__b16507336714"> </strong><strong id="EN-US_TASK_0000001563872189__b65498104714">ai-ecn</strong>
[*DeviceA-ai-service-ai-ecn] <strong id="EN-US_TASK_0000001563872189__b1873383853716">assign queue 4</strong>
[*DeviceA-ai-service-ai-ecn] <strong id="EN-US_TASK_0000001563872189__b12446358470">ai-ecn enable</strong>
[*DeviceA-ai-service-ai-ecn] <strong id="EN-US_TASK_0000001563872189__b37396530474">quit</strong>
[*DeviceA-ai-service]<strong id="EN-US_TASK_0000001563872189__b2177218528"> </strong><strong id="EN-US_TASK_0000001563872189__b152653213220">quit</strong>
[*DeviceA] <strong id="EN-US_TASK_0000001563872189__b11898163673312">commit</strong></pre>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0000001563872189__example23692022122818"><a name="EN-US_TASK_0000001563872189__1.3.4"></a><a name="1.3.4"></a><h4 class="sectiontitle">Verifying the Configuration</h4><div class="p" id="EN-US_TASK_0000001563872189__p1593263164810"># Check information about all models on the device. The command output shows that the AI ECN function has subscribed to the newly loaded model.<pre class="screen" id="EN-US_TASK_0000001563872189__screen17999012563">[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceA] <strong id="EN-US_TASK_0000001563872189__b1099003565">display ai-service model</strong>
--------------------------------------------------------------------------------
File Name
          Model Name        Model Version     Model Type        Service
--------------------------------------------------------------------------------
AI_ECN-1.0.0-1.0.0.zip
          AI_ECN            1.0.0             Default           --
AI_ECN-1.0.0-1.0.2.zip
          AI_ECN            1.0.2             User Define       AI ECN
--------------------------------------------------------------------------------</pre>
</div>
<p id="EN-US_TASK_0000001563872189__p1743044644811"># Check the ECN thresholds calculated by the AI ECN function for the lossless queue. The command output shows that the AI ECN function calculates the ECN thresholds of the device in NN mode (model inference mode).</p>
<pre class="screen" id="EN-US_TASK_0000001563872189__screen1072714701015">[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceA] <strong id="EN-US_TASK_0000001563872189__b20158619121116">display ai-ecn calculated state</strong> 
AI-ECN Model Version : 1.0.1
Mode : NN - Model inference    BBR - Heuristic inference    STATIC - Static threshold
-----------------------------------------------------------------------------------------------------------------------------
Interface       Queue   Low-Threshold   High-Threshold   Probability   Mode                Active model       Actived time
                               (Byte)           (Byte)           (%)
-----------------------------------------------------------------------------------------------------------------------------
<span>100GE</span><span>1/0/1</span>          4          204800           614400             5    NN    AI_ECN_DistributedStorage   2022-01-10 09:09:23
<span>100GE</span><span>1/0/2</span>          4          204800           614400             5    NN    AI_ECN_DistributedStorage   2022-01-10 09:09:23
-----------------------------------------------------------------------------------------------------------------------------</pre>
</div>
<div class="postreq"><a name="EN-US_TASK_0000001563872189__1.3.5"></a><a name="1.3.5"></a><h4 class="sectiontitle">Configuration Scripts</h4><p id="EN-US_TASK_0000001563872189__p471239549175329"><span class="keyword" id="EN-US_TASK_0000001563872189__keyword203409907175329">DeviceA</span></p>
<pre class="screen" id="EN-US_TASK_0000001563872189__screen543715260175329">#
sysname <span class="keyword" id="EN-US_TASK_0000001563872189__keyword1460474746175329">DeviceA</span>
#
dcb pfc
 priority 4
# 
dcb pfc dscp-mapping enable slot 1    //Supported only by the <span>CE6855-48XS8CQ, CE6863E-48S8CQ, CE6885, CE6885-LL (standard forwarding mode), CE6885-SAN, CE6885-T, CE8851-32CQ4BQ, CE8855</span>.
#
qos buffer headroom-pool size 4 mbytes slot <span>1</span>      //This command is required only on the <span>CE6855-48XS8CQ, CE6863E-48S8CQ, CE6885, CE6885-LL, CE6885-SAN, CE6885-T, CE8851-32CQ4BQ, CE8855</span>.
#
diffserv domain ds1  
 ip-dscp-inbound 24 phb af4 green
 ip-dscp-inbound 25 phb cs6 green
#
interface <span>100GE</span><span>1/0/1</span>
<strong id="EN-US_TASK_0000001563872189__b1369197217"> </strong>trust dscp
 trust upstream ds1
 dcb pfc enable mode manual
#
interface <span>100GE</span><span>1/0/2</span>
<strong id="EN-US_TASK_0000001563872189__b1582162442119"> </strong>trust dscp
 trust upstream ds1
 dcb pfc enable mode manual
#
ai-service 
 #
<strong id="EN-US_TASK_0000001563872189__b92488273546"> </strong>ai-ecn
  ai-ecn enable
  assign queue 4
#
port-group all_using        
 group-member <span>100GE</span><span>1/0/1</span>   
 group-member <span>100GE</span><span>1/0/2</span> 
#
return</pre>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="galaxy_ai_aiecn_cfg_0001.html">AI ECN Configuration
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="galaxy_ai_aiecn_cfg_0005.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>
</body>
</html>