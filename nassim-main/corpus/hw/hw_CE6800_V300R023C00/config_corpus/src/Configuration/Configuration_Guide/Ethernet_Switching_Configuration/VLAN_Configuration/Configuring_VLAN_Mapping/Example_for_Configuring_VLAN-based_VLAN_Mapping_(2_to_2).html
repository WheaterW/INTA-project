
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring VLAN-based VLAN Mapping (2 to 2)">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="vrp_vlan_cfg_0053.html">
<meta name="DC.Relation" scheme="URI" content="vrp_vlan_cfg_0058.html">
<meta name="DC.Relation" scheme="URI" content="vrp_vlan_cfg_0060.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="VLAN">
<meta name="featurename" content="VLAN Mapping">
<meta name="featuretype" content="Ethernet Switching">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="VLAN">
<meta name="featurename" content="VLAN Mapping">
<meta name="featuretype" content="Ethernet Switching">
<meta name="featurename" content="QinQ">
<meta name="featurename" content="VLAN">
<meta name="featurename" content="VLAN Mapping">
<meta name="featurename" content="VLAN Pool">
<meta name="featurename" content="Voice VLAN">
<meta name="featuretype" content="Ethernet Switching">
<meta name="featuretype" content="Ethernet Switching">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001176742299">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring VLAN-based VLAN Mapping (2 to 2)</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001176742299"></a><a name="EN-US_TASK_0000001176742299"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring VLAN-based VLAN Mapping (2 to 2)</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001176742299__1.3.1"></a><a name="1.3.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>In <a href="#EN-US_TASK_0000001176742299__fig21571951267">Figure 1</a>, PC1 connected to DeviceA belongs to VLAN 10, and PC2 connected to DeviceF belongs to VLAN 30. QinQ is configured on DeviceB and DeviceE. The VLAN IDs planned for communication between DeviceC and DeviceD are different from those on the downstream network. VLAN mapping needs to be configured on DeviceC and DeviceD so that PCs in different VLANs of different branches can communicate with each other.</p>
<div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>VLAN-based VLAN mapping can be configured only on the <span>CE6820H, CE6820H-K, CE6863H, CE6863H-K, CE6881H, CE6881H-K, CE6820S</span>.</p>
</div></div>
<div class="fignone" id="EN-US_TASK_0000001176742299__fig21571951267"><a name="EN-US_TASK_0000001176742299__fig21571951267"></a><a name="fig21571951267"></a><span class="figcap"><b>Figure 1 </b>Network diagram of configuring VLAN-based VLAN mapping (2 to 2)</span><div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface 1 and interface 2 represent <span>100GE</span> <span>1/0/1</span> and <span>100GE</span> <span>1/0/2</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0000001176662431.png" width="NaN" height="NaN"></span></div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001176742299__1.3.2"></a><a name="1.3.2"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Create VLANs on DeviceA and DeviceF and add interfaces to the VLANs.</span><p><p># Configure DeviceA.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname DeviceA</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>vlan batch 10</strong>
[<span class="keyword">*</span>DeviceA] <strong>interface <span>100ge</span> <span>1/0/1</span></strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>portswitch</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>port link-type access</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>port default vlan 10</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>interface <span>100ge</span> <span>1/0/2</span></strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/2</span>] <strong>portswitch</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/2</span>] <strong>port link-type trunk</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/2</span>] <strong>port trunk allow-pass vlan 10</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/2</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>commit</strong></pre>
<p># Configure DeviceF.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname DeviceF</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceF] <strong>vlan batch 30</strong>
[<span class="keyword">*</span>DeviceF] <strong>interface <span>100ge</span> <span>1/0/1</span></strong>
[<span class="keyword">*</span>DeviceF-<span>100GE</span><span>1/0/1</span>] <strong>portswitch</strong>
[<span class="keyword">*</span>DeviceF-<span>100GE</span><span>1/0/1</span>] <strong>port link-type access</strong>
[<span class="keyword">*</span>DeviceF-<span>100GE</span><span>1/0/1</span>] <strong>port default vlan 30</strong>
[<span class="keyword">*</span>DeviceF-<span>100GE</span><span>1/0/1</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceF] <strong>interface <span>100ge</span> <span>1/0/2</span></strong>
[<span class="keyword">*</span>DeviceF-<span>100GE</span><span>1/0/2</span>] <strong>portswitch</strong>
[<span class="keyword">*</span>DeviceF-<span>100GE</span><span>1/0/2</span>] <strong>port link-type trunk</strong>
[<span class="keyword">*</span>DeviceF-<span>100GE</span><span>1/0/2</span>] <strong>port trunk allow-pass vlan 30</strong>
[<span class="keyword">*</span>DeviceF-<span>100GE</span><span>1/0/2</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceF] <strong>commit</strong></pre>
</p></li><li><span>Configure QinQ on DeviceB and DeviceE.</span><p><p># On DeviceB, configure <span>100GE</span> <span>1/0/1</span> as a QinQ interface, and configure <span>100GE</span> <span>1/0/1</span> to add an outer tag with VLAN ID 20 to packets.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname DeviceB</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB] <strong>vlan batch 20</strong>
[<span class="keyword">*</span>DeviceB] <strong>interface <span>100ge</span> <span>1/0/1</span></strong>
[<span class="keyword">*</span>DeviceB-<span>100GE</span><span>1/0/1</span>] <strong>portswitch</strong>
[<span class="keyword">*</span>DeviceB-<span>100GE</span><span>1/0/1</span>] <strong>port link-type dot1q-tunnel</strong>
[<span class="keyword">*</span>DeviceB-<span>100GE</span><span>1/0/1</span>] <strong>port default vlan 20</strong>
[<span class="keyword">*</span>DeviceB-<span>100GE</span><span>1/0/1</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceB] <strong>interface <span>100ge</span> <span>1/0/2</span></strong>
[<span class="keyword">*</span>DeviceB-<span>100GE</span><span>1/0/2</span>] <strong>portswitch</strong>
[<span class="keyword">*</span>DeviceB-<span>100GE</span><span>1/0/2</span>] <strong>port link-type trunk</strong>
[<span class="keyword">*</span>DeviceB-<span>100GE</span><span>1/0/2</span>] <strong>port trunk allow-pass vlan 20</strong>
[<span class="keyword">*</span>DeviceB-<span>100GE</span><span>1/0/2</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceB] <strong>commit</strong></pre>
<p># On DeviceE, configure <span>100GE</span> <span>1/0/1</span> as a QinQ interface, and configure <span>100GE</span> <span>1/0/1</span> to add an outer tag with VLAN ID 40 to packets.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname DeviceE</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceE] <strong>vlan batch 40</strong>
[<span class="keyword">*</span>DeviceE] <strong>interface <span>100ge</span> <span>1/0/1</span></strong>
[<span class="keyword">*</span>DeviceE-<span>100GE</span><span>1/0/1</span>] <strong>portswitch</strong>
[<span class="keyword">*</span>DeviceE-<span>100GE</span><span>1/0/1</span>] <strong>port link-type dot1q-tunnel</strong>
[<span class="keyword">*</span>DeviceE-<span>100GE</span><span>1/0/1</span>] <strong>port default vlan 40</strong>
[<span class="keyword">*</span>DeviceE-<span>100GE</span><span>1/0/1</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceE] <strong>interface <span>100ge</span> <span>1/0/2</span></strong>
[<span class="keyword">*</span>DeviceE-<span>100GE</span><span>1/0/2</span>] <strong>portswitch</strong>
[<span class="keyword">*</span>DeviceE-<span>100GE</span><span>1/0/2</span>] <strong>port link-type trunk</strong>
[<span class="keyword">*</span>DeviceE-<span>100GE</span><span>1/0/2</span>] <strong>port trunk allow-pass vlan 40</strong>
[<span class="keyword">*</span>DeviceE-<span>100GE</span><span>1/0/2</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceE] <strong>commit</strong></pre>
</p></li><li><span>Configure VLAN mapping on DeviceC and DeviceD.</span><p><p># Configure VLAN mapping on <span>100GE</span> <span>1/0/1</span> of DeviceC. If a packet carries double VLAN tags (outer VLAN tag 20 and inner VLAN tag 10), the outer VLAN tag is replaced with VLAN 50 and the inner VLAN tag is replaced with VLAN 60.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname DeviceC</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceC] <strong>vlan batch 50</strong>
[<span class="keyword">*</span>DeviceC] <strong>interface <span>100ge</span> <span>1/0/1</span></strong>
[<span class="keyword">*</span>DeviceC-<span>100GE</span><span>1/0/1</span>] <strong>portswitch</strong>
[<span class="keyword">*</span>DeviceC-<span>100GE</span><span>1/0/1</span>] <strong>port link-type trunk</strong>
[<span class="keyword">*</span>DeviceC-<span>100GE</span><span>1/0/1</span>] <strong>port trunk allow-pass vlan 50</strong>
[<span class="keyword">*</span>DeviceC-<span>100GE</span><span>1/0/1</span>] <strong>port vlan-mapping vlan 20 inner-vlan 10 map-vlan 50 map-inner-vlan 60</strong>
[<span class="keyword">*</span>DeviceC-<span>100GE</span><span>1/0/1</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceC] <strong>interface <span>100ge</span> <span>1/0/2</span></strong>
[<span class="keyword">*</span>DeviceC-<span>100GE</span><span>1/0/2</span>] <strong>portswitch</strong>
[<span class="keyword">*</span>DeviceC-<span>100GE</span><span>1/0/2</span>] <strong>port link-type trunk</strong>
[<span class="keyword">*</span>DeviceC-<span>100GE</span><span>1/0/2</span>] <strong>port trunk allow-pass vlan 50</strong>
[<span class="keyword">*</span>DeviceC-<span>100GE</span><span>1/0/2</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceC] <strong>commit</strong></pre>
<p># Configure VLAN mapping on <span>100GE</span> <span>1/0/1</span> of DeviceD. If a packet carries double VLAN tags (outer VLAN tag 40 and inner VLAN tag 30), the outer VLAN tag is replaced with VLAN 50 and the inner VLAN tag is replaced with VLAN 60.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname DeviceD</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceD] <strong>vlan batch 50</strong>
[<span class="keyword">*</span>DeviceD] <strong>interface <span>100ge</span> <span>1/0/1</span></strong>
[<span class="keyword">*</span>DeviceD-<span>100GE</span><span>1/0/1</span>] <strong>portswitch</strong>
[<span class="keyword">*</span>DeviceD-<span>100GE</span><span>1/0/1</span>] <strong>port link-type trunk</strong>
[<span class="keyword">*</span>DeviceD-<span>100GE</span><span>1/0/1</span>] <strong>port trunk allow-pass vlan 50</strong>
[<span class="keyword">*</span>DeviceD-<span>100GE</span><span>1/0/1</span>] <strong>port vlan-mapping vlan 40 inner-vlan 30 map-vlan 50 map-inner-vlan 60</strong>
[<span class="keyword">*</span>DeviceD-<span>100GE</span><span>1/0/1</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceD] <strong>interface <span>100ge</span> <span>1/0/2</span></strong>
[<span class="keyword">*</span>DeviceD-<span>100GE</span><span>1/0/2</span>] <strong>portswitch</strong>
[<span class="keyword">*</span>DeviceD-<span>100GE</span><span>1/0/2</span>] <strong>port link-type trunk</strong>
[<span class="keyword">*</span>DeviceD-<span>100GE</span><span>1/0/2</span>] <strong>port trunk allow-pass vlan 50</strong>
[<span class="keyword">*</span>DeviceD-<span>100GE</span><span>1/0/2</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceD] <strong>commit</strong></pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001176742299__1.3.3"></a><a name="1.3.3"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p>After PC1 and PC2 are configured with IP addresses on the same network segment, they can ping each other.</p>
</div>
<div class="postreq"><a name="EN-US_TASK_0000001176742299__1.3.4"></a><a name="1.3.4"></a><h4 class="sectiontitle">Configuration Scripts</h4><ul><li>DeviceA<pre class="screen">#
sysname DeviceA
#
vlan batch 10
#
interface <span>100GE</span><span>1/0/1</span>
 port default vlan 10
#
interface <span>100GE</span><span>1/0/2</span>
 port link-type trunk
 port trunk allow-pass vlan 10
#
return</pre>
</li><li>DeviceB<pre class="screen">#
sysname DeviceB
#
vlan batch 20
#
interface <span>100GE</span><span>1/0/1</span>
 port link-type dot1q-tunnel
 port default vlan 20
#
interface <span>100GE</span><span>1/0/2</span>
 port link-type trunk
 port trunk allow-pass vlan 20
#
return</pre>
</li><li>DeviceC<pre class="screen">#
sysname DeviceC
#
vlan batch 50
#
interface <span>100GE</span><span>1/0/1</span>
 port link-type trunk
 port trunk allow-pass vlan 50
 port vlan-mapping vlan 20 inner-vlan 10 map-vlan 50 map-inner-vlan 60
#
interface <span>100GE</span><span>1/0/2</span>
 port link-type trunk
 port trunk allow-pass vlan 50
#
return</pre>
</li><li>DeviceD<pre class="screen">#
sysname DeviceD
#
vlan batch 50
#
interface <span>100GE</span><span>1/0/1</span>
 port link-type trunk
 port trunk allow-pass vlan 50
 port vlan-mapping vlan 40 inner-vlan 30 map-vlan 50 map-inner-vlan 60
#
interface <span>100GE</span><span>1/0/2</span>
 port link-type trunk
 port trunk allow-pass vlan 50
#
return</pre>
</li><li>DeviceE<pre class="screen">#
sysname DeviceE
#
vlan batch 40
#
interface <span>100GE</span><span>1/0/1</span>
 port link-type dot1q-tunnel
 port default vlan 40
#
interface <span>100GE</span><span>1/0/2</span>
 port link-type trunk
 port trunk allow-pass vlan 40
#
return</pre>
</li><li>DeviceF<pre class="screen">#
sysname DeviceF
#
vlan batch 30
#
interface <span>100GE</span><span>1/0/1</span>
 port default vlan 30
#
interface <span>100GE</span><span>1/0/2</span>
 port link-type trunk
 port trunk allow-pass vlan 30
#
return</pre>
</li></ul>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="vrp_vlan_cfg_0053.html">Configuring VLAN Mapping
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="vrp_vlan_cfg_0058.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="vrp_vlan_cfg_0060.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>