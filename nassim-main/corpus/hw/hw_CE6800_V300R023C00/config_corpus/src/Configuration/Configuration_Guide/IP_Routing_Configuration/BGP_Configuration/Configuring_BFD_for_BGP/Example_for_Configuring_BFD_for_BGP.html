
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring BFD for BGP">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="vrp_bgp_cfg_0109.html">
<meta name="DC.Relation" scheme="URI" content="vrp_bgp_cfg_0111.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing">
<meta name="featuretype" content="IP Routing">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001130783914">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring BFD for BGP</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001130783914"></a><a name="EN-US_TASK_0000001130783914"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring BFD for BGP</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001130783914__1.3.1"></a><a name="1.3.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>Voice and video services have high requirements for network reliability and stability. If a fault occurs on a network, rapid service recovery is required. Generally, the carrier-grade reliability requirement (within 50 ms) must be met. BFD for BGP can meet this requirement.</p>
<p>In <a href="#EN-US_TASK_0000001130783914__fig_dc_vrp_bgp_cfg_408301">Figure 1</a>, a primary link and a backup link are deployed on the network to ensure service transmission stability. EBGP peer relationships are established between indirectly connected DeviceA and DeviceB, and between indirectly connected DeviceA and DeviceC. In normal cases, traffic is transmitted along the primary link DeviceA -&gt; DeviceB. If the primary link fails, BGP must quickly detect the failure and switch traffic to the backup link DeviceA -&gt; DeviceC -&gt; DeviceB.</p>
<p>BFD for BGP can be configured to speed up the link switchover. Specifically, BFD is configured to track the BGP peer relationship between DeviceA and DeviceB. If the primary link between DeviceA and DeviceB fails, BFD will quickly detect the fault and notify BGP of the fault so that service traffic is switched to the backup link for transmission.</p>
<div class="fignone" id="EN-US_TASK_0000001130783914__fig_dc_vrp_bgp_cfg_408301"><a name="EN-US_TASK_0000001130783914__fig_dc_vrp_bgp_cfg_408301"></a><a name="fig_dc_vrp_bgp_cfg_408301"></a><span class="figcap"><b>Figure 1 </b>Network diagram of configuring BFD for BGP</span><div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface 1, interface 2, and interface 3 represent <span>100GE</span><span>1/0/1</span>, <span>100GE</span><span>1/0/2</span>, and <span>100GE</span><span>1/0/3</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0000001176663739.png" width="NaN" height="NaN"></span></div>
<div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>If two devices establish an EBGP peer relationship over a direct link, BFD for BGP is not required because the <a href="cmdqueryname=ebgp-interface-sensitive"><b><span class="cmdname">ebgp-interface-sensitive</span></b></a> command is enabled by default to rapidly detect link failures. </p>
</div></div>
<p>To complete the configuration, you need the following data:</p>
<ul><li><p>Router IDs and AS numbers of DeviceA, DeviceB, and DeviceC</p>
</li><li><p>Peer IP address of a BFD session</p>
</li><li><p>Minimum interval at which BFD Control packets are received and sent and the local detection multiplier</p>
</li></ul>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001130783914__1.3.2"></a><a name="1.3.2"></a>
<div class="p"><h4 class="sectiontitle">Precautions</h4><p>During the configuration, note the following:</p>
<ul><li><p>Before configuring BFD for BGP, enable BFD globally.</p>
</li><li><p>When configuring BFD for BGP, ensure that parameters configured on both ends of a BFD session are consistent.</p>
</li><li>To improve security, you are advised to deploy BGP security measures. For details, see "Configuring BGP Authentication." Keychain authentication is used as an example. For details, see Example for Configuring Keychain Authentication for BGP.</li></ul>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001130783914__1.3.3"></a><a name="1.3.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure basic BGP functions on each device.</p>
</li><li><p>Configure the MED attribute to control route selection.</p>
</li><li><p>Enable BFD on DeviceA and DeviceB.</p>
</li></ol>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001130783914__1.3.4"></a><a name="1.3.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Assign an IP address to each device interface. For detailed configurations, see <a href="#EN-US_TASK_0000001130783914__postreq189611542893">Configuration Scripts</a>.</span></li><li><span>Configure basic BGP functions, establish EBGP connections between DeviceA and DeviceB and between DeviceA and DeviceC, and establish an IBGP connection between DeviceB and DeviceC.</span><p><p># Configure DeviceA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA]<strong> bgp 100</strong>
[<span class="keyword">*</span>DeviceA-bgp]<strong> router-id 1.1.1.1</strong>
[<span class="keyword">*</span>DeviceA-bgp]<strong> peer 10.20.1.2 as-number 200</strong>
[<span class="keyword">*</span>DeviceA-bgp]<strong> peer 10.20.1.2 ebgp-max-hop</strong>
[<span class="keyword">*</span>DeviceA-bgp]<strong> peer 10.20.2.2 as-number 200</strong>
[<span class="keyword">*</span>DeviceA-bgp]<strong> peer 10.20.2.2 ebgp-max-hop</strong>
[<span class="keyword">*</span>DeviceA-bgp]<strong> quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>commit</strong></pre>
<p># Configure DeviceB.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB]<strong> bgp 200</strong>
[<span class="keyword">*</span>DeviceB-bgp]<strong> router-id 2.2.2.2</strong>
[<span class="keyword">*</span>DeviceB-bgp]<strong> peer 10.20.1.1 as-number 100</strong>
[<span class="keyword">*</span>DeviceB-bgp]<strong> peer 10.20.1.1 ebgp-max-hop</strong>
[<span class="keyword">*</span>DeviceB-bgp]<strong> peer 10.1.1.2 as-number 200</strong>
[<span class="keyword">*</span>DeviceB-bgp]<strong> network 172.16.1.0 255.255.255.0</strong>
[<span class="keyword">*</span>DeviceB-bgp]<strong> quit</strong>
[<span class="keyword">*</span>DeviceB] <strong>commit</strong></pre>
<p># Configure DeviceC.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceC]<strong> bgp 200</strong>
[<span class="keyword">*</span>DeviceC-bgp]<strong> router-id 3.3.3.3</strong>
[<span class="keyword">*</span>DeviceC-bgp]<strong> peer 10.20.2.1 as-number 100</strong>
[<span class="keyword">*</span>DeviceC-bgp]<strong> peer 10.20.2.1 ebgp-max-hop</strong>
[<span class="keyword">*</span>DeviceC-bgp]<strong> peer 10.1.1.1 as-number 200</strong>
[<span class="keyword">*</span>DeviceC-bgp]<strong> quit</strong>
[<span class="keyword">*</span>DeviceC] <strong>commit</strong></pre>
<p># On DeviceA, check whether the BGP peer relationship is in the Established state.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>display bgp peer</strong>

 BGP local router ID : 1.1.1.1
 Local AS number : 100
 Total number of peers : 2                 Peers in established state : 2

  Peer            V    AS  MsgRcvd  MsgSent  OutQ  Up/Down       State PrefRcv

  10.20.1.2       4   200        2        5     0 00:01:25 <strong>Established</strong>       0
  10.20.2.2       4   200        2        4     0 00:00:55 <strong>Established</strong>       0</pre>
</p></li><li><span>Configure BFD to detect the BGP peer relationship between DeviceA and DeviceB.</span><p><p># Enable BFD on DeviceA and configure a BFD session to detect the link between DeviceA and DeviceB.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>bfd</strong>
[<span class="keyword">*</span>DeviceA-bfd] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>commit</strong></pre>
<p># Enable BFD on <span class="keyword">Device</span>B and configure a BFD session to detect the link between <span class="keyword">Device</span>B and <span class="keyword">Device</span>A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB] <strong>bfd</strong>
[<span class="keyword">*</span>DeviceB-bfd] <strong>quit</strong>
[<span class="keyword">*</span>DeviceB] <strong>commit</strong></pre>
</p></li><li><span>Configure the MED attribute.</span><p><p>Configure a route-policy to set the MED attribute for the routes that DeviceB and DeviceC send to DeviceA.</p>
<p># Configure DeviceB.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB] <strong>route-policy 10 permit node 10</strong>
[<span class="keyword">*</span>DeviceB-route-policy] <strong>apply cost 100</strong>
[<span class="keyword">*</span>DeviceB-route-policy] <strong>quit</strong>
[<span class="keyword">*</span>DeviceB]<strong> bgp 200</strong>
[<span class="keyword">*</span>DeviceB-bgp] <strong>peer 10.20.1.1 route-policy 10 export</strong>
[<span class="keyword">*</span>DeviceB-bgp] <strong>quit</strong>
[<span class="keyword">*</span>DeviceB] <strong>commit</strong></pre>
<p># Configure DeviceC.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceC] <strong>route-policy 10 permit node 10</strong>
[<span class="keyword">*</span>DeviceC-route-policy] <strong>apply cost 150</strong>
[<span class="keyword">*</span>DeviceC-route-policy] <strong>quit</strong>
[<span class="keyword">*</span>DeviceC] <strong>bgp 200</strong>
[<span class="keyword">*</span>DeviceC-bgp] <strong>peer 10.20.2.1 route-policy 10 export</strong>
[<span class="keyword">*</span>DeviceC-bgp] <strong>quit</strong>
[<span class="keyword">*</span>DeviceC] <strong>commit</strong></pre>
<p># Check the BGP routing table of DeviceA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>display bgp routing-table</strong>

 BGP Local router ID is 1.1.1.1
 Status codes: * - valid, &gt; - best, d - damped,<span> x - best external,</span><span> a - add path,</span>
               h - history,  i - internal, s - suppressed, S - Stale
               Origin : i - IGP, e - EGP, ? - incomplete
 RPKI validation codes: V - valid, I - invalid, N - not-found

 Total Number of Routes: 2
      Network            NextHop        MED        LocPrf    PrefVal Path/Ogn

 *&gt;   172.16.1.0/24     <strong>10.20.1.2</strong>      <strong>100</strong>                   0      200i
 *                      10.20.2.2       150                   0      200i</pre>
<p>The BGP routing table shows that the next hop address of the route destined for 172.16.1.0/24 is 10.20.1.2 and traffic is transmitted on the primary link DeviceA -&gt; DeviceB.</p>
</p></li><li><span>Configure BFD, and set the interval at which BFD Control messages are sent and received as well as the local detection multiplier.</span><p><p># Enable BFD on DeviceA, set the minimum interval at which BFD Control messages are sent and received to 100 ms, and set the local detection multiplier to 4.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>bfd</strong>
[<span class="keyword">*</span>DeviceA-bfd]<strong> quit</strong>
[<span class="keyword">*</span>DeviceA]<strong> bgp 100</strong>
[<span class="keyword">*</span>DeviceA-bgp]<strong> peer 10.20.1.2 bfd enable</strong>
[<span class="keyword">*</span>DeviceA-bgp]<strong> peer 10.20.1.2 bfd min-tx-interval 100 min-rx-interval 100 detect-multiplier 4</strong>
[<span class="keyword">*</span>DeviceA-bgp]<strong> quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>commit</strong></pre>
<p># Enable BFD on DeviceB, set the minimum interval at which BFD Control messages are sent and received to 100 ms, and set the local detection multiplier to 4.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB] <strong>bfd</strong>
[<span class="keyword">*</span>DeviceB-bfd] <strong>quit</strong>
[<span class="keyword">*</span>DeviceB]<strong> bgp 200</strong>
[<span class="keyword">*</span>DeviceB-bgp] <strong>peer 10.20.1.1 bfd enable</strong>
[<span class="keyword">*</span>DeviceB-bgp] <strong>peer 10.20.1.1 bfd min-tx-interval 100 min-rx-interval 100 detect-multiplier 4</strong>
[<span class="keyword">*</span>DeviceB-bgp]<strong> quit</strong>
[<span class="keyword">*</span>DeviceB] <strong>commit</strong></pre>
<p># Check all BFD sessions established between BGP peers on DeviceA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>display bgp bfd session all</strong>
--------------------------------------------------------------------------------
  Local_Address      Peer_Address       Interface
  10.20.1.1          10.20.1.2           <span>100GE</span><span>1/0/1</span>
  Tx-interval(ms)    Rx-interval(ms)    Multiplier  Session-State
  100                100                <strong>4</strong>           <strong>Up</strong>
  Wtr-interval(m)
  0
--------------------------------------------------------------------------------</pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001130783914__1.3.5"></a><a name="1.3.5"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p># Run the <strong>shutdown</strong> command on DeviceB's <span>100GE</span><span>1/0/2</span> to simulate a primary link failure.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB] <strong>interface  <span>100GE</span><span>1/0/2</span></strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB- <span>100GE</span><span>1/0/2</span>] <strong>shutdown</strong>
[<span class="keyword">*</span>DeviceB- <span>100GE</span><span>1/0/2</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceB] <strong>commit</strong></pre>
<p># Check the BGP routing table of DeviceA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>display bgp routing-table</strong>

 BGP Local router ID is 1.1.1.1
 Status codes: * - valid, &gt; - best, d - damped,<span> x - best external,</span><span> a - add path,</span>
               h - history,  i - internal, s - suppressed, S - Stale
               Origin : i - IGP, e - EGP, ? - incomplete
 RPKI validation codes: V - valid, I - invalid, N - not-found

 Total Number of Routes: 1
      Network            NextHop        MED        LocPrf    PrefVal Path/Ogn

 *&gt;   172.16.1.0/24      10.20.2.2       150                   0      200i      </pre>
<p>The BGP routing table shows that the backup link DeviceA -&gt; DeviceC -&gt; DeviceB takes effect after the primary link fails, and that the next hop address of the route to 172.16.1.0/24 has become 10.20.2.2.</p>
</div>
<div class="postreq"><a name="EN-US_TASK_0000001130783914__postreq189611542893"></a><a name="postreq189611542893"></a><a name="EN-US_TASK_0000001130783914__1.3.6"></a><a name="1.3.6"></a><h4 class="sectiontitle">Configuration Scripts</h4><ul><li><p>DeviceA</p>
<pre class="screen">#
sysname DeviceA
#
bfd
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 10.20.1.1 255.255.255.0
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ip address 10.20.2.1 255.255.255.0
#
bgp 100
 router-id 1.1.1.1
 peer 10.20.1.2 as-number 200
 peer 10.20.1.2 ebgp-max-hop 255
 peer 10.20.1.2 bfd min-tx-interval 100 min-rx-interval 100 detect-multiplier 4
 peer 10.20.1.2 bfd enable
 peer 10.20.2.2 as-number 200
 peer 10.20.2.2 ebgp-max-hop 255
 #
 ipv4-family unicast
  peer 10.20.1.2 enable
  peer 10.20.2.2 enable
#
return</pre>
</li><li><p>DeviceB</p>
<pre class="screen">#
sysname DeviceB
#
bfd
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 10.1.1.1 255.255.255.0
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ip address 10.20.1.2 255.255.255.0
#
interface <span>100GE</span><span>1/0/3</span>
 undo portswitch
 ip address 172.16.1.1 255.255.255.0
#
bgp 200
 router-id 2.2.2.2
 peer 10.1.1.2 as-number 200
 peer 10.20.1.1 as-number 100
 peer 10.20.1.1 ebgp-max-hop 255
 peer 10.20.1.1 bfd min-tx-interval 100 min-rx-interval 100 detect-multiplier 4
 peer 10.20.1.1 bfd enable
 #
 ipv4-family unicast
  network 172.16.1.0 255.255.255.0
  peer 10.1.1.2 enable
  peer 10.20.1.1 enable
  peer 10.20.1.1 route-policy 10 export
#
route-policy 10 permit node 10
 apply cost 100
#
return</pre>
</li><li><p>DeviceC</p>
<pre class="screen">#
sysname DeviceC
#
bfd
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 10.1.1.2 255.255.255.0
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ip address 10.20.2.2 255.255.255.0
#
bgp 200
 router-id 3.3.3.3
 peer 10.1.1.1 as-number 200
 peer 10.20.2.1 as-number 100
 peer 10.20.2.1 ebgp-max-hop 255
 #
 ipv4-family unicast
  peer 10.1.1.1 enable
  peer 10.20.2.1 enable
  peer 10.20.2.1 route-policy 10 export
#
route-policy 10 permit node 10
 apply cost 150
#
return</pre>
</li></ul>
<p></p>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="vrp_bgp_cfg_0109.html">Configuring BFD for BGP
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="vrp_bgp_cfg_0111.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>
</body>
</html>