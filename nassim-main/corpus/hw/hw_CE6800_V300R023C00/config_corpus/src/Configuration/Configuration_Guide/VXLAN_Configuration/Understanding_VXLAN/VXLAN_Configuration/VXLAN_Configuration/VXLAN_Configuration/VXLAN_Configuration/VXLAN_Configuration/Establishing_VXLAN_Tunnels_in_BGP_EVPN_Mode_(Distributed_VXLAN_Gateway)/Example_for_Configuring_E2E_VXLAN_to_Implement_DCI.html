
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring E2E VXLAN to Implement DCI">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../dc/dc_vrp_vxlan_cfg_1066.html">
<meta name="DC.Relation" scheme="URI" content="../dc/dc_cfg_vxlan_cfgcase_0004.html">
<meta name="DC.Relation" scheme="URI" content="../dc/dc_cfg_vxlan_cfgcase_0011.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="VXLAN">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="VXLAN">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="VXLAN">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="VXLAN">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001568297137">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="../public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring E2E VXLAN to Implement DCI</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001568297137"></a><a name="EN-US_TASK_0000001568297137"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring E2E VXLAN to Implement DCI</h1>
<div class="taskbody" id="taskbody0000001568297137"><div class="context"><a name="EN-US_TASK_0000001568297137__1.3.1"></a><a name="1.3.1"></a>
<div class="p" id="EN-US_TASK_0000001568297137__context1363268974175357"><h4 class="sectiontitle">Networking Requirements</h4><p id="EN-US_TASK_0000001568297137__p725339178175357">As shown in <a href="#EN-US_TASK_0000001568297137__fig_dc_cfg_vxlan_cfgcase_001601">Figure 1</a>, an enterprise has VMs deployed in different DCs. VMa1 on Server1 belongs to VLAN 10 and resides in DC A. VMb2 on Server2 belongs to VLAN 20 and resides in DC B. The two VMs belong to different network segments. To implement E2E communication between the two VMs, create a VXLAN tunnel in distributed VXLAN gateway mode by configuring BGP EVPN on Leaf1 in DC A and Leaf4 in DC B.</p>
<div class="fignone" id="EN-US_TASK_0000001568297137__fig_dc_cfg_vxlan_cfgcase_001601"><a name="EN-US_TASK_0000001568297137__fig_dc_cfg_vxlan_cfgcase_001601"></a><a name="fig_dc_cfg_vxlan_cfgcase_001601"></a><span class="figcap"><b>Figure 1 </b>Configuring an E2E VXLAN tunnel</span><div class="note" id="EN-US_TASK_0000001568297137__note1648475717209"><img src="../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0000001568297137__p7484457122017">In this example, interface1, interface2, and interface3 represent <span>100GE</span><span>1/0/1</span>, <span>100GE</span><span>1/0/2</span>, and <span>100GE</span><span>1/0/3</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" id="EN-US_TASK_0000001568297137__image1348367782175357" src="images/fig_dc_cfg_vxlan_cfgcase_001601.png" width="NaN" height="NaN"></span></div>

<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" id="EN-US_TASK_0000001568297137__table_01" frame="border" border="1" rules="all"><caption><b>Table 1 </b>Interface IP addresses</caption><thead align="left"><tr id="EN-US_TASK_0000001568297137__row1744410268175357"><th align="left" class="cellrowborder" valign="top" width="11.42%" id="mcps1.3.1.4.2.7.1.1" liSelected="liSelected"><p id="EN-US_TASK_0000001568297137__p1272307310175357">Device</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="23.29%" id="mcps1.3.1.4.2.7.1.2" liSelected="liSelected"><p id="EN-US_TASK_0000001568297137__p1242681975175357">Interface</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="16.42%" id="mcps1.3.1.4.2.7.1.3" liSelected="liSelected"><p id="EN-US_TASK_0000001568297137__p1659237153175357">IP Address</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="11.4%" id="mcps1.3.1.4.2.7.1.4" liSelected="liSelected"><p id="EN-US_TASK_0000001568297137__p248546341175357">Device</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="21.18%" id="mcps1.3.1.4.2.7.1.5" liSelected="liSelected"><p id="EN-US_TASK_0000001568297137__p190569014175357">Interface</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="16.29%" id="mcps1.3.1.4.2.7.1.6" liSelected="liSelected"><p id="EN-US_TASK_0000001568297137__p883950771175357">IP Address</p>
</th>
</tr>
</thead>
<tbody><tr id="EN-US_TASK_0000001568297137__row1662569196175357"><td class="cellrowborder" rowspan="3" valign="middle" width="11.42%" headers="mcps1.3.1.4.2.7.1.1 "><p id="EN-US_TASK_0000001568297137__p32464257175357">Device1</p>
</td>
<td class="cellrowborder" valign="top" width="23.29%" headers="mcps1.3.1.4.2.7.1.2 "><p id="EN-US_TASK_0000001568297137__p1623168561175357"><span>100GE</span><span>1/0/1</span></p>
</td>
<td class="cellrowborder" valign="top" width="16.42%" headers="mcps1.3.1.4.2.7.1.3 "><p id="EN-US_TASK_0000001568297137__p1367185460175357">192.168.50.1/24</p>
</td>
<td class="cellrowborder" rowspan="3" valign="middle" width="11.4%" headers="mcps1.3.1.4.2.7.1.4 "><p id="EN-US_TASK_0000001568297137__p1273074903175357">Device2</p>
</td>
<td class="cellrowborder" valign="top" width="21.18%" headers="mcps1.3.1.4.2.7.1.5 "><p id="EN-US_TASK_0000001568297137__p449645290175357"><span>100GE</span><span>1/0/1</span></p>
</td>
<td class="cellrowborder" valign="top" width="16.29%" headers="mcps1.3.1.4.2.7.1.6 "><p id="EN-US_TASK_0000001568297137__p1239651283175357">192.168.60.1/24</p>
</td>
</tr>
<tr id="EN-US_TASK_0000001568297137__row1045874286175357"><td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.1 "><p id="EN-US_TASK_0000001568297137__p1822205006175357"><span>100GE</span><span>1/0/2</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.2 "><p id="EN-US_TASK_0000001568297137__p844969746175357">192.168.1.1/24</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.3 "><p id="EN-US_TASK_0000001568297137__p1018387073175357"><span>100GE</span><span>1/0/2</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.4 "><p id="EN-US_TASK_0000001568297137__p817300879175357">192.168.1.2/24</p>
</td>
</tr>
<tr id="EN-US_TASK_0000001568297137__row2092725097175357"><td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.1 "><p id="EN-US_TASK_0000001568297137__p395818094175357">Loopback0</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.2 "><p id="EN-US_TASK_0000001568297137__p66117265175357">1.1.1.1/32</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.3 "><p id="EN-US_TASK_0000001568297137__p675743646175357">Loopback0</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.4 "><p id="EN-US_TASK_0000001568297137__p825348004175357">2.2.2.2/32</p>
</td>
</tr>
<tr id="EN-US_TASK_0000001568297137__row1970006042175357"><td class="cellrowborder" rowspan="3" valign="middle" width="11.42%" headers="mcps1.3.1.4.2.7.1.1 "><p id="EN-US_TASK_0000001568297137__p196649716175357">Spine1</p>
</td>
<td class="cellrowborder" valign="top" width="23.29%" headers="mcps1.3.1.4.2.7.1.2 "><p id="EN-US_TASK_0000001568297137__p399665682175357"><span>100GE</span><span>1/0/1</span></p>
</td>
<td class="cellrowborder" valign="top" width="16.42%" headers="mcps1.3.1.4.2.7.1.3 "><p id="EN-US_TASK_0000001568297137__p1663387857175357">192.168.10.1/24</p>
</td>
<td class="cellrowborder" rowspan="3" valign="middle" width="11.4%" headers="mcps1.3.1.4.2.7.1.4 "><p id="EN-US_TASK_0000001568297137__p113631086175357">Spine2</p>
</td>
<td class="cellrowborder" valign="top" width="21.18%" headers="mcps1.3.1.4.2.7.1.5 "><p id="EN-US_TASK_0000001568297137__p1255214524175357"><span>100GE</span><span>1/0/1</span></p>
</td>
<td class="cellrowborder" valign="top" width="16.29%" headers="mcps1.3.1.4.2.7.1.6 "><p id="EN-US_TASK_0000001568297137__p53321163175357">192.168.30.1/24</p>
</td>
</tr>
<tr id="EN-US_TASK_0000001568297137__row954044828175357"><td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.1 "><p id="EN-US_TASK_0000001568297137__p1394672641175357"><span>100GE</span><span>1/0/2</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.2 "><p id="EN-US_TASK_0000001568297137__p1685077648175357">192.168.20.1/24</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.3 "><p id="EN-US_TASK_0000001568297137__p1194979389175357"><span>100GE</span><span>1/0/2</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.4 "><p id="EN-US_TASK_0000001568297137__p881870224175357">192.168.40.1/24</p>
</td>
</tr>
<tr id="EN-US_TASK_0000001568297137__row1239015974175357"><td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.1 "><p id="EN-US_TASK_0000001568297137__p513383694175357">Loopback0</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.2 "><p id="EN-US_TASK_0000001568297137__p2105495446175357">3.3.3.3/32</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.3 "><p id="EN-US_TASK_0000001568297137__p154880160175357">Loopback0</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.4 "><p id="EN-US_TASK_0000001568297137__p1753044445175357">4.4.4.4/32</p>
</td>
</tr>
<tr id="EN-US_TASK_0000001568297137__row2076444755175357"><td class="cellrowborder" rowspan="3" valign="middle" width="11.42%" headers="mcps1.3.1.4.2.7.1.1 "><p id="EN-US_TASK_0000001568297137__p261911039175357">Leaf1</p>
</td>
<td class="cellrowborder" valign="top" width="23.29%" headers="mcps1.3.1.4.2.7.1.2 "><p id="EN-US_TASK_0000001568297137__p1266065458175357"><span>100GE</span><span>1/0/1</span></p>
</td>
<td class="cellrowborder" valign="top" width="16.42%" headers="mcps1.3.1.4.2.7.1.3 "><p id="EN-US_TASK_0000001568297137__p720313781175357">192.168.10.2/24</p>
</td>
<td class="cellrowborder" rowspan="3" valign="middle" width="11.4%" headers="mcps1.3.1.4.2.7.1.4 "><p id="EN-US_TASK_0000001568297137__p1464430428175357">Leaf4</p>
</td>
<td class="cellrowborder" valign="top" width="21.18%" headers="mcps1.3.1.4.2.7.1.5 "><p id="EN-US_TASK_0000001568297137__p2136560048175357"><span>100GE</span><span>1/0/1</span></p>
</td>
<td class="cellrowborder" valign="top" width="16.29%" headers="mcps1.3.1.4.2.7.1.6 "><p id="EN-US_TASK_0000001568297137__p1884569675175357">192.168.40.2/24</p>
</td>
</tr>
<tr id="EN-US_TASK_0000001568297137__row123871040175357"><td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.1 "><p id="EN-US_TASK_0000001568297137__p192916721175357"><span>100GE</span><span>1/0/2</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.2 "><p id="EN-US_TASK_0000001568297137__p1152960905175357">-</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.3 "><p id="EN-US_TASK_0000001568297137__p388328353175357"><span>100GE</span><span>1/0/2</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.4 "><p id="EN-US_TASK_0000001568297137__p715253324175357">-</p>
</td>
</tr>
<tr id="EN-US_TASK_0000001568297137__row883229135175357"><td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.1 "><p id="EN-US_TASK_0000001568297137__p265677010175357">Loopback0</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.2 "><p id="EN-US_TASK_0000001568297137__p1472159215175357">5.5.5.5/32</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.3 "><p id="EN-US_TASK_0000001568297137__p369520824175357">Loopback0</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.4 "><p id="EN-US_TASK_0000001568297137__p1451831414175357">8.8.8.8/32</p>
</td>
</tr>
<tr id="EN-US_TASK_0000001568297137__row1206258569175357"><td class="cellrowborder" rowspan="3" valign="middle" width="11.42%" headers="mcps1.3.1.4.2.7.1.1 "><p id="EN-US_TASK_0000001568297137__p1459783619175357">Leaf2</p>
</td>
<td class="cellrowborder" valign="top" width="23.29%" headers="mcps1.3.1.4.2.7.1.2 "><p id="EN-US_TASK_0000001568297137__p932094299175357"><span>100GE</span><span>1/0/1</span></p>
</td>
<td class="cellrowborder" valign="top" width="16.42%" headers="mcps1.3.1.4.2.7.1.3 "><p id="EN-US_TASK_0000001568297137__p432599811175357">192.168.20.2/24</p>
</td>
<td class="cellrowborder" rowspan="3" valign="middle" width="11.4%" headers="mcps1.3.1.4.2.7.1.4 "><p id="EN-US_TASK_0000001568297137__p827230518175357">Leaf3</p>
</td>
<td class="cellrowborder" valign="top" width="21.18%" headers="mcps1.3.1.4.2.7.1.5 "><p id="EN-US_TASK_0000001568297137__p454844102175357"><span>100GE</span><span>1/0/1</span></p>
</td>
<td class="cellrowborder" valign="top" width="16.29%" headers="mcps1.3.1.4.2.7.1.6 "><p id="EN-US_TASK_0000001568297137__p830867487175357">192.168.30.2/24</p>
</td>
</tr>
<tr id="EN-US_TASK_0000001568297137__row1124110592175357"><td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.1 "><p id="EN-US_TASK_0000001568297137__p109542154175357"><span>100GE</span><span>1/0/3</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.2 "><p id="EN-US_TASK_0000001568297137__p823084951175357">192.168.50.2/24</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.3 "><p id="EN-US_TASK_0000001568297137__p773858171175357"><span>100GE</span><span>1/0/3</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.4 "><p id="EN-US_TASK_0000001568297137__p470705174175357">192.168.60.2/24</p>
</td>
</tr>
<tr id="EN-US_TASK_0000001568297137__row326739962175357"><td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.1 "><p id="EN-US_TASK_0000001568297137__p560499488175357">Loopback0</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.2 "><p id="EN-US_TASK_0000001568297137__p245297996175357">6.6.6.6/32</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.3 "><p id="EN-US_TASK_0000001568297137__p485240542175357">Loopback0</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.4 "><p id="EN-US_TASK_0000001568297137__p1294730850175357">7.7.7.7/32</p>
</td>
</tr>
</tbody>
</table>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001568297137__1.3.2"></a><a name="1.3.2"></a>
<div class="p" id="EN-US_TASK_0000001568297137__context1791788686175357"><h4 class="sectiontitle">Configuration Roadmap</h4><p id="EN-US_TASK_0000001568297137__p1396786281175357">The configuration roadmap is as follows:</p>
<ol id="EN-US_TASK_0000001568297137__ol1957343450175357"><li id="EN-US_TASK_0000001568297137__li106330734175357"><p id="EN-US_TASK_0000001568297137__p394252034175357"><a name="EN-US_TASK_0000001568297137__li106330734175357"></a><a name="li106330734175357"></a>Configure interface IP addresses for devices.</p>
</li><li id="EN-US_TASK_0000001568297137__li379282537175357"><p id="EN-US_TASK_0000001568297137__p870135063175357"><a name="EN-US_TASK_0000001568297137__li379282537175357"></a><a name="li379282537175357"></a>Configure routing protocols to ensure that devices can communicate with each other.</p>
</li><li id="EN-US_TASK_0000001568297137__li1355729051175357"><p id="EN-US_TASK_0000001568297137__p936665487175357"><a name="EN-US_TASK_0000001568297137__li1355729051175357"></a><a name="li1355729051175357"></a>Configure VXLAN service access points. </p>
</li><li id="EN-US_TASK_0000001568297137__li677213217182">Configure VXLAN tunnels.</li><li id="EN-US_TASK_0000001568297137__li0801526241">Configure Layer 3 VXLAN gateways.</li><li id="EN-US_TASK_0000001568297137__li10524782414">Configure the type of route to be advertised between VXLAN gateways. </li></ol>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001568297137__1.3.3"></a><a name="1.3.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol id="EN-US_TASK_0000001568297137__steps1819348992175357"><li id="EN-US_TASK_0000001568297137__step575910134175357"><span id="EN-US_TASK_0000001568297137__cmd612825109175357">Configure interface IP addresses for devices.</span><p><p id="EN-US_TASK_0000001568297137__p190808623175357"># Configure Device1. The configurations of other devices are similar to the configuration of Device1. For detailed configurations, see Configuration Scripts.</p>
<pre class="screen" id="EN-US_TASK_0000001568297137__screen5314548485">&lt;<span class="keyword" id="EN-US_TASK_0000001568297137__keyword288825270175357">HUAWEI</span>&gt; <strong id="EN-US_TASK_0000001568297137__b421803293175357">system-view</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword141191035814"><font style="font-size:8pt" Face="Courier New" >~</font></span></span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword2104953449175357">HUAWEI</span>] <strong id="EN-US_TASK_0000001568297137__b1773368561175357">sysname Device1</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword1652188171019">*</span></span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword969690710175357">HUAWEI</span>] <strong id="EN-US_TASK_0000001568297137__b378765553175357">commit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword151761739155618"><font style="font-size:8pt" Face="Courier New" >~</font></span></span>Device1] <strong id="EN-US_TASK_0000001568297137__b641458871175357">interface loopback 0</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword310811813561">*</span></span>Device1-LoopBack0] <strong id="EN-US_TASK_0000001568297137__b1323277340175357">ip address 1.1.1.1 32</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword19305151035620">*</span></span>Device1-LoopBack0] <strong id="EN-US_TASK_0000001568297137__b1636218836175357">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword420161219561">*</span></span>Device1] <strong id="EN-US_TASK_0000001568297137__b123426997175357">interface <span>100ge</span> <span>1/0/1</span></strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword1059614205620">*</span></span>Device1-<span>100GE</span><span>1/0/1</span>] <strong id="EN-US_TASK_0000001568297137__b459067790175357">undo portswitch</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword58809152568">*</span></span>Device1-<span>100GE</span><span>1/0/1</span>] <strong id="EN-US_TASK_0000001568297137__b565238834175357">ip address 192.168.50.1 24</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword517912184561">*</span></span>Device1-<span>100GE</span><span>1/0/1</span>] <strong id="EN-US_TASK_0000001568297137__b146578016175357">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword42661220145613">*</span></span>Device1] <strong id="EN-US_TASK_0000001568297137__b1395170172175357">interface <span>100ge</span> <span>1/0/2</span></strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword787717233569">*</span></span>Device1-<span>100GE</span><span>1/0/2</span>] <strong id="EN-US_TASK_0000001568297137__b550402134175357">undo portswitch</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword11860123155613">*</span></span>Device1-<span>100GE</span><span>1/0/2</span>] <strong id="EN-US_TASK_0000001568297137__b852427692175357">ip address 192.168.1.1 24</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword1962133365612">*</span></span>Device1-<span>100GE</span><span>1/0/2</span>] <strong id="EN-US_TASK_0000001568297137__b1203603298175357">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword9340257548">*</span></span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword2092415151">Device1</span>] <strong id="EN-US_TASK_0000001568297137__b183403573417">commit</strong></pre>
</p></li><li id="EN-US_TASK_0000001568297137__step943710766175357"><span id="EN-US_TASK_0000001568297137__cmd1780111067175357">Configure OSPF in DCs and BGP between DCs to implement route interworking.</span><p><p id="EN-US_TASK_0000001568297137__p647120296146"># Configure Device1. The configuration of Device2 is similar to the configuration of Device1. For detailed configurations, see Configuration Scripts.</p>
<pre class="screen" id="EN-US_TASK_0000001568297137__screen347122951416">[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword13471112918141"><font style="font-size:8pt" Face="Courier New" >~</font></span></span>Device1] <strong id="EN-US_TASK_0000001568297137__b13682044161913">bgp 10</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword24711529181413">*</span></span>Device1-bgp] <strong id="EN-US_TASK_0000001568297137__b175158339206">peer 192.168.1.2 as-number 10</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword18471629111417">*</span></span>Device1-bgp] <strong id="EN-US_TASK_0000001568297137__b1747492919207">peer 192.168.50.2 as-number 20</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword116241446145615">*</span></span>Device1-bgp] <strong id="EN-US_TASK_0000001568297137__b52581656115613">ipv4-family unicast</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword6471102912149">*</span></span>Device1-bgp-af-ipv4] <strong id="EN-US_TASK_0000001568297137__b510912103578">peer 192.168.1.2 enable</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword73001415574">*</span></span>Device1-bgp-af-ipv4] <strong id="EN-US_TASK_0000001568297137__b79664392573">peer 192.168.1.2 next-hop-local</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword16761917115716">*</span></span>Device1-bgp-af-ipv4] <strong id="EN-US_TASK_0000001568297137__b33541235195719">peer 192.168.50.2 enable</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword6471142917141">*</span></span>Device1-bgp-af-ipv4] <strong id="EN-US_TASK_0000001568297137__b104716298143">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword1423182511586">*</span></span>Device1-bgp] <strong id="EN-US_TASK_0000001568297137__b1723172519589">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword14711029141411">*</span></span>Device1] <strong id="EN-US_TASK_0000001568297137__b54711229191414">commit</strong></pre>
<p id="EN-US_TASK_0000001568297137__p1527712241376"># Configure Spine1. The configuration of Spine2 is similar to the configuration of Spine1. For detailed configurations, see Configuration Scripts.</p>
<pre class="screen" id="EN-US_TASK_0000001568297137__screen22771241375">&lt;<span class="keyword" id="EN-US_TASK_0000001568297137__keyword162779244714">HUAWEI</span>&gt; <strong id="EN-US_TASK_0000001568297137__b127713241078">system-view</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword12277324670"><font style="font-size:8pt" Face="Courier New" >~</font></span></span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword127742412713">HUAWEI</span>] <strong id="EN-US_TASK_0000001568297137__b1727717241072">sysname Spine1</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword10277152411717">*</span></span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword1527715242711">HUAWEI</span>] <strong id="EN-US_TASK_0000001568297137__b9277162414715">commit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword15277192412717"><font style="font-size:8pt" Face="Courier New" >~</font></span></span>Spine1] <strong id="EN-US_TASK_0000001568297137__b42771724876">ospf 1</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword112786249713">*</span></span>Spine1-ospf-1] <strong id="EN-US_TASK_0000001568297137__b1827814247710">area 0</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword172781124373">*</span></span>Spine1-ospf-1-area-0.0.0.0] <strong id="EN-US_TASK_0000001568297137__b1227819243711">network 3.3.3.3 0.0.0.0</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword1248718490818">*</span></span>Spine1-ospf-1-area-0.0.0.0] <strong id="EN-US_TASK_0000001568297137__b164871549481">network 192.168.10.0 0.0.0.255</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword132787243717">*</span></span>Spine1-ospf-1-area-0.0.0.0] <strong id="EN-US_TASK_0000001568297137__b327817241777">network 192.168.20.0 0.0.0.255</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword127892411717">*</span></span>Spine1-ospf-1-area-0.0.0.0] <strong id="EN-US_TASK_0000001568297137__b427813243719">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword22786241976">*</span></span>Spine1-ospf-1] <strong id="EN-US_TASK_0000001568297137__b927816241175">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword1227816247719">*</span></span>Spine1] <strong id="EN-US_TASK_0000001568297137__b182781242720">commit</strong></pre>
<p id="EN-US_TASK_0000001568297137__p1541768861175357"># Configure Leaf1. The configuration of Leaf4 is similar to the configuration of Leaf1. For detailed configurations, see Configuration Scripts.</p>
<pre class="screen" id="EN-US_TASK_0000001568297137__screen396904651414">&lt;<span class="keyword" id="EN-US_TASK_0000001568297137__keyword996954610149">HUAWEI</span>&gt; <strong id="EN-US_TASK_0000001568297137__b4969144671419">system-view</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword79691446171413"><font style="font-size:8pt" Face="Courier New" >~</font></span></span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword99691246171413">HUAWEI</span>] <strong id="EN-US_TASK_0000001568297137__b296924614143">sysname Leaf1</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword10969124619149">*</span></span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword119691746171412">HUAWEI</span>] <strong id="EN-US_TASK_0000001568297137__b1969144619140">commit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword5540323151519"><font style="font-size:8pt" Face="Courier New" >~</font></span></span>Leaf1] <strong id="EN-US_TASK_0000001568297137__b8755002179">ospf 1</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword18918622121612">*</span></span>Leaf1-ospf-1] <strong id="EN-US_TASK_0000001568297137__b1246810919513">area 0</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword131811925171617">*</span></span>Leaf1-ospf-1-area-0.0.0.0] <strong id="EN-US_TASK_0000001568297137__b1346819920513">network 5.5.5.5 0.0.0.0</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword945771819174">*</span></span>Leaf1-ospf-1-area-0.0.0.0] <strong id="EN-US_TASK_0000001568297137__b18457718121718">network 192.168.10.0 0.0.0.255</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword912342781620">*</span></span>Leaf1-ospf-1-area-0.0.0.0] <strong id="EN-US_TASK_0000001568297137__b104681191454">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword13724113621814">*</span></span>Leaf1-ospf-1] <strong id="EN-US_TASK_0000001568297137__b2072413360187">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword113031521111916">*</span></span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword12929524101913">Leaf1</span>] <strong id="EN-US_TASK_0000001568297137__b13033216195">commit</strong></pre>
</p><p><p id="EN-US_TASK_0000001568297137__p1684655361720"># Configure Leaf2. The configuration of Leaf3 is similar to the configuration of Leaf2. For detailed configurations, see Configuration Scripts.</p>
<pre class="screen" id="EN-US_TASK_0000001568297137__screen384635317178">&lt;<span class="keyword" id="EN-US_TASK_0000001568297137__keyword17846153171713">HUAWEI</span>&gt; <strong id="EN-US_TASK_0000001568297137__b48465530177">system-view</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword12846175321714"><font style="font-size:8pt" Face="Courier New" >~</font></span></span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword78462053131711">HUAWEI</span>] <strong id="EN-US_TASK_0000001568297137__b12846145391719">sysname Leaf2</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword158461153121719">*</span></span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword10846115315177">HUAWEI</span>] <strong id="EN-US_TASK_0000001568297137__b13846175311717">commit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword2084775371713"><font style="font-size:8pt" Face="Courier New" >~</font></span></span>Leaf2] <strong id="EN-US_TASK_0000001568297137__b1984775371720">ospf 1</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword12847185315179">*</span></span>Leaf2-ospf-1] <strong id="EN-US_TASK_0000001568297137__b10841012312">import-route bgp</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword41651257122210">*</span></span>Leaf2-ospf-1] <strong id="EN-US_TASK_0000001568297137__b161651957102211">area 0</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword984714536174">*</span></span>Leaf2-ospf-1-area-0.0.0.0] <strong id="EN-US_TASK_0000001568297137__b12847195321719">network 6.6.6.6 0.0.0.0</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword7847115320172">*</span></span>Leaf2-ospf-1-area-0.0.0.0] <strong id="EN-US_TASK_0000001568297137__b8847195381715">network 192.168.20.0 0.0.0.255</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword19847145371716">*</span></span>Leaf2-ospf-1-area-0.0.0.0] <strong id="EN-US_TASK_0000001568297137__b48476531170">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword193983411241">*</span></span>Leaf2-ospf-1] <strong id="EN-US_TASK_0000001568297137__b939819414249">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword14112191218244">*</span></span>Leaf2] <strong id="EN-US_TASK_0000001568297137__b20311215102415">commit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword9188684015"><font style="font-size:8pt" Face="Courier New" >~</font></span></span>Leaf2] <strong id="EN-US_TASK_0000001568297137__b1912651119019">bgp 20</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword103428181906">*</span></span>Leaf2-bgp] <strong id="EN-US_TASK_0000001568297137__b93421837102">peer 192.168.50.1 as-number 10</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword179331045406">*</span></span>Leaf2-bgp] <strong id="EN-US_TASK_0000001568297137__b168125613013">ipv4-family unicast</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword185675471902">*</span></span>Leaf2-bgp-af-ipv4] <strong id="EN-US_TASK_0000001568297137__b11620511211">network 5.5.5.5 255.255.255.255</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword1876193312118">*</span></span>Leaf2-bgp-af-ipv4] <strong id="EN-US_TASK_0000001568297137__b178275516114">network 6.6.6.6 255.255.255.255</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword116918343110">*</span></span>Leaf2-bgp-af-ipv4] <strong id="EN-US_TASK_0000001568297137__b585695819111">peer 192.168.50.1 enable</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword12942313926">*</span></span>Leaf2-bgp-af-ipv4] <strong id="EN-US_TASK_0000001568297137__b22361725224">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword814413017211">*</span></span>Leaf2-bgp] <strong id="EN-US_TASK_0000001568297137__b21446301422">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword166001137522">*</span></span>Leaf2] <strong id="EN-US_TASK_0000001568297137__b296018392219">commit</strong></pre>
</p></li><li id="EN-US_TASK_0000001568297137__step146286914171"><span id="EN-US_TASK_0000001568297137__cmd362817981711">Configure VXLAN service access points. </span><p><p id="EN-US_TASK_0000001568297137__p581799769175357"># Configure Leaf1.</p>
<pre class="screen" id="EN-US_TASK_0000001568297137__screen1624496343175357">[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword183772065418"><font style="font-size:8pt" Face="Courier New" >~</font></span></span>Leaf1] <strong id="EN-US_TASK_0000001568297137__b56072780175357">bridge-domain 10</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword10806133720496">*</span></span>Leaf1-bd10] <strong id="EN-US_TASK_0000001568297137__b17725192512265">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword43681440194915">*</span></span>Leaf1] <strong id="EN-US_TASK_0000001568297137__b2060219707175357">interface <span>100GE</span> <span>1/0/2</span>.1 mode l2</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword18663194215499">*</span></span>Leaf1-<span>100GE</span><span>1/0/2</span>.1] <strong id="EN-US_TASK_0000001568297137__b192191146182616">encapsulation dot1q vid 10</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword855864514914">*</span></span>Leaf1-<span>100GE</span><span>1/0/2</span>.1] <strong id="EN-US_TASK_0000001568297137__b1874418940175357">bridge-domain 10</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword19667147114913">*</span></span>Leaf1-<span>100GE</span><span>1/0/2</span>.1] <strong id="EN-US_TASK_0000001568297137__b2019411165175357">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword996424910494">*</span></span>Leaf1] <strong id="EN-US_TASK_0000001568297137__b1181676505175357">commit</strong></pre>
<p id="EN-US_TASK_0000001568297137__p15579152381712">The configuration of Leaf4 is similar to the configuration of Leaf1. For detailed configurations, see Configuration Scripts.</p>
</p></li><li id="EN-US_TASK_0000001568297137__step377705055175357"><span id="EN-US_TASK_0000001568297137__cmd127198853175357">Configure VXLAN tunnels.</span><ol type="a" id="EN-US_TASK_0000001568297137__substeps652628159175357"><li class="substepexpand" id="EN-US_TASK_0000001568297137__substep1520567621175357"><span id="EN-US_TASK_0000001568297137__cmd1124606847175357">Configure EVPN as the VXLAN control plane on Leaf1, Leaf2, Leaf3, and Leaf4.</span><p><p id="EN-US_TASK_0000001568297137__p1586054860175357"># Configure Leaf1.</p>
<pre class="screen" id="EN-US_TASK_0000001568297137__screen339558384175357">[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword1135272618547"><font style="font-size:8pt" Face="Courier New" >~</font></span></span>Leaf1] <strong id="EN-US_TASK_0000001568297137__b1325670113175357">evpn-overlay enable</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword16874121205012">*</span></span>Leaf1] <strong id="EN-US_TASK_0000001568297137__b605477833175357">commit</strong></pre>
<p id="EN-US_TASK_0000001568297137__p1981133959175357">The configurations of Leaf2, Leaf3, and Leaf4 are similar to the configuration of Leaf1. For detailed configurations, see Configuration Scripts. </p>
</p></li><li class="substepexpand" id="EN-US_TASK_0000001568297137__substep1654937854175357"><span id="EN-US_TASK_0000001568297137__cmd332316234175357">Establish an IBGP EVPN peer relationship between Leaf1 and Leaf2, and another one between Leaf3 and Leaf4.</span><p><p id="EN-US_TASK_0000001568297137__p1212048024175357"># Configure Leaf1.</p>
<pre class="screen" id="EN-US_TASK_0000001568297137__screen430044924175357">[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword1135613525253"><font style="font-size:8pt" Face="Courier New" >~</font></span></span>Leaf1] <strong id="EN-US_TASK_0000001568297137__b17356145218256">bgp 100 instance evpn1</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword93562523254">*</span></span>Leaf1-bgp-instance-evpn1] <strong id="EN-US_TASK_0000001568297137__b143567524250">peer 6.6.6.6 as-number 100</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword23566527255">*</span></span>Leaf1-bgp-instance-evpn1] <strong id="EN-US_TASK_0000001568297137__b1356195262519">peer 6.6.6.6 connect-interface LoopBack 0</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword14219416165011">*</span></span>Leaf1-bgp-instance-evpn1] <strong id="EN-US_TASK_0000001568297137__b92441214172912">l2vpn-family evpn</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword6338201812503">*</span></span>Leaf1-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001568297137__b828081059175357">peer 6.6.6.6 enable</strong>
Warning: This operation will reset the peer session. Continue? [Y/N]: <strong id="EN-US_TASK_0000001568297137__b836013922175357">y</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword19649221165017">*</span></span>Leaf1-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001568297137__b257860368175357">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword252013391863">*</span></span>Leaf1-bgp-instance-evpn1] <strong id="EN-US_TASK_0000001568297137__b15201139361">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword19918182375014">*</span></span>Leaf1] <strong id="EN-US_TASK_0000001568297137__b1818205008175357">commit</strong></pre>
<p id="EN-US_TASK_0000001568297137__p307407737175357"># Configure Leaf2.</p>
<pre class="screen" id="EN-US_TASK_0000001568297137__screen1681643262175357">[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword0589113914265"><font style="font-size:8pt" Face="Courier New" >~</font></span></span>Leaf2] <strong id="EN-US_TASK_0000001568297137__b8589133920265">bgp 100 instance evpn1</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword1758973914266">*</span></span>Leaf2-bgp-instance-evpn1] <strong id="EN-US_TASK_0000001568297137__b658903992613">peer 5.5.5.5 as-number 100</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword1158919397265">*</span></span>Leaf2-bgp-instance-evpn1] <strong id="EN-US_TASK_0000001568297137__b11589139132613">peer 5.5.5.5 connect-interface LoopBack 0</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword7253532195011">*</span></span>Leaf2-bgp-instance-evpn1] <strong id="EN-US_TASK_0000001568297137__b1069790288175357">l2vpn-family evpn</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword95052035195019">*</span></span>Leaf2-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001568297137__b4667419175357">peer 5.5.5.5 enable</strong>
Warning: This operation will reset the peer session. Continue? [Y/N]: <strong id="EN-US_TASK_0000001568297137__b1368621865175357">y</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword4746193914106">*</span></span>Leaf2-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001568297137__b9746163918102">peer 5.5.5.5 next-hop-invariable</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword17100194014505">*</span></span>Leaf2-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001568297137__b1827890584175357">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword26007511667">*</span></span>Leaf2-bgp-instance-evpn1] <strong id="EN-US_TASK_0000001568297137__b1360017513617">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword49114423509">*</span></span>Leaf2] <strong id="EN-US_TASK_0000001568297137__b1456970495175357">commit</strong></pre>
<p id="EN-US_TASK_0000001568297137__p648870883175357"># Configure Leaf3.</p>
<pre class="screen" id="EN-US_TASK_0000001568297137__screen1589831987175357">[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword3355123985417"><font style="font-size:8pt" Face="Courier New" >~</font></span></span>Leaf3] <strong id="EN-US_TASK_0000001568297137__b1231945896175357">bgp 200 instance evpn1</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword6408114710312">*</span></span>Leaf3-bgp-instance-evpn1] <strong id="EN-US_TASK_0000001568297137__b157732054103110">peer 8.8.8.8 as-number 200</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword1440749163115">*</span></span>Leaf3-bgp-instance-evpn1] <strong id="EN-US_TASK_0000001568297137__b868171614328">peer 8.8.8.8 connect-interface LoopBack 0</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword1633134615501">*</span></span>Leaf3-bgp-instance-evpn1] <strong id="EN-US_TASK_0000001568297137__b2122551822175357">l2vpn-family evpn</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword11124484503">*</span></span>Leaf3-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001568297137__b1899074891175357">peer 8.8.8.8 enable</strong>
Warning: This operation will reset the peer session. Continue? [Y/N]: <strong id="EN-US_TASK_0000001568297137__b1903857225175357">y</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword14885950205012">*</span></span>Leaf3-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001568297137__b1870149084175357">peer 8.8.8.8 next-hop-invariable</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword198185310506">*</span></span>Leaf3-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001568297137__b10804419193012">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword189191154115014">*</span></span>Leaf3-bgp-instance-evpn1] <strong id="EN-US_TASK_0000001568297137__b580312193304">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword777795645010">*</span></span>Leaf3] <strong id="EN-US_TASK_0000001568297137__b6803111973012">commit</strong></pre>
<p id="EN-US_TASK_0000001568297137__p575198405175357"># Configure Leaf4.</p>
<pre class="screen" id="EN-US_TASK_0000001568297137__screen2012572570175357">[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword3176444145413"><font style="font-size:8pt" Face="Courier New" >~</font></span></span>Leaf4] <strong id="EN-US_TASK_0000001568297137__b1580580982175357">bgp 200 instance evpn1</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword7884251143219">*</span></span>Leaf4-bgp-instance-evpn1] <strong id="EN-US_TASK_0000001568297137__b1467211584322">peer 7.7.7.7 as-number 200</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword116115520324">*</span></span>Leaf4-bgp-instance-evpn1] <strong id="EN-US_TASK_0000001568297137__b985713416331">peer 7.7.7.7 connect-interface LoopBack 0</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword113982195120">*</span></span>Leaf4-bgp-instance-evpn1] <strong id="EN-US_TASK_0000001568297137__b163753213308">l2vpn-family evpn</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword209919305114">*</span></span>Leaf4-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001568297137__b146371132113013">peer 7.7.7.7 enable</strong>
Warning: This operation will reset the peer session. Continue? [Y/N]: <strong id="EN-US_TASK_0000001568297137__b13637203213010">y</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword08016685118">*</span></span>Leaf4-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001568297137__b17637173213306">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword338680515">*</span></span>Leaf4-bgp-instance-evpn1] <strong id="EN-US_TASK_0000001568297137__b10637132173018">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword670219912517">*</span></span>Leaf4] <strong id="EN-US_TASK_0000001568297137__b1863653243014">commit</strong></pre>
</p></li><li class="substepexpand" id="EN-US_TASK_0000001568297137__substep1895729642175357"><span id="EN-US_TASK_0000001568297137__cmd1460706202175357">Configure an EBGP EVPN peer relationship between Leaf2 and Leaf3.</span><p><p id="EN-US_TASK_0000001568297137__p534080392175357"># Configure Leaf2.</p>
<pre class="screen" id="EN-US_TASK_0000001568297137__screen975634417175357">[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword270617113276"><font style="font-size:8pt" Face="Courier New" >~</font></span></span>Leaf2] <strong id="EN-US_TASK_0000001568297137__b1070610119272">bgp 100 instance evpn1</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword2070615110272">*</span></span>Leaf2-bgp-instance-evpn1] <strong id="EN-US_TASK_0000001568297137__b17061511102712">peer 7.7.7.7 as-number 200</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword670621110278">*</span></span>Leaf2-bgp-instance-evpn1] <strong id="EN-US_TASK_0000001568297137__b1370614118273">peer 7.7.7.7 connect-interface LoopBack 0</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword16589181425119">*</span></span>Leaf2-bgp-instance-evpn1] <strong id="EN-US_TASK_0000001568297137__b5859144012325">l2vpn-family evpn</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword23521517135117">*</span></span>Leaf2-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001568297137__b1385924013320">undo policy vpn-target</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword10112131935113">*</span></span>Leaf2-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001568297137__b16859104073217">peer 7.7.7.7 enable</strong>
Warning: This operation will reset the peer session. Continue? [Y/N]: <strong id="EN-US_TASK_0000001568297137__b17859194010321">y</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword05143222512">*</span></span>Leaf2-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001568297137__b188591140103212">peer 7.7.7.7 next-hop-invariable</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword599312712516">*</span></span>Leaf2-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001568297137__b585994023213">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword5723015110">*</span></span>Leaf2-bgp-instance-evpn1] <strong id="EN-US_TASK_0000001568297137__b17859114011321">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword07751931105116">*</span></span>Leaf2] <strong id="EN-US_TASK_0000001568297137__b1085915405322">commit</strong></pre>
<p id="EN-US_TASK_0000001568297137__p1603685222175357"># Configure Leaf3.</p>
<pre class="screen" id="EN-US_TASK_0000001568297137__screen2104023996175357">[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword51162052185418"><font style="font-size:8pt" Face="Courier New" >~</font></span></span>Leaf3] <strong id="EN-US_TASK_0000001568297137__b720487067175357">bgp 200 instance evpn1</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword1785511340298">*</span></span>Leaf3-bgp-instance-evpn1] <strong id="EN-US_TASK_0000001568297137__b1587017410319">peer 6.6.6.6 as-number 100</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword1656416407296">*</span></span>Leaf3-bgp-instance-evpn1] <strong id="EN-US_TASK_0000001568297137__b192687803112">peer 6.6.6.6 connect-interface LoopBack0</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword327536115112">*</span></span>Leaf3-bgp-instance-evpn1] <strong id="EN-US_TASK_0000001568297137__b1638125123218">l2vpn-family evpn</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword138291837195115">*</span></span>Leaf3-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001568297137__b193812511326">undo policy vpn-target</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword5637408514">*</span></span>Leaf3-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001568297137__b238175183212">peer 6.6.6.6 enable</strong>
Warning: This operation will reset the peer session. Continue? [Y/N]: <strong id="EN-US_TASK_0000001568297137__b19382514320">y</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword13921343185115">*</span></span>Leaf3-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001568297137__b13819518327">peer 6.6.6.6 next-hop-invariable</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword201351545115110">*</span></span>Leaf3-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001568297137__b113810512324">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword97027463518">*</span></span>Leaf3-bgp-instance-evpn1] <strong id="EN-US_TASK_0000001568297137__b337135123215">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword41671648105113">*</span></span>Leaf3] <strong id="EN-US_TASK_0000001568297137__b5374511326">commit</strong></pre>
</p></li><li class="substepexpand" id="EN-US_TASK_0000001568297137__substep1111202811215"><span id="EN-US_TASK_0000001568297137__cmd71117288217">Configure EVPN instances.</span><p><p id="EN-US_TASK_0000001568297137__p548647222"># Configure Leaf1.</p>
<pre class="screen" id="EN-US_TASK_0000001568297137__screen4483420222">[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword948342220"><font style="font-size:8pt" Face="Courier New" >~</font></span></span>Leaf1] <strong id="EN-US_TASK_0000001568297137__b5481452213">ip vpn-instance vpn1</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword11481849220">*</span></span>Leaf1-vpn-instance-vpn1] <strong id="EN-US_TASK_0000001568297137__b1486414224">vxlan vni 5010</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword5481041221">*</span></span>Leaf1-vpn-instance-vpn1] <strong id="EN-US_TASK_0000001568297137__b154884122218">ipv4-family</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword104884152214">*</span></span>Leaf1-vpn-instance-vpn1-af-ipv4] <strong id="EN-US_TASK_0000001568297137__b1748194192218">route-distinguisher 20:1</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword1048134122216">*</span></span>Leaf1-vpn-instance-vpn1-af-ipv4] <strong id="EN-US_TASK_0000001568297137__b114810416227">vpn-target 100:5010 evpn</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword134824172217">*</span></span>Leaf1-vpn-instance-vpn1-af-ipv4] <strong id="EN-US_TASK_0000001568297137__b16495418223">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword20498417227">*</span></span>Leaf1-vpn-instance-vpn1] <strong id="EN-US_TASK_0000001568297137__b124918472216">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword9498415220">*</span></span>Leaf1] <strong id="EN-US_TASK_0000001568297137__b04915415221">bridge-domain 10</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword1649943223">*</span></span>Leaf1-bd10] <strong id="EN-US_TASK_0000001568297137__b64944122216">vxlan vni 10</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword124913416226">*</span></span>Leaf1-bd10] <strong id="EN-US_TASK_0000001568297137__b04912422210">evpn</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword2497432213">*</span></span>Leaf1-bd10-evpn] <strong id="EN-US_TASK_0000001568297137__b54974172212">route-distinguisher 10:1</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword105017415227">*</span></span>Leaf1-bd10-evpn] <strong id="EN-US_TASK_0000001568297137__b16501418224">vpn-target 100:10</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword1150164162213">*</span></span>Leaf1-bd10-evpn] <strong id="EN-US_TASK_0000001568297137__b6503412221">vpn-target 100:5010 export-extcommunity</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword550174122217">*</span></span>Leaf1-bd10-evpn] <strong id="EN-US_TASK_0000001568297137__b3507412215">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword135014462219">*</span></span>Leaf1-bd10] <strong id="EN-US_TASK_0000001568297137__b1050643226">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword8507432218">*</span></span>Leaf1] <strong id="EN-US_TASK_0000001568297137__b12506414224">commit</strong></pre>
<p id="EN-US_TASK_0000001568297137__p4503411224">The configuration of Leaf4 is similar to the configuration of Leaf1. For detailed configurations, see Configuration Scripts.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0000001568297137__substep437254172115"><span id="EN-US_TASK_0000001568297137__cmd937145442118">Enable ingress replication on leaf nodes.</span><p><p id="EN-US_TASK_0000001568297137__p1221603078175357"># Configure Leaf1.</p>
<pre class="screen" id="EN-US_TASK_0000001568297137__screen1866171420175357">[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword4300151615513"><font style="font-size:8pt" Face="Courier New" >~</font></span></span>Leaf1] <strong id="EN-US_TASK_0000001568297137__b2093304111175357">interface nve 1</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword63228494528">*</span></span>Leaf1-Nve1] <strong id="EN-US_TASK_0000001568297137__b14585195333912">source 5.5.5.5</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword99721050145218">*</span></span>Leaf1-Nve1] <strong id="EN-US_TASK_0000001568297137__b95851353153914">vni 10 head-end peer-list protocol bgp</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword1549211529521">*</span></span>Leaf1-Nve1] <strong id="EN-US_TASK_0000001568297137__b1158515312395">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword3468554175220">*</span></span>Leaf1] <strong id="EN-US_TASK_0000001568297137__b1585853113917">commit</strong></pre>
<p id="EN-US_TASK_0000001568297137__p97081441162213">The configuration of Leaf4 is similar to the configuration of Leaf1. For detailed configurations, see Configuration Scripts.</p>
</p></li></ol>
</li><li id="EN-US_TASK_0000001568297137__step13101133417247"><span id="EN-US_TASK_0000001568297137__cmd1610113422410">Configure Layer 3 VXLAN gateways.</span><p><p id="EN-US_TASK_0000001568297137__p908149761175357"># Configure Leaf1.</p>
<pre class="screen" id="EN-US_TASK_0000001568297137__screen1856897019175357">[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword118691220175516"><font style="font-size:8pt" Face="Courier New" >~</font></span></span>Leaf1] <strong id="EN-US_TASK_0000001568297137__b1573267388175357">interface vbdif 10</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword42775013532">*</span></span>Leaf1-Vbdif10] <strong id="EN-US_TASK_0000001568297137__b1128145428">ip binding vpn-instance vpn1</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword129562185319">*</span></span>Leaf1-Vbdif10] <strong id="EN-US_TASK_0000001568297137__b1220149427">ip address 10.1.1.1 24</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword1282163165315">*</span></span>Leaf1-Vbdif10] <strong id="EN-US_TASK_0000001568297137__b41201419426">arp collect host enable</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword44320745310">*</span></span>Leaf1-Vbdif10] <strong id="EN-US_TASK_0000001568297137__b217147428">vxlan anycast-gateway enable</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword142986915537">*</span></span>Leaf1-Vbdif10] <strong id="EN-US_TASK_0000001568297137__b0113142427">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword103741211155313">*</span></span>Leaf1] <strong id="EN-US_TASK_0000001568297137__b8111413425">commit</strong></pre>
<p id="EN-US_TASK_0000001568297137__p99108092518">The configuration of Leaf4 is similar to the configuration of Leaf1. For detailed configurations, see Configuration Scripts.</p>
</p></li><li id="EN-US_TASK_0000001568297137__step388600225175357"><span id="EN-US_TASK_0000001568297137__cmd706211048175357">Configure the type of route to be advertised between VXLAN gateways. </span><p><p id="EN-US_TASK_0000001568297137__p562854212175357"># Configure Leaf1.</p>
<pre class="screen" id="EN-US_TASK_0000001568297137__screen200885882175357">[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword10649102410553"><font style="font-size:8pt" Face="Courier New" >~</font></span></span>Leaf1] <strong id="EN-US_TASK_0000001568297137__b603138964175357">bgp 100 instance evpn1</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword33691921205316">*</span></span>Leaf1-bgp-instance-evpn1] <strong id="EN-US_TASK_0000001568297137__b1453223118434">l2vpn-family evpn</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword17107123195316">*</span></span>Leaf1-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001568297137__b16532103116437">peer 6.6.6.6 advertise irb</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword36281324105313">*</span></span>Leaf1-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001568297137__b1953273115434">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword1637326185318">*</span></span>Leaf1-bgp-instance-evpn1] <strong id="EN-US_TASK_0000001568297137__b12532143115434">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword4388142717538">*</span></span>Leaf1] <strong id="EN-US_TASK_0000001568297137__b2053293118432">commit</strong></pre>
<p id="EN-US_TASK_0000001568297137__p40209872175357"># Configure Leaf2.</p>
<pre class="screen" id="EN-US_TASK_0000001568297137__screen1340888429175357">[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword1965272819552"><font style="font-size:8pt" Face="Courier New" >~</font></span></span>Leaf2] <strong id="EN-US_TASK_0000001568297137__b1837122144175357">bgp 100 instance evpn1</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword8974133110535">*</span></span>Leaf2-bgp-instance-evpn1] <strong id="EN-US_TASK_0000001568297137__b39668419438">l2vpn-family evpn</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword179193495317">*</span></span>Leaf2-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001568297137__b59661841134318">peer 5.5.5.5 advertise irb</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword196741535175313">*</span></span>Leaf2-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001568297137__b17966114154310">peer 7.7.7.7 advertise irb</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword6532937125313">*</span></span>Leaf2-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001568297137__b129668418431">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword788339175312">*</span></span>Leaf2-bgp-instance-evpn1] <strong id="EN-US_TASK_0000001568297137__b596616410432">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword2055084075313">*</span></span>Leaf2] <strong id="EN-US_TASK_0000001568297137__b996611411431">commit</strong></pre>
<p id="EN-US_TASK_0000001568297137__p13966041104312">The configurations of Leaf4 and Leaf3 are similar to the configurations of Leaf1 and Leaf2, respectively. For detailed configurations, see Configuration Scripts.</p>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0000001568297137__example1272468428175357"><a name="EN-US_TASK_0000001568297137__1.3.4"></a><a name="1.3.4"></a><h4 class="sectiontitle">Verifying the Configuration</h4><div class="p" id="EN-US_TASK_0000001568297137__p724096425175357">After the configurations are complete, run the <a href="cmdqueryname=display+vxlan+tunnel"><b><span class="cmdname" id="EN-US_TASK_0000001568297137__cmdname1843517315175357">display vxlan tunnel</span></b></a> command on each leaf node to check information about the established VXLAN tunnels. The following example uses the command output on Leaf1.<pre class="screen" id="EN-US_TASK_0000001568297137__screen1659355377175357">[<span><span class="keyword" id="EN-US_TASK_0000001568297137__keyword260518547575"><font style="font-size:8pt" Face="Courier New" >~</font></span></span>Leaf1] <strong id="EN-US_TASK_0000001568297137__b1221778452175357">display vxlan tunnel</strong>
Number of vxlan tunnel : 1
Tunnel ID   Source                Destination           State  Type     Uptime
-----------------------------------------------------------------------------------
4026531842  5.5.5.5               8.8.8.8               up     dynamic  00:10:16</pre>
</div>
<p id="EN-US_TASK_0000001568297137__p1292262450175357">After the configurations are complete, VMa1 and VMb2 can communicate with each other.</p>
</div>
<div class="postreq"><a name="EN-US_TASK_0000001568297137__1.3.5"></a><a name="1.3.5"></a><h4 class="sectiontitle">Configuration Scripts</h4><ul id="EN-US_TASK_0000001568297137__ul512840946175357"><li id="EN-US_TASK_0000001568297137__li1516314493175357"><p id="EN-US_TASK_0000001568297137__p509244902175357"><a name="EN-US_TASK_0000001568297137__li1516314493175357"></a><a name="li1516314493175357"></a>Spine1</p>
<pre class="screen" id="EN-US_TASK_0000001568297137__screen69285242175357">#
sysname Spine1
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 192.168.10.1 255.255.255.0
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ip address 192.168.20.1 255.255.255.0
#
interface LoopBack0
 ip address 3.3.3.3 255.255.255.255
#
ospf 1
 area 0.0.0.0
  network 3.3.3.3 0.0.0.0
  network 192.168.10.0 0.0.0.255
  network 192.168.20.0 0.0.0.255
#
return </pre>
</li><li id="EN-US_TASK_0000001568297137__li2038899306175357"><p id="EN-US_TASK_0000001568297137__p384080763175357"><a name="EN-US_TASK_0000001568297137__li2038899306175357"></a><a name="li2038899306175357"></a>Leaf1</p>
<pre class="screen" id="EN-US_TASK_0000001568297137__screen753234419175357">#
sysname Leaf1
#
evpn-overlay enable
#
ip vpn-instance vpn1
 ipv4-family
  route-distinguisher 20:1
  vpn-target 100:5010 export-extcommunity evpn
  vpn-target 100:5010 import-extcommunity evpn
 vxlan vni 5010
#
bridge-domain 10
 vxlan vni 10
 #
 evpn
  route-distinguisher 10:1
  vpn-target 100:10 export-extcommunity
  vpn-target 100:5010 export-extcommunity
  vpn-target 100:10 import-extcommunity
#
interface Vbdif10
 ip binding vpn-instance vpn1
 ip address 10.1.1.1 255.255.255.0
 vxlan anycast-gateway enable
 arp collect host enable
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 192.168.10.2 255.255.255.0
#
interface <span>100GE</span><span>1/0/2</span>.1 mode l2
 encapsulation dot1q vid 10
 bridge-domain 10
#
interface LoopBack0
 ip address 5.5.5.5 255.255.255.255
#
interface Nve1
 source 5.5.5.5
 vni 10 head-end peer-list protocol bgp
#
bgp 100 instance evpn1
 peer 6.6.6.6 as-number 100
 peer 6.6.6.6 connect-interface LoopBack0
 #
 l2vpn-family evpn
  policy vpn-target
  peer 6.6.6.6 enable
  peer 6.6.6.6 advertise irb
#
ospf 1
 area 0.0.0.0
  network 5.5.5.5 0.0.0.0
  network 192.168.10.0 0.0.0.255
#
return</pre>
</li><li id="EN-US_TASK_0000001568297137__li2112001844175357"><p id="EN-US_TASK_0000001568297137__p657790845175357"><a name="EN-US_TASK_0000001568297137__li2112001844175357"></a><a name="li2112001844175357"></a>Leaf2</p>
<pre class="screen" id="EN-US_TASK_0000001568297137__screen1744023661175357">#
sysname Leaf2
#
evpn-overlay enable
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 192.168.20.2 255.255.255.0
#
interface <span>100GE</span><span>1/0/3</span>
 undo portswitch
 ip address 192.168.50.2 255.255.255.0
#
interface LoopBack0
 ip address 6.6.6.6 255.255.255.255
#
bgp 20
 peer 192.168.50.1 as-number 10
 #
 ipv4-family unicast
  network 5.5.5.5 255.255.255.255
  network 6.6.6.6 255.255.255.255
  peer 192.168.50.1 enable
#
bgp 100 instance evpn1
 peer 5.5.5.5 as-number 100
 peer 5.5.5.5 connect-interface LoopBack0
 peer 7.7.7.7 as-number 200
 peer 7.7.7.7 connect-interface LoopBack0
 #
 l2vpn-family evpn
  undo policy vpn-target
  peer 5.5.5.5 enable
  peer 5.5.5.5 advertise irb
  peer 5.5.5.5 next-hop-invariable
  peer 7.7.7.7 enable
  peer 7.7.7.7 advertise irb
  peer 7.7.7.7 next-hop-invariable
#
ospf 1
 import-route bgp
 area 0.0.0.0
  network 6.6.6.6 0.0.0.0
  network 192.168.20.0 0.0.0.255
#
return</pre>
</li><li id="EN-US_TASK_0000001568297137__li1658043728175357"><p id="EN-US_TASK_0000001568297137__p993133024175357"><a name="EN-US_TASK_0000001568297137__li1658043728175357"></a><a name="li1658043728175357"></a>Spine2</p>
<pre class="screen" id="EN-US_TASK_0000001568297137__screen663344889175357">#
sysname Spine2
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 192.168.30.1 255.255.255.0
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ip address 192.168.40.1 255.255.255.0
#
interface LoopBack0
 ip address 4.4.4.4 255.255.255.255
#
ospf 1
 area 0.0.0.0
  network 4.4.4.4 0.0.0.0
  network 192.168.30.0 0.0.0.255
  network 192.168.40.0 0.0.0.255
#
return</pre>
</li><li id="EN-US_TASK_0000001568297137__li600766483175357"><p id="EN-US_TASK_0000001568297137__p1761655234175357"><a name="EN-US_TASK_0000001568297137__li600766483175357"></a><a name="li600766483175357"></a>Leaf3</p>
<pre class="screen" id="EN-US_TASK_0000001568297137__screen2042669162175357">#
sysname Leaf3
#
evpn-overlay enable
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 192.168.30.2 255.255.255.0
#
interface <span>100GE</span><span>1/0/3</span>
 undo portswitch
 ip address 192.168.60.2 255.255.255.0
#
interface LoopBack0
 ip address 7.7.7.7 255.255.255.255
#
bgp 30
 peer 192.168.60.1 as-number 10
 #
 ipv4-family unicast
  network 7.7.7.7 255.255.255.255
  network 8.8.8.8 255.255.255.255
  peer 192.168.60.1 enable
#
bgp 200 instance evpn1
 peer 6.6.6.6 as-number 100
 peer 6.6.6.6 connect-interface LoopBack0
 peer 8.8.8.8 as-number 200
 peer 8.8.8.8 connect-interface LoopBack0
 #
 l2vpn-family evpn
  undo policy vpn-target
  peer 6.6.6.6 enable
  peer 6.6.6.6 advertise irb
  peer 6.6.6.6 next-hop-invariable
  peer 8.8.8.8 enable
  peer 8.8.8.8 advertise irb
  peer 8.8.8.8 next-hop-invariable
#
ospf 1
 import-route bgp
 area 0.0.0.0
  network 7.7.7.7 0.0.0.0
  network 192.168.30.0 0.0.0.255
#
return</pre>
</li><li id="EN-US_TASK_0000001568297137__li346845359175357"><p id="EN-US_TASK_0000001568297137__p1159330755175357"><a name="EN-US_TASK_0000001568297137__li346845359175357"></a><a name="li346845359175357"></a>Leaf4</p>
<pre class="screen" id="EN-US_TASK_0000001568297137__screen1717838014175357">#
sysname Leaf4
#
evpn-overlay enable
#
ip vpn-instance vpn1
 ipv4-family
  route-distinguisher 20:4
  vpn-target 100:5010 export-extcommunity evpn
  vpn-target 100:5010 import-extcommunity evpn
 vxlan vni 5010
#
bridge-domain 20
 vxlan vni 20
 #
 evpn
  route-distinguisher 10:4
  vpn-target 100:20 export-extcommunity
  vpn-target 100:5010 export-extcommunity
  vpn-target 100:20 import-extcommunity
#
interface Vbdif20
 ip binding vpn-instance vpn1
 ip address 10.2.1.1 255.255.255.0
 vxlan anycast-gateway enable
 arp collect host enable
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 192.168.40.2 255.255.255.0
#
interface <span>100GE</span><span>1/0/2</span>.1 mode l2
 encapsulation dot1q vid 20
 bridge-domain 20
#
interface LoopBack0
 ip address 8.8.8.8 255.255.255.255
#
interface Nve1
 source 8.8.8.8
 vni 20 head-end peer-list protocol bgp
#
bgp 200 instance evpn1
 peer 7.7.7.7 as-number 200
 peer 7.7.7.7 connect-interface LoopBack0
 #
 l2vpn-family evpn
  policy vpn-target
  peer 7.7.7.7 enable
  peer 7.7.7.7 advertise irb
#
ospf 1
 area 0.0.0.0
  network 8.8.8.8 0.0.0.0
  network 192.168.40.0 0.0.0.255
#
return</pre>
</li><li id="EN-US_TASK_0000001568297137__li1488519849175357"><p id="EN-US_TASK_0000001568297137__p1516098240175357"><a name="EN-US_TASK_0000001568297137__li1488519849175357"></a><a name="li1488519849175357"></a>Device1</p>
<pre class="screen" id="EN-US_TASK_0000001568297137__screen209051537175357">#
sysname Device1
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 192.168.50.1 255.255.255.0
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ip address 192.168.1.1 255.255.255.0
#
interface LoopBack0
 ip address 1.1.1.1 255.255.255.255
#
bgp 10
 peer 192.168.1.2 as-number 10
 peer 192.168.50.2 as-number 20
 #
 ipv4-family unicast
  peer 192.168.1.2 enable
  peer 192.168.1.2 next-hop-local
  peer 192.168.50.2 enable
#
return </pre>
</li><li id="EN-US_TASK_0000001568297137__li1810542810175357"><p id="EN-US_TASK_0000001568297137__p2097213327175357"><a name="EN-US_TASK_0000001568297137__li1810542810175357"></a><a name="li1810542810175357"></a>Device2</p>
<pre class="screen" id="EN-US_TASK_0000001568297137__screen639844529175357">#
sysname Device2
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 192.168.60.1 255.255.255.0
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ip address 192.168.1.2 255.255.255.0
#
interface LoopBack0
 ip address 2.2.2.2 255.255.255.255
#
bgp 10
 peer 192.168.1.1 as-number 10
 peer 192.168.60.2 as-number 30
 #
 ipv4-family unicast
  peer 192.168.1.1 enable
  peer 192.168.1.1 next-hop-local
  peer 192.168.60.2 enable
#
return </pre>
</li></ul>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../dc/dc_vrp_vxlan_cfg_1066.html">Establishing VXLAN Tunnels in BGP EVPN Mode (Distributed VXLAN Gateway)
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../dc/dc_cfg_vxlan_cfgcase_0004.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../dc/dc_cfg_vxlan_cfgcase_0011.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>