
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring BGP or BGP4+ over M-LAG">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../dc/dc_cfg_m-lag_0021.html">
<meta name="DC.Relation" scheme="URI" content="../dc/dc_cfg_m-lag_0010.html">
<meta name="DC.Relation" scheme="URI" content="../dc/dc_cfg_m-lag_0042.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="M-LAG">
<meta name="featuretype" content="High Availability">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="M-LAG">
<meta name="featuretype" content="High Availability">
<meta name="featurename" content="M-LAG">
<meta name="featuretype" content="High Availability">
<meta name="featuretype" content="High Availability">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001512689674">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="../public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="../public_sys-resources/browseVersion.js"></script>
<title>Configuring BGP or BGP4+ over M-LAG</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001512689674"></a><a name="EN-US_TASK_0000001512689674"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring BGP or BGP4+ over M-LAG</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001512689674__1.3.1"></a><a name="1.3.1"></a>
<div class="p"><h4 class="sectiontitle">Prerequisites</h4><p>Before configuring BGP or BGP4+ over M-LAG, you have completed the following tasks:</p>
<ul><li>Establish an M-LAG and a BGP or BGP4+ network.</li><li>Add M-LAG member interfaces to the corresponding VLAN.</li><li>Enable BGP or BGP4+ on the user-side device.</li></ul>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001512689674__1.3.2"></a><a name="1.3.2"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><div class="note"><img src="../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>BGP or BGP4+ over M-LAG can be configured only for an M-LAG in dual-active mode. The active/standby mode and BGP or BGP4+ over M-LAG are mutually exclusive.</p>
<p>For the <span>CE6820H, CE6820H-K, and CE6820S</span>: VXLAN-related configurations are not supported.</p>
<p>For the <span>CE6885-LL (low latency mode)</span>: VXLAN and IPv6-related configurations are not supported.</p>
</div></div>
<p>On the network shown in <a href="#EN-US_TASK_0000001512689674__fig1098641724019">Figure 1</a>, DeviceC (a user-side device) is dual-homed to an M-LAG and has a small number of static routes configured so that it can communicate with the M-LAG through Layer 3 routes. However, the network using static routes is difficult to configure and maintain and is lack of flexible and fast deployment capabilities, thereby cannot meet the requirements of rapidly growing services. To address this problem, M-LAG master and backup devices need to establish neighbor relationships of dynamic routing protocols with the user-side device. Therefore, M-LAG member interfaces need to support dynamic routing protocols.</p>
<div class="fignone" id="EN-US_TASK_0000001512689674__fig1098641724019"><a name="EN-US_TASK_0000001512689674__fig1098641724019"></a><a name="fig1098641724019"></a><span class="figcap"><b>Figure 1 </b>Configuring BGP over M-LAG</span><br><span><img class="vsd" src="figure/en-us_image_0000001563769357.png" width="NaN" height="NaN"></span></div>
<p>In the scenario where a device is dual-homed to a BGP or BGP4+ network through an M-LAG, you must configure IP addresses for VLANIF or VBDIF interfaces corresponding to M-LAG member interfaces on M-LAG master and backup devices. When configuring BGP or BGP4+, configure different M-LAG IPv4/IPv6 global/IPv6 link-local addresses for the VLANIF or VBDIF interfaces so that M-LAG master and backup devices can establish BGP or BGP4+ peer relationships with the user-side device DeviceC.</p>
</div></div>
<div class="steps-unordered"><a name="EN-US_TASK_0000001512689674__1.3.3"></a><a name="1.3.3"></a><h4 class="sectiontitle">Procedure</h4>
<ul><li><span>Configure BGP over M-LAG.</span><ol><li class="substepexpand"><span>Enter the system view.</span><p><pre class="screen"><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></pre>
</p></li><li class="substepexpand"><span>Enter the VLANIF or VBDIF interface view.</span><p><ul><li>Enter the VLANIF interface view.<pre class="screen"><a href="cmdqueryname=interface"><b><span class="cmdname">interface</span></b></a> <strong><span>vlanif</span></strong> <i><span class="varname">vlan-id</span></i></pre>
</li></ul>
<ul><li>Enter the VBDIF interface view.<pre class="screen"><a href="cmdqueryname=interface"><b><span class="cmdname">interface</span></b></a> <strong><span>vbdif</span></strong> <i><span class="varname">bd-id</span></i> </pre>
</li></ul>
</p></li><li class="substepexpand"><span>Configure an IP address.</span><p><pre class="screen"><a href="cmdqueryname=ip+address"><b><span class="cmdname">ip address</span></b></a> <i><span class="varname">ip-address</span></i> { <i><span class="varname">mask</span></i> | <i><span class="varname">mask-length</span></i> }</pre>
</p></li><li class="substepexpand"><span>Configure a virtual MAC address for the VLANIF or VBDIF interface.</span><p><pre class="screen"><a href="cmdqueryname=mac-address"><b><span class="cmdname">mac-address</span></b></a> <i><span class="varname">mac-address</span></i></pre>
</p></li><li class="substepexpand"><span>Configure an M-LAG IP address.</span><p><pre class="screen"><strong><a href="cmdqueryname=m-lag+ip+address"><b><span class="cmdname">m-lag ip address</span></b></a></strong> <em><i><span class="varname">ip-address</span></i></em> { <em><i><span class="varname">mask</span></i></em> | <i><span class="varname">mask-length</span></i> }</pre>
<div class="note"><img src="../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><ul id="EN-US_TASK_0000001512689674__en-us_task_0000001563769141_ul17648348102412"><li id="EN-US_TASK_0000001512689674__en-us_task_0000001563769141_li564812482241">An M-LAG IPv4 address is a secondary IP address. Each VLANIF or VBDIF interface can be configured with only one M-LAG secondary IPv4 address. (Each interface can be configured with a maximum of 255 secondary IP addresses.)</li><li id="EN-US_TASK_0000001512689674__en-us_task_0000001563769141_li1464812488244">An M-LAG secondary IPv4 address must be unique on the entire network, and cannot be the same as any secondary address on the local device or other devices on the network.</li><li id="EN-US_TASK_0000001512689674__en-us_task_0000001563769141_li464834820249">A multicast, broadcast, or loopback address cannot be configured as an M-LAG IPv4 address.</li><li id="EN-US_TASK_0000001512689674__en-us_task_0000001563769141_li116481648182419">If an M-LAG secondary IPv4 address has been configured on an interface and a new M-LAG secondary IPv4 address is configured on the interface, the new address overwrites the original one.</li><li id="EN-US_TASK_0000001512689674__en-us_task_0000001563769141_li14648134892417">An M-LAG IPv4 address can be configured on a VLANIF or VBDIF interface only after a primary address is configured on the interface, and the M-LAG IPv4 address must be on the same network segment as the primary address.</li><li id="EN-US_TASK_0000001512689674__en-us_task_0000001563769141_li78371648135911">If you unbind a VNI from a BD and a dedicated M-LAG IPv4 address has been configured on the corresponding VBDIF interface using the <strong id="EN-US_TASK_0000001512689674__en-us_task_0000001563769141_b083724817590"><a href="cmdqueryname=m-lag+ip+address"><b><span class="cmdname" id="EN-US_TASK_0000001512689674__en-us_task_0000001563769141_cmdname775615617195">m-lag ip address</span></b></a></strong> command, the dedicated M-LAG IPv4 address on the VBDIF interface is also deleted.</li><li id="EN-US_TASK_0000001512689674__en-us_task_0000001563769141_li38371748165912">The <strong id="EN-US_TASK_0000001512689674__en-us_task_0000001563769141_b2837148175910"><a href="cmdqueryname=m-lag+ip+address"><b><span class="cmdname" id="EN-US_TASK_0000001512689674__en-us_task_0000001563769141_cmdname5568557161812">m-lag ip address</span></b></a></strong> command can be configured on a VBDIF interface only after a VNI is bound to the corresponding BD.</li><li id="EN-US_TASK_0000001512689674__en-us_task_0000001563769141_li158371948115920">If the <a href="cmdqueryname=ip+address+ignore+primary-sub+enable"><b><span class="cmdname" id="EN-US_TASK_0000001512689674__en-us_task_0000001563769141_cmdname42563106204">ip address ignore primary-sub enable</span></b></a> command is configured on the device, the <strong id="EN-US_TASK_0000001512689674__en-us_task_0000001563769141_b11837194813591"><a href="cmdqueryname=m-lag+ip+address"><b><span class="cmdname" id="EN-US_TASK_0000001512689674__en-us_task_0000001563769141_cmdname159391812018">m-lag ip address</span></b></a></strong> command cannot be configured.</li><li id="EN-US_TASK_0000001512689674__en-us_task_0000001563769141_li38371948135917">If an M-LAG IPv4 address configured for an interface using the <strong id="EN-US_TASK_0000001512689674__en-us_task_0000001563769141_b383812482594"><a href="cmdqueryname=m-lag+ip+address"><b><span class="cmdname" id="EN-US_TASK_0000001512689674__en-us_task_0000001563769141_cmdname64101827202016">m-lag ip address</span></b></a></strong> command is the same as a primary or secondary IP address on the interface, the M-LAG IPv4 address cannot be delivered.</li></ul>
</div></div>
</p></li><li class="substepexpand"><span>Configure routed proxy ARP.</span><p><ul id="EN-US_TASK_0000001512689674__en-us_task_0000001563769141_ul17819893820"><li id="EN-US_TASK_0000001512689674__en-us_task_0000001563769141_li18988163818">Configure routed proxy ARP on the VLANIF interface.<pre class="screen" id="EN-US_TASK_0000001512689674__en-us_task_0000001563769141_screen17751144113818"><strong id="EN-US_TASK_0000001512689674__en-us_task_0000001563769141_b5398555183816"><a href="cmdqueryname=arp+proxy+enable"><b><span class="cmdname" id="EN-US_TASK_0000001512689674__en-us_task_0000001563769141_cmdname15409115381714">arp proxy enable</span></b></a></strong></pre>
</li><li id="EN-US_TASK_0000001512689674__en-us_task_0000001563769141_li94276113394">Configure routed proxy ARP on the VBDIF interface.<pre class="screen" id="EN-US_TASK_0000001512689674__en-us_task_0000001563769141_screen4795131853914"><strong id="EN-US_TASK_0000001512689674__en-us_task_0000001563769141_b1395181618918"><a href="cmdqueryname=arp-proxy+local+enable"><b><span class="cmdname" id="EN-US_TASK_0000001512689674__en-us_task_0000001563769141_cmdname699414011813">arp-proxy local enable</span></b></a></strong></pre>
</li></ul>
<div class="note" id="EN-US_TASK_0000001512689674__en-us_task_0000001563769141_note7313591314"><img src="../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0000001512689674__en-us_task_0000001563769141_p13373511313">When a user-side device sends an ARP request packet to the M-LAG master device, the packet is forwarded to the M-LAG backup device because of the hash operation on the Eth-Trunk interface. The M-LAG backup device detects that the destination IP address in the packet is not its IP address, and does not perform ARP packet synchronization. As a result, the user-side device cannot receive a reply packet. Therefore, routed proxy ARP needs to be configured.</p>
</div></div>
</p></li><li class="substepexpand"><span>Exit the interface view.</span><p><pre class="screen"><a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></pre>
</p></li><li class="substepexpand"><span>Commit the configuration.</span><p><pre class="screen" id="EN-US_TASK_0000001512689674__en-us_task_0228023023_screen14848162118611"><a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001512689674__en-us_task_0228023023_cmdname1784862115612">commit</span></b></a></pre>
</p></li><li class="substepexpand"><span>Enable BGP, specify the local AS number, and enter the BGP view.</span><p><pre class="screen"><strong><a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a></strong> <em><i><span class="varname">as-number</span></i></em></pre>
</p></li><li class="substepexpand"><span>Configure a router ID for BGP.</span><p><pre class="screen"><strong><a href="cmdqueryname=router-id"><b><span class="cmdname">router-id</span></b></a></strong> <em><i><span class="varname">ipv4-address</span></i></em></pre>
</p></li><li class="substepexpand"><span>Create a BGP peer.</span><p><pre class="screen"><strong><a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a></strong> <em><i><span class="varname">ipv4-address</span></i></em> <strong>as-number</strong> <em><i><span class="varname">as-number</span></i></em></pre>
</p></li><li class="substepexpand"><span>Specify the source interface and source IP address used to set up a TCP connection between BGP peers.</span><p><pre class="screen"><strong><a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a></strong> <em><i><span class="varname">ipv4-address</span></i></em> <strong><a href="cmdqueryname=connect-interface"><b><span class="cmdname">connect-interface</span></b></a></strong> { <em><i><span class="varname">interface-type</span></i></em> <em><i><span class="varname">interface-number</span></i></em> [ <em><i><span class="varname">ipv4-source-address</span></i></em> ] | <em><i><span class="varname">ipv4-source-address</span></i></em> }</pre>
</p></li><li class="substepexpand"><span>Enter the BGP-IPv4 unicast address family view.</span><p><pre class="screen"><a href="cmdqueryname=ipv4-family+unicast"><b><span class="cmdname">ipv4-family unicast</span></b></a></pre>
</p></li><li class="substepexpand"><span>Enable MP-BGP for the BGP peer so that it becomes an MP-BGP peer.</span><p><pre class="screen"><strong><a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a></strong> <em><i><span class="varname">ipv4-address</span></i></em> <strong>enable</strong></pre>
</p></li><li class="substepexpand"><span>Commit the configuration.</span><p><pre class="screen" id="EN-US_TASK_0000001512689674__en-us_task_0228023023_screen14848162118611_1"><a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001512689674__en-us_task_0228023023_cmdname1784862115612_1">commit</span></b></a></pre>
</p></li></ol>
</li><li><span>Configure BGP4+ over M-LAG.</span><ol><li class="substepexpand"><span>Enter the system view.</span><p><pre class="screen"><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></pre>
</p></li><li class="substepexpand"><span>Enter the VLANIF or VBDIF interface view.</span><p><ul><li>Enter the VLANIF interface view.<pre class="screen"><a href="cmdqueryname=interface"><b><span class="cmdname">interface</span></b></a> <strong><span>vlanif</span></strong> <i><span class="varname">vlan-id</span></i></pre>
</li></ul>
<ul><li>Enter the VBDIF interface view.<pre class="screen"><a href="cmdqueryname=interface"><b><span class="cmdname">interface</span></b></a> <strong><span>vbdif</span></strong> <i><span class="varname">bd-id</span></i> </pre>
</li></ul>
</p></li><li class="substepexpand"><span>Enable IPv6 on the interface.</span><p><pre class="screen"><a href="cmdqueryname=ipv6+enable"><b><span class="cmdname">ipv6 enable</span></b></a></pre>
</p></li><li class="substepexpand"><span>Configure the device to generate ND entries on the interface upon receipt of valid NA messages if no ND entry exists on the interface.</span><p><pre class="screen"><a href="cmdqueryname=ipv6+nd+na+glean"><b><span class="cmdname">ipv6 nd na glean</span></b></a></pre>
<p>By default, the device does not generate ND entries on an interface upon receipt of valid NA messages if no ND entry exists on the interface.</p>
<div class="note"><img src="../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>To synchronize ND entries in an M-LAG, configure the <a href="cmdqueryname=ipv6+nd+na+glean"><b><span class="cmdname">ipv6 nd na glean</span></b></a> command. This configuration enables the M-LAG backup device to generate ND entries upon receipt of valid NA messages if no ND entry exists. After learning the entries, the M-LAG backup device synchronizes the entries to the M-LAG master device.</p>
</div></div>
</p></li><li class="substepexpand"><span>Configure an IPv6 address.</span><p><pre class="screen"><a href="cmdqueryname=ipv6+address"><b><span class="cmdname">ipv6 address</span></b></a> { <i><span class="varname">ipv6-address</span></i> <i><span class="varname">prefix-length</span></i> | <i><span class="varname">ipv6-address</span></i>/<i><span class="varname">prefix-length</span></i> }</pre>
</p></li><li class="substepexpand"><span>Configure a virtual MAC address for the VLANIF or VBDIF interface.</span><p><pre class="screen"><a href="cmdqueryname=mac-address"><b><span class="cmdname">mac-address</span></b></a> <i><span class="varname">mac-address</span></i></pre>
</p></li><li class="substepexpand"><span>Configure an M-LAG IPv6 address.</span><p><pre class="screen"><strong><a href="cmdqueryname=m-lag+ipv6+address"><b><span class="cmdname">m-lag ipv6 address</span></b></a></strong> <em><i><span class="varname">ipv6-address</span></i></em> [<strong> <strong><span>link-local</span></strong></strong> ]</pre>
</p><p><div class="note"><img src="../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><ul><li>An M-LAG IPv6 address can only be a global unicast address. An interface can be configured with only one M-LAG IPv6 address and a maximum of 16 global unicast addresses.</li><li>An M-LAG IPv6 address must be unique on the entire network, and cannot be the same as any IPv6 address on the local device or other devices on the network.</li><li>A multicast, anycast, or loopback address cannot be configured as an M-LAG IPv6 address.</li><li>If an M-LAG IPv6 address has been configured on an interface and a new M-LAG IPv6 address is configured on the interface, the new address overwrites the original one.</li><li>A link-local address cannot be configured as an M-LAG IPv6 address.</li><li>Before configuring an M-LAG IPv6 address for an interface, you must enable IPv6 on the interface.</li><li>If you unbind a VNI from a BD and a dedicated M-LAG IPv6 address has been configured on the corresponding VBDIF interface using the <a href="cmdqueryname=m-lag+ipv6+address"><b><span class="cmdname">m-lag ipv6 address</span></b></a> command, the dedicated M-LAG IPv6 address on the VBDIF interface is also deleted.</li><li>The <a href="cmdqueryname=m-lag+ipv6+address"><b><span class="cmdname">m-lag ipv6 address</span></b></a> command can be configured on a VBDIF interface only after a VNI is bound to the corresponding BD.</li><li>If an M-LAG IPv6 address configured for an interface using the <a href="cmdqueryname=m-lag+ipv6+address"><b><span class="cmdname">m-lag ipv6 address</span></b></a> command is the same as a primary or secondary IPv6 address on the device, the M-LAG IPv6 address cannot be delivered.</li><li>When an IPv6 address is configured using the <a href="cmdqueryname=m-lag+ipv6+address"><b><span class="cmdname">m-lag ipv6 address</span></b></a> command, the prefix of the specified IPv6 address cannot be FE80::/10. When an IPv6 address is configured using the <a href="cmdqueryname=m-lag+ipv6+address+link-local"><b><span class="cmdname">m-lag ipv6 address link-local</span></b></a> command, the prefix of the specified IPv6 address must match FE80::/10.</li></ul>
</div></div>
<div class="note"><img src="../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><ul><li>The M-LAG link-local address on an interface references the link-local address of the interface. Each interface can be configured with only one M-LAG link-local address.</li><li>The M-LAG link-local address cannot be the same as any link-local address on the local or peer M-LAG member device.</li><li>Before configuring an M-LAG link-local address for an interface, you must enable IPv6 on the interface.</li></ul>
<ul><li>If you unbind a VNI from a BD and a dedicated M-LAG IPv6 link-local address has been configured on the corresponding VBDIF interface using the <a href="cmdqueryname=m-lag+ipv6+address+link-local"><b><span class="cmdname">m-lag ipv6 address link-local</span></b></a> command, the dedicated M-LAG IPv6 link-local address on the VBDIF interface is also deleted.</li><li>The <a href="cmdqueryname=m-lag+ipv6+address+link-local"><b><span class="cmdname">m-lag ipv6 address link-local</span></b></a> command can be configured on a VBDIF interface only after a VNI is bound to the corresponding BD.</li><li>If an M-LAG IPv6 link-local address configured for an interface using the <a href="cmdqueryname=m-lag+ipv6+address+link-local"><b><span class="cmdname">m-lag ipv6 address link-local</span></b></a> command is the same as a primary or secondary IPv6 address on the interface, the M-LAG IPv6 link-local address cannot be delivered.</li><li>If the <a href="cmdqueryname=ipv6+address+link-local"><b><span class="cmdname">ipv6 address link-local</span></b></a> command is configured on an interface, the <a href="cmdqueryname=m-lag+ipv6+address+link-local"><b><span class="cmdname">m-lag ipv6 address link-local</span></b></a> command cannot be configured on the interface.</li><li>On a device, all VLANIF or VBDIF interfaces bound to the same VPN instance cannot be configured with the same M-LAG link-local address. If Layer 3 interfaces on M-LAG master and backup devices are bound to the same VPN instance, the link-local address of the Layer 3 interface on the local M-LAG device cannot be the same as the M-LAG link-local address configured on the peer M-LAG device.</li><li>The M-LAG link-local address on an interface of a device cannot be the same as the VRRP6 link-local address on the interface.</li></ul>
</div></div>
</p></li><li class="substepexpand"><span>Configure routed proxy ND.</span><p><pre class="screen" id="EN-US_TASK_0000001512689674__en-us_task_0000001563769141_screen05168618464"><strong id="EN-US_TASK_0000001512689674__en-us_task_0000001563769141_b178311334102013"><a href="cmdqueryname=ipv6+nd+proxy+route+enable"><b><span class="cmdname" id="EN-US_TASK_0000001512689674__en-us_task_0000001563769141_cmdname58311834122019">ipv6 nd proxy route enable </span></b></a></strong><a href="cmdqueryname=%5B"><b><span class="cmdname" id="EN-US_TASK_0000001512689674__en-us_task_0000001563769141_cmdname14832123492010">[</span></b></a><strong id="EN-US_TASK_0000001512689674__en-us_task_0000001563769141_b188311234202011"><a href="cmdqueryname=prune"><b><span class="cmdname" id="EN-US_TASK_0000001512689674__en-us_task_0000001563769141_cmdname1183110343202">prune</span></b></a></strong><a href="cmdqueryname=%5D"><b><span class="cmdname" id="EN-US_TASK_0000001512689674__en-us_task_0000001563769141_cmdname34322611192">]</span></b></a></pre>
<div class="note" id="EN-US_TASK_0000001512689674__en-us_task_0000001563769141_note4326101019465"><img src="../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0000001512689674__en-us_task_0000001563769141_p133264108469">When a user-side device sends an ND request packet to the M-LAG master device, the packet is forwarded to the M-LAG backup device because of the hash operation on the Eth-Trunk interface. The M-LAG backup device detects that the destination IP address in the packet is not its IP address, and does not perform ND packet synchronization. As a result, the user-side device cannot receive a reply packet. Therefore, routed proxy ND needs to be configured.</p>
<p id="EN-US_TASK_0000001512689674__en-us_task_0000001563769141_p1890788131213">If the interface that receives NS packets from the user side is the same as the next-hop interface of the route on the M-LAG device when the <strong id="EN-US_TASK_0000001512689674__en-us_task_0000001563769141_b4227144192912"><a href="cmdqueryname=ipv6+nd+proxy+route+enable"><b><span class="cmdname" id="EN-US_TASK_0000001512689674__en-us_task_0000001563769141_cmdname1669631110150">ipv6 nd proxy route enable</span></b></a> <strong><span id="EN-US_TASK_0000001512689674__en-us_task_0000001563769141_cmdparmname16458161616152">prune</span></strong></strong> command is configured, the M-LAG device does not perform routed proxy or reply with NA packets.</p>
</div></div>
</p></li><li class="substepexpand"><span>Exit the interface view.</span><p><pre class="screen"><a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></pre>
</p></li><li class="substepexpand"><span>Commit the configuration.</span><p><pre class="screen" id="EN-US_TASK_0000001512689674__en-us_task_0228023023_screen14848162118611_2"><a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001512689674__en-us_task_0228023023_cmdname1784862115612_2">commit</span></b></a></pre>
</p></li><li class="substepexpand"><span>Enable BGP, specify the local AS number, and enter the BGP view.</span><p><pre class="screen"><strong><a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a></strong> <em>as-number</em></pre>
</p></li><li class="substepexpand"><span>Configure a router ID for BGP.</span><p><pre class="screen"><strong><a href="cmdqueryname=router-id"><b><span class="cmdname">router-id</span></b></a></strong> <em><i><span class="varname">ipv4-address</span></i></em></pre>
</p></li><li class="substepexpand"><span>Create a BGP peer.</span><p><pre class="screen"><strong><a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a></strong> <em><i><span class="varname">ipv6-address</span></i></em> <strong><a href="cmdqueryname=as-number"><b><span class="cmdname">as-number</span></b></a></strong> <em><i><span class="varname">as-number</span></i></em></pre>
</p></li><li class="substepexpand"><span>Specify the source interface and source IP address used to set up a TCP connection between BGP peers.</span><p><pre class="screen"><strong><a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a></strong> <em><i><span class="varname">ipv6-address</span></i></em> <strong><a href="cmdqueryname=connect-interface"><b><span class="cmdname">connect-interface</span></b></a></strong> { <em><i><span class="varname">interface-type</span></i></em> <em><i><span class="varname">interface-number</span></i></em> [ <em><i><span class="varname">ipv6-source-address</span></i></em> ] | <em><i><span class="varname">ipv6-source-address</span></i></em> }</pre>
</p></li><li class="substepexpand"><span>Enter the BGP-IPv6 unicast address family view.</span><p><pre class="screen"><a href="cmdqueryname=ipv6-family+unicast"><b><span class="cmdname">ipv6-family unicast</span></b></a></pre>
</p></li><li class="substepexpand"><span>Enable MP-BGP for the BGP peer so that it becomes an MP-BGP peer.</span><p><pre class="screen"><strong><a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a></strong> <em>peerIpv6Addr</em> <strong><a href="cmdqueryname=enable"><b><span class="cmdname">enable</span></b></a></strong></pre>
</p></li><li class="substepexpand"><span>Commit the configuration.</span><p><pre class="screen" id="EN-US_TASK_0000001512689674__en-us_task_0228023023_screen14848162118611_3"><a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001512689674__en-us_task_0228023023_cmdname1784862115612_3">commit</span></b></a></pre>
</p></li></ol>
</li></ul></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../dc/dc_cfg_m-lag_0021.html">Configuring a Dynamic Routing Protocol for Communication with an M-LAG
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../dc/dc_cfg_m-lag_0010.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../dc/dc_cfg_m-lag_0042.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>