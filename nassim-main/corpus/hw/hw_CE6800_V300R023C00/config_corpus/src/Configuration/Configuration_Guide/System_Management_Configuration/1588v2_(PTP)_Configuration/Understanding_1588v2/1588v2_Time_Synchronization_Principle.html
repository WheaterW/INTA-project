
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="concept">
<meta name="DC.Title" content="1588v2 Time Synchronization Principle">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="galaxy_1588v2_cfg_0003.html">
<meta name="DC.Relation" scheme="URI" content="galaxy_1588v2_cfg_0005.html">
<meta name="DC.Relation" scheme="URI" content="galaxy_1588v2_cfg_0007.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="1588v2 (PTP)">
<meta name="featuretype" content="System Management">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="1588v2 (PTP)">
<meta name="featuretype" content="System Management">
<meta name="featurename" content="1588v2 (PTP)">
<meta name="featuretype" content="System Management">
<meta name="featuretype" content="System Management">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_CONCEPT_0000001563999209">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>1588v2 Time Synchronization Principle</title>
</head>
<body><a name="EN-US_CONCEPT_0000001563999209"></a><a name="EN-US_CONCEPT_0000001563999209"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">1588v2 Time Synchronization Principle</h1>
<div><div class="p">The principle of 1588v2 time synchronization is the same as that of NTP time synchronization. The master and slave nodes exchange timing packets, and calculate the packet transmission delays in both directions (sending and receiving) according to the receiving and sending timestamps in the exchanged timing packets. If the packet transmission delays in both directions are identical, the unidirectional delay is half the bidirectional delay. On this basis, the time offset between the slave and master nodes can be obtained. The slave node then synchronizes with the master node by correcting its local time according to the time offset. While 1588v2 and NTP have the same principles, they differ in implementation.<ul><li>NTP typically runs on main control boards to measure the communication delay, including the link delay and delays caused by various internal processing such as internal congestion queuing, software scheduling, and software processing. These make the packet transmission delay unstable, causing packet transmission delays in two directions to be asymmetric. As a result, the accuracy of NTP-based time synchronization is low.</li><li>Different from NTP, 1588v2 assumes that the link delay is a constant value (or a trivial value that can be ignored between synchronization processes), and that delays in opposite directions on a link are the same. In this case, 1588v2 adds timestamps at the points closest to each end of a link to measure the link delay, achieving the highest possible degree of time synchronization precision.</li></ul>
</div>
<div class="p">1588v2 defines two modes for delay measurement and time synchronization:<ul><li>Delay mode: measures the end-to-end delay.</li><li>Peer Delay (Pdelay) mode: calculates the transmission time (link delay) between two communication ports that support the Pdelay mechanism. This mechanism is irrelevant to master and slave states of ports.</li></ul>
</div>
<div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Currently, the device supports only the Delay mode. The following describes the principles of the Delay mode.</p>
</div></div>
<div class="section"><h4 class="sectiontitle">Delay Mode</h4><p><a href="#EN-US_CONCEPT_0000001563999209__fig_dc_cfg_ptp_000701">Figure 1</a> shows how 1588v2 calculates the average link delay and time offset between the master and slave devices in Delay mode.</p>
<div class="fignone" id="EN-US_CONCEPT_0000001563999209__fig_dc_cfg_ptp_000701"><a name="EN-US_CONCEPT_0000001563999209__fig_dc_cfg_ptp_000701"></a><a name="fig_dc_cfg_ptp_000701"></a><span class="figcap"><b>Figure 1 </b>Delay mode</span><br><span><img class="vsd" src="figure/en-us_image_0000001564119065.png" width="NaN" height="NaN"></span><br></div>
<div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><ul><li>When a packet arrives at or leaves a device, the device adds a timestamp to the packet based on its system clock.</li><li>In one-step mode, a Sync message in Delay mode carries the timestamp indicating when the message was sent.</li><li>In two-step mode, a Sync message in Delay mode does not carry the timestamp indicating when the message was sent. The device records the time when the Sync message is sent, and sends a subsequent Follow_Up message that carries the timestamp indicating when the Sync message was sent.</li></ul>
</div></div>
<ol><li>The master device sends a Sync message at t<sub>1</sub>. If the master device works in one-step mode, t<sub>1</sub> is sent to the slave device through the Sync message. If the master device works in two-step mode, t<sub>1</sub> is sent to the slave device through the subsequent Follow_Up message.</li><li>In one-step mode, the slave device receives the Sync message at t<sub>2</sub> and obtains t<sub>1</sub> from the Sync message. In two-step mode, the slave device receives the Sync message at t<sub>2</sub> and obtains t<sub>1</sub> from the Follow_Up message.</li><li>The slave device sends a Delay_Req message to the master device at t<sub>3</sub>.</li><li>The master device receives the Delay_Req message at t<sub>4</sub>.</li><li>The master device then sends a Delay_Resp message carrying t<sub>4</sub> to the slave device.</li></ol>
<div class="p">According to the four timestamps t<sub>1</sub>, t<sub>2</sub>, t<sub>3</sub>, and t<sub>4 </sub>, the slave device can calculate the average link delay and time offset between itself and the master device to synchronize its time with the master device. The calculation process is as follows:<ol><li>Assume that the time delay for sending packets from the master device to the slave device is Delay<sub>ms</sub>, the time delay for sending packets from the slave device to the master device is Delay<sub>sm</sub>, and the time offset between the slave and master devices is Offset. The formula for the average link delay between the master and slave devices is: Delay = (Delay<sub>ms</sub> + Delay<sub>sm</sub>)/2.</li><li>Because t<sub>2</sub> â t<sub>1</sub> = Delay<sub>ms</sub> + Offset and t<sub>4</sub> â t<sub>3</sub> = Delay<sub>sm</sub> â Offset, (t<sub>2</sub> â t<sub>1</sub>) â (t<sub>4</sub> â t<sub>3</sub>) = (Delay<sub>ms</sub> + Offset) â (Delay<sub>sm</sub> â Offset).</li><li>According to the preceding formula:<ul><li>Delay<sub>ms</sub> + Delay<sub>sm</sub> = (t<sub>2</sub> â t<sub>1</sub>) + (t<sub>4</sub> â t<sub>3</sub>)</li><li>Offset = [(t<sub>2</sub> â t<sub>1</sub>) â (t<sub>4</sub> â t<sub>3</sub>) â (Delay<sub>ms</sub> â Delay<sub>sm</sub>)]/2</li></ul>
</li><li>If bidirectional link delays between the master and slave devices are symmetric or Delay<sub>ms</sub> equals Delay<sub>sm</sub>, the following formulas can be used to calculate the average link delay and time offset between the two devices:<ul><li>Delay = [(t<sub>2</sub> â t<sub>1</sub>) + (t<sub>4</sub> â t<sub>3</sub>)]/2</li><li>Offset = [(t<sub>2</sub> â t<sub>1</sub>) â (t<sub>4</sub> â t<sub>3</sub>)]/2</li></ul>
</li></ol>
</div>
<p>In <a href="#EN-US_CONCEPT_0000001563999209__fig_dc_cfg_ptp_000702">Figure 2</a>, the time offset between the local clock and current time is calculated using 1588v2, and then the local clock is adjusted based on the time offset. This synchronization process is performed repeatedly to ensure time synchronization between the slave and master devices.</p>
<div class="fignone" id="EN-US_CONCEPT_0000001563999209__fig_dc_cfg_ptp_000702"><a name="EN-US_CONCEPT_0000001563999209__fig_dc_cfg_ptp_000702"></a><a name="fig_dc_cfg_ptp_000702"></a><span class="figcap"><b>Figure 2 </b>Time correction</span><br><span><img class="vsd" src="figure/en-us_image_0000001563878957.png" width="NaN" height="NaN"></span><br></div>
<p>1588v2 time synchronization requires symmetric bidirectional path delays between the master and slave devices. If bidirectional path delays are asymmetric, a synchronization offset is introduced. The offset is half of the difference between bidirectional path delays. 1588v2 high-precision time synchronization requires that the delay between the two nodes be stable and no jitter occur. Generally, the link delay can achieve the required results, but the forwarding delay and jitter of the device can be large. Therefore, in IEEE 1588v2, the correctionField field indicating delay correction must be introduced to calculations in Delay mode in order to obtain the correct average link delay (Delay) and time offset (Offset).</p>
<div class="fignone" id="EN-US_CONCEPT_0000001563999209__fig8507135013461"><a name="EN-US_CONCEPT_0000001563999209__fig8507135013461"></a><a name="fig8507135013461"></a><span class="figcap"><b>Figure 3 </b>Forwarding delay correction process</span><br><span><img src="figure/en-us_image_0000001512679826.png" width="NaN" height="NaN"></span></div>
<p>As shown in <a href="#EN-US_CONCEPT_0000001563999209__fig8507135013461">Figure 3</a>, the device modifies the correctionField field of a 1588v2 message on the inbound and outbound interfaces. Specifically, the device subtracts the timestamp indicating when the 1588v2 message was received on the inbound interface and adds the timestamp indicating when the 1588v2 message was sent from the outbound interface. As such, the forwarding delays of the 1588v2 message on the device are added to the correctionField field. In IEEE 1588v2, the process of calculating the average link delay by using the Delay mechanism that uses forwarding delay correction is as follows:</p>
<ol><li>The master node sends a Sync message to the slave node. The message carries the correctionField CF1 containing the forwarding delay generated when the message passes through the master node. When the slave node receives the Sync message and performs time synchronization calculation, it subtracts the CF1. There is only the link delay.<div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In two-step mode, the slave node also needs to deduct the value of the correctionField field from the Follow_Up message during time synchronization calculation.</p>
</div></div>
</li><li>The slave node sends a Delay_Req message to the master node. The message carries the correctionField field containing the forwarding delay of the slave node.</li><li>After receiving the Delay_Req message, the master node calculates a new correctionField and adds the correctionField value in the Delay_Req message to the new correctionField field to form CF2.</li><li>The master node sends a Delay_Resp message carrying CF2 to the slave node.</li><li>After receiving the Delay_Resp message, the slave node performs time synchronization calculation and subtracts the correctionField value containing the forwarding delay. The correct Delay and Offset values can then be obtained as follows:<ul><li>Delay = [(t<sub>2</sub> â t<sub>1</sub> â CF1) + (t<sub>4</sub> â t<sub>3</sub> â CF2)]/2 = [(t<sub>2</sub> â t<sub>1</sub>) + (t<sub>4</sub> â t<sub>3</sub>) â (CF1+CF2)]/2</li><li>Offset = [(t<sub>2</sub> â t<sub>1</sub> â CF1) â (t<sub>4</sub> â t<sub>3</sub> â CF2)]/2 = [(t<sub>2</sub> â t<sub>1</sub>) â (t<sub>4</sub> â t<sub>3</sub>) â (CF1â CF2)]/2</li></ul>
</li></ol>
<p>In this way, high-precision time synchronization can be implemented.</p>
</div>
<div class="section"><h4 class="sectiontitle">Asymmetrical Delay Correction</h4><p>1588v2 requires bidirectional delays of a link to be symmetric. In real-world scenarios, however, bidirectional delays of a link may be asymmetric. Asymmetric delays may be caused by link attributes or device attributes, for example, bidirectional link delays are different on the link segment from the location of a timestamp to the link. To address this issue, 1588v2 provides the asymmetric delay correction mechanism. <a href="#EN-US_CONCEPT_0000001563999209__fig_dc_cfg_ptp_000704">Figure 4</a> shows this mechanism.</p>
<div class="fignone" id="EN-US_CONCEPT_0000001563999209__fig_dc_cfg_ptp_000704"><a name="EN-US_CONCEPT_0000001563999209__fig_dc_cfg_ptp_000704"></a><a name="fig_dc_cfg_ptp_000704"></a><span class="figcap"><b>Figure 4 </b>Asymmetric delay correction mechanism</span><br><span><img class="vsd" src="figure/en-us_image_0000001512679814.png" width="NaN" height="NaN"></span></div>
<p>Generally, t<sub>ms</sub> equals t<sub>sm</sub>. If t<sub>ms</sub> does not equal t<sub>sm</sub>, you can configure their time difference as the asymmetric delay correction value as long as the delay difference is fixed and can be obtained in advance. During time synchronization, 1588v2 also calculates the asymmetrical delay correction value, improving time synchronization accuracy on links with asymmetric delays.</p>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="galaxy_1588v2_cfg_0003.html">Understanding 1588v2
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="galaxy_1588v2_cfg_0005.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="galaxy_1588v2_cfg_0007.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>