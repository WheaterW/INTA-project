
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Applying for a Local Certificate for a PKI Entity in Offline Mode">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="security_pki_cfg_0012.html">
<meta name="DC.Relation" scheme="URI" content="security_pki_cfg_0019.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="PKI">
<meta name="featuretype" content="Security">
<meta name="featuretype" content="Security Protection">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="PKI">
<meta name="featuretype" content="Security">
<meta name="featuretype" content="Security Protection">
<meta name="featurename" content="PKI">
<meta name="featuretype" content="Security">
<meta name="featuretype" content="Security Protection">
<meta name="featuretype" content="Security">
<meta name="featuretype" content="Security Protection">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001563766349">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>Example for Applying for a Local Certificate for a PKI Entity in Offline Mode</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001563766349"></a><a name="EN-US_TASK_0000001563766349"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1"><span>Example for </span>Applying for a Local Certificate for a PKI Entity in Offline Mode</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001563766349__1.3.1"></a><a name="1.3.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><div class="p">As shown in <a href="#EN-US_TASK_0000001563766349__fig_dc_cfg_pki_003901">Figure 1</a>, the device applies for a local certificate from the CA server on the public network in offline mode.<div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, Interface1 and Interface2 represent <span>100GE</span><span>1/0/1</span> and <span>100GE</span><span>1/0/2</span>, respectively.</p>
</div></div>
</div>
<div class="fignone" id="EN-US_TASK_0000001563766349__fig_dc_cfg_pki_003901"><a name="EN-US_TASK_0000001563766349__fig_dc_cfg_pki_003901"></a><a name="fig_dc_cfg_pki_003901"></a><span class="figcap"><b>Figure 1 </b>Applying for a local certificate for a PKI entity in offline mode</span><br><span><img class="vsd" src="figure/en-us_image_0000001512846506.png" width="NaN" height="NaN"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001563766349__1.3.2"></a><a name="1.3.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li>Create an RSA key pair so that the local certificate application request contains the public key.</li><li>Configure a PKI entity and its related information to identify the PKI entity.</li><li>Configure local certificate application for the PKI entity in offline mode and generate a local certificate request file.</li><li>Send the local certificate request file in out-of-band mode and download the local certificate.</li><li>Install the local certificate so that the device can protect communication data.</li></ol>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001563766349__1.3.3"></a><a name="1.3.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure IP addresses for interfaces.</span><p><pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname</strong> <strong>DeviceA</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong>
[<span><span class="eudemon"><span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA</span></span>] <strong>interface <span>100ge</span> <span>1/0/1</span></strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span><span class="eudemon">DeviceA</span></span>-<span>100GE</span><span>1/0/1</span>] <a href="cmdqueryname=undo+portswitch"><b><span class="cmdname">undo portswitch</span></b></a>
[<span class="keyword">*</span><span><span class="eudemon">DeviceA</span></span>-<span>100GE</span><span>1/0/1</span>] <strong>ip address 10.2.0.2 24</strong>
[<span class="keyword">*</span><span><span class="eudemon">DeviceA</span></span>-<span>100GE</span><span>1/0/1</span>] <strong>quit</strong>
[<span><span class="eudemon"><span class="keyword">*</span>DeviceA</span></span>] <strong>interface <span>100ge</span> <span>1/0/2</span></strong>
[<span class="keyword">*</span><span><span class="eudemon">DeviceA</span></span>-<span>100GE</span><span>1/0/2</span>] <a href="cmdqueryname=undo+portswitch"><b><span class="cmdname">undo portswitch</span></b></a>
[<span class="keyword">*</span><span><span class="eudemon">DeviceA</span></span>-<span>100GE</span><span>1/0/2</span>] <strong>ip address 10.1.0.2  24</strong>
[<span class="keyword">*</span><span><span class="eudemon">DeviceA</span></span>-<span>100GE</span><span>1/0/2</span>] <strong>quit</strong>
[<span class="keyword">*</span><span><span class="eudemon">DeviceA</span></span>] <strong>commit</strong></pre>
</p></li><li><span>Create an RSA key pair.</span><p><p>Create a 3072-bit RSA key pair named <strong>rsakey</strong> and allow it to be exported from the device.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>pki rsa local-key-pair create rsakey exportable</strong>
 Info: The name of the new key-pair will be: rsakey                             
 The size of the public key ranges from <span><span>2048 to 4096</span></span>.                            
 Input the bits in the modules:<strong>3072</strong>                                             
 Generating key-pairs...
 Generating key-pairs finished
[<span class="keyword">*</span><span><span class="eudemon">DeviceA</span></span>] <strong>commit</strong></pre>
</p></li><li><span>Configure a PKI entity to identify a certificate applicant.</span><p><p>Configure a PKI entity named <strong>user01</strong>.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA<span class="keyword"></span>] <strong>pki entity user01</strong>
[<span class="keyword">*</span>DeviceA<span class="keyword"></span>-pki-entity-user01] <strong>common-name hello</strong>
[<span class="keyword">*</span>DeviceA<span class="keyword"></span>-pki-entity-user01] <strong>country cn</strong>
[<span class="keyword">*</span>DeviceA<span class="keyword"></span>-pki-entity-user01] <strong>email user@test.abc.com</strong>
[<span class="keyword">*</span>DeviceA<span class="keyword"></span>-pki-entity-user01] <strong>fqdn test.abc.com</strong>
[<span class="keyword">*</span>DeviceA<span class="keyword"></span>-pki-entity-user01] <strong>ip-address 10.2.0.2</strong>
[<span class="keyword">*</span>DeviceA<span class="keyword"></span>-pki-entity-user01] <strong>state jiangsu</strong>
[<span class="keyword">*</span>DeviceA<span class="keyword"></span>-pki-entity-user01] <strong>organization huawei</strong>
[<span class="keyword">*</span>DeviceA<span class="keyword"></span>-pki-entity-user01] <strong>organization-unit info</strong>
[<span class="keyword">*</span>DeviceA<span class="keyword"></span>-pki-entity-user01] <strong>quit</strong>
[<span class="keyword">*</span><span><span class="eudemon">DeviceA</span></span>] <strong>commit</strong></pre>
</p></li><li><span>Apply for a local certificate for the PKI entity in offline mode.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA<span class="keyword"></span>] <strong>pki realm abc</strong>
[<span class="keyword">*</span>DeviceA<span class="keyword"></span>-pki-realm-abc] <strong>entity user01</strong>
[<span class="keyword">*</span>DeviceA<span class="keyword"></span>-pki-realm-abc] <strong>rsa local-key-pair rsakey</strong>
[<span class="keyword">*</span>DeviceA<span class="keyword"></span>-pki-realm-abc] <strong>quit</strong>
[<span class="keyword">*</span><span><span class="eudemon">DeviceA</span></span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA<span class="keyword"></span>] <strong>pki enroll-certificate realm abc pkcs10 filename cer_req</strong>
 Info: Creating certificate request file...                                     
 Info: Create certificate request file successfully.
[<span class="keyword">*</span><span><span class="eudemon">DeviceA</span></span>] <strong>commit</strong>  </pre>
<p>After the configurations are complete, run the <strong>display pki cert-req</strong> command to view content of the certificate request file.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA<span class="keyword"></span>] <strong>display pki cert-req filename cer_req</strong>
Certificate Request:                                                            
    Data:                                                                       
        Version: 1 (0x0)                                                        
        Subject: C=cn, ST=jiangsu, O=huawei, OU=info, CN=hello                  
        Subject Public Key Info:                                                
            Public Key Algorithm: rsaEncryption                                 
                RSA Public-Key: (3072 bits)                                          
                Modulus:                                                        
                    00:a2:db:e3:30:17:8e:f6:2d:2e:64:15:46:51:ad:               
                    70:86:dd:32:c4:bb:6b:58:3a:8c:5f:a0:06:a1:e1:               
                    56:2e:a4:eb:7e:12:06:05:04:28:b2:6d:64:7a:9c:               
                    4f:85:24:c1:aa:b8:99:dc:e9:bb:c4:1e:e2:9d:a0:               
                    18:51:1f:ad:b5:2f:60:18:06:8b:c1:cc:6f:32:58:               
                    f2:21:2c:16:e8:29:c2:a8:c5:aa:9d:6c:1e:ca:14:               
                    fc:7a:e9:bc:07:91:ce:ed:a0:c0:52:d9:0c:e9:ba:               
                    9b:64:43:e0:9a:3f:c5:d1:2c:86:36:96:6b:4b:4f:               
                    d4:df:05:d0:4b:41:2c:ec:0a:d7:0e:45:83:ed:cd:               
                    07:78:40:ed:d5:3d:7f:fe:0f:08:90:04:2e:ac:e5:               
                    42:b9:81:ea:ec:77:e2:cc:04:6e:e4:63:9f:69:ed:               
                    60:06:5e:c7:e8:bf:30:57:6a:5d:e0:46:68:d3:ee:               
                    b0:da:47:24:e3:b6:a5:f3:20:d8:5a:75:92:70:c2:               
                    a9:a6:97:07:07:0d:1c:94:9a:03:6f:f7:8c:db:6f:               
                    b7:06:de:51:50:9e:71:fd:86:f3:b5:c9:99:05:bf:               
                    f1:10:20:28:d3:a6:29:3d:e0:f4:a7:ba:1e:27:85:               
                    a9:66:fc:a9:90:49:f0:35:f7:d9:6d:06:a2:43:3f:               
                    18:87                                                       
                Exponent: 65537 (0x10001)                                       
        Attributes:                                                             
        Requested Extensions:
            X509v3 Key Usage: 
                Digital Signature, Non Repudiation, Key Encipherment, Data Encipherment
            X509v3 Subject Alternative Name:                                    
                IP Address:10.2.0.2, DNS:test.abc.com, email:user@test.abc.com
    Signature Algorithm: sha256WithRSAEncryption                                
         0e:0a:a5:b7:d5:54:11:10:c4:ea:ff:77:da:f9:24:4b:a9:98:                 
         a1:75:36:08:10:59:60:fa:1a:30:70:2c:b7:f6:5f:5e:31:b7:                 
         55:a5:7a:26:e5:af:4a:cd:83:c5:f3:90:f3:b9:d5:f9:0a:6d:                 
         6e:8f:25:b4:ed:95:9c:75:a5:d7:b6:25:fc:8d:39:89:fb:af:                 
         37:fc:01:7b:09:07:9c:96:7c:fa:28:6d:e2:11:49:a7:95:94:                 
         ed:26:5b:ca:f8:98:b0:e7:64:7e:dd:2d:75:ff:89:03:b7:0a:                 
         92:53:25:d4:a1:23:b9:5c:eb:5b:29:1d:8a:92:8f:36:68:7b:                 
         77:32:bc:48:92:48:84:fa:87:5a:d7:2e:3e:be:d5:6b:e4:df:                 
         b1:f2:02:35:91:6a:eb:cd:fc:5a:ea:37:85:6c:12:74:5f:a5:                 
         5c:c0:05:09:cd:34:59:0d:c6:c8:75:ca:1c:18:d6:48:e5:4b:                 
         e7:8e:e3:ff:25:99:0f:2e:a8:b4:c5:8e:4d:8f:dd:64:c5:1f:                 
         61:3c:58:21:4f:d5:35:ba:c8:8e:5f:76:41:9f:27:41:0a:94:                 
         59:2c:59:25:2d:de:60:5c:92:07:ac:8a:a5:7a:ba:75:af:2c:                 
         82:5f:bb:55:a8:48:49:54:0f:99:54:af:8d:12:4d:4b:7d:8b:                 
         95:28:ce:dc  </pre>
</p></li><li><span>Transfer the certificate request file to the CA server in out-of-band mode, for example, disk or email, to apply for a local certificate.</span><p><p>When the local certificate is successfully registered, download the local certificate <strong>abc_local.cer</strong> also in out-of-band mode. After the download is complete, you can import the file to the <strong>flash:/pki/public</strong> directory of the device using a file transfer protocol.</p>
</p></li><li><span>Install the local certificate.</span><p><p>After the certificate is imported, the <strong>abc_local.cer</strong> file in the <strong>flash:/pki/public</strong> directory is deleted by default. To keep it, select <strong>N</strong> as prompted.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA<span class="keyword"></span>] <strong>pki import-certificate local realm abc pem filename abc_local.cer</strong> 
 Info: Succeeded in importing the certificate. 
 Warning: The file in the flash will be deleted. Please select 'N' if you want to keep it. Please select [Y/N]:y
 Info: Delete Success.
[<span class="keyword">*</span><span><span class="eudemon">DeviceA</span></span>] <strong>commit</strong></pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001563766349__1.3.4"></a><a name="1.3.4"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p>After the local certificate is installed, the devices at both ends can use it to protect communication data.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA]<strong> display pki certificate local filename abc_local.cer</strong>
Info: It will take a few seconds or more to collect data for displaying. Please wait a moment.
Total Number: 1

Certificate:
    Data:
        Version: 3 (0x2)
        Serial Number: 8372560407419635446 (0x74314f54b0bf46f6)
        Signature Algorithm: sha256WithRSAEncryption
        Issuer: CN=HUAWEI BRAS CA, O=HUAWEI BRAS, C=AT
        Validity
            Not Before: Sep 12 22:18:27 2022 GMT
            Not After : Sep  7 22:18:27 2042 GMT
        Subject: C=cn, ST=jiangsu, O=huawei, OU=info, CN=hello
        Subject Public Key Info:
            Public Key Algorithm: rsaEncryption
                RSA Public-Key: (3072 bits)
                Modulus:
                    00:c8:4f:09:9d:6a:53:95:6d:98:fa:22:f4:7c:5e:
                    f7:4b:08:3b:d2:19:3b:2d:4c:6c:0d:5f:b7:a2:91:
                    e8:99:de:91:12:df:3d:f5:c4:89:00:30:e7:7c:a6:
                    7a:03:18:1e:31:6a:65:34:05:cb:8a:29:f8:65:49:
                    7c:bd:81:cd:93:8d:be:63:e5:87:99:5d:28:6f:b6:
                    5c:c6:5c:4e:85:dc:26:26:db:a9:81:1a:19:b4:c4:
                    72:b7:8f:01:8d:55:8c:a0:58:cd:ef:d2:bd:d2:04:
                    5c:62:ab:3a:c5:71:d8:46:68:db:30:11:9b:48:46:
                    f7:5a:f7:70:a9:bf:ce:df:67:50:31:6c:c5:b3:f7:
                    0c:73:74:33:94:69:18:5b:57:74:5b:6b:49:bf:15:
                    05:17:01:9f:d0:13:71:c0:fe:45:13:07:2d:95:42:
                    55:e8:9e:77:e8:4e:f8:80:42:97:4f:26:78:a9:81:
                    61:8e:d3:ac:e8:5e:e0:61:37:84:f4:82:fa:8a:f9:
                    08:df:c3:70:50:9a:8e:3b:78:a1:f2:5d:3d:0b:fb:
                    fa:f4:67:ec:31:35:ff:4a:70:29:86:8c:a8:e2:46:
                    97:39:f7:58:0e:9e:ff:26:f1:7f:10:6b:68:33:f3:
                    7e:fd:ce:f3:a2:b1:b5:a4:81:88:52:2f:82:e0:28:
                    d3:f5
                Exponent: 65537 (0x10001)
        X509v3 extensions:
            X509v3 Authority Key Identifier: 
                keyid:33:06:DB:08:3C:3F:61:9B:C4:04:A5:36:8C:FD:34:D3:4C:73:B9:92

            X509v3 Subject Key Identifier: 
                78:4C:65:05:E7:F6:B5:C8:48:C3:9D:E5:CE:3F:83:3A:62:84:EA:F9
            X509v3 CRL Distribution Points: 

                Full Name:
                  DirName:CN = pre_crl, OU = CRL, O = HUAWEI BRAS, C = AT

                Full Name:
                  URI:http://192.168.1.1:8080/allcrl/pre_crl.crl

                Full Name:
                  URI:ldap://www.jitldap.com:5389/CN=pre_crl,OU=CRL,O=HUAWEI BRAS,C=AT?certificateRevocationList?base?objectclass=cRLDistributionPoint

    Signature Algorithm: sha256WithRSAEncryption
         80:34:0d:ea:a0:7f:b8:a8:cb:8b:ae:a9:b3:85:b3:af:b2:1c:
         15:fc:7e:75:70:be:ff:37:75:6e:67:f8:37:33:ed:5c:5e:5b:
         3b:13:dc:44:7e:12:b6:85:b3:5c:b9:49:90:6c:96:33:57:a8:
         f3:c7:c4:04:2d:36:2a:54:fe:52:9a:16:64:66:a0:2e:a6:f1:
         0e:e0:29:f0:ac:69:d6:8a:f6:0d:43:41:ff:df:fd:06:03:39:
         75:8c:36:50:99:c3:89:c7:59:8c:65:7c:0c:6b:86:66:f3:a1:
         b1:6a:b7:43:0b:6d:3f:7d:82:27:45:b0:75:da:95:07:1d:d2:
         59:78:88:12:67:26:0f:65:fd:4f:05:4c:7c:74:16:4b:7d:ac:
         f8:a9:d1:2f:d6:57:4a:ad:aa:a3:ac:7c:30:de:6f:cf:3f:b4:
         d6:c5:84:e1:55:88:a2:40:52:12:5f:08:d8:50:54:ea:e7:c3:
         43:e2:6e:98:2a:5d:a4:e9:38:06:36:d6:40:25:a2:2e:0f:e1:
         95:cc:e8:f9:25:37:75:dd:67:0e:b9:0f:a9:5a:83:9c:6b:6c:
         f6:e1:bc:9d:fc:c1:a7:76:3f:33:81:e9:6d:25:a2:9f:1b:4e:
         61:f8:a9:12:de:33:02:2a:98:9d:04:a1:87:98:94:c4:11:cc:
         af:07:1b:68


Pki realm name: abc
Certificate file name: abc_local.cer
Certificate peer name: -</pre>
</div>
<div class="postreq"><a name="EN-US_TASK_0000001563766349__1.3.5"></a><a name="1.3.5"></a><h4 class="sectiontitle">Configuration Scripts</h4><pre class="screen">#
sysname DeviceA
#
pki entity user01
 country cn
 state jiangsu
 organization huawei
 organization-unit info
 common-name hello
 fqdn test.abc.com
 ip-address 10.2.0.2
 email user@test.abc.com
#
pki realm abc
 entity user01                                                                  
 rsa local-key-pair rsakey                                                     
#
interface <span>100GE</span><span>1/0/1</span>
 ip address 10.2.0.2 255.255.255.0
#
interface <span>100GE</span><span>1/0/2</span>
 ip address 10.1.0.2 255.255.255.0
#
return</pre>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="security_pki_cfg_0012.html">Applying for a Certificate in Offline Mode
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="security_pki_cfg_0019.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>
</body>
</html>