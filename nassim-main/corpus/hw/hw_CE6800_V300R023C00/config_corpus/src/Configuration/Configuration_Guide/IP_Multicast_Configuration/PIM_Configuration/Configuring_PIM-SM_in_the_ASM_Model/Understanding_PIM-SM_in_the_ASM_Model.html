
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="concept">
<meta name="DC.Title" content="Understanding PIM-SM in the ASM Model">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="vrp_pim_cfg_0010.html">
<meta name="DC.Relation" scheme="URI" content="vrp_pim_cfg_0012.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="PIM">
<meta name="featuretype" content="IP Multicast">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="PIM">
<meta name="featuretype" content="IP Multicast">
<meta name="featurename" content="PIM">
<meta name="featuretype" content="IP Multicast">
<meta name="featuretype" content="IP Multicast">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_CONCEPT_0000001176743279">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>Understanding PIM-SM in the ASM Model</title>
</head>
<body><a name="EN-US_CONCEPT_0000001176743279"></a><a name="EN-US_CONCEPT_0000001176743279"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Understanding PIM-SM in the ASM Model</h1>
<div><p>PIM-SM can implement P2MP on-demand data transmission on large-scale networks with sparsely distributed multicast data receivers.</p>
<p>PIM-SM assumes that no host wants to receive multicast data. Therefore, it sets up an MDT only if hosts request multicast data, and then sends the data to the hosts along the MDT.</p>
<div class="section" id="EN-US_CONCEPT_0000001176743279__section_dc_vrp_multicast_feature_300101"><a name="EN-US_CONCEPT_0000001176743279__section_dc_vrp_multicast_feature_300101"></a><a name="section_dc_vrp_multicast_feature_300101"></a><h4 class="sectiontitle">Related Concepts</h4><p><a href="#EN-US_CONCEPT_0000001176743279__fig_dc_vrp_multicast_feature_300110">Figure 1</a> shows the typical networking of PIM-SM.</p>
<div class="fignone" id="EN-US_CONCEPT_0000001176743279__fig_dc_vrp_multicast_feature_300110"><a name="EN-US_CONCEPT_0000001176743279__fig_dc_vrp_multicast_feature_300110"></a><a name="fig_dc_vrp_multicast_feature_300110"></a><span class="figcap"><b>Figure 1 </b>PIM-SM networking</span><br><span><img class="vsd" src="figure/en-us_image_0000001216565116.png" width="NaN" height="NaN"></span></div>
<p>In <a href="#EN-US_CONCEPT_0000001176743279__fig_dc_vrp_multicast_feature_300110">Figure 1</a>, PIM-SM involves the following basic concepts:</p>
<ul><li><p>PIM domain: A network consisting of PIM devices is called a PIM network. A PIM network can be divided into multiple PIM-SM domains by configuring bootstrap router (BSR) boundaries on multicast device interfaces. PIM domains restrict BSR message transmission, isolate multicast traffic between domains, and facilitate network management.</p>
</li><li><div class="p">DR: There are two types of DRs on a PIM network:<ul><li><p>Multicast source DR: a PIM device directly connected to a multicast source and responsible for sending Register messages to an RP on a PIM-SM network.</p>
</li><li><p>Receiver DR: a PIM device directly connected to multicast group members (usually receiver hosts) and responsible for forwarding multicast data to the multicast group members.</p>
</li></ul>
</div>
</li><li><p>RP: An RP is the forwarding core on a PIM-SM network, used to process join requests from the receiver DR and registration requests from the multicast source DR. An RP constructs an RPT with itself as the root and creates (S, G) entries to transmit multicast data to multicast group members. Devices on the network must know the RP address. <a href="#EN-US_CONCEPT_0000001176743279__tab_007247_01">Table 1</a> describes the types of RPs.</p>

<div class="tableBorder"><a name="EN-US_CONCEPT_0000001176743279__tab_007247_01"></a><a name="tab_007247_01"></a><table cellpadding="4" cellspacing="0" summary="" id="EN-US_CONCEPT_0000001176743279__tab_007247_01" frame="border" border="1" rules="all"><caption><b>Table 1 </b>RP classification</caption><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="13.558644135586443%" id="mcps1.3.3.5.3.2.2.5.1.1" liSelected="liSelected"><p>RP Type</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="30.076992300769923%" id="mcps1.3.3.5.3.2.2.5.1.2" liSelected="liSelected"><p>Implementation</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="30.716928307169283%" id="mcps1.3.3.5.3.2.2.5.1.3" liSelected="liSelected"><p>Usage Scenario</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="25.647435256474356%" id="mcps1.3.3.5.3.2.2.5.1.4" liSelected="liSelected"><p>Precautions</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" valign="top" width="13.558644135586443%" headers="mcps1.3.3.5.3.2.2.5.1.1 "><p>Static RP</p>
</td>
<td class="cellrowborder" valign="top" width="30.076992300769923%" headers="mcps1.3.3.5.3.2.2.5.1.2 "><p>You can manually configure the same address on all PIM devices on the network as a static RP address. All PIM devices on the network use this address as the RP address.</p>
</td>
<td class="cellrowborder" valign="top" width="30.716928307169283%" headers="mcps1.3.3.5.3.2.2.5.1.3 "><p>Static RPs are recommended on small- and medium-sized networks because such networks are stable and have low requirements on network devices. If only one multicast source exists on the network, setting the device directly connected to the multicast source as a static RP is recommended. In this case, the RP is also the source DR, which eliminates the need for the source DR to register with the RP.</p>
</td>
<td class="cellrowborder" valign="top" width="25.647435256474356%" headers="mcps1.3.3.5.3.2.2.5.1.4 "><p>To use a static RP, ensure that all <span class="keyword">devices</span>, including the RP, have the same RP information and the same range of multicast groups that the RP serves.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="13.558644135586443%" headers="mcps1.3.3.5.3.2.2.5.1.1 "><p>Dynamic RP</p>
</td>
<td class="cellrowborder" valign="top" width="30.076992300769923%" headers="mcps1.3.3.5.3.2.2.5.1.2 "><p>A dynamic RP is elected among the PIM devices that are configured as candidate-RPs (C-RPs) in the same PIM domain. Specifically, the BSR sends Bootstrap messages to collect all C-RP information as an RP-Set, and advertises the RP-Set information to all PIM devices in the domain. Then, all the PIM devices use the same RP-Set information and follow the same rules to elect an RP. If the elected RP fails, the other C-RPs compete again for a new RP.</p>
</td>
<td class="cellrowborder" valign="top" width="30.716928307169283%" headers="mcps1.3.3.5.3.2.2.5.1.3 "><div class="p">Dynamic RPs can be used on large-scale networks to ensure high reliability and easy maintenance.<ul><li><p>If multiple multicast sources exist on the network and are densely distributed, configuring core devices close to the multicast sources as C-RPs is recommended.</p>
</li><li><p>If multiple users are densely distributed on the network, configuring core devices close to the users as C-RPs is recommended.</p>
</li></ul>
</div>
</td>
<td class="cellrowborder" valign="top" width="25.647435256474356%" headers="mcps1.3.3.5.3.2.2.5.1.4 "><p>If dynamic RP election is used, a BSR is required. Through the BSR, the <span class="keyword">devices</span> on the multicast network can dynamically learn the mapping between the multicast group and the RP.</p>
</td>
</tr>
</tbody>
</table>
</div>
</li><li><p><strong>BSR</strong>: A BSR on a PIM-SM network collects RP information, summarizes that information into an RP-Set (group-RP mapping database), and advertises the RP-Set to the entire PIM-SM network. A network can have only one BSR but can have multiple candidate-BSRs (C-BSRs). If the BSR fails, a new BSR is elected from the C-BSRs.</p>
</li><li><p><strong>RPT</strong>: An RPT is an MDT with an RP as the root and multicast group members as leaves.</p>
</li><li><p><strong>SPT</strong>: An SPT is an MDT with the multicast source as the root and multicast group members as leaves.</p>
</li></ul>
</div>
<div class="section"><h4 class="sectiontitle">Implementation</h4><div class="p">The multicast data forwarding process in a PIM-SM domain is as follows:<ol><li><p><a href="#EN-US_CONCEPT_0000001176743279__section_dc_vrp_multicast_feature_300104">Neighbor Discovery</a>: Each PIM device in a PIM-SM domain periodically sends <a href="vrp_pim_cfg_0004.html#EN-US_CONCEPT_0000001130783604__section_dc_vrp_multicast_feature_300502">Hello messages</a> to all other PIM devices to discover PIM neighbors and maintain PIM neighbor relationships. By default, a PIM device permits other PIM control messages or multicast packets received from a neighbor, regardless of whether the PIM device has received <a href="vrp_pim_cfg_0004.html#EN-US_CONCEPT_0000001130783604__section_dc_vrp_multicast_feature_300502">Hello messages</a> from the neighbor before. However, if the neighbor check function is configured on a PIM device, the PIM device permits other PIM control messages or multicast packets received from a neighbor only after the PIM device receives Hello messages from the neighbor.</p>
</li><li><p><a href="#EN-US_CONCEPT_0000001176743279__section_dc_vrp_multicast_feature_300105">DR Election</a>: PIM devices exchange <a href="vrp_pim_cfg_0004.html#EN-US_CONCEPT_0000001130783604__section_dc_vrp_multicast_feature_300502">Hello messages</a> to elect DRs (a receiver DR and a multicast source DR) on a shared network segment. The receiver DR is the only multicast data forwarder on the shared network segment, and the multicast source DR is responsible for forwarding multicast data received from the multicast source to the RP.</p>
</li><li><p><a href="#EN-US_CONCEPT_0000001176743279__section_dc_vrp_multicast_feature_300106">RP Discovery</a>: An RP is the core device in a PIM-SM domain. A dynamic or static RP forwards multicast data over the entire network.</p>
</li><li><p><a href="#EN-US_CONCEPT_0000001176743279__section_dc_vrp_multicast_feature_300107">RPT Setup</a>: PIM-SM assumes that no hosts need to receive multicast data, and multicast data is transmitted only to the hosts that require the data. The core task of implementing multicast forwarding is to set up and maintain an RPT, along which the RP forwards multicast data to receivers.</p>
</li><li><p><a href="#EN-US_CONCEPT_0000001176743279__section_dc_vrp_multicast_feature_300108">Switchover to an SPT</a>: In a PIM-SM domain, a multicast group uniquely corresponds to an RP and an RPT. All multicast data must be forwarded by the RP. However, the path along which the RP forwards multicast data may not be the shortest path from the multicast source to receivers. In addition, the load of the RP increases with the multicast traffic volume. If the multicast data forwarding rate exceeds a configured threshold, the multicast data is switched to an SPT, which is the optimal path from the multicast source to receivers, reducing the burden on the RP.</p>
</li></ol>
</div>
<div class="p">If a network problem occurs, the Assert mechanism or a DR switchover delay can be used to guarantee that multicast data is transmitted properly.<ul><li><p><a href="#EN-US_CONCEPT_0000001176743279__section_dc_vrp_multicast_feature_300109">Assertion</a>: If multiple PIM devices exist on a network segment, the same multicast packets may be sent to the network segment repeatedly. The Assert mechanism resolves this issue by selecting only one multicast data forwarder on a network segment.</p>
</li><li><p><a href="#EN-US_CONCEPT_0000001176743279__section_dc_vrp_multicast_feature_300110">DR Switchover Delay</a>: When an interface changes from a DR to a non-DR, the PIM device immediately stops using this interface to forward data. If the new DR has not received multicast data, multicast data traffic is temporarily interrupted. If a DR switchover delay is configured, the interface continues forwarding multicast data until the delay expires, which prevents multicast data traffic from being interrupted.</p>
</li></ul>
</div>
<p>The implementation process is described in detail as follows:</p>
</div>
<div class="section" id="EN-US_CONCEPT_0000001176743279__section_dc_vrp_multicast_feature_300104"><a name="EN-US_CONCEPT_0000001176743279__section_dc_vrp_multicast_feature_300104"></a><a name="section_dc_vrp_multicast_feature_300104"></a><h4 class="sectiontitle">Neighbor Discovery</h4><div class="p" id="EN-US_CONCEPT_0000001176743279__p188514094214011">Each PIM-enabled interface on a PIM device sends <a href="vrp_pim_cfg_0004.html#EN-US_CONCEPT_0000001130783604__section_dc_vrp_multicast_feature_300502">Hello messages</a>. A multicast packet that carries a <a href="vrp_pim_cfg_0004.html#EN-US_CONCEPT_0000001130783604__section_dc_vrp_multicast_feature_300502">Hello message</a> has the following characteristics:<ul id="EN-US_CONCEPT_0000001176743279__ul105221683214011"><li id="EN-US_CONCEPT_0000001176743279__li958897398214011"><p id="EN-US_CONCEPT_0000001176743279__p1471281098214011"><a name="EN-US_CONCEPT_0000001176743279__li958897398214011"></a><a name="li958897398214011"></a>The destination address is 224.0.0.13, indicating that this packet is destined for all PIM devices on the same network segment as the interface that sent this packet.</p>
</li><li id="EN-US_CONCEPT_0000001176743279__li201331438214011"><p id="EN-US_CONCEPT_0000001176743279__p1490734441214011"><a name="EN-US_CONCEPT_0000001176743279__li201331438214011"></a><a name="li201331438214011"></a>The source address is an interface IP address.</p>
</li><li id="EN-US_CONCEPT_0000001176743279__li1286423774214011"><p id="EN-US_CONCEPT_0000001176743279__p59011622214011"><a name="EN-US_CONCEPT_0000001176743279__li1286423774214011"></a><a name="li1286423774214011"></a>The TTL value is 1, indicating that the packet is sent only to neighbor interfaces.</p>
</li></ul>
</div>
<p id="EN-US_CONCEPT_0000001176743279__p1405660141214011"><a href="vrp_pim_cfg_0004.html#EN-US_CONCEPT_0000001130783604__section_dc_vrp_multicast_feature_300502">Hello messages</a> are used to discover neighbors, negotiate protocol parameters, and maintain neighbor relationships.</p>
<p id="EN-US_CONCEPT_0000001176743279__p198103313410"><strong id="EN-US_CONCEPT_0000001176743279__b113171331154414">Discovering PIM neighbors</strong></p>
<p id="EN-US_CONCEPT_0000001176743279__p49098293417">All PIM devices on the same network segment must receive multicast packets with the destination address 224.0.0.13. Directly connected multicast <span class="keyword" id="EN-US_CONCEPT_0000001176743279__keyword14628953163318">devices</span> can then learn neighbor information from received <a href="vrp_pim_cfg_0004.html#EN-US_CONCEPT_0000001130783604__section_dc_vrp_multicast_feature_300502">Hello messages</a>.</p>
<p id="EN-US_CONCEPT_0000001176743279__p3920459154110"><strong id="EN-US_CONCEPT_0000001176743279__b978971615474">Negotiating protocol parameters</strong></p>
<p id="EN-US_CONCEPT_0000001176743279__p32418849214011"><a href="vrp_pim_cfg_0004.html#EN-US_CONCEPT_0000001130783604__section_dc_vrp_multicast_feature_300502">Hello messages</a> carry multiple protocol parameters, which are negotiated between neighbors and are described as follows:</p>
<ul id="EN-US_CONCEPT_0000001176743279__ul664260452214011"><li id="EN-US_CONCEPT_0000001176743279__li1303651098214011"><p id="EN-US_CONCEPT_0000001176743279__p1835837392214011"><a name="EN-US_CONCEPT_0000001176743279__li1303651098214011"></a><a name="li1303651098214011"></a>DR_Priority: priority used by each <span class="keyword" id="EN-US_CONCEPT_0000001176743279__keyword17628053123316">device</span> interface to elect a DR. The higher the priority, the higher the probability that the interface will be elected as the DR.</p>
</li><li id="EN-US_CONCEPT_0000001176743279__li1446977855214011"><p id="EN-US_CONCEPT_0000001176743279__p1251990357214011"><a name="EN-US_CONCEPT_0000001176743279__li1446977855214011"></a><a name="li1446977855214011"></a>Holdtime: timeout period during which a neighbor remains in the reachable state.</p>
</li><li id="EN-US_CONCEPT_0000001176743279__li184811742214011"><p id="EN-US_CONCEPT_0000001176743279__p869594232214011"><a name="EN-US_CONCEPT_0000001176743279__li184811742214011"></a><a name="li184811742214011"></a>LAN_Delay: delay for transmitting a <a href="vrp_pim_cfg_0004.html#EN-US_CONCEPT_0000001130783604__section_dc_vrp_multicast_feature_300505">Prune message</a> on the shared network segment.</p>
</li><li id="EN-US_CONCEPT_0000001176743279__li1018595789214011"><p id="EN-US_CONCEPT_0000001176743279__p1947275486214011"><a name="EN-US_CONCEPT_0000001176743279__li1018595789214011"></a><a name="li1018595789214011"></a>Override-Interval: interval carried in a <a href="vrp_pim_cfg_0004.html#EN-US_CONCEPT_0000001130783604__section_dc_vrp_multicast_feature_300502">Hello message</a> for overriding a Prune action.</p>
</li></ul>
<p id="EN-US_CONCEPT_0000001176743279__p144781532174215"><strong id="EN-US_CONCEPT_0000001176743279__b82481127195614">Maintaining neighbor relationships</strong></p>
<p id="EN-US_CONCEPT_0000001176743279__p437920313214011">PIM devices periodically exchange <a href="vrp_pim_cfg_0004.html#EN-US_CONCEPT_0000001130783604__section_dc_vrp_multicast_feature_300502">Hello messages</a>. If a PIM device does not receive a new <a href="vrp_pim_cfg_0004.html#EN-US_CONCEPT_0000001130783604__section_dc_vrp_multicast_feature_300502">Hello message</a> from its PIM neighbor within the holdtime, the device considers the neighbor unreachable and deletes it from the neighbor list.</p>
<p id="EN-US_CONCEPT_0000001176743279__p634861911214011">Changes of PIM neighbors will lead to multicast topology changes on the network. If an upstream or a downstream neighbor along an MDT becomes unreachable, multicast routes re-converge, and the MDT is updated.</p>
</div>
<div class="section" id="EN-US_CONCEPT_0000001176743279__section_dc_vrp_multicast_feature_300105"><a name="EN-US_CONCEPT_0000001176743279__section_dc_vrp_multicast_feature_300105"></a><a name="section_dc_vrp_multicast_feature_300105"></a><h4 class="sectiontitle">DR Election</h4><p>A multicast source or group members may be connected to multiple PIM devices on the same network segment, as shown in <a href="#EN-US_CONCEPT_0000001176743279__fig_dc_vrp_multicast_feature_300106">Figure 2</a>. The PIM devices exchange <a href="vrp_pim_cfg_0004.html#EN-US_CONCEPT_0000001130783604__section_dc_vrp_multicast_feature_300502">Hello messages</a> to set up PIM neighbor relationships. Each of the <a href="vrp_pim_cfg_0004.html#EN-US_CONCEPT_0000001130783604__section_dc_vrp_multicast_feature_300502">Hello messages</a> carries the DR priority and the address of the interface connected to this network segment. Each <span class="keyword">device</span> compares the local information with the information carried in received Hello messages to elect a DR. This process is called DR election, which adheres to the following rules:</p>
<ul><li><p>The <span class="keyword">device</span> whose interface has the highest DR priority on the network segment wins.</p>
</li><li><p>If the candidates have the same DR priority or some <span class="keyword">devices</span> on the network segment do not support encapsulating DR priorities in <a href="vrp_pim_cfg_0004.html#EN-US_CONCEPT_0000001130783604__section_dc_vrp_multicast_feature_300502">Hello messages</a>, the candidate with the highest IP address wins.</p>
</li></ul>
<div class="fignone" id="EN-US_CONCEPT_0000001176743279__fig_dc_vrp_multicast_feature_300106"><a name="EN-US_CONCEPT_0000001176743279__fig_dc_vrp_multicast_feature_300106"></a><a name="fig_dc_vrp_multicast_feature_300106"></a><span class="figcap"><b>Figure 2 </b>DR election</span><br><span><img class="vsd" src="figure/en-us_image_0000001130623892.png" width="NaN" height="NaN"></span></div>
</div>
<div class="section" id="EN-US_CONCEPT_0000001176743279__section_dc_vrp_multicast_feature_300106"><a name="EN-US_CONCEPT_0000001176743279__section_dc_vrp_multicast_feature_300106"></a><a name="section_dc_vrp_multicast_feature_300106"></a><h4 class="sectiontitle">RP Discovery</h4><p>An RP is the forwarding core on a PIM-SM network. RPs are classified as static RPs or dynamic RPs.</p>
<ul><li><p>Static RP: A static RP is specified by running a command to configure the same RP address on all <span class="keyword">devices</span> on the network, with no RP election involved.</p>
</li><li><p>Dynamic RP: A dynamic RP is elected from a set of PIM devices.</p>
</li></ul>
<p>On the network shown in <a href="#EN-US_CONCEPT_0000001176743279__fig_dc_vrp_multicast_feature_300103">Figure 3</a>, dynamic RP election is used. In this case, C-BSRs must be configured, and the C-BSRs run for the BSR.</p>
<div class="fignone" id="EN-US_CONCEPT_0000001176743279__fig_dc_vrp_multicast_feature_300103"><a name="EN-US_CONCEPT_0000001176743279__fig_dc_vrp_multicast_feature_300103"></a><a name="fig_dc_vrp_multicast_feature_300103"></a><span class="figcap"><b>Figure 3 </b>Dynamic RP election</span><br><span><img class="vsd" src="figure/en-us_image_0000001130623882.png"></span></div>
<p>The dynamic RP election rules are as follows:</p>
<ol><li><p>Initially, each C-BSR considers itself a BSR and advertises a <a href="vrp_pim_cfg_0004.html#EN-US_CONCEPT_0000001130783604__section_dc_vrp_multicast_feature_300506">Bootstrap message</a> to its neighbors. The <a href="vrp_pim_cfg_0004.html#EN-US_CONCEPT_0000001130783604__section_dc_vrp_multicast_feature_300506">Bootstrap message</a> carries the address and priority of the C-BSR. Each <span class="keyword">device</span> compares the C-BSR information contained in all received <a href="vrp_pim_cfg_0004.html#EN-US_CONCEPT_0000001130783604__section_dc_vrp_multicast_feature_300506">Bootstrap messages</a> and its information to determine the BSR. All the <span class="keyword">devices</span> follow the same election rules. Therefore, they will elect the same BSR and know the BSR's address. The election rules are as follows:</p>
<ol type="a"><li><p>The candidate with the highest priority (largest priority value) is elected.</p>
</li><li><p>If the candidates have the same priority, the one with the highest IP address is elected.</p>
</li></ol>
</li><li><p>The C-RPs send <a href="vrp_pim_cfg_0004.html#EN-US_CONCEPT_0000001130783604__section_dc_vrp_multicast_feature_300510">Advertisement messages</a> to the BSR. Each of the message carries the address of the C-RP that sent it, the range of multicast groups that the C-RP serves, and the priority of the C-RP.</p>
</li><li><p>The BSR collects the received information as an RP-Set, encapsulates the RP-Set information in a <a href="vrp_pim_cfg_0004.html#EN-US_CONCEPT_0000001130783604__section_dc_vrp_multicast_feature_300506">Bootstrap message</a>, and advertises the Bootstrap message to all PIM-SM devices.</p>
</li><li><div class="p">Based on the RP-Set information, each <span class="keyword">device</span> performs calculation and comparison using the same rules to elect an RP from multiple C-RPs. The rules are as follows:<ol type="a"><li><p>The C-RP with the longest mask length of the served group address range matching the specific multicast group wins.</p>
</li><li><p>If the corresponding group addresses that all C-RPs serve have the same mask length, the C-RP with the highest priority (lowest priority value) wins.</p>
</li><li><p>In the case of the same priority, hash functions are executed. The candidate with the greatest result value wins.</p>
</li><li><p>If all the preceding factors are the same, the C-RP with the highest address wins.</p>
</li></ol>
</div>
</li><li><p>Because all <span class="keyword">devices</span> use the same RP-Set and the same election rules, they obtain the same mapping between the multicast group and the RP. The <span class="keyword">devices</span> save the mapping between the multicast group and the RP to guide subsequent multicast operations.</p>
</li></ol>
<p>If a device needs to interwork with an auto-RP-capable device, auto-RP listening must be enabled. After auto-RP listening is enabled, the device can receive auto-RP announcement and discovery messages, parse the messages to obtain source addresses, and perform RPF checks based on the source addresses.</p>
<ul><li>If an RPF check fails, the device discards the auto-RP message.</li><li>If an RPF check succeeds, the device forwards the auto-RP message to its PIM neighbors. The auto-RP message carries the multicast group address range served by the RP to guide subsequent multicast operations.</li></ul>
</div>
<div class="section" id="EN-US_CONCEPT_0000001176743279__section_dc_vrp_multicast_feature_300107"><a name="EN-US_CONCEPT_0000001176743279__section_dc_vrp_multicast_feature_300107"></a><a name="section_dc_vrp_multicast_feature_300107"></a><h4 class="sectiontitle">RPT Setup</h4><p>The process of setting up an RPT is the process of establishing a multicast data forwarding path. <a href="#EN-US_CONCEPT_0000001176743279__fig_dc_vrp_multicast_feature_300101">Figure 4</a> shows the networking.</p>
<div class="fignone" id="EN-US_CONCEPT_0000001176743279__fig_dc_vrp_multicast_feature_300101"><a name="EN-US_CONCEPT_0000001176743279__fig_dc_vrp_multicast_feature_300101"></a><a name="fig_dc_vrp_multicast_feature_300101"></a><span class="figcap"><b>Figure 4 </b>RPT setup</span><br><span><img class="vsd" src="figure/en-us_image_0000001130783684.png" width="NaN" height="NaN"></span></div>
<p>RPT setup and data forwarding are described as follows:</p>
<ul><li><p>After receiving the first multicast packet of the multicast group G from a multicast source, the multicast source DR encapsulates the multicast packet in a <a href="vrp_pim_cfg_0004.html#EN-US_CONCEPT_0000001130783604__section_dc_vrp_multicast_feature_300503">Register message</a> and unicasts the message to the RP. The RP creates an (S, G) entry to register the multicast source information.</p>
</li><li><p>When a receiver joins the multicast group G through IGMP, the receiver DR sends a <a href="vrp_pim_cfg_0004.html#EN-US_CONCEPT_0000001130783604__section_dc_vrp_multicast_feature_300505">Join message</a> to the RP. An (*, G) entry is then created on each hop along the path to the RP, and an RPT is created.</p>
</li><li><p>When a receiver joins a multicast group and a multicast source sends a multicast packet for the group, the multicast packet is encapsulated in a <a href="vrp_pim_cfg_0004.html#EN-US_CONCEPT_0000001130783604__section_dc_vrp_multicast_feature_300503">Register message</a> and unicast to the RP. The RP then forwards the multicast data along the RPT to the receiver.</p>
</li></ul>
<p>The RPT helps implement on-demand multicast data forwarding, which reduces bandwidth consumption.</p>
</div>
<div class="section" id="EN-US_CONCEPT_0000001176743279__section_dc_vrp_multicast_feature_300108"><a name="EN-US_CONCEPT_0000001176743279__section_dc_vrp_multicast_feature_300108"></a><a name="section_dc_vrp_multicast_feature_300108"></a><h4 class="sectiontitle">Switchover to an SPT</h4><p>On a PIM-SM network, a multicast group corresponds to only one RP, and only one RPT is set up for this group. If the switchover to an SPT is not enabled, all multicast packets of a multicast group must be encapsulated in <a href="vrp_pim_cfg_0004.html#EN-US_CONCEPT_0000001130783604__section_dc_vrp_multicast_feature_300503">Register messages</a> and then sent to the RP. After receiving the messages, the RP de-encapsulates them and forwards the multicast packets along the RPT.</p>
<p>Since the RP transfers all of the multicast packets forwarded along the RPT, it may be overloaded when multicast traffic is heavy. To solve this problem, PIM-SM allows the RP or receiver DR to trigger a switchover to an SPT. On the network shown in <a href="#EN-US_CONCEPT_0000001176743279__fig_dc_vrp_multicast_feature_300102">Figure 5</a>, an SPT is set up from the multicast source to the receiver, and multicast data can be transmitted along the SPT.</p>
<div class="fignone" id="EN-US_CONCEPT_0000001176743279__fig_dc_vrp_multicast_feature_300102"><a name="EN-US_CONCEPT_0000001176743279__fig_dc_vrp_multicast_feature_300102"></a><a name="fig_dc_vrp_multicast_feature_300102"></a><span class="figcap"><b>Figure 5 </b>Switchover to an SPT triggered by the receiver DR</span><br><span><img class="vsd" src="figure/en-us_image_0000001130623886.png" width="NaN" height="NaN"></span></div>
<p>The modes for a switchover to an SPT are described as follows:</p>
<ul><li><p>Switchover to an SPT triggered by the RP: After receiving a <a href="vrp_pim_cfg_0004.html#EN-US_CONCEPT_0000001130783604__section_dc_vrp_multicast_feature_300503">Register message</a> from the source DR, the RP decapsulates the message and forwards the multicast data in the message along the RPT to receivers. In addition, the RP sends SPT <a href="vrp_pim_cfg_0004.html#EN-US_CONCEPT_0000001130783604__section_dc_vrp_multicast_feature_300505">Join messages</a> to the source DR to set up an SPT from the RP to the source. After the SPT is set up and the RP receives the first multicast data packet along the SPT, the RP stops processing <a href="vrp_pim_cfg_0004.html#EN-US_CONCEPT_0000001130783604__section_dc_vrp_multicast_feature_300503">Register messages</a>, which prevents frequent encapsulation and decapsulation between the source DR and RP. Multicast data is sent from the <span class="keyword">device</span> directly connected to the multicast source to the RP along the SPT, and then forwarded to receivers along the RPT.</p>
</li><li><div class="p">The process of a switchover to an SPT triggered by the receiver DR is described in detail as follows:<ol><li><p>On the network shown in <a href="#EN-US_CONCEPT_0000001176743279__fig_dc_vrp_multicast_feature_300102">Figure 5</a>, multicast data is forwarded along the RPT, which is a part of the following path: multicast source DR (<span class="keyword">Device</span>A) -&gt; RP (<span class="keyword">Device</span>B) -&gt; receiver DR (<span class="keyword">Device</span>D) -&gt; Receiver.</p>
</li><li><p>The receiver DR periodically checks the forwarding rate of multicast packets corresponding to an (S, G) entry. If the receiver DR finds that the forwarding rate is greater than the configured threshold, it triggers a switchover to the SPT.</p>
</li><li><p>The receiver DR sends (S, G) <a href="vrp_pim_cfg_0004.html#EN-US_CONCEPT_0000001130783604__section_dc_vrp_multicast_feature_300505">Join messages</a> to the multicast source DR. After receiving multicast data along the SPT, the receiver DR discards the multicast data received along the RPT and sends a <a href="vrp_pim_cfg_0004.html#EN-US_CONCEPT_0000001130783604__section_dc_vrp_multicast_feature_300505">Prune message</a> to the RP to instruct it to delete the receiver from the RPT. At this point, the switchover from the RPT to the SPT is completed.</p>
</li><li><p>Multicast data is forwarded along the SPT, which is a part of the following path: multicast source DR (<span class="keyword">Device</span>A) -&gt; receiver DR (<span class="keyword">Device</span>D) -&gt; Receiver.</p>
</li></ol>
</div>
</li></ul>
<p>After the SPT is set up from the source to multicast group members, subsequent multicast packets may bypass the RP. As the RPT may not be the shortest path, a switchover to the SPT reduces the delay in transmitting multicast data on the network.</p>
<div class="p">If one multicast source sends packets to multiple multicast groups simultaneously and a policy is specified for the switchover to the SPT for a specified group range:<ul><li><p>Before a switchover to the SPT is performed, these packets reach the receiver DR along the RPT.</p>
</li><li><p>After a switchover to the SPT is performed, only the packets sent to the multicast groups within the range specified in the policy for the switchover are forwarded along the SPT, whereas the packets sent to other multicast groups are still forwarded along the RPT.</p>
</li></ul>
</div>
<div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>When the receiver DR triggers a switchover to an SPT, it sends a Prune message containing information about multicast sources to be pruned to the RP. The RP then prunes these multicast sources. If the number of packed multicast sources to be pruned exceeds the maximum number of multicast sources that can be packed in a single Join/Prune message (calculated based on the MTU of the interface), only some multicast sources are packed and sent to the RP for pruning. Traffic of the multicast sources that are not packed for prune is still forwarded to the receiver DR through the RP and is discarded after the RPF check.</p>
</div></div>
</div>
<div class="section" id="EN-US_CONCEPT_0000001176743279__section_dc_vrp_multicast_feature_300109"><a name="EN-US_CONCEPT_0000001176743279__section_dc_vrp_multicast_feature_300109"></a><a name="section_dc_vrp_multicast_feature_300109"></a><h4 class="sectiontitle">Assertion</h4><p>Either of the following conditions indicates that another multicast forwarder exists on the network segment:</p>
<ul><li><p>A multicast packet fails the RPF check.</p>
</li><li><p>The interface that receives a multicast packet is a downstream interface corresponding to the (S, G) entry on the local <span class="keyword">device</span>.</p>
</li></ul>
<p>In this case, the <span class="keyword">device</span> performs the Assert mechanism.</p>
<p>The <span class="keyword">device</span> sends an <a href="vrp_pim_cfg_0004.html#EN-US_CONCEPT_0000001130783604__section_dc_vrp_multicast_feature_300507">Assert message</a> through the downstream interface, which also receives an <a href="vrp_pim_cfg_0004.html#EN-US_CONCEPT_0000001130783604__section_dc_vrp_multicast_feature_300507">Assert message</a> from a different multicast forwarder on the network segment. In the packet in which an <a href="vrp_pim_cfg_0004.html#EN-US_CONCEPT_0000001130783604__section_dc_vrp_multicast_feature_300507">Assert message</a> is encapsulated, the destination address is 224.0.0.13, the source address is the downstream interface's address, and the TTL value is 1. The <a href="vrp_pim_cfg_0004.html#EN-US_CONCEPT_0000001130783604__section_dc_vrp_multicast_feature_300507">Assert message</a> carries the route cost from the PIM device to the multicast source or RP, the priority of the used unicast routing protocol, and the address of the multicast group (G).</p>
<div class="p">The <span class="keyword">device</span> compares its information with that contained in the received message for Assert election. The rules are as follows:<ol><li><p>The device with the highest unicast routing priority wins.</p>
</li><li><p>If devices have the same unicast routing priority, the one with the smallest route cost to the multicast source wins.</p>
</li><li><p>If all the preceding conditions are the same, the device with the highest downstream interface IP address wins.</p>
</li></ol>
</div>
<p>The <span class="keyword">device</span> performs the following operations based on the Assert election result:</p>
<ul><li><p>If the <span class="keyword">device</span> wins the election, its downstream interface remains in the forwarding state and is responsible for forwarding multicast packets corresponding to the (S, G) entry on the network segment. This downstream interface is called an Assert winner.</p>
</li><li><p>If the device fails, its downstream interface is prohibited from forwarding multicast packets and is deleted from the downstream interface list of the (S, G) entry. This downstream interface is called an Assert loser.</p>
</li></ul>
<p>After Assert election is complete, only one upstream <span class="keyword">device</span> has a downstream interface that serves the network segment, and the downstream interface transmits only one copy of each multicast packet. The Assert winner then periodically sends <a href="vrp_pim_cfg_0004.html#EN-US_CONCEPT_0000001130783604__section_dc_vrp_multicast_feature_300507">Assert messages</a> to maintain its status as the Assert winner. If the Assert loser does not receive any <a href="vrp_pim_cfg_0004.html#EN-US_CONCEPT_0000001130783604__section_dc_vrp_multicast_feature_300507">Assert message</a> from the Assert winner within the timer maintained by the Assert loser, the loser restores the forwarding status of its downstream interface.</p>
</div>
<div class="section" id="EN-US_CONCEPT_0000001176743279__section_dc_vrp_multicast_feature_300110"><a name="EN-US_CONCEPT_0000001176743279__section_dc_vrp_multicast_feature_300110"></a><a name="section_dc_vrp_multicast_feature_300110"></a><h4 class="sectiontitle">DR Switchover Delay</h4><p>If an existing DR fails, PIM neighbor relationships time out, triggering the election of a new DR. By default, when an interface changes from a DR to a non-DR, the <span class="keyword">device</span> immediately stops using this interface to forward data. If the new DR has not received multicast data, multicast data traffic is temporarily interrupted.</p>
<p>If a PIM-SM interface with a PIM DR switchover delay configured changes from a DR to a non-DR upon reception of <a href="vrp_pim_cfg_0004.html#EN-US_CONCEPT_0000001130783604__section_dc_vrp_multicast_feature_300502">Hello messages</a> from a new neighbor, the interface retains some DR functions and continues forwarding multicast packets until the delay times out. If the <span class="keyword">device</span> in the DR switchover delay state receives data from a new DR, it immediately stops forwarding packets, which prevents duplicate data flows. When a new IGMP Report message is received on the shared network segment, the new DR (instead of the original DR in the DR switchover delay state) sends a PIM <a href="vrp_pim_cfg_0004.html#EN-US_CONCEPT_0000001130783604__section_dc_vrp_multicast_feature_300505">Join message</a> upstream. If the new DR receives multicast data from the original DR before the DR switchover delay expires, an Assert election is triggered.</p>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="vrp_pim_cfg_0010.html">Configuring PIM-SM in the ASM Model
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="vrp_pim_cfg_0012.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>