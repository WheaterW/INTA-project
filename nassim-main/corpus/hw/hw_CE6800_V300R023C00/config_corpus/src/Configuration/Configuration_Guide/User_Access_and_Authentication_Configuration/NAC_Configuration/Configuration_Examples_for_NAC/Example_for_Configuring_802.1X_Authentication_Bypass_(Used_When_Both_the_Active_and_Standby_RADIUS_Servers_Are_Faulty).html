
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring 802.1X Authentication Bypass (Used When Both the Active and Standby RADIUS Servers Are Faulty)">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="galaxy_cfg_nac_0245.html">
<meta name="DC.Relation" scheme="URI" content="galaxy_nac_cfg_0064.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="802.1X Authentication">
<meta name="featurename" content="NAC">
<meta name="featuretype" content="User Access and Authentication">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="802.1X Authentication">
<meta name="featurename" content="MAC Address Authentication">
<meta name="featurename" content="NAC">
<meta name="featuretype" content="User Access and Authentication">
<meta name="featuretype" content="User Access and Authentication">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001513160170">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring 802.1X Authentication Bypass (Used When Both the Active and Standby RADIUS Servers Are Faulty)</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001513160170"></a><a name="EN-US_TASK_0000001513160170"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring 802.1X Authentication Bypass (Used When Both the Active and Standby RADIUS Servers Are Faulty)</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001513160170__1.3.1"></a><a name="1.3.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the enterprise network shown in <a href="#EN-US_TASK_0000001513160170__fig_dc_cfg_aaa_602301">Figure 1</a>, DeviceA functions as the access device, and two RADIUS servers are deployed for 802.1X and RADIUS authentication of users on the enterprise network. Users can access the Internet only after being successfully authenticated. The administrator has the following user authentication requirements: When the two RADIUS servers are faulty, users bypass authentication and are granted the same network access rights as they are successfully authenticated. After the RADIUS servers recover, users are re-authenticated and re-authorized by the RADIUS servers.</p>
<div class="fignone" id="EN-US_TASK_0000001513160170__fig_dc_cfg_aaa_602301"><a name="EN-US_TASK_0000001513160170__fig_dc_cfg_aaa_602301"></a><a name="fig_dc_cfg_aaa_602301"></a><span class="figcap"><b>Figure 1 </b>Network diagram for configuring 802.1X authentication bypass (used when both the active and standby RADIUS servers are faulty)</span><div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface 1 and interface 2 represent <span>100GE</span> <span>1/0/1</span> and <span>100GE</span> <span>1/0/2</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0000001563880337.png" width="NaN" height="NaN"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001513160170__1.3.2"></a><a name="1.3.2"></a>
<div class="p"><h4 class="sectiontitle">Precautions</h4><ul><li>This section describes only NAC configurations on DeviceA. The RADIUS server configurations are not provided here.</li><li><p>The RADIUS authentication and accounting keys configured on the RADIUS server must be the same as the RADIUS server's shared key configured on the device.</p>
</li><li>By default, the outbound interface IP address of the device is used as the source IP address for sending RADIUS packets to the RADIUS server. This source IP address must be the same as the device IP address configured on the RADIUS server. You can run the following commands to change the IP address as required:<ul><li>Run the <strong>radius-server authentication </strong><em>ip-address</em><em> port</em> <strong>source </strong>{ <em>interface-type</em><em> interface-number</em> | <strong>ip-address</strong><em> source-ip-address</em> } command to configure a RADIUS authentication server and specify the source IP address used for sending RADIUS packets to the RADIUS authentication server.</li><li>Run the <strong>radius-server accounting</strong><em> ip-address</em><em> port</em> <strong>source</strong><strong> </strong>{ <em>interface-type</em><em> interface-number</em> | <strong>ip-address</strong><em> source-ip-address</em> } command to configure a RADIUS accounting server and specify the source IP address used for sending RADIUS packets to the RADIUS accounting server.</li></ul>
</li><li>When the <strong>authentication event authen-server-up action re-authen</strong> command is configured, you also need to run the <strong>radius-server testuser</strong> command to enable automatic detection. If automatic detection is not enabled and the authentication server status changes from down to up, the device cannot re-authenticate users in authentication bypass state.</li><li>To trigger the RADIUS server down event, run the following commands:<pre class="screen">[DeviceA] <strong>radius-server dead-interval 7</strong>
[DeviceA] <strong>radius-server dead-count 1</strong></pre>
<p>Run the <a href="cmdqueryname=test-aaa"><b><span class="cmdname">test-aaa</span></b></a> command four times. The RADIUS server then goes down.</p>
</li></ul>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001513160170__1.3.3"></a><a name="1.3.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><ol><li>Configure network connectivity to ensure that there are reachable routes between devices.</li><li>Configure AAA to implement RADIUS authentication, authorization, and accounting for users.</li><li>Configure 802.1X authentication, configure the rights granted to users when the RADIUS servers are faulty, and configure the re-authentication function when the RADIUS servers recover.</li></ol>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001513160170__1.3.4"></a><a name="1.3.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure network connectivity.</span><p><p># Create VLANs, configure the allowed VLANs on interfaces, and configure IP addresses for interfaces.</p>
<pre class="screen">&lt;HUAWEI&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>HUAWEI] <strong>sysname DeviceA</strong>
[<span class="keyword">*</span><span class="keyword">DeviceA</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>vlan batch 10 20</strong>
[<span class="keyword">*</span><span class="keyword">DeviceA</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>interface <span>100ge</span> <span>1/0/1</span></strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>portswitch</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>port link-type trunk</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>port trunk allow-pass vlan 10</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>interface vlanif 10</strong>
[<span class="keyword">*</span>DeviceA-Vlanif10] <strong>ip address 192.168.1.10 24</strong>
[<span class="keyword">*</span>DeviceA-Vlanif10] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>interface <span>100ge</span> <span>1/0/2</span></strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/2</span>] <strong>portswitch</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/2</span>] <strong>port link-type hybrid</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/2</span>] <strong>port hybrid pvid vlan 20</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/2</span>] <strong>port hybrid untagged vlan 20</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/2</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>interface vlanif 20</strong>
[<span class="keyword">*</span>DeviceA-Vlanif20] <strong>ip address 192.168.2.10 24</strong>
[<span class="keyword">*</span>DeviceA-Vlanif20] <strong>quit</strong></pre>
<p># Configure a route destined for RADIUS servers. In this example, the next-hop IP address is 192.168.1.1.</p>
<pre class="screen">[<span class="keyword">*</span>DeviceA] <strong>ip route-static 10.7.66.0 255.255.255.0 192.168.1.1</strong>
[<span class="keyword">*</span><span class="keyword">DeviceA</span>] <strong>commit</strong></pre>
</p></li><li><span>Configure AAA.</span><p><p># Create the RADIUS server template <strong>controller</strong>.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>radius-server template controller</strong></pre>
<p># Configure IP addresses and port numbers of the active and standby RADIUS authentication and accounting servers, set the algorithm for selecting RADIUS servers to <strong>master-backup</strong>, and set the RADIUS authentication key.</p>
<pre class="screen">[<span class="keyword">*</span>DeviceA-radius-controller] <strong>radius-server authentication 10.7.66.66 1812 weight 80</strong>
[<span class="keyword">*</span>DeviceA-radius-controller] <strong>radius-server accounting 10.7.66.66 1813 weight 80</strong>
[<span class="keyword">*</span>DeviceA-radius-controller] <strong>radius-server authentication 10.7.66.67 1812 weight 40</strong>
[<span class="keyword">*</span>DeviceA-radius-controller] <strong>radius-server accounting 10.7.66.67 1813 weight 40</strong>
[<span class="keyword">*</span>DeviceA-radius-controller] <strong>radius-server algorithm master-backup</strong>
[<span class="keyword">*</span>DeviceA-radius-controller] <strong>radius-server shared-key cipher Huawei@123456789</strong></pre>
<p># Configure automatic detection.</p>
<pre class="screen">[<span class="keyword">*</span>DeviceA-radius-controller] <strong>radius-server testuser username test1 password cipher abc@123</strong></pre>
<p># Configure the automatic detection interval and detection packet timeout period for RADIUS servers in down state. (This example uses the default values.)</p>
<pre class="screen">[<span class="keyword">*</span>DeviceA-radius-controller] <strong>radius-server detect-server interval 60</strong>
[<span class="keyword">*</span>DeviceA-radius-controller] <strong>radius-server detect-server timeout 3</strong></pre>
<p># Configure the number of retransmissions and timeout interval for RADIUS authentication requests. (This example uses the default values.)</p>
<pre class="screen">[<span class="keyword">*</span>DeviceA-radius-controller] <strong>radius-server retransmit 3 timeout 5</strong>
[<span class="keyword">*</span>DeviceA-radius-controller] <strong>quit</strong>
[<span class="keyword">*</span><span class="keyword">DeviceA</span>] <strong>commit</strong></pre>
<p># Configure the conditions for setting the RADIUS server to the down state. (This example uses the default values.)</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>radius-server dead-interval 5</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>radius-server dead-count 2</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>radius-server detect-cycle 2</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>radius-server max-unresponsive-interval 300</strong></pre>
<p># Configure the authentication scheme <strong>auth</strong> and set the authentication mode to RADIUS authentication.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>aaa</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA-aaa] <strong>authentication-scheme auth</strong>
[<span class="keyword">*</span>DeviceA-aaa-authen-auth] <strong>authentication-mode radius</strong>
[<span class="keyword">*</span>DeviceA-aaa-authen-auth] <strong>quit</strong></pre>
<p># Configure the accounting scheme <strong>acc</strong> and set the accounting mode to RADIUS accounting.</p>
<pre class="screen">[<span class="keyword">*</span>DeviceA-aaa] <strong>accounting-scheme acc</strong>
[<span class="keyword">*</span>DeviceA-aaa-accounting-acc] <strong>accounting-mode radius</strong>
[<span class="keyword">*</span>DeviceA-aaa-accounting-acc] <strong>quit</strong></pre>
<p># Configure the domain <strong>example</strong>, and apply the authentication scheme <strong>auth</strong>, accounting scheme <strong>acc</strong>, and RADIUS server template <strong>controller</strong> to the domain.</p>
<pre class="screen">[<span class="keyword">*</span>DeviceA-aaa] <strong>domain example</strong>
[<span class="keyword">*</span>DeviceA-aaa-domain-example] <strong>authentication-scheme auth</strong>
[<span class="keyword">*</span>DeviceA-aaa-domain-example] <strong>accounting-scheme acc</strong>
[<span class="keyword">*</span>DeviceA-aaa-domain-example] <strong>radius-server controller</strong>
[<span class="keyword">*</span>DeviceA-aaa-domain-example] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA-aaa] <strong>quit</strong>
[<span class="keyword">*</span><span class="keyword">DeviceA</span>] <strong>commit</strong></pre>
</p></li><li><span>Configure 802.1X authentication.</span><p><div class="p"># Configure the 802.1X access profile <strong>d1</strong> and set the client authentication timeout period to 30 seconds.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>dot1x-access-profile name d1</strong>
[<span class="keyword">*</span>DeviceA-dot1x-access-profile-d1] <strong>dot1x authentication-method</strong><strong> eap</strong>
[<span class="keyword">*</span>DeviceA-dot1x-access-profile-d1] <strong>dot1x timer client-timeout 30</strong>
[<span class="keyword">*</span>DeviceA-dot1x-access-profile-d1] <strong>quit</strong></pre>
</div>
<p># Bind the 802.1X access profile <strong>d1</strong> to the authentication profile, and configure the forcible authentication domain <strong>example</strong> for users using the authentication profile.</p>
<div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>After a forcible domain is configured in an authentication profile, users using this authentication profile are authenticated in the domain regardless of whether the user names carry domain names or carry what kind of domain names.</p>
</div></div>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>authentication-profile name p1</strong>
[<span class="keyword">*</span>DeviceA-authen-profile-p1] <strong>dot1x-access-profile d1</strong>
[<span class="keyword">*</span>DeviceA-authen-profile-p1] <strong>access-domain example force</strong>
[<span class="keyword">*</span>DeviceA-authen-profile-p1] <strong>quit</strong></pre>
<p># Configure the rights granted to users when RADIUS servers are faulty, and enable the re-authentication function when the RADIUS servers recover. The following uses VLAN-based authorization for users in bypass state as an example.</p>
<pre class="screen">[<span class="keyword">*</span>DeviceA] <strong>authentication-profile name p1</strong>
[<span class="keyword">*</span>DeviceA-authen-profile-p1] <strong>authentication event authen-server-down action authorize vlan 20</strong>
[<span class="keyword">*</span>DeviceA-authen-profile-p1] <strong>authentication event authen-server-up action re-authen</strong>
[<span class="keyword">*</span>DeviceA-authen-profile-p1] <strong>quit</strong>
[<span class="keyword">*</span><span class="keyword">DeviceA</span>] <strong>commit</strong></pre>
<p># Disable the pre-connection function.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>undo authentication pre-authen-access enable</strong>
[<span class="keyword">*</span><span class="keyword">DeviceA</span>] <strong>commit</strong></pre>
<p># Bind the authentication profile <strong>p1</strong> to <span>100GE</span> <span>1/0/2</span> and enable 802.1X authentication on <span>100GE</span> <span>1/0/2</span>. The configurations of other interfaces connected to terminals are similar.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>interface <span>100ge</span> <span>1/0/2</span></strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/2</span>] <strong>authentication-profile p1</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/2</span>] <strong>quit</strong>
[<span class="keyword">*</span><span class="keyword">DeviceA</span>] <strong>commit</strong></pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001513160170__1.3.5"></a><a name="1.3.5"></a><h4 class="sectiontitle">Verifying the Configuration</h4><ol><li>A user starts a terminal and initiates 802.1X authentication. After the authentication is successful, the user can access the Internet.</li><li>When the active RADIUS server is down, the standby RADIUS server authorizes the user so that the user can access the Internet. When both the active and standby RADIUS servers are down, the user enters the bypass state and can access specified network resources.</li><li>After the user goes online, you can run the <strong>display access-user mac-address</strong> command on DeviceA to check online user information.</li></ol>
</div>
<div class="postreq"><a name="EN-US_TASK_0000001513160170__1.3.6"></a><a name="1.3.6"></a><h4 class="sectiontitle">Configuration Scripts</h4><p>DeviceA</p>
<pre class="screen">#
sysname DeviceA
#
undo authentication pre-authen-access enable 
authentication-profile name p1
 dot1x-access-profile d1
 access-domain example force
 authentication event authen-server-down action authorize vlan 20
 authentication event authen-server-up action re-authen
#
vlan batch 10 20
#
aaa
 authentication-scheme auth    
  authentication-mode radius 
 accounting-scheme acc
  accounting-mode radius   
 domain example            
  authentication-scheme auth
  accounting-scheme acc
  radius-server controller        
# 
radius-server template controller
 radius-server shared-key cipher %+%##!!!!!!!!!"!!!!"!!!!*!!!!SKvr${[Fs.3t@/5k|BENhEu&gt;W(3\<font style="font-size:8pt" Face="Courier New" >~</font>XG!!D;!!!!!2jp5!!!!!!A!!!!3"pK8qv!}9M#(4$jGWvQF/R[CNe/+:W^jk8HUe&amp;W%+%#
 radius-server accounting 10.7.66.66 1813 weight 80   
 radius-server accounting 10.7.66.67 1813 weight 40 
 radius-server authentication 10.7.66.66 1812 weight 80 
 radius-server authentication 10.7.66.67 1812 weight 40   
 radius-server testuser username test1 password cipher %+%##!!!!!!!!!"!!!!"!!!!*!!!!SKvr${[Fs.3t@/5k|BENhEu&gt;W(3\<font style="font-size:8pt" Face="Courier New" >~</font>XG!!D;!!!!!2jp5!!!!!!A!!!!3"pK8qv!}9M#(4$jGWvQF/R[CNe/+:W^jk8HUe&amp;W%+%#
#
dot1x-access-profile name d1
 dot1x timer client-timeout 30 
#
interface Vlanif10
 ip address 192.168.1.10 255.255.255.0
#
interface Vlanif20
 ip address 192.168.2.10 255.255.255.0
#
interface <span>100GE</span><span>1/0/1</span>
 port link-type trunk
 port trunk allow-pass vlan 10
#
interface <span>100GE</span><span>1/0/2</span>
 port link-type hybrid
 port hybrid pvid vlan 20
 port hybrid untagged vlan 20
 authentication-profile p1
#
ip route-static 10.7.66.0 255.255.255.0 192.168.1.1
#
return </pre>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="galaxy_cfg_nac_0245.html">Configuration Examples for NAC
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="galaxy_nac_cfg_0064.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>
</body>
</html>