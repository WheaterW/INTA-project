
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring BGP Hierarchical Routing">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="vrp_bgp_cfg_2100.html">
<meta name="DC.Relation" scheme="URI" content="vrp_bgp_cfg_2102.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing">
<meta name="featuretype" content="IP Routing">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001176743533">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring BGP Hierarchical Routing</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001176743533"></a><a name="EN-US_TASK_0000001176743533"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring BGP Hierarchical Routing</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001176743533__1.3.1"></a><a name="1.3.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>In <a href="#EN-US_TASK_0000001176743533__fig168879525502">Figure 1</a>, DeviceA and DeviceB interwork through BGP. DeviceA may import a large number of external routes. To ensure fast route convergence in the case of a device or link failure, it is required that BGP hierarchical routing be deployed on DeviceA and hierarchical routing convergence be deployed on the other node. In this example, the route 1.1.1.1/32 is configured as a base route, and the route 2.2.2.2/32 is configured as a hierarchical route on DeviceA.</p>
<div class="fignone" id="EN-US_TASK_0000001176743533__fig168879525502"><a name="EN-US_TASK_0000001176743533__fig168879525502"></a><a name="fig168879525502"></a><span class="figcap"><b>Figure 1 </b>Networking diagram of BGP hierarchical routing</span><div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface 1 represents <span>100GE</span><span>1/0/1</span>.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0000001130783956.png"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001176743533__1.3.2"></a><a name="1.3.2"></a>
<div class="p"><h4 class="sectiontitle">Precautions</h4><p>During the configuration, note the following:</p>
<ul><li>To improve security, you are advised to deploy BGP security measures. For details, see "Configuring BGP Authentication." Keychain authentication is used as an example. For details, see Example for Configuring Keychain Authentication for BGP.</li></ul>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001176743533__1.3.3"></a><a name="1.3.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><ol><li><p>Configure an EBGP connection between DeviceA and DeviceB.</p>
</li><li>Configure the base route and hierarchical route on DeviceA.</li><li><p>Enable hierarchical convergence on DeviceB.</p>
</li></ol>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001176743533__1.3.4"></a><a name="1.3.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Assign IP addresses to interfaces.</span><p><p># Configure DeviceA.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname DeviceA</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>interface <span>100GE</span><span>1/0/1</span></strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>undo portswitch</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>ip address 10.10.1.1 24</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>interface loopback1</strong>
[<span class="keyword">*</span>DeviceA-LoopBack1] <strong>ip address 1.1.1.1 32</strong>
[<span class="keyword">*</span>DeviceA-LoopBack1] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>interface loopback2</strong>
[<span class="keyword">*</span>DeviceA-LoopBack2] <strong>ip address 2.2.2.2 32</strong>
[<span class="keyword">*</span>DeviceA-LoopBack2] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>commit</strong></pre>
<p># Configure DeviceB.</p>
<pre class="screen">&lt;<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname DeviceB</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB] <strong>interface <span>100GE</span><span>1/0/1</span></strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB-<span>100GE</span><span>1/0/1</span>] <strong>undo portswitch</strong>
[<span class="keyword">*</span>DeviceB-<span>100GE</span><span>1/0/1</span>] <strong>ip address 10.10.1.2 24</strong>
[<span class="keyword">*</span>DeviceB-<span>100GE</span><span>1/0/1</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceB] <strong>commit</strong></pre>
</p></li><li><span>Configure EBGP.</span><p><p># Configure DeviceA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA]<strong> bgp 100</strong>
[<span class="keyword">*</span>DeviceA-bgp] <strong>router-id 11.11.11.11</strong>
[<span class="keyword">*</span>DeviceA-bgp]<strong> peer </strong><strong>10.10.1.</strong><strong>2 as-number 200</strong>
[<span class="keyword">*</span>DeviceA-bgp]<strong> </strong><strong>peer 10.10.1.2 ebgp-max-hop 255</strong>
[<span class="keyword">*</span>DeviceA-bgp]<strong> quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>commit</strong></pre>
<p># Configure DeviceB.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB]<strong> bgp 200</strong>
[<span class="keyword">*</span>DeviceB-bgp] <strong>router-id 22.22.22.22</strong>
[<span class="keyword">*</span>DeviceB-bgp]<strong> peer </strong><strong>10.10.1.</strong><strong>1 as-number 100</strong>
[<span class="keyword">*</span>DeviceB-bgp]<strong> </strong><strong>peer 10.10.1.1 ebgp-max-hop 255</strong>
[<span class="keyword">*</span>DeviceB-bgp]<strong> quit</strong>
[<span class="keyword">*</span>DeviceB] <strong>commit</strong></pre>
<p># Check the status of BGP connections.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>display bgp peer</strong>

 BGP local router ID : 11.11.11.11
 Local AS number : 100
 Total number of peers : 1                 Peers in established state : 1

  Peer                             V          AS  MsgRcvd  MsgSent  OutQ  Up/Down       State  PrefRcv
  10.10.1.2                        4         200        5        6     0 00:00:17 <strong>Established</strong>       0</pre>
</p></li><li><span>Run the <strong>network</strong> command on DeviceA to import local routes and use BGP to advertise the routes to its peers.</span><p><p># Configure DeviceA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>bgp 1</strong><strong>00</strong>
[<span class="keyword">*</span>DeviceA-bgp] <strong>ipv4-family unicast</strong>
[<span class="keyword">*</span>DeviceA-bgp-af-ipv4] <strong>network</strong> <strong>1.1.1.1</strong> <strong>32</strong>
[<span class="keyword">*</span>DeviceA-bgp-af-ipv4] <strong>network</strong> <strong>2.2.2.2</strong> <strong>32</strong>
[<span class="keyword">*</span>DeviceA-bgp-af-ipv4] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA-bgp] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>commit</strong></pre>
</p></li><li><span>Configure the base route and hierarchical route on DeviceA.</span><p><p># Configure DeviceA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>bgp 1</strong><strong>00</strong>
[<span class="keyword">*</span>DeviceA-bgp] <strong>ipv4-family unicast</strong>
[<span class="keyword">*</span>DeviceA-bgp-af-ipv4] <strong>hierarchy-convergence base-route 1.1.1.1 32 hierarchy-route all</strong>
[<span class="keyword">*</span>DeviceA-bgp-af-ipv4] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA-bgp] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>commit</strong></pre>
</p></li><li><span>Enable hierarchical convergence on DeviceB.</span><p><p># Configure DeviceB.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB] <strong>bgp 2</strong><strong>00</strong>
[<span class="keyword">*</span>DeviceB-bgp] <strong>ipv4-family unicast</strong>
[<span class="keyword">*</span>DeviceB-bgp-af-ipv4] <strong>hierarchy-convergence enable</strong>
[<span class="keyword">*</span>DeviceB-bgp-af-ipv4] <strong>quit</strong>
[<span class="keyword">*</span>DeviceB-bgp] <strong>quit</strong>
[<span class="keyword">*</span>DeviceB] <strong>commit</strong></pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001176743533__1.3.5"></a><a name="1.3.5"></a><h4 class="sectiontitle">Verifying the Configuration</h4><div class="p"># Check the BGP routing table of DeviceB. The following command output shows that the route 1.1.1.1/32 is a base route.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB] <strong>display </strong><strong>bgp routing-table 1.1.1.1 32</strong>

 BGP local router ID : 22.22.22.22
 Local AS number : 200
 Paths:   1 available, 1 best, 1 select, 0 best-external, 0 add-path
 BGP routing table entry information of 1.1.1.1/32:
 From: 10.10.1.1 (11.11.11.11)
 Route Duration: 0d00h30m53s
 Relay IP Nexthop: 10.10.1.1
 Relay IP Out-Interface: <strong><span>100GE</span><span>1/0/1</span></strong>
 Original nexthop: 10.10.1.1
 Qos information : 0x0
 AS-path 100, origin igp, MED 0, pref-val 0, valid, external, best, select, pre 255
 <strong>Hierarchy convergence: base-route</strong>
 Advertised to such 1 peers:
    10.10.1.1</pre>
</div>
<div class="p"># Display the BGP routing table of DeviceB. The command output shows that the route 2.2.2.2/32 is a hierarchical route and depends on the base route 1.1.1.1/32.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB] <strong>display </strong><strong>bgp routing-table 2.2.2.2 32</strong>

 BGP local router ID : 22.22.22.22
 Local AS number : 200
 Paths:   1 available, 1 best, 1 select, 0 best-external, 0 add-path
 BGP routing table entry information of 1.1.1.1/32:
 From: 10.10.1.1 (1.1.1.1)
 Route Duration: 0d00h30m53s
 Relay IP Nexthop: 10.10.1.1
 Relay IP Out-Interface: <strong><span>100GE</span><span>1/0/1</span></strong>
 Original nexthop: 10.10.1.1
 Qos information : 0x0
 AS-path 100, origin igp, MED 0, pref-val 0, valid, external, best, select, pre 255
 <strong>Hierarchy convergence: hierarchy-route, rely-base-route 1.1.1.1/32</strong>
 Advertised to such 1 peers:
    10.10.1.1</pre>
</div>
</div>
<div class="postreq"><a name="EN-US_TASK_0000001176743533__1.3.6"></a><a name="1.3.6"></a><h4 class="sectiontitle">Configuration Scripts</h4><ul><li><p>DeviceA</p>
<pre class="screen">#
sysname DeviceA
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 10.10.1.1 24
#
interface LoopBack1
 ip address 1.1.1.1 32
#
interface LoopBack2
 ip address 2.2.2.2 32
#
bgp 100
 router-id 11.11.11.11
 peer 10.10.1.2 as-number 200
 peer 10.10.1.2 ebgp-max-hop 255
 #
 ipv4-family unicast
  undo synchronization
  network 1.1.1.1 255.255.255.255
  network 2.2.2.2 255.255.255.255
  hierarchy-convergence base-route 1.1.1.1 32 hierarchy-route all
  peer 10.10.1.2 enable
#
return</pre>
</li><li><div class="p">DeviceB<pre class="screen">#
sysname DeviceB
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 10.10.1.2 24
#
bgp 200
 router-id 22.22.22.22
 peer 10.10.1.1 as-number 100
 peer 10.10.1.1 ebgp-max-hop 255
 #
 ipv4-family unicast
  undo synchronization
  hierarchy-convergence enable
  peer 10.10.1.1 enable
#
return</pre>
</div>
</li></ul>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="vrp_bgp_cfg_2100.html">Configuring BGP Hierarchical Routing
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="vrp_bgp_cfg_2102.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>
</body>
</html>