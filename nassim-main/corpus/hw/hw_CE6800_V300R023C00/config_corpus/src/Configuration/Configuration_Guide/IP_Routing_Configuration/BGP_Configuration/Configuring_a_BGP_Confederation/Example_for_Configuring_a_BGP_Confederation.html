
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring a BGP Confederation">
<meta name="abstract" content="">
<meta name="description" content="">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="vrp_bgp_cfg_0077.html">
<meta name="DC.Relation" scheme="URI" content="vrp_bgp_cfg_0079.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing">
<meta name="featuretype" content="IP Routing">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001130783876">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring a BGP Confederation</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001130783876"></a><a name="EN-US_TASK_0000001130783876"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring a BGP Confederation</h1>
<div class="taskbody"><p></p>
<div class="context"><a name="EN-US_TASK_0000001130783876__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>If multiple devices are deployed in an AS and fully meshed IBGP connections must be set up between every two devices in the AS, a large number of IBGP connections will be established, increasing operation and maintenance costs. To address this issue, configure a BGP confederation.</p>
<p>As shown in <a href="#EN-US_TASK_0000001130783876__fig_dc_vrp_bgp_cfg_407601">Figure 1</a>, to implement IP connectivity between devices in AS 200, full-mesh IBGP connections need to be established between the devices. However, since multiple devices run BGP in AS 200, the configuration workload for establishing a full-mesh network is heavy. To reduce the number of IBGP connections to be established, you can configure the confederation function on the devices in AS 200. Configuring a confederation is a method to handle the sharp increase of IBGP connections in an AS. In <a href="#EN-US_TASK_0000001130783876__fig_dc_vrp_bgp_cfg_407601">Figure 1</a>, AS 200 is divided into three sub-ASs: AS 65001, AS 65002, and AS 65003. A confederation EBGP multi-peer relationship can be established between AS 65001 and each of AS 65002 and AS 65003. The three devices in AS 65001 establish full-mesh IBGP connections. This greatly reduces the number of IBGP connections to be established in AS 200 and reduces O&amp;M costs.</p>
<div class="fignone" id="EN-US_TASK_0000001130783876__fig_dc_vrp_bgp_cfg_407601"><a name="EN-US_TASK_0000001130783876__fig_dc_vrp_bgp_cfg_407601"></a><a name="fig_dc_vrp_bgp_cfg_407601"></a><span class="figcap"><b>Figure 1 </b>Network diagram of configuring a BGP confederation</span><div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface 1, interface 2, interface 3, interface 4, and interface 5 represent <span>100GE</span><span>1/0/1</span>, <span>100GE</span><span>1/0/2</span>, <span>100GE</span><span>1/0/3</span>, <span>100GE</span><span>1/0/4</span>, and <span>100GE</span><span>1/0/5</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0000001130624162.png"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001130783876__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Precautions</h4><p>During the configuration, note the following:</p>
<ul><li>To improve security, you are advised to deploy BGP security measures. For details, see "Configuring BGP Authentication." Keychain authentication is used as an example. For details, see Example for Configuring Keychain Authentication for BGP.</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001130783876__1.4.3"></a><a name="1.4.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Assign an IP address to each involved interface. For detailed configurations, see <a href="#EN-US_TASK_0000001130783876__postreq17364171716277">Configuration Scripts</a>.</span></li><li><span>Configure a BGP confederation.</span><p><p># Configure DeviceA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA]<strong> bgp 65001</strong>
[<span class="keyword">*</span>DeviceA-bgp] <strong>router-id 1.1.1.1</strong>
[<span class="keyword">*</span>DeviceA-bgp] <strong>confederation id 200</strong>
[<span class="keyword">*</span>DeviceA-bgp] <strong>confederation peer-as 65002 65003</strong>
[<span class="keyword">*</span>DeviceA-bgp] <strong>peer 10.1.1.2 as-number 65002 </strong>
[<span class="keyword">*</span>DeviceA-bgp]<strong> peer 10.1.2.2 as-number 65003</strong>
[<span class="keyword">*</span>DeviceA-bgp] <strong>ipv4-family unicast</strong>
[<span class="keyword">*</span>DeviceA-bgp-af-ipv4] <strong>peer 10.1.1.2 next-hop-local</strong>
[<span class="keyword">*</span>DeviceA-bgp-af-ipv4] <strong>peer 10.1.2.2 next-hop-local</strong>
[<span class="keyword">*</span>DeviceA-bgp-af-ipv4] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA-bgp] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>commit</strong></pre>
<p># Configure DeviceB.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB]<strong> bgp 65002</strong>
[<span class="keyword">*</span>DeviceB-bgp]<strong> router-id 2.2.2.2</strong>
[<span class="keyword">*</span>DeviceB-bgp]<strong> confederation id 200</strong>
[<span class="keyword">*</span>DeviceB-bgp]<strong> confederation peer-as 65001</strong>
[<span class="keyword">*</span>DeviceB-bgp]<strong> peer 10.1.1.1 as-number 65001</strong>
[<span class="keyword">*</span>DeviceB-bgp]<strong> quit</strong>
[<span class="keyword">*</span>DeviceB] <strong>commit</strong></pre>
<p># Configure DeviceC.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceC]<strong> bgp 65003</strong>
[<span class="keyword">*</span>DeviceC-bgp]<strong> router-id 3.3.3.3</strong>
[<span class="keyword">*</span>DeviceC-bgp]<strong> confederation id 200</strong>
[<span class="keyword">*</span>DeviceC-bgp]<strong> confederation peer-as 65001</strong>
[<span class="keyword">*</span>DeviceC-bgp]<strong> peer 10.1.2.1 as-number 65001</strong>
[<span class="keyword">*</span>DeviceC-bgp]<strong> quit</strong>
[<span class="keyword">*</span>DeviceC] <strong>commit</strong></pre>
</p></li><li><span>Configure IBGP connections in AS 65001.</span><p><p># Configure DeviceA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA]<strong> bgp 65001</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA-bgp] <strong>peer 10.1.3.2 as-number 65001</strong>
[<span class="keyword">*</span>DeviceA-bgp]<strong> peer 10.1.4.2 as-number 65001</strong>
[<span class="keyword">*</span>DeviceA-bgp] <strong>ipv4-family unicast</strong>
[<span class="keyword">*</span>DeviceA-bgp-af-ipv4] <strong>peer 10.1.3.2 next-hop-local</strong>
[<span class="keyword">*</span>DeviceA-bgp-af-ipv4] <strong>peer 10.1.4.2 next-hop-local</strong>
[<span class="keyword">*</span>DeviceA-bgp-af-ipv4] <strong>quit </strong>
[<span class="keyword">*</span>DeviceA-bgp] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>commit</strong></pre>
<p># Configure DeviceD.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceD]<strong> bgp 65001</strong>
[<span class="keyword">*</span>DeviceD-bgp]<strong> router-id 4.4.4.4</strong>
[<span class="keyword">*</span>DeviceD-bgp] <strong>confederation id 200</strong>
[<span class="keyword">*</span>DeviceD-bgp]<strong> peer 10.1.3.1 as-number 65001</strong>
[<span class="keyword">*</span>DeviceD-bgp]<strong> peer 10.1.5.2 as-number 65001</strong>
[<span class="keyword">*</span>DeviceD-bgp]<strong> quit</strong>
[<span class="keyword">*</span>DeviceD] <strong>commit</strong></pre>
<p># Configure DeviceE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceE]<strong> bgp 65001</strong>
[<span class="keyword">*</span>DeviceE-bgp]<strong> router-id 5.5.5.5</strong>
[<span class="keyword">*</span>DeviceE-bgp] <strong>confederation id 200</strong>
[<span class="keyword">*</span>DeviceE-bgp]<strong> peer 10.1.4.1 as-number 65001</strong>
[<span class="keyword">*</span>DeviceE-bgp] <strong>peer 10.1.5.1 as-number 65001</strong>
[<span class="keyword">*</span>DeviceE-bgp]<strong> quit</strong>
[<span class="keyword">*</span>DeviceE] <strong>commit</strong></pre>
</p></li><li><span>Establish an EBGP connection between AS 100 and AS 200.</span><p><p># Configure DeviceA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA]<strong> bgp 65001</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA-bgp]<strong> peer 172.16.1.2 as-number 100 </strong>
[<span class="keyword">*</span>DeviceA-bgp] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>commit</strong></pre>
<p># Configure DeviceF.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceF]<strong> bgp 100</strong>
[<span class="keyword">*</span>DeviceF-bgp] <strong>router-id 6.6.6.6</strong>
[<span class="keyword">*</span>DeviceF-bgp] <strong>peer 172.16.1.1 as-number 200 </strong>
[<span class="keyword">*</span>DeviceF-bgp] <strong>ipv4-family unicast</strong>
[<span class="keyword">*</span>DeviceF-bgp-af-ipv4] <strong>network 192.168.1.0 255.255.255.0</strong>
[<span class="keyword">*</span>DeviceF-bgp-af-ipv4]<strong> quit</strong>
[<span class="keyword">*</span>DeviceF-bgp] <strong>quit</strong>
[<span class="keyword">*</span>DeviceF] <strong>commit</strong></pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001130783876__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p># Check the BGP routing table of DeviceB.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB] <strong>display bgp routing-table</strong>
 BGP Local router ID is 2.2.2.2
 Status codes: * - valid, &gt; - best, d - damped,<span> x - best external,</span><span> a - add path,</span>
               h - history,  i - internal, s - suppressed, S - Stale
               Origin : i - IGP, e - EGP, ? - incomplete
 RPKI validation codes: V - valid, I - invalid, N - not-found

 Total Number of Routes: 1
      Network            NextHop        MED        LocPrf    PrefVal Path/Ogn

 *&gt;i  192.168.1.0/24     10.1.1.1        0          100        0      (65001) 100i</pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB] <strong>display bgp routing-table 192.168.1.0</strong>
BGP local router ID : 2.2.2.2
 Local AS number : 65002
 Paths:   1 available, 1 best, 1 select
 BGP routing table entry information of 192.168.1.0/24:
 From: 10.1.1.1 (1.1.1.1)
 Route Duration: 00h12m29s
 Relay IP Nexthop: 0.0.0.0
 Relay IP Out-Interface: <span>100GE</span><span>1/0/1</span>
 Original nexthop: 10.1.1.1
 Qos information : 0x0
 AS-path (65001) 100, origin igp, MED 0, localpref 100, pref-val 0, valid, <strong>external-confed</strong>, best, select, active, pre 255
 Not advertised to any peer yet</pre>
<p># Check the BGP routing table of DeviceD.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceD] <strong>display bgp routing-table</strong>
 BGP Local router ID is 4.4.4.4
 Status codes: * - valid, &gt; - best, d - damped,<span> x - best external,</span><span> a - add path,</span>
               h - history,  i - internal, s - suppressed, S - Stale
               Origin : i - IGP, e - EGP, ? - incomplete
 RPKI validation codes: V - valid, I - invalid, N - not-found

 Total Number of Routes: 1
      Network            NextHop        MED        LocPrf    PrefVal Path/Ogn

 *&gt;i  192.168.1.0/24     10.1.3.1        0          100        0      100i</pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceD] <strong>display bgp routing-table 192.168.1.0</strong>
BGP local router ID : 4.4.4.4
 Local AS number : 65001
 Paths:   1 available, 1 best, 1 select
 BGP routing table entry information of 192.168.1.0/24:
 From: 10.1.3.1 (1.1.1.1)
 Route Duration: 00h23m57s
 Relay IP Nexthop: 0.0.0.0
 Relay IP Out-Interface:<span>100GE</span><span>1/0/1</span>
 Original nexthop: 10.1.3.1
 Qos information : 0x0
 <strong>AS-path 100</strong>, origin igp, MED 0, localpref 100, pref-val 0, valid, <strong>internal-confed</strong>, best, select, active, pre 255
 Not advertised to any peer yet</pre>
</div>
<div class="postreq"><a name="EN-US_TASK_0000001130783876__postreq17364171716277"></a><a name="postreq17364171716277"></a><a name="EN-US_TASK_0000001130783876__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Scripts</h4><ul><li><p>DeviceA</p>
<pre class="screen">#
sysname DeviceA
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 172.16.1.1 255.255.255.0
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ip address 10.1.1.1 255.255.255.0
#
interface <span>100GE</span><span>1/0/3</span>
 undo portswitch
 ip address 10.1.2.1 255.255.255.0
#
interface <span>100GE</span><span>1/0/4</span>
 undo portswitch
 ip address 10.1.3.1 255.255.255.0
#
interface <span>100GE</span><span>1/0/5</span>
 undo portswitch
 ip address 10.1.4.1 255.255.255.0
#
bgp 65001
 router-id 1.1.1.1
 confederation id 200
 confederation peer-as 65002 65003
 peer 10.1.1.2 as-number 65002
 peer 10.1.2.2 as-number 65003
 peer 10.1.3.2 as-number 65001
 peer 10.1.4.2 as-number 65001
 peer 172.16.1.2 as-number 100
 #
 ipv4-family unicast
  undo synchronization 
  peer 172.16.1.2 enable
  peer 10.1.1.2 enable
  peer 10.1.1.2 next-hop-local
  peer 10.1.2.2 enable
  peer 10.1.2.2 next-hop-local
  peer 10.1.3.2 enable
  peer 10.1.3.2 next-hop-local
  peer 10.1.4.2 enable
  peer 10.1.4.2 next-hop-local
#
return</pre>
</li><li><p>DeviceB</p>
<pre class="screen">#
sysname DeviceB
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 10.1.1.2 255.255.255.0
#
bgp 65002
 router-id 2.2.2.2
 confederation id 200
 confederation peer-as 65001
 peer 10.1.1.1 as-number 65001
 #
 ipv4-family unicast
  undo synchronization 
  peer 10.1.1.1 enable
#
return</pre>
<div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The configuration script of DeviceC is similar to that of DeviceB.</p>
</div></div>
</li><li><p>DeviceD</p>
<pre class="screen">#
sysname DeviceD
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 10.1.3.2 255.255.255.0
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ip address 10.1.5.1 255.255.255.0
#
bgp 65001
 router-id 4.4.4.4
 confederation id 200
 peer 10.1.3.1 as-number 65001
 peer 10.1.5.2 as-number 65001
 #
 ipv4-family unicast
  undo synchronization 
  peer 10.1.3.1 enable
  peer 10.1.5.2 enable
#
return</pre>
<div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The configuration script of DeviceE is similar to that of DeviceD.</p>
</div></div>
</li><li><p>DeviceF</p>
<pre class="screen">#
sysname DeviceF
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 172.16.1.2 255.255.255.0
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ip address 192.168.1.1 255.255.255.0
#
bgp 100
 router-id 6.6.6.6
 peer 172.16.1.1 as-number 200
 #
 ipv4-family unicast
  undo synchronization 
  network 192.168.1.0 255.255.255.0
  peer 172.16.1.1 enable
#
return</pre>
</li></ul>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="vrp_bgp_cfg_0077.html">Configuring a BGP Confederation
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="vrp_bgp_cfg_0079.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>
</body>
</html>