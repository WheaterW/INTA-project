
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Saving a Configuration File">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="vrp_cfgfile_cfg_0004.html">
<meta name="DC.Relation" scheme="URI" content="vrp_cfgfile_cfg_0006.html">
<meta name="DC.Relation" scheme="URI" content="vrp_cfgfile_cfg_0023.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="Configuration File Management">
<meta name="featuretype" content="Basic Configuration">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="Configuration File Management">
<meta name="featuretype" content="Basic Configuration">
<meta name="featurename" content="Configuration File Management">
<meta name="featuretype" content="Basic Configuration">
<meta name="featuretype" content="Basic Configuration">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001513170278">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>Saving a Configuration File</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001513170278"></a><a name="EN-US_TASK_0000001513170278"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Saving a Configuration File</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001513170278__1.3.1"></a><a name="1.3.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><div class="p">You can run commands to modify current device configurations, but these modified configurations will be lost once the device restarts unless you save them to the configuration file before restarting the device. Two methods are available for saving configurations to a configuration file:<ul><li>Automatically saving configurations: With the auto-save function enabled, a device automatically saves configurations to the next-startup configuration file on condition that the current configurations are different from those in the next-startup configuration file and the time specified using the <strong>interval</strong> parameter arrives, regardless of whether the <strong>save</strong> command is run.</li><li>Manually saving configurations: The configurations are saved only after the <strong>save</strong> command is run. After the command is delivered, the current configurations are saved to the configuration file regardless of whether the current configurations are changed.</li></ul>
</div>
<p>Device configurations are stored in the configuration file of the storage medium. During startup, the system reads the configuration file to restore configurations of the device, and then saves the restored configurations to memory.</p>
<p>You can use the <a href="cmdqueryname=display+saved-configuration"><b><span class="cmdname">display saved-configuration</span></b></a> command to check configurations in the configuration file, and the <a href="cmdqueryname=display+current-configuration"><b><span class="cmdname">display current-configuration</span></b></a> command to check those in memory.</p>
<p>When the device is running properly, the configurations in the configuration file should be the same as those in memory. If you add, modify, or delete configurations, the latest configurations are saved in memory, and will be different from those in the configuration file. In this case, you can run the <a href="cmdqueryname=save"><b><span class="cmdname">save</span></b></a> command to save the current configurations in memory to the configuration file.</p>
<p>When the device has not run properly during system startup, the configurations in the configuration file are not completely restored in memory. If you run the <a href="cmdqueryname=save"><b><span class="cmdname">save</span></b></a> command at this time, incomplete configurations in memory will override those in the configuration file. As a result, some configurations may be lost.</p>
</div></div>
<div class="steps-unordered"><a name="EN-US_TASK_0000001513170278__1.3.2"></a><a name="1.3.2"></a><h4 class="sectiontitle">Procedure</h4>
<ul><li><span>Enable the system to automatically save configurations.</span><ol><li class="substepexpand"><span>Enter the system view.</span><p><pre class="screen"><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></pre>
</p></li><li class="substepexpand"><span>Configure the system to save the configurations at a scheduled time.</span><p><pre class="screen"><span><a href="cmdqueryname=configuration+file+auto-save"><b><span class="cmdname">configuration file auto-save</span></b></a> [ <strong><span>interval</span></strong> <i><span class="varname">interval</span></i> | <strong><span>delay</span></strong> <i><span class="varname">delay-interval</span></i> <span>| <strong><span>cpu-limit</span></strong> <i><span class="varname">cpu-usage</span></i></span> ] <sup>*</sup></span></pre>
<p>By default, scheduled saving of configurations is disabled.</p>
<div class="p">The system does not automatically save the configurations in the following scenarios when the scheduled time arrives:<ul><li>The system is writing the configuration file.</li><li>The system is restoring device configurations.</li><li>CPU usage is high.</li></ul>
</div>
</p></li><li class="substepexpand"><span>(Optional) Enable configuration saving interruption upon configuration committing and trigger the system to automatically save configurations.</span><p><pre class="screen"><a href="cmdqueryname=configuration+save-policy+interrupt-allowed"><b><span class="cmdname">configuration save-policy interrupt-allowed</span></b></a></pre>
<p>By default, configuration committing will interrupt configuration saving, and the system is disabled from automatically saving configurations.</p>
<p>After this function is enabled, if a user delivers configurations during configuration saving, configuration saving will be interrupted and fail, and configuration delivery will succeed. The system automatically saves the configurations five minutes later.</p>
<p>After this function is disabled, if a user delivers configurations during configuration saving, configuration saving will not be affected, and configuration delivery will fail.</p>
</p></li><li class="substepexpand"><span>(Optional) Configure server information, including the IP address of the server where the configuration file is automatically saved, user name and password, storage path, and mode for transmitting the configuration file to the server.</span><p><pre class="screen"><a href="cmdqueryname=configuration+file+auto-save+backup-to-server"><b><span class="cmdname">configuration file auto-save backup-to-server</span></b></a> <a href="cmdqueryname=server"><b><span class="cmdname">server</span></b></a> [ <strong><span>ipv6</span></strong> ] <i><span class="varname">server-ip</span></i> [ <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i> ] <strong><span>transport-type</span></strong> { { <strong><span>ftp</span></strong> | <strong><span>sftp</span></strong> }<span> [ <strong><span>port</span></strong> <i><span class="varname">port-value</span></i> ]</span> <strong><span>user</span></strong> <i><span class="varname">user-name</span></i> <strong><span>password</span></strong> <i><span class="varname">password</span></i> | <strong><span>tftp</span></strong> } [ <strong><span>path</span></strong> <i><span class="varname">folder</span></i> ]</pre>
<p>By default, the system does not periodically save configurations to a server.</p>
<div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>If the local storage medium does not have sufficient space or is damaged, or the configuration file needs to be backed up, you can run this command to specify a file server for saving the backup configuration file.</p>
<p>SFTP has higher security and is therefore recommended for saving the configuration file to the file server.</p>
<p>The configuration file is saved on the server as a compressed package, named in the <em>YY-MM-DD.HH-MM-SS</em>.<em>Device name</em>.zip format (for example, <strong>2019-10-25.15-13-37.HUAWEI.zip</strong>). After decompression, the file with the file name extension .cfg is the configuration file.</p>
</div></div>
</p></li><li class="substepexpand"><span>(Optional) Configure the function for uploading the configuration file at a specific time point of a certain day every month.</span><p><pre class="screen"><a href="cmdqueryname=configuration+current+backup-to-server+monthly"><b><span class="cmdname">configuration current backup-to-server monthly</span></b></a> <strong><span>date</span></strong> <i><span class="varname">date-value</span></i> [ <strong><span>time</span></strong> <i><span class="varname">time-value</span></i> ]</pre>
<p>By default, the function of uploading a configuration file to the server on a specific date and time every month is disabled.</p>
</p></li><li class="substepexpand"><span>(Optional) Set the local backup start time and interval.</span><p><pre class="screen"><a href="cmdqueryname=configuration+current+backup-to-file"><b><span class="cmdname">configuration current backup-to-file</span></b></a> [ <strong><span>interval</span></strong> <i><span class="varname">interval-time</span></i> | <strong><span>from</span></strong> <i><span class="varname">time</span></i> ] <sup>*</sup></pre>
</p><p><p>By default, the function of periodically backing up the configuration file is disabled.</p>
</p></li><li class="substepexpand"><span>Commit the configuration.</span><p><pre class="screen" id="EN-US_TASK_0000001513170278__en-us_task_0234857734_screen14848162118611"><a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001513170278__en-us_task_0234857734_cmdname1784862115612">commit</span></b></a></pre>
</p></li></ol>
</li><li><span>Manually save the configurations.</span><ol><li class="substepexpand"><span>(Optional) Enable configuration saving interruption upon configuration committing and trigger the system to automatically save configurations.</span><p><pre class="screen"><a href="cmdqueryname=configuration+save-policy+interrupt-allowed"><b><span class="cmdname">configuration save-policy interrupt-allowed</span></b></a></pre>
<p>By default, configuration committing will interrupt configuration saving, and the system is disabled from automatically saving configurations.</p>
<p>After this function is enabled, if a user delivers configurations during configuration saving, configuration saving will be interrupted and fail, and configuration delivery will succeed. The system automatically saves the configurations five minutes later.</p>
<p>After this function is disabled, if a user delivers configurations during configuration saving, configuration saving will not be affected, and configuration delivery will fail.</p>
</p></li><li class="substepexpand"><span>Save the configurations.</span><p><ul><li>Directly save the configuration file.<pre class="screen"><a href="cmdqueryname=save"><b><span class="cmdname">save</span></b></a><span> [ <i><span class="varname">configuration-file</span></i> ]</span></pre>
<p>The configuration file name extension must be .zip<span>, .dat,</span> or .cfg. If the configuration file will be loaded during system startup, it must be stored in the root directory of the storage medium.</p>
<p>If the <i><span class="varname">configuration-file</span></i> parameter is not specified, the system asks you whether to name the configuration file <strong>vrpcfg.zip</strong> when you save the configuration file for the first time. <span>The <strong>vrpcfg.zip</strong> file is the default configuration file and does not contain any configuration in the initial state.</span> If configurations are not saved for the first time, they will be saved in the running configuration file. You can run the <a href="cmdqueryname=display+startup"><b><span class="cmdname">display startup</span></b></a> command to check the name of the running configuration file.</p>
</li><li>Enter a password to save the configuration file.<pre class="screen"><a href="cmdqueryname=save"><b><span class="cmdname">save</span></b></a> <strong><span>shareable-configuration</span></strong> <i><span class="varname">configuration-file</span></i> [ <strong><span>password</span></strong> ]</pre>
<p>The device generates a key in the configuration file based on the password entered by the user. When the configuration file is used next time, the password must be entered for authentication.</p>
<div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>After the weak password dictionary maintenance function is enabled, the passwords (which can be queried using the <strong>display security weak-password-dictionary</strong> command) defined in the weak password dictionary cannot be specified in this command.</p>
</div></div>
</li></ul>
</p></li></ol>
</li></ul></div>
<div class="example"><a name="EN-US_TASK_0000001513170278__1.3.3"></a><a name="1.3.3"></a><h4 class="sectiontitle">Example</h4><p>If the device is unexpectedly damaged, the configuration file cannot be restored. To prevent this problem, you can configure the device to periodically save the configuration file to the SFTP server for backup.</p>
<ol><li>Configure a routing protocol to ensure that there are reachable routes between the device and SFTP server.</li><li>Configure the SFTP server function and related parameters, create an SSH user named <strong>huawei</strong>, set the authentication mode to password authentication, and set the password to YsHsjx_202206. For details, see "File System Management Configuration" in <span>Configuration Guide</span> &gt; Basic Configuration.</li><li>Set the interval at which the configuration file is saved to 60 minutes.<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>configuration file auto-save interval 60</strong></pre>
</li><li>Configure the configuration file to be transferred to the SFTP server.<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>configuration file auto-save backup-to-server server 10.2.1.2 transport-type sftp user huawei password YsHsjx_202206</strong></pre>
</li><li>After 60 minutes, view the configuration file named after the date and time in the root directory on the SFTP server.</li></ol>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="vrp_cfgfile_cfg_0004.html">Managing Configuration Files
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="vrp_cfgfile_cfg_0006.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="vrp_cfgfile_cfg_0023.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>