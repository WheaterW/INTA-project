
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="(Optional) Manually Configuring Mappings Between Instances and VLANs">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="galaxy_vbst_cfg_0006.html">
<meta name="DC.Relation" scheme="URI" content="galaxy_vbst_cfg_0007.html">
<meta name="DC.Relation" scheme="URI" content="galaxy_vbst_cfg_0009.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="VBST">
<meta name="featuretype" content="Ethernet Switching">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="VBST">
<meta name="featuretype" content="Ethernet Switching">
<meta name="featurename" content="VBST">
<meta name="featuretype" content="Ethernet Switching">
<meta name="featuretype" content="Ethernet Switching">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001512848794">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>(Optional) Manually Configuring Mappings Between Instances and VLANs</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001512848794"></a><a name="EN-US_TASK_0000001512848794"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">(Optional) Manually Configuring Mappings Between Instances and VLANs</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001512848794__1.3.1"></a><a name="1.3.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>Based on the instance-to-VLAN mapping model of MSTP, VBST establishes 1:1 mappings between instances and VLANs. The 1:1 mappings between instances and VLANs are used by devices only to determine the VBST forwarding status.</p>
<p>The mappings between instances and VLANs in VBST can be configured manually or generated dynamically. A manually configured mapping takes precedence over a dynamically generated mapping.</p>
<ul><li>You can manually configure mappings between the instances and VLANs on a device. After VLANs are deleted or VBST is disabled globally, the mappings can only be manually deleted.</li><li>After VBST is enabled, the system dynamically allocates instance IDs in ascending order to existing or new VLANs. Dynamically generated mappings cannot be changed manually; instead, they are automatically deleted after VLANs are deleted or VBST is disabled globally. If a VLAN is created when the number of dynamically specified instances exceeds the number of protected VLANs, a configuration indicating that STP is disabled in the VLAN is displayed in the configuration file.</li></ul>
<p>When manually configuring mappings between instances and VLANs, consider the following factors:</p>
<ul><li>To prevent temporary loops, instance 4094 is reserved in VBST mode, and it cannot be manually mapped to a specific VLAN. Therefore, before changing the spanning tree working mode to VBST, clear instance 4094's configuration or map the VLAN to which this instance is mapped to a different available instance.</li><li>In VBST, each instance maps a different VLAN. Therefore, to prevent multiple VLANs from being mapped to one instance, it is recommended that you run the <a href="cmdqueryname=display+stp+vlan+instance"><b><span class="cmdname">display stp vlan instance</span></b></a> command to view the existing mappings between instances and VLANs before configuring new mappings.</li><li>If the number of specified instances exceeds that supported by the device, when VLANs are created, VBST does not take effect in the VLANs by default and an alarm is generated. The number of instances supported by the device is the total number of instances in manually configured and dynamically generated mappings. To enable VBST in these VLANs, release the instances mapped to the other VLANs by running the <a href="cmdqueryname=undo+vlan"><b><span class="cmdname">undo vlan</span></b></a> command. When the number of VBST-enabled VLANs decreases to less than 95% of the upper limit, the alarm clears and the system automatically reallocates an instance to the specific VLAN.</li><li>If the number of configured VLANs exceeds the upper limit, deleting manually configured mappings will cause the system to reallocate the available instances to VLANs. In this scenario, VLANs that are not dynamically mapped to instances preferentially occupy the available instances. If you run the <a href="cmdqueryname=rollback+configuration"><b><span class="cmdname">rollback configuration</span></b></a> command to enable the system to reallocate available instances to the VLANs, configuration rollback will fail if all instances have been allocated. To prevent this from occurring, before implementing configuration rollback, determine whether the configuration can be rolled back as planned by running the <a href="cmdqueryname=display+configuration+commit+changes"><b><span class="cmdname">display configuration commit changes</span></b></a> command to view configuration changes. If certain configurations fail to be rolled back, run the <a href="cmdqueryname=display+configuration+rollback+result"><b><span class="cmdname">display configuration rollback result</span></b></a> command to check the configurations and system prompt displayed when configuration commands are run, and then manually restore the configurations.</li></ul>
<p>Perform the following steps to manually configure mappings between instances and VLANs.</p>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001512848794__1.3.2"></a><a name="1.3.2"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Enter the system view.</span><p><pre class="screen"><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></pre>
</p></li><li><span>Enter the MST region view.</span><p><pre class="screen"><a href="cmdqueryname=stp+region-configuration"><b><span class="cmdname">stp region-configuration</span></b></a></pre>
</p></li><li><span>Configure a 1:1 mapping between an instance and a VLAN.</span><p><pre class="screen"><a href="cmdqueryname=instance"><b><span class="cmdname">instance</span></b></a> <i><span class="varname">instance-id</span></i> <strong><span>vlan</span></strong> <i><span class="varname">vlan-id</span></i></pre>
<p>By default, all VLANs are mapped to the CIST instance, namely, instance 0.</p>
</p></li><li><span>Commit the configuration.</span><p><pre class="screen" id="EN-US_TASK_0000001512848794__en-us_task_0228023023_screen163801330213"><a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001512848794__en-us_task_0228023023_en-us_concept_0141113565_cmdname1667501373175340">commit</span></b></a></pre>
</p></li></ol></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="galaxy_vbst_cfg_0006.html">Configuring Basic VBST Functions
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="galaxy_vbst_cfg_0007.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="galaxy_vbst_cfg_0009.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>