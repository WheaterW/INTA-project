
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring a VXLAN I-PMSI Tunnel">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="vrp_ipv4_multi_over_vxlan_cfg_0010.html">
<meta name="DC.Relation" scheme="URI" content="vrp_ipv4_multi_over_vxlan_cfg_0012.html">
<meta name="DC.Relation" scheme="URI" content="vrp_ipv4_multi_over_vxlan_cfg_0014.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="IPv4 Layer 3 Multicast over VXLAN">
<meta name="featuretype" content="IP Multicast">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="IPv4 Layer 3 Multicast over VXLAN">
<meta name="featuretype" content="IP Multicast">
<meta name="featurename" content="IPv4 Layer 3 Multicast over VXLAN">
<meta name="featuretype" content="IP Multicast">
<meta name="featuretype" content="IP Multicast">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001136173418">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>Configuring a VXLAN I-PMSI Tunnel</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001136173418"></a><a name="EN-US_TASK_0000001136173418"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring a VXLAN I-PMSI Tunnel</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001136173418__1.3.1"></a><a name="1.3.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>An I-PMSI tunnel is a PMSI tunnel that connects all PEs on the same MVPN. This enables all PEs on the same MVPN to receive multicast data traffic from the I-PMSI tunnel. In a scenario where VXLAN gateways are deployed in distributed mode, VXLAN is used to establish I-PMSI tunnels as PEs functioning as VXLAN gateways have established VXLAN tunnels with each other. Perform the following steps on each of the PEs functioning as VXLAN gateways:</p>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001136173418__1.3.2"></a><a name="1.3.2"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Enter the system view.</span><p><pre class="screen"><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></pre>
</p></li><li><span>Configure an MVPN ID.</span><p><pre class="screen"><a href="cmdqueryname=multicast+mvpn"><b><span class="cmdname">multicast mvpn</span></b></a> <i><span class="varname">mvpn-id</span></i></pre>
<p>An MVPN ID is the IP address of the originator PE on an MVPN. The MVPN ID is used as the value of the Administrator field in the VRF Route Import extended community attribute. If no MVPN ID is configured, BGP EVPN routes and C-multicast routes sent by a PE cannot carry the VRF Route Import extended community attribute.</p>
<div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The MVPN ID configured on a distributed VXLAN gateway must be the same as the gateway's VTEP IP address. If VXLAN gateways are deployed in M-LAG active-active mode, the master and backup gateways must have the same VTEP IP address.</p>
</div></div>
</p></li><li><span>Enter the VPN instance view.</span><p><pre class="screen"><a href="cmdqueryname=ip+vpn-instance"><b><span class="cmdname">ip vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i></pre>
</p></li><li><span>Enter the VPN instance IPv4 address family view.</span><p><pre class="screen"><a href="cmdqueryname=ipv4-family"><b><span class="cmdname">ipv4-family</span></b></a></pre>
</p></li><li><span>Configure an RD for the VPN instance IPv4 address family.</span><p><pre class="screen"><a href="cmdqueryname=route-distinguisher"><b><span class="cmdname">route-distinguisher</span></b></a> <i><span class="varname">route-distinguisher</span></i></pre>
<p>A VPN instance IPv4 address family takes effect only after being assigned an RD. The RDs of different VPN instance IPv4 address families on the same PE must be different.</p>
</p></li><li><span>Configure a VPN-Target extended community.</span><p><pre class="screen"><strong><a href="cmdqueryname=vpn-target"><b><span class="cmdname">vpn-target</span></b></a> </strong>{ <em><i><span class="varname">vpn-target</span></i></em> } &amp;&lt;1-8&gt; [ <em><i><span class="varname">vrfRtType</span></i></em> ]</pre>
</p></li><li><span>Enable multicast routing for the VPN instance IPv4 address family.</span><p><pre class="screen"><a href="cmdqueryname=multicast+routing-enable"><b><span class="cmdname">multicast routing-enable</span></b></a></pre>
<p>By default, multicast routing is not enabled for a VPN instance IPv4 address family.</p>
</p></li><li><span>Configure a local VPN instance ID for the sender PE on the MVPN.</span><p><pre class="screen"><a href="cmdqueryname=multicast+mvpn+route-import+local-admin-id"><b><span class="cmdname">multicast mvpn route-import local-admin-id</span></b></a> <i><span class="varname">local-admin-id</span></i></pre>
<p>By default, no local VPN instance ID is configured for a sender PE on an MVPN.</p>
<p>The VRF Route Import extended community is in the format of Administrator field: Local Administrator field, where the Local Administrator field represents the sender PE's local VPN instance ID.</p>
<p>A local VPN instance cannot share the same <i><span class="varname">local-admin-id</span></i> with other VPN instances.</p>
</p></li><li><span>Enter the VPN instance IPv4 address family MVPN view.</span><p><pre class="screen"><a href="cmdqueryname=mvpn"><b><span class="cmdname">mvpn</span></b></a></pre>
</p></li><li><span>(Optional) Configure an MVPN target for the VPN instance MVPN address family.</span><p><pre class="screen"><a href="cmdqueryname=vpn-target"><b><span class="cmdname">vpn-target</span></b></a> { <em>vrfRT</em> } &amp; &lt;1-8&gt; [<em> <i><span class="varname">vrfRTType</span></i></em> ]</pre>
</p><p><p>By default, no MVPN target is configured for the VPN instance MVPN address family. The VPN instance MVPN address family uses the VPN target configured in the VPN instance IPv4 address family view as the MVPN target.</p>
<p>When the routes of a VPN instance MVPN address family need to be isolated from those of the IPv4 address family belonging to the same VPN instance, perform this step to configure an exclusive MVPN target for the VPN instance MVPN address family.</p>
</p></li><li><span>Configure BGP as the signaling protocol for transmitting C-multicast routes.</span><p><pre class="screen"><a href="cmdqueryname=c-multicast+signaling"><b><span class="cmdname">c-multicast signaling</span></b></a> <strong><span>bgp</span></strong></pre>
</p><p><p>By default, no signaling protocol is configured for transmitting C-multicast routes. To configure a signaling protocol for a PE to transmit C-multicast routes, run the <a href="cmdqueryname=c-multicast+signaling"><b><span class="cmdname">c-multicast signaling</span></b></a> command.</p>
</p></li><li><span>(Optional) Configure inter-AS automatic discovery.</span><p><pre class="screen"><a href="cmdqueryname=auto-discovery+inter-as"><b><span class="cmdname">auto-discovery inter-as</span></b></a></pre>
</p><p><p>By default, inter-AS automatic discovery is disabled.</p>
<p>In a scenario where an NG MVPN crosses different ASs, to enable PEs in different ASs to exchange Intra-AD routes for automatic MVPN peer discovery, perform this step.</p>
</p></li><li><span>(Optional) Enable PIM-SM RPTs to be set up not across the public network.</span><p><pre class="screen"><a href="cmdqueryname=spt-only+mode"><b><span class="cmdname">spt-only mode</span></b></a></pre>
</p><p><p>If receivers use the (S, G) join mode, skip this step. By default, no PIM-SM RPTs are established on a multicast network.</p>
<p>If receivers use the (*, G) join mode, perform this step to configure the PIM-SM RPT setup mode.</p>
</p></li><li><span>(Optional) Enable the function of advertising (S, G) entry information in MSDP SA messages to the remote PE through BGP Source Active A-D routes.</span><p><pre class="screen"><a href="cmdqueryname=import+msdp"><b><span class="cmdname">import msdp</span></b></a></pre>
</p><p><p>By default, (S, G) entry information in MSDP SA messages is not transmitted to the remote PE through BGP Source Active A-D routes.</p>
<p>If PIM-SM RPT setup is not across the public network, you can deploy VPN RPs on PEs or CEs. If an RP is deployed on a CE, the CE needs to establish an MSDP peer relationship with its connected PE and transmit (S, G) entry information to the PE through MSDP SA messages. To enable this PE to transmit the (S, G) entry information to the remote PE through BGP Source Active A-D routes, perform this step.</p>
</p></li><li><span>(Optional) Enable the function to advertise (S, G) entry information in BGP Source Active A-D routes to the RP through MSDP SA messages.</span><p><pre class="screen"><a href="cmdqueryname=export+msdp"><b><span class="cmdname">export msdp</span></b></a></pre>
</p><p><p>By default, (S, G) entry information in BGP Source Active A-D routes is not transmitted to the RP through MSDP SA messages.</p>
<p>If PIM-SM RPT setup is not across the public network, you can deploy VPN RPs on PEs or CEs. If an RP is deployed on a CE, the CE needs to establish an MSDP peer relationship with its connected PE. To enable this PE to transmit (S, G) entry information in BGP Source Active A-D routes to the remote CE, perform this step.</p>
</p></li><li><span>(Optional) Configure a pruning delay during the RPT-to-SPT switchover in a scenario where PIM-SM RPT setup is across the public network.</span><p><pre class="screen"><a href="cmdqueryname=rpt-prune-delay"><b><span class="cmdname">rpt-prune-delay</span></b></a> <i><span class="varname">delay-time</span></i></pre>
<p>By default, the pruning delay during the RPT-to-SPT switchover is 60 seconds.</p>
</p></li><li><span>Enter the MVPN I-PMSI view.</span><p><pre class="screen"><a href="cmdqueryname=ipmsi-tunnel"><b><span class="cmdname">ipmsi-tunnel</span></b></a></pre>
</p></li><li><span>Configure the device to use VXLAN to establish I-PMSI tunnels.</span><p><pre class="screen"><a href="cmdqueryname=vxlan+static"><b><span class="cmdname">vxlan static</span></b></a></pre>
</p><p><p>By default, no I-PMSI tunnel establishment mode is configured.</p>
</p></li><li><span>Exit the VPN instance IPv4 address family MVPN view.</span><p><pre class="screen"><a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></pre>
</p></li><li><span>Exit the VPN instance IPv4 address family view.</span><p><pre class="screen"><a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></pre>
</p></li><li><span>Bind a VNI to the VPN instance.</span><p><pre class="screen"><strong><a href="cmdqueryname=vxlan+vni"><b><span class="cmdname">vxlan vni</span></b></a> </strong><em><i><span class="varname">vni-id</span></i></em></pre>
</p></li><li><span>Commit the configuration.</span><p><pre class="screen" id="EN-US_TASK_0000001136173418__en-us_task_0234857734_screen163801330213"><a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001136173418__en-us_task_0234857734_en-us_concept_0141113565_cmdname1667501373175340">commit</span></b></a></pre>
</p></li></ol></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="vrp_ipv4_multi_over_vxlan_cfg_0010.html">Configuring IPv4 Layer 3 Multicast over VXLAN
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="vrp_ipv4_multi_over_vxlan_cfg_0012.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="vrp_ipv4_multi_over_vxlan_cfg_0014.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>