
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring OSPF GTSM">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../vrp/vrp_ospf_cfg_0107.html">
<meta name="DC.Relation" scheme="URI" content="../vrp/vrp_ospf_cfg_0110.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="OSPF">
<meta name="featuretype" content="IP Routing">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="OSPF">
<meta name="featuretype" content="IP Routing">
<meta name="featuretype" content="IP Routing">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001130623446">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="../public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring OSPF GTSM</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001130623446"></a><a name="EN-US_TASK_0000001130623446"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring OSPF GTSM</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001130623446__1.3.1"></a><a name="1.3.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0000001130623446__fig_dc_vrp_gtsm_cfg_001001">Figure 1</a>, OSPF runs on each device, and GTSM is enabled on each device. The valid TTL ranges of the packets sent from each device to DeviceC are as follows:</p>
<ul><li><p>DeviceA and DeviceE are directly connected to DeviceC; therefore, the valid TTL ranges in the packets are both [255, 255].</p>
</li><li><p>The valid TTL ranges in the packets sent from DeviceB, DeviceD, and DeviceF to DeviceC are [254, 255], [253, 255], and [252, 255], respectively.</p>
</li></ul>
<div class="fignone" id="EN-US_TASK_0000001130623446__fig_dc_vrp_gtsm_cfg_001001"><a name="EN-US_TASK_0000001130623446__fig_dc_vrp_gtsm_cfg_001001"></a><a name="fig_dc_vrp_gtsm_cfg_001001"></a><span class="figcap"><b>Figure 1 </b>Network diagram of OSPF GTSM</span><div class="note"><img src="../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface 1 and interface 2 represent <span>100GE</span> <span>1/0/1</span> and <span>100GE</span> <span>1/0/2</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0000001130623510.png"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001130623446__1.3.2"></a><a name="1.3.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Precautions</h4><p>To improve security, OSPF area authentication or interface authentication is recommended. For details, see "Improving OSPF Network Security." OSPF area authentication is used as an example. For details, see "Example for Configuring Basic OSPF Functions."</p>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001130623446__1.3.3"></a><a name="1.3.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure basic OSPF functions.</p>
</li><li><p>Enable GTSM on each device and specify a valid TTL range.</p>
</li></ol>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001130623446__1.3.4"></a><a name="1.3.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Assign an IP address to each interface.</span><p><p>Assign an IP address to each interface as shown in <a href="#EN-US_TASK_0000001130623446__fig_dc_vrp_gtsm_cfg_001001">Figure 1</a>. For detailed configurations, see the configuration scripts.</p>
</p></li><li><span>Configure basic OSPF functions.</span><p><p>See <a href="vrp_ospf_cfg_0018.html">Example for Configuring Basic OSPF Functions</a>. For detailed configurations, see Configuration Scripts in this section.</p>
</p></li><li><span>Configure OSPF GTSM.</span><p><p># Set the valid TTL range in packets from DeviceC to the other devices to [252, 255].</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceC] <strong>ospf valid-ttl-hops 4</strong>
<span>[<span class="keyword">*</span>DeviceC] <strong>commit</strong></span></pre>
<p># Set the valid TTL range in packets from DeviceA to DeviceC to [255, 255].</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA]<strong> ospf valid-ttl-hops 1</strong>
<span>[<span class="keyword">*</span>DeviceA] <strong>commit</strong></span></pre>
<p># Set the valid TTL range in packets from DeviceB to DeviceC to [254, 255].</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB]<strong> ospf valid-ttl-hops 2</strong>
<span>[<span class="keyword">*</span>DeviceB] <strong>commit</strong></span></pre>
<p># Set the valid TTL range in packets from DeviceD to DeviceC to [253, 255].</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceD]<strong> ospf valid-ttl-hops 3</strong>
<span>[<span class="keyword">*</span>DeviceD] <strong>commit</strong></span></pre>
<p># Set the valid TTL range in packets from DeviceE to DeviceC to [255, 255].</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceE]<strong> ospf valid-ttl-hops 1</strong>
<span>[<span class="keyword">*</span>DeviceE] <strong>commit</strong></span></pre>
<p># Set the valid TTL range in packets from DeviceF to DeviceC to [252, 255].</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceF]<strong> ospf valid-ttl-hops 4</strong>
<span>[<span class="keyword">*</span>DeviceF] <strong>commit</strong></span></pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001130623446__1.3.5"></a><a name="1.3.5"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p># Check whether the OSPF neighbor relationships are established properly between the devices. The following uses the command output on DeviceA as an example. The command output shows that the status of each neighbor relationship is Full, that is, the neighbor relationships are established properly.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA]<strong> display ospf peer</strong>
          OSPF Process 1 with Router ID 1.1.1.1
                  Neighbors

 Area 0.0.0.0 interface 192.168.0.1(<span>100GE</span><span>1/0/1</span>)'s neighbors
<strong> Router ID: 2.2.2.2</strong>      Address: 192.168.0.2
<strong> State: Full</strong>  Mode:Nbr is  Master  Priority: 1
   DR: None   BDR: None   MTU: 0
   Dead timer due in 36  sec
   Retrans timer interval: 5
   Neighbor is up for 00:15:04
   Authentication Sequence: [ 0 ]

                  Neighbors

 Area 0.0.0.1 interface 192.168.1.1(<span>100GE</span><span>1/0/2</span>)'s neighbors
<strong> Router ID: 3.3.3.3</strong>       Address: 192.168.1.2
<strong> State: Full</strong>  Mode:Nbr is  Master  Priority: 1
   DR: None   BDR: None   MTU: 0
   Dead timer due in 39  sec
   Retrans timer interval: 5
   Neighbor is up for 00:07:32
   Authentication Sequence: [ 0 ]</pre>
<p># Run the <strong>display gtsm statistics all</strong> command on DeviceC to check GTSM statistics. If the default action taken on packets that do not match the specified GTSM policy is set to pass and all the packets are valid, no packet is dropped.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceC] <strong>display gtsm statistics all</strong>
GTSM Statistics Table
----------------------------------------------------------------
SlotId  Protocol  Total Counters  Drop Counters  Pass Counters
----------------------------------------------------------------
 1      BGP       0               0              0
 1      BGPv6     0               0              0
 1      OSPF      0               0              0
 1      OSPFv3    0               0              0 
 1      RIP       0               0              0 
----------------------------------------------------------------</pre>
<p>If the host PC simulates the OSPF packets of DeviceA to attack DeviceC, the packets are dropped when they reach DeviceC because the TTL value is not 255. As a result, in the GTSM statistics on DeviceC, the number of dropped packets also increases.</p>
</div>
<div class="postreq"><a name="EN-US_TASK_0000001130623446__1.3.6"></a><a name="1.3.6"></a><h4 class="sectiontitle">Configuration Scripts</h4><ul><li><p>DeviceA</p>
<pre class="screen">#
sysname DeviceA
#
router id 1.1.1.1
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 192.168.0.1 255.255.255.0
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ip address 192.168.1.1 255.255.255.0
#
ospf 1
 area 0.0.0.0
  network 192.168.0.0 0.0.0.255
 area 0.0.0.1
  network 192.168.1.0 0.0.0.255
#
ospf valid-ttl-hops 1
#
return</pre>
</li><li><p>DeviceB</p>
<pre class="screen">#
sysname DeviceB
#
router id 2.2.2.2
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 192.168.0.2 255.255.255.0
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ip address 192.168.2.1 255.255.255.0
#
ospf 1
 area 0.0.0.0
  network 192.168.0.0 0.0.0.255
 area 0.0.0.2
  network 192.168.2.0 0.0.0.255
#
ospf valid-ttl-hops 2
#
return</pre>
</li><li><p>DeviceC</p>
<pre class="screen">#
sysname DeviceC
#
router id 3.3.3.3
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ip address 172.16.1.1 255.255.255.0
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 192.168.1.2 255.255.255.0
#
ospf 1
 area 0.0.0.1
  network 192.168.1.0 0.0.0.255
  network 172.16.1.0 0.0.0.255
#
ospf valid-ttl-hops 4
#
return</pre>
</li><li><p>DeviceD</p>
<pre class="screen">#
sysname DeviceD
#
router id 4.4.4.4
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ip address 172.17.1.1 255.255.255.0
#
interface <span>100GE</span><span>1/0/1</span><span></span>
 undo portswitch
 ip address 192.168.2.2 255.255.255.0
#
ospf 1
 area 0.0.0.2
  network 192.168.2.0 0.0.0.255
  network 172.17.1.0 0.0.0.255
#
ospf valid-ttl-hops 3
#
return</pre>
</li><li><p>DeviceE</p>
<pre class="screen">#
sysname DeviceE
#
router id 5.5.5.5
#
interface <span>100GE</span><span>1/0/2</span><span></span>
 undo portswitch
 ip address 172.16.1.2 255.255.255.0
#
ospf 1
 area 0.0.0.1
  network 172.16.1.0 0.0.0.255
#
ospf valid-ttl-hops 1
#
return</pre>
</li><li><p>DeviceF</p>
<pre class="screen">#
sysname DeviceF
#
router id 6.6.6.6
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ip address 172.17.1.2 255.255.255.0
#
ospf 1
 area 0.0.0.2
  network 172.17.1.0 0.0.0.255
#
ospf valid-ttl-hops 4
#
return</pre>
</li></ul>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../vrp/vrp_ospf_cfg_0107.html">Configuring OSPF GTSM
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../vrp/vrp_ospf_cfg_0110.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>
</body>
</html>