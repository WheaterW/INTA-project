
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Static IGMP Snooping over VXLAN">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="vrp_l2mc_over_vxlan_cfg_0015.html">
<meta name="DC.Relation" scheme="URI" content="vrp_l2mc_over_vxlan_cfg_0020.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="IGMP Snooping over VXLAN">
<meta name="featuretype" content="IP Multicast">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="IGMP Snooping over VXLAN">
<meta name="featuretype" content="IP Multicast">
<meta name="featurename" content="IGMP Snooping over VXLAN">
<meta name="featuretype" content="IP Multicast">
<meta name="featuretype" content="IP Multicast">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001200723013">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring Static IGMP Snooping over VXLAN</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001200723013"></a><a name="EN-US_TASK_0000001200723013"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Static IGMP Snooping over VXLAN</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001200723013__1.3.1"></a><a name="1.3.1"></a>
<div class="p"><div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On a VXLAN network, static IGMP snooping over VXLAN allows forwarding paths to be manually specified for multicast traffic, ensuring that downstream users can continuously and stably receive multicast traffic while also preventing multicast traffic flooding in the BD.</p>
<p>On the network shown in <a href="#EN-US_TASK_0000001200723013__fig_dc_cfg_igmp_snp_014001">Figure 1</a>, an enterprise has VMs deployed on different servers. VM1s on Server1, Server2, and Server3 belong to VLAN 10. The VMs on Server1 are multicast sources. The VMs on Server2 want to continuously receive traffic from multicast group 255.0.0.0, and the VMs on Server3 want to continuously receive traffic from multicast group 255.0.0.1. Static IGMP snooping over VXLAN needs to be configured to implement continuous traffic forwarding.</p>
<div class="fignone" id="EN-US_TASK_0000001200723013__fig_dc_cfg_igmp_snp_014001"><a name="EN-US_TASK_0000001200723013__fig_dc_cfg_igmp_snp_014001"></a><a name="fig_dc_cfg_igmp_snp_014001"></a><span class="figcap"><b>Figure 1 </b>Networking diagram for configuring static IGMP snooping over VXLAN</span><div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface1, interface2, and interface3 represent <span>100GE</span><span>1/0/1</span>, <span>100GE</span><span>1/0/2</span>, and <span>100GE</span><span>1/0/3</span>, respectively.</p>
</div></div>
<p><span><img class="vsd" src="figure/en-us_image_0000001172481782.png"></span></p>
</div>
<h4 class="sectiontitle">Configuration Roadmap</h4><div class="p">The configuration roadmap is as follows:<ol><li>Configure a routing protocol on DeviceA, DeviceB, and DeviceC to ensure Layer 3 interworking.</li><li>Configure a VXLAN service access point on DeviceA, DeviceB, and DeviceC to distinguish service traffic.</li><li>Configure static VXLAN tunnels on DeviceA, DeviceB, and DeviceC.</li><li>Enable IGMP snooping globally and in the BD on all service access points on DeviceA, DeviceB, and DeviceC to implement Layer 2 multicast on the VXLAN network.</li><li>Enable IGMP snooping proxy globally and in the BD on all service access points on DeviceA, DeviceB, and DeviceC. Configure the transmit end DeviceA to periodically send Query messages to collect join information, and configure the receive ends DeviceB and DeviceC to reply with join information based on static entries.</li><li>On DeviceB and DeviceC, configure static forwarding entries in which the outbound interfaces are downstream VMs.</li><li>Disable DeviceA from dynamically learning multicast group member ports. This prevents DeviceA from generating unnecessary dynamic router ports after receiving IGMP Query messages from downstream devices, which would otherwise cause redundant traffic forwarding.</li></ol>
</div>
</div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001200723013__1.3.2"></a><a name="1.3.2"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure a routing protocol.</span><p><p># Configure DeviceA.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname DeviceA</strong>
[<span><span class="keyword">*</span></span><span class="keyword">HUAWEI</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>interface loopback 0</strong>
[<span><span class="keyword">*</span></span>DeviceA-LoopBack0] <strong>ip address 1.1.1.1 32</strong>
[<span><span class="keyword">*</span></span>DeviceA-LoopBack0] <strong>quit</strong>
[<span><span class="keyword">*</span></span>DeviceA] <strong>interface <span>100ge</span> <span>1/0/1</span></strong>
[<span><span class="keyword">*</span></span>DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>undo portswitch</strong>
[<span><span class="keyword">*</span></span>DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>ip address 192.168.2.2 24</strong>
[<span><span class="keyword">*</span></span>DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>quit</strong>
[<span><span class="keyword">*</span></span>DeviceA] <strong>ospf 1</strong>
[<span class="keyword">*</span>DeviceA-ospf-1] <strong>area 0.0.0.0</strong>
[<span class="keyword">*</span>DeviceA-ospf-1-area-0.0.0.0] <strong>network 1.1.1.1 0.0.0.0</strong>
[<span class="keyword">*</span>DeviceA-ospf-1-area-0.0.0.0] <strong>network 192.168.2.0 0.0.0.255 </strong>
[<span class="keyword">*</span>DeviceA-ospf-1-area-0.0.0.0] <strong>network 192.168.3.0 0.0.0.255 </strong>
[<span class="keyword">*</span>DeviceA] <strong>commit</strong></pre>
<p>The configurations of DeviceB and DeviceC are similar to that of DeviceA. For detailed configurations, see Configuration Scripts.</p>
</p></li><li><span>Configure service access points.</span><p><p># Configure DeviceA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>bridge-domain 10</strong>
[<span><span class="keyword">*</span></span>DeviceA-bd10] <strong>quit</strong>
[<span><span class="keyword">*</span></span>DeviceA] <strong>interface <span>100ge</span> <span>1/0/2</span>.1 mode l2</strong>
[<span><span class="keyword">*</span></span>DeviceA-<span>100GE</span><span>1/0/2</span>.1] <strong>encapsulation dot1q vid 10</strong>
[<span><span class="keyword">*</span></span>DeviceA-<span>100GE</span><span>1/0/2</span>.1] <strong>bridge-domain 10</strong>
[<span><span class="keyword">*</span></span>DeviceA-<span>100GE</span><span>1/0/2</span>.1] <strong>quit</strong>
[<span><span class="keyword">*</span></span>DeviceA] <strong>commit</strong></pre>
<p>The configurations of DeviceB and DeviceC are similar to that of DeviceA. For detailed configurations, see Configuration Scripts.</p>
</p></li><li><span>Configure static VXLAN tunnels.</span><p><p># Configure DeviceA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>interface nve 1</strong>
[<span class="keyword">*</span>DeviceA-Nve1] <strong>source 1.1.1.1</strong>
[<span class="keyword">*</span>DeviceA-Nve1] <strong>vni 10 head-end peer-list 2.2.2.2 3.3.3.3</strong>
[<span class="keyword">*</span>DeviceA-Nve1] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>commit</strong></pre>
<p>The configurations of DeviceB and DeviceC are similar to that of DeviceA. For detailed configurations, see Configuration Scripts.</p>
</p></li><li><span>Enable IGMP snooping globally and in the BD.</span><p><p># Configure DeviceA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>igmp snooping enable</strong>
[<span><span class="keyword">*</span></span>DeviceA] <strong>bridge-domain 10</strong>
[<span><span class="keyword">*</span></span>DeviceA-bd10] <strong>igmp snooping enable</strong>
[<span><span class="keyword">*</span></span>DeviceA-bd10] <strong>quit</strong>
[<span><span class="keyword">*</span></span>DeviceA] <strong>commit</strong></pre>
</p><p><p>The configurations of DeviceB and DeviceC are similar to that of DeviceA. For detailed configurations, see Configuration Scripts.</p>
</p></li><li><span>Configure IGMP snooping proxy.</span><p><p># Configure DeviceA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>bridge-domain 10</strong>
[<span class="keyword">*</span>DeviceA-bd10] <strong>igmp snooping proxy</strong>
[<span class="keyword">*</span>DeviceA-bd10] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>commit </strong></pre>
<p>The configurations of DeviceB and DeviceC are similar to that of DeviceA. For detailed configurations, see Configuration Scripts.</p>
</p></li><li><span>Configure static Layer 2 multicast entries.</span><p><p># Configure DeviceB.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB] <strong>interface <span>100ge</span> <span>1/0/2</span>.1 mode l2  </strong>
[<span class="keyword">*</span>DeviceB-<span>100GE</span><span>1/0/2</span>.1] <strong>igmp snooping static-group group-address 225.0.0.0 dot1q vid 10  </strong>
[<span class="keyword">*</span>DeviceB-<span>100GE</span><span>1/0/2</span>.1] <strong>quit </strong>
[<span class="keyword">*</span>DeviceB] <strong>commit</strong></pre>
<p>The configuration of DeviceC is similar to that of DeviceB. For detailed configurations, see Configuration Scripts.</p>
</p></li><li><span>Disable the transmit end from automatically learning router ports.</span><p><p># Configure DeviceA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>bridge-domain 10</strong> 
[<span class="keyword">*</span>DeviceA-bd10] <strong>igmp snooping router-learning disable  </strong>
[<span class="keyword">*</span>DeviceA-bd10] <strong>quit </strong>
[<span class="keyword">*</span>DeviceA] <strong>commit</strong></pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001200723013__1.3.3"></a><a name="1.3.3"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p># Display VXLAN tunnel information.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>display vxlan tunnel</strong>
Number of vxlan tunnel : 2
Tunnel ID   Source                Destination           State  Type     Uptime
-----------------------------------------------------------------------------------
4026531841  1.1.1.1               2.2.2.2               up     dynamic  02:14:45
4026531842  1.1.1.1               3.3.3.3               up     dynamic  02:09:42</pre>
<p># Display router port information on a receive end.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB] <strong>display igmp snooping router-port</strong>
 Port Name                            UpTime        Expires       Flags
 --------------------------------------------------------------------------
 Bridge-domain 1, 1 router-port(s)
 <strong>vxlan-peer(1.1.1.1)</strong>                  02h15m42s     00h02m32s     <strong>DYNAMIC</strong></pre>
<p>The command output shows that a dynamic router port pointing to DeviceA has been generated on DeviceB.</p>
<p># Display information about multicast group member ports on the transmit end.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>display igmp snooping port-info bridge-domain 10 verbose </strong>
The port information of <strong>Group 225.0.0.0</strong> on Bridge-domain 10:
  Time of this group has been up : 02:13:13

  The port information of (*, 225.0.0.0):
    Time of this source has been up : 02:13:13
    Port Table on this source(*):
    Source flags: IGMP
    List of ports in include mode : 
      No.1 
        Port name : <strong>vxlan-peer(2.2.2.2)</strong> 
        Time of this port has been up as a host-port : 02:13:14 
        Remain time of port expire as dynamic host-port : -- 
        Host-port flags : Dynamic 
    There are 1 port(s) in include mode. 
The port information of <strong>Group 225.0.0.1</strong> on Bridge-domain 10: 
  Time of this group has been up : 02:13:12 
 
  The port information of (*, 225.0.0.1): 
    Time of this source has been up : 02:13:12 
    Port Table on this source(*): 
    Source flags: IGMP 
    List of ports in include mode : 
      No.1 
        Port name : <strong>vxlan-peer(3.3.3.3)</strong> 
        Time of this port has been up as a host-port : 02:13:12 
        Remain time of port expire as dynamic host-port : -- 
        Host-port flags : Dynamic 
    There are 1 port(s) in include mode.</pre>
<p>The command output on DeviceA shows that the dynamic member port <strong>vxlan-peer(2.2.2.2)</strong> has been generated for the traffic of the multicast group 225.0.0.0 to be sent to DeviceB, and the dynamic member port <strong>vxlan-peer(3.3.3.3)</strong> has been generated for the traffic of the multicast group 225.0.0.1 to be sent to DeviceC.</p>
<p># Display information about multicast group member ports on a receiver end.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB] <strong>display igmp snooping port-info bridge-domain 10 verbose </strong> 
The port information of <strong>Group 225.0.0.0</strong> on Bridge-domain 10: 
  Time of this group has been up : 02:21:15 
 
  The port information of (*, 225.0.0.0): 
    Time of this source has been up : 02:21:15 
    Port Table on this source(*): 
    Source flags: IGMP 
    List of ports in include mode : 
      No.1 
        Port name : <strong><span>100GE</span><span>1/0/2</span>.1</strong>(PE:10) 
        Time of this port has been up as a host-port : 02:21:15 
        Remain time of port expire as dynamic host-port : -- 
        Host-port flags : <strong>Static</strong> 
    There are 1 port(s) in include mode.</pre>
<p>The command output shows that the Layer 2 sub-interface <span>100GE</span><span>1/0/2</span>.1 on DeviceB has been statically added to multicast group 225.0.0.0 and works as a static member port.</p>
</div>
<div class="postreq"><a name="EN-US_TASK_0000001200723013__1.3.4"></a><a name="1.3.4"></a><h4 class="sectiontitle">Configuration Scripts</h4><ul><li>DeviceA<pre class="screen"># 
sysname DeviceA  
# 
igmp snooping enable 
# 
bridge-domain 10
 vxlan vni 10
 igmp snooping enable
 igmp snooping router-learning disable
 igmp snooping proxy
# 
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 192.168.2.2 255.255.255.0
# 
interface <span>100GE</span><span>1/0/3</span>
 undo portswitch
 ip address 192.168.3.2 255.255.255.0
#
interface <span>100GE</span><span>1/0/2</span>.1 mode l2
 encapsulation dot1q vid 10
 bridge-domain 10
# 
interface LoopBack0 
 ip address 1.1.1.1 255.255.255.255 
# 
interface Nve1
 source 1.1.1.1
 vni 10 head-end peer-list 2.2.2.2
 vni 10 head-end peer-list 3.3.3.3
# 
ospf 1
 area 0.0.0.0
  network 1.1.1.1 0.0.0.0
  network 192.168.2.0 0.0.0.255
  network 192.168.3.0 0.0.0.255
# 
return</pre>
</li><li><p>DeviceB</p>
<pre class="screen">#
sysname DeviceB
#
igmp snooping enable
# 
bridge-domain 10
 vxlan vni 10
 igmp snooping enable
 igmp snooping proxy
# 
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 192.168.2.1 255.255.255.0
# 
interface <span>100GE</span><span>1/0/2</span>.1 mode l2
 encapsulation dot1q vid 10
 bridge-domain 10
 igmp snooping static-group group-address 225.0.0.0 dot1q vid 10
# 
interface LoopBack0 
  ip address 2.2.2.2 255.255.255.255 
# 
interface Nve1
 source 2.2.2.2
 vni 10 head-end peer-list 1.1.1.1
# 
ospf 1
 area 0.0.0.0
  network 2.2.2.2 0.0.0.0
  network 192.168.2.0 0.0.0.255
# 
return</pre>
</li><li><p>DeviceC</p>
<pre class="screen"># 
sysname DeviceC  
# 
igmp snooping enable 
# 
bridge-domain 10
 vxlan vni 10
 igmp snooping enable
 igmp snooping proxy
# 
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 192.168.3.1 255.255.255.0
# 
interface <span>100GE</span><span>1/0/2</span>.1 mode l2
 encapsulation dot1q vid 10
 bridge-domain 10
 igmp snooping static-group group-address 225.0.0.1 dot1q vid 10
# 
interface LoopBack0 
  ip address 3.3.3.3 255.255.255.255 
# 
 interface Nve1
 source 3.3.3.3
 vni 10 head-end peer-list 1.1.1.1 
# 
ospf 1
 area 0.0.0.0
  network 3.3.3.3 0.0.0.0
  network 192.168.3.0 0.0.0.255
# 
return</pre>
</li></ul>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="vrp_l2mc_over_vxlan_cfg_0015.html">Configuring Static IGMP Snooping over VXLAN
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="vrp_l2mc_over_vxlan_cfg_0020.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>
</body>
</html>