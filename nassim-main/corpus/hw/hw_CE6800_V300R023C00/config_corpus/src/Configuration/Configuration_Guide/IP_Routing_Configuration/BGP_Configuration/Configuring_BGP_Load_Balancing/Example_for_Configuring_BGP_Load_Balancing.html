
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring BGP Load Balancing">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="vrp_bgp_cfg_0065.html">
<meta name="DC.Relation" scheme="URI" content="vrp_bgp_cfg_2105.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing">
<meta name="featuretype" content="IP Routing">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001176743599">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring BGP Load Balancing</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001176743599"></a><a name="EN-US_TASK_0000001176743599"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring BGP Load Balancing</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001176743599__1.3.1"></a><a name="1.3.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0000001176743599__fig_dc_vrp_bgp_cfg_308101">Figure 1</a>, all devices run BGP. DeviceA resides in AS 100. DeviceB and DeviceC reside in AS 300. DeviceD resides in AS 200. EBGP connections are established between DeviceA and DeviceB, between DeviceA and DeviceC, between DeviceD and DeviceB, and between DeviceD and DeviceC. On DeviceA, there are two BGP routes to 172.16.1.0/24. This means that traffic destined for 172.16.1.0/24 can be forwarded through DeviceB and DeviceC. It is required that BGP load balancing be configured to fully utilize network resources and reduce network congestion.</p>
<div class="fignone" id="EN-US_TASK_0000001176743599__fig_dc_vrp_bgp_cfg_308101"><a name="EN-US_TASK_0000001176743599__fig_dc_vrp_bgp_cfg_308101"></a><a name="fig_dc_vrp_bgp_cfg_308101"></a><span class="figcap"><b>Figure 1 </b>Network diagram of configuring BGP load balancing</span><div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface 1, interface 2, and interface 3 represent <span>100GE</span> <span>1/0/1</span>, <span>100GE</span> <span>1/0/2</span>, and <span>100GE</span> <span>1/0/3</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0000001130783986.png"></span></div>
<p>To complete the configuration, you need the following data:</p>
<ul><li><p>Router IDs and AS numbers of DeviceA, DeviceB, DeviceC, and DeviceD</p>
</li><li><p>Number of allowed BGP routes for load balancing</p>
</li></ul>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001176743599__1.3.2"></a><a name="1.3.2"></a>
<div class="p"><h4 class="sectiontitle">Precautions</h4><p>During the configuration, note the following:</p>
<ul><li><p>Route load balancing can be implemented by configuring BGP attributes, for example, configuring the device to ignore the comparison of IGP metrics. Ensure that no routing loops occur when configuring BGP attributes to implement load balancing.</p>
</li><li>To improve security, you are advised to deploy BGP security measures. For details, see "Configuring BGP Authentication." Keychain authentication is used as an example. For details, see Example for Configuring Keychain Authentication for BGP.</li></ul>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001176743599__1.3.3"></a><a name="1.3.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Establish an EBGP connection between DeviceA and DeviceB and between DeviceA and DeviceC.</p>
</li><li><p>Establish an EBGP connection between DeviceD and DeviceB and between DeviceD and DeviceC.</p>
</li><li><p>Configure route load balancing on DeviceA.</p>
</li></ol>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001176743599__1.3.4"></a><a name="1.3.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Assign an IP address to each involved interface. For detailed configurations, see <a href="#EN-US_TASK_0000001176743599__postreq8773112313451">Configuration Scripts</a>.</span></li><li><span>Configure BGP connections.</span><p><p># Configure DeviceA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA]<strong> bgp 100</strong>
[<span class="keyword">*</span>DeviceA-bgp]<strong> router-id 1.1.1.1</strong>
[<span class="keyword">*</span>DeviceA-bgp] <strong>peer 10.1.1.2 as-number 300</strong>
[<span class="keyword">*</span>DeviceA-bgp]<strong> peer 10.1.2.2 as-number 300</strong>
[<span class="keyword">*</span>DeviceA-bgp]<strong> quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>commit</strong></pre>
<p># Configure DeviceB.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB]<strong> bgp 300</strong>
[<span class="keyword">*</span>DeviceB-bgp]<strong> router-id 2.2.2.2</strong>
[<span class="keyword">*</span>DeviceB-bgp] <strong>peer 10.1.1.1 as-number 100</strong>
[<span class="keyword">*</span>DeviceB-bgp] <strong>peer 10.1.3.1 as-number 200</strong>
[<span class="keyword">*</span>DeviceB-bgp] <strong>quit</strong>
[<span class="keyword">*</span>DeviceB] <strong>commit</strong></pre>
<p># Configure DeviceC.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceC]<strong> bgp 300</strong>
[<span class="keyword">*</span>DeviceC-bgp]<strong> router-id 3.3.3.3</strong>
[<span class="keyword">*</span>DeviceC-bgp] <strong>peer 10.1.2.1 as-number 100</strong>
[<span class="keyword">*</span>DeviceC-bgp] <strong>peer 10.1.4.1 as-number 200</strong>
[<span class="keyword">*</span>DeviceC-bgp] <strong>quit</strong>
[<span class="keyword">*</span>DeviceC] <strong>commit</strong></pre>
<p># Configure DeviceD.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceD]<strong> bgp 200</strong>
[<span class="keyword">*</span>DeviceD-bgp]<strong> router-id 4.4.4.4</strong>
[<span class="keyword">*</span>DeviceD-bgp] <strong>peer 10.1.3.2 as-number 300</strong>
[<span class="keyword">*</span>DeviceD-bgp] <strong>peer 10.1.4.2 as-number 300</strong>
[<span class="keyword">*</span>DeviceD-bgp] <strong>ipv4-family unicast</strong>
[<span class="keyword">*</span>DeviceD-bgp-af-ipv4] <strong>network 172.16.1.0 255.255.255.0</strong>
[<span class="keyword">*</span>DeviceD-bgp-af-ipv4] <strong>quit</strong>
[<span class="keyword">*</span>DeviceD-bgp]<strong> quit</strong>
[<span class="keyword">*</span>DeviceD] <strong>commit</strong></pre>
<p># Check the routing table of DeviceA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>display bgp routing-table 172.16.1.0 24</strong>

 BGP local router ID : 1.1.1.1
 Local AS number : 100
 Paths : 2 available, <strong>1 best</strong>, <strong>1 select</strong>
 BGP routing table entry information of 172.16.1.0/24:
 From: 10.1.1.2 (2.2.2.2)
 Route Duration: 0d00h00m50s
 Direct Out-interface:<span>100GE</span><span>1/0/1</span>
 Original nexthop: 10.1.1.2
 Qos information : 0x0
 AS-path 200 300, origin igp, pref-val 0, valid, external, <strong>best</strong>, <strong>select</strong>, pre 255
 Advertised to such 2 peers:
    10.1.1.2
    10.1.2.2

 BGP routing table entry information of 172.16.1.0/24:
 From: 10.1.2.2 (3.3.3.3)
 Route Duration: 0d00h00m51s
 Direct Out-interface: <span>100GE</span><span>1/0/2</span>
 Original nexthop: 10.1.2.2
 Qos information : 0x0
 AS-path 200 300, origin igp, pref-val 0, valid, external, pre 255, not preferred for router ID
 Not advertised to any peers yet</pre>
<p>The command output shows that there are two valid routes from DeviceA to 172.16.1.0/24. The route with the next-hop IP address of 10.1.1.2 is the optimal route because DeviceB's router ID is smaller.</p>
</p></li><li><span>Configure load balancing.</span><p><p># Configure load balancing on DeviceA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>bgp 100</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA-bgp] <strong>ipv4-family unicast</strong>
[<span class="keyword">*</span>DeviceA-bgp-af-ipv4] <strong>maximum load-balancing 2</strong>
[<span class="keyword">*</span>DeviceA-bgp-af-ipv4] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA-bgp] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>commit</strong></pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001176743599__1.3.5"></a><a name="1.3.5"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p># Check the routing table of DeviceA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>display bgp routing-table 172.16.1.0 24</strong>

 BGP local router ID : 1.1.1.1
 Local AS number : 100
 Paths : 2 available, <strong>1 best</strong>, <strong>2 select</strong>
 BGP routing table entry information of 172.16.1.0/24:
 From: 10.1.1.2 (2.2.2.2)
 Route Duration: 0d00h03m55s
 Direct Out-interface: <span>100GE</span><span>1/0/1</span>
 Original nexthop: 10.1.1.2
 Qos information : 0x0
 AS-path 200 300, origin igp, pref-val 0, valid, external, <strong>best</strong>, <strong>select</strong>, pre 255
 Advertised to such 2 peers
    10.1.1.2
    10.1.2.2

 BGP routing table entry information of 172.16.1.0/24:
 From: 10.1.2.2 (3.3.3.3)
 Route Duration: 0d00h03m56s
 Direct Out-interface: <span>100GE</span><span>1/0/2</span>
 Original nexthop: 10.1.2.2
 Qos information : 0x0
 AS-path 200 300, origin igp, pref-val 0, valid, external,<strong> select</strong>, pre 255, not preferred for router ID
 Not advertised to any peers yet</pre>
<p>The preceding command output shows that a BGP route to 172.16.1.0/24 contains two next-hop IP addresses: 10.1.1.2 and 10.1.2.2.</p>
</div>
<div class="postreq"><a name="EN-US_TASK_0000001176743599__postreq8773112313451"></a><a name="postreq8773112313451"></a><a name="EN-US_TASK_0000001176743599__1.3.6"></a><a name="1.3.6"></a><h4 class="sectiontitle">Configuration Scripts</h4><ul><li><p>DeviceA</p>
<pre class="screen">#
sysname DeviceA
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 10.1.1.1 255.255.255.0
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ip address 10.1.2.1 255.255.255.0
#
bgp 100
 router-id 1.1.1.1
 peer 10.1.1.2 as-number 300
 peer 10.1.2.2 as-number 300
 #
 ipv4-family unicast
  maximum load-balancing 2
  peer 10.1.1.2 enable
  peer 10.1.2.2 enable
#
return</pre>
</li><li><p>DeviceB</p>
<pre class="screen">#
sysname DeviceB
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 10.1.1.2 255.255.255.0
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ip address 10.1.3.2 255.255.255.0
#
bgp 300
 router-id 2.2.2.2
 peer 10.1.1.1 as-number 100
 peer 10.1.3.1 as-number 200
 #
 ipv4-family unicast
  peer 10.1.1.1 enable
  peer 10.1.3.1 enable
#
return</pre>
</li><li><p>DeviceC</p>
<pre class="screen">#
sysname DeviceC
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 10.1.4.2 255.255.255.0
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ip address 10.1.2.2 255.255.255.0
#
bgp 300
 router-id 3.3.3.3
 peer 10.1.2.1 as-number 100
 peer 10.1.4.1 as-number 200
 #
 ipv4-family unicast
  peer 10.1.2.1 enable
  peer 10.1.4.1 enable
#
return</pre>
</li><li><p>DeviceD</p>
<pre class="screen">#
sysname DeviceD
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 10.1.4.1 255.255.255.0
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ip address 10.1.3.1 255.255.255.0
#
interface <span>100GE</span><span>1/0/3</span>
 undo portswitch
 ip address 172.16.1.1 255.255.255.0
#
bgp 200
 router-id 4.4.4.4
 peer 10.1.3.2 as-number 300
 peer 10.1.4.2 as-number 300
 #
 ipv4-family unicast
  network 172.16.1.0 255.255.255.0
  peer 10.1.3.2 enable
  peer 10.1.4.2 enable
#
return</pre>
</li></ul>
<p></p>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="vrp_bgp_cfg_0065.html">Configuring BGP Load Balancing
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="vrp_bgp_cfg_2105.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>
</body>
</html>