
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring MQC-based Selective QinQ">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="vrp_vlan_cfg_0061.html">
<meta name="DC.Relation" scheme="URI" content="vrp_vlan_cfg_0069.html">
<meta name="DC.Relation" scheme="URI" content="vrp_vlan_cfg_0071.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="QinQ">
<meta name="featurename" content="VLAN">
<meta name="featuretype" content="Ethernet Switching">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="QinQ">
<meta name="featurename" content="VLAN">
<meta name="featuretype" content="Ethernet Switching">
<meta name="featurename" content="QinQ">
<meta name="featurename" content="VLAN">
<meta name="featurename" content="VLAN Mapping">
<meta name="featurename" content="VLAN Pool">
<meta name="featurename" content="Voice VLAN">
<meta name="featuretype" content="Ethernet Switching">
<meta name="featuretype" content="Ethernet Switching">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001176662417">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring MQC-based Selective QinQ</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001176662417"></a><a name="EN-US_TASK_0000001176662417"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring MQC-based Selective QinQ</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001176662417__1.3.1"></a><a name="1.3.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>In <a href="#EN-US_TASK_0000001176662417__fig10534133734710">Figure 1</a>, PC1 and PC2 connected to DeviceA belong to VLAN 200 and VLAN 300, respectively, whereas PC3 and PC4 connected to DeviceD belong to VLAN 200 and VLAN 300, respectively, whereas PC1 and PC3 are on the same network segment, and PC2 and PC4 are on the same network segment. On the network between DeviceB and DeviceC, VLAN 2 is used for communication between PC1 and PC3, whereas VLAN 3 is used for communication between PC2 and PC4. MQC-based selective QinQ needs to be configured on DeviceB so that PC1 can unidirectionally access PC3 and PC2 can unidirectionally access PC4.</p>
<div class="fignone" id="EN-US_TASK_0000001176662417__fig10534133734710"><a name="EN-US_TASK_0000001176662417__fig10534133734710"></a><a name="fig10534133734710"></a><span class="figcap"><b>Figure 1 </b>Network diagram of configuring MQC-based selective QinQ</span><div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface 1, interface 2, and interface 3 represent <span>100GE</span> <span>1/0/1</span>, <span>100GE</span> <span>1/0/2</span>, and <span>100GE</span> <span>1/0/3</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0000001176742379.png"></span></div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001176662417__1.3.2"></a><a name="1.3.2"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Create VLANs and add interfaces to the VLANs.</span><p><p># Create VLAN 200 and VLAN 300 on DeviceA, add <span>100GE</span> <span>1/0/2</span> to VLAN 200 and <span>100GE</span> <span>1/0/3</span> to VLAN 300, and configure <span>100GE</span> <span>1/0/1</span> to allow packets from VLAN 200 and VLAN 300 to pass through. The configuration of DeviceD is similar to that of DeviceA.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname DeviceA</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>vlan batch 200 300</strong>
[<span class="keyword">*</span>DeviceA] <strong>interface <span>100ge</span> <span>1/0/1</span></strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>portswitch</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>port link-type trunk</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>port trunk allow-pass vlan 200 300</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>interface <span>100ge</span> <span>1/0/2</span></strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/2</span>] <strong>portswitch</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/2</span>] <strong>port link-type access</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/2</span>] <strong>port default vlan 200</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/2</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>interface </strong><strong><span>100ge</span> <span>1/0/3</span></strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/3</span>] <strong>portswitch</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/3</span>] <strong>port link-type access</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/3</span>] <strong>port default vlan 300</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/3</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>commit</strong></pre>
<p># Create VLAN 2 and VLAN 3 on DeviceB so that DeviceB can add an outer VLAN 2 or VLAN 3 tag to packets. Configure <span>100GE</span> <span>1/0/1</span> and <span>100GE</span> <span>1/0/2</span> to allow packets from the two VLANs to pass through.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname DeviceB</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB] <strong>vlan batch 2 3</strong>
[<span class="keyword">*</span>DeviceB] <strong>interface <span>100ge</span> <span>1/0/1</span></strong>
[<span class="keyword">*</span>DeviceB-<span>100GE</span><span>1/0/1</span>] <strong>portswitch</strong>
[<span class="keyword">*</span>DeviceB-<span>100GE</span><span>1/0/1</span>] <strong>port link-type trunk</strong>
[<span class="keyword">*</span>DeviceB-<span>100GE</span><span>1/0/1</span>] <strong>port trunk allow-pass vlan 2 3</strong>
[<span class="keyword">*</span>DeviceB-<span>100GE</span><span>1/0/1</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceB] <strong>interface <span>100ge</span> <span>1/0/2</span></strong>
[<span class="keyword">*</span>DeviceB-<span>100GE</span><span>1/0/2</span>] <strong>portswitch</strong>
[<span class="keyword">*</span>DeviceB-<span>100GE</span><span>1/0/2</span>] <strong>port link-type trunk</strong>
[<span class="keyword">*</span>DeviceB-<span>100GE</span><span>1/0/2</span>] <strong>port trunk allow-pass vlan 2 3</strong>
[<span class="keyword">*</span>DeviceB-<span>100GE</span><span>1/0/2</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceB] <strong>commit</strong></pre>
<p># Create VLAN 2 and VLAN 3 on DeviceC, and configure <span>100GE</span> <span>1/0/1</span> and <span>100GE</span> <span>1/0/2</span> to allow packets from VLAN 2 and VLAN 3 to pass through.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname DeviceC</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceC] <strong>vlan batch 2 3</strong>
[<span class="keyword">*</span>DeviceC] <strong>interface <span>100ge</span> <span>1/0/1</span></strong>
[<span class="keyword">*</span>DeviceC-<span>100GE</span><span>1/0/1</span>] <strong>portswitch</strong>
[<span class="keyword">*</span>DeviceC-<span>100GE</span><span>1/0/1</span>] <strong>port link-type hybrid</strong>
[<span class="keyword">*</span>DeviceC-<span>100GE</span><span>1/0/1</span>] <strong>port </strong><strong>hybrid</strong><strong> untagged vlan 2 3</strong>
[<span class="keyword">*</span>DeviceC-<span>100GE</span><span>1/0/1</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceC] <strong>interface <span>100ge</span> <span>1/0/2</span></strong>
[<span class="keyword">*</span>DeviceC-<span>100GE</span><span>1/0/2</span>] <strong>portswitch</strong>
[<span class="keyword">*</span>DeviceC-<span>100GE</span><span>1/0/2</span>] <strong>port link-type hybrid</strong>
[<span class="keyword">*</span>DeviceC-<span>100GE</span><span>1/0/2</span>] <strong>port hybrid untagged vlan 2 3</strong>
[<span class="keyword">*</span>DeviceC-<span>100GE</span><span>1/0/2</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceC] <strong>commit</strong></pre>
</p></li><li><span>Configure traffic classifiers, traffic behaviors, and traffic policies.</span><p><p># Configure traffic classifiers, traffic behaviors, and a traffic policy on DeviceB to add an outer VLAN 2 tag to the packets sent from VLAN 200 and an outer VLAN 3 tag to the packets sent from VLAN 300.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB] <strong>traffic classifier name1</strong>
[<span class="keyword">*</span>DeviceB-classifier-name1] <strong>if-match vlan 200</strong>
[<span class="keyword">*</span>DeviceB-classifier-name1] <strong>quit</strong>
[<span class="keyword">*</span>DeviceB] <strong>traffic behavior name1</strong>
[<span class="keyword">*</span>DeviceB-behavior-name1] <strong>vlan-stacking vlan 2</strong>
[<span class="keyword">*</span>DeviceB-behavior-name1] <strong>quit</strong>
[<span class="keyword">*</span>DeviceB] <strong>traffic classifier name2</strong>
[<span class="keyword">*</span>DeviceB-classifier-name2] <strong>if-match vlan 300</strong>
[<span class="keyword">*</span>DeviceB-classifier-name2] <strong>quit</strong>
[<span class="keyword">*</span>DeviceB] <strong>traffic behavior name2</strong>
[<span class="keyword">*</span>DeviceB-behavior-name2] <strong>vlan-stacking vlan 3</strong>
[<span class="keyword">*</span>DeviceB-behavior-name2] <strong>quit</strong>
[<span class="keyword">*</span>DeviceB] <strong>traffic policy name1</strong>
[<span class="keyword">*</span>DeviceB-trafficpolicy-name1] <strong>classifier name1 behavior name1</strong>
[<span class="keyword">*</span>DeviceB-trafficpolicy-name1] <strong>classifier name2 behavior name2</strong>
[<span class="keyword">*</span>DeviceB-trafficpolicy-name1] <strong>quit</strong>
[<span class="keyword">*</span>DeviceB] <strong>commit</strong></pre>
</p></li><li><span>Apply the traffic policy to a specified interface.</span><p><p># Apply the traffic policy to <span>100GE</span> <span>1/0/1</span> of DeviceB.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB] <strong>interface <span>100ge</span> <span>1/0/1</span></strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB-<span>100GE</span><span>1/0/1</span>] <strong>traffic-policy name1 inbound</strong>
[<span class="keyword">*</span>DeviceB-<span>100GE</span><span>1/0/1</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceB] <strong>commit</strong></pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001176662417__1.3.3"></a><a name="1.3.3"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p>After the configuration is complete, PC1 can access PC3, and PC2 can access PC4.</p>
</div>
<div class="postreq"><a name="EN-US_TASK_0000001176662417__1.3.4"></a><a name="1.3.4"></a><h4 class="sectiontitle">Configuration Scripts</h4><ul><li>DeviceA<pre class="screen">#
sysname DeviceA
#
vlan batch 200 300
#
interface <span>100GE</span><span>1/0/1</span>
 port link-type trunk
 port trunk allow-pass vlan 200 300
#
interface <span>100GE</span><span>1/0/2</span>
 port default vlan 200
#
interface <span>100GE</span><span>1/0/3</span>
 port default vlan 300
#
return</pre>
</li><li>DeviceB<pre class="screen">#
sysname DeviceB
#
vlan batch 2 to 3
#
traffic classifier name1 type or
 if-match vlan 200
#
traffic classifier name2 type or
 if-match vlan 300
#
traffic behavior name1
 vlan-stacking vlan 2
#
traffic behavior name2
 vlan-stacking vlan 3
#
traffic policy name1
 classifier name1 behavior name1 precedence 5
 classifier name2 behavior name2 precedence 10
#
interface <span>100GE</span><span>1/0/1</span>
 port link-type trunk
 port trunk allow-pass vlan 2 to 3
 traffic-policy name1 inbound
#
interface <span>100GE</span><span>1/0/2</span>
 port link-type trunk
 port trunk allow-pass vlan 2 to 3
#
return</pre>
</li><li>DeviceC<pre class="screen">#
sysname DeviceC
#
vlan batch 2 to 3
#
interface <span>100GE</span><span>1/0/1</span>
 port link-type hybrid
 port hybrid untagged vlan 2 to 3
#
interface <span>100GE</span><span>1/0/2</span>
 port link-type hybrid
 port hybrid untagged vlan 2 to 3
#
return</pre>
</li><li>DeviceD<pre class="screen">#
sysname DeviceD
#
vlan batch 200 300
#
interface <span>100GE</span><span>1/0/1</span>
 port link-type trunk
 port trunk allow-pass vlan 200 300
#
interface <span>100GE</span><span>1/0/2</span>
 port default vlan 200
#
interface <span>100GE</span><span>1/0/3</span>
 port default vlan 300
#
return</pre>
</li></ul>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="vrp_vlan_cfg_0061.html">Configuring QinQ
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="vrp_vlan_cfg_0069.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="vrp_vlan_cfg_0071.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>