
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring BGP MVPN Peer Relationships">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="vrp_ipv4_multi_over_vxlan_cfg_0010.html">
<meta name="DC.Relation" scheme="URI" content="vrp_ipv4_multi_over_vxlan_cfg_0011.html">
<meta name="DC.Relation" scheme="URI" content="vrp_ipv4_multi_over_vxlan_cfg_0013.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="IPv4 Layer 3 Multicast over VXLAN">
<meta name="featuretype" content="IP Multicast">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="IPv4 Layer 3 Multicast over VXLAN">
<meta name="featuretype" content="IP Multicast">
<meta name="featurename" content="IPv4 Layer 3 Multicast over VXLAN">
<meta name="featuretype" content="IP Multicast">
<meta name="featuretype" content="IP Multicast">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001136173408">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>Configuring BGP MVPN Peer Relationships</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001136173408"></a><a name="EN-US_TASK_0000001136173408"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring BGP MVPN Peer Relationships</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001136173408__1.3.1"></a><a name="1.3.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>In an IPv4 Layer 3 multicast over VXLAN scenario, all PEs functioning as VXLAN gateways must establish a BGP MVPN peer relationship between one another.</p>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001136173408__1.3.2"></a><a name="1.3.2"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Enter the system view.</span><p><pre class="screen"><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></pre>
</p></li><li><span>Enter the BGP view.</span><p><pre class="screen"><a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></pre>
</p></li><li><span>Specify a peer PE as a BGP peer.</span><p><pre class="screen"><a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <strong><span>as-number</span></strong> <i><span class="varname">as-number</span></i></pre>
</p></li><li><span>(Optional) Specify the source interface and source address used to establish a TCP connection with the BGP peer.</span><p><pre class="screen"><a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <strong><span>connect-interface</span></strong> <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i> [ <i><span class="varname">ipv4-source-address</span></i> ]</pre>
<p>If loopback interfaces are used to establish a BGP connection, you are advised to run the <a href="cmdqueryname=peer+connect-interface"><b><span class="cmdname">peer connect-interface</span></b></a> command on both ends to ensure proper connectivity. If this command is run on only one end, the BGP connection may fail to be established.</p>
<p>If a physical interface is configured with multiple IP addresses, <i><span class="varname">ipv4-source-address</span></i> must be specified in the command.</p>
</p></li><li><span>(Optional) Set the maximum number of hops allowed over an EBGP connection.</span><p><pre class="screen"><a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <a href="cmdqueryname=ebgp-max-hop"><b><span class="cmdname">ebgp-max-hop</span></b></a> [ <i><span class="varname">hop-count</span></i> ]</pre>
<p>By default, the value of <i><span class="varname">hop-count</span></i> is 255. In inter-AS NG MVPN scenarios, EBGP peer relationships must be established first. In most cases, EBGP peers are directly connected through a physical link. If you want to establish an EBGP peer relationship between indirectly connected peers, run the <a href="cmdqueryname=peer+ebgp-max-hop"><b><span class="cmdname">peer ebgp-max-hop</span></b></a> command to set the maximum number of hops allowed over the TCP connection.</p>
<p>If loopback interfaces are used to establish an EBGP connection, run the <a href="cmdqueryname=peer+ebgp-max-hop"><b><span class="cmdname">peer ebgp-max-hop</span></b></a> command, where the value of <i><span class="varname">hop-count</span></i> must be greater than or equal to 2. Otherwise, the EBGP peer relationship cannot be established.</p>
</p></li><li><span>Enter the BGP-MVPN address family view.</span><p><pre class="screen"><a href="cmdqueryname=ipv4-family"><b><span class="cmdname">ipv4-family</span></b></a> <strong><span>mvpn</span></strong></pre>
</p></li><li><span>Specify the peer device as a BGP MVPN peer.</span><p><pre class="screen"><a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>enable</span></strong></pre>
</p></li><li><span>(Optional) Disable the device from checking whether local A-D routes exist upon receiving C-multicast routes from its BGP MVPN peers.</span><p><pre class="screen"><a href="cmdqueryname=c-multicast+ad-route-ignore"><b><span class="cmdname">c-multicast ad-route-ignore</span></b></a></pre>
</p><p><p>By default, the device checks whether local A-D routes exist when validating C-multicast routes received from its BGP MVPN peers.</p>
<p>If different RD values are configured for the VPN instance IPv4 address families on the M-LAG active-active gateways of an inter-AS VXLAN network, one of the gateways considers received C-multicast routes invalid because the RD value carried in the C-multicast routes is different from that in a local A-D route. As a result, the M-LAG active-active function cannot take effect. To prevent this problem, perform this step on the two active-active gateways.</p>
</p></li><li><span>Commit the configuration.</span><p><pre class="screen" id="EN-US_TASK_0000001136173408__en-us_task_0234857734_screen163801330213"><a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001136173408__en-us_task_0234857734_en-us_concept_0141113565_cmdname1667501373175340">commit</span></b></a></pre>
</p></li></ol></div>
<div class="postreq"><a name="EN-US_TASK_0000001136173408__1.3.3"></a><a name="1.3.3"></a><h4 class="sectiontitle">Follow-up Procedure</h4>
<div class="p"><p>Configure the following BGP functions in the BGP-MVPN address family view as required. For details, see <a href="vrp_bgp_cfg_0001.html">BGP Configuration</a>.</p>
<ol><li><p><a href="vrp_bgp_cfg_0031.html">Configure a BGP peer group</a>.</p>
</li><li><p><a href="vrp_bgp_cfg_0073.html">Configure a BGP RR</a>.</p>
</li><li><p><a href="vrp_bgp_cfg_0090.html">Set a BGP Update timer</a>.</p>
</li><li><p><a href="vrp_bgp_cfg_0027.html">Configure Next_Hop-related functions</a>. Among these functions, the BGP-MVPN address family view supports only the function that allows the device to use its own address as the next-hop address of routes when advertising them.</p>
</li><li><p><a href="vrp_bgp_cfg_0081.html">Configure BGP community attributes</a>. Among these attributes, the BGP-MVPN address family view only supports the configuration that allows the device to advertise standard community attributes to its peers or peer groups.</p>
</li></ol>
</div></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="vrp_ipv4_multi_over_vxlan_cfg_0010.html">Configuring IPv4 Layer 3 Multicast over VXLAN
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="vrp_ipv4_multi_over_vxlan_cfg_0011.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="vrp_ipv4_multi_over_vxlan_cfg_0013.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>