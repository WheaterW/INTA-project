
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring an IPv4 VPN Instance on a PE">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="vrp_L3VPNv4_cfg_1111.html">
<meta name="DC.Relation" scheme="URI" content="vrp_L3VPNv4_cfg_0008.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="IPv4 L3VPN">
<meta name="featuretype" content="VPN">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="IPv4 L3VPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="IPv4 L3VPN">
<meta name="featuretype" content="VPN">
<meta name="featuretype" content="VPN">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001130621674">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>Configuring an IPv4 VPN Instance on a PE</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001130621674"></a><a name="EN-US_TASK_0000001130621674"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring an IPv4 VPN Instance on a PE</h1>
<div class="taskbody"><div class="prereq" style="margin-left:0"><a name="EN-US_TASK_0000001130621674__1.3.1"></a><a name="1.3.1"></a><h4 class="sectiontitle">Prerequisites</h4>
<div class="p"><p>Before configuring an IPv4 VPN instance on a PE, you have completed the following tasks:</p>
<ul><li>Configure link layer protocol parameters for interfaces to ensure that these interfaces work properly.</li></ul>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001130621674__1.3.2"></a><a name="1.3.2"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>A VPN instance is also called a VRF table or a per-site forwarding table.</p>
<p>VPN instances are used to isolate VPN routes from public network routes. Routes of different VPN instances are isolated from one another.</p>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001130621674__1.3.3"></a><a name="1.3.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Enter the system view.</span><p><pre class="screen"><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></pre>
</p></li><li><span>Create a VPN instance and enter the VPN instance view.</span><p><pre class="screen"><a href="cmdqueryname=ip+vpn-instance"><b><span class="cmdname">ip vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i></pre>
<div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The name of a VPN instance is case sensitive. For example, <strong>vpn1</strong> and <strong>VPN1</strong> are considered different VPN instances.</p>
</div></div>
</p></li><li><span>(Optional) Configure a description for the VPN instance.</span><p><pre class="screen"><a href="cmdqueryname=description"><b><span class="cmdname">description</span></b></a> <i><span class="varname">description-information</span></i></pre>
</p></li><li><span>Enable the IPv4 address family for the VPN instance, and enter the VPN instance IPv4 address family view.</span><p><pre class="screen"><a href="cmdqueryname=ipv4-family"><b><span class="cmdname">ipv4-family</span></b></a></pre>
<p>Configurations in a VPN instance can be performed only after an address family is enabled for the VPN instance based on the advertised route and forwarded data type.</p>
</p></li><li><span>Configure an RD for the VPN instance IPv4 address family.</span><p><pre class="screen"><a href="cmdqueryname=route-distinguisher"><b><span class="cmdname">route-distinguisher</span></b></a> <i><span class="varname">route-distinguisher</span></i></pre>
<p>A VPN instance IPv4 address family takes effect only after being configured with an RD. The RDs of different VPN instance IPv4 address families on a PE must be different.</p>
<div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>If you configure an RD for the VPN instance IPv4 address family in the created VPN instance view, the VPN instance IPv4 address family is automatically enabled and the VPN instance IPv4 address family view is automatically displayed.</p>
<p></p>
</div></div>
</p></li><li><span>Configure VPN targets for the VPN instance IPv4 address family.</span><p><pre class="screen"><a href="cmdqueryname=vpn-target"><b><span class="cmdname">vpn-target</span></b></a> <i><span class="varname">vpn-target</span></i> &amp;&lt;1-8&gt; [ <strong><span>both</span></strong> | <strong><span>export-extcommunity</span></strong> | <strong><span>import-extcommunity</span></strong> ]</pre>
<p>VPN targets are a type of BGP extended community attribute and used to control the import and export of VPN routes. You can configure a maximum of eight import VPN targets and eight export VPN targets each time the <a href="cmdqueryname=vpn-target"><b><span class="cmdname">vpn-target</span></b></a> command is run. Run this command multiple times if you want to configure more VPN targets.</p>
</p></li><li><span>(Optional) Configure the maximum number of route prefixes allowed by the VPN instance IPv4 address family.</span><p><pre class="screen"><a href="cmdqueryname=prefix+limit"><b><span class="cmdname">prefix limit</span></b></a><i><span class="varname"> number</span></i> { <i><span class="varname">alert-percent</span></i> [ <strong><span>route-unchanged</span></strong> ] | <strong><span>simply-alert</span></strong> }</pre>
</p><p><div class="p">This configuration prevents a VPN instance IPv4 address family on a PE from receiving too many route prefixes.<div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>After the <a href="cmdqueryname=prefix+limit"><b><span class="cmdname">prefix limit</span></b></a> command is run to increase the allowed maximum number of route prefixes in the VPN instance IPv4 address family or the <a href="cmdqueryname=undo+prefix+limit"><b><span class="cmdname">undo prefix limit</span></b></a> command is run to cancel the limit, the system adds newly received route prefixes of various protocols to the VPN IP routing table.</p>
<p>After the number of route prefixes exceeds the maximum limit, direct and static routes can still be added to the routing table of the VPN instance IPv4 address family.</p>
</div></div>
</div>
</p></li><li><span>(Optional) Configure an import route-policy for the VPN instance IPv4 address family.</span><p><pre class="screen"><a href="cmdqueryname=import+route-policy"><b><span class="cmdname">import route-policy</span></b></a> <i><span class="varname">policy-name</span></i></pre>
<p>In addition to using VPN targets to control VPN route import and export, an import route-policy can be configured to better control VPN route import. An import route-policy can be used to filter routes to be imported into the VPN instance IPv4 address family or modify route attributes.</p>
</p></li><li><span>(Optional) Configure an export route-policy for the VPN instance IPv4 address family.</span><p><pre class="screen"><a href="cmdqueryname=export+route-policy"><b><span class="cmdname">export route-policy</span></b></a> <i><span class="varname">policy-name</span></i><span> [ <strong><span>add-ert-first</span></strong> ]</span></pre>
</p><p><p>In addition to using VPN targets to control VPN route import and export, an export route-policy can be configured to better control VPN route export. An export route-policy can be used to filter routes to be advertised to other PEs or modify route attributes.</p>
<p>By default, export VPN targets are added to VPN routes after these routes are matched against an export route-policy. If the export route-policy contains VPN target-related filtering rules, it cannot apply to VPN routes. To address this issue, configure the <strong><span>add-ert-first</span></strong> parameter. This instructs the device to add export VPN targets to VPN routes before matching these routes against the export route-policy.</p>
</p></li><li><span>Commit the configuration.</span><p><pre class="screen"><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></pre>
</p></li></ol></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="vrp_L3VPNv4_cfg_1111.html">Configuring Mutual Access Between Local IPv4 L3VPNs
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="vrp_L3VPNv4_cfg_0008.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>