
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring ERPSv1">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="vrp_erps_cfg_0010.html">
<meta name="DC.Relation" scheme="URI" content="vrp_erps_cfg_0015.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="ERPS">
<meta name="featuretype" content="Ethernet Switching">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="ERPS">
<meta name="featuretype" content="Ethernet Switching">
<meta name="featurename" content="ERPS">
<meta name="featuretype" content="Ethernet Switching">
<meta name="featuretype" content="Ethernet Switching">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001188671261">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring ERPSv1</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001188671261"></a><a name="EN-US_TASK_0000001188671261"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring ERPSv1</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001188671261__1.3.1"></a><a name="1.3.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>Redundant links are usually used on an Ethernet switched network to provide link backup and improve network reliability. The use of redundant links, however, may cause loops on the switched network, leading to broadcast storms and unstable MAC address entries. As a result, the communication quality deteriorates, and communication services may even be interrupted. ERPS can be configured on devices on a ring network to prevent loops caused by redundant links. As a Layer 2 loop prevention protocol defined by the ITU-T, ERPS provides fast convergence that can meet carrier-class reliability requirements.</p>
<p>In <a href="#EN-US_TASK_0000001188671261__fig7895317249">Figure 1</a>, DeviceA, DeviceB, DeviceC, and DeviceD constitute an ERPS ring.</p>
<div class="fignone" id="EN-US_TASK_0000001188671261__fig7895317249"><a name="EN-US_TASK_0000001188671261__fig7895317249"></a><a name="fig7895317249"></a><span class="figcap"><b>Figure 1 </b>ERPS single-ring networking</span><div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface 1 and interface 2 represent <span>100GE</span><span>1/0/1</span> and <span>100GE</span><span>1/0/2</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0000001142631330.png"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001188671261__1.3.2"></a><a name="1.3.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Set the link type of all ports to be added to an ERPS ring to trunk.</p>
</li><li><p>Create an ERPS ring and configure a control VLAN and an ERP instance.</p>
</li><li><p>Add Layer 2 ports to the ERPS ring and configure port roles.</p>
</li><li><p>Configure the Guard timer and WTR timer for the ERPS ring.</p>
</li><li><p>Configure the Layer 2 forwarding function on DeviceA through DeviceD.</p>
</li></ol>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001188671261__1.3.3"></a><a name="1.3.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Set the link type of all ports to be added to an ERPS ring to trunk.</span><p><p># Configure DeviceA. The configurations of DeviceB, DeviceC, and DeviceD are similar to the configuration of DeviceA. For detailed configurations, see Configuration Scripts.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt;<strong> system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>]<strong> sysname DeviceA</strong>
[<span class="keyword">*</span>DeviceA] <strong>interface <span>100ge</span> <span>1/0/1</span></strong>
[<span class="keyword">*</span>DeviceA-<span><span>100GE</span><span>1/0/1</span></span>]<strong> portswitch</strong>
[<span class="keyword">*</span>DeviceA-<span><span>100GE</span><span>1/0/1</span></span>]<strong> port link-type trunk</strong>
[<span class="keyword">*</span>DeviceA-<span><span><span>100GE</span></span><span>1/0/1</span></span>]<strong> quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>interface </strong><strong><span>100ge</span> <span>1/0/2</span></strong>
[<span class="keyword">*</span>DeviceA-<span><span><span>100GE</span></span><span>1/0/2</span></span>]<strong> portswitch</strong>
[<span class="keyword">*</span>DeviceA-<span><span><span>100GE</span></span><span>1/0/2</span></span>]<strong> port link-type trunk</strong>
[<span class="keyword">*</span>DeviceA-<span><span><span>100GE</span></span><span>1/0/2</span></span>]<strong> quit</strong>
[<span class="keyword">*</span>DeviceA-<span><span><span>100GE</span></span><span>1/0/2</span></span>]<strong> commit</strong></pre>
</p></li><li><span>Create ERPS ring 1 and configure an ERP instance. Set the control VLAN ID of the ERPS ring to 10 and configure ERPS ring 1 to transmit data packets from VLANs 100 to 200.</span><p><p># Configure DeviceA. The configurations of DeviceB, DeviceC, and DeviceD are similar to the configuration of DeviceA. For detailed configurations, see Configuration Scripts.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>stp region-configuration</strong>
[<span class="keyword">*</span>DeviceA-mst-region] <strong>instance 1 vlan 10 100 to 200</strong>
[<span class="keyword">*</span>DeviceA-mst-region] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>erps ring 1</strong>
[<span class="keyword">*</span>DeviceA-erps-ring1] <strong>control-vlan 10</strong>
[<span class="keyword">*</span>DeviceA-erps-ring1] <strong>protected-instance 1</strong>
[<span class="keyword">*</span>DeviceA-erps-ring1] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA-erps-ring1] <strong>commit</strong></pre>
</p></li><li><span>Add Layer 2 ports to the ERPS ring and configure port roles. Configure <span><span>100GE</span><span>1/0/1</span></span> on DeviceB as the RPL owner port.</span><p><p># Configure DeviceA. The configurations of DeviceC and DeviceD are similar to the configuration of DeviceA. For detailed configurations, see Configuration Scripts.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>interface </strong><strong><span>100ge</span> <span>1/0/1</span></strong>
[<span class="keyword">*</span>DeviceA-<span><span><span>100GE</span></span><span>1/0/1</span></span>]<strong> stp disable</strong>
[<span class="keyword">*</span>DeviceA-<span><span><span>100GE</span></span><span>1/0/1</span></span>]<strong> erps ring 1</strong>
[<span class="keyword">*</span>DeviceA-<span><span><span>100GE</span></span><span>1/0/1</span></span>]<strong> quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>interface </strong><strong><span>100ge</span> <span>1/0/2</span></strong>
[<span class="keyword">*</span>DeviceA-<span><span><span>100GE</span></span><span>1/0/2</span></span>]<strong> stp disable</strong>
[<span class="keyword">*</span>DeviceA-<span><span><span>100GE</span></span><span>1/0/2</span></span>]<strong> erps ring 1</strong>
[<span class="keyword">*</span>DeviceA-<span><span><span>100GE</span></span><span>1/0/2</span></span>]<strong> quit</strong>
[<span class="keyword">*</span>DeviceA-<span><span><span>100GE</span></span><span>1/0/2</span></span>]<strong> commit</strong></pre>
<p># Configure DeviceB.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB] <strong>interface </strong><strong><span>100ge</span> <span>1/0/1</span></strong>
[<span class="keyword">*</span>DeviceB-<span><span><span>100GE</span></span><span>1/0/1</span></span>]<strong> stp disable</strong>
[<span class="keyword">*</span>DeviceB-<span><span><span>100GE</span></span><span>1/0/1</span></span>]<strong> erps ring 1 rpl owner</strong>
[<span class="keyword">*</span>DeviceB-<span><span><span>100GE</span></span><span>1/0/1</span></span>]<strong> quit</strong>
[<span class="keyword">*</span>DeviceB] <strong>interface <span>100ge</span> <span>1/0/2</span></strong>
[<span class="keyword">*</span>DeviceB-<span><span><span>100GE</span></span><span>1/0/2</span></span>]<strong> stp disable</strong>
[<span class="keyword">*</span>DeviceB-<span><span><span>100GE</span></span><span>1/0/2</span></span>]<strong> erps ring 1</strong>
[<span class="keyword">*</span>DeviceB-<span><span><span>100GE</span></span><span>1/0/2</span></span>]<strong> quit</strong>
[<span class="keyword">*</span>DeviceB-<span><span><span>100GE</span></span><span>1/0/2</span></span>]<strong> commit</strong></pre>
</p></li><li><span>Configure the Guard timer and WTR timer for the ERPS ring.</span><p><p># Configure DeviceA. The configurations of DeviceB, DeviceC, and DeviceD are similar to the configuration of DeviceA. For detailed configurations, see Configuration Scripts.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>erps ring 1</strong>
[<span class="keyword">*</span>DeviceA-erps-ring1] <strong>wtr-timer 6</strong>
[<span class="keyword">*</span>DeviceA-erps-ring1] <strong>guard-timer 100</strong>
[<span class="keyword">*</span>DeviceA-erps-ring1] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA-erps-ring1] <strong>commit</strong></pre>
</p></li><li><span>Configure the Layer 2 forwarding function on DeviceA through DeviceD.</span><p><p># Configure DeviceA. The configurations of DeviceB, DeviceC, and DeviceD are similar to the configuration of DeviceA. For detailed configurations, see Configuration Scripts.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>vlan batch 100 to 200</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>interface <span>100ge</span> <span>1/0/1</span></strong>
[<span class="keyword">*</span>DeviceA-<span><span><span>100GE</span></span><span>1/0/1</span></span>] <strong>undo port trunk allow-pass vlan 1</strong>
[<span class="keyword">*</span>DeviceA-<span><span><span>100GE</span></span><span>1/0/1</span></span>]<strong> port trunk allow-pass vlan 100 to 200</strong>
[<span class="keyword">*</span>DeviceA-<span><span><span>100GE</span></span><span>1/0/1</span></span>]<strong> quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>interface <span>100ge</span> <span>1/0/2</span></strong>
[<span class="keyword">*</span>DeviceA-<span><span><span>100GE</span></span><span>1/0/2</span></span>]<strong> </strong><strong>undo port trunk allow-pass vlan 1</strong>
[<span class="keyword">*</span>DeviceA-<span><span><span>100GE</span></span><span>1/0/2</span></span>]<strong> port trunk allow-pass vlan 100 to 200 </strong>
[<span class="keyword">*</span>DeviceA-<span><span><span>100GE</span></span><span>1/0/2</span></span>]<strong> quit</strong>
[<span class="keyword">*</span>DeviceA-<span><span><span>100GE</span></span><span>1/0/2</span></span>]<strong> commit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p># After the network becomes stable, run the <a href="cmdqueryname=display+erps"><b><span class="cmdname">display erps</span></b></a> command to check brief information about the ERPS ring and ports added to the ERPS ring. The following example uses the command output on DeviceB.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB] <strong>display erps</strong>
D  : Discarding
F  : Forwarding
R  : RPL Owner
N  : RPL Neighbour
FS : Forced 
MS : Manual Switch
Total number of rings configured = 1
Ring  Control  WTR Timer  Guard Timer  Port 1               Port 2
ID    VLAN     (min)      (csec)
--------------------------------------------------------------------------------
   1       10          6          100  (D,R)<span><span>100GE</span><span>1/0/1</span></span>         (F)<span><span>100GE</span><span>1/0/2</span></span>
--------------------------------------------------------------------------------</pre>
</p><p><p># Run the <a href="cmdqueryname=display+erps+verbose"><b><span class="cmdname">display erps verbose</span></b></a> command to check detailed information about the ERPS ring and ports added to the ERPS ring. The following example uses the command output on DeviceB.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB] <strong>display erps verbose</strong>
Ring ID                             : 1
Description                         : Ring 1
Control Vlan                        : 10
Protected Instance                  : 1 
Service Vlan                        : 100 to 200
WTR Timer Setting (min)             : 6      Running (s)           : <samp class="codeph">0</samp>  
Guard Timer Setting (csec)          : 100    Running (csec)        : 0  
Holdoff Timer Setting (deciseconds) : 0      Running (deciseconds) : 0  
WTB Timer Running (csec)            : 0  
Ring State                          : Idle
RAPS_MEL                            : 7
Revertive Mode                      : Revertive
R-APS Channel Mode                  : -
Version                             : 1
Sub-ring                            : No 
Forced Switch Port                  : -
Manual Switch Port                  : -
TC-Notify                           : -
Time since last topology change     : <samp class="codeph">0</samp> days <samp class="codeph">4</samp>h:<samp class="codeph">12</samp>m:<samp class="codeph">20</samp>s
--------------------------------------------------------------------------------
Port                Port Role     Port Status     Signal Status
--------------------------------------------------------------------------------
<span><span>100GE</span><span>1/0/1</span></span>             RPL Owner     Discarding      Non-failed      
<span><span>100GE</span><span>1/0/2</span></span>             Common        Forwarding      Non-failed</pre>
</p></li></ol></div>
<div class="postreq"><a name="EN-US_TASK_0000001188671261__1.3.4"></a><a name="1.3.4"></a><h4 class="sectiontitle">Configuration Scripts</h4><ul><li><p>DeviceA</p>
<pre class="screen">#
sysname DeviceA
#
vlan batch 100 to 200
#
stp region-configuration
 instance 1 vlan 10 100 to 200
#
erps ring 1
 control-vlan 10
 protected-instance 1
 wtr-timer 6
 guard-timer 100
#
interface <span>100ge</span><strong> </strong><span>1/0/1</span>
 port link-type trunk
 undo port trunk allow-pass vlan 1
 port trunk allow-pass vlan 10 100 to 200 
 stp disable
 erps ring 1
#
interface <span>100ge</span> <span>1/0/2</span>
 port link-type trunk
 undo port trunk allow-pass vlan 1
 port trunk allow-pass vlan 10 100 to 200 
 stp disable
 erps ring 1
#
return</pre>
</li><li><p>DeviceB</p>
<pre class="screen">#
sysname DeviceB
#
vlan batch 100 to 200
#
stp region-configuration
 instance 1 vlan 10 100 to 200
#
erps ring 1
 control-vlan 10
 protected-instance 1
 wtr-timer 6
 guard-timer 100
#
interface <span>100ge</span> <span>1/0/1</span>
 port link-type trunk
 undo port trunk allow-pass vlan 1
 port trunk allow-pass vlan 10 100 to 200 
 stp disable
 erps ring 1
#
interface <span>100ge</span> <span>1/0/2</span>
 port link-type trunk
 undo port trunk allow-pass vlan 1
 port trunk allow-pass vlan 10 100 to 200 
 stp disable
 erps ring 1 rpl owner
#
return</pre>
</li><li><p>DeviceC</p>
<pre class="screen">#
sysname DeviceC
#
vlan batch 100 to 200
#
stp region-configuration
 instance 1 vlan 10 100 to 200
#
erps ring 1
 control-vlan 10
 protected-instance 1
 wtr-timer 6
 guard-timer 100
#
interface <span>100ge</span> <span>1/0/1</span>
 port link-type trunk
 undo port trunk allow-pass vlan 1
 port trunk allow-pass vlan 10 100 to 200 
 stp disable
 erps ring 1
#
interface <span>100ge</span> <span>1/0/2</span>
 port link-type trunk
 undo port trunk allow-pass vlan 1
 port trunk allow-pass vlan 10 100 to 200 
 stp disable
 erps ring 1
#
return</pre>
</li><li><p>DeviceD</p>
<pre class="screen">#
sysname Device<span class="keyword">D</span>
#
vlan batch 100 to 200
#
stp region-configuration
 instance 1 vlan 10 100 to 200
#
erps ring 1
 control-vlan 10
 protected-instance 1
 wtr-timer 6
 guard-timer 100
#
interface <span>100ge</span> <span>1/0/1</span>
 port link-type trunk
 undo port trunk allow-pass vlan 1
 port trunk allow-pass vlan 10 100 to 200 
 stp disable
 erps ring 1
#
interface <span>100ge</span> <span>1/0/2</span>
 port link-type trunk
 undo port trunk allow-pass vlan 1
 port trunk allow-pass vlan 10 100 to 200 
 stp disable
 erps ring 1
#
return</pre>
</li></ul>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="vrp_erps_cfg_0010.html">Configuring ERPSv1
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="vrp_erps_cfg_0015.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>
</body>
</html>