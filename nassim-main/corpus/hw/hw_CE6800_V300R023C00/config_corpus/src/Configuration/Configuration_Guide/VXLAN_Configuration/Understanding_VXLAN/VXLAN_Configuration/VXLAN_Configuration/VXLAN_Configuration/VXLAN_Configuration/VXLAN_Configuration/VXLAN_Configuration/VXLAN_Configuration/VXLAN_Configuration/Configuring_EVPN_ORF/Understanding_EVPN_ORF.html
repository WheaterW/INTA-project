
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="concept">
<meta name="DC.Title" content="Understanding EVPN ORF">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../vrp/dc_vrp_vxlan_cfg_1250.html">
<meta name="DC.Relation" scheme="URI" content="../vrp/dc_vrp_vxlan_cfg_1252.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="VXLAN">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="VXLAN">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="VXLAN">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="VXLAN">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_CONCEPT_0000001550402001">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="../public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="../public_sys-resources/browseVersion.js"></script>
<title>Understanding EVPN ORF</title>
</head>
<body><a name="EN-US_CONCEPT_0000001550402001"></a><a name="EN-US_CONCEPT_0000001550402001"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Understanding EVPN ORF</h1>
<div><div class="section"><h4 class="sectiontitle">Background</h4><p>The growing number of services run over an EVPN has triggered a proliferation of new users. As a result, BGP-EVPN peers on an EVPN are sending vast quantities of EVPN routes to each other. Even if the remote peer does not have an RT-matching EVPN instance, the local PE still sends it EVPN routes. To reduce the pressure on the network, each PE needs to receive only desired routes. However, configuring a separate export route-policy for each user drives up O&amp;M costs significantly. To address this issue, configure EVPN outbound route filtering (ORF) on the network.</p>
</div>
<div class="section"><h4 class="sectiontitle">Implementation</h4><p>After EVPN ORF is configured, each PE on the EVPN sends the import VPN targets (IRTs) and original AS number of the local EVPN instances to the other PEs or BGP EVPN RRs. Upon receipt of such information, which is sent through ORF routes, the peers construct export route-policies based on these routes so that the local PE receives only the desired routes, thereby reducing the receiving pressure on this PE.</p>
<p><a href="#EN-US_CONCEPT_0000001550402001__fig_dc_vrp_evpn_feature_001801">Figure 1</a> shows a basic EVPN on which each device supports EVPN ORF. PE1, PE2, and PE3 establish BGP EVPN peer relationships with the RR and function as its clients. In addition, EVPN instances with specific RTs are configured on each PE.</p>
<p>Before EVPN ORF is enabled, the RR advertises all the routes it receives from PE1's EVPN instances to PE2 and PE3. However, PE2 only needs routes with an export VPN target (ERT) of 1:1, and PE3 only needs routes with an ERT of 2:2. As a result, PE2 and PE3 discard unwanted routes upon receipt, wasting device resources.</p>
<p>After EVPN ORF is enabled on all devices and BGP EVPN peer relationships are established between the PEs and RR in the BGP-VPN-target address family view, the BGP EVPN peers negotiate the EVPN ORF capability. Each device sends the IRTs of its local EVPN instances to the BGP EVPN peers through ORF routes, and then constructs export route policies based on the ORF routes it receives. After receiving the EVPN1, EVPN4, and EVPN5 routes from PE1, the RR advertises only those with the ERT of 1:1 to PE2 and only those with the ERT of 2:2 to PE3.</p>
<div class="fignone" id="EN-US_CONCEPT_0000001550402001__fig_dc_vrp_evpn_feature_001801"><a name="EN-US_CONCEPT_0000001550402001__fig_dc_vrp_evpn_feature_001801"></a><a name="fig_dc_vrp_evpn_feature_001801"></a><span class="figcap"><b>Figure 1 </b>Basic usage scenario of EVPN ORF</span><br><span><img src="images/fig_dc_vrp_evpn_feature_001801.png"></span></div>
<p>The BGP-VPN-target address family obtains the IRT configured on the local device regardless of the type of the instance that the IRT comes from. If EVPN ORF is enabled on a network where some devices do not support it, the EVPN service may not run properly. However, the BGP-VPN-target address family can resolve this problem.</p>
<p>On the network shown in <a href="#EN-US_CONCEPT_0000001550402001__fig_dc_vrp_evpn_feature_001801">Figure 1</a>, PE1, PE2, and PE3 establish BGP EVPN peer relationships with the RR and function as its clients. Suppose that PE1, PE2, and the RR all support EVPN ORF but that PE3 does not, as it runs an earlier version. If EVPN ORF is enabled on the network and the BGP-VPN-target peer relationships are established, PE3 does not send ORF routes to the RR, meaning that PE1 does not receive the ORF routes with an ERT of 2:2 from the RR. As a result, the RR does not advertise the route with the ERT being 2:2 to PE3, affecting services between EVPN4 and EVPN2. Because the BGP-VPN-target address family does not differentiate the type of instance the IRT belongs to, you can configure an L3VPN instance on PE3 and set both the IRT and ERT to 2:2. This configuration allows PE3 to advertise an ORF route with an IRT of 2:2 to the RR, which then advertises the route to PE1. Upon receipt, PE1 modifies its export route-policy so that the RR can advertise the route with the ERT being 2:2 to PE3.</p>
<div class="note"><img src="../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>For the preceding scenario, instead of configuring an L3VPN instance, you can configure the RR to advertise default ORF routes to PE1 and PE3, and then you can delete the BGP-VPN-target peer relationship between the RR and PE3. After the configuration is complete, PE1, PE2, and PE3 advertise all routes to the RR. The RR then advertises routes with ERTs of 1:1 and 2:2 to PE1, routes with an ERT of 1:1 to PE2, and all routes to PE3.</p>
</div></div>
<p>If both EVPN and L3VPN services are deployed on the preceding network, the preceding two configuration approaches cannot be used because the L3VPN service will not run properly. On the network shown in <a href="#EN-US_CONCEPT_0000001550402001__fig_dc_vrp_evpn_feature_001802">Figure 2</a>, only PE3 does not support EVPN ORF. In this case, after EVPN ORF is enabled on the network, the EVPN service cannot run properly. If an L3VPN instance is created, this instance receives the other PEs' L3VPN routes from the RR, which compromises the L3VPN service. To resolve this issue, you can disable the RR from filtering routes based on the IRT for PE3, thereby ensuring that both EVPN and L3VPN services can run properly.</p>
<div class="fignone" id="EN-US_CONCEPT_0000001550402001__fig_dc_vrp_evpn_feature_001802"><a name="EN-US_CONCEPT_0000001550402001__fig_dc_vrp_evpn_feature_001802"></a><a name="fig_dc_vrp_evpn_feature_001802"></a><span class="figcap"><b>Figure 2 </b>An EVPN ORF network carrying both EVPN and L3VPN services</span><br><span><img src="images/fig_dc_vrp_evpn_feature_001802.png"></span></div>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../vrp/dc_vrp_vxlan_cfg_1250.html">Configuring EVPN ORF
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../vrp/dc_vrp_vxlan_cfg_1252.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>