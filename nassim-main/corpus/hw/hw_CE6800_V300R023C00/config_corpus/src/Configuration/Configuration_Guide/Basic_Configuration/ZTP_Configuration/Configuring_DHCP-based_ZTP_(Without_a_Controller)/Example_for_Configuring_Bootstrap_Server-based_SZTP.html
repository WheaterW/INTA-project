
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Bootstrap Server-based SZTP">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="galaxy_ztp_cfg_0029.html">
<meta name="DC.Relation" scheme="URI" content="galaxy_ztp_cfg_0138.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="ZTP">
<meta name="featuretype" content="Basic Configuration">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="ZTP">
<meta name="featuretype" content="Basic Configuration">
<meta name="featurename" content="ZTP">
<meta name="featuretype" content="Basic Configuration">
<meta name="featurename" content="ZTP">
<meta name="featuretype" content="Basic Configuration">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001513034414">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring Bootstrap Server-based SZTP</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001513034414"></a><a name="EN-US_TASK_0000001513034414"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Bootstrap Server-based SZTP</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001513034414__1.3.1"></a><a name="1.3.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>In <a href="#EN-US_TASK_0000001513034414__fig188710432124">Figure 1</a>, DeviceA and DeviceB are two unconfigured devices on the network, and both are connected to DeviceC, which functions as the egress gateway of DeviceA and DeviceB. There are reachable routes between DeviceC and the DHCP server, and between DeviceC and the file server.</p>
<p>The customer requires that DeviceA and DeviceB automatically load the system software and configuration files in SZTP mode after they are powered on.</p>
<div class="p"><a href="#EN-US_TASK_0000001513034414__table2075911554408">Table 1</a> lists information about DeviceA and DeviceB, and the files to be loaded to them.
<div class="tableBorder"><a name="EN-US_TASK_0000001513034414__table2075911554408"></a><a name="table2075911554408"></a><table cellpadding="4" cellspacing="0" summary="" id="EN-US_TASK_0000001513034414__table2075911554408" frame="border" border="1" rules="all"><caption><b>Table 1 </b>Device information and files to be loaded</caption><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="32.11%" id="mcps1.3.1.4.2.2.3.1.1" liSelected="liSelected"><p>New Device</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="67.89%" id="mcps1.3.1.4.2.2.3.1.2" liSelected="liSelected"><p>Files to Be Loaded</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" valign="top" width="32.11%" headers="mcps1.3.1.4.2.2.3.1.1 "><p>DeviceA</p>
</td>
<td class="cellrowborder" valign="top" width="67.89%" headers="mcps1.3.1.4.2.2.3.1.2 "><ul><li><p>System software: software_file.cc</p>
</li><li><p>Configuration file: conf_file1.cfg</p>
</li></ul>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="32.11%" headers="mcps1.3.1.4.2.2.3.1.1 "><p>DeviceB</p>
</td>
<td class="cellrowborder" valign="top" width="67.89%" headers="mcps1.3.1.4.2.2.3.1.2 "><ul><li><p>System software: software_file.cc</p>
</li><li><p>Configuration file: conf_file2.cfg</p>
</li></ul>
</td>
</tr>
</tbody>
</table>
</div>
<div class="fignone" id="EN-US_TASK_0000001513034414__fig188710432124"><a name="EN-US_TASK_0000001513034414__fig188710432124"></a><a name="fig188710432124"></a><span class="figcap"><b>Figure 1 </b>Network diagram of SZTP</span><div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface1, interface2, and interface3 represent <span>100GE</span><span>1/0/1</span>, <span>100GE</span><span>1/0/2</span>, and <span>100GE</span><span>1/0/3</span>, respectively.</p>
</div></div>
<br><span><img src="figure/en-us_image_0000001563994697.png"></span></div>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001513034414__1.3.2"></a><a name="1.3.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li>Configure the DHCP server.</li><li>Configure the DHCP relay agent.</li><li>Configure the bootstrap server.</li><li>Configure the HTTPS deployment file server.</li><li>Power on DeviceA and DeviceB to start the SZTP process.</li></ol>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001513034414__1.3.3"></a><a name="1.3.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure the DHCP server.</span><p><p># Configure the IP address pool that the DHCP server uses to allocate IP addresses to DeviceA and DeviceB and set DHCP options by referring to <a href="#EN-US_TASK_0000001513034414__table1812243855410">Table 2</a>. In this example, a Huawei device is used as the DHCP server.</p>

<div class="tableBorder"><a name="EN-US_TASK_0000001513034414__table1812243855410"></a><a name="table1812243855410"></a><table cellpadding="4" cellspacing="0" summary="" id="EN-US_TASK_0000001513034414__table1812243855410" frame="border" border="1" rules="all"><caption><b>Table 2 </b>DHCP server options</caption><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="33.33333333333333%" id="mcps1.3.3.1.2.2.2.4.1.1" liSelected="liSelected"><p>Option</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="33.33333333333333%" id="mcps1.3.3.1.2.2.2.4.1.2" liSelected="liSelected"><p>Description</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="33.33333333333333%" id="mcps1.3.3.1.2.2.2.4.1.3" liSelected="liSelected"><p>Value</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.3.1.2.2.2.4.1.1 "><p>Option 1</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.3.1.2.2.2.4.1.2 "><p>Subnet mask of an IP address</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.3.1.2.2.2.4.1.3 "><p>255.255.255.0</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.3.1.2.2.2.4.1.1 "><p>Option 3</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.3.1.2.2.2.4.1.2 "><p>Egress gateway of a DHCP client</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.3.1.2.2.2.4.1.3 "><p>10.1.1.1</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.3.1.2.2.2.4.1.1 "><p>Option 143</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.3.1.2.2.2.4.1.2 "><p>IP address of a bootstrap server</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.3.1.2.2.2.4.1.3 "><p>10.1.4.2</p>
</td>
</tr>
</tbody>
</table>
</div>
<pre class="screen">&lt;HUAWEI&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>HUAWEI] <strong>sysname dhcp_server</strong>
[<span class="keyword">*</span>HUAWEI] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>dhcp_server] <strong>dhcp enable</strong>
[<span class="keyword">*</span>dhcp_server] <strong>ip pool pool1</strong>
[<span class="keyword">*</span>dhcp_server-ip-pool-pool1] <strong>gateway-list 10.1.1.1</strong>
[<span class="keyword">*</span>dhcp_server-ip-pool-pool1] <strong>network 10.1.1.0 mask 255.255.255.0</strong>
[<span class="keyword">*</span>dhcp_server-ip-pool-pool1] <strong>option 143 hex 001268747470733a2f2f31302e312e342e323a31</strong>
[<span class="keyword">*</span>dhcp_server-ip-pool-pool1] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>dhcp_server] <strong>vlan batch 10</strong>
[<span class="keyword">*</span>dhcp_server] <strong>interface </strong><strong><span>100ge</span> <span>1/0/3</span></strong>
[<span class="keyword">*</span>dhcp_server-<span>100GE</span><span>1/0/3</span>] <strong>portswitch</strong>
[<span class="keyword">*</span>dhcp_server-<span>100GE</span><span>1/0/3</span>] <strong>port link-type trunk</strong>
[<span class="keyword">*</span>dhcp_server-<span>100GE</span><span>1/0/3</span>] <strong>port trunk allow-pass vlan 10</strong>
[<span class="keyword">*</span>dhcp_server-<span>100GE</span><span>1/0/3</span>] <strong>quit</strong>
[<span class="keyword">*</span>dhcp_server] <strong>interface vlanif 10</strong>
[<span class="keyword">*</span>dhcp_server-Vlanif10] <strong>ip address 10.1.2.2 24</strong>
[<span class="keyword">*</span>dhcp_server-Vlanif10] <strong>quit</strong>
[<span class="keyword">*</span>dhcp_server] <strong>commit</strong></pre>
</p></li><li><span>Configure the DHCP relay agent.</span><p><p># Configure the DHCP relay function on DeviceC. Set the IP address of the interface connecting DeviceC to DeviceA and DeviceB to 10.1.1.1 to configure DeviceC as the default gateway of DeviceA and DeviceB.</p>
<pre class="screen">&lt;HUAWEI&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname</strong> <strong>DeviceC</strong>
[<span class="keyword">*</span>HUAWEI] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceC] <strong>vlan batch 10</strong>
[<span class="keyword">*</span>DeviceC] <strong>interface </strong><strong><span>100ge</span> <span>1/0/1</span></strong>
[<span class="keyword">*</span>DeviceC-<span>100GE</span><span>1/0/1</span>] <strong>portswitch</strong>
[<span class="keyword">*</span>DeviceC-<span>100GE</span><span>1/0/1</span>] <strong>port link-type trunk</strong>
[<span class="keyword">*</span>DeviceC-<span>100GE</span><span>1/0/1</span>] <strong>port trunk allow-pass vlan 10</strong>
[<span class="keyword">*</span>DeviceC-<span>100GE</span><span>1/0/1</span>] <strong>port trunk pvid vlan 10</strong>
[<span class="keyword">*</span>DeviceC-<span>100GE</span><span>1/0/1</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceC] <strong>interface </strong><strong><span>100ge</span> <span>1/0/2</span></strong>
[<span class="keyword">*</span>DeviceC-<span>100GE</span><span>1/0/2</span>] <strong>portswitch </strong>
[<span class="keyword">*</span>DeviceC-<span>100GE</span><span>1/0/2</span>] <strong>port link-type trunk</strong>
[<span class="keyword">*</span>DeviceC-<span>100GE</span><span>1/0/2</span>] <strong>port trunk allow-pass vlan 10</strong>
[<span class="keyword">*</span>DeviceC-<span>100GE</span><span>1/0/2</span>] <strong>port trunk pvid vlan 10</strong>
[<span class="keyword">*</span>DeviceC-<span>100GE</span><span>1/0/2</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceC] <strong>interface vlanif 10</strong>
[<span class="keyword">*</span>DeviceC-Vlanif10] <strong>ip address 10.1.1.1 24</strong>
[<span class="keyword">*</span>DeviceC-Vlanif10] <strong>quit</strong>
[<span class="keyword">*</span>DeviceC] <strong>dhcp enable</strong>
[<span class="keyword">*</span>DeviceC] <strong>interface vlanif 10</strong>
[<span class="keyword">*</span>DeviceC-Vlanif10] <strong>dhcp select relay</strong>
[<span class="keyword">*</span>DeviceC-Vlanif10] <strong>dhcp relay server-ip 10.1.2.2</strong>
[<span class="keyword">*</span>DeviceC-Vlanif10] <strong>commit</strong></pre>
</p></li><li><span>Configure the bootstrap server.</span><p><p># Huawei devices do not support the bootstrap server function. In the SZTP networking, a third-party server needs to be deployed. For details about how to configure a third-party server, see the third-party server operation guide.</p>
<p># Huawei level-2 CA certificate, ownership voucher, and owner certificate need to be built in the bootstrap server.</p>
<p># On the bootstrap server, set the IP address of the HTTPS file server to 10.1.3.2, and set the deployment files, configuration files, and their paths for DeviceA and DeviceB.</p>
</p></li><li><span>Configure the HTTPS deployment file server.</span><p><p># Huawei devices do not support the HTTPS server function. In the SZTP networking, a third-party server needs to be deployed. For details about how to configure a third-party server, see the third-party server operation guide.</p>
<p># After configuring the file server, save the deployment files and configuration files to be loaded to devices to the paths specified on the bootstrap server.</p>
</p></li><li><span>Power on DeviceA and DeviceB to start the SZTP process.</span></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001513034414__1.3.4"></a><a name="1.3.4"></a><h4 class="sectiontitle">Verifying the Configuration</h4><div class="p"># The devices complete the SZTP process in about 15 minutes after they are powered on. Log in to the devices and run the <strong>display startup</strong> command to check whether the current system software and configuration files are the required ones. The following shows the command output of DeviceA.<pre class="screen">&lt;DeviceA&gt; <strong>display startup</strong>
MainBoard:                                                                      
  Configured startup system software:        flash:/software_file.cc   
  Startup system software:                   flash:/software_file.cc   
  Next startup system software:              flash:/software_file.cc   
  Startup saved-configuration file:          flash:/conf_file1.cfg
  Next startup saved-configuration file:     flash:/conf_file1.cfg
  Startup paf file:                          default                            
  Next startup paf file:                     default                            
  Startup patch package:                     NULL                               
  Next startup patch package:                NULL                               
  Startup feature software:                  NULL                               
  Next startup feature software:             NULL   </pre>
</div>
</div>
<div class="postreq"><a name="EN-US_TASK_0000001513034414__1.3.5"></a><a name="1.3.5"></a><h4 class="sectiontitle">Configuration Scripts</h4><ul><li>DeviceC<pre class="screen">#
sysname DeviceC
#
vlan batch 10
#
dhcp enable
#
interface Vlanif10
 ip address 10.1.1.1 255.255.255.0
 dhcp select relay
 dhcp relay server-ip 10.1.2.2
#
interface <span>100GE</span><span>1/0/1</span>
 port link-type trunk
 port trunk pvid vlan 10
 port trunk allow-pass vlan 10
#
interface <span>100GE</span><span>1/0/2</span>
 port link-type trunk
 port trunk pvid vlan 10
 port trunk allow-pass vlan 10
#
return</pre>
</li><li>DHCP server<pre class="screen">#
sysname dhcp_server
#
dhcp enable
#
vlan batch 10
#
ip pool pool1
 gateway-list 10.1.1.1
 network 10.1.1.0 mask 255.255.255.0
 option 143 hex 001268747470733a2f2f31302e312e342e323a31
#
interface Vlanif10
  ip address 10.1.2.2 255.255.255.0
#
interface <span>100GE</span><span>1/0/3</span>
 port link-type trunk
 port trunk allow-pass vlan 10
#
return</pre>
</li></ul>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="galaxy_ztp_cfg_0029.html">Configuring DHCP-based ZTP (Without a Controller)
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="galaxy_ztp_cfg_0138.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>
</body>
</html>