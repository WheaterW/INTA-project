
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring an IPv4 over IPv4 GRE Tunnel">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="vrp_gre_cfg_0006.html">
<meta name="DC.Relation" scheme="URI" content="vrp_gre_cfg_0011.html">
<meta name="DC.Relation" scheme="URI" content="vrp_gre_cfg_0017.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="GRE">
<meta name="featuretype" content="VPN">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="GRE">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="GRE">
<meta name="featuretype" content="VPN">
<meta name="featuretype" content="VPN">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001176742273">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring an IPv4 over IPv4 GRE Tunnel</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001176742273"></a><a name="EN-US_TASK_0000001176742273"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring an IPv4 over IPv4 GRE Tunnel</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001176742273__1.3.1"></a><a name="1.3.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>In <a href="#EN-US_TASK_0000001176742273__fig_dc_vrp_gre_cfg_203101">Figure 1</a>, DeviceA, DeviceB, and DeviceC belong to the IPv4 backbone network and are running OSPF. A direct link needs to be established between DeviceA and DeviceC to ensure that PC1 and PC2 can communicate with each other. To meet such a requirement, a GRE tunnel needs to be established between DeviceA and DeviceC and static routes need to be configured so that packets between PC1 and PC2 can be forwarded through tunnel interfaces on both ends of the tunnel. DeviceA and DeviceC are the default gateways of PC1 and PC2, respectively.</p>
<div class="fignone" id="EN-US_TASK_0000001176742273__fig_dc_vrp_gre_cfg_203101"><a name="EN-US_TASK_0000001176742273__fig_dc_vrp_gre_cfg_203101"></a><a name="fig_dc_vrp_gre_cfg_203101"></a><span class="figcap"><b>Figure 1 </b>Configuring an IPv4 over IPv4 GRE tunnel</span><div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface 1 and interface 2 represent <span>100GE</span> <span>1/0/1</span> and <span>100GE</span> <span>1/0/2</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0000001176742289.png"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001176742273__1.3.2"></a><a name="1.3.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure an IPv4 dynamic routing protocol for communication between the devices.</p>
</li><li><p>Create tunnel interfaces on DeviceA and DeviceC and specify the tunnel source and destination addresses. The tunnel source address is the IP address of the interface that sends packets, and the tunnel destination address is the IP address of the interface that receives packets.</p>
</li><li><p>Configure IP addresses for the tunnel interfaces to generate tunnel routes.</p>
</li><li><p>Configure a static route between DeviceA and PC1 and between DeviceC and PC2 and specify the local tunnel interface as the outbound interface of the static route so that traffic between PC1 and PC2 can be transmitted through the GRE tunnel.</p>
</li></ol>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001176742273__1.3.3"></a><a name="1.3.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure IP addresses for interfaces.</span><p><p>Configure an IP address for each interface according to <a href="#EN-US_TASK_0000001176742273__fig_dc_vrp_gre_cfg_203101">Figure 1</a>. For detailed configurations, see <a href="#EN-US_TASK_0000001176742273__postreq9126101612412">Configuration Scripts</a>.</p>
</p></li><li><span>Configure an IGP on the VPN backbone network.</span><p><p># Configure DeviceA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>ospf 1</strong>
[<span class="keyword">*</span>DeviceA-ospf-1] <strong>area 0</strong>
[<span class="keyword">*</span>DeviceA-ospf-1-area-0.0.0.0] <strong>network 172.20.1.0 0.0.0.255</strong>
[<span class="keyword">*</span>DeviceA-ospf-1-area-0.0.0.0] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA-ospf-1] <strong>quit</strong>
<span>[<span class="keyword">*</span>DeviceA] <strong>commit</strong></span></pre>
<p># Configure DeviceB.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB] <strong>ospf 1</strong>
[<span class="keyword">*</span>DeviceB-ospf-1] <strong>area 0</strong>
[<span class="keyword">*</span>DeviceB-ospf-1-area-0.0.0.0] <strong>network 172.20.1.0 0.0.0.255</strong>
[<span class="keyword">*</span>DeviceB-ospf-1-area-0.0.0.0] <strong>network 172.21.1.0 0.0.0.255</strong>
[<span class="keyword">*</span>DeviceB-ospf-1-area-0.0.0.0] <strong>quit</strong>
[<span class="keyword">*</span>DeviceB-ospf-1] <strong>quit</strong>
<span>[<span class="keyword">*</span>DeviceB] <strong>commit</strong></span></pre>
<p># Configure DeviceC.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceC] <strong>ospf 1</strong>
[<span class="keyword">*</span>DeviceC-ospf-1] <strong>area 0</strong>
[<span class="keyword">*</span>DeviceC-ospf-1-area-0.0.0.0] <strong>network 172.21.1.0 0.0.0.255</strong>
[<span class="keyword">*</span>DeviceC-ospf-1-area-0.0.0.0] <strong>quit</strong>
[<span class="keyword">*</span>DeviceC-ospf-1] <strong>quit</strong>
<span>[<span class="keyword">*</span>DeviceC] <strong>commit</strong></span></pre>
<p>After the configuration is complete, run the <strong>display ip routing-table</strong> command on DeviceA and DeviceC. The command outputs show that DeviceA and DeviceC can learn the OSPF route to the network segment of the remote interface.</p>
<p># The following example uses the command output on DeviceA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA]<strong> display ip routing-table</strong>
Proto: Protocol        Pre: Preference
<span class="keyword">Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route</span>
------------------------------------------------------------------------------
Routing Table : _public_
         Destinations : 11       Routes : 11

Destination/Mask    Proto   Pre  Cost        Flags NextHop         Interface

       10.1.1.0/24  Direct  0    0             D  10.1.1.2        <span>100GE</span><span>1/0/2</span>
       10.1.1.2/32  Direct  0    0             D  127.0.0.1       <span>100GE</span><span>1/0/2</span>
     10.1.1.255/32  Direct  0    0             D  127.0.0.1       <span>100GE</span><span>1/0/2</span>
     172.20.1.0/24  Direct  0    0             D  172.20.1.1      <span>100GE</span><span>1/0/1</span>
     172.20.1.1/32  Direct  0    0             D  127.0.0.1       <span>100GE</span><span>1/0/1</span>
   172.20.1.255/32  Direct  0    0             D  127.0.0.1       <span>100GE</span><span>1/0/1</span>
     172.21.1.0/24  OSPF    10   2             D  172.20.1.2      <span>100GE</span><span>1/0/1</span>
      127.0.0.0/8   Direct  0    0             D  127.0.0.1       InLoopBack0
      127.0.0.1/32  Direct  0    0             D  127.0.0.1       InLoopBack0
127.255.255.255/32  Direct  0    0             D  127.0.0.1       InLoopBack0
255.255.255.255/32  Direct  0    0             D  127.0.0.1       InLoopBack0</pre>
</p></li><li><span>Configure tunnel interfaces.</span><p><p># Configure DeviceA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA]<strong> interface tunnel 1</strong>
[<span class="keyword">*</span>DeviceA-Tunnel1]<strong> tunnel-protocol gre</strong>
[<span class="keyword">*</span>DeviceA-Tunnel1]<strong> ip address 172.22.1.1 255.255.255.0</strong>
[<span class="keyword">*</span>DeviceA-Tunnel1]<strong> source 172.20.1.1</strong>
[<span class="keyword">*</span>DeviceA-Tunnel1]<strong> destination 172.21.1.2</strong>
[<span class="keyword">*</span>DeviceA-Tunnel1]<strong> quit</strong>
<span>[<span class="keyword">*</span>DeviceA] <strong>commit</strong></span></pre>
<p># Configure DeviceC.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceC]<strong> interface tunnel 1</strong>
[<span class="keyword">*</span>DeviceC-Tunnel1]<strong> tunnel-protocol gre</strong>
[<span class="keyword">*</span>DeviceC-Tunnel1]<strong> ip address 172.22.1.2 255.255.255.0</strong>
[<span class="keyword">*</span>DeviceC-Tunnel1]<strong> source 172.21.1.2</strong>
[<span class="keyword">*</span>DeviceC-Tunnel1]<strong> destination 172.20.1.1</strong>
[<span class="keyword">*</span>DeviceC-Tunnel1]<strong> quit</strong>
<span>[<span class="keyword">*</span>DeviceC] <strong>commit</strong></span></pre>
<p>After the configuration is complete, the status of tunnel interfaces becomes up and the tunnel interfaces can ping each other successfully.</p>
<p># The following example uses the command output on DeviceA.</p>
<pre class="screen">
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA]<strong> ping -a 172.22.1.1 172.22.1.2</strong>
  PING 172.22.1.2: 56  data bytes, press CTRL_C to break
    Reply from 172.22.1.2: bytes=56 Sequence=1 ttl=255 time=24 ms
    Reply from 172.22.1.2: bytes=56 Sequence=2 ttl=255 time=33 ms
    Reply from 172.22.1.2: bytes=56 Sequence=3 ttl=255 time=48 ms
    Reply from 172.22.1.2: bytes=56 Sequence=4 ttl=255 time=33 ms
    Reply from 172.22.1.2: bytes=56 Sequence=5 ttl=255 time=36 ms
  --- 172.22.1.2 ping statistics ---
    5 packet(s) transmitted
    5 packet(s) received
    0.00% packet loss
    round-trip min/avg/max = 24/34/48 ms</pre>
</p></li><li><span>Configure static routes.</span><p><p># Configure DeviceA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA]<strong> ip route-static 10.2.1.0 255.255.255.0 tunnel1</strong>
<span>[<span class="keyword">*</span>DeviceA] <strong>commit</strong></span></pre>
<p># Configure DeviceC.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceC]<strong> ip route-static 10.1.1.0 255.255.255.0 tunnel1</strong>
<span>[<span class="keyword">*</span>DeviceC] <strong>commit</strong></span></pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001176742273__1.3.4"></a><a name="1.3.4"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p>After the configuration is complete, run the <strong>display</strong> <strong>ip routing-table</strong> command on DeviceA and DeviceC. The command outputs show the static route with the local tunnel interface as the outbound interface and destined for the network segment of the remote end.</p>
<p># The following example uses the command output on DeviceA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA]<strong> display ip routing-table</strong>
Proto: Protocol        Pre: Preference
Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route
------------------------------------------------------------------------------
Routing Table : _public_
         Destinations : 15       Routes : 15

Destination/Mask    Proto   Pre  Cost        Flags NextHop         Interface

       10.1.1.0/24  Direct  0    0             D  10.1.1.2        <span>100GE</span><span>1/0/2</span>
       10.1.1.2/32  Direct  0    0             D  127.0.0.1       <span>100GE</span><span>1/0/2</span>
     10.1.1.255/32  Direct  0    0             D  127.0.0.1       <span>100GE</span><span>1/0/2</span>
    <strong>10.2.1.0/24</strong>  <strong>Static</strong>  <strong>60</strong>   <strong>0</strong>           <strong>D</strong> <strong> 172.22.1.1</strong>       <strong>Tunnel1</strong>
     172.20.1.0/24  Direct  0    0             D  172.20.1.1      <span>100GE</span><span>1/0/1</span>
     172.20.1.1/32  Direct  0    0             D  127.0.0.1       <span>100GE</span><span>1/0/1</span>
   172.20.1.255/32  Direct  0    0             D  127.0.0.1       <span>100GE</span><span>1/0/1</span>
     172.21.1.0/24  OSPF    10   2             D  172.20.1.2      <span>100GE</span><span>1/0/1</span>
     172.22.1.0/24  Direct  0    0             D  172.22.1.1      Tunnel1
     172.22.1.1/32  Direct  0    0             D  127.0.0.1       Tunnel1
   172.22.1.255/32  Direct  0    0             D  127.0.0.1       Tunnel1
      127.0.0.0/8   Direct  0    0             D  127.0.0.1       InLoopBack0
      127.0.0.1/32  Direct  0    0             D  127.0.0.1       InLoopBack0
127.255.255.255/32  Direct  0    0             D  127.0.0.1       InLoopBack0
255.255.255.255/32  Direct  0    0             D  127.0.0.1       InLoopBack0</pre>
</div>
<div class="postreq"><a name="EN-US_TASK_0000001176742273__postreq9126101612412"></a><a name="postreq9126101612412"></a><a name="EN-US_TASK_0000001176742273__1.3.5"></a><a name="1.3.5"></a><h4 class="sectiontitle">Configuration Scripts</h4><ul><li><p>DeviceA</p>
<pre class="screen">#
sysname DeviceA
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 172.20.1.1 255.255.255.0
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ip address 10.1.1.2 255.255.255.0
#
interface Tunnel1
 ip address 172.22.1.1 255.255.255.0
 tunnel-protocol gre
 source 172.20.1.1
 destination 172.21.1.2
#
ospf 1
 area 0.0.0.0
  network 172.20.1.0 0.0.0.255
#
ip route-static 10.2.1.0 255.255.255.0 Tunnel1
#
return</pre>
</li><li><p>DeviceB</p>
<pre class="screen">#
sysname DeviceB
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 172.20.1.2 255.255.255.0
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ip address 172.21.1.1 255.255.255.0
#
ospf 1
 area 0.0.0.0
  network 172.20.1.0 0.0.0.255
  network 172.21.1.0 0.0.0.255
#
return</pre>
</li><li><p>DeviceC</p>
<pre class="screen">#
sysname DeviceC
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 172.21.1.2 255.255.255.0
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ip address 10.2.1.2 255.255.255.0
#
interface Tunnel1
 ip address 172.22.1.2 255.255.255.0
 tunnel-protocol gre
 source 172.21.1.2
 destination 172.20.1.1
#
ospf 1
 area 0.0.0.0
 network 172.21.1.0 0.0.0.255
#
ip route-static 10.1.1.0 255.255.255.0 Tunnel1
#
return</pre>
</li></ul>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="vrp_gre_cfg_0006.html">Configuring a GRE Tunnel
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="vrp_gre_cfg_0011.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="vrp_gre_cfg_0017.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>