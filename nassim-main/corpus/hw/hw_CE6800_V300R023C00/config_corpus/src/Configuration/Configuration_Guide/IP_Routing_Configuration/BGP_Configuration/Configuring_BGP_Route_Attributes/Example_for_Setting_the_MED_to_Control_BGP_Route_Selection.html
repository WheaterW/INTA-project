
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Setting the MED to Control BGP Route Selection">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="vrp_bgp_cfg_0021.html">
<meta name="DC.Relation" scheme="URI" content="vrp_bgp_cfg_0029.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing">
<meta name="featuretype" content="IP Routing">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001176743601">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>Example for Setting the MED to Control BGP Route Selection</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001176743601"></a><a name="EN-US_TASK_0000001176743601"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Setting the MED to Control BGP Route Selection</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001176743601__1.3.1"></a><a name="1.3.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>Similar to the cost (or metric) used by an IGP, the MED is used to determine the optimal route when traffic enters an AS. When a BGP device learns multiple routes with the same destination address but different next hops from different EBGP peers, the route with the smallest MED value is selected as the optimal route if all other attributes are the same.</p>
<p>On the network shown in <a href="#EN-US_TASK_0000001176743601__fig_dc_vrp_bgp_cfg_307401">Figure 1</a>, BGP is configured on all devices. DeviceA is in AS 65008, and DeviceB and DeviceC are in AS 65009. DeviceA establishes EBGP connections with DeviceB and DeviceC, and DeviceB establishes an IBGP connection with DeviceC. Traffic sent by DeviceA to 172.16.1.0/24 can enter AS 65009 through DeviceB or DeviceC. If the attributes excluding the MED of the routes advertised by Devices B and C to DeviceA are the same, you can change the MED value of the route to be advertised by DeviceB or DeviceC to DeviceA in order to determine the device through which traffic will enter AS 65009.</p>
<div class="fignone" id="EN-US_TASK_0000001176743601__fig_dc_vrp_bgp_cfg_307401"><a name="EN-US_TASK_0000001176743601__fig_dc_vrp_bgp_cfg_307401"></a><a name="fig_dc_vrp_bgp_cfg_307401"></a><span class="figcap"><b>Figure 1 </b>Configuring the MED attribute to control BGP route selection</span><div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface 1 and interface 2 represent <span>100GE</span><span>1/0/1</span> and <span>100GE</span><span>1/0/2</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0000001176743651.png"></span></div>
<p>To complete the configuration, you need the following data:</p>
<ul><li>In AS 65008, DeviceA's router ID: 1.1.1.1</li><li>In AS 65009, DeviceB's router ID: 2.2.2.2, DeviceC's router ID: 3.3.3.3</li><li>DeviceB's new MED value: 100</li></ul>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001176743601__1.3.2"></a><a name="1.3.2"></a>
<div class="p"><h4 class="sectiontitle">Precautions</h4><p>During the configuration, note the following:</p>
<ul><li>To improve security, you are advised to deploy BGP security measures. For details, see "Configuring BGP Authentication." Keychain authentication is used as an example. For details, see Example for Configuring Keychain Authentication for BGP.</li></ul>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001176743601__1.3.3"></a><a name="1.3.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Establish EBGP connections between DeviceA and DeviceB, and between DeviceA and DeviceC, and establish an IBGP connection between DeviceB and DeviceC.</p>
</li><li>Apply a route-policy to increase the MED value of the route advertised by DeviceB to DeviceA, so that DeviceA will send traffic to AS 65009 through DeviceC.</li></ol>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001176743601__1.3.4"></a><a name="1.3.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Assign an IP address to each interface involved. For detailed configurations, see <a href="#EN-US_TASK_0000001176743601__postreq28647910915">Configuration Scripts</a>.</span></li><li><span>Configure BGP connections.</span><p><p># Configure DeviceA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA]<strong> bgp 65008</strong>
[<span class="keyword">*</span>DeviceA-bgp]<strong> router-id 1.1.1.1</strong>
[<span class="keyword">*</span>DeviceA-bgp] <strong>peer 10.1.1.1 as-number 65009</strong>
[<span class="keyword">*</span>DeviceA-bgp]<strong> peer 10.1.2.1 as-number 65009</strong>
[<span class="keyword">*</span>DeviceA-bgp]<strong> quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>commit</strong></pre>
<p># Configure DeviceB.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB]<strong> bgp 65009</strong>
[<span class="keyword">*</span>DeviceB-bgp]<strong> router-id 2.2.2.2</strong>
[<span class="keyword">*</span>DeviceB-bgp] <strong>peer 10.1.1.2 as-number 65008</strong>
[<span class="keyword">*</span>DeviceB-bgp] <strong>peer 172.16.1.2 as-number 65009</strong>
[<span class="keyword">*</span>DeviceB-bgp] <strong>ipv4-family unicast</strong>
[<span class="keyword">*</span>DeviceB-bgp-af-ipv4] <strong>network 172.16.1.0 255.255.255.0</strong>
[<span class="keyword">*</span>DeviceB-bgp-af-ipv4]<strong> quit</strong>
[<span class="keyword">*</span>DeviceB-bgp] <strong>quit</strong>
[<span class="keyword">*</span>DeviceB] <strong>commit</strong></pre>
<p># Configure DeviceC.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceC]<strong> bgp 65009</strong>
[<span class="keyword">*</span>DeviceC-bgp]<strong> router-id 3.3.3.3</strong>
[<span class="keyword">*</span>DeviceC-bgp] <strong>peer 10.1.2.2 as-number 65008</strong>
[<span class="keyword">*</span>DeviceC-bgp] <strong>peer 172.16.1.1 as-number 65009</strong>
[<span class="keyword">*</span>DeviceC-bgp] <strong>ipv4-family unicast</strong>
[<span class="keyword">*</span>DeviceC-bgp-af-ipv4] <strong>network 172.16.1.0 255.255.255.0</strong>
[<span class="keyword">*</span>DeviceC-bgp-af-ipv4]<strong> quit</strong>
[<span class="keyword">*</span>DeviceC-bgp] <strong>quit</strong>
[<span class="keyword">*</span>DeviceC] <strong>commit</strong></pre>
<p># Check the routing table of DeviceA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>display bgp routing-table 172.16.1.0 24</strong>

 BGP local router ID : 1.1.1.1
 Local AS number : 65008
 Paths:   2 available, 1 best, 1 select
 BGP routing table entry information of 172.16.1.0/24:
 From: 10.1.1.1 (2.2.2.2)
 Route Duration: 0d00h00m56s
 Direct Out-interface: <span>100GE</span><span>1/0/1</span>
 Original nexthop: 10.1.1.1
 Qos information : 0x0
 AS-path 65009, origin igp, MED 0, pref-val 0, valid, external, best, select, pre 255
 Advertised to such 2 peers:
    10.1.1.1
    10.1.2.1

 BGP routing table entry information of 172.16.1.0/24:
 From: 10.1.2.1 (3.3.3.3)
 Route Duration: 0d00h00m06s
 Direct Out-interface: <span>100GE</span><span>1/0/2</span>
 Original nexthop: 10.1.2.1
 Qos information : 0x0
 AS-path 65009, origin igp, MED 0, pref-val 0, valid, external, pre 255, not preferred for router ID
 Not advertised to any peers yet</pre>
<p>The command output shows two valid routes to 172.16.1.0/24. The route with 10.1.1.1 as the next hop is the optimal route because the router ID of DeviceB is smaller.</p>
</p></li><li><span>Configure the MED attribute.</span><p><p># Change the MED value of the route advertised by DeviceB to DeviceA using a route-policy.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB] <strong>route-policy 10 permit node 10</strong>
[<span class="keyword">*</span>DeviceB-route-policy] <strong>apply cost 100</strong>
[<span class="keyword">*</span>DeviceB-route-policy] <strong>quit</strong>
[<span class="keyword">*</span>DeviceB] <strong>bgp 65009</strong>
[<span class="keyword">*</span>DeviceB-bgp] <strong>ipv4-family unicast</strong>
[<span class="keyword">*</span>DeviceB-bgp-af-ipv4] <strong>peer 10.1.1.2 route-policy 10 export</strong>
[<span class="keyword">*</span>DeviceB-bgp-af-ipv4] <strong>quit</strong>
[<span class="keyword">*</span>DeviceB-bgp] <strong>quit</strong>
[<span class="keyword">*</span>DeviceB] <strong>commit</strong></pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001176743601__1.3.5"></a><a name="1.3.5"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p># Check the routing table of DeviceA.</p>
<pre class="screen">[DeviceA] <strong>display bgp routing-table 172.16.1.0 24</strong>

BGP local router ID : 1.1.1.1
 Local AS number : 65008
 Paths:   2 available, 1 best, 1 select
 BGP routing table entry information of 172.16.1.0/24:
 From: 10.1.2.1 (3.3.3.3)
 Route Duration: 0d00h07m45s
 Direct Out-interface: <span>100GE</span><span>1/0/2</span>
 Original nexthop: 10.1.2.1
 Qos information : 0x0
 AS-path 65009, origin igp, MED 0, pref-val 0, valid, external, best, select, pre 255
 Advertised to such 2 peers:
    10.1.1.1
    10.1.2.1

 BGP routing table entry information of 172.16.1.0/24:
 From: 10.1.1.1 (2.2.2.2)
 Route Duration: 0d00h00m08s
 Direct Out-interface: <span>100GE</span><span>1/0/1</span>
 Original nexthop: 10.1.1.1
 Qos information : 0x0
 AS-path 65009, origin igp, MED 100, pref-val 0, valid, external, pre 255, not preferred for MED
 Not advertised to any peers yet</pre>
<p>The command output shows that the MED value of the route with the next hop 10.1.1.1 (DeviceB) is 100 and the MED value of the route with the next hop 10.1.2.1 is 0. As a result, BGP selects the route with the smaller MED value.</p>
</div>
<div class="postreq"><a name="EN-US_TASK_0000001176743601__postreq28647910915"></a><a name="postreq28647910915"></a><a name="EN-US_TASK_0000001176743601__1.3.6"></a><a name="1.3.6"></a><h4 class="sectiontitle">Configuration Scripts</h4><ul><li><p>DeviceA</p>
<pre class="screen">#
sysname DeviceA
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 10.1.1.2 255.255.255.0
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ip address 10.1.2.2 255.255.255.0
#
bgp 65008
 router-id 1.1.1.1
 peer 10.1.1.1 as-number 65009
 peer 10.1.2.1 as-number 65009
 #
 ipv4-family unicast
  peer 10.1.1.1 enable
  peer 10.1.2.1 enable
#
return</pre>
</li><li><p>DeviceB</p>
<pre class="screen">#
sysname DeviceB
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 172.16.1.1 255.255.255.0
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ip address 10.1.1.1 255.255.255.0
#
bgp 65009
 router-id 2.2.2.2
 peer 172.16.1.2 as-number 65009
 peer 10.1.1.2 as-number 65008
 #
 ipv4-family unicast
  network 172.16.1.0 255.255.255.0
  peer 172.16.1.2 enable
  peer 10.1.1.2 enable
  peer 10.1.1.2 route-policy 10 export
#
route-policy 10 permit node 10
 apply cost 100
#
return</pre>
</li><li><p>DeviceC</p>
<pre class="screen">#
sysname DeviceC
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 172.16.1.2 255.255.255.0
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ip address 10.1.2.1 255.255.255.0
#
bgp 65009
 router-id 3.3.3.3
 peer 172.16.1.1 as-number 65009
 peer 10.1.2.2 as-number 65008
 #
 ipv4-family unicast
  network 172.16.1.0 255.255.255.0
  peer 172.16.1.1 enable
  peer 10.1.2.2 enable
#
return</pre>
</li></ul>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="vrp_bgp_cfg_0021.html">Configuring BGP Route Attributes
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="vrp_bgp_cfg_0029.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>
</body>
</html>