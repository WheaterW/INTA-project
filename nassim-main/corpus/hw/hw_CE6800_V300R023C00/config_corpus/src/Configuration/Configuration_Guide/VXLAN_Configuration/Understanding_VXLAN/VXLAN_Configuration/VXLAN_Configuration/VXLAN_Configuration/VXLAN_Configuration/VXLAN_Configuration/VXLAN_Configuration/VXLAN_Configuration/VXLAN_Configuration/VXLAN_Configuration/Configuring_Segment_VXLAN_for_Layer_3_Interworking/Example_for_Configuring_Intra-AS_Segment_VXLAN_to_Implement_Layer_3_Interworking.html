
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Intra-AS Segment VXLAN to Implement Layer 3 Interworking">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../vrp/dc_vrp_vxlan_cfg_1231.html">
<meta name="DC.Relation" scheme="URI" content="../vrp/dc_vrp_vxlan_cfg_1261.html">
<meta name="DC.Relation" scheme="URI" content="../vrp/dc_vrp_vxlan_cfg_1263.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="VXLAN">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="VXLAN">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="VXLAN">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="VXLAN">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001561023064">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="../public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring Intra-AS Segment VXLAN to Implement Layer 3 Interworking</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001561023064"></a><a name="EN-US_TASK_0000001561023064"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Intra-AS Segment VXLAN to Implement Layer 3 Interworking</h1>
<div class="taskbody" id="taskbody0000001561023064"><div class="context"><a name="EN-US_TASK_0000001561023064__1.3.1"></a><a name="1.3.1"></a>
<div class="p" id="EN-US_TASK_0000001561023064__context1677625172748"><h4 class="sectiontitle">Networking Requirements</h4><p id="EN-US_TASK_0000001561023064__p11949182411219">In <a href="#EN-US_TASK_0000001561023064__fig_dc_vrp_vxlan_cfg_108501">Figure 1</a>, DC A and DC B are planned in the same BGP AS. <span>To allow VMs in the same DC (VMa1 and VMa2 in DC A, and VMb1 and VMb2 in DC B) to communicate with each other, create a VXLAN tunnel in distributed gateway mode by configuring BGP EVPN in each DC. And to allow VMs in different DCs (for example, VMa1 and VMb2) to communicate with each other, create another VXLAN tunnel by configuring BGP EVPN on Leaf2 and Leaf3. </span>Because Leaf2 and Leaf3 do not send EVPN routes received from an IBGP EVPN peer to other IBGP EVPN peers, they need to be configured as RRs.</p>
<div class="fignone" id="EN-US_TASK_0000001561023064__fig_dc_vrp_vxlan_cfg_108501"><a name="EN-US_TASK_0000001561023064__fig_dc_vrp_vxlan_cfg_108501"></a><a name="fig_dc_vrp_vxlan_cfg_108501"></a><span class="figcap"><b>Figure 1 </b>Configuring intra-AS segment VXLAN for Layer 3 interworking</span><div class="note" id="EN-US_TASK_0000001561023064__note555116437108"><img src="../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0000001561023064__p255174321013">In this example, interface1, interface2, and interface3 represent <span>100GE</span><span>1/0/1</span>, <span>100GE</span><span>1/0/2</span>, and <span>100GE</span><span>1/0/3</span>, respectively.</p>
</div></div>
<p id="EN-US_TASK_0000001561023064__p183923465445"><span><img class="vsd" id="EN-US_TASK_0000001561023064__image1201021007175357" src="images/fig_dc_cfg_vxlan_cfgcase_001701dcf.png"></span></p>
</div>

<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" id="EN-US_TASK_0000001561023064__table_01" frame="border" border="1" rules="all"><caption><b>Table 1 </b>Interface IP addresses</caption><thead align="left"><tr id="EN-US_TASK_0000001561023064__row1744410268175357"><th align="left" class="cellrowborder" valign="top" width="11.42%" id="mcps1.3.1.4.2.7.1.1" liSelected="liSelected"><p id="EN-US_TASK_0000001561023064__p1272307310175357">Device</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="23.29%" id="mcps1.3.1.4.2.7.1.2" liSelected="liSelected"><p id="EN-US_TASK_0000001561023064__p1242681975175357">Interface</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="16.42%" id="mcps1.3.1.4.2.7.1.3" liSelected="liSelected"><p id="EN-US_TASK_0000001561023064__p1659237153175357">IP Address</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="11.4%" id="mcps1.3.1.4.2.7.1.4" liSelected="liSelected"><p id="EN-US_TASK_0000001561023064__p248546341175357">Device</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="21.18%" id="mcps1.3.1.4.2.7.1.5" liSelected="liSelected"><p id="EN-US_TASK_0000001561023064__p190569014175357">Interface</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="16.29%" id="mcps1.3.1.4.2.7.1.6" liSelected="liSelected"><p id="EN-US_TASK_0000001561023064__p883950771175357">IP Address</p>
</th>
</tr>
</thead>
<tbody><tr id="EN-US_TASK_0000001561023064__row1662569196175357"><td class="cellrowborder" rowspan="3" valign="middle" width="11.42%" headers="mcps1.3.1.4.2.7.1.1 "><p id="EN-US_TASK_0000001561023064__p32464257175357">Device1</p>
</td>
<td class="cellrowborder" valign="top" width="23.29%" headers="mcps1.3.1.4.2.7.1.2 "><p id="EN-US_TASK_0000001561023064__p1623168561175357"><span>100GE</span><span>1/0/1</span></p>
</td>
<td class="cellrowborder" valign="top" width="16.42%" headers="mcps1.3.1.4.2.7.1.3 "><p id="EN-US_TASK_0000001561023064__p1367185460175357">192.168.50.1/24</p>
</td>
<td class="cellrowborder" rowspan="3" valign="middle" width="11.4%" headers="mcps1.3.1.4.2.7.1.4 "><p id="EN-US_TASK_0000001561023064__p1273074903175357">Device2</p>
</td>
<td class="cellrowborder" valign="top" width="21.18%" headers="mcps1.3.1.4.2.7.1.5 "><p id="EN-US_TASK_0000001561023064__p449645290175357"><span>100GE</span><span>1/0/1</span></p>
</td>
<td class="cellrowborder" valign="top" width="16.29%" headers="mcps1.3.1.4.2.7.1.6 "><p id="EN-US_TASK_0000001561023064__p1239651283175357">192.168.60.1/24</p>
</td>
</tr>
<tr id="EN-US_TASK_0000001561023064__row1045874286175357"><td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.1 "><p id="EN-US_TASK_0000001561023064__p1822205006175357"><span>100GE</span><span>1/0/2</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.2 "><p id="EN-US_TASK_0000001561023064__p844969746175357">192.168.1.1/24</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.3 "><p id="EN-US_TASK_0000001561023064__p1018387073175357"><span>100GE</span><span>1/0/2</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.4 "><p id="EN-US_TASK_0000001561023064__p817300879175357">192.168.1.2/24</p>
</td>
</tr>
<tr id="EN-US_TASK_0000001561023064__row2092725097175357"><td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.1 "><p id="EN-US_TASK_0000001561023064__p395818094175357">Loopback1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.2 "><p id="EN-US_TASK_0000001561023064__p66117265175357">1.1.1.1/32</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.3 "><p id="EN-US_TASK_0000001561023064__p675743646175357">Loopback1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.4 "><p id="EN-US_TASK_0000001561023064__p825348004175357">2.2.2.2/32</p>
</td>
</tr>
<tr id="EN-US_TASK_0000001561023064__row1970006042175357"><td class="cellrowborder" rowspan="3" valign="middle" width="11.42%" headers="mcps1.3.1.4.2.7.1.1 "><p id="EN-US_TASK_0000001561023064__p196649716175357">Spine1</p>
</td>
<td class="cellrowborder" valign="top" width="23.29%" headers="mcps1.3.1.4.2.7.1.2 "><p id="EN-US_TASK_0000001561023064__p399665682175357"><span>100GE</span><span>1/0/1</span></p>
</td>
<td class="cellrowborder" valign="top" width="16.42%" headers="mcps1.3.1.4.2.7.1.3 "><p id="EN-US_TASK_0000001561023064__p1663387857175357">192.168.10.1/24</p>
</td>
<td class="cellrowborder" rowspan="3" valign="middle" width="11.4%" headers="mcps1.3.1.4.2.7.1.4 "><p id="EN-US_TASK_0000001561023064__p113631086175357">Spine2</p>
</td>
<td class="cellrowborder" valign="top" width="21.18%" headers="mcps1.3.1.4.2.7.1.5 "><p id="EN-US_TASK_0000001561023064__p1255214524175357"><span>100GE</span><span>1/0/1</span></p>
</td>
<td class="cellrowborder" valign="top" width="16.29%" headers="mcps1.3.1.4.2.7.1.6 "><p id="EN-US_TASK_0000001561023064__p53321163175357">192.168.30.1/24</p>
</td>
</tr>
<tr id="EN-US_TASK_0000001561023064__row954044828175357"><td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.1 "><p id="EN-US_TASK_0000001561023064__p1394672641175357"><span>100GE</span><span>1/0/2</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.2 "><p id="EN-US_TASK_0000001561023064__p1685077648175357">192.168.20.1/24</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.3 "><p id="EN-US_TASK_0000001561023064__p1194979389175357"><span>100GE</span><span>1/0/2</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.4 "><p id="EN-US_TASK_0000001561023064__p881870224175357">192.168.40.1/24</p>
</td>
</tr>
<tr id="EN-US_TASK_0000001561023064__row1239015974175357"><td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.1 "><p id="EN-US_TASK_0000001561023064__p513383694175357">Loopback1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.2 "><p id="EN-US_TASK_0000001561023064__p2105495446175357">3.3.3.3/32</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.3 "><p id="EN-US_TASK_0000001561023064__p154880160175357">Loopback1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.4 "><p id="EN-US_TASK_0000001561023064__p1753044445175357">4.4.4.4/32</p>
</td>
</tr>
<tr id="EN-US_TASK_0000001561023064__row2076444755175357"><td class="cellrowborder" rowspan="3" valign="middle" width="11.42%" headers="mcps1.3.1.4.2.7.1.1 "><p id="EN-US_TASK_0000001561023064__p261911039175357">Leaf1</p>
</td>
<td class="cellrowborder" valign="top" width="23.29%" headers="mcps1.3.1.4.2.7.1.2 "><p id="EN-US_TASK_0000001561023064__p1266065458175357"><span>100GE</span><span>1/0/1</span></p>
</td>
<td class="cellrowborder" valign="top" width="16.42%" headers="mcps1.3.1.4.2.7.1.3 "><p id="EN-US_TASK_0000001561023064__p720313781175357">192.168.10.2/24</p>
</td>
<td class="cellrowborder" rowspan="3" valign="middle" width="11.4%" headers="mcps1.3.1.4.2.7.1.4 "><p id="EN-US_TASK_0000001561023064__p1464430428175357">Leaf4</p>
</td>
<td class="cellrowborder" valign="top" width="21.18%" headers="mcps1.3.1.4.2.7.1.5 "><p id="EN-US_TASK_0000001561023064__p2136560048175357"><span>100GE</span><span>1/0/1</span></p>
</td>
<td class="cellrowborder" valign="top" width="16.29%" headers="mcps1.3.1.4.2.7.1.6 "><p id="EN-US_TASK_0000001561023064__p1884569675175357">192.168.40.2/24</p>
</td>
</tr>
<tr id="EN-US_TASK_0000001561023064__row123871040175357"><td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.1 "><p id="EN-US_TASK_0000001561023064__p192916721175357"><span>100GE</span><span>1/0/2</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.2 "><p id="EN-US_TASK_0000001561023064__p1152960905175357">-</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.3 "><p id="EN-US_TASK_0000001561023064__p388328353175357"><span>100GE</span><span>1/0/2</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.4 "><p id="EN-US_TASK_0000001561023064__p715253324175357">-</p>
</td>
</tr>
<tr id="EN-US_TASK_0000001561023064__row883229135175357"><td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.1 "><p id="EN-US_TASK_0000001561023064__p265677010175357">Loopback1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.2 "><p id="EN-US_TASK_0000001561023064__p1472159215175357">5.5.5.5/32</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.3 "><p id="EN-US_TASK_0000001561023064__p369520824175357">Loopback1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.4 "><p id="EN-US_TASK_0000001561023064__p1451831414175357">8.8.8.8/32</p>
</td>
</tr>
<tr id="EN-US_TASK_0000001561023064__row1206258569175357"><td class="cellrowborder" rowspan="4" valign="middle" width="11.42%" headers="mcps1.3.1.4.2.7.1.1 "><p id="EN-US_TASK_0000001561023064__p1459783619175357">Leaf2</p>
</td>
<td class="cellrowborder" valign="top" width="23.29%" headers="mcps1.3.1.4.2.7.1.2 "><p id="EN-US_TASK_0000001561023064__p932094299175357"><span>100GE</span><span>1/0/1</span></p>
</td>
<td class="cellrowborder" valign="top" width="16.42%" headers="mcps1.3.1.4.2.7.1.3 "><p id="EN-US_TASK_0000001561023064__p432599811175357">192.168.20.2/24</p>
</td>
<td class="cellrowborder" rowspan="4" valign="middle" width="11.4%" headers="mcps1.3.1.4.2.7.1.4 "><p id="EN-US_TASK_0000001561023064__p827230518175357">Leaf3</p>
</td>
<td class="cellrowborder" valign="top" width="21.18%" headers="mcps1.3.1.4.2.7.1.5 "><p id="EN-US_TASK_0000001561023064__p454844102175357"><span>100GE</span><span>1/0/1</span></p>
</td>
<td class="cellrowborder" valign="top" width="16.29%" headers="mcps1.3.1.4.2.7.1.6 "><p id="EN-US_TASK_0000001561023064__p830867487175357">192.168.30.2/24</p>
</td>
</tr>
<tr id="EN-US_TASK_0000001561023064__row1661132064813"><td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.1 "><p id="EN-US_TASK_0000001561023064__p17507330144816"><span>100GE</span><span>1/0/2</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.2 "><p id="EN-US_TASK_0000001561023064__p5611720114818">-</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.3 "><p id="EN-US_TASK_0000001561023064__p17698531134814"><span>100GE</span><span>1/0/2</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.4 "><p id="EN-US_TASK_0000001561023064__p1061132014816">-</p>
</td>
</tr>
<tr id="EN-US_TASK_0000001561023064__row1124110592175357"><td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.1 "><p id="EN-US_TASK_0000001561023064__p109542154175357"><span>100GE</span><span>1/0/3</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.2 "><p id="EN-US_TASK_0000001561023064__p823084951175357">192.168.50.2/24</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.3 "><p id="EN-US_TASK_0000001561023064__p773858171175357"><span>100GE</span><span>1/0/3</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.4 "><p id="EN-US_TASK_0000001561023064__p470705174175357">192.168.60.2/24</p>
</td>
</tr>
<tr id="EN-US_TASK_0000001561023064__row326739962175357"><td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.1 "><p id="EN-US_TASK_0000001561023064__p560499488175357">Loopback1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.2 "><p id="EN-US_TASK_0000001561023064__p245297996175357">6.6.6.6/32</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.3 "><p id="EN-US_TASK_0000001561023064__p485240542175357">Loopback1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.7.1.4 "><p id="EN-US_TASK_0000001561023064__p1294730850175357">7.7.7.7/32</p>
</td>
</tr>
</tbody>
</table>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001561023064__1.3.2"></a><a name="1.3.2"></a>
<div class="p" id="EN-US_TASK_0000001561023064__context1251121212569"><h4 class="sectiontitle">Configuration Roadmap</h4><div class="p" id="EN-US_TASK_0000001561023064__p1546337400175357">The configuration roadmap is as follows:<ol id="EN-US_TASK_0000001561023064__ol685164353175357"><li id="EN-US_TASK_0000001561023064__li1091272956175357"><p id="EN-US_TASK_0000001561023064__p1514226112175357"><a name="EN-US_TASK_0000001561023064__li1091272956175357"></a><a name="li1091272956175357"></a>Configure interface IP addresses for devices.</p>
</li><li id="EN-US_TASK_0000001561023064__li502280253175357"><p id="EN-US_TASK_0000001561023064__p65995814175357"><a name="EN-US_TASK_0000001561023064__li502280253175357"></a><a name="li502280253175357"></a>Configure routing protocols to ensure that devices can communicate with each other.</p>
</li><li id="EN-US_TASK_0000001561023064__li646378586175357"><p id="EN-US_TASK_0000001561023064__p1712608376175357"><a name="EN-US_TASK_0000001561023064__li646378586175357"></a><a name="li646378586175357"></a>Configure BGP EVPN within DC A and DC B to establish VXLAN tunnels for intra-DC communication.</p>
</li><li id="EN-US_TASK_0000001561023064__li1592128507175357"><p id="EN-US_TASK_0000001561023064__p1257575529175357"><a name="EN-US_TASK_0000001561023064__li1592128507175357"></a><a name="li1592128507175357"></a>Configure BGP EVPN on Leaf2 in DC A and Leaf3 in DC B to create a VXLAN tunnel<span> for inter-DC communication</span>.</p>
</li><li id="EN-US_TASK_0000001561023064__li1663514603175357"><p id="EN-US_TASK_0000001561023064__p600332328175357"><a name="EN-US_TASK_0000001561023064__li1663514603175357"></a><a name="li1663514603175357"></a>Configure Leaf2 and Leaf3 as RRs.</p>
</li><li id="EN-US_TASK_0000001561023064__li1543074712497">Configure and apply a routing policy on each leaf node.</li></ol>
</div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001561023064__1.3.3"></a><a name="1.3.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol id="EN-US_TASK_0000001561023064__steps10132325172748"><li id="EN-US_TASK_0000001561023064__step1439286410175357"><span id="EN-US_TASK_0000001561023064__cmd830893062175357">Configure interface IP addresses for devices.</span><p><p id="EN-US_TASK_0000001561023064__p190808623175357"># Configure Device1. The configurations of other devices are similar to the configuration of Device1. For detailed configurations, see Configuration Scripts.</p>
<pre class="screen" id="EN-US_TASK_0000001561023064__screen5314548485">&lt;<span class="keyword" id="EN-US_TASK_0000001561023064__keyword288825270175357">HUAWEI</span>&gt; <strong id="EN-US_TASK_0000001561023064__b421803293175357">system-view</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword141191035814"><font style="font-size:8pt" Face="Courier New" >~</font></span></span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword2104953449175357">HUAWEI</span>] <strong id="EN-US_TASK_0000001561023064__b1773368561175357">sysname Device1</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword1652188171019">*</span></span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword969690710175357">HUAWEI</span>] <strong id="EN-US_TASK_0000001561023064__b378765553175357">commit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword151761739155618"><font style="font-size:8pt" Face="Courier New" >~</font></span></span>Device1] <strong id="EN-US_TASK_0000001561023064__b641458871175357">interface loopback 1</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword310811813561">*</span></span>Device1-LoopBack1] <strong id="EN-US_TASK_0000001561023064__b1323277340175357">ip address 1.1.1.1 32</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword19305151035620">*</span></span>Device1-LoopBack1] <strong id="EN-US_TASK_0000001561023064__b1636218836175357">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword420161219561">*</span></span>Device1] <strong id="EN-US_TASK_0000001561023064__b123426997175357">interface <span>100ge</span> <span>1/0/1</span></strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword1059614205620">*</span></span>Device1-<span>100GE</span><span>1/0/1</span>] <strong id="EN-US_TASK_0000001561023064__b459067790175357">undo portswitch</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword58809152568">*</span></span>Device1-<span>100GE</span><span>1/0/1</span>] <strong id="EN-US_TASK_0000001561023064__b565238834175357">ip address 192.168.50.1 24</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword517912184561">*</span></span>Device1-<span>100GE</span><span>1/0/1</span>] <strong id="EN-US_TASK_0000001561023064__b146578016175357">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword42661220145613">*</span></span>Device1] <strong id="EN-US_TASK_0000001561023064__b1395170172175357">interface <span>100ge</span> <span>1/0/2</span></strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword787717233569">*</span></span>Device1-<span>100GE</span><span>1/0/2</span>] <strong id="EN-US_TASK_0000001561023064__b550402134175357">undo portswitch</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword11860123155613">*</span></span>Device1-<span>100GE</span><span>1/0/2</span>] <strong id="EN-US_TASK_0000001561023064__b852427692175357">ip address 192.168.1.1 24</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword1962133365612">*</span></span>Device1-<span>100GE</span><span>1/0/2</span>] <strong id="EN-US_TASK_0000001561023064__b1203603298175357">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword9340257548">*</span></span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword2092415151">Device1</span>] <strong id="EN-US_TASK_0000001561023064__b183403573417">commit</strong></pre>
</p></li><li id="EN-US_TASK_0000001561023064__step1300348759175357"><span id="EN-US_TASK_0000001561023064__cmd20516994175357">Configure routing protocols to ensure that devices can communicate with each other.</span><p><p id="EN-US_TASK_0000001561023064__p1527712241376"># Configure Spine1. The configurations of Spine2, Leaf1, and Leaf4 are similar to the configuration of Spine1. For detailed configurations, see Configuration Scripts.</p>
<pre class="screen" id="EN-US_TASK_0000001561023064__screen22771241375">&lt;<span class="keyword" id="EN-US_TASK_0000001561023064__keyword162779244714">HUAWEI</span>&gt; <strong id="EN-US_TASK_0000001561023064__b127713241078">system-view</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword12277324670"><font style="font-size:8pt" Face="Courier New" >~</font></span></span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword127742412713">HUAWEI</span>] <strong id="EN-US_TASK_0000001561023064__b1727717241072">sysname Spine1</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword10277152411717">*</span></span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword1527715242711">HUAWEI</span>] <strong id="EN-US_TASK_0000001561023064__b9277162414715">commit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword15277192412717"><font style="font-size:8pt" Face="Courier New" >~</font></span></span>Spine1] <strong id="EN-US_TASK_0000001561023064__b42771724876">ospf 1</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword112786249713">*</span></span>Spine1-ospf-1] <strong id="EN-US_TASK_0000001561023064__b1827814247710">area 0</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword172781124373">*</span></span>Spine1-ospf-1-area-0.0.0.0] <strong id="EN-US_TASK_0000001561023064__b1227819243711">network 3.3.3.3 0.0.0.0</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword1248718490818">*</span></span>Spine1-ospf-1-area-0.0.0.0] <strong id="EN-US_TASK_0000001561023064__b164871549481">network 192.168.10.0 0.0.0.255</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword132787243717">*</span></span>Spine1-ospf-1-area-0.0.0.0] <strong id="EN-US_TASK_0000001561023064__b327817241777">network 192.168.20.0 0.0.0.255</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword127892411717">*</span></span>Spine1-ospf-1-area-0.0.0.0] <strong id="EN-US_TASK_0000001561023064__b427813243719">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword22786241976">*</span></span>Spine1-ospf-1] <strong id="EN-US_TASK_0000001561023064__b927816241175">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword1227816247719">*</span></span>Spine1] <strong id="EN-US_TASK_0000001561023064__b182781242720">commit</strong></pre>
<p id="EN-US_TASK_0000001561023064__p1541768861175357"># Configure Leaf2. The configurations of Leaf3, Device1, and Device2 are similar to the configuration of Leaf2. For detailed configurations, see Configuration Scripts.</p>
<pre class="screen" id="EN-US_TASK_0000001561023064__screen396904651414">&lt;<span class="keyword" id="EN-US_TASK_0000001561023064__keyword996954610149">HUAWEI</span>&gt; <strong id="EN-US_TASK_0000001561023064__b4969144671419">system-view</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword79691446171413"><font style="font-size:8pt" Face="Courier New" >~</font></span></span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword99691246171413">HUAWEI</span>] <strong id="EN-US_TASK_0000001561023064__b296924614143">sysname Leaf2</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword10969124619149">*</span></span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword119691746171412">HUAWEI</span>] <strong id="EN-US_TASK_0000001561023064__b1969144619140">commit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword5540323151519"><font style="font-size:8pt" Face="Courier New" >~</font></span></span>Leaf2] <strong id="EN-US_TASK_0000001561023064__b8755002179">ospf 1</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword18918622121612">*</span></span>Leaf2-ospf-1] <strong id="EN-US_TASK_0000001561023064__b1246810919513">area 0</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword131811925171617">*</span></span>Leaf2-ospf-1-area-0.0.0.0] <strong id="EN-US_TASK_0000001561023064__b1346819920513">network 6.6.6.6 0.0.0.0</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword945771819174">*</span></span>Leaf2-ospf-1-area-0.0.0.0] <strong id="EN-US_TASK_0000001561023064__b18457718121718">network 192.168.20.0 0.0.0.255</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword912342781620">*</span></span>Leaf2-ospf-1-area-0.0.0.0] <strong id="EN-US_TASK_0000001561023064__b104681191454">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword13724113621814">*</span></span>Leaf2-ospf-1] <strong id="EN-US_TASK_0000001561023064__b2072413360187">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword15202153613120">*</span></span>Leaf2] <strong id="EN-US_TASK_0000001561023064__b16597181951114">bgp 20</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword94836501316">*</span></span>Leaf2-bgp] <strong id="EN-US_TASK_0000001561023064__b109221035412">peer 192.168.50.1 as-number 10</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword1059819194112">*</span></span>Leaf2-bgp] <strong id="EN-US_TASK_0000001561023064__b559871951114">ipv4-family unicast</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword12971523846">*</span></span>Leaf2-bgp-af-ipv4] <strong id="EN-US_TASK_0000001561023064__b16245349446">network 6.6.6.6 255.255.255.255</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword1159881911115">*</span></span>Leaf2-bgp-af-ipv4] <strong id="EN-US_TASK_0000001561023064__b07615463418">peer 192.168.50.1 enable</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword14598121919114">*</span></span>Leaf2-bgp-af-ipv4] <strong id="EN-US_TASK_0000001561023064__b65989190111">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword1959891951114">*</span></span>Leaf2-bgp] <strong id="EN-US_TASK_0000001561023064__b10598121915112">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword165981419171118">*</span></span>Leaf2] <strong id="EN-US_TASK_0000001561023064__b959819198119">commit</strong></pre>
</p></li><li id="EN-US_TASK_0000001561023064__step437759412175357"><span id="EN-US_TASK_0000001561023064__cmd143462862175357">Configure BGP EVPN to establish one VXLAN tunnel in DC A and another one in DC B.</span><ol type="a" id="EN-US_TASK_0000001561023064__substeps138580532175357"><li class="substepexpand" id="EN-US_TASK_0000001561023064__substep1415155796175357"><span id="EN-US_TASK_0000001561023064__cmd1142072847175357">Configure VXLAN service access points. </span><p><p id="EN-US_TASK_0000001561023064__p2024517259175357"># Configure Leaf1.</p>
<pre class="screen" id="EN-US_TASK_0000001561023064__screen345163553120">[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword545153593112"><font style="font-size:8pt" Face="Courier New" >~</font></span></span>Leaf1] <strong id="EN-US_TASK_0000001561023064__b34523523115">bridge-domain 10</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword1645335103110">*</span></span>Leaf1-bd10] <strong id="EN-US_TASK_0000001561023064__b1945163515318">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword16451935103110">*</span></span>Leaf1] <strong id="EN-US_TASK_0000001561023064__b34516357314">interface <span>100GE</span> <span>1/0/2</span>.1 mode l2</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword1745133563116">*</span></span>Leaf1-<span>100GE</span><span>1/0/2</span>.1] <strong id="EN-US_TASK_0000001561023064__b446123543115">encapsulation dot1q vid 10</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword946735203119">*</span></span>Leaf1-<span>100GE</span><span>1/0/2</span>.1] <strong id="EN-US_TASK_0000001561023064__b164612353317">bridge-domain 10</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword114618352314">*</span></span>Leaf1-<span>100GE</span><span>1/0/2</span>.1] <strong id="EN-US_TASK_0000001561023064__b846835113112">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword18466352318">*</span></span>Leaf1] <strong id="EN-US_TASK_0000001561023064__b04663523119">commit</strong></pre>
<p id="EN-US_TASK_0000001561023064__p0280114410386">The configurations of Leaf2, Leaf3, and Leaf4 are similar to the configuration of Leaf1. For detailed configurations, see Configuration Scripts. </p>
</p></li><li class="substepexpand" id="EN-US_TASK_0000001561023064__substep567254371175357"><span id="EN-US_TASK_0000001561023064__cmd1164304364175357">Configure EVPN as the VXLAN control plane on leaf nodes.</span><p><p id="EN-US_TASK_0000001561023064__p17708120183319"># Configure Leaf1.</p>
<pre class="screen" id="EN-US_TASK_0000001561023064__screen117081702333">[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword2708909337"><font style="font-size:8pt" Face="Courier New" >~</font></span></span>Leaf1] <strong id="EN-US_TASK_0000001561023064__b137081208332">evpn-overlay enable</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword2708200153317">*</span></span>Leaf1] <strong id="EN-US_TASK_0000001561023064__b1070818083318">commit</strong></pre>
<p id="EN-US_TASK_0000001561023064__p207082016334">The configurations of Leaf2, Leaf3, and Leaf4 are similar to the configuration of Leaf1. For detailed configurations, see Configuration Scripts. </p>
</p></li><li class="substepexpand" id="EN-US_TASK_0000001561023064__substep858615555175357"><span id="EN-US_TASK_0000001561023064__cmd1809008692175357">Establish a BGP EVPN peer relationship between Leaf1 and Leaf2, and another one between Leaf3 and Leaf4.</span><p><p id="EN-US_TASK_0000001561023064__p507807811175357"># Configure Leaf1.</p>
<pre class="screen" id="EN-US_TASK_0000001561023064__screen430044924175357">[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword1135613525253"><font style="font-size:8pt" Face="Courier New" >~</font></span></span>Leaf1] <strong id="EN-US_TASK_0000001561023064__b17356145218256">bgp 100 instance evpn1</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword93562523254">*</span></span>Leaf1-bgp-instance-evpn1] <strong id="EN-US_TASK_0000001561023064__b143567524250">peer 6.6.6.6 as-number 100</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword23566527255">*</span></span>Leaf1-bgp-instance-evpn1] <strong id="EN-US_TASK_0000001561023064__b1356195262519">peer 6.6.6.6 connect-interface LoopBack 1</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword14219416165011">*</span></span>Leaf1-bgp-instance-evpn1] <strong id="EN-US_TASK_0000001561023064__b92441214172912">l2vpn-family evpn</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword6338201812503">*</span></span>Leaf1-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001561023064__b828081059175357">peer 6.6.6.6 enable</strong>
Warning: This operation will reset the peer session. Continue? [Y/N]: <strong id="EN-US_TASK_0000001561023064__b836013922175357">y</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword19649221165017">*</span></span>Leaf1-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001561023064__b257860368175357">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword252013391863">*</span></span>Leaf1-bgp-instance-evpn1] <strong id="EN-US_TASK_0000001561023064__b15201139361">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword19918182375014">*</span></span>Leaf1] <strong id="EN-US_TASK_0000001561023064__b1818205008175357">commit</strong></pre>
<p id="EN-US_TASK_0000001561023064__p198621328174311">The configurations of Leaf2, Leaf3, and Leaf4 are similar to the configuration of Leaf1. For detailed configurations, see Configuration Scripts. </p>
</p></li><li class="substepexpand" id="EN-US_TASK_0000001561023064__substep725784871175357"><span id="EN-US_TASK_0000001561023064__cmd559211937175357">Configure an EVPN instance on Leaf1.</span><p><p id="EN-US_TASK_0000001561023064__p1456461230175357"># Configure Leaf1.</p>
<pre class="screen" id="EN-US_TASK_0000001561023064__screen4483420222">[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword948342220"><font style="font-size:8pt" Face="Courier New" >~</font></span></span>Leaf1] <strong id="EN-US_TASK_0000001561023064__b5481452213">ip vpn-instance vpn1</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword11481849220">*</span></span>Leaf1-vpn-instance-vpn1] <strong id="EN-US_TASK_0000001561023064__b1486414224">vxlan vni 5010</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword5481041221">*</span></span>Leaf1-vpn-instance-vpn1] <strong id="EN-US_TASK_0000001561023064__b154884122218">ipv4-family</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword104884152214">*</span></span>Leaf1-vpn-instance-vpn1-af-ipv4] <strong id="EN-US_TASK_0000001561023064__b1748194192218">route-distinguisher 20:1</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword1048134122216">*</span></span>Leaf1-vpn-instance-vpn1-af-ipv4] <strong id="EN-US_TASK_0000001561023064__b114810416227">vpn-target 100:5010 evpn</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword134824172217">*</span></span>Leaf1-vpn-instance-vpn1-af-ipv4] <strong id="EN-US_TASK_0000001561023064__b16495418223">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword20498417227">*</span></span>Leaf1-vpn-instance-vpn1] <strong id="EN-US_TASK_0000001561023064__b124918472216">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword9498415220">*</span></span>Leaf1] <strong id="EN-US_TASK_0000001561023064__b04915415221">bridge-domain 10</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword1649943223">*</span></span>Leaf1-bd10] <strong id="EN-US_TASK_0000001561023064__b64944122216">vxlan vni 10</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword124913416226">*</span></span>Leaf1-bd10] <strong id="EN-US_TASK_0000001561023064__b04912422210">evpn</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword2497432213">*</span></span>Leaf1-bd10-evpn] <strong id="EN-US_TASK_0000001561023064__b54974172212">route-distinguisher 10:1</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword105017415227">*</span></span>Leaf1-bd10-evpn] <strong id="EN-US_TASK_0000001561023064__b16501418224">vpn-target 100:10</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword1150164162213">*</span></span>Leaf1-bd10-evpn] <strong id="EN-US_TASK_0000001561023064__b6503412221">vpn-target 100:5010 export-extcommunity</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword550174122217">*</span></span>Leaf1-bd10-evpn] <strong id="EN-US_TASK_0000001561023064__b3507412215">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword135014462219">*</span></span>Leaf1-bd10] <strong id="EN-US_TASK_0000001561023064__b1050643226">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword8507432218">*</span></span>Leaf1] <strong id="EN-US_TASK_0000001561023064__b12506414224">commit</strong></pre>
<p id="EN-US_TASK_0000001561023064__p151611010466">The configurations of Leaf2, Leaf3, and Leaf4 are similar to the configuration of Leaf1. For detailed configurations, see Configuration Scripts. </p>
</p></li><li class="substepexpand" id="EN-US_TASK_0000001561023064__substep1617925582175357"><span id="EN-US_TASK_0000001561023064__cmd1037318360175357">Enable ingress replication on each leaf node.</span><p><p id="EN-US_TASK_0000001561023064__p1221603078175357"># Configure Leaf1.</p>
<pre class="screen" id="EN-US_TASK_0000001561023064__screen1866171420175357">[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword4300151615513"><font style="font-size:8pt" Face="Courier New" >~</font></span></span>Leaf1] <strong id="EN-US_TASK_0000001561023064__b2093304111175357">interface nve 1</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword63228494528">*</span></span>Leaf1-Nve1] <strong id="EN-US_TASK_0000001561023064__b14585195333912">source 5.5.5.5</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword99721050145218">*</span></span>Leaf1-Nve1] <strong id="EN-US_TASK_0000001561023064__b95851353153914">vni 10 head-end peer-list protocol bgp</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword1549211529521">*</span></span>Leaf1-Nve1] <strong id="EN-US_TASK_0000001561023064__b1158515312395">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword3468554175220">*</span></span>Leaf1] <strong id="EN-US_TASK_0000001561023064__b1585853113917">commit</strong></pre>
<p id="EN-US_TASK_0000001561023064__p97081441162213">The configurations of Leaf2, Leaf3, and Leaf4 are similar to the configuration of Leaf1. For detailed configurations, see Configuration Scripts. </p>
</p></li><li class="substepexpand" id="EN-US_TASK_0000001561023064__substep948075685317"><span id="EN-US_TASK_0000001561023064__cmd16480656185319">Configure leaf nodes as Layer 3 VXLAN gateways.</span><p><p id="EN-US_TASK_0000001561023064__p908149761175357"># Configure Leaf1.</p>
<pre class="screen" id="EN-US_TASK_0000001561023064__screen1856897019175357">[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword118691220175516"><font style="font-size:8pt" Face="Courier New" >~</font></span></span>Leaf1] <strong id="EN-US_TASK_0000001561023064__b1573267388175357">interface vbdif 10</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword42775013532">*</span></span>Leaf1-Vbdif10] <strong id="EN-US_TASK_0000001561023064__b1128145428">ip binding vpn-instance vpn1</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword129562185319">*</span></span>Leaf1-Vbdif10] <strong id="EN-US_TASK_0000001561023064__b1220149427">ip address 10.10.1.1 24</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword1282163165315">*</span></span>Leaf1-Vbdif10] <strong id="EN-US_TASK_0000001561023064__b41201419426">arp collect host enable</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword44320745310">*</span></span>Leaf1-Vbdif10] <strong id="EN-US_TASK_0000001561023064__b217147428">vxlan anycast-gateway enable</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword142986915537">*</span></span>Leaf1-Vbdif10] <strong id="EN-US_TASK_0000001561023064__b0113142427">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword103741211155313">*</span></span>Leaf1] <strong id="EN-US_TASK_0000001561023064__b8111413425">commit</strong></pre>
<p id="EN-US_TASK_0000001561023064__p99108092518">The configurations of Leaf2, Leaf3, and Leaf4 are similar to the configuration of Leaf1. For detailed configurations, see Configuration Scripts. </p>
</p></li><li class="substepexpand" id="EN-US_TASK_0000001561023064__substep152315312551"><span id="EN-US_TASK_0000001561023064__cmd423183114556">Configure the type of route to be advertised between VXLAN gateways. </span><p><p id="EN-US_TASK_0000001561023064__p562854212175357"># Configure Leaf1.</p>
<pre class="screen" id="EN-US_TASK_0000001561023064__screen200885882175357">[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword10649102410553"><font style="font-size:8pt" Face="Courier New" >~</font></span></span>Leaf1] <strong id="EN-US_TASK_0000001561023064__b603138964175357">bgp 100 instance evpn1</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword33691921205316">*</span></span>Leaf1-bgp-instance-evpn1] <strong id="EN-US_TASK_0000001561023064__b1453223118434">l2vpn-family evpn</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword17107123195316">*</span></span>Leaf1-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001561023064__b16532103116437">peer 6.6.6.6 advertise irb</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword36281324105313">*</span></span>Leaf1-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001561023064__b1953273115434">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword1637326185318">*</span></span>Leaf1-bgp-instance-evpn1] <strong id="EN-US_TASK_0000001561023064__b12532143115434">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword4388142717538">*</span></span>Leaf1] <strong id="EN-US_TASK_0000001561023064__b2053293118432">commit</strong></pre>
<p id="EN-US_TASK_0000001561023064__p19896326171114">The configurations of Leaf2, Leaf3, and Leaf4 are similar to the configuration of Leaf1. For detailed configurations, see Configuration Scripts. </p>
</p></li></ol>
</li><li id="EN-US_TASK_0000001561023064__step311602197175357"><span id="EN-US_TASK_0000001561023064__cmd1532993593175357">Configure BGP EVPN on Leaf2 and Leaf3 to create a VXLAN tunnel.</span><ol type="a" id="EN-US_TASK_0000001561023064__substeps8858228629"><li class="substepexpand" id="EN-US_TASK_0000001561023064__substep1285832812210"><span id="EN-US_TASK_0000001561023064__cmd17858142819215">Configure BGP EVPN peer relationships on leaf nodes.</span><p><p id="EN-US_TASK_0000001561023064__p1432913883175357"># Configure Leaf2.</p>
<pre class="screen" id="EN-US_TASK_0000001561023064__screen1652393533175357">[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword1096643320133"><font style="font-size:8pt" Face="Courier New" >~</font></span></span>Leaf2] <strong id="EN-US_TASK_0000001561023064__b1932530097175357">bgp 100 instance evpn1</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword673561217155">*</span></span>Leaf2-bgp-instance-evpn1] <strong id="EN-US_TASK_0000001561023064__b2135804370175357">peer 7.7.7.7 as-number 100</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword2936131551512">*</span></span>Leaf2-bgp-instance-evpn1] <strong id="EN-US_TASK_0000001561023064__b1841979429175357">peer 7.7.7.7 connect-interface LoopBack1</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword94720207154">*</span></span>Leaf2-bgp-instance-evpn1] <strong id="EN-US_TASK_0000001561023064__b1622299519175357">l2vpn-family evpn</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword7299024121510">*</span></span>Leaf2-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001561023064__b2131851966175357">peer 7.7.7.7 enable</strong>
Warning: This operation will reset the peer session. Continue? [Y/N]: <strong id="EN-US_TASK_0000001561023064__b1377707441175357">y</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword2071029121517">*</span></span>Leaf2-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001561023064__b822438509175357">peer 7.7.7.7 advertise irb</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword2092653091517">*</span></span>Leaf2-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001561023064__b652317741175357">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword84521433151513">*</span></span>Leaf2-bgp-instance-evpn1] <strong id="EN-US_TASK_0000001561023064__b1691179690175357">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword1724783541520">*</span></span>Leaf2] <strong id="EN-US_TASK_0000001561023064__b878038943175357">commit</strong></pre>
<p id="EN-US_TASK_0000001561023064__p1000262707175357"># Configure Leaf3.</p>
<pre class="screen" id="EN-US_TASK_0000001561023064__screen87780475175357">[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword1225323991312"><font style="font-size:8pt" Face="Courier New" >~</font></span></span>Leaf3] <strong id="EN-US_TASK_0000001561023064__b942859228175357">bgp 100 instance evpn1</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword15241339131516">*</span></span>Leaf3-bgp-instance-evpn1] <strong id="EN-US_TASK_0000001561023064__b365352658175357">peer 6.6.6.6 as-number 100</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword2083774091519">*</span></span>Leaf3-bgp-instance-evpn1] <strong id="EN-US_TASK_0000001561023064__b609569818175357">peer 6.6.6.6 connect-interface LoopBack1</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword4483134391514">*</span></span>Leaf3-bgp-instance-evpn1] <strong id="EN-US_TASK_0000001561023064__b997598996175357">l2vpn-family evpn</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword1095524451518">*</span></span>Leaf3-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001561023064__b309395813175357">peer 6.6.6.6 enable</strong>
Warning: This operation will reset the peer session. Continue? [Y/N]: <strong id="EN-US_TASK_0000001561023064__b2078032415175357">y</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword9747184741512">*</span></span>Leaf3-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001561023064__b1045088285175357">peer 6.6.6.6 advertise irb</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword81491949171512">*</span></span>Leaf3-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001561023064__b2131352514175357">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword563818500151">*</span></span>Leaf3-bgp-instance-evpn1] <strong id="EN-US_TASK_0000001561023064__b1793710890175357">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword1358115219152">*</span></span>Leaf3] <strong id="EN-US_TASK_0000001561023064__b1248597135175357">commit</strong></pre>
</p></li><li class="substepexpand" id="EN-US_TASK_0000001561023064__substep312736113175357"><span id="EN-US_TASK_0000001561023064__cmd1263366982175357">Configure the function to advertise the re-originated EVPN IRB routes and IP prefix routes.</span><p><p id="EN-US_TASK_0000001561023064__p2065943652175357"># Configure Leaf2.</p>
<pre class="screen" id="EN-US_TASK_0000001561023064__screen1417010338310">[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword13415742161317"><font style="font-size:8pt" Face="Courier New" >~</font></span></span>Leaf2] <strong id="EN-US_TASK_0000001561023064__b20200533638">bgp 100 instance evpn1</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword614574719173"><font style="font-size:8pt" Face="Courier New" >~</font></span></span>Leaf2-bgp-instance-evpn1] <strong id="EN-US_TASK_0000001561023064__b5201123313318">l2vpn-family evpn</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword3405249131712"><font style="font-size:8pt" Face="Courier New" >~</font></span></span>Leaf2-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001561023064__b12201113310316">peer 5.5.5.5 import reoriginate</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword329007101616">*</span></span>Leaf2-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001561023064__b72012337318">peer 5.5.5.5 advertise route-reoriginated evpn mac-ip</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword3777686165">*</span></span>Leaf2-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001561023064__b112016331532">peer 5.5.5.5 advertise route-reoriginated evpn ip</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword914313106163">*</span></span>Leaf2-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001561023064__b1320133316317">peer 7.7.7.7 import reoriginate</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword1635811201616">*</span></span>Leaf2-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001561023064__b22011334320">peer 7.7.7.7 advertise route-reoriginated evpn mac-ip</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword1811961319169">*</span></span>Leaf2-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001561023064__b92011331635">peer 7.7.7.7 advertise route-reoriginated evpn ip</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword554117141162">*</span></span>Leaf2-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001561023064__b6201133132">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword10802181521615">*</span></span>Leaf2-bgp-instance-evpn1] <strong id="EN-US_TASK_0000001561023064__b1420193315313">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword1756431719169">*</span></span>Leaf2] <strong id="EN-US_TASK_0000001561023064__b192012338318">commit</strong></pre>
<p id="EN-US_TASK_0000001561023064__p440535960175357"># Configure Leaf3.</p>
<pre class="screen" id="EN-US_TASK_0000001561023064__screen1625816479317">[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword1910674616135"><font style="font-size:8pt" Face="Courier New" >~</font></span></span>Leaf3] <strong id="EN-US_TASK_0000001561023064__b62679477311">bgp 100 instance evpn1</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword3211132161613">*</span></span>Leaf3-bgp-instance-evpn1] <strong id="EN-US_TASK_0000001561023064__b72681471239">l2vpn-family evpn</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword44241225160">*</span></span>Leaf3-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001561023064__b182682477318">peer 8.8.8.8 import reoriginate</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword1180952318160">*</span></span>Leaf3-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001561023064__b42682476316">peer 8.8.8.8 advertise route-reoriginated evpn mac-ip</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword8205182516163">*</span></span>Leaf3-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001561023064__b326815471937">peer 8.8.8.8 advertise route-reoriginated evpn ip</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword1362413261160">*</span></span>Leaf3-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001561023064__b22681476310">peer 6.6.6.6 import reoriginate</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword1399611275168">*</span></span>Leaf3-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001561023064__b92681471432">peer 6.6.6.6 advertise route-reoriginated evpn mac-ip</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword83751829111612">*</span></span>Leaf3-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001561023064__b926812475314">peer 6.6.6.6 advertise route-reoriginated evpn ip</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword4619230131613">*</span></span>Leaf3-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001561023064__b926810471935">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword9131832141615">*</span></span>Leaf3-bgp-instance-evpn1] <strong id="EN-US_TASK_0000001561023064__b22684471734">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword853013333166">*</span></span>Leaf3] <strong id="EN-US_TASK_0000001561023064__b1326817471534">commit</strong></pre>
</p></li></ol>
</li><li id="EN-US_TASK_0000001561023064__step2051256197175357"><span id="EN-US_TASK_0000001561023064__cmd1907917688175357">Specify Leaf1 and Leaf3 as RR clients of Leaf2. Specify Leaf4 and Leaf2 as RR clients of Leaf3.</span><p><p id="EN-US_TASK_0000001561023064__p644851451175357">Configure Leaf2.</p>
<pre class="screen" id="EN-US_TASK_0000001561023064__screen20880153617">[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword438550121314"><font style="font-size:8pt" Face="Courier New" >~</font></span></span>Leaf2] <strong id="EN-US_TASK_0000001561023064__b8894251167">bgp 100 instance evpn1</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword1972012599171"><font style="font-size:8pt" Face="Courier New" >~</font></span></span>Leaf2-bgp-instance-evpn1] <strong id="EN-US_TASK_0000001561023064__b188943518615">l2vpn-family evpn</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword102461110184"><font style="font-size:8pt" Face="Courier New" >~</font></span></span>Leaf2-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001561023064__b1389415366">peer 5.5.5.5 reflect-client</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword875319387163">*</span></span>Leaf2-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001561023064__b198942512618">peer 7.7.7.7 reflect-client</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword683014402167">*</span></span>Leaf2-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001561023064__b38948514617">undo policy vpn-target</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword532104251612">*</span></span>Leaf2-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001561023064__b689410510614">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword136861443171612">*</span></span>Leaf2-bgp-instance-evpn1] <strong id="EN-US_TASK_0000001561023064__b118941851765">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword1020264571615">*</span></span>Leaf2] <strong id="EN-US_TASK_0000001561023064__b12894135767">commit</strong></pre>
<p id="EN-US_TASK_0000001561023064__p358748391175357">Configure Leaf3.</p>
<pre class="screen" id="EN-US_TASK_0000001561023064__screen191419141861">[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword1549185391310"><font style="font-size:8pt" Face="Courier New" >~</font></span></span>Leaf3] <strong id="EN-US_TASK_0000001561023064__b52218141561">bgp 100 instance evpn1</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword73674511813"><font style="font-size:8pt" Face="Courier New" >~</font></span></span>Leaf3-bgp-instance-evpn1] <strong id="EN-US_TASK_0000001561023064__b18226144616">l2vpn-family evpn</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword198115619183"><font style="font-size:8pt" Face="Courier New" >~</font></span></span>Leaf3-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001561023064__b1022514661">peer 8.8.8.8 reflect-client</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword1836784841619">*</span></span>Leaf3-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001561023064__b8221814461">peer 6.6.6.6 reflect-client</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword13964164991617">*</span></span>Leaf3-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001561023064__b162217142619">undo policy vpn-target</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword55601351121620">*</span></span>Leaf3-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001561023064__b202213147619">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword158691152111616">*</span></span>Leaf3-bgp-instance-evpn1] <strong id="EN-US_TASK_0000001561023064__b1122161412616">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword7940654201617">*</span></span>Leaf3] <strong id="EN-US_TASK_0000001561023064__b6224141664">commit</strong></pre>
</p></li><li id="EN-US_TASK_0000001561023064__step1922111910151"><span id="EN-US_TASK_0000001561023064__cmd1322101914159">Configure and apply a routing policy on each leaf node.</span><p><p id="EN-US_TASK_0000001561023064__p182211910158">Configure a routing policy on Leaf1 to accept only the routes whose next hop is a local DCI leaf node (Leaf2), and apply the routing policy. The configuration of Leaf4 is similar to the configuration of Leaf1. For detailed configurations, see Configuration Scripts.</p>
<pre class="screen" id="EN-US_TASK_0000001561023064__screen67980364916">[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword12946356141319"><font style="font-size:8pt" Face="Courier New" >~</font></span></span>Leaf1] <strong id="EN-US_TASK_0000001561023064__b118076366912">ip ip-prefix DCI index 10 permit 6.6.6.6 32</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword11146175817161">*</span></span>Leaf1] <strong id="EN-US_TASK_0000001561023064__b1080753617918">route-policy DCI permit node 10</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword1751785901618">*</span></span>Leaf1-route-policy] <strong id="EN-US_TASK_0000001561023064__b08078361692">if-match ip next-hop ip-prefix DCI</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword76493061714">*</span></span>Leaf1-route-policy] <strong id="EN-US_TASK_0000001561023064__b1480714362915">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword124714231712">*</span></span>Leaf1] <strong id="EN-US_TASK_0000001561023064__b1080793612911">bgp 100 instance evpn1</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword38763321719">*</span></span>Leaf1-bgp-instance-evpn1] <strong id="EN-US_TASK_0000001561023064__b128076360911">l2vpn-family evpn</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword101151755174">*</span></span>Leaf1-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001561023064__b88072036195">peer 6.6.6.6 route-policy DCI import</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword1495146161710">*</span></span>Leaf1-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001561023064__b98081136497">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword578110713172">*</span></span>Leaf1-bgp-instance-evpn1] <strong id="EN-US_TASK_0000001561023064__b280853616914">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword1927459191717">*</span></span>Leaf1] <strong id="EN-US_TASK_0000001561023064__b580823614915">commit</strong></pre>
<p id="EN-US_TASK_0000001561023064__p425719141519">Configure a routing policy on Leaf2 to accept only the routes whose next hop is a remote DCI leaf node (Leaf3), and apply the routing policy. The configuration of Leaf3 is similar to the configuration of Leaf2. For detailed configurations, see Configuration Scripts.</p>
<pre class="screen" id="EN-US_TASK_0000001561023064__screen568112447915">[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword19076016144"><font style="font-size:8pt" Face="Courier New" >~</font></span></span>Leaf2] <strong id="EN-US_TASK_0000001561023064__b868912441190">ip ip-prefix DCI index 10 permit 7.7.7.7 32</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword127731511161713">*</span></span>Leaf2] <strong id="EN-US_TASK_0000001561023064__b14689844897">route-policy DCI permit node 10</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword74071213161711">*</span></span>Leaf2-route-policy] <strong id="EN-US_TASK_0000001561023064__b186909442912">if-match ip next-hop ip-prefix DCI</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword1253515142178">*</span></span>Leaf2-route-policy] <strong id="EN-US_TASK_0000001561023064__b16690134411919">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword1670210159171">*</span></span>Leaf2] <strong id="EN-US_TASK_0000001561023064__b069024410917">bgp 100 instance evpn1</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword1018319176176">*</span></span>Leaf2-bgp-instance-evpn1] <strong id="EN-US_TASK_0000001561023064__b9690944397">l2vpn-family evpn</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword6393118161713">*</span></span>Leaf2-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001561023064__b16907441498">peer 7.7.7.7 route-policy DCI import</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword454031911718">*</span></span>Leaf2-bgp-instance-evpn1-af-evpn] <strong id="EN-US_TASK_0000001561023064__b19690444892">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword12718320191720">*</span></span>Leaf2-bgp-instance-evpn1] <strong id="EN-US_TASK_0000001561023064__b969010441498">quit</strong>
[<span><span class="keyword" id="EN-US_TASK_0000001561023064__keyword12205112241719">*</span></span>Leaf2] <strong id="EN-US_TASK_0000001561023064__b369084414913">commit</strong></pre>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0000001561023064__example121226172748"><a name="EN-US_TASK_0000001561023064__1.3.4"></a><a name="1.3.4"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p id="EN-US_TASK_0000001561023064__p165203214175357">Run the <a href="cmdqueryname=display+vxlan+tunnel"><b><span class="cmdname" id="EN-US_TASK_0000001561023064__cmdname781044431175357">display vxlan tunnel</span></b></a> command on leaf nodes to check information about the VXLAN tunnels. The following uses the command output on Leaf2 as an example.</p>
<pre class="screen" id="EN-US_TASK_0000001561023064__screen210123341175357">[<span class="keyword" id="EN-US_TASK_0000001561023064__keyword5605144715710"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf2] <strong id="EN-US_TASK_0000001561023064__b149992972175357">display vxlan tunnel</strong>
Number of vxlan tunnel : 2
Tunnel ID   Source                Destination           State  Type     Uptime
-----------------------------------------------------------------------------------
4026531841  6.6.6.6               5.5.5.5               up     dynamic  0035h21m
4026531842  6.6.6.6               7.7.7.7               up     dynamic  0035h25m</pre>
<p id="EN-US_TASK_0000001561023064__p1302076093175357">After the configurations are complete, VMa1 and VMb2 can communicate with each other.</p>
</div>
<div class="postreq"><a name="EN-US_TASK_0000001561023064__1.3.5"></a><a name="1.3.5"></a><h4 class="sectiontitle">Configuration Scripts</h4><ul id="EN-US_TASK_0000001561023064__ul462679508175357"><li id="EN-US_TASK_0000001561023064__li217944659175357"><p id="EN-US_TASK_0000001561023064__p1536265678175357"><a name="EN-US_TASK_0000001561023064__li217944659175357"></a><a name="li217944659175357"></a>Spine1</p>
<pre class="screen" id="EN-US_TASK_0000001561023064__screen610704939175357">#
sysname Spine1
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 192.168.10.1 255.255.255.0
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ip address 192.168.20.1 255.255.255.0
#
interface LoopBack1
 ip address 3.3.3.3 255.255.255.255
#
ospf 1
 area 0.0.0.0
  network 3.3.3.3 0.0.0.0
  network 192.168.10.0 0.0.0.255
  network 192.168.20.0 0.0.0.255
#
return </pre>
</li><li id="EN-US_TASK_0000001561023064__li1803495196175357"><p id="EN-US_TASK_0000001561023064__p1759565414175357"><a name="EN-US_TASK_0000001561023064__li1803495196175357"></a><a name="li1803495196175357"></a>Leaf1</p>
<pre class="screen" id="EN-US_TASK_0000001561023064__screen1397527812175357">#
sysname Leaf1
#
evpn-overlay enable
#
ip vpn-instance vpn1
 ipv4-family
  route-distinguisher 20:1
  vpn-target 100:5010 export-extcommunity evpn
  vpn-target 100:5010 import-extcommunity evpn
 vxlan vni 5010
#
bridge-domain 10
 vxlan vni 10
 #
 evpn
  route-distinguisher 10:1
  vpn-target 100:10 export-extcommunity
  vpn-target 100:5010 export-extcommunity
  vpn-target 100:10 import-extcommunity
#
interface Vbdif10
 ip binding vpn-instance vpn1
 ip address 10.10.1.1 255.255.255.0
 vxlan anycast-gateway enable
 arp collect host enable
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 192.168.10.2 255.255.255.0
#
interface <span>100GE</span><span>1/0/2</span>.1 mode l2
 encapsulation dot1q vid 10
 bridge-domain 10
#
interface LoopBack1
 ip address 5.5.5.5 255.255.255.255
#
interface Nve1
 source 5.5.5.5
 vni 10 head-end peer-list protocol bgp
#
bgp 100 instance evpn1
 peer 6.6.6.6 as-number 100
 peer 6.6.6.6 connect-interface LoopBack1
 #
 l2vpn-family evpn
  policy vpn-target
  peer 6.6.6.6 enable
  peer 6.6.6.6 route-policy DCI import
  peer 6.6.6.6 advertise irb
#
ospf 1
 area 0.0.0.0
  network 5.5.5.5 0.0.0.0
  network 192.168.10.0 0.0.0.255
#
ip ip-prefix DCI index 10 permit 6.6.6.6 32                                 
# 
route-policy DCI permit node 10                                                 
 if-match ip next-hop ip-prefix DCI                                             
#                                                                               
return  </pre>
</li><li id="EN-US_TASK_0000001561023064__li1303155144175357"><p id="EN-US_TASK_0000001561023064__p2090273102175357"><a name="EN-US_TASK_0000001561023064__li1303155144175357"></a><a name="li1303155144175357"></a>Leaf2</p>
<pre class="screen" id="EN-US_TASK_0000001561023064__screen971167098175357">#
sysname Leaf2
#
evpn-overlay enable
#
ip vpn-instance vpn1
 ipv4-family
  route-distinguisher 20:2
  vpn-target 100:5010 export-extcommunity evpn
  vpn-target 300:5010 export-extcommunity evpn
  vpn-target 100:5010 import-extcommunity evpn
  vpn-target 300:5010 import-extcommunity evpn
 vxlan vni 5010
#
bridge-domain 20
 vxlan vni 20
 #
 evpn
  route-distinguisher 10:2
  vpn-target 100:20 export-extcommunity
  vpn-target 100:5010 export-extcommunity
  vpn-target 300:5010 export-extcommunity
  vpn-target 100:20 import-extcommunity
#
interface Vbdif20
 ip binding vpn-instance vpn1
 ip address 10.20.1.1 255.255.255.0
 vxlan anycast-gateway enable
 arp collect host enable
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 192.168.20.2 255.255.255.0
#
interface <span>100GE</span><span>1/0/2</span>.1 mode l2
 encapsulation dot1q vid 20
 bridge-domain 20
#
interface <span>100GE</span><span>1/0/3</span>
 undo portswitch
 ip address 192.168.50.2 255.255.255.0
#
interface LoopBack1
 ip address 6.6.6.6 255.255.255.255
#
interface Nve1
 source 6.6.6.6
 vni 20 head-end peer-list protocol bgp
#
bgp 20
 peer 192.168.50.1 as-number 10
 #
 ipv4-family unicast
  network 6.6.6.6 255.255.255.255
  peer 192.168.50.1 enable
#
bgp 100 instance evpn1
 peer 5.5.5.5 as-number 100
 peer 5.5.5.5 connect-interface LoopBack1
 peer 7.7.7.7 as-number 100
 peer 7.7.7.7 connect-interface LoopBack1
 #
 l2vpn-family evpn
  undo policy vpn-target
  peer 5.5.5.5 enable
  peer 5.5.5.5 advertise irb
  peer 5.5.5.5 reflect-client
  peer 5.5.5.5 import reoriginate
  peer 5.5.5.5 advertise route-reoriginated evpn mac-ip
  peer 5.5.5.5 advertise route-reoriginated evpn ip
  peer 7.7.7.7 enable
  peer 7.7.7.7 route-policy DCI import  
  peer 7.7.7.7 advertise irb
  peer 7.7.7.7 reflect-client
  peer 7.7.7.7 import reoriginate
  peer 7.7.7.7 advertise route-reoriginated evpn mac-ip
  peer 7.7.7.7 advertise route-reoriginated evpn ip
#
ospf 1          
 area 0.0.0.0   
  network 6.6.6.6 0.0.0.0
  network 192.168.20.0 0.0.0.255
#
ip ip-prefix DCI index 10 permit 7.7.7.7 32                                 
# 
route-policy DCI permit node 10                                                 
 if-match ip next-hop ip-prefix DCI                                             
#                                                                               
return  </pre>
</li><li id="EN-US_TASK_0000001561023064__li1335114827175357"><p id="EN-US_TASK_0000001561023064__p218269886175357"><a name="EN-US_TASK_0000001561023064__li1335114827175357"></a><a name="li1335114827175357"></a>Spine2</p>
<pre class="screen" id="EN-US_TASK_0000001561023064__screen48750128175357">#
sysname Spine2
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 192.168.30.1 255.255.255.0
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ip address 192.168.40.1 255.255.255.0
#               
interface LoopBack1
 ip address 4.4.4.4 255.255.255.255
#               
ospf 1          
 area 0.0.0.0   
  network 4.4.4.4 0.0.0.0
  network 192.168.30.0 0.0.0.255
  network 192.168.40.0 0.0.0.255
#               
return</pre>
</li><li id="EN-US_TASK_0000001561023064__li785756895175357"><p id="EN-US_TASK_0000001561023064__p1339188862175357"><a name="EN-US_TASK_0000001561023064__li785756895175357"></a><a name="li785756895175357"></a>Leaf3</p>
<pre class="screen" id="EN-US_TASK_0000001561023064__screen252432175175357">#
sysname Leaf3
#
evpn-overlay enable
#
ip vpn-instance vpn1
 ipv4-family
  route-distinguisher 20:3
  vpn-target 200:5010 export-extcommunity evpn
  vpn-target 300:5010 export-extcommunity evpn
  vpn-target 200:5010 import-extcommunity evpn
  vpn-target 300:5010 import-extcommunity evpn
 vxlan vni 5010
#
bridge-domain 10
 vxlan vni 10
 #
 evpn 
  route-distinguisher 10:3
  vpn-target 200:10 export-extcommunity
  vpn-target 200:5010 export-extcommunity
  vpn-target 300:5010 export-extcommunity
  vpn-target 200:10 import-extcommunity
#
interface Vbdif10
 ip binding vpn-instance vpn1
 ip address 10.30.1.1 255.255.255.0
 vxlan anycast-gateway enable
 arp collect host enable
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 192.168.30.2 255.255.255.0
#
interface <span>100GE</span><span>1/0/2</span>.1 mode l2
 encapsulation dot1q vid 10
 bridge-domain 10
#
interface <span>100GE</span><span>1/0/3</span>
 undo portswitch
 ip address 192.168.60.2 255.255.255.0
#               
interface LoopBack1
 ip address 7.7.7.7 255.255.255.255
#               
interface Nve1  
 source 7.7.7.7 
 vni 10 head-end peer-list protocol bgp
#
bgp 30
 peer 192.168.60.1 as-number 10
#
 ipv4-family unicast
  network 7.7.7.7 255.255.255.255
  peer 192.168.60.1 enable
#
bgp 100 instance evpn1
 peer 6.6.6.6 as-number 100
 peer 6.6.6.6 connect-interface LoopBack1
 peer 8.8.8.8 as-number 100
 peer 8.8.8.8 connect-interface LoopBack1
#
 l2vpn-family evpn
  undo policy vpn-target
  peer 6.6.6.6 enable
  peer 6.6.6.6 route-policy DCI import
  peer 6.6.6.6 advertise irb
  peer 6.6.6.6 reflect-client
  peer 6.6.6.6 import reoriginate
  peer 6.6.6.6 advertise route-reoriginated evpn mac-ip
  peer 6.6.6.6 advertise route-reoriginated evpn ip
  peer 8.8.8.8 enable
  peer 8.8.8.8 advertise irb
  peer 8.8.8.8 reflect-client
  peer 8.8.8.8 import reoriginate
  peer 8.8.8.8 advertise route-reoriginated evpn mac-ip
  peer 8.8.8.8 advertise route-reoriginated evpn ip
#
ospf 1          
 area 0.0.0.0   
  network 7.7.7.7 0.0.0.0
  network 192.168.30.0 0.0.0.255
#
ip ip-prefix DCI index 10 permit 6.6.6.6 32                                 
# 
route-policy DCI permit node 10                                                 
 if-match ip next-hop ip-prefix DCI                                             
#                                                                               
return</pre>
</li><li id="EN-US_TASK_0000001561023064__li715490911175357"><p id="EN-US_TASK_0000001561023064__p1494801624175357"><a name="EN-US_TASK_0000001561023064__li715490911175357"></a><a name="li715490911175357"></a>Leaf4</p>
<pre class="screen" id="EN-US_TASK_0000001561023064__screen781540169175357">#
sysname Leaf4
#
evpn-overlay enable
#
ip vpn-instance vpn1
 ipv4-family
  route-distinguisher 20:4
  vpn-target 200:5010 export-extcommunity evpn
  vpn-target 200:5010 import-extcommunity evpn
 vxlan vni 5010
#
bridge-domain 20
 vxlan vni 20
 #
 evpn 
  route-distinguisher 10:4
  vpn-target 200:20 export-extcommunity
  vpn-target 200:5010 export-extcommunity
  vpn-target 200:20 import-extcommunity
#
interface Vbdif20
 ip binding vpn-instance vpn1
 ip address 10.40.1.1 255.255.255.0
 vxlan anycast-gateway enable
 arp collect host enable
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 192.168.40.2 255.255.255.0
#
interface <span>100GE</span><span>1/0/2</span>.1 mode l2
 encapsulation dot1q vid 20
 bridge-domain 20
#               
interface LoopBack1
 ip address 8.8.8.8 255.255.255.255
#               
interface Nve1  
 source 8.8.8.8 
 vni 20 head-end peer-list protocol bgp
#               
bgp 100 instance evpn1
 peer 7.7.7.7 as-number 100
 peer 7.7.7.7 connect-interface LoopBack1
 #              
 l2vpn-family evpn
  policy vpn-target
  peer 7.7.7.7 enable
  peer 7.7.7.7 route-policy DCI import
  peer 7.7.7.7 advertise irb
#               
ospf 1          
 area 0.0.0.0   
  network 8.8.8.8 0.0.0.0
  network 192.168.40.0 0.0.0.255
#
ip ip-prefix DCI index 10 permit 7.7.7.7 32 
#
route-policy DCI permit node 10                                                 
 if-match ip next-hop ip-prefix DCI                                             
#                                                                               
return</pre>
</li><li id="EN-US_TASK_0000001561023064__li89900611175357"><p id="EN-US_TASK_0000001561023064__en-us_task_0141119119_p1949246415175357"><a name="EN-US_TASK_0000001561023064__li89900611175357"></a><a name="li89900611175357"></a>Device1</p>
<pre class="screen" id="EN-US_TASK_0000001561023064__en-us_task_0141119119_screen2094003368175357">#
sysname Device1
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 192.168.50.1 255.255.255.0
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ip address 192.168.1.1 255.255.255.0
#               
interface LoopBack1
 ip address 1.1.1.1 255.255.255.255
#
bgp 10
 peer 192.168.1.2 as-number 10
 peer 192.168.50.2 as-number 20
#
 ipv4-family unicast
  peer 192.168.1.2 enable
  peer 192.168.1.2 next-hop-local
  peer 192.168.50.2 enable
#
return </pre>
</li><li id="EN-US_TASK_0000001561023064__li1124549570175357"><p id="EN-US_TASK_0000001561023064__en-us_task_0141119119_p1808229795175357"><a name="EN-US_TASK_0000001561023064__li1124549570175357"></a><a name="li1124549570175357"></a>Device2</p>
<pre class="screen" id="EN-US_TASK_0000001561023064__en-us_task_0141119119_screen1479339046175357">#
sysname Device2
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 192.168.60.1 255.255.255.0
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ip address 192.168.1.2 255.255.255.0
#               
interface LoopBack1
 ip address 2.2.2.2 255.255.255.255
#
bgp 10
 peer 192.168.1.1 as-number 10
 peer 192.168.60.2 as-number 30
#
 ipv4-family unicast
  peer 192.168.1.1 enable
  peer 192.168.1.1 next-hop-local
  peer 192.168.60.2 enable
#
return </pre>
</li></ul>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../vrp/dc_vrp_vxlan_cfg_1231.html">Configuring Segment VXLAN for Layer 3 Interworking
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../vrp/dc_vrp_vxlan_cfg_1261.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../vrp/dc_vrp_vxlan_cfg_1263.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>