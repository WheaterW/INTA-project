
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Rolling Back Configurations">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="vrp_cfgfile_cfg_0004.html">
<meta name="DC.Relation" scheme="URI" content="vrp_cfgfile_cfg_0021.html">
<meta name="DC.Relation" scheme="URI" content="vrp_cfgfile_cfg_0031.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="Configuration File Management">
<meta name="featuretype" content="Basic Configuration">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="Configuration File Management">
<meta name="featuretype" content="Basic Configuration">
<meta name="featurename" content="Configuration File Management">
<meta name="featuretype" content="Basic Configuration">
<meta name="featuretype" content="Basic Configuration">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001513170282">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>Rolling Back Configurations</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001513170282"></a><a name="EN-US_TASK_0000001513170282"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Rolling Back Configurations</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001513170282__1.3.1"></a><a name="1.3.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>If faults are caused by incorrect configurations, or if an unexpected configuration result is generated on the network, you can roll back configurations.</p>
<p>After you run a command and press <strong>Enter</strong>, the system checks whether the current configurations are the same as the previous ones. If they are different, the system commits the current configurations.</p>
<div class="p">A configuration rollback point is generated using the following methods before the configuration rollback function is used:<ul><li>A configuration rollback point is automatically generated after the <strong>commit</strong> command is executed to commit a configuration. The function of automatically generating a configuration rollback point is enabled by default. To disable this function, run the <a href="cmdqueryname=configuration+checkpoint+auto-save+disable"><b><span class="cmdname">configuration checkpoint auto-save disable</span></b></a> command in the system view. After this command is run, no configuration rollback point is automatically generated when the <strong>commit</strong> command is executed.</li><li>To enable the time when a rollback point is automatically generated, run the <a href="cmdqueryname=set+save-configuration+checkpoint+daily"><b><span class="cmdname">set save-configuration checkpoint daily</span></b></a> <strong><span>time</span></strong> <i><span class="varname">time</span></i> command in the system view. By default, the function of periodically generating configuration rollback points is disabled.</li><li>After a series of configuration commands are configured, run the <a href="cmdqueryname=commit+label"><b><span class="cmdname">commit label</span></b></a> <i><span class="varname">label</span></i> [ <strong><span>description</span></strong> <i><span class="varname">description</span></i> ] command. The system generates a user label for the current configuration rollback point. You can specify <em>description</em> in the command to add brief description for a configuration rollback point, allowing rapid locating of a desired configuration rollback point.</li></ul>
</div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001513170282__1.3.2"></a><a name="1.3.2"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Check the configuration rollback points and the latest configuration changes.</span><p><p>For details, see <a href="#EN-US_TASK_0000001513170282__table13897184015814">Table 1</a>.</p>
</p><p>
<div class="tableBorder"><a name="EN-US_TASK_0000001513170282__table13897184015814"></a><a name="table13897184015814"></a><table cellpadding="4" cellspacing="0" summary="" id="EN-US_TASK_0000001513170282__table13897184015814" frame="border" border="1" rules="all"><caption><b>Table 1 </b>Checking configuration rollback points</caption><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="33.33333333333333%" id="mcps1.3.2.1.3.1.2.4.1.1" liSelected="liSelected"><p>Operation</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="33.33333333333333%" id="mcps1.3.2.1.3.1.2.4.1.2" liSelected="liSelected"><p>Command</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="33.33333333333333%" id="mcps1.3.2.1.3.1.2.4.1.3" liSelected="liSelected"><p>Description</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.2.1.3.1.2.4.1.1 "><p>Check all configuration rollback points.</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.2.1.3.1.2.4.1.2 "><p><a href="cmdqueryname=display+configuration+commit+list"><b><span class="cmdname">display configuration commit list</span></b></a> [ <strong><span>verbose</span></strong> ] [ <i><span class="varname">number-of-commits</span></i><span> | <strong><span>label</span></strong></span> ]</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.2.1.3.1.2.4.1.3 "><p>This command displays configuration rollback points and their details.</p>
<p>To check a specified number of latest configuration rollback points, specify <i><span class="varname">number-of-commits</span></i>.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.2.1.3.1.2.4.1.1 "><p>Check the configuration change of a specified configuration rollback point.</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.2.1.3.1.2.4.1.2 "><p><a href="cmdqueryname=display+configuration+commit+changes"><b><span class="cmdname">display configuration commit changes</span></b></a> [ <strong><span>at</span></strong> <i><span class="varname">commit-id</span></i> | <strong><span>since</span></strong> <i><span class="varname">commit-id</span></i> | [ <strong><span>last</span></strong> ] <i><span class="varname">number-of-commits</span></i> ]</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.2.1.3.1.2.4.1.3 "><div class="p">Based on the configuration change of a specified configuration rollback point, you can determine whether to roll back configurations and evaluate the impact of the configuration rollback on system performance.<ul><li><p>To check the configuration changes of all configuration rollback points, do not specify any parameters in the command.</p>
</li><li><p>To check the configuration change of a specified configuration rollback point, specify <strong><span>at</span></strong> <i><span class="varname">commit-id</span></i>.</p>
</li><li><p>To check the configuration change from a specified configuration rollback point to the current state, specify <strong><span>since</span></strong> <i><span class="varname">commit-id</span></i>.</p>
</li><li>To check a specified number of the latest configuration changes, specify [ <strong><span>last</span></strong> ] <i><span class="varname">number-of-commits</span></i>. If the <strong><span>last</span></strong> parameter is specified, the last configuration change is displayed. If the <strong><span>last</span></strong> parameter is not specified, each configuration change is displayed.</li></ul>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</p></li><li><span>Roll back the system to the historical configuration state<span> by specifying a configuration rollback point</span>.</span><p><pre class="screen"><span><a href="cmdqueryname=rollback+configuration"><b><span class="cmdname">rollback configuration</span></b></a> { <strong><span>to</span></strong> <span>{</span> <strong><span>commit-id</span></strong> <i><span class="varname">commit-id</span></i><span> | <strong><span>label</span></strong> <i><span class="varname">label</span></i> | <strong><span>file</span></strong> <i><span class="varname">file-name</span></i> } </span><span> | <strong><span>last</span></strong> <i><span class="varname">number-of-commits</span></i></span> }</span></pre>
</p><p><p>During configuration rollback, the created configuration will be deleted, the deleted configuration will be re-created, or the modified configuration will be restored to the original one.</p>
<ul><li><p>To roll back the system to the historical configuration state at a configuration rollback point, specify <strong><span>commit-id</span></strong> <i><span class="varname">commit-id</span></i>.</p>
<p></p>
</li><li><p>To roll back the system to the historical configuration state at a configuration rollback point with a specified user label, specify <strong><span>label</span></strong> <i><span class="varname">label</span></i>.</p>
</li><li><p>To roll back the system to the historical configuration state using a specified configuration file, specify <strong><span>file</span></strong> <i><span class="varname">file-name</span></i>.</p>
</li><li><p>To roll back the system to the historical configuration state before a specified number of latest configuration rollback points, specify <strong><span>last</span></strong> <i><span class="varname">number-of-commits</span></i>.</p>
</li></ul>
<div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Once configuration rollback is complete, run the <a href="cmdqueryname=display+configuration+rollback+result"><b><span class="cmdname">display configuration rollback result</span></b></a> command to view the result of this rollback. If multiple rollbacks are performed, this command displays the result of the latest one.</p>
</div></div>
</p></li><li><span>(Optional) Set the user label for a configuration rollback point.</span><p><pre class="screen"><a href="cmdqueryname=set+configuration+commit"><b><span class="cmdname">set configuration commit</span></b></a> <i><span class="varname">commit-id</span></i> <strong><span>label</span></strong> <i><span class="varname">label-string</span></i></pre>
<p>By default, no user label is set for a configuration rollback point.</p>
</p></li><li><span>(Optional) Delete the user label of the specified configuration rollback point or the earliest configuration rollback point list generated in the system.</span><p><pre class="screen"><a href="cmdqueryname=clear+configuration+commit"><b><span class="cmdname">clear configuration commit</span></b></a> { <i><span class="varname">commit-id</span></i> <strong><span>label</span></strong> | <strong><span>oldest</span></strong> <i><span class="varname">number-of-commits</span></i> }</pre>
</p></li><li><span>(Optional) Delete the configuration rollback point with a specified user label.</span><p><pre class="screen"><a href="cmdqueryname=clear+configuration+commit+label"><b><span class="cmdname">clear configuration commit label</span></b></a> <i><span class="varname">label-name</span></i></pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001513170282__1.3.3"></a><a name="1.3.3"></a><h4 class="sectiontitle">Example</h4><p>A user logs in to the device and finds that the configuration is incorrect. The user then rolls back the system using a backup configuration file.</p>
<ol><li>Check the name of the backup configuration file on the current device.<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>dir</strong>
Directory of <span>flash:/</span>

  Idx  Attr     Size(Byte)  Date        Time<span>     </span>  FileName
<samp class="codeph">    0  -rw-            889  Mar 01 2019 14:41:56   private-data.txt    </samp>
<samp class="codeph">    1  -rw-          6,311  Feb 17 2019 14:05:04   <strong>b</strong><strong>ackup.cfg
 </strong>   2  -rw-          2,393  Mar 06 2019 17:20:10   vrpcfg.zip    </samp>
<samp class="codeph">    3  -rw-            812  Nov 12 2019 15:43:10   hostkey    </samp>
<samp class="codeph">    4  drw-              -  Mar 01 2019 14:41:46   compatible    </samp>
<samp class="codeph">    5  -rw-            540  Nov 12 2019 15:43:12   serverkey...
<span>670,092 KB total (569,904 KB free)</span></samp></pre>
</li><li>Roll back the system using the backup configuration file.<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>rollback configuration to file backup.cfg</strong>
Warning: This operation will revert configuration changes to the file backup.cfg. 
Continue? [Y/N]:<strong>y</strong></pre>
</li><li>Verify the configuration.<p>Run the <strong>display current-configuration</strong> command to check whether the incorrect configuration still exists.</p>
</li></ol>
</div>
<div class="postreq"><a name="EN-US_TASK_0000001513170282__1.3.4"></a><a name="1.3.4"></a><h4 class="sectiontitle">Verifying the Configuration</h4><ul><li><p>Run the <a href="cmdqueryname=display+configuration+rollback+result"><b><span class="cmdname">display configuration rollback result</span></b></a> command to view information about the latest configuration rollback operation, including all prompts and failure messages.</p>
</li><li><p>Run the <a href="cmdqueryname=display+configuration+commit+at"><b><span class="cmdname">display configuration commit at</span></b></a> <em>commit-id</em> command to view all configuration information at the specified configuration rollback point.</p>
</li></ul>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="vrp_cfgfile_cfg_0004.html">Managing Configuration Files
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="vrp_cfgfile_cfg_0021.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="vrp_cfgfile_cfg_0031.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>