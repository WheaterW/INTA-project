
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="concept">
<meta name="DC.Title" content="VRRP Implementation">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="vrp_vrrp_cfg_0003.html">
<meta name="DC.Relation" scheme="URI" content="vrp_vrrp_cfg_0005.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="VRRP">
<meta name="featuretype" content="High Availability">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="VRRP">
<meta name="featuretype" content="High Availability">
<meta name="featurename" content="VRRP">
<meta name="featuretype" content="High Availability">
<meta name="featuretype" content="High Availability">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_CONCEPT_0000001130624270">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>VRRP Implementation</title>
</head>
<body><a name="EN-US_CONCEPT_0000001130624270"></a><a name="EN-US_CONCEPT_0000001130624270"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">VRRP Implementation</h1>
<div><div class="section" id="EN-US_CONCEPT_0000001130624270__section_dc_vrp_vrrp_feature_013001"><h4 class="sectiontitle">Transition Process of the VRRP States</h4><p id="EN-US_CONCEPT_0000001130624270__p272207031214008">Three states are defined in a VRRP state machine: Initialize, Master, and Backup. Only the device that is in the Master state can forward packets destined for the virtual IP address.</p>
<p id="EN-US_CONCEPT_0000001130624270__p1663780749214008"><a href="#EN-US_CONCEPT_0000001130624270__fig_dc_vrp_vrrp_feature_013001">Figure 1</a> shows the VRRP state transition.</p>
<div class="fignone" id="EN-US_CONCEPT_0000001130624270__fig_dc_vrp_vrrp_feature_013001"><a name="EN-US_CONCEPT_0000001130624270__fig_dc_vrp_vrrp_feature_013001"></a><a name="fig_dc_vrp_vrrp_feature_013001"></a><span class="figcap"><b>Figure 1 </b>Transition process of the VRRP states</span><br><span><img class="vsd" id="EN-US_CONCEPT_0000001130624270__image11926194813915" src="figure/en-us_image_0000001130624290.png" width="NaN" height="NaN"></span></div>

<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" id="EN-US_CONCEPT_0000001130624270__tab_dc_vrp_vrrp_feature_013001" frame="border" border="1" rules="all"><caption><b>Table 1 </b>VRRP states</caption><thead align="left"><tr id="EN-US_CONCEPT_0000001130624270__row2138551688214008"><th align="left" class="cellrowborder" valign="top" width="13.04%" id="mcps1.3.1.5.2.4.1.1" liSelected="liSelected"><p id="EN-US_CONCEPT_0000001130624270__p519631285214008">State</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="43.480000000000004%" id="mcps1.3.1.5.2.4.1.2" liSelected="liSelected"><p id="EN-US_CONCEPT_0000001130624270__p895074351214008">Description</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="43.480000000000004%" id="mcps1.3.1.5.2.4.1.3" liSelected="liSelected"><p id="EN-US_CONCEPT_0000001130624270__p359587015214008">Transition</p>
</th>
</tr>
</thead>
<tbody><tr id="EN-US_CONCEPT_0000001130624270__row249940609214008"><td class="cellrowborder" valign="top" width="13.04%" headers="mcps1.3.1.5.2.4.1.1 "><p id="EN-US_CONCEPT_0000001130624270__p844106719214008">Initialize</p>
</td>
<td class="cellrowborder" valign="top" width="43.480000000000004%" headers="mcps1.3.1.5.2.4.1.2 "><p id="EN-US_CONCEPT_0000001130624270__p57595376214008">VRRP is unavailable. A device in the Initialize state does not process VRRP Advertisement packets.</p>
<p id="EN-US_CONCEPT_0000001130624270__p786653328214008">A device usually enters the Initialize state when it starts or detects a fault.</p>
</td>
<td class="cellrowborder" valign="top" width="43.480000000000004%" headers="mcps1.3.1.5.2.4.1.3 "><div class="p" id="EN-US_CONCEPT_0000001130624270__p1428549980214008">After receiving an interface up event, a device changes its state as follows:<ul id="EN-US_CONCEPT_0000001130624270__ul1333940332214008"><li id="EN-US_CONCEPT_0000001130624270__li1688439348214008">It changes from Initialize to Master if it is an IP address owner with a priority of 255.</li><li id="EN-US_CONCEPT_0000001130624270__li1186080625214008">It changes from Initialize to Backup if it has a priority less than 255.</li></ul>
</div>
</td>
</tr>
<tr id="EN-US_CONCEPT_0000001130624270__row1995761891214008"><td class="cellrowborder" valign="top" width="13.04%" headers="mcps1.3.1.5.2.4.1.1 "><p id="EN-US_CONCEPT_0000001130624270__p1446596061214008">Master</p>
</td>
<td class="cellrowborder" valign="top" width="43.480000000000004%" headers="mcps1.3.1.5.2.4.1.2 "><div class="p" id="EN-US_CONCEPT_0000001130624270__p467275460214008">A VRRP device in the Master state performs the following operations:<ul id="EN-US_CONCEPT_0000001130624270__ul992095680214008"><li id="EN-US_CONCEPT_0000001130624270__li802279383214008">It sends a VRRP Advertisement packet each time the Adver_Interval timer expires.</li><li id="EN-US_CONCEPT_0000001130624270__li1464900522214008">It responds to an ARP request destined for a virtual IP address with an ARP reply carrying the virtual MAC address.</li><li id="EN-US_CONCEPT_0000001130624270__li1953098496214008">It forwards IP packets destined for the virtual MAC address.</li><li id="EN-US_CONCEPT_0000001130624270__li748859362214008">It allows a virtual IP address to be pinged by default.</li></ul>
</div>
</td>
<td class="cellrowborder" valign="top" width="43.480000000000004%" headers="mcps1.3.1.5.2.4.1.3 "><div class="p" id="EN-US_CONCEPT_0000001130624270__p1080140409214008">The device changes its state as follows:<ul id="EN-US_CONCEPT_0000001130624270__ul609702681214008"><li id="EN-US_CONCEPT_0000001130624270__li179741095214008">It changes from Master to Backup if the VRRP priority in a received VRRP packet is higher than the local VRRP priority.</li><li id="EN-US_CONCEPT_0000001130624270__li2145686366214008">It remains in the Master state if the VRRP priority in a received VRRP packet is the same as the local VRRP priority.</li><li id="EN-US_CONCEPT_0000001130624270__li1956185779214008">It changes from Backup to Initialize after it receives a Shutdown event, indicating that the VRRP-enabled interface has been shut down.</li></ul>
</div>
<div class="note" id="EN-US_CONCEPT_0000001130624270__note1749419772214008"><span class="notetitle"> NOTE: </span><div class="notebody"><p id="EN-US_CONCEPT_0000001130624270__p145080497263">If a device in the Master state receives a VRRP packet carrying a VRRP priority that is the same as the local VRRP priority, it compares the interface IP address carried in the packet with the local interface IP address. If the received interface IP address is larger, the device switches to the Backup state. Otherwise, the device remains in the Master state.</p>
</div></div>
</td>
</tr>
<tr id="EN-US_CONCEPT_0000001130624270__row466627953214008"><td class="cellrowborder" valign="top" width="13.04%" headers="mcps1.3.1.5.2.4.1.1 "><p id="EN-US_CONCEPT_0000001130624270__p1657371661214008">Backup</p>
</td>
<td class="cellrowborder" valign="top" width="43.480000000000004%" headers="mcps1.3.1.5.2.4.1.2 "><div class="p" id="EN-US_CONCEPT_0000001130624270__p2069822628214008">A VRRP device in the Backup state performs the following operations:<ul id="EN-US_CONCEPT_0000001130624270__ul721115542214008"><li id="EN-US_CONCEPT_0000001130624270__li838249837214008">It checks whether the master device is working properly based on the information in the VRRP Advertisement packets received from the master device.</li><li id="EN-US_CONCEPT_0000001130624270__li357167515214008">It does not respond to ARP requests destined for a virtual IP address.</li><li id="EN-US_CONCEPT_0000001130624270__li535097870214008">It discards the IP packets destined for a virtual MAC address.</li><li id="EN-US_CONCEPT_0000001130624270__li1003360204214008">It processes IP packets with the destination IP address being a virtual IP address according to the normal Layer 2 forwarding process.</li><li id="EN-US_CONCEPT_0000001130624270__li474796322214008">When receiving a packet carrying a VRRP priority lower than the local priority:<ul id="EN-US_CONCEPT_0000001130624270__ul30903452214008"><li id="EN-US_CONCEPT_0000001130624270__li1550630311214008">If the device is in preemption mode, it becomes the master after a specified preemption delay expires.</li><li id="EN-US_CONCEPT_0000001130624270__li1607476498214008">If the device is in non-preemption mode, it remains in the Backup state.</li></ul>
</li><li id="EN-US_CONCEPT_0000001130624270__li1871627055214008">It resets the Master_Down timer, but does not compare interface IP addresses if it receives a VRRP packet carrying a VRRP priority higher than or equal to the local one.</li></ul>
</div>
</td>
<td class="cellrowborder" valign="top" width="43.480000000000004%" headers="mcps1.3.1.5.2.4.1.3 "><p id="EN-US_CONCEPT_0000001130624270__p1198777125214008">The device changes its state as follows:</p>
<ul id="EN-US_CONCEPT_0000001130624270__ul1071860448214008"><li id="EN-US_CONCEPT_0000001130624270__li1134007208214008">It changes from Backup to Master after it receives a Master_Down timer timeout event.</li><li id="EN-US_CONCEPT_0000001130624270__li1658566177214008">It changes from Backup to Initialize after it receives a Shutdown event, indicating that the VRRP-enabled interface has been shut down.</li></ul>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="EN-US_CONCEPT_0000001130624270__section_dc_vrp_vrrp_feature_013002"><h4 class="sectiontitle">VRRP Working Process</h4><div class="p" id="EN-US_CONCEPT_0000001130624270__p1146571502214008">The VRRP working process is as follows:<ol id="EN-US_CONCEPT_0000001130624270__ol689488085214008"><li id="EN-US_CONCEPT_0000001130624270__li1400089326214008"><p id="EN-US_CONCEPT_0000001130624270__p1322981903214008"><a name="EN-US_CONCEPT_0000001130624270__li1400089326214008"></a><a name="li1400089326214008"></a>VRRP selects the master based on the priorities of devices in a VRRP group. The master device sends gratuitous ARP packets to notify devices or hosts that are connected to it of the virtual MAC address, and then starts forwarding packets.</p>
</li><li id="EN-US_CONCEPT_0000001130624270__li160015870214008"><p id="EN-US_CONCEPT_0000001130624270__p737201046214008"><a name="EN-US_CONCEPT_0000001130624270__li160015870214008"></a><a name="li160015870214008"></a>The master device periodically sends VRRP Advertisement packets to all backup devices in the VRRP group to advertise its configurations (such as the priority) and operating status.</p>
</li><li id="EN-US_CONCEPT_0000001130624270__li1901265007214008"><p id="EN-US_CONCEPT_0000001130624270__p4305289214008"><a name="EN-US_CONCEPT_0000001130624270__li1901265007214008"></a><a name="li1901265007214008"></a>If the master device fails, the backup device with the highest priority is elected as the new master.</p>
</li><li id="EN-US_CONCEPT_0000001130624270__li605564044214008"><p id="EN-US_CONCEPT_0000001130624270__p789884375214008"><a name="EN-US_CONCEPT_0000001130624270__li605564044214008"></a><a name="li605564044214008"></a>After a master/backup switchover, the new master device immediately sends gratuitous ARP packets carrying the virtual MAC and virtual IP addresses to allow devices or hosts that are connected to it to update corresponding MAC entries. After the update is complete, user traffic is switched to the new master device. The switching process is transparent to users.</p>
</li><li id="EN-US_CONCEPT_0000001130624270__li1436016836214008"><p id="EN-US_CONCEPT_0000001130624270__p1713737666214008"><a name="EN-US_CONCEPT_0000001130624270__li1436016836214008"></a><a name="li1436016836214008"></a>If the original master device recovers and it is the IP address owner (its priority is 255), it immediately switches to the Master state. If the original master device recovers and its priority is lower than 255, it switches to the Backup state, and its original priority is restored.</p>
</li><li id="EN-US_CONCEPT_0000001130624270__li592048871214008"><p id="EN-US_CONCEPT_0000001130624270__p1273638346214008"><a name="EN-US_CONCEPT_0000001130624270__li592048871214008"></a><a name="li592048871214008"></a>If the priority of a backup device is higher than that of a master device, VRRP determines whether to reelect a new master, depending on the backup device's working mode (preemption or non-preemption).</p>
</li></ol>
</div>
<p id="EN-US_CONCEPT_0000001130624270__p8585124016324">To ensure the master and backup devices work properly, VRRP must implement the following functions: electing the master and advertising the master status. The detailed VRRP working process is as follows:</p>
<p id="EN-US_CONCEPT_0000001130624270__p321344823318"><strong id="EN-US_CONCEPT_0000001130624270__b88111637144817">Electing the master</strong></p>
<p id="EN-US_CONCEPT_0000001130624270__p963696007214008">VRRP determines the master or backup role of each device in a VRRP group based on priorities. A device with a higher priority is more likely to be elected as the master.</p>
<p id="EN-US_CONCEPT_0000001130624270__p436328416214008">If devices in the Initialize state receive an interface up event and their priorities are lower than 255, they switch to the Backup state and then to the Master state after the Master_Down timer expires. The VRRP device that first switches to the Master state sends VRRP Advertisement packets to the other backup devices in the VRRP group.</p>
<ul id="EN-US_CONCEPT_0000001130624270__ul1599126506214008"><li id="EN-US_CONCEPT_0000001130624270__li1203341733214008"><p id="EN-US_CONCEPT_0000001130624270__p1711002732214008"><a name="EN-US_CONCEPT_0000001130624270__li1203341733214008"></a><a name="li1203341733214008"></a>If a device in the Backup state receives a VRRP Advertisement packet carrying a priority higher than or equal to its own priority, it remains in the Backup state.</p>
</li><li id="EN-US_CONCEPT_0000001130624270__li1265817246214008"><p id="EN-US_CONCEPT_0000001130624270__p1617446340214008"><a name="EN-US_CONCEPT_0000001130624270__li1265817246214008"></a><a name="li1265817246214008"></a>However, if the priority carried in the VRRP Advertisement packet is lower than its priority, the device switches to the Master state if it works in preemption mode, and it remains in the Backup state if it works in non-preemption mode.</p>
</li></ul>
<div class="note" id="EN-US_CONCEPT_0000001130624270__note472661601214008"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_CONCEPT_0000001130624270__p1430954312112">If a VRRP device is the IP address owner, it will immediately switch to the Master state after receiving an interface up event.</p>
<p id="EN-US_CONCEPT_0000001130624270__p15436145962019">If multiple devices in a VRRP group switch to the Master state simultaneously, they will negotiate the master and backup roles through VRRP Advertisement packets.</p>
<ul id="EN-US_CONCEPT_0000001130624270__ul18711166122114"><li id="EN-US_CONCEPT_0000001130624270__li071113614214">VRRP devices with lower priorities will switch to the Backup state.</li><li id="EN-US_CONCEPT_0000001130624270__li171119682110">VRRP device with the highest priority will become the master.</li><li id="EN-US_CONCEPT_0000001130624270__li1171112682112">If multiple devices have the same priority, the device whose interface where the VRRP group resides has the largest primary IP address will be elected as the master device.</li></ul>
</div></div>
<p id="EN-US_CONCEPT_0000001130624270__p3997195317337"><strong id="EN-US_CONCEPT_0000001130624270__b691711420318">Advertising the master status</strong></p>
<p id="EN-US_CONCEPT_0000001130624270__p833466853214008">The master device periodically sends VRRP Advertisement packets to all backup devices in the VRRP group to advertise its configurations (such as the priority) and operating status. The backup devices determine whether the master device is working properly based on the received VRRP Advertisement packets.</p>
<ul id="EN-US_CONCEPT_0000001130624270__ul717829655214008"><li id="EN-US_CONCEPT_0000001130624270__li176678020214008"><p id="EN-US_CONCEPT_0000001130624270__p1605081986214008"><a name="EN-US_CONCEPT_0000001130624270__li176678020214008"></a><a name="li176678020214008"></a>If the master device proactively gives up the master role (by leaving the VRRP group for example), it sends VRRP Advertisement packets carrying a priority of 0 to the backup devices. Instead of waiting for the Master_Down timer to expire, the backup device with the highest priority switches to the Master state after a specified switching time expires. This switching time (in seconds) is referred to as Skew_Time, and it is calculated using the following formula: Skew_Time = (256 - Backup device's priority)/256</p>
</li><li id="EN-US_CONCEPT_0000001130624270__li388638301214008"><p id="EN-US_CONCEPT_0000001130624270__p1346154380214008"><a name="EN-US_CONCEPT_0000001130624270__li388638301214008"></a><a name="li388638301214008"></a>If the master device fails and cannot send VRRP Advertisement packets, the backup devices will not be able to immediately detect the master device's operating status. In this case, the backup device with the highest priority will switch to the master state only after the Master_Down timer expires. The Master_Down timer value (in seconds) is calculated using the following formula: Master_Down timer value = (3 x Adver_Interval timer value) + Skew_Time</p>
</li></ul>
<div class="note" id="EN-US_CONCEPT_0000001130624270__note2096650739214008"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_CONCEPT_0000001130624270__p349806750214008">If network congestion occurs on an unstable network, a backup device may not receive VRRP Advertisement packets from the master device before the Master_Down timer expires. In this case, the backup device proactively switches to the Master state. If the new master device receives a VRRP Advertisement packet from the original master device, it will switch back to the Backup state. On a network with unstable performance, the status of a VRRP group member may be frequently switched. To prevent this problem, run the <strong id="EN-US_CONCEPT_0000001130624270__b1763812317"><a href="cmdqueryname=vrrp+vrid"><b><span class="cmdname" id="EN-US_CONCEPT_0000001130624270__cmdname57809143112">vrrp vrid</span></b></a> </strong><em id="EN-US_CONCEPT_0000001130624270__i9637143114"><i><span class="varname" id="EN-US_CONCEPT_0000001130624270__varname6625518113120">virtual-router-id</span></i></em><strong id="EN-US_CONCEPT_0000001130624270__b26313173114"> <strong><span id="EN-US_CONCEPT_0000001130624270__cmdparmname9178117328">preempt-mode timer delay</span></strong></strong><strong id="EN-US_CONCEPT_0000001130624270__b4631419318"> </strong><em id="EN-US_CONCEPT_0000001130624270__i176316113119"><i><span class="varname" id="EN-US_CONCEPT_0000001130624270__varname106301216133218">delay-time</span></i></em> command to set a preemption delay so that the backup device waits for the time specified by <em id="EN-US_CONCEPT_0000001130624270__i7851126163211">delay-time</em> after the Master_Down event. If no VRRP Advertisement packets are received during this period, the backup device becomes the master device.</p>
</div></div>
</div>
<div class="section"><h4 class="sectiontitle">VRRP Authentication</h4><div class="p">Different authentication modes and keys can be set and carried in VRRP Advertisement packets to meet various network security requirements.<ul><li><p>On secure networks, you can use the none authentication mode, through which a device does not authenticate VRRP Advertisement packets before sending them. The packets are considered authentic and valid; therefore, they are not authenticated by devices that receive them.</p>
</li><li><p>On insecure networks, configure simple or HMAC-MD5 authentication.</p>
<ul><li><p>Simple authentication: Before a device sends a VRRP Advertisement packet, it inserts an authentication mode and key to the packet. The device that receives the packet checks whether the authentication mode and key carried in it are the same as the locally configured ones. If the values are the same, the device considers the received VRRP Advertisement packet valid; otherwise, the device considers the packet invalid and discards it.</p>
</li><li><p>HMAC-MD5 authentication: A device uses the HMAC-MD5 algorithm to compute a hash value from the locally configured authentication key. Upon receipt of a VRRP Advertisement packet, the device compares the MD5 hash of the authentication key carried in the packet with the locally computed hash value to determine packet validity.</p>
</li></ul>
</li></ul>
<div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><ul><li><p>VRRPv2 supports authentication, but VRRPv3 does not.</p>
</li><li><p>MD5 authentication is more secure than simple authentication.</p>
</li></ul>
</div></div>
</div>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="vrp_vrrp_cfg_0003.html">Understanding VRRP
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="vrp_vrrp_cfg_0005.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>
</body>
</html>