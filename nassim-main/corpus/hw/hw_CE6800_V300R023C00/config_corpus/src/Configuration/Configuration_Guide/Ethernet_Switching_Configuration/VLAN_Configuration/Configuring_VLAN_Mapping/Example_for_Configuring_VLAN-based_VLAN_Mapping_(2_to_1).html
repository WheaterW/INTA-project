
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring VLAN-based VLAN Mapping (2 to 1)">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="vrp_vlan_cfg_0053.html">
<meta name="DC.Relation" scheme="URI" content="vrp_vlan_cfg_0057.html">
<meta name="DC.Relation" scheme="URI" content="vrp_vlan_cfg_0059.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="VLAN">
<meta name="featurename" content="VLAN Mapping">
<meta name="featuretype" content="Ethernet Switching">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="VLAN">
<meta name="featurename" content="VLAN Mapping">
<meta name="featuretype" content="Ethernet Switching">
<meta name="featurename" content="QinQ">
<meta name="featurename" content="VLAN">
<meta name="featurename" content="VLAN Mapping">
<meta name="featurename" content="VLAN Pool">
<meta name="featurename" content="Voice VLAN">
<meta name="featuretype" content="Ethernet Switching">
<meta name="featuretype" content="Ethernet Switching">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001176662391">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring VLAN-based VLAN Mapping (2 to 1)</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001176662391"></a><a name="EN-US_TASK_0000001176662391"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring VLAN-based VLAN Mapping (2 to 1)</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001176662391__1.3.1"></a><a name="1.3.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>In <a href="#EN-US_TASK_0000001176662391__fig265374023812">Figure 1</a>, PC1 and PC3 connected to DeviceA belong to VLAN 2 and VLAN 3 respectively, and PC2 and PC4 connected to DeviceB belong to VLAN 2 and VLAN 3 respectively. QinQ is configured on DeviceC and DeviceD. VLAN mapping needs to be configured on DeviceE so that PCs in the same VLAN of different branches can communicate with each other.</p>
<div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>VLAN-based VLAN mapping can be configured only on the <span>CE6820H, CE6820H-K, CE6863H, CE6863H-K, CE6881H, CE6881H-K, CE6820S</span>.</p>
</div></div>
<div class="fignone" id="EN-US_TASK_0000001176662391__fig265374023812"><a name="EN-US_TASK_0000001176662391__fig265374023812"></a><a name="fig265374023812"></a><span class="figcap"><b>Figure 1 </b>Network diagram of configuring VLAN-based VLAN mapping (2 to 1)</span><div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface 1, interface 2, and interface 3 represent <span>100GE</span> <span>1/0/1</span>, <span>100GE</span> <span>1/0/2</span>, and <span>100GE</span> <span>1/0/3</span>, respectively.</p>
</div></div>
<br><span><img src="figure/en-us_image_0000002150819682.png"></span></div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001176662391__1.3.2"></a><a name="1.3.2"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Create VLAN 2 and VLAN 3 on DeviceA and add interfaces to the VLANs. The configuration of DeviceB is similar to that of DeviceA.</span><p><pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname DeviceA</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>vlan batch 2 3</strong>
[<span class="keyword">*</span>DeviceA] <strong>interface <span>100ge</span> <span>1/0/1</span></strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>portswitch</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>port link-type access</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>port default vlan 2</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>interface <span>100ge</span> <span>1/0/2</span></strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/2</span>] <strong>portswitch</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/2</span>] <strong>port link-type access</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/2</span>] <strong>port default vlan 3</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/2</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>interface <span>100ge</span> <span>1/0/3</span></strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/3</span>] <strong>portswitch</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/3</span>] <strong>port link-type trunk</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/3</span>] <strong>port trunk allow-pass vlan 2 3</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/3</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>commit</strong></pre>
</p></li><li><span>On DeviceC, configure <span>100GE</span> <span>1/0/1</span> as a QinQ interface, and configure <span>100GE</span> <span>1/0/1</span> to add an outer tag with VLAN ID 201 to packets. The configuration of DeviceD is similar to that of DeviceC.</span><p><pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname DeviceC</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceC] <strong>vlan batch 201</strong>
[<span class="keyword">*</span>DeviceC] <strong>interface <span>100ge</span> <span>1/0/1</span></strong>
[<span class="keyword">*</span>DeviceC-<span>100GE</span><span>1/0/1</span>] <strong>portswitch</strong>
[<span class="keyword">*</span>DeviceC-<span>100GE</span><span>1/0/1</span>] <strong>port link-type dot1q-tunnel</strong>
[<span class="keyword">*</span>DeviceC-<span>100GE</span><span>1/0/1</span>] <strong>port default vlan 201</strong>
[<span class="keyword">*</span>DeviceC-<span>100GE</span><span>1/0/1</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceC] <strong>interface <span>100ge</span> <span>1/0/2</span></strong>
[<span class="keyword">*</span>DeviceC-<span>100GE</span><span>1/0/2</span>] <strong>portswitch</strong>
[<span class="keyword">*</span>DeviceC-<span>100GE</span><span>1/0/2</span>] <strong>port link-type trunk</strong>
[<span class="keyword">*</span>DeviceC-<span>100GE</span><span>1/0/2</span>] <strong>port trunk allow-pass vlan 201</strong>
[<span class="keyword">*</span>DeviceC-<span>100GE</span><span>1/0/2</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceC] <strong>commit</strong></pre>
</p></li><li><span>Configure VLAN mapping on DeviceE. If a packet carries double VLAN tags (outer VLAN tag 201 and inner VLAN tag 2), DeviceE replaces both VLAN tags with VLAN tag 501. If a packet carries double VLAN tags (outer VLAN tag 201 and inner VLAN tag 3), DeviceE replaces both VLAN tags with VLAN tag 502.</span><p><pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname DeviceE</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceE] <strong>vlan batch 501 502</strong>
[<span class="keyword">*</span>DeviceE] <strong>interface <span>100ge</span> <span>1/0/1</span></strong>
[<span class="keyword">*</span>DeviceE-<span>100GE</span><span>1/0/1</span>] <strong>portswitch</strong>
[<span class="keyword">*</span>DeviceE-<span>100GE</span><span>1/0/1</span>] <strong>port link-type trunk</strong>
[<span class="keyword">*</span>DeviceE-<span>100GE</span><span>1/0/1</span>] <strong>port trunk allow-pass vlan 501 502</strong>
[<span class="keyword">*</span>DeviceE-<span>100GE</span><span>1/0/1</span>] <strong>port vlan-mapping vlan 201 inner-vlan 2 map-single-vlan 501</strong>
[<span class="keyword">*</span>DeviceE-<span>100GE</span><span>1/0/1</span>] <strong>port vlan-mapping vlan 201 inner-vlan 3 map-single-vlan 502</strong>
[<span class="keyword">*</span>DeviceE-<span>100GE</span><span>1/0/1</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceE] <strong>interface <span>100ge</span> <span>1/0/2</span></strong>
[<span class="keyword">*</span>DeviceE-<span>100GE</span><span>1/0/2</span>] <strong>portswitch</strong>
[<span class="keyword">*</span>DeviceE-<span>100GE</span><span>1/0/2</span>] <strong>port link-type trunk</strong>
[<span class="keyword">*</span>DeviceE-<span>100GE</span><span>1/0/2</span>] <strong>port trunk allow-pass vlan 501 502</strong>
[<span class="keyword">*</span>DeviceE-<span>100GE</span><span>1/0/2</span>] <strong>port vlan-mapping vlan 201 inner-vlan 2 map-single-vlan 501</strong>
[<span class="keyword">*</span>DeviceE-<span>100GE</span><span>1/0/2</span>] <strong>port vlan-mapping vlan 201 inner-vlan 3 map-single-vlan 502</strong>
[<span class="keyword">*</span>DeviceE-<span>100GE</span><span>1/0/2</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceE] <strong>interface <span>100ge</span> <span>1/0/3</span></strong>
[<span class="keyword">*</span>DeviceE-<span>100GE</span><span>1/0/3</span>] <strong>portswitch</strong>
[<span class="keyword">*</span>DeviceE-<span>100GE</span><span>1/0/3</span>] <strong>port link-type trunk</strong>
[<span class="keyword">*</span>DeviceE-<span>100GE</span><span>1/0/3</span>] <strong>port trunk allow-pass vlan 501 502</strong>
[<span class="keyword">*</span>DeviceE-<span>100GE</span><span>1/0/3</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceE] <strong>commit</strong></pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001176662391__1.3.3"></a><a name="1.3.3"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p>PC1 and PC2 in the same VLAN can communicate with each other, and PC3 and PC4 in the same VLAN can communicate with each other. PCs in different VLANs cannot communicate with each other.</p>
</div>
<div class="postreq"><a name="EN-US_TASK_0000001176662391__1.3.4"></a><a name="1.3.4"></a><h4 class="sectiontitle">Configuration Scripts</h4><ul><li>DeviceA<pre class="screen">#
sysname DeviceA
#
vlan batch 2 to 3
#
interface <span>100GE</span><span>1/0/1</span>
 
 port default vlan 2
#
interface <span>100GE</span><span>1/0/2</span>
 
 port default vlan 3
#
interface <span>100GE</span><span>1/0/3</span>
 port link-type trunk
 port trunk allow-pass vlan 2 to 3
#
return</pre>
</li><li>DeviceB<pre class="screen">#
sysname DeviceB
#
vlan batch 2 to 3
#
interface <span>100GE</span><span>1/0/1</span>
 port default vlan 2
#
interface <span>100GE</span><span>1/0/2</span>
 port default vlan 3
#
interface <span>100GE</span><span>1/0/3</span>
 port link-type trunk
 port trunk allow-pass vlan 2 to 3
#
return</pre>
</li><li>DeviceC<pre class="screen">#
sysname DeviceC
#
vlan batch 201
#
interface <span>100GE</span><span>1/0/1</span>
 
 port link-type dot1q-tunnel
 port default vlan 201
#
interface <span>100GE</span><span>1/0/2</span>
 
 port link-type trunk
 port trunk allow-pass vlan 201
#
return</pre>
</li><li>DeviceD<pre class="screen">#
sysname DeviceD
#
vlan batch 201
#
interface <span>100GE</span><span>1/0/1</span>
 port link-type dot1q-tunnel
 port default vlan 201
#
interface <span>100GE</span><span>1/0/2</span>
 port link-type trunk
 port trunk allow-pass vlan 201
#
return</pre>
</li><li>DeviceE<pre class="screen">#
sysname DeviceE
#
vlan batch 501 to 502
#
interface <span>100GE</span><span>1/0/1</span>
 port link-type trunk 
 port trunk allow-pass vlan 501 to 502
 port vlan-mapping vlan 201 inner-vlan 2 map-single-vlan 501
 port vlan-mapping vlan 201 inner-vlan 3 map-single-vlan 502
#
interface <span>100GE</span><span>1/0/2</span>
 port link-type trunk 
 port trunk allow-pass vlan 501 to 502
 port vlan-mapping vlan 201 inner-vlan 2 map-single-vlan 501
 port vlan-mapping vlan 201 inner-vlan 3 map-single-vlan 502
#
interface <span>100GE</span><span>1/0/3</span>
 port link-type trunk 
 port trunk allow-pass vlan 501 to 502
#
return</pre>
</li></ul>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="vrp_vlan_cfg_0053.html">Configuring VLAN Mapping
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="vrp_vlan_cfg_0057.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="vrp_vlan_cfg_0059.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>