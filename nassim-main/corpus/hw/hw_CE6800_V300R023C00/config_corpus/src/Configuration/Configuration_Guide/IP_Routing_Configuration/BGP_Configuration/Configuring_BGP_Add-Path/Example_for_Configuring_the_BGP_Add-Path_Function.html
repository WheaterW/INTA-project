
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring the BGP Add-Path Function">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="vrp_bgp_cfg_0069.html">
<meta name="DC.Relation" scheme="URI" content="vrp_bgp_cfg_0071.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing">
<meta name="featuretype" content="IP Routing">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001176743611">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring the BGP Add-Path Function</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001176743611"></a><a name="EN-US_TASK_0000001176743611"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring the BGP Add-Path Function</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001176743611__1.3.1"></a><a name="1.3.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0000001176743611__fig_dc_vrp_bgp_cfg_309701">Figure 1</a>, DeviceA, DeviceB, and DeviceC are clients of the RR. DeviceD establishes an EBGP peer relationship with each of DeviceB and DeviceC.</p>
<p>To ensure reliable data transmission, configure the BGP Add-Path function on the RR and enable DeviceA to accept Add-Path routes. Then, the RR can send multiple preferred routes with the same prefix to DeviceA to form multiple links to the same destination.</p>
<div class="fignone" id="EN-US_TASK_0000001176743611__fig_dc_vrp_bgp_cfg_309701"><a name="EN-US_TASK_0000001176743611__fig_dc_vrp_bgp_cfg_309701"></a><a name="fig_dc_vrp_bgp_cfg_309701"></a><span class="figcap"><b>Figure 1 </b>Network diagram of configuring the BGP Add-Path function</span><div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface 1, interface 2, and interface 3 represent <span>100GE</span><span>1/0/1</span>, <span>100GE</span><span>1/0/2</span>, and <span>100GE</span><span>1/0/3</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0000001176663779.png"></span></div>
<p>To complete the configuration, you need the following data:</p>
<ul><li><p>Router IDs and AS numbers of DeviceA, DeviceB, DeviceC, DeviceD, and the RR</p>
</li></ul>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001176743611__1.3.2"></a><a name="1.3.2"></a>
<div class="p"><h4 class="sectiontitle">Precautions</h4><p>When configuring the BGP Add-Path function, enable the capability of sending Add-Path routes on the route sender and the capability of receiving Add-Path routes on the route receiver so that Add-Path routes can be exchanged between the two ends.</p>
<p>To improve security, you are advised to deploy BGP security measures. For details, see "Configuring BGP Authentication." Keychain authentication is used as an example. For details, see Example for Configuring Keychain Authentication for BGP.</p>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001176743611__1.3.3"></a><a name="1.3.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure IP addresses for interfaces.</p>
</li><li><p>Configure basic BGP functions on each device.</p>
</li><li><p>Configure the BGP Add-Path function on the RR. Enable the RR to send Add-Path routes to DeviceA, and set the number of preferred Add-Path routes that the RR can send to DeviceA.</p>
</li><li><p>Enable DeviceA to accept BGP Add-Path routes advertised by the RR.</p>
</li></ol>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001176743611__1.3.4"></a><a name="1.3.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Assign an IP address to each involved interface. For detailed configurations, see <a href="#EN-US_TASK_0000001176743611__postreq132151324173810">Configuration Scripts</a>.</span></li><li><span>Configure basic BGP functions. Configure an IBGP peer relationship between the RR and each of DeviceA, DeviceB, and DeviceC. DeviceA, DeviceB, and DeviceC are clients of the RR. Configure an EBGP peer relationship between DeviceD and each of DeviceB and DeviceC.</span><p><p># Configure DeviceA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA]<strong> bgp 65008</strong>
[<span class="keyword">*</span>DeviceA-bgp]<strong> router-id 1.1.1.1</strong>
[<span class="keyword">*</span>DeviceA-bgp]<strong> peer 172.16.2.2 as-number 65008</strong>
[<span class="keyword">*</span>DeviceA-bgp]<strong> import-route direct</strong>
[<span class="keyword">*</span>DeviceA-bgp]<strong> quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>commit</strong></pre>
<p># Configure DeviceB.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB]<strong> bgp 65008</strong>
[<span class="keyword">*</span>DeviceB-bgp]<strong> router-id 2.2.2.2</strong>
[<span class="keyword">*</span>DeviceB-bgp]<strong> peer 172.16.5.1 as-number 65008</strong>
[<span class="keyword">*</span>DeviceB-bgp]<strong> peer 172.16.7.2 as-number 65009</strong>
[<span class="keyword">*</span>DeviceB-bgp]<strong> import-route direct</strong>
[<span class="keyword">*</span>DeviceB-bgp]<strong> quit</strong>
[<span class="keyword">*</span>DeviceB] <strong>commit</strong></pre>
<p># Configure DeviceC.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceC]<strong> bgp 65008</strong>
[<span class="keyword">*</span>DeviceC-bgp]<strong> router-id 3.3.3.3</strong>
[<span class="keyword">*</span>DeviceC-bgp]<strong> peer 172.16.4.1 as-number 65008</strong>
[<span class="keyword">*</span>DeviceC-bgp]<strong> peer 172.16.6.2 as-number 65009</strong>
[<span class="keyword">*</span>DeviceC-bgp]<strong> import-route direct</strong>
[<span class="keyword">*</span>DeviceC-bgp]<strong> quit</strong>
[<span class="keyword">*</span>DeviceC] <strong>commit</strong></pre>
<p># Configure DeviceD.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceD]<strong> bgp 65009</strong>
[<span class="keyword">*</span>DeviceD-bgp]<strong> router-id 4.4.4.4</strong>
[<span class="keyword">*</span>DeviceD-bgp]<strong> peer 172.16.6.1 as-number 65008</strong>
[<span class="keyword">*</span>DeviceD-bgp]<strong> peer 172.16.7.1 as-number 65008</strong>
[<span class="keyword">*</span>DeviceD-bgp]<strong> import-route direct</strong>
[<span class="keyword">*</span>DeviceD-bgp]<strong> quit</strong>
[<span class="keyword">*</span>DeviceD] <strong>commit</strong></pre>
<p># Configure the RR.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RR]<strong> bgp 65008</strong>
[<span class="keyword">*</span>RR-bgp]<strong> router-id 5.5.5.5</strong>
[<span class="keyword">*</span>RR-bgp]<strong> peer 172.16.2.1 as-number 65008</strong>
[<span class="keyword">*</span>RR-bgp]<strong> peer 172.16.4.2 as-number 65008</strong>
[<span class="keyword">*</span>RR-bgp]<strong> peer 172.16.5.2 as-number 65008</strong>
[<span class="keyword">*</span>RR-bgp]<strong> peer 172.16.2.1 reflect-client</strong>
[<span class="keyword">*</span>RR-bgp]<strong> peer 172.16.4.2 reflect-client</strong>
[<span class="keyword">*</span>RR-bgp]<strong> peer 172.16.5.2 reflect-client</strong>
[<span class="keyword">*</span>RR-bgp]<strong> import-route direct</strong>
[<span class="keyword">*</span>RR-bgp]<strong> quit</strong>
[<span class="keyword">*</span>RR] <strong>commit</strong></pre>
<p># Check information about the routes to 1.1.1.1 on DeviceA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA]<strong> display bgp routing-table 1.1.1.1</strong>
 BGP local router ID : 1.1.1.1
 Local AS number : 65008
 Paths:   1 available, 1 best, 1 select<span>, 0 best-external</span><span>, 0 add-path</span>
 BGP routing table entry information of 1.1.1.1/32:
 From: 172.16.2.2 (5.5.5.5)
 Route Duration: 0d00h00m25s
 Relay IP Nexthop: 172.16.2.2
 Relay IP Out-interface: <span>100GE</span><span>1/0/3</span>
 Original nexthop: 172.16.7.2
 Qos information : 0x0
 AS-path 65009, origin incomplete, MED 0, localpref 100, pref-val 0, valid, internal, best, select, pre 255
 Originator: 2.2.2.2
 Cluster list: 5.5.5.5
 Not advertised to any peer yet</pre>
<p>The preceding command output shows that DeviceA has accepted only one BGP route to 1.1.1.1 from the RR.</p>
</p></li><li><span>Enable the BGP Add-Path function on the RR. Enable the RR to send Add-Path routes to DeviceA, set the number of preferred routes that the RR can send to DeviceA, and enable DeviceA to accept BGP Add-Path routes sent by the RR.</span><p><p># Configure the RR.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RR]<strong> bgp 65008</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RR-bgp]<strong> bestroute add-path path-number 2</strong>
[<span class="keyword">*</span>RR-bgp]<strong> peer 172.16.2.1 capability-advertise add-path send</strong>
[<span class="keyword">*</span>RR-bgp]<strong> peer 172.16.2.1 advertise add-path path-number 2</strong>
[<span class="keyword">*</span>RR-bgp]<strong> quit</strong>
[<span class="keyword">*</span>RR] <strong>commit</strong></pre>
<p># Configure DeviceA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA]<strong> bgp 65008</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA-bgp]<strong> peer 172.16.2.2 capability-advertise add-path receive</strong>
[<span class="keyword">*</span>DeviceA-bgp]<strong> quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>commit</strong></pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001176743611__1.3.5"></a><a name="1.3.5"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p># Check information about the routes to 1.1.1.1 on DeviceA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA]<strong> display bgp routing-table 1.1.1.1</strong>
 BGP local router ID : 1.1.1.1
 Local AS number : 65008
 Paths:   2 available, 1 best, 1 select<span>, 0 best-external</span><span>, 0 add-path</span>
 BGP routing table entry information of 1.1.1.1/32:
 From: 172.16.2.2 (5.5.5.5)
 Route Duration: 0d00h00m48s
 Relay IP Nexthop: 172.16.2.2
 Relay IP Out-interface:  <span>100GE</span><span>1/0/3</span>
 Original nexthop: <strong>172.16.7.2</strong>
 Qos information : 0x0
 AS-path 65009, origin incomplete, MED 0, localpref 100, pref-val 0, valid, internal, best, select, pre 255
 Received path-id: 0
 Originator: 2.2.2.2
 Cluster list: 5.5.5.5
 Not advertised to any peer yet

 BGP routing table entry information of 1.1.1.1/32:
 From: 172.16.2.2 (5.5.5.5)
 Route Duration: 0d00h00m48s
 Relay IP Nexthop: 172.16.2.2
 Relay IP Out-interface: <span>100GE</span><span>1/0/1</span>
 Original nexthop: <strong>172.16.6.2</strong>
 Qos information : 0x0
 AS-path 65009, origin incomplete, MED 0, localpref 100, pref-val 0, valid, internal, pre 255, not preferred for router ID
 Received path-id: 1
 Originator: 3.3.3.3
 Cluster list: 5.5.5.5
 Not advertised to any peer yet</pre>
<p>The preceding command output shows that BGP Add-Path-enabled DeviceA has accepted two routes from the RR. The route with the original next-hop IP address of 172.16.7.2 is the optimal route selected by the RR, and the other one with the original next-hop IP address of 172.16.6.2 is an Add-Path route.</p>
<p># Check information about the routes to 1.1.1.1 on the RR.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RR]<strong> display bgp routing-table 1.1.1.1</strong>
BGP local router ID : 5.5.5.5
 Local AS number : 65008
 Paths:   2 available, 1 best, 1 select, 0 best-external, <strong>1 add-path</strong>
 BGP routing table entry information of 1.1.1.1/32:
 RR-client route.
 From: 172.16.5.2 (2.2.2.2)
 Route Duration: 0d00h19m39s
 Relay IP Nexthop: 172.16.5.2
 Relay IP Out-interface:  <span>100GE</span><span>1/0/3</span>
 Original nexthop: 172.16.7.2
 Qos information : 0x0
 AS-path 65009, origin incomplete, MED 0, localpref 100, pref-val 0, valid, internal, best, select, pre 255
 Advertised to such 3 peers:
    172.16.5.2
    172.16.4.2
    172.16.2.1

 BGP routing table entry information of 1.1.1.1/32:
 RR-client route.
 From: 172.16.4.2 (3.3.3.3)
 Route Duration: 0d00h19m41s
 Relay IP Nexthop: 172.16.4.2
 Relay IP Out-interface: <span>100GE</span><span>1/0/2</span>
 Original nexthop: 172.16.6.2
 Qos information : 0x0
 AS-path 65009, origin incomplete, MED 0, localpref 100, pref-val 0, valid, internal, <strong>add-path</strong>, pre 255, not preferred for router ID
 Advertised to such 1 peers:
    <strong>172.16.2.1</strong></pre>
<p>The preceding command output shows that the RR has sent the optimal route to all its clients but has sent the Add-Path route only to DeviceA.</p>
</div>
<div class="postreq"><a name="EN-US_TASK_0000001176743611__postreq132151324173810"></a><a name="postreq132151324173810"></a><a name="EN-US_TASK_0000001176743611__1.3.6"></a><a name="1.3.6"></a><h4 class="sectiontitle">Configuration Scripts</h4><ul><li><p>DeviceA</p>
<pre class="screen">#
sysname DeviceA
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 172.16.1.1 255.255.255.0
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ip address 172.16.2.1 255.255.255.0
#
interface <span>100GE</span><span>1/0/3</span>
 undo portswitch
 ip address 172.16.3.1 255.255.255.0
#
bgp 65008
 router-id 1.1.1.1
 peer 172.16.2.2 as-number 65008
 #
 ipv4-family unicast
  import-route direct
  peer 172.16.2.2 enable
  peer 172.16.2.2 capability-advertise add-path receive
#
return</pre>
</li><li><p>DeviceB</p>
<pre class="screen">#
sysname DeviceB
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 172.16.3.2 255.255.255.0
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ip address 172.16.5.2 255.255.255.0
#
interface <span>100GE</span><span>1/0/3</span>
 undo portswitch
 ip address 172.16.7.1 255.255.255.0
#
bgp 65008
 router-id 2.2.2.2
 peer 172.16.5.1 as-number 65008
 peer 172.16.7.2 as-number 65009
 #
 ipv4-family unicast
  import-route direct
  peer 172.16.5.1 enable
  peer 172.16.7.2 enable
#
return</pre>
</li><li><p>DeviceC</p>
<pre class="screen">#
sysname DeviceC
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 172.16.1.2 255.255.255.0
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ip address 172.16.4.2 255.255.255.0
#
interface <span>100GE</span><span>1/0/3</span>
 undo portswitch
 ip address 172.16.6.1 255.255.255.0
#
bgp 65008
 router-id 3.3.3.3
 peer 172.16.4.1 as-number 65008
 peer 172.16.6.2 as-number 65009
 #
 ipv4-family unicast
  import-route direct
  peer 172.16.4.1 enable
  peer 172.16.6.2 enable
#
return</pre>
</li><li><p>DeviceD</p>
<pre class="screen">#
sysname DeviceD
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 172.16.6.2 255.255.255.0
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ip address 172.16.7.2 255.255.255.0
#
interface LoopBack0
 ip address 1.1.1.1 255.255.255.255
#
bgp 65009
 router-id 4.4.4.4
 peer 172.16.6.1 as-number 65008
 peer 172.16.7.1 as-number 65008
 #
 ipv4-family unicast
  import-route direct
  peer 172.16.6.1 enable
  peer 172.16.7.1 enable
#
return</pre>
</li><li><p>RR</p>
<pre class="screen">#
sysname RR
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 172.16.2.2 255.255.255.0
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ip address 172.16.4.1 255.255.255.0
#
interface <span>100GE</span><span>1/0/3</span>
 undo portswitch
 ip address 172.16.5.1 255.255.255.0
#
bgp 65008
 router-id 5.5.5.5
 peer 172.16.2.1 as-number 65008
 peer 172.16.4.2 as-number 65008
 peer 172.16.5.2 as-number 65008
 #
 ipv4-family unicast
  import-route direct
  bestroute add-path path-number 2
  peer 172.16.2.1 enable
  peer 172.16.2.1 reflect-client
  peer 172.16.2.1 capability-advertise add-path send
  peer 172.16.2.1 advertise add-path path-number 2
  peer 172.16.4.2 enable
  peer 172.16.4.2 reflect-client
  peer 172.16.5.2 enable
  peer 172.16.5.2 reflect-client
#
return</pre>
</li></ul>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="vrp_bgp_cfg_0069.html">Configuring BGP Add-Path
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="vrp_bgp_cfg_0071.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>
</body>
</html>