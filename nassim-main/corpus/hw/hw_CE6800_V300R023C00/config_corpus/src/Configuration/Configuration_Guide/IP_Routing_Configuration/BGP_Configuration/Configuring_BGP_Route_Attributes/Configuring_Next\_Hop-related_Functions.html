
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring Next_Hop-related Functions">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="vrp_bgp_cfg_0021.html">
<meta name="DC.Relation" scheme="URI" content="vrp_bgp_cfg_0026.html">
<meta name="DC.Relation" scheme="URI" content="vrp_bgp_cfg_0028.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing">
<meta name="featuretype" content="IP Routing">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001130783872">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>Configuring Next_Hop-related Functions</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001130783872"></a><a name="EN-US_TASK_0000001130783872"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring Next_Hop-related Functions</h1>
<div class="taskbody"><div class="prereq" style="margin-left:0"><a name="EN-US_TASK_0000001130783872__1.3.1"></a><a name="1.3.1"></a><h4 class="sectiontitle">Prerequisites</h4>
<div class="p"><p>Before configuring Next_Hop-related functions, you have completed the following task:</p>
<ul><li><a href="vrp_bgp_cfg_0014.html">Configure basic BGP functions</a>.</li></ul>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001130783872__1.3.2"></a><a name="1.3.2"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>Configuring the Next_Hop-related functions allows for flexible control of BGP route selection.</p>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001130783872__1.3.3"></a><a name="1.3.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Enter the system view.</span><p><pre class="screen"><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></pre>
</p></li><li><span>Enter the BGP view.</span><p><pre class="screen"><a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></pre>
</p></li><li><span>Enter the IPv4 unicast address family view.</span><p><pre class="screen"><a href="cmdqueryname=ipv4-family+unicast"><b><span class="cmdname">ipv4-family</span></b></a> <strong><span>unicast</span></strong></pre>
</p></li><li><span>Configure Next_Hop-related functions. For details, see <a href="#EN-US_TASK_0000001130783872__table29861143141218">Table 1</a>.</span><p>
<div class="tableBorder"><a name="EN-US_TASK_0000001130783872__table29861143141218"></a><a name="table29861143141218"></a><table cellpadding="4" cellspacing="0" summary="" id="EN-US_TASK_0000001130783872__table29861143141218" frame="border" border="1" rules="all"><caption><b>Table 1 </b>Configuring Next_Hop-related functions</caption><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="33.33333333333333%" id="mcps1.3.3.4.2.1.2.4.1.1" liSelected="liSelected"><p>Operation</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="33.33333333333333%" id="mcps1.3.3.4.2.1.2.4.1.2" liSelected="liSelected"><p>Command</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="33.33333333333333%" id="mcps1.3.3.4.2.1.2.4.1.3" liSelected="liSelected"><p>Description</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.3.4.2.1.2.4.1.1 "><p>Configure the device to change the next hop of each route to itself when the device advertises them to a specified peer or peer group.</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.3.4.2.1.2.4.1.2 "><p><a href="cmdqueryname=peer+next-hop-local"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> | <i><span class="varname">peerIpv6Addr</span></i> } <strong><span>next-hop-local</span></strong></p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.3.4.2.1.2.4.1.3 "><p>By default, a device does not change the next hop address of a route learned from an EBGP peer before forwarding the route to IBGP peers. The next hop address of a route advertised by an EBGP peer to this device is the peer address of the EBGP peer. After being forwarded to IBGP peers in the local AS, this route is not active because the next hop is unreachable. To address this issue, configure an ASBR to change the next hop address of a route advertised by an EBGP peer to the ASBR's own IP address before the ASBR advertises the route to an IBGP peer. As an IGP runs within the AS, the next hop of the route is reachable. As such, the route received by the IBGP peer is active.</p>
<p>By default, a device does not change the next-hop address of a route when advertising the route to an IBGP peer.</p>
<div class="note"><span class="notetitle"> NOTE: </span><div class="notebody"><p>If BGP load balancing is configured, the local device changes the next hop address of a route to its own address when advertising the route to an IBGP peer or peer group, regardless of whether the <a href="cmdqueryname=peer+next-hop-local"><b><span class="cmdname">peer next-hop-local</span></b></a> command is run.</p>
</div></div>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.3.4.2.1.2.4.1.1 "><p>Enter the BGP-VPNv4 address family view and configure the device not to change the next hop address of an imported IGP route when advertising the IGP route.</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.3.4.2.1.2.4.1.2 "><p><a href="cmdqueryname=peer+next-hop-invariable"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>next-hop-invariable</span></strong></p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.3.4.2.1.2.4.1.3 "><p>By default, a device changes the next hop address of a route imported from an IGP to the address of the local interface connected to a peer when advertising the route to the peer.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.3.4.2.1.2.4.1.1 "><p>Configure the device to recurse routes to next hops based on a specified route-policy.</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.3.4.2.1.2.4.1.2 "><p><a href="cmdqueryname=nexthop+recursive-lookup+route-policy"><b><span class="cmdname">nexthop recursive-lookup</span></b></a> <strong><span>route-policy</span></strong> <i><span class="varname">route-policy-name</span></i></p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.3.4.2.1.2.4.1.3 "><p>By default, no route-policy is configured for next hop recursion.</p>
<p>After this command is run, the device matches the recursive next hops against the specified route-policy after recursing routes. A route with a recursive next hop that does not match the route-policy will be set to invalid.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.3.4.2.1.2.4.1.1 "><p>Disable the device from changing the next hop address of each route when the device advertises them to a peer in specific scenarios.</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.3.4.2.1.2.4.1.2 "><p><a href="cmdqueryname=nexthop+third-party"><b><span class="cmdname">nexthop third-party</span></b></a></p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.3.3.4.2.1.2.4.1.3 "><p>The specific scenarios include the following:</p>
<ul><li>A route is learned from a directly connected peer and is to be advertised to a directly connected EBGP peer, the original next hop of the route resides on the same network segment as the local interface that is used to establish the peer relationship with the EBGP peer, and all directly connected interfaces are broadcast interfaces.</li><li>A route is locally imported and is to be advertised to a directly connected IBGP or EBGP peer, the recursive next hop of the route resides on the same network segment as the local interface that is used to establish the peer relationship with the IBGP or EBGP peer, and all directly connected interfaces are broadcast interfaces.</li></ul>
<div class="p">The default configurations are as follows:<ul><li>Before advertising a route learned from a directly connected peer to a directly connected EBGP peer, a device changes the next hop address of the route to the IP address of the local interface used to establish the peer relationship with the EBGP peer.</li><li>Before advertising a locally imported route to a directly connected IBGP or EBGP peer, the device changes the next hop address of the route to the IP address of the local interface that is used to establish the peer relationship with the IBGP or EBGP peer.</li></ul>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</p></li><li><span>Commit the configuration.</span><p><pre class="screen" id="EN-US_TASK_0000001130783872__en-us_task_0234857734_screen163801330213"><a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001130783872__en-us_task_0234857734_en-us_concept_0141113565_cmdname1667501373175340">commit</span></b></a></pre>
</p></li></ol></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="vrp_bgp_cfg_0021.html">Configuring BGP Route Attributes
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="vrp_bgp_cfg_0026.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="vrp_bgp_cfg_0028.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>