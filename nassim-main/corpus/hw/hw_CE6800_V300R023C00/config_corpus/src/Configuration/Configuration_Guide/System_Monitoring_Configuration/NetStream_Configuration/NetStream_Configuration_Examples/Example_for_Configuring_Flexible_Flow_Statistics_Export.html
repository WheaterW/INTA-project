
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Flexible Flow Statistics Export">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="galaxy_netstream_cfg_0054.html">
<meta name="DC.Relation" scheme="URI" content="galaxy_netstream_cfg_0055.html">
<meta name="DC.Relation" scheme="URI" content="galaxy_netstream_cfg_0057.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="NetStream">
<meta name="featuretype" content="System Monitoring">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="NetStream">
<meta name="featuretype" content="System Monitoring">
<meta name="featurename" content="NetStream">
<meta name="featuretype" content="System Monitoring">
<meta name="featurename" content="NetStream">
<meta name="featuretype" content="System Monitoring">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001512841718">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring Flexible Flow Statistics Export</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001512841718"></a><a name="EN-US_TASK_0000001512841718"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Flexible Flow Statistics Export</h1>
<div class="taskbody" id="taskbody924247537175343"><div class="context"><a name="EN-US_TASK_0000001512841718__1.3.1"></a><a name="1.3.1"></a>
<div class="p" id="EN-US_TASK_0000001512841718__context1532764741175343"><h4 class="sectiontitle">Networking Requirements</h4><p id="EN-US_TASK_0000001512841718__p2088409928175343">On the network shown in <a href="#EN-US_TASK_0000001512841718__fig376535683313">Figure 1</a>, Host1 and Host2 communicate with DeviceA through DeviceB. To support network planning, the network administrator wants the NetStream server to collect statistics about the traffic transmitted between the hosts and DeviceA.</p>
<div class="fignone" id="EN-US_TASK_0000001512841718__fig376535683313"><a name="EN-US_TASK_0000001512841718__fig376535683313"></a><a name="fig376535683313"></a><span class="figcap"><b>Figure 1 </b>NetStream networking diagram</span><div class="note" id="EN-US_TASK_0000001512841718__note882972081515"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0000001512841718__p128291720181517">In this example, interface 1 and interface 2 represent <span>100GE</span> <span>1/0/1</span> and <span>100GE</span> <span>1/0/2</span>, respectively.</p>
</div></div>
<br><span><img id="EN-US_TASK_0000001512841718__image188291920161518" src="figure/en-us_image_0000002135713857.png" width="NaN" height="NaN"></span></div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001512841718__1.3.2"></a><a name="1.3.2"></a><h4 class="sectiontitle">Procedure</h4>
<ol id="EN-US_TASK_0000001512841718__steps1882859887175343"><li id="EN-US_TASK_0000001512841718__step19211221513"><span id="EN-US_TASK_0000001512841718__cmd5927224514">Configure IP addresses for interfaces on DeviceB according to <a href="#EN-US_TASK_0000001512841718__fig376535683313">Figure 1</a>.</span><p><pre class="screen" id="EN-US_TASK_0000001512841718__screen831179378175343">&lt;<span class="keyword" id="EN-US_TASK_0000001512841718__keyword512844822213">HUAWEI</span>&gt; <strong id="EN-US_TASK_0000001512841718__b23676313175343">system-view</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font><span class="keyword" id="EN-US_TASK_0000001512841718__keyword798281642518">HUAWEI</span>] <strong id="EN-US_TASK_0000001512841718__b20453424172520">sysname DeviceB</strong>
[*<span class="keyword" id="EN-US_TASK_0000001512841718__keyword897171302918">DeviceB</span>] <strong id="EN-US_TASK_0000001512841718__b236048766175343">commit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font><span class="keyword" id="EN-US_TASK_0000001512841718__keyword187001432285">DeviceB</span>] <strong id="EN-US_TASK_0000001512841718__b1582931237175343">vlan 110</strong>
[*<span class="keyword" id="EN-US_TASK_0000001512841718__keyword0575618162914">DeviceB</span>-vlan110] <strong id="EN-US_TASK_0000001512841718__b1432022719175343">quit</strong>
[*<span class="keyword" id="EN-US_TASK_0000001512841718__keyword1218714217294">DeviceB</span>] <strong id="EN-US_TASK_0000001512841718__b763601305175343">interface vlanif 110</strong>
[*<span class="keyword" id="EN-US_TASK_0000001512841718__keyword3505172322917">DeviceB</span>-Vlanif110] <strong id="EN-US_TASK_0000001512841718__b905954520175343">ip address 10.1.1.1 24</strong>
[*<span class="keyword" id="EN-US_TASK_0000001512841718__keyword47951728152912">DeviceB</span>-Vlanif110] <strong id="EN-US_TASK_0000001512841718__b1179947032175343">quit</strong>
[*<span class="keyword" id="EN-US_TASK_0000001512841718__keyword5721143010291">DeviceB</span>] <strong id="EN-US_TASK_0000001512841718__b1881132603018">interface <span>100ge</span><span>1/0/1</span></strong>
[*<span class="keyword" id="EN-US_TASK_0000001512841718__keyword17243193332917">DeviceB</span>-<span>100GE</span><span>1/0/1</span>] <strong id="EN-US_TASK_0000001512841718__b994536304175343">port link-type trunk</strong>
[*<span class="keyword" id="EN-US_TASK_0000001512841718__keyword118013356298">DeviceB</span>-<span>100GE</span><span>1/0/1</span>] <strong id="EN-US_TASK_0000001512841718__b1552816274175343">port trunk pvid vlan 110</strong>
[*<span class="keyword" id="EN-US_TASK_0000001512841718__keyword124171137162918">DeviceB</span>-<span>100GE</span><span>1/0/1</span>] <strong id="EN-US_TASK_0000001512841718__b83886811175343">port trunk allow-pass vlan 110</strong>
[*<span class="keyword" id="EN-US_TASK_0000001512841718__keyword8561839132916">DeviceB</span>-<span>100GE</span><span>1/0/1</span>] <strong id="EN-US_TASK_0000001512841718__b628137238175343">quit</strong>
[*<span class="keyword" id="EN-US_TASK_0000001512841718__keyword48334152910">DeviceB</span>] <strong id="EN-US_TASK_0000001512841718__b1148590290175343">vlan 120</strong>
[*<span class="keyword" id="EN-US_TASK_0000001512841718__keyword43901344122913">DeviceB</span>-vlan120] <strong id="EN-US_TASK_0000001512841718__b693090315175343">quit</strong>
[*<span class="keyword" id="EN-US_TASK_0000001512841718__keyword97793462293">DeviceB</span>] <strong id="EN-US_TASK_0000001512841718__b911134003175343">interface vlanif 120</strong>
[*<span class="keyword" id="EN-US_TASK_0000001512841718__keyword278113484296">DeviceB</span>-Vlanif120] <strong id="EN-US_TASK_0000001512841718__b2003034943175343">ip address 10.1.2.1 24</strong>
[*<span class="keyword" id="EN-US_TASK_0000001512841718__keyword9720750192912">DeviceB</span>-Vlanif120] <strong id="EN-US_TASK_0000001512841718__b657157549175343">quit</strong>
[*<span class="keyword" id="EN-US_TASK_0000001512841718__keyword18466526290">DeviceB</span>] <strong id="EN-US_TASK_0000001512841718__b46371627193410">interface <span>100ge</span></strong><strong id="EN-US_TASK_0000001512841718__b1334953113472"><span>1/0/2</span></strong>
[*<span class="keyword" id="EN-US_TASK_0000001512841718__keyword6628135517294">DeviceB</span>-<span>100GE</span><span>1/0/2</span>] <strong id="EN-US_TASK_0000001512841718__b1538820174175343">port link-type trunk</strong>
[*<span class="keyword" id="EN-US_TASK_0000001512841718__keyword831425822915">DeviceB</span>-<span>100GE</span><span>1/0/2</span>] <strong id="EN-US_TASK_0000001512841718__b1314919309175343">port trunk pvid vlan 120</strong>
[*<span class="keyword" id="EN-US_TASK_0000001512841718__keyword1064714013020">DeviceB</span>-<span>100GE</span><span>1/0/2</span>] <strong id="EN-US_TASK_0000001512841718__b1574170918175343">port trunk allow-pass vlan 120</strong>
[*<span class="keyword" id="EN-US_TASK_0000001512841718__keyword139771826308">DeviceB</span>-<span>100GE</span><span>1/0/2</span>] <strong id="EN-US_TASK_0000001512841718__b809857321175343">quit</strong></pre>
</p></li><li id="EN-US_TASK_0000001512841718__step480773584175343"><span id="EN-US_TASK_0000001512841718__cmd1528146274175343">Configure a flexible flow statistics template.</span><p><p id="EN-US_TASK_0000001512841718__p361695262175343"># Create a flexible flow statistics template named <strong id="EN-US_TASK_0000001512841718__b12390152214220">record1</strong> to aggregate flows based on source and destination addresses, and configure the exported packets to include the number of bytes and packets.</p>
<pre class="screen" id="EN-US_TASK_0000001512841718__screen1600611920175343">[*<span class="keyword" id="EN-US_TASK_0000001512841718__keyword1641855315419">DeviceB</span>] <strong id="EN-US_TASK_0000001512841718__b1690902870175343">netstream record record1 ip</strong>
[*<span class="keyword" id="EN-US_TASK_0000001512841718__keyword2594014133">DeviceB</span>-netstream-record-ipv4-record1] <strong id="EN-US_TASK_0000001512841718__b1234873388175343">match ip destination-address</strong>
[*<span class="keyword" id="EN-US_TASK_0000001512841718__keyword61531115135">DeviceB</span>-netstream-record-ipv4-record1] <strong id="EN-US_TASK_0000001512841718__b546947352175343">match ip source-address</strong>
[*<span class="keyword" id="EN-US_TASK_0000001512841718__keyword18149192121320">DeviceB</span>-netstream-record-ipv4-record1] <strong id="EN-US_TASK_0000001512841718__b339782635175343">collect counter bytes</strong>
[*<span class="keyword" id="EN-US_TASK_0000001512841718__keyword1127916321312">DeviceB</span>-netstream-record-ipv4-record1] <strong id="EN-US_TASK_0000001512841718__b618506457175343">collect counter packets</strong>
[*<span class="keyword" id="EN-US_TASK_0000001512841718__keyword9350134191314">DeviceB</span>-netstream-record-ipv4-record1] <strong id="EN-US_TASK_0000001512841718__b1209870814175343">quit</strong></pre>
</p></li><li id="EN-US_TASK_0000001512841718__step969440636175343"><span id="EN-US_TASK_0000001512841718__cmd430339463175343">Configure NetStream sampling.</span><p><p id="EN-US_TASK_0000001512841718__p1023955257175343"># Configure NetStream sampling for the incoming and outgoing traffic on <span>100GE</span> <span>1/0/1</span> and set the sampling rate to 1024.</p>
<pre class="screen" id="EN-US_TASK_0000001512841718__screen185479254175343">[*<span class="keyword" id="EN-US_TASK_0000001512841718__keyword4207913171318">DeviceB</span>] <strong id="EN-US_TASK_0000001512841718__b1612438177175343">interface <span>100ge</span><span>1/0/1</span></strong>
[*<span class="keyword" id="EN-US_TASK_0000001512841718__keyword1154210261296">DeviceB</span>-<span>100GE</span><span>1/0/1</span>] <strong id="EN-US_TASK_0000001512841718__b150922601175343">netstream sampler random-packets 1024 inbound</strong>
[*<span class="keyword" id="EN-US_TASK_0000001512841718__keyword269582718296">DeviceB</span>-<span>100GE</span><span>1/0/1</span>] <strong id="EN-US_TASK_0000001512841718__b50837683175343">netstream sampler random-packets 1024 outbound</strong>
[*<span class="keyword" id="EN-US_TASK_0000001512841718__keyword1678961631316">DeviceB</span>-<span>100GE</span><span>1/0/1</span>] <strong id="EN-US_TASK_0000001512841718__b224373670175343">quit</strong></pre>
</p></li><li id="EN-US_TASK_0000001512841718__step674158920175343"><span id="EN-US_TASK_0000001512841718__cmd465246868175343">Configure NetStream flexible flow statistics export.</span><p><p id="EN-US_TASK_0000001512841718__p827149705175343"># Set the source IP address of the exported packets carrying flexible flow statistics to 10.1.2.1, destination IP address to 10.1.2.2, destination port number to 6000, and DSCP value to 0.</p>
<pre class="screen" id="EN-US_TASK_0000001512841718__screen1415132571175343">[*<span class="keyword" id="EN-US_TASK_0000001512841718__keyword173391921317">DeviceB</span>] <strong id="EN-US_TASK_0000001512841718__b909782340175343">netstream export ip source 10.1.2.1</strong>
[*<span class="keyword" id="EN-US_TASK_0000001512841718__keyword10790142091316">DeviceB</span>] <strong id="EN-US_TASK_0000001512841718__b1937172080175343">netstream export ip host 10.1.2.2 6000</strong> <strong id="EN-US_TASK_0000001512841718__b395185814719">dscp 0</strong></pre>
</p></li><li id="EN-US_TASK_0000001512841718__step613504308175343"><span id="EN-US_TASK_0000001512841718__cmd1097915309175343">Enable flexible flow statistics collection on an interface.</span><p><p id="EN-US_TASK_0000001512841718__p673503675175343"># Enable flexible flow statistics collection for incoming and outgoing packets on <span>100GE</span> <span>1/0/1</span>, and apply the flexible flow statistics template to the interface.</p>
<pre class="screen" id="EN-US_TASK_0000001512841718__screen1952966713175343">[*<span class="keyword" id="EN-US_TASK_0000001512841718__keyword937413014132">DeviceB</span>] <strong id="EN-US_TASK_0000001512841718__b951195130175343">interface <span>100ge</span><span>1/0/1</span></strong> 
[*<span class="keyword" id="EN-US_TASK_0000001512841718__keyword238911318132">DeviceB</span>-<span>100GE</span><span>1/0/1</span>] <strong id="EN-US_TASK_0000001512841718__b1924552748175343">netstream record record1 ip</strong>
[*<span class="keyword" id="EN-US_TASK_0000001512841718__keyword13480143241315">DeviceB</span>-<span>100GE</span><span>1/0/1</span>] <strong id="EN-US_TASK_0000001512841718__b207915001175343">netstream inbound ip</strong>
[*<span class="keyword" id="EN-US_TASK_0000001512841718__keyword11453183312133">DeviceB</span>-<span>100GE</span><span>1/0/1</span>] <strong id="EN-US_TASK_0000001512841718__b1771257842175343">netstream outbound ip </strong>
[*<span class="keyword" id="EN-US_TASK_0000001512841718__keyword18539334111312">DeviceB</span>-<span>100GE</span><span>1/0/1</span>] <strong id="EN-US_TASK_0000001512841718__b380545366175343">quit</strong>
[*<span class="keyword" id="EN-US_TASK_0000001512841718__keyword48741635121319">DeviceB</span>] <strong id="EN-US_TASK_0000001512841718__b1503851311175343">commit</strong></pre>
</p></li><li id="EN-US_TASK_0000001512841718__step393853144175343"><span id="EN-US_TASK_0000001512841718__cmd945191154175343">Verify the configuration.</span><p><p id="EN-US_TASK_0000001512841718__p1756317784175343"># View flow statistics.</p>
<pre class="screen" id="EN-US_TASK_0000001512841718__screen1788215361739">[<font style="font-size:8pt" Face="Courier New" >~</font><span class="keyword" id="EN-US_TASK_0000001512841718__keyword588293611311">DeviceB</span>] <strong id="EN-US_TASK_0000001512841718__b158826361536">display netstream statistics ip slot </strong><span>1</span>
 Last time when statistics were cleared: -
 -------------------------------------------------------------------------------
 Packet Length    : Number
 -------------------------------------------------------------------------------
 1      <font style="font-size:8pt" Face="Courier New" >~</font>    64   : 15
 65     <font style="font-size:8pt" Face="Courier New" >~</font>    128  : 14
 129    <font style="font-size:8pt" Face="Courier New" >~</font>    256  : 1
 257    <font style="font-size:8pt" Face="Courier New" >~</font>    512  : 0
 513    <font style="font-size:8pt" Face="Courier New" >~</font>    1024 : 0
 1025   <font style="font-size:8pt" Face="Courier New" >~</font>    1500 : 0
 longer than 1500 : 0
 -------------------------------------------------------------------------------
 StreamType
      Current           Aged        Created       Exported       Exported
      (streams)         (streams)   (streams)     (streams)      (Packets)
 -------------------------------------------------------------------------------
 origin
            0              0              0              0              0
 ------------------------------------------------------------------------------- 
 record1
            2              2              4              2              2
-------------------------------------------------------------------------------</pre>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0000001512841718__example1967683934175343"><a name="EN-US_TASK_0000001512841718__1.3.3"></a><a name="1.3.3"></a><h4 class="sectiontitle">Configuration Scripts</h4><p id="EN-US_TASK_0000001512841718__p1992994738175343">DeviceB</p>
<pre class="screen" id="EN-US_TASK_0000001512841718__screen299565017175343">#                                                                               
sysname DeviceB 
# 
vlan batch 110 120 
# 
netstream export ip source 10.1.2.1
netstream export ip host 10.1.2.2 6000 dscp 0
#
netstream record record1 ip
 collect counter bytes
 collect counter packets
 match ip destination-address
 match ip source-address
#    
interface Vlanif110                                                             
 ip address 10.1.1.1 255.255.255.0 
#                                                                               
interface Vlanif120                                                             
 ip address 10.1.2.1 255.255.255.0 
# 
interface <span>100GE</span><span>1/0/1</span>        
 port link-type trunk                                                           
 port trunk pvid vlan 110                                                       
 port trunk allow-pass vlan 110 
 netstream inbound ip 
 netstream outbound ip 
 netstream sampler random-packets 1024 inbound
 netstream sampler random-packets 1024 outbound
 netstream record record1 ip
# 
interface <span>100GE</span><span>1/0/2</span>                                                  
 port link-type trunk                                                           
 port trunk pvid vlan 120                                                       
 port trunk allow-pass vlan 120
# 
return</pre>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="galaxy_netstream_cfg_0054.html">NetStream Configuration Examples
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="galaxy_netstream_cfg_0055.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="galaxy_netstream_cfg_0057.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>