
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring OSPF IP FRR">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../vrp/vrp_ospf_cfg_0197.html">
<meta name="DC.Relation" scheme="URI" content="../vrp/vrp_ospf_cfg_0100_copy.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="OSPF">
<meta name="featuretype" content="IP Routing">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="OSPF">
<meta name="featuretype" content="IP Routing">
<meta name="featuretype" content="IP Routing">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001176663027">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="../public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring OSPF IP FRR</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001176663027"></a><a name="EN-US_TASK_0000001176663027"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring OSPF IP FRR</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001176663027__1.3.1"></a><a name="1.3.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><div class="p">If a fault occurs on a primary link, traffic is switched to a backup link. In this scenario, two problems arise:<ul><li>If the OSPF fault detection mechanism is used, it takes hundreds of milliseconds to switch traffic to the backup link. During this period, traffic is interrupted.</li><li>Traffic may be switched to the link that passes through DeviceA. DeviceA is an ASBR and is not expected to function as a backup device.</li></ul>
</div>
<p>If a fault occurs on the network, OSPF IP FRR can rapidly switch traffic to the backup link without waiting for route convergence, ensuring uninterrupted traffic transmission. In addition, you can also prevent the link that passes through DeviceA from functioning as the FRR backup link.</p>
<div class="p">On the network shown in <a href="#EN-US_TASK_0000001176663027__en-us_task_0275861814_fig_dc_vrp_ospf_cfg_200801">Figure 1</a>:<ul><li>OSPF runs on all devices.</li><li>The link costs meet the OSPF IP FRR inequality.</li><li><p>If the primary link (link T) fails, DeviceS immediately switches traffic to the backup link, which passes through DeviceN.</p>
</li><li>Based on the network planning, the link that passes through DeviceA does not function as an FRR backup link.</li></ul>
</div>
<div class="fignone" id="EN-US_TASK_0000001176663027__en-us_task_0275861814_fig_dc_vrp_ospf_cfg_200801"><a name="EN-US_TASK_0000001176663027__en-us_task_0275861814_fig_dc_vrp_ospf_cfg_200801"></a><a name="en-us_task_0275861814_fig_dc_vrp_ospf_cfg_200801"></a><span class="figcap"><b>Figure 1 </b>Network diagram of OSPF IP FRR</span><div class="note"><img src="../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface1, interface2, interface3, and interface4 represent <span>100GE</span> <span>1/0/1</span>, <span>100GE</span> <span>1/0/2</span>, <span>100GE</span> <span>1/0/3</span>, and <span>100GE</span><span>1/0/4</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0000001229800821.png"></span></div>

<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" frame="border" border="1" rules="all"><thead align="left"><tr><th align="left" class="cellrowborder" char="." valign="top" width="25%" id="mcps1.3.1.6.1.5.1.1" liSelected="liSelected"><p>Device</p>
</th>
<th align="left" class="cellrowborder" char="." valign="top" width="11%" id="mcps1.3.1.6.1.5.1.2" liSelected="liSelected"><p>Router ID</p>
</th>
<th align="left" class="cellrowborder" char="." valign="top" width="32%" id="mcps1.3.1.6.1.5.1.3" liSelected="liSelected"><p>Interface</p>
</th>
<th align="left" class="cellrowborder" char="." valign="top" width="32%" id="mcps1.3.1.6.1.5.1.4" liSelected="liSelected"><p>IP Address</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" rowspan="3" char="." valign="top" width="25%" headers="mcps1.3.1.6.1.5.1.1 "><p>DeviceS</p>
</td>
<td class="cellrowborder" rowspan="3" char="." valign="top" width="11%" headers="mcps1.3.1.6.1.5.1.2 "><p>1.1.1.1</p>
</td>
<td class="cellrowborder" char="." valign="top" width="32%" headers="mcps1.3.1.6.1.5.1.3 "><p><span>100GE</span><span>1/0/1</span></p>
</td>
<td class="cellrowborder" char="." valign="top" width="32%" headers="mcps1.3.1.6.1.5.1.4 "><p>10.1.1.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.3.1.6.1.5.1.1 "><p><span>100GE</span><span>1/0/2</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.3.1.6.1.5.1.2 "><p>10.1.2.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.3.1.6.1.5.1.1 "><p><span>100GE</span><span>1/0/3</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.3.1.6.1.5.1.2 "><p>10.1.3.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="2" char="." valign="top" width="25%" headers="mcps1.3.1.6.1.5.1.1 "><p>DeviceA</p>
</td>
<td class="cellrowborder" rowspan="2" char="." valign="top" width="11%" headers="mcps1.3.1.6.1.5.1.2 "><p>2.2.2.2</p>
</td>
<td class="cellrowborder" char="." valign="top" width="32%" headers="mcps1.3.1.6.1.5.1.3 "><p><span>100GE</span><span>1/0/1</span></p>
</td>
<td class="cellrowborder" char="." valign="top" width="32%" headers="mcps1.3.1.6.1.5.1.4 "><p>10.1.1.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.3.1.6.1.5.1.1 "><p><span>100GE</span><span>1/0/2</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.3.1.6.1.5.1.2 "><p>10.2.1.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="2" char="." valign="top" width="25%" headers="mcps1.3.1.6.1.5.1.1 "><p>DeviceN</p>
</td>
<td class="cellrowborder" rowspan="2" char="." valign="top" width="11%" headers="mcps1.3.1.6.1.5.1.2 "><p>3.3.3.3</p>
</td>
<td class="cellrowborder" char="." valign="top" width="32%" headers="mcps1.3.1.6.1.5.1.3 "><p><span>100GE</span><span>1/0/1</span></p>
</td>
<td class="cellrowborder" char="." valign="top" width="32%" headers="mcps1.3.1.6.1.5.1.4 "><p>10.1.3.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.3.1.6.1.5.1.1 "><p><span>100GE</span><span>1/0/2</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.3.1.6.1.5.1.2 "><p>10.2.3.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="4" char="." valign="top" width="25%" headers="mcps1.3.1.6.1.5.1.1 "><p>DeviceE</p>
</td>
<td class="cellrowborder" rowspan="4" char="." valign="top" width="11%" headers="mcps1.3.1.6.1.5.1.2 "><p>4.4.4.4</p>
</td>
<td class="cellrowborder" char="." valign="top" width="32%" headers="mcps1.3.1.6.1.5.1.3 "><p><span>100GE</span><span>1/0/1</span></p>
</td>
<td class="cellrowborder" char="." valign="top" width="32%" headers="mcps1.3.1.6.1.5.1.4 "><p>10.2.1.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.3.1.6.1.5.1.1 "><p><span>100GE</span><span>1/0/2</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.3.1.6.1.5.1.2 "><p>10.1.2.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.3.1.6.1.5.1.1 "><p><span>100GE</span><span>1/0/3</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.3.1.6.1.5.1.2 "><p>10.2.3.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.3.1.6.1.5.1.1 "><p><span>100GE</span><span>1/0/4</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.3.1.6.1.5.1.2 "><p>172.17.1.1/24</p>
</td>
</tr>
</tbody>
</table>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001176663027__1.3.2"></a><a name="1.3.2"></a>
<div class="p"><h4 class="sectiontitle">Precautions</h4><div class="p">During the configuration, note the following:<ul><li>Before configuring OSPF IP FRR, disabling FRR on specific interfaces is recommended. This prevents the links connected to these interfaces from being calculated as backup links during FRR calculation.</li><li>When OSPF IP FRR is configured, the underlying layer must be able to quickly respond to link changes so that traffic can be quickly switched to the backup link. After the <a href="cmdqueryname=bfd+all-interfaces"><b><span class="cmdname">bfd all-interfaces</span></b></a> <strong><span>frr-binding</span></strong> command is run, the BFD session status is bound to the link status of the interface (when the BFD session goes down, the link status of the interface also goes down). In this manner, faults can be rapidly detected.</li><li>To improve security, OSPF area authentication or interface authentication is recommended. For details, see "Improving OSPF Network Security." OSPF area authentication is used as an example. For details, see "Example for Configuring Basic OSPF Functions."</li></ul>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001176663027__1.3.3"></a><a name="1.3.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><div class="p">The configuration roadmap is as follows:<ol><li><p>Configure basic OSPF functions on each device.</p>
</li><li><p>Configure BFD for OSPF on all the devices in area 0.</p>
</li><li><p>Set link costs to ensure that link T is preferentially selected to transmit traffic.</p>
</li><li><p>Disable FRR on a specified interface of DeviceS.</p>
</li><li>Enable OSPF IP FRR on DeviceS to protect the traffic it forwards.</li></ol>
</div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001176663027__1.3.4"></a><a name="1.3.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Assign an IP address to each interface.</span><p><p>Assign an IP address to each interface as shown in <a href="#EN-US_TASK_0000001176663027__en-us_task_0275861814_fig_dc_vrp_ospf_cfg_200801">Figure 1</a>. For detailed configurations, see the configuration scripts.</p>
</p></li><li><span>Configure basic OSPF functions.</span><p><p>See <a href="vrp_ospf_cfg_0018.html">Example for Configuring Basic OSPF Functions</a>. For detailed configurations, see Configuration Scripts.</p>
</p></li><li><span>Configure BFD for OSPF on all the devices in area 0.</span><p><p># Configure DeviceS.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceS] <strong>bfd</strong>
[<span><span class="keyword">*</span></span>DeviceS-bfd] <strong>quit</strong>
[<span><span class="keyword">*</span></span>DeviceS] <strong>ospf 1</strong>
[<span><span class="keyword">*</span></span>DeviceS-ospf-1] <strong>bfd all-interfaces enable</strong>
[<span><span class="keyword">*</span></span>DeviceS-ospf-1] <strong>quit</strong>
<span>[<span><span class="keyword">*</span></span>DeviceS] <strong>commit</strong></span></pre>
<p>The configurations of DeviceA, DeviceN, and DeviceE are similar to the configuration of DeviceS. For detailed configurations, see Configuration Scripts.</p>
</p></li><li><span>Set the costs of links to ensure that link T is selected to transmit traffic.</span><p><p># Configure DeviceS.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceS] <strong>interface <span>100ge</span> <span>1/0/1</span></strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceS-<span>100GE</span><span>1/0/1</span>] <strong>ospf cost 10</strong>
[<span><span class="keyword">*</span></span>DeviceS-<span>100GE</span><span>1/0/1</span>] <strong>quit</strong>
[<span><span class="keyword">*</span></span>DeviceS] <strong>interface </strong><strong><span>100ge</span></strong><strong> </strong><strong><span>1/0/2</span></strong>
[<span><span class="keyword">*</span></span>DeviceS-<span>100GE</span><span>1/0/2</span>] <strong>ospf cost 15</strong>
[<span><span class="keyword">*</span></span>DeviceS-<span>100GE</span><span>1/0/2</span>] <strong>quit</strong>
[<span><span class="keyword">*</span></span>DeviceS] <strong>interface <span>100ge</span></strong> <strong><span>1/0/3</span></strong>
[<span><span class="keyword">*</span></span>DeviceS-<span>100GE</span><span>1/0/3</span>] <strong>ospf cost 10</strong>
[<span><span class="keyword">*</span></span>DeviceS-<span>100GE</span><span>1/0/3</span>] <strong>quit</strong>
<span>[<span><span class="keyword">*</span></span>DeviceS] <strong>commit</strong></span></pre>
</p><p><p># Configure DeviceA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>interface </strong><strong><span>100ge</span></strong><strong> </strong><strong><span>1/0/2</span></strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA-<span>100GE</span><span>1/0/2</span>] <strong>ospf cost 15</strong>
[<span><span class="keyword">*</span></span>DeviceA-<span>100GE</span><span>1/0/2</span>] <strong>quit</strong>
<span>[<span><span class="keyword">*</span></span>DeviceA] <strong>commit</strong></span></pre>
</p><p><p># Configure DeviceN.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceN] <strong>interface </strong><strong><span>100ge</span></strong><strong> </strong><strong><span>1/0/2</span></strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceN-<span>100GE</span><span>1/0/2</span>] <strong>ospf cost 10</strong>
[<span><span class="keyword">*</span></span>DeviceN-<span>100GE</span><span>1/0/2</span>] <strong>quit</strong>
<span>[<span><span class="keyword">*</span></span>DeviceN] <strong>commit</strong></span></pre>
</p></li><li><span>Disable FRR on a specified interface of DeviceS.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceS] <strong>interface </strong><strong><span>100ge</span></strong><strong> </strong><strong><span>1/0/1</span></strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceS-<span>100GE</span><span>1/0/1</span>] <strong>ospf frr block</strong>
[<span><span class="keyword">*</span></span>DeviceS-<span>100GE</span><span>1/0/1</span>] <strong>quit</strong>
<span>[<span><span class="keyword">*</span></span>DeviceS] <strong>commit</strong></span></pre>
</p></li><li><span>Enable OSPF IP FRR, and bind IP FRR and BFD on DeviceS.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceS] <strong>ospf</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceS-ospf-1] <strong>frr</strong>
[<span><span class="keyword">*</span></span>DeviceS-ospf-1-frr] <strong>loop-free-alternate</strong>
[<span><span class="keyword">*</span></span>DeviceS-ospf-1-frr] <strong>quit</strong>
[<span><span class="keyword">*</span></span>DeviceS-ospf-1] <a href="cmdqueryname=bfd+all-interfaces"><b><span class="cmdname">bfd all-interfaces</span></b></a> <strong><span>frr-binding</span></strong>
[<span><span class="keyword">*</span></span>DeviceS-ospf-1] <strong>quit</strong>
<span>[<span><span class="keyword">*</span></span>DeviceS] <strong>commit</strong></span></pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001176663027__1.3.5"></a><a name="1.3.5"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p># Run the <a href="cmdqueryname=display+ospf+routing"><b><span class="cmdname">display ospf routing</span></b></a> command on DeviceS to check routing information.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceS] <strong>display ospf routing router-id 4.4.4.4</strong>
          OSPF Process 1 with Router ID 1.1.1.1

 Destination :    4.4.4.4             Route Type :       Intra-area
 Area        :    0.0.0.1             AdvRouter  :       4.4.4.4
 Type        :    ASBR                
 URT Cost    :    59
 NextHop     :    10.1.2.2           Interface  :       <span>100GE</span><span>1/0/2</span>
<strong> Backup Nexthop : 10.1.3.2         Backup Interface : <span>100GE</span><span>1/0/3</span>  Backup Type : LFA LINK          </strong></pre>
<p>The command output shows that a backup link has been generated through FRR calculation on DeviceS.</p>
</div>
<div class="postreq"><a name="EN-US_TASK_0000001176663027__1.3.6"></a><a name="1.3.6"></a><h4 class="sectiontitle">Configuration Scripts</h4><ul><li><p>DeviceS</p>
<pre class="screen">#
 sysname DeviceS
#
 bfd
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 10.1.1.1 255.255.255.0
 ospf frr block
 ospf cost 10
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ip address 10.1.2.1 255.255.255.0
 ospf cost 15
#
interface <span>100GE</span><span>1/0/3</span>
 undo portswitch
 ip address 10.1.3.1 255.255.255.0
 ospf cost 10
#
interface LoopBack0
 ip address 1.1.1.1 255.255.255.255
#
ospf 1 router-id 1.1.1.1
 bfd all-interfaces enable
 bfd all-interfaces frr-binding
 frr
  loop-free-alternate
 area 0.0.0.0
  network 10.1.1.0 0.0.0.255
  network 10.1.2.0 0.0.0.255
  network 10.1.3.0 0.0.0.255
#
return</pre>
</li><li><p>DeviceA</p>
<pre class="screen">#
 sysname DeviceA
#  
 bfd
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 10.1.1.2 255.255.255.0
 ospf cost 10
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ip address 10.2.1.2 255.255.255.0
 ospf cost 15
#
interface LoopBack0
 ip address 2.2.2.2 255.255.255.255
#
ospf 1 router-id 2.2.2.2
 bfd all-interfaces enable
 area 0.0.0.0
  network 10.1.1.0 0.0.0.255
  network 10.2.2.0 0.0.0.255
#
return</pre>
</li><li><p>DeviceN</p>
<pre class="screen">#
 sysname DeviceN
#
 bfd
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 10.1.3.2 255.255.255.0
 ospf cost 10
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ip address 10.2.3.2 255.255.255.0
 ospf cost 10
#
interface LoopBack0
 ip address 3.3.3.3 255.255.255.255
#
ospf 1 router-id 3.3.3.3
 bfd all-interfaces enable
 area 0.0.0.0
  network 10.1.3.0 0.0.0.255
  network 10.2.3.0 0.0.0.255
#
return</pre>
</li><li><p>DeviceE</p>
<pre class="screen">#
 sysname DeviceE
#
 bfd
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 10.2.1.1 255.255.255.0
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ip address 10.1.2.2 255.255.255.0
#
interface <span>100GE</span><span>1/0/3</span>
 undo portswitch
 ip address 10.2.3.1 255.255.255.0
#
interface <span>100GE</span><span>1/0/4</span>
 undo portswitch
 ip address 172.17.1.1 255.255.255.0
 ospf cost 5
#
interface LoopBack0
 ip address 4.4.4.4 255.255.255.255
#
ospf 1 router-id 4.4.4.4
 bfd all-interfaces enable
 area 0.0.0.0
  network 10.1.1.0 0.0.0.255
  network 10.1.2.0 0.0.0.255
  network 10.1.3.0 0.0.0.255
  network 172.17.1.0 0.0.0.255
#
return</pre>
</li></ul>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../vrp/vrp_ospf_cfg_0197.html">Configuring OSPF IP FRR
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../vrp/vrp_ospf_cfg_0100_copy.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>
</body>
</html>