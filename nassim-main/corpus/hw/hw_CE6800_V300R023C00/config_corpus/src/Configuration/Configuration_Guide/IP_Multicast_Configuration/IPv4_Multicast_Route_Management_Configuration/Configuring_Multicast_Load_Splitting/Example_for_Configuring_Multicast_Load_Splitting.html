
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Multicast Load Splitting">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="vrp_mcast_cfg_0014.html">
<meta name="DC.Relation" scheme="URI" content="vrp_mcast_cfg_0016.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="IPv4 Multicast Route Management">
<meta name="featuretype" content="IP Multicast">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="IPv4 Multicast Route Management">
<meta name="featuretype" content="IP Multicast">
<meta name="featurename" content="IPv4 Multicast Route Management">
<meta name="featuretype" content="IP Multicast">
<meta name="featuretype" content="IP Multicast">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001176662523">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<link rel="stylesheet" type="text/css" href="public_sys-resources/imagePopup.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/customQuery.js"></script>
<script language="javascript" type="text/javascript" src="public_sys-resources/imagePopup.js"></script>
<title>Example for Configuring Multicast Load Splitting</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001176662523"></a><a name="EN-US_TASK_0000001176662523"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Multicast Load Splitting</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001176662523__1.3.1"></a><a name="1.3.1"></a>
<div class="p"><div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On a PIM-SM network where multicast services are stable, configure the stable-preferred multicast load splitting policy so that multicast traffic can be distributed among multiple equal-cost routes for transmission. As shown in <a href="#EN-US_TASK_0000001176662523__fig_dc_vrp_multicast_cfg_009701">Figure 1</a>, there are three equal-cost routes from the device connected with HostA to the multicast source (Source). HostA needs to stably receive multicast data for an extended period of time from the source. To evenly distribute entries to equal-cost routes, a multicast load splitting policy is required so that load balancing among the equal-cost routes can be implemented.</p>
<div class="fignone" id="EN-US_TASK_0000001176662523__fig_dc_vrp_multicast_cfg_009701"><a name="EN-US_TASK_0000001176662523__fig_dc_vrp_multicast_cfg_009701"></a><a name="fig_dc_vrp_multicast_cfg_009701"></a><span class="figcap"><b>Figure 1 </b>Network diagram of configuring multicast load splitting</span><div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface1, interface2, interface3, and interface4 represent <span>100GE</span><span>1/0/1</span>, <span>100GE</span><span>1/0/2</span>, <span>100GE</span><span>1/0/3</span>, and <span>100GE</span><span>1/0/4</span>, respectively.</p>
</div></div>
<br><span><img class="imgResize" src="figure/en-us_image_0000001216407038.png" width="522.69" height="228.49838900000003" title="Click to enlarge"></span></div>
<h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure IP addresses for interfaces.</p>
</li><li><p>Configure IS-IS to implement interworking among all the devices and ensure that route costs are the same.</p>
</li><li><p>Enable the multicast function on all the devices, enable PIM-SM on all the involved interfaces, and configure the loopback interface of DeviceA as an RP.</p>
</li><li><p>Configure stable-preferred multicast load splitting on DeviceE.</p>
</li><li><p>Configure the host-facing interface of DeviceF to statically join the multicast groups.</p>
</li></ol>
</div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001176662523__1.3.2"></a><a name="1.3.2"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Assign IP addresses to interfaces.</span><p><p># Configure DeviceA.</p>
<pre class="screen">&lt;HUAWEI&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname DeviceA</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>]<strong> commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>interface </strong><strong><span>100GE</span> <span>1/0/1</span></strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>undo </strong><strong>portswitch</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>ip address 10.110.1.2 255.255.255.0</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>interface </strong><strong><span>100GE</span> <span>1/0/2</span></strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/2</span>] <strong>undo </strong><strong>portswitch</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/2</span>] <strong>ip address 192.168.1.1 255.255.255.0</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/2</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>interface </strong><strong><span>100GE</span> <span>1/0/3</span></strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/3</span>] <strong>undo </strong><strong>portswitch</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/3</span>] <strong>ip address 192.168.2.1 255.255.255.0</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/3</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>interface </strong><strong><span>100GE</span> <span>1/0/4</span></strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/4</span>] <strong>undo </strong><strong>portswitch</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/4</span>] <strong>ip address 192.168.3.1 255.255.255.0</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/4</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>interface </strong><strong>Loopback 0</strong>
[<span class="keyword">*</span>DeviceA-LoopBack0] <strong>ip address 1.1.1.1 255.255.255.255</strong>
[<span class="keyword">*</span>DeviceA-LoopBack0] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>commit</strong></pre>
<p>The configurations of DeviceB, DeviceC, DeviceD, DeviceE, and DeviceF are similar to the configuration of DeviceA. For detailed configurations, see Configuration Scripts.</p>
</p></li><li><span>Configure IS-IS to implement interworking among all the devices and ensure that route costs are the same.</span><p><p># Configure DeviceA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>isis 1</strong>
[<span class="keyword">*</span>DeviceA-isis-1] <strong>network-entity 10.0000.0000.0001.00</strong>
[<span class="keyword">*</span>DeviceA-isis-1] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>interface </strong><strong><span>100GE</span> <span>1/0/1</span></strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>isis enable 1</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>interface </strong><strong><span>100GE</span> <span>1/0/2</span></strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/2</span>] <strong>isis enable 1</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/2</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>interface </strong><strong><span>100GE</span> <span>1/0/3</span></strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/3</span>] <strong>isis enable 1</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/3</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>interface </strong><strong><span>100GE</span> <span>1/0/4</span></strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/4</span>] <strong>isis enable 1</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/4</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>interface </strong><strong>Loopback 0</strong>
[<span class="keyword">*</span>DeviceA-LoopBack0] <strong>isis enable 1</strong>
[<span class="keyword">*</span>DeviceA-LoopBack0] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>commit</strong></pre>
<p>The configurations of DeviceB, DeviceC, DeviceD, DeviceE, and DeviceF are similar to the configuration of DeviceA. For detailed configurations, see Configuration Scripts.</p>
</p></li><li><span>Enable the multicast function on all the devices and enable PIM-SM on all the involved interfaces.</span><p><p># Configure DeviceA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>multicast routing-enable</strong>
[<span class="keyword">*</span>DeviceA] <strong>interface </strong><strong><span>100GE</span></strong> <strong><span>1/0/1</span></strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>pim sm</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>interface</strong><strong> </strong><strong><span>100GE</span> <span>1/0/2</span></strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/2</span>] <strong>pim sm</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/2</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>interface </strong><strong><span>100GE</span> </strong><strong><span>1/0/3</span></strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/3</span>]<strong> pim sm</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/3</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>interface</strong> <strong><span>100GE</span> <span>1/0/4</span></strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/4</span>]<strong> pim sm</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/4</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>interface Loopback 0</strong>
[<span class="keyword">*</span>DeviceA-LoopBack0] <strong>pim sm</strong>
[<span class="keyword">*</span>DeviceA-LoopBack0] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>commit</strong></pre>
<p>The configurations of DeviceB, DeviceC, DeviceD, DeviceE, and DeviceF are similar to the configuration of DeviceA. For detailed configurations, see Configuration Scripts.</p>
</p></li><li><span>Enable IGMP on the interface connecting to the host.</span><p><p># Enable IGMP on the interface connecting DeviceF to the host.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceF] <strong>interface </strong><strong><span>100GE</span> <span>1/0/1</span></strong>
[<span class="keyword">*</span>DeviceF-<span>100GE</span><span>1/0/1</span>] <strong>igmp enable</strong>
[<span class="keyword">*</span>DeviceF-<span>100GE</span><span>1/0/1</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceF] <strong>commit</strong></pre>
</p></li><li><span>Configure DeviceA as an RP.</span><p><div class="p"># Configure Loopback0's address on DeviceA as the RP address.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>pim</strong>
[<span class="keyword">*</span>DeviceA-pim] <strong>c-bsr </strong><strong>loopback 0</strong>
[<span class="keyword">*</span>DeviceA-pim] <strong>c-rp </strong><strong>loopback 0</strong>
[<span class="keyword">*</span>DeviceA-pim] <strong>commit</strong></pre>
</div>
</p></li><li><span>Configure stable-preferred multicast load splitting on DeviceE.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceE] <strong>multicast load-splitting stable-preferred</strong>
[<span class="keyword">*</span>DeviceE] <strong>commit</strong></pre>
</p></li><li><span>Configure host-facing interfaces to statically join multicast groups.</span><p><p># Configure <span>100GE</span><span>1/0/1</span> that connects DeviceF to the host to statically join multicast groups 225.1.1.1 to 225.1.1.3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceF] <strong>interface <span>100GE</span> <span>1/0/1</span></strong>
[<span class="keyword">*</span>DeviceF-<span>100GE</span><span>1/0/1</span>] <strong>igmp static-group 225.1.1.1</strong> <strong>inc-step-mask</strong><strong> 32 number 3</strong>
[<span class="keyword">*</span>DeviceF-<span>100GE</span><span>1/0/1</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceF] <strong>commit</strong></pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001176662523__1.3.3"></a><a name="1.3.3"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p># Check the PIM routing table on DeviceE. Source (10.110.1.1/24) sends multicast data to multicast groups 225.1.1.1 to 225.1.1.3. HostA can receive the multicast data from the multicast source.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceE] <strong>display pim routing-table brief</strong>
 VPN-Instance: public net
 Total 3 (*, G) entries; 3 (S, G) entries

 Entries                                Upstream interface       NDwnstrms
 (*, 225.1.1.1)                         <span>100GE</span><span>1/0/3</span>                 1
 (10.110.1.1, 225.1.1.1)                <span>100GE</span><span>1/0/3</span>                 1
 (*, 225.1.1.2)                         <span>100GE</span><span>1/0/2</span>                 1
 (10.110.1.1, 225.1.1.2)                <span>100GE</span><span>1/0/2</span>                 1
 (*, 225.1.1.3)                         <span>100GE</span><span>1/0/1</span>                 1
 (10.110.1.1, 225.1.1.3)                <span>100GE</span><span>1/0/1</span>                 1
</pre>
<p>(*, G) and (S, G) entries are evenly distributed to the three equal-cost routes, with the upstream interfaces of the routes being <span>100GE</span><span>1/0/3</span>, <span>100GE</span><span>1/0/2</span>, and <span>100GE</span><span>1/0/1</span>.</p>
<div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The load splitting algorithm processes (*, G) and (S, G) entries separately using the same rule.</p>
</div></div>
</div>
<div class="postreq"><a name="EN-US_TASK_0000001176662523__1.3.4"></a><a name="1.3.4"></a><h4 class="sectiontitle">Configuration Scripts</h4><ul><li><p>DeviceA</p>
<pre class="screen">#
sysname DeviceA
#
multicast routing-enable
#
isis 1
 network-entity 10.0000.0000.0001.00
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 10.110.1.2 255.255.255.0
 pim sm
 isis enable 1
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ip address 192.168.1.1 255.255.255.0
 pim sm
 isis enable 1
#
interface <span>100GE</span><span>1/0/3</span>
 undo portswitch
 ip address 192.168.2.1 255.255.255.0
 pim sm
 isis enable 1
#
interface <span>100GE</span><span>1/0/4</span>
 undo portswitch
 ip address 192.168.3.1 255.255.255.0
 pim sm
 isis enable 1
#
interface Loopback0
 ip address 1.1.1.1 255.255.255.255
 pim sm
 isis enable 1
#
pim
 c-bsr LoopBack0
 c-rp LoopBack0
#
return</pre>
</li><li><p>DeviceB</p>
<pre class="screen">#
sysname DeviceB
#
multicast routing-enable
#
isis 1
 network-entity 10.0000.0000.0002.00
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 192.168.1.2 255.255.255.0
 pim sm
 isis enable 1
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ip address 192.168.4.1 255.255.255.0
 pim sm
 isis enable 1
#
return</pre>
</li><li><p>DeviceC</p>
<pre class="screen">#
sysname DeviceC
#
multicast routing-enable
#
isis 1
 network-entity 10.0000.0000.0003.00
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 192.168.2.2 255.255.255.0
 pim sm
 isis enable 1
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ip address 192.168.5.1 255.255.255.0
 pim sm
 isis enable 1
#
return</pre>
</li><li><p>DeviceD</p>
<pre class="screen">#
sysname DeviceD
#
multicast routing-enable
#
isis 1
 network-entity 10.0000.0000.0004.00
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 192.168.3.2 255.255.255.0
 pim sm
 isis enable 1
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ip address 192.168.6.1 255.255.255.0
 pim sm
 isis enable 1
#
return</pre>
</li><li><p>DeviceE</p>
<pre class="screen">#
sysname DeviceE
#
multicast routing-enable
multicast load-splitting stable-preferred
#
isis 1
 network-entity 10.0000.0000.0005.00
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 192.168.4.2 255.255.255.0
 isis enable 1
 pim sm
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ip address 192.168.5.2 255.255.255.0
 pim sm
 isis enable 1
#
interface <span>100GE</span><span>1/0/3</span>
 undo portswitch
 ip address 192.168.6.2 255.255.255.0
 pim sm
 isis enable 1
#
interface <span>100GE</span><span>1/0/4</span>
 undo portswitch
 ip address 192.168.7.1 255.255.255.0
 pim sm
 isis enable 1
#
return</pre>
</li><li><p>DeviceF</p>
<pre class="screen">#
sysname DeviceF
#
multicast routing-enable
#
isis 1
 network-entity 10.0000.0000.0006.00
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 10.110.2.2 255.255.255.0
 pim sm
 igmp enable
 igmp static-group 225.1.1.1 inc-step-mask 32 number 3
 isis enable 1
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ip address 192.168.7.2 255.255.255.0
 pim sm
 isis enable 1
#
return</pre>
</li></ul>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="vrp_mcast_cfg_0014.html">Configuring Multicast Load Splitting
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="vrp_mcast_cfg_0016.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>

<script language="JavaScript">
<!--
initImageViewer('.imgResize');
var msg_imageMax = "view original image";
var msg_imageClose = "close";
//--></script></body>
</html>