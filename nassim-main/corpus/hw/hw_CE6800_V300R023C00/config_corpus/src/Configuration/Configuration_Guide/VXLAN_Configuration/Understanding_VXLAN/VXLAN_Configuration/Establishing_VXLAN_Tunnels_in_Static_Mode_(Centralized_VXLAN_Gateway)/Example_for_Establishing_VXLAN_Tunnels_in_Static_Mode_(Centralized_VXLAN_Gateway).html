
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Establishing VXLAN Tunnels in Static Mode (Centralized VXLAN Gateway)">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../dc/dc_vrp_vxlan_cfg_1039.html">
<meta name="DC.Relation" scheme="URI" content="../dc/dc_vrp_vxlan_cfg_1046.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="VXLAN">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="VXLAN">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="VXLAN">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="VXLAN">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001130624508">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="../public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="../public_sys-resources/browseVersion.js"></script>
<title>Example for Establishing VXLAN Tunnels in Static Mode (Centralized VXLAN Gateway)</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001130624508"></a><a name="EN-US_TASK_0000001130624508"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Establishing VXLAN Tunnels in Static Mode (Centralized VXLAN Gateway)</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001130624508__1.3.1"></a><a name="1.3.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0000001130624508__fig_dc_cfg_vxlan_cfgcase_000101">Figure 1</a>, an enterprise has VMs deployed in different data centers. VM1 on Server1 (Server1 VM1 for short) belongs to VLAN 10, Server3 VM1 belongs to VLAN 30, and Server2 VM1 belongs to VLAN 20. Server1 and Server2 reside on different network segments, and Server3 and Server2 reside on the same network segment. Server1 VM1, Server3 VM1, and Server2 VM1 need to communicate with each other through a VXLAN gateway.</p>
<div class="fignone" id="EN-US_TASK_0000001130624508__fig_dc_cfg_vxlan_cfgcase_000101"><a name="EN-US_TASK_0000001130624508__fig_dc_cfg_vxlan_cfgcase_000101"></a><a name="fig_dc_cfg_vxlan_cfgcase_000101"></a><span class="figcap"><b>Figure 1 </b>VXLAN tunnel establishment in centralized gateway mode</span><div class="note"><img src="../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interfaces 1 through 3 represent <span>100GE</span><span>1/0/1</span>, <span>100GE</span><span>1/0/2</span>, and <span>100GE</span><span>1/0/3</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0000001130784362.png"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001130624508__1.3.2"></a><a name="1.3.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><div class="p">The configuration roadmap is as follows:<ol><li><p>Configure a routing protocol on Device1, Device2, and Device3 to ensure Layer 3 connectivity on the network.</p>
</li><li><p>Configure service access points on Device1 and Device3 to distinguish service traffic.</p>
</li><li><p>Configure VXLAN tunnels on Device1, Device2, and Device3 to forward service traffic.</p>
</li><li><p>Configure Device2 as a Layer 3 VXLAN gateway to allow users on different network segments to communicate.</p>
</li></ol>
</div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001130624508__1.3.3"></a><a name="1.3.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure a routing protocol.</span><p><p># Configure Device1. The configurations of Device2 and Device3 are similar to the configuration of Device1. If OSPF is used, ensure that 32-bit loopback interface addresses are advertised.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname Device1</strong>
[<span><span><span class="keyword">*</span></span></span><span class="keyword">HUAWEI</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Device1]<strong> interface loopback 1</strong>
[<span><span class="keyword">*</span></span>Device1-LoopBack1]<strong> ip address 2.2.2.2 32</strong>
[<span><span class="keyword">*</span></span>Device1-LoopBack1]<strong> quit</strong>
[<span><span class="keyword">*</span></span>Device1]<strong> interface <span>100ge</span> <span>1/0/1</span></strong>
[<span><span class="keyword">*</span></span>Device1-<span>100GE</span><span>1/0/1</span>]<strong> undo portswitch</strong>
[<span><span class="keyword">*</span></span>Device1-<span>100GE</span><span>1/0/1</span>]<strong> ip address 192.168.1.1 24</strong>
[<span><span class="keyword">*</span></span>Device1-<span>100GE</span><span>1/0/1</span>]<strong> quit</strong>
[<span><span class="keyword">*</span></span>Device1]<strong> ospf</strong>
[<span><span class="keyword">*</span></span>Device1-ospf-1]<strong> area 0</strong>
[<span><span class="keyword">*</span></span>Device1-ospf-1-area-0.0.0.0]<strong> network 2.2.2.2 0.0.0.0</strong>
[<span><span class="keyword">*</span></span>Device1-ospf-1-area-0.0.0.0]<strong> network 192.168.1.0 0.0.0.255</strong>
[<span><span class="keyword">*</span></span>Device1-ospf-1-area-0.0.0.0]<strong> quit</strong>
[<span><span class="keyword">*</span></span>Device1-ospf-1]<strong> quit</strong>
[<span><span class="keyword">*</span></span>Device1]<strong> commit</strong></pre>
<p># After OSPF is configured, the devices can learn each other's loopback interface IP address and successfully ping one another. For example, ping Device3 from Device1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Device1] <strong>ping 4.4.4.4</strong>
  PING 4.4.4.4: 56  data bytes, press CTRL_C to break
    Reply from 4.4.4.4: bytes=56 Sequence=1 ttl=253 time=5 ms
    Reply from 4.4.4.4: bytes=56 Sequence=2 ttl=253 time=2 ms
    Reply from 4.4.4.4: bytes=56 Sequence=3 ttl=253 time=2 ms
    Reply from 4.4.4.4: bytes=56 Sequence=4 ttl=253 time=3 ms
    Reply from 4.4.4.4: bytes=56 Sequence=5 ttl=253 time=3 ms

  --- 4.4.4.4 ping statistics ---
    5 packet(s) transmitted
    5 packet(s) received
    0.00% packet loss
    round-trip min/avg/max = 2/3/5 ms</pre>
</p></li><li><span>Configure service access points on Device1 and Device3.</span><p><p># Configure Device1. The configuration of Device3 is similar to the configuration of Device1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Device1] <strong>bridge-domain 10</strong>
[<span><span class="keyword">*</span></span>Device1-bd10] <strong>quit</strong>
[<span><span class="keyword">*</span></span>Device1] <strong>interface <span>100ge</span> <span>1/0/2</span>.1 mode l2</strong>
[<span><span class="keyword">*</span></span>Device1-<span>100GE</span><span>1/0/2</span>.1] <strong>encapsulation dot1q vid 10</strong>
[<span><span class="keyword">*</span></span>Device1-<span>100GE</span><span>1/0/2</span>.1] <strong>bridge-domain 10</strong>
[<span><span class="keyword">*</span></span>Device1-<span>100GE</span><span>1/0/2</span>.1] <strong>quit</strong>
[<span><span class="keyword">*</span></span>Device1] <strong>bridge-domain 20</strong>
[<span><span class="keyword">*</span></span>Device1-bd20] <strong>quit</strong>
[<span><span class="keyword">*</span></span>Device1] <strong>interface <span>100ge</span> <span>1/0/3</span>.1 mode l2</strong>
[<span><span class="keyword">*</span></span>Device1-<span>100GE</span><span>1/0/3</span>.1] <strong>encapsulation dot1q vid 30</strong>
[<span><span class="keyword">*</span></span>Device1-<span>100GE</span><span>1/0/3</span>.1] <strong>bridge-domain 20</strong>
[<span><span class="keyword">*</span></span>Device1-<span>100GE</span><span>1/0/3</span>.1] <strong>quit</strong>
[<span><span class="keyword">*</span></span>Device1] <strong>commit</strong></pre>
</p></li><li><span>Configure VXLAN tunnels on Device1, Device2, and Device3.</span><p><p># Configure Device1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Device1] <strong>bridge-domain 10</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Device1-bd10] <strong>vxlan vni 5010</strong>
[<span><span class="keyword">*</span></span>Device1-bd10] <strong>quit</strong>
[<span><span class="keyword">*</span></span>Device1] <strong>interface nve 1</strong>
[<span><span class="keyword">*</span></span>Device1-Nve1] <strong>source 2.2.2.2</strong>
[<span><span class="keyword">*</span></span>Device1-Nve1] <strong>vni 5010 head-end peer-list 3.3.3.3</strong>
[<span><span class="keyword">*</span></span>Device1-Nve1] <strong>quit</strong>
[<span><span class="keyword">*</span></span>Device1] <strong>bridge-domain 20</strong>
[<span><span class="keyword">*</span></span>Device1-bd20] <strong>vxlan vni 5020</strong>
[<span><span class="keyword">*</span></span>Device1-bd20] <strong>quit</strong>
[<span><span class="keyword">*</span></span>Device1] <strong>interface nve 1</strong>
[<span><span class="keyword">*</span></span>Device1-Nve1] <strong>vni 5020 head-end peer-list 3.3.3.3</strong>
[<span><span class="keyword">*</span></span>Device1-Nve1] <strong>vni 5020 head-end peer-list 4.4.4.4</strong>
[<span><span class="keyword">*</span></span>Device1-Nve1] <strong>quit</strong>
[<span><span class="keyword">*</span></span>Device1] <strong>commit</strong></pre>
<p># Configure Device2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Device2] <strong>bridge-domain 10</strong>
[<span><span class="keyword">*</span></span>Device2-bd10] <strong>vxlan vni 5010</strong>
[<span><span class="keyword">*</span></span>Device2-bd10] <strong>quit</strong>
[<span><span class="keyword">*</span></span>Device2] <strong>interface nve 1</strong>
[<span><span class="keyword">*</span></span>Device2-Nve1] <strong>source 3.3.3.3</strong>
[<span><span class="keyword">*</span></span>Device2-Nve1] <strong>vni 5010 head-end peer-list 2.2.2.2</strong>
[<span><span class="keyword">*</span></span>Device2-Nve1] <strong>quit</strong>
[<span><span class="keyword">*</span></span>Device2] <strong>bridge-domain 20</strong>
[<span><span class="keyword">*</span></span>Device2-bd20] <strong>vxlan vni 5020</strong>
[<span><span class="keyword">*</span></span>Device2-bd20] <strong>quit</strong>
[<span><span class="keyword">*</span></span>Device2] <strong>interface nve 1</strong>
[<span><span class="keyword">*</span></span>Device2-Nve1] <strong>vni 5020 head-end peer-list 2.2.2.2</strong>
[<span><span class="keyword">*</span></span>Device2-Nve1] <strong>vni 5020 head-end peer-list 4.4.4.4</strong>
[<span><span class="keyword">*</span></span>Device2-Nve1] <strong>quit</strong>
[<span><span class="keyword">*</span></span>Device2] <strong>commit</strong></pre>
<p># Configure Device3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Device3] <strong>bridge-domain 20</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Device3-bd20] <strong>vxlan vni 5020</strong>
[<span><span class="keyword">*</span></span>Device3-bd20] <strong>quit</strong>
[<span><span class="keyword">*</span></span>Device3] <strong>interface nve 1</strong>
[<span><span class="keyword">*</span></span>Device3-Nve1] <strong>source 4.4.4.4</strong>
[<span><span class="keyword">*</span></span>Device3-Nve1] <strong>vni 5020 head-end peer-list 3.3.3.3</strong>
[<span><span class="keyword">*</span></span>Device3-Nve1] <strong>vni 5020 head-end peer-list 2.2.2.2</strong>
[<span><span class="keyword">*</span></span>Device3-Nve1] <strong>quit</strong>
[<span><span class="keyword">*</span></span>Device3] <strong>commit</strong></pre>
</p></li><li><span>Configure Device2 as a Layer 3 VXLAN gateway.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Device2] <strong>interface vbdif 10</strong>
[<span><span class="keyword">*</span></span>Device2-Vbdif10] <strong>ip address 192.168.10.10 24</strong>
[<span><span class="keyword">*</span></span>Device2-Vbdif10] <strong>quit</strong>
[<span><span class="keyword">*</span></span>Device2] <strong>interface vbdif 20</strong>
[<span><span class="keyword">*</span></span>Device2-Vbdif20] <strong>ip address 192.168.20.10 24</strong>
[<span><span class="keyword">*</span></span>Device2-Vbdif20] <strong>quit</strong>
[<span><span class="keyword">*</span></span>Device2] <strong>commit</strong></pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001130624508__1.3.4"></a><a name="1.3.4"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p>After completing the configurations, run the <a href="cmdqueryname=display+vxlan+tunnel"><b><span class="cmdname">display vxlan tunnel</span></b></a> command on Device1, Device2, and Device3 to check VXLAN tunnel information, and run the <a href="cmdqueryname=display+vxlan+vni"><b><span class="cmdname">display vxlan vni</span></b></a> command to check whether the VNI state is up. The following example uses the command output on Device2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Device2] <strong>display vxlan tunnel</strong>
Number of vxlan tunnel : 2
Tunnel ID   Source                Destination           State  Type     Uptime
----------------------------------------------------------------------------------- 
4026531841  3.3.3.3               2.2.2.2               up     static   0035h21m
4026531842  3.3.3.3               4.4.4.4               up     static   0036h21m</pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Device2] <strong>display vxlan vni</strong>
Number of vxlan vni : 2
VNI            BD-ID            <strong>State</strong>
---------------------------------------
5010           10               up
5020           20               up</pre>
<p>VM1s on different servers can communicate.</p>
</div>
<div class="postreq"><a name="EN-US_TASK_0000001130624508__1.3.5"></a><a name="1.3.5"></a><h4 class="sectiontitle">Configuration Scripts</h4><ul><li><p>Device1</p>
<pre class="screen">#
sysname Device1
#
bridge-domain 10
 vxlan vni 5010
#
bridge-domain 20
 vxlan vni 5020
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 192.168.1.1 255.255.255.0
#
interface <span>100GE</span><span>1/0/2</span>.1 mode l2
 encapsulation dot1q vid 10
 bridge-domain 10
#
interface <span>100GE</span><span>1/0/3</span>.1 mode l2
 encapsulation dot1q vid 30
 bridge-domain 20
#
interface LoopBack1
 ip address 2.2.2.2 255.255.255.255
#
interface Nve1
 source 2.2.2.2
 vni 5010 head-end peer-list 3.3.3.3
 vni 5020 head-end peer-list 3.3.3.3
 vni 5020 head-end peer-list 4.4.4.4
#
ospf 1
 area 0.0.0.0
  network 2.2.2.2 0.0.0.0
  network 192.168.1.0 0.0.0.255
#
return</pre>
</li><li><p>Device2</p>
<pre class="screen">#
sysname Device2
#
bridge-domain 10
 vxlan vni 5010
#
bridge-domain 20
 vxlan vni 5020
#
interface Vbdif10
 ip address 192.168.10.10 255.255.255.0
#
interface Vbdif20
 ip address 192.168.20.10 255.255.255.0
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 192.168.1.2 255.255.255.0
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ip address 192.168.2.1 255.255.255.0
#
interface LoopBack1
 ip address 3.3.3.3 255.255.255.255
#
interface Nve1
 source 3.3.3.3
 vni 5010 head-end peer-list 2.2.2.2
 vni 5020 head-end peer-list 2.2.2.2
 vni 5020 head-end peer-list 4.4.4.4
#
ospf 1
 area 0.0.0.0
  network 3.3.3.3 0.0.0.0
  network 192.168.1.0 0.0.0.255
  network 192.168.2.0 0.0.0.255
#
return</pre>
</li><li><p>Device3</p>
<pre class="screen">#
sysname Device3
#
bridge-domain 20
 vxlan vni 5020
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 192.168.2.2 255.255.255.0
#
interface <span>100GE</span><span>1/0/2</span>.1 mode l2
 encapsulation dot1q vid 20
 bridge-domain 20
#
interface LoopBack1
 ip address 4.4.4.4 255.255.255.255
#
interface Nve1
 source 4.4.4.4
 vni 5020 head-end peer-list 2.2.2.2
 vni 5020 head-end peer-list 3.3.3.3
#
ospf 1
 area 0.0.0.0
  network 4.4.4.4 0.0.0.0
  network 192.168.2.0 0.0.0.255
#
return</pre>
</li></ul>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../dc/dc_vrp_vxlan_cfg_1039.html">Establishing VXLAN Tunnels in Static Mode (Centralized VXLAN Gateway)
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../dc/dc_vrp_vxlan_cfg_1046.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>
</body>
</html>