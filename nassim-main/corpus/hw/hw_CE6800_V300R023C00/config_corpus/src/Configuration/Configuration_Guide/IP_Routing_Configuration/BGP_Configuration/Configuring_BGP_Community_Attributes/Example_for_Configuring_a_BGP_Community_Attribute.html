
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring a BGP Community Attribute">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="vrp_bgp_cfg_0081.html">
<meta name="DC.Relation" scheme="URI" content="vrp_bgp_cfg_0085.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing">
<meta name="featuretype" content="IP Routing">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001176663687">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring a BGP Community Attribute</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001176663687"></a><a name="EN-US_TASK_0000001176663687"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring a BGP Community Attribute</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001176663687__1.3.1"></a><a name="1.3.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>Enterprises A, B, and C belong to different ASs, and enterprise B's network communicates with the networks of the other two enterprises through EBGP connections. Enterprises A and C compete with each other. To improve security, enterprise A requires that the routes sent from enterprise A's AS to enterprise B's network be advertised only within enterprise B's network. To tackle this issue, configure the community attribute function on the device that sends routes from enterprise A to enterprise B.</p>
<p>As shown in <a href="#EN-US_TASK_0000001176663687__fig_dc_vrp_bgp_cfg_407701">Figure 1</a>, EBGP connections are established between DeviceB and each of DeviceA and DeviceC. It is required that the BGP routes imported by DeviceA in AS 10 and then advertised to DeviceB in AS 20 be transmitted only in AS 20 instead of being advertised by AS 20 to other ASs. In this case, you can configure DeviceA to encapsulate the No_Export community attribute for the BGP routes to be advertised to DeviceB.</p>
<div class="fignone" id="EN-US_TASK_0000001176663687__fig_dc_vrp_bgp_cfg_407701"><a name="EN-US_TASK_0000001176663687__fig_dc_vrp_bgp_cfg_407701"></a><a name="fig_dc_vrp_bgp_cfg_407701"></a><span class="figcap"><b>Figure 1 </b>Network diagram of configuring a BGP community attribute</span><div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface 1 and interface 2 represent <span>100GE</span><span>1/0/1</span> and <span>100GE</span><span>1/0/2</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0000001130783990.png"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001176663687__1.3.2"></a><a name="1.3.2"></a>
<div class="p"><h4 class="sectiontitle">Precautions</h4><p>During the configuration, note the following:</p>
<ul><li>To improve security, you are advised to deploy BGP security measures. For details, see "Configuring BGP Authentication." Keychain authentication is used as an example. For details, see Example for Configuring Keychain Authentication for BGP.</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001176663687__1.3.3"></a><a name="1.3.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Assign an IP address to each involved interface. For detailed configurations, see <a href="#EN-US_TASK_0000001176663687__postreq17364171716277">Configuration Scripts</a>.</span></li><li><span>Configure EBGP.</span><p><p># Configure DeviceA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>bgp 10</strong>
[<span class="keyword">*</span>DeviceA-bgp] <strong>router-id 1.1.1.1</strong>
[<span class="keyword">*</span>DeviceA-bgp] <strong>peer 10.1.2.2 as-number 20</strong>
[<span class="keyword">*</span>DeviceA-bgp]<strong> ipv4-family unicast</strong>
[<span class="keyword">*</span>DeviceA-bgp-af-ipv4]<strong> network 10.5.1.0 255.255.255.0</strong>
[<span class="keyword">*</span>DeviceA-bgp-af-ipv4] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA-bgp] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>commit</strong></pre>
<p># Configure DeviceB.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB] <strong>bgp 20</strong>
[<span class="keyword">*</span>DeviceB-bgp] <strong>router-id 2.2.2.2</strong>
[<span class="keyword">*</span>DeviceB-bgp] <strong>peer 10.1.2.1 as-number 10</strong>
[<span class="keyword">*</span>DeviceB-bgp] <strong>peer 10.1.3.2 as-number 30</strong>
[<span class="keyword">*</span>DeviceB-bgp] <strong>quit</strong>
[<span class="keyword">*</span>DeviceB] <strong>commit</strong></pre>
<p># Configure DeviceC.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceC]<strong> bgp 30</strong>
[<span class="keyword">*</span>DeviceC-bgp]<strong> router-id 3.3.3.3 </strong>
[<span class="keyword">*</span>DeviceC-bgp] <strong>peer 10.1.3.1 as-number 20</strong>
[<span class="keyword">*</span>DeviceC-bgp] <strong>quit</strong>
[<span class="keyword">*</span>DeviceC] <strong>commit</strong></pre>
<p># Check the routing table of DeviceB.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB] <strong>display bgp routing-table 10.5.1.0</strong>

BGP local router ID : 2.2.2.2
 Local AS number : 20
 Paths:   1 available, 1 best, 1 select
 BGP routing table entry information of 10.5.1.0/24:
 From: 10.1.2.1 (1.1.1.1)
 Route Duration: 0d00h00m37s
 Direct Out-interface: <span>100GE</span><span>1/0/2</span>
 Original nexthop: 10.1.2.1
 Qos information : 0x0
 AS-path 10, origin igp, MED 0, pref-val 0, valid, external, best, select, pre 255
 <strong>Advertised to such 2 peers:</strong>
    <strong>10.1.2.1</strong>
    <strong>10.1.3.2</strong></pre>
<p>The preceding command output shows that DeviceB has advertised the accepted route to DeviceC in AS 30.</p>
<p># Check the routing table of DeviceC.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceC] <strong>display bgp routing-table</strong>

 BGP Local router ID is 3.3.3.3
 Status codes: * - valid, &gt; - best, d - damped,<span> x - best external,</span><span> a - add path,</span>
               h - history,  i - internal, s - suppressed, S - Stale
               Origin : i - IGP, e - EGP, ? - incomplete
 RPKI validation codes: V - valid, I - invalid, N - not-found

 Total Number of Routes: 1
      Network            NextHop        MED        LocPrf    PrefVal Path/Ogn

 *&gt;   <strong>10.5.1.0/24</strong>        10.1.3.1                             0      20 10i</pre>
<p>The preceding command output shows that DeviceC has learned the route to 10.5.1.0/24 from DeviceB.</p>
</p></li><li><span>Configure a BGP community attribute.</span><p><p># Configure a route-policy on DeviceA to ensure that the routes advertised by DeviceA to DeviceB are not advertised by DeviceB to any other AS.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>route-policy comm_policy permit node 10</strong>
[<span class="keyword">*</span>DeviceA-route-policy] <strong>apply community no-export</strong>
[<span class="keyword">*</span>DeviceA-route-policy] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>commit</strong></pre>
<p># Apply the route-policy.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>bgp 10</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA-bgp] <strong>ipv4-family unicast</strong>
[<span class="keyword">*</span>DeviceA-bgp-af-ipv4] <strong>peer 10.1.2.2 route-policy comm_policy export</strong>
[<span class="keyword">*</span>DeviceA-bgp-af-ipv4] <strong>peer 10.1.2.2 advertise-community</strong>
[<span class="keyword">*</span>DeviceA-bgp-af-ipv4] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA-bgp] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>commit</strong></pre>
<p></p>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001176663687__1.3.4"></a><a name="1.3.4"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p># Check the routing table of DeviceB.</p>
<pre class="screen">[<span class="keyword">*</span>DeviceB] <strong>display bgp routing-table 10.5.1.0</strong>
BGP local router ID : 2.2.2.2
 Local AS number : 20
 Paths:   1 available, 1 best, 1 select
 BGP routing table entry information of 10.5.1.0/24:
 From: 10.1.2.1 (1.1.1.1)
 Route Duration: 0d00h00m12s
 Direct Out-interface: <span>100GE</span><span>1/0/2</span>
 Original nexthop: 10.1.2.1
 Qos information : 0x0
 <strong>Community:no-export</strong>
 AS-path 10, origin igp, MED 0, pref-val 0, valid, external, best, select, pre 255
 <strong>Not advertised to any peers yet</strong></pre>
<p>The BGP routing table of DeviceB contains the configured community attribute. Then, there is no route to 10.5.1.0/24 in the BGP routing table of DeviceC.</p>
</div>
<div class="postreq"><a name="EN-US_TASK_0000001176663687__postreq17364171716277"></a><a name="postreq17364171716277"></a><a name="EN-US_TASK_0000001176663687__1.3.5"></a><a name="1.3.5"></a><h4 class="sectiontitle">Configuration Scripts</h4><ul><li><p>DeviceA</p>
<pre class="screen">#
sysname DeviceA
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 10.5.1.1 255.255.255.0
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ip address 10.1.2.1 255.255.255.0
#
bgp 10
 router-id 1.1.1.1
 peer 10.1.2.2 as-number 20
 #
 ipv4-family unicast
  undo synchronization 
  network 10.5.1.0 255.255.255.0
  peer 10.1.2.2 enable
  peer 10.1.2.2 route-policy comm_policy export
  peer 10.1.2.2 advertise-community
#
route-policy comm_policy permit node 10
 apply community no-export
#
return</pre>
</li><li><p>DeviceB</p>
<pre class="screen">#
sysname DeviceB
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 10.1.3.1 255.255.255.0
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ip address 10.1.2.2 255.255.255.0
#
bgp 20
 router-id 2.2.2.2
 peer 10.1.2.1 as-number 10
 peer 10.1.3.2 as-number 30
 #
 ipv4-family unicast
  undo synchronization 
  peer 10.1.2.1 enable
  peer 10.1.3.2 enable
#
return</pre>
</li><li><p>DeviceC</p>
<pre class="screen">#
sysname DeviceC
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 10.1.3.2 255.255.255.0
#
bgp 30
 router-id 3.3.3.3
 peer 10.1.3.1 as-number 20
 #
 ipv4-family unicast
  undo synchronization 
  peer 10.1.3.1 enable
#
return</pre>
</li></ul>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="vrp_bgp_cfg_0081.html">Configuring BGP Community Attributes
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="vrp_bgp_cfg_0085.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>
</body>
</html>