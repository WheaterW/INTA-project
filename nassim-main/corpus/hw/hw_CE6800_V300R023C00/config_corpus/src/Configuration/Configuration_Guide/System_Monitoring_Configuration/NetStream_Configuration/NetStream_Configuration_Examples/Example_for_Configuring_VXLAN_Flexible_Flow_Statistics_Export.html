
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring VXLAN Flexible Flow Statistics Export">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="galaxy_netstream_cfg_0054.html">
<meta name="DC.Relation" scheme="URI" content="galaxy_netstream_cfg_0056.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="NetStream">
<meta name="featuretype" content="System Monitoring">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="NetStream">
<meta name="featuretype" content="System Monitoring">
<meta name="featurename" content="NetStream">
<meta name="featuretype" content="System Monitoring">
<meta name="featurename" content="NetStream">
<meta name="featuretype" content="System Monitoring">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001513161246">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring VXLAN Flexible Flow Statistics Export</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001513161246"></a><a name="EN-US_TASK_0000001513161246"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring VXLAN Flexible Flow Statistics Export</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001513161246__1.3.1"></a><a name="1.3.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the VXLAN network shown in <a href="#EN-US_TASK_0000001513161246__fig376535683313">Figure 1</a>, Host1 and Host2 are connected to the VXLAN network through DeviceB and DeviceC, respectively. A VXLAN tunnel is established between DeviceB and DeviceA and between DeviceC and DeviceA. The network administrator wants the NetStream server to collect statistics about VXLAN traffic and the network resources used by Host1 and Host2.</p>
<div class="fignone" id="EN-US_TASK_0000001513161246__fig376535683313"><a name="EN-US_TASK_0000001513161246__fig376535683313"></a><a name="fig376535683313"></a><span class="figcap"><b>Figure 1 </b>NetStream networking diagram</span><div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface 1, interface 2, and interface 3 represent <span>100GE</span> <span>1/0/1</span>, <span>100GE</span> <span>1/0/2</span>, and <span>100GE</span> <span>1/0/3</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0000001564001597.png" width="NaN" height="NaN"></span></div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001513161246__1.3.2"></a><a name="1.3.2"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure IP addresses for interfaces on DeviceA according to <a href="#EN-US_TASK_0000001513161246__fig376535683313">Figure 1</a>.</span><p><pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font><span class="keyword">HUAWEI</span>] <strong>sysname DeviceA</strong>
[*<span class="keyword">HUAWEI</span>] <strong>commit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font><span class="keyword">DeviceA</span>] <strong>interface <span>100ge</span><span>1/0/1</span></strong>
[<font style="font-size:8pt" Face="Courier New" >~</font><span class="keyword">DeviceA</span>-<span>100GE</span><span>1/0/1</span>] <strong>undo portswitch</strong>
[*<span class="keyword">DeviceA</span>-<span>100GE</span><span>1/0/1</span>] <strong>ip address 10.1.1.1 24</strong>
[*<span class="keyword">DeviceA</span>-<span>100GE</span><span>1/0/1</span>] <strong>quit</strong>
[*<span class="keyword">DeviceA</span>] <strong>interface <span>100ge</span><span>1/0/2</span></strong>
[*<span class="keyword">DeviceA</span>-<span>100GE</span><span>1/0/2</span>] <strong>undo portswitch</strong>
[*<span class="keyword">DeviceA</span>-<span>100GE</span><span>1/0/2</span>] <strong>ip address 10.1.2.1 24</strong>
[*<span class="keyword">DeviceA</span>-<span>100GE</span><span>1/0/2</span>] <strong>quit</strong>
[*<span class="keyword">DeviceA</span>] <strong>interface <span>100ge</span><span>1/0/3</span></strong>
[*<span class="keyword">DeviceA</span>-<span>100GE</span><span>1/0/3</span>] <strong>undo portswitch</strong>
[*<span class="keyword">DeviceA</span>-<span>100GE</span><span>1/0/3</span>] <strong>ip address 10.1.3.1 24</strong>
[*<span class="keyword">DeviceA</span>-<span>100GE</span><span>1/0/3</span>] <strong>quit</strong>
[*<span class="keyword">DeviceA</span>] <strong>commit</strong></pre>
</p></li><li><span>Configure a VXLAN flexible flow statistics template.</span><p><p># Create a flexible flow statistics template named <strong>VXLAN-record</strong> to aggregate flows based on the source and destination addresses of inner packets in VXLAN packets, and configure the exported packets to include the number of bytes and packets.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font><span class="keyword">DeviceA</span>] <strong>netstream record VXLAN-record vxlan inner-ip</strong>
[*<span class="keyword">DeviceA</span>-netstream-record-vxlan-VXLAN-record] <strong>match inner-ip destination-address</strong>
[*<span class="keyword">DeviceA</span>-netstream-record-vxlan-VXLAN-record] <strong>match inner-ip source-address</strong>
[*<span class="keyword">DeviceA</span>-netstream-record-vxlan-VXLAN-record] <strong>collect counter bytes</strong>
[*<span class="keyword">DeviceA</span>-netstream-record-vxlan-VXLAN-record] <strong>collect counter packets</strong>
[*<span class="keyword">DeviceA</span>-netstream-record-vxlan-VXLAN-record] <strong>quit</strong>
[*<span class="keyword">DeviceA</span>] <strong>commit</strong></pre>
</p></li><li><span>Configure NetStream sampling.</span><p><p># Configure NetStream sampling for the incoming and outgoing traffic on <span>100GE</span> <span>1/0/1</span> and <span>100GE</span> <span>1/0/2</span>, and set the sampling rate to 8192.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font><span class="keyword">DeviceA</span>] <strong>interface <span>100ge</span><span>1/0/1</span></strong>
[*<span class="keyword">DeviceA</span>-<span>100GE</span><span>1/0/1</span>] <strong>netstream sampler random-packets <span><strong>8192</strong></span> inbound</strong>
[*<span class="keyword">DeviceA</span>-<span>100GE</span><span>1/0/1</span>] <strong>netstream sampler random-packets <span><strong>8192</strong></span> outbound</strong>
[*<span class="keyword">DeviceA</span>-<span>100GE</span><span>1/0/1</span>] <strong>quit</strong>
[*<span class="keyword">DeviceA</span>] <strong>interface <span>100ge</span><span>1/0/2</span></strong>
[*<span class="keyword">DeviceA</span>-<span>100GE</span><span>1/0/2</span>] <strong>netstream sampler random-packets 8192 inbound</strong>
<span>[*<span class="keyword">DeviceA</span>-<span>100GE</span><span>1/0/2</span>] <strong>netstream sampler random-packets 8192 outbound</strong></span>
[*<span class="keyword">DeviceA</span>-<span>100GE</span><span>1/0/2</span>] <strong>quit</strong>
[*<span class="keyword">DeviceA</span>] <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></pre>
</p></li><li><span>Configure VXLAN flexible flow statistics export.</span><p><p># Set the source IP address of the exported packets carrying VXLAN flexible flow statistics to 10.1.3.1, destination IP address to 10.1.3.2, destination port number to 6000, and DSCP value to 0.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font><span class="keyword">DeviceA</span>] <strong>netstream export vxlan inner-ip source 10.1.3.1</strong>
[*<span class="keyword">DeviceA</span>] <strong>netstream export vxlan inner-ip host 10.1.3.2 6000</strong> <strong>dscp 0</strong>
[*<span class="keyword">DeviceA</span>] <strong>commit</strong></pre>
</p></li><li><span>Enable VXLAN flexible flow statistics collection on interfaces.</span><p><p># Enable VXLAN flexible flow statistics collection for incoming packets on <span>100GE</span> <span>1/0/1</span> and <span>100GE</span> <span>1/0/2</span>, and apply the VXLAN flexible flow statistics template to the interfaces.</p>
<pre class="screen">[*<span class="keyword">DeviceA</span>] <strong>interface <span>100ge</span><span>1/0/1</span></strong>
[*<span class="keyword">DeviceA</span>-<span>100GE</span><span>1/0/1</span>] <strong>netstream record VXLAN-record vxlan inner-ip</strong>
[*<span class="keyword">DeviceA</span>-<span>100GE</span><span>1/0/1</span>] <strong>netstream inbound ip</strong>
[*<span class="keyword">DeviceA</span>-<span>100GE</span><span>1/0/1</span>] <strong>quit</strong>
[*<span class="keyword">DeviceA</span>] <strong>interface <span>100ge</span><span>1/0/2</span></strong>
[*<span class="keyword">DeviceA</span>-<span>100GE</span><span>1/0/2</span>] <strong>netstream record VXLAN-record vxlan inner-ip</strong>
[*<span class="keyword">DeviceA</span>-<span>100GE</span><span>1/0/2</span>] <strong>netstream inbound ip</strong>
[*<span class="keyword">DeviceA</span>-<span>100GE</span><span>1/0/2</span>] <strong>quit</strong>
[*<span class="keyword">DeviceA</span>] <strong>commit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p># View flow statistics.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font><span class="keyword">DeviceA</span>] <strong>display netstream statistics vxlan inner-ip slot </strong><span>1</span>
 Last time when statistics were cleared: -
 -------------------------------------------------------------------------------
 Packet Length    : Number
 -------------------------------------------------------------------------------
 1      <font style="font-size:8pt" Face="Courier New" >~</font>    64   : 0
 65     <font style="font-size:8pt" Face="Courier New" >~</font>    128  : 3480368
 129    <font style="font-size:8pt" Face="Courier New" >~</font>    256  : 0
 257    <font style="font-size:8pt" Face="Courier New" >~</font>    512  : 0
 513    <font style="font-size:8pt" Face="Courier New" >~</font>    1024 : 0
 1025   <font style="font-size:8pt" Face="Courier New" >~</font>    1500 : 0
 longer than 1500 : 0
 -------------------------------------------------------------------------------
 StreamType
      Current           Aged        Created       Exported       Exported
      (streams)         (streams)   (streams)     (streams)      (Packets)
 -------------------------------------------------------------------------------
 VXLAN-record
            0             60             60             60              6
 -------------------------------------------------------------------------------</pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001513161246__1.3.3"></a><a name="1.3.3"></a><h4 class="sectiontitle">Configuration Scripts</h4><p>DeviceA</p>
<pre class="screen">#
sysname DeviceA 
#
netstream export vxlan inner-ip source 10.1.3.1
netstream export vxlan inner-ip host 10.1.3.2 6000 dscp 0
#
netstream record VXLAN-record vxlan inner-ip
 collect counter bytes
 collect counter packets
 match inner-ip destination-address
 match inner-ip source-address
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 10.1.1.1 255.255.255.0
 netstream inbound ip
 netstream sampler random-packets 8192 inbound
 netstream sampler random-packets 8192 outbound
 netstream record VXLAN-record vxlan inner-ip
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ip address 10.1.2.1 255.255.255.0
 netstream inbound ip
 netstream sampler random-packets 8192 inbound
 netstream sampler random-packets 8192 outbound
 netstream record VXLAN-record vxlan inner-ip
#
interface <span>100GE</span><span>1/0/3</span>
 undo portswitch
 ip address 10.1.3.1 255.255.255.0
#
return</pre>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="galaxy_netstream_cfg_0054.html">NetStream Configuration Examples
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="galaxy_netstream_cfg_0056.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>
</body>
</html>