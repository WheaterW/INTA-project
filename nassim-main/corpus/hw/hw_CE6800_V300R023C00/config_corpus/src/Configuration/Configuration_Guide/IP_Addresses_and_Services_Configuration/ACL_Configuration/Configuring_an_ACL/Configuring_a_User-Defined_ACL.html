
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring a User-Defined ACL">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="vrp_acl_cfg_0010.html">
<meta name="DC.Relation" scheme="URI" content="vrp_acl_cfg_0013.html">
<meta name="DC.Relation" scheme="URI" content="vrp_acl_cfg_0015.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="ACL">
<meta name="featuretype" content="IP Addresses and Services">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="ACL">
<meta name="featuretype" content="IP Addresses and Services">
<meta name="featurename" content="ACL">
<meta name="featuretype" content="IP Addresses and Services">
<meta name="featuretype" content="IP Addresses and Services">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001130623036">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>Configuring a User-Defined ACL</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001130623036"></a><a name="EN-US_TASK_0000001130623036"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring a User-Defined ACL</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001130623036__1.3.1"></a><a name="1.3.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>A user-defined ACL defines packet filtering rules based on packet headers, offsets, character string masks, and user-defined character strings. With a user-defined ACL configured, the system performs an AND operation on the packet bytes from a specified offset behind the packet header and the character string mask, compares the extracted character string against the user-defined character string, and then filters IPv4 packets.</p>
<p>User-defined ACLs are more accurate and flexible than basic ACLs, advanced ACLs, and Layer 2 ACLs, and provide more functions. For example, a user-defined ACL can be configured to filter ARP packets based on source IPv4 addresses and ARP packet types.</p>
<div class="p"><strong id="EN-US_TASK_0000001130623036__en-us_task_0000001176742483_b1652132913555">When ACL rules are configured:</strong><ul id="EN-US_TASK_0000001130623036__en-us_task_0000001176742483_en-us_concept_0177090555_ul1191338372183158"><li id="EN-US_TASK_0000001130623036__en-us_task_0000001176742483_en-us_concept_0177090555_li822401570183158"><p id="EN-US_TASK_0000001130623036__en-us_task_0000001176742483_en-us_concept_0177090555_p898434898183158"><a name="EN-US_TASK_0000001130623036__en-us_task_0000001176742483_en-us_concept_0177090555_li822401570183158"></a><a name="en-us_task_0000001176742483_en-us_concept_0177090555_li822401570183158"></a>If the specified rule ID already exists and the new rule conflicts with the original, the original is replaced.</p>
</li><li id="EN-US_TASK_0000001130623036__en-us_task_0000001176742483_en-us_concept_0177090555_li504316878183158"><p id="EN-US_TASK_0000001130623036__en-us_task_0000001176742483_en-us_concept_0177090555_p2083297484183158"><a name="EN-US_TASK_0000001130623036__en-us_task_0000001176742483_en-us_concept_0177090555_li504316878183158"></a><a name="en-us_task_0000001176742483_en-us_concept_0177090555_li504316878183158"></a>Matching stops for a packet once the packet matches a rule in an ACL.</p>
</li><li id="EN-US_TASK_0000001130623036__en-us_task_0000001176742483_li1538122512195">Many services that are not configured with ACL rules also occupy ACL resources. You can run the <a href="cmdqueryname=display+system+tcam+service+brief"><b><span class="cmdname" id="EN-US_TASK_0000001130623036__en-us_task_0000001176742483_cmdname4391122852016">display system tcam service brief</span></b></a> command to check ACL resources occupied by services.</li></ul>
</div>
<p><strong id="EN-US_TASK_0000001130623036__en-us_task_0000001176742483_b19922155455712">When ACL rules are deleted:</strong> The <a href="cmdqueryname=undo+rule"><b><span class="cmdname" id="EN-US_TASK_0000001130623036__en-us_task_0000001176742483_en-us_concept_0177090555_cmdname1539083973183158">undo rule</span></b></a> command can delete an ACL rule even if this rule is referenced. Before deleting a rule, run the <a href="cmdqueryname=display+current-configuration+%7C+include+acl"><b><span class="cmdname" id="EN-US_TASK_0000001130623036__en-us_task_0000001176742483_cmdname6906162174518">display current-configuration | include acl</span></b></a> command to check whether the rule is being referenced.</p>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001130623036__1.3.2"></a><a name="1.3.2"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Enter the system view.</span><p><pre class="screen"><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></pre>
</p></li><li><span>Configure a user-defined ACL. You can create a numbered or named user-defined ACL.</span><p><ul><li><div class="p">Create a numbered user-defined ACL and enter its view.<pre class="screen"><a href="cmdqueryname=acl+number"><b><span class="cmdname">acl</span></b></a> [ <strong><span>number</span></strong> ] <i><span class="varname">user-acl-number</span></i> </pre>
</div>
<p>The number of a user-defined ACL ranges from 5000 to 5999.</p>
</li><li><p>Create a named user-defined ACL and enter its view.</p>
<pre class="screen"><a href="cmdqueryname=acl+name+user"><b><span class="cmdname">acl name</span></b></a> <i><span class="varname">user-acl-name</span></i> <strong><span>user</span></strong></pre>
</li></ul>
</p></li><li><span>(Optional) Configure an ACL step.</span><p><pre class="screen" id="EN-US_TASK_0000001130623036__en-us_task_0000001176742483_screen148201438191713"><a href="cmdqueryname=step"><b><span class="cmdname" id="EN-US_TASK_0000001130623036__en-us_task_0000001176742483_cmdname430815436176">step</span></b></a> <i><span class="varname" id="EN-US_TASK_0000001130623036__en-us_task_0000001176742483_varname776743717423">step-value</span></i></pre>
</p><p><p id="EN-US_TASK_0000001130623036__en-us_task_0000001176742483_p1373340508183306">The default ACL step is 5. Change the step value as required.</p>
</p></li><li><span>(Optional) Configure a description for the basic ACL.</span><p><pre class="screen" id="EN-US_TASK_0000001130623036__en-us_task_0000001176742483_screen1670613531740"><a href="cmdqueryname=description"><b><span class="cmdname" id="EN-US_TASK_0000001130623036__en-us_task_0000001176742483_cmdname664116591417">description</span></b></a> <i><span class="varname" id="EN-US_TASK_0000001130623036__en-us_task_0000001176742483_varname126411059742">text</span></i></pre>
<p id="EN-US_TASK_0000001130623036__en-us_task_0000001176742483_p48583136183305">The ACL description helps you understand and remember the functions or purpose of the ACL.</p>
</p></li><li><span>Configure a rule for the user-defined ACL.</span><p><pre class="screen"><a href="cmdqueryname=rule+name+deny+permit+l2-head+ipv4-head+l4-head+time-range"><b><span class="cmdname">rule </span></b></a>[ <i><span class="varname">rule-id</span></i> ] [ <strong><span>name</span></strong> <i><span class="varname">rule-name</span></i> ] { <strong><span>deny</span></strong> | <strong><span>permit</span></strong> } [ [ [ [ <strong><span>l2-head</span></strong> ] <i><span class="varname">rule1</span></i> <i><span class="varname">rulemask1</span></i> <i><span class="varname">offset1-l2</span></i> [ <i><span class="varname">rule2</span></i> <i><span class="varname">rulemask2</span></i> <i><span class="varname">offset2-l2</span></i> [ <i><span class="varname">rule3</span></i> <i><span class="varname">rulemask3</span></i> <i><span class="varname">offset3-l2</span></i> [ <i><span class="varname">rule4</span></i> <i><span class="varname">rulemask4</span></i> <i><span class="varname">offset4-l2</span></i> ] ] ] ] | [ <strong><span>ipv4-head</span></strong> <i><span class="varname">rule1</span></i> <i><span class="varname">rulemask1</span></i> <i><span class="varname">offset1-ipv4</span></i> [ <i><span class="varname">rule2</span></i> <i><span class="varname">rulemask2</span></i> <i><span class="varname">offset2-ipv4</span></i> [ <i><span class="varname">rule3</span></i> <i><span class="varname">rulemask3</span></i> <i><span class="varname">offset3-ipv4</span></i> [ <i><span class="varname">rule4</span></i> <i><span class="varname">rulemask4</span></i> <i><span class="varname">offset4-ipv4</span></i> ] ] ] ] | [ <strong><span>l4-head</span></strong> <i><span class="varname">rule1</span></i> <i><span class="varname">rulemask1</span></i> <i><span class="varname">offset1-l4</span></i> [ <i><span class="varname">rule2</span></i> <i><span class="varname">rulemask2</span></i> <i><span class="varname">offset2-l4</span></i> [ <i><span class="varname">rule3</span></i> <i><span class="varname">rulemask3</span></i> <i><span class="varname">offset3-l4</span></i> [ <i><span class="varname">rule4</span></i> <i><span class="varname">rulemask4</span></i> <i><span class="varname">offset4-l4</span></i> ] ] ] ] ] | [ <strong><span>time-range</span></strong> <i><span class="varname">time-name</span></i> ] ] <sup>*</sup></pre>
<p>In this example, only one permit or deny rule is configured. In actual configuration, you can configure multiple ACL rules and decide the matching order of the rules according to service requirements.</p>
</p><p><div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>To configure a time-based user-defined ACL, you must create a time range. For details, see <a href="vrp_acl_cfg_0009.html">Creating a Time Range in Which an ACL Takes Effect</a>.</p>
<div class="p">When a user-defined ACL rule is configured:<ul><li>If you do not specify an offset, the Ethernet frame header (equivalent to the case where <strong><span>l2-head</span></strong> is specified) is used as an offset by default.</li><li>If <strong><span>time-range</span></strong> is specified, the specified time range name must exist. Otherwise, the ACL rule configuration fails.</li></ul>
</div>
</div></div>
</p></li><li><span>(Optional) Configure a description for the ACL rule.</span><p><pre class="screen" id="EN-US_TASK_0000001130623036__en-us_task_0000001176742483_screen826615523308"><a href="cmdqueryname=rule+description"><b><span class="cmdname" id="EN-US_TASK_0000001130623036__en-us_task_0000001176742483_cmdnameab4d2703fa0c1de096e4d062b2daaf76">rule </span></b></a><i><span class="varname" id="EN-US_TASK_0000001130623036__en-us_task_0000001176742483_varname2b46a6416d48ff26018b9248bc2f24d3">rule-id</span></i> <strong><span id="EN-US_TASK_0000001130623036__en-us_task_0000001176742483_cmdpar6d720d4c65920475c7de7c975e80d31c">description</span></strong> <i><span class="varname" id="EN-US_TASK_0000001130623036__en-us_task_0000001176742483_varname7f65f9ae3bfa636bde170682d2274f6c">destext</span></i></pre>
<p id="EN-US_TASK_0000001130623036__en-us_task_0000001176742483_p2120462660183305">The ACL rule description helps you understand and remember the functions or purpose of the ACL rule.</p>
<p id="EN-US_TASK_0000001130623036__en-us_task_0000001176742483_rule_description_01">You must create a rule before you can configure a description for it.</p>
</p></li><li><span>Commit the configuration.</span><p><pre class="screen" id="EN-US_TASK_0000001130623036__en-us_task_0234857734_screen163801330213"><a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001130623036__en-us_task_0234857734_en-us_concept_0141113565_cmdname1667501373175340">commit</span></b></a></pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001130623036__1.3.3"></a><a name="1.3.3"></a><h4 class="sectiontitle">Example</h4><p>Configure packet filtering rules based on Layer 2 headers, offsets, character string masks, and user-defined character strings.</p>
<ul><li>Configure a rule in ACL 5001 to deny ARP packets from 192.168.0.2.<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>acl 5001</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-acl-user-5001] <strong>rule deny l2-head 0x00000806 0x0000ffff 10<span> 0x0000c0a8 0x0000ffff 26 0x00020000 0xffff0000 30</span></strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-acl-user-5001] <strong>quit</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<p>In the preceding rule:</p>
<ul><li>0x00000806 indicates the ARP protocol.</li><li>0x0000ffff is the character string mask.</li><li>10 indicates the offset of the Protocol Type field in an ARP packet without VLAN ID.</li><li>0x0000c0a8 and 0x00020000 are the hexadecimal format of 192.168.0.2. The source IP address (the hexadecimal value 0xc0a80002 in this example) needs to be divided into two segments for matching. This is because the IP Address of Sender field in an ARP packet begins at the 28th byte in the Layer 2 header and occupies 4 bytes, and the Layer 2 header's offset defined in a user-defined ACL must be 4 x <em>n</em> + 2 (<em>n</em> is an integer). The two low-order bytes among the four bytes behind the offset of 26 (4 x 6 + 2) and the two high-order bytes among the four bytes behind the offset of 30 (4 x 7 + 2) are matched separately. To filter ARP packets with VLAN IDs, add 4 to each offset.</li><li>26 and 30 indicate the offsets of two high-order bytes and two low-order bytes of the IP Address of Sender field in an ARP packet without VLAN ID, respectively.<div class="fignone"><span class="figcap"><b>Figure 1 </b>Offset of the IP Address of Sender field in the Layer 2 header of an ARP packet</span><br><span><img class="vsd" src="figure/en-us_image_0000001130782828.png"></span><br></div>
</li></ul>
</li><li>Configure a rule in a user-defined ACL named <strong>deny-tcp</strong> to deny all TCP packets.<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>acl name deny-tcp user</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-acl-user-deny-tcp] <strong>rule 5 deny ipv4-head 0x00060000 0x00ff0000 8</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-acl-user-5001] <strong>quit</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<p>In the preceding rule:</p>
<ul><li>0x00060000 indicates the TCP protocol.</li><li>8 indicates the offset of the Protocol field in an IP packet. The Protocol field begins at the 10th byte of the IPv4 header and occupies 1 byte. The IPv4 header's offset defined in a user-defined ACL must be 4 x <em>n</em> (<em>n</em> is an integer). Therefore, the second high-order byte among the 4 bytes behind the offset of 8 in the IPv4 header is matched.</li></ul>
<div class="fignone"><span class="figcap"><b>Figure 2 </b>Offset of the Protocol field in the IPv4 header</span><br><span><img class="vsd" src="figure/en-us_image_0000001130623040.png"></span><br></div>
</li></ul>
<h4 class="sectiontitle">Verifying the Configuration</h4><p>Run the <span><a href="cmdqueryname=display+acl+name+all"><b><span class="cmdname">display acl</span></b></a> { <i><span class="varname">user-acl-number</span></i> | <strong><span>name</span></strong> <i><span class="varname">user-acl-name</span></i> | <strong><span>all</span></strong> }</span> command to check the configuration of the user-defined ACL.</p>
</div>
<div class="postreq"><a name="EN-US_TASK_0000001130623036__1.3.4"></a><a name="1.3.4"></a><h4 class="sectiontitle">Follow-up Procedure</h4>
<div class="p"><p>Apply the user-defined ACL to a service module so that the user-defined ACL rules can be delivered and take effect.</p>
</div></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="vrp_acl_cfg_0010.html">Configuring an ACL
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="vrp_acl_cfg_0013.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="vrp_acl_cfg_0015.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>