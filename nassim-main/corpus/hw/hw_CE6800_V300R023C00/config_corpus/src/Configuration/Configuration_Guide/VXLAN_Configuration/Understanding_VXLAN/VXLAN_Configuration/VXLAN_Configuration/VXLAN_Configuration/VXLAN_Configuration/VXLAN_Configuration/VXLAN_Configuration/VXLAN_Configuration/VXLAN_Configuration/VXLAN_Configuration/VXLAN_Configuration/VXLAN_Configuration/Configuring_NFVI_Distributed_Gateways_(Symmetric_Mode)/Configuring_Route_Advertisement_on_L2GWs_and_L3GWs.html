
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring Route Advertisement on L2GWs/L3GWs">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../vrp/dc_vrp_vxlan_cfg_1232.html">
<meta name="DC.Relation" scheme="URI" content="../vrp/dc_vrp_vxlan_cfg_1233.html">
<meta name="DC.Relation" scheme="URI" content="../vrp/dc_vrp_vxlan_cfg_1235.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="VXLAN">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="VXLAN">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="VXLAN">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="VXLAN">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001150047634">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="../public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="../public_sys-resources/browseVersion.js"></script>
<title>Configuring Route Advertisement on L2GWs/L3GWs</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001150047634"></a><a name="EN-US_TASK_0000001150047634"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring Route Advertisement on L2GWs/L3GWs</h1>
<div class="taskbody"><div class="prereq" style="margin-left:0"><a name="EN-US_TASK_0000001150047634__1.3.1"></a><a name="1.3.1"></a><h4 class="sectiontitle">Prerequisites</h4>
<div class="p"><p>Before configuring route advertisement on an L2GW/L3GW, complete one of the following tasks based on the network type:</p>
<ul><li><a href="../dc/dc_vrp_vxlan_cfg_1066.html">Establishing VXLAN Tunnels in BGP EVPN Mode (Distributed VXLAN Gateway)</a></li><li><a href="../dc/dc_vrp_vxlan6_cfg_1066.html">Establishing IPv6 VXLAN Tunnels in BGP EVPN Mode (Distributed VXLAN Gateway)</a></li></ul>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001150047634__1.3.2"></a><a name="1.3.2"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p><a href="#EN-US_TASK_0000001150047634__fig14453146813">Figure 1</a> shows the networking diagram of NFVI distributed gateways. DC gateways are the DCN's border gateways and can be used to exchange Internet routes with the external network. L2GW/L3GW1 and L2GW/L3GW2 connect to virtualized network functions (VNFs). VNF1 and VNF2, as virtualized NEs, can be deployed to respectively provide vUGW and vMSE functions and connect to L2GW/L3GW1 and L2GW/L3GW2 through interface processing units (IPUs).</p>
<div class="fignone" id="EN-US_TASK_0000001150047634__fig14453146813"><a name="EN-US_TASK_0000001150047634__fig14453146813"></a><a name="fig14453146813"></a><span class="figcap"><b>Figure 1 </b>NFVI distributed gateway networking</span><br><span><img class="vsd" src="figure/en-us_image_0000001196218629.png" width="NaN" height="NaN"></span></div>
<p>After route advertisement is configured on L2GWs/L3GWs, other devices can obtain routes to L2GWs/L3GWs, and L2GWs/L3GWs can generate their own forwarding entries based on the received EVPN or BGP routes.</p>
<div class="note"><img src="../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The NFVI distributed gateway function is supported for both IPv4 and IPv6 services. If a configuration step is not differentiated in terms of IPv4 and IPv6, this step applies to both IPv4 and IPv6 services.</p>
<p>This series of devices can function as L2GWs/L3GWs only.</p>
</div></div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001150047634__1.3.3"></a><a name="1.3.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Use either of the following methods to configure a VPN route to a VNF:</span><p><ul><li>Configure a VPN static route to a VNF. For details, see <em>Configuration Guide &gt; IP Routing &gt; IPv4 Static Route Configuration</em> or <em>Configuration Guide &gt; IP Routing &gt; IPv6 Static Route Configuration</em>.<div class="note"><img src="../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>To load-balance east-west traffic between VNF1 and VNF2, use the <strong><span>inter-protocol-ecmp</span></strong> keyword when configuring VPN static routes to VNFs on L2GWs/L3GWs, and set the preference of the static routes to 255. (These routes must have the same preference as BGP EVPN routes.)</p>
</div></div>
</li><li>Configure L2GWs/L3GWs to establish VPN IGP neighbor relationships with VNFs. For details, see "Configuring Basic IPv4 IS-IS Functions" located under <em>Configuration Guide &gt; IP Routing &gt; IS-IS Configuration</em>, "Configuring Basic OSPF Functions" located under <em>Configuration Guide &gt; IP Routing &gt; OSPF Configuration</em>, "Configuring Basic IPv6 IS-IS Functions" located under <em>Configuration Guide &gt; IP Routing &gt; IS-IS Configuration</em>, or "Configuring Basic OSPFv3 Functions" located under <em>Configuration Guide &gt; IP Routing &gt; OSPFv3 Configuration</em>.<div class="note"><img src="../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In an active-active L2GW/L3GW scenario, a secondary IP address (<a href="cmdqueryname=ip+address"><b><span class="cmdname">ip address</span></b></a> <i><span class="varname">ip-address</span></i> <strong><span>sub</span></strong>) needs to be configured for the VBDIF interface on each L2GW/L3GW for the establishment of VPN IGP neighbor relationships with VNFs.</p>
</div></div>
</li></ul>
</p></li><li><span>Configure an L3VPN instance to advertise VPN routes destined for VNFs to the EVPN instance.</span><ol type="a"><li class="substepexpand"><span>Enter the system view.</span><p><pre class="screen"><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></pre>
</p></li><li class="substepexpand"><span>Create a route-policy to filter VPN routes reachable to VNFs in the L3VPN instance.</span><p><p>For details about how to create a route-policy, see "Routing Policy Configuration" located under <em>Configuration Guide &gt; IP Routing Configuration &gt; Configuring a Route-Policy</em>. When configuring the apply clause, you need to run the <a href="cmdqueryname=apply+gateway-ip"><b><span class="cmdname">apply gateway-ip</span></b></a> { <strong><span>origin-nexthop</span></strong> | <i><span class="varname">ipv4-address</span></i> } or <a href="cmdqueryname=apply+ipv6+gateway-ip"><b><span class="cmdname">apply ipv6 gateway-ip</span></b></a> { <strong><span>origin-nexthop</span></strong> | <i><span class="varname">ipv6-address</span></i> } command to set the original next hop address of a VPN route to the gateway address.</p>
</p></li><li class="substepexpand"><span>Create a VPN instance and enter its view.</span><p><pre class="screen"><a href="cmdqueryname=ip+vpn-instance"><b><span class="cmdname">ip vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i></pre>
</p></li><li class="substepexpand"><span>Enter the VPN instance IPv4/IPv6 address family view.</span><p><pre class="screen"><a href="cmdqueryname=ipv4-family"><b><span class="cmdname">ipv4-family</span></b></a> or <a href="cmdqueryname=ipv6-family"><b><span class="cmdname">ipv6-family</span></b></a></pre>
</p></li><li class="substepexpand"><span>Associate the current L3VPN instance with an export route-policy.</span><p><pre class="screen"><a href="cmdqueryname=export+route-policy"><b><span class="cmdname">export route-policy</span></b></a> <i><span class="varname">policy-name</span></i> <strong><span>evpn</span></strong></pre>
<p>The route-policy is created in Step 2.b and used to filter routes advertised by the L3VPN instance to the EVPN instance. This ensures that the L3VPN instance advertises only VPN routes destined for the VNF to the EVPN instance.</p>
</p></li><li class="substepexpand"><span>Return to the VPN instance view.</span><p><pre class="screen"><a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></pre>
</p></li><li class="substepexpand"><span>Return to the system view.</span><p><pre class="screen"><a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></pre>
</p></li><li class="substepexpand"><span>Enter the BGP view.</span><p><pre class="screen"><a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></pre>
</p></li><li class="substepexpand"><span>Enter the BGP VPN instance IPv4/IPv6 address family view.</span><p><pre class="screen"><a href="cmdqueryname=ipv4-family"><b><span class="cmdname">ipv4-family</span></b></a> <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i> or <a href="cmdqueryname=ipv6-family"><b><span class="cmdname">ipv6-family</span></b></a> <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i></pre>
</p></li><li class="substepexpand"><span>Import routes destined for the VNF into the routing table of the BGP VPN instance IPv4 or IPv6 address family.</span><p><pre class="screen"><a href="cmdqueryname=import-route"><b><span class="cmdname">import-route</span></b></a> { <strong><span>static</span></strong> | { <strong><span>ospf</span></strong> | <strong><span>isis</span></strong> } <i><span class="varname">process-id</span></i> } [ <strong><span>med</span></strong> <i><span class="varname">med</span></i> | <strong><span>route-policy</span></strong> <i><span class="varname">route-policy-name</span></i> ] <sup>*</sup>
or
<a href="cmdqueryname=import-route"><b><span class="cmdname">import-route</span></b></a> { <strong><span>static</span></strong> | { <strong><span>ospfv3</span></strong> | <strong><span>isis</span></strong> } <i><span class="varname">process-id</span></i> } [ <strong><span>med</span></strong> <i><span class="varname">med</span></i> | <strong><span>route-policy</span></strong> <i><span class="varname">route-policy-name</span></i> ] <sup>*</sup></pre>
<p>By default, other protocol routes are not imported into the routing table for the BGP VPN instance IPv4/IPv6 address family.</p>
</p></li><li class="substepexpand"><span>Enable the VPN instance to advertise EVPN IP prefix routes.</span><p><pre class="screen"><a href="cmdqueryname=advertise+l2vpn+evpn"><b><span class="cmdname">advertise l2vpn evpn</span></b></a> { <strong><span>best-route</span></strong> | <strong><span>valid-routes</span></strong> }[ <strong><span>import-route-multipath</span></strong> ] [ <strong><span>include-local-cross-route</span></strong> ]</pre>
<p>By default, a VPN instance cannot advertise EVPN IP prefix routes. If load balancing is required, you are advised to specify the <strong><span>import-route-multipath</span></strong> keyword, so that a VPN instance can advertise all routes with the same destination address as EVPN IP prefix routes. </p>
</p></li><li class="substepexpand"><span>Return to the BGP view.</span><p><pre class="screen"><a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></pre>
</p></li><li class="substepexpand"><span>Return to the system view.</span><p><pre class="screen"><a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></pre>
</p></li><li class="substepexpand"><span>Commit the configuration.</span><p><pre class="screen" id="EN-US_TASK_0000001150047634__en-us_task_0234857734_screen14848162118611"><a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001150047634__en-us_task_0234857734_cmdname1784862115612">commit</span></b></a></pre>
</p></li></ol>
</li><li><span>Configure the device to advertise IRB or IRBv6 routes to the DC gateway.</span><ol type="a"><li class="substepexpand"><span>Enter the BGP view.</span><p><pre class="screen"><a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></pre>
</p></li><li class="substepexpand"><span>Enter the BGP-EVPN address family view.</span><p><pre class="screen"><a href="cmdqueryname=l2vpn-family+evpn"><b><span class="cmdname">l2vpn-family evpn</span></b></a></pre>
</p></li><li class="substepexpand"><span>Configure the device to advertise IRB or IRBv6 routes to the DC gateway.</span><p><pre class="screen"><a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> | <i><span class="varname">ipv6-address</span></i> } <strong><span>advertise</span></strong> { <strong><span>irb</span></strong> | <strong><span>irbv6</span></strong> }</pre>
<p>By default, a device does not advertise IRB/IRBv6 routes to BGP EVPN peers.</p>
</p></li><li class="substepexpand"><span>Return to the BGP view.</span><p><pre class="screen"><a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></pre>
</p></li><li class="substepexpand"><span>Return to the system view.</span><p><pre class="screen"><a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></pre>
</p></li><li class="substepexpand"><span>Commit the configuration.</span><p><pre class="screen" id="EN-US_TASK_0000001150047634__en-us_task_0234857734_screen14848162118611_1"><a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001150047634__en-us_task_0234857734_cmdname1784862115612_1">commit</span></b></a></pre>
</p></li></ol>
</li></ol></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../vrp/dc_vrp_vxlan_cfg_1232.html">Configuring NFVI Distributed Gateways (Symmetric Mode)
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../vrp/dc_vrp_vxlan_cfg_1233.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../vrp/dc_vrp_vxlan_cfg_1235.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>