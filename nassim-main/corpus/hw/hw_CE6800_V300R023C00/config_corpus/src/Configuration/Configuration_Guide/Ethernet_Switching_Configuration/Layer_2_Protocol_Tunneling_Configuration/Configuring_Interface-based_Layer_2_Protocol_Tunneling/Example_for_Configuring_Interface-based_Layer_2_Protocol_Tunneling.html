
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Interface-based Layer 2 Protocol Tunneling">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="dc_cfg_l2pt_0006.html">
<meta name="DC.Relation" scheme="URI" content="dc_cfg_l2pt_0012.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="L2PT">
<meta name="featuretype" content="Ethernet Switching">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="L2PT">
<meta name="featuretype" content="Ethernet Switching">
<meta name="featurename" content="L2PT">
<meta name="featuretype" content="Ethernet Switching">
<meta name="featuretype" content="Ethernet Switching">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001204643937">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring Interface-based Layer 2 Protocol Tunneling</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001204643937"></a><a name="EN-US_TASK_0000001204643937"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Interface-based Layer 2 Protocol Tunneling</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001204643937__1.3.1"></a><a name="1.3.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>In <a href="#EN-US_TASK_0000001204643937__fig_dc_cfg_l2pt_001801">Figure 1</a>, CEs are edge devices on user networks in different locations of an enterprise, and PE1 and PE2 are edge devices on an ISP network. The two networks of the enterprise are Layer 2 networks and are connected through the ISP network. STP is run on the Layer 2 networks to prevent loops. The enterprise requires that STP be run only on the user networks to generate correct spanning trees.</p>
<div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface 1, interface 2, and interface 3 represent <span>100GE</span> <span>1/0/1</span>, <span>100GE</span> <span>1/0/2</span>, and <span>100GE</span> <span>1/0/3</span>, respectively.</p>
</div></div>
<div class="fignone" id="EN-US_TASK_0000001204643937__fig_dc_cfg_l2pt_001801"><a name="EN-US_TASK_0000001204643937__fig_dc_cfg_l2pt_001801"></a><a name="fig_dc_cfg_l2pt_001801"></a><span class="figcap"><b>Figure 1 </b>Network diagram of configuring interface-based Layer 2 protocol tunneling</span><br><span><img class="vsd" src="figure/en-us_image_0000001204882485.png"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001204643937__1.3.2"></a><a name="1.3.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure STP on CEs to prevent loops on Layer 2 networks.</p>
</li><li><p>Add PE interfaces connected to CEs to specified VLANs so that the PEs can forward packets from the VLANs.</p>
</li><li><p>Configure interface-based Layer 2 protocol tunneling on PEs so that STP BPDUs are not sent to the CPUs of PEs for processing.</p>
</li></ol>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001204643937__1.3.3"></a><a name="1.3.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Enable STP on CEs.</span><p><p># Configure CE1.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname CE1</strong>
<span>[<span><span class="keyword">*</span></span><span class="keyword">HUAWEI</span>] <strong>commit</strong></span>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>vlan 100</strong>
[<span><span class="keyword">*</span></span>CE1-vlan100] <strong>quit</strong>
[<span><span class="keyword">*</span></span>CE1] <strong>stp enable</strong>
[<span><span class="keyword">*</span></span>CE1] <strong>interface <span>100ge</span> <span>1/0/1</span></strong>
[<span><span class="keyword">*</span></span>CE1-<span>100GE</span><span>1/0/1</span>] <strong>portswitch</strong>
[<span><span class="keyword">*</span></span>CE1-<span>100GE</span><span>1/0/1</span>]<strong> port link-type access</strong>
[<span><span class="keyword">*</span></span>CE1-<span>100GE</span><span>1/0/1</span>]<strong> port default vlan 100</strong>
[<span><span class="keyword">*</span></span>CE1-<span>100GE</span><span>1/0/1</span>] <strong>quit</strong>
<span>[<span><span class="keyword">*</span></span>CE1] <strong>commit</strong></span></pre>
<p># Configure CE2.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname CE2</strong>
<span>[<span><span class="keyword">*</span></span><span class="keyword">HUAWEI</span>] <strong>commit</strong></span>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>vlan 100</strong>
[<span><span class="keyword">*</span></span>CE2-vlan100] <strong>quit</strong>
[<span><span class="keyword">*</span></span>CE2] <strong>stp enable</strong>
[<span><span class="keyword">*</span></span>CE2] <strong>interface <span>100ge</span> <span>1/0/1</span></strong>
[<span><span class="keyword">*</span></span>CE2-<span>100GE</span><span>1/0/1</span>] <strong>portswitch</strong>
<span>[<span><span class="keyword">*</span></span>CE2-<span>100GE</span><span>1/0/1</span>]<strong> port link-type access</strong>
[<span><span class="keyword">*</span></span>CE2-<span>100GE</span><span>1/0/1</span>]<strong> port default vlan 100</strong></span>
[<span><span class="keyword">*</span></span>CE2-<span>100GE</span><span>1/0/1</span>] <strong>quit</strong>
<span>[<span><span class="keyword">*</span></span>CE2] <strong>commit</strong></span></pre>
</p></li><li><span>Add <span>100GE</span> <span>1/0/1</span> on PE1 and PE2 to VLAN 100 and enable Layer 2 protocol tunneling on the PEs.</span><p><p># Configure PE1.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname PE1</strong>
<span>[<span><span class="keyword">*</span></span><span class="keyword">HUAWEI</span>] <strong>commit</strong></span>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>stp enable</strong>
[<span><span class="keyword">*</span></span>PE1] <span><strong>commit</strong></span>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>vlan 100</strong>
[<span><span class="keyword">*</span></span>PE1-vlan100] <strong>quit</strong>
[<span><span class="keyword">*</span></span>PE1] <strong>interface <span>100ge</span> <span>1/0/1</span></strong>
[<span><span class="keyword">*</span></span>PE1-<span>100GE</span><span>1/0/1</span>] <strong>portswitch</strong>
<span>[<span><span class="keyword">*</span></span>PE1-<span>100GE</span><span>1/0/1</span>]<strong> port link-type access</strong>
[<span><span class="keyword">*</span></span>PE1-<span>100GE</span><span>1/0/1</span>]<strong> port default vlan 100</strong></span>
<span>[<span><span class="keyword">*</span></span>PE1-<span>100GE</span><span>1/0/1</span>]<strong> stp disable</strong></span>
[<span><span class="keyword">*</span></span>PE1-<span>100GE</span><span>1/0/1</span>] <strong>l2protocol-tunnel stp enable</strong>
[<span><span class="keyword">*</span></span>PE1-<span>100GE</span><span>1/0/1</span>] <strong>quit</strong>
<span>[<span><span class="keyword">*</span></span>PE1] <strong>commit</strong></span></pre>
<p># Configure PE2.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname PE2</strong>
<span>[<span><span><span class="keyword">*</span></span></span><span class="keyword">HUAWEI</span>] <strong>commit</strong></span>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>stp enable</strong>
[<span><span><span class="keyword">*</span></span></span>PE2] <span><strong>commit</strong></span>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2]<strong> vlan 100</strong>
[<span><span><span class="keyword">*</span></span></span>PE2-vlan100] <strong>quit</strong>
[<span><span><span class="keyword">*</span></span></span>PE2] <strong>interface <span>100ge</span> <span>1/0/1</span></strong>
[<span><span><span class="keyword">*</span></span></span>PE2-<span>100GE</span><span>1/0/1</span>] <strong>portswitch</strong>
<span>[<span><span><span class="keyword">*</span></span></span>PE2-<span>100GE</span><span>1/0/1</span>]<strong> port link-type access</strong>
[<span><span><span class="keyword">*</span></span></span>PE2-<span>100GE</span><span>1/0/1</span>]<strong> port default vlan 100</strong></span>
<span>[<span><span><span class="keyword">*</span></span></span>PE2-<span>100GE</span><span>1/0/1</span>]<strong> <span><strong>stp disable</strong></span></strong></span>
[<span><span><span class="keyword">*</span></span></span>PE2-<span>100GE</span><span>1/0/1</span>] <strong>l2protocol-tunnel stp enable</strong>
[<span><span><span class="keyword">*</span></span></span>PE2-<span>100GE</span><span>1/0/1</span>] <strong>quit</strong>
<span>[<span><span><span class="keyword">*</span></span></span>PE2] <strong>commit</strong></span></pre>
<div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>If the peer device sends non-standard protocol packets, first run the <a href="cmdqueryname=l2protocol-tunnel+user-defined-protocol"><b><span class="cmdname">l2protocol-tunnel user-defined-protocol</span></b></a> <i><span class="varname">protocol-name</span></i> <strong><span>protocol-mac</span></strong> <i><span class="varname">protocol-mac</span></i> [ <strong><span>encap-type</span></strong> { { <strong><span>ethernetii</span></strong> | <strong><span>snap</span></strong> } <strong><span>protocol-type</span></strong> <i><span class="varname">protocol-type-value</span></i> | <strong><span>llc dsap</span></strong> <i><span class="varname">dsap-value</span></i> <strong><span>ssap</span></strong> <i><span class="varname">ssap-value</span></i> } ] <strong><span>group-mac</span></strong> { <i><span class="varname">group-mac</span></i> | <strong><span>default-group-mac</span></strong> } command to define the characteristics of the Layer 2 protocol for transparent transmission and then run the <a href="cmdqueryname=l2protocol-tunnel+user-defined-protocol"><b><span class="cmdname">l2protocol-tunnel user-defined-protocol</span></b></a> <i><span class="varname">protocol-name</span></i> <strong><span>enable</span></strong> command to enable Layer 2 protocol tunneling on the interface.</p>
</div></div>
</p></li><li><span>Configure PEs to replace the destination MAC addresses of STP BPDUs received from CEs.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>l2protocol-tunnel stp group-mac <span>0100-5e00-0011</span></strong>
<span>[<span><span><span><span class="keyword">*</span></span></span></span>PE1] <strong>commit</strong></span></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>l2protocol-tunnel stp group-mac <span>0100-5e00-0011</span></strong>
<span>[<span><span><span><span class="keyword">*</span></span></span></span>PE2] <strong>commit</strong></span></pre>
</p></li><li><span>Set the priority of CE2 to 4096.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>stp priority 4096</strong>
<span>[<span><span><span><span class="keyword">*</span></span></span></span>CE2] <strong>commit</strong></span></pre>
</p></li><li><span>Verify the configuration.</span><p><p># After the configuration is complete, run the <a href="cmdqueryname=display+l2protocol-tunnel+group-mac"><b><span class="cmdname">display l2protocol-tunnel group-mac</span></b></a> command on PEs to view the protocol name, protocol type, destination multicast MAC address, group MAC address, and priority of Layer 2 protocol packets that are transparently transmitted.</p>
<p>The following example uses the command output on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display l2protocol-tunnel group-mac stp</strong>
Protocol         EncapeType ProtocolType Protocol-MAC   Group-MAC      Pri      
-----------------------------------------------------------------------------   
stp              llc        dsap 0x42    0180-c200-0000 <span>0100-5e00-0011</span> 0        
                            ssap 0x42                                           </pre>
<p># Wait for 30s and run the <a href="cmdqueryname=display+stp+brief"><b><span class="cmdname">display stp brief</span></b></a> command on CE1 and CE2 to check the root in the MST region. The command output shows that CE1 and CE2 complete spanning tree calculation. <span><span>100GE</span> <span>1/0/1</span></span> is the root port on CE1, and <span><span>100GE</span> <span>1/0/1</span></span> is a designated port on CE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>display stp brief</strong>
MSTID  Port                        Role  STP State     Protection  Cost       Edged
    0  <span><span>100GE</span><span>1/0/1</span></span>                   ROOT  forwarding    none        2000       disable
</pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>display stp brief</strong>
MSTID  Port                        Role  STP State     Protection  Cost       Edged
    0  <span><span>100GE</span><span>1/0/1</span></span>                   DESI  forwarding    none        2000       disable
</pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001204643937__1.3.4"></a><a name="1.3.4"></a><h4 class="sectiontitle">Configuration Scripts</h4><ul><li><p>CE1</p>
<pre class="screen">#
sysname CE1
#
vlan batch 100
#
interface <span><span>100GE</span><span>1/0/1</span></span><span></span>
<span> port default vlan 100</span>
#
return</pre>
</li><li><p>CE2</p>
<pre class="screen">#
sysname CE2
#
vlan batch 100 
#
stp instance 0 priority 4096
#
interface <span><span>100GE</span><span>1/0/1</span></span><span></span>
<span> port default vlan 100</span>
#
return</pre>
</li><li><p>PE1</p>
<pre class="screen">#
sysname PE1
#
vlan batch 100
#
l2protocol-tunnel stp group-mac <span>0100-5e00-0011</span>
#
interface <span><span>100GE</span><span>1/0/1</span></span><span></span>
<span> port default vlan 100</span>
 stp disable
 l2protocol-tunnel stp enable
#
return</pre>
</li><li><p>PE2</p>
<pre class="screen">#
sysname PE2
#
vlan batch 100
#
l2protocol-tunnel stp group-mac <span>0100-5e00-0011</span>
#
interface <span><span>100GE</span><span>1/0/1</span></span><span></span>
<span> port default vlan 100</span>
 stp disable
 l2protocol-tunnel stp enable
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="dc_cfg_l2pt_0006.html">Configuring Interface-based Layer 2 Protocol Tunneling
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="dc_cfg_l2pt_0012.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>
</body>
</html>