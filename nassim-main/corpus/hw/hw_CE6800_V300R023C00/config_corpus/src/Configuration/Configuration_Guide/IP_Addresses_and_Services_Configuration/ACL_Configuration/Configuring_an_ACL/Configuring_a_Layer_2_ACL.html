
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring a Layer 2 ACL">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="vrp_acl_cfg_0010.html">
<meta name="DC.Relation" scheme="URI" content="vrp_acl_cfg_0012.html">
<meta name="DC.Relation" scheme="URI" content="vrp_acl_cfg_0014.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="ACL">
<meta name="featuretype" content="IP Addresses and Services">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="ACL">
<meta name="featuretype" content="IP Addresses and Services">
<meta name="featurename" content="ACL">
<meta name="featuretype" content="IP Addresses and Services">
<meta name="featuretype" content="IP Addresses and Services">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001176662577">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>Configuring a Layer 2 ACL</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001176662577"></a><a name="EN-US_TASK_0000001176662577"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring a Layer 2 ACL</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001176662577__1.3.1"></a><a name="1.3.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>A Layer 2 ACL defines packet filtering rules based on the information in Ethernet frame headers of the packets, such as source and destination MAC addresses, VLAN IDs, and Layer 2 protocol types.</p>
<div class="p"><strong id="EN-US_TASK_0000001176662577__en-us_task_0000001176742483_b1652132913555">When ACL rules are configured:</strong><ul id="EN-US_TASK_0000001176662577__en-us_task_0000001176742483_en-us_concept_0177090555_ul1191338372183158"><li id="EN-US_TASK_0000001176662577__en-us_task_0000001176742483_en-us_concept_0177090555_li822401570183158"><p id="EN-US_TASK_0000001176662577__en-us_task_0000001176742483_en-us_concept_0177090555_p898434898183158"><a name="EN-US_TASK_0000001176662577__en-us_task_0000001176742483_en-us_concept_0177090555_li822401570183158"></a><a name="en-us_task_0000001176742483_en-us_concept_0177090555_li822401570183158"></a>If the specified rule ID already exists and the new rule conflicts with the original, the original is replaced.</p>
</li><li id="EN-US_TASK_0000001176662577__en-us_task_0000001176742483_en-us_concept_0177090555_li504316878183158"><p id="EN-US_TASK_0000001176662577__en-us_task_0000001176742483_en-us_concept_0177090555_p2083297484183158"><a name="EN-US_TASK_0000001176662577__en-us_task_0000001176742483_en-us_concept_0177090555_li504316878183158"></a><a name="en-us_task_0000001176742483_en-us_concept_0177090555_li504316878183158"></a>Matching stops for a packet once the packet matches a rule in an ACL.</p>
</li><li id="EN-US_TASK_0000001176662577__en-us_task_0000001176742483_li1538122512195">Many services that are not configured with ACL rules also occupy ACL resources. You can run the <a href="cmdqueryname=display+system+tcam+service+brief"><b><span class="cmdname" id="EN-US_TASK_0000001176662577__en-us_task_0000001176742483_cmdname4391122852016">display system tcam service brief</span></b></a> command to check ACL resources occupied by services.</li></ul>
</div>
<p><strong id="EN-US_TASK_0000001176662577__en-us_task_0000001176742483_b19922155455712">When ACL rules are deleted:</strong> The <a href="cmdqueryname=undo+rule"><b><span class="cmdname" id="EN-US_TASK_0000001176662577__en-us_task_0000001176742483_en-us_concept_0177090555_cmdname1539083973183158">undo rule</span></b></a> command can delete an ACL rule even if this rule is referenced. Before deleting a rule, run the <a href="cmdqueryname=display+current-configuration+%7C+include+acl"><b><span class="cmdname" id="EN-US_TASK_0000001176662577__en-us_task_0000001176742483_cmdname6906162174518">display current-configuration | include acl</span></b></a> command to check whether the rule is being referenced.</p>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001176662577__1.3.2"></a><a name="1.3.2"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Enter the system view.</span><p><pre class="screen"><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></pre>
</p></li><li><span>Create a Layer 2 ACL. You can create a numbered or named Layer 2 ACL.</span><p><ul><li><div class="p">Create a numbered Layer 2 ACL and enter its view.<pre class="screen"><a href="cmdqueryname=acl+number"><b><span class="cmdname">acl</span></b></a> [ <strong><span>number</span></strong> ] <i><span class="varname">link-acl-number</span></i> </pre>
</div>
<p>The number of a Layer 2 ACL ranges from 4000 to 4999.</p>
</li><li><p>Create a named Layer 2 ACL and enter its view.</p>
<pre class="screen"><a href="cmdqueryname=acl+name+link"><b><span class="cmdname">acl name</span></b></a> <i><span class="varname">link-acl-name</span></i> <strong><span>link</span></strong> </pre>
</li></ul>
</p></li><li><span>(Optional) Configure an ACL step.</span><p><pre class="screen" id="EN-US_TASK_0000001176662577__en-us_task_0000001176742483_screen148201438191713"><a href="cmdqueryname=step"><b><span class="cmdname" id="EN-US_TASK_0000001176662577__en-us_task_0000001176742483_cmdname430815436176">step</span></b></a> <i><span class="varname" id="EN-US_TASK_0000001176662577__en-us_task_0000001176742483_varname776743717423">step-value</span></i></pre>
</p><p><p id="EN-US_TASK_0000001176662577__en-us_task_0000001176742483_p1373340508183306">The default ACL step is 5. Change the step value as required.</p>
</p></li><li><span>(Optional) Configure a description for the basic ACL.</span><p><pre class="screen" id="EN-US_TASK_0000001176662577__en-us_task_0000001176742483_screen1670613531740"><a href="cmdqueryname=description"><b><span class="cmdname" id="EN-US_TASK_0000001176662577__en-us_task_0000001176742483_cmdname664116591417">description</span></b></a> <i><span class="varname" id="EN-US_TASK_0000001176662577__en-us_task_0000001176742483_varname126411059742">text</span></i></pre>
<p id="EN-US_TASK_0000001176662577__en-us_task_0000001176742483_p48583136183305">The ACL description helps you understand and remember the functions or purpose of the ACL.</p>
</p></li><li><span>Configure a rule for the Layer 2 ACL.</span><p><pre class="screen"><a href="cmdqueryname=rule+name+permit+deny+type+arp+ip+ipv6+mpls+rarp+source-mac"><b><span class="cmdname">rule </span></b></a>[ <i><span class="varname">rule-id</span></i> ] [ <strong><span>name</span></strong> <i><span class="varname">rule-name</span></i> ] { <strong><span>permit</span></strong> | <strong><span>deny</span></strong> } [ [ <strong><span>ether-ii</span></strong> | <strong><span>snap</span></strong> ] | [ <strong><span>type</span></strong> { <i><span class="varname">type</span></i> | <strong><span>arp</span></strong> | <strong><span>ip</span></strong> | <strong><span>ipv6</span></strong> | <strong><span>mpls</span></strong> | <strong><span>rarp</span></strong> } [ <i><span class="varname">fram-type-mask</span></i> ] ] | <strong><span>source-mac</span></strong> <i><span class="varname">src-mac-address</span></i> [ <i><span class="varname">src-mac-mask</span></i> ] | <strong><span>destination-mac</span></strong> <i><span class="varname">dest-mac-address</span></i> [ <i><span class="varname">dest-mac-mask</span></i> ] | <strong><span>vlan</span></strong> <i><span class="varname">vlan-id</span></i> [ <i><span class="varname">vlanid-mask</span></i> ] | <strong><span>8021p</span></strong> <i><span class="varname">8021p</span></i> | <strong><span>inner-vlan</span></strong> <i><span class="varname">cvlan-value</span></i> [ <i><span class="varname">cvlan-mask</span></i> ] | <strong><span>inner-8021p</span></strong> <i><span class="varname">cvlan-8021p-value</span></i> | <strong><span>double-tag</span></strong> | <strong><span>time-range</span></strong> <i><span class="varname">time-range-name</span></i> ] <sup>*</sup></pre>
<p>In this example, only one permit or deny rule is configured. In actual configuration, you can configure multiple ACL rules and decide the matching order of the rules according to service requirements.</p>
<div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>To configure a time-based Layer 2 ACL, you must create a time range. For details, see <a href="vrp_acl_cfg_0009.html">Creating a Time Range in Which an ACL Takes Effect</a>.</p>
<div class="p">When a rule is configured for the Layer 2 ACL:<ul><li>If <strong><span>ether-ii</span></strong> | <strong><span>snap</span></strong> is specified, only packets with a specified encapsulation type are filtered.</li><li>If no <strong><span>ether-ii</span></strong> | <strong><span>snap</span></strong> is specified, packets with all encapsulation types are filtered.</li><li>If <strong><span>time-range</span></strong> is specified, the specified time range name must exist. Otherwise, the ACL rule configuration fails.</li></ul>
</div>
</div></div>
</p></li><li><span>(Optional) Configure a description for the ACL rule.</span><p><pre class="screen" id="EN-US_TASK_0000001176662577__en-us_task_0000001176742483_screen826615523308"><a href="cmdqueryname=rule+description"><b><span class="cmdname" id="EN-US_TASK_0000001176662577__en-us_task_0000001176742483_cmdnameab4d2703fa0c1de096e4d062b2daaf76">rule </span></b></a><i><span class="varname" id="EN-US_TASK_0000001176662577__en-us_task_0000001176742483_varname2b46a6416d48ff26018b9248bc2f24d3">rule-id</span></i> <strong><span id="EN-US_TASK_0000001176662577__en-us_task_0000001176742483_cmdpar6d720d4c65920475c7de7c975e80d31c">description</span></strong> <i><span class="varname" id="EN-US_TASK_0000001176662577__en-us_task_0000001176742483_varname7f65f9ae3bfa636bde170682d2274f6c">destext</span></i></pre>
<p id="EN-US_TASK_0000001176662577__en-us_task_0000001176742483_p2120462660183305">The ACL rule description helps you understand and remember the functions or purpose of the ACL rule.</p>
<p id="EN-US_TASK_0000001176662577__en-us_task_0000001176742483_rule_description_01">You must create a rule before you can configure a description for it.</p>
</p></li><li><span>Commit the configuration.</span><p><pre class="screen" id="EN-US_TASK_0000001176662577__en-us_task_0234857734_screen163801330213"><a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001176662577__en-us_task_0234857734_en-us_concept_0141113565_cmdname1667501373175340">commit</span></b></a></pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001176662577__1.3.3"></a><a name="1.3.3"></a><h4 class="sectiontitle">Example</h4><ul><li><p>Configure packet filtering rules based on the source MAC address, destination MAC address, and Layer 2 protocol type.</p>
<div class="p">To permit ARP packets with the specified destination and source MAC addresses and Layer 2 protocol type, configure a rule in a Layer 2 ACL. For example, to permit ARP packets with the destination MAC address of 00e0-fc00-0001, source MAC address of 00e0-fc00-0002, and Layer 2 protocol type of 0x0806, configure the following rule in ACL 4001.<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>acl 4001</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-acl-L2-4001] <strong>rule permit destination-mac 00e0-fc00-0001 source-mac 00e0-fc00-0002 type 0x0806</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-acl-L2-4001] <strong>quit</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
</div>
<div class="p">To reject packets with a specified Layer 2 protocol type, configure a rule in a Layer 2 ACL. For example, to reject packets with the Layer 2 protocol type of 0x8863, configure the following rule in ACL 4001.<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>acl 4001</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-acl-L2-4001] <strong>rule deny type 0x8863</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-acl-L2-4001] <strong>quit</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
</div>
</li><li><p>Configure a packet filtering rule based on the source MAC address segment and inner VLAN IDs.</p>
<div class="p">To reject packets from a specified MAC address segment in a VLAN, configure a rule in a Layer 2 ACL. For example, to reject packets from the source MAC address segment 00e0-fc01-0000 to 00e0-fc01-ffff in VLAN 10, configure the following rule in the Layer 2 ACL <strong>deny-vlan10-mac</strong>.<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>acl name deny-vlan10-mac link</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-acl-L2-deny-vlan10-mac] <strong>rule deny vlan 10 source-mac 00e0-fc01-0000 00e0-fc01-ffff</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-acl-L2-deny-vlan10-mac] <strong>quit</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
</div>
</li></ul>
<h4 class="sectiontitle">Verifying the Configuration</h4><p>Run the <span><a href="cmdqueryname=display+acl+name+all"><b><span class="cmdname">display acl</span></b></a> { <i><span class="varname">link-acl-number</span></i> | <strong><span>name</span></strong> <i><span class="varname">link-acl-name</span></i> | <strong><span>all</span></strong> }</span> command to check the configuration of the Layer 2 ACL.</p>
</div>
<div class="postreq"><a name="EN-US_TASK_0000001176662577__1.3.4"></a><a name="1.3.4"></a><h4 class="sectiontitle">Follow-up Procedure</h4>
<div class="p"><p>Apply the Layer 2 ACL to a service module so that the Layer 2 ACL rules can be delivered and take effect.</p>
</div></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="vrp_acl_cfg_0010.html">Configuring an ACL
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="vrp_acl_cfg_0012.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="vrp_acl_cfg_0014.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>