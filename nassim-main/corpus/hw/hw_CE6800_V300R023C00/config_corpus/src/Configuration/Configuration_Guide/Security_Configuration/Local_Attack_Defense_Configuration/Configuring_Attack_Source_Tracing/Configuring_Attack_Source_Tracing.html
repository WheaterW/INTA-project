
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring Attack Source Tracing">
<meta name="abstract" content="">
<meta name="description" content="">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="galaxy_localattackdefense_cfg_0024.html">
<meta name="DC.Relation" scheme="URI" content="galaxy_localattackdefense_cfg_0025.html">
<meta name="DC.Relation" scheme="URI" content="galaxy_localattackdefense_cfg_0027.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="Local Attack Defense">
<meta name="featuretype" content="Security">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="Local Attack Defense">
<meta name="featuretype" content="Security">
<meta name="featurename" content="Local Attack Defense">
<meta name="featuretype" content="Security">
<meta name="featuretype" content="Security">
<meta name="featuretype" content="Security Protection">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001564116617">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>Configuring Attack Source Tracing</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001564116617"></a><a name="EN-US_TASK_0000001564116617"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring Attack Source Tracing</h1>
<div class="taskbody"><p></p>
<div class="context"><a name="EN-US_TASK_0000001564116617__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>After attack source tracing is configured, the device analyzes packets sent to the CPU to determine if the CPU is under attack. If so, the device traces the attack source and notifies the administrator through logs or alarms, who can then take appropriate measures to defend against the attack source.</p>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001564116617__1.4.2"></a><a name="1.4.2"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Enter the system view.</span><p><pre class="screen"><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></pre>
</p></li><li><span>Create an attack defense policy and enter the attack defense policy view.</span><p><pre class="screen"><a href="cmdqueryname=cpu-defend+policy"><b><span class="cmdname">cpu-defend policy</span></b></a> <i><span class="varname">policy-name</span></i></pre>
</p></li><li><span>Enable attack source tracing.</span><p><pre class="screen"><a href="cmdqueryname=auto-defend+enable"><b><span class="cmdname">auto-defend enable</span></b></a></pre>
</p></li><li><span>Set the rate threshold of attack source tracing.</span><p><pre class="screen"><a href="cmdqueryname=auto-defend+threshold"><b><span class="cmdname">auto-defend threshold</span></b></a> <i><span class="varname">threshold-value</span></i></pre>
</p></li><li><span>Set the packet sampling ratio for attack source tracing.</span><p><pre class="screen"><a href="cmdqueryname=auto-defend+attack-packet+sample"><b><span class="cmdname">auto-defend attack-packet sample</span></b></a> <i><span class="varname">sample-value</span></i></pre>
</p></li><li><span>Specify the type of packets to which attack source tracing is applied.</span><p><pre class="screen"><a href="cmdqueryname=auto-defend+protocol"><b><span class="cmdname">auto-defend protocol</span></b></a> { { <strong><span>arp</span></strong> | <strong><span>icmp</span></strong> | <strong><span>dhcp</span></strong> | <strong><span>ttl-expired</span></strong> | <strong><span>tcp</span></strong> | <strong><span>udp</span></strong> | <strong><span>telnet</span></strong> | <a href="cmdqueryname=dhcpv6"><b><span class="cmdname">dhcpv6</span></b></a> | <strong><span>dns</span></strong> | <strong><span>nd</span></strong> | <strong><span>icmpv6</span></strong> | <strong><span>tcpv6</span></strong> | <strong><strong><span>igmp</span></strong></strong> | <strong><strong><span>mld</span></strong></strong> } <sup>*</sup> | <strong><span>all</span></strong> }</pre>
<div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The CE6885-LL in low latency mode does not support nd, icmpv6, dhcpv6, mld, or tcpv6.</p>
</div></div>
</p></li><li><span>Set the attack source tracing mode.</span><p><pre class="screen"><a href="cmdqueryname=auto-defend+trace-type"><b><span class="cmdname">auto-defend trace-type</span></b></a> { <strong><span>source-mac</span></strong> | <strong><span>source-ip</span></strong> | <strong><span>source-portvlan</span></strong> } <sup>*</sup></pre>
<p>The source tracing modes are listed in descending order of priority as follows: MAC address-based &gt; IP address-based &gt; interface- and VLAN-based. If multiple source tracing modes are configured, the configured modes take effect according to this order of priorities.</p>
</p></li><li><span>(Optional) Configure a whitelist for attack source tracing.</span><p><pre class="screen"><a href="cmdqueryname=auto-defend+whitelist"><b><span class="cmdname">auto-defend whitelist</span></b></a> <i><span class="varname">whitelist-id</span></i> { <strong><span>acl</span></strong> <i><span class="varname">acl-number</span></i> | <strong><span>acl</span></strong> <strong><span>ipv6</span></strong> <i><span class="varname">ipv6-acl-number</span></i> | <strong><span>interface</span></strong> <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i> }</pre>
<div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The CE6885-LL in low latency mode does not support <strong>ipv6</strong> <em>ipv6-acl-number</em>.</p>
</div></div>
<p>By default, no whitelist is configured for attack source tracing.</p>
<div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Note the following when configuring an ACL-based whitelist for attack source tracing:</p>
<ul><li>Before referencing an ACL in a whitelist, create the ACL and configure rules. If an ACL has no rule, the whitelist that references the ACL does not take effect.</li><li>The ACL referenced can be a basic ACL, advanced ACL, Layer 2 ACL, basic ACL6, or advanced ACL6.</li><li>All packets matching an ACL referenced by a whitelist are considered legitimate, and will not be source-traced or punished regardless of whether the ACL rule is permit or deny.</li><li>If an ACL rule is defined by a protocol, ensure that the attack source tracing function supports this protocol.</li><li>Insufficient ACL resources may lead to an ineffective whitelist.</li></ul>
</div></div>
</p></li><li><span>(Optional) Configure the event reporting function for attack source tracing.</span><ol type="a"><li class="substepexpand"><span>Enable the event reporting function for attack source tracing.</span><p><pre class="screen"><a href="cmdqueryname=auto-defend+alarm+enable"><b><span class="cmdname">auto-defend alarm enable</span></b></a></pre>
<p>By default, the event reporting function for attack source tracing is disabled.</p>
</p></li><li class="substepexpand"><span>Configure the rate threshold for triggering event reporting in attack source tracing.</span><p><pre class="screen"><a href="cmdqueryname=auto-defend+alarm+threshold"><b><span class="cmdname">auto-defend alarm threshold</span></b></a> <i><span class="varname">alarm-threshold</span></i></pre>
</p></li></ol>
</li><li><span>Configure the punishment action for attack source tracing.</span><p><pre class="screen"><a href="cmdqueryname=auto-defend+action"><b><span class="cmdname">auto-defend action</span></b></a> { <strong><span>deny</span></strong> [ <strong><span>timeout</span></strong> <i><span class="varname">timeout-num</span></i> ] | <strong><span>error-down</span></strong> }</pre>
<div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><ul><li>A device can set the status of an interface to error-down when it detects a fault on the interface. An interface in error-down state cannot receive or send packets and the interface indicator is off.<p>If the punishment action results in the interface that receives attack packets being set to the error-down state, services of authorized users on this interface will be interrupted. Exercise caution when setting this punishment action.</p>
</li><li>The device does not take punishment actions on whitelisted users.</li></ul>
</div></div>
</p></li><li><span>Return to the system view.</span><p><pre class="screen" id="EN-US_TASK_0000001564116617__en-us_task_0000001563756889_screen1060848102417"><a href="cmdqueryname=quit"><b><span class="cmdname" id="EN-US_TASK_0000001564116617__en-us_task_0000001563756889_cmdname16697145422412">quit</span></b></a></pre>
</p></li><li><span>Apply the attack defense policy.</span><p><ul id="EN-US_TASK_0000001564116617__en-us_task_0000001563756889_ul187417318538"><li id="EN-US_TASK_0000001564116617__en-us_task_0000001563756889_li6741173125310">Configure attack defense policies in batches.<pre class="screen" id="EN-US_TASK_0000001564116617__en-us_task_0000001563756889_screen1214533413538"><a href="cmdqueryname=cpu-defend-policy"><b><span class="cmdname" id="EN-US_TASK_0000001564116617__en-us_task_0000001563756889_cmdname221512514546">cpu-defend-policy</span></b></a> <em id="EN-US_TASK_0000001564116617__en-us_task_0000001563756889_i1821585165416">policy-name</em> <strong id="EN-US_TASK_0000001564116617__en-us_task_0000001563756889_b17956929185412">batch</strong><strong id="EN-US_TASK_0000001564116617__en-us_task_0000001563756889_b7956629185418"> slot</strong> { <em id="EN-US_TASK_0000001564116617__en-us_task_0000001563756889_i1795682955418">start-slot</em> [ <strong id="EN-US_TASK_0000001564116617__en-us_task_0000001563756889_b1595602965419">to</strong><em id="EN-US_TASK_0000001564116617__en-us_task_0000001563756889_i0956729135411"> end-slot</em> ] } &amp;&lt;1-12&gt;</pre>
</li><li id="EN-US_TASK_0000001564116617__en-us_task_0000001563756889_li20136134065316">Configure an attack defense policy separately.<pre class="screen" id="EN-US_TASK_0000001564116617__en-us_task_0000001563756889_screen07011461574"><a href="cmdqueryname=cpu-defend-policy"><b><span class="cmdname" id="EN-US_TASK_0000001564116617__en-us_task_0000001563756889_cmdname15559175725716">cpu-defend-policy</span></b></a> <em id="EN-US_TASK_0000001564116617__en-us_task_0000001563756889_i555915713574">policy-name</em> [ <strong id="EN-US_TASK_0000001564116617__en-us_task_0000001563756889_b4233161617221">slot</strong><em id="EN-US_TASK_0000001564116617__en-us_task_0000001563756889_i13233516152214"> slot-id</em> ]</pre>
</li></ul>
<p id="EN-US_TASK_0000001564116617__en-us_task_0000001563756889_p8122345193912">After an attack defense policy is created, you must apply the policy in the system view. Otherwise, the policy does not take effect.</p>
</p></li><li><span>Commit the configuration.</span><p><pre class="screen" id="EN-US_TASK_0000001564116617__en-us_task_0228023023_screen163801330213"><a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001564116617__en-us_task_0228023023_en-us_concept_0141113565_cmdname1667501373175340">commit</span></b></a></pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001564116617__1.4.3"></a><a name="1.4.3"></a><h4 class="sectiontitle">Example</h4><p>In the attack defense policy named <strong>test</strong>, enable attack source tracing; and set the rate threshold to 200 pps, sampling ratio to 7, attack source tracing mode to source IP address-based, and punishment action to discarding attack packets.</p>
<pre class="screen">&lt;HUAWEI&gt; <strong>system-view</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>HUAWEI] <a href="cmdqueryname=cpu-defend+policy"><b><span class="cmdname">cpu-defend policy</span></b></a> <strong>test</strong>
[*HUAWEI-cpu-defend-policy-test] <a href="cmdqueryname=auto-defend+enable"><b><span class="cmdname">auto-defend enable</span></b></a>
[*HUAWEI-cpu-defend-policy-test] <strong><a href="cmdqueryname=auto-defend+threshold"><b><span class="cmdname">auto-defend threshold</span></b></a> 200</strong>
[*HUAWEI-cpu-defend-policy-test] <a href="cmdqueryname=auto-defend+attack-packet+sample"><b><span class="cmdname">auto-defend attack-packet sample</span></b></a><strong> 7</strong>
[*HUAWEI-cpu-defend-policy-test] <a href="cmdqueryname=auto-defend+trace-type"><b><span class="cmdname">auto-defend trace-type</span></b></a> <strong>source-ip</strong>
[*HUAWEI-cpu-defend-policy-test] <strong><a href="cmdqueryname=auto-defend+action"><b><span class="cmdname">auto-defend action</span></b></a></strong> <strong><span>deny</span></strong>
[*HUAWEI-cpu-defend-policy-test] <strong>quit</strong>
[*HUAWEI] <a href="cmdqueryname=cpu-defend-policy"><b><span class="cmdname">cpu-defend-policy</span></b></a> <strong>test</strong>
[*HUAWEI] <strong>commit</strong></pre>
</div>
<div class="postreq"><a name="EN-US_TASK_0000001564116617__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Follow-up Procedure</h4>
<div class="p"><p>If the punishment action for attack source tracing is set to error-down, the device sets the status of the interface that receives attack packets to down after identifying the attack source. After the interface is set to down, you are advised to eliminate attacks before recovering the interface to the up state.</p>

<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" frame="border" border="1" rules="all"><caption><b>Table 1 </b>Methods of recovering an interface to the up state</caption><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="13.041304130413039%" id="mcps1.4.4.2.2.4.1.1" liSelected="liSelected"><p>Method</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="40.87408740874087%" id="mcps1.4.4.2.2.4.1.2" liSelected="liSelected"><p>Application Scenario</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="46.084608460846084%" id="mcps1.4.4.2.2.4.1.3" liSelected="liSelected"><p>Procedure</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" valign="top" width="13.041304130413039%" headers="mcps1.4.4.2.2.4.1.1 "><p>Manual recovery</p>
</td>
<td class="cellrowborder" valign="top" width="40.87408740874087%" headers="mcps1.4.4.2.2.4.1.2 "><ul><li>A small number of interfaces are expected to go down.</li><li>The interface has been set to down.</li></ul>
</td>
<td class="cellrowborder" valign="top" width="46.084608460846084%" headers="mcps1.4.4.2.2.4.1.3 "><p>Run the <strong>shutdown</strong> and <strong>undo shutdown</strong> commands, or run the <strong>restart</strong> command in the interface view to restart the interface.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="13.041304130413039%" headers="mcps1.4.4.2.2.4.1.1 "><p>Automatic recovery</p>
</td>
<td class="cellrowborder" valign="top" width="40.87408740874087%" headers="mcps1.4.4.2.2.4.1.2 "><ul><li>A large number of interfaces are expected to go down. Manually restoring the interface status one by one is time-consuming and may result in omissions.</li><li>The interface has not been set to down. This mode does not take effect on interfaces that are already in down state.</li></ul>
</td>
<td class="cellrowborder" valign="top" width="46.084608460846084%" headers="mcps1.4.4.2.2.4.1.3 "><p>Run the <strong>error-down auto-recovery</strong> <strong>cause auto-defend</strong> <strong>interval</strong> command in the system view to enable automatic interface recovery after a specified delay. You can run the <strong>display error-down recovery</strong> command to view information about automatic interface recovery.</p>
</td>
</tr>
</tbody>
</table>
</div>
</div></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="galaxy_localattackdefense_cfg_0024.html">Configuring Attack Source Tracing
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="galaxy_localattackdefense_cfg_0025.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="galaxy_localattackdefense_cfg_0027.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>