
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring BGP BMP">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="vrp_bgp_cfg_0121.html">
<meta name="DC.Relation" scheme="URI" content="vrp_bgp_cfg_0122.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing">
<meta name="featuretype" content="IP Routing">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001130783952">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>Configuring BGP BMP</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001130783952"></a><a name="EN-US_TASK_0000001130783952"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring BGP BMP</h1>
<div class="taskbody"><div class="prereq" style="margin-left:0"><a name="EN-US_TASK_0000001130783952__1.3.1"></a><a name="1.3.1"></a><h4 class="sectiontitle">Prerequisites</h4>
<div class="p"><p>Before configuring the BGP Monitoring Protocol (BMP), you have completed the following task:</p>
<ul><li><a href="vrp_bgp_cfg_0014.html">Configure basic BGP functions</a>.</li></ul>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001130783952__1.3.2"></a><a name="1.3.2"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>BMP is mainly used in networking scenarios where monitoring servers exist and need to monitor the BGP running status and trace data of BGP routes on network devices in real time. Without BMP, only manual query can be used to obtain the BGP running status and trace data of BGP routes. The emergence of BMP eliminates this restriction and significantly improves network monitoring efficiency.</p>
</div></div>
<div class="steps-unordered"><a name="EN-US_TASK_0000001130783952__1.3.3"></a><a name="1.3.3"></a><h4 class="sectiontitle">Procedure</h4>
<ul><li><span>Configure BMP to report the BGP running status to a monitoring server.</span><ol><li class="substepexpand"><span>Enter the system view.</span><p><pre class="screen"><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></pre>
</p></li><li class="substepexpand"><span>Start BMP and enter the BMP view.</span><p><pre class="screen"><a href="cmdqueryname=bmp"><b><span class="cmdname">bmp</span></b></a></pre>
</p></li><li class="substepexpand"><span>(Optional) Configure an interval at which the BMP device sends BGP running statistics to a monitoring server.</span><p><pre class="screen"><a href="cmdqueryname=statistics-timer"><b><span class="cmdname">statistics-timer</span></b></a> <i><span class="varname">time</span></i></pre>
<p>You can configure the interval at which the BMP device sends BGP running statistics to a monitoring server based on BGP stability requirements. In most cases, a short interval is required on a network with high quality requirements, but more bandwidth resources will be consumed because the device sends statistics frequently.</p>
<p>By default, the interval at which the BMP device reports BGP running statistics to a monitoring server is 3600s. Using the default interval is recommended.</p>
</p></li><li class="substepexpand"><span>Configure an IPv4 session address for the TCP connection to be established between the BMP device and the monitoring server.</span><p><pre class="screen"><a href="cmdqueryname=bmp-session+vpn-instance+alias"><b><span class="cmdname">bmp-session</span></b></a> [ <strong><span>vpn-instance</span></strong> <i><span class="varname">vrf-name</span></i> ] <i><span class="varname">ipv4-address</span></i> [ <strong><span>alias</span></strong> <i><span class="varname">alias-name</span></i> ]</pre>
<p><strong><span>alias</span></strong> <i><span class="varname">alias-name</span></i> specifies a session alias. If the device needs to establish TCP connections with monitoring servers that have the same destination IP address but different destination port numbers, specify different values for the <strong><span>alias</span></strong> <i><span class="varname">alias-name</span></i> parameter to differentiate the connections.</p>
</p></li><li class="substepexpand"><span>Configure the device to send statistics about routes of specific types to the monitoring server.</span><p><ul><li>Configure the device to send statistics about RIB-in routes (all received routes or only accepted routes) from BGP peers in a specified address family.<ol type="a"><li>Run any of the following commands as required to enter the BMP-Monitor view and configure BMP to monitor the BGP running status of BGP peers.<div class="p">Enter the BMP-Monitor view and configure BMP to monitor the running status of all BGP peers in the public network address family.<pre class="screen"><a href="cmdqueryname=monitor+public"><b><span class="cmdname">monitor</span></b></a> <strong><span>public</span></strong> </pre>
</div>
<p>Enter the BMP-Monitor view and configure BMP to monitor the running status of a specified BGP peer in the public network address family.</p>
<pre class="screen"><a href="cmdqueryname=monitor+peer"><b><span class="cmdname">monitor</span></b></a> <strong><span>peer</span></strong> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">ipv6-address</span></i> } </pre>
<p>Enter the BMP-Monitor view and configure BMP to monitor the running status of all BGP peers in VPN address families.</p>
<pre class="screen"><a href="cmdqueryname=monitor+all-vpn-instance"><b><span class="cmdname">monitor all-vpn-instance</span></b></a></pre>
<p>Enter the BMP-Monitor view and configure BMP to monitor the running status of a specified BGP peer in a specified VPN instance.</p>
<pre class="screen"><a href="cmdqueryname=monitor+vpn-instance+peer"><b><span class="cmdname">monitor vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i> <strong><span>peer</span></strong> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">ipv6-address</span></i> }</pre>
<p>Enter the BMP-Monitor view and configure BMP to monitor the running status of all BGP peers in a specified VPN instance.</p>
<pre class="screen"><a href="cmdqueryname=monitor+vpn-instance"><b><span class="cmdname">monitor vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i></pre>
</li><li><p>Configure the BMP device to send statistics about RIB-in routes (all received routes or only accepted routes) of BGP peers in a specified address family to the monitoring server.</p>
<pre class="screen"><a href="cmdqueryname=route-mode+ipv4-family+unicast+adj-rib-in+pre-policy+post-policy"><b><span class="cmdname">route-mode</span></b></a> <strong><span>ipv4-family</span></strong> <strong><span>unicast</span></strong> <strong><span>adj-rib-in</span></strong> { <strong><span>pre-policy</span></strong> | <strong><span>post-policy</span></strong> }</pre>
<p>To configure the device to send statistics about all received routes to the monitoring server, specify <strong><span>pre-policy</span></strong> in the command. To configure the device to send statistics about only the routes that match the import policy (those delivered to the routing table) to the monitoring server, specify <strong><span>post-policy</span></strong> in the command.</p>
<div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>If the <strong><span>pre-policy</span></strong> parameter is specified in the command, run the <a href="cmdqueryname=keep-all-routes"><b><span class="cmdname">keep-all-routes</span></b></a> command in the BGP view to save information about routes carried in BGP Update messages that are received from all BGP peers or peer groups after BGP connections are established. Alternatively, run the <a href="cmdqueryname=peer+keep-all-routes"><b><span class="cmdname">peer keep-all-routes</span></b></a> command to save information about routes carried in the BGP Update messages that are received from a specified BGP peer or peer group after the BGP connection is established.</p>
</div></div>
</li></ol>
</li><li>Configure the BMP device to send statistics about RIB-out routes of BGP peers in a specified address family to the monitoring server.<ol type="a"><li>Run any of the following commands as required to enter the BMP-Monitor view and configure BMP to monitor the BGP running status of BGP peers.<div class="p">Enter the BMP-Monitor view and configure BMP to monitor the running status of all BGP peers in the public network address family.<pre class="screen"><a href="cmdqueryname=monitor+public"><b><span class="cmdname">monitor</span></b></a> <strong><span>public</span></strong> </pre>
</div>
<p>Enter the BMP-Monitor view and configure BMP to monitor the running status of a specified BGP peer in the public network address family.</p>
<pre class="screen"><a href="cmdqueryname=monitor+peer"><b><span class="cmdname">monitor</span></b></a> <strong><span>peer</span></strong> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">ipv6-address</span></i> } </pre>
<p>Enter the BMP-Monitor view and configure BMP to monitor the running status of all BGP peers in VPN address families.</p>
<pre class="screen"><a href="cmdqueryname=monitor+all-vpn-instance"><b><span class="cmdname">monitor all-vpn-instance</span></b></a></pre>
<p>Enter the BMP-Monitor view and configure BMP to monitor the running status of a specified BGP peer in a specified VPN instance.</p>
<pre class="screen"><a href="cmdqueryname=monitor+vpn-instance+peer"><b><span class="cmdname">monitor vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i> <strong><span>peer</span></strong> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">ipv6-address</span></i> }</pre>
<p>Enter the BMP-Monitor view and configure BMP to monitor the running status of all BGP peers in a specified VPN instance.</p>
<pre class="screen"><a href="cmdqueryname=monitor+vpn-instance"><b><span class="cmdname">monitor vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i></pre>
</li><li>Configure the BMP device to send statistics about RIB-out routes of BGP peers in a specified address family to the monitoring server.<pre class="screen"><a href="cmdqueryname=route-mode+ipv4-family+unicast+adj-rib-out+pre-policy"><b><span class="cmdname">route-mode</span></b></a> <strong><span>ipv4-family</span></strong> <strong><span>unicast</span></strong> <strong><span>adj-rib-out</span></strong> { <strong><span>pre-policy</span></strong> | <strong><span>post-policy</span></strong> }</pre>
<p>If you want the monitoring server to monitor all the routes to be advertised, regardless of whether they match the export policy, specify <strong><span>pre-policy</span></strong> in the command. If you want the monitoring server to monitor only the routes that match the export policy, specify <strong><span>post-policy</span></strong> in the command.</p>
</li></ol>
</li><li>Configure the device to send statistics about Local-RIB routes of BGP peers in a specified address family.<ol type="a"><li>Enter the BMP-Monitor view and configure BMP to monitor the running status of BGP peers.<div class="p">Enter the BMP-Monitor view and configure BMP to monitor the running status of all BGP peers in the public network address family.<pre class="screen"><a href="cmdqueryname=monitor+public"><b><span class="cmdname">monitor</span></b></a> <strong><span>public</span></strong> </pre>
</div>
<div class="p">Enter the BMP-Monitor view and configure BMP to monitor the running status of all BGP peers in a specified VPN instance.<pre class="screen"><a href="cmdqueryname=monitor+vpn-instance"><b><span class="cmdname">monitor vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i></pre>
</div>
</li><li>Configure the BMP device to send statistics about Local-RIB routes of BGP peers in a specified address family to the monitoring server.<pre class="screen"><a href="cmdqueryname=route-mode+ipv4-family+unicast+local-rib+add-path+all"><b><span class="cmdname">route-mode</span></b></a> <strong><span>ipv4-family</span></strong> <strong><span>unicast</span></strong> <strong><span>local-rib</span></strong> [ <strong><span>add-path</span></strong> | <strong><span>all</span></strong> ] [ <strong><span>path-marking</span></strong> ]</pre>
</li></ol>
</li></ul>
</p></li><li class="substepexpand"><span>Return to the BMP session view.</span><p><pre class="screen"><a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></pre>
</p></li><li class="substepexpand"><span>Configure parameters for a TCP connection to be established between the device and monitoring server.</span><p><pre class="screen"><a href="cmdqueryname=tcp+connect+port+password+md5+keychain"><b><span class="cmdname">tcp</span></b></a> <strong><span>connect</span></strong> <strong><span>port</span></strong> <i><span class="varname">port-number</span></i> [ <strong><span>password md5</span></strong> <i><span class="varname">cipher-password</span></i> | <strong><span>keychain</span></strong> <i><span class="varname">keychain-name</span></i> ]</pre>
<div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>For security purposes, MD5 is not recommended. If MD5 is required, run the <a href="cmdqueryname=install+feature-software+WEAKEA"><b><span class="cmdname">install feature-software WEAKEA</span></b></a> command first to install the weak security algorithm/protocol feature package WEAKEA.</p>
</div></div>
<div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><ul><li><p>It is recommended that the password be at least eight characters long and contain at least two of the following character types: uppercase letters, lowercase letters, digits, and special characters.</p>
</li><li><p>To prevent high security risks, you are advised to select the ciphertext mode. To ensure device security, change the password periodically.</p>
</li></ul>
</div></div>
</p></li><li class="substepexpand"><span>(Optional) Configure an SSL policy for BMP.</span><p><pre class="screen"><a href="cmdqueryname=ssl-policy+name"><b><span class="cmdname">ssl-policy name</span></b></a> <i><span class="varname">policy-name</span></i></pre>
<div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Ensure that the specified SSL policy has been created using the <a href="cmdqueryname=ssl+policy"><b><span class="cmdname">ssl policy</span></b></a> <i><span class="varname">policy-name</span></i> command in the system view.</p>
</div></div>
</p></li><li class="substepexpand"><span>(Optional) Configure a source interface for sending BMP messages.</span><p><pre class="screen"><a href="cmdqueryname=connect-interface"><b><span class="cmdname">connect-interface</span></b></a> { <i><span class="varname">interface-name</span></i> | <i><span class="varname">ipv4-source-address</span></i> | <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i> | <i><span class="varname">interface-name ipv4-source-address</span></i> | <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i> <i><span class="varname">ipv4-source-address</span></i> }</pre>
</p></li><li class="substepexpand"><span>Commit the configuration.</span><p><pre class="screen" id="EN-US_TASK_0000001130783952__en-us_task_0234857734_screen14848162118611"><a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001130783952__en-us_task_0234857734_cmdname1784862115612">commit</span></b></a></pre>
</p></li></ol>
</li><li><span>Configure BMP to report the trace data of IPv4 public network unicast routes to the monitoring server.</span><ol><li class="substepexpand"><span>Enter the system view.</span><p><pre class="screen"><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></pre>
</p></li><li class="substepexpand"><span>Start BMP and enter the BMP view.</span><p><pre class="screen"><a href="cmdqueryname=bmp"><b><span class="cmdname">bmp</span></b></a></pre>
</p></li><li class="substepexpand"><span>Configure an IPv4 session address for the TCP connection to be established between the BMP device and the monitoring server.</span><p><pre class="screen"><a href="cmdqueryname=bmp-session+vpn-instance+alias"><b><span class="cmdname">bmp-session</span></b></a> [ <strong><span>vpn-instance</span></strong> <i><span class="varname">vrf-name</span></i> ] <i><span class="varname">ipv4-address</span></i> [ <strong><span>alias</span></strong> <i><span class="varname">alias-name</span></i> ]</pre>
</p><p><p><strong><span>alias</span></strong> <i><span class="varname">alias-name</span></i> specifies a session alias. If the device needs to establish TCP connections with monitoring servers that have the same destination IP address but different destination port numbers, specify different values for the <strong><span>alias</span></strong> <i><span class="varname">alias-name</span></i> parameter to differentiate the connections.</p>
</p></li><li class="substepexpand"><span>Create and enter the BMP session IPv4 unicast view.</span><p><pre class="screen"><a href="cmdqueryname=ipv4+unicast"><b><span class="cmdname">ipv4 unicast</span></b></a></pre>
</p></li><li class="substepexpand"><span>Configure BMP to monitor the trace data of all IPv4 public network unicast routes or the trace data of a specified IPv4 public network unicast route.</span><p><pre class="screen"><a href="cmdqueryname=trace-prefix+all"><b><span class="cmdname">trace-prefix all</span></b></a> or <a href="cmdqueryname=trace-prefix"><b><span class="cmdname">trace-prefix</span></b></a> <i><span class="varname">ipv4-address</span></i> <i><span class="varname">mask-length</span></i></pre>
</p></li><li class="substepexpand"><span>Commit the configuration.</span><p><pre class="screen" id="EN-US_TASK_0000001130783952__en-us_task_0234857734_screen14848162118611_1"><a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001130783952__en-us_task_0234857734_cmdname1784862115612_1">commit</span></b></a></pre>
</p></li></ol>
</li><li><span>Configure BMP to report the trace data of VPNv4 routes and the IPv4 VPN unicast routes to the monitoring server.</span><ol><li class="substepexpand"><span>Enter the system view.</span><p><pre class="screen"><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></pre>
</p></li><li class="substepexpand"><span>Start BMP and enter the BMP view.</span><p><pre class="screen"><a href="cmdqueryname=bmp"><b><span class="cmdname">bmp</span></b></a></pre>
</p></li><li class="substepexpand"><span>Configure an IPv4 session address for the TCP connection to be established between the BMP device and the monitoring server.</span><p><pre class="screen"><a href="cmdqueryname=bmp-session+vpn-instance+alias"><b><span class="cmdname">bmp-session</span></b></a> [ <strong><span>vpn-instance</span></strong> <i><span class="varname">vrf-name</span></i> ] <i><span class="varname">ipv4-address</span></i> [ <strong><span>alias</span></strong> <i><span class="varname">alias-name</span></i> ]</pre>
</p><p><p><strong><span>alias</span></strong> <i><span class="varname">alias-name</span></i> specifies a session alias. If the device needs to establish TCP connections with monitoring servers that have the same destination IP address but different destination port numbers, specify different values for the <strong><span>alias</span></strong> <i><span class="varname">alias-name</span></i> parameter to differentiate the connections.</p>
</p></li><li class="substepexpand"><span>Create and enter the BMP session IPv4 VPN view.</span><p><pre class="screen"><a href="cmdqueryname=ipv4+vpn"><b><span class="cmdname">ipv4 vpn</span></b></a></pre>
</p></li><li class="substepexpand"><span>Configure BMP to monitor the trace data of all VPNv4 routes and IPv4 VPN unicast routes based on a specified RD. Alternatively, configure BMP to monitor the trace data of a VPNv4 route and the IPv4 VPN unicast route with a specified RD and route prefix.</span><p><pre class="screen"><a href="cmdqueryname=trace-prefix+route-distinguisher+all"><b><span class="cmdname">trace-prefix route-distinguisher all</span></b></a> or <a href="cmdqueryname=trace-prefix+route-distinguisher"><b><span class="cmdname">trace-prefix route-distinguisher</span></b></a> <i><span class="varname">vrfRD</span></i> <i><span class="varname">ipv4-address</span></i> <i><span class="varname">mask-length</span></i></pre>
</p></li><li class="substepexpand"><span>Commit the configuration.</span><p><pre class="screen" id="EN-US_TASK_0000001130783952__en-us_task_0234857734_screen14848162118611_2"><a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001130783952__en-us_task_0234857734_cmdname1784862115612_2">commit</span></b></a></pre>
</p></li></ol>
</li></ul></div>
<div class="example"><a name="EN-US_TASK_0000001130783952__1.3.4"></a><a name="1.3.4"></a><h4 class="sectiontitle">Verifying the Configuration</h4><div class="p">After the configuration is complete, verify it.<ul><li>Run the <a href="cmdqueryname=display+bmp+session"><b><span class="cmdname">display bmp session</span></b></a> [ <strong><span>vpn-instance</span></strong> <i><span class="varname">vrf-name</span></i> ] [ <i><span class="varname">ipv4-address</span></i> [ <strong><span>alias</span></strong> <i><span class="varname">alias-name</span></i> ] <strong><span>verbose</span></strong> ] command to check the configuration of the BMP session.</li><li>Run the <a href="cmdqueryname=display+bgp+bmp-monitor"><b><span class="cmdname">display bgp bmp-monitor</span></b></a> { <strong><span>all</span></strong> | <strong><span>ipv4</span></strong> <i><span class="varname">ipv4-address</span></i> } command to check information about BGP peers monitored through BMP in all address families or in a specified address family.</li><li>Run the <b><span class="cmdname">display debugging bmp</span></b> command to check information about enabled BMP debugging functions.</li><li>Run the <a href="cmdqueryname=display+default-parameter+bmp"><b><span class="cmdname">display default-parameter bmp</span></b></a> command to view default BMP configurations.</li></ul>
</div>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="vrp_bgp_cfg_0121.html">Configuring BGP BMP
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="vrp_bgp_cfg_0122.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>
</body>
</html>