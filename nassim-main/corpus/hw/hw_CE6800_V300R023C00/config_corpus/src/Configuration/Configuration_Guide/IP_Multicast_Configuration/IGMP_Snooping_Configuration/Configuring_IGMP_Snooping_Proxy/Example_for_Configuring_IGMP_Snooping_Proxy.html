
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring IGMP Snooping Proxy">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../vrp/vrp_l2mc_cfg_0022.html">
<meta name="DC.Relation" scheme="URI" content="../vrp/vrp_l2mc_cfg_0027.html">
<meta name="DC.Relation" scheme="URI" content="../vrp/vrp_l2mc_cfg_0605.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="IGMP Snooping">
<meta name="featuretype" content="IP Multicast">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="IGMP Snooping">
<meta name="featuretype" content="IP Multicast">
<meta name="featurename" content="IGMP Snooping">
<meta name="featuretype" content="IP Multicast">
<meta name="featuretype" content="IP Multicast">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001176661659">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="../public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring IGMP Snooping Proxy</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001176661659"></a><a name="EN-US_TASK_0000001176661659"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring IGMP Snooping Proxy</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001176661659__1.3.1"></a><a name="1.3.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p><a href="#EN-US_TASK_0000001176661659__fig_dc_cfg_vxlan_cfgcase_000401">Figure 1</a> shows an IPv4 multicast network on which a router (Router) runs IGMPv2 and connects to a user network through a Layer 2 device (Device). There are a large number of receiver hosts on the network. The administrator wants to ensure that IGMP message exchange does not burden Router while also ensuring that data receiving remains unaffected. To meet these requirements, configure IGMP snooping proxy on <span class="keyword">Device</span>.</p>
<div class="fignone" id="EN-US_TASK_0000001176661659__fig_dc_cfg_vxlan_cfgcase_000401"><a name="EN-US_TASK_0000001176661659__fig_dc_cfg_vxlan_cfgcase_000401"></a><a name="fig_dc_cfg_vxlan_cfgcase_000401"></a><span class="figcap"><b>Figure 1 </b>Network diagram of IGMP snooping proxy</span><div class="note"><img src="../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface1, interface2, and interface3 represent <span>100GE</span><span>1/0/1</span>, <span>100GE</span><span>1/0/2</span>, and <span>100GE</span><span>1/0/3</span>, respectively.</p>
</div></div>
<p><span><img class="vsd" src="figure/en-us_image_0000001130622142.png"></span></p>
<p></p>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001176661659__1.3.2"></a><a name="1.3.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Create a VLAN and add related interfaces to the VLAN.</p>
</li><li><p>Enable IGMP snooping globally and in the VLAN so that users can receive multicast data.</p>
</li><li><p>Configure IGMP snooping proxy to reduce the number of messages exchanged between <span class="keyword">Device</span> and Router.</p>
</li><li><p>Disable <span class="keyword">Device</span> from sending Query messages to the upstream interface, preventing reelection of the IGMP querier.</p>
</li></ol>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001176661659__1.3.3"></a><a name="1.3.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Create a VLAN and add related interfaces to the VLAN.</span><p><pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname Device</strong>
<span>[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></span>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>] <strong>vlan 10</strong>
[<span><span class="keyword">*</span></span><span class="keyword">Device</span>-vlan10] <strong>quit</strong>
[<span><span class="keyword">*</span></span><span class="keyword">Device</span>] <strong>interface <span>100ge</span> <span>1/0/1</span></strong>
[<span><span class="keyword">*</span></span><span class="keyword">Device</span>-<span>100GE</span><span>1/0/1</span>]<strong> port link-type access</strong>
[<span><span class="keyword">*</span></span><span class="keyword">Device</span>-<span>100GE</span><span>1/0/1</span>] <strong>port default vlan 10</strong>
[<span><span class="keyword">*</span></span><span class="keyword">Device</span>-<span>100GE</span><span>1/0/1</span>] <strong>quit</strong>
[<span><span class="keyword">*</span></span><span class="keyword">Device</span>] <strong>interface <span>100ge</span> <span>1/0/2</span></strong>
[<span><span class="keyword">*</span></span><span class="keyword">Device</span>-<span>100GE</span><span>1/0/2</span>] <strong>port link-type access</strong>
[<span><span class="keyword">*</span></span><span class="keyword">Device</span>-<span>100GE</span><span>1/0/2</span>] <strong>port default vlan 10</strong>
[<span><span class="keyword">*</span></span><span class="keyword">Device</span>-<span>100GE</span><span>1/0/2</span>] <strong>quit</strong>
[<span><span class="keyword">*</span></span><span class="keyword">Device</span>] <strong>interface <span>100ge</span> <span>1/0/3</span></strong>
[<span><span class="keyword">*</span></span><span class="keyword">Device</span>-<span>100GE</span><span>1/0/3</span>] <strong>port link-type trunk</strong>
[<span><span class="keyword">*</span></span><span class="keyword">Device</span>-<span>100GE</span><span>1/0/3</span>] <strong>port trunk allow-pass vlan 10</strong>
<span>[<span><span class="keyword">*</span></span><span class="keyword">Device</span>-<span>100GE</span><span>1/0/3</span>] <strong>commit</strong></span>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>-<span>100GE</span><span>1/0/3</span>] <strong>quit</strong></pre>
</p></li><li><span>Enable IGMP snooping.</span><p><p># Enable IGMP snooping globally.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>] <strong>igmp snooping enable</strong></pre>
<p># Enable IGMP snooping in VLAN10.</p>
<pre class="screen">[<span><span><span class="keyword">*</span></span></span><span class="keyword">Device</span>] <strong>vlan 10</strong>
[<span><span><span class="keyword">*</span></span></span><span class="keyword">Device</span>-vlan10] <strong>igmp snooping enable</strong>
[<span><span><span class="keyword">*</span></span></span><span class="keyword">Device</span>-vlan10] <strong>commit</strong></pre>
</p><p><p># Specify IGMP snooping v3 so that the device can process IGMP messages of all versions.</p>
<pre class="screen">[<span class="keyword"></span><span class="keyword"></span><span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>-vlan10] <strong>igmp snooping version 3</strong>
[<span class="keyword"></span><span class="keyword"></span><span><span><span class="keyword">*</span></span></span><span class="keyword">Device</span>-vlan10] <strong>commit</strong></pre>
</p></li><li><span>Enable IGMP snooping proxy.</span><p><pre class="screen">[<span class="keyword"></span><span class="keyword"></span><span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>-vlan10] <strong>igmp snooping proxy</strong>
[<span class="keyword"></span><span class="keyword"></span><span><span><span class="keyword">*</span></span></span><span class="keyword">Device</span>-vlan10] <strong>commit</strong>
[<span class="keyword"></span><span class="keyword"></span><span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>-vlan10] <strong>quit</strong></pre>
</p></li><li><span>Disable <span class="keyword">Device</span> from sending Query messages to the upstream interface.</span><p><pre class="screen">[<span class="keyword"></span><span class="keyword"></span><span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>] <strong>interface <span>100ge</span> <span>1/0/3</span></strong>
[<span class="keyword"></span><span class="keyword"></span><span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>-<span>100GE</span><span>1/0/3</span>] <strong>igmp snooping proxy-uplink-port vlan 10</strong>
[<span><span class="keyword">*</span></span><span class="keyword">Device</span>-<span>100GE</span><span>1/0/3</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>-<span>100GE</span><span>1/0/3</span>] <strong>quit</strong></pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001176661659__1.3.4"></a><a name="1.3.4"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p># Check the IGMP message statistics on Device.</p>
<pre class="screen">[<span class="keyword"></span><span class="keyword"></span><span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>] <strong>display igmp snooping statistics vlan 10</strong>
 IGMP Snooping Packets Counter:                                                      
   Statistics for VLAN 10                                                            
     Receive V1 Report:          0                                                   
     Receive V2 Report:          1121                                                
     Receive V3 Report:          0                                                   
     Receive V1 Query:           0                                                   
     Receive V2 Query:           2                                                   
     Receive V3 Query:           0                                                   
     Receive Leave:              0                                                   
     Receive Pim Hello:          4                                                   
     Send Query (S=0):           0                                                   
     Send Query (S!=0):          -                                                   
     <strong>Proxy Send General Query</strong>:             <strong>13</strong>                                     
     Proxy Send Group-Specific Query:         0                                      
     Proxy Send Group-Source-Specific Query:  0  
     Recv Invalid Packet:                     0
     Recv Ignore Packet:                      0
     Foward Report:              1121
     Foward Leave:               0
     Foward Query:               2</pre>
<p>The command output shows that <span class="keyword">Device</span> has sent General Query messages as a proxy device, indicating that the IGMP snooping proxy function has taken effect.</p>
</div>
<div class="postreq"><a name="EN-US_TASK_0000001176661659__1.3.5"></a><a name="1.3.5"></a><h4 class="sectiontitle">Configuration Scripts</h4><ul><li><div class="p">Device<pre class="screen">#
sysname <span class="keyword">Device</span>
#
vlan batch 10
#
igmp snooping enable
#
vlan 10
 igmp snooping enable
 igmp snooping version 3
 igmp snooping proxy
#
interface <span>100GE</span><span>1/0/1</span>
 port default vlan 10
#
interface <span>100GE</span><span>1/0/2</span>
 port default vlan 10
#
interface <span>100GE</span><span>1/0/3</span>
 port link-type trunk
 port trunk allow-pass vlan 10
 igmp snooping proxy-uplink-port vlan 10 
#
return</pre>
</div>
</li></ul>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../vrp/vrp_l2mc_cfg_0022.html">Configuring IGMP Snooping Proxy
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../vrp/vrp_l2mc_cfg_0027.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../vrp/vrp_l2mc_cfg_0605.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>