
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring an IGMP Snooping Querier">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../vrp/vrp_l2mc_cfg_0022.html">
<meta name="DC.Relation" scheme="URI" content="../vrp/vrp_l2mc_cfg_0028.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="IGMP Snooping">
<meta name="featuretype" content="IP Multicast">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="IGMP Snooping">
<meta name="featuretype" content="IP Multicast">
<meta name="featurename" content="IGMP Snooping">
<meta name="featuretype" content="IP Multicast">
<meta name="featuretype" content="IP Multicast">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001847202941">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="../public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring an IGMP Snooping Querier</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001847202941"></a><a name="EN-US_TASK_0000001847202941"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring an IGMP Snooping Querier</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001847202941__1.3.1"></a><a name="1.3.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the pure Layer 2 network shown in <a href="#EN-US_TASK_0000001847202941__fig_dc_cfg_vxlan_cfgcase_000401">Figure 1</a>, multicast sources Source1 and Source2 send multicast data to multicast groups 224.1.1.1 and 225.1.1.1, respectively. <span class="keyword">User</span>A and <span class="keyword">User</span>C want to receive the data of multicast group 224.1.1.1; <span class="keyword">User</span>B and <span class="keyword">User</span>D want to receive data of multicast group 225.1.1.1. All <span class="keyword">device</span>s run IGMP Snooping V2 by default.</p>
<div class="fignone" id="EN-US_TASK_0000001847202941__fig_dc_cfg_vxlan_cfgcase_000401"><a name="EN-US_TASK_0000001847202941__fig_dc_cfg_vxlan_cfgcase_000401"></a><a name="fig_dc_cfg_vxlan_cfgcase_000401"></a><span class="figcap"><b>Figure 1 </b>Network diagram for configuring an IGMP snooping querier</span><div class="note"><img src="../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface1, interface2, interface3, and interface4 represent <span>100GE</span><span>1/0/1</span>, <span>100GE</span><span>1/0/2</span>, <span>100GE</span><span>1/0/3</span>, and <span>100GE</span><span>1/0/4</span>, respectively.</p>
</div></div>
<p><span><img class="vsd" src="figure/en-us_image_0000001847282881.png"></span></p>
<p></p>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001847202941__1.3.2"></a><a name="1.3.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Create a VLAN and add related interfaces to the VLAN.</p>
</li><li><p>Enable IGMP snooping globally and in the VLAN so that users can receive multicast data.</p>
</li><li><p>Configure a device close to the source as the IGMP snooping querier. In this example, <span class="keyword">DeviceA</span> is used.</p>
</li><li><p>Enable all the <span class="keyword">device</span>s to discard unknown multicast packets. In this way, the <span class="keyword">device</span>s will not broadcast multicast data in a VLAN when there is no corresponding Layer 2 forwarding entry.</p>
</li></ol>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001847202941__1.3.3"></a><a name="1.3.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Create a VLAN and add related interfaces to the VLAN.</span><p><p># Configure <span class="keyword">Device</span>A.</p>
</p><p><pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname DeviceA</strong>
<span>[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></span>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>vlan 10</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-vlan10] <strong>quit</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>interface <span>100ge</span> <span>1/0/1</span></strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-<span>100GE</span><span>1/0/1</span>] <strong>port link-type</strong><strong> access</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-<span>100GE</span><span>1/0/1</span>] <strong>port default vlan 10</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-<span>100GE</span><span>1/0/1</span>] <strong>quit</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>interface <span>100ge</span> <span>1/0/2</span></strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-<span>100GE</span><span>1/0/2</span>] <strong>port link-type</strong><strong> access</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-<span>100GE</span><span>1/0/2</span>] <strong>port default vlan 10</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-<span>100GE</span><span>1/0/2</span>] <strong>quit</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>interface <span>100ge</span> <span>1/0/3</span></strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-<span>100GE</span><span>1/0/3</span>] <strong>port link-type trunk</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-<span>100GE</span><span>1/0/3</span>] <strong>port trunk allow-pass vlan 10</strong>
<span>[<span class="keyword">*</span><span class="keyword">Device</span>A-<span>100GE</span><span>1/0/3</span>] <strong>commit</strong></span>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-<span>100GE</span><span>1/0/3</span>] <strong>quit</strong></pre>
<p>The configurations of <span class="keyword">Device</span>B, <span class="keyword">Device</span>C, and <span class="keyword">Device</span>D are similar to the configuration of <span class="keyword">Device</span>A. For detailed configurations, see Configuration Scripts.</p>
</p></li><li><span>Enable IGMP snooping.</span><p><p># Enable IGMP snooping globally on <span class="keyword">Device</span>A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>igmp snooping enable</strong></pre>
<p># Enable IGMP snooping in VLAN 10 on <span class="keyword">Device</span>A.</p>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>vlan 10</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-vlan10] <strong>igmp snooping enable</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-vlan10] <strong>commit</strong></pre>
</p><p><p>The configurations of <span class="keyword">Device</span>B, <span class="keyword">Device</span>C, and <span class="keyword">Device</span>D are similar to the configuration of <span class="keyword">Device</span>A. For detailed configurations, see Configuration Scripts.</p>
</p></li><li><span>Configure <span class="keyword">Device</span>A as the querier.</span><p><pre class="screen">[<span class="keyword"></span><span class="keyword"></span><span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-vlan10] <strong>igmp snooping querier enable</strong>
[<span class="keyword"></span><span class="keyword"></span><span class="keyword">*</span><span class="keyword">Device</span>A-vlan10] <strong>commit</strong></pre>
</p></li><li><span>Enable all the <span class="keyword">device</span>s to discard unknown multicast packets.</span><p><p># Configure <span class="keyword">Device</span>A.</p>
</p><p><pre class="screen">[<span class="keyword"></span><span class="keyword"></span><span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-vlan10]<strong> unknown-multicast discard</strong>
[<span class="keyword"></span><span class="keyword"></span><span class="keyword">*</span><span class="keyword">Device</span>A-vlan10] <strong>commit</strong>
[<span class="keyword"></span><span class="keyword"></span><span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-vlan10] <strong>quit</strong></pre>
<p>The configurations of <span class="keyword">Device</span>B, <span class="keyword">Device</span>C, and <span class="keyword">Device</span>D are similar to the configuration of <span class="keyword">Device</span>A. For detailed configurations, see Configuration Scripts.</p>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001847202941__1.3.4"></a><a name="1.3.4"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p># After the IGMP snooping querier begins to work, all the devices except the IGMP snooping querier receive IGMP General Query messages. Run the <a href="cmdqueryname=display+igmp+snooping+statistics"><b><span class="cmdname">display igmp snooping statistics</span></b></a> command on DeviceB to view IGMP message statistics.</p>
<pre class="screen">[<span class="keyword"></span><span class="keyword"></span><span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>display igmp snooping statistics vlan 10</strong>
 IGMP Snooping Packets Counter:                                                      
   Statistics for VLAN 10                                                            
     Receive V1 Report:          0                                                   
     Receive V2 Report:          32                                                
     Receive V3 Report:          0                                                   
     Receive V1 Query:           0                                                   
     <strong>Receive V2 Query:        30</strong>                                                   
     Receive V3 Query:           0                                                   
     Receive Leave:              0                                                   
     Receive Pim Hello:          0                                                   
     Send Query (S=0):           0                                                   
     Send Query (S!=0):          -                                                   
     Proxy Send General Query:                0                                     
     Proxy Send Group-Specific Query:         0                                      
     Proxy Send Group-Source-Specific Query:  0  
     Recv Invalid Packet:                     0
     Recv Ignore Packet:                      0
     Foward Report:              1121
     Foward Leave:               0
     Foward Query:               2</pre>
<p># Run the <strong><a href="cmdqueryname=display+igmp+snooping"><b><span class="cmdname">display igmp snooping</span></b></a> vlan</strong> command on the querier to check whether a VLAN takes effect on the querier.</p>
<pre class="screen">[<span class="keyword"></span><span class="keyword"></span><span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>display igmp snooping vlan 10</strong>
  IGMP Snooping Information for VLAN 10
     IGMP Snooping is Enabled
     IGMP Version is Set to default 2
     IGMP Query Interval is Set to default 60
     IGMP Max Response Interval is Set to default 10
     IGMP Robustness is Set to default 2
     IGMP Last Member Query Interval is Set to default 1
     IGMP Router Port Aging Interval is Set to 180s or holdtime in hello
     IGMP Filter Group-Policy is Set to default : Permit All
     IGMP Filter IP-Source-Policy is Set to default : Permit All
     IGMP Filter Query IP-Source-Policy is Set to default : Permit All
     IGMP Prompt Leave Disable
     IGMP Router Alert is Not Required
     IGMP Send Router Alert Enable
     IGMP Router Port Learning Enable
     IGMP Proxy Disable
     IGMP Proxy Router Protocol Action is Set to default: Terminate All
     IGMP Report Suppress Disable
     <strong>IGMP Querier Enable</strong>
     IGMP Snooping Explicit-tracking Disable
     IGMP Snooping querier-election Disable
     IGMP ASM-SSM
     IGMP SSM-Mapping Disable
     IGMP Suppress-dynamic-join Disable
     <strong>IGMP Query Source IP Address is 192.168.0.1</strong></pre>
<p># Run the <strong><a href="cmdqueryname=display+igmp+snooping+querier"><b><span class="cmdname">display igmp snooping querier</span></b></a> vlan</strong> command on the querier to view the querier status.</p>
<pre class="screen">[<span class="keyword"></span><span class="keyword"></span><span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>display igmp snooping querier vlan 10</strong>
 VLAN                            Querier-state Querier
---------------------------------------------------------------
 10                              Enable        192.168.0.1</pre>
<p>The command output shows that the source address in a Query message is 192.168.0.1 by default. In some scenarios, this address may be used by other devices. You can run the <a href="cmdqueryname=igmp+snooping+send-query+source-address"><b><span class="cmdname">igmp snooping send-query source-address</span></b></a> command to change the source address of Query messages.</p>
</div>
<div class="postreq"><a name="EN-US_TASK_0000001847202941__1.3.5"></a><a name="1.3.5"></a><h4 class="sectiontitle">Configuration Scripts</h4><ul><li><div class="p">DeviceA<pre class="screen">#
sysname <span class="keyword">Device</span>A
#
vlan batch 10
#
igmp snooping enable
#
vlan 10
 unknown-multicast discard
 igmp snooping enable
 igmp snooping querier enable
#
interface <span>100GE</span><span>1/0/1</span>
 port default vlan 10
#
interface <span>100GE</span><span>1/0/2</span>
 port default vlan 10
#
interface <span>100GE</span><span>1/0/3</span>
 port link-type trunk
 port trunk allow-pass vlan 10
#
return</pre>
</div>
</li></ul>
<ul><li><div class="p">DeviceB<pre class="screen">#
sysname <span class="keyword">Device</span>B
#
vlan batch 10
#
igmp snooping enable
#
vlan 10
 unknown-multicast discard
 igmp snooping enable
#
interface <span>100GE</span><span>1/0/1</span>
 port default vlan 10
#
interface <span>100GE</span><span>1/0/2</span>
 port default vlan 10
#
interface <span>100GE</span><span>1/0/3</span>
 port default vlan 10
#
interface <span>100GE</span><span>1/0/4</span>
 port link-type trunk
 port trunk allow-pass vlan 10
#
return</pre>
</div>
</li></ul>
<ul><li><div class="p">DeviceC<pre class="screen">#
sysname <span class="keyword">Device</span>C
#
vlan batch 10
#
igmp snooping enable
#
vlan 10
 unknown-multicast discard
 igmp snooping enable
#
interface <span>100GE</span><span>1/0/1</span>
 port default vlan 10
#
interface <span>100GE</span><span>1/0/2</span>
 port default vlan 10
#
interface <span>100GE</span><span>1/0/3</span>
 port default vlan 10
#
return</pre>
</div>
</li></ul>
<ul><li><div class="p">DeviceD<pre class="screen">#
sysname <span class="keyword">Device</span>D
#
vlan batch 10
#
igmp snooping enable
#
vlan 10
 unknown-multicast discard
 igmp snooping enable
#
interface <span>100GE</span><span>1/0/1</span>
 port default vlan 10
#
interface <span>100GE</span><span>1/0/2</span>
 port default vlan 10
#
return</pre>
</div>
</li></ul>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../vrp/vrp_l2mc_cfg_0022.html">Configuring IGMP Snooping Proxy
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../vrp/vrp_l2mc_cfg_0028.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>
</body>
</html>