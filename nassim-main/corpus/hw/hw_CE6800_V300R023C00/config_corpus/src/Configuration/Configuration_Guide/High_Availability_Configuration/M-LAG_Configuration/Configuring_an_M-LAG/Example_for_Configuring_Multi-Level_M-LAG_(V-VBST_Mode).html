
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Multi-Level M-LAG (V-VBST Mode)">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../dc/dc_cfg_m-lag_0020.html">
<meta name="DC.Relation" scheme="URI" content="../dc/dc_cfg_m-lag_0081.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="M-LAG">
<meta name="featuretype" content="High Availability">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="M-LAG">
<meta name="featuretype" content="High Availability">
<meta name="featurename" content="M-LAG">
<meta name="featuretype" content="High Availability">
<meta name="featuretype" content="High Availability">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001709917776">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="../public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring Multi-Level M-LAG (V-VBST Mode)</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001709917776"></a><a name="EN-US_TASK_0000001709917776"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Multi-Level M-LAG (V-VBST Mode)</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001709917776__1.3.1"></a><a name="1.3.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>In <a href="#EN-US_TASK_0000001709917776__fig465819107476">Figure 1</a>, multi-level M-LAG ensures reliability, improves link utilization, and expands the network scale in dual-homing mode, meeting customer requirements. In addition, aggregation devices function as dual-active gateways, and core and aggregation devices are cross-connected to ensure device-level reliability. A server is connected to access devices in load balancing or active/standby mode. If load balancing mode is used for server access, you are advised to configure the M-LAG to work in dual-active mode. If active/standby mode is used for server access, you are advised to configure the M-LAG to work in active/standby mode. In this example, the server is connected to access devices in load balancing mode. M-LAG devices at the access and aggregation layers use independent links as DAD links to improve reliability.</p>
<div class="fignone" id="EN-US_TASK_0000001709917776__fig465819107476"><a name="EN-US_TASK_0000001709917776__fig465819107476"></a><a name="fig465819107476"></a><span class="figcap"><b>Figure 1 </b>Network diagram for configuring multi-level M-LAG</span><div class="note"><img src="../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface 1, interface 2, interface 3, interface 4, interface 5, interface 6, and interface 7 represent <span>100GE</span> <span>1/0/1</span>, <span>100GE</span> <span>1/0/2</span>, <span>100GE</span> <span>1/0/3</span>, <span>100GE</span> <span>1/0/4</span>, <span>100GE</span> <span>1/0/5</span>, <span>100GE</span> <span>1/0/6</span>, and <span>100GE</span> <span>1/0/7</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0000002001230506.png" width="NaN" height="NaN"></span></div>

<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" frame="border" border="1" rules="all"><caption><b>Table 1 </b>Data plan</caption><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="25%" id="mcps1.3.1.4.2.5.1.1" liSelected="liSelected"><p>Device Name</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="25%" id="mcps1.3.1.4.2.5.1.2" liSelected="liSelected"><p>Interface</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="25%" id="mcps1.3.1.4.2.5.1.3" liSelected="liSelected"><p>IP Address</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="25%" id="mcps1.3.1.4.2.5.1.4" liSelected="liSelected"><p>Virtual MAC Address</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" valign="top" width="25%" headers="mcps1.3.1.4.2.5.1.1 "><p>DeviceA</p>
</td>
<td class="cellrowborder" valign="top" width="25%" headers="mcps1.3.1.4.2.5.1.2 "><p><span>100GE</span><span>1/0/4</span></p>
</td>
<td class="cellrowborder" valign="top" width="25%" headers="mcps1.3.1.4.2.5.1.3 "><p>10.1.1.1/24</p>
</td>
<td class="cellrowborder" valign="top" width="25%" headers="mcps1.3.1.4.2.5.1.4 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="25%" headers="mcps1.3.1.4.2.5.1.1 "><p>DeviceB</p>
</td>
<td class="cellrowborder" valign="top" width="25%" headers="mcps1.3.1.4.2.5.1.2 "><p><span>100GE</span><span>1/0/4</span></p>
</td>
<td class="cellrowborder" valign="top" width="25%" headers="mcps1.3.1.4.2.5.1.3 "><p>10.1.1.2/24</p>
</td>
<td class="cellrowborder" valign="top" width="25%" headers="mcps1.3.1.4.2.5.1.4 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="5" valign="top" width="25%" headers="mcps1.3.1.4.2.5.1.1 "><p>DeviceC</p>
</td>
<td class="cellrowborder" valign="top" width="25%" headers="mcps1.3.1.4.2.5.1.2 "><p><span>100GE</span><span>1/0/1</span></p>
</td>
<td class="cellrowborder" valign="top" width="25%" headers="mcps1.3.1.4.2.5.1.3 "><p>10.4.1.1/24</p>
</td>
<td class="cellrowborder" valign="top" width="25%" headers="mcps1.3.1.4.2.5.1.4 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.5.1.1 "><p><span>100GE</span><span>1/0/2</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.5.1.2 "><p>10.5.1.1/24</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.5.1.3 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.5.1.1 "><p>VLANIF 11</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.5.1.2 "><p>10.3.1.1/24</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.5.1.3 "><p>0000-5e00-0110</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.5.1.1 "><p>VLANIF 100</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.5.1.2 "><p>10.10.10.1/30</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.5.1.3 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.5.1.1 "><p><span>100GE</span><span>1/0/5</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.5.1.2 "><p>10.2.1.1/24</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.5.1.3 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="5" valign="top" width="25%" headers="mcps1.3.1.4.2.5.1.1 "><p>DeviceD</p>
</td>
<td class="cellrowborder" valign="top" width="25%" headers="mcps1.3.1.4.2.5.1.2 "><p><span>100GE</span><span>1/0/1</span></p>
</td>
<td class="cellrowborder" valign="top" width="25%" headers="mcps1.3.1.4.2.5.1.3 "><p>10.6.1.1/24</p>
</td>
<td class="cellrowborder" valign="top" width="25%" headers="mcps1.3.1.4.2.5.1.4 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.5.1.1 "><p><span>100GE</span><span>1/0/2</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.5.1.2 "><p>10.7.1.1/24</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.5.1.3 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.5.1.1 "><p>VLANIF 11</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.5.1.2 "><p>10.3.1.1/24</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.5.1.3 "><p>0000-5e00-0110</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.5.1.1 "><p>VLANIF 100</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.5.1.2 "><p>10.10.10.2/30</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.5.1.3 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.5.1.1 "><p><span>100GE</span><span>1/0/5</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.5.1.2 "><p>10.2.1.2/24</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.5.1.3 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="2" valign="top" width="25%" headers="mcps1.3.1.4.2.5.1.1 "><p>DeviceE</p>
</td>
<td class="cellrowborder" valign="top" width="25%" headers="mcps1.3.1.4.2.5.1.2 "><p><span>100GE</span><span>1/0/1</span></p>
</td>
<td class="cellrowborder" valign="top" width="25%" headers="mcps1.3.1.4.2.5.1.3 "><p>10.4.1.2/24</p>
</td>
<td class="cellrowborder" valign="top" width="25%" headers="mcps1.3.1.4.2.5.1.4 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.5.1.1 "><p><span>100GE</span><span>1/0/2</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.5.1.2 "><p>10.7.1.2/24</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.5.1.3 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="2" valign="top" width="25%" headers="mcps1.3.1.4.2.5.1.1 "><p>DeviceF</p>
</td>
<td class="cellrowborder" valign="top" width="25%" headers="mcps1.3.1.4.2.5.1.2 "><p><span>100GE</span><span>1/0/1</span></p>
</td>
<td class="cellrowborder" valign="top" width="25%" headers="mcps1.3.1.4.2.5.1.3 "><p>10.6.1.2/24</p>
</td>
<td class="cellrowborder" valign="top" width="25%" headers="mcps1.3.1.4.2.5.1.4 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.5.1.1 "><p><span>100GE</span><span>1/0/2</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.5.1.2 "><p>10.5.1.2/24</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.5.1.3 "><p>-</p>
</td>
</tr>
</tbody>
</table>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001709917776__1.3.2"></a><a name="1.3.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>On DeviceA and DeviceB at the access layer, configure M-LAG, links between the access and aggregation layers, and server access.</p>
</li><li><p>On DeviceC and DeviceD at the aggregation layer, configure M-LAG, links between the aggregation and access layers, Layer 3 gateways, and the egress network.</p>
</li><li><p>On DeviceE and DeviceF at the core layer, configure interface IP addresses and enable OSPF to implement Layer 3 communication with the aggregation layer.</p>
</li></ol>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001709917776__1.3.3"></a><a name="1.3.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure DeviceA and DeviceB at the access layer.</span><ol type="a"><li class="substepexpand"><span>Configure M-LAG.</span><p><p># Configure M-LAG in V-VBST mode.</p>
<p>Configure DeviceA.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname DeviceA</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>stp mode vbst</strong>
[<span class="keyword">*</span>DeviceA] <strong>stp enable</strong>
[<span class="keyword">*</span>DeviceA] <strong>commit</strong></pre>
<p>Configure DeviceB.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname DeviceB</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB] <strong>stp mode vbst</strong>
[<span class="keyword">*</span>DeviceB] <strong>stp enable</strong>
[<span class="keyword">*</span>DeviceB] <strong>commit</strong></pre>
<p># Configure a DFS group and bind IP addresses to the DFS group.</p>
<p>Configure DeviceA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>dfs-group 1</strong>
[<span class="keyword">*</span>DeviceA-dfs-group-1] <strong>priority 150</strong>
[<span class="keyword">*</span>DeviceA-dfs-group-1] <strong>dual-active detection source ip 10.1.1.1 peer 10.1.1.2</strong>
[<span class="keyword">*</span>DeviceA-dfs-group-1] <strong>authentication-mode hmac-sha256 password YsHsjx_202206</strong>
[<span class="keyword">*</span>DeviceA-dfs-group-1] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>commit</strong></pre>
<p>Configure DeviceB.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB] <strong>dfs-group 1</strong>
[<span class="keyword">*</span>DeviceB-dfs-group-1] <strong>priority 120</strong>
[<span class="keyword">*</span>DeviceB-dfs-group-1] <strong>dual-active detection source ip 10.1.1.2 peer 10.1.1.1</strong>
[<span class="keyword">*</span>DeviceB-dfs-group-1] <strong>authentication-mode hmac-sha256 password YsHsjx_202206</strong>
[<span class="keyword">*</span>DeviceB-dfs-group-1] <strong>quit</strong>
[<span class="keyword">*</span>DeviceB] <strong>commit</strong></pre>
<p># Deploy an independent direct physical link for M-LAG heartbeat detection.</p>
<p>Configure DeviceA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>interface <span>100ge</span> <span>1/0/4</span></strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA-<span>100GE</span><span>1/0/4</span>] <strong>undo portswitch</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/4</span>] <strong>ip address 10.1.1.1 24</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/4</span>] <strong>m-lag unpaired-port reserved</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/4</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>commit</strong></pre>
<p>Configure DeviceB.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB] <strong>interface <span>100ge</span> <span>1/0/4</span></strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB-<span>100GE</span><span>1/0/4</span>] <strong>undo portswitch</strong>
[<span class="keyword">*</span>DeviceB-<span>100GE</span><span>1/0/4</span>] <strong>ip address 10.1.1.2 24</strong>
[<span class="keyword">*</span>DeviceB-<span>100GE</span><span>1/0/4</span>] <strong>m-lag unpaired-port reserved</strong>
[<span class="keyword">*</span>DeviceB-<span>100GE</span><span>1/0/4</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceB] <strong>commit</strong></pre>
<p># Configure peer-link interfaces in the M-LAG.</p>
<p>Configure DeviceA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>interface Eth-Trunk0</strong>
[<span class="keyword">*</span>DeviceA-Eth-Trunk0] <strong>trunkport <span>100ge</span> <span>1/0/5</span></strong>
[<span class="keyword">*</span>DeviceA-Eth-Trunk0] <strong>trunkport <span>100ge</span> <span>1/0/6</span></strong>
[<span class="keyword">*</span>DeviceA-Eth-Trunk0] <strong>mode lacp-static</strong>
[<span class="keyword">*</span>DeviceA-Eth-Trunk0] <strong>peer-link 1</strong>
[<span class="keyword">*</span>DeviceA-Eth-Trunk0] <strong>port vlan exclude 1</strong>
[<span class="keyword">*</span>DeviceA-Eth-Trunk0] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>commit</strong></pre>
<p>Configure DeviceB.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB] <strong>interface Eth-Trunk0</strong>
[<span class="keyword">*</span>DeviceB-Eth-Trunk0] <strong>trunkport <span>100ge</span> <span>1/0/5</span></strong>
[<span class="keyword">*</span>DeviceB-Eth-Trunk0] <strong>trunkport <span>100ge</span> </strong><strong><span>1/0/6</span></strong>
[<span class="keyword">*</span>DeviceB-Eth-Trunk0] <strong>mode lacp-static</strong>
[<span class="keyword">*</span>DeviceB-Eth-Trunk0] <strong>peer-link 1</strong>
[<span class="keyword">*</span>DeviceB-Eth-Trunk0] <strong>port vlan exclude 1</strong>
[<span class="keyword">*</span>DeviceB-Eth-Trunk0] <strong>quit</strong>
[<span class="keyword">*</span>DeviceB] <strong>commit</strong></pre>
</p></li><li class="substepexpand"><span>Configure links between the access and aggregation layers.</span><p><p># Configure DeviceA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>vlan batch 11</strong>
[<span class="keyword">*</span>DeviceA] <strong>interface Eth-Trunk10</strong>
[<span class="keyword">*</span>DeviceA-Eth-Trunk10] <strong>trunkport <span>100ge</span> <span>1/0/1</span></strong>
[<span class="keyword">*</span>DeviceA-Eth-Trunk10] <strong>trunkport <span>100ge</span> <span>1/0/2</span></strong>
[<span class="keyword">*</span>DeviceA-Eth-Trunk10] <strong>mode lacp-static</strong>
[<span class="keyword">*</span>DeviceA-Eth-Trunk10]<strong> port link-type trunk</strong>
[<span class="keyword">*</span>DeviceA-Eth-Trunk10] <strong>undo port trunk allow-pass vlan 1</strong>
[<span class="keyword">*</span>DeviceA-Eth-Trunk10] <strong>port trunk allow-pass vlan 11</strong>
[<span class="keyword">*</span>DeviceA-Eth-Trunk10]<strong> dfs-group 1 m-lag 10</strong>
[<span class="keyword">*</span>DeviceA-Eth-Trunk10] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>commit</strong></pre>
<p># Configure DeviceB.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB] <strong>vlan batch 11</strong>
[<span class="keyword">*</span>DeviceB] <strong>interface Eth-Trunk10</strong>
[<span class="keyword">*</span>DeviceB-Eth-Trunk10] <strong>trunkport <span>100ge</span> <span>1/0/1</span></strong>
[<span class="keyword">*</span>DeviceB-Eth-Trunk10] <strong>trunkport <span>100ge</span> <span>1/0/2</span></strong>
[<span class="keyword">*</span>DeviceB-Eth-Trunk10] <strong>mode lacp-static</strong>
[<span class="keyword">*</span>DeviceB-Eth-Trunk10]<strong> port link-type trunk</strong>
[<span class="keyword">*</span>DeviceB-Eth-Trunk10] <strong>undo port trunk allow-pass vlan 1</strong>
[<span class="keyword">*</span>DeviceB-Eth-Trunk10] <strong>port trunk allow-pass vlan 11</strong>
[<span class="keyword">*</span>DeviceB-Eth-Trunk10]<strong> dfs-group 1 m-lag 10</strong>
[<span class="keyword">*</span>DeviceB-Eth-Trunk10] <strong>quit</strong>
[<span class="keyword">*</span>DeviceB] <strong>commit</strong></pre>
</p></li><li class="substepexpand"><span>Configure server access.</span><p><p># Configure DeviceA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>interface Eth-Trunk1</strong>
[<span class="keyword">*</span>DeviceA-Eth-Trunk1] <strong>trunkport </strong><strong><span>100ge</span> <span>1/0/3</span></strong>
[<span class="keyword">*</span>DeviceA-Eth-Trunk1] <strong>mode lacp-static</strong>
[<span class="keyword">*</span>DeviceA-Eth-Trunk1]<strong> port link-type trunk</strong>
[<span class="keyword">*</span>DeviceA-Eth-Trunk1] <strong>undo port trunk allow-pass vlan 1</strong>
[<span class="keyword">*</span>DeviceA-Eth-Trunk1] <strong>port trunk allow-pass vlan 11</strong>
[<span class="keyword">*</span>DeviceA-Eth-Trunk1]<strong> dfs-group 1 m-lag 1</strong>
[<span class="keyword">*</span>DeviceA-Eth-Trunk1] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>commit</strong></pre>
<p># Configure DeviceB.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB] <strong>interface Eth-Trunk1</strong>
[<span class="keyword">*</span>DeviceB-Eth-Trunk1] <strong>trunkport <span>100ge</span> <span>1/0/3</span></strong>
[<span class="keyword">*</span>DeviceB-Eth-Trunk1] <strong>mode lacp-static</strong>
[<span class="keyword">*</span>DeviceB-Eth-Trunk1]<strong> port link-type trunk</strong>
[<span class="keyword">*</span>DeviceB-Eth-Trunk1] <strong>undo port trunk allow-pass vlan 1</strong>
[<span class="keyword">*</span>DeviceB-Eth-Trunk1] <strong>port trunk allow-pass vlan 11</strong>
[<span class="keyword">*</span>DeviceB-Eth-Trunk1]<strong> dfs-group 1 m-lag 1</strong>
[<span class="keyword">*</span>DeviceB-Eth-Trunk1] <strong>quit</strong>
[<span class="keyword">*</span>DeviceB] <strong>commit</strong></pre>
</p></li></ol>
</li><li><span>Configure DeviceC and DeviceD at the aggregation layer.</span><ol type="a"><li class="substepexpand"><span>Configure M-LAG.</span><p><p># Configure M-LAG in V-VBST mode.</p>
<p>Configure DeviceC.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname DeviceC</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceC] <strong>stp mode vbst</strong>
[<span class="keyword">*</span>DeviceC] <strong>stp enable</strong>
[<span class="keyword">*</span>DeviceC] <strong>commit</strong></pre>
<p>Configure DeviceD.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname DeviceD</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceD] <strong>stp mode vbst</strong>
[<span class="keyword">*</span>DeviceD] <strong>stp enable</strong>
[<span class="keyword">*</span>DeviceD] <strong>commit</strong></pre>
<p># Configure a DFS group and bind IP addresses to the DFS group.</p>
<p>Configure DeviceC.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceC] <strong>dfs-group 1</strong>
[<span class="keyword">*</span>DeviceC-dfs-group-1] <strong>priority 150</strong>
[<span class="keyword">*</span>DeviceC-dfs-group-1] <strong>dual-active detection source ip 10.2.1.1 peer 10.2.1.2</strong>
[<span class="keyword">*</span>DeviceC-dfs-group-1] <strong>authentication-mode hmac-sha256 password YsHsjx_202206</strong>
[<span class="keyword">*</span>DeviceC-dfs-group-1] <strong>quit</strong>
[<span class="keyword">*</span>DeviceC] <strong>commit</strong></pre>
<p>Configure DeviceD.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceD] <strong>dfs-group 1</strong>
[<span class="keyword">*</span>DeviceD-dfs-group-1] <strong>priority 120</strong>
[<span class="keyword">*</span>DeviceD-dfs-group-1] <strong>dual-active detection source ip 10.2.1.2 peer 10.2.1.1</strong>
[<span class="keyword">*</span>DeviceD-dfs-group-1] <strong>authentication-mode hmac-sha256 password YsHsjx_202206</strong>
[<span class="keyword">*</span>DeviceD-dfs-group-1] <strong>quit</strong>
[<span class="keyword">*</span>DeviceD] <strong>commit</strong></pre>
<p># Deploy an independent direct physical link for M-LAG heartbeat detection.</p>
<p>Configure DeviceC.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceC] <strong>interface <span>100ge</span> <span>1/0/5</span></strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceC-<span>100GE</span><span>1/0/5</span>] <strong>undo portswitch</strong>
[<span class="keyword">*</span>DeviceC-<span>100GE</span><span>1/0/5</span>] <strong>ip address 10.2.1.1 24</strong>
[<span class="keyword">*</span>DeviceC-<span>100GE</span><span>1/0/5</span>] <strong>m-lag unpaired-port reserved</strong>
[<span class="keyword">*</span>DeviceC-<span>100GE</span><span>1/0/5</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceC] <strong>commit</strong></pre>
<p>Configure DeviceD.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceD] <strong>interface <span>100ge</span> <span>1/0/5</span></strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceD-<span>100GE</span><span>1/0/5</span>] <strong>undo portswitch</strong>
[<span class="keyword">*</span>DeviceD-<span>100GE</span><span>1/0/5</span>] <strong>ip address 10.2.1.2 24</strong>
[<span class="keyword">*</span>DeviceD-<span>100GE</span><span>1/0/5</span>] <strong>m-lag unpaired-port reserved</strong>
[<span class="keyword">*</span>DeviceD-<span>100GE</span><span>1/0/5</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceD] <strong>commit</strong></pre>
<p># Configure peer-link interfaces in the M-LAG.</p>
<p>Configure DeviceC.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceC] <strong>interface Eth-Trunk0</strong>
[<span class="keyword">*</span>DeviceC-Eth-Trunk0] <strong>trunkport <span>100ge</span> </strong><strong><span>1/0/6</span></strong>
[<span class="keyword">*</span>DeviceC-Eth-Trunk0] <strong>trunkport <span>100ge</span> <span>1/0/7</span></strong>
[<span class="keyword">*</span>DeviceC-Eth-Trunk0] <strong>mode lacp-static</strong>
[<span class="keyword">*</span>DeviceC-Eth-Trunk0] <strong>peer-link 1</strong>
[<span class="keyword">*</span>DeviceC-Eth-Trunk0] <strong>port vlan exclude 1</strong>
[<span class="keyword">*</span>DeviceC-Eth-Trunk0] <strong>quit</strong>
[<span class="keyword">*</span>DeviceC] <strong>commit</strong></pre>
<p>Configure DeviceD.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceD] <strong>interface Eth-Trunk0</strong>
[<span class="keyword">*</span>DeviceD-Eth-Trunk0] <strong>trunkport <span>100ge</span> </strong><strong><span>1/0/6</span></strong>
[<span class="keyword">*</span>DeviceD-Eth-Trunk0] <strong>trunkport <span>100ge</span> </strong><strong><span>1/0/7</span></strong>
[<span class="keyword">*</span>DeviceD-Eth-Trunk0] <strong>mode lacp-static</strong>
[<span class="keyword">*</span>DeviceD-Eth-Trunk0] <strong>peer-link 1</strong>
[<span class="keyword">*</span>DeviceD-Eth-Trunk0] <strong>port vlan exclude 1</strong>
[<span class="keyword">*</span>DeviceD-Eth-Trunk0] <strong>quit</strong>
[<span class="keyword">*</span>DeviceD] <strong>commit</strong></pre>
</p></li><li class="substepexpand"><span>Configure links between the aggregation and access layers.</span><p><p># Configure DeviceC.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceC] <strong>vlan batch 11</strong>
[<span class="keyword">*</span>DeviceC] <strong>interface Eth-Trunk10</strong>
[<span class="keyword">*</span>DeviceC-Eth-Trunk10] <strong>trunkport <span>100ge</span> <span>1/0/3</span></strong>
[<span class="keyword">*</span>DeviceC-Eth-Trunk10] <strong>trunkport <span>100ge</span> <span>1/0/4</span></strong>
[<span class="keyword">*</span>DeviceC-Eth-Trunk10] <strong>mode lacp-static</strong>
[<span class="keyword">*</span>DeviceC-Eth-Trunk10]<strong> port link-type trunk</strong>
[<span class="keyword">*</span>DeviceC-Eth-Trunk10] <strong>undo port trunk allow-pass vlan 1</strong>
[<span class="keyword">*</span>DeviceC-Eth-Trunk10] <strong>port trunk allow-pass vlan 11</strong>
[<span class="keyword">*</span>DeviceC-Eth-Trunk10]<strong> dfs-group 1 m-lag 10</strong>
[<span class="keyword">*</span>DeviceC-Eth-Trunk10] <strong>quit</strong>
[<span class="keyword">*</span>DeviceC] <strong>commit</strong></pre>
<p># Configure DeviceD.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceD] <strong>vlan batch 11</strong>
[<span class="keyword">*</span>DeviceD] <strong>interface Eth-Trunk10</strong>
[<span class="keyword">*</span>DeviceD-Eth-Trunk10] <strong>trunkport <span>100ge</span> <span>1/0/3</span></strong>
[<span class="keyword">*</span>DeviceD-Eth-Trunk10] <strong>trunkport <span>100ge</span> <span>1/0/4</span></strong>
[<span class="keyword">*</span>DeviceD-Eth-Trunk10] <strong>mode lacp-static</strong>
[<span class="keyword">*</span>DeviceD-Eth-Trunk10]<strong> port link-type trunk</strong>
[<span class="keyword">*</span>DeviceD-Eth-Trunk10] <strong>undo port trunk allow-pass vlan 1</strong>
[<span class="keyword">*</span>DeviceD-Eth-Trunk10] <strong>port trunk allow-pass vlan 11</strong>
[<span class="keyword">*</span>DeviceD-Eth-Trunk10]<strong> dfs-group 1 m-lag 10</strong>
[<span class="keyword">*</span>DeviceD-Eth-Trunk10] <strong>quit</strong>
[<span class="keyword">*</span>DeviceD] <strong>commit</strong></pre>
</p></li><li class="substepexpand"><span>Configure Layer 3 gateways. On DeviceC and DeviceD, configure the same IP addresses and MAC addresses for VLANIF interfaces so that the devices function as dual-active gateways for the access layer.</span><p><p># Configure DeviceC.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceC] <strong>interface</strong><strong> vlanif 11</strong>
[<span class="keyword">*</span>DeviceC-Vlanif11] <strong>ip address 10.3.1.1 24</strong>
[<span class="keyword">*</span>DeviceC-Vlanif11] <strong>mac-address 0000-5e00-0110</strong>
[<span class="keyword">*</span>DeviceC-Vlanif11] <strong>quit</strong>
[<span class="keyword">*</span>DeviceC] <strong>commit</strong></pre>
<p># Configure DeviceD.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceD] <strong>interface</strong><strong> vlanif 11</strong>
[<span class="keyword">*</span>DeviceD-Vlanif11] <strong>ip address 10.3.1.1 24</strong>
[<span class="keyword">*</span>DeviceD-Vlanif11] <strong>mac-address 0000-5e00-0110</strong>
[<span class="keyword">*</span>DeviceD-Vlanif11] <strong>quit</strong>
[<span class="keyword">*</span>DeviceD] <strong>commit</strong></pre>
</p></li><li class="substepexpand"><span>Configure the egress network. Configure physical links of the peer-link as egress bypass links between DeviceC and DeviceD, and configure dedicated VLANIF interfaces for the peer-link for Layer 3 interconnection.</span><p><p># Configure DeviceC.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceC] <strong>interface</strong><strong> <span>100ge</span> <span>1/0/1</span></strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceC-<span>100GE</span><span>1/0/1</span>] <strong>undo portswitch</strong>
[<span class="keyword">*</span>DeviceC-<span>100GE</span><span>1/0/1</span>] <strong>ip address 10.4.1.1 24</strong>
[<span class="keyword">*</span>DeviceC-<span>100GE</span><span>1/0/1</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceC] <strong>interface</strong><strong> <span>100ge</span> <span>1/0/2</span></strong>
[<span class="keyword">*</span>DeviceC-<span>100GE</span><span>1/0/2</span>] <strong>undo portswitch</strong>
[<span class="keyword">*</span>DeviceC-<span>100GE</span><span>1/0/2</span>] <strong>ip address 10.5.1.1 24</strong>
[<span class="keyword">*</span>DeviceC-<span>100GE</span><span>1/0/2</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceC] <strong>vlan batch 100</strong>
[<span class="keyword">*</span>DeviceC] <strong>interface vlanif 100 </strong>
[<span class="keyword">*</span>DeviceC-Vlanif100] <strong>ip address 10.10.10.1 30</strong>
[<span class="keyword">*</span>DeviceC-Vlanif100]<strong> ospf cost 10000</strong>
[<span class="keyword">*</span>DeviceC-Vlanif100] <strong>quit</strong>
[<span class="keyword">*</span>DeviceC] <strong>ospf 1</strong>
[<span class="keyword">*</span>DeviceC-ospf-1] <strong>area 0</strong>
[<span class="keyword">*</span>DeviceC-ospf-1-area-0.0.0.0] <strong>network 10.3.1.0 0.0.0.255</strong>
[<span class="keyword">*</span>DeviceC-ospf-1-area-0.0.0.0] <strong>network 10.4.1.0 0.0.0.255</strong>
[<span class="keyword">*</span>DeviceC-ospf-1-area-0.0.0.0] <strong>network 10.5.1.0 0.0.0.255</strong>
[<span class="keyword">*</span>DeviceC-ospf-1-area-0.0.0.0] <strong>network 10.10.10.0 0.0.0.3</strong>
[<span class="keyword">*</span>DeviceC-ospf-1-area-0.0.0.0] <strong>quit</strong>
[<span class="keyword">*</span>DeviceC-ospf-1] <strong>quit</strong>
[<span class="keyword">*</span>DeviceC] <strong>commit</strong></pre>
<p># Configure DeviceD.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceD] <strong>interface</strong><strong> <span>100ge</span> <span>1/0/1</span></strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceD-<span>100GE</span><span>1/0/1</span>] <strong>undo portswitch</strong>
[<span class="keyword">*</span>DeviceD-<span>100GE</span><span>1/0/1</span>] <strong>ip address 10.6.1.1 24</strong>
[<span class="keyword">*</span>DeviceD-<span>100GE</span><span>1/0/1</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceD] <strong>interface</strong><strong> <span>100ge</span> <span>1/0/2</span></strong>
[<span class="keyword">*</span>DeviceD-<span>100GE</span><span>1/0/2</span>] <strong>undo portswitch</strong>
[<span class="keyword">*</span>DeviceD-<span>100GE</span><span>1/0/2</span>] <strong>ip address 10.7.1.1 24</strong>
[<span class="keyword">*</span>DeviceD-<span>100GE</span><span>1/0/2</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceD] <strong>vlan batch 100</strong>
[<span class="keyword">*</span>DeviceD] <strong>interface vlanif 100 </strong>
[<span class="keyword">*</span>DeviceD-Vlanif100] <strong>ip address 10.10.10.2 30</strong>
[<span class="keyword">*</span>DeviceD-Vlanif100]<strong> ospf cost 10000</strong>
[<span class="keyword">*</span>DeviceD-Vlanif100] <strong>quit</strong>
[<span class="keyword">*</span>DeviceD] <strong>ospf 1</strong>
[<span class="keyword">*</span>DeviceD-ospf-1] <strong>area 0</strong>
[<span class="keyword">*</span>DeviceD-ospf-1-area-0.0.0.0] <strong>network 10.3.1.0 0.0.0.255</strong>
[<span class="keyword">*</span>DeviceD-ospf-1-area-0.0.0.0] <strong>network 10.6.1.0 0.0.0.255</strong>
[<span class="keyword">*</span>DeviceD-ospf-1-area-0.0.0.0] <strong>network 10.7.1.0 0.0.0.255</strong>
[<span class="keyword">*</span>DeviceD-ospf-1-area-0.0.0.0] <strong>network 10.10.10.0 0.0.0.3</strong>
[<span class="keyword">*</span>DeviceD-ospf-1-area-0.0.0.0] <strong>quit</strong>
[<span class="keyword">*</span>DeviceD-ospf-1] <strong>quit</strong>
[<span class="keyword">*</span>DeviceD] <strong>commit</strong></pre>
</p></li></ol>
</li><li><span>Configure DeviceE and DeviceF at the core layer.</span><p><p># Configure DeviceE.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname DeviceE</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceE] <strong>interface</strong><strong> <span>100ge</span> <span>1/0/1</span></strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceE-<span>100GE</span><span>1/0/1</span>] <strong>undo portswitch</strong>
[<span class="keyword">*</span>DeviceE-<span>100GE</span><span>1/0/1</span>] <strong>ip address 10.4.1.2 24</strong>
[<span class="keyword">*</span>DeviceE-<span>100GE</span><span>1/0/1</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceE] <strong>interface</strong><strong> <span>100ge</span> <span>1/0/2</span></strong>
[<span class="keyword">*</span>DeviceE-<span>100GE</span><span>1/0/2</span>] <strong>undo portswitch</strong>
[<span class="keyword">*</span>DeviceE-<span>100GE</span><span>1/0/2</span>] <strong>ip address 10.7.1.2 24</strong>
[<span class="keyword">*</span>DeviceE-<span>100GE</span><span>1/0/2</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceE] <strong>ospf 1</strong>
[<span class="keyword">*</span>DeviceE-ospf-1] <strong>area 0</strong>
[<span class="keyword">*</span>DeviceE-ospf-1-area-0.0.0.0] <strong>network 10.4.1.0 0.0.0.255</strong>
[<span class="keyword">*</span>DeviceE-ospf-1-area-0.0.0.0] <strong>network 10.7.1.0 0.0.0.255</strong>
[<span class="keyword">*</span>DeviceE-ospf-1-area-0.0.0.0] <strong>quit</strong>
[<span class="keyword">*</span>DeviceE-ospf-1] <strong>quit</strong>
[<span class="keyword">*</span>DeviceE] <strong>commit</strong></pre>
<p># Configure DeviceF.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname DeviceF</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceF] <strong>interface</strong><strong> <span>100ge</span> <span>1/0/1</span></strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceF-<span>100GE</span><span>1/0/1</span>] <strong>undo portswitch</strong>
[<span class="keyword">*</span>DeviceF-<span>100GE</span><span>1/0/1</span>] <strong>ip address 10.6.1.2 24</strong>
[<span class="keyword">*</span>DeviceF-<span>100GE</span><span>1/0/1</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceF] <strong>interface</strong><strong> <span>100ge</span> <span>1/0/2</span></strong>
[<span class="keyword">*</span>DeviceF-<span>100GE</span><span>1/0/2</span>] <strong>undo portswitch</strong>
[<span class="keyword">*</span>DeviceF-<span>100GE</span><span>1/0/2</span>] <strong>ip address 10.5.1.2 24</strong>
[<span class="keyword">*</span>DeviceF-<span>100GE</span><span>1/0/2</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceF] <strong>ospf 1</strong>
[<span class="keyword">*</span>DeviceF-ospf-1] <strong>area 0</strong>
[<span class="keyword">*</span>DeviceF-ospf-1-area-0.0.0.0] <strong>network 10.5.1.0 0.0.0.255</strong>
[<span class="keyword">*</span>DeviceF-ospf-1-area-0.0.0.0] <strong>network 10.6.1.0 0.0.0.255</strong>
[<span class="keyword">*</span>DeviceF-ospf-1-area-0.0.0.0] <strong>quit</strong>
[<span class="keyword">*</span>DeviceF-ospf-1] <strong>quit</strong>
[<span class="keyword">*</span>DeviceF] <strong>commit</strong></pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001709917776__1.3.4"></a><a name="1.3.4"></a><h4 class="sectiontitle">Verifying the Configuration</h4><ul><li>Run the <strong>display dfs-group 1 m-lag</strong> command to check the M-LAG status. Under normal circumstances, the states of two member devices are displayed. One device is in Master state, and the other device is in Backup state.<p># Check the M-LAG status at the access layer.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>display dfs-group 1 m-lag</strong>
*                     : Local node
Heart beat state      : <strong>OK</strong>
<strong>Node 1</strong> *                            
  Dfs-Group ID        : 1
  Priority            : 150
  Dual-active Address : 10.1.1.1
  VPN-Instance        : public net
  State               : <strong>Master</strong>
  Causation           : - 
  System ID           : 00e0-fc12-3457
  SysName             : DeviceA
  Version             : <span class="keyword">V300R023C00</span>
  Device Type         : <span>CE6860-SAN</span>
<strong>Node 2</strong>                            
  Dfs-Group ID        : 1
  Priority            : 120
  Dual-active Address : 10.1.1.2
  VPN-Instance        : public net
  State               : <strong>Backup</strong>
  Causation           : - 
  System ID           : 00e0-fc12-3458
  SysName             : DeviceB
  Version             : <span class="keyword">V300R023C00</span>
  Device Type         : <span>CE6860-SAN</span></pre>
<p># Check the M-LAG status at the aggregation layer.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceC] <strong>display dfs-group 1 m-lag</strong>
*                     : Local node
Heart beat state      : <strong>OK</strong>
<strong>Node 1</strong> *                            
  Dfs-Group ID        : 1
  Priority            : 150
  Dual-active Address : 10.2.1.1
  VPN-Instance        : public net
  State               : <strong>Master</strong>
  Causation           : - 
  System ID           : 00e0-fc12-3459
  SysName             : DeviceC
  Version             : <span class="keyword">V300R023C00</span>
  Device Type         : <span>CE6860-SAN</span>
<strong>Node 2</strong>                            
  Dfs-Group ID        : 1
  Priority            : 120
  Dual-active Address : 10.2.1.2
  VPN-Instance        : public net
  State               : <strong>Backup</strong>
  Causation           : - 
  System ID           : 00e0-fc12-3460
  SysName             : DeviceD
  Version             : <span class="keyword">V300R023C00</span>
  Device Type         : <span>CE6860-SAN</span></pre>
</li><li>Run the <strong>display dfs-group 1 node 1 m-lag</strong> <strong>brief</strong> command to check the M-LAG Eth-Trunk status.<p># Check the M-LAG Eth-Trunk status on DeviceA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>display dfs-group 1 node 1 m-lag brief</strong>
* - Local node

M-Lag ID     Interface      Port State    Status                Consistency-check
<strong>       1     Eth-Trunk 1    Up            active(*)-active      success</strong>
      10     Eth-Trunk 10   Up            active(*)-active      success
......</pre>
<p># Check the M-LAG Eth-Trunk status on DeviceC.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceC] <strong>display dfs-group 1 node 1 m-lag brief</strong>
* - Local node

M-Lag ID     Interface      Port State    Status                Consistency-check
      <strong>10     Eth-Trunk 10   Up            active(*)-active      success</strong>
......</pre>
</li></ul>
</div>
<div class="postreq"><a name="EN-US_TASK_0000001709917776__1.3.5"></a><a name="1.3.5"></a><h4 class="sectiontitle">Configuration Scripts</h4><ul><li>DeviceA<pre class="screen">#
sysname DeviceA
#
dfs-group 1
 priority 150
 dual-active detection source ip 10.1.1.1 peer 10.1.1.2
 authentication-mode hmac-sha256 password %+%##!!!!!!!!!"!!!!"!!!!*!!!!C+tR0CW9x*eB&amp;pWp`t),Azgw-h\o8#4LZPD!!!!!!!!!!!!!!!9!!!!&gt;fwJ)I0E{=:%,*,XRhbH&amp;t0MCy_8=7!!!!!!!!!!%+%#
#
vlan batch 11
#
stp mode vbst
#
interface Eth-Trunk0
 mode lacp-static
 peer-link 1
 port vlan exclude 1
#
interface Eth-Trunk1
 port link-type trunk
 undo port trunk allow-pass vlan 1
 port trunk allow-pass vlan 11
 mode lacp-static
 dfs-group 1 m-lag 1
#
interface Eth-Trunk10
 port link-type trunk
 undo port trunk allow-pass vlan 1
 port trunk allow-pass vlan 11
 mode lacp-static
 dfs-group 1 m-lag 10
#
interface <span>100GE</span><span>1/0/1</span>
 eth-trunk 10
#
interface <span>100GE</span><span>1/0/2</span>
 eth-trunk 10
#
interface <span>100GE</span><span>1/0/3</span>
 eth-trunk 1
#
interface <span>100GE</span><span>1/0/4</span>
 undo portswitch
 ip address 10.1.1.1 255.255.255.0
 m-lag unpaired-port reserved
#
interface <span>100GE</span><span>1/0/5</span>
 eth-trunk 0
#
interface <span>100GE</span><span>1/0/6</span>
 eth-trunk 0
#
return</pre>
</li><li>DeviceB<pre class="screen">#
sysname DeviceB
#
dfs-group 1
 priority 120
 dual-active detection source ip 10.1.1.2 peer 10.1.1.1
 authentication-mode hmac-sha256 password %+%##!!!!!!!!!"!!!!"!!!!*!!!!C+tR0CW9x*eB&amp;pWp`t),Azgw-h\o8#4LZPD!!!!!!!!!!!!!!!9!!!!&gt;fwJ)I0E{=:%,*,XRhbH&amp;t0MCy_8=7!!!!!!!!!!%+%#
#
vlan batch 11
#
stp mode vbst
#
interface Eth-Trunk0
 mode lacp-static
 peer-link 1
 port vlan exclude 1
#
interface Eth-Trunk1
 port link-type trunk
 undo port trunk allow-pass vlan 1
 port trunk allow-pass vlan 11
 mode lacp-static
 dfs-group 1 m-lag 1
#
interface Eth-Trunk10
 port link-type trunk
 undo port trunk allow-pass vlan 1
 port trunk allow-pass vlan 11
 mode lacp-static
 dfs-group 1 m-lag 10
#
interface <span>100GE</span><span>1/0/1</span>
 eth-trunk 10
#
interface <span>100GE</span><span>1/0/2</span>
 eth-trunk 10
#
interface <span>100GE</span><span>1/0/3</span>
 eth-trunk 1
#
interface <span>100GE</span><span>1/0/4</span>
 undo portswitch
 ip address 10.1.1.2 255.255.255.0
 m-lag unpaired-port reserved
#
interface <span>100GE</span><span>1/0/5</span>
 eth-trunk 0
#
interface <span>100GE</span><span>1/0/6</span>
 eth-trunk 0
#
return</pre>
</li><li>DeviceC<pre class="screen">#
sysname DeviceC
#
dfs-group 1
 priority 150
 dual-active detection source ip 10.2.1.1 peer 10.2.1.2
 authentication-mode hmac-sha256 password %+%##!!!!!!!!!"!!!!"!!!!*!!!!C+tR0CW9x*eB&amp;pWp`t),Azgw-h\o8#4LZPD!!!!!!!!!!!!!!!9!!!!&gt;fwJ)I0E{=:%,*,XRhbH&amp;t0MCy_8=7!!!!!!!!!!%+%#
#
vlan batch 11 100
#
stp mode vbst
#
interface Vlanif11
 ip address 10.3.1.1 255.255.255.0
 mac-address 0000-5e00-0110 
#
interface Vlanif100
 ip address 10.10.10.1 255.255.255.252
 ospf cost 10000
#
interface Eth-Trunk0
 mode lacp-static
 peer-link 1
 port vlan exclude 1
#
interface Eth-Trunk10
 port link-type trunk
 undo port trunk allow-pass vlan 1
 port trunk allow-pass vlan 11
 mode lacp-static
 dfs-group 1 m-lag 10
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 10.4.1.1 255.255.255.0
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ip address 10.5.1.1 255.255.255.0
#
interface <span>100GE</span><span>1/0/3</span>
 eth-trunk 10
#
interface <span>100GE</span><span>1/0/4</span>
 eth-trunk 10
#
interface <span>100GE</span><span>1/0/5</span>
 undo portswitch
 ip address 10.2.1.1 255.255.255.0
 m-lag unpaired-port reserved
#
interface <span>100GE</span><span>1/0/6</span>
 eth-trunk 0
#
interface <span>100GE</span><span>1/0/7</span>
 eth-trunk 0
#
ospf 1
 area 0.0.0.0
  network 10.3.1.0 0.0.0.255
  network 10.4.1.0 0.0.0.255
  network 10.5.1.0 0.0.0.255
  network 10.10.10.0 0.0.0.3
#
return</pre>
</li><li>DeviceD<pre class="screen">#
sysname DeviceD
#
dfs-group 1
 priority 120
 dual-active detection source ip 10.2.1.2 peer 10.2.1.1
 authentication-mode hmac-sha256 password %+%##!!!!!!!!!"!!!!"!!!!*!!!!C+tR0CW9x*eB&amp;pWp`t),Azgw-h\o8#4LZPD!!!!!!!!!!!!!!!9!!!!&gt;fwJ)I0E{=:%,*,XRhbH&amp;t0MCy_8=7!!!!!!!!!!%+%#
#
vlan batch 11 100
#
stp mode vbst
#
interface Vlanif11
 ip address 10.3.1.1 255.255.255.0
 mac-address 0000-5e00-0110
#
interface Vlanif100
 ip address 10.10.10.2 255.255.255.252
 ospf cost 10000
#
interface Eth-Trunk0
 mode lacp-static
 peer-link 1
 port vlan exclude 1
#
interface Eth-Trunk10
 port link-type trunk
 undo port trunk allow-pass vlan 1
 port trunk allow-pass vlan 11
 mode lacp-static
 dfs-group 1 m-lag 10
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 10.6.1.1 255.255.255.0
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ip address 10.7.1.1 255.255.255.0
#
interface <span>100GE</span><span>1/0/3</span>
 eth-trunk 10
#
interface <span>100GE</span><span>1/0/4</span>
 eth-trunk 10
#
interface <span>100GE</span><span>1/0/5</span>
 undo portswitch
 ip address 10.2.1.2 255.255.255.0
 m-lag unpaired-port reserved
#
interface <span>100GE</span><span>1/0/6</span>
 eth-trunk 0
#
interface <span>100GE</span><span>1/0/7</span>
 eth-trunk 0
#
ospf 1
 area 0.0.0.0
  network 10.3.1.0 0.0.0.255
  network 10.6.1.0 0.0.0.255
  network 10.7.1.0 0.0.0.255
  network 10.10.10.0 0.0.0.3
#
return</pre>
</li><li>DeviceE<pre class="screen">#
sysname DeviceE
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 10.4.1.2 255.255.255.0
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ip address 10.7.1.2 255.255.255.0
#
ospf 1
 area 0.0.0.0
  network 10.4.1.0 0.0.0.255
  network 10.7.1.0 0.0.0.255
#
return</pre>
</li><li>DeviceF<pre class="screen">#
sysname DeviceF
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 10.5.1.2 255.255.255.0
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ip address 10.6.1.2 255.255.255.0
#
ospf 1
 area 0.0.0.0
  network 10.5.1.0 0.0.0.255
  network 10.6.1.0 0.0.0.255
#
return</pre>
</li></ul>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../dc/dc_cfg_m-lag_0020.html">Configuring an M-LAG
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../dc/dc_cfg_m-lag_0081.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>
</body>
</html>