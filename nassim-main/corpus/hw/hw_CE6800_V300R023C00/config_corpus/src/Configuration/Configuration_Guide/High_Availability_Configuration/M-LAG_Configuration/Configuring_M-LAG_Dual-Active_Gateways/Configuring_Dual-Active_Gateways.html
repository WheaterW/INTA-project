
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring Dual-Active Gateways">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../dc/dc_cfg_m-lag_0015.html">
<meta name="DC.Relation" scheme="URI" content="../dc/dc_cfg_m-lag_0041.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="M-LAG">
<meta name="featuretype" content="High Availability">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="M-LAG">
<meta name="featuretype" content="High Availability">
<meta name="featurename" content="M-LAG">
<meta name="featuretype" content="High Availability">
<meta name="featuretype" content="High Availability">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001563888785">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="../public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="../public_sys-resources/browseVersion.js"></script>
<title>Configuring Dual-Active Gateways</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001563888785"></a><a name="EN-US_TASK_0000001563888785"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring Dual-Active Gateways</h1>
<div class="taskbody"><div class="prereq" style="margin-left:0"><a name="EN-US_TASK_0000001563888785__1.3.1"></a><a name="1.3.1"></a><h4 class="sectiontitle">Prerequisites</h4>
<div class="p"><p>VLANIF interfaces have been configured on M-LAG master and backup devices, and M-LAG member interfaces have been added to the corresponding VLAN. Alternatively, VBDIF interfaces have been configured on M-LAG master and backup devices, a VXLAN VNI has been bound to the corresponding BD, and Layer 2 sub-interfaces of Eth-Trunk interfaces that function as M-LAG member interfaces have been added to the BD.</p>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001563888785__1.3.2"></a><a name="1.3.2"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>When a server is dual-homed to a Layer 3 or VXLAN network through an M-LAG, both the M-LAG master and backup devices need to function as Layer 3 gateways. You must ensure that VLANIF or VBDIF interfaces corresponding to M-LAG member interfaces have the same IP address and MAC address. You can configure the same IP address for the VLANIF or VBDIF interfaces and run the <a href="cmdqueryname=mac-address"><b><span class="cmdname">mac-address</span></b></a> command to configure the same virtual MAC address for them.</p>
<p>If a server is dual-homed to a VXLAN network through an M-LAG and a downlink of the M-LAG fails, service traffic needs to be transmitted through the peer-link between the M-LAG member devices. Therefore, a static bypass VXLAN tunnel must be configured between the M-LAG member devices in this scenario to divert the service traffic to the peer-link.</p>
<p>For the <span>CE6820H, CE6820H-K, and CE6820S</span>: VXLAN-related configurations are not supported.</p>
<p>For the <span>CE6885-LL (low latency mode)</span>: VXLAN and IPv6-related configurations are not supported.</p>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001563888785__1.3.3"></a><a name="1.3.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Enter the system view.</span><p><pre class="screen"><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></pre>
</p></li><li><span>Enter the VLANIF or VBDIF interface view.</span><p><ul><li>Enter the VLANIF interface view.<pre class="screen"><a href="cmdqueryname=interface"><b><span class="cmdname">interface</span></b></a> <strong><span>vlanif</span></strong> <i><span class="varname">vlan-id</span></i></pre>
</li></ul>
<ul><li>Enter the VBDIF interface view.<pre class="screen"><a href="cmdqueryname=interface"><b><span class="cmdname">interface</span></b></a> <strong><span>vbdif</span></strong> <i><span class="varname">bd-id</span></i></pre>
</li></ul>
</p></li><li><span>Configure an IP address for the interface.</span><p><ul><li>Configure an IPv4 address.<pre class="screen"><a href="cmdqueryname=ip+address"><b><span class="cmdname">ip address</span></b></a> <i><span class="varname">ip-address</span></i> { <i><span class="varname">mask</span></i> | <i><span class="varname">mask-length</span></i> } [ <strong><span>sub</span></strong> ]</pre>
</li><li>Configure an IPv6 address.<ol type="a"><li>Enable IPv6 on the interface.<pre class="screen"><a href="cmdqueryname=ipv6+enable"><b><span class="cmdname">ipv6 enable</span></b></a></pre>
</li><li>Configure a global unicast address for the interface.<pre class="screen"><a href="cmdqueryname=ipv6+address"><b><span class="cmdname">ipv6 address</span></b></a> { <i><span class="varname">ipv6-address</span></i> <i><span class="varname">prefix-length</span></i> | <i><span class="varname">ipv6-address</span></i>/<i><span class="varname">prefix-length</span></i> } [ <strong>eui-64</strong> ]</pre>
</li></ol>
<p>By default, no IP address is configured for an interface.</p>
</li></ul>
</p><p><div class="note"><img src="../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>VLANIF or VBDIF interfaces corresponding to M-LAG member interfaces of M-LAG master and backup devices must be configured with the same IP address.</p>
</div></div>
</p></li><li><span>Configure a virtual MAC address for the VLANIF or VBDIF interface.</span><p><pre class="screen"><a href="cmdqueryname=mac-address"><b><span class="cmdname">mac-address</span></b></a> <i><span class="varname">mac-address</span></i></pre>
<div class="p">By default, the MAC address of a VLANIF or VBDIF interface is the same as the system MAC address.<div class="note"><img src="../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>VLANIF or VBDIF interfaces corresponding to M-LAG member interfaces of M-LAG master and backup devices must be configured with the same virtual MAC address. In addition, to simplify device MAC address management and O&amp;M, you are advised to configure a virtual MAC address in the reserved range. The virtual MAC address is in the format of 0000-5E00-01XX or 0000-5E00-02XX.</p>
</div></div>
</div>
</p></li><li><span>(Optional) Set a delay after which the Layer 3 protocol status of the interface changes to up.</span><p><pre class="screen"><a href="cmdqueryname=protocol+up-delay-time"><b><span class="cmdname">protocol up-delay-time</span></b></a> <i><span class="varname">time</span></i></pre>
<p>When an M-LAG member device or the peer-link recovers from a fault, a large number of ARP entries need to be synchronized in a batch. After the delay is set for an interface, the protocol status of the interface changes from down to up after ARP entries are synchronized. This prevents protocol packets from being discarded, shortens the packet loss time during link fault recovery, and improves convergence performance.</p>
<p>By default, the delay after which the Layer 3 protocol status changes to up is 1s for a VLANIF interface and 0s for a VBDIF interface. When there are a large number of ARP entries, however, this delay needs to be longer.</p>
<div class="note"><img src="../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>After an M-LAG member device restarts or a board resets, the physical status of an interface changes to up, but the upper-layer protocol modules do not meet forwarding requirements, resulting in packet loss. To ensure switchback performance, an M-LAG member interface reports the up state after a delay of 240s by default. If a delay after which the Layer 3 protocol status changes to up is configured on the VLANIF or VBDIF interface, ensure that the delay after which an M-LAG member interface reports the up state is longer than the delay configured on the VLANIF or VBDIF interface. Otherwise, the device is triggered to learn ND entries that fail to be synchronized only when ND Miss messages are generated.</p>
<p>To prevent spanning tree protocol flapping caused by device restart and peer-link faults and ensure switchback performance, you are advised to set the delay in reporting the up state to 30s or longer on M-LAG member interfaces.</p>
</div></div>
</p></li><li><span>Commit the configuration.</span><p><pre class="screen" id="EN-US_TASK_0000001563888785__en-us_task_0228023023_screen163801330213"><a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001563888785__en-us_task_0228023023_en-us_concept_0141113565_cmdname1667501373175340">commit</span></b></a></pre>
</p></li></ol></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../dc/dc_cfg_m-lag_0015.html">Configuring M-LAG Dual-Active Gateways
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../dc/dc_cfg_m-lag_0041.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>