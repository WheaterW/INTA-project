
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring PFC Deadlock Detection">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="galaxy_dcb_cfg_0009.html">
<meta name="DC.Relation" scheme="URI" content="galaxy_dcb_cfg_0010.html">
<meta name="DC.Relation" scheme="URI" content="galaxy_dcb_cfg_0012.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="DCB">
<meta name="featuretype" content="DCN and Network Management">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="DCB">
<meta name="featuretype" content="DCN and Network Management">
<meta name="featurename" content="DCB">
<meta name="featuretype" content="DCN and Network Management">
<meta name="featuretype" content="DCN and Network Management">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001563750005">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>Configuring PFC Deadlock Detection</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001563750005"></a><a name="EN-US_TASK_0000001563750005"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring PFC Deadlock Detection</h1>
<div class="taskbody" id="taskbody1567479154484"><div class="context"><a name="EN-US_TASK_0000001563750005__1.3.1"></a><a name="1.3.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p" id="EN-US_TASK_0000001563750005__context1491506485175459"><p id="EN-US_TASK_0000001563750005__p579077704">If a large number of PFC backpressure signals are present on the network, a network deadlock may occur, leading to system risks. After the PFC deadlock detection function is enabled, if the device continuously receives PFC frames throughout the deadlock detection period, the device does not respond to the frames, ensuring that a PFC deadlock does not occur.</p>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001563750005__1.3.2"></a><a name="1.3.2"></a><h4 class="sectiontitle">Procedure</h4>
<ol id="EN-US_TASK_0000001563750005__steps331585419175459"><li id="EN-US_TASK_0000001563750005__step1238767835175324"><span id="EN-US_TASK_0000001563750005__cmd117045180175324">Enter the system view.</span><p><pre class="screen" id="EN-US_TASK_0000001563750005__screen1484011497269"><a href="cmdqueryname=system-view"><b><span class="cmdname" id="EN-US_TASK_0000001563750005__cmdname193313812175324">system-view</span></b></a></pre>
</p></li><li id="EN-US_TASK_0000001563750005__step1908383751175324"><span id="EN-US_TASK_0000001563750005__cmd1537435112175324">Enter the PFC profile view.</span><p><pre class="screen" id="EN-US_TASK_0000001563750005__screen16414138204710"><a href="cmdqueryname=dcb+pfc"><b><span class="cmdname" id="EN-US_TASK_0000001563750005__cmdname99044230175324">dcb pfc</span></b></a> [ <em id="EN-US_TASK_0000001563750005__i0193184117442">profilename</em> ]</pre>
</p></li><li id="EN-US_TASK_0000001563750005__step626815447488"><span id="EN-US_TASK_0000001563750005__cmd5268134417482">Enable a device to automatically disable PFC on an interface after the specified number of deadlocks occur within a 20-second period.</span><p><pre class="screen" id="EN-US_TASK_0000001563750005__screen8197114664917"><a href="cmdqueryname=priority"><b><span class="cmdname" id="EN-US_TASK_0000001563750005__cmdname819774610491">priority</span></b></a> <i><span class="varname" id="EN-US_TASK_0000001563750005__varname15197124614491">priority</span></i> <strong><span id="EN-US_TASK_0000001563750005__cmdparmname21977462494">turn-off</span></strong> <strong><span id="EN-US_TASK_0000001563750005__cmdparmname1519724617495">threshold</span></strong> <i><span class="varname" id="EN-US_TASK_0000001563750005__varname519712467497">threshold-value</span></i></pre>
<p id="EN-US_TASK_0000001563750005__p135641549497">By default, PFC is automatically disabled on an interface if 30 deadlocks occur within a 20-second period.</p>
</p></li><li id="EN-US_TASK_0000001563750005__step17516368492"><span id="EN-US_TASK_0000001563750005__cmd107518363492">Enable a device to set the interface status to error-down after a specified number of deadlocks occur within a 20-second period.</span><p><pre class="screen" id="EN-US_TASK_0000001563750005__screen1424615913501"><a href="cmdqueryname=priority"><b><span class="cmdname" id="EN-US_TASK_0000001563750005__cmdname22466935012">priority</span></b></a> <i><span class="varname" id="EN-US_TASK_0000001563750005__varname15246295506">priority</span></i> <strong><span id="EN-US_TASK_0000001563750005__cmdparmname192463995013">error-down</span></strong> <strong><span id="EN-US_TASK_0000001563750005__cmdparmname1246694501">threshold</span></strong> <i><span class="varname" id="EN-US_TASK_0000001563750005__varname52462985015">threshold-value</span></i></pre>
<p id="EN-US_TASK_0000001563750005__p6168151255010">By default, an interface is set to the error-down state if deadlock occurs more than 30 times within a 20-second period.</p>
</p></li><li id="EN-US_TASK_0000001563750005__step68163732313"><span id="EN-US_TASK_0000001563750005__cmd8816177102312">(Optional) For the <span>CE6855-48XS8CQ, CE6863E-48S8CQ, CE6885, CE6885-LL, CE6885-SAN, CE6885-T, CE8851-32CQ4BQ, CE8855</span>: Set the detection period for hardware-based deadlock detection.</span><p><pre class="screen" id="EN-US_TASK_0000001563750005__screen20971162382319"><strong id="EN-US_TASK_0000001563750005__b889312496239"><a href="cmdqueryname=priority"><b><span class="cmdname" id="EN-US_TASK_0000001563750005__cmdname09171539102517">priority</span></b></a></strong> <em id="EN-US_TASK_0000001563750005__i1728455762315">priority</em> <strong id="EN-US_TASK_0000001563750005__b1611012442416"><strong><span id="EN-US_TASK_0000001563750005__cmdparmname44141640172611">deadlock-detect</span></strong> <strong><span id="EN-US_TASK_0000001563750005__cmdparmname1042454412616">time</span></strong></strong> <em id="EN-US_TASK_0000001563750005__i974810918249">time</em></pre>
<p id="EN-US_TASK_0000001563750005__p12496162571918">By default, the detection period for hardware-based deadlock detection is 100 ms.</p>
</p></li><li id="EN-US_TASK_0000001563750005__step67171381290"><span id="EN-US_TASK_0000001563750005__cmd1871718832913">(Optional) For the <span>CE6855-48XS8CQ, CE6863E-48S8CQ, CE6885, CE6885-LL, CE6885-SAN, CE6885-T, CE8851-32CQ4BQ, CE8855</span>: Set the recovery period for hardware-based deadlock detection.</span><p><pre class="screen" id="EN-US_TASK_0000001563750005__screen18699153310309"><strong id="EN-US_TASK_0000001563750005__b1288844883014"><a href="cmdqueryname=priority"><b><span class="cmdname" id="EN-US_TASK_0000001563750005__cmdname1169691512391">priority</span></b></a></strong> <em id="EN-US_TASK_0000001563750005__i187741054173010">priority</em> <strong id="EN-US_TASK_0000001563750005__b9541584304"><strong><span id="EN-US_TASK_0000001563750005__cmdparmname1265522515397">deadlock-recovery</span></strong> <strong><span id="EN-US_TASK_0000001563750005__cmdparmname109767298398">time</span></strong></strong> <em id="EN-US_TASK_0000001563750005__i5482821313">time</em></pre>
<p id="EN-US_TASK_0000001563750005__p555015812819">By default, the recovery period for hardware-based deadlock detection is 100 ms.</p>
<p id="EN-US_TASK_0000001563750005__p184671912141210">If the recovery period (<em id="EN-US_TASK_0000001563750005__i1443514269121">time</em>) is set to 0, the device does not perform PFC deadlock recovery when a PFC deadlock occurs. Instead, the device performs a new round of deadlock detection.</p>
<div class="note" id="EN-US_TASK_0000001563750005__note1337184934611"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0000001563750005__p131411301470">For the <span>CE6855-48XS8CQ, CE6863E-48S8CQ, CE6885, CE6885-LL, CE6885-SAN, CE6885-T, CE8851-32CQ4BQ, CE8855</span>:</p>
<p id="EN-US_TASK_0000001563750005__p4141110184715">The units of the detection period and recovery period for hardware-based deadlock detection are determined by the <strong id="EN-US_TASK_0000001563750005__b71413034712">dcb pfc deadlock-detect interval</strong> <em id="EN-US_TASK_0000001563750005__i91415017471">interval-value</em> command configuration. The detection period or recovery period that actually takes effect is the product of <em id="EN-US_TASK_0000001563750005__i414150194713">interval-value</em> (the configured precision) and <em id="EN-US_TASK_0000001563750005__i13142303470">time</em> (the configured detection period or recovery period).</p>
</div></div>
</p></li><li id="EN-US_TASK_0000001563750005__step86781148105015"><span id="EN-US_TASK_0000001563750005__cmd667812485508">Return to the system view.</span><p><pre class="screen" id="EN-US_TASK_0000001563750005__screen1987715582507"><a href="cmdqueryname=quit"><b><span class="cmdname" id="EN-US_TASK_0000001563750005__cmdname198771858145019">quit</span></b></a></pre>
</p></li><li id="EN-US_TASK_0000001563750005__step1144515119519"><span id="EN-US_TASK_0000001563750005__cmd144514112511">Enter the interface view.</span><p><pre class="screen" id="EN-US_TASK_0000001563750005__screen178246156516"><a href="cmdqueryname=interface"><b><span class="cmdname" id="EN-US_TASK_0000001563750005__cmdname188244157515">interface</span></b></a> <i><span class="varname" id="EN-US_TASK_0000001563750005__varname1582451535116">interface-type interface-number</span></i></pre>
</p></li><li id="EN-US_TASK_0000001563750005__step12601333155119"><span id="EN-US_TASK_0000001563750005__cmd3601433135118">Configure a device to set an interface to the error-down state or disable PFC on the interface when the number of PFC deadlocks on the interface exceeds the deadlock threshold within a 20-second period.</span><p><pre class="screen" id="EN-US_TASK_0000001563750005__screen12602182764818"><a href="cmdqueryname=port+pfc-deadlock+trigger"><b><span class="cmdname" id="EN-US_TASK_0000001563750005__cmdname69078279715">port pfc-deadlock trigger</span></b></a> { <strong><span id="EN-US_TASK_0000001563750005__cmdparmname2080483319716">error-down</span></strong> | <strong><span id="EN-US_TASK_0000001563750005__cmdparmname448217403718">turn-off</span></strong> }</pre>
<p id="EN-US_TASK_0000001563750005__p6150165712392">By default, if the number of PFC deadlocks on an interface exceeds the deadlock threshold within a 20-second period, PFC is automatically disabled.</p>
</p></li><li id="EN-US_TASK_0000001563750005__step18851161075215"><span id="EN-US_TASK_0000001563750005__cmd985121045212">Return to the system view.</span><p><pre class="screen" id="EN-US_TASK_0000001563750005__screen1290422210529"><a href="cmdqueryname=quit"><b><span class="cmdname" id="EN-US_TASK_0000001563750005__cmdname1790482245217">quit</span></b></a></pre>
</p></li><li id="EN-US_TASK_0000001563750005__step1424992717326"><span id="EN-US_TASK_0000001563750005__cmd102491827143217">(Optional) For the <span>CE6855-48XS8CQ, CE6863E-48S8CQ, CE6885, CE6885-LL, CE6885-SAN, CE6885-T, CE8851-32CQ4BQ, CE8855</span>: Set the precision of the detection period and recovery period for hardware-based PFC deadlock detection.</span><p><pre class="screen" id="EN-US_TASK_0000001563750005__screen1042601413340"><strong id="EN-US_TASK_0000001563750005__b2474182915345"><a href="cmdqueryname=dcb+pfc+deadlock-detect+interval"><b><span class="cmdname" id="EN-US_TASK_0000001563750005__cmdname6192282246">dcb pfc deadlock-detect interval</span></b></a></strong> <em id="EN-US_TASK_0000001563750005__i9778173553416">interval-value</em></pre>
<p id="EN-US_TASK_0000001563750005__p3148194340">By default, the precision of the detection period and recovery period for hardware-based PFC deadlock detection is 10 ms.</p>
</p></li><li id="EN-US_TASK_0000001563750005__step43182015205212"><span id="EN-US_TASK_0000001563750005__cmd12318141535218">(Optional) For the <span>CE6866, CE6860-SAN, CE6866K, CE6860-HAM, CE8851-32CQ8DQ-P, CE8850-SAN, CE8851K, CE8850-HAM</span>: Set the detection period for hardware-based deadlock detection.</span><p><pre class="screen" id="EN-US_TASK_0000001563750005__screen13146113714529"><a href="cmdqueryname=dcb+pfc+deadlock-detect+timer"><b><span class="cmdname" id="EN-US_TASK_0000001563750005__cmdname201468377529">dcb pfc deadlock-detect timer</span></b></a> <i><span class="varname" id="EN-US_TASK_0000001563750005__varname161471137115218">detect-time</span></i></pre>
<p id="EN-US_TASK_0000001563750005__p39905315313">By default, the detection period for hardware-based deadlock detection is 100 ms.</p>
</p></li><li id="EN-US_TASK_0000001563750005__step114420121533"><span id="EN-US_TASK_0000001563750005__cmd16143512145317">(Optional) For the <span>CE6866, CE6860-SAN, CE6866K, CE6860-HAM, CE8851-32CQ8DQ-P, CE8850-SAN, CE8851K, CE8850-HAM</span>: Set the recovery period for hardware-based deadlock detection.</span><p><pre class="screen" id="EN-US_TASK_0000001563750005__screen196001515124820"><a href="cmdqueryname=dcb+pfc+deadlock-recovery+timer"><b><span class="cmdname" id="EN-US_TASK_0000001563750005__cmdname889015517191">dcb pfc deadlock-recovery timer</span></b></a> <i><span class="varname" id="EN-US_TASK_0000001563750005__varname74142015742">recovery-time</span></i></pre>
<p id="EN-US_TASK_0000001563750005__p1288352875313">By default, the recovery period for hardware-based deadlock detection is 100 ms.</p>
</p></li><li id="EN-US_TASK_0000001563750005__step104714138531"><span id="EN-US_TASK_0000001563750005__cmd2471913125317">(Optional) Configure the packet processing behavior of the device during the recovery period of hardware-based deadlock detection.</span><p><pre class="screen" id="EN-US_TASK_0000001563750005__screen8931134144911"><a href="cmdqueryname=dcb+pfc+deadlock+recovery-behavior"><b><span class="cmdname" id="EN-US_TASK_0000001563750005__cmdname191661650124416">dcb pfc deadlock recovery-behavior</span></b></a> { <strong id="EN-US_TASK_0000001563750005__b96811742111617">discard</strong> | <strong id="EN-US_TASK_0000001563750005__b668194214160">forwarding</strong> }<strong id="EN-US_TASK_0000001563750005__b8583121161920"> slot</strong> <i><span class="varname" id="EN-US_TASK_0000001563750005__varname10812155719182">slot-id</span></i></pre>
<p id="EN-US_TASK_0000001563750005__p13493142111576">By default, during the recovery period of hardware-based deadlock detection, packets are discarded on the <span>CE6866, CE6860-SAN, CE6866K, CE6860-HAM, CE8851-32CQ8DQ-P, CE8850-SAN, CE8851K, CE8850-HAM</span>, and are forwarded on the <span>CE6855-48XS8CQ, CE6863E-48S8CQ, CE6885, CE6885-LL, CE6885-SAN, CE6885-T, CE8851-32CQ4BQ, CE8855</span>.</p>
<p id="EN-US_TASK_0000001563750005__p1232617341316">If any of the following exists on the PFC-enabled network, you need to set the forwarding behavior of all devices the network to discard during the recovery period of hardware-based deadlock detection: <span>CE6866, CE6860-SAN, CE6866K, CE6860-HAM, CE8851-32CQ8DQ-P, CE8850-SAN, CE8851K, CE8850-HAM</span></p>
<div class="note" id="EN-US_TASK_0000001563750005__note137961255143810"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0000001563750005__p8796115583816">The commands used to set the detection period and recovery period for hardware-based deadlock detection and the command used to configure the packet processing behavior of the device during the recovery period take effect for both PFC and antilocking PFC.</p>
</div></div>
</p></li><li id="EN-US_TASK_0000001563750005__step814088294175324"><span id="EN-US_TASK_0000001563750005__en-us_task_0138780877_cmd764557967182229">Commit the configuration.</span><p><pre class="screen" id="EN-US_TASK_0000001563750005__screen716892653310"><a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001563750005__en-us_task_0138780877_cmdname1903563622182229">commit</span></b></a></pre>
</p></li></ol></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="galaxy_dcb_cfg_0009.html">Configuring PFC
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="galaxy_dcb_cfg_0010.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="galaxy_dcb_cfg_0012.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>