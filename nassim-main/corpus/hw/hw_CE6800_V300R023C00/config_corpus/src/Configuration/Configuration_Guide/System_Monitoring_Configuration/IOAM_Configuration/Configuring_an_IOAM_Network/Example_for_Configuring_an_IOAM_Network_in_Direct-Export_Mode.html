
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring an IOAM Network in Direct-Export Mode">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="galaxy_ioam_cfg_0008.html">
<meta name="DC.Relation" scheme="URI" content="galaxy_ioam_cfg_0023.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="IOAM">
<meta name="featuretype" content="System Monitoring">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="IOAM">
<meta name="featuretype" content="System Monitoring">
<meta name="featurename" content="IOAM">
<meta name="featuretype" content="System Monitoring">
<meta name="featuretype" content="System Monitoring">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001513158058">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring an IOAM Network in Direct-Export Mode</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001513158058"></a><a name="EN-US_TASK_0000001513158058"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring an IOAM Network in Direct-Export Mode</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001513158058__1.3.1"></a><a name="1.3.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>In <a href="#EN-US_TASK_0000001513158058__fig086114419616">Figure 1</a>, packets sent from Host1 to Host2 are forwarded on the IOAM network. The network administrator wants to monitor the status of each node on the forwarding path from Host1 to Host2 in order to quickly determine service connectivity and locate faulty nodes in the event of a service fault.</p>
<div class="fignone" id="EN-US_TASK_0000001513158058__fig086114419616"><a name="EN-US_TASK_0000001513158058__fig086114419616"></a><a name="fig086114419616"></a><span class="figcap"><b>Figure 1 </b>IOAM networking in direct-export mode</span><div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface 1 represents <span>100GE</span> <span>1/0/1</span>.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0000001563758497.png" width="NaN" height="NaN"></span></div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001513158058__1.3.2"></a><a name="1.3.2"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Enable the IOAM function.</span><p><p># On <span class="keyword">DeviceA</span>, enter the IOAM view, enable the IOAM function, and set the device ID to 11 and namespace ID to 20.</p>
</p><p><pre class="screen">&lt;HUAWEI&gt; <strong>system-view</strong>
&lt;<font style="font-size:8pt" Face="Courier New" >~</font>HUAWEI&gt; <strong>sysname DeviceA</strong>
[*HUAWEI]<strong> <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceA]<strong> </strong><a href="cmdqueryname=ptp+enable"><b><span class="cmdname">ptp enable</span></b></a>
[*DeviceA]<strong> <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceA]<strong> <a href="cmdqueryname=ioam"><b><span class="cmdname">ioam</span></b></a></strong>
[*DeviceA-ioam]<strong> <a href="cmdqueryname=enable"><b><span class="cmdname">enable</span></b></a></strong>
[*DeviceA-ioam]<strong> <a href="cmdqueryname=device-id"><b><span class="cmdname">device-id</span></b></a> 11</strong>
[*DeviceA-ioam]<strong> <a href="cmdqueryname=namespace-id"><b><span class="cmdname">namespace-id</span></b></a> 20</strong>
[*DeviceA-ioam]<strong> <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></strong>
[*DeviceA]<strong> <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></strong></pre>
</p><p><p># On <span class="keyword">DeviceB</span>, enter the IOAM view, enable the IOAM function, and set the device ID to 12 and namespace ID to 20.</p>
</p><p><pre class="screen">&lt;HUAWEI&gt; <strong>system-view</strong>
&lt;<font style="font-size:8pt" Face="Courier New" >~</font>HUAWEI&gt; <strong>sysname DeviceB</strong>
[*HUAWEI]<strong> <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceB]<strong> </strong><a href="cmdqueryname=ptp+enable"><b><span class="cmdname">ptp enable</span></b></a>
[*DeviceB]<strong> <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceB]<strong> <a href="cmdqueryname=ioam"><b><span class="cmdname">ioam</span></b></a></strong>
[*DeviceB-ioam]<strong> <a href="cmdqueryname=enable"><b><span class="cmdname">enable</span></b></a></strong>
[*DeviceB-ioam]<strong> <a href="cmdqueryname=device-id"><b><span class="cmdname">device-id</span></b></a> 12</strong>
[*DeviceB-ioam]<strong> <a href="cmdqueryname=namespace-id"><b><span class="cmdname">namespace-id</span></b></a> 20</strong>
[*DeviceB-ioam]<strong> <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></strong>
[*DeviceB]<strong> <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></strong></pre>
</p><p><p># On <span class="keyword">DeviceC</span>, enter the IOAM view, enable the IOAM function, and set the device ID to 13 and namespace ID to 20.</p>
</p><p><pre class="screen">&lt;HUAWEI&gt; <strong>system-view</strong>
&lt;<font style="font-size:8pt" Face="Courier New" >~</font>HUAWEI&gt; <strong>sysname DeviceC</strong>
[*HUAWEI]<strong> <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceC]<strong> </strong><a href="cmdqueryname=ptp+enable"><b><span class="cmdname">ptp enable</span></b></a>
[*DeviceC]<strong> <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceC]<strong> <a href="cmdqueryname=ioam"><b><span class="cmdname">ioam</span></b></a></strong>
[*DeviceC-ioam]<strong> <a href="cmdqueryname=enable"><b><span class="cmdname">enable</span></b></a></strong>
[*DeviceC-ioam]<strong> <a href="cmdqueryname=device-id"><b><span class="cmdname">device-id</span></b></a> 13</strong>
[*DeviceC-ioam]<strong> <a href="cmdqueryname=namespace-id"><b><span class="cmdname">namespace-id</span></b></a> 20</strong>
[*DeviceC-ioam]<strong> <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></strong>
[*DeviceC]<strong> <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></strong></pre>
</p></li><li><span>Configure DeviceA as the encapsulation node to sample the service traffic sent from Host1 to Host2 based on ACL rules, and set the data collection mode to direct-export mode.</span><p><p># Create advanced ACL 3001 on <span class="keyword">DeviceA</span> to match TCP packets sent from Host1 at 10.1.1.1 to Host2 at 10.1.2.1.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceA]<strong> acl 3001</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">DeviceA</span>-acl4-advance-3001] <strong>rule permit tcp source 10.1.1.1 0.0.0.0 destination 10.1.2.1 0.0.0.0 </strong>
[<span class="keyword">*</span><span class="keyword">DeviceA-acl4-advance-3001</span>] <strong>quit</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
<p># On <span class="keyword">DeviceA</span>, create an analyzer with the ID 1, and set the source IP address to the device's IP address 10.2.2.1, destination IP address to the analyzer's IP address 10.2.2.2, and the analyzer's port number to 9000. Ensure that there are reachable routes between the device and analyzer. For detailed configurations, see "Configuration Scripts".</p>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">DeviceA</span>] <strong>collector </strong><strong>collect </strong><strong>1</strong>
[<span class="keyword">*</span><span class="keyword">DeviceA</span>-collect-1] <strong>source ip 10.1.3.1 export host ip 10.2.2.2 udp-port 9000</strong>
[<span class="keyword">*</span><span class="keyword">DeviceA</span>-collect-1] <strong>quit</strong>
[<span class="keyword">*</span><span class="keyword">DeviceA</span>] <strong>commit</strong></pre>
<p># On <span class="keyword">DeviceA</span>, enter the IOAM view, set the ID of the analyzer to which IOAM data is sent to 1, enter the view of the IOAM profile named <strong>default</strong>, and create an IOAM policy named <strong>1</strong>.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceA]<strong> <a href="cmdqueryname=ioam"><b><span class="cmdname">ioam</span></b></a></strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceA-ioam]<strong> <a href="cmdqueryname=collector"><b><span class="cmdname">collector</span></b></a> collect 1</strong>
[*DeviceA-ioam]<strong> <a href="cmdqueryname=profile+default"><b><span class="cmdname">profile default</span></b></a></strong>
[*DeviceA-ioam-profile-default]<strong> <a href="cmdqueryname=policy"><b><span class="cmdname">policy</span></b></a></strong> <strong>1</strong>
[*DeviceA-ioam-profile-default-policy-1]<strong> <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></strong></pre>
<p># On <span class="keyword">DeviceA</span>, enter the IOAM policy view, set the data collection mode to direct-export mode, and configure advanced ACL 3001 to match packets.</p>
<pre class="screen">[*DeviceA-ioam-profile-default]<strong> <a href="cmdqueryname=policy"><b><span class="cmdname">policy</span></b></a></strong> <strong>1</strong>
[*DeviceA-ioam-profile-default-policy-1]<strong> <a href="cmdqueryname=action-type+encapsulate"><b><span class="cmdname">action-type encapsulate</span></b></a></strong> <strong>service-type direct-export</strong>
[*DeviceA-ioam-profile-default-policy-1]<strong> <a href="cmdqueryname=acl+3001"><b><span class="cmdname">acl 3001 </span></b></a></strong>
[*DeviceA-ioam-profile-default-policy-1]<strong> <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></strong>
[*DeviceA-ioam-profile-default]<strong> <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></strong>
[*DeviceA-ioam]<strong> <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></strong>
[*DeviceA]<strong> <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></strong></pre>
</p></li><li><span>Configure DeviceB as the transit node to send IOAM packets to the analyzer.</span><p><div class="p"># On <span class="keyword">DeviceB</span>, create an analyzer with the ID 1, and set the source IP address to the device's IP address 10.1.4.1, destination IP address to the analyzer's IP address 10.2.2.2, and the analyzer's port number to 9000. Ensure that there are reachable routes between the device and analyzer. For detailed configurations, see "Configuration Scripts".<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font><span class="keyword">DeviceB</span>] <strong>collector </strong><strong>collect </strong><strong>1</strong>
[*<span class="keyword">DeviceB</span>-collect-1] <strong>source ip 10.1.4.1 export host ip 10</strong>.<strong>2.2.2 udp-port 9000</strong>
[*<span class="keyword">DeviceB</span>-collect-1] <strong>quit</strong>
[*<span class="keyword">DeviceB</span>] <strong>commit</strong></pre>
</div>
</p><p><div class="p"># On <span class="keyword">DeviceB</span>, set the ID of the analyzer to which IOAM data is sent to 1, and enable the transmission function.<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font><span class="keyword">DeviceB</span>] <strong>ioam</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font><span class="keyword">DeviceB</span>-ioam]<strong> <a href="cmdqueryname=collector"><b><span class="cmdname">collector</span></b></a> collect 1</strong>
[*DeviceC-ioam]<strong> </strong><strong>action-type transit</strong>
[*<span class="keyword">DeviceB</span>-ioam] <strong>quit</strong>
[*<span class="keyword">DeviceB</span>] <strong>commit</strong></pre>
</div>
</p></li><li><span>Configure DeviceC as the decapsulation node to send IOAM packets to the analyzer.</span><p><div class="p"># On <span class="keyword">DeviceC</span>, create an analyzer with the ID 1, and set the source IP address to the device's IP address 10.1.5.1, destination IP address to the analyzer's IP address 10.2.2.2, and the analyzer's port number to 9000. Ensure that there are reachable routes between the device and analyzer. For detailed configurations, see "Configuration Scripts".<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font><span class="keyword">DeviceC</span>] <strong>collector </strong><strong>collect </strong><strong>1</strong>
[*<span class="keyword">DeviceC</span>-collect-1] <strong>source ip 10.1.5.1 export host ip 10.2.2.2 udp-port 9000</strong>
[*<span class="keyword">DeviceC</span>-collect-1] <strong>quit</strong>
[*<span class="keyword">DeviceC</span>] <strong>commit</strong></pre>
</div>
</p><p><p># On <span class="keyword">DeviceC</span>, enter the IOAM view, set the ID of the analyzer to which IOAM data is sent to 1, and enable the decapsulation function.</p>
</p><p><pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceC]<strong> <a href="cmdqueryname=ioam"><b><span class="cmdname">ioam</span></b></a></strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceC-ioam]<strong> <a href="cmdqueryname=collector"><b><span class="cmdname">collector</span></b></a> collect 1</strong>
[*DeviceC-ioam]<strong> </strong><strong>action-type decapsulate</strong>
[*DeviceC-ioam] <strong>quit</strong>
[*DeviceC]<strong> <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></strong></pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001513158058__1.3.3"></a><a name="1.3.3"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p># Check the application of the ACL rule on <span class="keyword">Device</span>A.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceA] <strong>display ioam encapsulate acl applied-record slot 1</strong>
Total records: 1 
--------------------------------------------------------------------------------
ACL Number/Name                    TYPE   Rule       Count   State
--------------------------------------------------------------------------------
3001                               IPv4   5          1       Success
--------------------------------------------------------------------------------</pre>
</div>
<div class="postreq"><a name="EN-US_TASK_0000001513158058__1.3.4"></a><a name="1.3.4"></a><h4 class="sectiontitle">Configuration Scripts</h4><p>DeviceA</p>
<pre class="screen">#
sysname DeviceA
#
vlan 10
#
interface Vlanif10
 ip address 10.2.2.1 255.255.255.0
#
interface <span>100GE</span><span>1/0/1</span>
 port link-type trunk
 port trunk allow-pass vlan 10
#
arp static 10.2.2.2 00e0-fc12-3456 vlan 10 interface <span>100GE</span><span>1/0/1</span>
#
ptp enable
#
ioam
 enable
 namespace-id 20
 device-id 11
 collector collect 1
 #
 profile default
  #
  policy 1
   action-type encapsulate service-type direct-export
   acl 3001
#
collector collect 1
 source ip 10.1.3.1 export host ip 10.2.2.2 udp-port 9000 
#
acl number 3001
 rule 5 permit tcp source 10.1.1.1 0 destination 10.1.2.1 0
# 
return</pre>
<p>DeviceB</p>
<pre class="screen">#
sysname DeviceB
#
vlan 10
#
interface Vlanif10
 ip address 10.2.2.1 255.255.255.0
#
interface <span>100GE</span><span>1/0/1</span>
 port link-type trunk
 port trunk allow-pass vlan 10
#
arp static 10.2.2.2 00e0-fc12-3457 vlan 10 interface <span>100GE</span><span>1/0/1</span>
#
ptp enable
#
ioam
 enable
 namespace-id 20
 device-id 12
 action-type transit
 collector collect 1                                                              
#
collector collect 1 
 source ip 10.1.4.1 export host ip 10.2.2.2 udp-port 9000 
#
return</pre>
<p>DeviceC</p>
<pre class="screen">#
sysname DeviceC
#
vlan 10
#
interface Vlanif10
 ip address 10.2.2.1 255.255.255.0
#
interface <span>100GE</span><span>1/0/1</span>
 port link-type trunk
 port trunk allow-pass vlan 10
#
arp static 10.2.2.2 00e0-fc12-3458 vlan 10 interface <span>100GE</span><span>1/0/1</span>
#
ptp enable
#
ioam
 enable
 namespace-id 20
 device-id 13
 action-type decapsulate
 collector collect 1                                                           
# 
collector collect 1
 source ip 10.1.5.1 export host ip 10.2.2.2 udp-port 9000 
#
return</pre>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="galaxy_ioam_cfg_0008.html">Configuring an IOAM Network
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="galaxy_ioam_cfg_0023.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>
</body>
</html>