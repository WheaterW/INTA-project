
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring Longest Match for Multicast Route Selection">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="vrp_mcast_cfg_0001.html">
<meta name="DC.Relation" scheme="URI" content="vrp_mcast_cfg_0008.html">
<meta name="DC.Relation" scheme="URI" content="vrp_mcast_cfg_0014.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="IPv4 Multicast Route Management">
<meta name="featuretype" content="IP Multicast">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="IPv4 Multicast Route Management">
<meta name="featuretype" content="IP Multicast">
<meta name="featuretype" content="IP Multicast">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001176662535">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>Configuring Longest Match for Multicast Route Selection</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001176662535"></a><a name="EN-US_TASK_0000001176662535"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring Longest Match for Multicast Route Selection</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001176662535__1.3.1"></a><a name="1.3.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>By default, a device selects routes according to the route preference during an RPF check. You can change the default RPF route selection rules by configuring longest match for multicast routes. With this configuration, when a device selects an RPF route, it first compares the mask matching lengths of routes and then compares route preferences.</p>
<p>The rules for selecting routes based on the longest match rule are as follows:</p>
<ol><li>The multicast device preferentially selects the route whose destination address has the longest matching mask with the source address. For example, a host with address 192.168.1.1 needs multicast data from the multicast source with address 10.1.1.1. Two reachable routes to the multicast source are found after a lookup of the multicast static routing table and unicast routing table. Their destination subnets are 10.1.0.0/16 and 10.1.1.0/24, respectively. Based on the longest match rule for route selection, the route to subnet 10.1.1.0/24 is chosen for multicast data forwarding.</li><li>If the mask matching lengths are the same, the route with a higher preference is selected for multicast data forwarding. </li><li>If the mask matching lengths and the route preferences are the same, a route is selected in the following order of preference for multicast data forwarding: multicast static route &gt; unicast route.</li><li>If all the preceding conditions cannot determine a forwarding path for multicast data (multiple equal-cost routes exist), the route with the largest next-hop IP address is selected for multicast data forwarding.</li></ol>
</div></div>
<div class="steps-unordered"><a name="EN-US_TASK_0000001176662535__1.3.2"></a><a name="1.3.2"></a><h4 class="sectiontitle">Procedure</h4>
<ul><li><span>Public network instance</span><ol><li class="substepexpand"><span>Enter the system view.</span><p><pre class="screen"><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></pre>
</p></li><li class="substepexpand"><span>Enable the multicast function.</span><p><pre class="screen"><a href="cmdqueryname=multicast+routing-enable"><b><span class="cmdname">multicast routing-enable</span></b></a></pre>
</p></li><li class="substepexpand"><span>Configure longest-match route selection for the public network instance.</span><p><pre class="screen"><a href="cmdqueryname=multicast+longest-match"><b><span class="cmdname">multicast longest-match</span></b></a></pre>
</p></li><li class="substepexpand"><span>Commit the configuration.</span><p><pre class="screen"><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></pre>
</p></li></ol>
</li><li><span>VPN instance</span><ol><li class="substepexpand"><span>Enter the system view.</span><p><pre class="screen"><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></pre>
</p></li><li class="substepexpand"><span>Enter the VPN instance view.</span><p><pre class="screen"><a href="cmdqueryname=ip+vpn-instance"><b><span class="cmdname">ip vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i></pre>
</p></li><li class="substepexpand"><span>Enable the IPv4 address family for the VPN instance and enter the VPN instance IPv4 address family view.</span><p><pre class="screen"><a href="cmdqueryname=ipv4-family"><b><span class="cmdname">ipv4-family</span></b></a></pre>
</p></li><li class="substepexpand"><span>Set an RD for the VPN instance IPv4 address family.</span><p><pre class="screen"><a href="cmdqueryname=route-distinguisher"><b><span class="cmdname">route-distinguisher</span></b></a> <i><span class="varname">route-distinguisher</span></i></pre>
<p>Only after an RD is configured for this family can other configurations be performed for the VPN instance IPv4 address family.</p>
</p></li><li class="substepexpand"><span>Enable the multicast function.</span><p><pre class="screen"><a href="cmdqueryname=multicast+routing-enable"><b><span class="cmdname">multicast routing-enable</span></b></a></pre>
</p></li><li class="substepexpand"><span>Configure longest-match route selection for the VPN instance.</span><p><pre class="screen"><a href="cmdqueryname=multicast+longest-match"><b><span class="cmdname">multicast longest-match</span></b></a></pre>
<div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>VPN instance-related configurations apply only to provider edges (PEs). To configure longest match for multicast routes in a VPN instance on a PE, you must perform the configuration in the VPN instance. For other cases, configurations need to be performed in the public network instance.</p>
</div></div>
</p></li><li class="substepexpand"><span>Commit the configuration.</span><p><pre class="screen"><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></pre>
</p></li></ol>
</li></ul></div>
<div class="example"><a name="EN-US_TASK_0000001176662535__1.3.3"></a><a name="1.3.3"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p>Run the <a href="cmdqueryname=display+multicast"><b><span class="cmdname">display multicast</span></b></a> <span>[ <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i> | <strong><span>all-instance</span></strong> ]</span> <strong><span>rpf-info</span></strong> <i><span class="varname">source-address</span></i> [ <i><span class="varname">group-address</span></i> ] [ <strong><span>rpt</span></strong> | <strong><span>spt</span></strong> ] [ <strong><span>verbose</span></strong> ] command to check the RPF route information of a specific multicast source.</p>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="vrp_mcast_cfg_0001.html">IPv4 Multicast Route Management Configuration
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="vrp_mcast_cfg_0008.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="vrp_mcast_cfg_0014.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>