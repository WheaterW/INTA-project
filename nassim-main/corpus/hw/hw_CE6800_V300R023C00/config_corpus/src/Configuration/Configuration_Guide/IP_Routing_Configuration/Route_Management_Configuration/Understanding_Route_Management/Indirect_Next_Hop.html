
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="concept">
<meta name="DC.Title" content="Indirect Next Hop">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../vrp_ip_routing_management_cfg_0003.html">
<meta name="DC.Relation" scheme="URI" content="../vrp/feature_0003999999.html">
<meta name="DC.Relation" scheme="URI" content="../vrp/feature_0003994691.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="Route Management">
<meta name="featuretype" content="IP Routing">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="Route Management">
<meta name="featuretype" content="IP Routing">
<meta name="featurename" content="Route Management">
<meta name="featuretype" content="IP Routing">
<meta name="featuretype" content="IP Routing">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_CONCEPT_0000001176742209">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="../public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="../public_sys-resources/browseVersion.js"></script>
<title>Indirect Next Hop</title>
</head>
<body><a name="EN-US_CONCEPT_0000001176742209"></a><a name="EN-US_CONCEPT_0000001176742209"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Indirect Next Hop</h1>
<div><div class="section"><h4 class="sectiontitle">Definition</h4><p>The indirect next hop technology changes a direct association between route prefixes and next-hop information to an indirect association, speeding up route convergence. Indirect next hop allows next-hop information mapped to a prefix to be refreshed separately from other prefixes of the same next hop, which speeds up route convergence.</p>
</div>
<div class="section"><h4 class="sectiontitle">Purpose</h4><p>In a scenario requiring route recursion, when IGP route or tunnel switching occurs, the indirect next hop function helps a device rapidly refresh forwarding entries, which implements fast route convergence and minimizes the impact of route or tunnel switching on services.</p>
</div>
<div class="section"><h4 class="sectiontitle">Next-Hop Information</h4><p>Mapping between route prefixes and next-hop information is the basis of indirect next hop. Next-hop information includes the address family, original next-hop IP address, and tunnel policy, which meets various route and tunnel recursion requirements. A device assigns an index to each piece of next-hop information, performs route recursion, notifies the recursive route to a routing protocol, and delivers a forwarding entry to the forwarding table.</p>
</div>
<div class="section"><h4 class="sectiontitle">On-Demand Route Recursion</h4><p>Devices forward packets over dependent routes. Route recursion refers to the process of finding a dependent route based on a next-hop IP address, which is called route recursion.</p>
<p>On-demand route recursion indicates that once a dependent route changes, recursion is performed only for the next hop associated with the dependent route. If the destination address of the dependent route is an original next-hop IP address or network segment address contained in next-hop information, a dependent route change affects the recursion for the next-hop information. In other situations, dependent route changes do not affect the recursion for next-hop information. Therefore, if a dependent route changes, re-recursion is performed only for the next-hop information associated with the corresponding destination address of the changed route. For example, if the original next-hop IP address of a route to 10.2.2.2/32 is 10.1.1.1, the dependent route may be 10.1.1.1/32 or 10.1.0.0/16. If the route to 10.1.1.1/32 or 10.1.0.0/16 changes, the recursion of the original next hop 10.1.1.1 is affected.</p>
<p>With respect to tunnel recursion, when a tunnel alternates between up and down, a device merely needs to re-recurse the next-hop information whose original next-hop address is the same as the destination address of the tunnel.</p>
</div>
<div class="section"><h4 class="sectiontitle">Indirect Next Hop Implementation</h4><p>Without indirect next hop, forwarding information and prefixes are in one-to-one mapping. Subsequently, the total convergence time is in direct proportion to the number of prefixes. With indirect next hop enabled, in the case of mapping between numerous prefixes and the same next hop, only the next hop-specific forwarding information needs to be added to the forwarding table, so that traffic related to the route prefixes can be switched simultaneously, speeding up route convergence.</p>
<div class="fignone" id="EN-US_CONCEPT_0000001176742209__fig_dc_vrp_ip-route_feature_001401"><a name="EN-US_CONCEPT_0000001176742209__fig_dc_vrp_ip-route_feature_001401"></a><a name="fig_dc_vrp_ip-route_feature_001401"></a><span class="figcap"><b>Figure 1 </b>Implementation without indirect next hop used</span><br><span><img class="vsd" src="figure/en-us_image_0000001176742235.png" width="NaN" height="NaN"></span></div>
<p>In <a href="#EN-US_CONCEPT_0000001176742209__fig_dc_vrp_ip-route_feature_001401">Figure 1</a>, without indirect next hop, prefixes are independent, and each prefix is separately mapped to its next hop and forwarding information. If a dependent route changes, recursion is performed for the next-hop information mapped to each prefix, and forwarding information is updated based on the prefix. In this case, the convergence time is in direct proportion to the number of prefixes.</p>
<p>Note that prefixes of the same BGP peer have the same next hop, forwarding information, and refreshed forwarding information.</p>
<div class="fignone" id="EN-US_CONCEPT_0000001176742209__fig_dc_vrp_ip-route_feature_001402"><a name="EN-US_CONCEPT_0000001176742209__fig_dc_vrp_ip-route_feature_001402"></a><a name="fig_dc_vrp_ip-route_feature_001402"></a><span class="figcap"><b>Figure 2 </b>Implementation with indirect next hop used</span><br><span><img class="vsd" src="figure/en-us_image_0000001176662323.png" width="NaN" height="NaN"></span></div>
<p>As shown in <a href="#EN-US_CONCEPT_0000001176742209__fig_dc_vrp_ip-route_feature_001402">Figure 2</a>, with indirect next hop, prefixes of routes from the same BGP peer share the next hop. When a dependent route changes, only the shared next hop participates in recursion and forwarding information mapped to the next hop is updated. In this case, routes of all prefixes can converge simultaneously, and the convergence time is irrelevant to the number of prefixes.</p>
</div>
<div class="section"><h4 class="sectiontitle">Comparison Between Route Recursion and Tunnel Recursion</h4><p><a href="#EN-US_CONCEPT_0000001176742209__tab_dc_vrp_ip-route_feature_001401">Table 1</a> describes the differences between route recursion and tunnel recursion.</p>

<div class="tableBorder"><a name="EN-US_CONCEPT_0000001176742209__tab_dc_vrp_ip-route_feature_001401"></a><a name="tab_dc_vrp_ip-route_feature_001401"></a><table cellpadding="4" cellspacing="0" summary="" id="EN-US_CONCEPT_0000001176742209__tab_dc_vrp_ip-route_feature_001401" frame="border" border="1" rules="all"><caption><b>Table 1 </b>Comparison between route recursion and tunnel recursion</caption><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="22.99%" id="mcps1.3.6.3.2.3.1.1" liSelected="liSelected"><p>Recursion Type</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="77.01%" id="mcps1.3.6.3.2.3.1.2" liSelected="liSelected"><p>Characteristics</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" valign="top" width="22.99%" headers="mcps1.3.6.3.2.3.1.1 "><p>Route recursion</p>
</td>
<td class="cellrowborder" valign="top" width="77.01%" headers="mcps1.3.6.3.2.3.1.2 "><ul><li><p>Applies to BGP public network routes.</p>
</li><li><p>Is triggered by route changes.</p>
</li><li><p>Supports next hop recursion based on a specified route-policy.</p>
</li></ul>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="22.99%" headers="mcps1.3.6.3.2.3.1.1 "><p>Tunnel recursion</p>
</td>
<td class="cellrowborder" valign="top" width="77.01%" headers="mcps1.3.6.3.2.3.1.2 "><ul><li><p>Applies to BGP VPN routes.</p>
</li><li><p>Is triggered by tunnel or tunnel policy changes.</p>
</li><li><p>Uses tunnel policies to control recursion behaviors to meet requirements in different scenarios.</p>
</li></ul>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section"><h4 class="sectiontitle">IBGP Route Recursion to an IGP Route</h4><div class="fignone" id="EN-US_CONCEPT_0000001176742209__fig_dc_vrp_ip-route_feature_001403"><a name="EN-US_CONCEPT_0000001176742209__fig_dc_vrp_ip-route_feature_001403"></a><a name="fig_dc_vrp_ip-route_feature_001403"></a><span class="figcap"><b>Figure 3 </b>Network diagram of IBGP route recursion</span><br><span><img class="vsd" src="figure/en-us_image_0000001130782566.png" width="NaN" height="NaN"></span></div>
<p>As shown in <a href="#EN-US_CONCEPT_0000001176742209__fig_dc_vrp_ip-route_feature_001403">Figure 3</a>, an IBGP peer relationship is established between DeviceA and DeviceD. The IBGP peer relationship is usually established between two loopback interfaces on the routing devices. As the next hop of the IBGP route is not directly reachable, it cannot be used to guide packet forwarding. Therefore, to refresh the forwarding table and guide packet forwarding, a device needs to search for an eligible outbound interface and directly connected next hop based on the original IBGP next hop.</p>
<p>DeviceD receives 100,000 routes, which have the same original BGP next hop, from DeviceA. After recursion is performed, these routes follow the same IGP path (DeviceA -&gt; DeviceB -&gt; DeviceD). If the IGP path (DeviceA -&gt; DeviceB -&gt; DeviceD) fails, recursion does not need to be performed to each of these IBGP routes, and the relevant forwarding entries do not need to be refreshed one by one. Note that only the shared next hop participates in recursion and needs to be refreshed. Consequently, these IBGP routes converge to the path (DeviceA -&gt; DeviceC -&gt; DeviceD) on the forwarding plane. Therefore, the convergence time depends on only the number of next hops, not the number of prefixes.</p>
<p>If DeviceA and DeviceD establish a multi-hop EBGP peer relationship, the convergence procedure is the same as the preceding one. Indirect next hop also applies to the recursion of a multi-hop EBGP route.</p>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../vrp_ip_routing_management_cfg_0003.html">Understanding Route Management
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../vrp/feature_0003999999.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../vrp/feature_0003994691.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>