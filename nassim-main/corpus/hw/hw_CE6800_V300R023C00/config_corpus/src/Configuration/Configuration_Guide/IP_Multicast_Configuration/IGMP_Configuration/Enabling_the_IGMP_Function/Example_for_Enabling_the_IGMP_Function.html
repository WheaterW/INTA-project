
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Enabling the IGMP Function">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="vrp_igmp_cfg_0010.html">
<meta name="DC.Relation" scheme="URI" content="vrp_igmp_cfg_0015.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="IGMP">
<meta name="featuretype" content="IP Multicast">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="IGMP">
<meta name="featuretype" content="IP Multicast">
<meta name="featurename" content="IGMP">
<meta name="featuretype" content="IP Multicast">
<meta name="featuretype" content="IP Multicast">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001130624422">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>Example for Enabling the IGMP Function</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001130624422"></a><a name="EN-US_TASK_0000001130624422"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Enabling the IGMP Function</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001130624422__1.3.1"></a><a name="1.3.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>Multicast services need to be deployed on the PIM network shown in <a href="#EN-US_TASK_0000001130624422__fig_dc_vrp_multicast_cfg_206801">Figure 1</a>. Hosts (HostA, HostB, HostC, and HostD in the figure) on the network are required to receive VOD information in multicast mode. HostA and HostB are required to steadily receive popular programs from the multicast group 225.1.1.1.</p>
<div class="fignone" id="EN-US_TASK_0000001130624422__fig_dc_vrp_multicast_cfg_206801"><a name="EN-US_TASK_0000001130624422__fig_dc_vrp_multicast_cfg_206801"></a><a name="fig_dc_vrp_multicast_cfg_206801"></a><span class="figcap"><b>Figure 1 </b>Network diagram of enabling the IGMP function</span><div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface1, interface2, interface3, and interface4 represent <span>100GE</span><span>1/0/1</span>, <span>100GE</span><span>1/0/2</span>, <span>100GE</span><span>1/0/3</span>, and <span>100GE</span><span>1/0/4</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0000001261567149.png" width="NaN" height="NaN"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001130624422__1.3.2"></a><a name="1.3.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure IP addresses and a unicast routing protocol for interfaces on each device to ensure connectivity at the network layer.</p>
</li><li><p>Configure basic multicast functions on each device to implement multicast data forwarding on the network.</p>
</li><li><p>Enable IGMP on the interfaces connected to user hosts.</p>
</li><li><p>Add DeviceA's interface1 to the multicast group 225.1.1.1 statically.</p>
</li></ol>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001130624422__1.3.3"></a><a name="1.3.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure IP addresses and a unicast routing protocol for interfaces on each device.</span><p><p># Configure DeviceA.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname DeviceA</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>interface <span>100ge</span> <span>1/0/1</span></strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>undo portswitch</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>ip address 10.110.1.1 24</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>interface <span>100ge</span> <span><span><span>1/0/2</span></span></span></strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/2</span>] <strong>undo portswitch</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/2</span>] <strong>ip address 192.168.1.1 24</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/2</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>ospf 1</strong>
[<span class="keyword">*</span>DeviceA-ospf-1] <strong>area 0.0.0.0</strong>
[<span class="keyword">*</span>DeviceA-ospf-1-area-0.0.0.0] <strong>network 192.168.1.0 0.0.0.255</strong>
[<span class="keyword">*</span>DeviceA-ospf-1-area-0.0.0.0] <strong>network 10.110.1.0 0.0.0.255</strong>
[<span class="keyword">*</span>DeviceA-ospf-1-area-0.0.0.0] <strong>quit</strong>
[<span class="keyword">*</span>DeviceB-ospf-1] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>commit</strong></pre>
<p>The configurations of DeviceB, DeviceC, and DeviceD are similar to the configuration of DeviceA. For detailed configurations, see Configuration Scripts.</p>
</p></li><li><span>Enable the multicast function on all the devices, enable PIM-SM on all the involved interfaces, and configure RPs.</span><p><p># Configure DeviceA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>multicast routing-enable</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>interface <span>100ge</span> <span>1/0/1</span></strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-<span>100GE</span><span>1/0/1</span>] <strong>pim sm</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-<span>100GE</span><span>1/0/1</span>] <strong>quit</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>interface </strong><strong><span>100ge</span> <span>1/0/2</span></strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-<span>100GE</span><span>1/0/2</span>] <strong>pim sm</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-<span>100GE</span><span>1/0/2</span>] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>pim</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-pim] <strong>c-bsr <span>100ge</span> <span>1/0/2</span></strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-pim] <strong>c-rp <span>100ge</span> <span>1/0/2</span></strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-pim] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>commit</strong></pre>
<p>The configurations of DeviceB, DeviceC, and DeviceD are similar to the configuration of DeviceA. For detailed configurations, see Configuration Scripts.</p>
</p></li><li><span>Enable IGMP on the interfaces connected to user hosts.</span><p><p># Configure <span class="keyword">Device</span>A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>interface <span>100ge</span> <span>1/0/1</span></strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-<span>100GE</span><span>1/0/1</span>] <strong>igmp enable</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-<span>100GE</span><span>1/0/1</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>commit</strong></pre>
<p>The configurations of DeviceB and DeviceC are similar to the configuration of DeviceA. For detailed configurations, see Configuration Scripts.</p>
</p></li><li><span>Add <span class="keyword">Device</span>A's interface1 to the multicast group 225.1.1.1 statically.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>interface <span>100ge</span> <span>1/0/1</span></strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-<span>100GE</span><span>1/0/1</span>] <strong>igmp static-group 225.1.1.1</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-<span>100GE</span><span>1/0/1</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>commit</strong></pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001130624422__1.3.4"></a><a name="1.3.4"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p># Run the <strong>display igmp interface</strong> command to check IGMP information on interfaces. For example, the IGMP information on <span class="keyword">Device</span>B's interface1 is as follows:</p>
<pre class="screen">&lt;<span class="keyword">Device</span>B&gt; <strong>display igmp interface</strong>
Interface information of VPN Instance: public net
 <span>100GE</span><span>1/0/1</span>(10.110.2.1):
   IGMP is enabled   
   Current IGMP version is 2   
   IGMP state: up
   IGMP group policy: none
   IGMP limit: -
   <span>Q</span>uery interval for IGMP (negotiated): -
   <span>Q</span>uery interval for IGMP(configured): 60 s
   Other querier timeout for IGMP: 0 s
   <span>M</span>aximum query response time for IGMP: 10 s
   <strong>Querier for IGMP: 10.110.2.1 (this router)</strong>
   Total 1 IGMP Group reported</pre>
<p>The command output shows that <span class="keyword">Device</span>B is the querier. This is because the IP address of <span class="keyword">Device</span>B's interface1, which is connected to the user network segment, is lower.</p>
<p># Run the <a href="cmdqueryname=display+pim+routing-table"><b><span class="cmdname">display pim routing-table</span></b></a> command on <span class="keyword">Device</span>A to check whether interface1 is statically added to the multicast group 225.1.1.1. If the (*, 225.1.1.1) entry exists, the downstream interface is interface1, and the protocol type is static, interface1 has been statically added to the multicast group 225.1.1.1. The command output is as follows:</p>
<pre class="screen">&lt;<span class="keyword">Device</span>A&gt; <strong>display pim routing-table</strong>
VPN-Instance: public net
 Total 1 (*, G) entry; 0 (S, G) entry
 <strong>(*, 225.1.1.1)</strong>
     RP: 192.168.4.1
     Protocol: pim-sm, Flag: WC
     UpTime: 00:12:17
     Upstream interface: <span>100GE</span><span>1/0/2</span>, Refresh time: 00:12:17
         Upstream neighbor: 192.168.1.2
         RPF prime neighbor: 192.168.1.2
     Downstream interface(s) information:
     Total number of downstreams: 1
         1: <strong><span>100GE</span></strong><strong><span>1/0/1</span></strong>
             <strong>Protocol: static</strong>, UpTime: 00:12:17, Expires: -</pre>
</div>
<div class="postreq"><a name="EN-US_TASK_0000001130624422__1.3.5"></a><a name="1.3.5"></a><h4 class="sectiontitle">Configuration Scripts</h4><ul><li><p><span class="keyword">Device</span>A</p>
<pre class="screen">#
sysname <span class="keyword">Device</span>A
#
multicast routing-enable
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 10.110.1.1 255.255.255.0
 pim sm
 igmp enable
 igmp static-group 225.1.1.1
#
interface <span>100GE</span><span>1/0/2</span> 
 undo portswitch
 ip address 192.168.1.1 255.255.255.0
 pim sm
#
ospf 1
 area 0.0.0.0
  network 192.168.1.0 0.0.0.255
  network 10.110.1.0 0.0.0.255
#
pim
 c-bsr <span>100GE</span><span>1/0/2</span>
 c-rp <span>100GE</span><span>1/0/2</span>
#
return</pre>
</li><li><p><span class="keyword"></span><span class="keyword">Device</span>B</p>
<pre class="screen">#
sysname <span class="keyword">Device</span>B
#
multicast routing-enable
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 10.110.2.1 255.255.255.0
 pim sm
 igmp enable
#
interface <span>100GE</span><span>1/0/2</span> 
 undo portswitch
 ip address 192.168.2.1 255.255.255.0
 pim sm
#
ospf 1
 area 0.0.0.0
  network 192.168.2.0 0.0.0.255
  network 10.110.2.0 0.0.0.255
#
pim
 c-bsr <span>100GE</span><span>1/0/2</span>
 c-rp <span>100GE</span><span>1/0/2</span>
#
return</pre>
</li><li><p><span class="keyword"></span><span class="keyword">Device</span>C</p>
<pre class="screen">#
sysname <span class="keyword">Device</span><span class="keyword"></span>C
#
multicast routing-enable
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 10.110.2.2 255.255.255.0
 pim sm
 igmp enable
#
interface <span>100GE</span><span>1/0/2</span> 
 undo portswitch
 ip address 192.168.3.1 255.255.255.0
 pim sm
#
ospf 1
 area 0.0.0.0
  network 192.168.3.0 0.0.0.255
  network 10.110.2.0 0.0.0.255
#
pim
 c-bsr <span>100GE</span><span>1/0/2</span>
 c-rp <span>100GE</span><span>1/0/2</span>
#
return</pre>
</li><li><p><span class="keyword"></span><span class="keyword">Device</span>D</p>
<pre class="screen">#
sysname <span class="keyword">Device</span><span class="keyword"></span>D
#
multicast routing-enable
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 192.168.1.2 255.255.255.0
 pim sm
#
interface <span>100GE</span><span>1/0/2</span> 
 undo portswitch
 ip address 192.168.2.2 255.255.255.0
 pim sm
#
interface <span>100GE</span><span>1/0/3</span> 
 undo portswitch
 ip address 192.168.3.2 255.255.255.0
 pim sm
#
interface <span>100GE</span><span>1/0/4</span>
 undo portswitch
 ip address 192.168.4.1 255.255.255.0
 pim sm
#
ospf 1
 area 0.0.0.0
  network 192.168.4.0 0.0.0.255
  network 192.168.3.0 0.0.0.255
  network 192.168.2.0 0.0.0.255
  network 192.168.1.0 0.0.0.255
#
pim
 c-bsr <span>100GE</span><span>1/0/4</span>
 c-rp <span>100GE</span><span>1/0/4</span>
#
return</pre>
</li></ul>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="vrp_igmp_cfg_0010.html">Enabling the IGMP Function
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="vrp_igmp_cfg_0015.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>
</body>
</html>