
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="(Optional) Configuring BGP Soft Reset">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="vrp_bgp_cfg_0045.html">
<meta name="DC.Relation" scheme="URI" content="vrp_bgp_cfg_0156.html">
<meta name="DC.Relation" scheme="URI" content="vrp_bgp_cfg_0049.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing">
<meta name="featuretype" content="IP Routing">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001176743581">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>(Optional) Configuring BGP Soft Reset</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001176743581"></a><a name="EN-US_TASK_0000001176743581"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">(Optional) Configuring BGP Soft Reset</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001176743581__1.3.1"></a><a name="1.3.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>If a BGP import routing policy changes, you can soft-reset BGP connections to allow the new policy to take effect immediately. Specifically, this configuration triggers re-acceptance of BGP routes based on the new policy. BGP route-refresh allows the system to update the BGP routing table dynamically without tearing down any BGP connection when a policy is changed.</p>
<ul><li><p>If a BGP peer supports route-refresh, you can run the <a href="cmdqueryname=refresh+bgp"><b><span class="cmdname">refresh bgp</span></b></a> command to update the routing table through a soft reset on BGP connections.</p>
</li><li><p>If a BGP peer does not support route-refresh, you can run the <a href="cmdqueryname=peer+keep-all-routes"><b><span class="cmdname">peer keep-all-routes</span></b></a> command to retain all the original routes of the peer. In this manner, the routing table can be updated without resetting the BGP connection.</p>
</li></ul>
</div></div>
<div class="steps-unordered"><a name="EN-US_TASK_0000001176743581__1.3.2"></a><a name="1.3.2"></a><h4 class="sectiontitle">Procedure</h4>
<ul><li><span>For BGP peers that support route-refresh:</span><ol><li class="substepexpand"><span>(Optional) Enable the route-refresh capability.</span><p><ol type="a"><li>Enter the system view.<pre class="screen"><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></pre>
</li><li>Enter the BGP view.<pre class="screen"><a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></pre>
</li><li>Enable the route-refresh capability.<pre class="screen"><a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> | <i><span class="varname">ipv6-address</span></i> } <a href="cmdqueryname=capability-advertise+route-refresh"><b><span class="cmdname">capability-advertise</span></b></a> <strong><span>route-refresh</span></strong></pre>
<p>By default, the route-refresh capability is enabled.</p>
<p>If route-refresh is enabled on all BGP peers and the import routing policy of the local device is changed, the local device sends a Route-refresh message to its peers or peer groups. Upon receipt, the peers or peer groups re-send their routing information to the local device. This enables the local device to dynamically update its BGP routing table and apply the new routing policy without terminating any BGP connections.</p>
</li><li>Commit the configuration.<pre class="screen"><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></pre>
</li></ol>
</p></li><li class="substepexpand"><span>Configure BGP soft reset.</span><p><ol type="a"><li>Configure inbound BGP soft reset in the user view.<pre class="screen"><a href="cmdqueryname=refresh+bgp+all+group+external+internal+import"><b><span class="cmdname">refresh bgp</span></b></a> { <strong><span>all</span></strong> | <i><span class="varname">ipv4-address</span></i> | <strong><span>group</span></strong> <i><span class="varname">group-name</span></i> | <strong><span>external</span></strong> | <strong><span>internal</span></strong> } <strong><span>import</span></strong></pre>
</li></ol>
<p><strong><span>external</span></strong> softly resets an EBGP connection, and <strong><span>internal</span></strong> softly resets an IBGP connection.</p>
</p></li></ol>
</li><li><span>If the device's peers do not support route-refresh, perform the following operations:</span><p><ol><li>Enter the system view.<pre class="screen"><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></pre>
</li><li>Enter the BGP view.<pre class="screen"><a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></pre>
</li><li>Enter the IPv4 unicast address family view.<pre class="screen"><a href="cmdqueryname=ipv4-family+unicast"><b><span class="cmdname">ipv4-family</span></b></a> <strong><span>unicast</span></strong></pre>
</li><li>Configure the device to retain all the routing updates received from a specified peer or peer group.<pre class="screen"><a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> | <i><span class="varname">peerIpv6Addr</span></i> } <a href="cmdqueryname=keep-all-routes"><b><span class="cmdname">keep-all-routes</span></b></a></pre>
<p>By default, a device retains only the routing updates that are received from peers or peer groups and match a configured import policy.</p>
<p>After this command is run, all routing updates sent by a specified peer or peer group are retained, regardless of whether an import policy is used. If the local routing policy changes, the retained information can be used to regenerate BGP routes.</p>
<div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>This command needs to be run on both the local device and its peers. If the <a href="cmdqueryname=peer+keep-all-routes"><b><span class="cmdname">peer keep-all-routes</span></b></a> command is run on the device for the first time, the sessions between the device and its peers are re-established.</p>
<p>The <a href="cmdqueryname=peer+keep-all-routes"><b><span class="cmdname">peer keep-all-routes</span></b></a> command does not need to be run on a device that supports route-refresh. If this command is run on such a device, the sessions between the device and its peers will not be re-established, but running the <a href="cmdqueryname=refresh+bgp"><b><span class="cmdname">refresh bgp</span></b></a> command cannot update the routing table.</p>
</div></div>
</li><li>Commit the configuration.<pre class="screen"><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></pre>
</li></ol>
</p></li></ul></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="vrp_bgp_cfg_0045.html">Configuring BGP to Accept Routes
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="vrp_bgp_cfg_0156.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="vrp_bgp_cfg_0049.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>