
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring IPv4 PIM FRR">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="vrp_pim_cfg_0073.html">
<meta name="DC.Relation" scheme="URI" content="vrp_pim_cfg_0069.html">
<meta name="DC.Relation" scheme="URI" content="vrp_pim_cfg_0077.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="PIM">
<meta name="featuretype" content="IP Multicast">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="PIM">
<meta name="featuretype" content="IP Multicast">
<meta name="featurename" content="PIM">
<meta name="featuretype" content="IP Multicast">
<meta name="featuretype" content="IP Multicast">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001313940861">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring IPv4 PIM FRR</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001313940861"></a><a name="EN-US_TASK_0000001313940861"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring IPv4 PIM FRR</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001313940861__1.3.1"></a><a name="1.3.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0000001313940861__fig_dc_vrp_multicast_cfg_227901">Figure 1</a>, DeviceA is a PIM device that is not directly connected to the multicast source. PIM FRR can be deployed on DeviceA to meet the requirements of the multicast services that have high requirements for real-time transmission. The primary link is DeviceB -&gt; DeviceA, and the backup link is DeviceB -&gt; DeviceC -&gt; DeviceA. Multicast traffic is bidirectionally forwarded along the primary and backup links. In normal cases, traffic received from the primary link is accepted. If the primary link fails, traffic received from the backup link is accepted.</p>
<div class="fignone" id="EN-US_TASK_0000001313940861__fig_dc_vrp_multicast_cfg_227901"><a name="EN-US_TASK_0000001313940861__fig_dc_vrp_multicast_cfg_227901"></a><a name="fig_dc_vrp_multicast_cfg_227901"></a><span class="figcap"><b>Figure 1 </b>Configuring PIM FRR</span><div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, Interface1, Interface2, and Interface3 represent <span>100GE</span><span>1/0/1</span>, <span>100GE</span><span>1/0/2</span>, and <span>100GE</span><span>1/0/3</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0000001317622241.png"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001313940861__1.3.2"></a><a name="1.3.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Assign IP addresses to interfaces on each device and configure a unicast routing protocol.</p>
</li><li><div class="p">Enable OSPF IP FRR on DeviceA.<div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Unicast FRR can be implemented among static backup FRR routes, dynamic backup FRR routes, or both static and dynamic backup FRR routes. In this example, it is implemented among dynamic backup FRR routes.</p>
</div></div>
</div>
</li><li><p>Enable the multicast function and PIM-SM on all devices that need to provide multicast services.</p>
</li><li><p>Configure a static IGMP multicast group on the interface connected to the host.</p>
<div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Configure a static IGMP multicast group only when multicast data of a multicast group needs to be received stably and steadily.</p>
</div></div>
</li><li><p>Configure the RP function.</p>
</li><li><p>Enable PIM FRR on DeviceA.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001313940861__1.3.3"></a><a name="1.3.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>Multicast group (G) address: 225.1.0.0</p>
</li><li><p>Multicast source (S) address: 10.0.5.100</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001313940861__1.3.4"></a><a name="1.3.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Assign IP addresses to interfaces and configure a unicast routing protocol. For configuration details, see configuration scripts.</span></li><li><span>Enable OSPF IP FRR on <span class="keyword">Device</span>A.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>ospf</strong><strong> 1</strong> 
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-ospf-1] <strong>frr</strong> 
[<span class="keyword">*</span><span class="keyword">Device</span>A-ospf-1] <strong>loop-free-alternate</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-ospf-1] <strong>quit</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
</p></li><li><span>Enable the multicast function on each device and PIM-SM on each interface.</span><p><p># Enable the multicast function on all <span class="keyword">device</span>s and PIM-SM on all the involved interfaces.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>multicast routing-enable</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>interface <span>100ge</span> <span>1/0/1</span></strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-<span>100GE</span><span>1/0/1</span>] <strong>pim sm</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-<span>100GE</span><span>1/0/1</span>] <strong>quit</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>interface <span>100ge</span> <span>1/0/2</span></strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-<span>100GE</span><span>1/0/2</span>] <strong>pim sm</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-<span>100GE</span><span>1/0/2</span>] <strong>quit</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>interface <span>100ge</span> <span>1/0/3</span></strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-<span>100GE</span><span>1/0/3</span>] <strong>pim sm</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-<span>100GE</span><span>1/0/3</span>] <strong>quit</strong></pre>
<p>The configurations of <span class="keyword">Device</span>B and <span class="keyword">Device</span>C are similar to the configuration of <span class="keyword">Device</span>A. For details, see the configuration files.</p>
</p></li><li><span>Configure a static IGMP group on the interface connected to the host to simulate a user joining the multicast group.</span><p><p># Configure a static IGMP group on <span class="keyword">Device</span>A's interface connected to the host side.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>interface <span>100ge</span> <span>1/0/3</span></strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-<span>100GE</span><span>1/0/3</span>] <strong>igmp static-group 225.1.0.0 source 10.0.5.100</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-<span>100GE</span><span>1/0/3</span>] <strong>quit</strong>
[<span class="keyword">*</span><span class="keyword">DeviceA</span>] <strong>commit</strong></pre>
</p></li><li><span>Configure the RP function.</span><p><p># Configure a candidate-BSR (C-BSR) and candidate-RP (C-RP) on <span class="keyword">Device</span>A. The configurations of DeviceB and DeviceC are similar to the configuration of DeviceA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>pim</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-pim] <strong>c-bsr <span>100ge</span> <span>1/0/1</span></strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-pim] <strong>c-rp <span>100ge</span> <span>1/0/1</span></strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-pim] <strong>quit</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
<p># Check the PIM routing table of <span class="keyword">Device</span>A. The command output shows that there are no backup inbound or outbound interfaces.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>display pim routing-table</strong>
 VPN-Instance: public net
 Total 0 (*, G) entry; 1 (S, G) entry

 (10.0.5.100, 225.1.0.0)
     RP: 192.168.8.2 (local)
     Protocol: pim-sm, Flag: SPT SG_RCVR
     UpTime: 01:21:36
     Upstream interface: <span>100GE</span><span>1/0/1</span>, Refresh time: 01:21:36
         Upstream neighbor: 192.168.8.1
         RPF prime neighbor: 192.168.8.1
     Downstream interface(s) information:
     Total number of downstreams: 1
        1: <span>100GE</span><span>1/0/3</span>
             Protocol: static, UpTime: 01:05:00, Expires: -</pre>
</p></li><li><span>Enable PIM FRR on <span class="keyword">Device</span>A.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>pim</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-pim] <strong>rpf-frr</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-pim] <strong>quit</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
<p># Check the PIM routing table of <span class="keyword">DeviceA</span>. Because PIM FRR is enabled, a backup inbound interface is generated in the PIM entry.</p>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>display pim routing-table</strong>
 VPN-Instance: public net
 Total 0 (*, G) entry; 1 (S, G) entry

 (10.0.5.100, 225.1.0.0)
     RP: 192.168.8.2 (local)
     Protocol: pim-sm, Flag: SPT SG_RCVR
     UpTime: 01:22:40
     Upstream interface:  <span>100GE</span><span>1/0/1</span>, Refresh time: 01:22:40
         Upstream neighbor: 192.168.8.1
         RPF prime neighbor: 192.168.8.1
<strong>     Backup upstream interface: <span>100GE</span><span>1/0/2</span></strong>
<strong>         Backup upstream neighbor: 192.168.10.1
         Backup RPF prime neighbor: 192.168.10.1</strong>
     Downstream interface(s) information:
     Total number of downstreams: 1
        1: <span>100GE</span><span>1/0/3</span>
             Protocol: static, UpTime: 01:06:04, Expires: -</pre>
</p></li><li><span>Verify the configuration.</span><p><p># Run the <strong>shutdown</strong> command on <span>100GE</span><span>1/0/1</span> of <span class="keyword">Device</span>B to simulate a link fault.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>interface <span>100ge</span> <span>1/0/1</span></strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-<span>100GE</span><span>1/0/1</span>] <strong>shutdown</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-<span>100GE</span><span>1/0/1</span>] <strong>commit</strong></pre>
<p># Run the <strong>display pim routing-table</strong> command on <span class="keyword">Device</span>A immediately to check the PIM routing table.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>display pim routing-table</strong>
 VPN-Instance: public net
 Total 0 (*, G) entry; 1 (S, G) entry

 (10.0.5.100, 225.1.0.0)
     RP: NULL
     Protocol: pim-sm, Flag: SPT SG_RCVR
     UpTime: 01:24:22
<strong>     Upstream interface: <span>100GE</span><span>1/0/2</span></strong>, Refresh time: 01:24:22
         Upstream neighbor: 192.168.10.1
         RPF prime neighbor: 192.168.10.1
     Downstream interface(s) information:
     Total number of downstreams: 1
        1: <span>100GE</span><span>1/0/3</span>
             Protocol: static, UpTime: 01:07:46, Expires: -</pre>
<p>The command output shows that the inbound interface of the route on <span class="keyword">Device</span>A has been changed to <span>100GE</span><span>1/0/2</span>, which was on the original backup link.</p>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001313940861__1.3.5"></a><a name="1.3.5"></a><h4 class="sectiontitle">Configuration Scripts</h4><ul><li><p><span class="keyword">Device</span>A</p>
<pre class="screen">#
sysname <span class="keyword">Device</span> A
#
multicast routing-enable
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 192.168.8.2 255.255.255.0
 pim sm
 ospf enable 1 area 0.0.0.0
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ip address 192.168.10.2 255.255.255.0
 pim sm
 ospf enable 1 area 0.0.0.0
#
interface <span>100GE</span><span>1/0/3</span>
 undo portswitch
 ip address 192.168.11.1 255.255.255.0
 pim sm
 igmp static-group 225.1.0.0 source 10.0.5.100
 ospf enable 1 area 0.0.0.0
#
ospf 1
 frr
  loop-free-alternate 
 area 0.0.0.0
  network 192.168.11.0 0.0.0.255
  network 192.168.8.0 0.0.0.255
  network 192.168.10.0 0.0.0.255
#
pim
 c-bsr <span>100GE</span><span>1/0/1</span>
 c-rp <span>100GE</span><span>1/0/1</span>
 rpf-frr
#
return</pre>
</li><li><p><span class="keyword">Device</span>B</p>
<pre class="screen">#
sysname <span class="keyword">Device</span> B
#
multicast routing-enable
#
interface <span>100GE</span><span>1/0/3</span>
 undo portswitch
 ip address 10.0.5.100 255.255.255.0
 pim sm
 ospf enable 1 area 0.0.0.0
#
interface <span>100GE</span><span>1/0/1</span>
 undo portswitch
 ip address 192.168.8.1 255.255.255.0
 pim sm
 ospf enable 1 area 0.0.0.0
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ip address 192.168.9.1 255.255.255.0
 pim sm
 ospf enable 1 area 0.0.0.0
#
ospf 1
 area 0.0.0.0
  network 10.0.5.0 0.0.0.255
  network 192.168.8.0 0.0.0.255
  network 192.168.9.0 0.0.0.255
#
pim
 c-bsr <span>100GE</span><span>1/0/1</span>
 c-rp <span>100GE</span><span>1/0/1</span>
#
return</pre>
</li><li><p><span class="keyword">Device</span>C</p>
<pre class="screen">#
sysname <span class="keyword">Device</span> C
#
multicast routing-enable
#
interface <span>100GE</span><span>1/0/3</span>
 undo portswitch
 ip address 192.168.9.2 255.255.255.0
 pim sm
 ospf enable 1 area 0.0.0.0
#
interface <span>100GE</span><span>1/0/2</span>
 undo portswitch
 ip address 192.168.10.1 255.255.255.0
 pim sm
 ospf enable 1 area 0.0.0.0
#
ospf 1
 area 0.0.0.0
  network 192.168.9.0 0.0.0.255
  network 192.168.10.0 0.0.0.255
#
pim
 c-bsr <span>100GE</span><span>1/0/2</span>
 c-rp <span>100GE</span><span>1/0/2</span>
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="vrp_pim_cfg_0073.html">Configuring IPv4 PIM FRR
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="vrp_pim_cfg_0069.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="vrp_pim_cfg_0077.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>