
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring Layer 3 VXLAN Gateways">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../dc/dc_vrp_vxlan_cfg_1066.html">
<meta name="DC.Relation" scheme="URI" content="../dc/dc_vrp_vxlan_cfg_1092.html">
<meta name="DC.Relation" scheme="URI" content="../dc/dc_vrp_vxlan_cfg_1093.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="VXLAN">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="VXLAN">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="VXLAN">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="VXLAN">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001130624504">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="../public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="../public_sys-resources/browseVersion.js"></script>
<title>Configuring Layer 3 VXLAN Gateways</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001130624504"></a><a name="EN-US_TASK_0000001130624504"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring Layer 3 VXLAN Gateways</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001130624504__1.3.1"></a><a name="1.3.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>Each tenant can be identified by a VNI. VNIs can be mapped to BDs in 1:1 mode, and a BD can function as a VXLAN network entity to transmit VXLAN data packets. You can create a VBDIF interface (logical Layer 3 interface) for each BD to implement communication between VXLAN segments, between VXLAN segments and non-VXLAN segments, and between Layer 2 and Layer 3 networks. After you configure an IP address for a VBDIF interface, the interface functions as the gateway for tenants in the BD to forward packets at Layer 3 based on the IP address.</p>
<p>In distributed VXLAN gateway scenarios, inter-subnet communication between hosts requires Layer 3 forwarding. To allow this, Layer 3 VXLAN gateways must be configured.</p>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001130624504__1.3.2"></a><a name="1.3.2"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Enter the system view.</span><p><pre class="screen"><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></pre>
</p></li><li><span>Create a VBDIF interface and enter its view.</span><p><pre class="screen"><a href="cmdqueryname=interface+vbdif"><b><span class="cmdname">interface vbdif</span></b></a> <i><span class="varname">bd-id</span></i></pre>
<p><i><span class="varname">bd-id</span></i> specified in this command must be the same as <i><span class="varname">bd-id</span></i> specified in Step 2 in the service access point configuration.</p>
</p></li><li><span>Bind the VBDIF interface to a VPN instance.</span><p><pre class="screen"><a href="cmdqueryname=ip+binding+vpn-instance"><b><span class="cmdname">ip binding vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i></pre>
</p></li><li><span>Configure an IP address for the VBDIF interface to implement Layer 3 communication.</span><ul><li>On an IPv4 overlay network, run the following command to configure an IPv4 address:<pre class="screen"><a href="cmdqueryname=ip+address"><b><span class="cmdname">ip address</span></b></a> <i><span class="varname">ip-address</span></i> { <i><span class="varname">mask</span></i> | <i><span class="varname">mask-length</span></i> } [ <strong><span>sub</span></strong> ]</pre>
</li><li>On an IPv6 overlay network, run the following command to configure an IPv6 address:<pre class="screen"><a href="cmdqueryname=ipv6+enable"><b><span class="cmdname">ipv6 enable</span></b></a>
<a href="cmdqueryname=ipv6+address"><b><span class="cmdname">ipv6 address</span></b></a> { <i><span class="varname">ipv6-address</span></i> <i><span class="varname">prefix-length</span></i> | <i><span class="varname">ipv6-address</span></i>/<i><span class="varname">prefix-length</span></i> } [ <strong><span>eui-64</span></strong> ]</pre>
</li></ul>
</li><li><span>(Optional) Configure a MAC address for the VBDIF interface.</span><p><pre class="screen"><a href="cmdqueryname=mac-address"><b><span class="cmdname">mac-address</span></b></a> <i><span class="varname">mac-address</span></i></pre>
<p>By default, the MAC address of a VBDIF interface is the system MAC address.</p>
</p></li><li><span>(Optional) Enable ARP broadcast probe used when a VXLAN tunnel or Layer 2 sub-interface goes down.</span><p><pre class="screen"><a href="cmdqueryname=arp+broadcast-detect+enable"><b><span class="cmdname">arp broadcast-detect enable</span></b></a></pre>
<p>By default, ARP broadcast probe is disabled when a VXLAN tunnel or Layer 2 sub-interface goes down.</p>
<p>If the VXLAN tunnel or Layer 2 sub-interface on the local device is down, the ARP entries learned from the VXLAN tunnel or Layer 2 sub-interface are deleted. As a result, traffic cannot be forwarded. By default, the device triggers ARP Miss messages through traffic forwarding to relearn ARP entries. To enable the device to quickly learn ARP entries, enable ARP broadcast probe on the VBDIF interface.</p>
</p></li><li><span>Enable the distributed gateway function.</span><p><pre class="screen"><a href="cmdqueryname=vxlan+anycast-gateway+enable"><b><span class="cmdname">vxlan anycast-gateway enable</span></b></a></pre>
</p><p><p>By default, the distributed gateway function is disabled.</p>
<div class="note"><img src="../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>After the distributed gateway function is enabled on a Layer 3 gateway, the Layer 3 gateway discards network-side ARP<span> or NS</span> messages and learns only user-side ARP<span> or NS</span> messages.</p>
</div></div>
</p></li><li><span>Configure host route advertisement based on overlay network types and the types of routes to be advertised between gateways.</span><p>
<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" frame="border" border="1" rules="all"><caption><b>Table 1 </b>Configuring host route advertisement</caption><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="17.071707170717072%" id="mcps1.3.2.8.2.1.2.4.1.1" liSelected="liSelected"><p>Overlay Network Type</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="19.321932193219325%" id="mcps1.3.2.8.2.1.2.4.1.2" liSelected="liSelected"><p>Type of Route to Be Advertised Between Gateways</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="63.606360636063606%" id="mcps1.3.2.8.2.1.2.4.1.3" liSelected="liSelected"><p>Command for Host Route Advertisement</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" rowspan="2" valign="top" width="17.071707170717072%" headers="mcps1.3.2.8.2.1.2.4.1.1 "><p>IPv4</p>
</td>
<td class="cellrowborder" valign="top" width="19.321932193219325%" headers="mcps1.3.2.8.2.1.2.4.1.2 "><p>IRB route</p>
</td>
<td class="cellrowborder" valign="top" width="63.606360636063606%" headers="mcps1.3.2.8.2.1.2.4.1.3 "><p><a href="cmdqueryname=arp+collect+host+enable"><b><span class="cmdname">arp collect host enable</span></b></a></p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.3.2.8.2.1.2.4.1.1 "><p>IP prefix route</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.2.8.2.1.2.4.1.2 "><p><span><a href="cmdqueryname=arp+direct-route+enable"><b><span class="cmdname">arp direct-route enable</span></b></a></span> [ <strong><span>route-policy</span></strong> <i><span class="varname">route-policy-name</span></i> ]</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="2" valign="top" width="17.071707170717072%" headers="mcps1.3.2.8.2.1.2.4.1.1 "><p>IPv6</p>
</td>
<td class="cellrowborder" valign="top" width="19.321932193219325%" headers="mcps1.3.2.8.2.1.2.4.1.2 "><p>IRB route</p>
</td>
<td class="cellrowborder" valign="top" width="63.606360636063606%" headers="mcps1.3.2.8.2.1.2.4.1.3 "><p><a href="cmdqueryname=ipv6+nd+collect+host+enable"><b><span class="cmdname">ipv6 nd collect host enable</span></b></a></p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.3.2.8.2.1.2.4.1.1 "><p>IP prefix route</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.2.8.2.1.2.4.1.2 "><p><a href="cmdqueryname=ipv6+nd+direct-route+enable"><b><span class="cmdname">ipv6 nd direct-route enable</span></b></a> [ <strong><span>route-policy</span></strong> <i><span class="varname">route-policy-name</span></i> ]</p>
</td>
</tr>
</tbody>
</table>
</div>
</p></li><li><span>Commit the configuration.</span><p><pre class="screen" id="EN-US_TASK_0000001130624504__en-us_task_0234857734_screen163801330213"><a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001130624504__en-us_task_0234857734_en-us_concept_0141113565_cmdname1667501373175340">commit</span></b></a></pre>
</p></li></ol></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../dc/dc_vrp_vxlan_cfg_1066.html">Establishing VXLAN Tunnels in BGP EVPN Mode (Distributed VXLAN Gateway)
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../dc/dc_vrp_vxlan_cfg_1092.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../dc/dc_vrp_vxlan_cfg_1093.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>