
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Adding Double VLAN Tags to Untagged Packets">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="vrp_vlan_cfg_0061.html">
<meta name="DC.Relation" scheme="URI" content="vrp_vlan_cfg_0071.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="QinQ">
<meta name="featurename" content="VLAN">
<meta name="featuretype" content="Ethernet Switching">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="QinQ">
<meta name="featurename" content="VLAN">
<meta name="featuretype" content="Ethernet Switching">
<meta name="featurename" content="QinQ">
<meta name="featurename" content="VLAN">
<meta name="featurename" content="VLAN Mapping">
<meta name="featurename" content="VLAN Pool">
<meta name="featurename" content="Voice VLAN">
<meta name="featuretype" content="Ethernet Switching">
<meta name="featuretype" content="Ethernet Switching">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001310525589">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>Example for Adding Double VLAN Tags to Untagged Packets</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001310525589"></a><a name="EN-US_TASK_0000001310525589"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Adding Double VLAN Tags to Untagged Packets</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001310525589__1.3.1"></a><a name="1.3.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>In <a href="#EN-US_TASK_0000001310525589__fig10534133734710">Figure 1</a>, PC1 and PC2 need to send untagged packets to each other and receive only untagged packets from each other. During transmission on the backbone network, double VLAN tags need to be added to untagged packets to conserve VLAN IDs on the public network and isolate services of different users.</p>
<div class="fignone" id="EN-US_TASK_0000001310525589__fig10534133734710"><a name="EN-US_TASK_0000001310525589__fig10534133734710"></a><a name="fig10534133734710"></a><span class="figcap"><b>Figure 1 </b>Network diagram of adding double VLAN tags to untagged packets</span><div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface 1 and interface 2 represent <span>100GE</span> <span>1/0/1</span> and <span>100GE</span> <span>1/0/2</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0000001262485712.png"></span></div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001310525589__1.3.2"></a><a name="1.3.2"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Create VLANs.</span><p><p># Create VLAN 2 (the outer VLAN IDs to be added) on <span>100GE</span> <span>1/0/1</span> of DeviceA. The configuration of DeviceB is similar to the configuration of DeviceA. For detailed configurations, see Configuration Scripts.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname DeviceA</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>vlan 2</strong>
[<span class="keyword">*</span>DeviceA] <strong>commit</strong></pre>
</p></li><li><span>Create VLANs and add interfaces to the VLANs.</span><p><p># Configure <span>100GE</span> <span>1/0/1</span> on DeviceA to add double tags to untagged packets. The configuration of DeviceB is similar to the configuration of DeviceA. For detailed configurations, see Configuration Scripts.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>interface <span>100ge</span> <span>1/0/1</span></strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>portswitch</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>port link-type hybrid</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>port hybrid untagged vlan 2</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>port vlan-stacking untagged stack-vlan 2 stack-inner-vlan 200</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>commit</strong></pre>
</p></li><li><span>Add the outbound interfaces to the outer VLANs.</span><p><p># Configure <span>100GE</span> <span>1/0/2</span> on DeviceA to allow packets from VLAN 2 to pass through. The configuration of DeviceB is similar to the configuration of DeviceA. For detailed configurations, see Configuration Scripts.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>interface <span>100ge</span> <span>1/0/2</span></strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA-<span>100GE</span><span>1/0/2</span>] <strong>portswitch</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA-<span>100GE</span><span>1/0/2</span>] <strong>port link-type trunk</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/2</span>] <strong>port trunk allow-pass vlan 2</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/2</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>commit</strong></pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001310525589__1.3.3"></a><a name="1.3.3"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p>After completing the configuration, verify that DeviceA can add double VLAN tags to the packets sent by PC1 and that PC2 can receive untagged packets.</p>
</div>
<div class="postreq"><a name="EN-US_TASK_0000001310525589__1.3.4"></a><a name="1.3.4"></a><h4 class="sectiontitle">Configuration Scripts</h4><ul><li>DeviceA<pre class="screen">#
sysname DeviceA
#
vlan 2
#
interface <span>100GE</span><span>1/0/1</span>
 port link-type hybrid
 port hybrid untagged vlan 2
 port vlan-stacking untagged stack-vlan 2 stack-inner-vlan 200
 #
interface <span>100GE</span><span>1/0/2</span>
 port link-type trunk
 port trunk allow-pass vlan 2
#
return</pre>
</li><li>DeviceB<pre class="screen">#
sysname DeviceB
#
vlan 2
#
interface <span>100GE</span><span>1/0/1</span>
 port link-type hybrid
 port hybrid untagged vlan 2
 port vlan-stacking untagged stack-vlan 2 stack-inner-vlan 200
 #
interface <span>100GE</span><span>1/0/2</span>
 port link-type trunk
 port trunk allow-pass vlan 2
#
return</pre>
</li></ul>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="vrp_vlan_cfg_0061.html">Configuring QinQ
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="vrp_vlan_cfg_0071.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>
</body>
</html>