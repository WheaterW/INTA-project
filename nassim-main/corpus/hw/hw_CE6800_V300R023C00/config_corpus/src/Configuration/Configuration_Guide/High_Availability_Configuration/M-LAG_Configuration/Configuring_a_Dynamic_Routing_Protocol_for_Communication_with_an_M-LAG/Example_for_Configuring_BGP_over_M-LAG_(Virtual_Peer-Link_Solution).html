
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring BGP over M-LAG (Virtual Peer-Link Solution)">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../dc/dc_cfg_m-lag_0021.html">
<meta name="DC.Relation" scheme="URI" content="../dc/dc_cfg_ospf_cfgcase_1006.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="M-LAG">
<meta name="featuretype" content="High Availability">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="M-LAG">
<meta name="featuretype" content="High Availability">
<meta name="featurename" content="M-LAG">
<meta name="featuretype" content="High Availability">
<meta name="featuretype" content="High Availability">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001512849250">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="../public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring BGP over M-LAG (Virtual Peer-Link Solution)</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001512849250"></a><a name="EN-US_TASK_0000001512849250"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring BGP over M-LAG (Virtual Peer-Link Solution)</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001512849250__1.3.1"></a><a name="1.3.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><div class="note"><img src="../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>This configuration example is supported only by the <span>CE6866, CE6860-SAN, CE6866K, CE6860-HAM, CE8851-32CQ8DQ-P, CE8850-SAN, CE8851K, CE8850-HAM</span>, <span>CE8855, CE8851-32CQ4BQ, CE6855-48XS8CQ, CE6885, CE6885-SAN, CE6885-LL (standard forwarding mode), CE6885-T, and CE6863E-48S8CQ</span>.</p>
</div></div>
<p>On the network shown in <a href="#EN-US_TASK_0000001512849250__en-us_task_0241512178_en-us_task_0141119105_fig_dc_cfg_vxlan_cfgcase_000601">Figure 1</a>, DeviceA, DeviceB, and DeviceC constitute an M-LAG. The M-LAG member interfaces on DeviceB and DeviceC support dynamic routing protocols. A dynamic routing protocol is configured on DeviceA so that it can communicate with the M-LAG through Layer 3 routes.</p>
<div class="fignone" id="EN-US_TASK_0000001512849250__en-us_task_0241512178_en-us_task_0141119105_fig_dc_cfg_vxlan_cfgcase_000601"><a name="EN-US_TASK_0000001512849250__en-us_task_0241512178_en-us_task_0141119105_fig_dc_cfg_vxlan_cfgcase_000601"></a><a name="en-us_task_0241512178_en-us_task_0141119105_fig_dc_cfg_vxlan_cfgcase_000601"></a><span class="figcap"><b>Figure 1 </b>Configuring BGP over M-LAG (virtual peer-link solution)</span><div class="note"><img src="../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface 1 and interface 2 represent <span>100GE</span> <span>1/0/1</span> and <span>100GE</span> <span>1/0/2</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0000001512689882.png"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001512849250__1.3.2"></a><a name="1.3.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><div class="p">The configuration roadmap is as follows:<ol><li>Configure DeviceA, DeviceB, and DeviceC to establish an M-LAG.<ul><li>Configure V-STP on DeviceB and DeviceC.</li><li>Configure a DFS group on DeviceB and DeviceC, and bind IP addresses of their management interfaces to the DFS group.</li><li>Configure BGP on DeviceB, DeviceC, and DeviceD so that EBGP peer relationships can be established between DeviceD and DeviceB and between DeviceD and DeviceC. BGP is used to advertise dedicated routing information for establishing a bypass VXLAN tunnel.</li><li>Configure a virtual peer-link between DeviceB and DeviceC.</li><li>Configure a reserved VNI for the M-LAG, and configure a bypass VXLAN tunnel.</li><li>Configure M-LAG member interfaces on DeviceB and DeviceC and an Eth-Trunk interface on DeviceA.</li><li>Configure Monitor Link on DeviceB and DeviceC.</li></ul>
</li><li>Configure BGP over M-LAG.<ul><li>Configure IPv4 addresses for BGP over M-LAG on DeviceB and DeviceC.</li><li>Configure DeviceA to establish BGP peer relationships with M-LAG member devices (DeviceB and DeviceC).</li></ul>
</li></ol>
</div>
<div class="note"><img src="../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><ul><li>DeviceB and DeviceC have the same AS number. To ensure that M-LAG devices advertise bypass VXLAN tunnel information, disable the function of checking duplicate AS numbers on DeviceB for the BGP peer relationship with DeviceD. The configuration on DeviceC is similar.</li><li>To prevent the backup device from shutting down the outbound interface of the bypass VXLAN tunnel due to a negotiation exception on M-LAG devices, the outbound interface of the bypass VXLAN tunnel must be configured as an M-LAG reserved interface.</li><li>Configure different M-LAG IPv4 addresses on DeviceB and DeviceC. Otherwise, peer relationships of the routing protocol cannot be established.</li></ul>
</div></div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001512849250__1.3.3"></a><a name="1.3.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure DeviceA, DeviceB, and DeviceC to establish an M-LAG.</span><p><ol type="a"><li>Configure V-STP.<p># Configure DeviceB. The configuration of DeviceC is similar to that of DeviceB.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname DeviceB</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB]<strong> stp mode rstp</strong>
[<span class="keyword">*</span>DeviceB]<strong> stp v-stp enable</strong>
[<span class="keyword">*</span>DeviceB]<strong> commit</strong></pre>
</li><li>Configure a DFS group on DeviceB and DeviceC, and bind IP addresses of their management interfaces to the DFS group. Ensure that DeviceB and DeviceC can communicate at Layer 3 through their management interfaces.<div class="p"># Configure DeviceB. The configuration of DeviceC is similar to that of DeviceB.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB]<strong> interface meth 0/0/0</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB-MEth0/0/0]<strong> ip address 10.200.1.1 24</strong>
[<span class="keyword">*</span>DeviceB-MEth0/0/0]<strong> quit</strong>
[<span class="keyword">*</span>DeviceB] <strong>dfs-group 1</strong>
[<span class="keyword">*</span>DeviceB-dfs-group-1] <strong>dual-active detection </strong><strong>source ip 10.200.1.1</strong><strong> peer 10.200.2.1</strong>
[<span class="keyword">*</span>DeviceB-dfs-group-1] <strong>authentication-mode hmac-sha256 password</strong> <strong>YsHsjx_202206</strong>
[<span class="keyword">*</span>DeviceB-dfs-group-1] <strong>quit</strong>
[<span class="keyword">*</span>DeviceB] <strong>commit</strong></pre>
</div>
</li><li>Configure BGP on DeviceB, DeviceC, and DeviceD so that EBGP peer relationships can be established between DeviceD and DeviceB and between DeviceD and DeviceC. BGP is used to advertise dedicated routing information for establishing a bypass VXLAN tunnel.<p># Configure a BGP peer for DeviceB and disable the function of checking duplicate AS numbers.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB]<strong> interface loopback 1</strong>
[<span class="keyword">*</span>DeviceB-LoopBack1]<strong> ip address 10.1.1.1 32</strong>
[<span class="keyword">*</span>DeviceB-LoopBack1]<strong> </strong><strong>quit</strong>
[<span class="keyword">*</span>DeviceB]<strong> </strong><strong>commit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceB]<strong> bgp</strong> <strong>100</strong>
[*DeviceB-bgp]<strong> router-id 10.111.12.12</strong> 
[*DeviceB-bgp]<strong> peer 192.168.1.2</strong> <strong>as-number 200</strong> 
[*DeviceB-bgp]<strong> peer 192.168.1.2 allow-as-loop</strong>
[*DeviceB-bgp]<strong> network 10.1.1.1 255.255.255.255</strong>
[*DeviceB-bgp]<strong> quit</strong> 
[*DeviceB]<strong> commit</strong></pre>
<p># Configure a BGP peer for DeviceC and disable the function of checking duplicate AS numbers.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceC]<strong> interface loopback 1</strong>
[<span class="keyword">*</span>DeviceC-LoopBack1]<strong> ip address 10.1.1.2 32</strong>
[<span class="keyword">*</span>DeviceC-LoopBack1]<strong> </strong><strong>quit</strong>
[<span class="keyword">*</span>DeviceC]<strong> </strong><strong>commit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceC]<strong> bgp</strong> <strong>100</strong>
[*DeviceC-bgp]<strong> router-id 10.114.14.14</strong> 
[*DeviceC-bgp]<strong> peer 192.168.2.2</strong> <strong>as-number 200</strong> 
[*DeviceC-bgp]<strong> peer 192.168.2.2 allow-as-loop</strong>
[*DeviceC-bgp]<strong> network 10.1.1.2 255.255.255.255</strong>
[*DeviceC-bgp]<strong> quit</strong> 
[*DeviceC]<strong> commit</strong></pre>
<p># Configure BGP peers for DeviceD.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname DeviceD</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceD]<strong> interface loopback 1</strong>
[<span class="keyword">*</span>DeviceD-LoopBack1]<strong> ip address 10.1.1.3 32</strong>
[<span class="keyword">*</span>DeviceD-LoopBack1]<strong> </strong><strong>quit</strong>
[<span class="keyword">*</span>DeviceD]<strong> </strong><strong>commit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceD]<strong> bgp</strong> <strong>200</strong>
[*DeviceD-bgp]<strong> router-id 10.113.13.13</strong> 
[*DeviceD-bgp]<strong> peer 192.168.1.1</strong> <strong>as-number 100</strong> 
[*DeviceD-bgp]<strong> peer 192.168.2.1 as-number 100</strong>
[*DeviceD-bgp]<strong> quit</strong> 
[*DeviceD]<strong> commit</strong></pre>
</li><li>Configure a virtual peer-link between DeviceB and DeviceC.<p># Configure DeviceB. The configuration of DeviceC is similar to that of DeviceB.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceB] <strong>interface eth-trunk 1 </strong>
[*DeviceB-Eth-Trunk1] <strong>peer-link 1 virtual-link</strong>
[*DeviceB-Eth-Trunk1] <strong>quit</strong> 
[*DeviceB] <strong>commit</strong></pre>
</li><li>Configure a reserved VNI for the M-LAG, and configure a bypass VXLAN tunnel.<p># Configure the uplink interface of the bypass VXLAN tunnel as an M-LAG reserved interface on DeviceB.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceB] <strong>interface <span>100ge</span> <span>1/0/1</span>    </strong>                                     
[*DeviceB-<span>100GE</span><span>1/0/1</span>] <strong>m-lag unpaired-port reserved</strong>
[*DeviceB-<span>100GE</span><span>1/0/1</span>] <strong>quit</strong>
[*DeviceB] <strong>commit</strong></pre>
<p># Configure the uplink interface of the bypass VXLAN tunnel as an M-LAG reserved interface on DeviceC.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceC] <strong>interface <span>100ge</span> <span>1/0/1</span>  </strong>                                       
[*DeviceC-<span>100GE</span><span>1/0/1</span>] <strong>m-lag unpaired-port reserved</strong>
[*DeviceC-<span>100GE</span><span>1/0/1</span>] <strong>quit</strong>
[*DeviceC] <strong>commit</strong></pre>
<p># Configure a reserved VNI for the virtual peer-link solution and configure a bypass VXLAN tunnel on DeviceB.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceB] <strong>interface nve 1  </strong>                                       
[*DeviceB-Nve1] <strong>pip-source 10.1.1.1 peer 10.1.1.2 bypass</strong>
[*DeviceB-Nve1] <strong>vni 10000 reserved for m-lag</strong>
[*DeviceB-Nve1] <strong>quit</strong>
[*DeviceB] <strong>commit</strong></pre>
<p># Configure a reserved VNI for the virtual peer-link solution and configure a bypass VXLAN tunnel on DeviceC.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceC] <strong>interface nve 1  </strong>                                       
[*DeviceC-Nve1] <strong>pip-source 10.1.1.2 peer 10.1.1.1 bypass</strong>
[*DeviceC-Nve1] <strong>vni 10000 reserved for m-lag</strong>
[*DeviceC-Nve1] <strong>quit</strong>
[*DeviceC] <strong>commit</strong></pre>
</li><li>Configure M-LAG member interfaces on DeviceB and DeviceC and an Eth-Trunk interface on DeviceA.<p># Configure DeviceB. The configuration of DeviceC is similar to that of DeviceB.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceB] <strong>interface eth-trunk 10</strong> 
[*DeviceB-Eth-Trunk10] <strong>mode lacp-static</strong> 
[*DeviceB-Eth-Trunk10] <strong>port link-type trunk</strong> 
[*DeviceB-Eth-Trunk10] <strong>lacp mixed-rate link enable</strong> 
[*DeviceB-Eth-Trunk10] <strong>trunkport <span>100ge</span> </strong><strong><span>1/0/2</span></strong> 
[*DeviceB-Eth-Trunk10] <strong>dfs-group 1 m-lag 1</strong> 
[*DeviceB-Eth-Trunk10] <strong>quit</strong> 
[*DeviceB] <strong>commit</strong></pre>
<p># Configure DeviceA.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname DeviceA</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceA] <strong>interface eth-trunk 10</strong> 
[*DeviceA-Eth-Trunk10] <strong>mode lacp-static</strong> 
[*DeviceA-Eth-Trunk10] <strong>port link-type trunk</strong> 
[*DeviceA-Eth-Trunk10] <strong>trunkport <span>100ge</span> </strong><strong><span>1/0/1</span></strong>
[*DeviceA-Eth-Trunk10] <strong>trunkport <span>100ge</span> </strong><strong><span>1/0/2</span></strong>
[*DeviceA-Eth-Trunk10] <strong>quit</strong> 
[*DeviceA] <strong>commit</strong></pre>
</li><li>Configure Monitor Link on DeviceB and DeviceC.<p># Configure DeviceB. The configuration of DeviceC is similar to that of DeviceB.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceB] <strong>monitor-link group 1</strong> 
[*DeviceB-mtlk-group1] <strong>port <span>100ge</span> <span>1/0/1</span> uplink</strong> 
[*DeviceB-mtlk-group1] <strong>port eth-trunk 10 downlink 1</strong> 
[*DeviceB-mtlk-group1] <strong>quit</strong> 
[*DeviceB] <strong>commit</strong></pre>
</li></ol>
</p></li><li><span>Configure BGP over M-LAG.</span><p><ol type="a"><li>Configure IPv4 addresses for BGP over M-LAG on DeviceB, DeviceC, and DeviceA.<p># Configure DeviceA.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceA] <strong>vlan batch 102</strong>
[*DeviceA] <strong>interface vlanif 102</strong>
[*DeviceA-Vlanif102] <strong>ip address 10.102.0.2 255.255.255.0</strong>
[*DeviceA-Vlanif102] <strong>quit</strong>
[*DeviceA] <strong>commit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceA]<strong> interface eth-trunk 10</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceA-Eth-Trunk10]<strong> port trunk allow-pass vlan 102</strong>
[*DeviceA-Eth-Trunk10]<strong> quit</strong>
[*DeviceA] <strong>commit</strong></pre>
<p># Configure DeviceB.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceB] <strong>vlan batch 102</strong>
[*DeviceB] <strong>interface vlanif 102</strong>
[*DeviceB-Vlanif102] <strong>ip address 10.102.0.1 255.255.255.0</strong>
[*DeviceB-Vlanif102] <strong>m-lag ip address 10.102.0.3 255.255.255.0</strong>
[*DeviceB-Vlanif102] <strong>mac-address 0000-5e00-0101</strong>
[*DeviceB-Vlanif102] <strong>arp proxy enable</strong>
[*DeviceB-Vlanif102] <strong>quit</strong>
[*DeviceB] <strong>commit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceB]<strong> interface eth-trunk 10</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceB-Eth-Trunk10]<strong> port trunk allow-pass vlan 102</strong>
[*DeviceB-Eth-Trunk10]<strong> quit</strong>
[*DeviceB] <strong>commit</strong></pre>
<p># Configure DeviceC.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceC] <strong>vlan batch 102</strong>
[*DeviceC] <strong>interface vlanif 102</strong>
[*DeviceC-Vlanif102] <strong>ip address 10.102.0.1 255.255.255.0</strong>
[*DeviceC-Vlanif102] <strong>m-lag ip address 10.102.0.4 255.255.255.0</strong>
[*DeviceC-Vlanif102] <strong>mac-address 0000-5e00-0101</strong>
[*DeviceC-Vlanif102] <strong>arp proxy enable</strong>
[*DeviceC-Vlanif102] <strong>quit</strong>
[*DeviceC] <strong>commit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceC]<strong> interface eth-trunk 10</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceC-Eth-Trunk10]<strong> port trunk allow-pass vlan 102</strong>
[*DeviceC-Eth-Trunk10]<strong> quit</strong>
[*DeviceC] <strong>commit</strong></pre>
</li><li>Configure DeviceA to establish BGP peer relationships with M-LAG member devices (DeviceB and DeviceC).<div class="p"># Configure DeviceA.<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceA]<strong> bgp</strong><strong> 100</strong>
[*DeviceA-bgp]<strong> router-id 10.115.15.15</strong> 
[*DeviceA-bgp] <strong>peer 10.102.0.3 as-number 100</strong>  
[*DeviceA-bgp] <strong>peer 10.102.0.4 as-number 100</strong>
[*DeviceA-bgp] <strong>quit</strong>
[*DeviceA] <strong>commit</strong></pre>
</div>
<div class="p"># Configure DeviceB.<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceB]<strong> bgp</strong> <strong>100</strong>  
[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceB-bgp]<strong> peer 10.102.0.2 as-number 100</strong> 
[*DeviceB-bgp] <strong>peer 10.102.0.2 connect-interface Vlanif102 10.102.0.3</strong>  
[*DeviceB-bgp] <strong>quit</strong>
[*DeviceB] <strong>commit</strong></pre>
</div>
<div class="p"># Configure DeviceC.<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceC]<strong> bgp</strong><strong> 100 </strong> 
[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceC-bgp]<strong> peer 10.102.0.2 as-number 100</strong> 
[*DeviceC-bgp] <strong>peer 10.102.0.2 connect-interface Vlanif102 10.102.0.4</strong>  
[*DeviceC-bgp] <strong>quit</strong>
[*DeviceC] <strong>commit</strong></pre>
</div>
</li></ol>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001512849250__1.3.4"></a><a name="1.3.4"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p># Run the <strong>display dfs-group 1 m-lag</strong> command to check M-LAG information.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB] <strong>display dfs-group 1 m-lag</strong>
*                     : Local node
Heart beat state      : OK
Node 1 *
  Dfs-Group ID        : 1
  Priority            : 100
  Dual-active Address : 10.200.1.1
  VPN-Instance        : public net
  State               : <strong>Master</strong>
  Causation           : -
  System ID           : 00e0-fc12-3457
  SysName             : DeviceB
  Version             : <span class="keyword">V300R023C00</span>
  Device Type         : <span>CE6860-SAN</span>
Node 2
  Dfs-Group ID        : 1
  Priority            : 100
  Dual-active Address : 10.200.2.1
  VPN-Instance        : public net
  State               : <strong>Backup</strong>
  Causation           : -
  System ID           : 00e0-fc12-3458
  SysName             : DeviceC
  Version             : <span class="keyword">V300R023C00</span>
  Device Type         : <span>CE6860-SAN</span></pre>
<p># Check M-LAG information on DeviceB.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB] <strong>display dfs-group 1 node 1 m-lag brief</strong>
* - Local node

M-Lag ID     Interface      Port State    Status                Consistency-check
       1     Eth-Trunk 10   <strong>Up</strong>            active(*)-active      --

Failed reason:
    1 -- Relationship between vlan and port is inconsistent
    2 -- STP configuration under the port is inconsistent
    3 -- STP port priority configuration is inconsistent
    4 -- LACP mode of M-LAG is inconsistent
    5 -- M-LAG configuration is inconsistent
    6 -- The number of M-LAG members is inconsistent
    7 -- LACP system-id of M-LAG is inconsistent
    8 -- LACP priority of M-LAG is inconsistent
    9 -- STP port edged configuration is inconsistent
    10 -- M-LAG mode configuration is inconsistent</pre>
<p># Check M-LAG information on DeviceC.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceC] <strong>display dfs-group 1 node 2 m-lag brief</strong>
* - Local node

M-Lag ID     Interface      Port State    Status                Consistency-check
       1     Eth-Trunk 10   <strong>Up</strong>            active-active(*)      --

Failed reason:
    1 -- Relationship between vlan and port is inconsistent
    2 -- STP configuration under the port is inconsistent
    3 -- STP port priority configuration is inconsistent
    4 -- LACP mode of M-LAG is inconsistent
    5 -- M-LAG configuration is inconsistent
    6 -- The number of M-LAG members is inconsistent
    7 -- LACP system-id of M-LAG is inconsistent
    8 -- LACP priority of M-LAG is inconsistent
    9 -- STP port edged configuration is inconsistent
    10 -- M-LAG mode configuration is inconsistent</pre>
<p>Run the <strong>display bgp peer</strong> command on DeviceB, DeviceC, and DeviceA to check BGP peer information.</p>
<p># Check BGP peer information on DeviceB.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceB]<strong> display bgp peer</strong>                                          
Status codes: * - Dynamic 
BGP local router ID        : 10.111.12.12 
Local AS number            : 100 
Total number of peers      : 2 
Peers in established state : 2 
Total number of dynamic peers : 0 
  
 Peer            V          AS  MsgRcvd  MsgSent  OutQ  Up/Down       State  PrefRcv            
 10.102.0.2      4         100        6        8     0 00:00:45 <strong> Established</strong>    0             
 192.168.1.2     4         200       26       25     0 00:03:52  <strong>Established</strong>    0</pre>
<p># Check BGP peer information on DeviceC.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceC]<strong> display bgp peer</strong>                                          
Status codes: * - Dynamic 
BGP local router ID        : 10.114.14.14 
Local AS number            : 100 
Total number of peers      : 2 
Peers in established state : 2 
Total number of dynamic peers : 0 
  
 Peer            V          AS  MsgRcvd  MsgSent  OutQ  Up/Down       State  PrefRcv            
 10.102.0.2      4         100        7        9     0 00:00:45  <strong>Established</strong>    0             
 192.168.2.2     4         200       26       24     0 00:03:52 <strong> Established</strong>    0</pre>
<p># Check BGP peer information on DeviceA.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceA]<strong> display bgp peer</strong>                                          
Status codes: * - Dynamic 
BGP local router ID        : 10.115.15.15 
Local AS number            : 100 
Total number of peers      : 2 
Peers in established state : 2 
Total number of dynamic peers : 0 
  
 Peer            V          AS  MsgRcvd  MsgSent  OutQ  Up/Down       State  PrefRcv            
 10.102.0.3      4         100        6        0     0 00:00:45  <strong>Established</strong>    0             
 10.102.0.4      4         100        7        0     0 00:03:52 <strong> Established</strong>    0</pre>
<p>After BGP is configured successfully, run the <strong>display bgp peer</strong> command on DeviceD to check BGP peer information.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceD]<strong> display bgp peer</strong>                                          
Status codes: * - Dynamic 
BGP local router ID        : 10.113.13.13 
Local AS number            : 200 
Total number of peers      : 2 
Peers in established state : 2 
Total number of dynamic peers : 0 
  
 Peer            V          AS  MsgRcvd  MsgSent  OutQ  Up/Down       State  PrefRcv            
 192.168.1.1     4         100        3        3     0 00:00:45  <strong>Established</strong>    0             
 192.168.2.1     4         100        7        7     0 00:03:52 <strong> Established</strong>    0</pre>
<p>After the bypass VXLAN tunnel is established successfully, check tunnel information. The command outputs on DeviceB and DeviceC are as follows:</p>
<p># Check bypass VXLAN tunnel information on DeviceB.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceB] <strong>display vxlan tunnel</strong> 
                                         
Number of vxlan tunnel : 1  
                                                                                                    
Tunnel ID   Source                        Destination                  State  Type     Uptime

----------------------------------------------------------------------------------------------------

4026533892  10.1.1.1                      10.1.1.2                       up     static   00:32:34</pre>
<p># Check bypass VXLAN tunnel information on DeviceC.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceC] <strong>display vxlan tunnel</strong>  
                                                                                                           
Number of vxlan tunnel : 1                                                                                                          
Tunnel ID   Source                         Destination                  State  Type     Uptime

----------------------------------------------------------------------------------------------------

4026531845  10.1.1.2                       10.1.1.1                       up     static   00:17:55</pre>
</div>
<div class="postreq"><a name="EN-US_TASK_0000001512849250__1.3.5"></a><a name="1.3.5"></a><h4 class="sectiontitle">Configuration Scripts</h4><ul><li>DeviceA<pre class="screen">#
sysname DeviceA
#
vlan batch 102
#
interface Vlanif102
 ip address 10.102.0.2 255.255.255.0
#
interface Eth-Trunk10
 port link-type trunk
 port trunk allow-pass vlan 102
 mode lacp-static
#
interface <span>100GE</span><span>1/0/1</span>
 eth-trunk 10
#
interface <span>100GE</span><span>1/0/2</span>
 eth-trunk 10
#
bgp 100
 router-id 10.115.15.15 
 peer 10.102.0.3 as-number 100 
 peer 10.102.0.4 as-number 100 
 private-4-byte-as enable
#
return</pre>
</li><li><p>DeviceB</p>
<pre class="screen">#
sysname DeviceB
#
dfs-group 1
 dual-active detection source ip 10.200.1.1 peer 10.200.2.1
 authentication-mode hmac-sha256 password %+%##!!!!!!!!!"!!!!"!!!!*!!!!C+tR0CW9x*eB&amp;pWp`t),Azgw-h\o8#4LZPD!!!!!!!!!!!!!!!9!!!!&gt;fwJ)I0E{=:%,*,XRhbH&amp;t0MCy_8=7!!!!!!!!!!%+%# 
#
vlan batch 102
#
stp mode rstp
stp v-stp enable
#
interface Vlanif102
 ip address 10.102.0.1 255.255.255.0
 mac-address 0000-5e00-0101
 m-lag ip address 10.102.0.3 255.255.255.0
 arp proxy enable
#
interface Eth-Trunk1
  peer-link 1 virtual-link
#
interface Eth-Trunk10
 port link-type trunk
 port trunk allow-pass vlan 102
 mode lacp-static
 lacp mixed-rate link enable
 dfs-group 1 m-lag 1
#
interface MEth0/0/0
 ip address 10.200.1.1 255.255.255.0
#
interface <span>100GE</span><span>1/0/1</span>
 m-lag unpaired-port reserved
#
interface <span>100GE</span><span>1/0/2</span>
 eth-trunk 10
#
interface LoopBack1
 ip address 10.1.1.1 255.255.255.255
#
interface nve 1
 pip-source 10.1.1.1 peer 10.1.1.2 bypass
 vni 10000 reserved for m-lag
#
monitor-link group 1
 port <span>100GE</span><span>1/0/1</span> uplink
 port Eth-Trunk10 downlink 1
#
bgp 100
 router-id 10.111.12.12 
 peer 192.168.1.2 as-number 200 
 peer 192.168.1.2 allow-as-loop
 peer 10.102.0.2 as-number 100 
 peer 10.102.0.2 connect-interface Vlanif102 10.102.0.3 
 network 10.1.1.1 255.255.255.255
 private-4-byte-as enable
#
return</pre>
</li><li><p>DeviceC</p>
<pre class="screen">#
sysname DeviceC
#
dfs-group 1
 dual-active detection source ip 10.200.2.1 peer 10.200.1.1
 authentication-mode hmac-sha256 password %+%##!!!!!!!!!"!!!!"!!!!*!!!!=I9f8&gt;C{!P_bhB31@7r-=jrS8c|_"(Bn<font style="font-size:8pt" Face="Courier New" >~</font>#=!!!!!!!!!!!!!!!9!!!!kx-6@.tGA(wAt/IQXl6&gt;[g{6YlOi9$!!!!!!!!!!%+%#
#
vlan batch 102
#
stp mode rstp
stp v-stp enable
#
interface Vlanif102
 ip address 10.102.0.1 255.255.255.0
 mac-address 0000-5e00-0101
 m-lag ip address 10.102.0.4 255.255.255.0
<strong> </strong>arp proxy enable
#
interface Eth-Trunk1
 peer-link 1 virtual-link
#
interface Eth-Trunk10
 port link-type trunk
 port trunk allow-pass vlan 102
 mode lacp-static
 lacp mixed-rate link enable
 dfs-group 1 m-lag 1
#
interface MEth0/0/0
 ip address 10.200.1.1 255.255.255.0
#
interface <span>100GE</span><span>1/0/1</span>
 m-lag unpaired-port reserved
#
interface <span>100GE</span><span>1/0/2</span>
 eth-trunk 10
#
interface LoopBack1
 ip address 10.1.1.2 255.255.255.255
#
interface nve 1
 pip-source 10.1.1.2 peer 10.1.1.1 bypass
 vni 10000 reserved for m-lag
#
monitor-link group 1
 port <span>100GE</span><span>1/0/1</span> uplink
 port Eth-Trunk10 downlink 1
#
bgp 100
 router-id 10.114.14.14 
 peer 192.168.2.2 as-number 200 
 peer 192.168.2.2 allow-as-loop
 peer 10.102.0.2 as-number 100 
 peer 10.102.0.2 connect-interface Vlanif102 10.102.0.4
 network 10.1.1.2 255.255.255.255
 private-4-byte-as enable
#
return</pre>
</li><li><p>DeviceD</p>
<pre class="screen">#
sysname DeviceD
#
interface LoopBack1
 ip address 10.1.1.3 255.255.255.255
#
bgp 200
 router-id 10.113.13.13 
 peer 192.168.1.1 as-number 100 
 peer 192.168.2.1 as-number 100 
 private-4-byte-as enable
#
return</pre>
</li></ul>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../dc/dc_cfg_m-lag_0021.html">Configuring a Dynamic Routing Protocol for Communication with an M-LAG
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../dc/dc_cfg_ospf_cfgcase_1006.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>
</body>
</html>