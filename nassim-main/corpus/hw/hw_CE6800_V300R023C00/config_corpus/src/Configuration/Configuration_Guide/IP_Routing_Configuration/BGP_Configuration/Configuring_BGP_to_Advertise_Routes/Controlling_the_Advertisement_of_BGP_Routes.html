
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Controlling the Advertisement of BGP Routes">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="vrp_bgp_cfg_0037.html">
<meta name="DC.Relation" scheme="URI" content="vrp_bgp_cfg_0041.html">
<meta name="DC.Relation" scheme="URI" content="vrp_bgp_cfg_0043.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing">
<meta name="featuretype" content="IP Routing">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001176663627">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>Controlling the Advertisement of BGP Routes</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001176663627"></a><a name="EN-US_TASK_0000001176663627"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Controlling the Advertisement of BGP Routes</h1>
<div class="taskbody"><div class="prereq" style="margin-left:0"><a name="EN-US_TASK_0000001176663627__1.3.1"></a><a name="1.3.1"></a><h4 class="sectiontitle">Prerequisites</h4>
<div class="p"><p>Before controlling the advertisement of BGP routes, you have completed the following task:</p>
<ul><li><p><a href="vrp_bgp_cfg_0014.html">Configure basic BGP functions</a>.</p>
</li><li>To filter routes based on an IP prefix list, create the IP prefix list first.</li><li>To filter routes based on an AS_Path filter, create the AS_Path filter first.</li><li>To filter routes based on a route-policy, create the route-policy first.</li></ul>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001176663627__1.3.2"></a><a name="1.3.2"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>After a route advertisement policy is configured on a device, the device advertises only the routes that match the policy to its BGP peers.</p>
</div></div>
<div class="steps-unordered"><a name="EN-US_TASK_0000001176663627__1.3.3"></a><a name="1.3.3"></a><h4 class="sectiontitle">Procedure</h4>
<ul><li><span>Configure BGP to filter the routes to be advertised to all peers.</span><p><p>You can configure the device to filter the routes to be advertised. Perform the following steps on a BGP device:</p>
</p><ol><li class="substepexpand"><span>Enter the system view.</span><p><pre class="screen"><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></pre>
</p></li><li class="substepexpand"><span>Configure the BGP device to filter the routes to be advertised to all peers.</span><p><ul><li><div class="p">Configure the BGP device to filter the routes to be advertised against a basic ACL.<ol type="a"><li>Enter the ACL view.<pre class="screen"><span><a href="cmdqueryname=acl+name+basic+basic+number+number"><b><span class="cmdname">acl</span></b></a> { <strong><span>name</span></strong> <i><span class="varname">basic-acl-name</span></i> { <strong><span>basic</span></strong> | [ <strong><span>basic</span></strong> ] <strong><span>number</span></strong> <i><span class="varname">basic-acl-number</span></i> } | [ <strong><span>number</span></strong> ] <i><span class="varname">basic-acl-number</span></i> }</span></pre>
</li><li><p>Configure an ACL rule.</p>
<pre class="screen"><span><a href="cmdqueryname=rule+name+deny+permit+fragment-type+fragment+non-fragment"><b><span class="cmdname">rule</span></b></a> [ <i><span class="varname">rule-id</span></i> ] [ <strong><span>name</span></strong> <i><span class="varname">rule-name</span></i> ] { <strong><span>deny</span></strong> | <strong><span>permit</span></strong> } [ <strong><span>fragment-type</span></strong> { <strong><span>fragment</span></strong> | <strong><span>non-fragment</span></strong> | <strong><span>non-subseq</span></strong> | <strong><span>fragment-subseq</span></strong> | <strong><span>fragment-spe-first</span></strong> } | <strong><span>source</span></strong> { <i><span class="varname">source-ip-address</span></i> { <i><span class="varname">source-wildcard</span></i> | <strong><span>0</span></strong><span> | <i><span class="varname">src-netmask</span></i></span> } | <strong><span>any</span></strong> } | <strong><span>time-range</span></strong> <i><span class="varname">time-name</span></i> | <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i> ] <sup>*</sup></span></pre>
<p>When the <a href="cmdqueryname=rule"><b><span class="cmdname">rule</span></b></a> command is used to configure a filtering rule for a named ACL, only the configurations specified by <strong><span>source</span></strong> and <strong><span>time-range</span></strong> take effect.</p>
<div class="p">When a filter-policy of a routing protocol is used to filter routes:<ul><li><p>If the action specified in an ACL rule is permit, a route matching the rule will be accepted or advertised by the device.</p>
</li><li><p>If the action specified in an ACL rule is deny, a route matching the rule will not be accepted or advertised by the device.</p>
</li><li><p>If a route has not matched any ACL rules, the route will not be accepted or advertised by the device.</p>
</li><li><p>If an ACL does not contain any rules, none of the routes matched against the filter-policy that uses this ACL will be accepted or advertised by the device.</p>
</li><li><p>Routes can be filtered using a blacklist or whitelist:</p>
<p>Filtering using a blacklist: Configure a rule with a smaller ID and specify the action <strong>deny</strong> in this rule to filter out the unwanted routes. Then, configure another rule with a larger ID in the same ACL and specify the action <strong>permit</strong> in this rule to advertise or accept the other routes.</p>
<p>Filtering using a whitelist: Configure a rule with a smaller ID and specify the action <strong>permit</strong> in this rule to permit the routes to be advertised or accepted. Then, configure another rule with a larger ID in the same ACL and specify the action <strong>deny</strong> in this rule to filter out the unwanted routes.</p>
<p>If <strong>match-order</strong> is set to <strong>config</strong> for the ACL, the ACL rules are matched based on their configuration order by default. If the ACL rules are numbered with IDs, the rules are matched in ascending order of their IDs.</p>
</li></ul>
</div>
</li><li>Return to the system view.<pre class="screen"><a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></pre>
</li><li>Enter the BGP view.<pre class="screen"><a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></pre>
</li><li>Enter the IPv4 unicast address family view.<pre class="screen"><a href="cmdqueryname=ipv4-family+unicast"><b><span class="cmdname">ipv4-family</span></b></a> <strong><span>unicast</span></strong></pre>
</li><li>Configure the device to filter the routes to be advertised to all peers.<pre class="screen"><a href="cmdqueryname=filter-policy+acl-name+export+direct+isis+ospf+rip+static"><b><span class="cmdname">filter-policy</span></b></a> { <i><span class="varname">acl-number</span></i> | <strong><span>acl-name</span></strong> <i><span class="varname">acl-name</span></i> } <strong><span>export</span></strong> [ <strong><span>direct</span></strong> | <strong><span>isis</span></strong> <i><span class="varname">process-id</span></i> | <strong><span>ospf</span></strong> <i><span class="varname">process-id</span></i><span> | <strong><span>rip</span></strong> <i><span class="varname">process-id</span></i></span> | <strong><span>static</span></strong> ]</pre>
</li></ol>
</div>
</li><li>Configure the BGP device to filter the routes to be advertised against an IP prefix list.<ol type="a"><li>Enter the BGP view.<pre class="screen"><a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></pre>
</li><li>Enter the IPv4 unicast address family view.<pre class="screen"><a href="cmdqueryname=ipv4-family+unicast"><b><span class="cmdname">ipv4-family</span></b></a> <strong><span>unicast</span></strong></pre>
</li><li>Configure the device to filter the routes to be advertised.<pre class="screen"><a href="cmdqueryname=filter-policy+ip-prefix+export+direct+isis+ospf+rip+static"><b><span class="cmdname">filter-policy</span></b></a> <strong><span>ip-prefix</span></strong> <i><span class="varname">ip-prefix-name</span></i> <strong><span>export</span></strong> [ <strong><span>direct</span></strong> | <strong><span>isis</span></strong> <i><span class="varname">process-id</span></i> | <strong><span>ospf</span></strong> <i><span class="varname">process-id</span></i><span> | <strong><span>rip</span></strong> <i><span class="varname">process-id</span></i></span> | <strong><span>static</span></strong> ]</pre>
</li></ol>
</li></ul>
</p><p><p>If a protocol type is specified, only the routes discovered by the specified routing protocol match the filtering condition. If no protocol type is specified, all BGP routes to be advertised match the filtering condition, including those imported using the <a href="cmdqueryname=import-route+%28BGP%29"><b><span class="cmdname">import-route (BGP)</span></b></a> command and local routes imported using the <a href="cmdqueryname=network+%28BGP%29"><b><span class="cmdname">network (BGP)</span></b></a> command.</p>
<div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>If an ACL is specified in the <a href="cmdqueryname=filter-policy"><b><span class="cmdname">filter-policy</span></b></a> command and no VPN instance is specified in ACL rules, BGP filters both public network and VPN routes in all address families. If a VPN instance is specified in an ACL rule, only data traffic from the VPN instance matches the filtering condition, and no routes are filtered.</p>
</div></div>
</p></li><li class="substepexpand"><span>Commit the configuration.</span><p><pre class="screen" id="EN-US_TASK_0000001176663627__en-us_task_0234857734_screen14848162118611"><a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001176663627__en-us_task_0234857734_cmdname1784862115612">commit</span></b></a></pre>
</p></li></ol>
</li><li><span>Configure the BGP device to advertise routes to a specified peer or peer group.</span><ol><li class="substepexpand"><span>Enter the system view.</span><p><pre class="screen"><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></pre>
</p></li><li class="substepexpand"><span>Configure the device to filter the routes to be advertised to a specified peer or peer group.</span><p><ul><li><div class="p">Configure the device to filter the routes to be advertised to a specified peer or peer group against a basic ACL.<ol type="a"><li>Enter the ACL view.<pre class="screen"><span><a href="cmdqueryname=acl+name+basic+basic+number+number"><b><span class="cmdname">acl</span></b></a> { <strong><span>name</span></strong> <i><span class="varname">basic-acl-name</span></i> { <strong><span>basic</span></strong> | [ <strong><span>basic</span></strong> ] <strong><span>number</span></strong> <i><span class="varname">basic-acl-number</span></i> } | [ <strong><span>number</span></strong> ] <i><span class="varname">basic-acl-number</span></i> }</span></pre>
</li><li><p>Configure an ACL rule.</p>
<pre class="screen"><span><a href="cmdqueryname=rule+name+deny+permit+fragment-type+fragment+non-fragment"><b><span class="cmdname">rule</span></b></a> [ <i><span class="varname">rule-id</span></i> ] [ <strong><span>name</span></strong> <i><span class="varname">rule-name</span></i> ] { <strong><span>deny</span></strong> | <strong><span>permit</span></strong> } [ <strong><span>fragment-type</span></strong> { <strong><span>fragment</span></strong> | <strong><span>non-fragment</span></strong> | <strong><span>non-subseq</span></strong> | <strong><span>fragment-subseq</span></strong> | <strong><span>fragment-spe-first</span></strong> } | <strong><span>source</span></strong> { <i><span class="varname">source-ip-address</span></i> { <i><span class="varname">source-wildcard</span></i> | <strong><span>0</span></strong><span> | <i><span class="varname">src-netmask</span></i></span> } | <strong><span>any</span></strong> } | <strong><span>time-range</span></strong> <i><span class="varname">time-name</span></i> | <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i> ] <sup>*</sup></span></pre>
<p>When the <a href="cmdqueryname=rule"><b><span class="cmdname">rule</span></b></a> command is used to configure a filtering rule for a named ACL, only the configurations specified by <strong><span>source</span></strong> and <strong><span>time-range</span></strong> take effect.</p>
<div class="p">When a filter-policy of a routing protocol is used to filter routes:<ul><li><p>If the action specified in an ACL rule is permit, a route matching the rule will be accepted or advertised by the device.</p>
</li><li><p>If the action specified in an ACL rule is deny, a route matching the rule will not be accepted or advertised by the device.</p>
</li><li><p>If a route has not matched any ACL rules, the route will not be accepted or advertised by the device.</p>
</li><li><p>If an ACL does not contain any rules, none of the routes matched against the filter-policy that uses this ACL will be accepted or advertised by the device.</p>
</li><li><p>Routes can be filtered using a blacklist or whitelist:</p>
<p>If <strong>match-order</strong> is set to <strong>config</strong> for the ACL, the ACL rules are matched based on their configuration order by default. If the ACL rules are numbered with IDs, the rules are matched in ascending order of their IDs.</p>
<p>Filtering using a blacklist: Configure a rule with a smaller ID and specify the action <strong>deny</strong> in this rule to filter out the unwanted routes. Then, configure another rule with a larger ID in the same ACL and specify the action <strong>permit</strong> in this rule to advertise or accept the other routes.</p>
<p>Filtering using a whitelist: Configure a rule with a smaller ID and specify the action <strong>permit</strong> in this rule to permit the routes to be advertised or accepted. Then, configure another rule with a larger ID in the same ACL and specify the action <strong>deny</strong> in this rule to filter out the unwanted routes.</p>
</li></ul>
</div>
</li><li>Return to the system view.<pre class="screen"><a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></pre>
</li><li>Enter the BGP view.<pre class="screen"><a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></pre>
</li><li>Enter the IPv4 unicast address family view.<pre class="screen"><a href="cmdqueryname=ipv4-family+unicast"><b><span class="cmdname">ipv4-family</span></b></a> <strong><span>unicast</span></strong></pre>
</li><li>Configure the device to filter the routes to be advertised to a specified peer or peer group.<pre class="screen"><a href="cmdqueryname=peer+filter-policy+acl-name+export"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> | <i><span class="varname">peerIpv6Addr</span></i> } <strong><span>filter-policy</span></strong> { <i><span class="varname">acl-number</span></i> | <strong><span>acl-name</span></strong> <i><span class="varname">acl-name</span></i> } <strong><span>export</span></strong></pre>
</li></ol>
</div>
</li><li><p>Configure the device to filter the routes to be advertised to a specified peer or peer group based on an IP prefix list.</p>
<ol type="a"><li>Enter the BGP view.<pre class="screen"><a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></pre>
</li><li>Enter the IPv4 unicast address family view.<pre class="screen"><a href="cmdqueryname=ipv4-family+unicast"><b><span class="cmdname">ipv4-family</span></b></a> <strong><span>unicast</span></strong></pre>
</li><li>Configure the device to filter the routes to be advertised to a specified peer or peer group.<pre class="screen"><a href="cmdqueryname=peer+ip-prefix+export"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> | <i><span class="varname">peerIpv6Addr</span></i> } <strong><span>ip-prefix</span></strong> <i><span class="varname">ip-prefix-name</span></i> <strong><span>export</span></strong></pre>
</li></ol>
</li><li><p>Configure the device to filter the routes to be advertised to a specified peer or peer group based on an AS_Path filter.</p>
<ol type="a"><li>Enter the BGP view.<pre class="screen"><a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></pre>
</li><li>Enter the IPv4 unicast address family view.<pre class="screen"><a href="cmdqueryname=ipv4-family+unicast"><b><span class="cmdname">ipv4-family</span></b></a> <strong><span>unicast</span></strong></pre>
</li><li>Configure the device to filter the routes to be advertised to a specified peer or peer group.<pre class="screen"><a href="cmdqueryname=peer+as-path-filter+export"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> | <i><span class="varname">peerIpv6Addr</span></i> } <strong><span>as-path-filter</span></strong> { <i><span class="varname">number</span></i> | <i><span class="varname">name</span></i> } <strong><span>export</span></strong></pre>
</li></ol>
</li><li><p>Configure the device to filter the routes to be advertised to a specified peer or peer group based on a route-policy.</p>
<ol type="a"><li>Enter the BGP view.<pre class="screen"><a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></pre>
</li><li>Enter the IPv4 unicast address family view.<pre class="screen"><a href="cmdqueryname=ipv4-family+unicast"><b><span class="cmdname">ipv4-family</span></b></a> <strong><span>unicast</span></strong></pre>
</li><li>Configure the device to filter the routes to be advertised to a specified peer or peer group.<pre class="screen"><a href="cmdqueryname=peer+route-policy+export"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> | <i><span class="varname">peerIpv6Addr</span></i> } <strong><span>route-policy</span></strong> <i><span class="varname">route-policy-name</span></i> <strong><span>export</span></strong></pre>
<div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>A route-policy specified in the <a href="cmdqueryname=peer+route-policy"><b><span class="cmdname">peer route-policy</span></b></a> <a href="cmdqueryname=export"><b><span class="cmdname">export</span></b></a> command does not support interface-based matching rules (configured using the <a href="cmdqueryname=if-match+interface"><b><span class="cmdname">if-match interface</span></b></a> command).</p>
</div></div>
</li></ol>
</li></ul>
<p>The export routing policy applied to a peer in a peer group can be different from that applied to the peer group. Specifically, a unique policy can be used to filter the routes to be advertised to each peer in the peer group.</p>
</p></li><li class="substepexpand"><span>Commit the configuration.</span><p><pre class="screen" id="EN-US_TASK_0000001176663627__en-us_task_0234857734_screen14848162118611_1"><a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001176663627__en-us_task_0234857734_cmdname1784862115612_1">commit</span></b></a></pre>
</p></li></ol>
</li></ul></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="vrp_bgp_cfg_0037.html">Configuring BGP to Advertise Routes
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="vrp_bgp_cfg_0041.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="vrp_bgp_cfg_0043.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>