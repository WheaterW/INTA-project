
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring VLAN ID-based Selective QinQ">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="vrp_vlan_cfg_0061.html">
<meta name="DC.Relation" scheme="URI" content="vrp_vlan_cfg_0064.html">
<meta name="DC.Relation" scheme="URI" content="vrp_vlan_cfg_0067.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="QinQ">
<meta name="featurename" content="VLAN">
<meta name="featuretype" content="Ethernet Switching">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="QinQ">
<meta name="featurename" content="VLAN">
<meta name="featuretype" content="Ethernet Switching">
<meta name="featurename" content="QinQ">
<meta name="featurename" content="VLAN">
<meta name="featurename" content="VLAN Mapping">
<meta name="featurename" content="VLAN Pool">
<meta name="featurename" content="Voice VLAN">
<meta name="featuretype" content="Ethernet Switching">
<meta name="featuretype" content="Ethernet Switching">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001297750725">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>Configuring VLAN ID-based Selective QinQ</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001297750725"></a><a name="EN-US_TASK_0000001297750725"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring VLAN ID-based Selective QinQ</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001297750725__1.3.1"></a><a name="1.3.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>VLAN ID-based selective QinQ allows an interface to add outer VLAN tags to packets based on VLAN IDs of the packets.</p>
<div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><ul><li>Because only hybrid interfaces can distinguish between tagged and untagged modes, you are advised to set the interface type to hybrid.</li><li>If an interface is configured as a trunk interface, you can run the <strong>port trunk pvid vlan</strong> command to configure the interface to remove the VLAN tag from packets carrying the default VLAN ID.</li><li>Only the <span>CE6866, CE6860-SAN, CE6866K, CE6860-HAM, CE8851-32CQ8DQ-P, CE8850-SAN, CE8851K, CE8850-HAM</span>, <span>CE6820H, CE6820H-K, CE6863H, CE6863H-K, CE6881H, CE6881H-K, CE6820S</span>, CE8875, CE8865, CE8865-SAN, CE8855, CE8851-32CQ4BQ, CE6855-48XS8CQ, CE6885, CE6885-SAN, CE6885H, CE6885-LL (standard forwarding mode), CE6885-T, and CE6863E-48S8CQ support the selective QinQ function.</li></ul>
</div></div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001297750725__1.3.2"></a><a name="1.3.2"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Enter the system view.</span><p><pre class="screen"><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></pre>
</p></li><li><span>Enter the interface view.</span><p><pre class="screen"><a href="cmdqueryname=interface"><b><span class="cmdname">interface</span></b></a> <i><span class="varname">interface-type </span></i><i><span class="varname">interface-number</span></i></pre>
</p><p><p>The interface can be a physical interface or an Eth-Trunk interface.</p>
<p>MUX VLAN and selective QinQ cannot be configured on the same interface.</p>
</p></li><li><span>Change the interface working mode from Layer 3 to Layer 2.</span><p><pre class="screen"><a href="cmdqueryname=portswitch"><b><span class="cmdname">portswitch</span></b></a></pre>
</p><p><p>Determine whether to perform this step based on the current interface working mode.</p>
</p></li><li><span>Set the Layer 2 interface attribute to hybrid or trunk.</span><p><pre class="screen"><a href="cmdqueryname=port+link-type"><b><span class="cmdname">port link-type</span></b></a> { <strong><strong><span>hybrid</span></strong></strong> | <strong><strong><span>trunk</span></strong> </strong>}</pre>
</p><p><p><span>By default, the link type of an interface is<span> access.</span></span></p>
</p></li><li><span>Add the interface to VLANs.</span><p><ul><li>For a hybrid interface that sends frames in untagged mode, add it to VLANs in untagged mode.<pre class="screen"><a href="cmdqueryname=port+hybrid+untagged+vlan"><b><span class="cmdname">port hybrid untagged vlan</span></b></a> { { <i><span class="varname">vlan-id1</span></i> [ <strong><span>to</span></strong> <i><span class="varname">vlan-id2</span></i> ] } &amp;&lt;1-10&gt; | <strong><span>all</span></strong> }</pre>
</li></ul>
</p><p><ul><li>For a hybrid interface that sends frames in tagged mode, add it to VLANs in tagged mode.<pre class="screen"><a href="cmdqueryname=port+hybrid+tagged+vlan"><b><span class="cmdname">port hybrid tagged vlan</span></b></a> { { <i><span class="varname">vlan-id1</span></i> [ <strong><span>to</span></strong> <i><span class="varname">vlan-id2</span></i> ] } &amp;&lt;1-40&gt; | <strong><span>all</span></strong> }</pre>
</li><li>For a trunk interface, add it to VLANs.<pre class="screen"><a href="cmdqueryname=port+trunk+allow-pass+vlan"><b><span class="cmdname">port trunk allow-pass vlan</span></b></a> { { <i><span class="varname">vlan-id1</span></i> [ <strong><span>to</span></strong> <i><span class="varname">vlan-id2</span></i> ] } &amp;&lt;1-40&gt; | <strong><span>all</span></strong> }</pre>
</li></ul>
</p><p><p>Only one outer VLAN tag can be added to an inner VLAN tag on an interface. The added outer VLAN tag must be an existing VLAN tag on the device. Note that the inner VLAN tag does not need to be created.</p>
</p></li><li><span>Configure selective QinQ.</span><p><pre class="screen"><a href="cmdqueryname=port+vlan-stacking"><b><span class="cmdname">port vlan-stacking</span></b></a> <strong><span>vlan</span></strong> <i><span class="varname">vlan-id1</span></i> [ <strong><span>to</span></strong> <i><span class="varname">vlan-id2</span></i> ] <strong><span>stack-vlan</span></strong> <i><span class="varname">vlan-id3</span></i> [ <strong><span>remark-8021p</span></strong> <i><span class="varname">8021p-value3</span></i> ]</pre>
<p>If the PVID of an interface is not VLAN 1 (default value), restore the PVID to the default value before running the <strong>port vlan-stacking</strong> command.</p>
<p>VLAN ID-based selective QinQ takes effect only for incoming packets.</p>
</p></li><li><span>Exit the interface view and return to the system view.</span><p><pre class="screen"><a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></pre>
</p></li><li><span>Enter the interface view.</span><p><pre class="screen"><a href="cmdqueryname=interface"><b><span class="cmdname">interface</span></b></a> <i><span class="varname">interface-type </span></i><i><span class="varname">interface-number</span></i></pre>
</p><p><p>This interface is the outbound interface for QinQ packets, different from the interface specified in Step 2.</p>
</p></li><li><span>Configure interface attributes.</span><p><pre class="screen"><a href="cmdqueryname=port+link-type"><b><span class="cmdname">port link-type</span></b></a> <strong><span>trunk</span></strong></pre>
</p></li><li><span>Configure the outer VLANs to which the interface needs to be added.</span><p><pre class="screen"><a href="cmdqueryname=port+trunk+allow-pass+vlan"><b><span class="cmdname">port trunk allow-pass vlan</span></b></a> { { <i><span class="varname">vlan-id1</span></i> [ <strong><span>to</span></strong> <i><span class="varname">vlan-id2</span></i> ] } &amp;&lt;1-40&gt; | <strong><span>all</span></strong> }</pre>
</p></li><li><span>Commit the configuration.</span><p><pre class="screen" id="EN-US_TASK_0000001297750725__en-us_task_0228023023_screen163801330213"><a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001297750725__en-us_task_0228023023_en-us_concept_0141113565_cmdname1667501373175340">commit</span></b></a></pre>
</p></li></ol></div>
<div class="postreq"><a name="EN-US_TASK_0000001297750725__1.3.3"></a><a name="1.3.3"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p>Run the <a href="cmdqueryname=display+current-configuration"><b><span class="cmdname">display current-configuration</span></b></a> <strong><span>interface</span></strong> <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i> command to check the selective QinQ configuration on the interface.</p>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="vrp_vlan_cfg_0061.html">Configuring QinQ
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="vrp_vlan_cfg_0064.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="vrp_vlan_cfg_0067.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>