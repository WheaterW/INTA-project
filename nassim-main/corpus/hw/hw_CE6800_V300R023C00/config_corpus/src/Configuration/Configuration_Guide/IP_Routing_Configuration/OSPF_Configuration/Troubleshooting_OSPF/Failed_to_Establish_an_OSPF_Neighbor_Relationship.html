
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Failed to Establish an OSPF Neighbor Relationship">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../vrp/vrp_ospf_cfg_0114.html">
<meta name="DC.Relation" scheme="URI" content="../vrp/vrp_ospf_cfg_0116.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="OSPF">
<meta name="featuretype" content="IP Routing">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="OSPF">
<meta name="featuretype" content="IP Routing">
<meta name="featuretype" content="IP Routing">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001176662975">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="../public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="../public_sys-resources/browseVersion.js"></script>
<title>Failed to Establish an OSPF Neighbor Relationship</title>
</head>
<body><a name="EN-US_TASK_0000001176662975"></a><a name="EN-US_TASK_0000001176662975"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Failed to Establish an OSPF Neighbor Relationship</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001176662975__1.3.1"></a><a name="1.3.1"></a>
<div class="p"><h4 class="sectiontitle">Fault Symptom</h4><p>An OSPF neighbor relationship cannot be established between two devices.</p>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001176662975__1.3.2"></a><a name="1.3.2"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Check whether the physical status and protocol status of interfaces at both ends are up and stable, whether packet loss occurs on the interfaces, and whether the two devices can ping each other with large packets.</span><p><p>If the physical status or protocol status of either interface is not up or unstable (an interface flaps, for example), check the physical link and link layer protocol. Ensure that both the physical status and protocol status of each interface are up and that the interfaces have no error packet statistics.</p>
<p>You can perform a ping test for a long time with large packets (with each being 1500 bytes or longer) to check whether any packet loss occurs on the interfaces.</p>
</p></li><li><span>Check whether the OSPF processes on the two devices have the same router ID.</span><p><p>Run the <a href="cmdqueryname=display+ospf"><b><span class="cmdname">display ospf</span></b></a> [ <i><span class="varname">process-id</span></i> ] <strong><span>brief</span></strong> command on each device to check the router ID in the OSPF process.</p>
<p>Each router ID must be unique on the entire network. If router ID conflict occurs, devices at both ends cannot establish an OSPF neighbor relationship, and routing information is incorrect. In this case, you are advised to set a unique router ID for each OSPF process on each device.</p>
<p>If the OSPF processes on the devices have the same router ID, run the <a href="cmdqueryname=ospf"><b><span class="cmdname">ospf</span></b></a> [ <i><span class="varname">process-id</span></i> ] <strong><span>router-id</span></strong> <i><span class="varname">router-id</span></i> command in the system view to change the router ID on either device and ensure that the two devices have different router IDs in the same OSPF process.</p>
<p>After changing the router ID, run the <a href="cmdqueryname=reset+ospf"><b><span class="cmdname">reset ospf</span></b></a> [ <i><span class="varname">process-id</span></i> ] <strong><span>process</span></strong> command in the user view to allow the new router ID to take effect.</p>
</p></li><li><span>Check whether the two devices have the same OSPF area ID.</span><p><p>Run the <a href="cmdqueryname=display+ospf"><b><span class="cmdname">display ospf</span></b></a> [ <i><span class="varname">process-id</span></i> ] <strong><span>brief</span></strong> command on each device to check the OSPF area ID.</p>
<p>If the devices have different OSPF area IDs, run the <a href="cmdqueryname=area"><b><span class="cmdname">area</span></b></a> <i><span class="varname">area-id</span></i> command in the OSPF view on either device to change the OSPF area ID and ensure that the two devices have the same OSPF area ID.</p>
</p></li><li><span>Check whether the OSPF interfaces at both ends have the same network type.</span><p><p>Run the <a href="cmdqueryname=display+ospf"><b><span class="cmdname">display ospf</span></b></a> [ <i><span class="varname">process-id</span></i> ] <strong><span>interface</span></strong> command on each device to check the OSPF interface network type.</p>
<p>The network types of the OSPF interfaces at both ends of a link must be the same; otherwise, the two interfaces cannot establish an OSPF neighbor relationship.</p>
<p>If the network types of the two OSPF interfaces are different, run the <a href="cmdqueryname=ospf+network-type"><b><span class="cmdname">ospf network-type</span></b></a> { <strong><span>broadcast</span></strong> | <strong><span>nbma</span></strong> | <strong><span>p2mp</span></strong> | <strong><span>p2p</span></strong> } command in the OSPF interface view on either device to change the network type and ensure that the OSPF interfaces at both ends have the same network type.</p>
<div class="note"><img src="../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>If the network types of OSPF interfaces at both ends are set to NBMA, run the <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ip-address</span></i> [ <strong><span>dr-priority</span></strong> <i><span class="varname">priority</span></i> ] command in the OSPF view on each device to configure the NBMA neighbor.</p>
</div></div>
</p></li><li><span>Check whether the OSPF interfaces at both ends have the same IP address mask.</span><p><p>Run the <a href="cmdqueryname=display+current-configuration"><b><span class="cmdname">display current-configuration</span></b></a> <strong><span>interface</span></strong> <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i> command on each device to check the IP address information of the specified OSPF interface.</p>
<p>The IP address masks of OSPF interfaces at both ends of a link must be the same; otherwise, the two interfaces cannot establish an OSPF neighbor relationship. On a P2MP network, however, you can run the <a href="cmdqueryname=ospf+p2mp-mask-ignore"><b><span class="cmdname">ospf p2mp-mask-ignore</span></b></a> command in the OSPF interface view to disable a device from checking the network mask so that an OSPF neighbor relationship can be established.</p>
<p>If the two OSPF interfaces have different IP address masks, run the <a href="cmdqueryname=ip+address"><b><span class="cmdname">ip address</span></b></a> <i><span class="varname">ip-address</span></i> { <i><span class="varname">mask</span></i> | <i><span class="varname">mask-length</span></i> } command in the OSPF interface view on either device to change the IP address mask and ensure that the two OSPF interfaces have the same IP address mask.</p>
</p></li><li><span>Check whether the network segment that the IP addresses of the two OSPF interfaces belong to is included in the network segment specified in the <strong>network</strong> command.</span><p><p>Run the <a href="cmdqueryname=display+current-configuration"><b><span class="cmdname">display current-configuration</span></b></a> <strong><span>interface</span></strong> <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i> command on each device to check the IP address of the specified OSPF interface, and run the <a href="cmdqueryname=display+current-configuration"><b><span class="cmdname">display current-configuration</span></b></a> <strong><span>configuration</span></strong> <strong><span>ospf</span></strong> command on each device to check the OSPF process configuration.</p>
<p>OSPF can run on an interface only if the following two conditions are met:</p>
<ul><li>The mask length of the interface's IP address is greater than or equal to that converted from the wildcard mask specified in the <strong>network</strong> command. OSPF uses the wildcard mask. For example, 0.0.0.255 indicates that the mask length is 24 bits.</li><li>The primary IP address (if any) of the interface must be within the network segment specified in the <strong>network</strong> command.</li></ul>
<p>If the IP address of an interface does not meet the preceding conditions, run the <a href="cmdqueryname=ip+address"><b><span class="cmdname">ip address</span></b></a> <i><span class="varname">ip-address</span></i> { <i><span class="varname">mask</span></i> | <i><span class="varname">mask-length</span></i> } command in the OSPF interface view to change the IP address of the interface, or run the <a href="cmdqueryname=network"><b><span class="cmdname">network</span></b></a> command in the OSPF area view to change the specified network segment so that the IP address of the interface can meet the preceding conditions.</p>
</p></li><li><span>Check whether the DR priorities of the two OSPF interfaces are not 0.</span><p><p>Run the <a href="cmdqueryname=display+ospf"><b><span class="cmdname">display ospf</span></b></a> [ <i><span class="varname">process-id</span></i> ] <strong><span>interface</span></strong> command on each device to check the OSPF interface's DR priority.</p>
<p>On a broadcast or NBMA network, ensure that the DR priority of at least one OSPF interface on the link is not 0 so that the DR can be elected. Otherwise, the neighbor status of both ends can only reach <strong>2-Way</strong>.</p>
<p>In this case, run the <a href="cmdqueryname=ospf+dr-priority"><b><span class="cmdname">ospf dr-priority</span></b></a> <i><span class="varname">priority</span></i> command in the OSPF interface view on either device to change the DR priority and ensure that at least one OSPF interface has a non-zero DR priority.</p>
</p></li><li><span>Check whether the intervals at which the OSPF interfaces on both ends of the link send Hello packets are the same.</span><p><p>Run the <a href="cmdqueryname=display+ospf"><b><span class="cmdname">display ospf</span></b></a> [ <i><span class="varname">process-id</span></i> ] <strong><span>interface</span></strong> command on devices at both ends of the link to check the interval for sending Hello packets on OSPF interfaces.</p>
<p>If the intervals at which OSPF interfaces on both ends of a link send Hello packets are different, the OSPF neighbor relationship may fail to be established. In this case, run the <strong><a href="cmdqueryname=ospf+timer+hello"><b><span class="cmdname">ospf timer hello</span></b></a></strong> <i><span class="varname">interval</span></i> command in the interface view to change the interval at which OSPF interfaces send Hello packets and ensure that the intervals at the two ends are the same.</p>
</p></li></ol></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../vrp/vrp_ospf_cfg_0114.html">Troubleshooting OSPF
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../vrp/vrp_ospf_cfg_0116.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>