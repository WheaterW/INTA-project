
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="concept">
<meta name="DC.Title" content="ERPS Multi-Ring">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="vrp_erps_cfg_0003.html">
<meta name="DC.Relation" scheme="URI" content="vrp_erps_cfg_0006.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="ERPS">
<meta name="featuretype" content="Ethernet Switching">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="ERPS">
<meta name="featuretype" content="Ethernet Switching">
<meta name="featurename" content="ERPS">
<meta name="featuretype" content="Ethernet Switching">
<meta name="featuretype" content="Ethernet Switching">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_CONCEPT_0000001141938800">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>ERPS Multi-Ring</title>
</head>
<body><a name="EN-US_CONCEPT_0000001141938800"></a><a name="EN-US_CONCEPT_0000001141938800"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">ERPS Multi-Ring</h1>
<div><p>In an ERPS multi-ring scenario, multiple ERPS rings are configured on an ERPS network. ERPSv1 supports only single-ring topologies, whereas ERPSv2 supports both single-ring and multi-ring topologies. An ERPS multi-ring network consists of one or more major rings and sub-rings. R-APS PDUs from sub-rings can be transmitted in VC or NVC mode, depending on whether the R-APS PDUs enter the major ring.</p>
<p>This section describes how ERPS is implemented on a multi-ring network where R-APS PDUs from sub-rings are transmitted in NVC mode when links are normal, when a link fails, and when the link recovers.</p>
<div class="section"><h4 class="sectiontitle">Normal Links</h4><p>In <a href="#EN-US_CONCEPT_0000001141938800__fig_dc_fd_erps_001001">Figure 1</a>, DeviceA through DeviceE constitute a major ring. DeviceB, DeviceC, and DeviceF constitute sub-ring 1, and DeviceC, DeviceD, and DeviceG constitute sub-ring 2. The devices on each ring can communicate with each other.</p>
<ol><li>To prevent loops, each ring blocks its RPL owner port.</li><li>The RPL owner port on the major ring sends R-APS NRRB messages to other nodes on the major ring at an interval of 5s. Similarly, the RPL owner ports on sub-rings 1 and 2 send R-APS NR messages to other nodes on their respective rings at an interval of 5s. The R-APS PDUs of the major ring are transmitted only on the major ring. The R-APS PDUs of the two sub-rings are terminated on the interconnected nodes and are not transmitted to the major ring.</li></ol>
<p>Traffic exchanged between PC1 and the upstream network is transmitted along the path PC1 &lt;-&gt; DeviceF &lt;-&gt; DeviceB &lt;-&gt; DeviceA &lt;-&gt; Router1, and traffic exchanged between PC2 and the upstream network is transmitted along the path PC2 &lt;-&gt; DeviceG &lt;-&gt; DeviceD &lt;-&gt; DeviceE &lt;-&gt; Router2.</p>
<div class="fignone" id="EN-US_CONCEPT_0000001141938800__fig_dc_fd_erps_001001"><a name="EN-US_CONCEPT_0000001141938800__fig_dc_fd_erps_001001"></a><a name="fig_dc_fd_erps_001001"></a><span class="figcap"><b>Figure 1 </b>ERPS multi-ring networking (normal links)</span><br><span><img class="vsd" src="figure/en-us_image_0000001261768219.png"></span></div>
</div>
<div class="section"><h4 class="sectiontitle">Link Fault</h4><p>In <a href="#EN-US_CONCEPT_0000001141938800__fig164623485137">Figure 2</a>, if the link between DeviceD and DeviceG fails, the ERPS protection switching mechanism is triggered. The ports on both ends of the faulty link are blocked, and the RPL owner port on sub-ring 2 is unblocked to send and receive traffic. User traffic of PC1 is not affected. To ensure that downlink traffic of PC2 is not interrupted, interconnected nodes DeviceC and DeviceD need to notify the other nodes on the major ring of the topology change on sub-ring 2. Traffic exchanged between PC2 and the upstream network is transmitted along the path PC2 &lt;-&gt; DeviceG &lt;-&gt; DeviceC &lt;-&gt; DeviceB &lt;-&gt; DeviceA &lt;-&gt; DeviceE &lt;-&gt; Router2. The detailed process is as follows:</p>
<ol><li>After DeviceD and DeviceG detect the link fault, they block their ports on the faulty link and update their FDB entries.</li><li>DeviceG sends three consecutive R-APS SF messages carrying local link fault information within sub-ring 2 immediately after detecting the link fault and then sends R-APS SF messages at an interval of 5s.</li><li>DeviceG where the RPL owner port resides unblocks the RPL owner port and updates its FDB entries.</li><li>After the interconnected node DeviceC receives R-APS SF messages, it updates its FDB entries. After detecting the topology change, DeviceC and DeviceD send R-APS Event messages within the major ring to notify the other nodes of the topology change on sub-ring 2.</li><li>After receiving R-APS Event messages, the other nodes on the major ring update their FDB entries.</li></ol>
<div class="fignone" id="EN-US_CONCEPT_0000001141938800__fig164623485137"><a name="EN-US_CONCEPT_0000001141938800__fig164623485137"></a><a name="fig164623485137"></a><span class="figcap"><b>Figure 2 </b>ERPS multi-ring networking (link fault)</span><br><span><img class="vsd" src="figure/en-us_image_0000001216729386.png"></span></div>
</div>
<div class="section"><h4 class="sectiontitle">Link Recovery</h4><p>After the faulty link recovers, if the ERPS rings use the revertive switching mode, the device where the RPL owner port resides blocks the RPL again, and the link that has recovered is used to forward traffic. If the ERPS rings use the non-revertive switching mode, the link that has recovered is still blocked, and the RPL is not blocked. The following uses the revertive switching mode as an example to describe the recovery process:</p>
<ol><li>After the link between DeviceD and DeviceG recovers, DeviceD and DeviceG start the Guard timer to avoid receiving out-of-date R-APS PDUs. They do not receive any R-APS PDUs before the timer expires. At the same time, DeviceD and DeviceG send R-APS NR messages within sub-ring 2.</li><li>DeviceG where the RPL owner port resides starts the WTR timer. After the WTR timer expires, DeviceG blocks the RPL owner port and unblocks its port on the link that has recovered. At the same time, DeviceG sends R-APS NRRB messages.</li><li>After receiving R-APS NRRB messages from DeviceG, DeviceD unblocks its blocked port, stops sending R-APS NR messages, and updates its FDB entries. After receiving R-APS NRRB messages from DeviceG, DeviceC also updates its FDB entries.</li><li>After DeviceC and DeviceD update their FDB entries, they send R-APS Event messages within the major ring to notify the other nodes of the topology change on sub-ring 2.</li><li>After receiving R-APS Event messages, the other nodes on the major ring update their FDB entries.</li></ol>
<p>Finally, the user traffic of PC2 is switched back to the path shown in <a href="#EN-US_CONCEPT_0000001141938800__fig_dc_fd_erps_001001">Figure 1</a>.</p>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="vrp_erps_cfg_0003.html">Understanding ERPS
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="vrp_erps_cfg_0006.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>
</body>
</html>