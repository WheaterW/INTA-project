
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring DCB">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="galaxy_dcb_cfg_0001.html">
<meta name="DC.Relation" scheme="URI" content="galaxy_dcb_cfg_0019.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="DCB">
<meta name="featuretype" content="DCN and Network Management">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="DCB">
<meta name="featuretype" content="DCN and Network Management">
<meta name="featuretype" content="DCN and Network Management">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001513029674">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring DCB</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001513029674"></a><a name="EN-US_TASK_0000001513029674"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring DCB</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001513029674__1.3.1"></a><a name="1.3.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>During deployment of a converged data center network, DCB is used to build lossless Ethernet, meeting QoS requirements on the converged data center network.</p>
<div class="p">DeviceA carries common Ethernet traffic and the server cluster's IPC traffic, and the 802.1p priority of IPC traffic is 7. The QoS requirements of these types of traffic are as follows:<ul><li>IPC traffic requires low latency.</li><li>Common Ethernet traffic is transmitted in BE mode.</li></ul>
</div>
<div class="fignone"><span class="figcap"><b>Figure 1 </b>Networking diagram of a data center</span><div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface1, interface2, and interface3 represent <span>100GE</span> <span>1/0/1</span>, <span>100GE</span> <span>1/0/2</span>, and <span>100GE</span> <span>1/0/3</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0000001563869645.png" width="NaN" height="NaN"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001513029674__1.3.2"></a><a name="1.3.2"></a>
<div class="p"><h4 class="sectiontitle">Precautions</h4><p>This example applies to the following models: <span>CE6866, CE6860-SAN, CE6866K, CE6860-HAM, CE8851-32CQ8DQ-P, CE8850-SAN, CE8851K, CE8850-HAM</span>, <span>CE6855-48XS8CQ, CE6863E-48S8CQ, CE6885, CE6885-LL (standard forwarding mode), CE6885-SAN, CE6885-T, CE8851-32CQ4BQ, CE8855</span>.</p>
<p>The CE6885-LL (low-latency mode) supports only PFC. It does not support ETS, DCBX, or specifying the PFC working to auto.</p>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001513029674__1.3.3"></a><a name="1.3.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>To meet QoS requirements in the preceding scenario, configure DCB on DeviceA.</p>
<div class="p">The configuration roadmap is as follows:<ol><li>If the peer DCBX version is <strong>intel-oui</strong>, switch the DCBX version on DeviceA.</li><li>Configure DCBX on DeviceA to implement automatic DCB capability negotiation at both ends of a link.</li><li>Configure PFC on DeviceA to ensure lossless transmission of SAN traffic.</li><li>Configure ETS on DeviceA to ensure low latency of IPC traffic and bandwidth of SAN traffic.</li></ol>
</div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001513029674__1.3.4"></a><a name="1.3.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Switch the DCBX version.</span><p><p># The default DCBX version is <strong>IEEE DCBX</strong>. If the DCBX version of the peer device is <strong>intel-oui</strong>, switch the DCBX version on <span>100GE</span><span>1/0/1</span>, <span>100GE</span><span>1/0/2</span>, and <span>100GE</span><span>1/0/3</span>.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>interface <span>100ge</span> <span>1/0/1</span></strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>dcb compliance intel-oui</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>interface <span>100ge</span> <span>1/0/2</span></strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/2</span>] <strong>dcb compliance intel-oui</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/2</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>interface <span>100ge</span> <span>1/0/3</span></strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/3</span>] <strong>dcb compliance intel-oui</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/3</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>commit</strong></pre>
</p></li><li><span>Configure DCBX.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>lldp enable</strong>
[<span class="keyword">*</span>DeviceA] <strong>interface <span>100ge</span> <span>1/0/1</span></strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>lldp tlv-enable dcbx</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>interface <span>100ge</span> <span>1/0/2</span></strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/2</span>] <strong>lldp tlv-enable dcbx</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/2</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>interface <span>100ge</span> <span>1/0/3</span></strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/3</span>] <strong>lldp tlv-enable dcbx</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/3</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>commit</strong></pre>
</p></li><li><span>Configure PFC.</span><p><p># Enable <span>PFC globally and enable </span>PFC in queues with priority 3. By default, <span>PFC is enabled globally, and </span>PFC is enabled in queues with priority 3. Therefore, skip this step.</p>
</p><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>qos buffer headroom-pool size</strong><strong> 4 mbytes slot <span>1</span></strong>      //This command is required only on the <span>CE6855-48XS8CQ, CE6863E-48S8CQ, CE6885, CE6885-LL, CE6885-SAN, CE6885-T, CE8851-32CQ4BQ, CE8855</span>.
[<span class="keyword">*</span>DeviceA] <strong>interface <span>100ge</span> <span>1/0/1</span></strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>dcb pfc enable mode auto</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>interface <span>100ge</span> <span>1/0/2</span></strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/2</span>] <strong>dcb pfc enable mode auto</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/2</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>interface <span>100ge</span> <span>1/0/3</span></strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/3</span>] <strong>dcb pfc enable mode auto</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/3</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>commit</strong></pre>
</p></li><li><span>Configure ETS.</span><p><p># Create an ETS profile.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>dcb ets-profile ets1</strong></pre>
</p><p><p># Map queue 3 to PG1, queue 7 to PG15, and other queues to PG0. Queue 3 maps PG1, and queues 6 and 7 map PG15 by default, so you only need to add queue 6 to PG0.</p>
<pre class="screen">[<span class="keyword">*</span>DeviceA-ets-ets1] <strong>priority-group 0 queue 6</strong></pre>
</p><p><p># Configure flow control based on the priority group and set DRR weights of PG0 and PG1 to 60% and 40% respectively.</p>
<pre class="screen">[<span class="keyword">*</span>DeviceA-ets-ets1] <strong>priority-group 0 drr weight 60</strong>
[<span class="keyword">*</span>DeviceA-ets-ets1] <strong>priority-group 1 drr weight 40</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceA-ets-ets1] <strong>quit</strong></pre>
</p><p><p># Apply the ETS profile on <span>100GE</span><span>1/0/1</span> and <span>100GE</span><span>1/0/2</span>.</p>
<pre class="screen">[<span class="keyword">*</span>DeviceA] <strong>interface <span>100ge</span> <span>1/0/1</span></strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>dcb ets enable ets1</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/1</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>interface <span>100ge</span> <span>1/0/2</span></strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/2</span>] <strong>dcb ets enable ets1</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/2</span>] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>commit</strong></pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001513029674__1.3.5"></a><a name="1.3.5"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p># Check the ETS profile configuration.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>display dcb ets-profile ets1</strong>
ETS Profile: ets1                                                               
------------------------------------------------------------------------------- 
PG(RN)  Q  SCH    Weight              CIR/PIR(kbps)            CBS/PBS(kbytes)  
------------------------------------------------------------------------------- 
 0(0)   -  DRR    60(60)                -/-                      -/-            
        0  PQ          -                -/-                      -/-            
        1  PQ          -                -/-                      -/-            
        2  PQ          -                -/-                      -/-            
        4  PQ          -                -/-                      -/-            
        5  PQ          -                -/-                      -/-            
        6  PQ          -                -/-                      -/-            
 1(1)   -  DRR    40(40)                -/-                      -/-            
        3  PQ          -                -/-                      -/-            
15(15)  -  PQ          -                -/-                      -/-            
        7  PQ          -                -/-                      -/-            
------------------------------------------------------------------------------- </pre>
<p># Check the DCB configuration and negotiation status.</p>
<p>Run the <strong>display dcb</strong> command to check the DCB configuration and negotiation status. If the DCB configuration is correct, the following negotiation result is displayed:</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>display dcb</strong>
M:Manual;    A:Auto                                                             
------------------------------------------------------------------------------- 
Interface         PFC Name     PFC Status  ETS Name    ETS Status App-Profile   
------------------------------------------------------------------------------- 
<span>100GE</span><span>1/0/1</span>        default      <strong>ENABLE(A)</strong>   ets1        <strong>SUCCEED</strong>     -             
<span>100GE</span><span>1/0/2</span>        default      <strong>ENABLE(A)</strong>   ets1        <strong>SUCCEED</strong>     -             
<span>100GE</span><span>1/0/3</span>        default      <strong>ENABLE(A)</strong>   -           <strong>-</strong>            -             
-------------------------------------------------------------------------------</pre>
<h4 class="sectiontitle">Configuration Scripts</h4><pre class="screen">#
sysname DeviceA
#
dcb pfc                                                                         
#                                                                               
dcb ets-profile default                                                         
#                                                                               
dcb ets-profile ets1                                                            
 priority-group 0 drr weight 60                                                 
 priority-group 1 drr weight 40                                                 
 priority-group 0 queue 0 to 2 4 to 6                                           
 priority-group 15 queue 7                                                      
#                                                                               
dcb app-profile default
#
qos buffer headroom-pool size 4 mbytes slot <span>1</span>      //This command is required only on the <span>CE6855-48XS8CQ, CE6863E-48S8CQ, CE6885, CE6885-LL, CE6885-SAN, CE6885-T, CE8851-32CQ4BQ, CE8855</span>.
#                                                                               
interface <span>100GE</span><span>1/0/1</span>
 lldp tlv-enable dcbx                                                           
 dcb compliance intel-oui                                                       
 dcb ets enable ets1                                                            
 dcb pfc enable mode auto 
#
interface <span>100GE</span><span>1/0/2</span>
 lldp tlv-enable dcbx                                                           
 dcb compliance intel-oui                                                       
 dcb ets enable ets1                                                            
 dcb pfc enable mode auto
#
interface <span>100GE</span><span>1/0/3</span> 
 lldp tlv-enable dcbx                                                           
 dcb compliance intel-oui                                                       
 dcb pfc enable mode auto
#
lldp enable                                                                     
#
return</pre>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="galaxy_dcb_cfg_0001.html">DCB Configuration
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="galaxy_dcb_cfg_0019.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>
</body>
</html>