
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring DHCPv4 Relay">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="galaxy_dhcpv4_cfg_0022.html">
<meta name="DC.Relation" scheme="URI" content="galaxy_dhcpv4_cfg_0024.html">
<meta name="DC.Relation" scheme="URI" content="galaxy_dhcpv4_cfg_0047.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="DHCPv4">
<meta name="featuretype" content="IP Addresses and Services">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="DHCPv4">
<meta name="featuretype" content="IP Addresses and Services">
<meta name="featurename" content="DHCPv4">
<meta name="featuretype" content="IP Addresses and Services">
<meta name="featuretype" content="IP Addresses and Services">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001513166134">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>Configuring DHCPv4 Relay</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001513166134"></a><a name="EN-US_TASK_0000001513166134"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring DHCPv4 Relay</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001513166134__1.3.1"></a><a name="1.3.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>If a DHCPv4 server and client are on the same network segment, they can directly exchange DHCPv4 messages. In this case, no DHCPv4 relay agent is required. If a DHCPv4 server and client are on different network segments, a device must be configured as a DHCPv4 relay agent to forward DHCPv4 messages.</p>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001513166134__1.3.2"></a><a name="1.3.2"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Enter the system view.</span><p><pre class="screen"><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></pre>
</p></li><li><span>(Optional) Configure the DHCPv4 relay agent not to check the DHCPv4 server identifier (Option 54) in a DHCPREQUEST message to be forwarded.</span><p><pre class="screen"><a href="cmdqueryname=undo+dhcp+relay+request+server-match+enable"><b><span class="cmdname">undo dhcp relay request server-match enable</span></b></a></pre>
<p>By default, a DHCPv4 relay agent checks the DHCPv4 server identifier (Option 54) in a DHCPREQUEST message to be forwarded.</p>
</p></li><li><span>(Optional) Configure the DHCPv4 relay agent to forward all DHCPACK messages.</span><p><pre class="screen"><a href="cmdqueryname=dhcp+relay+reply+forward+all+enable"><b><span class="cmdname">dhcp relay reply forward all enable</span></b></a></pre>
<p>By default, a DHCPv4 relay agent forwards only the first received DHCPACK message.</p>
</p></li><li><span>Enter the interface view.</span><p><pre class="screen"><a href="cmdqueryname=interface"><b><span class="cmdname">interface</span></b></a> <i><span class="varname">interface-type interface-number</span></i></pre>
</p></li><li><span>Switch the interface working mode to Layer 3.</span><p><pre class="screen" id="EN-US_TASK_0000001513166134__en-us_task_0228023023_screen166833536478"><a href="cmdqueryname=undo+portswitch"><b><span class="cmdname" id="EN-US_TASK_0000001513166134__en-us_task_0228023023_cmdname182821059820">undo portswitch</span></b></a></pre>
<p id="EN-US_TASK_0000001513166134__en-us_task_0228023023_p18457174912148">Determine whether to perform this step based on the current interface working mode.</p>
</p></li><li><span>Configure an IPv4 address for the interface.</span><p><div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Generally, DHCPv4 relay is configured on a user-side gateway interface. In this case, the IPv4 address of the gateway interface must be on the same network segment as the address pool configured on the server. Otherwise, a DHCPv4 client cannot obtain an IPv4 address.</p>
</div></div>
</p><ul><li>Configure an IPv4 address for the interface.<pre class="screen"><a href="cmdqueryname=ip+address"><b><span class="cmdname">ip address</span></b></a> <i><span class="varname">ip-address</span></i> { <i><span class="varname">mask</span></i> | <i><span class="varname">mask-length</span></i> }</pre>
<p>By default, no IPv4 address is configured for an interface.</p>
</li><li>Configure the interface to borrow the IPv4 address of another interface.<pre class="screen"><a href="cmdqueryname=ip+address+unnumbered+interface"><b><span class="cmdname">ip address unnumbered interface</span></b></a> <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i></pre>
<p>By default, an interface does not borrow the IPv4 address of another interface.</p>
</li></ul>
</li><li><span>Enable DHCPv4 relay on the interface.</span><p><pre class="screen"><a href="cmdqueryname=dhcp+select+relay"><b><span class="cmdname">dhcp select relay</span></b></a></pre>
<p>By default, DHCPv4 relay is disabled on an interface.</p>
</p></li><li><span>(Optional) In an inter-VPN scenario, enable the DHCPv4 relay interface to insert Option 82 into DHCPv4 messages.</span><p><pre class="screen"><a href="cmdqueryname=dhcp+option82"><b><span class="cmdname">dhcp option82</span></b></a> { <strong><span>vss-control</span></strong> | <strong><span>link-selection</span></strong> | <strong><span>server-id-override</span></strong> } <strong><span>insert</span></strong> <strong><span>enable</span></strong></pre>
</p><p><p>By default, a DHCPv4 relay interface does not insert Option 82 into DHCPv4 messages.</p>
</p><p><p>If a DHCPv4 client and server are located in different VPNs, you must run this command on the DHCPv4 relay agent. You can specify <strong><span>vss-control</span></strong>, <strong><span>link-selection</span></strong>, and <strong><span>server-id-override</span></strong> to insert Option 82's different suboptions into DHCPv4 messages, ensuring that clients can obtain IPv4 addresses.</p>
<p>The <strong>dhcp option82 link-selection insert enable</strong> command takes precedence over the <a href="cmdqueryname=dhcp+relay+source-ip-address"><b><span class="cmdname">dhcp relay source-ip-address</span></b></a> and <a href="cmdqueryname=dhcp+relay+gateway"><b><span class="cmdname">dhcp relay gateway</span></b></a> commands.</p>
</p></li><li><span>(Optional) In an inter-VPN scenario, modify the information of the giaddr field.</span><p><p>Configure the source interface of DHCPv4 relay messages, and use the primary IPv4 address of the interface to fill in the giaddr field.</p>
<pre class="screen"><a href="cmdqueryname=dhcp+relay+giaddr+source-interface"><b><span class="cmdname">dhcp relay giaddr source-interface</span></b></a> <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-num</span></i></pre>
<p>Or configure the device to use the primary IPv4 address of the outbound interface to fill in the giaddr field.</p>
<pre class="screen"><a href="cmdqueryname=dhcp+relay+giaddr+outgoing-interface-address"><b><span class="cmdname">dhcp relay giaddr outgoing-interface-address</span></b></a></pre>
<p>By default, a device uses the IPv4 address of a DHCPv4 relay agent to fill in the giaddr field.</p>
<p>The <a href="cmdqueryname=dhcp+relay+source-ip-address"><b><span class="cmdname">dhcp relay source-ip-address</span></b></a> and <a href="cmdqueryname=dhcp+relay+gateway"><b><span class="cmdname">dhcp relay gateway</span></b></a> commands are mutually exclusive with the <a href="cmdqueryname=dhcp+relay+giaddr+source-interface"><b><span class="cmdname">dhcp relay giaddr source-interface</span></b></a> and <a href="cmdqueryname=dhcp+relay+giaddr+outgoing-interface-address"><b><span class="cmdname">dhcp relay giaddr outgoing-interface-address</span></b></a> commands.</p>
<p>The <a href="cmdqueryname=dhcp+relay+giaddr+source-interface"><b><span class="cmdname">dhcp relay giaddr source-interface</span></b></a> <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-num</span></i> command takes precedence over the <a href="cmdqueryname=dhcp+relay+giaddr+outgoing-interface-address"><b><span class="cmdname">dhcp relay giaddr outgoing-interface-address</span></b></a> command.</p>
<p>In an inter-VPN scenario, if the DHCPv4 server supports the link-selection suboption of Option 82, you can perform this step to ensure that the DHCPv4 relay agent can search for a return route for reply messages based on the address specified by the giaddr field. If the DHCPv4 server does not support the link-selection suboption, this step cannot be performed. However, you can run the <a href="cmdqueryname=dhcp+relay+giaddr+source-interface"><b><span class="cmdname">dhcp relay giaddr source-interface</span></b></a> <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-num</span></i> command on the DHCPv4 relay agent, configure the IP address of the source interface as the address specified by the giaddr field, and bind the source interface to the VPN where the server resides. This ensures that the return route is reachable.</p>
<p>This step cannot be performed in a non-inter-VPN scenario, as doing so causes user access failures.</p>
</p></li><li><span>(Optional) Configure a source address and gateway address for the DHCPv4 relay agent.</span><ul><li>Configure a source address for the DHCPv4 relay agent. DHCPv4 request and reply messages may travel along different paths. If such a case occurs, the relay agent discards a reply message because it cannot find user information. As a result, the client cannot go online. To resolve this issue, you can change the source address of DHCPv4 messages. After receiving a DHCPv4 request message, the relay agent fills the source address in the Source Address field in the IP header of the message. When the DHCPv4 server replies with a message, it searches for a route based on this address.<pre class="screen"><a href="cmdqueryname=dhcp+relay+source-ip-address"><b><span class="cmdname">dhcp relay source-ip-address</span></b></a> <i><span class="varname">ip-address</span></i></pre>
<p>By default, the source address of a DHCPv4 relay agent is the primary IPv4 address of a relay interface.</p>
</li><li>Configure a gateway address for the DHCPv4 relay agent. Generally, a gateway address can be set to the primary or secondary IPv4 address of an interface. If VRRP is enabled on an interface, you must perform this step to forcibly specify a gateway address.<pre class="screen"><a href="cmdqueryname=dhcp+relay+gateway"><b><span class="cmdname">dhcp relay gateway</span></b></a> <i><span class="varname">ip-address</span></i></pre>
<p>By default, no gateway address is configured, and the primary IPv4 address of an interface is used as the gateway address of a DHCPv4 relay agent.</p>
</li></ul>
</li><li><span>(Optional) Configure abnormal packet detection.</span><ul><li>Configure the device to check the magic cookie field in received DHCPv4 messages in the system view.<pre class="screen"><a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a>
<a href="cmdqueryname=dhcp+anti-attack+check+magic-cookie"><b><span class="cmdname">dhcp anti-attack check magic-cookie</span></b></a></pre>
</li><li>Configure the device to check the magic cookie field in received DHCPv4 messages in the VLAN view.<pre class="screen"><a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a>
<a href="cmdqueryname=vlan"><b><span class="cmdname">vlan</span></b></a> <i><span class="varname">vlan-id</span></i>
<a href="cmdqueryname=dhcp+anti-attack+check+magic-cookie"><b><span class="cmdname">dhcp anti-attack check magic-cookie</span></b></a></pre>
</li><li>Configure the device to check the magic cookie field in received DHCPv4 messages in the interface view.<pre class="screen"><a href="cmdqueryname=dhcp+anti-attack+check+magic-cookie"><b><span class="cmdname">dhcp anti-attack check magic-cookie</span></b></a></pre>
</li><li>Configure the device not to check the UDP header checksum in received DHCPv4 messages in the system view.<pre class="screen"><a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a>
<strong>undo</strong> <a href="cmdqueryname=dhcp+anti-attack+check+udp-checksum"><b><span class="cmdname">dhcp anti-attack check udp-checksum</span></b></a></pre>
</li><li>Configure the device not to check the UDP header checksum in received DHCPv4 messages in the VLAN view.<pre class="screen"><a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a>
<a href="cmdqueryname=vlan"><b><span class="cmdname">vlan</span></b></a> <i><span class="varname">vlan-id</span></i>
<strong>undo</strong> <a href="cmdqueryname=dhcp+anti-attack+check+udp-checksum"><b><span class="cmdname">dhcp anti-attack check udp-checksum</span></b></a></pre>
</li><li>Configure the device not to check the UDP header checksum in received DHCPv4 messages in the interface view.<pre class="screen"><strong>undo</strong> <a href="cmdqueryname=dhcp+anti-attack+check+udp-checksum"><b><span class="cmdname">dhcp anti-attack check udp-checksum</span></b></a></pre>
</li><li>Configure the device to carry the UDP header checksum in sent DHCPv4 messages in the system view.<pre class="screen"><a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a>
<strong><a href="cmdqueryname=dhcp+udp-checksum+enable"><b><span class="cmdname">dhcp udp-checksum enable</span></b></a></strong></pre>
</li></ul>
<p><p>By default, a device does not check the magic cookie field in DHCPv4 messages and directly forwards those with incorrect magic cookie field values; a device checks the UDP header checksum in DHCPv4 messages and discards those with incorrect checksums.</p>
</p></li><li><span>Commit the configuration.</span><p><pre class="screen" id="EN-US_TASK_0000001513166134__en-us_task_0228023023_screen163801330213"><a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001513166134__en-us_task_0228023023_en-us_concept_0141113565_cmdname1667501373175340">commit</span></b></a></pre>
</p></li></ol></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="galaxy_dhcpv4_cfg_0022.html">Configuring a Device to Function as a DHCPv4 Relay Agent
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="galaxy_dhcpv4_cfg_0024.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="galaxy_dhcpv4_cfg_0047.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>