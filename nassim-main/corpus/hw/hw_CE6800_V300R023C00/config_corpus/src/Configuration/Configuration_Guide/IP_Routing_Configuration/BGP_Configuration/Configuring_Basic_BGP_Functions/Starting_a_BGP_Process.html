
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Starting a BGP Process">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="vrp_bgp_cfg_0014.html">
<meta name="DC.Relation" scheme="URI" content="vrp_bgp_cfg_0016.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing">
<meta name="featuretype" content="IP Routing">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001130624122">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>Starting a BGP Process</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001130624122"></a><a name="EN-US_TASK_0000001130624122"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Starting a BGP Process</h1>
<div class="taskbody"><div class="prereq" style="margin-left:0"><a name="EN-US_TASK_0000001130624122__1.3.1"></a><a name="1.3.1"></a><h4 class="sectiontitle">Prerequisites</h4>
<div class="p"><p>Before configuring basic BGP functions, you have completed the following task:</p>
<ul><li><p>Set data link layer protocol parameters and IP addresses for interfaces to ensure that the data link layer protocol status on each interface is up.</p>
</li></ul>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001130624122__1.3.2"></a><a name="1.3.2"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>Building a BGP network can implement communication between different ASs. Configuring basic BGP functions is a prerequisite for such a BGP network, and includes the following steps:</p>
<ul><li><p>Create a BGP process: This step is a prerequisite for configuring all BGP functions.</p>
</li><li><p>Establish BGP peer relationships: Devices can exchange BGP routing information only after peer relationships are established between them.</p>
</li><li><p>Import routes: BGP itself cannot discover routes. Instead, it needs to import routes discovered by non-BGP protocols to generate BGP routes.</p>
</li></ul>
<div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>To facilitate configuration, the commands in the BGP-IPv4 unicast address family view can be run in the BGP view. However, in configuration files, these commands are still displayed in the BGP-IPv4 unicast address family view.</p>
<p>To prevent the commands of the BGP-IPv4 unicast address family from being executed in the BGP view, run the <a href="cmdqueryname=bgp+default+ipv4-unicast-config+disable"><b><span class="cmdname">bgp default ipv4-unicast-config disable</span></b></a> command.</p>
</div></div>
<p>Starting a BGP process is a prerequisite for configuring basic BGP functions. When starting a BGP process on a device, you need to specify the number of the AS to which the device belongs.</p>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001130624122__1.3.3"></a><a name="1.3.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Enter the system view.</span><p><pre class="screen"><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></pre>
</p></li><li><span>(Optional) Enable BGP routing loop detection.</span><p><pre class="screen"><a href="cmdqueryname=route+loop-detect+bgp+enable"><b><span class="cmdname">route loop-detect bgp enable</span></b></a></pre>
<p>After this function is enabled, the device reports an alarm when detecting a BGP routing loop. Because the device cannot determine whether the routing loop is removed, the alarm will not be cleared automatically even if the routing loop is removed. To manually clear the BGP routing loop alarm, run the <a href="cmdqueryname=clear+route+loop-detect+bgp+alarm"><b><span class="cmdname">clear route loop-detect bgp alarm</span></b></a> command.</p>
</p></li><li><span>Enable BGP (with the local AS number specified), and enter the BGP view.</span><p><pre class="screen"><a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></pre>
</p></li><li><span>(Optional) Configure a BGP router ID.</span><p><pre class="screen"><a href="cmdqueryname=router-id"><b><span class="cmdname">router-id</span></b></a> <i><span class="varname">ipv4-address</span></i></pre>
<p>Configuring a new BGP router ID or changing the existing one will reset the BGP peer relationship between devices.</p>
<p>If two devices have different router IDs, an IBGP or EBGP connection can be established between them. If the router IDs are the same and the <a href="cmdqueryname=router-id+allow-same+enable"><b><span class="cmdname">router-id allow-same enable</span></b></a> command is run, an EBGP connection can be established.</p>
<div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>By default, BGP automatically selects a router ID in the system view as its router ID. If the IP address of a physical interface is used as the router ID, route flapping occurs when this IP address changes. To enhance network stability, configuring the IP address of a loopback interface as the router ID is recommended. For rules in selecting router IDs from the system view, see the <a href="cmdqueryname=router-id"><b><span class="cmdname">router-id</span></b></a> command description.</p>
<p>By default, Cluster_List comparison takes precedence over router ID comparison during BGP route selection. To enable router ID comparison to take precedence over Cluster_List comparison during BGP route selection, run the <a href="cmdqueryname=bestroute+routerid-prior-clusterlist"><b><span class="cmdname">bestroute routerid-prior-clusterlist</span></b></a> command.</p>
</div></div>
</p></li><li><span>(Optional) Terminate the BGP sessions between the device and all its BGP peers.</span><p><pre class="screen"><a href="cmdqueryname=shutdown"><b><span class="cmdname">shutdown</span></b></a></pre>
</p><p><p>Frequent BGP route flapping may occur during system upgrade and maintenance. To prevent this from impacting the network, perform this step.</p>
<div class="notice"><span class="noticetitle"><img src="public_sys-resources/notice_3.0-en-us.png"> </span><div class="noticebody"><p>After an upgrade or maintenance, run the <a href="cmdqueryname=undo+shutdown"><b><span class="cmdname">undo shutdown</span></b></a> command to restore the BGP sessions; if you do not run this command, BGP functions will not work properly.</p>
</div></div>
</p></li><li><span>(Optional) Configure BGP memory protection.</span><p><pre class="screen"><a href="cmdqueryname=prefix+memory-limit"><b><span class="cmdname">prefix memory-limit</span></b></a></pre>
</p></li><li><span>(Optional) Configure BGP to minimize the priorities of BGP routes to be advertised.</span><p><pre class="screen"><a href="cmdqueryname=advertise+lowest-priority+on-startup+delay-time"><b><span class="cmdname">advertise lowest-priority on-startup</span></b></a> [ <strong><span>delay-time</span></strong> <i><span class="varname">time-value</span></i> ]</pre>
<p>During ARP entry delivery triggered upon a device restart, if the BGP routes advertised by the device are selected as optimal routes, traffic loss may occur. To prevent this problem, run the <b><span class="cmdname">advertise lowest-priority on-startup</span></b> command before the device is restarted to configure BGP to minimize the priorities of BGP routes to be advertised to peers. After configuration, the MED and Local_Pref of the BGP routes are changed to 4294967295 and 0, respectively. This ensures that BGP routes advertised by the device after restart have the lowest priority. To configure the device to restore the original priorities of these routes after delivering ARP entries, run the <a href="cmdqueryname=reset+bgp+advertise+lowest-priority+on-startup"><b><span class="cmdname">reset bgp advertise lowest-priority on-startup</span></b></a> command.</p>
<p>Alternatively, you can also run the <a href="cmdqueryname=advertise+lowest-priority+on-startup+delay-time"><b><span class="cmdname">advertise lowest-priority on-startup</span></b></a><strong><span> delay-time</span></strong> <i><span class="varname">time-value</span></i> command before the device restarts to ensure that the priorities of the routes advertised by the device are the lowest among the routes of the same type within the configured delay after the device restarts. ARP entry delivery completes within the delay time. After the delay time expires, the original priorities of the routes advertised by the device are automatically restored. Within the delay, you can also run the <a href="cmdqueryname=reset+bgp+advertise+lowest-priority+on-startup"><b><span class="cmdname">reset bgp advertise lowest-priority on-startup</span></b></a> command to restore the original priorities of the routes advertised by the device.</p>
<div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>If the <a href="cmdqueryname=advertise+lowest-priority+on-startup"><b><span class="cmdname">advertise lowest-priority on-startup</span></b></a> command is run after BGP configurations are committed, the command configuration takes effect only after the configurations are saved and the <a href="cmdqueryname=reboot"><b><span class="cmdname">reboot</span></b></a> command is run. If the <a href="cmdqueryname=advertise+lowest-priority+on-startup"><b><span class="cmdname">advertise lowest-priority on-startup</span></b></a> command and BGP configurations are committed together, the command configuration takes effect immediately.</p>
</div></div>
</p></li><li><span>(Optional) Configure BGP to minimize the priorities of routes to be advertised to BGP peers when the peers go from down to up.</span><p><pre class="screen"><a href="cmdqueryname=advertise+lowest-priority+all-address-family+peer-up+delay"><b><span class="cmdname">advertise lowest-priority all-address-family peer-up</span></b></a> [ <strong><span>delay</span></strong> <i><span class="varname">delay</span></i> ]</pre>
<p>This command is used in scenarios where route advertisement is delayed to prevent long packet loss during a traffic switchback. If the <a href="cmdqueryname=advertise+lowest-priority+all-address-family+peer-up"><b><span class="cmdname">advertise lowest-priority all-address-family peer-up</span></b></a> command is not run, the routes with unchanged priorities are sent immediately after the peer relationship is established. If the <a href="cmdqueryname=advertise+lowest-priority+all-address-family+peer-up"><b><span class="cmdname">advertise lowest-priority all-address-family peer-up</span></b></a> command is run and a peer relationship is established, BGP advertises routes carrying the lowest priority (largest MED value and smallest Local_Pref value) to the peer until the specified delay expires. BGP starts to advertise routes with the original priorities only after the delay expires.</p>
<div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>To restore the priorities of routes to be advertised to BGP peers when the peers go from down to up, run the <a href="cmdqueryname=reset+bgp+advertise+lowest-priority+all-address-family+peer-up"><b><span class="cmdname">reset bgp advertise lowest-priority all-address-family peer-up</span></b></a> command.</p>
</div></div>
</p></li><li><span>(Optional) Configure a delay for BGP route advertisement after a device restart.</span><p><pre class="screen"><a href="cmdqueryname=advertise+delay+on-startup+delay-time"><b><span class="cmdname">advertise delay on-startup delay-time </span></b></a><i><span class="varname">time-value</span></i></pre>
<p>The <a href="cmdqueryname=advertise+delay+on-startup+delay-time"><b><span class="cmdname">advertise delay on-startup delay-time</span></b></a> configuration takes effect only after it is saved and the <a href="cmdqueryname=reboot"><b><span class="cmdname">reboot</span></b></a> command is run.</p>
<p>After a device is restarted, traffic loss may occur if the device advertises routes during ARP entry delivery. To prevent this issue, you can run the <a href="cmdqueryname=advertise+delay+on-startup+delay-time"><b><span class="cmdname">advertise delay on-startup delay-time</span></b></a> command before restarting the device to configure a delay for advertising BGP routes after the device restarts. The command specifies how long the device must wait after a restart before it starts to advertise BGP routes. To allow the device to advertise BGP routes immediately after ARP entries are delivered, run the <a href="cmdqueryname=refresh+bgp+all+export"><b><span class="cmdname">refresh bgp all export</span></b></a> or <a href="cmdqueryname=reset+bgp+advertise+delay+on-startup"><b><span class="cmdname">reset bgp advertise delay on-startup</span></b></a> command.</p>
</p></li><li><span>(Optional) Configure BGP to record peer state changes and event information.</span><p><pre class="screen"><a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <a href="cmdqueryname=log-change"><b><span class="cmdname">log-change</span></b></a></pre>
<p>System log files serve as an important reference for locating network connectivity and stability problems. If an error occurs on a connection between BGP peers, a corresponding error code and subcode are generated. Upon receiving a Notification message from a peer, the local device records the error code and subcode carried in the received message, and the state of the FSM on the local device changes. As a result, the connection between the local device and peer is terminated. If an error occurs on the local device, the state of the FSM on the local device changes, and the local device sends a Notification message to the peer.</p>
<p>By default, BGP records peer state changes and event information in system log files. The recorded information includes BGP error codes and subcodes, changes in the state of the BGP FSM, and whether Notification messages are sent.</p>
<p>If you do not need BGP to record peer state changes or event information, run the <a href="cmdqueryname=undo+peer+log-change"><b><span class="cmdname">undo peer log-change</span></b></a> command. After the <a href="cmdqueryname=undo+peer+log-change"><b><span class="cmdname">undo peer log-change</span></b></a> command is run, BGP records only the last peer state change in a log file. You can run the <a href="cmdqueryname=display+bgp+peer"><b><span class="cmdname">display bgp peer</span></b></a> <strong><span>log-info</span></strong> command to view this log.</p>
</p></li><li><span>Commit the configuration.</span><p><pre class="screen" id="EN-US_TASK_0000001130624122__en-us_task_0234857734_screen163801330213"><a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001130624122__en-us_task_0234857734_en-us_concept_0141113565_cmdname1667501373175340">commit</span></b></a></pre>
</p></li></ol></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="vrp_bgp_cfg_0014.html">Configuring Basic BGP Functions
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="vrp_bgp_cfg_0016.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>