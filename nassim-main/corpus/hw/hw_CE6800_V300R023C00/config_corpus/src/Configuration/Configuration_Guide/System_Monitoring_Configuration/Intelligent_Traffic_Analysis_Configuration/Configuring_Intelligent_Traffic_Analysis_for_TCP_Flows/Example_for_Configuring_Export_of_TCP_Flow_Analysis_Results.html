
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Export of TCP Flow Analysis Results">
<meta name="abstract" content="">
<meta name="description" content="">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="galaxy_traffic-analysis_cfg_0009.html">
<meta name="DC.Relation" scheme="URI" content="galaxy_traffic-analysis_cfg_0023.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="Intelligent Traffic Analysis">
<meta name="featuretype" content="System Monitoring">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="Intelligent Traffic Analysis">
<meta name="featuretype" content="System Monitoring">
<meta name="featurename" content="Intelligent Traffic Analysis">
<meta name="featuretype" content="System Monitoring">
<meta name="featuretype" content="System Monitoring">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001512693824">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring Export of TCP Flow Analysis Results</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001512693824"></a><a name="EN-US_TASK_0000001512693824"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Export of TCP Flow Analysis Results</h1>
<div class="taskbody"><p></p>
<div class="context"><a name="EN-US_TASK_0000001512693824__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0000001512693824__en-us_concept_0000001563892933_p72361027191614">The <span>CE6885-LL (low latency mode)</span> does not support intelligent traffic analysis for TCP flows.</p>
</div></div>
<p>In <a href="#EN-US_TASK_0000001512693824__fig_dc_cfg_traffic-analysis_001501">Figure 1</a>, packets of a TCP flow between the client with the IP address 10.1.1.1 and the server with the IP address 10.1.2.1 traverse the same path in both directions. <span class="keyword">Device</span>A on the path can be configured with intelligent traffic analysis for the TCP flow to analyze the flow and export the flow analysis results to the FabricInsight analyzer.</p>
<div class="fignone" id="EN-US_TASK_0000001512693824__fig_dc_cfg_traffic-analysis_001501"><a name="EN-US_TASK_0000001512693824__fig_dc_cfg_traffic-analysis_001501"></a><a name="fig_dc_cfg_traffic-analysis_001501"></a><span class="figcap"><b>Figure 1 </b>Network diagram of intelligent traffic analysis for the TCP flow</span><div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface 1, interface 2, and interface 3 represent <span>100GE</span> <span>1/0/1</span>, <span>100GE</span> <span>1/0/2</span>, and <span>100GE</span> <span>1/0/3</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0000001512853444.png"></span></div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001512693824__1.4.2"></a><a name="1.4.2"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure an advanced ACL rule.</span><p><p># Configure an advanced ACL rule to match the TCP flow transmitted between the client with IP address 10.1.1.1 and the server with the IP address 10.1.2.1.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname <span class="keyword">Device</span>A</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>acl number 3055</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-acl4-advance-3055] <strong>rule 4 permit tcp source 10.1.1.1 0.0.0.0 destination 10.1.2.1 0.0.0.0</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-acl4-advance-3055] <strong>quit</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
</p></li><li><span>Enable intelligent traffic analysis for the TCP flow.</span><p><p># Configure a traffic classifier.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>traffic classifier c1</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-classifier-c1] <strong>if-match acl 3055</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-classifier-c1] <strong>quit</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
<p># Enable intelligent traffic analysis for the TCP flow on <span class="keyword">Device</span>A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>traffic behavior b1</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-behavior-b1] <strong>traffic-analysis enable</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-behavior-b1] <strong>quit</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
</p><p><p># Configure a traffic policy.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>traffic policy p1</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-trafficpolicy-p1] <strong>classifier c1 behavior b1</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-trafficpolicy-p1] <strong>quit</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
<p># Apply the traffic policy globally.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>traffic-policy p1 global inbound</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
<p># On <span class="keyword">Device</span>A, enable intelligent traffic analysis for unidirectional TCP packets with the sequence numbers or acknowledgment numbers of 0x<em>XXXXXX</em>0A (<em>X</em> indicates a hexadecimal digit), so that <span class="keyword">Device</span>A can create a unidirectional flow table for these TCP packets.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>traffic-analysis tcp one-way sequence 0x0000000A 0x000000FF </strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
</p></li><li><span>Configure the TCP flow aging function.</span><p><p># Set the inactive flow aging time to 100 seconds.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>traffic-analysis tcp timeout inactive 100</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
</p></li><li><span>Configure export of TCP flow analysis results.</span><p><p># Set the source IP address to 10.1.3.1, destination IP address to 10.1.3.2, and destination port number to 6000 for the exported packets carrying TCP flow analysis results.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>traffic-analysis tcp export source ip 10.1.3.1</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>traffic-analysis tcp export host ip 10.1.3.2 6000</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001512693824__1.4.3"></a><a name="1.4.3"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p># Display detailed information about intelligent traffic analysis results of TCP flows.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>display traffic-analysis tcp ipv4 cache slot 1</strong>
NOTE:  S2C: server to client  C2S: client to server                                                                                 
Traffic analysis cache information:                                                                                                 
-------------------------------------------------------------------------------                                                     
ClientIP            ClientPort          C2S Interface1      C2S Interface2                                                          
ServerIP            ServerPort          S2C Interface1      S2C Interface2                                                          
C2S RTT             C2S Packets         C2S PacketLossUp    C2S PacketLoss                                                          
S2C RTT             S2C Packets         S2C PacketLossUp    S2C PacketLoss                                                          
C2S Vni             S2C Vni             FlowStatus          Time                                                                    
-------------------------------------------------------------------------------  
10.1.1.1            1024                <span>100GE</span><span>1/0/2</span>           --                                                                
10.1.2.1            24                  --                  --                                                                      
0                   48331               0                   1                                                                   
0                   7788                0                   0                                                                       
--                  --                  ESTABLISH           2019-06-05 19:58:28
-------------------------------------------------------------------------------                                                     </pre>
</div>
<div class="postreq"><a name="EN-US_TASK_0000001512693824__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Configuration Scripts</h4><p>DeviceA</p>
<pre class="screen">#
sysname DeviceA
#
acl number 3055
 rule 4 permit tcp source 10.1.1.1 0.0.0.0 destination 10.1.2.1 0.0.0.0
#
traffic classifier c1
 if-match acl 3055 
#
traffic behavior b1
 traffic-analysis enable
#
traffic policy p1
 classifier c1 behavior b1
#
traffic-policy p1 global inbound
#
traffic-analysis tcp one-way sequence 0x0000000A 0x000000FF
#
traffic-analysis tcp timeout inactive 100
#
traffic-analysis tcp export source ip 10.1.3.1
#
traffic-analysis tcp export host ip 10.1.3.2 6000
#</pre>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="galaxy_traffic-analysis_cfg_0009.html">Configuring Intelligent Traffic Analysis for TCP Flows
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="galaxy_traffic-analysis_cfg_0023.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>
</body>
</html>