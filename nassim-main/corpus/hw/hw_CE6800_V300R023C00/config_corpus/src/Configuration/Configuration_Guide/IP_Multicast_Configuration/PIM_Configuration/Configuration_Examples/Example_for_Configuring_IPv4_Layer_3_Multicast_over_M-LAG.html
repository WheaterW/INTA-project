
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring IPv4 Layer 3 Multicast over M-LAG">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="vrp_pim_cfg_1080.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation">
<meta name="DC.Publisher" content="20230413">
<meta name="featurename" content="PIM">
<meta name="featuretype" content="IP Multicast">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="PIM">
<meta name="featuretype" content="IP Multicast">
<meta name="featurename" content="PIM">
<meta name="featuretype" content="IP Multicast">
<meta name="featuretype" content="IP Multicast">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001699389541">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/mediaQuery.css">
<script language="javascript" type="text/javascript" src="public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring IPv4 Layer 3 Multicast over M-LAG</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001699389541"></a><a name="EN-US_TASK_0000001699389541"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring IPv4 Layer 3 Multicast over M-LAG</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001699389541__1.3.1"></a><a name="1.3.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0000001699389541__fig_01">Figure 1</a>, to ensure high IPv4 network reliability, the user-side device Device is dual-homed to the active-active VRRP gateways DeviceA and DeviceB through an M-LAG. The user Receiver connected to the Device wants to receive the multicast video program from the Source.</p>
<div class="fignone" id="EN-US_TASK_0000001699389541__fig_01"><a name="EN-US_TASK_0000001699389541__fig_01"></a><a name="fig_01"></a><span class="figcap"><b>Figure 1 </b>Network diagram for IPv4 Layer 3 multicast over M-LAG configuration</span><br><span><img class="vsd" src="figure/en-us_image_0000001651309270.png"></span></div>

<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" frame="border" border="1" rules="all"><caption><b>Table 1 </b>Device configuration list</caption><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="27.717228277172286%" id="mcps1.3.1.4.2.5.1.1" liSelected="liSelected"><p>Device</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="30.046995300469952%" id="mcps1.3.1.4.2.5.1.2" liSelected="liSelected"><p>Interface</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="20.287971202879714%" id="mcps1.3.1.4.2.5.1.3" liSelected="liSelected"><p>VLANIF interface</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="21.947805219478052%" id="mcps1.3.1.4.2.5.1.4" liSelected="liSelected"><p>IP Address</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" rowspan="4" valign="top" width="27.717228277172286%" headers="mcps1.3.1.4.2.5.1.1 "><p>DeviceA</p>
</td>
<td class="cellrowborder" valign="top" width="30.046995300469952%" headers="mcps1.3.1.4.2.5.1.2 "><p><span>100GE</span><span>1/0/1</span> represents interface1.</p>
</td>
<td class="cellrowborder" char="." valign="top" width="20.287971202879714%" headers="mcps1.3.1.4.2.5.1.3 "><p>VLANIF 12</p>
</td>
<td class="cellrowborder" valign="top" width="21.947805219478052%" headers="mcps1.3.1.4.2.5.1.4 "><p>10.3.1.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.5.1.1 "><p><span>100GE</span> 1/0/6 represents interface6.</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.3.1.4.2.5.1.2 "><p>VLANIF 13</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.5.1.3 "><p>10.5.1.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.3.1.4.2.5.1.1 "><p>Eth-Trunk 10</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.3.1.4.2.5.1.2 "><p>VLANIF 11</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.5.1.3 "><p>10.2.1.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.3.1.4.2.5.1.1 "><p><span>MEth</span><span>0/0/0</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.3.1.4.2.5.1.2 "><p>â</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.5.1.3 "><p>10.1.1.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="4" valign="top" width="27.717228277172286%" headers="mcps1.3.1.4.2.5.1.1 "><p>DeviceB</p>
</td>
<td class="cellrowborder" valign="top" width="30.046995300469952%" headers="mcps1.3.1.4.2.5.1.2 "><p><span>100GE</span><span>1/0/1</span> represents interface1.</p>
</td>
<td class="cellrowborder" valign="top" width="20.287971202879714%" headers="mcps1.3.1.4.2.5.1.3 "><p>VLANIF 14</p>
</td>
<td class="cellrowborder" valign="top" width="21.947805219478052%" headers="mcps1.3.1.4.2.5.1.4 "><p>10.4.1.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.5.1.1 "><p><span>100GE</span> 1/0/6 represents interface6.</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.5.1.2 "><p>VLANIF 13</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.5.1.3 "><p>10.5.1.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.5.1.1 "><p>Eth-Trunk 10</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.5.1.2 "><p>VLANIF 11</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.5.1.3 "><p>10.2.1.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.5.1.1 "><p><span>MEth</span><span>0/0/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.5.1.2 "><p>â</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.5.1.3 "><p>10.1.1.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="3" valign="top" width="27.717228277172286%" headers="mcps1.3.1.4.2.5.1.1 "><p>DeviceC</p>
</td>
<td class="cellrowborder" valign="top" width="30.046995300469952%" headers="mcps1.3.1.4.2.5.1.2 "><p><span>100GE</span><span>1/0/1</span> represents interface1.</p>
</td>
<td class="cellrowborder" valign="top" width="20.287971202879714%" headers="mcps1.3.1.4.2.5.1.3 "><p>VLANIF 12</p>
</td>
<td class="cellrowborder" valign="top" width="21.947805219478052%" headers="mcps1.3.1.4.2.5.1.4 "><p>10.3.1.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.5.1.1 "><p><span>100GE</span><span>1/0/2</span> represents interface2.</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.5.1.2 "><p>VLANIF 14</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.5.1.3 "><p>10.4.1.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.5.1.1 "><p><span>100GE</span><span>1/0/3</span> represents interface3.</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.5.1.2 "><p>VLANIF 15</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.1.4.2.5.1.3 "><p>10.6.1.1/24</p>
</td>
</tr>
</tbody>
</table>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001699389541__1.3.2"></a><a name="1.3.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>To meet the requirements, the M-LAG master and backup devices (DeviceA and DeviceB) must have both a peer link and a direct Layer 3 link between them, and they must have the same multicast configuration.</p>
</div></div>
<p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure M-LAG on DeviceA and DeviceB, and configure dual-homed access on Device to enhance high reliability of the network.</p>
</li><li>On DeviceA and DeviceB, configure IP and MAC addresses for VLANIF interfaces so that DeviceA and DeviceB function as active-active gateways for access devices.</li><li><p>Configure a unicast routing protocol on DeviceA, DeviceB, and DeviceC to implement IP interworking. Multicast routing protocols work depending on unicast routing protocols.</p>
</li><li><p>Enable PIM-SM and IGMP on VLANIF interfaces of DeviceA and DeviceB, and enable PIM-SM on VLANIF interfaces of DeviceC, so that multicast forwarding entries can be created.</p>
</li><li><p>Enable the PIM silent function on user-side VLANIF interfaces on DeviceA and DeviceB, to ensure that DeviceA and DeviceB both act as DRs and send Join messages to the RP.</p>
</li><li><p>On DeviceA and DeviceB, enable IGMP snooping in the VLANs corresponding to the VLANIF interfaces to implement accurate multicast forwarding on the Layer 2 network.</p>
</li><li><p>Disable STP on the interfaces at both sides of the Layer 3 link between the master and backup devices, and specify the VLAN that is not allowed on the peer-link. This ensures normal multicast forwarding on the M-LAG.</p>
</li></ol>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001699389541__1.3.3"></a><a name="1.3.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure V-STP-based M-LAG and M-LAG active-active gateways.</span><p><ol type="a"><li><p>Configure a V-STP-based M-LAG.</p>
<div class="p"># On DeviceA, configure a DFS group, a peer-link, V-STP, an M-LAG, and the LACP M-LAG system priority and system ID, to set up a V-STP-based M-LAG. The configuration on DeviceB is similar to the configuration on DeviceA. For detailed configurations, see Configuration Scripts.<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname DeviceA</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA]<strong> interface <span>meth</span> <span>0/0/0</span></strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA-<span>MEth</span><span>0/0/0</span>]<strong> ip address 10.1.1.1 24</strong>
[<span class="keyword">*</span>DeviceA-<span>MEth</span><span>0/0/0</span>]<strong> quit</strong>
[<span class="keyword">*</span>DeviceA]<strong> dfs-group 1</strong>
[<span class="keyword">*</span>DeviceA-dfs-group-1]<strong> dual-active detection source ip 10.1.1.1</strong><strong> peer </strong><strong>10.1.1.2</strong>
[<span class="keyword">*</span>DeviceA-dfs-group-1]<strong> priority 150</strong>
[<span class="keyword">*</span>DeviceA-dfs-group-1] <strong>authentication-mode hmac-sha256 password </strong><strong>YsHsjx_202206</strong>
[<span class="keyword">*</span>DeviceA-dfs-group-1]<strong> quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>interface eth-trunk 1</strong>
[<span class="keyword">*</span>DeviceA-Eth-Trunk1] <strong>trunkport <span>100ge</span> <span>1/0/4</span> to </strong><strong><span>1/0/5</span></strong>
[<span class="keyword">*</span>DeviceA-Eth-Trunk1] <strong>mode lacp-static</strong>
[<span class="keyword">*</span>DeviceA-Eth-Trunk1] <strong>peer-link 1</strong>
[<span class="keyword">*</span>DeviceA-Eth-Trunk1] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA]<strong> stp mode rstp</strong>
[<span class="keyword">*</span>DeviceA]<strong> stp v-stp enable</strong>
[<span class="keyword">*</span>DeviceA]<strong> vlan batch 11</strong>
[<span class="keyword">*</span>DeviceA]<strong> interface eth-trunk 10</strong>
[<span class="keyword">*</span>DeviceA-Eth-Trunk10]<strong> mode lacp-static</strong>
[<span class="keyword">*</span>DeviceA-Eth-Trunk10]<strong> port link-type trunk</strong>
[<span class="keyword">*</span>DeviceA-Eth-Trunk10]<strong> port trunk allow-pass vlan 11</strong>
[<span class="keyword">*</span>DeviceA-Eth-Trunk10]<strong> trunkport <span>100ge</span> <span>1/0/2</span> to <span>1/0/3</span></strong>
[<span class="keyword">*</span>DeviceA-Eth-Trunk10]<strong> dfs-group 1 m-lag 1</strong>
[<span class="keyword">*</span>DeviceA-Eth-Trunk10]<strong> lacp m-lag priority 10</strong>
[<span class="keyword">*</span>DeviceA-Eth-Trunk10]<strong> lacp m-lag system-id 00e0-fc00-0000</strong>
[<span class="keyword">*</span>DeviceA-Eth-Trunk10]<strong> quit</strong>
[<span class="keyword">*</span>DeviceA]<strong> commit</strong></pre>
</div>
<div class="p">On Device, bind uplink interfaces to an Eth-Trunk interface.<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname Device</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Device]<strong> vlan batch 11</strong>
[<span class="keyword">*</span>Device]<strong> interface eth-trunk 20</strong>
[<span class="keyword">*</span>Device-Eth-Trunk20]<strong> mode lacp-static</strong>
[<span class="keyword">*</span>Device-Eth-Trunk20]<strong> port link-type trunk</strong>
[<span class="keyword">*</span>Device-Eth-Trunk20]<strong> port trunk allow-pass vlan 11</strong>
[<span class="keyword">*</span>Device-Eth-Trunk20]<strong> trunkport <span>100ge</span> <span>1/0/1</span> to <span>1/0/4</span></strong>
[<span class="keyword">*</span>Device-Eth-Trunk20]<strong> quit</strong>
[<span class="keyword">*</span>Device]<strong> commit</strong></pre>
</div>
</li><li>On DeviceA and DeviceB, configure IP and MAC addresses for VLANIF interfaces so that DeviceA and DeviceB function as active-active gateways for access devices.<p>DeviceA and DeviceB must be configured with the same virtual IP address and virtual MAC address.</p>
<div class="p"># Configure DeviceA.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA]<strong> interface vlanif 11</strong>
[<span class="keyword">*</span>DeviceA-Vlanif11]<strong> ip address 10.2.1.1 24</strong>
[<span class="keyword">*</span>DeviceA-Vlanif11]<strong> mac-address 0000-5e00-0101</strong>
[<span class="keyword">*</span>DeviceA-Vlanif11]<strong> quit</strong>
[<span class="keyword">*</span>DeviceA]<strong> commit</strong></pre>
</div>
<div class="p"># Configure DeviceB.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB]<strong> interface vlanif 11</strong>
[<span class="keyword">*</span>DeviceB-Vlanif11]<strong> ip address 10.2.1.1 24</strong>
[<span class="keyword">*</span>DeviceB-Vlanif11]<strong> mac-address 0000-5e00-0101</strong>
[<span class="keyword">*</span>DeviceB-Vlanif11]<strong> quit</strong>
[<span class="keyword">*</span>DeviceB]<strong> commit</strong></pre>
</div>
</li></ol>
</p></li><li><span>Configure OSPF to implement IP interworking.</span><p><p># Configure DeviceA. The configurations of DeviceB and DeviceC are similar to the configuration of DeviceA. For detailed configurations, see Configuration Scripts.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA]<strong> vlan batch 12 13</strong>
[<span class="keyword">*</span>DeviceA]<strong> interface <span>100ge</span> <span>1/0/1</span></strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/1</span>]<strong> port link-type trunk</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/1</span>]<strong> port trunk allow-pass vlan 12</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span><span>1/0/1</span>]<strong> quit</strong>
[<span class="keyword">*</span>DeviceA]<strong> interface <span>100ge</span> 1/0/6</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span>1/0/6]<strong> port link-type trunk</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span>1/0/6]<strong> port trunk allow-pass vlan 13</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span>1/0/6]<strong> quit</strong>
[<span class="keyword">*</span>DeviceA]<strong> interface vlanif 12</strong>
[<span class="keyword">*</span>DeviceA-Vlanif12]<strong> ip address 10.3.1.1 24</strong>
[<span class="keyword">*</span>DeviceA-Vlanif12]<strong> quit</strong>
[<span class="keyword">*</span>DeviceA]<strong> interface vlanif 13</strong>
[<span class="keyword">*</span>DeviceA-Vlanif13]<strong> ip address 10.5.1.1 24</strong>
[<span class="keyword">*</span>DeviceA-Vlanif13]<strong> quit</strong>
[<span class="keyword">*</span>DeviceA]<strong> ospf 1</strong>
[<span class="keyword">*</span>DeviceA-ospf-1]<strong> area 0</strong>
[<span class="keyword">*</span>DeviceA-ospf-1-area-0.0.0.0]<strong> network 10.1.1.1 0.0.0.255</strong>
[<span class="keyword">*</span>DeviceA-ospf-1-area-0.0.0.0]<strong> network 10.3.1.0 0.0.0.255</strong>
[<span class="keyword">*</span>DeviceA-ospf-1-area-0.0.0.0]<strong> network 10.5.1.0 0.0.0.255</strong>
[<span class="keyword">*</span>DeviceA-ospf-1-area-0.0.0.0]<strong> quit</strong>
[<span class="keyword">*</span>DeviceA-ospf-1]<strong> quit</strong>
[<span class="keyword">*</span>DeviceA]<strong> commit</strong></pre>
<div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>If the peer-link is selected as the optimal link to the RP or multicast source by the unicast routing protocol, multicast traffic with the peer-link interface as the outbound interface may fail to be forwarded. To prevent this problem, ensure that the Layer 3 link between the M-LAG master and backup devices has a route cost less than or equal to the route cost of the peer-link, so that the Layer 3 link is selected as the optimal route by the unicast routing protocol.</p>
</div></div>
</p></li><li><span>Enable PIM-SM and IGMP on VLANIF interfaces of DeviceA and DeviceB, and enable PIM-SM on VLANIF interfaces of DeviceC.</span><p><div class="p"># Configure DeviceA. The configuration on DeviceB is similar to the configuration on DeviceA. For detailed configurations, see Configuration Scripts.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA]<strong> multicast routing-enable</strong>
[<span class="keyword">*</span>DeviceA]<strong> interface vlanif 11</strong>
[<span class="keyword">*</span>DeviceA-Vlanif11]<strong> pim sm</strong>
[<span class="keyword">*</span>DeviceA-Vlanif11]<strong> igmp enable</strong>
[<span class="keyword">*</span>DeviceA-Vlanif11]<strong> quit</strong>
[<span class="keyword">*</span>DeviceA]<strong> interface vlanif 12</strong>
[<span class="keyword">*</span>DeviceA-Vlanif12]<strong> pim sm</strong>
[<span class="keyword">*</span>DeviceA-Vlanif12]<strong> igmp enable</strong>
[<span class="keyword">*</span>DeviceA-Vlanif12]<strong> quit</strong>
[<span class="keyword">*</span>DeviceA]<strong> interface vlanif 13</strong>
[<span class="keyword">*</span>DeviceA-Vlanif13]<strong> pim sm</strong>
[<span class="keyword">*</span>DeviceA-Vlanif13]<strong> igmp enable</strong>
[<span class="keyword">*</span>DeviceA-Vlanif13]<strong> quit</strong>
[<span class="keyword">*</span>DeviceA]<strong> commit</strong></pre>
</div>
<div class="p"># Configure DeviceC. Configure VLANIF 15 of DeviceC as a C-BSR and C-RP.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceC]<strong> multicast routing-enable</strong>
[<span class="keyword">*</span>DeviceC]<strong> interface vlanif 12</strong>
[<span class="keyword">*</span>DeviceC-Vlanif12]<strong> pim sm</strong>
[<span class="keyword">*</span>DeviceC-Vlanif12]<strong> quit</strong>
[<span class="keyword">*</span>DeviceC]<strong> interface vlanif 14</strong>
[<span class="keyword">*</span>DeviceC-Vlanif14]<strong> pim sm</strong>
[<span class="keyword">*</span>DeviceC-Vlanif14]<strong> quit</strong>
[<span class="keyword">*</span>DeviceC]<strong> interface vlanif 15</strong>
[<span class="keyword">*</span>DeviceC-Vlanif15]<strong> pim sm</strong>
[<span class="keyword">*</span>DeviceC-Vlanif15]<strong> quit</strong>
[<span class="keyword">*</span>DeviceC]<strong> pim</strong>
[<span class="keyword">*</span>DeviceC-pim]<strong> c-bsr vlanif 15</strong>
[<span class="keyword">*</span>DeviceC-pim]<strong> c-rp vlanif 15</strong>
[<span class="keyword">*</span>DeviceC-pim]<strong> quit</strong>
[<span class="keyword">*</span>DeviceC]<strong> commit</strong></pre>
</div>
</p></li><li><span>Enable the PIM silent function on user-side VLANIF interfaces of DeviceA and DeviceB.</span><p><div class="p"># Configure DeviceA. The configuration on DeviceB is similar to the configuration on DeviceA. For detailed configurations, see Configuration Scripts.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA]<strong> interface vlanif 11</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA-Vlanif11]<strong> pim silent</strong>
[<span class="keyword">*</span>DeviceA-Vlanif11]<strong> quit</strong>
[<span class="keyword">*</span>DeviceA]<strong> commit</strong></pre>
</div>
</p></li><li><span>On DeviceA and DeviceB, enable IGMP snooping in the VLANs corresponding to the VLANIF interfaces.</span><p><div class="p"># Configure DeviceA. The configuration on DeviceB is similar to the configuration on DeviceA. For detailed configurations, see Configuration Scripts.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA]<strong> igmp snooping enable</strong>
[<span class="keyword">*</span>DeviceA]<strong> vlan 11</strong>
[<span class="keyword">*</span>DeviceA-vlan11]<strong> igmp snooping enable</strong>
[<span class="keyword">*</span>DeviceA-vlan11]<strong> quit</strong>
[<span class="keyword">*</span>DeviceA]<strong> vlan 12</strong>
[<span class="keyword">*</span>DeviceA-vlan12]<strong> igmp snooping enable</strong>
[<span class="keyword">*</span>DeviceA-vlan12]<strong> quit</strong>
[<span class="keyword">*</span>DeviceA]<strong> vlan 13</strong>
[<span class="keyword">*</span>DeviceA-vlan13]<strong> igmp snooping enable</strong>
[<span class="keyword">*</span>DeviceA-vlan13]<strong> quit</strong>
[<span class="keyword">*</span>DeviceA]<strong> commit</strong></pre>
</div>
</p></li><li><span>Disable STP on the interfaces at both sides of the Layer 3 link between the M-LAG master and backup devices, and specify the VLAN that is not allowed on the peer-link.</span><p><div class="p"># Configure DeviceA. The configuration on DeviceB is similar to the configuration on DeviceA. For detailed configurations, see Configuration Scripts.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>interface <span>100ge</span> 1/0/6</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA-<span>100GE</span>1/0/6] <strong>stp disable</strong>
[<span class="keyword">*</span>DeviceA-<span>100GE</span>1/0/6] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA] <strong>interface eth-trunk 1</strong>
[<span class="keyword">*</span>DeviceA-Eth-Trunk1] <strong>port vlan exclude 1 13</strong>
[<span class="keyword">*</span>DeviceA-Eth-Trunk1] <strong>quit</strong>
[<span class="keyword">*</span>DeviceA]<strong> commit</strong></pre>
</div>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001699389541__1.3.4"></a><a name="1.3.4"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p># Run the <a href="cmdqueryname=display+dfs-group"><b><span class="cmdname">display dfs-group</span></b></a> command on DeviceA to check M-LAG information.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA]<strong> display dfs-group 1 m-lag</strong>
*                     : Local node
Heart beat state      : <strong>OK</strong>
Node 1 *
  Dfs-Group ID        : 1
  Priority            : 150
  Dual-active Address : 10.1.1.1
  VPN-Instance        : public net
  State               : <strong>Master</strong>
  Causation           : -
  System ID           : 00e0-fc12-3457
  SysName             : DeviceA
  Version             : <span><span class="keyword">V300R023C00</span></span>
  Device Type         : <span>CE6860-SAN</span>
Node 2
  Dfs-Group ID        : 1
  Priority            : 120
  Dual-active Address : 10.1.1.2
  VPN-Instance        : public net
  State               : <strong>Backup</strong>
  Causation           : -
  System ID           : 00e0-fc12-3458
  SysName             : DeviceB
  Version             : <span><span class="keyword">V300R023C00</span></span>
  Device Type         : <span>CE6860-SAN</span></pre>
<p>In the preceding command output, the <span class="parmname"><b>Heart beat state</b></span> field displays <span class="parmname"><b>OK</b></span>, indicating that the heartbeat status is normal. DeviceA is node 1 with a priority of 150, and its <span class="parmname"><b>State</b></span> is <span class="parmname"><b>Master</b></span>; DeviceB is node 2 with a priority of 120, and its <span class="parmname"><b>State</b></span> is <span class="parmname"><b>Backup</b></span>. The preceding information shows that DeviceA is the M-LAG master device, and DeviceB is the M-LAG backup device.</p>
<p># Run the <a href="cmdqueryname=display+pim+interface"><b><span class="cmdname">display pim interface</span></b></a> command on DeviceA and DeviceB to check the PIM configuration and running status on interfaces.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA]<strong> display pim interface</strong>
 VPN-Instance: public net
 Interface           State NbrCnt HelloInt     DR-Pri     DR-Address
 Vlanif11            up         0       30          1     <strong>10.2.1.1 (local)</strong>
 Vlanif12            up         1       30          1     10.3.1.2
 Vlanif13            up         1       30          1     10.5.1.2 </pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB]<strong> display pim interface</strong>
 VPN-Instance: public net
 Interface           State NbrCnt HelloInt     DR-Pri     DR-Address
 Vlanif11            up         0       30          1     <strong>10.2.1.2 (local)</strong>
 Vlanif14            up         1       30          1     10.4.1.2 
 Vlanif13            up         1       30          1     10.5.1.2 (local)</pre>
<p>According to the preceding information, VLANIF 11 of DeviceA and VLANIF 11 of DeviceB are both DRs; therefore, both DeviceA and DeviceB will send Join messages to the upstream RP.</p>
<p># Run the <a href="cmdqueryname=display+pim+routing-table"><b><span class="cmdname">display pim routing-table</span></b></a> command on DeviceA, DeviceB, and DeviceC to check the PIM-SM routing tables on them.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceC]<strong> display pim routing-table</strong>
 VPN-Instance: public net                                          
 Total 1 (*, G) entry; 1 (S, G) entry                              

 (*, 225.1.1.1)                                                    
     RP: 10.6.1.1 (local)                                          
     Protocol: pim-sm, Flag: WC                                    
     UpTime: 00:14:45                                              
     Upstream interface: Register                                  
         Upstream neighbor: NULL                                   
         RPF prime neighbor: NULL                                  
     Downstream interface(s) information:                          
     Total number of downstreams: <strong>2</strong>
        1: <strong>Vlanif12</strong>
             Protocol: pim-sm, UpTime: 00:14:45, Expires: 00:02:45 
        2: <strong>Vlanif14</strong>
             Protocol: pim-sm, UpTime: 00:14:45, Expires: 00:02:45 

 (10.6.1.2, 225.1.1.1)                                             
     RP: 10.6.1.1 (local)                                          
     Protocol: pim-sm, Flag: SPT LOC ACT                     
     UpTime: 00:15:47                                              
     Upstream interface: Vlanif15                                  
         Upstream neighbor: NULL                                   
         RPF prime neighbor: NULL                                  
     Downstream interface(s) information:                          
     Total number of downstreams: <strong>2</strong>
        1: <strong>Vlanif12</strong>
             Protocol: pim-sm, UpTime: 00:14:45, Expires: 00:02:45 
        2: <strong>Vlanif14</strong>
             Protocol: pim-sm, UpTime: 00:14:45, Expires: 00:02:45 
</pre>
<p>According to the preceding information, DeviceC has two downstream interfaces VLANIF 12 and VLANIF 14. Because both DeviceA and DeviceB are DRs, data sent from the multicast source is forwarded to the two devices through the two downstream interfaces. In real-world application, the downstream interfaces on DeviceC are determined by the unicast routes from the DRs to the RP.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA]<strong> display pim routing-table</strong>
 VPN-Instance: public net                                 
 Total 1 (*, G) entry; 1 (S, G) entry                     

 (*, 225.1.1.1)                                           
     RP: 10.6.1.1                                         
     Protocol: pim-sm, Flag: WC                           
     UpTime: 00:18:31                                     
     Upstream interface: Vlanif12                         
         Upstream neighbor: 10.3.1.2                      
         RPF prime neighbor: 10.3.1.2                     
     Downstream interface(s) information:                 
     Total number of downstreams: 1                       
        1: <strong>Vlanif11</strong>
             Protocol: igmp, UpTime: 00:18:31, Expires: - 

 (10.6.1.2, 225.1.1.1)                                    
     RP: 10.6.1.1                                         
     Protocol: pim-sm, Flag: SPT ACT                      
     UpTime: 00:17:31                                     
     Upstream interface: Vlanif12                         
         Upstream neighbor: 10.3.1.2                      
         RPF prime neighbor: 10.3.1.2                     
     Downstream interface(s) information:                 
     Total number of downstreams: 1                       
        1: <strong>Vlanif11</strong>
             Protocol: pim-sm, UpTime: 00:17:31, Expires: - </pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB]<strong> display pim routing-table</strong>
 VPN-Instance: public net                                 
 Total 1 (*, G) entry; 1 (S, G) entry                     

 (*, 225.1.1.1)                                           
     RP: 10.6.1.1                                         
     Protocol: pim-sm, Flag: WC                           
     UpTime: 00:18:59                                     
     Upstream interface: Vlanif14                         
         Upstream neighbor: 10.4.1.2                      
         RPF prime neighbor: 10.4.1.2                     
     Downstream interface(s) information:                 
     Total number of downstreams: 1                       
        1: <strong>Vlanif11</strong>
             Protocol: igmp, UpTime: 00:18:59, Expires: - 

 (10.6.1.2, 225.1.1.1)                                    
     RP: 10.6.1.1                                         
     Protocol: pim-sm, Flag: SPT ACT                      
     UpTime: 00:17:59                                     
     Upstream interface: Vlanif14                         
         Upstream neighbor: 10.4.1.2                      
         RPF prime neighbor: 10.4.1.2                     
     Downstream interface(s) information:                 
     Total number of downstreams: 1                       
        1: <strong>Vlanif11</strong>
             Protocol: pim-sm, UpTime: 00:17:59, Expires: - </pre>
<p>The preceding information shows that both DeviceA and DeviceB have a downstream interface VLANIF 11. When the M-LAG is functioning normally, both the master and backup M-LAG member interfaces can forward multicast data traffic to the receiver, implementing load sharing. The load balancing rule is as follows: If the last decimal number of a multicast group address is an odd number (for example, 225.1.1.1), traffic is forwarded by the M-LAG master member interface. If the last decimal number of a multicast group address is an even number (for example, 225.1.1.2), traffic is forwarded by the M-LAG backup member interface. In this example, the M-LAG master device forwards data traffic to the multicast group address 225.1.1.1.</p>
</div>
<div class="postreq"><a name="EN-US_TASK_0000001699389541__1.3.5"></a><a name="1.3.5"></a><h4 class="sectiontitle">Configuration Scripts</h4><ul><li><p>DeviceA</p>
<pre class="screen">#
sysname DeviceA
#
dfs-group 1
 priority 150
<strong> </strong>dual-active detection source ip 10.1.1.1 peer 10.1.1.2
 authentication-mode hmac-sha256 password %+%##!!!!!!!!!"!!!!"!!!!*!!!!C+tR0CW9x*eB&amp;pWp`t),Azgw-h\o8#4LZPD!!!!!!!!!!!!!!!9!!!!&gt;fwJ)I0E{=:%,*,XRhbH&amp;t0MCy_8=7!!!!!!!!!!%+%#
#
vlan batch 11 to 13
#
stp mode rstp
stp v-stp enable
#
multicast routing-enable
#
igmp snooping enable
#
vlan 11
 igmp snooping enable
#
vlan 12
 igmp snooping enable
#
vlan 13
 igmp snooping enable
#
interface Vlanif11
 ip address 10.2.1.1 255.255.255.0
 mac-address 0000-5e00-0101  
 pim silent
 pim sm
 igmp enable
#
interface Vlanif12
 ip address 10.3.1.1 255.255.255.0
 pim sm
 igmp enable
#
interface Vlanif13
 ip address 10.5.1.1 255.255.255.0
 pim sm
 igmp enable
#
interface <span>MEth</span><span>0/0/0</span>
 ip address 10.1.1.1 255.255.255.0
#
interface Eth-Trunk1
 mode lacp-static
 peer-link 1
 port vlan exclude 1 13
#
interface Eth-Trunk10
 port link-type trunk
 port trunk allow-pass vlan 11
 mode lacp-static
 dfs-group 1 m-lag 1
 lacp m-lag priority 10
 lacp m-lag system-id 00e0-fc00-0000
#
interface <span>100GE</span><span>1/0/1</span>
 port link-type trunk
 port trunk allow-pass vlan 12
#
interface <span>100GE</span><span>1/0/2</span>
 eth-trunk 10
#
interface <span>100GE</span><span>1/0/3</span>
 eth-trunk 10
#
interface <span>100GE</span><span>1/0/4</span>
 eth-trunk 1
#
interface <span>100GE</span><span>1/0/5</span>
 eth-trunk 1
#
interface <span>100GE</span>1/0/6
 port link-type trunk
 port trunk allow-pass vlan 13
 stp disable
#
ospf 1
 area 0.0.0.0
  network 10.1.1.0 0.0.0.255
  network 10.3.1.0 0.0.0.255
  network 10.5.1.0 0.0.0.255
#
return</pre>
</li><li><p>DeviceB</p>
<pre class="screen">#
sysname DeviceB
#
dfs-group 1
 priority 120
 dual-active detection source ip 10.1.1.2 peer 10.1.1.1
 authentication-mode hmac-sha256 password %+%##!!!!!!!!!"!!!!"!!!!*!!!!=I9f8&gt;C{!P_bhB31@7r-=jrS8c|_"(Bn<font style="font-size:8pt" Face="Courier New" >~</font>#=!!!!!!!!!!!!!!!9!!!!kx-6@.tGA(wAt/IQXl6&gt;[g{6YlOi9$!!!!!!!!!!%+%#
#
vlan batch 11 13 to 14
#
stp mode rstp
stp v-stp enable
#
multicast routing-enable
#
igmp snooping enable
#
vlan 11
 igmp snooping enable
#
vlan 13
 igmp snooping enable
#
vlan 14
 igmp snooping enable
#
interface Vlanif11
 ip address 10.2.1.1 255.255.255.0
 mac-address 0000-5e00-0101  
 pim silent
 pim sm
 igmp enable
#
interface Vlanif13
 ip address 10.5.1.2 255.255.255.0
 pim sm
 igmp enable
#
interface Vlanif14
 ip address 10.4.1.1 255.255.255.0
 pim sm
 igmp enable
#
interface <span>MEth</span><span>0/0/0</span>
 ip address 10.1.1.2 255.255.255.0
#
interface Eth-Trunk1
 mode lacp-static
 peer-link 1
 port vlan exclude 1 13
#
interface Eth-Trunk10
 port link-type trunk
 port trunk allow-pass vlan 11
 mode lacp-static
 dfs-group 1 m-lag 1
 lacp m-lag priority 10
 lacp m-lag system-id 00e0-fc00-0000
#
interface <span>100GE</span><span>1/0/1</span>
 port link-type trunk
 port trunk allow-pass vlan 14
#
interface <span>100GE</span><span>1/0/2</span>
 eth-trunk 10
#
interface <span>100GE</span><span>1/0/3</span>
 eth-trunk 10
#
interface <span>100GE</span><span>1/0/4</span>
 eth-trunk 1
#
interface <span>100GE</span><span>1/0/5</span>
 eth-trunk 1
#
interface <span>100GE</span>1/0/6
 port link-type trunk
 port trunk allow-pass vlan 13
 stp disable
#
ospf 1
 area 0.0.0.0
  network 10.1.1.0 0.0.0.255
  network 10.4.1.0 0.0.0.255
  network 10.5.1.0 0.0.0.255
#
return</pre>
</li><li><p>DeviceC</p>
<pre class="screen">#
sysname DeviceC
#
vlan batch 12 14 to 15
#
multicast routing-enable
#
interface Vlanif12
 ip address 10.3.1.2 255.255.255.0
 pim sm
#
interface Vlanif14
 ip address 10.4.1.2 255.255.255.0
 pim sm
#
interface Vlanif15
 ip address 10.6.1.1 255.255.255.0
 pim sm
#
interface <span>100GE</span><span>1/0/1</span>
 port link-type trunk
 port trunk allow-pass vlan 12
#
interface <span>100GE</span><span>1/0/2</span>
 port link-type trunk
 port trunk allow-pass vlan 14
#
interface <span>100GE</span><span>1/0/3</span>
 port default vlan 15
#
ospf 1
 area 0.0.0.0
  network 10.3.1.0 0.0.0.255
  network 10.4.1.0 0.0.0.255
  network 10.6.1.0 0.0.0.255
#
pim
 c-bsr Vlanif15
 c-rp Vlanif15
#
return</pre>
</li><li><p>Device</p>
<pre class="screen">#
sysname Device
#
vlan batch 11
#
interface Eth-Trunk20
 port link-type trunk
 port trunk allow-pass vlan 11
 mode lacp-static
#
interface <span>100GE</span><span>1/0/1</span>
 eth-trunk 20
#
interface <span>100GE</span><span>1/0/2</span>
 eth-trunk 20
#
interface <span>100GE</span><span>1/0/3</span>
 eth-trunk 20
#
interface <span>100GE</span><span>1/0/4</span>
 eth-trunk 20
#
return</pre>
</li></ul>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="vrp_pim_cfg_1080.html">Configuration Examples
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="copyrightBottomBar_responsive">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
</div>
</div>
</body>
</html>