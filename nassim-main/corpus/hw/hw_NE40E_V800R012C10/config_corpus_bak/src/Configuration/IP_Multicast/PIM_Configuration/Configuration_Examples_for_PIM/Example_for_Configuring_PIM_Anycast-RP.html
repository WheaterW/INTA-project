
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring PIM Anycast-RP">
<meta name="abstract" content="In the scenario where multiple multicast sources and receivers are located in a PIM-SM domain, you can configure Anycast-Rendezvous Point (RP) peer relationships so that IP routing will automatically select the topologically closest RP for each source and receiver. This alleviates burdens on RPs, implements RP backup, and optimizes multicast forwarding paths.">
<meta name="description" content="In the scenario where multiple multicast sources and receivers are located in a PIM-SM domain, you can configure Anycast-Rendezvous Point (RP) peer relationships so that IP routing will automatically select the topologically closest RP for each source and receiver. This alleviates burdens on RPs, implements RP backup, and optimizes multicast forwarding paths.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_multicast_cfg_0036.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_multicast_cfg_0041.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_multicast_cfg_2201.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="z00603461,w00606909,w00447999">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="PIM">
<meta name="featuretype" content="IP Multicast">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="PIM">
<meta name="featuretype" content="IP Multicast">
<meta name="featurename" content="PIM">
<meta name="featuretype" content="IP Multicast">
<meta name="featurename" content="PIM">
<meta name="featuretype" content="IP Multicast">
<meta name="OWNER" content="w00447999">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="w00447999">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172366936">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>Example for Configuring PIM Anycast-RP</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172366936"></a><a name="EN-US_TASK_0172366936"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring PIM Anycast-RP</h1>
<div class="taskbody"><p>In the scenario where multiple multicast sources and receivers are located in a PIM-SM domain, you can configure Anycast-Rendezvous Point (RP) peer relationships so that IP routing will automatically select the topologically closest RP for each source and receiver. This alleviates burdens on RPs, implements RP backup, and optimizes multicast forwarding paths.</p>
<div class="context"><a name="EN-US_TASK_0172366936__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On a traditional PIM-SM domain, all multicast groups map to one RP. When the network is overloaded or traffic congests on an RP, the RP may be overburdened. If the RP fails, routes are converged slowly or multicast packets are forwarded over non-optimal paths. Configuring the Anycast-RP in the PIM-SM domain can address these problems. IP routing will automatically select the topologically closest RP for each source and receiver. This feature can accelerate data transmission to receivers. On the network shown in <a href="#EN-US_TASK_0172366936__fig61819557114">Figure 1</a>, Receiver 2 requests multicast data from the source. In this case, configure an Anycast-RP peer relationship between <span class="keyword">Device</span>C and <span class="keyword">Device</span>D so that Receiver 2 can send a Join message to the closest RP, that is, <span class="keyword">Device</span>D. After receiving multicast data from the source, <span class="keyword">Device</span>A encapsulates the multicast data into a Register message and sends it to <span class="keyword">Device</span>C. Upon receipt, <span class="keyword">Device</span>C forwards it to <span class="keyword">Device</span>D so that Receiver 2 can receive the multicast data from the source.</p>
<div class="fignone" id="EN-US_TASK_0172366936__fig61819557114"><a name="EN-US_TASK_0172366936__fig61819557114"></a><a name="fig61819557114"></a><span class="figcap"><b>Figure 1 </b>Configuring PIM Anycast-RP</span><br><span><img class="vsd" src="figure/en-us_image_0258940455.png"></span></div>

<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" frame="border" border="1" rules="all"><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="33.33333333333333%" id="mcps1.4.1.4.1.4.1.1" liSelected="liSelected"><p>Device</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="33.33333333333333%" id="mcps1.4.1.4.1.4.1.2" liSelected="liSelected"><p>Interface</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="33.33333333333333%" id="mcps1.4.1.4.1.4.1.3" liSelected="liSelected"><p>IP Address</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" rowspan="2" valign="top" width="33.33333333333333%" headers="mcps1.4.1.4.1.4.1.1 "><p><span class="keyword">Device</span>A</p>
<p></p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.4.1.4.1.2 "><p>GE <span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.4.1.4.1.3 "><p>10.110.1.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.2 "><p>GE <span>0/2/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.3 "><p>192.168.1.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.4.1.4.1.1 "><p><span class="keyword">Device</span>B</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.4.1.4.1.2 "><p>GE <span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.4.1.4.1.3 "><p>192.168.2.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="5" valign="top" width="33.33333333333333%" headers="mcps1.4.1.4.1.4.1.1 "><p><span class="keyword">Device</span>C</p>
<p></p>
<p></p>
<p></p>
<p></p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.4.1.4.1.2 "><p>GE <span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.4.1.4.1.3 "><p>192.168.3.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.2 "><p>GE <span>0/2/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.3 "><p>192.168.1.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.2 "><p>GE <span>0/3/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.3 "><p>10.110.2.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.2 "><p>Loopback 0</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.3 "><p>1.1.1.1/32</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.2 "><p>Loopback 1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.3 "><p>2.2.2.2/32</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="5" valign="top" width="33.33333333333333%" headers="mcps1.4.1.4.1.4.1.1 "><p><span class="keyword">Device</span>D</p>
<p></p>
<p></p>
<p></p>
<p></p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.4.1.4.1.2 "><p>GE <span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.4.1.4.1.3 "><p>192.168.2.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.2 "><p>GE <span>0/2/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.3 "><p>10.110.3.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.2 "><p>GE <span>0/3/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.3 "><p>192.168.3.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.2 "><p>Loopback 0</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.3 "><p>1.1.1.1/32</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.2 "><p>Loopback 1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.3 "><p>3.3.3.3/32</p>
</td>
</tr>
</tbody>
</table>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172366936__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Assign an IP address to each <span class="keyword">Router</span> interface and configure OSPF to implement IP interworking.</p>
</li><li><p>Enable multicast routing on each <span class="keyword">Router</span> and PIM-SM on each <span class="keyword">Router</span> interface.</p>
</li><li><p>Enable IGMP on interfaces connecting <span class="keyword">Router</span>s to hosts.</p>
</li><li><p>On <span class="keyword">Device</span>C and <span class="keyword">Device</span>D, configure the Loopback 0 interfaces as both Candidate-Rendezvous Points (C-RPs) and Candidate-BootStrap Routers (C-BSRs).</p>
</li><li><p>Configure the address of the Loopback 0 interfaces on <span class="keyword">Device</span>C and <span class="keyword">Device</span>D as the Anycast-RP address.</p>
</li><li><p>On <span class="keyword">Device</span>C and <span class="keyword">Device</span>D, configure the addresses of the Loopback 1 interfaces as the local addresses of Anycast-RPs.</p>
</li><li><p>Configure an Anycast-RP peer relationship between <span class="keyword">Device</span>C and <span class="keyword">Device</span>D.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172366936__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>Multicast group address: 226.1.1.1/24</p>
</li><li><p>RP address</p>
</li><li><p>Local RP address of the Anycast-RP</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172366936__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Assign an IP address to each <span class="keyword">Router</span> interface and configure OSPF to implement IP interworking. Enable multicast routing on each <span class="keyword">Router</span> and PIM-SM on each <span class="keyword">Router</span> interface. For configuration details, see Configuration Files in this section.</span><p><p># Assign an IP address and mask for each <span class="keyword">Router</span> interface in the PIM-SM domain based on <a href="#EN-US_TASK_0172366936__fig61819557114">Figure 1</a>, and configure OSPF between <span class="keyword">Router</span>s to implement IP interworking. Enable multicast routing on each <span class="keyword">Router</span> and PIM-SM on each <span class="keyword">Router</span> interface.</p>
<p># Configure <span class="keyword">Device</span>A.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname <span class="keyword">Device</span>A</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>multicast routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/0</span>] <strong>ip address 10.110.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/0</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>interface gigabitEthernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/2/0</span>] <strong>ip address 192.168.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/2/0</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>ospf</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-ospf-1] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-ospf-1-area-0.0.0.0] <strong>network 10.110.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-ospf-1-area-0.0.0.0] <strong>network 192.168.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-ospf-1-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-ospf-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
<p># Configure <span class="keyword">Device</span>B.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname <span class="keyword">Device</span>B</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>multicast routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>interface gigabitEthernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/0</span>] <strong>ip address 192.168.2.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/0</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>ospf</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-ospf-1] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-ospf-1-area-0.0.0.0] <strong>network 192.168.2.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-ospf-1-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-ospf-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>commit</strong></pre>
<p># Configure <span class="keyword">Device</span>C.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname <span class="keyword">Device</span>C</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C] <strong>multicast routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C] <strong>interface gigabitEthernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-GigabitEthernet<span>0/1/0</span>] <strong>ip address 192.168.3.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-GigabitEthernet<span>0/1/0</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C] <strong>interface gigabitEthernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-GigabitEthernet<span>0/2/0</span>] <strong>ip address 192.168.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-GigabitEthernet<span>0/2/0</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C] <strong>interface gigabitethernet <span>0/3/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-GigabitEthernet<span>0/3/0</span>] <strong>ip address 10.110.2.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-GigabitEthernet<span>0/3/0</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-GigabitEthernet<span>0/3/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C] <strong>interface loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-LoopBack0] <strong>ip address 1.1.1.1 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-LoopBack0] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-LoopBack0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-LoopBack1] <strong>ip address 2.2.2.2 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-LoopBack1] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C] <strong>ospf</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-ospf-1] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-ospf-1-area-0.0.0.0] <strong>network 192.168.3.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-ospf-1-area-0.0.0.0] <strong>network 192.168.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-ospf-1-area-0.0.0.0] <strong>network 10.110.2.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-ospf-1-area-0.0.0.0] <strong>network 1.1.1.1 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-ospf-1-area-0.0.0.0] <strong>network 2.2.2.2 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-ospf-1-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-ospf-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C] <strong>commit</strong></pre>
<p># Configure <span class="keyword">Device</span>D.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname <span class="keyword">Device</span>D</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>D] <strong>multicast routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D] <strong>interface gigabitEthernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-GigabitEthernet<span>0/1/0</span>] <strong>ip address 192.168.2.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-GigabitEthernet<span>0/1/0</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D] <strong>interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-GigabitEthernet<span>0/2/0</span>] <strong>ip address 10.110.3.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-GigabitEthernet<span>0/2/0</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D] <strong>interface gigabitEthernet <span>0/3/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-GigabitEthernet<span>0/3/0</span>] <strong>ip address 192.168.3.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-GigabitEthernet<span>0/3/0</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-GigabitEthernet<span>0/3/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D] <strong>interface loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-LoopBack0] <strong>ip address 1.1.1.1 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-LoopBack0] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-LoopBack0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-LoopBack1] <strong>ip address 3.3.3.3 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-LoopBack1] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D] <strong>ospf</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-ospf-1] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-ospf-1-area-0.0.0.0] <strong>network 192.168.2.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-ospf-1-area-0.0.0.0] <strong>network 10.110.3.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-ospf-1-area-0.0.0.0] <strong>network 192.168.3.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-ospf-1-area-0.0.0.0] <strong>network 1.1.1.1 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-ospf-1-area-0.0.0.0] <strong>network 3.3.3.3 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-ospf-1-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-ospf-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D] <strong>commit</strong></pre>
</p></li><li><span>Enable IGMP on interfaces connecting <span class="keyword">Router</span>s to hosts.</span><p><p># Enable IGMP on the interfaces connecting <span class="keyword">Device</span>C and <span class="keyword">Device</span>D to hosts.</p>
<p># Configure <span class="keyword">Device</span>C.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C] <strong>interface gigabitethernet <span>0/3/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C-GigabitEthernet<span>0/3/0</span>] <strong>igmp enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-GigabitEthernet<span>0/3/0</span>] <strong>quit</strong></pre>
<p># Configure <span class="keyword">Device</span>D.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>D] <strong>interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>D-GigabitEthernet<span>0/2/0</span>] <strong>igmp enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-GigabitEthernet<span>0/2/0</span>]<strong> quit</strong></pre>
</p></li><li><span>On <span class="keyword">Device</span>C and <span class="keyword">Device</span>D, configure the Loopback 0 interfaces as both C-RPs and C-BSRs.</span><p><p># Configure <span class="keyword">Device</span>C.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C] <strong>pim</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-pim] <strong>c-bsr loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-pim] <strong>c-rp loopback 0</strong></pre>
<p># Configure <span class="keyword">Device</span>D.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>D] <strong>pim</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-pim] <strong>c-bsr loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-pim] <strong>c-rp loopback 0</strong></pre>
</p></li><li><span>Configure the address of the Loopback 0 interfaces on <span class="keyword">Device</span>C and <span class="keyword">Device</span>D as the Anycast-RP address.</span><p><p># Configure <span class="keyword">Device</span>C.</p>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-pim] <strong>anycast-rp 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-pim-anycast-rp-1.1.1.1] <strong>quit</strong></pre>
<p># Configure <span class="keyword">Device</span>D.</p>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-pim] <strong>anycast-rp 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-pim-anycast-rp-1.1.1.1] <strong>quit</strong></pre>
</p></li><li><span>On <span class="keyword">Device</span>C and <span class="keyword">Device</span>D, configure the addresses of the Loopback 1 interfaces as the local addresses of Anycast-RPs.</span><p><p># Configure <span class="keyword">Device</span>C.</p>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-pim] <strong>anycast-rp 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-pim-anycast-rp-1.1.1.1] <strong>local-address 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-pim-anycast-rp-1.1.1.1] <strong>quit</strong></pre>
<p># Configure <span class="keyword">Device</span>D.</p>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-pim] <strong>anycast-rp 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-pim-anycast-rp-1.1.1.1] <strong>local-address 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-pim-anycast-rp-1.1.1.1] <strong>quit</strong></pre>
</p></li><li><span>Configure an Anycast-RP peer relationship between <span class="keyword">Device</span>C and <span class="keyword">Device</span>D.</span><p><p># Configure <span class="keyword">Device</span>C.</p>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-pim] <strong>anycast-rp 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-pim-anycast-rp-1.1.1.1] <strong>peer 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-pim-anycast-rp-1.1.1.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-pim] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C] <strong>commit</strong></pre>
<p># Configure <span class="keyword">Device</span>D.</p>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-pim] <strong>anycast-rp 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-pim-anycast-rp-1.1.1.1] <strong>peer 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-pim-anycast-rp-1.1.1.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-pim] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D] <strong>commit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p># Run the <strong>display pim rp-info</strong> command on <span class="keyword">Device</span>C and <span class="keyword">Device</span>D to check RP information.</p>
<pre class="screen">&lt;<span class="keyword">Device</span>C&gt; <strong>display pim rp-info</strong></pre>
<pre class="screen"> VPN-Instance: public net
 PIM-SM BSR RP Number:1
 Group/MaskLen: 224.0.0.0/4
     <strong>RP: 1.1.1.1 (local)</strong>
     Priority: 0
     Uptime: 00:45:19
     Expires: 00:02:11</pre>
<pre class="screen">&lt;<span class="keyword">Device</span>D&gt; <strong>display pim rp-info</strong></pre>
<pre class="screen"> VPN-Instance: public net
 PIM-SM BSR RP Number:1
 Group/MaskLen: 224.0.0.0/4
     <strong>RP: 1.1.1.1 (local)</strong>
     Priority: 0
     Uptime: 02:27:56
     Expires: 00:01:39
</pre>
<p>The preceding command output shows that <span class="keyword">Device</span>C and <span class="keyword">Device</span>D both serve as an RP and can forward Register messages from the multicast source to each other.</p>
<p># Run the <strong>display pim routing-table</strong> command to check PIM entries on each <span class="keyword">Router</span>. Source (10.110.1.2/24) in the PIM-SM domain sends multicast data to G (226.1.1.1), and Receiver2 joins G and receives the multicast data sent to G. Source registers with <span class="keyword">Device</span>C, and Receiver 2 sends a Join message to <span class="keyword">Device</span>D.</p>
<pre class="screen">&lt;<span class="keyword">Device</span>C&gt; <strong>display pim routing-table</strong></pre>
<pre class="screen"> VPN-Instance: public net
 Total 0 (*, G) entry; 1 (S, G) entries

 (10.110.1.2, 226.1.1.1)
     <strong>RP: 1.1.1.1 (local)</strong>
     Protocol: pim-sm, Flag: 2MSDP ACT
     UpTime: 00:00:38
     Upstream interface: Register, Refresh time: 00:00:38
         Upstream neighbor: NULL
         RPF prime neighbor: NULL
     Downstream interface(s) information: None</pre>
<pre class="screen">&lt;<span class="keyword">Device</span>D&gt; <strong>display pim routing-table</strong></pre>
<pre class="screen"> VPN-Instance: public net
 Total 1 (*, G) entry; 1 (S, G) entries

 (*, 226.1.1.1)
     <strong>RP: 1.1.1.1 (local)</strong>
     Protocol: pim-sm, Flag: WC
     UpTime: 00:01:25
     Upstream interface: Register, Refresh time: 00:01:25
         Upstream neighbor: NULL
         RPF prime neighbor: NULL
     Downstream interface(s) information:
     Total number of downstreams: 1
         1: GigabitEthernet<span>0/2/0</span>
             Protocol: igmp, UpTime: 00:01:25, Expires: -

 (10.110.1.2, 226.1.1.1)
     <strong>RP: 1.1.1.1 (local)</strong>
     Protocol: pim-sm, Flag: 2MSDP SWT ACT
     UpTime: 00:00:02
     Upstream interface: Register, Refresh time: 00:00:02
         Upstream neighbor: NULL
         RPF prime neighbor: NULL
     Downstream interface(s) information:
     Total number of downstreams: 1
         1: GigabitEthernet<span>0/2/0</span>
             Protocol: pim-sm, UpTime: 00:00:02, Expires: -</pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172366936__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p><span class="keyword">Device</span>A configuration file</p>
<pre class="screen">#
sysname <span class="keyword">Device</span>A
#
multicast routing-enable
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.110.1.1 255.255.255.0
 pim sm
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 192.168.1.1 255.255.255.0
 pim sm
#
ospf 1
 area 0.0.0.0
  network 10.110.1.0 0.0.0.255
  network 192.168.1.0 0.0.0.255
#
return</pre>
</li><li><p><span class="keyword">Device</span>B configuration file</p>
<pre class="screen">#
sysname <span class="keyword">Device</span>B
#
multicast routing-enable
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 192.168.2.1 255.255.255.0
 pim sm
#
ospf 1
 area 0.0.0.0
   network 192.168.2.0 0.0.0.255
#
return</pre>
</li><li><p><span class="keyword">Device</span>C configuration file</p>
<pre class="screen">#
sysname <span class="keyword">Device</span>C
#
multicast routing-enable
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 192.168.3.1 255.255.255.0
 pim sm
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 192.168.1.2 255.255.255.0
 pim sm
#
interface GigabitEthernet<span>0/3/0</span>
 undo shutdown
 ip address 10.110.2.1 255.255.255.0
 pim sm
 igmp enable
#
interface LoopBack0
 ip address 1.1.1.1 255.255.255.255
 pim sm
#
interface LoopBack1
 ip address 2.2.2.2 255.255.255.255
 pim sm
#
ospf 1
 area 0.0.0.0
  network 192.168.1.0 0.0.0.255
  network 192.168.3.0 0.0.0.255
  network 10.110.2.0 0.0.0.255
  network 1.1.1.1 0.0.0.0
  network 2.2.2.2 0.0.0.0
#
pim
 c-bsr LoopBack0
 c-rp LoopBack0
 anycast-rp 1.1.1.1
  local-address 2.2.2.2
  peer 3.3.3.3
#
return</pre>
</li><li><p><span class="keyword">Device</span>D configuration file</p>
<pre class="screen">#
sysname <span class="keyword">Device</span>D
#
multicast routing-enable
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 192.168.2.2 255.255.255.0
 pim sm
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.110.3.1 255.255.255.0
 pim sm
 igmp enable
#
interface GigabitEthernet<span>0/3/0</span>
 undo shutdown
 ip address 192.168.3.2 255.255.255.0
 pim sm
#
interface LoopBack0
 ip address 1.1.1.1 255.255.255.255
 pim sm
#
interface LoopBack1
 ip address 3.3.3.3 255.255.255.255
 pim sm
#
ospf 1
 area 0.0.0.0
  network 192.168.2.0 0.0.0.255
  network 192.168.3.0 0.0.0.255
  network 10.110.3.0 0.0.0.255
  network 3.3.3.3 0.0.0.0
  network 1.1.1.1 0.0.0.0
#
pim
 c-bsr LoopBack0
 c-rp LoopBack0
 anycast-rp 1.1.1.1
  local-address 3.3.3.3
  peer 2.2.2.2
#
return
</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_multicast_cfg_0036.html">Configuration Examples for PIM
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_multicast_cfg_0041.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_multicast_cfg_2201.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>