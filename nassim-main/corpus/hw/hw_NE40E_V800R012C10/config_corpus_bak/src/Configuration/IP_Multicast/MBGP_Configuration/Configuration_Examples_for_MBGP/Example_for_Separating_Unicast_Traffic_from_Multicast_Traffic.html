
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Separating Unicast Traffic from Multicast Traffic">
<meta name="abstract" content="Separating unicast traffic from multicast traffic helps plan network bandwidth resources.">
<meta name="description" content="Separating unicast traffic from multicast traffic helps plan network bandwidth resources.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_multicast_cfg_1031.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_multicast_cfg_1032.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_multicast-MBGP_cfg_2266.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="z00603461,w00606909,w00447999">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="MBGP">
<meta name="featuretype" content="IP Multicast">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="MBGP">
<meta name="featuretype" content="IP Multicast">
<meta name="featurename" content="MBGP">
<meta name="featuretype" content="IP Multicast">
<meta name="featurename" content="MBGP">
<meta name="featuretype" content="IP Multicast">
<meta name="OWNER" content="w00447999">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="w00447999">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172367070">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>Example for Separating Unicast Traffic from Multicast Traffic</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172367070"></a><a name="EN-US_TASK_0172367070"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Separating Unicast Traffic from Multicast Traffic</h1>
<div class="taskbody"><p>Separating unicast traffic from multicast traffic helps plan network bandwidth resources.</p>
<div class="context"><a name="EN-US_TASK_0172367070__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>In <a href="#EN-US_TASK_0172367070__fig_dc_vrp_multicast_cfg_226501">Figure 1</a>, <span class="keyword">Device</span> A resides in AS 65001 and is connected to the Internet and an IPTV multicast source; <span class="keyword">Device</span> B and <span class="keyword">Device</span> C reside in AS 65002 and are connected to high-speed Internet (HSI) users and IPTV users. It is required that the unicast traffic from AS 65001 to AS 65002 be separated from the multicast traffic from AS 65001 to AS 65002. Specifically, the HSI traffic is forwarded by <span class="keyword">Device</span> B, whereas the IPTV traffic is forwarded by <span class="keyword">Device</span> C.</p>
<div class="fignone" id="EN-US_TASK_0172367070__fig_dc_vrp_multicast_cfg_226501"><a name="EN-US_TASK_0172367070__fig_dc_vrp_multicast_cfg_226501"></a><a name="fig_dc_vrp_multicast_cfg_226501"></a><span class="figcap"><b>Figure 1 </b>Networking for configuring MBGP</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface 1, interface 2, and interface 3 represent GE <span>0/1/0</span>, GE <span>0/2/0</span>, and GE <span>0/3/0</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0000001197712187.png"></span></div>

<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" frame="border" border="1" rules="all"><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="33.33333333333333%" id="mcps1.4.1.4.1.4.1.1" liSelected="liSelected"><p>Device</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="33.33333333333333%" id="mcps1.4.1.4.1.4.1.2" liSelected="liSelected"><p>Interface</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="33.33333333333333%" id="mcps1.4.1.4.1.4.1.3" liSelected="liSelected"><p>IP Address</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" rowspan="4" valign="middle" width="33.33333333333333%" headers="mcps1.4.1.4.1.4.1.1 "><p><span class="keyword">Device</span>A</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.4.1.4.1.2 "><p>Loopback1</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.4.1.4.1.3 "><p>1.1.1.1/32</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.2 "><p>GE<span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.3 "><p>10.1.2.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.2 "><p>GE<span>0/2/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.3 "><p>10.1.1.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.2 "><p>GE<span>0/3/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.3 "><p>192.168.1.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="3" valign="middle" width="33.33333333333333%" headers="mcps1.4.1.4.1.4.1.1 "><p><span class="keyword">Device</span>B</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.4.1.4.1.2 "><p>Loopback1</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.4.1.4.1.3 "><p>2.2.2.2/32</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.2 "><p>GE<span>0/2/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.3 "><p>10.1.1.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.2 "><p>GE<span>0/3/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.3 "><p>10.1.3.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="3" valign="middle" width="33.33333333333333%" headers="mcps1.4.1.4.1.4.1.1 "><p><span class="keyword">Device</span>C</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.4.1.4.1.2 "><p>Loopback1</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.4.1.4.1.3 "><p>3.3.3.3/32</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.2 "><p>GE<span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.3 "><p>10.1.2.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.2 "><p>GE<span>0/3/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.3 "><p>10.1.3.2/24</p>
</td>
</tr>
</tbody>
</table>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172367070__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure an IP address for each interface and unicast routes so that devices within an AS can communicate with each other.</p>
</li><li><p>Establish MBGP peer relationships to generate inter-AS multicast routes.</p>
</li><li><p>Import the routes to be advertised and apply route-policies to the routes to be advertised by <span class="keyword">Device</span> B and <span class="keyword">Device</span> C to <span class="keyword">Device</span> A to control the results of unicast BGP route and MBGP route selection on <span class="keyword">Device</span> A.</p>
</li><li><p>Enable the multicast function on each device.</p>
</li><li><p>Configure the bootstrap router (BSR) boundary on inter-AS connected interfaces.</p>
</li><li><p>Establish MSDP peer relationships to transmit inter-AS multicast source information.</p>
</li><li><p>Verify the configuration.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172367070__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li>AS 65001 for <span class="keyword">Device</span> A and AS 65002 for <span class="keyword">Device</span> B and <span class="keyword">Device</span> C</li><li>Route-policy named <strong>policy_b2a</strong> on <span class="keyword">Device</span> B, used to change the MED of the MBGP route to be advertised to <span class="keyword">Device</span> A to 120</li><li>Route-policy named <strong>policy_c2a</strong> on <span class="keyword">Device</span> C, used to change the MED of the unicast BGP route to be advertised to <span class="keyword">Device</span> A to 160</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172367070__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure an IP address for each interface and enable OSPF within an AS.</span><p><p># Configure an IP address and a mask for each interface and enable a unicast routing protocol within an AS to update routes dynamically. For configuration details, see <a href="#EN-US_TASK_0172367070__fig_dc_vrp_multicast_cfg_226501">Figure 1</a>. In this example, OSPF is used as the unicast routing protocol, with process ID 1. For configuration details, see <a href="#EN-US_TASK_0172367070__section_dc_vrp_multicast_cfg_226505">Configuration Files</a> in this section.</p>
</p></li><li><span>Configure BGP, enable MBGP, and establish MBGP peer relationships.</span><p><p># Configure BGP and establish MBGP peer relationships on <span class="keyword">Device</span> A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>bgp 65001</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp] <strong>peer 10.1.1.2 as-number 65002</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp] <strong>peer 10.1.2.2 as-number 65002</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp] <strong>ipv4-family multicast</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp-af-multicast] <strong>peer 10.1.1.2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp-af-multicast] <strong>peer 10.1.2.2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp-af-multicast] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-bgp-af-multicast] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-bgp] <strong>quit</strong></pre>
<p># Configure BGP and establish MBGP peer relationships on <span class="keyword">Device</span> B.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>bgp 65002</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp] <strong>peer 10.1.1.1 as-number 65001</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp] <strong>peer 10.1.3.2 as-number 65002</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp] <strong>ipv4-family multicast</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp-af-multicast] <strong>peer 10.1.1.1 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp-af-multicast] <strong>peer 10.1.3.2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp-af-multicast] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-bgp-af-multicast] <strong>quit</strong></pre>
<p># Configure BGP and establish MBGP peer relationships on <span class="keyword">Device</span> C.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C] <strong>bgp 65002</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp] <strong>peer 10.1.2.1 as-number 65001</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp]<strong> peer 10.1.3.1 as-number 65002</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp]<strong> ipv4-family multicast</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp-af-multicast] <strong>peer 10.1.2.1 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp-af-multicast] <strong>peer 10.1.3.1 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp-af-multicast] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C-bgp-af-multicast] <strong>quit</strong></pre>
</p></li><li><span>Configure the routes to be advertised.</span><p><p># Configure the routes to be advertised on <span class="keyword">Device</span> B.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-bgp] <strong>network 2.2.2.2 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp] <strong>network 10.1.3.0 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp] <strong>ipv4-family multicast</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp-af-multicast] <strong>network 2.2.2.2 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp-af-multicast] <strong>network 10.1.3.0 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp-af-multicast] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-bgp-af-multicast] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-bgp] <strong>quit</strong></pre>
<p># Configure the routes to be advertised on <span class="keyword">Device</span> C.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C-bgp] <strong>network 3.3.3.3 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp] <strong>network 10.1.3.0 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp] <strong>ipv4-family multicast</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp-af-multicast] <strong>network 3.3.3.3 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp-af-multicast] <strong>network 10.1.3.0 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp-af-multicast] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C-bgp-af-multicast] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C-bgp] <strong>quit</strong></pre>
</p></li><li><span>Configure route-policies.</span><p><p># Configure a route-policy on <span class="keyword">Device</span> B to change the MED of the MBGP route to be advertised to <span class="keyword">Device</span> A so that <span class="keyword">Device</span> A selects the MBGP route advertised by <span class="keyword">Device</span> C.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>ip ip-prefix p_b2a permit 10.1.3.0 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>route-policy policy_b2a permit node 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-route-policy] <strong>if-match ip-prefix p_b2a</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-route-policy] <strong>apply cost 120</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-route-policy] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>route-policy policy_b2a permit node 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-route-policy] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>bgp 65002</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp] <strong>ipv4-family multicast</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp-af-multicast] <strong>peer 10.1.1.1 route-policy policy_b2a export</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp-af-multicast] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-bgp-af-multicast] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-bgp] <strong>quit</strong></pre>
<p># Configure a route-policy on <span class="keyword">Device</span> C to change the MED of the unicast BGP route to be advertised to <span class="keyword">Device</span> A so that <span class="keyword">Device</span> A selects the unicast BGP route advertised by <span class="keyword">Device</span> B.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C] <strong>ip ip-prefix p_c2a permit 10.1.3.0 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C] <strong>route-policy policy_c2a permit node 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-route-policy] <strong>if-match ip-prefix p_c2a</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-route-policy] <strong>apply cost 160</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-route-policy] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C] <strong>route-policy policy_c2a permit node 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-route-policy] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C] <strong>bgp 65002</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp] <strong>peer 10.1.2.1 route-policy policy_c2a export</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C-bgp] <strong>quit</strong></pre>
<p>Check the unicast BGP routing table and MBGP routing table on <span class="keyword">Device</span> A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>display bgp routing-table</strong></pre>
<pre class="screen"> BGP Local router ID is 10.1.1.1
 Status codes: * - valid, &gt; - best, d - damped, x - best external, a - add path,
               h - history,  i - internal, s - suppressed, S - Stale
               Origin : i - IGP, e - EGP, ? - incomplete
 RPKI validation codes: V - valid, I - invalid, N - not-found


 Total Number of Routes: 5
      Network            NextHop        MED        LocPrf    PrefVal Path/Ogn

 *&gt;   1.1.1.1/32         0.0.0.0         0                     0      i
 *&gt;   2.2.2.2/32         10.1.1.2        0                     0      65002i
 *&gt;   3.3.3.3/32         10.1.2.2        0                     0      65002i
 *&gt;   10.1.3.0/24        <strong>10.1.1.2</strong>        0                     0      65002i
 *                       10.1.2.2        160                   0      65002i</pre>
<p>The preceding command output shows that <span class="keyword">Device</span> A selects the unicast route advertised by <span class="keyword">Device</span> B as the optimal unicast route to transmit the traffic destined for 10.1.3.0/24.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>display bgp multicast routing-table</strong></pre>
<pre class="screen"> BGP Local router ID is 10.1.1.1
 Status codes: * - valid, &gt; - best, d - damped, x - best external, a - add path,
               h - history,  i - internal, s - suppressed, S - Stale
               Origin : i - IGP, e - EGP, ? - incomplete


 Total Number of Routes: 5
      Network            NextHop        MED        LocPrf    PrefVal Path/Ogn

 *&gt;   1.1.1.1/32         0.0.0.0         0                     0      i
 *&gt;   2.2.2.2/32         10.1.1.2        0                     0      65002i
 *&gt;   3.3.3.3/32         10.1.2.2        0                     0      65002i
 *&gt;   10.1.3.0/24        <strong>10.1.2.2</strong>        0                     0      65002i
 *                       10.1.1.2        120                   0      65002i</pre>
<p>The preceding command output shows that <span class="keyword">Device</span> A selects the route advertised by <span class="keyword">Device</span> C as the optimal multicast route to transmit the traffic destined for 10.1.3.0/24.</p>
</p></li><li><span>Enable the multicast function on the devices and interconnected interfaces of the devices.</span><p><p># Configure <span class="keyword">Device</span> A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A]<strong> multicast routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A]<strong> interface GigabitEthernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/0</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>interface GigabitEthernet<span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/2/0</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>interface GigabitEthernet<span>0/3/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/3/0</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/3/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-LoopBack1] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-LoopBack1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-LoopBack1] <strong>quit</strong></pre>
<p># Configure <span class="keyword">Device</span> B.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B]<strong> multicast routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>interface GigabitEthernet<span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/2/0</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B]<strong> interface GigabitEthernet<span>0/3/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/3/0</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/3/0</span>] <strong>igmp enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/3/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-LoopBack1] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-LoopBack1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-LoopBack1] <strong>quit</strong></pre>
<p># Configure <span class="keyword">Device</span> C.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C]<strong> multicast routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C] <strong>interface GigabitEthernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-GigabitEthernet<span>0/1/0</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C]<strong> interface GigabitEthernet<span>0/3/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-GigabitEthernet<span>0/3/0</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-GigabitEthernet<span>0/3/0</span>] <strong>igmp enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-GigabitEthernet<span>0/3/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-LoopBack1] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-LoopBack1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C-LoopBack1] <strong>quit</strong></pre>
</p></li><li><span>Configure the C-BSR and candidate-rendezvous point (C-RP) to run for the BSR and RP.</span><p><p># Configure <span class="keyword">Device</span> A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>pim</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-pim] <strong>c-bsr loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-pim] <strong>c-rp loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-pim] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-pim] <strong>quit</strong></pre>
<p># Configure <span class="keyword">Device</span> C.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C] <strong>pim</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-pim] <strong>c-bsr loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-pim] <strong>c-rp loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-pim] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C] <strong>quit</strong></pre>
</p></li><li><span>Configure the BSR boundary on inter-AS connected interfaces.</span><p><p># Configure <span class="keyword">Device</span> A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>interface GigabitEthernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/0</span>] <strong>pim bsr-boundary</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>interface GigabitEthernet<span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/2/0</span>] <strong>pim bsr-boundary</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/2/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<p># Configure <span class="keyword">Device</span> B.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>interface GigabitEthernet<span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/2/0</span>] <strong>pim bsr-boundary</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/2/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<p># Configure <span class="keyword">Device</span> C.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C] <strong>interface GigabitEthernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-GigabitEthernet<span>0/1/0</span>] <strong>pim bsr-boundary</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-GigabitEthernet<span>0/1/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
</p></li><li><span>Establish MSDP peer relationships.</span><p><p># Configure <span class="keyword">Device</span> A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>msdp</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-msdp] <strong>peer 10.1.1.2 connect-interface GigabitEthernet<span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-msdp] <strong>peer 10.1.2.2 connect-interface GigabitEthernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-msdp] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-msdp] <strong>quit</strong></pre>
<p># Configure <span class="keyword">Device</span> B.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>msdp</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-msdp] <strong>peer 10.1.1.1 connect-interface GigabitEthernet<span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-msdp] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-msdp] <strong>quit</strong></pre>
<p># Configure <span class="keyword">Device</span> C.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C] <strong>msdp</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-msdp] <strong>peer 10.1.2.1 connect-interface GigabitEthernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-msdp] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C-msdp] <strong>quit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p># Run the <strong>display msdp brief</strong> command to check whether MSDP peer relationships are established. For example, the brief information about the MSDP peer relationship displayed on <span class="keyword">Device</span>A is as follows:</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>display msdp brief</strong></pre>
<pre class="screen">MSDP Peer Brief Information of VPN-Instance: public net
  Configured   Up           Listen       Connect      Shutdown     Down
  2            2            0            0            0            0

  Peer's Address   State     Up/Down time    AS          SA Count   Reset Count
  10.1.1.2         Up        01:04:26        65002       0          0
  10.1.2.2         Up        01:04:13        65002       0          0</pre>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0172367070__section_dc_vrp_multicast_cfg_226505"><a name="EN-US_TASK_0172367070__section_dc_vrp_multicast_cfg_226505"></a><a name="section_dc_vrp_multicast_cfg_226505"></a><a name="EN-US_TASK_0172367070__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p><span class="keyword">Device</span> A configuration file</p>
<pre class="screen">#
sysname <span class="keyword">Device</span>A
#
multicast routing-enable
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.2.1 255.255.255.0
 pim bsr-boundary
 pim sm
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.1.1.1 255.255.255.0
 pim bsr-boundary
 pim sm
#
interface GigabitEthernet<span>0/3/0</span>
 shutdown
 pim sm
#
interface LoopBack1
 ip address 1.1.1.1 255.255.255.255
 pim sm
#
bgp 65001
 peer 10.1.1.2 as-number 65002
 peer 10.1.2.2 as-number 65002
 #
 ipv4-family unicast
 undo synchronization
 network 1.1.1.1 255.255.255.255
  peer 10.1.1.2 enable
  peer 10.1.2.2 enable
 #
 ipv4-family multicast
 undo synchronization
 network 1.1.1.1 255.255.255.255
  peer 10.1.1.2 enable
  peer 10.1.2.2 enable
#
pim
 c-bsr LoopBack1
 c-rp LoopBack1
#
msdp
 peer 10.1.1.2 connect-interface GigabitEthernet<span>0/2/0</span>
 peer 10.1.2.2 connect-interface GigabitEthernet<span>0/1/0</span>
#
return</pre>
</li><li><p><span class="keyword">Device</span> B configuration file</p>
<pre class="screen">#
sysname <span class="keyword">Device</span>B
#
multicast routing-enable
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.1.1.2 255.255.255.0
 pim bsr-boundary
 pim sm
#
interface GigabitEthernet<span>0/3/0</span>
 undo shutdown
 ip address 10.1.3.1 255.255.255.0
 pim sm
 igmp enable
#
interface LoopBack1
 ip address 2.2.2.2 255.255.255.255
 pim sm
#
bgp 65002
 peer 10.1.1.1 as-number 65001
 peer 10.1.3.2 as-number 65002
 #
 ipv4-family unicast
 undo synchronization
  network 2.2.2.2 255.255.255.255
  network 10.1.3.0 255.255.255.0
  peer 10.1.1.1 enable
  peer 10.1.3.2 enable
 #
 ipv4-family multicast
 undo synchronization
  network 2.2.2.2 255.255.255.255
  network 10.1.3.0 255.255.255.0
  peer 10.1.1.1 enable
  peer 10.1.1.1 route-policy policy_b2a export
  peer 10.1.3.2 enable
#
ospf 1
 area 0.0.0.0
  network 2.2.2.2 0.0.0.0
  network 10.1.3.0 0.0.0.255
#
ip ip-prefix p_b2a index 10 permit 10.1.3.0 24
#
route-policy policy_b2a permit node 10
 if-match ip-prefix p_b2a
 apply cost 120
#
route-policy policy_b2a permit node 20
#
msdp
 peer 10.1.1.1 connect-interface GigabitEthernet<span>0/2/0</span>
#
return</pre>
</li><li><p><span class="keyword">Device</span> C configuration file</p>
<pre class="screen">#
sysname <span class="keyword">Device</span>C
#
multicast routing-enable
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.2.2 255.255.255.0
 pim bsr-boundary
 pim sm
#
interface GigabitEthernet<span>0/3/0</span>
 undo shutdown
 ip address 10.1.3.2 255.255.255.0
 pim sm
 igmp enable
#
interface LoopBack1
 ip address 3.3.3.3 255.255.255.255
 pim sm
#
bgp 65002
 peer 10.1.2.1 as-number 65001
 peer 10.1.3.1 as-number 65002
 #
 ipv4-family unicast
 undo synchronization
 network 3.3.3.3 255.255.255.255
  network 10.1.3.0 255.255.255.0
  peer 10.1.2.1 enable
  peer 10.1.2.1 route-policy policy_c2a export
  peer 10.1.3.1 enable
 #
 ipv4-family multicast
 undo synchronization
  network 3.3.3.3 255.255.255.255
  network 10.1.3.0 255.255.255.0
  peer 10.1.2.1 enable
  peer 10.1.3.1 enable
#
ospf 1
 area 0.0.0.0
  network 3.3.3.3 0.0.0.0
  network 10.1.3.0 0.0.0.255
#
ip ip-prefix p_c2a index 10 permit 10.1.3.0 24
#
route-policy policy_c2a permit node 10
 if-match ip-prefix p_c2a
 apply cost 160
#
route-policy policy_c2a permit node 20
#
pim
 c-bsr LoopBack1
 c-rp LoopBack1
#
msdp
 peer 10.1.2.1 connect-interface GigabitEthernet<span>0/1/0</span>
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_multicast_cfg_1031.html">Configuration Examples for MBGP
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_multicast_cfg_1032.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_multicast-MBGP_cfg_2266.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>