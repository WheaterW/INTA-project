
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring Route Exchange Between PEs and CEs">
<meta name="abstract" content="To enable CEs to communicate, the PEs and CEs must be capable of exchanging routes.">
<meta name="description" content="To enable CEs to communicate, the PEs and CEs must be capable of exchanging routes.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_ngmvpn_0024.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_ngmvpn_0034.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="z00603461,w00606909,w00447999">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="IPv4 Multicast VPN_NG MVPN">
<meta name="featuretype" content="IP Multicast">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="IPv4 Multicast VPN_NG MVPN">
<meta name="featuretype" content="IP Multicast">
<meta name="featurename" content="IPv4 Multicast VPN_NG MVPN">
<meta name="featuretype" content="IP Multicast">
<meta name="featurename" content="IPv4 Multicast VPN_NG MVPN">
<meta name="featuretype" content="IP Multicast">
<meta name="featurename" content="IPv4 Multicast VPN_NG MVPN">
<meta name="featuretype" content="IP Multicast">
<meta name="OWNER" content="w00447999">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="w00447999">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001270193545">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring Route Exchange Between PEs and CEs</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001270193545"></a><a name="EN-US_TASK_0000001270193545"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring Route Exchange Between PEs and CEs</h1>
<div class="taskbody"><p>To enable CEs to communicate, the PEs and CEs must be capable of exchanging routes.</p>
<div class="context"><a name="EN-US_TASK_0000001270193545__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><div class="p">In BGP/MPLS IP VPN, a routing protocol or static route must be configured between a PE and a CE to allow them to communicate and allow the CE to obtain routes to other CEs. The routing protocol can be External Border Gateway Protocol (EBGP), Internal Border Gateway Protocol (IBGP), Routing Information Protocol (RIP), Open Shortest Path First (OSPF), or Intermediate System to Intermediate System (IS-IS). Choose one of the following configurations as needed:<ul><li><a href="#EN-US_TASK_0000001270193545__step_dc_vrp_cfg_ngmvpn_002501">Configure EBGP between a PE and a CE.</a></li><li><a href="#EN-US_TASK_0000001270193545__step_dc_vrp_cfg_ngmvpn_002502">Configure IBGP between a PE and a CE.</a></li><li><a href="#EN-US_TASK_0000001270193545__step_dc_vrp_cfg_ngmvpn_002503">Configure a static route between a PE and a CE.</a></li><li><a href="#EN-US_TASK_0000001270193545__step_dc_vrp_cfg_ngmvpn_002504">Configure RIP between a PE and a CE.</a></li><li><a href="#EN-US_TASK_0000001270193545__step_dc_vrp_cfg_ngmvpn_002505">Configure OSPF between a PE and a CE.</a></li><li><a href="#EN-US_TASK_0000001270193545__step_dc_vrp_cfg_ngmvpn_002506">Configure IS-IS between a PE and a CE.</a></li><li><a href="#EN-US_TASK_0000001270193545__step_dc_vrp_cfg_ngmvpn_002507">Configure a direct route between a PE and a CE.</a></li></ul>
</div>
<div class="p">The routing protocol configurations on the CE and PE are different:<ul><li>The CE is located at the client side and unaware of the VPN. Therefore, you do not need to configure VPN parameters when configuring a routing protocol on the CE.</li><li>A PE is located at the edge of the carrier's network. It connects to a CE and exchanges VPN routing information with other PEs. If the CEs that access a PE belong to different VPNs, the PE must maintain different VRF tables. When configuring a routing protocol on the PE, specify the name of the VPN instance to which the routing protocol applies and configure the routing protocol and MP-BGP to import routes from each other.</li></ul>
</div>
</div></div>
<div class="steps-unordered"><a name="EN-US_TASK_0000001270193545__1.4.2"></a><a name="1.4.2"></a><h4 class="sectiontitle">Procedure</h4>
<ul><li id="EN-US_TASK_0000001270193545__step_dc_vrp_cfg_ngmvpn_002501"><span id="EN-US_TASK_0000001270193545__">Configure EBGP between a PE and a CE.</span><p><p>Perform the following steps on the PE:</p>
</p><ol><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ipv4-family"><b><span class="cmdname">ipv4-family</span></b></a> <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i></span><p><p>The BGP-VPN instance IPv4 address family view is displayed.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=as-number"><b><span class="cmdname">as-number</span></b></a> <i><span class="varname">vrf-as</span></i> [ <i><span class="varname">no-prepend</span></i> ]</span><p><p>An AS number is configured for the VPN instance IPv4 address family.</p>
<p>If a device needs to be simulated as multiple BGP devices logically during network transfer or service identification, you can run the <a href="cmdqueryname=as-number"><b><span class="cmdname">as-number</span></b></a> command to configure a different AS number for each VPN instance IPv4 address family.</p>
<p>If <strong>no-prepend</strong> is not configured, the AS_Path attribute of a VPN route sent to the VPNv6 routing table carries the configured AS number. If <strong>no-prepend</strong> is configured, the AS_Path attribute of a VPN route sent to the VPNv6 routing table does not carry the configured AS number.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The AS number configured in the BGP-VPN instance IPv4 address family view must be different from the AS number configured in the BGP view.</p>
</div></div>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <strong><span>as-number</span></strong> <i><span class="varname">as-number</span></i></span><p><p>The CE is configured as a VPN peer.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <a href="cmdqueryname=ebgp-max-hop"><b><span class="cmdname">ebgp-max-hop</span></b></a> [ <i><span class="varname">hop-count</span></i> ]</span><p><p>The maximum number of hops between the PE and its EBGP peer (the CE) is specified. This step is mandatory if the PE and CE are not directly connected.</p>
<p>Generally, EBGP peers are connected by a direct physical link. If no direct physical link is available, the <a href="cmdqueryname=peer+ebgp-max-hop"><b><span class="cmdname">peer ebgp-max-hop</span></b></a> command must be used to allow EBGP peers to establish a multi-hop TCP connection.</p>
<p> If the maximum number of hops is set to 1, the PE cannot establish an EBGP connection with a peer if they are not directly connected.</p>
</p></li><li class="substepexpand"><span>(Optional) Run either of the following commands:</span><p><ul><li><a href="cmdqueryname=import-route"><b><span class="cmdname">import-route</span></b></a> <strong><span>direct</span></strong> [ <strong><span>med</span></strong> <i><span class="varname">med</span></i> | <strong><span>route-policy</span></strong> <i><span class="varname">route-policy-name</span></i> ] <sup>*</sup></li><li><a href="cmdqueryname=network"><b><span class="cmdname">network</span></b></a> <i><span class="varname">ipv4-address</span></i> [ <i><span class="varname">mask</span></i> | <i><span class="varname">mask-length</span></i> ] [ <strong><span>route-policy</span></strong> <i><span class="varname">route-policy-name</span></i> ]</li></ul>
<p>The PE is enabled to import the direct routes destined for the local CE into the VRF table and advertise the routes to the remote PE.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The PE can automatically learn the direct routes destined for the local CE. The learned routes take precedence over the direct routes advertised from the local CE using EBGP. If this step is not performed, the PE does not use MP-BGP to advertise the direct routes destined for the local CE to the remote PE.</p>
</div></div>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">group-name</span></i> | <i><span class="varname">ipv4-address</span></i> } <a href="cmdqueryname=soo"><b><span class="cmdname">soo</span></b></a> <i><span class="varname">site-of-origin</span></i></span><p><p>The Site of Origin (SoO) attribute is configured for the CE that has been specified as a VPN peer of the PE.</p>
<p>Several CEs at a VPN site may establish BGP connections with different PEs. The VPN routes advertised from the CEs to the PEs may be re-advertised to the same VPN site after the routes traverse the backbone network. This may cause route loops at the VPN site.</p>
<p>If the SoO attribute is configured for a specified CE, the PE adds the attribute to a route sent from the CE and advertises the route to the remote PE. The remote PE checks the SoO attribute of the route before sending it to its attached CE. If the SoO attribute is the same as the local SoO attribute on the remote PE, the remote PE does not send the route to its attached CE.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <a href="cmdqueryname=allow-as-loop"><b><span class="cmdname">allow-as-loop</span></b></a> [ <i><span class="varname">number</span></i> ]</span><p><p>Route loops are allowed.</p>
<p>This step is used in hub &amp; spoke networking.</p>
<p> Generally, BGP uses the AS number to detect route loops. On a hub &amp; spoke network, if EBGP runs between a Hub-PE and a Hub-CE at a hub site, the route sent from the Hub-PE to the Hub-CE carries the AS number of the Hub-PE. If the Hub-CE sends a route update message to the Hub-PE, the Hub-PE will deny it because the route update message contains the AS number of the Hub-PE. To ensure proper route transmission on a hub &amp; spoke network, configure all the BGP peers along the path (along which the Hub-CE advertises VPN routes to the Spoke-CE) to accept the routes which have the AS number repeated once.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <a href="cmdqueryname=substitute-as"><b><span class="cmdname">substitute-as</span></b></a></span><p><p>BGP AS number substitution is enabled. Perform this step on the PE in a scenario in which CEs at different sites use the same AS number.</p>
<div class="notice"><span class="noticetitle"><img src="../../../../public_sys-resources/notice_3.0-en-us.png"> </span><div class="noticebody"><p>Enabling BGP AS number substitution may cause routing loops on a CE multi-homing network.</p>
</div></div>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
<p><p>Perform the following steps on the CE:</p>
</p><ol><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <a href="cmdqueryname=as-number"><b><span class="cmdname">as-number</span></b></a> <i><span class="varname">as-number</span></i></span><p><p>The PE is configured as a VPN peer.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <a href="cmdqueryname=ebgp-max-hop"><b><span class="cmdname">ebgp-max-hop</span></b></a> [ <i><span class="varname">hop-count</span></i> ]</span><p><p>The maximum number of hops between the CE and its EBGP peer (the PE) is set. This step is mandatory if the PE and CE are not directly connected.</p>
<p>Generally, EBGP peers are directly connected by a physical link. If no direct physical link is available, the <a href="cmdqueryname=peer+ebgp-max-hop"><b><span class="cmdname">peer ebgp-max-hop</span></b></a> command must be used to allow EBGP peers to establish a multi-hop TCP connection.</p>
<p>If the maximum number of hops is set to 1, the CE cannot establish an EBGP connection with a peer if they are not directly connected.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=import-route"><b><span class="cmdname">import-route</span></b></a> { <strong><span>direct</span></strong> | <strong><span>static</span></strong> | <strong><span>rip</span></strong> <i><span class="varname">process-id</span></i> | <strong><span>ospf</span></strong><i><span class="varname"> process-id</span></i> | <strong><span>isis</span></strong> <i><span class="varname">process-id</span></i> } [ <strong><span>med</span></strong> <i><span class="varname">med</span></i> | <strong><span>route-policy</span></strong> <i><span class="varname">route-policy-name</span></i> ] <sup>*</sup></span><p><p>Routes of the local site are imported.</p>
<p>The CE advertises the routes of its own VPN network segment to the connected PE. The PE forwards the routes to the remote CE. The type of route imported at this step may vary according to the networking mode.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li id="EN-US_TASK_0000001270193545__step_dc_vrp_cfg_ngmvpn_002502"><span id="EN-US_TASK_0000001270193545__">Configure IBGP between a PE and a CE.</span><p><p>Perform the following steps on the PE:</p>
</p><ol><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ipv4-family"><b><span class="cmdname">ipv4-family</span></b></a> <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i></span><p><p>The BGP-VPN instance IPv4 address family view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <strong><span>as-number</span></strong> <i><span class="varname">as-number</span></i></span><p><p>The CE is configured as a VPN peer.</p>
</p></li><li class="substepexpand"><span>(Optional) Run either of the following commands:</span><p><ul><li><pre class="screen"><a href="cmdqueryname=import-route"><b><span class="cmdname">import-route</span></b></a> <strong><span>direct</span></strong> [ <strong><span>med</span></strong> <i><span class="varname">med</span></i> | <strong><span>route-policy</span></strong> <i><span class="varname">route-policy-name</span></i> ] <sup>*</sup></pre>
</li><li><pre class="screen"><a href="cmdqueryname=network"><b><span class="cmdname">network</span></b></a> <i><span class="varname">ipv4-address</span></i> [ <i><span class="varname">mask</span></i> | <i><span class="varname">mask-length</span></i> ] [ <strong><span>route-policy</span></strong> <i><span class="varname">route-policy-name</span></i> ]</pre>
</li></ul>
<p>The PE is enabled to import the direct routes destined for the local CE into the VRF table and advertise the routes to the remote PE.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The PE can automatically learn the direct routes destined for the local CE. The learned routes take precedence over the direct routes advertised from the local CE using IBGP. If this step is not performed, the PE does not use MP-BGP to advertise the direct routes destined for the local CE to the remote PE.</p>
</div></div>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
<p><p>Perform the following steps on the CE:</p>
</p><ol><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <a href="cmdqueryname=as-number"><b><span class="cmdname">as-number</span></b></a> <i><span class="varname">as-number</span></i></span><p><p>The PE is configured as a VPN peer.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=import-route"><b><span class="cmdname">import-route</span></b></a> { <strong><span>direct</span></strong> | <strong><span>static</span></strong> | <strong><span>rip</span></strong> <i><span class="varname">process-id</span></i> | <strong><span>ospf</span></strong> <i><span class="varname">process-id</span></i> | <strong><span>isis</span></strong> <i><span class="varname">process-id</span></i> } [ <strong><span>med</span></strong> <i><span class="varname">med</span></i> | <strong><span>route-policy</span></strong> <i><span class="varname">route-policy-name</span></i> ] <sup>*</sup></span><p><p>Routes of the local site are imported.</p>
<p>The CE advertises the routes of its own VPN network segment to the connected PE. The PE forwards the routes to the remote CE. The type of route imported at this step may vary according to the networking mode.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li id="EN-US_TASK_0000001270193545__step_dc_vrp_cfg_ngmvpn_002503"><span id="EN-US_TASK_0000001270193545__">Configure a static route between a PE and a CE.</span><p><p>Perform the following configurations on the PE device. The configurations on the CE are similar to those on the PE and are not provided here.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>For details about how to configure a static route, see <span><a href="dc_vrp_static-route-ipv4_cfg_0000.html">"IPv4 Static Route Configuration" in the <em><span class="keyword">HUAWEI NE40E-M2 series</span> <span class="keyword">Universal Service Router</span> Configuration Guide - IP Routing</em>.</a></span></p>
</div></div>
</p><ol><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ip+route-static+vpn-instance"><b><span class="cmdname">ip route-static vpn-instance</span></b></a> <i><span class="varname">vpn-source-name</span></i> <i><span class="varname">destination-address</span></i> { <i><span class="varname">mask</span></i> | <i><span class="varname">mask-length</span></i> } <i><span class="varname">interface-type interface-number</span></i> [ <i><span class="varname">nexthop-address</span></i> ] [ <strong><span>preference</span></strong> <i><span class="varname">preference</span></i> | <strong><span>tag</span></strong> <i><span class="varname">tag</span></i> ] <sup>*</sup></span><p><p>A static route is configured for a specified VPN instance IPv4 address family.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ipv4-family"><b><span class="cmdname">ipv4-family</span></b></a> <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i></span><p><p>The BGP-VPN instance IPv4 address family view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=import-route"><b><span class="cmdname">import-route</span></b></a> <strong><span>static</span></strong> [ <strong><span>med</span></strong> <i><span class="varname">med</span></i> | <strong><span>route-policy</span></strong> <i><span class="varname">route-policy-name</span></i> ] <sup>*</sup></span><p><p>The configured static route is added to the VRF table of the BGP-VPN instance IPv4 address family.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>A VPN that receives routes outside it from a device other than the PE and advertises the routes to the PE is called a transit VPN. A VPN that receives only routes in it and routes advertised by the PE is called a stub VPN. Generally, a static route is used for route exchange between the CE and PE in a stub VPN only.</p>
</div></div>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li id="EN-US_TASK_0000001270193545__step_dc_vrp_cfg_ngmvpn_002504"><span id="EN-US_TASK_0000001270193545__">Configure RIP between a PE and a CE.</span><p><p>Perform the following configurations on the PE device. The configurations on the CE are similar to those on the PE and are not provided here.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Configuring RIPv1 or RIPv2 on the CE is not described here. For details about how to configure RIP, see "RIP Configuration" in the <em><a href="dc_vrp_rip_cfg_0000.html"><span class="keyword">HUAWEI NE40E-M2 series</span><span class="keyword">Universal Service Router</span> Configuration Guide - IP Routing</a></em>.</p>
</div></div>
</p><ol><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=rip"><b><span class="cmdname">rip</span></b></a> <i><span class="varname">process-id</span></i> <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i></span><p><p>A RIP process is created on the PE.</p>
<p>A RIP process can be bound only to one VPN instance. If a RIP process is not bound to any VPN instance before it is started, this process becomes a public network process and cannot be bound to a VPN instance later.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=network"><b><span class="cmdname">network</span></b></a> <i><span class="varname">network-address</span></i></span><p><p>RIP is enabled on the network segment where the interface bound to the VPN instance resides.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=import-route"><b><span class="cmdname">import-route</span></b></a><strong><span> bgp</span></strong> [ <strong><span>cost</span></strong> { <i><span class="varname">cost</span></i> | <strong><span>transparent</span></strong> } | <strong><span>route-policy</span></strong> <i><span class="varname">route-policy-name</span></i> ] <sup>*</sup></span><p><p>BGP routes are imported into the RIP routing table.</p>
<p>After the <a href="cmdqueryname=import-route"><b><span class="cmdname">import-route</span></b></a> <strong><span>bgp</span></strong> command is run in the RIP view, the PE can import the VPNv4 routes learned from the remote PE into the RIP routing table and advertise them to the attached CE.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Return to the system view.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ipv4-family"><b><span class="cmdname">ipv4-family</span></b></a> <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i></span><p><p>The BGP-VPN instance IPv4 address family view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=import-route"><b><span class="cmdname">import-route</span></b></a> <strong><span>rip</span></strong> <i><span class="varname">process-id</span></i> [ <strong><span>med</span></strong> <i><span class="varname">med</span></i> | <strong><span>route-policy</span></strong> <i><span class="varname">route-policy-name</span></i> ] <sup>*</sup></span><p><p>RIP routes are imported into the VRF table of the BGP-VPN instance IPv4 address family.</p>
<p>After the <a href="cmdqueryname=import-route"><b><span class="cmdname">import-route</span></b></a> <strong><span>rip</span></strong> command is run in the BGP-VPN instance IPv4 address family view, the PE imports the VPN routes learned from the attached CE into the BGP routing table and advertises VPNv4 routes to the remote PE.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
<p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Deleting a VPN instance or disabling a VPN instance IPv4 address family will delete all the RIP processes bound to the VPN instance or the VPN instance IPv4 address family on the PE.</p>
</div></div>
</p></li><li id="EN-US_TASK_0000001270193545__step_dc_vrp_cfg_ngmvpn_002505"><span id="EN-US_TASK_0000001270193545__">Configure OSPF between a PE and a CE.</span><p><p>Configure OSPF on the CE, and the CE configuration details are not provided here. Perform the following steps on the PE:</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Configuring OSPF on the CE is not described here. For details about how to configure OSPF, see "OSPF Configuration" in the <em><a href="dc_vrp_ospf_cfg_0000.html"><span class="keyword">HUAWEI NE40E-M2 series</span><span class="keyword">Universal Service Router</span> Configuration Guide - IP Routing</a></em>.</p>
</div></div>
</p><ol><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ospf"><b><span class="cmdname">ospf</span></b></a> <i><span class="varname">process-id</span></i> [ <strong><span>router-id</span></strong> <i><span class="varname">router-id</span></i> ] <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i></span><p><p>An OSPF process is created on the PE, and the OSPF view is displayed.</p>
<p>An OSPF process can be bound to only one VPN instance. If an OSPF process is not bound to any VPN instance before it is started, this process becomes a public network process and cannot be bound to a VPN instance later.</p>
<p>A router ID needs to be specified when an OSPF process is started after it is bound to a VPN instance. The router ID must be different from the public network router ID configured in the system view. If the router ID is not specified, OSPF selects the IP address of one of the interfaces bound to the VPN instance as the router ID based on a certain rule.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=domain-id"><b><span class="cmdname">domain-id</span></b></a> <i><span class="varname">domain-id</span></i> [ <strong><span>secondary</span></strong> ]</span><p><p>The domain ID is configured.</p>
<p>The domain ID can be an integer or in dotted decimal notation.</p>
<p>Each OSPF process can be configured with two domain IDs. Different processes can have the same domain ID. There is no restriction on the domain IDs of the OSPF processes of different VPNs on a PE. The OSPF processes of the same VPN must be configured with the same domain ID to ensure proper route advertisement.</p>
<p>The domain ID of an OSPF process is contained in the routes generated by this OSPF process. When OSPF routes are imported into BGP, the domain ID is added to the BGP VPN routes and forwarded as the BGP extended community attribute.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=route-tag"><b><span class="cmdname">route-tag</span></b></a> <i><span class="varname">tag</span></i></span><p><p>The VPN route tag is configured.</p>
</p><p><ul><li>If a BGP process is not started on the local device, the default VPN route tag is 0.</li><li>If a BGP process is started on the local device, the default VPN route tag is 3489660928 (0xD000 in the hexadecimal format) plus the local AS number of BGP.</li></ul>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=import-route"><b><span class="cmdname">import-route</span></b></a> <strong><span>bgp</span></strong> [ <strong><span>cost</span></strong> <i><span class="varname">cost</span></i> | <strong><span>route-policy</span></strong> <i><span class="varname">route-policy-name</span></i> | <strong><span>tag</span></strong> <i><span class="varname">tag</span></i> | <strong><span>type</span></strong> <i><span class="varname">type</span></i> ] <sup>*</sup></span><p><p>BGP routes are imported.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=area"><b><span class="cmdname">area</span></b></a> <i><span class="varname">area-id</span></i></span><p><p>The OSPF area view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=network"><b><span class="cmdname">network</span></b></a> <i><span class="varname">address</span></i> <i><span class="varname">wildcard-mask</span></i></span><p><p>OSPF is enabled on the network segment where the interface bound to the VPN instance resides.</p>
<p>A network segment belongs to only one area. The area to which each OSPF interface belongs must be specified.</p>
<p>OSPF can run on an interface properly only when the following conditions are met:</p>
<ul><li><p>The mask length of the IP address of the interface is longer than or equal to that specified in the <a href="cmdqueryname=network"><b><span class="cmdname">network</span></b></a> command.</p>
</li><li><p>The primary IP address of the interface is on the network segment specified in the <a href="cmdqueryname=network"><b><span class="cmdname">network</span></b></a> command.</p>
</li></ul>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>The OSPF view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Return to the system view.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ipv4-family"><b><span class="cmdname">ipv4-family</span></b></a> <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i></span><p><p>The BGP-VPN instance IPv4 address family view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=import-route"><b><span class="cmdname">import-route</span></b></a> <strong><span>ospf</span></strong> <i><span class="varname">process-id</span></i> [ <strong><span>med</span></strong> <i><span class="varname">med</span></i> | <strong><span>route-policy</span></strong> <i><span class="varname">route-policy-name</span></i> ] <sup>*</sup></span><p><p>OSPF routes are imported into the VRF table of the BGP-VPN instance IPv4 address family.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
<p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Deleting a VPN instance or disabling a VPN instance IPv4 address family will delete all the OSPF processes bound to the VPN instance or the VPN instance IPv4 address family on the PE.</p>
</div></div>
</p></li><li id="EN-US_TASK_0000001270193545__step_dc_vrp_cfg_ngmvpn_002506"><span id="EN-US_TASK_0000001270193545__">Configure IS-IS between a PE and a CE.</span><p><p>Perform the following steps on the PE:</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Configuring IS-IS on the CE is not described here. For details about how to configure IS-IS, see "IS-IS Configuration" in the <em><a href="dc_vrp_isis_cfg_0000.html"><span class="keyword">HUAWEI NE40E-M2 series</span><span class="keyword">Universal Service Router</span> Configuration Guide - IP Routing</a></em>.</p>
</div></div>
</p><ol><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=isis"><b><span class="cmdname">isis</span></b></a> <i><span class="varname">process-id</span></i> <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i></span><p><p>An IS-IS process is created on the PE, and the IS-IS view is displayed.</p>
<p>An IS-IS process can be bound to only one VPN instance. If an IS-IS process is not bound to any VPN instance before it is started, this process becomes a public network process and cannot be bound to a VPN instance later.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=network-entity"><b><span class="cmdname">network-entity</span></b></a> <i><span class="varname">net-addr</span></i></span><p><p>The network entity title (NET) is configured.</p>
<p>A NET specifies the current IS-IS area address and the system ID of the <span class="keyword">router</span>.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=is-level"><b><span class="cmdname">is-level</span></b></a> { <strong><span>level-1</span></strong> | <strong><span>level-1-2</span></strong> | <strong><span>level-2</span></strong> }</span><p><p>The IS-IS level of the <span class="keyword">router</span> is specified.</p>
<p>Configure the device level based on the network planning. If no device level is configured, IS-IS establishes separate neighbor relationships for Level-1 and Level-2 devices and maintains two identical LSDBs, consuming excessive system resources.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=import-route"><b><span class="cmdname">import-route</span></b></a> <strong><span>bgp</span></strong> [ <strong><span>cost-type</span></strong> { <strong><span>external</span></strong> | <strong><span>internal</span></strong> } | <strong><span>cost</span></strong> <i><span class="varname">cost</span></i> | <strong><span>tag</span></strong> <i><span class="varname">tag</span></i> | <strong><span>route-policy</span></strong> <i><span class="varname">route-policy-name</span></i> | [ <strong><span>level-1</span></strong> | <strong><span>level-2</span></strong> | <strong><span>level-1-2</span></strong> ] ] <sup>*</sup></span><p><p>BGP routes are imported.</p>
<p>If the IS-IS level is not specified in the command, BGP routes will be imported into the Level-2 IS-IS routing table.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Return to the system view.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=interface"><b><span class="cmdname">interface</span></b></a> <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i></span><p><p>The view of the interface bound to the VPN instance is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=isis+enable"><b><span class="cmdname">isis enable</span></b></a> [ <i><span class="varname">process-id</span></i> ]</span><p><p>IS-IS is enabled on the interface.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Return to the system view.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ipv4-family"><b><span class="cmdname">ipv4-family</span></b></a> <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i></span><p><p>The BGP-VPN instance IPv4 address family view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=import-route"><b><span class="cmdname">import-route</span></b></a> <strong><span>isis</span></strong> <i><span class="varname">process-id</span></i> [ <strong><span>med</span></strong> <i><span class="varname">med</span></i> | <strong><span>route-policy</span></strong> <i><span class="varname">route-policy-name</span></i> ] <sup>*</sup></span><p><p>IS-IS routes are imported into the VRF table of the BGP-VPN instance IPv4 address family.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
<p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Deleting a VPN instance or disabling a VPN instance IPv4 address family will delete all the IS-IS processes bound to the VPN instance or the VPN instance IPv4 address family on the PE.</p>
</div></div>
</p></li><li id="EN-US_TASK_0000001270193545__step_dc_vrp_cfg_ngmvpn_002507"><span id="EN-US_TASK_0000001270193545__">Configure a direct route between a PE and a CE.</span><p><p>A direct route can be configured between a PE and a CE only if the CE is a host and connected to the PE using a VLANIF interface. Note that the direct route only needs to be configured on the PE.</p>
<p>Perform the following steps on the PE:</p>
</p><ol><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ip+vpn-instance"><b><span class="cmdname">ip vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i></span><p><p>The VPN instance view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ipv4-family"><b><span class="cmdname">ipv4-family</span></b></a></span><p><p>The VPN instance IPv4 address family view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=arp+vlink-direct-route+advertise"><b><span class="cmdname">arp vlink-direct-route advertise</span></b></a> [ <strong><span>route-policy</span></strong> <i><span class="varname">route-policy-name</span></i><span> | <strong><span>route-filter</span></strong> <i><span class="varname">route-filter-name</span></i></span> ]</span><p><p>ARP Vlink direct routes are advertised.</p>
<p>After the parameter <strong>route-policy</strong><em> route-policy-name</em><span> or <strong><span>route-filter</span></strong> <i><span class="varname">route-filter-name</span></i></span> is specified in the <a href="cmdqueryname=arp+vlink-direct-route+advertise"><b><span class="cmdname">arp vlink-direct-route advertise</span></b></a> command, only filtered ARP Vlink direct routes are advertised.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Return to the VPN instance view.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Return to the system view.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ipv4-family"><b><span class="cmdname">ipv4-family</span></b></a> <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i></span><p><p>The BGP-VPN instance IPv4 address family view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=import-route"><b><span class="cmdname">import-route</span></b></a> <strong><span>direct</span></strong> [ <strong><span>med</span></strong> <i><span class="varname">med</span></i> | <strong><span>route-policy</span></strong> <i><span class="varname">route-policy-name</span></i> ] <sup>*</sup></span><p><p>The direct route to the local CE is imported.</p>
<p>After the direct route to the local CE is imported to the VPN routing table, the local PE use MP-BGP to advertise the direct route to the remote PE. This allows the remote CE to access the local CE.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li></ul></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_ngmvpn_0024.html">Configuring Inter-AS NG MVPN Option B
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_ngmvpn_0034.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>
</body>
</html>