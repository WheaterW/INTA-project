
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Enabling a Device to Select the Highest IP Address as the UMH on an NG MVPN">
<meta name="abstract" content="This section provides an example for enabling a device to select the highest IP address as the UMH on an NG MVPN.">
<meta name="description" content="This section provides an example for enabling a device to select the highest IP address as the UMH on an NG MVPN.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_ngmvpn_0012.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_ngmvpn_0125.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="z00603461,w00606909,w00447999">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="IPv4 Multicast VPN_NG MVPN">
<meta name="featuretype" content="IP Multicast">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="IPv4 Multicast VPN_NG MVPN">
<meta name="featuretype" content="IP Multicast">
<meta name="featurename" content="IPv4 Multicast VPN_NG MVPN">
<meta name="featuretype" content="IP Multicast">
<meta name="featurename" content="IPv4 Multicast VPN_NG MVPN">
<meta name="featuretype" content="IP Multicast">
<meta name="OWNER" content="w00447999">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="w00447999">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001270433385">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/thickbox.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/imageResize.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery-migrate-1.2.1.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery-ui.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery.mousewheel.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/thickbox.js"></script>
<title>Example for Enabling a Device to Select the Highest IP Address as the UMH on an NG MVPN</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001270433385"></a><a name="EN-US_TASK_0000001270433385"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Enabling a Device to Select the Highest IP Address as the UMH on an NG MVPN</h1>
<div class="taskbody"><p>This section provides an example for enabling a device to select the highest IP address as the UMH on an NG MVPN.</p>
<div class="context"><a name="EN-US_TASK_0000001270433385__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On an NG MVPN, when multiple sender PEs exist, receiver PEs select routes based on preferred unicast routes by default. On the network shown in <a href="#EN-US_TASK_0000001270433385__fig_dc_vrp_cfg_ngmvpn_001301">Figure 1</a>, PE3 is a receiver PE, whereas PE1 and PE2 are sender PEs. By default, PE3 selects PE3 -&gt; PE1 -&gt; CE1 as the path to the source based on preferred unicast routes. If PE3 is enabled to select the highest IP address as the UMH, the path selected is PE3 -&gt; PE2 -&gt; CE1.</p>
<div class="fignone" id="EN-US_TASK_0000001270433385__fig_dc_vrp_cfg_ngmvpn_001301"><a name="EN-US_TASK_0000001270433385__fig_dc_vrp_cfg_ngmvpn_001301"></a><a name="fig_dc_vrp_cfg_ngmvpn_001301"></a><span class="figcap"><b>Figure 1 </b>Enabling a device to select the highest IP address as the UMH on an NG MVPN</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface1, interface2, and interface3 represent GE <span>0/1/0</span>, GE <span>0/1/1</span>, and GE <span>0/1/2</span>, respectively.</p>
</div></div>
<br><span><img class="imgResize" src="figure/en-us_image_0000001225513772.png" width="526.6800000000001" title="Click to enlarge"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001270433385__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure BGP/MPLS IP VPN to ensure that the unicast VPN is running properly. (In this example, ensure that the source and user can communicate.)</p>
</li><li><p>Enable mLDP on all PEs globally and ensure that the PEs can use mLDP to establish P2MP tunnels.</p>
</li><li><p>Enable all PEs to establish BGP MVPN peer relationships and configure BGP to transmit A-D and C-multicast routes.</p>
</li><li><p>Configure PE1 and PE2 to use mLDP to establish an I-PMSI tunnel so that an mLDP P2MP tunnel is established.</p>
</li><li><p>Configure PIM on the PEs' interfaces bound to a VPN instance and on the CEs' interfaces connected to the PEs so that C-multicast routing entries are generated for multicast traffic forwarding.</p>
</li><li><p>Enable PE3 to select the highest IP address as the UMH in the VPN instance IPv4 address family MVPN view.</p>
</li><li><p>Configure IGMP on the interfaces connecting a multicast device to a user network segment to allow the device to manage multicast group members on the network segment.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001270433385__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>Public network OSPF process ID: 1; area ID: 0</p>
</li><li><p>VPN instance name on PE1, PE2, and PE3: VPNA, and data shown in <a href="#EN-US_TASK_0000001270433385__fig_dc_vrp_cfg_ngmvpn_001301">Figure 1</a></p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001270433385__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure BGP/MPLS IP VPN.</span><ol type="a"><li class="substepexpand"><span>Assign an IP address to each interface of devices on the VPN backbone network and VPN sites.</span><p><p>Configure an IP address for each interface according to <a href="#EN-US_TASK_0000001270433385__fig_dc_vrp_cfg_ngmvpn_001301">Figure 1</a>. For configuration details, see <a href="#EN-US_TASK_0000001270433385__example_dc_vrp_cfg_ngmvpn_001301">Configuration Files</a> in this section.</p>
</p></li><li class="substepexpand"><span>Configure an IGP for interworking on the BGP/MPLS IP VPN backbone network.</span><p><p>OSPF is used in this example. For configuration details, see <a href="#EN-US_TASK_0000001270433385__example_dc_vrp_cfg_ngmvpn_001301">Configuration Files</a> in this section.</p>
</p></li><li class="substepexpand"><span>Configure basic MPLS functions and MPLS Label Distribution Protocol (LDP) on the backbone network to establish LDP label switch paths (LSPs).</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>mpls lsr-id 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface GigabitEthernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>mpls lsr-id 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface GigabitEthernet<span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>mpls lsr-id 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>interface GigabitEthernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>interface GigabitEthernet<span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/1</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/1</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
</p></li><li class="substepexpand"><span>Establish an MP-IBGP peer relationship between PEs.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 3.3.3.3 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 3.3.3.3 connect-interface LoopBack0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>ipv4-family vpnv4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-vpnv4] <strong>peer 3.3.3.3 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-vpnv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>peer 3.3.3.3 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>peer 3.3.3.3 connect-interface LoopBack0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>ipv4-family vpnv4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-vpnv4] <strong>peer 3.3.3.3 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-vpnv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>peer 2.2.2.2 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>peer 2.2.2.2 connect-interface LoopBack0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>peer 1.1.1.1 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>peer 1.1.1.1 connect-interface LoopBack0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>ipv4-family vpnv4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp-af-vpnv4] <strong>peer 2.2.2.2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp-af-vpnv4] <strong>peer 1.1.1.1 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp-af-vpnv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
</p></li><li class="substepexpand"><span>Configure a VPN instance on each PE so that each CE can access the corresponding PE.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>ip vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4] <strong>route-distinguisher 300:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4] <strong>vpn-target 3:3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface GigabitEthernet<span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>ip binding vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>ip address 10.1.2.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>ip vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA-af-ipv4] <strong>route-distinguisher 300:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA-af-ipv4] <strong>vpn-target 4:4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface GigabitEthernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>ip binding vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>ip address 10.1.3.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>ip vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-VPNA] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-VPNA-af-ipv4] <strong>route-distinguisher 300:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-VPNA-af-ipv4] <strong>vpn-target 3:3 4:4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-VPNA-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>interface GigabitEthernet<span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/2</span>] <strong>ip binding vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/2</span>] <strong>ip address 192.168.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
</p></li><li class="substepexpand"><span>Configure a static route to the source 10.1.5.2 in the VPN instance on each PE, and import the static route to the VPN instance.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>ip route-static vpn-instance VPNA 10.1.5.0 255.255.255.0 10.1.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>ipv4-family vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-VPNA] <strong>import-route static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>ip route-static vpn-instance VPNA 10.1.5.0 255.255.255.0 10.1.3.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>ipv4-family vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-VPNA] <strong>import-route static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>ipv4-family vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp-VPNA] <strong>network 192.168.1.0 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
</p></li><li class="substepexpand"><span>Check the route to the source 10.1.5.2 on PE3.</span><p><p>Run the <a href="cmdqueryname=display+ip+routing-table+vpn-instance+VPNA"><b><span class="cmdname">display ip routing-table vpn-instance VPNA</span></b></a> command on PE3. The command output shows the route to the source network segment.</p>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>display ip routing-table vpn-instance VPNA</strong></pre>
<pre class="screen">Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route
 ------------------------------------------------------------------------------
 Routing Table : VPNA
          Destinations : 8        Routes : 8         

Destination/Mask    Proto   Pre  Cost        Flags NextHop         Interface

       10.1.2.0/24  IBGP    255  0             RD  1.1.1.1         <span>0/1/0</span>
       10.1.3.0/24  IBGP    255  2             RD  2.2.2.2         <span>0/1/1</span>
<strong>     10.1.5.0/24  IBGP   255 3           RD  1.1.1.1       <span>0/1/0</span></strong>
      127.0.0.0/8   Direct  0    0             D   127.0.0.1       InLoopBack0
    192.168.1.0/24  Direct  0    0             D   192.168.1.2     <span>0/1/2</span>
    192.168.1.2/32  Direct  0    0             D   127.0.0.1       <span>0/1/2</span>
  192.168.1.255/32  Direct  0    0             D   127.0.0.1       <span>0/1/2</span>
255.255.255.255/32  Direct  0    0             D   127.0.0.1       InLoopBack0</pre>
</p></li></ol>
</li><li><span>Enable mLDP globally.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp] <strong>mldp p2mp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-mpls-ldp] <strong>quit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-ldp] <strong>mldp p2mp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-ldp] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-mpls-ldp] <strong>quit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-mpls-ldp] <strong>mldp p2mp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-mpls-ldp] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3-mpls-ldp] <strong>quit</strong></pre>
</p></li><li><span>Establish a BGP MVPN peer relationship between the PEs.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>ipv4-family mvpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-mvpn] <strong>peer 3.3.3.3 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-mvpn] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp-af-mvpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp] <strong>quit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>ipv4-family mvpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-mvpn] <strong>peer 3.3.3.3 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-mvpn] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-bgp-af-mvpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-bgp] <strong>quit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>ipv4-family mvpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp-af-mvpn] <strong>peer 1.1.1.1 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp-af-mvpn] <strong>peer 2.2.2.2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp-af-mvpn] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3-bgp-af-mvpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3-bgp] <strong>quit</strong></pre>
<p>After the configuration is complete, run the <a href="cmdqueryname=display+bgp+mvpn+all+peer"><b><span class="cmdname">display bgp mvpn all peer</span></b></a> command on the PEs. The command output shows that PE1 has established a BGP MVPN peer relationship with PE2 and PE3. The following example uses the command output on PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>display bgp mvpn all peer</strong></pre>
<pre class="screen"> BGP local router ID : 3.3.3.3
 Local AS number : 100
 Total number of peers : 2                 Peers in established state : 2

  Peer            V          AS  MsgRcvd  MsgSent  OutQ  Up/Down       State  PrefRcv
<strong> 1.1.1.1        4        100    87     89     0 01:10:28   Established        0  </strong>
<strong> 2.2.2.2        4        100    87     88     0 01:09:36   Established        0</strong></pre>
</p></li><li><span>Configure the device to use mLDP to establish an I-PMSI tunnel.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>multicast mvpn 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>ip vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4] <strong>multicast routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4] <strong>mvpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4-mvpn] <strong>sender-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4-mvpn] <strong>c-multicast signaling bgp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4-mvpn] <strong>rpt-spt mode</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4-mvpn] <strong>ipmsi-tunnel</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4-mvpn-ipmsi] <strong>mldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4-mvpn-ipmsi] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4-mvpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>multicast mvpn 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>ip vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA-af-ipv4] <strong>multicast routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA-af-ipv4] <strong>mvpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA-af-ipv4-mvpn] <strong>sender-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA-af-ipv4-mvpn] <strong>c-multicast signaling bgp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA-af-ipv4-mvpn] <strong>rpt-spt mode</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA-af-ipv4-mvpn] <strong>ipmsi-tunnel</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA-af-ipv4-mvpn-ipmsi] <strong>mldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA-af-ipv4-mvpn-ipmsi] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA-af-ipv4-mvpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>multicast mvpn 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>ip vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-VPNA] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-VPNA-af-ipv4] <strong>multicast routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-VPNA-af-ipv4] <strong>mvpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-VPNA-af-ipv4-mvpn] <strong>c-multicast signaling bgp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-VPNA-af-ipv4-mvpn] <strong>rpt-spt mode</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-VPNA-af-ipv4-mvpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-VPNA-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
<p>After the configurations are complete, run the <a href="cmdqueryname=display+mvpn+vpn-instance+ipmsi"><b><span class="cmdname">display mvpn vpn-instance ipmsi</span></b></a> command on the PEs to check I-PMSI tunnel information. The following example uses the command output on PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>display mvpn vpn-instance VPNA ipmsi</strong></pre>
<pre class="screen">MVPN local I-PMSI information for VPN-Instance: VPNA
Tunnel type: mLDP P2MP LSP
Tunnel state: --
Root-ip: 1.1.1.1
Opaque value: 0x01000400008001
<strong>Root: 1.1.1.1 </strong>Leaf:
<strong>  1: 3.3.3.3 (local)</strong>
 
Tunnel type: mLDP P2MP LSP
Tunnel state: --
Root-ip: 2.2.2.2
Opaque value: 0x01000400008001
<strong>Root: 2.2.2.2 Leaf:   1: 3.3.3.3 (local)</strong></pre>
<p>According to the preceding command output, two mLDP P2MP tunnels have been established, with PE1 and PE2 as their root nodes and PE3 as a leaf node.</p>
</p></li><li><span>Configure PIM.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface GigabitEthernet<span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface GigabitEthernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>interface GigabitEthernet<span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/2</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
<p># Configure CE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>multicast routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>interface GigabitEthernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>interface GigabitEthernet<span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/1</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>interface GigabitEthernet<span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/2</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>commit</strong></pre>
</p></li><li><span>Enable PE3 to select the highest IP address as the UMH in the VPN instance IPv4 address family MVPN view.</span><p><pre class="screen">[<span class="keyword">*</span>PE3] <strong>ip vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-VPNA] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-VPNA-af-ipv4] <strong>mvpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-VPNA-af-ipv4-mvpn] <strong>umh-select highest-ip</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-VPNA-af-ipv4-mvpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-VPNA-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-VPNA] <strong>quit</strong></pre>
</p></li><li><span>Configure IGMP and set the IGMP version to IGMPv3.</span><p><p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>interface GigabitEthernet<span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/2</span>] <strong>igmp enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/2</span>] <strong>igmp version 3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/2</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p>After the preceding configurations are complete, run the <a href="cmdqueryname=display+ip+routing-table+vpn-instance+VPNA"><b><span class="cmdname">display ip routing-table vpn-instance VPNA</span></b></a> command on PE3. The command output shows that the next hop of the optimal unicast path is PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>display ip routing-table vpn-instance VPNA</strong></pre>
<pre class="screen">Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route
 ------------------------------------------------------------------------------
 Routing Table : VPNA
          Destinations : 8        Routes : 8         

Destination/Mask    Proto   Pre  Cost        Flags NextHop         Interface

       10.1.2.0/24  IBGP    255  0             RD  1.1.1.1         <span>0/1/0</span>
       10.1.3.0/24  IBGP    255  2             RD  2.2.2.2         <span>0/1/1</span>
<strong>     10.1.5.0/24  IBGP   255 3           RD 1.1.1.1        <span>0/1/0</span></strong>
      127.0.0.0/8   Direct  0    0             D   127.0.0.1       InLoopBack0
    192.168.1.0/24  Direct  0    0             D   192.168.1.2     <span>0/1/2</span>
    192.168.1.2/32  Direct  0    0             D   127.0.0.1       <span>0/1/2</span>
  192.168.1.255/32  Direct  0    0             D   127.0.0.1       <span>0/1/2</span>
255.255.255.255/32  Direct  0    0             D   127.0.0.1       InLoopBack0</pre>
<p>Run the <a href="cmdqueryname=display+pim+vpn-instance+VPNA+routing-table"><b><span class="cmdname">display pim vpn-instance VPNA routing-table</span></b></a> command on PE3. The command output shows that the UMH of the route selected based on the highest IP address is PE2. When the source sends multicast traffic to the source group, user1 can receive the multicast traffic and the traffic travels along the path PE3 -&gt; PE2 -&gt; CE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>display pim vpn-instance VPNA routing-table</strong></pre>
<pre class="screen"> VPN-Instance: VPNA
 Total 0 (*, G) entry; 1 (S, G) entry
 
 (10.1.5.2, 224.1.1.1)
     RP: NULL
     Protocol: pim-sm, Flag: SPT SG_RCVR 
     UpTime: 00:22:17
     Upstream interface: through-BGP, Refresh time: 00:22:17
         <strong>Upstream neighbor: 2.2.2.2</strong>
         <strong>RPF prime neighbor: 2.2.2.2</strong>
     Downstream interface(s) information:
     Total number of downstreams: 1
        1: <span>0/1/2</span>
             Protocol: static, UpTime: 00:22:17, Expires: -</pre>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0000001270433385__example_dc_vrp_cfg_ngmvpn_001301"><a name="EN-US_TASK_0000001270433385__example_dc_vrp_cfg_ngmvpn_001301"></a><a name="example_dc_vrp_cfg_ngmvpn_001301"></a><a name="EN-US_TASK_0000001270433385__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>CE1 configuration file</p>
<pre class="screen">#
sysname CE1
multicast routing-enable
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.2.2 255.255.255.0
 pim sm
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ip address 10.1.5.1 255.255.255.0
 pim sm
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 10.1.3.2 255.255.255.0
 pim sm
#
return
</pre>
</li><li>PE1 configuration file<pre class="screen">#
sysname PE1
#
multicast mvpn 1.1.1.1
#
ip vpn-instance VPNA
 ipv4-family
  route-distinguisher 300:1
  apply-label per-instance
  vpn-target 3:3 export-extcommunity
  vpn-target 3:3 import-extcommunity
  multicast routing-enable
  mvpn
   sender-enable
   c-multicast signaling bgp
   rpt-spt mode
   ipmsi-tunnel 
    mldp
#
mpls lsr-id 1.1.1.1
#
mpls
#
mldp-p2mp-tunnel p2mp-lsp
#
mpls ldp
 #
 ipv4-family
#
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip binding vpn-instance VPNA
 ip address 10.1.2.1 255.255.255.0
 pim sm
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.1.1 255.255.255.0
 mpls
 mpls ldp
#               
interface LoopBack0
 ip address 1.1.1.1 255.255.255.255
#
ip route-static vpn-instance VPNA 10.1.5.0 255.255.255.0 10.1.2.2
#
bgp 100
 peer 3.3.3.3 as-number 100
 peer 3.3.3.3 connect-interface LoopBack0
 #
 ipv4-family unicast
  undo synchronization
  peer 3.3.3.3 enable
 #
 ipv4-family mvpn
  policy vpn-target
  peer 3.3.3.3 enable
 #
 ipv4-family vpnv4
  policy vpn-target
  peer 3.3.3.3 enable
 #
 ipv4-family vpn-instance VPNA
  import-route direct
  import-route static
#
ospf 1
 area 0.0.0.0
  network 1.1.1.1 0.0.0.0
  network 10.1.1.0 0.0.0.255
#
return
</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#
sysname PE2
#
multicast mvpn 2.2.2.2
#
ip vpn-instance VPNA
 ipv4-family
  route-distinguisher 300:1
  apply-label per-instance
  vpn-target 4:4 export-extcommunity
  vpn-target 4:4 import-extcommunity
  multicast routing-enable
  mvpn
   sender-enable
   c-multicast signaling bgp
   rpt-spt mode
   ipmsi-tunnel 
    mldp
#
mpls lsr-id 2.2.2.2
#
mpls
#
mldp-p2mp-tunnel p2mp-lsp
#
mpls ldp
 #
 ipv4-family
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 10.1.4.1 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip binding vpn-instance VPNA
 ip address 10.1.3.1 255.255.255.0
 pim sm
#
interface LoopBack0
 ip address 2.2.2.2 255.255.255.255
#
ip route-static vpn-instance VPNA 10.1.5.0 255.255.255.0 10.1.3.2
#
bgp 100         
 peer 3.3.3.3 as-number 100
 peer 3.3.3.3 connect-interface LoopBack0
 #
 ipv4-family unicast
  undo synchronization
  peer 3.3.3.3 enable
 #
 ipv4-family mvpn
  policy vpn-target
  peer 3.3.3.3 enable
 #
 ipv4-family vpnv4
  policy vpn-target
  peer 3.3.3.3 enable
 #
 ipv4-family vpn-instance VPNA
  import-route direct
  import-route static
#
ospf 1
 area 0.0.0.0
  network 2.2.2.2 0.0.0.0
  network 10.1.4.0 0.0.0.255
#
return
</pre>
</li><li><p>PE3 configuration file</p>
<pre class="screen">#
 sysname PE3
#
multicast mvpn 3.3.3.3
#
ip vpn-instance VPNA
 ipv4-family
  route-distinguisher 300:1
  apply-label per-instance
  vpn-target 3:3 export-extcommunity
  vpn-target 4:4 export-extcommunity
  vpn-target 3:3 import-extcommunity
  vpn-target 4:4 import-extcommunity
  multicast routing-enable
  mvpn
   c-multicast signaling bgp
   rpt-spt mode 
   umh-select highest-ip
#
mpls lsr-id 3.3.3.3
#
mpls
#
mpls ldp
 mldp p2mp
 #
 ipv4-family
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 10.1.4.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.1.2 255.255.255.0
 mpls           
 mpls ldp
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ip binding vpn-instance VPNA
 ip address 192.168.1.2 255.255.255.0
 pim sm
 igmp enable
 igmp version 3
 igmp static-group 224.1.1.1 source 10.1.5.2
#
interface LoopBack0
 ip address 3.3.3.3 255.255.255.255
#
bgp 100
 peer 1.1.1.1 as-number 100
 peer 1.1.1.1 connect-interface LoopBack0
 peer 2.2.2.2 as-number 100
 peer 2.2.2.2 connect-interface LoopBack0
 #
 ipv4-family unicast
  undo synchronization
  peer 1.1.1.1 enable
  peer 2.2.2.2 enable
 #
 ipv4-family mvpn
  policy vpn-target
  peer 1.1.1.1 enable
  peer 2.2.2.2 enable
 #
 ipv4-family vpnv4
  policy vpn-target
  peer 1.1.1.1 enable
  peer 2.2.2.2 enable
 #
 ipv4-family vpn-instance VPNA
  network 192.168.1.0 255.255.255.0
#
ospf 1
 area 0.0.0.0
  network 3.3.3.3 0.0.0.0
  network 10.1.1.0 0.0.0.255
  network 10.1.4.0 0.0.0.255
#
return
</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_ngmvpn_0012.html">Configuration Examples for NG MVPN
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_ngmvpn_0125.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>

<script language="JavaScript">
<!--
image_size('.imgResize');
var msg_imageMax = "view original image";
var msg_imageClose = "close";
//--></script></body>
</html>