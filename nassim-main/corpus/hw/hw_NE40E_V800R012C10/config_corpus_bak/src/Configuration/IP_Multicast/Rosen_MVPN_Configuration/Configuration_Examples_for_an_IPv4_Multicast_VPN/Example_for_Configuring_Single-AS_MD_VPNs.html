
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Single-AS MD VPNs">
<meta name="abstract" content="This section provides an example for configuring single-AS multicast domain (MD) VPN on an MPLS/BGP network to enable the transmission of multicast data of private networks over a public network to receivers.">
<meta name="description" content="This section provides an example for configuring single-AS multicast domain (MD) VPN on an MPLS/BGP network to enable the transmission of multicast data of private networks over a public network to receivers.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_multicast_cfg_2133.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_multicast_cfg_2275.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="z00603461,w00606909,w00447999">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="IPv4 Multicast VPN_Rosen">
<meta name="featuretype" content="IP Multicast">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="IPv4 Multicast VPN_Rosen">
<meta name="featuretype" content="IP Multicast">
<meta name="featurename" content="IPv4 Multicast VPN_Rosen">
<meta name="featuretype" content="IP Multicast">
<meta name="featurename" content="IPv4 Multicast VPN_Rosen">
<meta name="featuretype" content="IP Multicast">
<meta name="OWNER" content="w00447999">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="w00447999">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001225672704">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>Example for Configuring Single-AS MD VPNs</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001225672704"></a><a name="EN-US_TASK_0000001225672704"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Single-AS MD VPNs</h1>
<div class="taskbody"><p>This section provides an example for configuring single-AS multicast domain (MD) VPN on an MPLS/BGP network to enable the transmission of multicast data of private networks over a public network to receivers.</p>
<div class="context"><a name="EN-US_TASK_0000001225672704__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>In the single-AS MPLS/BGP VPN shown in <a href="#EN-US_TASK_0000001225672704__fig66771216144217">Figure 1</a>, configure MD to deploy multicast services.</p>
<div class="fignone" id="EN-US_TASK_0000001225672704__fig66771216144217"><a name="EN-US_TASK_0000001225672704__fig66771216144217"></a><a name="fig66771216144217"></a><span class="figcap"><b>Figure 1 </b>Configuring single-AS MD VPNs</span><br><span><img class="vsd" src="figure/en-us_image_0000001225352876.png"></span></div>
<p>The networking requirements are described in <a href="#EN-US_TASK_0000001225672704__tab_dc_vrp_multicast_cfg_213401">Table 1</a>:</p>

<div class="tableBorder"><a name="EN-US_TASK_0000001225672704__tab_dc_vrp_multicast_cfg_213401"></a><a name="tab_dc_vrp_multicast_cfg_213401"></a><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" id="EN-US_TASK_0000001225672704__tab_dc_vrp_multicast_cfg_213401" frame="border" border="1" rules="all"><caption><b>Table 1 </b>Networking requirements of single-AS MD VPNs</caption><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="23.72%" id="mcps1.4.1.5.2.3.1.1" liSelected="liSelected"><p>Item</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="76.28%" id="mcps1.4.1.5.2.3.1.2" liSelected="liSelected"><p>Networking Requirements</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" valign="top" width="23.72%" headers="mcps1.4.1.5.2.3.1.1 "><p>Multicast source/receiver</p>
</td>
<td class="cellrowborder" valign="top" width="76.28%" headers="mcps1.4.1.5.2.3.1.2 "><p>The multicast source of VPN RED is Source 1. The receivers include PC1, PC2, and PC3. The multicast source of VPN BLUE is Source 2. The receiver is PC4. In the VPN RED, the Share-Group address is 239.1.1.1 and Switch-Group pool address ranges from 225.2.2.1 to 225.2.2.16. In the VPN BLUE, the Share-Group address is 239.2.2.2 and Switch-Group pool address ranges from 225.4.4.1 to 225.4.4.16.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="23.72%" headers="mcps1.4.1.5.2.3.1.1 "><p>VPN instance to which the interfaces on PEs belong</p>
</td>
<td class="cellrowborder" valign="top" width="76.28%" headers="mcps1.4.1.5.2.3.1.2 "><p>On PE-A, GE2 and GE3 belong to VPN-RED, and GE1 and Loopback1 belong to the public network instance. On PE-B, GE2 belongs to VPN-BLUE, GE3 belongs to VPN-RED, and GE1 and Loopback1 belong to the public network instance. On PE-C, GE2 belongs to VPN-RED, GE3 and Loopback2 belong to VPN-BLUE, and GE1 and Loopback1 belong to the public network instance.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="23.72%" headers="mcps1.4.1.5.2.3.1.1 "><p>Routing protocol and MPLS</p>
</td>
<td class="cellrowborder" valign="top" width="76.28%" headers="mcps1.4.1.5.2.3.1.2 "><p>Configure Open Shortest Path First (OSPF) on the public network. Enable the Routing Information Protocol (RIP) on PE and CE devices. Establish BGP peer relationships and transmit all private network routes between Loopback1 interfaces on PE-A, PE-B, and PE-C. Enable MPLS forwarding on the public network.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="23.72%" headers="mcps1.4.1.5.2.3.1.1 "><p>Multicast function</p>
</td>
<td class="cellrowborder" valign="top" width="76.28%" headers="mcps1.4.1.5.2.3.1.2 "><p>Enable multicast on the P. Enable multicast on the public network instance on PE-A, PE-B, and PE-C. Enable multicast on the VPN-RED on PE-A, PE-B, and PE-C. Enable multicast on the VPN-BLUE on PE-B and PE-C. Enable multicast on CE-Ra, CE-Rb, CE-Rc, CE-Bb, and CE-Bc.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="23.72%" headers="mcps1.4.1.5.2.3.1.1 "><p>IGMP function</p>
</td>
<td class="cellrowborder" valign="top" width="76.28%" headers="mcps1.4.1.5.2.3.1.2 "><p>Enable the Internet Group Management Protocol (IGMP) on GE2 of PE-A. Enable IGMP on GE1 interfaces of CE-Rb, CE-Rc, and CE-Bc.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="23.72%" headers="mcps1.4.1.5.2.3.1.1 "><p>PIM function</p>
</td>
<td class="cellrowborder" valign="top" width="76.28%" headers="mcps1.4.1.5.2.3.1.2 "><p>Enable PIM-SM on all the VPN interfaces in VPN-RED. Enable PIM-SM on all the VPN interfaces in VPN-BLUE. Enable PIM-SM on all the interfaces of the P and CEs, and the public network interfaces of PEs. Configure Loopback1 on the P as the Candidate-BootStrap Router (C-BSR) and Candidate-Rendezvous Point (C-RP) of the public network (serving all multicast groups). Configure Loopback1 on CE-Rb as the C-BSR and C-RP of VPN-RED (serving all multicast groups). Configure Loopback2 on PE-C as the C-BSR and C-RP of VPN-BLUE (serving all multicast groups).</p>
</td>
</tr>
</tbody>
</table>
</div>
<p><a href="#EN-US_TASK_0000001225672704__tab_dc_vrp_multicast_cfg_213402">Table 2</a> lists the IP addresses planned for the interfaces shown in <a href="#EN-US_TASK_0000001225672704__fig66771216144217">Figure 1</a> based on the networking requirements.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>GE1, GE2, and GE3 represent GigabitEthernet <span>0/1/0</span>, GigabitEthernet <span>0/1/1</span>, and GigabitEthernet <span>0/1/2</span>, respectively.</p>
</div></div>

<div class="tableBorder"><a name="EN-US_TASK_0000001225672704__tab_dc_vrp_multicast_cfg_213402"></a><a name="tab_dc_vrp_multicast_cfg_213402"></a><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" id="EN-US_TASK_0000001225672704__tab_dc_vrp_multicast_cfg_213402" frame="border" border="1" rules="all"><caption><b>Table 2 </b>Configuration information about interfaces on the <span class="keyword">device</span>s</caption><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="14.13141314131413%" id="mcps1.4.1.8.2.4.1.1" liSelected="liSelected"><p>Device</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="39.54395439543954%" id="mcps1.4.1.8.2.4.1.2" liSelected="liSelected"><p>Interface IP Address</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="46.324632463246324%" id="mcps1.4.1.8.2.4.1.3" liSelected="liSelected"><p>Remarks</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" rowspan="4" valign="top" width="14.13141314131413%" headers="mcps1.4.1.8.2.4.1.1 "><p>P</p>
</td>
<td class="cellrowborder" valign="top" width="39.54395439543954%" headers="mcps1.4.1.8.2.4.1.2 "><p>GE1: 192.168.6.2/24</p>
</td>
<td class="cellrowborder" valign="top" width="46.324632463246324%" headers="mcps1.4.1.8.2.4.1.3 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.8.2.4.1.2 "><p>GE2: 192.168.7.2/24</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.8.2.4.1.3 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.8.2.4.1.2 "><p>GE3: 192.168.8.2/24</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.8.2.4.1.3 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.8.2.4.1.2 "><p>Loopback 1: 2.2.2.2/32</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.8.2.4.1.3 "><p>Loopback1 functions as a C-RP on the public network.</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="4" valign="top" width="14.13141314131413%" headers="mcps1.4.1.8.2.4.1.1 "><p>PE-A</p>
</td>
<td class="cellrowborder" valign="top" width="39.54395439543954%" headers="mcps1.4.1.8.2.4.1.2 "><p>GE1: 192.168.6.1/24</p>
</td>
<td class="cellrowborder" valign="top" width="46.324632463246324%" headers="mcps1.4.1.8.2.4.1.3 "><p>GE1 belongs to the public network instance.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.8.2.4.1.2 "><p>GE2: 10.110.1.1/24</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.8.2.4.1.3 "><p>GE2 belongs to the VPN-RED instance.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.8.2.4.1.2 "><p>GE3: 10.110.2.1/24</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.8.2.4.1.3 "><p>GE3 belongs to the VPN-RED instance.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.8.2.4.1.2 "><p>Loopback 1: 1.1.1.1/32</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.8.2.4.1.3 "><p>Loopback1 belongs to the public network instance.</p>
<p>Internal Border Gateway Protocol (IBGP) peer relationships are set up among Loopback 1 interfaces of PE-A, PE-B, and PE-C.</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="4" valign="top" width="14.13141314131413%" headers="mcps1.4.1.8.2.4.1.1 "><p>PE-B</p>
</td>
<td class="cellrowborder" valign="top" width="39.54395439543954%" headers="mcps1.4.1.8.2.4.1.2 "><p>GE1: 192.168.7.1/24</p>
</td>
<td class="cellrowborder" valign="top" width="46.324632463246324%" headers="mcps1.4.1.8.2.4.1.3 "><p>GE1 belongs to the public network instance.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.8.2.4.1.2 "><p>GE2: 10.110.3.1/24</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.8.2.4.1.3 "><p>GE2 belongs to the VPN-BLUE instance.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.8.2.4.1.2 "><p>GE3: 10.110.4.1/24</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.8.2.4.1.3 "><p>GE3 belongs to the VPN-RED instance.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.8.2.4.1.2 "><p>Loopback 1: 1.1.1.2/32</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.8.2.4.1.3 "><p>Loopback1 belongs to the public network instance.</p>
<p>IBGP peer relationships are set up among Loopback 1 interfaces of PE-A, PE-B, and PE-C.</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="5" valign="top" width="14.13141314131413%" headers="mcps1.4.1.8.2.4.1.1 "><p>PE-C</p>
</td>
<td class="cellrowborder" valign="top" width="39.54395439543954%" headers="mcps1.4.1.8.2.4.1.2 "><p>GE1: 192.168.8.1/24</p>
</td>
<td class="cellrowborder" valign="top" width="46.324632463246324%" headers="mcps1.4.1.8.2.4.1.3 "><p>GE1 belongs to the public network instance.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.8.2.4.1.2 "><p>GE2: 10.110.5.1/24</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.8.2.4.1.3 "><p>GE2 belongs to the VPN-RED instance.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.8.2.4.1.2 "><p>GE3: 10.110.6.1/24</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.8.2.4.1.3 "><p>GE3 belongs to the VPN-BLUE instance.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.8.2.4.1.2 "><p>Loopback1: 1.1.1.3/32</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.8.2.4.1.3 "><p>Loopback1 belongs to the public network instance.</p>
<p>IBGP peer relationships are set up among Loopback 1 interfaces of PE-A, PE-B, and PE-C.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.8.2.4.1.2 "><p>Loopback 2: 9.9.9.9/32</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.8.2.4.1.3 "><p>Loopback2 belongs to VPN-BLUE and functions as a VPN C-RP.</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="2" valign="top" width="14.13141314131413%" headers="mcps1.4.1.8.2.4.1.1 "><p>CE-Ra</p>
</td>
<td class="cellrowborder" valign="top" width="39.54395439543954%" headers="mcps1.4.1.8.2.4.1.2 "><p>GE1: 10.110.7.1/24</p>
</td>
<td class="cellrowborder" valign="top" width="46.324632463246324%" headers="mcps1.4.1.8.2.4.1.3 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.8.2.4.1.2 "><p>GE2: 10.110.2.2/24</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.8.2.4.1.3 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="3" valign="top" width="14.13141314131413%" headers="mcps1.4.1.8.2.4.1.1 "><p>CE-Bb</p>
</td>
<td class="cellrowborder" valign="top" width="39.54395439543954%" headers="mcps1.4.1.8.2.4.1.2 "><p>GE1: 10.110.8.1/24</p>
</td>
<td class="cellrowborder" valign="top" width="46.324632463246324%" headers="mcps1.4.1.8.2.4.1.3 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.8.2.4.1.2 "><p>GE2: 10.110.3.2/24</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.8.2.4.1.3 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.8.2.4.1.2 "><p>Loopback 2: 8.8.8.8/32</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.8.2.4.1.3 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="4" valign="top" width="14.13141314131413%" headers="mcps1.4.1.8.2.4.1.1 "><p>CE-Rb</p>
</td>
<td class="cellrowborder" valign="top" width="39.54395439543954%" headers="mcps1.4.1.8.2.4.1.2 "><p>GE1: 10.110.9.1/24</p>
</td>
<td class="cellrowborder" valign="top" width="46.324632463246324%" headers="mcps1.4.1.8.2.4.1.3 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.8.2.4.1.2 "><p>GE2: 10.110.4.2/24</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.8.2.4.1.3 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.8.2.4.1.2 "><p>GE3: 10.110.12.1/24</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.8.2.4.1.3 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.8.2.4.1.2 "><p>Loopback 1: 7.7.7.7/32</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.8.2.4.1.3 "><p>Loopback1 belongs to VPN-RED and functions as a VPN C-RP.</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="3" valign="top" width="14.13141314131413%" headers="mcps1.4.1.8.2.4.1.1 "><p>CE-Rc</p>
</td>
<td class="cellrowborder" valign="top" width="39.54395439543954%" headers="mcps1.4.1.8.2.4.1.2 "><p>GE1: 10.110.10.1/24</p>
</td>
<td class="cellrowborder" valign="top" width="46.324632463246324%" headers="mcps1.4.1.8.2.4.1.3 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.8.2.4.1.2 "><p>GE2: 10.110.5.2/24</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.8.2.4.1.3 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.8.2.4.1.2 "><p>GE3: 10.110.12.2/24</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.8.2.4.1.3 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="2" valign="top" width="14.13141314131413%" headers="mcps1.4.1.8.2.4.1.1 "><p>CE-Bc</p>
<p></p>
</td>
<td class="cellrowborder" valign="top" width="39.54395439543954%" headers="mcps1.4.1.8.2.4.1.2 "><p>GE1: 10.110.11.1/24</p>
</td>
<td class="cellrowborder" valign="top" width="46.324632463246324%" headers="mcps1.4.1.8.2.4.1.3 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.8.2.4.1.2 "><p>GE2: 10.110.6.2/24</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.8.2.4.1.3 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="14.13141314131413%" headers="mcps1.4.1.8.2.4.1.1 "><p>Source 1</p>
</td>
<td class="cellrowborder" valign="top" width="39.54395439543954%" headers="mcps1.4.1.8.2.4.1.2 "><p>10.110.7.2/24</p>
</td>
<td class="cellrowborder" valign="top" width="46.324632463246324%" headers="mcps1.4.1.8.2.4.1.3 "><p>Multicast source in VPN-RED</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="14.13141314131413%" headers="mcps1.4.1.8.2.4.1.1 "><p>Source 2</p>
</td>
<td class="cellrowborder" valign="top" width="39.54395439543954%" headers="mcps1.4.1.8.2.4.1.2 "><p>10.110.8.2/24</p>
</td>
<td class="cellrowborder" valign="top" width="46.324632463246324%" headers="mcps1.4.1.8.2.4.1.3 "><p>Multicast source in VPN-BLUE</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="14.13141314131413%" headers="mcps1.4.1.8.2.4.1.1 "><p>PC1</p>
</td>
<td class="cellrowborder" valign="top" width="39.54395439543954%" headers="mcps1.4.1.8.2.4.1.2 "><p>10.110.1.2/24</p>
</td>
<td class="cellrowborder" valign="top" width="46.324632463246324%" headers="mcps1.4.1.8.2.4.1.3 "><p>Multicast receiver in VPN-RED</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="14.13141314131413%" headers="mcps1.4.1.8.2.4.1.1 "><p>PC2</p>
</td>
<td class="cellrowborder" valign="top" width="39.54395439543954%" headers="mcps1.4.1.8.2.4.1.2 "><p>10.110.9.2/24</p>
</td>
<td class="cellrowborder" valign="top" width="46.324632463246324%" headers="mcps1.4.1.8.2.4.1.3 "><p>Multicast receiver in VPN-RED</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="14.13141314131413%" headers="mcps1.4.1.8.2.4.1.1 "><p>PC3</p>
</td>
<td class="cellrowborder" valign="top" width="39.54395439543954%" headers="mcps1.4.1.8.2.4.1.2 "><p>10.110.10.2/24</p>
</td>
<td class="cellrowborder" valign="top" width="46.324632463246324%" headers="mcps1.4.1.8.2.4.1.3 "><p>Multicast receiver in VPN-RED</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="14.13141314131413%" headers="mcps1.4.1.8.2.4.1.1 "><p>PC4</p>
</td>
<td class="cellrowborder" valign="top" width="39.54395439543954%" headers="mcps1.4.1.8.2.4.1.2 "><p>10.110.11.2/24</p>
</td>
<td class="cellrowborder" valign="top" width="46.324632463246324%" headers="mcps1.4.1.8.2.4.1.3 "><p>Multicast receiver in VPN-BLUE</p>
</td>
</tr>
</tbody>
</table>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001225672704__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure MPLS/BGP VPN to ensure that the VPN network works properly and unicast routes are reachable.</p>
</li><li><p>Enable multicast routing and PIM on the entire network. Enable public network instance multicast on the PEs and P, and enable VPN instance multicast with the IPv4 address family on PEs and CEs.</p>
</li><li><p>Configure the same share-group address, the same MTI, and the same switch-group-pool range of a switch-MDT for the same VPN instance enabled with the IPv4 address family on each PE. Set the automatic configuration mode for the MTI.</p>
</li></ol>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><div class="p">This example does not involve the following situations:<ul><li>Multicast VPN is not supported on an interface board.</li><li>The current device is an ingress PE, and the VPN inbound interface is a logical interface.</li><li>The current device is an egress PE, and the public network inbound interface is a logical interface.</li></ul>
If any of the preceding situations exists in the actual networking, you need to enable IP multicast VPN to allow multicast traffic to be properly forwarded. For configuration details, see <a href="../ne/dc_ne_mcast_cfg_2001.html">(Optional) Enabling IP Multicast VPN</a>.</div>
</div></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001225672704__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>See <a href="#EN-US_TASK_0000001225672704__fig66771216144217">Figure 1</a>.</p>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001225672704__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure PE-A.</span><p><p># Configure an ID for PE-A, enable public-network IP multicast routing, configure an MPLS LSR-ID, and enable LDP.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname PE-A</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-A]<strong> router id 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-A]<strong> multicast routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-A]<strong> mpls lsr-id 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-A]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-A-mpls]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-A]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-A-mpls-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-A]<strong> commit</strong></pre>
<p># Configure an IP address and enable PIM-SM on Loopback1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-A]<strong> interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-A-LoopBack1]<strong> ip address 1.1.1.1 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-A-LoopBack1]<strong> pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-A-LoopBack1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-A-LoopBack1]<strong> quit</strong></pre>
<p># Create a VPN instance named VPN RED, and enable the IPv4 address family for it. In the VPN instance IPv4 address family view, configure a VPN IPv4 prefix and create import and export VPN targets for the instance. Enable IP multicast routing, configure a share-group, specify an MTI bound to the VPN instance, and set the range of the switch-MDT switch-address-pool. In addition, set the IP address of a specified interface as the default IP address of an MTI.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-A] <strong>ip vpn-instance RED</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-A-vpn-instance-RED]<strong> ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-A-vpn-instance-RED<span>-af-ipv4</span>]<strong> route-distinguisher 100:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-A-vpn-instance-RED<span>-af-ipv4</span>] <strong>vpn-target 100:1 export-extcommunity </strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-A-vpn-instance-RED<span>-af-ipv4</span>] <strong>vpn-target 100:1 import-extcommunity</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-A-vpn-instance-RED<span>-af-ipv4</span>]<strong> multicast routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-A-vpn-instance-RED<span>-af-ipv4</span>]<strong> multicast-domain share-group 239.1.1.1 binding mtunnel 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-A-vpn-instance-RED-af-ipv4]<strong> multicast-domain source-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-A-vpn-instance-RED-af-ipv4] <strong>multicast-domain switch-group-pool 225.2.2.1 28</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-A-vpn-instance-RED-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-A-vpn-instance-RED] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-A-vpn-instance-RED] <strong>quit</strong></pre>
<p># Enable LDP and PIM-SM on the public network interface GigabitEthernet <span>0/1/0</span>.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-A]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-A-GigabitEthernet<span>0/1/0</span>]<strong> ip address 192.168.6.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-A-GigabitEthernet<span>0/1/0</span>]<strong> pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-A-GigabitEthernet<span>0/1/0</span>]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-A-GigabitEthernet<span>0/1/0</span>]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-A-GigabitEthernet<span>0/1/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-A-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<p># Bind GigabitEthernet <span>0/1/1</span> to VPN RED, and enable IGMP and PIM-SM.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-A]<strong> interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-A-GigabitEthernet<span>0/1/1</span>]<strong> ip binding vpn-instance RED</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-A-GigabitEthernet<span>0/1/1</span>]<strong> ip address 10.110.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-A-GigabitEthernet<span>0/1/1</span>]<strong> pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-A-GigabitEthernet<span>0/1/1</span>]<strong> igmp enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-A-GigabitEthernet<span>0/1/1</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-A-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<p># Bind GigabitEthernet <span>0/1/2</span> to VPN RED, and enable PIM-SM.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-A]<strong> interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-A-GigabitEthernet<span>0/1/2</span>]<strong> ip binding vpn-instance RED</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-A-GigabitEthernet<span>0/1/2</span>]<strong> ip address 10.110.2.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-A-GigabitEthernet<span>0/1/2</span>]<strong> pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-A-GigabitEthernet<span>0/1/2</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-A-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<p># Configure BGP, OSPF, and RIP for unicast routing.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-A]<strong> bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-A-bgp]<strong> group VPN-G internal </strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-A-bgp]<strong> peer VPN-G connect-interface LoopBack1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-A-bgp]<strong> peer 1.1.1.2 group VPN-G</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-A-bgp]<strong> peer 1.1.1.3 group VPN-G</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-A-bgp]<strong> ipv4-family vpn-instance RED</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-A-bgp-RED]<strong> import-route rip 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-A-bgp-RED]<strong> import-route direct </strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-A-bgp-RED]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-A-bgp]<strong> ipv4-family vpnv4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-A-bgp-af-vpnv4]<strong> peer VPN-G enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-A-bgp-af-vpnv4]<strong> peer 1.1.1.2 group VPN-G</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-A-bgp-af-vpnv4]<strong> peer 1.1.1.3 group VPN-G</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-A-bgp-af-vpnv4]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-A-bgp] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-A-bgp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-A]<strong> ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-A-ospf-1]<strong> area 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-A-ospf-1-area-0.0.0.0]<strong> network 1.1.1.1 0.0.0.0 </strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-A-ospf-1-area-0.0.0.0]<strong> network 192.168.0.0 0.0.255.255 </strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-A-ospf-1-area-0.0.0.0]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-A-ospf-1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-A-ospf-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-A]<strong> rip 2 vpn-instance RED</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-A-rip-2]<strong> network 10.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-A-rip-2]<strong> import-route bgp cost 3 </strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-A-rip-2] <strong>commit</strong></pre>
</p></li><li><span>Configure PE-B.</span><p><p># Configure an ID for PE-B, enable public-network IP multicast routing, configure an MPLS LSR-ID, and enable LDP.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname PE-B</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-B]<strong> router id 1.1.1.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-B]<strong> multicast routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-B]<strong> mpls lsr-id 1.1.1.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-B]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-B-mpls]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-B]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-B-mpls-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-B]<strong> commit</strong></pre>
<p># Configure an IP address and enable PIM-SM on Loopback1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-B]<strong> interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-B-LoopBack1]<strong> ip address 1.1.1.2 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-B-LoopBack1]<strong> pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-B-LoopBack1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-B-LoopBack1]<strong> quit</strong></pre>
<p># Create a VPN instance named VPN BLUE, and enable the IPv4 address family for it. In the VPN instance IPv4 address family view, configure a VPN IPv4 prefix and set import and export VPN targets for the instance. Enable IP multicast routing, configure a share-group, specify an MTI to be bound to the VPN instance, and set the range of the switch-MDT switch-address-pool. Set the automatic configuration mode for the MTI.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-B]<strong> ip vpn-instance BLUE</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-B-vpn-instance-BLUE]<strong> ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-B-vpn-instance-BLUE<span>-af-ipv4</span>]<strong> route-distinguisher 200:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-B-vpn-instance-BLUE<span>-af-ipv4</span>]<strong> vpn-target 200:1 export-extcommunity </strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-B-vpn-instance-BLUE<span>-af-ipv4</span>]<strong> vpn-target 200:1 import-extcommunity </strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-B-vpn-instance-BLUE<span>-af-ipv4</span>]<strong> multicast routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-B-vpn-instance-BLUE<span>-af-ipv4</span>]<strong> multicast-domain share-group 239.2.2.2 binding mtunnel 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-B-vpn-instance-BLUE-af-ipv4]<strong> multicast-domain source-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-B-vpn-instance-BLUE<span>-af-ipv4</span>]<strong> multicast-domain switch-group-pool 225.4.4.1 28</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-B-vpn-instance-BLUE-af-ipv4]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-B-vpn-instance-BLUE] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-B-vpn-instance-BLUE]<strong> quit</strong></pre>
<p># Create a VPN instance named VPN RED, and enable the IPv4 address family for it. In the VPN instance IPv4 address family view, configure a VPN IPv4 prefix and set import and export VPN targets for the instance. Enable IP multicast routing, configure a share-group, specify an MTI to be bound to the VPN instance, and set the range of the switch-MDT switch-address-pool. Set the automatic configuration mode for the MTI.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-B]<strong> ip vpn-instance RED</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-B-vpn-instance-RED]<strong> ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-B-vpn-instance-RED<span>-af-ipv4</span>]<strong> route-distinguisher 100:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-B-vpn-instance-RED<span>-af-ipv4</span>]<strong> vpn-target 100:1 export-extcommunity </strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-B-vpn-instance-RED<span>-af-ipv4</span>]<strong> vpn-target 100:1 import-extcommunity </strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-B-vpn-instance-RED<span>-af-ipv4</span>]<strong> multicast routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-B-vpn-instance-RED<span>-af-ipv4</span>]<strong> multicast-domain share-group 239.1.1.1 binding mtunnel 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-B-vpn-instance-RED-af-ipv4]<strong> multicast-domain source-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-B-vpn-instance-RED<span>-af-ipv4</span>]<strong> multicast-domain switch-group-pool 225.2.2.1 28</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-B-vpn-instance-RED-af-ipv4]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-B-vpn-instance-RED] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-B-vpn-instance-RED]<strong> quit</strong></pre>
<p># Enable LDP and PIM-SM on the public network interface GigabitEthernet <span>0/1/0</span>.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-B]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-B-GigabitEthernet<span>0/1/0</span>]<strong> ip address 192.168.7.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-B-GigabitEthernet<span>0/1/0</span>]<strong> pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-B-GigabitEthernet<span>0/1/0</span>]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-B-GigabitEthernet<span>0/1/0</span>]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-B-GigabitEthernet<span>0/1/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-B-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<p># Bind GigabitEthernet <span>0/1/1</span> to VPN BLUE, and enable PIM-SM.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-B]<strong> interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-B-GigabitEthernet<span>0/1/1</span>]<strong> ip binding vpn-instance BLUE</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-B-GigabitEthernet<span>0/1/1</span>]<strong> ip address 10.110.3.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-B-GigabitEthernet<span>0/1/1</span>]<strong> pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-B-GigabitEthernet<span>0/1/1</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-B-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<p># Bind GigabitEthernet <span>0/1/2</span> to VPN RED, and enable PIM-SM.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-B]<strong> interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-B-GigabitEthernet<span>0/1/2</span>]<strong> ip binding vpn-instance RED</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-B-GigabitEthernet<span>0/1/2</span>]<strong> ip address 10.110.4.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-B-GigabitEthernet<span>0/1/2</span>]<strong> pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-B-GigabitEthernet<span>0/1/2</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-B-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<p># Configure BGP, OSPF, and RIP for unicast routing.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-B]<strong> bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-B-bgp]<strong> group VPN-G internal </strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-B-bgp]<strong> peer VPN-G connect-interface LoopBack1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-B-bgp]<strong> peer 1.1.1.1 group VPN-G</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-B-bgp]<strong> peer 1.1.1.3 group VPN-G</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-B-bgp]<strong> ipv4-family vpn-instance RED</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-B-bgp-RED]<strong> import-route rip 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-B-bgp-RED]<strong> import-route direct </strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-B-bgp-RED]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-B-bgp]<strong> ipv4-family vpn-instance BLUE</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-B-bgp-BLUE]<strong> import-route rip 3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-B-bgp-BLUE]<strong> import-route direct </strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-B-bgp-BLUE]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-B-bgp]<strong> ipv4-family vpnv4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-B-bgp-af-vpnv4]<strong> peer VPN-G enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-B-bgp-af-vpnv4]<strong> peer 1.1.1.1 group VPN-G</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-B-bgp-af-vpnv4]<strong> peer 1.1.1.3 group VPN-G</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-B-bgp-af-vpnv4]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-B-bgp] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-B-bgp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-B]<strong> ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-B-ospf-1]<strong> area 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-B-ospf-1-area-0.0.0.0]<strong> network 1.1.1.2 0.0.0.0 </strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-B-ospf-1-area-0.0.0.0]<strong> network 192.168.0.0 0.0.255.255 </strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-B-ospf-1-area-0.0.0.0]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-B-ospf-1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-B-ospf-1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-B]<strong> rip 2 vpn-instance RED</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-B-rip-2]<strong> network 10.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-B-rip-2]<strong> import-route bgp cost 3 </strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-B-rip-2] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-B-rip-2]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-B]<strong> rip 3 vpn-instance BLUE</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-B-rip-3]<strong> network 10.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-B-rip-3]<strong> import-route bgp cost 3 </strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-B-rip-3] <strong>commit</strong></pre>
</p></li><li><span>Configure PE-C.</span><p><p># Configure an ID for PE-C, enable public-network IP multicast routing, configure an MPLS LSR-ID, and enable LDP.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname PE-C</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-C]<strong> router id 1.1.1.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C]<strong> multicast routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C]<strong> mpls lsr-id 1.1.1.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C-mpls]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C-mpls-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C] <strong>commit</strong></pre>
<p># Configure an IP address and enable PIM-SM on Loopback1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-C]<strong> interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C-LoopBack1]<strong> ip address 1.1.1.3 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C-LoopBack1]<strong> pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C-LoopBack1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-C-LoopBack1]<strong> quit</strong></pre>
<p># Create a VPN instance named VPN RED enabled with the IPv4 address family and enter the VPN instance IPv4 address family view. Configure a VPN IPv4 prefix and create egress and ingress routes for the instance. Enable IP multicast routing, configure a share-group, specify an MTI bound to the VPN instance, and set the range of the switch-MDT switch-address-pool. Set the automatic configuration mode for the MTI.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-C]<strong> ip vpn-instance RED</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C-vpn-instance-RED]<strong> ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C-vpn-instance-RED<span>-af-ipv4</span>]<strong> route-distinguisher 100:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C-vpn-instance-RED<span>-af-ipv4</span>]<strong> vpn-target 100:1 export-extcommunity </strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C-vpn-instance-RED<span>-af-ipv4</span>]<strong> vpn-target 100:1 import-extcommunity </strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C-vpn-instance-RED<span>-af-ipv4</span>]<strong> multicast routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C-vpn-instance-RED<span>-af-ipv4</span>]<strong> multicast-domain share-group 239.1.1.1 binding mtunnel 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C-vpn-instance-RED-af-ipv4]<strong> multicast-domain source-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C-vpn-instance-RED<span>-af-ipv4</span>]<strong> multicast-domain switch-group-pool 225.2.2.1 28</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C-vpn-instance-RED-af-ipv4]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C-vpn-instance-RED] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-C-vpn-instance-RED]<strong> quit</strong></pre>
<p># Create a VPN instance named VPN BLUE enabled with the IPv4 address family and enter the VPN instance IPv4 address family view. Configure a VPN IPv4 prefix and create egress and ingress routes for the instance. Enable IP multicast routing, configure a share-group, specify an MTI bound to the VPN instance, and set the range of the switch-MDT switch-address-pool. Set the automatic configuration mode for the MTI.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-C]<strong> ip vpn-instance BLUE</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C-vpn-instance-BLUE]<strong> ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C-vpn-instance-BLUE<span>-af-ipv4</span>]<strong> route-distinguisher 200:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C-vpn-instance-BLUE<span>-af-ipv4</span>]<strong> vpn-target 200:1 export-extcommunity </strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C-vpn-instance-BLUE<span>-af-ipv4</span>]<strong> vpn-target 200:1 import-extcommunity </strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C-vpn-instance-BLUE<span>-af-ipv4</span>]<strong> multicast routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C-vpn-instance-BLUE<span>-af-ipv4</span>]<strong> multicast-domain share-group 239.2.2.2 binding mtunnel 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C-vpn-instance-BLUE-af-ipv4]<strong> multicast-domain source-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C-vpn-instance-BLUE<span>-af-ipv4</span>]<strong> multicast-domain switch-group-pool 225.4.4.1 28</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C-vpn-instance-BLUE-af-ipv4]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C-vpn-instance-BLUE] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-C-vpn-instance-BLUE]<strong> quit</strong></pre>
<p># Enable LDP and PIM-SM on the public network interface GigabitEthernet <span>0/1/0</span>.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-C]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-C-GigabitEthernet<span>0/1/0</span>]<strong> ip address 192.168.8.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C-GigabitEthernet<span>0/1/0</span>]<strong> pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C-GigabitEthernet<span>0/1/0</span>]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C-GigabitEthernet<span>0/1/0</span>]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C-GigabitEthernet<span>0/1/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-C-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<p># Bind GigabitEthernet <span>0/1/1</span> to VPN RED, and enable PIM-SM.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-C]<strong> interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-C-GigabitEthernet<span>0/1/1</span>]<strong> ip binding vpn-instance RED</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C-GigabitEthernet<span>0/1/1</span>]<strong> ip address 10.110.5.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C-GigabitEthernet<span>0/1/1</span>]<strong> pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C-GigabitEthernet<span>0/1/1</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-C-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<p># Bind GigabitEthernet <span>0/1/2</span> to VPN BLUE, and enable PIM-SM.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-C]<strong> interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-C-GigabitEthernet<span>0/1/2</span>]<strong> ip binding vpn-instance BLUE</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C-GigabitEthernet<span>0/1/2</span>]<strong> ip address 10.110.6.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C-GigabitEthernet<span>0/1/2</span>]<strong> pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C-GigabitEthernet<span>0/1/2</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-C-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<p># Bind Loopback 2 to VPN BLUE, and enable PIM-SM.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-C]<strong> interface loopback 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C-LoopBack2]<strong> ip binding vpn-instance BLUE</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C-LoopBack2]<strong> ip address 9.9.9.9 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C-LoopBack2]<strong> pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C-LoopBack2] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-C-LoopBack2]<strong> quit</strong></pre>
<p># Configure Loopback 2 as C-BSR and C-RP for VPN BLUE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-C]<strong> pim vpn-instance BLUE</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C-pim-blue]<strong> c-bsr Loopback2 </strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C-pim-blue]<strong> c-rp Loopback2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C-pim-blue] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-C-pim-blue]<strong> quit</strong></pre>
<p># Configure BGP, OSPF, and RIP for unicast routing.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-C] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C-bgp]<strong> group VPN-G internal </strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C-bgp]<strong> peer VPN-G connect-interface LoopBack1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C-bgp]<strong> peer 1.1.1.1 group VPN-G</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C-bgp] <strong>peer 1.1.1.2 group VPN-G</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C-bgp]<strong> ipv4-family vpn-instance RED</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C-bgp-RED]<strong> import-route rip 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C-bgp-RED]<strong> import-route direct </strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C-bgp-RED]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C-bgp]<strong> ipv4-family vpn-instance BLUE</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C-bgp-BLUE]<strong> import-route rip 3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C-bgp-BLUE]<strong> import-route direct </strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C-bgp-BLUE]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C-bgp]<strong> ipv4-family vpnv4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C-bgp-af-vpnv4]<strong> peer VPN-G enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C-bgp-af-vpnv4]<strong> peer 1.1.1.1 group VPN-G</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C-bgp-af-vpnv4]<strong> peer 1.1.1.2 group VPN-G</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C-bgp-af-vpnv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C-bgp] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-C-bgp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-C]<strong> ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C-ospf-1]<strong> area 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C-ospf-1-area-0.0.0.0]<strong> network 1.1.1.3 0.0.0.0 </strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C-ospf-1-area-0.0.0.0]<strong> network 192.168.0.0 0.0.255.255 </strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C-ospf-1-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C-ospf-1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-C-ospf-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-C]<strong> rip 2 vpn-instance RED</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C-rip-2]<strong> network 10.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C-rip-2] <strong>import-route bgp cost 3 </strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C-rip-2] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-C-rip-2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-C]<strong> rip 3 vpn-instance BLUE</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C-rip-3]<strong> network 10.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C-rip-3] <strong>import-route bgp cost 3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-C-rip-3] <strong>commit</strong></pre>
</p></li><li><span>Configure the P.</span><p><p># Enable public-network IP multicast routing, configure an MPLS LSR-ID, and enable LDP.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname P</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P]<strong> multicast routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P]<strong> mpls lsr-id 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-mpls]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-mpls-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>commit</strong></pre>
<p># Enable LDP and PIM-SM on the public network interface GigabitEthernet <span>0/1/0</span>.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P-GigabitEthernet<span>0/1/0</span>]<strong> ip address 192.168.6.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/0</span>]<strong> pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/0</span>]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/0</span>]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<p># Enable LDP and PIM-SM on the public network interface GigabitEthernet <span>0/1/1</span>.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P]<strong> interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P-GigabitEthernet<span>0/1/1</span>]<strong> ip address 192.168.7.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/1</span>]<strong> pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/1</span>]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/1</span>]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/1</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<p># Enable LDP and PIM-SM on the public network interface GigabitEthernet <span>0/1/2</span>.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P]<strong> interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P-GigabitEthernet<span>0/1/2</span>]<strong> ip address 192.168.8.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/2</span>]<strong> pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/2</span>]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/2</span>]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/2</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<p># Configure an IP address and enable PIM-SM on Loopback1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P]<strong> interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-LoopBack1]<strong> ip address 2.2.2.2 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-LoopBack1]<strong> pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-LoopBack1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P-LoopBack1]<strong> quit</strong></pre>
<p># Configure Loopback 1 as the C-BSR and C-RP of the public network instance.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P] <strong>pim</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-pim]<strong> c-bsr Loopback1 </strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-pim]<strong> c-rp Loopback1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-pim] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P-pim] <strong>quit</strong></pre>
<p># Perform configurations for OSPF unicast routing.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P]<strong> ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-ospf-1]<strong> area 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-ospf-1-area-0.0.0.0]<strong> network 2.2.2.2 0.0.0.0 </strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-ospf-1-area-0.0.0.0]<strong> network 192.168.0.0 0.0.255.255 </strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-ospf-1-area-0.0.0.0]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-ospf-1] <strong>commit</strong></pre>
</p></li><li><span>Configure CE-Ra.</span><p><p># Enable IP multicast routing.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname CE-Ra</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE-Ra]<strong> multicast routing-enable</strong></pre>
<p># Enable PIM-SM on the VPN interface GigabitEthernet <span>0/1/0</span>.</p>
<pre class="screen">[<span class="keyword">*</span>CE-Ra]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-Ra-GigabitEthernet<span>0/1/0</span>]<strong> ip address 10.110.7.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-Ra-GigabitEthernet<span>0/1/0</span>]<strong> pim sm</strong></pre>
<p># Enable PIM-SM on the VPN interface GigabitEthernet <span>0/1/1</span>.</p>
<pre class="screen">[<span class="keyword">*</span>CE-Ra]<strong> interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-Ra-GigabitEthernet<span>0/1/1</span>]<strong> ip address 10.110.2.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-Ra-GigabitEthernet<span>0/1/1</span>]<strong> pim sm</strong></pre>
<p># Perform configurations for RIP unicast routing.</p>
<pre class="screen">[<span class="keyword">*</span>CE-Ra]<strong> rip 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-Ra-rip-2]<strong> network 10.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-Ra-rip-2]<strong> import-route direct</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-Ra-rip-2] <strong>commit</strong></pre>
</p></li><li><span>Configure CE-Bb.</span><p><p># Enable IP multicast routing.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname CE-Bb</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE-Bb]<strong> multicast routing-enable</strong></pre>
<p># Enable PIM-SM on the VPN interface GigabitEthernet <span>0/1/0</span>.</p>
<pre class="screen">[<span class="keyword">*</span>CE-Bb]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-Bb-GigabitEthernet<span>0/1/0</span>]<strong> ip address 10.110.8.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-Bb-GigabitEthernet<span>0/1/0</span>]<strong> pim sm</strong></pre>
<p># Enable PIM-SM on the VPN interface GigabitEthernet <span>0/1/1</span>.</p>
<pre class="screen">[<span class="keyword">*</span>CE-Bb]<strong> interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-Bb-GigabitEthernet<span>0/1/1</span>]<strong> ip address 10.110.3.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-Bb-GigabitEthernet<span>0/1/1</span>]<strong> pim sm</strong></pre>
<p># Configure an IP address and enable PIM-SM on Loopback2.</p>
<pre class="screen">[<span class="keyword">*</span>CE-Bb]<strong> interface LoopBack2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-Bb-LoopBack2]<strong> ip address 8.8.8.8 255.255.255.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-Bb-LoopBack2]<strong> pim sm</strong></pre>
<p># Perform configurations for RIP unicast routing.</p>
<pre class="screen">[<span class="keyword">*</span>CE-Bb]<strong> rip 3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-Bb-rip-3]<strong> network 10.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-Bb-rip-3]<strong> import-route direct</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-Bb-rip-3] <strong>commit</strong></pre>
</p></li><li><span>Configure CE-Rb.</span><p><p># Enable IP multicast routing.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname CE-Rb</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE-Rb]<strong> multicast routing-enable</strong></pre>
<p># Enable PIM-SM and IGMP on the VPN interface GigabitEthernet <span>0/1/0</span>.</p>
<pre class="screen">[<span class="keyword">*</span>CE-Rb]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-Rb-GigabitEthernet<span>0/1/0</span>]<strong> ip address 10.110.9.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-Rb-GigabitEthernet<span>0/1/0</span>]<strong> pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-Rb-GigabitEthernet<span>0/1/0</span>]<strong> igmp enable</strong></pre>
<p># Enable PIM-SM on the VPN interface GigabitEthernet <span>0/1/1</span>.</p>
<pre class="screen">[<span class="keyword">*</span>CE-Rb]<strong> interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-Rb-GigabitEthernet<span>0/1/1</span>]<strong> ip address 10.110.4.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-Rb-GigabitEthernet<span>0/1/1</span>]<strong> pim sm</strong></pre>
<p># Enable PIM-SM on the VPN interface GigabitEthernet <span>0/1/2</span>.</p>
<pre class="screen">[<span class="keyword">*</span>CE-Rb]<strong> interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-Rb-GigabitEthernet<span>0/1/2</span>]<strong> ip address 10.110.12.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-Rb-GigabitEthernet<span>0/1/2</span>]<strong> pim sm</strong></pre>
<p># Configure an IP address and enable PIM-SM on Loopback1.</p>
<pre class="screen">[<span class="keyword">*</span>CE-Rb]<strong> interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-Rb-LoopBack1]<strong> ip address 7.7.7.7 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-Rb-LoopBack1]<strong> pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-Rb-LoopBack1]<strong> quit</strong></pre>
<p># Configure Loopback 1 as the C-BSR and C-RP of VPN RED.</p>
<pre class="screen">[<span class="keyword">*</span>CE-Rb]<strong> pim</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-Rb-pim]<strong> c-bsr Loopback1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-Rb-pim]<strong> c-rp Loopback1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-Rb-pim]<strong> quit</strong></pre>
<p># Perform configurations for RIP unicast routing.</p>
<pre class="screen">[<span class="keyword">*</span>CE-Rb]<strong> rip 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-Rb-rip-2]<strong> network 10.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-Rb-rip-2]<strong> network 10.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-Rb-rip-2]<strong> import-route direct</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-Rb-rip-2] <strong>commit</strong></pre>
</p></li><li><span>Configure CE-Rc.</span><p><p># Enable IP multicast routing.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname CE-Rc</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE-Rc]<strong> multicast routing-enable</strong></pre>
<p># Enable PIM-SM and IGMP on the VPN interface GigabitEthernet <span>0/1/0</span>.</p>
<pre class="screen">[<span class="keyword">*</span>CE-Rc]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-Rc-GigabitEthernet<span>0/1/0</span>]<strong> ip address 10.110.10.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-Rc-GigabitEthernet<span>0/1/0</span>]<strong> pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-Rc-GigabitEthernet<span>0/1/0</span>]<strong> igmp enable</strong></pre>
<p># Enable PIM-SM on the VPN interface GigabitEthernet <span>0/1/1</span>.</p>
<pre class="screen">[<span class="keyword">*</span>CE-Rc]<strong> interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-Rc-GigabitEthernet<span>0/1/1</span>]<strong> ip address 10.110.5.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-Rc-GigabitEthernet<span>0/1/1</span>]<strong> pim sm</strong></pre>
<p># Enable PIM-SM on the VPN interface GigabitEthernet <span>0/1/2</span>.</p>
<pre class="screen">[<span class="keyword">*</span>CE-Rc]<strong> interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-Rc-GigabitEthernet<span>0/1/2</span>]<strong> ip address 10.110.12.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-Rc-GigabitEthernet<span>0/1/2</span>]<strong> pim sm</strong></pre>
<p># Perform configurations for RIP unicast routing.</p>
<pre class="screen">[<span class="keyword">*</span>CE-Rc]<strong> rip 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-Rc-rip-2]<strong> network 10.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-Rc-rip-2]<strong> import-route direct</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-Rc-rip-2] <strong>commit</strong></pre>
</p></li><li><span>Configure CE-Bc.</span><p><p># Enable IP multicast routing.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname CE-Bc</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE-Bc]<strong> multicast routing-enable</strong></pre>
<p># Enable PIM-SM and IGMP on the VPN interface GigabitEthernet <span>0/1/0</span>.</p>
<pre class="screen">[<span class="keyword">*</span>CE-Bc]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-Bc-GigabitEthernet<span>0/1/0</span>]<strong> ip address 10.110.11.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-Bc-GigabitEthernet<span>0/1/0</span>]<strong> pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-Bc-GigabitEthernet<span>0/1/0</span>]<strong> igmp enable</strong></pre>
<p># Enable PIM-SM on the VPN interface GigabitEthernet <span>0/1/1</span>.</p>
<pre class="screen">[<span class="keyword">*</span>CE-Bc]<strong> interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-Bc-GigabitEthernet<span>0/1/1</span>]<strong> ip address 10.110.6.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-Bc-GigabitEthernet<span>0/1/1</span>]<strong> pim sm</strong></pre>
<p># Perform configurations for RIP unicast routing.</p>
<pre class="screen">[<span class="keyword">*</span>CE-Bc]<strong> rip 3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-Bc-rip-3]<strong> network 10.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-Bc-rip-3]<strong> import-route direct</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-Bc-rip-3] <strong>commit</strong></pre>
</p></li><li><span>Configure an IP address for the MTunnel interface.</span><p><p># Configure PE-A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-A] <strong>interface MTunnel 0 </strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-A-MTunnel0]<strong> ip address 1.1.1.1 32</strong> 
[<span class="keyword">*</span>PE-A-MTunnel0] <strong>quit</strong> 
[<span class="keyword">*</span>PE-A] <strong>commit</strong></pre>
<p># Configure PE-B.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-B]<strong> interface MTunnel 0 </strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-B-MTunnel0] <strong>ip address 1.1.1.2 32</strong> 
[<span class="keyword">*</span>PE-B-MTunnel0] <strong>quit</strong> 
[<span class="keyword">*</span>PE-B] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-B] <strong>interface MTunnel 1 </strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-B-MTunnel11] <strong>ip address 1.1.1.2 32 </strong>
[<span class="keyword">*</span>PE-B-MTunnel1] <strong>quit</strong> 
[<span class="keyword">*</span>PE-B]<strong> commit</strong></pre>
<p># Configure PE-C.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-C] <strong>interface MTunnel 0 </strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-C-MTunnel0] <strong>ip address 1.1.1.3 32 </strong>
[<span class="keyword">*</span>PE-C-MTunnel0] <strong>quit</strong> 
[<span class="keyword">*</span>PE-C] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-C] <strong>interface MTunnel 1 </strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-C-MTunnel1] <strong>ip address 1.1.1.3 32 </strong>
[<span class="keyword">*</span>PE-C-MTunnel1] <strong>quit</strong> 
[<span class="keyword">*</span>PE-C] <strong>commit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p># Run the <strong>display pim vpn-instance neighbor</strong> command on PE-C and PE-B to check the neighbors of each MTI bound to a specific VPN. For example:</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-C] <strong>display pim vpn-instance BLUE neighbor</strong>
VPN-Instance: BLUE

 Total Number of Neighbors = 2 

 Neighbor        Interface           Uptime   Expires    Dr-Priority    BFD-Session
 10.110.6.2      GE<span>0/1/2</span>             1d:01h   00:01:42   1              N
<strong> 1.1.1.2</strong>         <strong>MTun1</strong>               <strong>1d:01h</strong>   <strong>00:01:29</strong>  <strong>1</strong>              N</pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-B] <strong>display pim vpn-instance BLUE neighbor</strong>
VPN-Instance: BLUE

 Total Number of Neighbors = 2 

 Neighbor        Interface           Uptime   Expires    Dr-Priority    BFD-Session
 10.110.3.2      GE<span>0/1/1</span>             1d:01h   00:01:39   1              N
 <strong>1.1.1.3</strong>         <strong>MTun1</strong>               <strong>1d:02h</strong>   <strong>00:01:19</strong>  <strong>1</strong>              N</pre>
<p>The preceding command output shows that the multicast VPN neighbor relationship can be established on the MTunnel interface, indicating that the multicast VPN channel is successfully established.</p>
<p># Run the <strong>display pim vpn-instance routing-table</strong> command on PE-C to view the PIM routing table. For example:</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-C] <strong>display pim vpn-instance BLUE routing-table</strong></pre>
<pre class="screen"> VPN-Instance: BLUE
 Total 0 (*, G) entry; 1 (S, G) entry

 (8.8.8.8, 227.111.1.2)
     RP: 9.9.9.9(local)
     Protocol: pim-sm, Flag: SPT
     UpTime: 06:39:55
     <strong>Upstream interface: MTunnel1</strong>, Refresh time: 06:39:55
          Upstream neighbor: 1.1.1.2
          RPF prime neighbor: 1.1.1.2
     Downstream interface(s) information:
     Total number of downstreams: 1
       <strong>1: GigabitEthernet<span>0/1/2</span></strong>
             Protocol: pim-sm, UpTime: 06:38:41, Expires: 00:02:49
</pre>
<p>The preceding command output shows that PIM routing entries are created for VPNs on PE-C.</p>
<p># Run the <strong>display multicast vpn-instance forwarding-table</strong> command on PE-C to check forwarding entries created for VPNs. For example:</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-C] <strong>display multicast vpn-instance BLUE forwarding-table</strong>
Multicast Forwarding Table of VPN-Instance: BLUE
Total 1 entry, 1 matched

1.(8.8.8.8, 227.111.1.2)
     MID: 3, Flags: -
     Uptime: 06:53:54, Timeout in: 00:00:00
     Incoming interface: MTunnel1
     List of 1 outgoing interfaces:
       1: GigabitEthernet<span>0/1/2</span>
     <strong>Matched rate: 328938 packets/sec, 215783368 bits/sec</strong>
     <strong>Matched 38264 packets(1071392 bytes)</strong>, Wrong If 0 packets
     <strong>Forwarded 38264 packets(1071392 bytes)</strong></pre>
<p>The preceding command output shows that forwarding entries are created for VPNs on PE-C and traffic is forwarded properly.</p>
<p># Run the <strong>display pim routing-table</strong> command on CE-Bb connected to a source and CE-Bc connected to receivers to check the PIM routing tables established for the public network. For example:</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE-Bb] <strong>display pim routing-table</strong></pre>
<pre class="screen">VPN-Instance: public net
Total 0 (*, G) entry; 1 (S, G) entry

 (8.8.8.8, 227.111.1.2)
     RP: 9.9.9.9
     Protocol: pim-sm, Flag: SPT LOC
     UpTime: 00:01:29
     Upstream interface: LoopBack1, Refresh time: 00:01:29
         Upstream neighbor: NULL
         RPF prime neighbor: NULL
     Downstream interface(s) information:
     Total number of downstreams: 1
       <strong>1: GigabitEthernet<span>0/1/1</span></strong>
             Protocol: pim-sm, UpTime: 00:00:15, Expires: 00:03:15</pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE-Bc] <strong>display pim routing-table</strong></pre>
<pre class="screen">VPN-Instance: public net
 Total 0 (*, G) entry; 1 (S, G) entry

 (8.8.8.8, 227.111.1.2)
     RP: NULL
     Protocol: pim-sm, Flag: SPT SG_RCVR
     UpTime: 00:00:11
     Upstream interface: GigabitEthernet<span>0/1/1</span>, Refresh time: 00:00:11
         Upstream neighbor: 10.110.6.1
         RPF prime neighbor: 10.110.6.1
     Downstream interface(s) information:
     Total number of downstreams: 1
       <strong>1: GigabitEthernet<span>0/1/0</span></strong>
             Protocol: static, UpTime: 00:00:11, Expires: -</pre>
<p>The preceding command output shows that PIM routing entries are created for the public network on CE-Bb and CE-Bc.</p>
<p># Run the <strong>display multicast forwarding-table</strong> command on CE-Bb connected to a source and CE-Bc connected to receivers to check the PIM forwarding tables established for the public network. For example:</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE-Bb] <strong>display multicast forwarding-table</strong></pre>
<pre class="screen">Multicast Forwarding Table of VPN-Instance: <span>public_net</span>
Total 1 entry, 1 matched

1.(8.8.8.8, 227.111.1.2)
     MID: 1, Flags: -
     Uptime: 05:25:35, Timeout in: 00:00:00
     Incoming interface: Mcast_In_IF
     List of 1 outgoing interfaces:
       1: GigabitEthernet<span>0/1/1</span>       
         Activetime: 02:35:57
     <strong>Matched rate: 328938 packets/sec, 215783368 bits/sec</strong>
     <strong>Matched 38264 packets(1071392 bytes)</strong>, Wrong If 0 packets
     <strong>Forwarded 38264 packets(1071392 bytes)</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE-Bc] <strong>display multicast forwarding-table</strong></pre>
<pre class="screen">Multicast Forwarding Table of VPN-Instance: <span>public_net</span>

Total 1 entry, 1 matched

1.(8.8.8.8, 227.111.1.2)
     MID: 1, Flags: -
     Uptime: 05:25:35, Timeout in: 00:00:00
     Incoming interface: Mcast_In_IF
     List of 1 outgoing interfaces:
       1: GigabitEthernet<span>0/1/0</span>
         Activetime: 02:35:57
     <strong>Matched rate: 328938 packets/sec, 215783368 bits/sec</strong>
     <strong>Matched 38264 packets(1071392 bytes)</strong>, Wrong If 0 packets
     <strong>Forwarded 38264 packets(1071392 bytes)</strong></pre>
<p>The preceding command output shows that PIM forwarding entries are created for the public network on CE-Bb and CE-Bc and traffic is forwarded properly.</p>
<p>After the preceding configurations are performed, PC4 can receive multicast packets from source 2. Similarly, PC1, PC2, and PC3 can receive multicast packets from source 1.</p>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001225672704__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>PE-A configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname PE-A</pre>
<pre class="screen">#</pre>
<pre class="screen">router id 1.1.1.1</pre>
<pre class="screen">#</pre>
<pre class="screen">multicast routing-enable</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls lsr-id 1.1.1.1</pre>
<pre class="screen">mpls</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls ldp</pre>
<pre class="screen"> #</pre>
<pre class="screen"> ipv4-family</pre>
<pre class="screen">#</pre>
<pre class="screen">ip vpn-instance RED</pre>
<pre class="screen"> ipv4-family
  route-distinguisher 100:1
  apply-label per-instance
  vpn-target 100:1 export-extcommunity
  vpn-target 100:1 import-extcommunity
  multicast routing-enable
  multicast-domain share-group 239.1.1.1 binding MTunnel 0
  multicast-domain switch-group-pool 225.2.2.0 255.255.255.240
  multicast-domain source-interface loopback 1</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 192.168.6.1 255.255.255.0 </pre>
<pre class="screen"> pim sm</pre>
<pre class="screen"> mpls</pre>
<pre class="screen"> mpls ldp</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/1</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip binding vpn-instance RED</pre>
<pre class="screen"> ip address 10.110.1.1 255.255.255.0 </pre>
<pre class="screen"> pim sm </pre>
<pre class="screen"> igmp enable</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/2</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip binding vpn-instance RED</pre>
<pre class="screen"> ip address 10.110.2.1 255.255.255.0 </pre>
<pre class="screen"> pim sm</pre>
<pre class="screen">#</pre>
<pre class="screen">interface LoopBack1</pre>
<pre class="screen"> ip address 1.1.1.1 255.255.255.255</pre>
<pre class="screen"> pim sm</pre>
<pre class="screen">#</pre>
<pre class="screen">interface MTunnel0</pre>
<pre class="screen"> ip binding vpn-instance RED
 ip address 1.1.1.1 255.255.255.255</pre>
<pre class="screen">#</pre>
<pre class="screen">bgp 100</pre>
<pre class="screen"> group VPN-G internal</pre>
<pre class="screen"> peer VPN-G connect-interface LoopBack1</pre>
<pre class="screen"> peer 1.1.1.2 as-number 100</pre>
<pre class="screen"> peer 1.1.1.2 group VPN-G</pre>
<pre class="screen"> peer 1.1.1.3 as-number 100</pre>
<pre class="screen"> peer 1.1.1.3 group VPN-G</pre>
<pre class="screen"> #</pre>
<pre class="screen"> ipv4-family unicast</pre>
<pre class="screen">  undo synchronization</pre>
<pre class="screen">  peer VPN-G enable</pre>
<pre class="screen">  peer 1.1.1.2 enable </pre>
<pre class="screen">  peer 1.1.1.2 group VPN-G</pre>
<pre class="screen">  peer 1.1.1.3 enable</pre>
<pre class="screen">  peer 1.1.1.3 group VPN-G</pre>
<pre class="screen"> #</pre>
<pre class="screen"> ipv4-family vpnv4</pre>
<pre class="screen">  policy vpn-target</pre>
<pre class="screen">  peer VPN-G enable</pre>
<pre class="screen">  peer 1.1.1.2 enable</pre>
<pre class="screen">  peer 1.1.1.2 group VPN-G</pre>
<pre class="screen">  peer 1.1.1.3 enable</pre>
<pre class="screen">  peer 1.1.1.3 group VPN-G</pre>
<pre class="screen">#</pre>
<pre class="screen"> ipv4-family vpn-instance RED</pre>
<pre class="screen">  import-route rip 2</pre>
<pre class="screen">  import-route direct </pre>
<pre class="screen">#</pre>
<pre class="screen">ospf 1 </pre>
<pre class="screen"> area 0.0.0.0</pre>
<pre class="screen">  network 1.1.1.1 0.0.0.0 </pre>
<pre class="screen">  network 192.168.0.0 0.0.255.255 </pre>
<pre class="screen">#</pre>
<pre class="screen">rip 2 vpn-instance RED</pre>
<pre class="screen">  network 10.0.0.0</pre>
<pre class="screen">  import-route bgp cost 3 </pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p>PE-B configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname PE-B</pre>
<pre class="screen">#</pre>
<pre class="screen">router id 1.1.1.2</pre>
<pre class="screen">#</pre>
<pre class="screen">multicast routing-enable</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls lsr-id 1.1.1.2</pre>
<pre class="screen">mpls </pre>
<pre class="screen">#</pre>
<pre class="screen">mpls ldp</pre>
<pre class="screen"> #</pre>
<pre class="screen"> ipv4-family</pre>
<pre class="screen">#</pre>
<pre class="screen">ip vpn-instance BLUE</pre>
<pre class="screen"> ipv4-family
  route-distinguisher 200:1
  apply-label per-instance
  vpn-target 200:1 export-extcommunity
  vpn-target 200:1 import-extcommunity
  multicast routing-enable
  multicast-domain share-group 239.2.2.2 binding MTunnel 1
  multicast-domain switch-group-pool 225.4.4.0 255.255.255.240
  multicast-domain source-interface loopback 1</pre>
<pre class="screen">#</pre>
<pre class="screen">ip vpn-instance RED</pre>
<pre class="screen"> ipv4-family
  route-distinguisher 100:1
  apply-label per-instance
  vpn-target 100:1 export-extcommunity
  vpn-target 100:1 import-extcommunity
  multicast routing-enable
  multicast-domain share-group 239.1.1.1 binding MTunnel 0
  multicast-domain switch-group-pool 225.2.2.0 255.255.255.240
  multicast-domain source-interface loopback 1</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 192.168.7.1 255.255.255.0 </pre>
<pre class="screen"> pim sm</pre>
<pre class="screen"> mpls</pre>
<pre class="screen"> mpls ldp </pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/1</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip binding vpn-instance BLUE</pre>
<pre class="screen"> ip address 10.110.3.1 255.255.255.0</pre>
<pre class="screen"> pim sm</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/2</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip binding vpn-instance RED</pre>
<pre class="screen"> ip address 10.110.4.1 255.255.255.0 </pre>
<pre class="screen"> pim sm</pre>
<pre class="screen">#</pre>
<pre class="screen">interface LoopBack1</pre>
<pre class="screen"> ip address 1.1.1.2 255.255.255.255</pre>
<pre class="screen"> pim sm</pre>
<pre class="screen">#</pre>
<pre class="screen">interface MTunnel0</pre>
<pre class="screen"> ip binding vpn-instance RED
 ip address 1.1.1.2 255.255.255.255</pre>
<pre class="screen">#</pre>
<pre class="screen">interface MTunnel1</pre>
<pre class="screen"> ip binding vpn-instance BLUE
 ip address 1.1.1.2 255.255.255.255</pre>
<pre class="screen">#</pre>
<pre class="screen">bgp 100</pre>
<pre class="screen"> group VPN-G internal</pre>
<pre class="screen"> peer VPN-G connect-interface LoopBack1</pre>
<pre class="screen"> peer 1.1.1.1 as-number 100</pre>
<pre class="screen"> peer 1.1.1.1 group VPN-G</pre>
<pre class="screen"> peer 1.1.1.3 as-number 100</pre>
<pre class="screen"> peer 1.1.1.3 group VPN-G</pre>
<pre class="screen"> #</pre>
<pre class="screen"> ipv4-family unicast</pre>
<pre class="screen">  undo synchronization</pre>
<pre class="screen">  peer VPN-G enable</pre>
<pre class="screen">  peer 1.1.1.1 enable</pre>
<pre class="screen">  peer 1.1.1.1 group VPN-G</pre>
<pre class="screen">  peer 1.1.1.3 enable</pre>
<pre class="screen">  peer 1.1.1.3 group VPN-G</pre>
<pre class="screen"> #</pre>
<pre class="screen"> ipv4-family vpnv4</pre>
<pre class="screen">  policy vpn-target</pre>
<pre class="screen">  peer VPN-G enable</pre>
<pre class="screen">  peer 1.1.1.1 enable</pre>
<pre class="screen">  peer 1.1.1.1 group VPN-G</pre>
<pre class="screen">  peer 1.1.1.3 enable</pre>
<pre class="screen">  peer 1.1.1.3 group VPN-G</pre>
<pre class="screen"> #</pre>
<pre class="screen"> ipv4-family vpn-instance RED</pre>
<pre class="screen">  import-route rip 2</pre>
<pre class="screen">  import-route direct </pre>
<pre class="screen"> #</pre>
<pre class="screen"> ipv4-family vpn-instance BLUE</pre>
<pre class="screen">  import-route rip 3</pre>
<pre class="screen">  import-route direct </pre>
<pre class="screen">#</pre>
<pre class="screen">ospf 1 </pre>
<pre class="screen"> area 0.0.0.0</pre>
<pre class="screen">  network 1.1.1.2 0.0.0.0 </pre>
<pre class="screen">  network 192.168.0.0 0.0.255.255 </pre>
<pre class="screen">#</pre>
<pre class="screen">rip 2 vpn-instance RED</pre>
<pre class="screen"> network 10.0.0.0</pre>
<pre class="screen"> import-route bgp cost 3 </pre>
<pre class="screen">#</pre>
<pre class="screen">rip 3 vpn-instance BLUE</pre>
<pre class="screen"> network 10.0.0.0</pre>
<pre class="screen"> import-route bgp cost 3 </pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p>PE-C configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname PE-C</pre>
<pre class="screen"># </pre>
<pre class="screen">router id 1.1.1.3</pre>
<pre class="screen"># </pre>
<pre class="screen">multicast routing-enable</pre>
<pre class="screen"># </pre>
<pre class="screen">mpls lsr-id 1.1.1.3</pre>
<pre class="screen">mpls </pre>
<pre class="screen"># </pre>
<pre class="screen">mpls ldp</pre>
<pre class="screen"> #</pre>
<pre class="screen"> ipv4-family</pre>
<pre class="screen"># </pre>
<pre class="screen">ip vpn-instance RED</pre>
<pre class="screen"> ipv4-family 
  route-distinguisher 100:1
  apply-label per-instance
  vpn-target 100:1 export-extcommunity
  vpn-target 100:1 import-extcommunity
  multicast routing-enable
  multicast-domain share-group 239.1.1.1 binding MTunnel 0
  multicast-domain switch-group-pool 225.2.2.0 255.255.255.240
  multicast-domain source-interface loopback 1</pre>
<pre class="screen"># </pre>
<pre class="screen">ip vpn-instance BLUE</pre>
<pre class="screen"> ipv4-family
  route-distinguisher 200:1
  apply-label per-instance
  vpn-target 200:1 export-extcommunity
  vpn-target 200:1 import-extcommunity
  multicast routing-enable
  multicast-domain share-group 239.2.2.2 binding MTunnel 1
  multicast-domain switch-group-pool 225.4.4.0 255.255.255.240
  multicast-domain source-interface loopback 1</pre>
<pre class="screen"># </pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 192.168.8.1 255.255.255.0 </pre>
<pre class="screen"> pim sm</pre>
<pre class="screen"> mpls </pre>
<pre class="screen"> mpls ldp </pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/1</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip binding vpn-instance RED</pre>
<pre class="screen"> ip address 10.110.5.1 255.255.255.0 </pre>
<pre class="screen"> pim sm</pre>
<pre class="screen"># </pre>
<pre class="screen">interface GigabitEthernet<span>0/1/2</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip binding vpn-instance BLUE</pre>
<pre class="screen"> ip address 10.110.6.1 255.255.255.0 </pre>
<pre class="screen"> pim sm</pre>
<pre class="screen"># </pre>
<pre class="screen">interface LoopBack1</pre>
<pre class="screen"> ip address 1.1.1.3 255.255.255.255</pre>
<pre class="screen"> pim sm</pre>
<pre class="screen"># </pre>
<pre class="screen">interface LoopBack2</pre>
<pre class="screen"> ip binding vpn-instance BLUE</pre>
<pre class="screen"> ip address 9.9.9.9 255.255.255.255 </pre>
<pre class="screen"> pim sm</pre>
<pre class="screen"># </pre>
<pre class="screen">pim vpn-instance BLUE</pre>
<pre class="screen"> c-bsr LoopBack2 </pre>
<pre class="screen"> c-rp LoopBack2</pre>
<pre class="screen"># </pre>
<pre class="screen">interface MTunnel0</pre>
<pre class="screen"> ip binding vpn-instance RED
 ip address 1.1.1.3 255.255.255.255</pre>
<pre class="screen"># </pre>
<pre class="screen">interface MTunnel1</pre>
<pre class="screen"> ip binding vpn-instance BLUE
 ip address 1.1.1.3 255.255.255.255</pre>
<pre class="screen"># </pre>
<pre class="screen">bgp 100</pre>
<pre class="screen"> group VPN-G internal</pre>
<pre class="screen"> peer VPN-G connect-interface LoopBack1</pre>
<pre class="screen"> peer 1.1.1.1 as-number 100</pre>
<pre class="screen"> peer 1.1.1.1 group VPN-G</pre>
<pre class="screen"> peer 1.1.1.2 as-number 100</pre>
<pre class="screen"> peer 1.1.1.2 group VPN-G</pre>
<pre class="screen"> #</pre>
<pre class="screen"> ipv4-family unicast</pre>
<pre class="screen">  undo synchronization</pre>
<pre class="screen">  peer VPN-G enable</pre>
<pre class="screen">  peer 1.1.1.1 enable</pre>
<pre class="screen">  peer 1.1.1.1 group VPN-G</pre>
<pre class="screen">  peer 1.1.1.2 enable</pre>
<pre class="screen">  peer 1.1.1.2 group VPN-G</pre>
<pre class="screen"> #</pre>
<pre class="screen"> ipv4-family vpnv4</pre>
<pre class="screen">  policy vpn-target</pre>
<pre class="screen">  peer VPN-G enable</pre>
<pre class="screen">  peer 1.1.1.1 enable</pre>
<pre class="screen">  peer 1.1.1.1 group VPN-G</pre>
<pre class="screen">  peer 1.1.1.2 enable</pre>
<pre class="screen">  peer 1.1.1.2 group VPN-G</pre>
<pre class="screen"> #</pre>
<pre class="screen"> ipv4-family vpn-instance RED</pre>
<pre class="screen">  import-route rip 2</pre>
<pre class="screen">  import-route direct </pre>
<pre class="screen"> #         </pre>
<pre class="screen"> ipv4-family vpn-instance BLUE</pre>
<pre class="screen">  import-route rip 3</pre>
<pre class="screen">  import-route direct </pre>
<pre class="screen">#         </pre>
<pre class="screen">ospf 1     </pre>
<pre class="screen"> area  0.0.0.0</pre>
<pre class="screen">  network 1.1.1.3 0.0.0.0 </pre>
<pre class="screen">  network 192.168.0.0 0.0.255.255 </pre>
<pre class="screen">#</pre>
<pre class="screen">rip 2 vpn-instance RED </pre>
<pre class="screen"> network 10.0.0.0</pre>
<pre class="screen"> import-route bgp cost 3 </pre>
<pre class="screen">#               </pre>
<pre class="screen">rip 3 vpn-instance BLUE </pre>
<pre class="screen"> network 10.0.0.0</pre>
<pre class="screen"> import-route bgp cost 3 </pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p>P configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname P</pre>
<pre class="screen">#</pre>
<pre class="screen">multicast routing-enable</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls lsr-id 2.2.2.2</pre>
<pre class="screen">mpls </pre>
<pre class="screen">#</pre>
<pre class="screen">mpls ldp</pre>
<pre class="screen"> #</pre>
<pre class="screen"> ipv4-family</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 192.168.6.2 255.255.255.0 </pre>
<pre class="screen"> pim sm</pre>
<pre class="screen"> mpls</pre>
<pre class="screen"> mpls ldp</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/1</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 192.168.7.2 255.255.255.0 </pre>
<pre class="screen"> pim sm</pre>
<pre class="screen"> mpls</pre>
<pre class="screen"> mpls ldp</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/2</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 192.168.8.2 255.255.255.0 </pre>
<pre class="screen"> pim sm</pre>
<pre class="screen"> mpls</pre>
<pre class="screen"> mpls ldp </pre>
<pre class="screen">#</pre>
<pre class="screen">interface LoopBack1</pre>
<pre class="screen"> ip address 2.2.2.2 255.255.255.255</pre>
<pre class="screen"> pim sm</pre>
<pre class="screen">#</pre>
<pre class="screen">pim</pre>
<pre class="screen"> c-bsr Loopback1</pre>
<pre class="screen"> c-rp Loopback1</pre>
<pre class="screen">#</pre>
<pre class="screen">ospf 1 </pre>
<pre class="screen"> area 0.0.0.0</pre>
<pre class="screen">  network 2.2.2.2 0.0.0.0 </pre>
<pre class="screen">  network 192.168.0.0 0.0.255.255 </pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p>CE-Ra configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname CE-Ra</pre>
<pre class="screen">#</pre>
<pre class="screen">multicast routing-enable</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.110.7.1 255.255.255.0 </pre>
<pre class="screen"> pim sm</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/1</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.110.2.2 255.255.255.0 </pre>
<pre class="screen"> pim sm</pre>
<pre class="screen">#</pre>
<pre class="screen">rip 2</pre>
<pre class="screen"> network 10.0.0.0</pre>
<pre class="screen"> import-route direct</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p>CE-Bb configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname CE-Bb</pre>
<pre class="screen">#</pre>
<pre class="screen">multicast routing-enable</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.110.8.1 255.255.255.0</pre>
<pre class="screen"> pim sm</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/1</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.110.3.2 255.255.255.0 </pre>
<pre class="screen"> pim sm</pre>
<pre class="screen">#</pre>
<pre class="screen">interface LoopBack2</pre>
<pre class="screen"> ip address 8.8.8.8 255.255.255.255</pre>
<pre class="screen"> pim sm</pre>
<pre class="screen">#</pre>
<pre class="screen">rip 3</pre>
<pre class="screen"> network 10.0.0.0</pre>
<pre class="screen"> import-route direct</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p>CE-Rb configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname CE-Rb</pre>
<pre class="screen">#</pre>
<pre class="screen">multicast routing-enable</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.110.9.1 255.255.255.0 </pre>
<pre class="screen"> pim sm</pre>
<pre class="screen"> igmp enable</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/1</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.110.4.2 255.255.255.0 </pre>
<pre class="screen"> pim sm</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/2</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.110.12.1 255.255.255.0</pre>
<pre class="screen"> pim sm</pre>
<pre class="screen">#</pre>
<pre class="screen"> interface loopback 1</pre>
<pre class="screen"> ip address 7.7.7.7 32</pre>
<pre class="screen"> pim sm</pre>
<pre class="screen">#       </pre>
<pre class="screen">pim</pre>
<pre class="screen"> c-bsr Loopback1 </pre>
<pre class="screen"> c-rp Loopback1</pre>
<pre class="screen">#</pre>
<pre class="screen">rip 2</pre>
<pre class="screen"> network 10.0.0.0 </pre>
<pre class="screen"> network 10.0.0.0</pre>
<pre class="screen"> import-route direct</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p>CE-Rc configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname CE-Rc</pre>
<pre class="screen">#</pre>
<pre class="screen">multicast routing-enable</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.110.10.1 255.255.255.0 </pre>
<pre class="screen"> pim sm</pre>
<pre class="screen"> igmp enable</pre>
<pre class="screen"> igmp version 3</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/1</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.110.5.2 255.255.255.0 </pre>
<pre class="screen"> pim sm</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/2</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.110.12.2 255.255.255.0 </pre>
<pre class="screen"> pim sm</pre>
<pre class="screen">#</pre>
<pre class="screen">rip 2</pre>
<pre class="screen"> network 10.0.0.0</pre>
<pre class="screen"> import-route direct</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p>CE-Bc configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname CE-Bc</pre>
<pre class="screen">#</pre>
<pre class="screen">multicast routing-enable</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.110.11.1 255.255.255.0 </pre>
<pre class="screen"> pim sm</pre>
<pre class="screen"> igmp enable</pre>
<pre class="screen"> igmp version 3</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/1</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.110.6.2 255.255.255.0 </pre>
<pre class="screen"> pim sm</pre>
<pre class="screen">#</pre>
<pre class="screen">rip 3</pre>
<pre class="screen"> network 10.0.0.0</pre>
<pre class="screen"> import-route direct</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_multicast_cfg_2133.html">Configuration Examples for an IPv4 Multicast VPN
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_multicast_cfg_2275.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>