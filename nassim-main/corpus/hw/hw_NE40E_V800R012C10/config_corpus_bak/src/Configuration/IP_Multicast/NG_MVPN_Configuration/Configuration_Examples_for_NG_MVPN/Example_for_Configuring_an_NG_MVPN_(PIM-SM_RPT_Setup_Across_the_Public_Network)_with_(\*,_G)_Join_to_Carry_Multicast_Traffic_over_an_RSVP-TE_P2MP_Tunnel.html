
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring an NG MVPN (PIM-SM RPT Setup Across the Public Network) with (*, G) Join to Carry Multicast Traffic over an RSVP-TE P2MP Tunnel">
<meta name="abstract" content="This section provides an example for configuring an NG MVPN (PIM-SM RPT setup across the public network) with (*, G) Join to carry multicast traffic over an RSVP-TE P2MP tunnel.">
<meta name="description" content="This section provides an example for configuring an NG MVPN (PIM-SM RPT setup across the public network) with (*, G) Join to carry multicast traffic over an RSVP-TE P2MP tunnel.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_ngmvpn_0012.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_ngmvpn_0017.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_ngmvpn_0019.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="z00603461,w00606909,w00447999">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="IPv4 Multicast VPN_NG MVPN">
<meta name="featuretype" content="IP Multicast">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="IPv4 Multicast VPN_NG MVPN">
<meta name="featuretype" content="IP Multicast">
<meta name="featurename" content="IPv4 Multicast VPN_NG MVPN">
<meta name="featuretype" content="IP Multicast">
<meta name="featurename" content="IPv4 Multicast VPN_NG MVPN">
<meta name="featuretype" content="IP Multicast">
<meta name="OWNER" content="w00447999">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="w00447999">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001270153521">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring an NG MVPN (PIM-SM RPT Setup Across the Public Network) with (*, G) Join to Carry Multicast Traffic over an RSVP-TE P2MP Tunnel</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001270153521"></a><a name="EN-US_TASK_0000001270153521"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring an NG MVPN (PIM-SM RPT Setup Across the Public Network) with (*, G) Join to Carry Multicast Traffic over an RSVP-TE P2MP Tunnel</h1>
<div class="taskbody"><p>This section provides an example for configuring an NG MVPN (PIM-SM RPT setup across the public network) with (*, G) Join to carry multicast traffic over an RSVP-TE P2MP tunnel.</p>
<div class="context"><a name="EN-US_TASK_0000001270153521__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the single-AS NG MVPN shown in <a href="#EN-US_TASK_0000001270153521__fig_dc_vrp_cfg_ngmvpn_001801">Figure 1</a>, RSVP-TE tunnels have been deployed to carry BGP/MPLS IP VPN services. In this NG MVPN configuration example, users join a multicast group through PIM-SM (*, G) Join messages, and PIM-SM RPTs are set up across the public network.</p>
<div class="fignone" id="EN-US_TASK_0000001270153521__fig_dc_vrp_cfg_ngmvpn_001801"><a name="EN-US_TASK_0000001270153521__fig_dc_vrp_cfg_ngmvpn_001801"></a><a name="fig_dc_vrp_cfg_ngmvpn_001801"></a><span class="figcap"><b>Figure 1 </b>Configuring an NG MVPN (PIM-SM RPT setup across the public network) with (*, G) Join to carry multicast traffic over an RSVP-TE P2MP tunnel</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface1, interface2, and interface3 represent GE <span>0/1/0</span>, GE <span>0/1/1</span>, and GE <span>0/1/2</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0000001270193689.png" width="NaN" height="NaN"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001270153521__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure BGP/MPLS IP VPN to ensure that the unicast VPN is running properly.</p>
</li><li><p>Enable P2MP TE globally and configure a P2MP TE template on PEs so that the PEs can use RSVP-TE to establish P2MP tunnels.</p>
</li><li><p>Establish BGP MVPN peer relationships between the PEs so that the PEs can use BGP to exchange BGP A-D and BGP C-multicast routes (C is short for customer, and C-multicast routes are advertised by a CE).</p>
</li><li><p>Configure PE1 to use RSVP-TE to establish an I-PMSI tunnel so that an RSVP-TE P2MP tunnel is established. Configure PIM-SM RPTs to be set up across the public network.</p>
</li><li><p>Configure PIM-SM on the PEs' interfaces bound to a VPN instance and on the CEs' interfaces connected to the PEs so that VPN multicast routing entries are generated for multicast traffic forwarding.</p>
</li><li><p>Configure a static RP for a VPN instance.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In an NG MVPN scenario, if PIM-SM RPT setup is across the public network and triggered by (*, G) Join messages, a static RP must be configured, either on a PE or CE.</p>
</div></div>
</li><li><p>Configure IGMP on the interfaces connecting a multicast device to a user network segment to allow the device to manage multicast group members on the network segment.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001270153521__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>Loopback1 interface addresses of PE1, PE2, PE3, and CE3 (1.1.1.1, 2.2.2.2, 3.3.3.3, and 4.4.4.4)</p>
</li><li><p>OSPF process on the public network (process 1) in Area 0; OSPF multi-process (process 2) in Area 0</p>
</li><li><p>MPLS LSR IDs of PE1, PE2, and PE3 (1.1.1.1, 2.2.2.2, and 3.3.3.3)</p>
</li><li><p>AS number of PEs (AS 100)</p>
</li><li><p>MVPN IDs of PE1, PE2, and PE3 (1.1.1.1, 2.2.2.2, and 3.3.3.3)</p>
</li><li><p>VPN instance name (VPNA), RDs (100:1, 200:1, and 300:1), and VPN targets (3:3) of PE1, PE2, and PE3</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001270153521__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure BGP/MPLS IP VPN.</span><ol type="a"><li class="substepexpand"><span>Assign an IP address to each interface of devices on the VPN backbone network and VPN sites.</span><p><p>Assign an IP address to each interface according to <a href="#EN-US_TASK_0000001270153521__fig_dc_vrp_cfg_ngmvpn_001801">Figure 1</a>. For configuration details, see <a href="#EN-US_TASK_0000001270153521__example_dc_vrp_cfg_ngmvpn_001801">Configuration Files</a> in this section.</p>
</p></li><li class="substepexpand"><span>Configure an IGP for interworking on the BGP/MPLS IP VPN backbone network.</span><p><p>OSPF is used in this example. For configuration details, see <a href="#EN-US_TASK_0000001270153521__example_dc_vrp_cfg_ngmvpn_001801">Configuration Files</a> in this section.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>To use OSPF in an RSVP-TE P2MP tunnel scenario, you must <a href="dc_vrp_te-p2p_cfg_0005.html">configure IGP TE (OSPF or IS-IS)</a>.</p>
</div></div>
</p></li><li class="substepexpand"><span>Configure basic MPLS functions and enable MPLS TE to establish MPLS TE tunnels on the MPLS backbone network.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>mpls lsr-id 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls] <strong>mpls rsvp-te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls] <strong>mpls te cspf</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>mpls rsvp-te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p>The configuration of PE2 and PE3 is similar to the configuration of PE1. For configuration details, see <a href="#EN-US_TASK_0000001270153521__example_dc_vrp_cfg_ngmvpn_001801">Configuration Files</a> in this section.</p>
</p></li><li class="substepexpand"><span>Establish an MP-IBGP peer relationship between PEs.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 3.3.3.3 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 3.3.3.3 connect-interface LoopBack1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 2.2.2.2 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 2.2.2.2 connect-interface LoopBack1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>ipv4-family vpnv4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-vpnv4] <strong>peer 3.3.3.3 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-vpnv4] <strong>peer 2.2.2.2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-vpnv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p>The configuration of PE2 and PE3 is similar to the configuration of PE1. For configuration details, see <a href="#EN-US_TASK_0000001270153521__example_dc_vrp_cfg_ngmvpn_001801">Configuration Files</a> in this section.</p>
</p></li><li class="substepexpand"><span>Configure a VPN instance on each PE and bind the VPN instance on each PE to its interface connecting to a CE.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>ip vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4] <strong>route-distinguisher 100:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4] <strong>vpn-target 3:3 both</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet<span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>ip binding vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>ip address 192.168.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p>The configuration of PE2 and PE3 is similar to the configuration of PE1. For configuration details, see <a href="#EN-US_TASK_0000001270153521__example_dc_vrp_cfg_ngmvpn_001801">Configuration Files</a> in this section.</p>
</p></li><li class="substepexpand"><span>Configure OSPF multi-instance on each PE to import VPN routes.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>ospf 2 vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-2] <strong>import-route bgp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-2] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-2-area-0.0.0.0] <strong>network 192.168.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-2-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>ipv4-family vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-VPNA] <strong>import-route ospf 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p>The configuration of PE2 and PE3 is similar to the configuration of PE1. For configuration details, see <a href="#EN-US_TASK_0000001270153521__example_dc_vrp_cfg_ngmvpn_001801">Configuration Files</a> in this section.</p>
</p></li><li class="substepexpand"><span># Configure OSPF on each CE.</span><p><p># Configure CE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>ospf 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-ospf-2] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-ospf-2-area-0.0.0.0] <strong>network 10.1.3.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-ospf-2-area-0.0.0.0] <strong>network 10.1.4.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-ospf-2-area-0.0.0.0] <strong>network 192.168.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-ospf-2-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-ospf-2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>commit</strong></pre>
<p>The configuration of CE2 and CE3 is similar to the configuration of CE1. For configuration details, see <a href="#EN-US_TASK_0000001270153521__example_dc_vrp_cfg_ngmvpn_001801">Configuration Files</a> in this section.</p>
<p>After the configurations are complete, run the <a href="cmdqueryname=display+ip+routing-table"><b><span class="cmdname">display ip routing-table</span></b></a> command on CE2. The command outputs show that CE2 has routes to CE1. Run the <a href="cmdqueryname=ping"><b><span class="cmdname">ping</span></b></a> command on CE2 to ping CE1. The command output shows that the ping operation succeeds.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>display ip routing-table</strong></pre>
<pre class="screen"><span class="keyword">Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route</span>
------------------------------------------------------------------------------
Routing Table : _public_
         Destinations : 15       Routes : 15

Destination/Mask    Proto   Pre  Cost        Flags NextHop         Interface

        4.4.4.4/32  OSPF    10   3             D   192.168.2.1     Gigabitethernet<span>0/1/0</span>
       10.1.3.0/24  OSPF    10   4             D   192.168.2.1     Gigabitethernet<span>0/1/0</span>
       10.1.4.0/24  OSPF    10   4             D   192.168.2.1     Gigabitethernet<span>0/1/0</span>
       10.1.5.0/24  Direct  0    0             D   10.1.5.1        Gigabitethernet<span>0/1/1</span>
       10.1.5.1/32  Direct  0    0             D   127.0.0.1       Gigabitethernet<span>0/1/1</span>
     10.1.5.255/32  Direct  0    0             D   127.0.0.1       Gigabitethernet<span>0/1/1</span>
      127.0.0.0/8   Direct  0    0             D   127.0.0.1       InLoopBack0
      127.0.0.1/32  Direct  0    0             D   127.0.0.1       InLoopBack0
127.255.255.255/32  Direct  0    0             D   127.0.0.1       InLoopBack0
    192.168.1.0/24  OSPF    10   3             D   192.168.2.1     Gigabitethernet<span>0/1/0</span>
    192.168.2.0/24  Direct  0    0             D   192.168.2.2     Gigabitethernet<span>0/1/0</span>
    192.168.2.2/32  Direct  0    0             D   127.0.0.1       Gigabitethernet<span>0/1/0</span>
  192.168.2.255/32  Direct  0    0             D   127.0.0.1       Gigabitethernet<span>0/1/0</span>
    192.168.3.0/24  OSPF    10   3             D   192.168.2.1     Gigabitethernet<span>0/1/0</span>
255.255.255.255/32  Direct  0    0             D   127.0.0.1       InLoopBack0</pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>ping 10.1.3.1</strong></pre>
<pre class="screen">  PING 10.1.3.1: 56  data bytes, press CTRL_C to break
    Reply from 10.1.3.1: bytes=56 Sequence=1 ttl=253 time=5 ms
    Reply from 10.1.3.1: bytes=56 Sequence=2 ttl=253 time=2 ms
    Reply from 10.1.3.1: bytes=56 Sequence=3 ttl=253 time=2 ms
    Reply from 10.1.3.1: bytes=56 Sequence=4 ttl=253 time=2 ms
    Reply from 10.1.3.1: bytes=56 Sequence=5 ttl=253 time=1 ms

  --- 10.1.3.1 ping statistics ---
    5 packet(s) transmitted
    5 packet(s) received
    0.00% packet loss
    round-trip min/avg/max = 1/2/5 ms                 </pre>
</p></li></ol>
</li><li><span>Enable P2MP TE globally and configure a P2MP TE template.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls] <strong>mpls te p2mp-te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls te p2mp-template t1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-te-p2mp-template-t1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls] <strong>mpls te p2mp-te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>mpls te p2mp-template t1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-te-p2mp-template-t1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-mpls] <strong>mpls te p2mp-te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
</p></li><li><span>Establish a BGP MVPN peer relationship between the PEs.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>ipv4-family mvpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-mvpn] <strong>peer 2.2.2.2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-mvpn] <strong>peer 3.3.3.3 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-mvpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p>The configuration of PE2 and PE3 is similar to the configuration of PE1. For configuration details, see <a href="#EN-US_TASK_0000001270153521__example_dc_vrp_cfg_ngmvpn_001801">Configuration Files</a> in this section.</p>
<p>After completing the configurations, run the <a href="cmdqueryname=display+bgp+mvpn+all+peer"><b><span class="cmdname">display bgp mvpn all peer</span></b></a> command on the PEs. The command output shows that PE3 has established a BGP MVPN peer relationship with PE1 and PE2. The following example uses the command output on PE3:</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>display bgp mvpn all peer</strong></pre>
<pre class="screen"> BGP local router ID : 10.1.1.2
 Local AS number : 100
 Total number of peers : 2                 Peers in established state : 2

  Peer            V          AS  MsgRcvd  MsgSent  OutQ  Up/Down       State  PrefRcv
  1.1.1.1         4         100      159      227     0 02:52:24 <strong>Established</strong>    1
  2.2.2.2         4         100      148      226     0 02:52:26 <strong>Established</strong>    1</pre>
</p></li><li><span>Configure devices to use RSVP-TE to establish an I-PMSI tunnel, and configure PIM-SM RPTs to be set up across the public network.</span><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>To configure PIM-SM RPTs to be set up across the public network, run the <a href="cmdqueryname=rpt-spt+mode"><b><span class="cmdname">rpt-spt mode</span></b></a> command. PEs in the same VPN instance must use the same PIM-SM RPT setup mode.</p>
</div></div>
<ul><li><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>multicast mvpn 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>ip vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4] <strong>multicast routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4] <strong>mvpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4-mvpn] <strong>sender-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4-mvpn] <strong>c-multicast signaling bgp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4-mvpn] <strong>rpt-spt mode</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4-mvpn] <strong>ipmsi-tunnel</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4-mvpn-ipmsi] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4-mvpn-ipmsi-mpls-te] <strong>p2mp-template t1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4-mvpn-ipmsi-mpls-te] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4-mvpn-ipmsi] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4-mvpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</li><li><p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>multicast mvpn 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>ip vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA-af-ipv4] <strong>multicast routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA-af-ipv4] <strong>mvpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA-af-ipv4-mvpn] <strong>sender-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA-af-ipv4-mvpn] <strong>c-multicast signaling bgp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA-af-ipv4-mvpn] <strong>rpt-spt mode</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA-af-ipv4-mvpn] <strong>ipmsi-tunnel</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA-af-ipv4-mvpn-ipmsi] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA-af-ipv4-mvpn-ipmsi-mpls-te] <strong>p2mp-template t1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA-af-ipv4-mvpn-ipmsi-mpls-te] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA-af-ipv4-mvpn-ipmsi] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA-af-ipv4-mvpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</li><li><p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>multicast mvpn 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>ip vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-VPNA] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-VPNA-af-ipv4] <strong>multicast routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-VPNA-af-ipv4] <strong>mvpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-VPNA-af-ipv4-mvpn] <strong>rpt-spt mode</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-VPNA-af-ipv4-mvpn] <strong>c-multicast signaling bgp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-VPNA-af-ipv4-mvpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-VPNA-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
</li></ul>
</p></li><li><span>Configure PIM-SM.</span><p><ul><li><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface gigabitethernet<span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p>The configuration of PE2 and PE3 is similar to the configuration of PE1. For configuration details, see <a href="#EN-US_TASK_0000001270153521__example_dc_vrp_cfg_ngmvpn_001801">Configuration Files</a> in this section.</p>
</li><li><p># Configure CE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>multicast routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>interface gigabitethernet<span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/1</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>interface gigabitethernet<span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/2</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>commit</strong></pre>
<p>The configuration of CE2 and CE3 is similar to the configuration of CE1. For configuration details, see <a href="#EN-US_TASK_0000001270153521__example_dc_vrp_cfg_ngmvpn_001801">Configuration Files</a> in this section.</p>
</li></ul>
</p></li><li><span>Configure a static RP for the VPN instance.</span><p><ul><li><p># Configure CE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>pim</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-pim] <strong>static-rp 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-pim] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>commit</strong></pre>
</li><li><p># Configure CE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE3] <strong>interface LoopBack1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-LoopBack1] <strong>ip address 4.4.4.4 255.255.255.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-LoopBack1] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3] <strong>pim</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-pim] <strong>static-rp 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-pim] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3] <strong>commit</strong></pre>
</li><li><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>pim vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-pim-VPNA] <strong>static-rp 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-pim-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</li><li><p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>pim vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-pim-VPNA] <strong>static-rp 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-pim-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</li><li><p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>pim vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-pim-VPNA] <strong>static-rp 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-pim-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
</li><li><p># Configure CE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>pim</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-pim] <strong>static-rp 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-pim] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>commit</strong></pre>
</li></ul>
</p></li><li><span>Configure IGMP.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>interface gigabitethernet<span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>] <strong>igmp enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>] <strong>igmp static-group 225.0.0.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>commit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p>After the configurations are complete, an NG MVPN with (*, G) join is configured. In this example, multicast source (10.1.3.0/24) in the PIM-SM domain sends multicast traffic to multicast group G (225.0.0.1). The receiver joins multicast group G and receives multicast traffic from this group. Run the <a href="cmdqueryname=display+pim+routing-table"><b><span class="cmdname">display pim routing-table</span></b></a> command to check whether multicast routing entries are correctly generated and whether the NG MVPN with (*, G) join is successfully configured.</p>
<p>Run the <a href="cmdqueryname=display+pim+vpn-instance"><b><span class="cmdname">display pim vpn-instance</span></b></a> <strong><span>routing-table</span></strong> command on the PEs to check their PIM routing tables of the VPN instance.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display pim vpn-instance VPNA routing-table</strong></pre>
<pre class="screen"> VPN-Instance: VPNA
 Total 0 (*, G) entry; 1 (S, G) entry

 (10.1.3.100, 225.0.0.1)
     RP: 4.4.4.4
     Protocol: pim-sm, Flag: SPT ACT SG_RCVR 2BGP
     UpTime: 02:05:57
     Upstream interface: GigabitEthernet<span>0/1/1</span>
         Upstream neighbor: 192.168.1.1
         RPF prime neighbor: 192.168.1.1
     Downstream interface(s) information:
     Total number of downstreams: 1
        1: pseudo
             Protocol: BGP, UpTime: 00:02:08, Expires: -          </pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>display pim vpn-instance VPNA routing-table</strong></pre>
<pre class="screen"> VPN-Instance: VPNA
 Total 1 (*, G) entry; 1 (S, G) entry

 (*, 225.0.0.1)
     RP: 4.4.4.4
     Protocol: pim-sm, Flag: WC
     UpTime: 00:03:28
     Upstream interface: GigabitEthernet<span>0/1/1</span>
         Upstream neighbor: 192.168.3.1
         RPF prime neighbor: 192.168.3.1
     Downstream interface(s) information:
     Total number of downstreams: 1
        1: pseudo
             Protocol: BGP, UpTime: 00:03:28, Expires: -

 (10.1.3.100, 225.0.0.1)
     RP: 4.4.4.4
     Protocol: pim-sm, Flag: RPT ACT BGP
     UpTime: 02:04:15
     Upstream interface: GigabitEthernet<span>0/1/1</span>
         Upstream neighbor: 192.168.3.1
         RPF prime neighbor: 192.168.3.1
     Downstream interface(s) information: none
</pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>display pim vpn-instance VPNA routing-table</strong></pre>
<pre class="screen"> VPN-Instance: VPNA
 Total 1 (*, G) entry; 1 (S, G) entry

 (*, 225.0.0.1)
     RP: 4.4.4.4
     Protocol: pim-sm, Flag: WC
     UpTime: 00:02:48
     Upstream interface: through-BGP
         Upstream neighbor: 2.2.2.2
         RPF prime neighbor: 2.2.2.2
     Downstream interface(s) information:
     Total number of downstreams: 1
        1: GigabitEthernet<span>0/1/1</span>
             Protocol: pim-sm, UpTime: 00:02:48, Expires: 00:02:12

 (10.1.3.100, 225.0.0.1)
     RP: 4.4.4.4
     Protocol: pim-sm, Flag: RPT SPT ACT BGP
     UpTime: 00:02:45
     Upstream interface: through-BGP
         Upstream neighbor: 1.1.1.1
         RPF prime neighbor: 1.1.1.1
     Downstream interface(s) information:
     Total number of downstreams: 1
        1: GigabitEthernet<span>0/1/1</span>
             Protocol: pim-sm, UpTime: 00:02:45, Expires: 00:02:14     </pre>
<p>Run the <a href="cmdqueryname=display+pim+routing-table"><b><span class="cmdname">display pim routing-table</span></b></a> command on the CEs to check the PIM routing tables.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>display pim routing-table</strong></pre>
<pre class="screen"> VPN-Instance: public net
 Total 0 (*, G) entry; 1 (S, G) entry

 (10.1.3.100, 225.0.0.1)
     RP: 4.4.4.4
     Protocol: pim-sm, Flag: SPT LOC ACT
     UpTime: 04:07:50
     Upstream interface: GigabitEthernet<span>0/1/0</span>
         Upstream neighbor: NULL
         RPF prime neighbor: NULL
     Downstream interface(s) information:
     Total number of downstreams: 1
        1: GigabitEthernet<span>0/1/1</span>
             Protocol: pim-sm, UpTime: 00:04:15, Expires: 00:03:02
                                                                        </pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>display pim routing-table</strong></pre>
<pre class="screen"> VPN-Instance: public net
 Total 1 (*, G) entry; 1 (S, G) entry

 (*, 225.0.0.1)
     RP: 4.4.4.4
     Protocol: pim-sm, Flag: WC
     UpTime: 03:53:23
     Upstream interface: GigabitEthernet<span>0/1/0</span>
         Upstream neighbor: 192.168.2.1
         RPF prime neighbor: 192.168.2.1
     Downstream interface(s) information:
     Total number of downstreams: 1
        1: GigabitEthernet<span>0/1/1</span>
             Protocol: static, UpTime: 03:53:23, Expires: -

 (10.1.3.100, 225.0.0.1)
     RP: 4.4.4.4
     Protocol: pim-sm, Flag: SPT ACT
     UpTime: 00:04:50
     Upstream interface: GigabitEthernet<span>0/1/0</span>
         Upstream neighbor: 192.168.2.1
         RPF prime neighbor: 192.168.2.1
     Downstream interface(s) information:
     Total number of downstreams: 1
        1: GigabitEthernet<span>0/1/1</span>
             Protocol: pim-sm, UpTime: 00:04:50, Expires: -   </pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE3] <strong>display pim routing-table</strong></pre>
<pre class="screen"> VPN-Instance: public net
 Total 1 (*, G) entry; 1 (S, G) entry

 (*, 225.0.0.1)
     RP: 4.4.4.4 (local)
     Protocol: pim-sm, Flag: WC
     UpTime: 00:08:31
     Upstream interface: Register
         Upstream neighbor: NULL
         RPF prime neighbor: NULL
     Downstream interface(s) information:
     Total number of downstreams: 1
        1: GigabitEthernet<span>0/1/1</span>
             Protocol: pim-sm, UpTime: 00:05:08, Expires: 00:03:22

 (10.1.3.100, 225.0.0.1)
     RP: 4.4.4.4 (local)
     Protocol: pim-sm, Flag: RPT 2MSDP ACT
     UpTime: 04:02:03
     Upstream interface: Register
         Upstream neighbor: NULL
         RPF prime neighbor: NULL
     Downstream interface(s) information: none   </pre>
<p>The command output shows that PE2 connected to the RP has received a Join message from PE3 connected to a receiver, created a (*, G) entry, and implemented a switchover from an RPT to an SPT. (S, G) PIM routing entries have been created successfully, and the receiver can receive multicast data from the multicast source 10.1.3.100.</p>
<p>Run the <a href="cmdqueryname=display+mvpn+vpn-instance"><b><span class="cmdname">display mvpn vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i> <strong><span>ipmsi verbose</span></strong> command on the PEs to check I-PMSI tunnel establishment. The following example uses the command output on PE3:</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>display mvpn vpn-instance VPNA ipmsi verbose</strong></pre>
<pre class="screen">MVPN local I-PMSI information for VPN-Instance: VPNA
Tunnel type: RSVP-TE P2MP LSP
Tunnel state: --
P2MP ID: 0x1010101
Tunnel ID: 32769
Extended tunnel ID: 1.1.1.1
Root: 1.1.1.1
Leaf:
  1: 3.3.3.3 (local)
Total number of (S, G): 1
    1. (10.1.3.100, 225.0.0.1)

Tunnel type: RSVP-TE P2MP LSP
Tunnel state: --
P2MP ID: 0x2020202
Tunnel ID: 32769
Extended tunnel ID: 2.2.2.2
Root: 2.2.2.2
Leaf:
  1: 3.3.3.3 (local)  </pre>
<p>The command outputs show that two RSVP-TE P2MP tunnels have been established, with PE1 and PE2 as the root nodes and PE3 as a leaf node.</p>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0000001270153521__example_dc_vrp_cfg_ngmvpn_001801"><a name="EN-US_TASK_0000001270153521__example_dc_vrp_cfg_ngmvpn_001801"></a><a name="example_dc_vrp_cfg_ngmvpn_001801"></a><a name="EN-US_TASK_0000001270153521__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>CE1 configuration file</p>
<pre class="screen">#
sysname CE1
#
multicast routing-enable
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.3.1 255.255.255.0
 pim sm
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 192.168.1.1 255.255.255.0
 pim sm
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ip address 10.1.4.1 255.255.255.0
 pim sm
#
ospf 2
 area 0.0.0.0
  network 10.1.3.0 0.0.0.255
  network 10.1.4.0 0.0.0.255
  network 192.168.1.0 0.0.0.255
#
pim
 static-rp 4.4.4.4
#
return
</pre>
</li><li><p>CE3 configuration file</p>
<pre class="screen">#
sysname CE3
#
multicast routing-enable
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.4.2 255.255.255.0
 pim sm
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 192.168.3.1 255.255.255.0
 pim sm
#
interface LoopBack1
 ip address 4.4.4.4 255.255.255.255
 pim sm
#
ospf 2
 area 0.0.0.0
  network 4.4.4.4 0.0.0.0
  network 10.1.4.0 0.0.0.255
  network 192.168.3.0 0.0.0.255
#
pim
 static-rp 4.4.4.4
#
return
</pre>
</li><li><p>PE1 configuration file</p>
<pre class="screen">#
sysname PE1
#
multicast mvpn 1.1.1.1
#
ip vpn-instance VPNA
 ipv4-family
  route-distinguisher 100:1
  apply-label per-instance
  vpn-target 3:3 export-extcommunity
  vpn-target 3:3 import-extcommunity
  multicast routing-enable
  mvpn
   sender-enable
   c-multicast signaling bgp
   rpt-spt mode
   ipmsi-tunnel
    mpls te
     p2mp-template t1
#
mpls lsr-id 1.1.1.1
#
mpls
 mpls te
 mpls te p2mp-te
 mpls rsvp-te
 mpls te cspf
#
mpls te p2mp-template t1
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.1.1 255.255.255.0
 mpls
 mpls te
 mpls rsvp-te
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip binding vpn-instance VPNA
 ip address 192.168.1.2 255.255.255.0
 pim sm
#
interface LoopBack1
 ip address 1.1.1.1 255.255.255.255
#
bgp 100
 peer 2.2.2.2 as-number 100
 peer 2.2.2.2 connect-interface LoopBack1
 peer 3.3.3.3 as-number 100
 peer 3.3.3.3 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 2.2.2.2 enable
  peer 3.3.3.3 enable
 #
 ipv4-family mvpn
  policy vpn-target
  peer 2.2.2.2 enable
  peer 3.3.3.3 enable
 #
 ipv4-family vpnv4
  policy vpn-target
  peer 2.2.2.2 enable
  peer 3.3.3.3 enable
 #
 ipv4-family vpn-instance VPNA
  import-route ospf 2
#
ospf 1
 opaque-capability enable
 area 0.0.0.0
  network 1.1.1.1 0.0.0.0
  network 10.1.1.0 0.0.0.255
  mpls-te enable
#
ospf 2 vpn-instance VPNA
 import-route bgp
 area 0.0.0.0
  network 192.168.1.0 0.0.0.255
#
pim vpn-instance VPNA
 static-rp 4.4.4.4
#
return
</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#
sysname PE2
#
multicast mvpn 2.2.2.2
#
ip vpn-instance VPNA
 ipv4-family
  route-distinguisher 200:1
  apply-label per-instance
  vpn-target 3:3 export-extcommunity
  vpn-target 3:3 import-extcommunity
  multicast routing-enable
  mvpn
   sender-enable
   c-multicast signaling bgp
   rpt-spt mode
   ipmsi-tunnel
    mpls te
     p2mp-template t1
#
mpls lsr-id 2.2.2.2
#
mpls
 mpls te
 mpls te p2mp-te
 mpls rsvp-te
 mpls te cspf
#
mpls te p2mp-template t1
#
mpls ldp
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip binding vpn-instance VPNA
 ip address 192.168.3.2 255.255.255.0
 pim sm
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ip address 10.1.2.1 255.255.255.0
 mpls
 mpls te
 mpls rsvp-te
#
interface LoopBack1
 ip address 2.2.2.2 255.255.255.255
#
bgp 100
 peer 1.1.1.1 as-number 100
 peer 1.1.1.1 connect-interface LoopBack1
 peer 3.3.3.3 as-number 100
 peer 3.3.3.3 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 1.1.1.1 enable
  peer 3.3.3.3 enable
 #
 ipv4-family mvpn
  policy vpn-target
  peer 1.1.1.1 enable
  peer 3.3.3.3 enable
 #
 ipv4-family vpnv4
  policy vpn-target
  peer 1.1.1.1 enable
  peer 3.3.3.3 enable
 #
 ipv4-family vpn-instance VPNA
  import-route ospf 2
#
ospf 1
 opaque-capability enable
 area 0.0.0.0
  network 2.2.2.2 0.0.0.0
  network 10.1.2.0 0.0.0.255
  mpls-te enable
#
ospf 2 vpn-instance VPNA
 import-route bgp
 area 0.0.0.0
  network 192.168.3.0 0.0.0.255
#
pim vpn-instance VPNA
 static-rp 4.4.4.4
#
return
</pre>
</li><li><p>PE3 configuration file</p>
<pre class="screen">#
sysname PE3
#
multicast mvpn 3.3.3.3
#
ip vpn-instance VPNA
 ipv4-family
  route-distinguisher 300:1
  apply-label per-instance
  vpn-target 3:3 export-extcommunity
  vpn-target 3:3 import-extcommunity
  multicast routing-enable
  mvpn
   c-multicast signaling bgp
   rpt-spt mode
#
mpls lsr-id 3.3.3.3
#
mpls
 mpls te
 mpls te p2mp-te
 mpls rsvp-te
 mpls te cspf
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.1.2 255.255.255.0
 mpls
 mpls te
 mpls rsvp-te
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip binding vpn-instance VPNA
 ip address 192.168.2.1 255.255.255.0
 pim sm
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ip address 10.1.2.2 255.255.255.0
 mpls
 mpls te
 mpls rsvp-te
#
interface LoopBack1
 ip address 3.3.3.3 255.255.255.255
#
bgp 100
 peer 1.1.1.1 as-number 100
 peer 1.1.1.1 connect-interface LoopBack1
 peer 2.2.2.2 as-number 100
 peer 2.2.2.2 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 1.1.1.1 enable
  peer 2.2.2.2 enable
 #
 ipv4-family mvpn
  policy vpn-target
  peer 1.1.1.1 enable
  peer 2.2.2.2 enable
 #
 ipv4-family vpnv4
  policy vpn-target
  peer 1.1.1.1 enable
  peer 2.2.2.2 enable
 #
 ipv4-family vpn-instance VPNA
  import-route ospf 2
#
ospf 1
 opaque-capability enable
 area 0.0.0.0
  network 3.3.3.3 0.0.0.0
  network 10.1.1.0 0.0.0.255
  network 10.1.2.0 0.0.0.255
  mpls-te enable
#
ospf 2 vpn-instance VPNA
 import-route bgp
 area 0.0.0.0
  network 192.168.2.0 0.0.0.255
#
pim vpn-instance VPNA
 static-rp 4.4.4.4
#
return</pre>
</li><li><p>CE2 configuration file</p>
<pre class="screen">#
sysname CE2
#
multicast routing-enable
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 192.168.2.2 255.255.255.0
 pim sm
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 10.1.5.1 255.255.255.0
 pim sm
 igmp enable
 igmp static-group 225.0.0.1
#
ospf 2
 area 0.0.0.0
  network 10.1.5.0 0.0.0.255
  network 192.168.2.0 0.0.0.255
#
pim
 static-rp 4.4.4.4 
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_ngmvpn_0012.html">Configuration Examples for NG MVPN
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_ngmvpn_0017.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_ngmvpn_0019.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>