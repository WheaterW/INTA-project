
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring the Layer 2 Multicast Entry Limit in a VSI Scenario">
<meta name="abstract" content="This section provides an example for configuring the Layer 2 multicast entry limit in a VSI scenario.">
<meta name="description" content="This section provides an example for configuring the Layer 2 multicast entry limit in a VSI scenario.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2mc_cfg_0033.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2mc_cfg_0058.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2mc_cfg_063.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="z00603461,w00800033,l2multicastvrp,c00549182,w00556928,w00437000,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="Layer 2 Multicast">
<meta name="featuretype" content="IP Multicast">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="Layer 2 Multicast">
<meta name="featuretype" content="IP Multicast">
<meta name="featurename" content="Layer 2 Multicast">
<meta name="featuretype" content="IP Multicast">
<meta name="featurename" content="Layer 2 Multicast">
<meta name="featuretype" content="IP Multicast">
<meta name="OWNER" content="w00447999">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="c00549182">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172367994">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>Example for Configuring the Layer 2 Multicast Entry Limit in a VSI Scenario</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172367994"></a><a name="EN-US_TASK_0172367994"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring the Layer 2 Multicast Entry Limit in a VSI Scenario</h1>
<div class="taskbody"><p>This section provides an example for configuring the Layer 2 multicast entry limit in a VSI scenario.</p>
<div class="context"><a name="EN-US_TASK_0172367994__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the VPLS network shown in <a href="#EN-US_TASK_0172367994__fig_dc_vrp_l2mc_cfg_005601">Figure 1</a>, PE1, PE2, and PE3 are responsible for transmitting multicast data from the IPTV server to downstream receivers.</p>
<p>To control the multicast group number over the VPLS network, configure the Layer 2 multicast entry limit for the VSI on PEs to prevent the bandwidth resources from exceeding the total bandwidth of the aggregation network and ensure service quality for most subscribers. </p>
<p>The Layer 2 multicast entry limit configurations for PEs on the VPLS network are as follows:</p>
<ul><li>On PE1, limit the number of multicast groups to 10 in the VSI <strong>vsi1</strong>.</li><li>On PE3, limit the number of multicast groups on the PW (with the remote-peer address of 1.1.1.1) to 10.</li></ul>
<div class="fignone" id="EN-US_TASK_0172367994__fig_dc_vrp_l2mc_cfg_005601"><a name="EN-US_TASK_0172367994__fig_dc_vrp_l2mc_cfg_005601"></a><a name="fig_dc_vrp_l2mc_cfg_005601"></a><span class="figcap"><b>Figure 1 </b>Layer 2 multicast entry limit for a VSI</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 through 3 in this example represent GE<span>0/1/0</span>, GE<span>0/1/1</span>, and GE<span>0/1/2</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_l2mc_cfg_005601.png" width="NaN" height="NaN"></span><br></div>

<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" frame="border" border="1" rules="all"><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="33.33333333333333%" id="mcps1.4.1.7.1.4.1.1" liSelected="liSelected"><p>Device</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="33.33333333333333%" id="mcps1.4.1.7.1.4.1.2" liSelected="liSelected"><p>Interface</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="33.33333333333333%" id="mcps1.4.1.7.1.4.1.3" liSelected="liSelected"><p>IP Address</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" rowspan="2" char="." valign="top" width="33.33333333333333%" headers="mcps1.4.1.7.1.4.1.1 "><p>PE1</p>
</td>
<td class="cellrowborder" char="." valign="top" width="33.33333333333333%" headers="mcps1.4.1.7.1.4.1.2 "><p>GE <span>0/1/1</span></p>
</td>
<td class="cellrowborder" char="." valign="top" width="33.33333333333333%" headers="mcps1.4.1.7.1.4.1.3 "><p>192.168.0.1/30</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.7.1.4.1.2 "><p>GE <span>0/1/2</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.7.1.4.1.3 "><p>192.168.1.1/30</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" width="33.33333333333333%" headers="mcps1.4.1.7.1.4.1.1 "><p>PE2</p>
</td>
<td class="cellrowborder" char="." valign="top" width="33.33333333333333%" headers="mcps1.4.1.7.1.4.1.2 "><p>GE <span>0/1/0</span></p>
</td>
<td class="cellrowborder" char="." valign="top" width="33.33333333333333%" headers="mcps1.4.1.7.1.4.1.3 "><p>192.168.1.2/30</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" width="33.33333333333333%" headers="mcps1.4.1.7.1.4.1.1 "><p>PE3</p>
</td>
<td class="cellrowborder" char="." valign="top" width="33.33333333333333%" headers="mcps1.4.1.7.1.4.1.2 "><p>GE <span>0/1/0</span></p>
</td>
<td class="cellrowborder" char="." valign="top" width="33.33333333333333%" headers="mcps1.4.1.7.1.4.1.3 "><p>192.168.0.2/30</p>
</td>
</tr>
</tbody>
</table>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172367994__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure basic MPLS and L2VPN functions on each device to ensure that multicast services run properly on the L2VPN.</p>
</li><li><p>Create the VSI on each device and create a PW between PE1 and PE3 so that virtual tunnels can be set up between them.</p>
</li><li><p>Configure IGMP snooping globally and in the VSI to manage the forwarding of multicast data packets to implement on-demand multicast data distribution on the Layer 2 VPLS network and reduce bandwidth usage at both the user side and network side.</p>
</li><li><p>Configure the multicast group number limit for the VSI on PE1.</p>
</li><li><p>Configure the multicast group number limit for the PW on PE3.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172367994__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>IP addresses of the interfaces and loopback address of each device</p>
</li><li><p>IP routing protocol (IS-IS is used in this example and the process ID is 1)</p>
</li><li><p>MPLS Label Switch Router (LSR) ID of each device (consistent with loopback address of each device)</p>
</li><li><p>VSI name (<strong>vsi1</strong> is used in this example) used to set up a PW between PEs</p>
</li><li><p>Sub-interface bound to the VSI on PE1 and PE3 and VLAN to which users belong (GE <span>0/1/1</span>.1 and VLAN 11)</p>
</li><li><p>Multicast group number limit</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172367994__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure IS-IS to make router interfaces reachable. (Configuration procedures are not detailed here.)</span></li><li><span>Enable MPLS and Label Distribution Protocol (LDP) on the MPLS backbone network and enable L2VPN. (Configuration procedures are not detailed here.)</span></li><li><span>Enable MPLS L2VPN and configure a VSI.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>vsi vsi1 static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1] <strong>pwsignal ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1-ldp] <strong>vsi-id 123</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1-ldp] <strong>peer 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>vsi vsi1 static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vsi1] <strong>pwsignal ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vsi1-ldp] <strong>vsi-id 123</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vsi1-ldp] <strong>peer 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vsi1-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vsi1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
</p></li><li><span>Bind the VSI to a sub-interface on each PE.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface gigabitethernet<span>0/1/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1] <strong>vlan-type dot1q 11</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1] <strong>l2 binding vsi vsi1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>interface gigabitethernet<span>0/1/1</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/0</span>.1] <strong>vlan-type dot1q 11</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/0</span>.1] <strong>l2 binding vsi vsi1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/0</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
</p></li><li><span>After the preceding configurations are complete, run the <a href="cmdqueryname=display+vsi"><b><span class="cmdname">display vsi</span></b></a> command on each device to check the VSI status.</span><p><p>The following example uses the command output on PE1. The command output shows that the VSI is Up.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> display vsi</strong></pre>
<pre class="screen">Total VSI number is 1, 1 is up, 0 is down, 1 is LDP mode, 0 is BGP mode

Vsi                             Mem    PW   Mac       Encap     Mtu   Vsi
Name                            Disc   Type Learn     Type      Value State
--------------------------------------------------------------------------
vsi1                            static ldp  unqualify vlan      1500  <strong>up</strong></pre>
</p></li><li><span>Enable IGMP snooping globally and for the VSI on PE1 and PE3.</span><p><p># Configure PE1. The configurations on PE3 are similar to those on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>igmp-snooping enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>vsi vsi1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1] <strong>igmp-snooping enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</p></li><li><span>Configure GE <span>0/1/0</span>.1 on PE1 a static router port.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface gigabitethernet <span>0/1/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/0</span>.1] <strong>igmp-snooping static-router-port vsi vsi1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</p></li><li><span>Configure the multicast group number limit for the VSI on PE1.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>vsi vsi1</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-vsi-vsi1] <strong>l2-multicast limit max-entry 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</p></li><li><span>Configure the multicast group number limit for the PW on PE3.</span><p><p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>vsi vsi1</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3-vsi-vsi1] <strong>pwsignal ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vsi1-ldp] <strong>l2-multicast limit max-entry 10 remote-peer 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vsi1-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vsi1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p># After completing the configurations, run the <strong>display l2-multicast limit</strong> command on PE1 to view the configured entry limit information. The command output is as follows:</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong> display l2-multicast limit</strong></pre>
<pre class="screen">L2-multicast limit information
------------------------------------------------------------------------------
                                               ConfigEntries 
                                               CurrentEntries
------------------------------------------------------------------------------
VSI vsi1 limit information:
------------------------------------------------------------------------------
                                               10           
                                               5</pre>
<p># Run the <strong>display l2-multicast limit</strong> command on PE3 to view the configured entry limit information. The command output is as follows:</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3]<strong> display l2-multicast limit</strong>
L2-multicast limit information
------------------------------------------------------------------------------
                                               ConfigEntries 
                                               CurrentEntries
------------------------------------------------------------------------------
PW(Peer:1.1.1.1, VCID:111) limit information:
------------------------------------------------------------------------------
                                               10           
                                               3 
------------------------------------------------------------------------------</pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172367994__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>PE1 configuration file</p>
<pre class="screen">#
sysname PE1
#
vlan batch 11
#
igmp-snooping enable
#
mpls lsr-id 1.1.1.1
 mpls
#
 mpls l2vpn
#
vsi vsi1 static
 pwsignal ldp
  vsi-id 123
  peer 3.3.3.3
 igmp-snooping enable
 l2-multicast limit max-entry 10
#
mpls ldp
#
isis 1
 is-level level-1
 network-entity 49.0010.0100.1001.00
#
interface GigabitEthernet<span>0/1/0</span>.1
 vlan-type dot1q 11
 l2 binding vsi vsi1
 igmp-snooping static-router-port vsi vsi1
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 192.168.0.1 255.255.255.252
 isis enable 1
 mpls
 mpls ldp
#
interface LoopBack0
 ip address 1.1.1.1 255.255.255.255
 isis enable 1
#
return
</pre>
</li><li><p>PE3 configuration file</p>
<pre class="screen">#
sysname PE3
#
vlan batch 11
#
mpls lsr-id 3.3.3.3
 mpls
#
 mpls l2vpn
#
vsi vsi1 static
 pwsignal ldp
  vsi-id 123
  peer 1.1.1.1
  l2-multicast limit max-entry 10 remote-peer 1.1.1.1
#
mpls ldp
#
isis 1
 is-level level-1
 network-entity 49.0030.0300.3003.00
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 192.168.0.2 255.255.255.0
 isis enable 1
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/1</span>.1
 vlan-type dot1q 11
 l2 binding vsi vsi1
#
interface LoopBack0
 ip address 3.3.3.3 255.255.255.255
 isis enable 1
#
return
</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2mc_cfg_0033.html">Configuration Examples for Layer 2 Multicast
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2mc_cfg_0058.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2mc_cfg_063.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>