
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring Dual-Root 1+1 Protection">
<meta name="abstract" content="Configuring dual-root 1+1 protection accelerates multicast service convergence and improves reliability in case a sender PE on a P2MP tunnel fails.">
<meta name="description" content="Configuring dual-root 1+1 protection accelerates multicast service convergence and improves reliability in case a sender PE on a P2MP tunnel fails.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_ngmvpn_0000.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_ngmvpn_0118.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_ngmvpn_0012.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="z00603461,w00606909,w00447999">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="IPv4 Multicast VPN_NG MVPN">
<meta name="featuretype" content="IP Multicast">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="IPv4 Multicast VPN_NG MVPN">
<meta name="featuretype" content="IP Multicast">
<meta name="featurename" content="IPv4 Multicast VPN_NG MVPN">
<meta name="featuretype" content="IP Multicast">
<meta name="OWNER" content="w00447999">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="c00549182">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001270153613">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring Dual-Root 1+1 Protection</title>
</head>
<body><a name="EN-US_TASK_0000001270153613"></a><a name="EN-US_TASK_0000001270153613"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring Dual-Root 1+1 Protection</h1>
<div class="taskbody"><p>Configuring dual-root 1+1 protection accelerates multicast service convergence and improves reliability in case a sender PE on a P2MP tunnel fails.</p>
<div class="context"><a name="EN-US_TASK_0000001270153613__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Usage Scenario</h4><div class="p">In an NG MVPN scenario, if a sender PE on a P2MP tunnel fails, the VPN multicast service will be interrupted. The network can rely only on unicast route convergence for recovery. However, unicast route convergence takes a long time and may fail to meet the high reliability requirements of some multicast services. To resolve this problem, configure dual-root 1+1 protection. On the network shown in <a href="#EN-US_TASK_0000001270153613__fig_dc_vrp_cfg_ngmvpn_001501">Figure 1</a>, a primary P2MP tunnel is established with PE1 as the root node, and a backup P2MP tunnel is established with PE2 as the root node. When the links are working properly, multicast traffic is forwarded through both the primary and backup tunnels bidirectionally. The leaf node PE3 selects the multicast traffic received from the primary tunnel and discards the multicast traffic received from the backup tunnel. If PE1 or a public network link fails, PE3 can use BFD for P2MP TE/mLDP or traffic detection to quickly detect the P2MP tunnel fault and choose to accept the multicast traffic received from the backup tunnel. This accelerates multicast service convergence and improves reliability.<div class="fignone" id="EN-US_TASK_0000001270153613__fig_dc_vrp_cfg_ngmvpn_001501"><a name="EN-US_TASK_0000001270153613__fig_dc_vrp_cfg_ngmvpn_001501"></a><a name="fig_dc_vrp_cfg_ngmvpn_001501"></a><span class="figcap"><b>Figure 1 </b>Configuring dual-root 1+1 protection</span><br><span><img class="vsd" src="figure/en-us_image_0000001225833828.png" width="NaN" height="NaN"></span></div>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001270153613__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Pre-configuration Tasks</h4><div class="p">Before configuring BFD for P2MP TE/mLDP based dual-root 1+1 protection, complete the following tasks:<ul><li><p>RSVP-TE P2MP Tunnel:</p>
<ul><li><p>Configure NG MVPN.</p>
</li><li><p><span><a href="dc_vrp_te-p2p_cfg_0198.html">Configure BFD for P2MP TE</a></span> on the root nodes.</p>
</li><li><p><a href="dc_vrp_mpls-l3vpn-v4_cfg_2017.html">Configure VPN FRR</a> on the leaf nodes.</p>
</li><li><p>Globally enable BFD on the root and leaf nodes.</p>
</li></ul>
</li><li><p>mLDP P2MP Tunnel:</p>
<ul><li><p>Configure NG MVPN.</p>
</li><li><p><a href="dc_vrp_ldp-p2p_cfg_0112.html">Configure BFD for mLDP P2MP</a> on the root and leaf nodes.</p>
</li><li><p><a href="dc_vrp_mpls-l3vpn-v4_cfg_2017.html">Configure VPN FRR</a> on the leaf nodes.</p>
</li><li><p>Globally enable BFD on the root and leaf nodes.</p>
</li></ul>
</li></ul>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>If static default routes are configured on leaf nodes, to enable the leaf nodes to forward received BFD detection packets properly, configure IPv4 route import between VPN and public network instances so that public network routes can be replicated to the NG MVPN instance. For details on how to import public network routes into an NG MVPN instance, see <a href="dc_vrp_mpls-l3vpn-v4_cfg_2024.html">Configuring Route Import Between VPN and Public Network Instances</a>. Ensure that the specified route-policy has been configured using the <a href="cmdqueryname=route-policy"><b><span class="cmdname">route-policy</span></b></a> command.</p>
</div></div>
</div>
<div class="p">Before configuring multicast traffic detection based dual-root 1+1 protection, complete the following tasks:<ul><li><p>Configure NG MVPN.</p>
</li><li><p><a href="dc_vrp_mpls-l3vpn-v4_cfg_2017.html">Configure VPN FRR</a> on the leaf nodes.</p>
</li></ul>
</div>
<p>Perform the following steps on the leaf nodes:</p>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001270153613__1.4.3"></a><a name="1.4.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li><span>Run <a href="cmdqueryname=ip+vpn-instance"><b><span class="cmdname">ip vpn-instance</span></b></a><i><span class="varname">vpn-instance-name</span></i></span><p><p>The VPN instance view is displayed.</p>
</p></li><li><span>Run <a href="cmdqueryname=ipv4-family"><b><span class="cmdname">ipv4-family</span></b></a></span><p><p>The VPN instance IPv4 address family view is displayed.</p>
</p></li><li><span>Run <a href="cmdqueryname=mvpn"><b><span class="cmdname">mvpn</span></b></a></span><p><p>The VPN instance IPv4 address family MVPN view is displayed.</p>
</p></li><li><span>Run <a href="cmdqueryname=c-multicast+frr"><b><span class="cmdname">c-multicast frr</span></b></a></span><p><p>C-multicast FRR is enabled. C-multicast FRR allows C-multicast traffic to be diverted to the primary and backup tunnels.</p>
</p></li><li><span>(Only for traffic detection-based configuration) Run <a href="cmdqueryname=c-multicast+frr+flow-detection-based"><b><span class="cmdname">c-multicast frr flow-detection-based</span></b></a></span><p><p>Traffic detection-based C-multicast FRR is enabled.</p>
</p></li><li><span>(Optional) Run <a href="cmdqueryname=multicast+wtr"><b><span class="cmdname">multicast wtr</span></b></a><i><span class="varname">wtr-time</span></i></span><p><p>A switchback wait time is set for C-multicast FRR in the NG MVPN 1+1 scenario.</p>
</p></li><li><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol></div>
<div class="postreq"><a name="EN-US_TASK_0000001270153613__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p>After configuring dual-root 1+1 protection, check the configurations.</p>
<p>Run the <a href="cmdqueryname=display+pim"><b><span class="cmdname">display pim</span></b></a> <span>[ <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i> | <strong><span>all-instance</span></strong> ] </span><strong><span>routing-table</span></strong> [ <i><span class="varname">group-address</span></i> [ <strong><span>mask</span></strong> { <i><span class="varname">group-mask-length</span></i> | <i><span class="varname">group-mask</span></i> } ] | <i><span class="varname">source-address</span></i> [ <strong><span>mask</span></strong> { <i><span class="varname">source-mask-length</span></i> | <i><span class="varname">source-mask</span></i> } ] | <strong><span>incoming-interface</span></strong> { <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i> | <strong><span>register</span></strong> <span>| <strong><span>through-bgp</span></strong> </span>} | <strong><span>outgoing-interface</span></strong> { <strong><span>include</span></strong> | <strong><span>exclude</span></strong> | <strong><span>match</span></strong> } { <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i> | <strong><span>register</span></strong> | <strong><span>none</span></strong> <span>| <strong><span>pseudo </span></strong></span>} | <strong><span>mode</span></strong> { <strong><span>ssm</span></strong> | <strong><span>sm</span></strong> } | <strong><span>flags</span></strong> <i><span class="varname">flag-value</span></i> | <strong><span>fsm</span></strong> ] <sup>*</sup> [ <strong><span>outgoing-interface-number</span></strong> [ <i><span class="varname">number</span></i> ] ] command to check information about the PIM routing table.</p>
<p># Run the <a href="cmdqueryname=display+pim"><b><span class="cmdname">display pim</span></b></a> <span>[ <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i> | <strong><span>all-instance</span></strong> ] </span><strong><span>routing-table</span></strong> command. The command output shows backup PIM entries in the PIM routing table.</p>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_ngmvpn_0000.html">NG MVPN Configuration
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_ngmvpn_0118.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_ngmvpn_0012.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>