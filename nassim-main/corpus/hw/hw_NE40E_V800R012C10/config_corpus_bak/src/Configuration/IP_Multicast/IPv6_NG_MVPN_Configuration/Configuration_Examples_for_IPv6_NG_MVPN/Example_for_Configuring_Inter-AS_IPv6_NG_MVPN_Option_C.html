
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Inter-AS IPv6 NG MVPN Option C">
<meta name="abstract" content="The inter-AS IPv6 NG MVPN Option C solution is implemented by establishing a multi-hop MP-EBGP peer relationship between PEs in different ASs.">
<meta name="description" content="The inter-AS IPv6 NG MVPN Option C solution is implemented by establishing a multi-hop MP-EBGP peer relationship between PEs in different ASs.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_ngmvpn_0212.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_ngmvpn_0273.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_ngmvpn_00274.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="z00603461,w00606909,w00447999">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="IPv6 Multicast VPN">
<meta name="featuretype" content="IP Multicast">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="IPv6 Multicast VPN">
<meta name="featuretype" content="IP Multicast">
<meta name="featurename" content="IPv6 Multicast VPN">
<meta name="featuretype" content="IP Multicast">
<meta name="featurename" content="IPv6 Multicast VPN">
<meta name="featuretype" content="IP Multicast">
<meta name="OWNER" content="w00447999">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="w00447999">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172367590">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring Inter-AS IPv6 NG MVPN Option C</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172367590"></a><a name="EN-US_TASK_0172367590"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Inter-AS IPv6 NG MVPN Option C</h1>
<div class="taskbody"><p>The inter-AS IPv6 NG MVPN Option C solution is implemented by establishing a multi-hop MP-EBGP peer relationship between PEs in different ASs.</p>
<div class="context"><a name="EN-US_TASK_0172367590__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>As shown in <a href="#EN-US_TASK_0172367590__fig_dc_vrp_cfg_ngmvpn_027401">Figure 1</a>, CE1 and CE2 belong to the same VPN. CE1 accesses the backbone network by means of PE1 in AS100, and CE2 accesses the backbone network by means of PE2 in AS200.</p>
<div class="fignone" id="EN-US_TASK_0172367590__fig_dc_vrp_cfg_ngmvpn_027401"><a name="EN-US_TASK_0172367590__fig_dc_vrp_cfg_ngmvpn_027401"></a><a name="fig_dc_vrp_cfg_ngmvpn_027401"></a><span class="figcap"><b>Figure 1 </b>Inter-AS VPN Option C networking</span><br><span><img class="vsd" src="images/fig_dc_vrp_cfg_ngmvpn_027401.png"></span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 through 4 in this example represent GE <span>0/1/1</span>, GE <span>0/1/2</span>, GE <span>0/1/3</span>, and GE <span>0/1/4</span>, respectively.</p>
</div></div>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172367590__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Establish an MP-EBGP peer relationship between the PEs in different ASs and configure the maximum number of hops between the PEs.</p>
</li><li><p>Configure a routing policy on each ASBR. Assign an MPLS label to the loopback interface route received from the PE within the local AS and advertised to the remote ASBR. Assign new MPLS labels to the labeled IPv4 routes advertised to the PE within the local AS.</p>
</li><li><p>Configure the PE and ASBR in the same AS to exchange labeled IPv4 routes.</p>
</li><li><p>Configure ASBR1 and ASBR2 to exchange labeled IPv4 routes.</p>
</li><li><p>Configure IPv6 NG MVPN.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172367590__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>MPLS LSR IDs of the PEs and ASBRs (1.1.1.2, 1.1.1.3, 1.1.1.4, and 1.1.1.5)</p>
</li><li><p>Name (ngv6), RD (1:3 and 1:5), and export and import VPN targets (1:1) of the VPN instance on each PE</p>
</li><li><p>Routing policies used by ASBRs</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172367590__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure an IGP on the MPLS backbone networks in AS100 and AS200, so that the PE and ASBR on the same MPLS backbone network can communicate.</span><p><p>This example uses IS-IS. For configuration details, see Configuration Files in this example.</p>
</p></li><li><span>Configure basic MPLS functions and MPLS LDP on the MPLS backbone networks of AS100 and AS200 to establish LDP LSPs. For configuration details, see Configuration Files in this example.</span></li><li><span>Configure an automatic mLDP P2MP LSP on PEs and ASBRs.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-mpls-ldp] <strong>mldp p2mp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-mpls-ldp] <strong>quit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-mpls-ldp] <strong>mldp p2mp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-ldp] <strong>mldp recursive-fec</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-ldp] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-mpls-ldp] <strong>quit</strong></pre>
<p># Configure ASBR1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1-mpls-ldp] <strong>mldp p2mp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-mpls-ldp] <strong>mldp recursive-fec</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-mpls-ldp] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1-mpls-ldp] <strong>quit</strong></pre>
<p>The procedure for configuring ASBR2 is similar to the procedure for configuring ASBR1. For configuration details, see Configuration Files in this example.</p>
</p></li><li><span>Configure IBGP peer relationships in the IPv4 address family view for AS100 and AS200. For configuration details, see Configuration Files in this example.</span></li><li><span>Configure a VPN instance on each PE and bind the interface connecting a PE to a CE to the VPN instance.</span><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The import VPN target of the VPN instance on PE1 must match the export VPN target of the VPN instance on PE2. The import VPN target of the VPN instance on PE2 must match the export VPN target of the VPN instance on PE1.</p>
</div></div>
</p></li><li><span>Enable the capability of exchanging labeled IPv4 routes.</span><p><p># Configure PE1 to exchange labeled IPv4 routes with ASBR1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp] <strong>ipv4-family unicast</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp-af-ipv4] <strong>peer 1.1.1.3 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-ipv4] <strong>peer 1.1.1.3 label-route-capability</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-ipv4] <strong>undo synchronization</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-ipv4] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp-af-ipv4] <strong>quit</strong></pre>
<p># Enable MPLS on GigabitEthernet<span>0/1/2</span> connecting ASBR1 to ASBR2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1] <strong>interface GigabitEthernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1-GigabitEthernet<span>0/1/2</span>] <strong>ip address 10.0.7.5 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-GigabitEthernet<span>0/1/2</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-GigabitEthernet<span>0/1/2</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1] <strong>commit</strong></pre>
<p># Create a routing policy on ASBR1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1] <strong>route-policy policy1 permit node 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-route-policy] <strong>apply mpls-label</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-route-policy] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1] <strong>route-policy policy2 permit node 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-route-policy] <strong>if-match mpls-label</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-route-policy] <strong>apply mpls-label</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-route-policy]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1] <strong>commit</strong></pre>
<p># Apply the routing policy to the routes advertised by ASBR1 to PE1 and enable ASBR1 to exchange labeled IPv4 routes with PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1-bgp] <strong>ipv4-family unicast</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1-bgp-af-ipv4] <strong>peer 1.1.1.2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp-af-ipv4]<strong> peer 1.1.1.2 route-policy policy2 export</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp-af-ipv4] <strong>peer 1.1.1.2 label-route-capability</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp-af-ipv4] <strong>quit</strong></pre>
<p># Apply the routing policy to the routes advertised by ASBR1 to ASBR2 and enable ASBR1 to exchange labeled IPv4 routes with ASBR2.</p>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp] <strong>peer 10.0.7.7 as-number 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp] <strong>ipv4-family unicast</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp-af-ipv4] <strong>peer 10.0.7.7 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp-af-ipv4] <strong>peer 10.0.7.7 route-policy policy1 export</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp-af-ipv4] <strong>peer 10.0.7.7 label-route-capability</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp-af-ipv4] <strong>quit</strong></pre>
<p># Configure ASBR1 to advertise PE1's loopback route to ASBR2 and then to PE2.</p>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp] <strong>ipv4-family unicast</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp-af-ipv4] <strong>network 1.1.1.2 255.255.255.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1] <strong>commit</strong></pre>
<p>The configurations on PE2 and ASBR2 are similar to those on PE1 and ASBR1. For configuration details, see Configuration Files in this example.</p>
</p></li><li><span>Establish an MP-EBGP peer relationship between PE1 and PE2 and configure the PEs to filter received VPNv4 routes based on VPN targets.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 1.1.1.5 as-number 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 1.1.1.5 connect-interface LoopBack0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 1.1.1.5 ebgp-max-hop 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>ipv6-family vpnv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-vpnv6] <strong>peer 1.1.1.5 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-vpnv6] <strong>policy vpn-target</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-vpnv6]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>bgp 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>peer 1.1.1.2 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>peer 1.1.1.2 connect-interface LoopBack0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>peer 1.1.1.2 ebgp-max-hop 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>ipv6-family vpnv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-vpnv6] <strong>peer 1.1.1.2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-vpnv6] <strong>policy vpn-target</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-vpnv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</p></li><li><span>Configure BGP MVPN peers.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp] <strong>ipv4-family unicast</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp-af-ipv4] <strong>undo synchronization</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-ipv4] <strong>peer 1.1.1.5 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-ipv4] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp] <strong>ipv6-family vpn-instance ngv6</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp-af-vpn-ngv6] <strong>import-route isis 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-vpn-ngv6] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp-af-vpn-ngv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp] <strong>ipv6-family mvpn</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp-af-mvpnv6] <strong>policy vpn-target</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-mvpnv6] <strong>peer 1.1.1.5 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-mvpnv6] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp-af-mvpnv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp] <strong>quit</strong></pre>
<p>The configuration on PE2 is similar to the configuration on PE1. For configuration details, see Configuration Files in this example.</p>
</p></li><li><span>Configure a P2MP LSP on PEs to carry multicast traffic.</span><p><p># Configure PE1 as the sender PE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>multicast ipv6 mvpn 1.1.1.2</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>ip vpn-instance ngv6</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-vpn-instance-ngv6] <strong>ipv6-family</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-vpn-instance-ngv6-af-ipv6] <strong>multicast ipv6 routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-ngv6-af-ipv6] <strong>mvpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-ngv6-af-ipv6-mvpn] <strong>sender-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-ngv6-af-ipv6-mvpn] <strong>c-multicast signaling bgp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-ngv6-af-ipv6-mvpn] <strong>auto-discovery inter-as</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-ngv6-af-ipv6-mvpn] <strong>ipmsi-tunnel</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-ngv6-af-ipv6-mvpn-ipmsi] <strong>mldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-ngv6-af-ipv6-mvpn-ipmsi] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-vpn-instance-ngv6-af-ipv6-mvpn-ipmsi] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-vpn-instance-ngv6-af-ipv6-mvpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-vpn-instance-ngv6-af-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-vpn-instance-ngv6] <strong>quit</strong></pre>
<p># Configure PE2 as the receiver PE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>multicast ipv6 mvpn 1.1.1.5</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>ip vpn-instance ngv6</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-vpn-instance-ngv6] <strong>ipv6-family</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-vpn-instance-ngv6-af-ipv6] <strong>multicast ipv6 routing-enable</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-vpn-instance-ngv6-af-ipv6] <strong>mvpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-ngv6-af-ipv6-mvpn] <strong>c-multicast signaling bgp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-ngv6-af-ipv6-mvpn] <strong>auto-discovery inter-as</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-ngv6-af-ipv6-mvpn-ipmsi] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-vpn-instance-ngv6-af-ipv6-mvpn-ipmsi] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-vpn-instance-ngv6-af-ipv6-mvpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-vpn-instance-ngv6-af-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-vpn-instance-ngv6] <strong>quit</strong></pre>
</p></li><li><span>Configure PIM.</span><p><p># Configure CE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>pim-ipv6</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1-pim6] <strong>static-rp 2001:db8:6::3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-pim6] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1-pim6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>multicast ipv6 routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>interface GigabitEthernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>] <strong>pim ipv6 sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>interface GigabitEthernet <span>0/1/3</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1-GigabitEthernet<span>0/1/3</span>] <strong>pim ipv6 sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/3</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1-GigabitEthernet<span>0/1/3</span>] <strong>quit</strong></pre>
<p># Configure CE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>pim-ipv6</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2-pim6] <strong>static-rp 2001:db8:6::3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-pim6] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2-pim6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>multicast ipv6 routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>interface GigabitEthernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>] <strong>pim ipv6 sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>] <strong>mld enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>] <strong>mld static-group FF3E::1 source 2001:DB8:5::2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>interface GigabitEthernet <span>0/1/4</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1-GigabitEthernet<span>0/1/4</span>] <strong>pim ipv6 sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/4</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1-GigabitEthernet<span>0/1/4</span>] <strong>quit</strong></pre>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>pim-ipv6 vpn-instance ngv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-pim6-ngv6] <strong>static-rp 2001:db8:6::3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-pim6-ngv6] <strong>source-lifetime 60</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-pim6-ngv6] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-pim6-ngv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface GigabitEthernet <span>0/1/3</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/3</span>] <strong>pim ipv6 sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/3</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/3</span>] <strong>quit</strong></pre>
<p>The configuration on PE2 is similar to the configuration on PE1. For configuration details, see Configuration Files in this example.</p>
</p></li><li><span>Verify the configuration.</span><p><p>After the configuration is complete, CEs can learn the routes to each other's interfaces and ping each other.</p>
<p>The following example uses the command output on CE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>ping ipv6 2001:db8:14::1</strong></pre>
<pre class="screen">  PING 2001:DB8:14::1: 56  data bytes, press CTRL_C to break</pre>
<pre class="screen">    Reply from 2001:DB8:14::1: bytes=56 Sequence=1 ttl=252 time=102 ms</pre>
<pre class="screen">    Reply from 2001:DB8:14::1: bytes=56 Sequence=2 ttl=252 time=89 ms</pre>
<pre class="screen">    Reply from 2001:DB8:14::1: bytes=56 Sequence=3 ttl=252 time=106 ms</pre>
<pre class="screen">    Reply from 2001:DB8:14::1: bytes=56 Sequence=4 ttl=252 time=104 ms</pre>
<pre class="screen">    Reply from 2001:DB8:14::1: bytes=56 Sequence=5 ttl=252 time=56 ms</pre>
<pre class="screen"></pre>
<pre class="screen">  --- 2001:DB8:14::1 ping statistics ---</pre>
<pre class="screen">    5 packet(s) transmitted</pre>
<pre class="screen">    5 packet(s) received</pre>
<pre class="screen">    0.00% packet loss</pre>
<pre class="screen">    round-trip min/avg/max = 56/91/106 ms</pre>
<p>Run the <a href="cmdqueryname=display+pim+ipv6+routing-table"><b><span class="cmdname">display pim ipv6 routing-table</span></b></a> command on a PE to check the PIM routing table.</p>
<p>The following example uses the command output on PE2.</p>
<pre class="screen">&lt;PE2&gt;<strong> display pim ipv6 vpn-instance ngv6 routing-table</strong></pre>
<pre class="screen"> VPN-Instance: ngv6
 Total 1 (S, G) entry

 (2001:DB8:5::2, FF3E::1)
     Protocol: pim-ssm, Flag:
     UpTime: 00:24:09
     Upstream interface: through-BGP, Refresh time: 00:24:09
         Upstream neighbor: ::FFFF:1.1.1.2
         RPF prime neighbor: ::FFFF:1.1.1.2
     Downstream interface(s) information:
     Total number of downstreams: 1
        1: GigabitEthernet<span>0/1/3</span>
             Protocol: pim-ssm, UpTime: 00:24:09, Expires: 00:02:35</pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172367590__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>CE1 configuration file</p>
<pre class="screen">#
sysname CE1
#
multicast ipv6 routing-enable
#
isis 2
 is-level level-2
 ipv6 enable topology ipv6
 network-entity 10.0000.0000.0004.00
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ipv6 enable
 ipv6 address 2001:DB8:5::6 64
 isis ipv6 enable 2
 pim ipv6 sm
#
interface GigabitEthernet<span>0/1/3</span>
 undo shutdown
 ipv6 enable
 ipv6 address 2001:DB8:6::6 64
 isis ipv6 enable 2
 pim ipv6 sm
#
pim-ipv6
 static-rp 2001:DB8:6::3
#
return</pre>
</li><li><p>PE1 configuration file</p>
<pre class="screen">#
sysname PE1
#
multicast ipv6 mvpn 1.1.1.2
#
ip vpn-instance ngv6
 ipv6-family
  route-distinguisher 1:3
  apply-label per-instance
  vpn-target 1:1 export-extcommunity
  vpn-target 1:1 import-extcommunity
  multicast ipv6 routing-enable
  mvpn
   sender-enable
   c-multicast signaling bgp
   auto-discovery inter-as
   ipmsi-tunnel
    mldp
#
mpls lsr-id 1.1.1.2
#
mpls
#
mpls ldp
 mldp p2mp
#
isis 1
 is-level level-2
 cost-style wide
 network-entity 10.0000.0000.000b.00
#
isis 2 vpn-instance ngv6
 is-level level-2
 network-entity 10.0000.0000.0006.00
 ipv6 enable topology ipv6
 ipv6 import-route bgp
#
interface GigabitEthernet<span>0/1/3</span>
 undo shutdown
 ip binding vpn-instance ngv6
 ipv6 enable
 ipv6 address 2001:DB8:6::3 64
 isis ipv6 enable 2
 pim ipv6 sm
#
interface GigabitEthernet<span>0/1/4</span>
 undo shutdown
 ip address 10.0.2.3 255.255.255.0
 isis enable 1
 mpls
 mpls ldp
#
interface LoopBack0
 ip address 1.1.1.2 255.255.255.255
 isis enable 1
#
bgp 100
 peer 1.1.1.3 as-number 100
 peer 1.1.1.3 connect-interface LoopBack0
 peer 1.1.1.5 as-number 200
 peer 1.1.1.5 ebgp-max-hop 10 
 peer 1.1.1.5 connect-interface LoopBack0
 #
 ipv4-family unicast
  undo synchronization
  peer 1.1.1.3 enable
  peer 1.1.1.3 label-route-capability
  peer 1.1.1.5 enable
 #
 ipv6-family mvpn
  policy vpn-target
  peer 1.1.1.5 enable
 #
 ipv6-family vpnv6
  policy vpn-target
  peer 1.1.1.5 enable
 #
 ipv6-family vpn-instance ngv6  
  import-route isis 2
#
pim-ipv6 vpn-instance ngv6
 static-rp 2001:DB8:6::3
 source-lifetime 60
#
return</pre>
</li><li><p>ASBR1 configuration file</p>
<pre class="screen">#
sysname ASBR1
#
mpls lsr-id 1.1.1.3
#
mpls
#
 mpls ldp
 mldp p2mp
 mldp recursive-fec
#
isis 1
 is-level level-2
 cost-style wide
 network-entity 10.0000.0000.000c.00
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ip address 10.0.7.5 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/4</span>
 undo shutdown
 ip address 10.0.2.5 255.255.255.0
 isis enable 1
 mpls
 mpls ldp
#
interface LoopBack0
 ip address 1.1.1.3 255.255.255.255
 isis enable 1
#
bgp 100
 peer 10.0.7.7 as-number 200
 peer 1.1.1.2 as-number 100
 peer 1.1.1.2 connect-interface LoopBack0
 #
 ipv4-family unicast
  undo synchronization
  network 1.1.1.2 255.255.255.255
  peer 10.0.7.7 enable
  peer 10.0.7.7 route-policy policy1 export
  peer 10.0.7.7 label-route-capability
  peer 1.1.1.2 enable
  peer 1.1.1.2 route-policy policy2 export 
  peer 1.1.1.2 label-route-capability
#
route-policy policy1 permit node 1
 apply mpls-label
route-policy policy2 permit node 1
 if-match mpls-label
 apply mpls-label
#
ip route-static 1.1.1.4 255.255.255.255 10.0.7.7
#
return</pre>
</li><li><p>ASBR2 configuration file</p>
<pre class="screen">#
sysname ASBR2
#
mpls lsr-id 1.1.1.4
#
mpls
#
mpls ldp
 mldp p2mp
 mldp recursive-fec
#
isis 1
 is-level level-2
 cost-style wide
 network-entity 10.0000.0000.000d.00
#
interface GigabitEthernet<span>0/1/3</span>
 undo shutdown
 ip address 10.0.7.7 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/4</span>
 undo shutdown
 ip address 10.0.16.1 255.255.255.0
 isis enable 1
 mpls
 mpls ldp
#
interface LoopBack0
 ip address 1.1.1.4 255.255.255.255
 isis enable 1
#
bgp 200
 peer 10.0.7.5 as-number 100
 peer 1.1.1.5 as-number 200
 peer 1.1.1.5 connect-interface LoopBack0
 #
 ipv4-family unicast
  undo synchronization
  network 1.1.1.5 255.255.255.255
  peer 10.0.7.5 enable
  peer 10.0.7.5 route-policy policy1 export
  peer 10.0.7.5 label-route-capability
  peer 1.1.1.5 enable
  peer 1.1.1.5 route-policy policy2 export
  peer 1.1.1.5 label-route-capability
#
route-policy policy1 permit node 1
 apply mpls-label
route-policy policy2 permit node 1
 if-match mpls-label
 apply mpls-label
#
ip route-static 1.1.1.3 255.255.255.255 10.0.7.5
#
return
</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#
sysname PE2
#
multicast ipv6 mvpn 1.1.1.5
#
ip vpn-instance ngv6
 ipv6-family
  route-distinguisher 1:5
  apply-label per-instance
  vpn-target 1:1 export-extcommunity
  vpn-target 1:1 import-extcommunity
  multicast ipv6 routing-enable
  mvpn
   c-multicast signaling bgp
   auto-discovery inter-as
   ipmsi-tunnel
    mldp
#
mpls lsr-id 1.1.1.5
#
mpls
#
mpls ldp
 mldp p2mp
 mldp recursive-fec
#
isis 1
 is-level level-2
 cost-style wide
 network-entity 10.0000.0000.000e.00
#
isis 2 vpn-instance ngv6
 is-level level-2
 network-entity 10.0000.0000.0007.00
 ipv6 enable topology ipv6
 ipv6 import-route bgp
#
interface GigabitEthernet<span>0/1/3</span>
 undo shutdown
 ip address 10.0.16.2 255.255.255.0
 isis enable 1
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/4</span>
 undo shutdown
 ip binding vpn-instance ngv6
 ipv6 enable
 ipv6 address 2001:DB8:14::4 64
 isis ipv6 enable 2
 pim ipv6 sm
#
interface LoopBack0
 ip address 1.1.1.5 255.255.255.255
 isis enable 1
#
bgp 200
 peer 1.1.1.2 as-number 100
 peer 1.1.1.2 ebgp-max-hop 10
 peer 1.1.1.2 connect-interface LoopBack0
 peer 1.1.1.4 as-number 200
 peer 1.1.1.4 connect-interface LoopBack0
 #
 ipv4-family unicast
  undo synchronization
  peer 1.1.1.2 enable
  peer 1.1.1.4 enable
  peer 1.1.1.4 label-route-capability
 #
 ipv6-family mvpn
  policy vpn-target
  peer 1.1.1.2 enable
 #
 ipv6-family vpnv6
  policy vpn-target
  peer 1.1.1.2 enable
 #
 ipv6-family vpn-instance ngv6
  import-route isis 2
 #
pim-ipv6 vpn-instance ngv6
 static-rp 2001:DB8:6::3
 source-lifetime 60
#
return</pre>
</li><li><p>CE2 configuration file</p>
<pre class="screen">#
sysname CE2
#
multicast ipv6 routing-enable
#
isis 2
 is-level level-2
 ipv6 enable topology ipv6
 network-entity 10.0000.0000.0004.00
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ipv6 enable
 ipv6 address 2001:DB8:3::1 64
 isis ipv6 enable 2
 pim ipv6 sm
 mld enable
 mld static-group FF3E::1 source 2001:DB8:5::2
#
interface GigabitEthernet<span>0/1/4</span>
 undo shutdown
 ipv6 enable
 ipv6 address 2001:DB8:14::1 64
 isis ipv6 enable 2
 pim ipv6 sm
#
pim-ipv6
 static-rp 2001:DB8:6::3
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_ngmvpn_0212.html">Configuration Examples for IPv6 NG MVPN
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_ngmvpn_0273.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_ngmvpn_00274.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>