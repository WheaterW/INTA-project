
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring mLDP In-Band MVPN">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_mldp-in-band_0008.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_mldp-in-band_0011.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="z00603461,w00606909,w00447999">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="mLDP In-Band MVPN">
<meta name="featuretype" content="IP Multicast">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="mLDP In-Band MVPN">
<meta name="featuretype" content="IP Multicast">
<meta name="featurename" content="mLDP In-Band MVPN">
<meta name="featuretype" content="IP Multicast">
<meta name="featurename" content="mLDP In-Band MVPN">
<meta name="featuretype" content="IP Multicast">
<meta name="OWNER" content="w00447999">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="w00447999">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001270154509">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>Example for Configuring mLDP In-Band MVPN</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001270154509"></a><a name="EN-US_TASK_0000001270154509"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring mLDP In-Band MVPN</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001270154509__1.3.1"></a><a name="1.3.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>This section provides an example for configuring mLDP in-band MVPN.</p>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001270154509__1.3.2"></a><a name="1.3.2"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>mLDP in-band MVPN is deployed on a service provider's backbone network to solve multicast service issues related to traffic congestion, reliability, and security. In the mLDP in-band MVPN networking shown in <a href="#EN-US_TASK_0000001270154509__fig_dc_vrp_cfg_ngmvpn_002201">Figure 1</a>, BGP/MPLS IP VPN services carried by MPLS LDP tunnels have been deployed. It is required that MVPN services be provided for users over the existing IPv4 network and that users implement access through the IPv4 network.</p>
<div class="fignone" id="EN-US_TASK_0000001270154509__fig_dc_vrp_cfg_ngmvpn_002201"><a name="EN-US_TASK_0000001270154509__fig_dc_vrp_cfg_ngmvpn_002201"></a><a name="fig_dc_vrp_cfg_ngmvpn_002201"></a><span class="figcap"><b>Figure 1 </b>mLDP in-band MVPN networking</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface1 and interface2 represent GE <span>0/1/0</span> and GE <span>0/1/1</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0000001270194557.png"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001270154509__1.3.3"></a><a name="1.3.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure a BGP/MPLS IP VPN and ensure that the unicast VPN works properly and unicast routes between the sender PE and receiver PEs are reachable.</p>
</li><li><p>Enable mLDP globally on all PEs so that they can use mLDP to establish P2MP tunnels.</p>
</li><li><p>Enable mLDP in-band MVPN on PE2 to trigger mLDP P2MP tunnel establishment.</p>
</li><li><p>Configure PIM on the PEs' interfaces bound to a VPN instance and on the CEs' interfaces connected to the PEs so that VPN multicast routing entries are generated for multicast traffic forwarding.</p>
</li><li><p>Configure IGMP on the multicast device's interface that is connected to the user network segment to manage multicast group members on that network segment.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001270154509__1.3.4"></a><a name="1.3.4"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data.</p>
<ul><li><p>IS-IS process ID: 1</p>
</li><li><div class="p">VPN instance name on PE1: VPNA; other data shown in <a href="#EN-US_TASK_0000001270154509__table_dc_vrp_cfg_ngmvpn_002201">Table 1</a>
<div class="tableBorder"><a name="EN-US_TASK_0000001270154509__table_dc_vrp_cfg_ngmvpn_002201"></a><a name="table_dc_vrp_cfg_ngmvpn_002201"></a><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" id="EN-US_TASK_0000001270154509__table_dc_vrp_cfg_ngmvpn_002201" frame="border" border="1" rules="all"><caption><b>Table 1 </b>Data needed for each device</caption><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="17.421731123388582%" id="mcps1.3.4.3.2.1.2.2.8.1.1" liSelected="liSelected"><p>Device</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="17.421731123388582%" id="mcps1.3.4.3.2.1.2.2.8.1.2" liSelected="liSelected"><p>IP Address of Loopback 1</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="17.421731123388582%" id="mcps1.3.4.3.2.1.2.2.8.1.3" liSelected="liSelected"><p>MPLS LSR-ID</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="17.421731123388582%" id="mcps1.3.4.3.2.1.2.2.8.1.4" liSelected="liSelected"><p>MVPN ID</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="6.445672191528545%" id="mcps1.3.4.3.2.1.2.2.8.1.5" liSelected="liSelected"><p>RD</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="6.445672191528545%" id="mcps1.3.4.3.2.1.2.2.8.1.6" liSelected="liSelected"><p>VPN-Target</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="17.421731123388582%" id="mcps1.3.4.3.2.1.2.2.8.1.7" liSelected="liSelected"><p>AS Number</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" valign="middle" width="17.421731123388582%" headers="mcps1.3.4.3.2.1.2.2.8.1.1 "><p>CE1</p>
</td>
<td class="cellrowborder" valign="middle" width="17.421731123388582%" headers="mcps1.3.4.3.2.1.2.2.8.1.2 "><p>1.1.1.1</p>
</td>
<td class="cellrowborder" valign="top" width="17.421731123388582%" headers="mcps1.3.4.3.2.1.2.2.8.1.3 "><p>-</p>
</td>
<td class="cellrowborder" valign="top" width="17.421731123388582%" headers="mcps1.3.4.3.2.1.2.2.8.1.4 "><p>-</p>
</td>
<td class="cellrowborder" valign="top" width="6.445672191528545%" headers="mcps1.3.4.3.2.1.2.2.8.1.5 "><p>-</p>
</td>
<td class="cellrowborder" valign="middle" width="6.445672191528545%" headers="mcps1.3.4.3.2.1.2.2.8.1.6 "><p>-</p>
</td>
<td class="cellrowborder" valign="middle" width="17.421731123388582%" headers="mcps1.3.4.3.2.1.2.2.8.1.7 "><p>AS 65001</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="middle" width="17.421731123388582%" headers="mcps1.3.4.3.2.1.2.2.8.1.1 "><p>PE1</p>
</td>
<td class="cellrowborder" valign="middle" width="17.421731123388582%" headers="mcps1.3.4.3.2.1.2.2.8.1.2 "><p>2.2.2.2</p>
</td>
<td class="cellrowborder" valign="top" width="17.421731123388582%" headers="mcps1.3.4.3.2.1.2.2.8.1.3 "><p>2.2.2.2</p>
</td>
<td class="cellrowborder" valign="top" width="17.421731123388582%" headers="mcps1.3.4.3.2.1.2.2.8.1.4 "><p>2.2.2.2</p>
</td>
<td class="cellrowborder" valign="top" width="6.445672191528545%" headers="mcps1.3.4.3.2.1.2.2.8.1.5 "><p>200:1</p>
</td>
<td class="cellrowborder" valign="middle" width="6.445672191528545%" headers="mcps1.3.4.3.2.1.2.2.8.1.6 "><p>3:3</p>
</td>
<td class="cellrowborder" valign="middle" width="17.421731123388582%" headers="mcps1.3.4.3.2.1.2.2.8.1.7 "><p>AS 100</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="middle" width="17.421731123388582%" headers="mcps1.3.4.3.2.1.2.2.8.1.1 "><p>PE2</p>
</td>
<td class="cellrowborder" valign="middle" width="17.421731123388582%" headers="mcps1.3.4.3.2.1.2.2.8.1.2 "><p>4.4.4.4</p>
</td>
<td class="cellrowborder" valign="top" width="17.421731123388582%" headers="mcps1.3.4.3.2.1.2.2.8.1.3 "><p>4.4.4.4</p>
</td>
<td class="cellrowborder" valign="top" width="17.421731123388582%" headers="mcps1.3.4.3.2.1.2.2.8.1.4 "><p>4.4.4.4</p>
</td>
<td class="cellrowborder" valign="top" width="6.445672191528545%" headers="mcps1.3.4.3.2.1.2.2.8.1.5 "><p>400:1</p>
</td>
<td class="cellrowborder" valign="middle" width="6.445672191528545%" headers="mcps1.3.4.3.2.1.2.2.8.1.6 "><p>3:3</p>
</td>
<td class="cellrowborder" valign="middle" width="17.421731123388582%" headers="mcps1.3.4.3.2.1.2.2.8.1.7 "><p>AS 100</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="17.421731123388582%" headers="mcps1.3.4.3.2.1.2.2.8.1.1 "><p>CE2</p>
</td>
<td class="cellrowborder" valign="top" width="17.421731123388582%" headers="mcps1.3.4.3.2.1.2.2.8.1.2 "><p>5.5.5.5</p>
</td>
<td class="cellrowborder" valign="top" width="17.421731123388582%" headers="mcps1.3.4.3.2.1.2.2.8.1.3 "><p>-</p>
</td>
<td class="cellrowborder" valign="top" width="17.421731123388582%" headers="mcps1.3.4.3.2.1.2.2.8.1.4 "><p>-</p>
</td>
<td class="cellrowborder" valign="top" width="6.445672191528545%" headers="mcps1.3.4.3.2.1.2.2.8.1.5 "><p>-</p>
</td>
<td class="cellrowborder" valign="top" width="6.445672191528545%" headers="mcps1.3.4.3.2.1.2.2.8.1.6 "><p>-</p>
</td>
<td class="cellrowborder" valign="top" width="17.421731123388582%" headers="mcps1.3.4.3.2.1.2.2.8.1.7 "><p>AS 65002</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001270154509__1.3.5"></a><a name="1.3.5"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure BGP/MPLS IP VPN.</span><ol type="a"><li class="substepexpand"><span>Assign an IP address to each interface of devices on the backbone network and VPN sites.</span><p><p>Assign an IP address to each interface according to <a href="#EN-US_TASK_0000001270154509__fig_dc_vrp_cfg_ngmvpn_002201">Figure 1</a>. For configuration details, see <a href="#EN-US_TASK_0000001270154509__example_dc_vrp_cfg_ngmvpn_002201">Configuration Files</a> in this section.</p>
</p></li><li class="substepexpand"><span>Configure an IGP for interworking on the BGP/MPLS IP VPN backbone network.</span><p><p>IS-IS is used in this example. For configuration details, see <a href="#EN-US_TASK_0000001270154509__example_dc_vrp_cfg_ngmvpn_002201">Configuration Files</a> in this section.</p>
</p></li><li class="substepexpand"><span>Configure basic MPLS functions and MPLS LDP on the MPLS backbone network to establish LDP LSPs.</span><p><ul><li><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>mpls lsr-id 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</li><li><p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>mpls lsr-id 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</li></ul>
</p></li><li class="substepexpand"><span>Establish an MP-IBGP peer relationship between the PEs.</span><p><ul><li><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 4.4.4.4 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 4.4.4.4 connect-interface LoopBack1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>ipv4-family vpnv4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-vpnv4] <strong>peer 4.4.4.4 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-vpnv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</li><li><p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>peer 2.2.2.2 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>peer 2.2.2.2 connect-interface LoopBack1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>ipv4-family vpnv4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-vpnv4] <strong>peer 2.2.2.2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-vpnv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</li></ul>
</p></li><li class="substepexpand"><span>Configure a VPN instance on the PEs.</span><p><ul><li><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>ip vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4] <strong>route-distinguisher 200:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4] <strong>vpn-target 3:3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet<span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>ip binding vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>ip address 192.168.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</li><li><p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>ip vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA-af-ipv4] <strong>route-distinguisher 400:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA-af-ipv4] <strong>vpn-target 3:3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>ip binding vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>ip address 192.168.3.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</li></ul>
</p></li><li class="substepexpand"><span>Configure IS-IS on the PEs and import IS-IS routes into the BGP VPN instance.</span><p><ul><li><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>isis 1 vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1]<strong> is-level level-2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>network-entity 10.0000.0000.0002.00</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>import-route bgp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> isis 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-2] <strong>is-level level-2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-2] <strong>network-entity 10.0000.0000.0006.00</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet <span><span>0/1/1</span></span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>ipv4-family vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-VPNA] <strong>import-route isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</li><li><p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>isis 1 vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1] <strong>is-level level-2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1] <strong>network-entity 10.0000.0000.0004.00</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1] <strong>import-route bgp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>isis 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-2] <strong>is-level level-2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-2] <strong>network-entity 10.0000.0000.0008.00</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>ipv4-family vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-VPNA] <strong>import-route isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</li></ul>
</p></li><li class="substepexpand"><span>Configure IS-IS on the CEs.</span><p><ul><li><p># Configure CE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-isis-1] <strong>is-level level-2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-isis-1] <strong>network-entity 10.0000.0000.0001.00</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>interface gigabitethernet<span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/1</span>] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>commit</strong></pre>
</li><li><p># Configure CE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-isis-1] <strong>is-level level-2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-isis-1] <strong>network-entity 10.0000.0000.0005.00</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>interface gigabitethernet</strong><span>0/1/0</span></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>commit</strong></pre>
</li></ul>
<p>After completing the configurations, run the <a href="cmdqueryname=display+ip+routing-table+vpn-instance+verbose"><b><span class="cmdname">display ip routing-table vpn-instance verbose</span></b></a> command on PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>display ip routing-table vpn-instance VPNA 10.1.3.0 verbose</strong></pre>
<pre class="screen"><span class="keyword">Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route</span>
------------------------------------------------------------------------------
Routing Table : VPNA
Summary Count : 1

Destination: 10.1.3.0/24
     Protocol: IBGP            Process ID: 0
   Preference: 255                   Cost: 0
      NextHop: 2.2.2.2          Neighbour: 0.0.0.0
        State: Active Adv Relied      Age: 00h14m34s
          Tag: 0                 Priority: low
        Label: 32829              QoSInfo: 0x0
   IndirectID: 0xF60000B5       Instance:         
 RelayNextHop: 0.0.0.0          Interface: GigabitEthernet<span>0/1/1</span>
     TunnelID: 0x000000000300000001 Flags: RD<strong>                           </strong></pre>
</p></li></ol>
</li><li><span>Enable mLDP globally.</span><p><ul><li><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp] <strong>mldp p2mp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-mpls-ldp] <strong>quit</strong></pre>
</li><li><p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-ldp] <strong>mldp p2mp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-ldp] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-mpls-ldp] <strong>quit</strong></pre>
</li></ul>
</p></li><li><span>Configure mLDP in-band MVPN.</span><p><p># Configure PE1.</p>
</p><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>ip vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4] <strong>multicast routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4] <strong>multicast inband-signaling mld</strong><strong>p</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>ip vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA-af-ipv4] <strong>multicast routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA-af-ipv4] <strong>multicast inband-signaling mld</strong><strong>p</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</p></li><li><span>Configure PIM.</span><p><ul><li><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet<span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</li><li><p># Configure CE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>multicast routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>interface gigabitethernet<span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/1</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>commit</strong></pre>
</li><li><p># Configure CE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>multicast routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>interface gigabitethernet<span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>commit</strong></pre>
</li><li><p># Configure PE2.</p>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</li></ul>
</p></li><li><span>Configure IGMP.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>interface gigabitethernet<span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>] <strong>igmp enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>] <strong>igmp version 3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>commit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p>After the preceding configurations are completed, mLDP in-band MVPN has been configured. If CE2 has access users, CE1 can use the BGP/MPLS IP VPN to forward multicast data to the users. In this example, a static multicast entry is generated on CE2 for users to join the multicast group 225.1.1.1 and receive data from the multicast source 10.1.3.2. In this case, you can check the multicast routing entries.</p>
<div class="p"># Run the <strong>display pim </strong><strong>vpn-instance</strong><strong> routing-table</strong> command on PE2 to check its PIM routing table.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>display pim vpn-instance VPNA routing-table</strong></pre>
<pre class="screen"> VPN-Instance: VPNA
 Total 0 (*, G) entry; 1 (S, G) entry

 (10.1.3.2, 225.1.1.1)
     RP: NULL
     Protocol: pim-sm, Flag: SPT SG_RCVR
     UpTime: 03:12:27
     Upstream interface: through-MLDP, Refresh time: 03:12:27
         Upstream neighbor: 2.2.2.2
         RPF prime neighbor: 2.2.2.2
     Downstream interface(s) information:
     Total number of downstreams: 1
        1: GigabitEthernet<span>0/1/0</span>
             Protocol: static, UpTime: 03:12:27, Expires: 00:03:05 </pre>
</div>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0000001270154509__example_dc_vrp_cfg_ngmvpn_002201"><a name="EN-US_TASK_0000001270154509__example_dc_vrp_cfg_ngmvpn_002201"></a><a name="example_dc_vrp_cfg_ngmvpn_002201"></a><a name="EN-US_TASK_0000001270154509__1.3.6"></a><a name="1.3.6"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>CE1</p>
<pre class="screen">#
sysname CE1
#
multicast routing-enable
#
isis 1
  is-level level-2
  network-entity 10.0000.0000.0001.00
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.3.1 255.255.255.0
 isis enable 1
 pim sm
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 192.168.1.1 255.255.255.0
 isis enable 1
 pim sm
#
return</pre>
</li><li><p>PE1</p>
<pre class="screen">#
sysname PE1
#
ip vpn-instance VPNA
 ipv4-family
  route-distinguisher 200:1
  apply-label per-instance
  vpn-target 3:3 export-extcommunity
  vpn-target 3:3 import-extcommunity
  multicast routing-enable
  multicast inband-signaling mldp
#
mpls lsr-id 2.2.2.2
#
mpls ldp
 mldp p2mp
#
isis 1 vpn-instance VPNA
 is-level level-2
 network-entity 10.0000.0000.0002.00
 import-route bgp 
#
isis 2
  is-level level-2
  network-entity 10.0000.0000.0006.00
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.1.1 255.255.255.0
 isis enable 2
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip binding vpn-instance VPNA
 ip address 192.168.1.2 255.255.255.0
 isis enable 1
 pim sm
#
interface LoopBack1
 ip address 2.2.2.2 255.255.255.255
#
bgp 100
 peer 4.4.4.4 as-number 100
 peer 4.4.4.4 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 4.4.4.4 enable
 #
 ipv4-family vpnv4
  policy vpn-target
  peer 4.4.4.4 enable
 #
 ipv4-family vpn-instance VPNA
  import-route isis 1
#
return</pre>
</li><li><p>PE2</p>
<pre class="screen">#
sysname PE2
#
ip vpn-instance VPNA
 ipv4-family
  route-distinguisher 400:1
  apply-label per-instance
  vpn-target 3:3 export-extcommunity
  vpn-target 3:3 import-extcommunity
  multicast routing-enable
  multicast inband-signaling mldp
#
mpls lsr-id 4.4.4.4    
#
mpls ldp
 mldp p2mp
#
isis 1 vpn-instance VPNA
  is-level level-2
  network-entity 10.0000.0000.0004.00
  import-route bgp
#
isis 2
  is-level level-2
  network-entity 10.0000.0000.0008.00
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip binding vpn-instance VPNA
 ip address 192.168.3.1 255.255.255.0
 pim sm
 isis enable 1
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 10.1.1.2 255.255.255.0
 isis enable 2
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 4.4.4.4 255.255.255.255
#
bgp 100
 peer 2.2.2.2 as-number 100
 peer 2.2.2.2 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 2.2.2.2 enable
 #
 ipv4-family vpnv4
  policy vpn-target
  peer 2.2.2.2 enable
 #
 ipv4-family vpn-instance VPNA
  import-route isis 1
#
return</pre>
</li><li><p>CE2</p>
<pre class="screen">#
sysname CE2
#
multicast routing-enable
#
isis 1
  is-level level-2
  network-entity 10.0000.0000.0005.00
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 192.168.3.2 255.255.255.0
 pim sm
 isis enable 1
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 10.1.4.1 255.255.255.0
 pim sm
 igmp enable
 igmp version 3
#
interface LoopBack1
 ip address 5.5.5.5 255.255.255.255
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_mldp-in-band_0008.html">Configuration Examples
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_mldp-in-band_0011.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>