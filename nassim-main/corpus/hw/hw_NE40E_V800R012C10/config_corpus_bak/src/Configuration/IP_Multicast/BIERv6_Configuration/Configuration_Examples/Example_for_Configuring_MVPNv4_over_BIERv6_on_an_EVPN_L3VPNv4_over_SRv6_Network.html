
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring MVPNv4 over BIERv6 on an EVPN L3VPNv4 over SRv6 Network">
<meta name="abstract" content="This section describes how to configure MVPNv4 over BIERv6 on a unicast EVPN L3VPNv4 over SRv6 network.">
<meta name="description" content="This section describes how to configure MVPNv4 over BIERv6 on a unicast EVPN L3VPNv4 over SRv6 network.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_bierv6_cfg_0023.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_bierv6_cfg_1013.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_bierv6_cfg_0026.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="z00603461,w00606909,w00447999">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="BIERv6">
<meta name="featuretype" content="IP Multicast">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BIERv6">
<meta name="featuretype" content="IP Multicast">
<meta name="featurename" content="BIERv6">
<meta name="featuretype" content="IP Multicast">
<meta name="featurename" content="BIERv6">
<meta name="featuretype" content="IP Multicast">
<meta name="OWNER" content="w00447999">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="w00447999">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0251394661">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/thickbox.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/imageResize.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery-migrate-1.2.1.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery-ui.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery.mousewheel.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/thickbox.js"></script>
<title>Example for Configuring MVPNv4 over BIERv6 on an EVPN L3VPNv4 over SRv6 Network</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0251394661"></a><a name="EN-US_TASK_0251394661"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring MVPNv4 over BIERv6 on an EVPN L3VPNv4 over SRv6 Network</h1>
<div class="taskbody"><p>This section describes how to configure MVPNv4 over BIERv6 on a unicast EVPN L3VPNv4 over SRv6 network.</p>
<div class="context"><a name="EN-US_TASK_0251394661__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>In <a href="#EN-US_TASK_0251394661__fig35284409229">Figure 1</a>, EVPN L3VPNv4 over SRv6 has been deployed. It is required that MVPNv4 over BIERv6 be deployed on the existing network.</p>
<div class="fignone" id="EN-US_TASK_0251394661__fig35284409229"><a name="EN-US_TASK_0251394661__fig35284409229"></a><a name="fig35284409229"></a><span class="figcap"><b>Figure 1 </b>MVPNv4 over BIERv6 networking</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface 1, interface 2, and interface 3 represent GE <span>0/1/0</span>, GE <span>0/1/1</span>, and GE <span>0/1/2</span>, respectively.</p>
</div></div>
<br><span><img class="imgResize" src="figure/en-us_image_0283435060.png" width="519.7696547080079" height="278.47403429122073" title="Click to enlarge"></span></div>
<p></p>
</div></div>
<div class="context"><a name="EN-US_TASK_0251394661__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>(Optional) Configure EVPN L3VPNv4 over SRv6 and ensure that the unicast VPN runs properly. If the unicast network has been configured, skip this step.</p>
</li><li><p>Configure basic BIERv6 functions and enable IS-ISv6 for BIERv6 on PE1, PE2, PE3, and the P.</p>
</li><li><p>Establish BGP MVPN peer relationships between PEs.</p>
</li><li>Configure multicast traffic forwarding over a BIERv6 I-PMSI tunnel.</li><li>Enable the BIERv6 S-PMSI tunnel function and configure switching criteria.</li><li><p>Enable PIM on PEs.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0251394661__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li>IP addresses of key interfaces on each device, as shown in <a href="#EN-US_TASK_0251394661__fig35284409229">Figure 1</a></li><li>ID (1) of the public network IS-IS process, in a Level-2 area</li><li>VPN instance name (VPNA) on PE1, PE2, and PE3</li><li>PE2's BFR-ID (2), PE3's BFR-ID (3), sub-domain ID (0), BSL (256), and Max-SI (0)</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0251394661__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>(Optional) Configure EVPN L3VPNv4 over SRv6.</span><p><p>This step is a part of configuring the unicast network, and its content is for reference only. In most cases, the unicast network has been configured before multicast services are deployed. If this is the case, skip this step and contact the configuration personnel for the configuration data related to the multicast services. For details about how to configure a unicast network, see <span class="uicontrol"><b>Segment Routing IPv6 Configuration</b></span> in the Configuration Guide.</p>
<p># Enable IPv6 forwarding on each interface and configure an IPv6 address for each interface. The configuration of PE1 is used as an example. The configurations of PE2, PE3, and the P are similar to the configuration of PE1. For configuration details, see <a href="#EN-US_TASK_0251394661__postreq24192593172748">Configuration Files</a> in this section. Similar details will be omitted in the rest of the document.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname PE1</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface gigabitethernet <span>0/1/0</span></strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>ipv6 enable</strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>ipv6 address 2001:db8:1::2 96</strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>interface LoopBack 1</strong>
[<span class="keyword">*</span>PE1-LoopBack1] <strong>ipv6 enable</strong>
[<span class="keyword">*</span>PE1-LoopBack1] <strong>ipv6 address </strong><strong>2001:db8:10::1 128</strong>
[<span class="keyword">*</span>PE1-LoopBack1] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure IS-IS. The configuration of PE1 is used as an example. The configurations of PE2, PE3, and the P are similar to the configuration of PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>is-level level-2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>cost-style wide</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>network-entity 10.0000.0000.0001.00</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>ipv6 enable topology ipv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>isis ipv6 enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface loopback1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack1] <strong>isis ipv6 enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-LoopBack1] <strong>quit</strong></pre>
<p># Configure an IPv4 L3VPN instance on each PE and bind the instance to an access-side interface. The configuration of PE1 is used as an example. The configurations of PE2 and PE3 are similar to the configuration of PE1. The <strong>vpn-target evpn</strong> and <strong>advertise l2vpn evpn</strong> commands allow EVPN routes to be used in an L3VPN and must be configured on an EVPN L3VPN network. To ensure that multicast runs properly, run both the <a href="cmdqueryname=vpn-target"><b><span class="cmdname">vpn-target</span></b></a> and <a href="cmdqueryname=vpn-target+evpn"><b><span class="cmdname">vpn-target evpn</span></b></a> commands.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>multicast mvpn ipv6-underlay </strong><strong>2001:db8:10::1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>ip vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4] <strong>route-distinguisher 100:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4] <strong>vpn-target 111:1 both evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4] <strong>multicast routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4] <strong>mvpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4-mvpn] <strong>vpn-target 111:1 both</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4-mvpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>ip binding vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>ip address 192.168.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>router-id 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>ipv4-family vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-VPNA] <strong>import-route direct</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-VPNA] <strong>advertise l2vpn evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Establish an EBGP peer relationship between each PE and its connected CE. The establishment of an EBGP peer relationship between PE1 and CE1 is used as an example. The establishment of an EBGP peer relationship between PE2 and CE2, and between PE3 and CE3 is similar to that between PE1 and CE1.</p>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>bgp 65410</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp] <strong>router-id 11.11.11.11</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp] <strong>peer 192.168.1.1 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp] <strong>import-route direct</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>commit</strong></pre>
<p></p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>ipv4-family vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-VPNA] <strong>peer 192.168.1.2 as-number 65410</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-VPNA] <strong>commit</strong></pre>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE1-bgp-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp] <strong>quit</strong></pre>
<p># Establish a BGP EVPN peer relationship between PE1 and PE2 and between PE1 and PE3. The configuration of PE1 is used as an example. The configurations of PE2 and PE3 are similar to the configuration of PE1. After you run the <a href="cmdqueryname=peer+enable"><b><span class="cmdname">peer enable</span></b></a> command, enter <span class="uicontrol"><b>Y</b></span> at the system prompt to confirm the action.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp] <strong>peer 2001:db8:20::1 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 2001:db8:30::1 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer </strong><strong>2001:db8:20::1</strong><strong> connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 2001:db8:30::1 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>l2vpn-family evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-evpn] <strong>peer </strong><strong>2001:db8:20::1</strong><strong> enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-evpn] <strong>peer </strong><strong>2001:db8:30::1</strong><strong> enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-evpn] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp-af-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp] <strong>quit</strong></pre>
<p># Configure SRv6 SIDs, and configure PEs to add SIDs to the VPN routes to be advertised. The configurations of PE1 and P are used as an example. The configurations of PE2 and PE3 are similar to the configuration of PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>segment-routing ipv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing-ipv6] <strong>encapsulation source-address 2001:db8:10::1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing-ipv6] <strong>locator PE1 ipv6-prefix </strong><strong>2001:db8:100::</strong><strong> 64 static 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing-ipv6-locator] <strong>opcode ::10 end</strong> <strong>psp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing-ipv6-locator] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>l2vpn-family evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-evpn] <strong>peer </strong><strong>2001:db8:20::1</strong><strong> advertise encap-type srv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-evpn] <strong>peer </strong><strong>2001:db8:30::1</strong><strong> advertise encap-type srv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>ipv4-family vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-VPNA] <strong>segment-routing ipv6</strong><strong> </strong><strong>best-effort</strong> <strong>evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-VPNA] <strong>segment-routing ipv6 locator PE1</strong> <strong>evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-VPNA] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-isis-1] <strong>segment-routing ipv6 locator PE1 auto-sid-disable</strong> </pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-isis-1] <strong>quit</strong></pre>
<p></p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P] <strong>segment-routing ipv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-segment-routing-ipv6] <strong>encapsulation source-address </strong><strong>2001:db8:40::1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-segment-routing-ipv6] <strong>locator P ipv6-prefix <span>2001:db8:400::</span> 64 static 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-segment-routing-ipv6-locator] <strong>opcode ::40 end</strong> <strong>psp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-segment-routing-ipv6-locator] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-segment-routing-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-isis-1] <strong>segment-routing ipv6 locator P</strong><strong> auto-sid-disable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-isis-1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P-isis-1] <strong>quit</strong></pre>
<p># Perform other unicast network configurations based on unicast service requirements.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0251394661__en-us_task_0251394660_p76909297241">In an MVPNv4 over BIERv6 scenario, if routes sent by a multicast source CE to a root PE carry Source AS Extended Community and VRF Route Import Extended Community attributes and the root PE needs to advertise only locally configured Source AS Extended Community and VRF Route Import Extended Community attributes among extended community attributes in the routes to be sent to a leaf PE, run the <a href="cmdqueryname=attr-set"><b><span class="cmdname" id="EN-US_TASK_0251394661__en-us_task_0251394660_cmdname16499913182513">attr-set</span></b></a> command in the BGP-VPN instance IPv4 address family view on the root PE.</p>
</div></div>
</p></li><li><span>Configure basic BIERv6 functions and enable IS-ISv6 for BIERv6 on PE1, PE2, PE3, and the P.</span><p><div class="p"># Configure PE1.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bier</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bier] <strong>sub-domain 0</strong> <strong>ipv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bier-sub-domain-0-ipv6] <strong>bfr-id 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bier-sub-domain-0-ipv6] <strong>encapsulation-type ipv6 bsl 256 max-si 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bier-sub-domain-0-ipv6] <strong>bfr-prefix interface loopback1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bier-sub-domain-0-ipv6] <strong>end-bier locator PE1 sid 2001:db8:100::1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bier-sub-domain-0-ipv6]<strong> protocol isis</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bier-sub-domain-0-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bier] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>bier enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</div>
<div class="p"># Configure PE2.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>bier</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bier] <strong>sub-domain 0</strong> <strong>ipv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bier-sub-domain-0-ipv6] <strong>bfr-id 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bier-sub-domain-0-ipv6] <strong>encapsulation-type ipv6 bsl 256 max-si 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bier-sub-domain-0-ipv6] <strong>bfr-prefix interface loopback1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bier-sub-domain-0-ipv6] <strong>end-bier locator PE2 sid 2001:db8:200::1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bier-sub-domain-0-ipv6]<strong> protocol isis</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bier-sub-domain-0-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bier] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1] <strong>bier enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</div>
<div class="p"># Configure PE3.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>bier</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bier] <strong>sub-domain 0</strong> <strong>ipv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bier-sub-domain-0-ipv6] <strong>bfr-id 3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bier-sub-domain-0-ipv6] <strong>encapsulation-type ipv6 bsl 256 max-si 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bier-sub-domain-0-ipv6] <strong>bfr-prefix interface loopback1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bier-sub-domain-0-ipv6] <strong>end-bier locator PE3 sid 2001:db8:300::1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bier-sub-domain-0-ipv6]<strong> protocol isis</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bier-sub-domain-0-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bier] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-isis-1] <strong>bier enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
</div>
<div class="p"># Configure the P.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P] <strong>bier</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-bier] <strong>sub-domain 0</strong> <strong>ipv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-bier-sub-domain-0-ipv6] <strong>encapsulation-type ipv6 bsl 256 max-si 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-bier-sub-domain-0-ipv6] <strong>bfr-prefix interface loopback1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-bier-sub-domain-0-ipv6] <strong>end-bier locator P sid 2001:db8:400::1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-bier-sub-domain-0-ipv6]<strong> protocol isis</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-bier-sub-domain-0-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-bier] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-isis-1] <strong>bier enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>commit</strong></pre>
</div>
</p></li><li><span>Establish BGP MVPN peer relationships between PEs.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp] <strong>ipv4-family mvpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-mvpn] <strong>peer 2001:db8:20::1 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-mvpn] <strong>peer 2001:db8:30::1 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-mvpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-bgp] <strong>ipv4-family mvpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-mvpn] <strong>peer 2001:db8:10::1 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-mvpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3-bgp] <strong>ipv4-family mvpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp-af-mvpn] <strong>peer 2001:db8:10::1 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp-af-mvpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
<p># Display information about BGP MVPN peers. The command output shows that a BGP MVPN peer relationship has been established between PE1 and PE2 and between PE1 and PE3.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE1]<strong>display bgp mvpn all peer</strong>

 BGP local router ID : 1.1.1.1    
 Local AS number : 100           
 Total number of peers : 2                 Peers in established state : 2
 
  Peer                             V          AS  MsgRcvd  MsgSent  OutQ  Up/Down       State  PrefRcv
  2001:DB8:20::1                   4         100   41      43    0 00:08:08        <strong>Established</strong>      0
  2001:DB8:30::1                   4         100   29      32    0 00:07:15        <strong>Established</strong>      0</pre>
</p></li><li><span>Configure multicast traffic forwarding over a BIERv6 I-PMSI tunnel.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>ip vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4] <strong>mvpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4-mvpn] <strong>c-multicast signaling bgp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4-mvpn] <strong>sender-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4-mvpn] <strong>ipv6 underlay enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4-mvpn] <strong>src-dt4 locator PE1 sid 2001:db8:100::2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4-mvpn] <strong>rpt-spt mode</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4-mvpn] <strong>ipmsi-tunnel</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4-mvpn-ipmsi] <strong>bier sub-domain 0 bsl 256</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4-mvpn-ipmsi] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4-mvpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>ip vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4] <strong>multicast routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA-af-ipv4] <strong>mvpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA-af-ipv4-mvpn] <strong>ipv6 underlay enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA-af-ipv4-mvpn] <strong>c-multicast signaling bgp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA-af-ipv4-mvpn] <strong>rpt-spt mode</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA-af-ipv4-mvpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>ip vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-VPNA] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4] <strong>multicast routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-VPNA-af-ipv4] <strong>mvpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-VPNA-af-ipv4-mvpn] <strong>ipv6 underlay enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-VPNA-af-ipv4-mvpn] <strong>c-multicast signaling bgp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-VPNA-af-ipv4-mvpn] <strong>rpt-spt mode</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-VPNA-af-ipv4-mvpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-VPNA-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
<p># Display I-PMSI tunnel information of a specified VPN instance. The command output shows that an I-PMSI tunnel has been established, with PE1 as the root node and PE2 and PE3 as leaf nodes.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE1]<strong>display mvpn vpn-instance VPNA ipmsi</strong>
MVPN local I-PMSI information for VPN-Instance: VPNA
Tunnel type: BIER IPv6
Tunnel state: Up
Src-dt4 SID: 2001:DB8:100::2 
Sub-domain ID: 0
BFR-ID: 1
BFR prefix: 2001:DB8:10::1
Bit string ID: 1
Root: 2001:DB8:10::1 (local) 
Leaf: 
  1: 2001:DB8:20::1 (BFR-ID: 2, BFR prefix: 2001:DB8:20::1)
  2: 2001:DB8:30::1 (BFR-ID: 3, BFR prefix: 2001:DB8:30::1)</pre>
</p></li><li><span>Enable the BIERv6 S-PMSI tunnel function and configure switching criteria.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>ip vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4] <strong>mvpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4-mvpn] <strong>spmsi-tunnel</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4-mvpn-spmsi] <strong>group 225.1.1.0 24 source 192.168.11.0 24 threshold 10 bier</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4-mvpn-spmsi] <strong>switch-delay 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4-mvpn-spmsi] <strong>holddown-time 80</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4-mvpn-spmsi] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4-mvpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</p></li><li><span>Enable PIM on PEs.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface LoopBack2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Loopback2] <strong>ip binding vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack2] <strong>ip address 10.1.1.1 255.255.255.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Loopback2] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Loopback2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>pim vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-pim-VPNA] <strong>static-rp 10.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-pim-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-GigabitEthernet<span>0/1/1</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>pim vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-pim-VPNA] <strong>static-rp 10.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-pim-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3-GigabitEthernet<span>0/1/1</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>pim vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-pim-VPNA] <strong>static-rp 10.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-pim-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
<p># Display S-PMSI tunnel information of MVPN services in a specified VPN instance. The command output on PE2 shows the S-PMSI tunnel and multicast user information.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE2]<strong>display mvpn vpn-instance VPNA spmsi</strong> <strong>verbose</strong>
MVPN local S-PMSI information for VPN-Instance : VPNA 
 Total number of tunnel: 1 
 S-PMSI A-D Route Type: -- 
 Tunnel type: BIER IPv6 
 Tunnel state: -- 
 Src-dt4 SID: 2001:DB8:100::1 
 Sub-domain ID: 0 
 BFR-ID: 1 
 BFR prefix: 2001:DB8:10::1 
 Root: 2001:DB8:10::1 
 Leaf: 
   1: 2001:DB8:20::1 (BFR-ID: 2, BFR prefix: 2001:DB8:20::1)(local)
</pre>
</p></li></ol></div>
<div class="postreq"><a name="EN-US_TASK_0251394661__postreq24192593172748"></a><a name="postreq24192593172748"></a><a name="EN-US_TASK_0251394661__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><p>CE1 configuration file</p>
<pre class="screen">#  
sysname CE1   
#
multicast routing-enable
#
interface GigabitEthernet <span>0/1/0</span>
 undo shutdown
 ip address 192.168.1.2 255.255.255.0
 pim sm
#
interface GigabitEthernet <span>0/1/1</span>
 undo shutdown
 ip address 192.168.11.2 255.255.255.0
 pim sm
#
bgp 65410
 router-id 11.11.11.11
 peer 192.168.1.1 as-number 100
 #
 ipv4-family unicast
  undo synchronization
  import-route direct
  peer 192.168.1.1 enable
#
return</pre>
<p>CE2 configuration file</p>
<pre class="screen">#  
sysname CE2   
#
multicast routing-enable
#
interface GigabitEthernet <span>0/1/0</span>
 undo shutdown
 ip address 192.168.2.2 255.255.255.0
 pim sm
# 
interface GigabitEthernet <span>0/1/1</span>
 undo shutdown
 ip address 192.168.4.2 255.255.255.0
 pim sm
 igmp enable
 igmp version 3
#
bgp 65411
 router-id 12.12.12.12
 peer 192.168.2.1 as-number 100
 #
 ipv4-family unicast
  undo synchronization
  import-route direct
  peer 192.168.2.1 enable
#
return</pre>
<p>CE3 configuration file</p>
<pre class="screen">#  
sysname CE3   
#
multicast routing-enable
#
interface GigabitEthernet <span>0/1/0</span>
 undo shutdown
 ip address 192.168.3.2 255.255.255.0
 pim sm
#
interface GigabitEthernet <span>0/1/1</span>
 undo shutdown
 ip address 192.168.5.2 255.255.255.0
 pim sm
 igmp enable
 igmp version 3
#
bgp 65412
 router-id 13.13.13.13
 peer 192.168.3.1 as-number 100
 #
 ipv4-family unicast
  undo synchronization
  import-route direct
  peer 192.168.3.1 enable
#
return</pre>
<p>PE1 configuration file</p>
<pre class="screen">#                                                                               
sysname PE1                                                                     
#                                                                               
multicast mvpn ipv6-underlay 2001:DB8:10::1                                     
#                                                                                                        
ip vpn-instance VPNA                                                            
 ipv4-family                                                                    
  route-distinguisher 100:1                                                     
  apply-label per-instance                                                                    
  vpn-target 111:1 export-extcommunity evpn                                          
  vpn-target 111:1 import-extcommunity evpn                                     
  multicast routing-enable                                                      
  mvpn                                                                          
   vpn-target 111:1 export-extcommunity
   vpn-target 111:1 import-extcommunity
   ipv6 underlay enable                                                         
   sender-enable                                                                
   src-dt4 locator PE1 sid 2001:DB8:100::2
   c-multicast signaling bgp 
   rpt-spt mode
   ipmsi-tunnel                                                                 
    bier                                                                        
   spmsi-tunnel                                                                 
    holddown-time 80                                                            
    switch-delay 20                                                             
    group 225.1.1.0 255.255.255.0 source 192.168.11.0 255.255.255.0 threshold 10 bier
#                                                                               
segment-routing ipv6                                                            
 encapsulation source-address 2001:DB8:10::1                                    
 locator PE1 ipv6-prefix 2001:DB8:100:: 64 static 32                            
  opcode ::10 end psp                                                       
#                                                                               
isis 1                                                                          
 is-level level-2                                                               
 cost-style wide                                                                
 network-entity 10.0000.0000.0001.00                                            
 bier enable                                                                    
 #                                                                              
 ipv6 enable topology ipv6                                                      
 segment-routing ipv6 locator PE1 auto-sid-disable                              
 #                                                                              
#                                                                               
interface GigabitEthernet<span>0/1/0</span>                                                         
 undo shutdown                                                                  
 ipv6 enable                                                                    
 ipv6 address 2001:DB8:1::2/96                                                  
 isis ipv6 enable 1                                                                                    
#                                                                               
interface GigabitEthernet<span>0/1/1</span>                                                        
 undo shutdown                                                                  
 ip binding vpn-instance VPNA                                                   
 ip address 192.168.1.1 255.255.255.0                                           
 pim sm
#
interface LoopBack2
 ip binding vpn-instance VPNA<strong> </strong>
 ip address 10.1.1.1 255.255.255.255
 pim sm
# 
pim vpn-instance VPNA
 static-rp 10.1.1.1
#                                                                                                    
interface LoopBack1                                                             
 ipv6 enable                                                                    
 ipv6 address 2001:DB8:10::1/128                                                
 isis ipv6 enable 1  
#                                                                               
bgp 100                                                                         
 router-id 1.1.1.1                                                              
 peer 2001:DB8:20::1 as-number 100                                              
 peer 2001:DB8:20::1 connect-interface LoopBack1                                
 peer 2001:DB8:30::1 as-number 100                                              
 peer 2001:DB8:30::1 connect-interface LoopBack1                                
 #                                                                              
 ipv4-family unicast                                                            
  undo synchronization                                                          
 #                                                                              
 ipv4-family mvpn                                                               
  policy vpn-target                                                             
  peer 2001:DB8:20::1 enable                                                    
  peer 2001:DB8:30::1 enable                                                    
 #                                                                              
 ipv4-family vpn-instance VPNA                                                  
  import-route direct                                                           
  advertise l2vpn evpn                                                          
  segment-routing ipv6 locator PE1 evpn                                         
  segment-routing ipv6 best-effort evpn                        
  peer 192.168.1.2 as-number 65410                                              
 #                                                                              
 l2vpn-family evpn                                                              
  policy vpn-target                                                             
  peer 2001:DB8:20::1 enable                                                    
  peer 2001:DB8:20::1 advertise encap-type srv6                                 
  peer 2001:DB8:30::1 enable                                                    
  peer 2001:DB8:30::1 advertise encap-type srv6                                 
#      
bier                                                                            
 sub-domain 0 ipv6
  bfr-id 1                                                              
  bfr-prefix interface LoopBack1                                                
  protocol isis                                                                 
  end-bier locator PE1 sid 2001:DB8:100::1                                      
  encapsulation-type ipv6 bsl 256 max-si 0                                              
#                                                                                                              
return</pre>
<p>PE2 configuration file</p>
<pre class="screen">#                                                                               
sysname PE2                                                                     
#                                                                            
multicast mvpn ipv6-underlay 2001:DB8:20::1                                     
#                                                                               
ip vpn-instance VPNA                                                            
 ipv4-family                                                                    
  route-distinguisher 100:1                                                     
  apply-label per-instance                                                      
  vpn-target 111:1 export-extcommunity evpn
  vpn-target 111:1 import-extcommunity evpn                                     
  multicast routing-enable                                                      
  mvpn                                                                          
   vpn-target 111:1 export-extcommunity
   vpn-target 111:1 import-extcommunity
   ipv6 underlay enable
   c-multicast signaling bgp
   rpt-spt mode                                                    
#                                                 
segment-routing ipv6                                                            
 encapsulation source-address 2001:DB8:20::1                                    
 locator PE2 ipv6-prefix 2001:DB8:200:: 64 static 32                            
  opcode ::20 end psp                                                       
#                                                                               
isis 1                                                                          
 is-level level-2                                                               
 cost-style wide                                                                
 network-entity 10.0000.0000.0002.00                                            
 bier enable                                                                    
 #                                                                              
 ipv6 enable topology ipv6                                                      
 segment-routing ipv6 locator PE2 auto-sid-disable                              
 #                                                                              
#                                                                               
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown                                                                  
 ipv6 enable                                                                    
 ipv6 address 2001:DB8:2::2/96                                                  
 isis ipv6 enable 1                                                             
#                                                                               
interface GigabitEthernet<span>0/1/1</span>                                                        
 undo shutdown                                                                  
 ip binding vpn-instance VPNA                                                   
 ip address 192.168.2.1 255.255.255.0                                           
 pim sm
# 
pim vpn-instance VPNA
 static-rp 10.1.1.1  
#                                                                               
interface LoopBack1                                                             
 ipv6 enable                                                                    
 ipv6 address 2001:DB8:20::1/128                                                
 isis ipv6 enable 1                                                             
#                                     
bgp 100                                                                         
 router-id 1.1.1.2                                                              
 peer 2001:DB8:10::1 as-number 100                                              
 peer 2001:DB8:10::1 connect-interface LoopBack1                                
 #                                                                              
 ipv4-family unicast                                                            
  undo synchronization                                                          
 #                                                                              
 ipv4-family mvpn                                                               
  policy vpn-target                                                             
  peer 2001:DB8:10::1 enable                                                    
 #                                                                              
 ipv4-family vpn-instance VPNA                                                  
  import-route direct                                                           
  advertise l2vpn evpn                                                          
  segment-routing ipv6 locator PE2 evpn
  segment-routing ipv6 best-effort evpn                        
  peer 192.168.2.2 as-number 65411                                              
 #                                                                              
 l2vpn-family evpn                                                              
  policy vpn-target                                                             
  peer 2001:DB8:10::1 enable                                                    
  peer 2001:DB8:10::1 advertise encap-type srv6                                 
#                    
bier                                                                            
 sub-domain 0 ipv6                                                              
  bfr-id 2                                                                      
  bfr-prefix interface LoopBack1                                                
  protocol isis                                                                 
  end-bier locator PE2 sid 2001:DB8:200::1                                      
  encapsulation-type ipv6 bsl 256 max-si 0                                      
#                                       
return</pre>
<p>PE3 configuration file</p>
<pre class="screen">#                                                                               
sysname PE3                                                                     
#                                                                            
multicast mvpn ipv6-underlay 2001:DB8:30::1                                     
#                                                                               
ip vpn-instance VPNA                                                            
 ipv4-family                                                                    
  route-distinguisher 100:1                                                     
  apply-label per-instance                                                      
  vpn-target 111:1 export-extcommunity evpn               
  vpn-target 111:1 import-extcommunity evpn                                     
  multicast routing-enable                                                      
  mvpn                                                                          
   vpn-target 111:1 export-extcommunity
   vpn-target 111:1 import-extcommunity
   ipv6 underlay enable
   c-multicast signaling bgp
   rpt-spt mode                                                    
#                                                 
segment-routing ipv6                                                            
 encapsulation source-address 2001:DB8:30::1                                    
 locator PE3 ipv6-prefix 2001:DB8:300:: 64 static 32                            
  opcode ::30 end psp                                                       
#                                                                               
isis 1                                                                          
 is-level level-2                                                               
 cost-style wide                                                                
 network-entity 10.0000.0000.0003.00                                            
 bier enable                                                                    
 #                                                                              
 ipv6 enable topology ipv6                                                      
 segment-routing ipv6 locator PE3 auto-sid-disable                              
 #                                                                              
#                                                                               
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown                                                                  
 ipv6 enable                                                                    
 ipv6 address 2001:DB8:3::2/96                                                  
 isis ipv6 enable 1                                                             
#                                                                               
interface GigabitEthernet<span>0/1/1</span>                                                        
 undo shutdown                                                                  
 ip binding vpn-instance VPNA                                                   
 ip address 192.168.3.1 255.255.255.0                                           
 pim sm
# 
pim vpn-instance VPNA
 static-rp 10.1.1.1 
#                                                                               
interface LoopBack1                                                             
 ipv6 enable                                                                    
 ipv6 address 2001:DB8:30::1/128                                                
 isis ipv6 enable 1                                                             
#
bgp 100                                                                         
 router-id 1.1.1.3                                                              
 peer 2001:DB8:10::1 as-number 100                                              
 peer 2001:DB8:10::1 connect-interface LoopBack1                                
 #                                                                              
 ipv4-family unicast                                                            
  undo synchronization                                                          
 #                                                                              
 ipv4-family mvpn                                                               
  policy vpn-target                                                             
  peer 2001:DB8:10::1 enable                                                    
 #                                                                              
 ipv4-family vpn-instance VPNA                                                  
  import-route direct                                                           
  advertise l2vpn evpn                                                          
  segment-routing ipv6 locator PE3 evpn
  segment-routing ipv6 best-effort evpn                        
  peer 192.168.3.2 as-number 65412                                              
 #                                                                              
 l2vpn-family evpn                                                              
  policy vpn-target                                                             
  peer 2001:DB8:10::1 enable                                                    
  peer 2001:DB8:10::1 advertise encap-type srv6                                 
#                    
bier                                                                            
 sub-domain 0 ipv6                                                              
  bfr-id 3                                                                      
  bfr-prefix interface LoopBack1                                                
  protocol isis                                                                 
  end-bier locator PE3 sid 2001:DB8:300::1                                      
  encapsulation-type ipv6 bsl 256 max-si 0                                      
#                                       
return</pre>
<p>P configuration file</p>
<pre class="screen">#                                                                               
sysname P                                                                       
# 
segment-routing ipv6                                                            
 encapsulation source-address 2001:DB8:40::1                                    
 locator P ipv6-prefix 2001:DB8:400:: 64 static 32                              
  opcode ::40 end psp                                                       
#                                                                               
isis 1                                                                          
 is-level level-2                                                               
 cost-style wide                                                                
 network-entity 10.0000.0000.0004.00                                            
 bier enable                                                                    
 #                                                                              
 ipv6 enable topology ipv6                                                      
 segment-routing ipv6 locator P auto-sid-disable                                
 #                                                                              
#                                                                               
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown                                                                  
 ipv6 enable                                                                    
 ipv6 address 2001:DB8:1::1/96        
 isis ipv6 enable 1                                                             
#                                                                               
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown                                                                  
 ipv6 enable                                                                    
 ipv6 address 2001:DB8:2::1/96                                                  
 isis ipv6 enable 1                                                             
#                                                                               
interface GigabitEthernet<span>0/1/2</span> 
 undo shutdown                                                                  
 ipv6 enable                                                                    
 ipv6 address 2001:DB8:3::1/96                                                  
 isis ipv6 enable 1                                                             
#                                                                               
interface LoopBack1                                                             
 ipv6 enable                                                                    
 ipv6 address 2001:DB8:40::1/128                                                
 isis ipv6 enable 1                                                             
#                                                                               
bier                                                                            
 sub-domain 0 ipv6                                                              
  bfr-prefix interface LoopBack1                                                
  protocol isis                                                                 
  end-bier locator P sid 2001:DB8:400::1                                        
  encapsulation-type ipv6 bsl 256 max-si 0                                    
#                                                                               
return            </pre>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_bierv6_cfg_0023.html">Configuration Examples
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_bierv6_cfg_1013.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_bierv6_cfg_0026.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>

<script language="JavaScript">
<!--
image_size('.imgResize');
var msg_imageMax = "view original image";
var msg_imageClose = "close";
//--></script></body>
</html>