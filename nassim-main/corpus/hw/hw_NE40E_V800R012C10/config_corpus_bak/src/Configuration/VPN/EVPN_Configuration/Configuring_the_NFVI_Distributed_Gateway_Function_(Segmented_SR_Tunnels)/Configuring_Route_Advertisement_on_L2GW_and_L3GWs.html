
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring Route Advertisement on L2GW/L3GWs">
<meta name="abstract" content="Route advertisement allows L2GW/L3GWs to construct their own forwarding entries based on received EVPN or BGP routes.">
<meta name="description" content="Route advertisement allows L2GW/L3GWs to construct their own forwarding entries based on received EVPN or BGP routes.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0121.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0123.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0125.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="l00425560">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00878323">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172370577">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring Route Advertisement on L2GW/L3GWs</title>
</head>
<body><a name="EN-US_TASK_0172370577"></a><a name="EN-US_TASK_0172370577"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring Route Advertisement on L2GW/L3GWs</h1>
<div class="taskbody"><p>Route advertisement allows L2GW/L3GWs to construct their own forwarding entries based on received EVPN or BGP routes.</p>
<div class="steps"><a name="EN-US_TASK_0172370577__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure L2GW/L3GWs to generate ARP or ND entries for Layer 2 forwarding based on the ARP or ND information in EVPN routes.</span><ol type="a"><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=interface"><b><span class="cmdname">interface</span></b></a> <strong><span>vbdif</span></strong> <i><span class="varname">bd-id</span></i></span><p><p>A VBDIF interface is created, and its view is displayed.</p>
</p></li><li class="substepexpand"><span>Configure the L2GW/L3GW to generate ARP or ND entries for Layer 2 forwarding based on the ARP or ND information in EVPN routes.</span><p><ul><li><p>Run the <a href="cmdqueryname=arp+generate-rd-table+enable"><b><span class="cmdname">arp generate-rd-table enable</span></b></a> command to configure the L2GW/L3GW to generate ARP entries for Layer 2 forwarding based on the ARP information in EVPN routes.</p>
</li><li><p>Run the <a href="cmdqueryname=ipv6+nd+generate-rd-table+enable"><b><span class="cmdname">ipv6 nd generate-rd-table enable</span></b></a> command to configure the L2GW/L3GW to generate ND entries for Layer 2 forwarding based on the ND information in EVPN routes.</p>
</li></ul>
</p></li><li class="substepexpand"><span>Configure the function of collecting host information by VBDIF interface.</span><p><ul><li><p>To enable host information collection for IPv4 services, run the <a href="cmdqueryname=arp+collect+host+enable"><b><span class="cmdname">arp collect host enable</span></b></a> command.</p>
</li><li><p>To enable host information collection for IPv6 services, run the <a href="cmdqueryname=ipv6+nd+collect+host+enable"><b><span class="cmdname">ipv6 nd collect host enable</span></b></a> command.</p>
</li></ul>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=ipv6+nd+dad+attempts"><b><span class="cmdname">ipv6 nd dad attempts</span></b></a> <strong>0</strong></span><p><p>DAD is prohibited. This command is mandatory in IPv6 scenarios. It helps prevent service interruptions that occur because the system detects that the IPv6 address of another device is the same as that of the VBDIF interface.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Exit the VBDIF interface view.</p>
</p></li></ol>
</li><li><span>Configure the L3VPN instance on L2GW/L3GWs to advertise the static VPN routes destined for VNFs to EVPN.</span><ol type="a"><li class="substepexpand"><span>Create a route-policy so that the static VPN routes destined for VNFs can be filtered out in the L3VPN instance. For detailed configurations, see <a href="dc_vrp_route-policy_cfg_0007.html">Configuring a Route-Policy</a>. During the configuration of an apply clause, run the <a href="cmdqueryname=apply+gateway-ip"><b><span class="cmdname">apply gateway-ip</span></b></a> { <strong><span>origin-nexthop</span></strong> | <i><span class="varname">ipv4-address</span></i> } or <a href="cmdqueryname=apply+ipv6+gateway-ip"><b><span class="cmdname">apply ipv6 gateway-ip</span></b></a> { <strong><span>origin-nexthop</span></strong> | <i><span class="varname">ipv6-address</span></i> } command to specify the original next hop address of a static VPN route as a gateway address.</span></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ip+vpn-instance"><b><span class="cmdname">ip vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i></span><p><p>The VPN instance view is displayed.</p>
</p></li><li class="substepexpand"><span>Enter the VPN instance IPv4 or IPv6 address family view.</span><p><ul><li><p>Run the <a href="cmdqueryname=ipv4-family"><b><span class="cmdname">ipv4-family</span></b></a> command to enter the VPN instance IPv4 address family view.</p>
</li><li><p>Run the <a href="cmdqueryname=ipv6-family"><b><span class="cmdname">ipv6-family</span></b></a> command to enter the VPN instance IPv6 address family view.</p>
</li></ul>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=export+route-policy"><b><span class="cmdname">export route-policy</span></b></a> <i><span class="varname">policy-name</span></i> <strong><span>evpn</span></strong></span><p><p>An export route-policy is applied to the L3VPN instance, so that the L3VPN instance can filter routes to be advertised to EVPN. This ensures that the L3VPN instance advertises only static VPN routes reachable to VNFs to EVPN.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Exit the VPN instance IPv4 or IPv6 address family view.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Exit the VPN instance view.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Enter the BGP-VPN instance IPv4 or IPv6 address family view.</span><p><ul><li><p>Run the <a href="cmdqueryname=ipv4-family"><b><span class="cmdname">ipv4-family</span></b></a> <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i> command to enter the BGP-VPN instance IPv4 address family view.</p>
</li><li><p>Run the <a href="cmdqueryname=ipv6-family"><b><span class="cmdname">ipv6-family</span></b></a> <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i> command to enter the BGP-VPN instance IPv6 address family view.</p>
</li></ul>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=import-route"><b><span class="cmdname">import-route</span></b></a> <strong><span>static</span></strong> [ <strong><span>med</span></strong> <i><span class="varname">med</span></i> | <strong><span>route-policy</span></strong> <i><span class="varname">route-policy-name</span></i> ] <sup>*</sup></span><p><p>Static routes are imported into the routing table for the BGP-VPN instance IPv4 or IPv6 address family.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=advertise+l2vpn+evpn"><b><span class="cmdname">advertise l2vpn evpn</span></b></a> [ <strong><span>import-route-multipath</span></strong> ]</span><p><p>The function to advertise IP routes from the VPN instance to the EVPN instance is enabled.</p>
<p>If the load balancing function needs to be deployed on the network, specify the <strong><span>import-route-multipath</span></strong> parameter so that the VPN instance can advertise all the routes with the same destination address to the EVPN instance.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=irb+asymmetric"><b><span class="cmdname">irb asymmetric</span></b></a></span><p><p>The asymmetric mode is enabled for IRB routes.</p>
<p>If L2GW/L3GWs are configured to advertise ARP or ND routes to each other, skip this step. If L2GW/L3GWs are configured to advertise IRB or IRBv6 routes to each other, perform this step so that L2GW/L3GWs do not generate IP prefix routes. This prevents routing loops.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Exit the BGP-VPN instance IPv4 or IPv6 address family view.</p>
</p></li></ol>
</li><li><span>Configure L2GW/L3GWs to send IRB/IRBv6 or ARP/ND routes to DCGWs.</span><ol type="a"><li class="substepexpand"><span>Run <a href="cmdqueryname=l2vpn-family+evpn"><b><span class="cmdname">l2vpn-family evpn</span></b></a></span><p><p>The BGP-EVPN address family view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer+advertise"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>advertise</span></strong> { <strong><span>irb</span></strong> | <strong><span>arp</span></strong> | <strong><span>irbv6</span></strong> | <strong><span>nd</span></strong> }</span><p><p>L2GW/L3GWs are configured to advertise IRB/IRBv6 or ARP/ND routes.</p>
<p>If L2GW/L3GWs are configured to advertise ARP or ND routes, L2GW/L3GWs send only the routes carrying MAC addresses and ARP information to DCGWs. If L2GW/L3GWs are configured to advertise IRB or IRBv6 routes, L2GW/L3GWs send routes carrying MAC address, ARP information, and L3 VNIs to DCGWs. In this case, you need to run the <a href="cmdqueryname=irb+asymmetric"><b><span class="cmdname">irb asymmetric</span></b></a> command on DCGWs so that DCGWs do not generate IP prefix routes based on IP addresses and L3 VNIs. This prevents routing loops.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Exit the BGP-EVPN address family view.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Exit the BGP view.</p>
</p></li></ol>
</li><li><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0121.html">Configuring the NFVI Distributed Gateway Function (Segmented SR Tunnels)
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0123.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0125.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>