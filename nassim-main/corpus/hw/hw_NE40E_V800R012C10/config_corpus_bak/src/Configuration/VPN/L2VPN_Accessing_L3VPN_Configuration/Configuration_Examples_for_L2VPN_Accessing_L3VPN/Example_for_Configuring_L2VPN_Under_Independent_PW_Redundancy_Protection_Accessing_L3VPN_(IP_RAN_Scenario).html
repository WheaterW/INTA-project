
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring L2VPN Under Independent PW Redundancy Protection Accessing L3VPN (IP RAN Scenario)">
<meta name="abstract" content="Mixed VPN is a bearer mode used by the IPTime MBB solution. This solution is a major solution for IP mobile backhaul (MBH) networks that Huawei builds.">
<meta name="description" content="Mixed VPN is a bearer mode used by the IPTime MBB solution. This solution is a major solution for IP mobile backhaul (MBH) networks that Huawei builds.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2-l3_cfg_5013.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2-l3_cfg_5016.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2-l3_cfg_5028.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,w00556928,w00606909,l00455378,l2-l3">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="L2VPN Accessing L3VPN">
<meta name="featuretype" content="VPN">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="L2VPN Accessing L3VPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="L2VPN Accessing L3VPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="L2VPN Accessing L3VPN">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="l00415692">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00415692">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172370382">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>Example for Configuring L2VPN Under Independent PW Redundancy Protection Accessing L3VPN (IP RAN Scenario)</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172370382"></a><a name="EN-US_TASK_0172370382"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring L2VPN Under Independent PW Redundancy Protection Accessing L3VPN (IP RAN Scenario)</h1>
<div class="taskbody"><p>Mixed VPN is a bearer mode used by the IPTime MBB solution. This solution is a major solution for IP mobile backhaul (MBH) networks that Huawei builds.</p>
<div class="context"><a name="EN-US_TASK_0172370382__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>The mixed VPN solution provides excellent FMC capabilities and adopts a simple and flexible networking scheme. The network between CSGs and RSGs is designed hierarchically to meet large-scale service bearer requirements.</p>
<p>CSGs are connected to form the access network, and ASGs and RSGs are connected to form the aggregation network. All these devices can be flexibly deployed to meet LTE service bearer requirements. See <a href="#EN-US_TASK_0172370382__fig_dc_vrp_l2-l3_cfg_501701">Figure 1</a>.</p>
<div class="fignone" id="EN-US_TASK_0172370382__fig_dc_vrp_l2-l3_cfg_501701"><a name="EN-US_TASK_0172370382__fig_dc_vrp_l2-l3_cfg_501701"></a><a name="fig_dc_vrp_l2-l3_cfg_501701"></a><span class="figcap"><b>Figure 1 </b>Configuring L2VPN under independent PW redundancy protection accessing L3VPN (IP RAN scenario)</span><br><span><img class="vsd" src="images/fig_dc_vrp_l2-l3_cfg_501601.png"></span></div>
<div class="p">The integrated L2VPN+L3VPN solution allows Ethernet base stations to communicate with EPC devices. ASGs terminate the L2VPN and provide access to the L3VPN through a VE group. Independent PW redundancy is configured on CSGs to protect PWs. VRRP is configured between ASGs to determine the master/backup status of each ASG. VRRP is also configured between RSGs to determine the master/backup status of each RSG. VPN FRR is configured for the L3VPN to protect links, providing reliable connections for services.<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0172370382__en-us_task_0172370377_p13122204117209">This example uses VE interfaces to implement L2VPN accessing L3VPN. Because VE interfaces are bound to only one board, services are interrupted when the board fails. To improve service reliability, create two global VE interfaces on each ASG: Global-VE1 (L2VE interface used to terminate L2VPN services) and Global-VE2 (L3VE interface used to access an L3VPN network). Other configurations do not need to be changed.</p>
</div></div>
</div>
<p>HVPLS (PWE3 accessing VPLS) or PWE3 can be used to deploy the L2VPN. This example uses Ethernet base stations and PWE3+L3VPN for service bearer. <a href="#EN-US_TASK_0172370382__fig_dc_vrp_l2-l3_cfg_501702">Figure 2</a> shows a simplified single-ring network. The current versions are used for networking. The configurations on the CSGs and ASGs are mainly described here.</p>
<div class="fignone" id="EN-US_TASK_0172370382__fig_dc_vrp_l2-l3_cfg_501702"><a name="EN-US_TASK_0172370382__fig_dc_vrp_l2-l3_cfg_501702"></a><a name="fig_dc_vrp_l2-l3_cfg_501702"></a><span class="figcap"><b>Figure 2 </b>Configuring L2VPN under independent PW redundancy protection accessing L3VPN (IP RAN scenario, simplified networking)</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><div class="p"><ul><li>Interfaces 1 and 2 in this example represent GE<span>0/1/0</span> and GE<span>0/1/3</span>, respectively.</li></ul>
</div>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_l2-l3_cfg_501701.png"></span></div>

<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" frame="border" border="1" rules="all"><caption><b>Table 1 </b>Device interfaces and their IP addresses</caption><thead align="left"><tr><th align="left" class="cellrowborder" char="." valign="top" width="25.06250625062506%" id="mcps1.4.1.8.2.5.1.1" liSelected="liSelected"><p>Device</p>
</th>
<th align="left" class="cellrowborder" char="." valign="top" width="40.324032403240324%" id="mcps1.4.1.8.2.5.1.2" liSelected="liSelected"><p>Interface</p>
</th>
<th align="left" class="cellrowborder" char="." valign="top" width="17.32173217321732%" id="mcps1.4.1.8.2.5.1.3" liSelected="liSelected"><p>Peer Device</p>
</th>
<th align="left" class="cellrowborder" char="." valign="top" width="17.291729172917293%" id="mcps1.4.1.8.2.5.1.4" liSelected="liSelected"><p>IP Address</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" rowspan="3" char="." valign="top" width="25.06250625062506%" headers="mcps1.4.1.8.2.5.1.1 "><p>CSG</p>
</td>
<td class="cellrowborder" char="." valign="top" width="40.324032403240324%" headers="mcps1.4.1.8.2.5.1.2 "><p>GE<span>0/1/1</span></p>
</td>
<td class="cellrowborder" char="." valign="top" width="17.32173217321732%" headers="mcps1.4.1.8.2.5.1.3 "><p>ASG1</p>
</td>
<td class="cellrowborder" char="." valign="top" width="17.291729172917293%" headers="mcps1.4.1.8.2.5.1.4 "><p>172.16.1.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.8.2.5.1.2 "><p>GE<span>0/1/2</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.8.2.5.1.3 "><p>ASG2</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.8.2.5.1.4 "><p>172.16.4.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.8.2.5.1.2 "><p>GE<span>0/1/3</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.8.2.5.1.3 "><p>eNodeB</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.8.2.5.1.4 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="4" char="." valign="top" width="25.06250625062506%" headers="mcps1.4.1.8.2.5.1.1 "><p>ASG1</p>
</td>
<td class="cellrowborder" char="." valign="top" width="40.324032403240324%" headers="mcps1.4.1.8.2.5.1.2 "><p>GE<span>0/1/0</span></p>
</td>
<td class="cellrowborder" char="." valign="top" width="17.32173217321732%" headers="mcps1.4.1.8.2.5.1.3 "><p>ASG2</p>
</td>
<td class="cellrowborder" char="." valign="top" width="17.291729172917293%" headers="mcps1.4.1.8.2.5.1.4 "><p>172.16.2.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.8.2.5.1.2 "><p>GE<span>0/1/1</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.8.2.5.1.3 "><p>CSG</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.8.2.5.1.4 "><p>172.16.1.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.8.2.5.1.2 "><p>GE<span>0/1/3</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.8.2.5.1.3 "><p>RSG1</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.8.2.5.1.4 "><p>172.16.3.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.8.2.5.1.2 "><p>GE<span>0/1/4</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.8.2.5.1.3 "><p>RSG2</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.8.2.5.1.4 "><p>172.16.8.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="4" char="." valign="top" width="25.06250625062506%" headers="mcps1.4.1.8.2.5.1.1 "><p>ASG2</p>
</td>
<td class="cellrowborder" char="." valign="top" width="40.324032403240324%" headers="mcps1.4.1.8.2.5.1.2 "><p>GE<span>0/1/0</span></p>
</td>
<td class="cellrowborder" char="." valign="top" width="17.32173217321732%" headers="mcps1.4.1.8.2.5.1.3 "><p>ASG1</p>
</td>
<td class="cellrowborder" char="." valign="top" width="17.291729172917293%" headers="mcps1.4.1.8.2.5.1.4 "><p>172.16.2.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.8.2.5.1.2 "><p>GE<span>0/1/2</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.8.2.5.1.3 "><p>CSG</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.8.2.5.1.4 "><p>172.16.4.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.8.2.5.1.2 "><p>GE<span>0/1/3</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.8.2.5.1.3 "><p>RSG2</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.8.2.5.1.4 "><p>172.16.6.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.8.2.5.1.2 "><p>GE<span>0/1/4</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.8.2.5.1.3 "><p>RSG1</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.8.2.5.1.4 "><p>172.16.7.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="4" char="." valign="top" width="25.06250625062506%" headers="mcps1.4.1.8.2.5.1.1 "><p>RSG1</p>
</td>
<td class="cellrowborder" char="." valign="top" width="40.324032403240324%" headers="mcps1.4.1.8.2.5.1.2 "><p>GE<span>0/1/0</span></p>
</td>
<td class="cellrowborder" char="." valign="top" width="17.32173217321732%" headers="mcps1.4.1.8.2.5.1.3 "><p>RSG2</p>
</td>
<td class="cellrowborder" char="." valign="top" width="17.291729172917293%" headers="mcps1.4.1.8.2.5.1.4 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.8.2.5.1.2 "><p>GE<span>0/1/1</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.8.2.5.1.3 "><p>ASG1</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.8.2.5.1.4 "><p>172.16.3.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.8.2.5.1.2 "><p>GE<span>0/1/2</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.8.2.5.1.3 "><p>ASG2</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.8.2.5.1.4 "><p>172.16.7.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.8.2.5.1.2 "><p>GE<span>0/1/3</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.8.2.5.1.3 "><p>EPC</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.8.2.5.1.4 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="4" char="." valign="top" width="25.06250625062506%" headers="mcps1.4.1.8.2.5.1.1 "><p>RSG2</p>
</td>
<td class="cellrowborder" char="." valign="top" width="40.324032403240324%" headers="mcps1.4.1.8.2.5.1.2 "><p>GE<span>0/1/0</span></p>
</td>
<td class="cellrowborder" char="." valign="top" width="17.32173217321732%" headers="mcps1.4.1.8.2.5.1.3 "><p>RSG1</p>
</td>
<td class="cellrowborder" char="." valign="top" width="17.291729172917293%" headers="mcps1.4.1.8.2.5.1.4 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.8.2.5.1.2 "><p>GE<span>0/1/1</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.8.2.5.1.3 "><p>ASG2</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.8.2.5.1.4 "><p>172.16.6.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.8.2.5.1.2 "><p>GE<span>0/1/2</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.8.2.5.1.3 "><p>ASG1</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.8.2.5.1.4 "><p>172.16.8.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.8.2.5.1.2 "><p>GE<span>0/1/3</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.8.2.5.1.3 "><p>EPC</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.8.2.5.1.4 "><p>-</p>
</td>
</tr>
</tbody>
</table>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172370382__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure IP addresses and routes.</p>
</li><li><p>Configure MPLS and public network tunnels. Specifically:</p>
<ul><li>Configure TE tunnels under protection between the CSG and each ASG.</li><li>Configure LSPs between ASGs and RSGs.</li></ul>
</li><li><p>Configure independent PW redundancy:</p>
<ul><li>Configure MPLS LDP remote sessions between the CSG and ASGs.</li><li>Configure service PWs.</li><li>Configure an mPW.</li><li>Configure BFD to detect the mPW.</li><li>Configure primary/secondary status negotiation for PWs.</li></ul>
</li><li><p>Configure an L3VPN.</p>
<ul><li>Configure VPN instances on ASGs and RSGs.</li><li>Configure a VE group on each ASG, and bind the L3VE sub-interface in the group to the VPN instance on each ASG.</li><li>Establish MP-IBGP peer relationships between ASGs and RSGs.</li><li>Import direct routes into VPN instances on ASGs and RSGs.</li><li>Configure VPN FRR.</li></ul>
</li><li><p>Configure VRRP.</p>
<ul><li>Configure service VRRP and mVRRP on ASGs to determine a gateway for base stations.</li><li>Configure service VRRP on RSGs to determine their master/backup status.</li></ul>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172370382__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data.</p>
<ul><li><p>Interface numbers, interface IP addresses, and OSPF process IDs</p>
</li><li><p>LSR IDs</p>
</li><li><p>L2VCs' destination addresses, VC IDs, and VC types</p>
</li><li><p>Names, local discriminators, and remote discriminators of BFD sessions</p>
</li><li><p>VE group number</p>
</li><li><p>Numbers and priorities of VRRP groups</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172370382__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure interface IP addresses and a routing protocol.</span><ol type="a"><li class="substepexpand"><span>Configure an IP address for each interface.</span></li><li class="substepexpand"><span>Configure a routing protocol on the CSG, ASG1, ASG2, RSG1, and RSG2 for them to be routable to each other. In this example, OSPF is used.</span><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>One access ring is used in this example. If multiple access rings are available, each access ring belongs to a different area. If IS-IS is used, each access ring belongs to a different IS-IS process, and a different NET is deployed for each access ring. If the planned network is small, the entire network can be planned as a Level-2 area.</p>
</div></div>
</p></li></ol>
<p><p>After the configuration is complete, run the <a href="cmdqueryname=display+ip+routing-table"><b><span class="cmdname">display ip routing-table</span></b></a> command on the CSG, ASGs, and RSGs. These devices have learned routes from each other. Note that when configuring OSPF, you need to configure OSPF to advertise the 32-bit loopback interface addresses (LSR IDs) of the CSG, ASGs, and RSGs.</p>
<p>For configuration details, see the configuration files.</p>
</p></li><li><span>Configure basic MPLS functions and public network tunnels.</span><p><ul><li>Configure explicit path-based TE tunnels between the CSG and ASG1 and between the CSG and ASG2.</li><li>Configure LSPs between ASGs and between ASGs and RSGs.</li><li>To improve reliability, enable RSVP GR, LDP GR, and OSPF GR.</li></ul>
<p>For configuration details, see the configuration files.</p>
</p></li><li><span>Configure PW redundancy.</span><ol type="a"><li class="substepexpand"><span>Configure MPLS LDP remote sessions between the CSG and ASGs.</span><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this configuration example, TE tunnels are configured between the CSG and ASGs, and MPLS LDP is not configured. PWE3, however, uses extended LDP signaling to distribute VPN labels. Therefore, MPLS LDP remote sessions need to be configured between the CSG and ASGs. An LDP LSP is configured to directly connect ASGs, and no LDP remote session needs to be configured between ASGs.</p>
</div></div>
<p># Configure the CSG.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CSG] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG] <strong>mpls ldp remote-peer 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-mpls-ldp-remote-2.2.2.2] <strong>remote-ip 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-mpls-ldp-remote-2.2.2.2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG] <strong>mpls ldp remote-peer 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-mpls-ldp-remote-3.3.3.3] <strong>remote-ip 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-mpls-ldp-remote-3.3.3.3] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG] <strong>commit</strong></pre>
<p># Configure ASG1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASG1] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1] <strong>mpls ldp remote-peer 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-mpls-ldp-remote-1.1.1.1] <strong>remote-ip 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-mpls-ldp-remote-1.1.1.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1] <strong>commit</strong></pre>
<p># Configure ASG2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASG2] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2] <strong>mpls ldp remote-peer 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-mpls-ldp-remote-1.1.1.1] <strong>remote-ip 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-mpls-ldp-remote-1.1.1.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2] <strong>commit</strong></pre>
<p># Verify the configuration. Run the <strong>display mpls ldp session all</strong> command on the CSG and ASGs to check whether the LDP session status is <strong>Operational</strong>. If the LDP session status is <strong>Operational</strong>, the LDP session has been established. Use the CSG as an example.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CSG] <strong>display mpls ldp session all</strong></pre>
<pre class="screen"> LDP Session(s) in Public Network
 Codes: LAM(Label Advertisement Mode), SsnAge Unit(DDDD:HH:MM)
<span> An asterisk (*) before a session means the session is being deleted.</span>
 ------------------------------------------------------------------------------
 PeerID             Status      LAM  SsnRole  SsnAge      KASent/Rcv
 ------------------------------------------------------------------------------
 2.2.2.2:0          <strong>Operational</strong> DU   Passive  0000:00:47  190/190
 3.3.3.3:0          <strong>Operational</strong> DU   Passive  0000:00:47  190/190
 ------------------------------------------------------------------------------
 TOTAL: 2 session(s) Found.    </pre>
</p></li><li class="substepexpand"><span>Configure service PWs.</span><p><p># Configure the CSG.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CSG] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG] <strong>interface gigabitethernet <span>0/1/3</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-GigabitEthernet<span>0/1/3</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-GigabitEthernet<span>0/1/3</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG] <strong>interface gigabitethernet <span>0/1/3</span>.10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-GigabitEthernet<span>0/1/3</span>.10] <strong>vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-GigabitEthernet<span>0/1/3</span>.10] <strong>mpls l2vc 2.2.2.2 100 tunnel-policy policy1 control-word</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-GigabitEthernet<span>0/1/3</span>.10] <strong>mpls l2vc 3.3.3.3 200 secondary tunnel-policy policy1 control-word</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-GigabitEthernet<span>0/1/3</span>.10] <strong>mpls l2vpn redundancy independent</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-GigabitEthernet<span>0/1/3</span>.10] <strong>mpls l2vpn stream-dual-receiving</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-GigabitEthernet<span>0/1/3</span>.10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG] <strong>commit</strong></pre>
<p># Configure ASG1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASG1] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1] <strong>interface virtual-ethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-Virtual-Ethernet<span>0/1/0</span>] <strong>ve-group 1 l2-terminate</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-Virtual-Ethernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1] <strong>interface virtual-ethernet <span>0/1/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-Virtual-Ethernet<span>0/1/0</span>.1] <strong>vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-Virtual-Ethernet<span>0/1/0</span>.1] <strong>mpls l2vc 1.1.1.1 100 tunnel-policy policy1 ignore-standby-state</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-Virtual-Ethernet<span>0/1/0</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1] <strong>commit</strong></pre>
<p># Configure ASG2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASG2] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2] <strong>interface virtual-ethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-Virtual-Ethernet<span>0/1/0</span>] <strong>ve-group 1 l2-terminate</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-Virtual-Ethernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2] <strong>interface virtual-ethernet <span>0/1/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-Virtual-Ethernet<span>0/1/0</span>.1] <strong>vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-Virtual-Ethernet<span>0/1/0</span>.1] <strong>mpls l2vc 1.1.1.1 200 tunnel-policy policy1 ignore-standby-state</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-Virtual-Ethernet<span>0/1/0</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2] <strong>commit</strong></pre>
</p></li><li class="substepexpand"><span>Configure BFD to detect the mPW.</span><p><p># Configure ASG1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASG1] <strong>bfd</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-bfd] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1] <strong>bfd pw1 bind pw interface virtual-ethernet<span>0/1/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-bfd-lsp-session-pw1] <strong>discriminator local 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-bfd-lsp-session-pw1] <strong>discriminator remote 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-bfd-lsp-session-pw1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-bfd-lsp-session-pw1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1] <strong>commit</strong></pre>
<p># Configure ASG2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASG2] <strong>bfd</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-bfd] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2] <strong>bfd pw2 bind pw interface virtual-ethernet<span>0/1/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-bfd-lsp-session-pw2] <strong>discriminator local 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-bfd-lsp-session-pw2] <strong>discriminator remote 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-bfd-lsp-session-pw2] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-bfd-lsp-session-pw2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2] <strong>commit</strong></pre>
<p># Verify the configuration. Run the <a href="cmdqueryname=display+bfd+session+all"><b><span class="cmdname">display bfd session all</span></b></a> command on ASGs to check whether BFD sessions are in the up state. The command output on ASG1 is used as an example.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASG1] <strong>display bfd session all</strong></pre>
<pre class="screen"><span>(w): State in WTR 
(*): State is invalid</span>
--------------------------------------------------------------------------------
Local Remote PeerIpAddr      State     Type        InterfaceName
--------------------------------------------------------------------------------
2     2      --.--.--.--     <strong>Up</strong>        S_PW(M)     Virtual-Ethernet<span>0/1/0</span>.1
--------------------------------------------------------------------------------
     Total UP/DOWN Session Number : 1/0     </pre>
</p></li><li class="substepexpand"><span>Configure primary/secondary status negotiation for PWs.</span><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>If independent PW redundancy is used, mVRRP needs to be configured on ASGs to determine the master/backup status of ASGs, so that after PWs are associated with mVRRP, the primary/secondary status of PWs can be determined.</p>
</div></div>
<p># Configure ASG1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASG1] <strong>interface gigabitethernet  <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-GigabitEthernet<span>0/1/0</span>] <strong>vrrp vrid 20 virtual-ip 172.16.2.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-GigabitEthernet<span>0/1/0</span>] <strong>admin-vrrp vrid 20 ignore-if-down</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-GigabitEthernet<span>0/1/0</span>] <strong>vrrp vrid 20 priority 150</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1] <strong>interface virtual-ethernet <span>0/1/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-Virtual-Ethernet<span>0/1/0</span>.1] <strong>mpls l2vc track admin-vrrp interface gigabitethernet  <span>0/1/0</span> vrid 20 pw-redundancy</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-Virtual-Ethernet<span>0/1/0</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1] <strong>commit</strong></pre>
<p># Configure ASG2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASG2] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-GigabitEthernet<span>0/1/0</span>] <strong>vrrp vrid 20 virtual-ip 172.16.2.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-GigabitEthernet<span>0/1/0</span>] <strong>admin-vrrp vrid 20 ignore-if-down</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2] <strong>interface virtual-ethernet <span>0/1/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-Virtual-Ethernet<span>0/1/0</span>.1] <strong>mpls l2vc track admin-vrrp interface gigabitethernet <span>0/1/0</span> vrid 20 pw-redundancy</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-Virtual-Ethernet<span>0/1/0</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2] <strong>commit</strong></pre>
<p># Verify the configuration. Run the <a href="cmdqueryname=display+vrrp"><b><span class="cmdname">display vrrp</span></b></a> command on ASG1 and ASG2 to check the master/backup status of each ASG. The command output on ASG1 is used as an example. Because the default VRRP priority is 100, ASG1 whose VRRP priority is 150 assumes the master role.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASG1] <strong>display vrrp</strong></pre>
<pre class="screen">  GigabitEthernet<span>0/1/0</span> | Virtual Router 1
    State            : <strong>Master</strong>
    Virtual IP       : 172.16.2.3
    Master IP        : 172.16.2.2
    Local IP         : 172.16.2.2 
    PriorityRun      : 150
    PriorityConfig   : 150
    MasterPriority   : 150
    Preempt          : YES   Delay Time : 0
    Hold Multiplier  : 3
    TimerRun         : 1
    TimerConfig      : 1
    Auth Type        : NONE
    Virtual Mac      :  00e0-fc12-3456
    Check TTL        : YES
    Config type      : admin-vrrp
    Create time      : 2010-09-05 15:25:47
    Last change time : 2010-09-05 15:25:51</pre>
</p></li></ol>
</li><li><span>Configure an L3VPN.</span><ol type="a"><li class="substepexpand"><span>Configure a VPN instance on each ASG and RSG, and bind interfaces to VPN instances.</span><p><p># Configure ASG1. The configuration of ASG2 is similar to that of ASG1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASG1] <strong>ip vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-vpn-instance-vpna] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-vpn-instance-vpna-af-ipv4] <strong>route-distinguisher 1:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-vpn-instance-vpna-af-ipv4] <strong>vpn-target 1:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-vpn-instance-vpna-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-vpn-instance-vpna] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1] <strong>interface virtual-ethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-Virtual-Ethernet<span>0/1/1</span>] <strong>ve-group 1 l3-access</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-Virtual-Ethernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1] <strong>interface virtual-ethernet <span>0/1/1</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-Virtual-Ethernet<span>0/1/1</span>.1] <strong>vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-Virtual-Ethernet<span>0/1/1</span>.1] <strong>ip binding vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-Virtual-Ethernet<span>0/1/1</span>.1] <strong>ip address 10.0.0.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-Virtual-Ethernet<span>0/1/1</span>.1] <strong>direct-route track pw-state degrade-cost 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-Virtual-Ethernet<span>0/1/1</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1] <strong>commit</strong></pre>
<p># Configure RSG1. The configuration of RSG2 is similar to that of RSG1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RSG1] <strong>ip vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-vpn-instance-vpna] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-vpn-instance-vpna-af-ipv4] <strong>route-distinguisher 1:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-vpn-instance-vpna-af-ipv4] <strong>vpn-target 1:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-vpn-instance-vpna-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-vpn-instance-vpna] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1] <strong>interface gigabitethernet <span>0/1/3</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-GigabitEthernet<span>0/1/3</span>] <strong>portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-GigabitEthernet<span>0/1/3</span>] <strong>port link-type trunk</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-GigabitEthernet<span>0/1/3</span>] <strong>port trunk allow-pass vlan 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-GigabitEthernet<span>0/1/3</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-GigabitEthernet<span>0/1/0</span>] <strong>portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-GigabitEthernet<span>0/1/0</span>] <strong>port link-type trunk</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-GigabitEthernet<span>0/1/0</span>] <strong>port trunk allow-pass vlan 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1] <strong>vlan 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-vlan10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1] <strong>interface vlanif 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-Vlanif10] <strong>ip binding vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-Vlanif10] <strong>ip address 10.0.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-Vlanif10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1] <strong>commit</strong></pre>
</p></li><li class="substepexpand"><span>Establish MP-IBGP peer relationships between ASGs and RSGs.</span><p><p># Configure ASG2. The configuration of ASG1 is similar to that of ASG2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASG2] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-bgp] <strong>graceful-restart</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-bgp] <strong>peer 2.2.2.2 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-bgp] <strong>peer 2.2.2.2 connect-interface loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-bgp] <strong>peer 4.4.4.4 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-bgp] <strong>peer 4.4.4.4 connect-interface loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-bgp] <strong>peer 4.4.4.4 tracking delay 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-bgp] <strong>peer 5.5.5.5 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-bgp] <strong>peer 5.5.5.5 connect-interface loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-bgp] <strong>peer 5.5.5.5 tracking delay 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-bgp] <strong>ipv4-family vpnv4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-bgp-af-vpnv4] <strong>peer 2.2.2.2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-bgp-af-vpnv4] <strong>peer 4.4.4.4 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-bgp-af-vpnv4] <strong>peer 5.5.5.5 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-bgp-af-vpnv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2] <strong>commit</strong></pre>
<p># Configure RSG1. The configuration of RSG2 is similar to that of RSG1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RSG1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-bgp] <strong>graceful-restart</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-bgp] <strong>peer 2.2.2.2 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-bgp] <strong>peer 2.2.2.2 connect-interface loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-bgp] <strong>peer 2.2.2.2 tracking delay 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-bgp] <strong>peer 3.3.3.3 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-bgp] <strong>peer 3.3.3.3 connect-interface loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-bgp] <strong>peer 3.3.3.3 tracking delay 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-bgp] <strong>peer 5.5.5.5 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-bgp] <strong>peer 5.5.5.5 connect-interface loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-bgp] <strong>ipv4-family vpnv4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-bgp-af-vpnv4] <strong>peer 2.2.2.2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-bgp-af-vpnv4] <strong>peer 3.3.3.3 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-bgp-af-vpnv4] <strong>peer 5.5.5.5 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-bgp-af-vpnv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1] <strong>commit</strong></pre>
</p></li><li class="substepexpand"><span>Import direct routes into VPN instances on ASGs and RSGs.</span><p><p># Configure ASG1. The configuration of ASG2 is similar to that of ASG1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASG1-bgp] <strong>ipv4-family vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-bgp-vpna] <strong>import-route direct</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-bgp-vpna] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1] <strong>commit</strong></pre>
<p># Configure RSG1. The configuration of RSG2 is similar to that of RSG1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RSG1-bgp] <strong>ipv4-family vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-bgp-vpna] <strong>import-route direct</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-bgp-vpna] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1] <strong>commit</strong></pre>
</p></li><li class="substepexpand"><span>Configure VPN FRR.</span><p><p># Configure RSG1. The configurations of the other RSG and each ASG are similar to that of RSG1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RSG1] <strong>ip vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-vpn-instance-vpna] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-vpn-instance-vpna-af-ipv4] <strong>vpn frr</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-vpn-instance-vpna-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-vpn-instance-vpna] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1] <strong>commit</strong></pre>
</p></li></ol>
</li><li><span>Configure VRRP on ASG1 and ASG2 to determine a gateway for base stations.</span><p><p>For configuration details, see the configuration files and "VRRP Configuration" located under <em><span class="keyword">NE40E</span> Configuration Guide &gt; Network Reliability</em>.</p>
</p></li><li><span>Configure VRRP to determine the master/backup status of RSGs.</span><p><p>For configuration details, see the configuration files and "VRRP Configuration" located under <em><span class="keyword">NE40E</span> Configuration Guide &gt; Network Reliability</em>.</p>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172370382__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>CSG configuration file</p>
<pre class="screen">#
 sysname CSG
#
 mpls lsr-id 1.1.1.1
 mpls
  mpls te
  mpls rsvp-te
  mpls rsvp-te hello
  mpls te cspf
#
 mpls l2vpn
#
 explicit-path to_sr1
  next hop 172.16.1.2
  next hop 2.2.2.2
#
 explicit-path to_sr2
  next hop 172.16.4.2
  next hop 3.3.3.3
#
mpls ldp
 graceful-restart
#
 mpls ldp remote-peer 2.2.2.2
 remote-ip 2.2.2.2
#
 mpls ldp remote-peer 3.3.3.3
 remote-ip 3.3.3.3
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 172.16.1.1 255.255.255.0
 mpls
 mpls te
 mpls rsvp-te
 mpls rsvp-te hello
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ip address 172.16.4.1 255.255.255.0
 mpls
 mpls te
 mpls rsvp-te
 mpls rsvp-te hello
#
interface GigabitEthernet<span>0/1/3</span>
 undo shutdown
#
interface GigabitEthernet<span>0/1/3</span>.10
 vlan-type dot1q 10
 mpls l2vc 2.2.2.2 100 tunnel-policy policy1 control-word
 mpls l2vc 3.3.3.3 200 secondary tunnel-policy policy1 control-word
 mpls l2vpn redundancy independent
 mpls l2vpn stream-dual-receiving
#
interface LoopBack0
 ip address 1.1.1.1 255.255.255.255
#
interface Tunnel11
 ip address unnumbered interface LoopBack0
 tunnel-protocol mpls te
 destination 2.2.2.2
 mpls te tunnel-id 100
 mpls te record-route
 mpls te signal-protocol rsvp-te
 mpls te path explicit-path to_sr1
 mpls te backup hot-standby wtr 15
 mpls te reserved-for-binding
#
interface Tunnel12
 ip address unnumbered interface LoopBack0
 tunnel-protocol mpls te
 destination 3.3.3.3
 mpls te tunnel-id 200
 mpls te record-route
 mpls te signal-protocol rsvp-te
 mpls te path explicit-path to_sr2
 mpls te backup hot-standby wtr 15
 mpls te reserved-for-binding
#
ospf 100
 opaque-capability enable
 graceful-restart
 area 0.0.0.0
  network 1.1.1.1 0.0.0.0
  network 172.16.1.0 0.0.0.255
  network 172.16.4.0 0.0.0.255
  mpls-te enable
#
tunnel-policy policy1
 tunnel binding destination 2.2.2.2 te Tunnel11
 tunnel binding destination 3.3.3.3 te Tunnel12
#
bfd master bind pw interface GigabitEthernet<span>0/1/3</span>.10 remote-peer 2.2.2.2 pw-ttl auto-calculate
 discriminator local 2
 discriminator remote 2
 commit
#
return </pre>
</li><li><p>ASG1 configuration file</p>
<pre class="screen">#
 sysname ASG1
#
ip vpn-instance vpna
 ipv4-family
  route-distinguisher 1:1
  apply-label per-instance
  vpn frr
  vpn-target 1:1 export-extcommunity
  vpn-target 1:1 import-extcommunity
#
 bfd
#
 mpls lsr-id 2.2.2.2
 mpls
  mpls te
  mpls rsvp-te
  mpls rsvp-te hello
  mpls te cspf
#
 mpls l2vpn
#
 explicit-path to_csg
  next hop 172.16.1.1
  next hop 1.1.1.1
#
mpls ldp
 graceful-restart
#
 mpls ldp remote-peer 1.1.1.1
 remote-ip 1.1.1.1
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 172.16.2.2 255.255.255.0
 vrrp vrid 20 virtual-ip 172.16.2.3
 admin-vrrp vrid 20 ignore-if-down
 vrrp vrid 20 priority 150
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 172.16.1.2 255.255.255.0
 mpls
 mpls te
 mpls rsvp-te
 mpls rsvp-te hello
#
interface GigabitEthernet<span>0/1/3</span>
 undo shutdown
 ip address 172.16.3.1 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/4</span>
 undo shutdown
 ip address 172.16.8.1 255.255.255.0
 mpls
 mpls ldp
#
interface Virtual-Ethernet<span>0/1/0</span>
 ve-group 1 l2-terminate
#
interface Virtual-Ethernet<span>0/1/0</span>.1
 vlan-type dot1q 10
 mpls l2vc 1.1.1.1 100 tunnel-policy policy1 ignore-standby-state
 mpls l2vc track admin-vrrp interface GigabitEthernet<span>0/1/0</span> vrid 20 pw-redundancy
#
interface Virtual-Ethernet<span>0/1/1</span>
 ve-group 1 l3-access
#
interface Virtual-Ethernet<span>0/1/1</span>.1
 vlan-type dot1q 10
 ip binding vpn-instance vpna
 ip address 10.0.0.2 255.255.255.0
 direct-route track pw-state degrade-cost 30
 vrrp vrid 10 virtual-ip 10.0.0.3
 vrrp vrid 10 track admin-vrrp interface GigabitEthernet<span>0/1/0</span> vrid 20
#
interface LoopBack0
 ip address 2.2.2.2 255.255.255.255
#
interface LoopBack1
 mpls l2vc 3.3.3.3 400 control-word admin
#
interface Tunnel11
 ip address unnumbered interface LoopBack0
 tunnel-protocol mpls te
 destination 1.1.1.1
 mpls te tunnel-id 100
 mpls te record-route
 mpls te signal-protocol rsvp-te
 mpls te path explicit-path to_csg
 mpls te backup hot-standby wtr 15
 mpls te reserved-for-binding
#
bgp 100
 graceful-restart
 peer 3.3.3.3 as-number 100
 peer 3.3.3.3 connect-interface LoopBack0
 peer 4.4.4.4 as-number 100
 peer 4.4.4.4 connect-interface LoopBack0
 peer 5.5.5.5 as-number 100
 peer 5.5.5.5 connect-interface LoopBack0
 #
 ipv4-family unicast
  undo synchronization
  peer 3.3.3.3 enable
  peer 4.4.4.4 enable
  peer 5.5.5.5 enable
 #
 ipv4-family vpnv4
  policy vpn-target
  peer 3.3.3.3 enable
  peer 4.4.4.4 enablef
  peer 5.5.5.5 enable
 #
 ipv4-family vpn-instance vpna
  import-route direct
#
ospf 100
 opaque-capability enable
 graceful-restart
 area 0.0.0.0
  network 2.2.2.2 0.0.0.0
  network 172.16.1.0 0.0.0.255
  network 172.16.3.0 0.0.0.255
  network 172.16.2.0 0.0.0.255
  network 172.16.8.0 0.0.0.255
  mpls-te enable
#
tunnel-policy policy1
 tunnel binding destination 1.1.1.1 te Tunnel11
#
bfd pw1 bind pw interface virtual-ethernet<span>0/1/0</span>.1
 discriminator local 2
 discriminator remote 2
 commit
#
return </pre>
</li><li><p>ASG2 configuration file</p>
<pre class="screen">#
 sysname ASG2
#
ip vpn-instance vpna
 ipv4-family
  route-distinguisher 1:1
  apply-label per-instance
  vpn frr
  vpn-target 1:1 export-extcommunity
  vpn-target 1:1 import-extcommunity
#
 bfd
#
 mpls lsr-id 3.3.3.3
 mpls
  mpls te
  mpls rsvp-te
  mpls rsvp-te hello
  mpls te cspf
#
 mpls l2vpn
#
 explicit-path to_csg
  next hop 172.16.4.1
  next hop 1.1.1.1
#
mpls ldp
 graceful-restart
#
 mpls ldp remote-peer 1.1.1.1
 remote-ip 1.1.1.1
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 172.16.2.1 255.255.255.0
 vrrp vrid 20 virtual-ip 172.16.2.3
 admin-vrrp vrid 20 ignore-if-down
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ip address 172.16.4.2 255.255.255.0
 mpls
 mpls te
 mpls rsvp-te
#
interface GigabitEthernet<span>0/1/3</span>
 undo shutdown
 ip address 172.16.6.1 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/4</span>
 undo shutdown
 ip address 172.16.7.1 255.255.255.0
 mpls
 mpls ldp
#
interface Virtual-Ethernet<span>0/1/0</span>
 ve-group 1 l2-terminate
#
interface Virtual-Ethernet<span>0/1/0</span>.1
 vlan-type dot1q 10
 mpls l2vc 1.1.1.1 200 tunnel-policy policy1 ignore-standby-state
 mpls l2vc track admin-vrrp interface GigabitEthernet<span>0/1/0</span> vrid 20 pw-redundancy
#
interface Virtual-Ethernet<span>0/1/1</span>
 ve-group 1 l3-access
#
interface Virtual-Ethernet<span>0/1/1</span>.1
 vlan-type dot1q 10
 ip binding vpn-instance vpna
 ip address 10.0.0.4 255.255.255.0
 vrrp vrid 10 virtual-ip 10.0.0.3
 vrrp vrid 10 track admin-vrrp interface GigabitEthernet<span>0/1/0</span> vrid 20
#
interface LoopBack0
 ip address 3.3.3.3 255.255.255.255
#
interface LoopBack1
 mpls l2vc 2.2.2.2 400 control-word admin
#
interface Tunnel12
 ip address unnumbered interface LoopBack0
 tunnel-protocol mpls te
 destination 1.1.1.1
 mpls te tunnel-id 200
 mpls te record-route
 mpls te signal-protocol rsvp-te
 mpls te path explicit-path to_csg
 mpls te backup hot-standby wtr 15
 mpls te reserved-for-binding
#
bgp 100
 graceful-restart
 peer 2.2.2.2 as-number 100
 peer 2.2.2.2 connect-interface LoopBack0
 peer 4.4.4.4 as-number 100
 peer 4.4.4.4 connect-interface LoopBack0
 peer 4.4.4.4 tracking delay 30
 peer 5.5.5.5 as-number 100
 peer 5.5.5.5 connect-interface LoopBack0
 peer 5.5.5.5 tracking delay 30
 #
 ipv4-family unicast
  undo synchronization
  peer 2.2.2.2 enable
  peer 4.4.4.4 enable
  peer 5.5.5.5 enable
 #
 ipv4-family vpnv4
  policy vpn-target
  peer 2.2.2.2 enable
  peer 4.4.4.4 enable
  peer 5.5.5.5 enable
 #
 ipv4-family vpn-instance vpna
  import-route direct
#
ospf 100
 opaque-capability enable
 graceful-restart
 area 0.0.0.0
  network 3.3.3.3 0.0.0.0
  network 172.16.2.0 0.0.0.255
  network 172.16.7.0 0.0.0.255
  network 172.16.4.0 0.0.0.255
  network 172.16.6.0 0.0.0.255
  mpls-te enable
#
tunnel-policy policy1
 tunnel binding destination 1.1.1.1 te Tunnel12
#
bfd pw2 bind pw interface virtual-ethernet<span>0/1/0</span>.1
 discriminator local 2
 discriminator remote 2
 commit
#
return  </pre>
</li><li><p>RSG1 configuration file</p>
<pre class="screen">#
 sysname RSG1
#
 vlan batch 10
#
ip vpn-instance vpna
 ipv4-family
  route-distinguisher 1:1
  apply-label per-instance
  vpn frr
  vpn-target 1:1 export-extcommunity
  vpn-target 1:1 import-extcommunity
#
 mpls lsr-id 4.4.4.4
#
 mpls l2vpn
#
mpls ldp
 graceful-restart
#
interface Vlanif10
 ip binding vpn-instance vpna
 ip address 10.0.1.1 255.255.255.0
 vrrp vrid 1 virtual-ip 10.0.1.3
 vrrp vrid 1 priority 150
#
interface GigabitEthernet<span>0/1/0</span>
 portswitch
 undo shutdown
 port link-type trunk
 port trunk allow-pass vlan 10
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 172.16.3.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ip address 172.16.7.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/3</span>
 portswitch
 undo shutdown
 port link-type trunk
 port trunk allow-pass vlan 10
#
interface LoopBack0
 ip address 4.4.4.4 255.255.255.255
#
bgp 100
 graceful-restart
 peer 2.2.2.2 as-number 100
 peer 2.2.2.2 connect-interface LoopBack0
 peer 2.2.2.2 tracking delay 30
 peer 3.3.3.3 as-number 100
 peer 3.3.3.3 connect-interface LoopBack0
 peer 3.3.3.3 tracking delay 30
 peer 5.5.5.5 as-number 100
 peer 5.5.5.5 connect-interface LoopBack0
 #
 ipv4-family unicast
  undo synchronization
  peer 2.2.2.2 enable
  peer 3.3.3.3 enable
  peer 5.5.5.5 enable
 #
 ipv4-family vpnv4
  policy vpn-target
  peer 2.2.2.2 enable
  peer 3.3.3.3 enable
  peer 5.5.5.5 enable
 #
 ipv4-family vpn-instance vpna
  import-route direct
#
ospf 100
 opaque-capability enable
 graceful-restart
 area 0.0.0.0
  network 4.4.4.4 0.0.0.0
  network 172.16.3.0 0.0.0.255
  network 172.16.7.0 0.0.0.255
  mpls-te enable
#
return </pre>
</li><li><p>RSG2 configuration file</p>
<pre class="screen">#
 sysname RSG2
#
 vlan batch 10
#
ip vpn-instance vpna
 ipv4-family
  route-distinguisher 11
  apply-label per-instance
  vpn frr
  vpn-target 11 export-extcommunity
  vpn-target 11 import-extcommunity
#
 mpls lsr-id 5.5.5.5
#
 mpls l2vpn
#
mpls ldp
 graceful-restart
#
interface Vlanif10
 ip binding vpn-instance vpna
 ip address 10.0.1.2 255.255.255.0
 vrrp vrid 1 virtual-ip 10.0.1.3
#
interface GigabitEthernet<span>0/1/0</span>
 portswitch
 undo shutdown
 port link-type trunk
 port trunk allow-pass vlan 10
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 172.16.6.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ip address 172.16.8.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/3</span>
 portswitch
 undo shutdown
 port link-type trunk
 port trunk allow-pass vlan 10
#
interface LoopBack0
 ip address 5.5.5.5 255.255.255.255
#
bgp 100
 graceful-restart
 peer 2.2.2.2 as-number 100
 peer 2.2.2.2 connect-interface LoopBack0
 peer 2.2.2.2 tracking delay 30
 peer 3.3.3.3 as-number 100
 peer 3.3.3.3 connect-interface LoopBack0
 peer 3.3.3.3 tracking delay 30
 peer 4.4.4.4 as-number 100
 peer 4.4.4.4 connect-interface LoopBack0
 #
 ipv4-family unicast
  undo synchronization
  peer 2.2.2.2 enable
  peer 3.3.3.3 enable
  peer 4.4.4.4 enable
 #
 ipv4-family vpnv4
  policy vpn-target
  peer 2.2.2.2 enable
  peer 3.3.3.3 enable
  peer 4.4.4.4 enable
 #
 ipv4-family vpn-instance vpna
  import-route direct
#
ospf 100
 opaque-capability enable
 graceful-restart
 area 0.0.0.0
  network 5.5.5.5 0.0.0.0
  network 172.16.8.0 0.0.0.255
  network 172.16.6.0 0.0.0.255
  mpls-te enable
#
return  </pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2-l3_cfg_5013.html">Configuration Examples for L2VPN Accessing L3VPN
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2-l3_cfg_5016.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2-l3_cfg_5028.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>