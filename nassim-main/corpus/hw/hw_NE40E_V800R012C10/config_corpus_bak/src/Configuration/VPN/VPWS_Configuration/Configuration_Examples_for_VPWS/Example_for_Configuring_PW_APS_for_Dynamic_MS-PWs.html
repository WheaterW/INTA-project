
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring PW APS for Dynamic MS-PWs">
<meta name="abstract" content="In PW APS scenarios, MPLS OAM is used to detect the status of dynamic MS-PWs.">
<meta name="description" content="In PW APS scenarios, MPLS OAM is used to detect the status of dynamic MS-PWs.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpws_cfg_3012.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpws_cfg_6040.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_019006.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="VPWS">
<meta name="featuretype" content="VPN">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="VPWS">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="VPWS">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="VPWS">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="l00415692">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00415692">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172369990">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring PW APS for Dynamic MS-PWs</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172369990"></a><a name="EN-US_TASK_0172369990"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring PW APS for Dynamic MS-PWs</h1>
<div class="taskbody"><p>In PW APS scenarios, MPLS OAM is used to detect the status of dynamic MS-PWs.</p>
<div class="context"><a name="EN-US_TASK_0172369990__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the public network shown in <a href="#EN-US_TASK_0172369990__fig_dc_vrp_vpws_cfg_604101">Figure 1</a>, dynamic associated bidirectional LSPs need to be established between the four PEs. In addition, CE1 and CE2 need to reliably communicate through the four PEs on the public network.</p>
<p>PW redundancy needs to be deployed on PE1 and PE2. For primary and secondary PWs that share the same source and same destination and dynamic associated bidirectional LSPs, consider deploying PW APS for dynamic PWs. As the four PEs belong to different IGP domains, the PWs must be MS-PWs.</p>
<div class="fignone" id="EN-US_TASK_0172369990__fig_dc_vrp_vpws_cfg_604101"><a name="EN-US_TASK_0172369990__fig_dc_vrp_vpws_cfg_604101"></a><a name="fig_dc_vrp_vpws_cfg_604101"></a><span class="figcap"><b>Figure 1 </b>Configuring PW APS for dynamic MS-PWs</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><div class="p"><ul><li><p>In this example, interface1, subinterface1.1, interface2, and interface3 represent GE<span>0/1/0</span>, GE<span>0/1/0</span>.1, GE<span>0/1/1</span>, and GE<span>0/1/2</span>, respectively.</p>
</li></ul>
</div>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_vpws_cfg_604101.png"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172369990__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure interface IP addresses and a routing protocol.</p>
</li><li><p>Configure MPLS and public network tunnels.</p>
<p>In this example, dynamic associated bidirectional LSPs are used between PEs and SPEs. The specific configurations include:</p>
<ul><li><p>Configure basic MPLS functions and enable MPLS TE, RSVP-TE, and CSPF.</p>
</li><li><p>Configure OSPF TE.</p>
</li><li><p>Configure dynamic associated bidirectional LSPs.</p>
</li></ul>
</li><li><p>Configure a PW protection group (dynamic MS-PWs are used in this example), which includes:</p>
<ul><li><p>Configure a PW protection group on PE1 and PE2.</p>
</li><li><p>Configure a dynamic switched PW on SPE1 and SPE2.</p>
</li></ul>
</li><li><p>Configure PW APS, which includes:</p>
<ul><li><p>Configure a PW APS instance on PE1 and PE2.</p>
</li><li><p>Bind the PW protection group to the PW APS instance.</p>
</li></ul>
</li><li><p>Configure MPLS OAM to detect PW status.</p>
</li><li><p>Configure CEs to access the L2VPN through VLANs on the AC side.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172369990__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>PEs' interface numbers, IP addresses and OSPF process IDs</p>
</li><li><p>Each PE's LSR ID, tunnel interface numbers and IP addresses, and tunnel IDs and ingress LSR IDs of reverse RSVP LSPs</p>
</li><li><p>Local and remote IP addresses, VC IDs, and VC types of L2VCs</p>
</li><li><p>APS instance numbers on PE1 and PE2</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172369990__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure interface IP addresses and a routing protocol.</span><p><p>Configure an IP address and mask for each involved interface according to <a href="#EN-US_TASK_0172369990__fig_dc_vrp_vpws_cfg_604101">Figure 1</a>. For detailed configurations, see Configuration Files.</p>
<p>In this example, OSPF is used as the IGP for PE1, PE2, SPE1, and SPE2 to communicate at the network layer. The configuration details are not provided here.</p>
</p></li><li><span>Configure MPLS and public network tunnels.</span><p><p>In this example, dynamic associated bidirectional LSPs are used between PEs (PE1 and PE2) and SPEs (SPE1 and SPE2).</p>
</p><ol type="a"><li class="substepexpand"><span>Configure basic MPLS functions and enable MPLS TE, RSVP-TE, and CSPF.</span><p><p>Enable MPLS, MPLS TE, and CSPF globally for each node and enable MPLS, MPLS TE, and RSVP-TE on each interface along the TE tunnel.</p>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>mpls lsr-id 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls] <strong>mpls rsvp-te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls] <strong>mpls te cspf</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls] <strong>label advertise non-null</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>mpls rsvp-te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/2</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/2</span>] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/2</span>] <strong>mpls rsvp-te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p>The configurations of PE2 and SPE1 are similar to that of SPE2. For detailed configurations, see Configuration Files.</p>
</p></li><li class="substepexpand"><span>Configure OSPF TE.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1] <strong>opaque-capability enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1-area-0.0.0.0] <strong>mpls-te enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p>The configurations of PE2 and SPE1 are similar to that of SPE2. For detailed configurations, see Configuration Files.</p>
</p></li><li class="substepexpand"><span>Configure an MPLS TE explicit path.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>explicit-path 1to2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-explicit-path-1to2] <strong>next hop 10.1.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-explicit-path-1to2] <strong>next hop 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-explicit-path-1to2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>explicit-path 1to3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-explicit-path-1to3] <strong>next hop 10.1.3.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-explicit-path-1to3] <strong>next hop 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-explicit-path-1to3] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure SPE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE1] <strong>explicit-path 2to1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-explicit-path-2to1] <strong>next hop 10.1.2.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-explicit-path-2to1] <strong>next hop 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-explicit-path-2to1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>explicit-path 2to4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-explicit-path-2to4] <strong>next hop 10.1.4.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-explicit-path-2to4] <strong>next hop 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-explicit-path-2to4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>commit</strong></pre>
<p># Configure SPE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE2] <strong>explicit-path 3to1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-explicit-path-3to1] <strong>next hop 10.1.3.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-explicit-path-3to1] <strong>next hop 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-explicit-path-3to1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2] <strong>explicit-path 3to4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-explicit-path-3to4] <strong>next hop 10.1.5.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-explicit-path-3to4] <strong>next hop 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-explicit-path-3to4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>explicit-path 4to2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-explicit-path-4to2] <strong>next hop 10.1.4.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-explicit-path-4to2] <strong>next hop 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-explicit-path-4to2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>explicit-path 4to3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-explicit-path-4to3] <strong>next hop 10.1.5.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-explicit-path-4to3] <strong>next hop 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-explicit-path-4to3] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</p></li><li class="substepexpand"><span>Configure dynamic associated bidirectional LSPs.</span><p><p>The following example shows how to configure a dynamic associated bidirectional LSP between PE1 and SPE1. Repeat this step to configure a dynamic associated bidirectional LSP between PE1 and SPE2, between PE2 and SPE1, and between PE2 and SPE2. For detailed configurations, see Configuration Files.</p>
<p># Configure an LSP from PE1 to SPE1 and bind it to the LSP from SPE1 to PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface Tunnel10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel10] <strong>ip address unnumbered interface loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel10] <strong>tunnel-protocol mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel10] <strong>destination 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel10] <strong>mpls te tunnel-id 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel10] <strong>mpls te reverse-lsp protocol rsvp-te ingress-lsr-id 2.2.2.2 tunnel-id 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel10]<strong> mpls te path explicit-path 1to2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure an LSP from SPE1 to PE1 and bind it to the LSP from PE1 to SPE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE1] <strong>interface Tunnel10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-Tunnel10] <strong>ip address unnumbered interface loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-Tunnel10] <strong>tunnel-protocol mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-Tunnel10] <strong>destination 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-Tunnel10] <strong>mpls te tunnel-id 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-Tunnel10] <strong>mpls te reverse-lsp protocol rsvp-te ingress-lsr-id 1.1.1.1 tunnel-id 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-Tunnel10]<strong> mpls te path explicit-path 2to1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-Tunnel10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>commit</strong></pre>
<p>Run the <strong>display mpls te reverse-lsp</strong> command on PE1, PE2, SPE1, and SPE2 to check information about the dynamic associated bidirectional LSPs. PE1 is used as an example.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display mpls te reverse-lsp tunnel-interface Tunnel 10 verbose</strong></pre>
<pre class="screen">-------------------------------------------------------------------------------
                 LSP Information: RSVP LSP
-------------------------------------------------------------------------------
  Obverse Tunnel           :  Tunnel10
  Reverse LSP IngressLsrID :  2.2.2.2
  Reverse LSP SessionID    :  100
  Signalled Tunnel Name    :  Tunnel10
  Reverse LSP State        :  <strong>Up</strong>
  Incoming Label           :  3
   Incoming Interface      :  GE<span>0/1/1</span>
   LSP-id                  :  2</pre>
<p>Run the <strong>ping lsp</strong> command on PE1, PE2, SPE1, and SPE2 to check LSP connectivity. If the ping operations succeed, the dynamic associated bidirectional LSPs have been established. A tunnel on PE1 is used as an example.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>ping lsp -r 4 te Tunnel 11</strong></pre>
<pre class="screen">  LSP PING FEC: TE TUNNEL IPV4 SESSION QUERY Tunnel11 : 100  data bytes, pres
s CTRL_C to break
    Reply from 3.3.3.3: bytes=100 Sequence=1 time=90 ms
    Reply from 3.3.3.3: bytes=100 Sequence=2 time=90 ms
    Reply from 3.3.3.3: bytes=100 Sequence=3 time=90 ms
    Reply from 3.3.3.3: bytes=100 Sequence=4 time=480 ms
    Reply from 3.3.3.3: bytes=100 Sequence=5 time=70 ms

  --- FEC: TE TUNNEL IPV4 SESSION QUERY Tunnel11 ping statistics ---
    5 packet(s) transmitted
    5 packet(s) received
    0.00% packet loss
    round-trip min/avg/max = 70/164/480 ms  </pre>
</p></li></ol>
</li><li><span>Configure a PW protection group.</span><p><p>Dynamic MS-PWs are used in this example.</p>
</p><ol type="a"><li class="substepexpand"><span>Configure VPN tunnel binding.</span><p><p>In this example, the dynamic PWs are carried over dynamic associated bidirectional LSPs. A tunnel policy is required to bind LSPs to the L2VPN.</p>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface Tunnel10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel10] <strong>mpls te reserved-for-binding</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface Tunnel11</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel11] <strong>mpls te reserved-for-binding</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel11] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>tunnel-policy policy1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-tunnel-policy-policy1] <strong>tunnel binding destination 2.2.2.2 te Tunnel10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-tunnel-policy-policy1] <strong>tunnel binding destination 3.3.3.3 te Tunnel11</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-tunnel-policy-policy1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure SPE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE1] <strong>interface Tunnel10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-Tunnel10] <strong>mpls te reserved-for-binding</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-Tunnel10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>interface Tunnel11</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-Tunnel11] <strong>mpls te reserved-for-binding</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-Tunnel11] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>tunnel-policy policy1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-tunnel-policy-policy1] <strong>tunnel binding destination 1.1.1.1 te Tunnel10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-tunnel-policy-policy1] <strong>tunnel binding destination 4.4.4.4 te Tunnel11</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-tunnel-policy-policy1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>commit</strong></pre>
<p># Configure SPE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE2] <strong>interface Tunnel10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-Tunnel10] <strong>mpls te reserved-for-binding</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-Tunnel10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2] <strong>interface Tunnel11</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-Tunnel11] <strong>mpls te reserved-for-binding</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-Tunnel11] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2] <strong>tunnel-policy policy1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-tunnel-policy-policy1] <strong>tunnel binding destination 1.1.1.1 te Tunnel10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-tunnel-policy-policy1] <strong>tunnel binding destination 4.4.4.4 te Tunnel11</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-tunnel-policy-policy1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>interface Tunnel10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Tunnel10] <strong>mpls te reserved-for-binding</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Tunnel10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface Tunnel11</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Tunnel11] <strong>mpls te reserved-for-binding</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Tunnel11] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>tunnel-policy policy1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-tunnel-policy-policy1] <strong>tunnel binding destination 2.2.2.2 te Tunnel10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-tunnel-policy-policy1] <strong>tunnel binding destination 3.3.3.3 te Tunnel11</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-tunnel-policy-policy1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</p></li><li class="substepexpand"><span>Configure remote MPLS LDP sessions.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls ldp remote-peer 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp-remote-2.2.2.2] <strong>remote-ip 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp-remote-2.2.2.2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls ldp remote-peer 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp-remote-3.3.3.3] <strong>remote-ip 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp-remote-3.3.3.3] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>mpls ldp remote-peer 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-ldp-remote-2.2.2.2] <strong>remote-ip 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-ldp-remote-2.2.2.2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>mpls ldp remote-peer 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-ldp-remote-3.3.3.3] <strong>remote-ip 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-ldp-remote-3.3.3.3] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure SPE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE1] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>mpls ldp remote-peer 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-mpls-ldp-remote-1.1.1.1] <strong>remote-ip 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-mpls-ldp-remote-1.1.1.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>mpls ldp remote-peer 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-mpls-ldp-remote-4.4.4.4] <strong>remote-ip 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-mpls-ldp-remote-4.4.4.4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>commit</strong></pre>
<p># Configure SPE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE2] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2] <strong>mpls ldp remote-peer 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-mpls-ldp-remote-1.1.1.1] <strong>remote-ip 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-mpls-ldp-remote-1.1.1.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2] <strong>mpls ldp remote-peer 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-mpls-ldp-remote-4.4.4.4] <strong>remote-ip 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-mpls-ldp-remote-4.4.4.4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2] <strong>commit</strong></pre>
</p></li><li class="substepexpand"><span>Configure dynamic PWs.</span><p><p># Configure the primary and secondary dynamic PWs on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet <span>0/1/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1] <strong>vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1] <strong>mpls l2vc 2.2.2.2 1 tunnel-policy policy1 control-word</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1] <strong>mpls l2vc 3.3.3.3 2 tunnel-policy policy1 control-word secondary</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1] <strong>mpls l2vpn stream-dual-receiving</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure the primary and secondary dynamic PWs on PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface gigabitethernet<span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface gigabitethernet<span>0/1/2</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/2</span>.1] <strong>vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/2</span>.1] <strong>mpls l2vc 2.2.2.2 3 tunnel-policy policy1 control-word</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/2</span>.1] <strong>mpls l2vc 3.3.3.3 4 tunnel-policy policy1 control-word secondary</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/2</span>.1] <strong>mpls l2vpn stream-dual-receiving</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure a dynamic switched PW on SPE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE1] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>mpls switch-l2vc 4.4.4.4 3 tunnel-policy policy1 between 1.1.1.1 1 tunnel-policy policy1 encapsulation vlan</strong><strong> control-word-transparent</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>commit</strong></pre>
<p># Configure a dynamic switched PW on SPE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE2] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2] <strong>mpls switch-l2vc 4.4.4.4 4 tunnel-policy policy1 between 1.1.1.1 2 tunnel-policy policy1 encapsulation vlan control-word-transparent</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2] <strong>commit</strong></pre>
<p>Run the <strong>display mpls l2vc brief</strong> command on PE1 and PE2. The command output shows dynamic PW information. PE1 is used as an example.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display mpls l2vc brief</strong></pre>
<pre class="screen"> Total ldp vc : 2     2 up       0 down

 *Client Interface     : GigabitEthernet<span>0/1/0</span>.1
  Administrator PW     : no
  AC status            : up
  VC State             : <strong>up</strong>
  Label state          : 0
  Token state          : 0
  VC ID                : 1
  VC Type              : VLAN
  session state        : up
  Destination          : 2.2.2.2
  link state           : up

 *Client Interface     : GigabitEthernet<span>0/1/0</span>.1
  Administrator PW     : no
  AC status            : up
  VC State             : <strong>up</strong>
  Label state          : 0
  Token state          : 0
  VC ID                : 2
  VC Type              : VLAN
  session state        : up
  Destination          : 3.3.3.3
  link state           : up
</pre>
<p>Run the <strong>display mpls switch-l2vc brief</strong> command on SPE1 and SPE2. The command output shows dynamic PW information. SPE1 is used as an example.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE1] <strong>display mpls switch-l2vc brief</strong></pre>
<pre class="screen"> Total Switch VC : 1, 1 up, 0 down

*Switch-l2vc type             : LDP&lt;----&gt;LDP
 Peer IP Address              : 4.4.4.4, 1.1.1.1
 VC ID                        : 3, 1
 VC Type                      : VLAN
 VC State                     : <strong>up</strong>
 Session State                : up, up  </pre>
</p></li></ol>
</li><li><span>Configure PW APS.</span><ol type="a"><li class="substepexpand"><span>Configure PW APS instances.</span><p><p>Configure a PW APS instance on PE1 and PE2.</p>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>pw-aps 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-pw-aps-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>pw-aps 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-pw-aps-2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</p></li><li class="substepexpand"><span>Bind PWs to PW APS instances.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface gigabitethernet <span>0/1/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1] <strong>mpls l2vpn pw-aps 1 admin</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>interface gigabitethernet <span>0/1/2</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/2</span>.1] <strong>mpls l2vpn pw-aps 2 admin</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/2</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p>Run the <strong>display mpls l2vpn pw-aps verbose</strong> command on PE1 and PE2. The command output shows information about PW APS instances and their associated PWs. PE1 and PE2 are used as examples.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display mpls l2vpn pw-aps verbose</strong></pre>
<pre class="screen"> APS Information:
   Description            :--
   Local Id               : 1
   Status                 : NR
   Work Path Status       : NoDefect
   Protect Path Status    : NoDefect
   Far End Status         : NR
   Request Result         : Work
   Wtr Interval(s)        : 300
   HoldOff Interval(ms)   : 0
   Operation Type         : Revertive
   Role                   : --
   Remote Id              : --
   Alarm Info             : None
   Total VPN Number       : 1
 ----------------------------------------
 PW Information:
   Number                 : 1
   Client Interface       : GigabitEthernet<span>0/1/0</span>.1
   Bind Type              : admin
  Primary PW:
    VC ID                 : 1
    VC Type               : VLAN
    Destination           : 2.2.2.2
    VC State              : up
  Secondary PW:
    VC ID                 : 2
    VC Type               : VLAN
    Destination           : 3.3.3.3
    VC State              : up  </pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>display mpls l2vpn pw-aps verbose</strong></pre>
<pre class="screen"> APS Information:
   Description            :--
   Local Id               : 1
   Work Path Status       : NoDefect
   Protect Path Status    : NoDefect
   Far End Status         : NR
   Request Result         : Work
   Wtr Interval(s)        : 300
   HoldOff Interval(ms)   : 0
   Operation Type         : Revertive
   Role                   : --
   Remote Id              : --
   Alarm Info             : None
   Total VPN Number       : 0
 ----------------------------------------
 PW Information:
   Number                 : 1
   Client Interface       : GigabitEthernet<span>0/1/2</span>.1
   Bind Type              : admin
  Primary PW:
    VC ID                 : 3
    VC Type               : VLAN
    Destination           : 2.2.2.2
    VC State              : up
  Secondary PW:
    VC ID                 : 4
    VC Type               : VLAN
    Destination           : 3.3.3.3
    VC State              : up     </pre>
</p></li></ol>
</li><li><span>Configure MPLS OAM to detect PW status.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls] <strong>mpls oam</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls-oam</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-oam] <strong>mpls oam l2vc peer-ip 2.2.2.2 vc-id 1 vc-type vlan remote-peer-ip 4.4.4.4 remote-vc-id 3 remote-vc-type vlan type cv auto-protocol</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-oam] <strong>mpls oam l2vc peer-ip 3.3.3.3 vc-id 2 vc-type vlan remote-peer-ip 4.4.4.4 remote-vc-id 4 remote-vc-type vlan type cv auto-protocol</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-oam] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls] <strong>mpls oam</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>mpls-oam</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-oam] <strong>mpls oam l2vc peer-ip 2.2.2.2 vc-id 3 vc-type vlan remote-peer-ip 1.1.1.1 remote-vc-id 1 remote-vc-type vlan type cv auto-protocol</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-oam] <strong>mpls oam l2vc peer-ip 3.3.3.3 vc-id 4 vc-type vlan remote-peer-ip 1.1.1.1 remote-vc-id 2 remote-vc-type vlan type cv auto-protocol</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-oam] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p>Check MPLS OAM information on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display mpls oam l2vc all</strong></pre>
<pre class="screen">--------------------------------------------------------------------------------

Total Oam Num:                    2
Total Start Oam Num:              2
Total Defect Oam Num:             0
--------------------------------------------------------------------------------

No.  Peer IP        VC Type             VC ID          Status
--------------------------------------------------------------------------------

1    2.2.2.2        vlan                3              Start/Non-defect
2    3.3.3.3        vlan                4              Start/Non-defect     </pre>
</p></li><li><span>Verify the configuration.</span><p><p># Ping a GE sub-interface of CE2 from CE1. </p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>ping 10.1.1.2</strong></pre>
<pre class="screen">PING 10.1.1.2: 56  data bytes, press CTRL_C to break
    Reply from 10.1.1.2: bytes=56 Sequence=1 ttl=255 time=40 ms
    Reply from 10.1.1.2: bytes=56 Sequence=2 ttl=255 time=30 ms
    Reply from 10.1.1.2: bytes=56 Sequence=3 ttl=255 time=40 ms
    Reply from 10.1.1.2: bytes=56 Sequence=4 ttl=255 time=1 ms
    Reply from 10.1.1.2: bytes=56 Sequence=5 ttl=255 time=1 ms

  --- 10.1.1.2 ping statistics ---
    5 packet(s) transmitted
    5 packet(s) received
    0.00% packet loss
    round-trip min/avg/max = 1/22/40 ms  </pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172369990__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>CE1 configuration file</p>
<pre class="screen">#                                                                               
sysname CE1                                                                     
#                                                                               
interface GigabitEthernet<span>0/1/0</span>                                                  
 undo shutdown                                                                  
#                                                                               
interface GigabitEthernet<span>0/1/0</span>.1                                                
 vlan-type dot1q 10                                                             
 ip address 10.1.1.1 255.255.255.0                                              
#                                                                               
return                 </pre>
</li><li><p>PE1 configuration file</p>
<pre class="screen">#                                                                               
sysname PE1                                                                     
#                                                                               
mpls lsr-id 1.1.1.1
#                                                             
mpls                                                                            
 mpls te                                                                        
 label advertise non-null                                                       
 mpls rsvp-te                                                                   
 mpls oam                                                                       
 mpls te cspf                                                                   
#                                                                               
mpls l2vpn                                                                      
#                                                                               
pw-aps 1                                                                        
#                                                                               
explicit-path 1to2                                                              
 next hop 10.1.2.2                                                              
 next hop 2.2.2.2                                                               
#                                                                               
explicit-path 1to3                                                              
 next hop 10.1.3.2                                                              
 next hop 3.3.3.3                                                               
#                                                                               
mpls ldp                                                                        
#                                                                               
mpls ldp remote-peer 2.2.2.2                                                    
 remote-ip 2.2.2.2                                                              
#                                                                               
mpls ldp remote-peer 3.3.3.3                                                    
 remote-ip 3.3.3.3                                                                                                                           
#                                                                               
interface GigabitEthernet<span>0/1/0</span>                                                  
 undo shutdown                                                                  
#                                                                               
interface GigabitEthernet<span>0/1/0</span>.1                                                
 vlan-type dot1q 10                                                             
 mpls l2vc 2.2.2.2 1 tunnel-policy policy1 control-word                         
 mpls l2vc 3.3.3.3 2 tunnel-policy policy1 control-word secondary
 mpls l2vpn stream-dual-receiving               
 mpls l2vpn pw-aps 1 admin                                                      
#                                                                               
interface GigabitEthernet<span>0/1/1</span>                                                  
 undo shutdown                                                                  
 ip address 10.1.2.1 255.255.255.0                                              
 mpls                                                                           
 mpls te                                                                        
 mpls rsvp-te                                                                   
#                                                                               
interface GigabitEthernet<span>0/1/2</span>                                                  
 undo shutdown                                                                  
 ip address 10.1.3.1 255.255.255.0                                              
 mpls                                                                           
 mpls te                                                                        
 mpls rsvp-te                                                                   
#                                                                               
interface LoopBack0                                                             
 ip address 1.1.1.1 255.255.255.255                                             
#                                                                               
interface Tunnel10                                                           
 ip address unnumbered interface LoopBack0                                      
 tunnel-protocol mpls te                                                        
 destination 2.2.2.2                                                            
 mpls te tunnel-id 100                                                          
 mpls te reverse-lsp protocol rsvp-te ingress-lsr-id 2.2.2.2 tunnel-id 100      
 mpls te path explicit-path 1to2                                                
 mpls te reserved-for-binding                                                   
#                                                                               
interface Tunnel11                                                           
 ip address unnumbered interface LoopBack0                                      
 tunnel-protocol mpls te                                                        
 destination 3.3.3.3                                                            
 mpls te tunnel-id 200                                                          
 mpls te reverse-lsp protocol rsvp-te ingress-lsr-id 3.3.3.3 tunnel-id 200      
 mpls te path explicit-path 1to3                                                
 mpls te reserved-for-binding                                                   
#                                                                               
ospf 1                                                                          
 opaque-capability enable                                                       
 area 0.0.0.0                                                                   
  network 10.1.2.0 0.0.0.255                                                    
  network 1.1.1.1 0.0.0.0                                                       
  network 10.1.3.0 0.0.0.255                                                    
  mpls-te enable                                                                
#                                                                               
tunnel-policy policy1                                                           
 tunnel binding destination 2.2.2.2 te Tunnel10                              
 tunnel binding destination 3.3.3.3 te Tunnel11                              
#                                                                               
mpls-oam                                                                        
 mpls oam l2vc peer-ip 2.2.2.2 vc-id 1 vc-type vlan remote-peer-ip 4.4.4.4 remote-vc-id 3 remote-vc-type vlan type cv auto-protocol
 mpls oam l2vc peer-ip 3.3.3.3 vc-id 2 vc-type vlan remote-peer-ip 4.4.4.4 remote-vc-id 4 remote-vc-type vlan type cv auto-protocol
#                                                                               
return </pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#                                                                               
sysname PE2                                                                     
#                                                                               
mpls lsr-id 4.4.4.4 
#                                                            
mpls                                                                            
 mpls te                                                                        
 label advertise non-null                                                       
 mpls rsvp-te                                                                   
 mpls oam                                                                       
 mpls te cspf                                                                   
#                                                                               
mpls l2vpn                                                                      
#                                                                               
pw-aps 2                                                                        
#                                                                               
explicit-path 4to2                                                              
 next hop 10.1.4.1                                                              
 next hop 2.2.2.2                                                               
#                                                                               
explicit-path 4to3                                                              
 next hop 10.1.5.1                                                              
 next hop 3.3.3.3                                                               
#                                                                               
mpls ldp                                                                        
#                                                                               
mpls ldp remote-peer 2.2.2.2                                                    
 remote-ip 2.2.2.2                                                              
#                                                                               
mpls ldp remote-peer 3.3.3.3                                                    
 remote-ip 3.3.3.3                                                              
#                                                                               
interface GigabitEthernet<span>0/1/0</span>                                                  
 undo shutdown                                                                  
 ip address 10.1.4.2 255.255.255.0                                              
 mpls                                                                           
 mpls te                                                                        
 mpls rsvp-te                                                                   
 mpls ldp                                                                       
#                                                                               
interface GigabitEthernet<span>0/1/1</span>                                                  
 undo shutdown                                                                  
 ip address 10.1.5.2 255.255.255.0                                              
 mpls                                                                           
 mpls te                                                                        
 mpls rsvp-te                                                                   
#                                                                               
interface GigabitEthernet<span>0/1/2</span>                                                  
 undo shutdown                                                                  
#                                                                               
interface GigabitEthernet<span>0/1/2</span>.1                                                
 vlan-type dot1q 10                                                             
 mpls l2vc 2.2.2.2 3 tunnel-policy policy1 control-word                         
 mpls l2vc 3.3.3.3 4 tunnel-policy policy1 control-word secondary
 mpls l2vpn stream-dual-receiving               
 mpls l2vpn pw-aps 2 admin                                                      
#                                                                               
interface LoopBack0                                                             
 ip address 4.4.4.4 255.255.255.255                                             
# 
interface Tunnel10                                                           
 ip address unnumbered interface LoopBack0                                      
 tunnel-protocol mpls te                                                        
 destination 2.2.2.2                                                            
 mpls te tunnel-id 300                                                          
 mpls te reverse-lsp protocol rsvp-te ingress-lsr-id 2.2.2.2 tunnel-id 300      
 mpls te path explicit-path 4to2                                                
 mpls te reserved-for-binding                                                   
#                                                                               
interface Tunnel11                                                           
 ip address unnumbered interface LoopBack0                                      
 tunnel-protocol mpls te                                                        
 destination 3.3.3.3                                                            
 mpls te tunnel-id 400                                                          
 mpls te reverse-lsp protocol rsvp-te ingress-lsr-id 3.3.3.3 tunnel-id 400      
 mpls te path explicit-path 4to3                                                
 mpls te reserved-for-binding                                                   
#                                                                            
ospf 1                                                                          
 opaque-capability enable                                                       
 area 0.0.0.0                                                                   
  network 10.1.4.0 0.0.0.255                                                    
  network 10.1.5.0 0.0.0.255                                                    
  network 4.4.4.4 0.0.0.0                                                       
  mpls-te enable                                                                
#                                                                               
tunnel-policy policy1                                                           
 tunnel binding destination 2.2.2.2 te Tunnel10                              
 tunnel binding destination 3.3.3.3 te Tunnel11                              
#                                                                               
mpls-oam                                                                        
 mpls oam l2vc peer-ip 2.2.2.2 vc-id 3 vc-type vlan remote-peer-ip 1.1.1.1 remote-vc-id 1 remote-vc-type vlan type cv auto-protocol
 mpls oam l2vc peer-ip 3.3.3.3 vc-id 4 vc-type vlan remote-peer-ip 1.1.1.1 remote-vc-id 2 remote-vc-type vlan type cv auto-protocol
#                                                                               
return </pre>
</li><li><p>SPE1 configuration file</p>
<pre class="screen">#                                                                               
sysname SPE1                                                                    
#                                                                               
mpls lsr-id 2.2.2.2
#                                                             
mpls                                                                            
 mpls te                                                                        
 label advertise non-null                                                       
 mpls rsvp-te                                                                   
 mpls te cspf                                                                   
#                                                                               
mpls l2vpn                                                                      
#                                                                               
mpls switch-l2vc 4.4.4.4 3 tunnel-policy policy1 between 1.1.1.1 1 tunnel-policy policy1 encapsulation vlan control-word-transparent         
#                                                                               
explicit-path 2to1                                                              
 next hop 10.1.2.1                                                              
 next hop 1.1.1.1                                                               
#                                                                               
explicit-path 2to4                                                              
 next hop 10.1.4.2                                                              
 next hop 4.4.4.4                                                               
#                                                                               
mpls ldp                                                                        
#                                                                               
mpls ldp remote-peer 1.1.1.1                                                    
 remote-ip 1.1.1.1                                                              
#                                                                               
mpls ldp remote-peer 4.4.4.4                                                    
 remote-ip 4.4.4.4                                                              
#                                                                               
interface GigabitEthernet<span>0/1/0</span>                                                  
 undo shutdown                                                                  
 ip address 10.1.2.2 255.255.255.0                                              
 mpls                                                                           
 mpls te                                                                        
 mpls rsvp-te                                                                   
#                                                                               
interface GigabitEthernet<span>0/1/1</span>                                                  
 undo shutdown                                                                  
 ip address 10.1.4.1 255.255.255.0                                              
 mpls                                                                           
 mpls te                                                                        
 mpls rsvp-te                                                                   
#                                                                               
interface LoopBack0                                                             
 ip address 2.2.2.2 255.255.255.255                                             
#                                                                               
interface Tunnel10                                                           
 ip address unnumbered interface LoopBack0                                      
 tunnel-protocol mpls te                                                        
 destination 1.1.1.1                                                            
 mpls te tunnel-id 100                                                          
 mpls te reverse-lsp protocol rsvp-te ingress-lsr-id 1.1.1.1 tunnel-id 100      
 mpls te path explicit-path 2to1                                                
 mpls te reserved-for-binding                                                   
#                                                                               
interface Tunnel11                                                           
 ip address unnumbered interface LoopBack0                                      
 tunnel-protocol mpls te                                                        
 destination 4.4.4.4                                                            
 mpls te tunnel-id 300                                                          
 mpls te reverse-lsp protocol rsvp-te ingress-lsr-id 4.4.4.4 tunnel-id 300      
 mpls te path explicit-path 2to4                                                
 mpls te reserved-for-binding                                                   
#                                                                               
ospf 1                                                                          
 opaque-capability enable                                                       
 area 0.0.0.0                                                                   
  network 2.2.2.2 0.0.0.0                                                       
  network 10.1.4.0 0.0.0.255                                                    
  network 10.1.2.0 0.0.0.255                                                    
  mpls-te enable                                                                
#                                                                               
tunnel-policy policy1                                                           
 tunnel binding destination 1.1.1.1 te Tunnel10                              
 tunnel binding destination 4.4.4.4 te Tunnel11                              
#                                                                               
return   </pre>
</li><li><p>SPE2 configuration file</p>
<pre class="screen">#                                                                               
sysname SPE2                                                                    
#                                                                               
mpls lsr-id 3.3.3.3
#                                                             
mpls                                                                            
 mpls te                                                                        
 label advertise non-null                                                       
 mpls rsvp-te                                                                   
 mpls te cspf                                                                   
#                                                                               
mpls l2vpn                                                                      
#                                                                               
mpls switch-l2vc 4.4.4.4 4 tunnel-policy policy1 between 1.1.1.1 2 tunnel-policy policy1 encapsulation vlan control-word-transparent
#                                                                                       
explicit-path 3to1                                                              
 next hop 10.1.3.1                                                              
 next hop 1.1.1.1                                                               
#                                                                               
explicit-path 3to4                                                              
 next hop 10.1.5.2                                                              
 next hop 4.4.4.4                                                               
#                                                                               
mpls ldp                                                                        
#                                                                               
mpls ldp remote-peer 1.1.1.1                                                    
 remote-ip 1.1.1.1                                                              
#                                                                               
mpls ldp remote-peer 4.4.4.4                                                    
 remote-ip 4.4.4.4                                                              
#                                                                               
interface GigabitEthernet<span>0/1/0</span>                                                  
 undo shutdown                                                                  
 ip address 10.1.3.2 255.255.255.0                                              
 mpls                                                                           
 mpls te                                                                        
 mpls rsvp-te                                                                   
#                                                                               
interface GigabitEthernet<span>0/1/1</span>                                                  
 undo shutdown                                                                  
 ip address 10.1.5.1 255.255.255.0                                              
 mpls                                                                           
 mpls te                                                                        
 mpls rsvp-te                                                                   
#                                                                               
interface LoopBack0                                                             
 ip address 3.3.3.3 255.255.255.255                                             
#                                                                              
interface Tunnel10                                                           
 ip address unnumbered interface LoopBack0                                      
 tunnel-protocol mpls te                                                        
 destination 1.1.1.1                                                            
 mpls te tunnel-id 200                                                          
 mpls te reverse-lsp protocol rsvp-te ingress-lsr-id 1.1.1.1 tunnel-id 300      
 mpls te path explicit-path 3to1                                                
 mpls te reserved-for-binding                                                   
#                                                                               
interface Tunnel11                                                           
 ip address unnumbered interface LoopBack0                                      
 tunnel-protocol mpls te                                                        
 destination 4.4.4.4                                                            
 mpls te tunnel-id 400                                                          
 mpls te reverse-lsp protocol rsvp-te ingress-lsr-id 4.4.4.4 tunnel-id 400      
 mpls te path explicit-path 3to4                                                
 mpls te reserved-for-binding                                               
#                                                                               
ospf 1                                                                          
 opaque-capability enable                                                       
 area 0.0.0.0                                                                   
  network 3.3.3.3 0.0.0.0                                                       
  network 10.1.3.0 0.0.0.255                                                    
  network 10.1.4.0 0.0.0.255                                                    
  network 10.1.5.0 0.0.0.255                                                    
  mpls-te enable                                                                
#                                                                               
tunnel-policy policy1                                                           
 tunnel binding destination 1.1.1.1 te Tunnel10                              
 tunnel binding destination 4.4.4.4 te Tunnel11                              
#                                                                               
return    </pre>
</li><li><p>CE2 configuration file</p>
<pre class="screen">#                                                                               
sysname CE2
#                                                                               
vlan batch 10
#                                                                               
interface Vlanif10                                                              
 ip address 10.1.1.2 255.255.255.0                                              
#                                                                               
interface Eth-Trunk10                                                          
 portswitch                                                                     
 port trunk allow-pass vlan 10                                                  
 mode lacp-static                                                               
#                                                                               
interface GigabitEthernet<span>0/1/0</span>                                                  
 undo shutdown                                                                  
 eth-trunk 10                                                                   
#                                                                               
interface GigabitEthernet<span>0/1/1</span>                                                  
 undo shutdown                                                                  
 eth-trunk 10                                                                   
#                                                                               
return </pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpws_cfg_3012.html">Configuration Examples for VPWS
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpws_cfg_6040.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_019006.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>