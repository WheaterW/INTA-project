
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring an HoVPN">
<meta name="abstract" content="On an HoVPN, a UPE only needs to obtain a default route from an SPE. This implementation mechanism reduces the route storage space required on a UPE.">
<meta name="description" content="On an HoVPN, a UPE only needs to obtain a default route from an SPE. This implementation mechanism reduces the route storage space required on a UPE.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0164.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0166.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,l3vpnvrp,w00556928,l00468467,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="h00847023">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="h00847023">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172369403">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring an HoVPN</title>
</head>
<body><a name="EN-US_TASK_0172369403"></a><a name="EN-US_TASK_0172369403"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring an HoVPN</h1>
<div class="taskbody"><p>On an HoVPN, a UPE only needs to obtain a default route from an SPE. This implementation mechanism reduces the route storage space required on a UPE.</p>
<div class="context"><a name="EN-US_TASK_0172369403__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><div class="p">HoVPN networking requires the following configurations:<ul><li><div class="p">Configure a VPN instance on each UPE, SPE, and NPE. For configuration details, see <a href="dc_vrp_mpls-l3vpn-v4_cfg_0155.html">Configuring a VPN Instance</a>.<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>According to relevant standards, the VPN instance status obtained from an NMS is Up only if at least one interface bound to the VPN instance is Up. On an HoVPN, VPN instances on SPEs are not bound to interfaces. As a result, the VPN instance status obtained from an NMS is always Down. To solve this problem, run the <a href="cmdqueryname=transit-vpn"><b><span class="cmdname">transit-vpn</span></b></a> command in the VPN instance view or VPN instance IPv4 address family view of an SPE. Then, the VPN instance status obtained from an NMS is always Up, no matter whether the VPN instance is bound to interfaces.</p>
</div></div>
</div>
</li><li><p>Configure an MP-BGP peer relationship between each SPE and NPE. This configuration is similar to configuring an MP-IBGP peer relationship between PEs on a BGP/MPLS IP VPN. For more information, see <a href="dc_vrp_mpls-l3vpn-v4_cfg_0157.html">Establishing MP-IBGP Peer Relationships Between PEs</a>.</p>
</li><li><p>Configure routing protocols for NPEs and UPEs to exchange routes with CEs. This configuration is similar to configuring PEs and CEs to exchange routes on a BGP/MPLS IP VPN. For more information, see <a href="dc_vrp_mpls-l3vpn-v4_cfg_0158.html">Configuring Route Exchange Between PEs and CEs</a>.</p>
</li><li><div class="p">Configure an MP-BGP peer relationship between each UPE and SPE. <span>Configure the SPE to send the default route to the UPE in either of the following modes:</span><ul><li>Route filtering mode: You can configure the default static route and routing policy to enable the SPE to send the default route to the UPE.</li><li>Command control mode: You can run the <a href="cmdqueryname=peer+default-originate+vpn-instance"><b><span class="cmdname">peer default-originate vpn-instance</span></b></a> command to enable the SPE to automatically generate the default route and send it to the UPE.</li></ul>
</div>
<p>The default route generated using the <a href="cmdqueryname=peer+default-originate+vpn-instance"><b><span class="cmdname">peer default-originate vpn-instance</span></b></a> command cannot be associated with an interface. When the primary link connecting the SPE to the UPE fails, the default route may be sent to the UPE over another interface, which affects network reaction sensitivity to faults. Therefore, the route filtering mode is recommended.</p>
</li></ul>
</div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172369403__1.4.2"></a><a name="1.4.2"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure a UPE to establish an MP-BGP peer relationship with an SPE.</span><ol type="a"><li><span>Run the <span><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span> command to enter the system view.</span></li><li><span>Run the <span><a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span> command to enter the BGP view.</span></li><li><span>Run the <span><a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>as-number</span></strong> <i><span class="varname">as-number</span></i></span> command to specify the SPE as a BGP peer of the UPE.</span></li><li><span>Run the <a href="cmdqueryname=ipv4-family"><b><span class="cmdname">ipv4-family</span></b></a> <strong><span>vpnv4</span></strong> command to enter the BGP-VPNv4 address family view.</span></li><li><span>Run the <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>enable</span></strong> command to enable the function to exchange BGP-VPNv4 routes with the specified peer.</span></li><li><span>Run the <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span> command to commit the configuration.</span></li></ol>
</li><li><span>Configure the SPE to send the default or summary route to the UPE. </span><p><ul><li><p>Configure the SPE to send the default route to the UPE.</p>
<ol type="a"><li><p>Run the <span><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span> command to enter the system view.</p>
</li><li><p>Run the <a href="cmdqueryname=ip+route-static+vpn-instance"><b><span class="cmdname">ip route-static vpn-instance</span></b></a> <i><span class="varname">vpn-source-name</span></i> <strong>0.0.0.0</strong> { <strong>0.0.0.0</strong> | <strong>0</strong> }{ <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i> } [ <i><span class="varname">nexthop-address</span></i> ] [ <strong><span>preference</span></strong> <i><span class="varname">preference</span></i> | <strong><span>tag</span></strong> <i><span class="varname">tag</span></i> ] <span><sup>*</sup></span> [ <strong><span>description</span></strong> <i><span class="varname">text</span></i> ] command to create a static default VPN IPv4 route.</p>
</li><li><p>Run the <span><a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span> command to enter the BGP view.</p>
</li><li><p>Run the <span><a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>as-number</span></strong> <i><span class="varname">as-number</span></i></span> command to specify the UPE as a BGP peer of the SPE.</p>
</li><li><p>Run the <span><a href="cmdqueryname=ipv4-family"><b><span class="cmdname">ipv4-family</span></b></a> <strong><span>vpnv4</span></strong></span> command to enter the BGP-VPNv4 address family view.</p>
</li><li><p>Run the <span><a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>upe</span></strong></span> command to specify the UPE as a lower-level PE of the SPE.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>This step can be performed only if a VPNv4 peer relationship has been established between the SPE and UPE.</p>
</div></div>
</li><li><p>Run the <span><a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span> command to return to the BGP view.</p>
</li><li><p>Run the <span><a href="cmdqueryname=ipv4-family"><b><span class="cmdname">ipv4-family</span></b></a> <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i></span> command to enter the BGP VPN instance IPv4 address family view.</p>
</li><li><p>Run <span><a href="cmdqueryname=network"><b><span class="cmdname">network</span></b></a> <strong>0.0.0.0</strong> [ <strong>0.0.0.0</strong> | <strong>0</strong> ] [ <strong><span>route-policy</span></strong> <i><span class="varname">route-policy-name</span></i> ]</span> command to import the default route into the IPv4 VPN instance routing table.</p>
</li><li><p>Run the <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span> command to commit the configuration.</p>
</li></ol>
</li></ul>
<ul><li><p>Configure the SPE to send summary routes to the UPE.</p>
<ol type="a"><li><p>Run the <span><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span> command to enter the system view.</p>
</li><li><p>Run the <span><a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span> command to enter the BGP view.</p>
</li><li><p>Run the <span><a href="cmdqueryname=ipv4-family"><b><span class="cmdname">ipv4-family</span></b></a> <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i></span> command to enter the BGP VPN instance IPv4 address family view.</p>
</li><li><p>Run the <span><a href="cmdqueryname=aggregate"><b><span class="cmdname">aggregate</span></b></a> <i><span class="varname">ipv4-address</span></i> { <i><span class="varname">mask</span></i> | <i><span class="varname">mask-length</span></i> } [ <strong><span>as-set</span></strong> | <strong><span>attribute-policy</span></strong> <i><span class="varname">route-policy-name1</span></i> | <strong><span>detail-suppressed</span></strong> | <strong><span>origin-policy</span></strong> <i><span class="varname">route-policy-name2</span></i> | <strong><span>suppress-policy</span></strong> <i><span class="varname">route-policy-name3</span></i> ] <sup>*</sup></span> command to configure route summarization.</p>
</li><li><p>Run the <span><a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span> command to return to the BGP view.</p>
</li><li><p>Run the <span><a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span> command to return to the system view.</p>
</li><li><p>Run the <span><a href="cmdqueryname=ip+ip-prefix"><b><span class="cmdname">ip ip-prefix</span></b></a> <i><span class="varname">ip-prefix-name</span></i> [ <strong><span>index</span></strong> <i><span class="varname">index-number</span></i> ] { <strong><span>permit</span></strong> | <strong><span>deny</span></strong> } <i><span class="varname">ip-address</span></i> <i><span class="varname">mask-length</span></i> [ <strong><span>greater-equal</span></strong> <i><span class="varname">greater-equal-value</span></i> ] [ <strong><span>less-equal</span></strong> <i><span class="varname">less-equal-value</span></i> ]</span> command to configure an IPv4 prefix list.</p>
</li><li><p>Run the <span><a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span> command to enter the BGP view.</p>
</li><li><p>Run the <span><a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>as-number</span></strong> <i><span class="varname">as-number</span></i></span> command to specify the UPE as a BGP peer of the SPE.</p>
</li><li><p>Run the <span><a href="cmdqueryname=ipv4-family"><b><span class="cmdname">ipv4-family</span></b></a> <strong><span>vpnv4</span></strong></span> command to enter the BGP-VPNv4 address family view.</p>
</li><li><p>Run the <span><a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>ip-prefix</span></strong> <i><span class="varname">ip-prefix-name</span></i> <strong><span>export</span></strong></span> command to configure the SPE to advertise filtered routes to the UPE.</p>
</li><li><p>Run the <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span> command to commit the configuration.</p>
</li></ol>
</li></ul>
</p></li><li><span>(Optional) Configure one-label-per-next-hop label distribution on the SPE. </span><p><p>In an HoVPN scenario, if an SPE needs to send large numbers of VPNv4 routes but the MPLS labels are inadequate, configure one-label-per-next-hop label distribution on the SPE.</p>
</p><ol type="a"><li class="substepexpand"><span>Run the <span><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span> command to enter the system view.</span></li><li class="substepexpand"><span>Run the <span><a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span> command to enter the BGP view.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=ipv4-family"><b><span class="cmdname">ipv4-family</span></b></a> <strong><span>vpnv4</span></strong> command to enter the BGP-VPNv4 address family view.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=apply-label+per-nexthop"><b><span class="cmdname">apply-label per-nexthop</span></b></a> command to enable one-label-per-next-hop label distribution for VPNv4 routes on the SPE.</span><p><div class="notice"><span class="noticetitle"><img src="../../../../public_sys-resources/notice_3.0-en-us.png"> </span><div class="noticebody"><p>After one-label-per-next-hop label distribution is enabled or disabled on an SPE, the labels assigned by the SPE to routes change. As a result, temporary packet loss occurs.</p>
</div></div>
</p></li><li class="substepexpand"><span>Run the <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span> command to commit the configuration.</span></li></ol>
</li></ol></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0164.html">Configuring an HVPN
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0166.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>