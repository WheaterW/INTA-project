
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring BGP EVPN Peer Relationships">
<meta name="abstract" content="After a BGP EVPN peer relationship is established between PEs, the PEs can exchange EVPN routes when MPLS or SR-MPLS tunnels are deployed on the backbone network.">
<meta name="description" content="After a BGP EVPN peer relationship is established between PEs, the PEs can exchange EVPN routes when MPLS or SR-MPLS tunnels are deployed on the backbone network.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0003.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0013.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0014.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="p00915595,w00800033,w00556928,l00468467,w00606909,evpnvrp,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="p00915595">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00878323">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172370439">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring BGP EVPN Peer Relationships</title>
</head>
<body><a name="EN-US_TASK_0172370439"></a><a name="EN-US_TASK_0172370439"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring BGP EVPN Peer Relationships</h1>
<div class="taskbody"><p>After a BGP EVPN peer relationship is established between PEs, the PEs can exchange EVPN routes when MPLS or SR-MPLS tunnels are deployed on the backbone network.</p>
<div class="context"><a name="EN-US_TASK_0172370439__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>In EVPN networking, PEs have to establish BGP EVPN peer relationships before exchanging EVPN routes to implement communication between the PEs within an EVPN instance.</p>
<p>Perform the following steps on each PE.</p>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172370439__1.4.2"></a><a name="1.4.2"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span><p><p>The BGP view is displayed.</p>
</p></li><li><span>(Optional) Run <a href="cmdqueryname=router-id"><b><span class="cmdname">router-id</span></b></a> <i><span class="varname">router-id-value</span></i></span><p><p>A BGP router ID is configured.</p>
</p><p><p>If this step is not performed, the device automatically selects an interface address as the BGP router ID. This step is mandatory if you need to specify a router ID for the current BGP process.</p>
</p></li><li><span>Run <a href="cmdqueryname=peer+as-number"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <strong><span>as-number</span></strong> <i><span class="varname">as-number</span></i></span><p><p>A remote PE is configured as a peer.</p>
</p></li><li><span>Run <a href="cmdqueryname=peer+connect-interface"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <a href="cmdqueryname=connect-interface"><b><span class="cmdname">connect-interface</span></b></a> <strong><span>loopback</span></strong> <i><span class="varname">interface-number</span></i></span><p><p>The interface on which a TCP connection to the specified BGP peer is established is specified.</p>
</p><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>A PE must use a loopback interface address with a 32-bit mask to establish an MP-IBGP peer relationship with the peer PE so that routes can recurse to tunnels. The route to the local loopback interface is advertised to the peer PE using an IGP on the MPLS backbone network.</p>
</div></div>
</p></li><li><span>(Optional) Run <a href="cmdqueryname=group"><b><span class="cmdname">group</span></b></a><strong> </strong><em>group-name</em> [ <strong>internal</strong> | <strong>external</strong> ]</span><p><p>A peer group is created.</p>
</p></li><li><span>Run <a href="cmdqueryname=l2vpn-family+evpn"><b><span class="cmdname">l2vpn-family evpn</span></b></a></span><p><p>The BGP-EVPN address family view is displayed.</p>
</p></li><li><span>Run <a href="cmdqueryname=peer+enable"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>enable</span></strong></span><p><p>The device is enabled to exchange EVPN routes with a specified peer or peer group.</p>
</p></li><li><span>(Optional) Run <a href="cmdqueryname=peer+group"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <strong><span>group</span></strong> <i><span class="varname">group-name</span></i></span><p><p>A BGP EVPN peer is added to the peer group.</p>
<p>Adding BGP EVPN peers to peer groups simplifies BGP network configuration and management.</p>
</p></li><li><span>(Optional) Run <a href="cmdqueryname=timer+df-delay"><b><span class="cmdname">timer df-delay</span></b></a> <i><span class="varname">delay-value</span></i></span><p><p>A designated forwarder (DF) election delay is configured.</p>
<p>If a network is unstable, PE interfaces connecting to CEs will frequently alternate between up and down, resulting in repeated DF election and subsequent network performance deterioration. To prevent repeated DF election, run the <a href="cmdqueryname=timer+df-delay"><b><span class="cmdname">timer df-delay</span></b></a> command to set a longer DF election delay to improve network stability.</p>
<p>In an EVPN dual-homing scenario where interface-based DF election is enabled, you need to run this command to set the DF election delay to 0s, preventing the long-time existence of dual standby devices during a switchback from causing traffic interruption.</p>
</p></li><li><span>(Optional) Run <a href="cmdqueryname=peer+mac-limit"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">group-name</span></i> | <i><span class="varname">ipv4-address</span></i> } <a href="cmdqueryname=mac-limit"><b><span class="cmdname">mac-limit</span></b></a> <i><span class="varname">number</span></i> [ <i><span class="varname">percentage</span></i> ] [ <strong><span>alert-only</span></strong> | <strong><span>idle-forever</span></strong> | <strong><span>idle-timeout</span></strong> <i><span class="varname">times</span></i> ]</span><p><p>The maximum number of MAC advertisement routes that can be received from a peer or peer group is configured.</p>
<p>If an EVPN instance imports many inapplicable MAC routes from a peer or peer group and they account for a large proportion of the total number of MAC routes, you are advised to run this command to limit the maximum number of MAC advertisement routes that can be imported. If the number of imported MAC advertisement routes exceeds the specified maximum number, the device displays an alarm, prompting you to check the validity of the MAC advertisement routes imported into the EVPN instance.</p>
</p></li><li><span>(Optional) Perform the following operations to enable the device to advertise the routes carrying the large-community attribute to BGP EVPN peers.</span><p><p>The large-community attribute can represent a whole 2-byte or 4-byte AS number, and contain two 4-byte LocalData IDs, facilitating the flexible application of route-policies. Before enabling the function to advertise the routes carrying the large-community attribute to BGP EVPN peers, <a href="dc_vrp_bgp_cfg_4059.html">configure the route-policy related to the large-community attribute</a> and use the route-policy to set the large-community attribute.</p>
</p><ol type="a"><li class="substepexpand"><span>Run the <a href="cmdqueryname=peer+route-policy"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>route-policy</span></strong> <i><span class="varname">route-policy-name</span></i> <strong><span>export</span></strong> command to configure an export route-policy for the BGP EVPN peer or group. </span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=peer+advertise-large-community"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>advertise-large-community</span></strong> command to enable the device to advertise the routes carrying the large-community attribute to the specified BGP EVPN peer or peer group.</span><p><p>If the routes carrying the large-community attribute do not need to be advertised to a specified BGP EVPN peer in a peer group, run the <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <strong><span>advertise-large-community</span></strong> <strong><span>disable</span></strong> command.</p>
</p></li></ol>
</li><li><span>(Optional) Run <a href="cmdqueryname=peer+path-attribute-treat"><b><span class="cmdname" id="EN-US_TASK_0172370439__en-us_task_0172370456_cmdname33171046194416">peer</span></b></a> <i><span class="varname" id="EN-US_TASK_0172370439__en-us_task_0172370456_varname1831724694412">peerIpv4Addr</span></i> <strong><span id="EN-US_TASK_0172370439__en-us_task_0172370456_cmdparmname7317164634410">path-attribute-treat</span></strong> <strong><span id="EN-US_TASK_0172370439__en-us_task_0172370456_cmdparmname113171646124411">attribute-id</span></strong> { <i><span class="varname" id="EN-US_TASK_0172370439__en-us_task_0172370456_varname93177467447">id</span></i> [ <strong><span id="EN-US_TASK_0172370439__en-us_task_0172370456_cmdparmname12317946104412">to</span></strong> <i><span class="varname" id="EN-US_TASK_0172370439__en-us_task_0172370456_varname2031764694414">id2</span></i> ] } &amp;&lt;1-255&gt; { <strong><span id="EN-US_TASK_0172370439__en-us_task_0172370456_cmdparmname15317246194419">discard</span></strong> | <strong><span id="EN-US_TASK_0172370439__en-us_task_0172370456_cmdparmname6317746184417">withdraw</span></strong> | <strong><span id="EN-US_TASK_0172370439__en-us_task_0172370456_cmdparmname183171846204414">treat-as-unknown</span></strong> }</span><p><p id="EN-US_TASK_0172370439__en-us_task_0172370456_p1152850194810">A special mode for processing BGP EVPN path attributes is configured.</p>
<p id="EN-US_TASK_0172370439__en-us_task_0172370456_p160152604910">Alternatively, run the <a href="cmdqueryname=peer"><b><span class="cmdname" id="EN-US_TASK_0172370439__en-us_task_0172370456_cmdname1148092318490">peer</span></b></a> { <i><span class="varname" id="EN-US_TASK_0172370439__en-us_task_0172370456_varname20480623164914">peerIpv4Addr</span></i> | <i><span class="varname" id="EN-US_TASK_0172370439__en-us_task_0172370456_varname17480202384916">peerIpv6Addr</span></i> } <strong><span id="EN-US_TASK_0172370439__en-us_task_0172370456_cmdparmname1348092312499">treat-with-error</span></strong> <strong><span id="EN-US_TASK_0172370439__en-us_task_0172370456_cmdparmname84801623144916">attribute-id</span></strong> <i><span class="varname" id="EN-US_TASK_0172370439__en-us_task_0172370456_varname16480162314914">id</span></i> <strong><span id="EN-US_TASK_0172370439__en-us_task_0172370456_cmdparmname1548162384920">accept-zero-value</span></strong> command to configure a mode for processing malformed BGP EVPN path attributes.</p>
</p><p><p id="EN-US_TASK_0172370439__en-us_task_0172370456_p853610510717">A BGP EVPN Update message contains various path attributes. If a local device receives Update messages containing malformed path attributes, the involved BGP EVPN sessions may flap. To enhance reliability, you can perform this step to perform special processing on specified path attributes or malformed path attributes in BGP EVPN Update messages.</p>
<div class="p" id="EN-US_TASK_0172370439__en-us_task_0172370456_p18357962720"><strong id="EN-US_TASK_0172370439__en-us_task_0172370456_b1987125855810">path-attribute-treat</strong> is used to specify the processing mode for path attributes. The processing mode can be:<ul id="EN-US_TASK_0172370439__en-us_task_0172370456_ul8357461570"><li id="EN-US_TASK_0172370439__en-us_task_0172370456_li4357168712"><p id="EN-US_TASK_0172370439__en-us_task_0172370456_p16357176170"><a name="EN-US_TASK_0172370439__en-us_task_0172370456_li4357168712"></a><a name="en-us_task_0172370456_li4357168712"></a>Discarding the specified path attributes</p>
</li><li id="EN-US_TASK_0172370439__en-us_task_0172370456_li335796579"><p id="EN-US_TASK_0172370439__en-us_task_0172370456_p173579615716"><a name="EN-US_TASK_0172370439__en-us_task_0172370456_li335796579"></a><a name="en-us_task_0172370456_li335796579"></a>Withdrawing routes with the specified path attributes</p>
</li><li id="EN-US_TASK_0172370439__en-us_task_0172370456_li63577614715"><p id="EN-US_TASK_0172370439__en-us_task_0172370456_p18357561571"><a name="EN-US_TASK_0172370439__en-us_task_0172370456_li63577614715"></a><a name="en-us_task_0172370456_li63577614715"></a>Processing the specified path attributes as unknown ones</p>
</li></ul>
</div>
<p id="EN-US_TASK_0172370439__en-us_task_0172370456_p13276172704120"><strong id="EN-US_TASK_0172370439__en-us_task_0172370456_b2043118321906">treat-with-error</strong> is used to specify the processing mode for malformed path attributes. The processing mode is as follows: Receiving path attributes with values being 0.</p>
</p></li><li><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0003.html">Configuring EVPN VPLS over MPLS (Common EVPN Instance)
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0013.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0014.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>