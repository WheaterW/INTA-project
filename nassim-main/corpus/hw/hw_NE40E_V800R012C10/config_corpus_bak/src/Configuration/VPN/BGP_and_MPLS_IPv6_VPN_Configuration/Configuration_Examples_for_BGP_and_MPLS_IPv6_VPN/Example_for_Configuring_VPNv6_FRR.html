
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring VPNv6 FRR">
<meta name="abstract" content="This section provides an example for configuring VPNv6 FRR in a CE multi-homing scenario. If a PE fails, VPNv6 FRR can quickly switch IPv6 VPN traffic to the backup route.">
<meta name="description" content="This section provides an example for configuring VPNv6 FRR in a CE multi-homing scenario. If a PE fails, VPNv6 FRR can quickly switch IPv6 VPN traffic to the backup route.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v6_cfg_2039.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v6_cfg_2081.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v6_cfg_2030.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,l3vpnvrp,w00556928,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="BGP/MPLS IPv6 VPN">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP/MPLS IPv6 VPN">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="BGP/MPLS IPv6 VPN">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="BGP/MPLS IPv6 VPN">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="h00847023">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00415692">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172369738">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring VPNv6 FRR</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172369738"></a><a name="EN-US_TASK_0172369738"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring VPNv6 FRR</h1>
<div class="taskbody"><p>This section provides an example for configuring VPNv6 FRR in a CE multi-homing scenario. If a PE fails, VPNv6 FRR can quickly switch IPv6 VPN traffic to the backup route.</p>
<div class="context"><a name="EN-US_TASK_0172369738__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>VPNv6 FRR can be deployed in the CE dual-homing networking. If the primary route between PEs fails, VPNv6 FRR can quickly switch IPv6 VPN traffic to the backup route.</p>
<p>On the network shown in <a href="#EN-US_TASK_0172369738__fig_dc_vrp_mpls-l3vpn-v6_cfg_204401">Figure 1</a>, PE1 learns two routes with the same prefix to the CE from PE2 and PE3. It is required that PE3 be configured as a backup next hop for the IPv6 route on PE1. In this manner, VPN traffic can be quickly switched to PE3 if PE2 becomes faulty.</p>
<div class="fignone" id="EN-US_TASK_0172369738__fig_dc_vrp_mpls-l3vpn-v6_cfg_204401"><a name="EN-US_TASK_0172369738__fig_dc_vrp_mpls-l3vpn-v6_cfg_204401"></a><a name="fig_dc_vrp_mpls-l3vpn-v6_cfg_204401"></a><span class="figcap"><b>Figure 1 </b>Network diagram of configuring VPNv6 FRR</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface1, interface2, and interface3 represent GE<span>0/1/0</span>, GE<span>0/2/0</span>, and GE<span>0/3/0</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0285385105.png" width="NaN" height="NaN"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172369738__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Notes</h4><ul><li>A CE is dual-homed to two PEs, and VPN instances with different RDs are configured on the PEs.</li><li>In a VPN FRR scenario, after the primary path recovers, traffic switches back to this path. Because the order in which nodes undergo IGP convergence differs, packet loss may occur during the switchback. To resolve this problem, run the <a href="cmdqueryname=route-select+delay"><b><span class="cmdname">route-select delay</span></b></a> <i><span class="varname">delay-value</span></i> command to configure a route selection delay so that traffic is switched back only after forwarding entries on the devices along the primary path are updated. The delay specified using <em>delay-value</em> depends on various factors, such as the number of routes on the devices. Set a proper delay as needed.</li></ul>
</div></div>
<div class="context"><a name="EN-US_TASK_0172369738__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure OSPF on the MPLS backbone network for communication between PE1, PE2, and PE3.</p>
</li><li><p>Configure basic MPLS functions and MPLS LDP on the MPLS backbone network to establish LDP LSPs.</p>
</li><li><p>Configure an IPv6-address-family-enabled VPN instance on PE1, PE2, and PE3, and bind the interface that connects a PE to the CE to the VPN instance on that PE.</p>
</li><li><p>Establish an EBGP peer relationship between the CE and PEs for IPv6 VPN route import, and establish MP-IBGP peer relationships between PEs.</p>
</li><li><p>Configure static BFD for LDP LSP on PE1 and PE2.</p>
</li><li><p>Enable VPNv6 auto FRR on PE1.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172369738__1.4.4"></a><a name="1.4.4"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>AS numbers of the PEs and CE</p>
</li><li><p>Name of the VPN instance configured on each PE as well as other attributes of the VPN instance IPv6 address family, such as the RD and VPN targets</p>
</li><li><p>Names of the route-policy and IP prefix configured on PE1</p>
</li><li><p>BFD configuration name, local discriminator, and remote discriminator</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172369738__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure IPv4 addresses for interfaces on the VPN backbone network and IPv6 addresses for interfaces at the VPN site. For detailed configurations, see Configuration Files.</span></li><li><span>Configure OSPF on the MPLS backbone network for communication between PEs on the backbone network. For detailed configurations, see Configuration Files.</span></li><li><span>Configure basic MPLS functions and MPLS LDP on the MPLS backbone network to establish LDP LSPs.</span><p><p># Configure PE1.</p>
<pre class="screen">&lt;PE1&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>mpls lsr-id 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitEthernet<span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitEthernet<span>0/3/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/3/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/3/0</span>]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/3/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">&lt;PE2&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>mpls lsr-id 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface gigabitEthernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> commit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">&lt;PE3&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>mpls lsr-id 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>interface gigabitEthernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/0</span>]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/0</span>]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3]<strong> commit</strong></pre>
<p>Run the <strong>display mpls lsp</strong> command on PEs. The command output shows that LSPs have been set up between PE1 and PE2, and between PE1 and PE3. The following example uses the command output on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> display mpls lsp</strong></pre>
<pre class="screen">2021-04-09 01:14:17.813                                                                                                             
Flag after Out IF: (I) - RLFA Iterated LSP, (I*) - Normal and RLFA Iterated LSP                                                     
Flag after LDP FRR: (L) - Logic FRR LSP
-------------------------------------------------------------------------------
                 LSP Information: LDP LSP
-------------------------------------------------------------------------------
FEC                In/Out Label  In/Out IF                      Vrf Name
1.1.1.1/32         3/NULL        -/-
2.2.2.2/32         NULL/3        -/GE<span>0/2/0</span>
2.2.2.2/32         1025/3        -/GE<span>0/2/0</span>
3.3.3.3/32         NULL/3        -/GE<span>0/3/0</span>
3.3.3.3/32         1024/3        -/GE<span>0/3/0</span></pre>
</p></li><li><span>Configure an IPv6-address-family-enabled VPN instance on each PE and configure the CE to access PE2 and PE3.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>ip vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpn1] <strong>ipv6-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpn1-af-ipv6] <strong>route-distinguisher 100:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpn1-af-ipv6] <strong>vpn-target 111:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpn1-af-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpn1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface loopback2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Loopback2] <strong>ip binding vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Loopback2]<strong> ipv6 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Loopback2]<strong> ipv6 address 2001:DB8:8::1 64</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Loobpack2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>ip vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-vpn1] <strong>ipv6-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-vpn1-af-ipv6] <strong>route-distinguisher 100:2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-vpn1-af-ipv6] <strong>vpn-target 111:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-vpn1-af-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-vpn1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface gigabitethernet<span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>] <strong>ip binding vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>]<strong> ipv6 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>]<strong> ipv6 address 2001:DB8:1::2 64</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>ip vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-vpn1] <strong>ipv6-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-vpn1-af-ipv6] <strong>route-distinguisher 100:3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-vpn1-af-ipv6] <strong>vpn-target 111:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-vpn1-af-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-vpn1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>interface gigabitethernet<span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/2/0</span>] <strong>ip binding vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/2/0</span>]<strong> ipv6 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/2/0</span>]<strong> ipv6 address 2001:DB8:3::2 64</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
</p></li><li><span>Establish an EBGP peer relationship between PE2 and the CE, and between PE3 and the CE.</span><p><p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2]<strong> bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>ipv6-family vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp6-vpn1]<strong> peer 2001:DB8:1::1 as-number 65410</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp6-vpn1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3]<strong> bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>ipv6-family vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp6-vpn1] <strong>peer 2001:DB8:3::1 as-number 65410</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp6-vpn1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
<p># Configure the CE.</p>
<pre class="screen">&lt;CE&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE]<strong> bgp 65410</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-bgp]<strong> router-id 10.10.10.10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-bgp]<strong> peer 2001:DB8:1::2 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-bgp]<strong> peer 2001:DB8:3::2 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-bgp]<strong> ipv6-family unicast</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-bgp-af-ipv6] <strong>peer 2001:DB8:1::2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-bgp-af-ipv6] <strong>peer 2001:DB8:3::2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-bgp-af-ipv6] <strong>network 2001:DB8:0:1:2::1 128</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-bgp-af-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-bgp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE]<strong> commit</strong></pre>
<p>After the configuration is complete, run the <strong>display bgp vpnv6 vpn-instance vpn1 peer</strong> command on PE2 and PE3. The command output shows that the status of the EBGP peer relationships between the PEs and CE is <strong>Established</strong>.</p>
<p>The following example uses the command output on PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>display bgp vpnv6 vpn-instance vpn1 peer</strong></pre>
<pre class="screen"> BGP local router ID : 2.2.2.2
 Local AS number : 100
 Total number of peers : 1                 Peers in established state : 1
  Peer            V    AS  MsgRcvd  MsgSent  OutQ  Up/Down       State PrefRcv
  2001:DB8:1::1   4 65001       46       46     0 00:08:36 <strong>Established</strong>     5</pre>
</p></li><li><span>Establish an MP-IBGP peer relationship between PEs.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 2.2.2.2 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp]<strong> peer 2.2.2.2 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 3.3.3.3 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp]<strong> peer 3.3.3.3 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>ipv6-family vpnv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-vpnv6] <strong>peer 2.2.2.2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-vpnv6] <strong>peer 3.3.3.3 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-vpnv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>peer 1.1.1.1 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp]<strong> peer 1.1.1.1 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>ipv6-family vpnv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-vpnv6] <strong>peer 1.1.1.1 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-vpnv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>commit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>peer 1.1.1.1 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>peer 1.1.1.1 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>ipv6-family vpnv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp-af-vpnv6]<strong> peer 1.1.1.1 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp-af-vpnv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
<p>After the configuration is complete, run the <strong>display bgp vpnv6 all peer</strong> command on PEs. The command output shows that the status of the MP-IBGP peer relationship between the PEs is <strong>Established</strong>.</p>
<p>The following example uses the command output on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display bgp vpnv6 all peer</strong></pre>
<pre class="screen"> BGP local router ID : 10.10.1.1
 Local AS number : 100
 Total number of peers : 2                 Peers in established state : 2

  Peer            V          AS  MsgRcvd  MsgSent  OutQ  Up/Down       State  PrefRcv
  2.2.2.2         4         100       29       26     0 00:20:08 <strong>Established</strong>       2
  3.3.3.3         4         100       18       17     0 00:11:32 <strong>Established</strong>       1</pre>
</p></li><li><span>Configure static BFD for LDP LSP.</span><p><p># Configure static BFD for LDP LSP on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bfd</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bfd] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> bfd for_ldp_lsp bind ldp-lsp peer-ip 2.2.2.2 nexthop 10.10.1.2 interface gigabitethernet<span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bfd-session-for_ldp_lsp] <strong>discriminator local 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bfd-session-for_ldp_lsp] <strong>discriminator remote 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bfd-session-for_ldp_lsp] <strong>process-pst</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bfd-session-for_ldp_lsp] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bfd-session-for_ldp_lsp] <strong>quit</strong></pre>
<p># Configure static BFD for LDP LSP on PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>bfd</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bfd] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>bfd for_ldp_lsp bind ldp-lsp peer-ip 1.1.1.1 nexthop 10.10.1.1 interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bfd-session-for_ldp_lsp] <strong>discriminator local 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bfd-session-for_ldp_lsp] <strong>discriminator remote 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bfd-session-for_ldp_lsp] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-bfd-session-for_ldp_lsp] <strong>quit</strong></pre>
<p># After the configuration is complete, run the <strong>display bfd session all verbose</strong> command on PE1 and PE2. The command output shows that <strong>State</strong> is <strong>Up</strong>, and <strong>BFD Bind Type</strong> is <strong>LDP_LSP</strong>.</p>
</p></li><li><span>Enable VPNv6 auto FRR.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp] <strong>ipv6-family vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp6-vpn1] <strong>auto-frr</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp6-vpn1] <strong>route-select delay 300</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp6-vpn1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p>After the configuration is complete, run the <strong>display ipv6 routing-table vpn-instance verbose</strong> command on PE1. The command output shows the backup next hop, backup label, and backup tunnel ID of the IPv6 VPN route.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display ipv6 routing-table vpn-instance vpn1 2001:DB8:2::1 128 verbose</strong></pre>
<pre class="screen">Routing Table : vpn1
Summary Count : 1

Destination  : 2001:DB8:2::1                           PrefixLength : 128
NextHop      : 2.2.2.2                                 Preference   : 255
Neighbour    : ::                                      ProcessID    : 0
Label        : 4099                                    Protocol     : IBGP
State        : Active Adv Relied                       Cost         : 0
Entry ID     : 0                                       EntryFlags   : 0x00000000
Reference Cnt: 0                                       Tag          : 0
Priority     : low                                     Age          : 450sec
IndirectID   : 0x5A00006E
RelayNextHop : ::                                      TunnelID     : 0x0000000001004c4b42
Interface    : LDP LSP                                 Flags        : RD
<strong>BkNextHop</strong>   : 3.3.3.3                                 BkInterface  : LDP LSP
<strong>BkLabel</strong>     : 4098                                    BkTunnelID   : 0x0
<strong>BkPETunnelID</strong>: 0x0000000001004c4b43                    BkIndirectID : 0x5A000070</pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172369738__1.4.6"></a><a name="1.4.6"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>PE1 configuration file</p>
<pre class="screen">#
sysname PE1
#
ip vpn-instance vpn1
 ipv6-family
  route-distinguisher 100:1
  apply-label per-instance
  vpn-target 111:1 export-extcommunity
  vpn-target 111:1 import-extcommunity
#
bfd
#
mpls lsr-id 1.1.1.1
#
mpls
#
mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.10.1.1 255.255.255.252
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/3/0</span>
 undo shutdown
 ip address 10.20.1.1 255.255.255.252
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 1.1.1.1 255.255.255.255
#
interface LoopBack2
 ip binding vpn-instance vpn1
 ipv6 enable
 ipv6 address 2001:DB8:8::1/64
#
bgp 100
 peer 2.2.2.2 as-number 100
 peer 2.2.2.2 connect-interface LoopBack1
 peer 3.3.3.3 as-number 100
 peer 3.3.3.3 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 2.2.2.2 enable
  peer 3.3.3.3 enable
#
 ipv6-family vpnv6
  policy vpn-target
  peer 2.2.2.2 enable
  peer 3.3.3.3 enable
#
 ipv6-family vpn-instance vpn1
 auto-frr
<strong> </strong>route-select delay 300
#
ospf 1
 area 0.0.0.0
  network 10.10.1.0 0.0.0.3
  network 10.20.1.0 0.0.0.3
  network 1.1.1.1 0.0.0.0
#
bfd for_ldp_lsp bind ldp-lsp peer-ip 2.2.2.2 nexthop 10.10.1.2 interface gigabitethernet<span>0/2/0</span>
 discriminator local 10
 discriminator remote 20
 process-pst
#
return</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#
sysname PE2
#
ip vpn-instance vpn1
 ipv6-family
  route-distinguisher 100:2
  apply-label per-instance
  vpn-target 111:1 export-extcommunity
  vpn-target 111:1 import-extcommunity
#
bfd
#
mpls lsr-id 2.2.2.2
#
mpls
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.10.1.2 255.255.255.252
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ipv6 enable 
 ip binding vpn-instance vpn1
 ipv6 address 2001:DB8:1::2/64
#
interface LoopBack1
 ip address 2.2.2.2 255.255.255.255
#
bgp 100
 peer 1.1.1.1 as-number 100
 peer 1.1.1.1 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 1.1.1.1 enable
#
 ipv6-family vpnv6
  policy vpn-target
  peer 1.1.1.1 enable
#
 ipv6-family vpn-instance vpn1
  peer 2001:DB8:1::1 as-number 65410
  import-route direct
#
ospf 1
 area 0.0.0.0
  network 10.10.1.0 0.0.0.3
  network 2.2.2.2 0.0.0.0
#
bfd for_ldp_lsp bind ldp-lsp peer-ip 1.1.1.1 nexthop 10.10.1.1 interface gigabitethernet<span>0/1/0</span>
 discriminator local 20
 discriminator remote 10
#
return</pre>
</li><li><p>PE3 configuration file</p>
<pre class="screen">#
sysname PE3
#
ip vpn-instance vpn1
 ipv6-family
  route-distinguisher 100:3
  apply-label per-instance
  vpn-target 111:1 export-extcommunity
  vpn-target 111:1 import-extcommunity
#
mpls lsr-id 3.3.3.3
#
mpls
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.20.1.2 255.255.255.252
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ipv6 enable 
 ip binding vpn-instance vpn1
 ipv6 address 2001:DB8:3::2/64
#
interface LoopBack1
 ip address 3.3.3.3 255.255.255.255
#
bgp 100
 peer 1.1.1.1 as-number 100 
 peer 1.1.1.1 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 1.1.1.1 enable
#
 ipv6-family vpnv6
  policy vpn-target
  peer 1.1.1.1 enable
#
 ipv6-family vpn-instance vpn1
  peer 2001:DB8:3::1 as-number 65410
#
ospf 1
 area 0.0.0.0
  network 10.20.1.0 0.0.0.3
  network 3.3.3.3 0.0.0.0
#
Return</pre>
</li><li><p>CE configuration file</p>
<pre class="screen">#
sysname CE
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ipv6 enable
 ipv6 address 2001:DB8:1::1/64
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ipv6 enable
 ipv6 address 2001:DB8:3::1/64
#
interface LoopBack1
 ipv6 enable
 ipv6 address 2001:DB8:2::1/128
#
bgp 65410
 router-id 10.10.10.10
 peer 2001:DB8:1::2 as-number 100
 peer 2001:DB8:3::2 as-number 100
 #
 ipv4-family unicast
  undo synchronization
 #
  ipv6-family unicast
   undo synchronization
   network 2001:DB8:0:1:2::1 128
   peer 2001:DB8:1::2 enable
   peer 2001:DB8:3::2 enable
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v6_cfg_2039.html">Configuration Examples for BGP/MPLS IPv6 VPN
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v6_cfg_2081.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v6_cfg_2030.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>