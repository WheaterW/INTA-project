
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring ATM Cell Relay in N-to-1 VCC Mode">
<meta name="abstract" content="If a large number of ATM services are transparently transmitted over a PSN, you can configure ATM cell relay in N-to-1 VCC mode. In this mode, an ATM physical link can be divided into multiple PVCs, with each PVC transmitting a single type of service. For example, you can create three PVCs to transmit audio, video, and data traffic, respectively.">
<meta name="description" content="If a large number of ATM services are transparently transmitted over a PSN, you can configure ATM cell relay in N-to-1 VCC mode. In this mode, an ATM physical link can be divided into multiple PVCs, with each PVC transmitting a single type of service. For example, you can create three PVCs to transmit audio, video, and data traffic, respectively.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpws_cfg_3012.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpws_cfg_6053.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpws_cfg_6011.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="VPWS">
<meta name="featuretype" content="VPN">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="VPWS">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="VPWS">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="VPWS">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="l00425560">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00415692">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172369975">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring ATM Cell Relay in N-to-1 VCC Mode</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172369975"></a><a name="EN-US_TASK_0172369975"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring ATM Cell Relay in N-to-1 VCC Mode</h1>
<div class="taskbody"><p>If a large number of ATM services are transparently transmitted over a PSN, you can configure ATM cell relay in N-to-1 VCC mode. In this mode, an ATM physical link can be divided into multiple PVCs, with each PVC transmitting a single type of service. For example, you can create three PVCs to transmit audio, video, and data traffic, respectively.</p>
<div class="context"><a name="EN-US_TASK_0172369975__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>This section does not apply to the M2K or M2K-B models.</p>
</div></div>
<p>On the network shown in <a href="#EN-US_TASK_0172369975__fig_dc_vrp_vpws_cfg_600901">Figure 1</a>, the NodeB connects to PE1 through two E1 links that are added to an IMA group, and four PVCs are configured on an IMA group sub-interface. The RNC connects to PE2 through E1 links that are also added to an IMA group, and four PVCs are configured on an IMA group sub-interface. A PW is established between PE1 and PE2 to transparently transmit ATM cells.</p>
<div class="fignone" id="EN-US_TASK_0172369975__fig_dc_vrp_vpws_cfg_600901"><a name="EN-US_TASK_0172369975__fig_dc_vrp_vpws_cfg_600901"></a><a name="fig_dc_vrp_vpws_cfg_600901"></a><span class="figcap"><b>Figure 1 </b>Configuring ATM cell relay in N-to-1 VCC mode</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><div class="p"><ul><li>In this example, interface1 and interface2 represent GE<span>0/1/0</span> and GE<span>0/2/0</span>, respectively.</li></ul>
</div>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_vpws_cfg_600901.png" width="NaN" height="NaN"></span><br><div class="tableBorder"><table cellpadding="4" cellspacing="0" summary=""><tr><td valign="top"><p>Router</p>
</td>
<td valign="top"><p>Interface</p>
</td>
<td valign="top"><p>IP Address</p>
</td>
</tr>
<tr><td valign="top"><p>PE1</p>
</td>
<td valign="top"><p>GE<span>0/1/0</span></p>
<p>Loopback0</p>
</td>
<td valign="top"><p>10.1.1.1/24</p>
<p>192.168.2.2/32</p>
</td>
</tr>
<tr><td valign="top"><p>P</p>
</td>
<td valign="top"><p>GE<span>0/1/0</span></p>
<p>GE<span>0/2/0</span></p>
<p>Loopback0</p>
</td>
<td valign="top"><p>10.1.1.2/24</p>
<p>10.2.1.1/24</p>
<p>192.168.4.4/32</p>
</td>
</tr>
<tr><td valign="top"><p>PE2</p>
</td>
<td valign="top"><p>GE<span>0/2/0</span></p>
<p>Loopback0</p>
</td>
<td valign="top"><p>10.2.1.2/24</p>
<p>192.168.3.3/32</p>
</td>
</tr>
</table></div>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172369975__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Run the IGP protocol on the backbone network so that devices can communicate with each other.</p>
</li><li><p>Configure basic MPLS functions on the backbone network, and configure MPLS L2VPN functions on PEs. Establish the remote MPLS LDP peer relationship between PEs at both ends of the PW.</p>
</li><li><p>Set parameters for the serial interface.</p>
</li><li><p>Configure the PW template.</p>
</li><li><p>Establish MPLS L2VC connections on PEs.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172369975__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li>L2VC IDs at both ends of the PW (must be the same)</li><li>MPLS LSR IDs of the PEs and P router</li><li>IP address of the remote peer of the PE</li><li>Coding mode and frame format of the E1/CE1 interface</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172369975__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Run the IGP protocol on the backbone network so that devices can communicate with each other. For detailed configurations, see Configuration Files.</span></li><li><span>Configure basic MPLS functions on the backbone network, and configure MPLS L2VPN functions on PEs. Then, establish the remote MPLS LDP peer relationship between PEs at both ends of the PW. For detailed configurations, see Configuration Files.</span><p><p>The remote MPLS LDP peer relationship is required only for the dynamic PW.</p>
</p></li><li><span>Set parameters for the serial interface on PE1 and then add the serial interface to the IMA group. Set parameters for the IMA interface on PE2.</span><p><ol type="a"><li><p>Configure PE1.</p>
<p># Configure the channelized mode and non-CRC4 frame format for E1 <span>0/2/1</span> and E1 <span>0/2/2</span> on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>controller e1 <span>0/2/1</span></strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-E1<span>0/2/1</span>] <strong>channel-set 1 timeslot-list 1-15</strong>
[<span class="keyword">*</span>PE1] <strong>controller e1 <span>0/2/2</span></strong>
[<span class="keyword">*</span>PE1-E1<span>0/2/2</span>] <strong>channel-set 1 timeslot-list 16-30</strong>
[<span class="keyword">*</span>PE1-E1<span>0/2/2</span>] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Create an IMA interface.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface ima-group <span>0/2/1</span></strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-Ima-group<span>0/2/1</span>] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Add the channelized serial interface to the IMA group.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface serial<span>0/2/1</span>:1</strong>
[<span class="keyword">*</span>PE1-Serial<span>0/2/1</span>:1] <strong>link-protocol atm</strong>
[<span class="keyword">*</span>PE1-Serial<span>0/2/1</span>:1] <strong>ima ima-group <span>0/2/1</span></strong>
[<span class="keyword">*</span>PE1-Serial<span>0/2/1</span>:1] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>interface serial<span>0/2/2</span>:1</strong>
[<span class="keyword">*</span>PE1-Serial<span>0/2/2</span>:1] <strong>link-protocol atm</strong>
[<span class="keyword">*</span>PE1-Serial<span>0/2/2</span>:1] <strong>ima ima-group <span>0/2/1</span></strong>
[<span class="keyword">*</span>PE1-Serial<span>0/2/2</span>:1] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</li><li><p>Configure PE2.</p>
<p># Configure the channelized mode and non-CRC4 frame format for E1 <span>0/2/1</span> on PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>controller e1 <span>0/2/1</span></strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-E1<span>0/2/1</span>] <strong>channel-set 1 timeslot-list 1-15</strong>
[<span class="keyword">*</span>PE2-E1<span>0/2/1</span>] <strong>quit</strong>
[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Create an IMA interface.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>interface ima-group <span>0/2/1</span></strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-Ima-group<span>0/2/1</span>] <strong>quit</strong>
[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Add the channelized serial interface to the IMA group.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>interface serial<span>0/2/1</span>:1</strong>
[<span class="keyword">*</span>PE2-Serial<span>0/2/1</span>:1] <strong>link-protocol atm</strong>
[<span class="keyword">*</span>PE2-Serial<span>0/2/1</span>:1] <strong>ima ima-group <span>0/2/1</span></strong>
[<span class="keyword">*</span>PE2-Serial<span>0/2/1</span>:1] <strong>quit</strong>
[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</li></ol>
</p></li><li><span>Configure the PW and configure N-to-1 VCC transparent transmission of ATM cells.</span><p><ol type="a"><li><p>Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>pw-template 1to3</strong>
[<span class="keyword">*</span>PE1-pw-template-1to3] <strong>peer-address 192.168.3.3</strong>
[<span class="keyword">*</span>PE1-pw-template-1to3] <strong>atm-pack-overtime 1000</strong>
[<span class="keyword">*</span>PE1-pw-template-1to3] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>interface ima-group <span>0/2/1</span>.1</strong>
[<span class="keyword">*</span>PE1-Ima-group<span>0/2/1</span>.1] <strong>pvc 1/100</strong>
[<span class="keyword">*</span>PE1-Ima-group<span>0/2/1</span>.1-1/100] <strong>quit</strong>
[<span class="keyword">*</span>PE1-Ima-group<span>0/2/1</span>.1] <strong>pvc 1/200</strong>
[<span class="keyword">*</span>PE1-Ima-group<span>0/2/1</span>.1-1/200] <strong>quit</strong>
[<span class="keyword">*</span>PE1-Ima-group<span>0/2/1</span>.1] <strong>pvc 1/300</strong>
[<span class="keyword">*</span>PE1-Ima-group<span>0/2/1</span>.1-1/300] <strong>quit</strong>
[<span class="keyword">*</span>PE1-Ima-group<span>0/2/1</span>.1] <strong>pvc 1/400</strong>
[<span class="keyword">*</span>PE1-Ima-group<span>0/2/1</span>.1-1/400] <strong>quit</strong>
[<span class="keyword">*</span>PE1-Ima-group<span>0/2/1</span>.1] <strong>mpls l2vc pw-template 1to3 100</strong>
[<span class="keyword">*</span>PE1-Ima-group<span>0/2/1</span>.1] <strong>undo shutdown</strong>
[<span class="keyword">*</span>PE1-Ima-group<span>0/2/1</span>.1] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</li><li><p>Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>pw-template 3to1</strong>
[<span class="keyword">*</span>PE2-pw-template-3to1] <strong>peer-address 192.168.2.2</strong>
[<span class="keyword">*</span>PE2-pw-template-3to1] <strong>quit</strong>
[<span class="keyword">*</span>PE2] <strong>interface ima-group <span>0/2/1</span>.1</strong>
[<span class="keyword">*</span>PE2-Ima-group<span>0/2/1</span>.1] <strong>pvc 1/100</strong>
[<span class="keyword">*</span>PE2-Ima-group<span>0/2/1</span>.1-1/100] <strong>quit</strong>
[<span class="keyword">*</span>PE2-Ima-group<span>0/2/1</span>.1] <strong>pvc 1/200</strong>
[<span class="keyword">*</span>PE2-Ima-group<span>0/2/1</span>.1-1/200] <strong>quit</strong>
[<span class="keyword">*</span>PE2-Ima-group<span>0/2/1</span>.1] <strong>pvc 1/300</strong>
[<span class="keyword">*</span>PE2-Ima-group<span>0/2/1</span>.1-1/300] <strong>quit</strong>
[<span class="keyword">*</span>PE2-Ima-group<span>0/2/1</span>.1] <strong>pvc 1/400</strong>
[<span class="keyword">*</span>PE2-Ima-group<span>0/2/1</span>.1-1/400] <strong>quit</strong>
[<span class="keyword">*</span>PE2-Ima-group<span>0/2/1</span>.1] <strong>mpls l2vc pw-template 3to1 100</strong>
[<span class="keyword">*</span>PE2-Ima-group<span>0/2/1</span>.1] <strong>undo shutdown</strong>
[<span class="keyword">*</span>PE2-Ima-group<span>0/2/1</span>.1] <strong>quit</strong>
[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</li></ol>
</p></li><li><span>Verify the configuration.</span><p><p>Run the <strong>display mpls l2vc</strong> command on PEs to check PW status. The command output shows that the status is up.</p>
<p># The display on PE1 is as follows:</p>
<pre class="screen">&lt;PE1&gt; <strong>display mpls l2vc interface ima-group <span>0/2/1</span>.1</strong>
*client interface       : Ima-group <span>0/2/1</span>.1 is up
  session state          : <strong>up</strong>
  AC status               : <strong>up</strong>
  VC state               : <strong>up</strong>
  VC ID                  : 4
  VC type                : ATM Nto1 VCC
  destination            : 192.168.3.3
  local group ID         : 0            remote group ID      : 0
  local VC label         : 146439       remote VC label      : 21504
  max ATM cells          : 28
  ATM pack overtime      : 1000
  seq-number             : disable
  local AC OAM State     : up
  local PSN State        : up
  local forwarding state : not forwarding
  local status code      : 0x0
  remote AC OAM state    : up
  remote PSN state       : up
  remote forwarding state: forwarding
  remote statuscode      : 0x0
  BFD for PW             : unavailable
  manual fault           : not set
  active state           : active
  forwarding entry       : not exist
  link state             : down
  local VC MTU           : 1500
  remote VC MTU        : 0
  local VCCV             : cw alert ttl lsp-ping bfd
  remote VCCV            : none
  local control word     : enable
  remote control word    : none
  tunnel policy name     : --
  traffic behavior name  : --
  PW template name       : --
  primary or secondary   : primary
  VC tunnel/token info   : 1 tunnels/tokens
  NO.0 TNL type : lsp , TNL ID : 0x208000
  create time            : 0 days, 0 hours, 0 minutes, 16 seconds
  up time                : 0 days, 0 hours, 0 minutes, 0 seconds
  last change time       : 0 days, 0 hours, 0 minutes, 16 seconds
  VC last up time        : 0000/00/00 00:00:00
  VC total up time       : 0 days, 0 hours, 0 minutes, 0 seconds
  CKey                   : 11
  NKey                   : 10  
  PW redundancy mode     : frr
  AdminPw interface      : --
  AdminPw link state     : --
<span>  Forward state          : send inactive, receive inactive </span>
  Diffserv Mode          : uniform
  Service Class          : --
  Color                  : --
  DomainId               : --
  Domain Name            : --

</pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172369975__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>PE1 configuration file</p>
<pre class="screen">#
sysname PE1
#
mpls lsr-id 192.168.2.2
#
mpls
#
mpls l2vpn
#
pw-template 1to3
 peer-address 192.168.3.3
 atm-pack-overtime 1000
#
mpls ldp
#
mpls ldp remote-peer 192.168.3.3
 remote-ip 192.168.3.3 
#
controller e1 <span>0/2/1</span>
using ce1
code ami
channel-set 1 timeslot-list 1-15
undo shutdown
#
interface serial<span>0/2/1</span>:1
link-protocol atm
ima ima-group <span>0/2/1</span>
undo shutdown
#
controller e1 <span>0/2/2</span>
using ce1
code ami
channel-set 1 timeslot-list 16-30
undo shutdown
#
interface serial<span>0/2/2</span>:1
link-protocol atm
ima ima-group <span>0/2/1</span>
undo shutdown
#
interface ima-group <span>0/2/1</span>
 undo shutdown
#
interface ima-group <span>0/2/1</span>.1
 pvc 1/100
 pvc 1/200
 pvc 1/300
 pvc 1/400
 mpls l2vc pw-template 1to3 100
 undo shutdown
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.1.1 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack0
 ip address 192.168.2.2 255.255.255.255
#
ospf 1
area 0.0.0.0
  network 192.168.2.2 0.0.0.0
  network 10.1.1.0 0.0.0.255
#
return
</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#
sysname PE2
#
mpls lsr-id 192.168.3.3
#
mpls
#
mpls l2vpn
#
pw-template 3to1
 peer-address 192.168.2.2
 atm-pack-overtime 1000
#
mpls ldp
#
mpls ldp remote-peer 192.168.2.2
 remote-ip 192.168.2.2
#
controller e1 <span>0/2/1</span>
using ce1
channel-set 1 timeslot-list 1-15
undo shutdown
#
interface serial<span>0/2/1</span>:1
link-protocol atm
ima ima-group <span>0/2/1</span>
undo shutdown
#
interface ima-group <span>0/2/1</span>
 undo shutdown
#
interface ima-group <span>0/2/1</span>.1
 pvc 1/100
 pvc 1/200
 pvc 1/300
 pvc 1/400
 mpls l2vc pw-template 3to1 100
 undo shutdown
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.2.2.2 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack0
 ip address 192.168.3.3 255.255.255.255
#
ospf 1
 area 0.0.0.0
  network 192.168.3.3 0.0.0.0
network 10.2.2.0 0.0.0.255
#
return
</pre>
</li><li><p>P configuration file</p>
<pre class="screen">#
sysname P
#
mpls lsr-id 192.168.4.4
#
mpls
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.1.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.2.2.1 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack0
 ip address 192.168.4.4 255.255.255.255
#
ospf 1
 area 0.0.0.0
  network 192.168.4.4 0.0.0.0
  network 10.1.1.0 0.0.0.255
  network 10.2.2.0 0.0.0.255
#
return
</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpws_cfg_3012.html">Configuration Examples for VPWS
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpws_cfg_6053.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpws_cfg_6011.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>