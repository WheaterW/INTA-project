
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Setting a Delay in Releasing an Obtained Label in a BGP EVPN FRR Switchover Scenario">
<meta name="abstract" content="After you set a delay in releasing an obtained label in a BGP EVPN FRR switchover scenario, you can prevent second-time packet loss.">
<meta name="description" content="After you set a delay in releasing an obtained label in a BGP EVPN FRR switchover scenario, you can prevent second-time packet loss.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0000.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0016.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_dampening.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="l00425560">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00878323">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0183675446">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Setting a Delay in Releasing an Obtained Label in a BGP EVPN FRR Switchover Scenario</title>
</head>
<body><a name="EN-US_TASK_0183675446"></a><a name="EN-US_TASK_0183675446"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Setting a Delay in Releasing an Obtained Label in a BGP EVPN FRR Switchover Scenario</h1>
<div class="taskbody"><p>After you set a delay in releasing an obtained label in a BGP EVPN FRR switchover scenario, you can prevent second-time packet loss.</p>
<div class="context"><a name="EN-US_TASK_0183675446__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Usage Scenario</h4><p>As shown in <a href="#EN-US_TASK_0183675446__fig1499024145414">Figure 1</a>, DeviceA and DeviceD belong to AS100, and DeviceB, DeviceC, DeviceE, and DeviceF belong to AS200 in a BGP EVPN FRR switchover scenario. DeviceB selects the optimal route that is learned from the EBGP EVPN peer DeviceA and the sub-optimal route that is learned from the IBGP EVPN peer DeviceE. In normal situations, DeviceB preferentially selects a labeled BGP route learned from EBGP EVPN peer DeviceA and advertises the route to the IBGP EVPN peer DeviceC. DeviceB delivers an incoming label map (ILM) entry and next hop label forwarding entry (NHLFE), and DeviceC also delivers an NHLFE entry. If DeviceA is restarted due to a fault, DeviceB withdraws the route learned from DeviceA, selects the sub-optimal route learned from IBGP EVPN peer DeviceE, and reflects the route to DeviceC through the RR. Then, DeviceB releases the applied label and deletes the ILM entry mapped to the label. If traffic arrives at DeviceC before DeviceC updates the NHLFE entry, DeviceC still uses this entry to forward traffic to DeviceB. Because DeviceB has released the label and deleted the ILM entry, packets are lost for the second time.</p>
<div class="fignone" id="EN-US_TASK_0183675446__fig1499024145414"><a name="EN-US_TASK_0183675446__fig1499024145414"></a><a name="fig1499024145414"></a><span class="figcap"><b>Figure 1 </b>Networking for packet loss during a BGP EVPN FRR switchover</span><br><span><img class="vsd" src="figure/en-us_image_0000001184881798.png" width="NaN" height="NaN"></span><br></div>
<p>To prevent traffic loss during a BGP EVPN FRR switchover, configure the local device to delay deleting the ILM entry.</p>
</div></div>
<div class="context"><a name="EN-US_TASK_0183675446__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Pre-configuration Tasks</h4><p>Before setting a delay in releasing an obtained label in a BGP EVPN FRR switchover scenario, complete the following tasks:</p>
<ul><li><p><a href="dc_vrp_evpn_cfg_0003.html">Configure EVPN VPLS over MPLS (common EVPN instance)</a> or <a href="dc_vrp_evpn_cfg_0065.html">EVPN VPLS over MPLS (BD EVPN instance)</a>.</p>
</li><li><p><a href="dc_vrp_bgp_cfg_4057.html">Configure BGP auto FRR</a> in the BGP-EVPN address family view.</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0183675446__1.4.3"></a><a name="1.4.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span><p><p>The BGP view is displayed.</p>
</p></li><li><span>Run <strong>l2vpn-family evpn</strong></span><p><p>The BGP-EVPN address family view is displayed.</p>
</p></li><li><span>Run <a href="cmdqueryname=label-free+delay"><b><span class="cmdname">label-free delay</span></b></a> <i><span class="varname">delay-value</span></i></span><p><p>A delay for releasing obtained labels is set.</p>
</p></li><li><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol></div>
<div class="postreq"><a name="EN-US_TASK_0183675446__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p>After completing the configuration, verify the configuration.</p>
<p>Run the <a href="cmdqueryname=display+current-configuration"><b><span class="cmdname">display current-configuration</span></b></a> command to check the current configuration.</p>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0000.html">EVPN Configuration
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0016.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_dampening.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>