
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring NHRP">
<meta name="abstract" content="Configure the Next Hop Resolution Protocol (NHRP) so that spokes can obtain the peer IP address of each other by exchanging NHRP Resolution Request and Reply packets.">
<meta name="description" content="Configure the Next Hop Resolution Protocol (NHRP) so that spokes can obtain the peer IP address of each other by exchanging NHRP Resolution Request and Reply packets.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_cfg_dsvpn_0021.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_cfg_dsvpn_0007.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_cfg_dsvpn_0009.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="dsvpn,w00800033,w00556928,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="DSVPN">
<meta name="featuretype" content="VPN">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="DSVPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="DSVPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="DSVPN">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="l00415692">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00415692">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172369150">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring NHRP</title>
</head>
<body><a name="EN-US_TASK_0172369150"></a><a name="EN-US_TASK_0172369150"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring NHRP</h1>
<div class="taskbody"><p>Configure the Next Hop Resolution Protocol (NHRP) so that spokes can obtain the peer IP address of each other by exchanging NHRP Resolution Request and Reply packets.</p>
<div class="context"><a name="EN-US_TASK_0172369150__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>In DSVPN, NHRP enables a source spoke on a public network to dynamically obtain the public IP address of a destination spoke. When a spoke connects to the public network, it sends NHRP Registration Request packets to the hub using the public address of the outbound interface as the source address. The hub creates or updates NHRP peer entries based on the packets received. Spokes also exchange NHRP Resolution Request and Reply packets to create or update NHRP peer entries.</p>
<p>Perform the following configurations on the hub and spokes.</p>
</div></div>
<div class="steps-unordered"><a name="EN-US_TASK_0172369150__1.4.2"></a><a name="1.4.2"></a><h4 class="sectiontitle">Procedure</h4>
<ul><li><span>Configure the hub.</span><ol><li class="substepexpand"><span>Run <span><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=nhrp+enable"><b><span class="cmdname">nhrp enable</span></b></a></span></span><p><p>NHRP is enabled globally.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=interface+tunnel"><b><span class="cmdname">interface tunnel</span></b></a> <i><span class="varname">interface-number</span></i></span></span><p><p>The tunnel interface view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=nhrp+enable"><b><span class="cmdname">nhrp enable</span></b></a></span><p><p>NHRP is enabled on the interface.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <span><a href="cmdqueryname=nhrp+network-id"><b><span class="cmdname">nhrp network-id</span></b></a> <i><span class="varname">netId</span></i></span></span><p><p>An NHRP domain is configured for the interface.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=nhrp+entry+multicast+dynamic"><b><span class="cmdname">nhrp entry multicast dynamic</span></b></a></span></span><p><p>Dynamically registered spokes are added to the NHRP multicast member table.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=nhrp+authentication"><b><span class="cmdname">nhrp authentication</span></b></a> [ <strong><span>hash</span></strong> { <strong><span>sha2-256</span></strong> | <strong><span>sha2-384</span></strong> | <strong><span>sha2-512</span></strong> } ] <strong><span>cipher</span></strong> <i><span class="varname">authenString</span></i></span><p><p>An authentication string is configured for NHRP negotiation.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=nhrp+entry+holdtime"><b><span class="cmdname">nhrp entry holdtime</span></b></a> <i><span class="varname">holdtime</span></i></span><p><p>The hold time of NHRP mapping entries is set.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=nhrp+redirect"><b><span class="cmdname">nhrp redirect</span></b></a></span><p><p>The NHRP redirect function is enabled.</p>
</p><p><p>This command is configured only when DSVPN uses the shortcut mode. When forwarding traffic from spokes of the same DSVPN, the hub sends an NHRP Redirect packet to the source spoke, triggering the source spoke to send NHRP Resolution Request packets and establish tunnels for spokes to directly communicate with each other. </p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li><span>Configure spokes.</span><ol><li class="substepexpand"><span>Run <span><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=nhrp+enable"><b><span class="cmdname">nhrp enable</span></b></a></span></span><p><p>NHRP is enabled globally.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=interface+tunnel"><b><span class="cmdname">interface tunnel</span></b></a> <i><span class="varname">interface-number</span></i></span></span><p><p>The tunnel interface view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=nhrp+enable"><b><span class="cmdname">nhrp enable</span></b></a></span></span><p><p>NHRP is enabled on the interface.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <span><a href="cmdqueryname=nhrp+network-id"><b><span class="cmdname">nhrp network-id</span></b></a> <i><span class="varname">netId</span></i></span></span><p><p>An NHRP domain is configured for the interface.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <span><a href="cmdqueryname=nhrp+shortcut"><b><span class="cmdname">nhrp shortcut</span></b></a></span></span><p><p>The NHRP shortcut function is enabled. This step is mandatory in DSVPN shortcut scenarios.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=nhrp+entry+multicast"><b><span class="cmdname">nhrp entry multicast</span></b></a> <strong><span>dynamic</span></strong></span><p><p>Dynamically registered spokes are added to the NHRP multicast member table.</p>
</p></li><li class="substepexpand"><span>Run <strong><a href="cmdqueryname=nhrp+entry"><b><span class="cmdname">nhrp entry</span></b></a> </strong><i><span class="varname">protocol-address</span></i><em> </em><i><span class="varname">nbma-address</span></i> [ <strong><span>register</span></strong> ]</span><p><p>An NHRP mapping entry is configured.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=nhrp+registration+no-unique"><b><span class="cmdname">nhrp registration no-unique</span></b></a></span><p><p>The device is enabled to send NHRP packets with the no-unique flag to instruct the remote device to use new NHRP mapping entries to overwrite conflicting NHRP peer entries during NHRP registration.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=nhrp+authentication"><b><span class="cmdname">nhrp authentication</span></b></a> [ <strong><span>hash</span></strong> { <strong><span>sha2-256</span></strong> | <strong><span>sha2-384</span></strong> | <strong><span>sha2-512</span></strong> } ] <strong><span>cipher</span></strong> <i><span class="varname">authenString</span></i></span><p><p>An authentication string is configured for NHRP negotiation.</p>
</p><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>If this configuration is performed on the hub, it must also be performed on the spokes.</p>
<p>For security purposes, it is recommended that the authentication string contain at least 6 characters, including at least two types of the following: lowercase letters, uppercase letters, digits, and special characters.</p>
</div></div>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=nhrp+registration+interval"><b><span class="cmdname">nhrp registration interval</span></b></a> <i><span class="varname">regInterval</span></i></span><p><p>The NHRP registration interval is set.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=nhrp+entry+holdtime"><b><span class="cmdname">nhrp entry holdtime</span></b></a> <i><span class="varname">holdtime</span></i></span><p><p>The hold time of NHRP mapping entries is set.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li></ul></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_cfg_dsvpn_0021.html">Configuring DSVPN
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_cfg_dsvpn_0007.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_cfg_dsvpn_0009.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>