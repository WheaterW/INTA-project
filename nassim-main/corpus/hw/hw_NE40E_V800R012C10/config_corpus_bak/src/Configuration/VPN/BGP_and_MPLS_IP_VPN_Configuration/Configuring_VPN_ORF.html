
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring VPN ORF">
<meta name="abstract" content="After BGP peer relationships are established in the BGP-VPN-target address family, VPN ORF filters the routes to be advertised to PEs based on the VPN target of each VPN instance bound to each PE.">
<meta name="description" content="After BGP peer relationships are established in the BGP-VPN-target address family, VPN ORF filters the routes to be advertised to PEs based on the VPN target of each VPN instance bound to each PE.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0000.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_2023.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_2017.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,l3vpnvrp,w00556928,l00468467,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="h00847023">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="h00847023">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172369419">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring VPN ORF</title>
</head>
<body><a name="EN-US_TASK_0172369419"></a><a name="EN-US_TASK_0172369419"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring VPN ORF</h1>
<div class="taskbody"><p>After BGP peer relationships are established in the BGP-VPN-target address family, VPN ORF filters the routes to be advertised to PEs based on the VPN target of each VPN instance bound to each PE.</p>
<div class="context"><a name="EN-US_TASK_0172369419__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Usage Scenario</h4><p>As a network increases in size and complexity, PEs receive larger numbers of routes. To enable PEs to receive only desired routes, thereby reducing pressure on the PEs, intra-AS RR, and ASBR, configure VPN ORF. After VPN ORF is configured, a device filters the routes to be advertised to a peer device based on the VPN targets of the VPN instance bound to the peer device.</p>
<p>The following uses the intra-AS RR scenario as an example to describe VPN ORF. On the network shown in <a href="#EN-US_TASK_0172369419__fig_dc_vrp_mpls-l3vpn-v4_cfg_204501">Figure 1</a>, before VPN ORF is enabled, the RR advertises all the VPN routes received from the VPN instances on PE1 to PE2. However, only the ERT 1:1 in these routes matches the IRT 1:1 of PE2. Similarly, the RR also advertises all the VPN routes received from the VPN instances on PE2 to PE1, and only the ERT 1:1 in these routes matches the IRT 1:1 of PE1. In this case, PE1 and PE2 both receive many unwanted routes. To prevent this issue, you can establish VPN ORF route-based peer relationships between the RR and PE1 and between the RR and PE2 in the BGP-VPN-target address family. The VPN ORF route-based peers negotiate the VPN ORF capability. Then, PE1 and PE2 send VPN ORF routes to their peer (the RR). These VPN ORF routes carry the IRTs of the expected routes and original AS numbers. Based on the received routes, the RR constructs an export policy. The RR learns the routes matching IRTs 1:1 and 2:2 from PE1 and the routes matching IRTs 1:1 and 3:3 from PE2. The RR advertises only the routes with ERT 1:1 to PE1 and PE2.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The implementation in an ASBR scenario is similar to that in an intra-AS RR scenario.</p>
</div></div>
<div class="fignone" id="EN-US_TASK_0172369419__fig_dc_vrp_mpls-l3vpn-v4_cfg_204501"><a name="EN-US_TASK_0172369419__fig_dc_vrp_mpls-l3vpn-v4_cfg_204501"></a><a name="fig_dc_vrp_mpls-l3vpn-v4_cfg_204501"></a><span class="figcap"><b>Figure 1 </b>Networking for VPN ORF</span><br><span><img class="vsd" src="images/fig_dc_vrp_mpls-l3vpn-v4_cfg_204501.png"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172369419__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Pre-configuration Tasks</h4><p>Before configuring VPN ORF, complete the following tasks:</p>
<ul><li><p><a href="dc_vrp_bgp_cfg_3004.html">Configure basic BGP functions</a>.</p>
</li><li><p><a href="dc_vrp_mpls-l3vpn-v4_cfg_0154.html">Configure a basic BGP/MPLS IP VPN</a> and establish VPNv4 connections.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>By default, VPN ORF is enabled for VPNv4 and VPNv6 after the BGP-VPN-target address family is configured. To disable VPN ORF, run the <a href="cmdqueryname=vpn-orf+disable"><b><span class="cmdname">vpn-orf disable</span></b></a> command.</p>
</div></div>
</li></ul>
</div></div>
<div class="steps-unordered"><a name="EN-US_TASK_0172369419__1.4.3"></a><a name="1.4.3"></a><h4 class="sectiontitle">Procedure</h4>
<ul><li><span>Perform the following steps on the PE:</span><ol><li><span>Run the <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a> command to enter the system view.</span></li><li><span>Run the <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i> command to enter the BGP view.</span></li><li><span>Run the <a href="cmdqueryname=ipv4-family"><b><span class="cmdname">ipv4-family</span></b></a> <strong><span>vpn-target</span></strong> command to enter the BGP-VPN-target address family view.</span></li><li><span>Run the <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">peeripv4addr</span></i> |<i><span class="varname"> peeripv6addr</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>enable</span></strong> command to establish a VPN ORF peer relationship and enable the device to exchange VPN ORF routing information with the specified peer or peer group.</span></li><li><span>(Optional) Run the <a href="cmdqueryname=timer+wait-for-eor"><b><span class="cmdname">timer wait-for-eor</span></b></a> <i><span class="varname">eor-time</span></i> command to configure the maximum period during which the BGP-VPN-target address family waits for the End-Of-RIB flag.</span></li><li><span>Run the <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a> command to commit the configuration.</span></li></ol>
</li><li><span>Perform the following steps on the RR:</span><ol><li class="substepexpand"><span>Run the <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a> command to enter the system view.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i> command to enter the BGP view.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=ipv4-family"><b><span class="cmdname">ipv4-family</span></b></a> <strong><span>vpn-target</span></strong> command to enter the BGP-VPN-target address family view.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">peeripv4addr</span></i> |<i><span class="varname"> peeripv6addr</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>enable</span></strong> command to establish a VPN ORF peer relationship and enable the device to exchange VPN ORF routing information with the specified peer or peer group.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">group-name</span></i> | <i><span class="varname">ipv4-address</span></i> } <strong><span>reflect-client</span></strong> command to configure the local device as an RR and the specified peer or peer group as an RR client.</span></li><li class="substepexpand"><span>(Optional) Run the <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> |<i><span class="varname"> ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>allow-cluster-loop</span></strong> [ <i><span class="varname">loop-number</span></i> ] command to set the maximum number of times the local cluster ID can be included in the Cluster_List of each received route.</span></li><li class="substepexpand"><span>(Optional) Run the <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <a href="cmdqueryname=default-route-advertise"><b><span class="cmdname">default-route-advertise</span></b></a> command to configure the device to advertise default VPN ORF routes to the specified peer or peer group.</span><p><p>If a device that does not support VPN ORF exists on the network, you can configure the RR to advertise the default VPN ORF route to the peer or peer group in the BGP-VPN-target address family view so that the RR can establish a VPN ORF route-based peer relationship with the specified peer or peer group. On the network shown in <a href="#EN-US_TASK_0172369419__fig_dc_vrp_mpls-l3vpn-v4_cfg_204501">Figure 1</a>, if PE2 does not support VPN ORF, run this command to enable the RR to send the default VPN ORF route to PE1. PE1 then sends all its local VPN routes to the RR. As a result, PE1 receives routes with the VPN target 1:1, and PE2 receives routes with the VPN targets 1:1 and 2:2.</p>
</p></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a> command to commit the configuration.</span></li></ol>
</li><li><span>Perform the following steps on the ASBR:</span><ol><li class="substepexpand"><span>Run the <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a> command to enter the system view.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i> command to enter the BGP view.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=ipv4-family"><b><span class="cmdname">ipv4-family</span></b></a> <strong><span>vpn-target</span></strong> command to enter the BGP-VPN-target address family view.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">peeripv4addr</span></i> |<i><span class="varname"> peeripv6addr</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>enable</span></strong> command to establish a VPN ORF peer relationship and enable the device to exchange VPN ORF routing information with the specified peer or peer group.</span></li><li class="substepexpand"><span>(Optional) Run the <a href="cmdqueryname=external-path"><b><span class="cmdname">external-path</span></b></a> <i><span class="varname">path-number</span></i> command to set the maximum number of EBGP peers in the VPN-target address family.</span><p><p>By default, after a BGP device receives VPN ORF routes with the same prefix from different peers, it selects one of these routes as the preferred route and advertises only VPN routes that match VPN ORF to the peer from which the preferred route is received. As a result, FRR and load balancing cannot be implemented. To enable FRR and load balancing between ASBRs, run this command to set the maximum number of EBGP peers allowed in the VPN-target address family.</p>
</p></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a> command to commit the configuration.</span></li></ol>
</li></ul></div>
<div class="example"><a name="EN-US_TASK_0172369419__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p>After enabling VPN ORF, run the <a href="cmdqueryname=display+bgp+vpn-target+routing-table"><b><span class="cmdname">display bgp vpn-target routing-table</span></b></a> command to check route information in the BGP-VPN-target address family.</p>
<p>Run the <a href="cmdqueryname=display+bgp+vpnv4+routing-table"><b><span class="cmdname">display bgp vpnv4 routing-table</span></b></a> command to check information about BGP VPNv4 routes and BGP VPN routes.</p>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0000.html">BGP/MPLS IP VPN Configuration
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_2023.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_2017.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>