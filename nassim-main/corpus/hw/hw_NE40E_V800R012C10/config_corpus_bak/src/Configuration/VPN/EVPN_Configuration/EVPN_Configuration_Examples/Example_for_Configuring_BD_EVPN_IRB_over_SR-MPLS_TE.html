
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring BD EVPN IRB over SR-MPLS TE">
<meta name="abstract" content="This section provides an example for configuring BD EVPN IRB over SR-MPLS TE to transmit services.">
<meta name="description" content="This section provides an example for configuring BD EVPN IRB over SR-MPLS TE to transmit services.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0010.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_vpls_evpn-over-srv6_exp2.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0127.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="p00915595,w00800033,w00556928,l00468467,w00606909,evpnvrp,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="p00915595">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00878323">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172370670">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/thickbox.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/imageResize.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery-migrate-1.2.1.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery-ui.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery.mousewheel.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/thickbox.js"></script>
<title>Example for Configuring BD EVPN IRB over SR-MPLS TE</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172370670"></a><a name="EN-US_TASK_0172370670"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring BD EVPN IRB over SR-MPLS TE</h1>
<div class="taskbody" id="taskbody2046782882214056"><p id="shortdesc1061054481214056">This section provides an example for configuring BD EVPN IRB over SR-MPLS TE to transmit services.</p>
<div class="context"><a name="EN-US_TASK_0172370670__1.4.1"></a><a name="1.4.1"></a>
<div class="p" id="EN-US_TASK_0172370670__context231016047214056"><h4 class="sectiontitle">Networking Requirements</h4><p id="EN-US_TASK_0172370670__p1343590193214056">On the network shown in <a href="#EN-US_TASK_0172370670__fig117545811214">Figure 1</a>, to allow different sites to communicate over the backbone network, configure EVPN and VPN to transmit Layer 2 and Layer 3 services. If sites belong to the same subnet, create an EVPN instance on each PE to store EVPN routes and implement Layer 2 forwarding based on MAC addresses. If sites belong to different subnets, create a VPN instance on each PE to store VPN routes. In this situation, Layer 2 traffic is terminated, and Layer 3 traffic is forwarded through a Layer 3 gateway. In this example, an SR-MPLS TE tunnel needs to be used to transmit services between the PEs.</p>
<div class="fignone" id="EN-US_TASK_0172370670__fig117545811214"><a name="EN-US_TASK_0172370670__fig117545811214"></a><a name="fig117545811214"></a><span class="figcap"><b>Figure 1 </b>Configuring BD EVPN IRB over SR-MPLS TE</span><div class="note" id="EN-US_TASK_0172370670__note7831183437"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0172370670__p8831103533">interface1, interface2, and sub-interface1.1 in this example represent GigabitEthernet<span>0/1/0</span>, GigabitEthernet<span>0/2/0</span>, and GigabitEthernet<span>0/1/0</span>.1, respectively.</p>
</div></div>
<br><span><img class="imgResize" id="EN-US_TASK_0172370670__image48951461621" src="figure/en-us_image_0000001182556270.png" width="523.6875" height="350.735364" title="Click to enlarge"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172370670__1.4.2"></a><a name="1.4.2"></a>
<div class="p" id="EN-US_TASK_0172370670__context536772446214056"><h4 class="sectiontitle">Configuration Precautions</h4><p id="EN-US_TASK_0172370670__p11265859214056">During the configuration process, note the following:</p>
<ul id="EN-US_TASK_0172370670__ul374505649214056"><li id="EN-US_TASK_0172370670__li1538845933214056"><p id="EN-US_TASK_0172370670__p1238035110214056"><a name="EN-US_TASK_0172370670__li1538845933214056"></a><a name="li1538845933214056"></a>For the same EVPN instance, the export VPN target list of one site shares VPN targets with the import VPN target lists of the other sites. Conversely, the import VPN target list of one site shares VPN targets with the export VPN target lists of the other sites.</p>
</li><li id="EN-US_TASK_0172370670__li387220084214056"><p id="EN-US_TASK_0172370670__p1132501378214056"><a name="EN-US_TASK_0172370670__li387220084214056"></a><a name="li387220084214056"></a>Using each PE's local loopback interface address as its EVPN source address is recommended.</p>
</li></ul>
</div></div>
<div class="context"><a name="EN-US_TASK_0172370670__1.4.3"></a><a name="1.4.3"></a>
<div class="p" id="EN-US_TASK_0172370670__context908789542214056"><h4 class="sectiontitle">Configuration Roadmap</h4><p id="EN-US_TASK_0172370670__p1482594108214056">The configuration roadmap is as follows:</p>
<ol id="EN-US_TASK_0172370670__ol1461170489214056"><li id="EN-US_TASK_0172370670__li479165063214056"><p id="EN-US_TASK_0172370670__p263537591214056"><a name="EN-US_TASK_0172370670__li479165063214056"></a><a name="li479165063214056"></a>Configure an IGP for PE1, PE2, and the P to communicate.</p>
</li><li id="EN-US_TASK_0172370670__li768923461214056"><p id="EN-US_TASK_0172370670__p1887505028214056"><a name="EN-US_TASK_0172370670__li768923461214056"></a><a name="li768923461214056"></a>Configure an SR-MPLS TE tunnel on the backbone network.</p>
</li><li id="EN-US_TASK_0172370670__li1775292976214056"><p id="EN-US_TASK_0172370670__p211256214214056"><a name="EN-US_TASK_0172370670__li1775292976214056"></a><a name="li1775292976214056"></a>Configure an EVPN instance and a VPN instance on each PE.</p>
</li><li id="EN-US_TASK_0172370670__li1385498229214056"><p id="EN-US_TASK_0172370670__p903550382214056"><a name="EN-US_TASK_0172370670__li1385498229214056"></a><a name="li1385498229214056"></a>Configure a source address on each PE.</p>
</li><li id="EN-US_TASK_0172370670__li1096409267214056"><p id="EN-US_TASK_0172370670__p1940859209214056"><a name="EN-US_TASK_0172370670__li1096409267214056"></a><a name="li1096409267214056"></a>Configure Layer 2 Ethernet sub-interfaces used by PEs to connect to CEs.</p>
</li><li id="EN-US_TASK_0172370670__li2043636348214056"><p id="EN-US_TASK_0172370670__p542650718214056"><a name="EN-US_TASK_0172370670__li2043636348214056"></a><a name="li2043636348214056"></a>Bind the VBDIF interface to a VPN instance on each PE.</p>
</li><li id="EN-US_TASK_0172370670__li1318031224214056"><p id="EN-US_TASK_0172370670__p856962963214056"><a name="EN-US_TASK_0172370670__li1318031224214056"></a><a name="li1318031224214056"></a>Configure and apply a tunnel policy to enable EVPN service recursion to the SR-MPLS TE tunnel.</p>
</li><li id="EN-US_TASK_0172370670__li1646744874214056"><p id="EN-US_TASK_0172370670__p71854782214056"><a name="EN-US_TASK_0172370670__li1646744874214056"></a><a name="li1646744874214056"></a>Establish a BGP EVPN peer relationship between PEs.</p>
</li><li id="EN-US_TASK_0172370670__li1512609901214056"><p id="EN-US_TASK_0172370670__p523192921214056"><a name="EN-US_TASK_0172370670__li1512609901214056"></a><a name="li1512609901214056"></a>Configure CEs and PEs to communicate.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172370670__1.4.4"></a><a name="1.4.4"></a>
<div class="p" id="EN-US_TASK_0172370670__context511240224214056"><h4 class="sectiontitle">Data Preparation</h4><p id="EN-US_TASK_0172370670__p374909754214056">To complete the configuration, you need the following data:</p>
<ul id="EN-US_TASK_0172370670__ul1706086793214056"><li id="EN-US_TASK_0172370670__li282368156214056"><p id="EN-US_TASK_0172370670__p1970221669214056"><a name="EN-US_TASK_0172370670__li282368156214056"></a><a name="li282368156214056"></a>EVPN instance named evrf1 and VPN instance named vpn1</p>
</li><li id="EN-US_TASK_0172370670__li818424214056"><p id="EN-US_TASK_0172370670__p870350286214056"><a name="EN-US_TASK_0172370670__li818424214056"></a><a name="li818424214056"></a>RDs (100:1 and 200:1) and RT (1:1) of the EVPN instance evrf1 on PE1 and PE2 vpn1 RDs (100:2 and 200:2) and RT 2:2</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172370670__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Procedure</h4>
<ol id="EN-US_TASK_0172370670__steps1059808557214056"><li id="EN-US_TASK_0172370670__step951293862214056"><span id="EN-US_TASK_0172370670__cmd380186719214056">Configure addresses for interfaces connecting the PEs and P according to <a href="dc_vrp_dci_cfg_0035.html">Example for Configuring BD EVPN IRB over SR-MPLS TE</a>.</span><p><p id="EN-US_TASK_0172370670__en-us_task_0172369488_p1188131509214048"># Configure PE1.</p>
<pre class="screen" id="EN-US_TASK_0172370670__en-us_task_0172369488_screen1539879811214048">&lt;<span class="keyword" id="EN-US_TASK_0172370670__keyword1796874616214050"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword" id="EN-US_TASK_0172370670__keyword9143351214050">HUAWEI</span>&gt; <strong id="EN-US_TASK_0172370670__b1456632315214050">system-view</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__en-us_task_0172369488_screen1556776246214048">[<span class="keyword" id="EN-US_TASK_0172370670__keyword14127381919"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword" id="EN-US_TASK_0172370670__keyword4412838114">HUAWEI</span>] <strong id="EN-US_TASK_0172370670__en-us_task_0172369488_b1826021567214048">sysname PE1</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__en-us_task_0172369488_screen53468997214048">[<span class="keyword" id="EN-US_TASK_0172370670__keyword168243124517">*</span><span class="keyword" id="EN-US_TASK_0172370670__keyword1871232616110">HUAWEI</span>] <strong id="EN-US_TASK_0172370670__en-us_task_0172369488_b1758551947214048">commit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__en-us_task_0172369488_screen951847452214048">[<span class="keyword" id="EN-US_TASK_0172370670__en-us_task_0172369488_keyword1043223072214048"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong id="EN-US_TASK_0172370670__en-us_task_0172369488_b925133943214048">interface loopback 1</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__en-us_task_0172369488_screen1285024223214048">[<span class="keyword" id="EN-US_TASK_0172370670__en-us_task_0172369488_keyword8183659214048">*</span>PE1-LoopBack1] <strong id="EN-US_TASK_0172370670__en-us_task_0172369488_b867106471214048">ip address 1.1.1.1 32</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__en-us_task_0172369488_screen601223530214048">[<span class="keyword" id="EN-US_TASK_0172370670__en-us_task_0172369488_keyword678232359214048">*</span>PE1-LoopBack1] <strong id="EN-US_TASK_0172370670__en-us_task_0172369488_b751580343214048">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__en-us_task_0172369488_screen1725882633214048">[<span class="keyword" id="EN-US_TASK_0172370670__en-us_task_0172369488_keyword299625369214048">*</span>PE1]<strong id="EN-US_TASK_0172370670__en-us_task_0172369488_b665376355214048"> interface gigabitethernet<span>0/2/0</span></strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__en-us_task_0172369488_screen216319910214048">[<span class="keyword" id="EN-US_TASK_0172370670__en-us_task_0172369488_keyword1058127016214048">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong id="EN-US_TASK_0172370670__en-us_task_0172369488_b1031148063214048">ip address 10.1.1.1 24</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__en-us_task_0172369488_screen977384742214048">[<span class="keyword" id="EN-US_TASK_0172370670__en-us_task_0172369488_keyword273931289214048">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong id="EN-US_TASK_0172370670__en-us_task_0172369488_b1799184375214048">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__en-us_task_0172369488_screen320501124214048">[<span class="keyword" id="EN-US_TASK_0172370670__en-us_task_0172369488_keyword2036584700214048">*</span>PE1] <strong id="EN-US_TASK_0172370670__en-us_task_0172369488_b1727035938214048">commit</strong></pre>
<p id="EN-US_TASK_0172370670__en-us_task_0172369488_p704972473214048"># Configure the P.</p>
<pre class="screen" id="EN-US_TASK_0172370670__screen198406130310">&lt;<span class="keyword" id="EN-US_TASK_0172370670__keyword68405138310"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword" id="EN-US_TASK_0172370670__keyword198404131136">HUAWEI</span>&gt; <strong id="EN-US_TASK_0172370670__b184010131434">system-view</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen9840513137">[<span class="keyword" id="EN-US_TASK_0172370670__keyword884012134317"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword" id="EN-US_TASK_0172370670__keyword128406137316">HUAWEI</span>] <strong id="EN-US_TASK_0172370670__b384011316320">sysname P</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen158401513037">[<span class="keyword" id="EN-US_TASK_0172370670__keyword13806258104416">*</span><span class="keyword" id="EN-US_TASK_0172370670__keyword13840913939">HUAWEI</span>] <strong id="EN-US_TASK_0172370670__b484061319311">commit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__en-us_task_0172369488_screen974993317214048">[<span class="keyword" id="EN-US_TASK_0172370670__en-us_task_0172369488_keyword800042725214048"><font style="font-size:8pt" Face="Courier New" >~</font></span>P] <strong id="EN-US_TASK_0172370670__en-us_task_0172369488_b1001868575214048">interface loopback 1</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__en-us_task_0172369488_screen785218503214048">[<span class="keyword" id="EN-US_TASK_0172370670__en-us_task_0172369488_keyword201236712214048">*</span>P-LoopBack1] <strong id="EN-US_TASK_0172370670__en-us_task_0172369488_b2125328831214048">ip address 2.2.2.2 32</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__en-us_task_0172369488_screen1088003628214048">[<span class="keyword" id="EN-US_TASK_0172370670__en-us_task_0172369488_keyword1543740642214048">*</span>P-LoopBack1] <strong id="EN-US_TASK_0172370670__en-us_task_0172369488_b1106794695214048">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__en-us_task_0172369488_screen233840133214048">[<span class="keyword" id="EN-US_TASK_0172370670__en-us_task_0172369488_keyword1876737106214048">*</span>P]<strong id="EN-US_TASK_0172370670__en-us_task_0172369488_b1824173385214048"> interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__en-us_task_0172369488_screen671151759214048">[<span class="keyword" id="EN-US_TASK_0172370670__en-us_task_0172369488_keyword1905366392214048">*</span>P-GigabitEthernet<span>0/1/0</span>] <strong id="EN-US_TASK_0172370670__en-us_task_0172369488_b114475027214048">ip address 10.1.1.2 24</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__en-us_task_0172369488_screen1823662946214048">[<span class="keyword" id="EN-US_TASK_0172370670__en-us_task_0172369488_keyword505711824214048">*</span>P-GigabitEthernet<span>0/1/0</span>] <strong id="EN-US_TASK_0172370670__en-us_task_0172369488_b1702628474214048">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__en-us_task_0172369488_screen1072742025214048">[<span class="keyword" id="EN-US_TASK_0172370670__en-us_task_0172369488_keyword465405114214048">*</span>P]<strong id="EN-US_TASK_0172370670__en-us_task_0172369488_b614348113214048"> interface gigabitethernet<span>0/2/0</span></strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__en-us_task_0172369488_screen1853870408214048">[<span class="keyword" id="EN-US_TASK_0172370670__en-us_task_0172369488_keyword2088189828214048">*</span>P-GigabitEthernet<span>0/2/0</span>] <strong id="EN-US_TASK_0172370670__en-us_task_0172369488_b200585444214048">ip address 10.2.1.1 24</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__en-us_task_0172369488_screen1368967001214048">[<span class="keyword" id="EN-US_TASK_0172370670__en-us_task_0172369488_keyword757038772214048">*</span>P-GigabitEthernet<span>0/2/0</span>] <strong id="EN-US_TASK_0172370670__en-us_task_0172369488_b1393643972214048">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__en-us_task_0172369488_screen1150915313214048">[<span class="keyword" id="EN-US_TASK_0172370670__en-us_task_0172369488_keyword1314517399214048">*</span>P] <strong id="EN-US_TASK_0172370670__en-us_task_0172369488_b301008334214048">commit</strong></pre>
<p id="EN-US_TASK_0172370670__en-us_task_0172369488_p1002916576214048"># Configure PE2.</p>
<pre class="screen" id="EN-US_TASK_0172370670__screen69211561835">&lt;<span class="keyword" id="EN-US_TASK_0172370670__keyword149212563312"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword" id="EN-US_TASK_0172370670__keyword892112567318">HUAWEI</span>&gt; <strong id="EN-US_TASK_0172370670__b1192117564310">system-view</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen129211556730">[<span class="keyword" id="EN-US_TASK_0172370670__keyword09211568310"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword" id="EN-US_TASK_0172370670__keyword392115620311">HUAWEI</span>] <strong id="EN-US_TASK_0172370670__b592114561234">sysname PE2</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen11921185610318">[<span class="keyword" id="EN-US_TASK_0172370670__keyword6459254114420">*</span><span class="keyword" id="EN-US_TASK_0172370670__keyword9921456334">HUAWEI</span>] <strong id="EN-US_TASK_0172370670__b139211560312">commit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__en-us_task_0172369488_screen2143072645214048">[<span class="keyword" id="EN-US_TASK_0172370670__en-us_task_0172369488_keyword1188470960214048"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong id="EN-US_TASK_0172370670__en-us_task_0172369488_b753305913214048">interface loopback 1</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__en-us_task_0172369488_screen1269567466214048">[<span class="keyword" id="EN-US_TASK_0172370670__en-us_task_0172369488_keyword807806922214048">*</span>PE2-LoopBack1] <strong id="EN-US_TASK_0172370670__en-us_task_0172369488_b1646302233214048">ip address 3.3.3.3 32</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__en-us_task_0172369488_screen738681779214048">[<span class="keyword" id="EN-US_TASK_0172370670__en-us_task_0172369488_keyword754452122214048">*</span>PE2-LoopBack1] <strong id="EN-US_TASK_0172370670__en-us_task_0172369488_b832790317214048">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__en-us_task_0172369488_screen2107838496214048">[<span class="keyword" id="EN-US_TASK_0172370670__en-us_task_0172369488_keyword1131419293214048">*</span>PE2]<strong id="EN-US_TASK_0172370670__en-us_task_0172369488_b566344980214048"> interface gigabitethernet<span>0/2/0</span></strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__en-us_task_0172369488_screen185627733214048">[<span class="keyword" id="EN-US_TASK_0172370670__en-us_task_0172369488_keyword895179050214048">*</span>PE2-GigabitEthernet<span>0/2/0</span>]<strong id="EN-US_TASK_0172370670__en-us_task_0172369488_b810907017214048"> ip address 10.2.1.2 24</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__en-us_task_0172369488_screen871777228214048">[<span class="keyword" id="EN-US_TASK_0172370670__en-us_task_0172369488_keyword697289516214048">*</span>PE2-GigabitEthernet<span>0/2/0</span>]<strong id="EN-US_TASK_0172370670__en-us_task_0172369488_b1078548112214048"> quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__en-us_task_0172369488_screen125558937214048">[<span class="keyword" id="EN-US_TASK_0172370670__en-us_task_0172369488_keyword1835211945214048">*</span>PE2]<strong id="EN-US_TASK_0172370670__en-us_task_0172369488_b41270465214048"> commit</strong></pre>
</p></li><li id="EN-US_TASK_0172370670__step1385097590214056"><span id="EN-US_TASK_0172370670__cmd612461650214056">Configure an IGP for PE1, PE2, and the P to communicate. IS-IS is used as the IGP in this example.</span><p><p id="EN-US_TASK_0172370670__p1225254148214056"># Configure PE1.</p>
<pre class="screen" id="EN-US_TASK_0172370670__screen1162131512214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1331339912214056"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong id="EN-US_TASK_0172370670__b625342059214056">isis 1</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen587880874214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1841749423214056">*</span>PE1-isis-1] <strong id="EN-US_TASK_0172370670__b892006012214056">is-level level-2</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1780020429214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword172464171214056">*</span>PE1-isis-1] <strong id="EN-US_TASK_0172370670__b1261184494214056">network-entity 00.1111.1111.1111.00</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1677653560214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1187362254214056">*</span>PE1-isis-1] <strong id="EN-US_TASK_0172370670__b1322515658214056">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen940649594214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword26902257214056">*</span>PE1] <strong id="EN-US_TASK_0172370670__b819993032214056">interface loopback 1</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1550673325214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword650921992214056">*</span>PE1-LoopBack1] <strong id="EN-US_TASK_0172370670__b174856175214056">isis enable 1</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1079485057214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1570626021214056">*</span>PE1-LoopBack1] <strong id="EN-US_TASK_0172370670__b1723231445214056">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1576365161214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1253885947214056">*</span>PE1] <strong id="EN-US_TASK_0172370670__b112054355214056">interface GigabitEthernet <span>0/2/0</span></strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen28199966214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword329321967214056">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong id="EN-US_TASK_0172370670__b1309621025214056">isis enable 1</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen2006364381214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1902612265214056">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong id="EN-US_TASK_0172370670__b733199568214056">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen949713929214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1265761278214056">*</span>PE1] <strong id="EN-US_TASK_0172370670__b1772505836214056">commit</strong></pre>
<p id="EN-US_TASK_0172370670__p296983605214056"># Configure the P.</p>
<pre class="screen" id="EN-US_TASK_0172370670__screen1109140443214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1315014947214056"><font style="font-size:8pt" Face="Courier New" >~</font></span>P] <strong id="EN-US_TASK_0172370670__b1081436224214056">isis 1</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1981821760214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1727429090214056">*</span>P-isis-1] <strong id="EN-US_TASK_0172370670__b1444746363214056">is-level level-2</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen36300960214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword2117147331214056">*</span>P-isis-1] <strong id="EN-US_TASK_0172370670__b199604000214056">network-entity 00.1111.1111.2222.00</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1427064204214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword2002417200214056">*</span>P-isis-1] <strong id="EN-US_TASK_0172370670__b918762537214056">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen2031055536214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1720935320214056">*</span>P] <strong id="EN-US_TASK_0172370670__b1138707505214056">interface loopback 1</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1180522043214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword838531781214056">*</span>P-LoopBack1] <strong id="EN-US_TASK_0172370670__b1633139564214056">isis enable 1</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen2099497881214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1026506740214056">*</span>P-LoopBack1] <strong id="EN-US_TASK_0172370670__b201116638214056">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1549001123214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1182620520214056">*</span>P] <strong id="EN-US_TASK_0172370670__b888029791214056">interface GigabitEthernet <span>0/1/0</span></strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen745913451214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1053933464214056">*</span>P-GigabitEthernet<span>0/1/0</span>] <strong id="EN-US_TASK_0172370670__b648836178214056">isis enable 1</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1549163997214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1366672818214056">*</span>P-GigabitEthernet<span>0/1/0</span>] <strong id="EN-US_TASK_0172370670__b583884048214056">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen442378000214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1381256319214056">*</span>P] <strong id="EN-US_TASK_0172370670__b128916984214056">interface GigabitEthernet <span>0/2/0</span></strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen497640559214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword904496105214056">*</span>P-GigabitEthernet<span>0/2/0</span>] <strong id="EN-US_TASK_0172370670__b1895145811214056">isis enable 1</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen403140603214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword492465866214056">*</span>P-GigabitEthernet<span>0/2/0</span>] <strong id="EN-US_TASK_0172370670__b877667330214056">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen673705077214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1480478448214056">*</span>P] <strong id="EN-US_TASK_0172370670__b952511132214056">commit</strong></pre>
<p id="EN-US_TASK_0172370670__p1041579939214056"># Configure PE2.</p>
<pre class="screen" id="EN-US_TASK_0172370670__screen752379524214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword925926790214056"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong id="EN-US_TASK_0172370670__b2016706143214056">isis 1</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen826686552214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1154875008214056">*</span>PE2-isis-1] <strong id="EN-US_TASK_0172370670__b288066504214056">is-level level-2</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1662784886214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword133845852214056">*</span>PE2-isis-1] <strong id="EN-US_TASK_0172370670__b696251959214056">network-entity 00.1111.1111.3333.00</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1454289817214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1819584378214056">*</span>PE2-isis-1] <strong id="EN-US_TASK_0172370670__b906192834214056">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen33387819214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1851526858214056">*</span>PE2] <strong id="EN-US_TASK_0172370670__b1264838333214056">interface loopback 1</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1463530625214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword627678718214056">*</span>PE2-LoopBack1] <strong id="EN-US_TASK_0172370670__b494475692214056">isis enable 1</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1752865322214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword791860709214056">*</span>PE2-LoopBack1] <strong id="EN-US_TASK_0172370670__b385128459214056">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1391238876214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1133494976214056">*</span>PE2] <strong id="EN-US_TASK_0172370670__b30990990214056">interface GigabitEthernet <span>0/2/0</span></strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen2113323738214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword272662052214056">*</span>PE2-GigabitEthernet<span>0/2/0</span>] <strong id="EN-US_TASK_0172370670__b258381774214056">isis enable 1</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen104083077214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1571345694214056">*</span>PE2-GigabitEthernet<span>0/2/0</span>] <strong id="EN-US_TASK_0172370670__b1826314529214056">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1285029390214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1416398929214056">*</span>PE2] <strong id="EN-US_TASK_0172370670__b534743967214056">commit</strong></pre>
<p id="EN-US_TASK_0172370670__p1378861197214056">After completing the configurations, run the <strong id="EN-US_TASK_0172370670__b88514266254011">display isis peer</strong> command to check whether an IS-IS neighbor relationship has been established between PE1 and the P and between PE2 and the P. If the <strong id="EN-US_TASK_0172370670__b134380416754011">Up</strong> state is displayed in the command output, the neighbor relationship has been successfully established. Run the <strong id="EN-US_TASK_0172370670__b212992171454011">display ip routing-table</strong> command. The command output shows that the PEs have learned the route to each other's Loopback1 interface.</p>
<p id="EN-US_TASK_0172370670__p219293214214056">The following example uses the command output on PE1.</p>
<pre class="screen" id="EN-US_TASK_0172370670__screen696570718214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1140350745214056"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong id="EN-US_TASK_0172370670__b1513357047214056">display isis peer</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1359901917214056">                          Peer information for ISIS(1)
                         
  System Id     Interface          Circuit Id        State HoldTime Type     PRI
--------------------------------------------------------------------------------
1111.1111.2222  GE<span>0/2/0</span>            1111.1111.2222.01  Up   8s       L2       64 

Total Peer(s): 1</pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1363655515214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword498925425214056"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong id="EN-US_TASK_0172370670__b1831565563214056">display ip routing-table</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen2139351133214056"><span class="keyword" id="EN-US_TASK_0172370670__keyword755790610214056">Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route</span>
------------------------------------------------------------------------------
Routing Table : _public_
         Destinations : 11       Routes : 11        

Destination/Mask    Proto   Pre  Cost        Flags NextHop         Interface

        1.1.1.1/32  Direct  0    0             D   127.0.0.1       LoopBack1
        2.2.2.2/32  ISIS-L2 15   10            D   10.1.1.2        GigabitEthernet<span>0/2/0</span>
        3.3.3.3/32  ISIS-L2 15   20            D   10.1.1.2        GigabitEthernet<span>0/2/0</span>
       10.1.1.0/24  Direct  0    0             D   10.1.1.1        GigabitEthernet<span>0/2/0</span>
       10.1.1.1/32  Direct  0    0             D   127.0.0.1       GigabitEthernet<span>0/2/0</span>
     10.1.1.255/32  Direct  0    0             D   127.0.0.1       GigabitEthernet<span>0/2/0</span>
       10.2.1.0/24  ISIS-L2 15   20            D   10.1.1.2        GigabitEthernet<span>0/2/0</span>
      127.0.0.0/8   Direct  0    0             D   127.0.0.1       InLoopBack0
      127.0.0.1/32  Direct  0    0             D   127.0.0.1       InLoopBack0
127.255.255.255/32  Direct  0    0             D   127.0.0.1       InLoopBack0
255.255.255.255/32  Direct  0    0             D   127.0.0.1       InLoopBack0</pre>
</p></li><li id="EN-US_TASK_0172370670__step1218888044214056"><span id="EN-US_TASK_0172370670__cmd1004846775214056">Configure an SR-MPLS TE tunnel on the backbone network.</span><p><p id="EN-US_TASK_0172370670__p1968389015214056"># Configure PE1.</p>
<pre class="screen" id="EN-US_TASK_0172370670__screen511972296214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword872776863214056"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong id="EN-US_TASK_0172370670__b218079601214056">mpls lsr-id 1.1.1.1</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen761678573214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1650262119214056">*</span>PE1] <strong id="EN-US_TASK_0172370670__b2125395915214056">mpls</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1261906416214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1727243018214056">*</span>PE1-mpls] <strong id="EN-US_TASK_0172370670__b372474760214056">mpls te</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen149371858214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1744089821214056">*</span>PE1-mpls] <strong id="EN-US_TASK_0172370670__b810354530214056">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1047961396214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword191694576214056">*</span>PE1] <strong id="EN-US_TASK_0172370670__b1129752664214056">segment-routing</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1227092934214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword825639336214056">*</span>PE1-segment-routing] <strong id="EN-US_TASK_0172370670__b131925180214056">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen810866358214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword453172293214056">*</span>PE1] <strong id="EN-US_TASK_0172370670__b148148150214056">isis 1</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen2079842237214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1163324004214056">*</span>PE1-isis-1] <strong id="EN-US_TASK_0172370670__b816069294214056">cost-style wide</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1942002203214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword755433469214056">*</span>PE1-isis-1] <strong id="EN-US_TASK_0172370670__b1291881372214056">traffic-eng level-2</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen464369582214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1497325809214056">*</span>PE1-isis-1] <strong id="EN-US_TASK_0172370670__b97789966214056">segment-routing mpls</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1782917009214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1732352768214056">*</span>PE1-isis-1] <strong id="EN-US_TASK_0172370670__b829812635214056">segment-routing global-block 153616 153800</strong></pre>
<div class="note" id="EN-US_TASK_0172370670__note5675122403810"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0172370670__p1318624118245">The SRGB range varies according to the device. This example is for reference only. In this example, the adjacency label is a dynamic one.</p>
</div></div>
<pre class="screen" id="EN-US_TASK_0172370670__screen1248015569214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1104869752214056">*</span>PE1-isis-1] <strong id="EN-US_TASK_0172370670__b782475667214056">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1101720737214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1925088037214056">*</span>PE1] <strong id="EN-US_TASK_0172370670__b789951379214056">interface loopback 1</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen288415692214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword411158694214056">*</span>PE1-LoopBack1] <strong id="EN-US_TASK_0172370670__b396410271214056">isis prefix-sid absolute 153700</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen525216769214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword193188237214056">*</span>PE1-LoopBack1] <strong id="EN-US_TASK_0172370670__b838072222214056">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen829161876214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword390151131214056">*</span>PE1] <strong id="EN-US_TASK_0172370670__b1746537067214056">explicit-path pe1tope2</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1510181249214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword405325054214056">*</span>PE1-explicit-path-pe1tope2] <strong id="EN-US_TASK_0172370670__b176457479214056">next sid label 48121 type adjacency</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1050074849214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword47737020214056">*</span>PE1-explicit-path-pe1tope2] <strong id="EN-US_TASK_0172370670__b50135346214056">next sid label 48120 type adjacency</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1118049430214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword122251467214056">*</span>PE1-explicit-path-pe1tope2] <strong id="EN-US_TASK_0172370670__b1216414794214056">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1003702089214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1592864617214056">*</span>PE1] <strong id="EN-US_TASK_0172370670__b1141799097214056">interface tunnel1</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1553155784214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1007438844214056">*</span>PE1-Tunnel1] <strong id="EN-US_TASK_0172370670__b492349937214056">ip address unnumbered interface loopback 1</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1514850526214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1197333685214056">*</span>PE1-Tunnel1] <strong id="EN-US_TASK_0172370670__b1276048837214056">tunnel-protocol mpls te</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1249061686214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword925166097214056">*</span>PE1-Tunnel1] <strong id="EN-US_TASK_0172370670__b138353759214056">destination 3.3.3.3</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen945220682214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1755471479214056">*</span>PE1-Tunnel1] <strong id="EN-US_TASK_0172370670__b1065308026214056">mpls te tunnel-id 1</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen926000607214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1425949206214056">*</span>PE1-Tunnel1] <strong id="EN-US_TASK_0172370670__b1206336306214056">mpls te signal-protocol segment-routing</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen962153771214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1913293013214056">*</span>PE1-Tunnel1] <strong id="EN-US_TASK_0172370670__b2147041727214056">mpls te path explicit-path pe1tope2</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1762362030214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword716616129214056">*</span>PE1-Tunnel1] <strong id="EN-US_TASK_0172370670__b1194812421214056">mpls te reserved-for-binding</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen224028828214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1106868540214056">*</span>PE1-Tunnel1] <strong id="EN-US_TASK_0172370670__b1109939227214056">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1917521873214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1912465882214056">*</span>PE1] <strong id="EN-US_TASK_0172370670__b37687414214056">commit</strong></pre>
<div class="note" id="EN-US_TASK_0172370670__note168353693214056"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0172370670__p1284555152214056">In the preceding steps, the <a href="cmdqueryname=next+sid+label"><b><span class="cmdname" id="EN-US_TASK_0172370670__cmdname949163527214056">next sid label</span></b></a> command uses the adjacency labels of PE1 â&gt; P and P â&gt; PE2, which are dynamically generated through IS-IS. Before the configuration, you can run the <a href="cmdqueryname=display+segment-routing+adjacency+mpls+forwarding"><b><span class="cmdname" id="EN-US_TASK_0172370670__cmdname283856300214056">display segment-routing adjacency mpls forwarding</span></b></a> command to query the label value. For example:</p>
<pre class="screen" id="EN-US_TASK_0172370670__screen39921743214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1660090608214056"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong id="EN-US_TASK_0172370670__b1489417430214056">display segment-routing adjacency mpls forwarding</strong>
            Segment Routing Adjacency MPLS Forwarding Information

Label     Interface         NextHop          Type        MPLSMtu   Mtu       VPN-Name       
-------------------------------------------------------------------------------------
48121     GE<span>0/2/0</span>           10.1.1.2         ISIS-V4     ---       1500      _public_      </pre>
</div></div>
<p id="EN-US_TASK_0172370670__p1236253644214056"># Configure the P.</p>
<pre class="screen" id="EN-US_TASK_0172370670__screen1966427713214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1957313040214056"><font style="font-size:8pt" Face="Courier New" >~</font></span>P] <strong id="EN-US_TASK_0172370670__b2116080291214056">mpls lsr-id 2.2.2.2</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen24669372214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1348106390214056">*</span>P] <strong id="EN-US_TASK_0172370670__b1551060106214056">mpls</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1332180689214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword511314214214056">*</span>P-mpls] <strong id="EN-US_TASK_0172370670__b1622899706214056"> mpls te</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1514909655214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword548525440214056">*</span>P-mpls] <strong id="EN-US_TASK_0172370670__b253096079214056">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen900586065214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword48657132214056">*</span>P] <strong id="EN-US_TASK_0172370670__b1118130471214056">segment-routing</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen23228656214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword68243782214056">*</span>P-segment-routing] <strong id="EN-US_TASK_0172370670__b298080226214056">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1325545263214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword2101681210214056">*</span>P] <strong id="EN-US_TASK_0172370670__b1600848731214056">isis 1</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen488626672214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1423000791214056">*</span>P-isis-1] <strong id="EN-US_TASK_0172370670__b1232904687214056">cost-style wide</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1115236978214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword733556687214056">*</span>P-isis-1] <strong id="EN-US_TASK_0172370670__b183843735214056">traffic-eng level-2</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen570969509214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword667974039214056">*</span>P-isis-1] <strong id="EN-US_TASK_0172370670__b1346723642214056">segment-routing mpls</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen233623155214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword145444964214056">*</span>P-isis-1] <strong id="EN-US_TASK_0172370670__b1849246360214056">segment-routing global-block 153616 153800</strong></pre>
<div class="note" id="EN-US_TASK_0172370670__note1892681585410"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0172370670__p1689102614306">The SRGB range varies according to the device. This example is for reference only.</p>
</div></div>
<pre class="screen" id="EN-US_TASK_0172370670__screen1989002215214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword2089412238214056">*</span>P-isis-1] <strong id="EN-US_TASK_0172370670__b656663654214056">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1291001498214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1151983795214056">*</span>P] <strong id="EN-US_TASK_0172370670__b796868155214056">interface loopback 1</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1182030317214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword894095442214056">*</span>P-LoopBack1] <strong id="EN-US_TASK_0172370670__b1781480666214056">isis prefix-sid absolute 153710</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen913657012214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1030736954214056">*</span>P-LoopBack1] <strong id="EN-US_TASK_0172370670__b185938773214056">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen11787248193516">[<span class="keyword" id="EN-US_TASK_0172370670__keyword194761749123517">*</span>P] <strong id="EN-US_TASK_0172370670__b144761049163515">commit</strong></pre>
<div class="note" id="EN-US_TASK_0172370670__note952118324117"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0172370670__p1521113114116">After the configuration is complete, run the <a href="cmdqueryname=display+segment-routing+adjacency+mpls+forwarding"><b><span class="cmdname" id="EN-US_TASK_0172370670__cmdname19521173104114">display segment-routing adjacency mpls forwarding</span></b></a> command to query the automatically generated adjacency label. For example:</p>
<pre class="screen" id="EN-US_TASK_0172370670__screen1052163204117">[<span class="keyword" id="EN-US_TASK_0172370670__keyword115211832418"><font style="font-size:8pt" Face="Courier New" >~</font></span>P] <strong id="EN-US_TASK_0172370670__b3521103104112">display segment-routing adjacency mpls forwarding</strong>
            Segment Routing Adjacency MPLS Forwarding Information

Label     Interface         NextHop          Type        MPLSMtu   Mtu       VPN-Name       
-------------------------------------------------------------------------------------
48221     GE<span>0/1/0</span>           10.1.1.1         ISIS-V4     ---       1500      _public_ 
48120     GE<span>0/2/0</span>           10.2.1.2         ISIS-V4     ---       1500      _public_      </pre>
</div></div>
<p id="EN-US_TASK_0172370670__p1998178299214056"># Configure PE2.</p>
<pre class="screen" id="EN-US_TASK_0172370670__screen1645260860214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword951170962214056"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong id="EN-US_TASK_0172370670__b1046871710214056">mpls lsr-id 3.3.3.3</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen436055507214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1929357171214056">*</span>PE2] <strong id="EN-US_TASK_0172370670__b1742675601214056">mpls</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen14179631214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword640865540214056">*</span>PE2-mpls] <strong id="EN-US_TASK_0172370670__b1350285815214056">mpls te</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1001140912214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword395378021214056">*</span>PE2-mpls] <strong id="EN-US_TASK_0172370670__b779026179214056">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1055020711214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1653928809214056">*</span>PE2] <strong id="EN-US_TASK_0172370670__b605850802214056">segment-routing</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen944556420214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword565276866214056">*</span>PE2-segment-routing] <strong id="EN-US_TASK_0172370670__b1378987238214056">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen352560905214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1351739938214056">*</span>PE2] <strong id="EN-US_TASK_0172370670__b1265513555214056">isis 1</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1911035304214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword2043681364214056">*</span>PE2-isis-1] <strong id="EN-US_TASK_0172370670__b622703714214056">cost-style wide</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen446880143214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1235494232214056">*</span>PE2-isis-1] <strong id="EN-US_TASK_0172370670__b1161616602214056">traffic-eng level-2</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1068288632214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1614411387214056">*</span>PE2-isis-1] <strong id="EN-US_TASK_0172370670__b2145596369214056">segment-routing mpls</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1344901881214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1495343923214056">*</span>PE2-isis-1] <strong id="EN-US_TASK_0172370670__b310837723214056">segment-routing global-block 153616 153800</strong></pre>
<div class="note" id="EN-US_TASK_0172370670__note187186218544"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0172370670__en-us_task_0172368860_p969181111187">The SRGB range varies according to the device. This example is for reference only. In this example, the adjacency label is a dynamic one.</p>
</div></div>
<pre class="screen" id="EN-US_TASK_0172370670__screen1191591845214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1418916720214056">*</span>PE2-isis-1] <strong id="EN-US_TASK_0172370670__b1950250878214056">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1753179780214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1027619890214056">*</span>PE2] <strong id="EN-US_TASK_0172370670__b821463601214056">interface loopback 1</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen248378914214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword2080829422214056">*</span>PE2-LoopBack1] <strong id="EN-US_TASK_0172370670__b1445477825214056">isis prefix-sid absolute 153720</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1955272540214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword276317885214056">*</span>PE2-LoopBack1] <strong id="EN-US_TASK_0172370670__b896140144214056">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen876298932214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword574449387214056">*</span>PE2] <strong id="EN-US_TASK_0172370670__b1645354116214056">explicit-path pe2tope1</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen281093957214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword782092674214056">*</span>PE2-explicit-path-pe2tope1] <strong id="EN-US_TASK_0172370670__b989849046214056">next sid label 48220 type adjacency</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen228628016214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1142891703214056">*</span>PE2-explicit-path-pe2tope1] <strong id="EN-US_TASK_0172370670__b1502801485214056">next sid label 48221 type adjacency</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen762712364214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword751631077214056">*</span>PE2-explicit-path-pe2tope1] <strong id="EN-US_TASK_0172370670__b790801990214056">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1339630942214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword83378681214056">*</span>PE2] <strong id="EN-US_TASK_0172370670__b594927360214056">interface tunnel1</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen86443077214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword319694616214056">*</span>PE2-Tunnel1] <strong id="EN-US_TASK_0172370670__b1438639850214056">ip address unnumbered interface loopback 1</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1725753209214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword2132088968214056">*</span>PE2-Tunnel1] <strong id="EN-US_TASK_0172370670__b2094152930214056">tunnel-protocol mpls te</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen957199702214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1315071441214056">*</span>PE2-Tunnel1] <strong id="EN-US_TASK_0172370670__b1287172373214056">destination 1.1.1.1</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1940059395214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1470316068214056">*</span>PE2-Tunnel1] <strong id="EN-US_TASK_0172370670__b979418351214056">mpls te tunnel-id 1</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1196937018214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1920703273214056">*</span>PE2-Tunnel1] <strong id="EN-US_TASK_0172370670__b450456157214056">mpls te signal-protocol segment-routing</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1175212211214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1790528881214056">*</span>PE2-Tunnel1] <strong id="EN-US_TASK_0172370670__b1316833793214056">mpls te path explicit-path pe2tope1</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1038085069214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1891301970214056">*</span>PE2-Tunnel1] <strong id="EN-US_TASK_0172370670__b1813792511214056">mpls te reserved-for-binding</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen102176254214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword970478660214056">*</span>PE2-Tunnel1] <strong id="EN-US_TASK_0172370670__b808621788214056">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen940366525214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1594239121214056">*</span>PE2] <strong id="EN-US_TASK_0172370670__b1605556640214056">commit</strong></pre>
<div class="note" id="EN-US_TASK_0172370670__note169916591426"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0172370670__p12699175912423">In the preceding steps, the <a href="cmdqueryname=next+sid+label"><b><span class="cmdname" id="EN-US_TASK_0172370670__cmdname206994599425">next sid label</span></b></a> command uses the adjacency labels of PE2 â&gt; P and P â&gt; PE1, which are dynamically generated through IS-IS. Before the configuration, you can run the <a href="cmdqueryname=display+segment-routing+adjacency+mpls+forwarding"><b><span class="cmdname" id="EN-US_TASK_0172370670__cmdname116993598423">display segment-routing adjacency mpls forwarding</span></b></a> command to query the label value. For example:</p>
<pre class="screen" id="EN-US_TASK_0172370670__screen206992596428">[<span class="keyword" id="EN-US_TASK_0172370670__keyword3699195915424"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong id="EN-US_TASK_0172370670__b186991859114214">display segment-routing adjacency mpls forwarding</strong>
            Segment Routing Adjacency MPLS Forwarding Information

Label     Interface         NextHop          Type        MPLSMtu   Mtu       VPN-Name       
-------------------------------------------------------------------------------------
48220     GE<span>0/2/0</span>           10.2.1.1         ISIS-V4     ---       1500      _public_      </pre>
</div></div>
<p id="EN-US_TASK_0172370670__p352560617214056">After completing the configurations, run the <strong id="EN-US_TASK_0172370670__b1603246812214056">display mpls te tunnel-interface</strong> command. The command output shows that the tunnel status is <strong id="EN-US_TASK_0172370670__b166071554071">Up</strong>.</p>
<p id="EN-US_TASK_0172370670__p2017388795214056">The following example uses the command output on PE1.</p>
<pre class="screen" id="EN-US_TASK_0172370670__screen1973768182214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword2077987618214056"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong id="EN-US_TASK_0172370670__b130151817214056"> display mpls te tunnel-interface</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen281307779214056">    Tunnel Name       : Tunnel1
    Signalled Tunnel Name: -
    Tunnel State Desc : <strong id="EN-US_TASK_0172370670__b2120133729214056">CR-LSP is Up</strong>
    Tunnel Attributes   :     
    Active LSP          : Primary LSP
    Traffic Switch      : - 
    Session ID          : 1
    Ingress LSR ID      : 1.1.1.1               Egress LSR ID: 3.3.3.3
    Admin State         : <strong id="EN-US_TASK_0172370670__b1597063487214056">UP</strong>                    Oper State   : <strong id="EN-US_TASK_0172370670__b1418538061214056">UP</strong>
    Signaling Protocol  : Segment-Routing
    FTid                : 1
    Tie-Breaking Policy : None                  Metric Type  : None
    Bfd Cap             : None                  
    Reopt               : Disabled              Reopt Freq   : -              
    Auto BW             : Disabled              Threshold    : - 
    Current Collected BW: -                     Auto BW Freq : -
    Min BW              : -                     Max BW       : -
    Offload             : Disabled              Offload Freq : - 
    Low Value           : -                     High Value   : - 
    Readjust Value      : - 
    Offload Explicit Path Name: -
    Tunnel Group        : Primary
    Interfaces Protected: -
    Excluded IP Address : -
    Referred LSP Count  : 0
    Primary Tunnel      : -                     Pri Tunn Sum : -
    Backup Tunnel       : -
    Group Status        : Up                    Oam Status   : None
    IPTN InLabel        : -                     Tunnel BFD Status : -
    BackUp LSP Type     : None                  BestEffort   : -
    Secondary HopLimit  : -
    BestEffort HopLimit  : -
    Secondary Explicit Path Name: -
    Secondary Affinity Prop/Mask: 0x0/0x0
    BestEffort Affinity Prop/Mask: -  
    IsConfigLspConstraint: -
    Hot-Standby Revertive Mode:  Revertive
    Hot-Standby Overlap-path:  Disabled
    Hot-Standby Switch State:  CLEAR
    Bit Error Detection:  Disabled
    Bit Error Detection Switch Threshold:  -
    Bit Error Detection Resume Threshold:  -
    Ip-Prefix Name    : -
    P2p-Template Name : -
    PCE Delegate      : No                    LSP Control Status : Local control

    Path Verification : No
    Entropy Label     : -
    Associated Tunnel Group ID: -             Associated Tunnel Group Type: -
    Auto BW Remain Time   : -                 Reopt Remain Time     : - 
    Segment-Routing Remote Label   : -
    Binding Sid       : -                     Reverse Binding Sid : - 
<span>    FRR Attr Source   : -                     Is FRR degrade down : No</span>
    Color             : - 

    Primary LSP ID      : 1.1.1.1:2
    LSP State           : UP                    LSP Type     : Primary
    Setup Priority      : 7                     Hold Priority: 7
    IncludeAll          : 0x0
    IncludeAny          : 0x0
    ExcludeAny          : 0x0
    Affinity Prop/Mask  : 0x0/0x0               Resv Style   :  SE
    SidProtectType      : - 
    Configured Bandwidth Information:
    CT0 Bandwidth(Kbit/sec): 0               CT1 Bandwidth(Kbit/sec): 0
    CT2 Bandwidth(Kbit/sec): 0               CT3 Bandwidth(Kbit/sec): 0
    CT4 Bandwidth(Kbit/sec): 0               CT5 Bandwidth(Kbit/sec): 0
    CT6 Bandwidth(Kbit/sec): 0               CT7 Bandwidth(Kbit/sec): 0
    Actual Bandwidth Information:
    CT0 Bandwidth(Kbit/sec): 0               CT1 Bandwidth(Kbit/sec): 0
    CT2 Bandwidth(Kbit/sec): 0               CT3 Bandwidth(Kbit/sec): 0
    CT4 Bandwidth(Kbit/sec): 0               CT5 Bandwidth(Kbit/sec): 0
    CT6 Bandwidth(Kbit/sec): 0               CT7 Bandwidth(Kbit/sec): 0
    Explicit Path Name  : pe1tope2                         Hop Limit: -
    Record Route        : -                            Record Label : Disabled
    Route Pinning       : -
    FRR Flag            : -
    IdleTime Remain     : -
    BFD Status          : -
    Soft Preemption     : -
    Reroute Flag        : -
    Pce Flag            : Normal
    Path Setup Type     : EXPLICIT
    Create Modify LSP Reason: -</pre>
</p></li><li id="EN-US_TASK_0172370670__step545409922214056"><span id="EN-US_TASK_0172370670__cmd1244353658214056">Configure an EVPN instance and a VPN instance on each PE.</span><p><p id="EN-US_TASK_0172370670__p861413021214056"># Configure PE1.</p>
<pre class="screen" id="EN-US_TASK_0172370670__screen987977368214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1550970653214056"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong id="EN-US_TASK_0172370670__b366322494214056">evpn vpn-instance evrf1 bd-mode</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1305344256214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword428695632214056">*</span>PE1-evpn-instance-evrf1] <strong id="EN-US_TASK_0172370670__b472267643214056">route-distinguisher 100:1</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen368951580214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1643096542214056">*</span>PE1-evpn-instance-evrf1] <strong id="EN-US_TASK_0172370670__b1804670210214056">vpn-target 1:1</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1613325721214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1921609017214056">*</span>PE1-evpn-instance-evrf1] <strong id="EN-US_TASK_0172370670__b1658166480214056">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen327147023214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1724518562214056">*</span>PE1] <strong id="EN-US_TASK_0172370670__b552576959214056">ip vpn-instance vpn1</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen2073904541214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword307537757214056">*</span>PE1-vpn-instance-vpn1] <strong id="EN-US_TASK_0172370670__b700703601214056">ipv4-family</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1759845002214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword81359505214056">*</span>PE1-vpn-instance-vpn1-af-ipv4] <strong id="EN-US_TASK_0172370670__b713228442214056">route-distinguisher 100:2</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1506409381214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword31903443214056">*</span>PE1-vpn-instance-vpn1-af-ipv4] <strong id="EN-US_TASK_0172370670__b700877631214056">vpn-target 2:2 evpn</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen731781348214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1976424999214056">*</span>PE1-vpn-instance-vpn1-af-ipv4] <strong id="EN-US_TASK_0172370670__b1716525667214056">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1134200200214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1330445105214056">*</span>PE1-vpn-instance-vpn1] <strong id="EN-US_TASK_0172370670__b767945663214056">evpn mpls routing-enable</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1986760256214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1385107041214056">*</span>PE1-vpn-instance-vpn1] <strong id="EN-US_TASK_0172370670__b1105236557214056">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen177701009214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1448840382214056">*</span>PE1] <strong id="EN-US_TASK_0172370670__b474121545214056">bridge-domain 10</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen730833052214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword347891487214056">*</span>PE1-bd10] <strong id="EN-US_TASK_0172370670__b1532910491214056">evpn binding vpn-instance evrf1</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen875303474214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1984252172214056">*</span>PE1-bd10] <strong id="EN-US_TASK_0172370670__b1767708601214056">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen981809736214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword109233857214056">*</span>PE1] <strong id="EN-US_TASK_0172370670__b2018907180214056">commit</strong></pre>
<p id="EN-US_TASK_0172370670__p1983323972214056"># Configure PE2.</p>
<pre class="screen" id="EN-US_TASK_0172370670__screen962499972214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword869171329214056"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong id="EN-US_TASK_0172370670__b288012443214056">evpn vpn-instance evrf1 bd-mode</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1524562514214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword2099261726214056">*</span>PE2-evpn-instance-evrf1] <strong id="EN-US_TASK_0172370670__b368605906214056">route-distinguisher 200:1</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1227819159214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword890481039214056">*</span>PE2-evpn-instance-evrf1] <strong id="EN-US_TASK_0172370670__b544362529214056">vpn-target 1:1</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen27230500214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1589207667214056">*</span>PE2-evpn-instance-evrf1] <strong id="EN-US_TASK_0172370670__b896234016214056">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen264799904214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1444575225214056">*</span>PE2] <strong id="EN-US_TASK_0172370670__b1938998862214056">ip vpn-instance vpn1</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1115824851214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1837640495214056">*</span>PE2-vpn-instance-vpn1] <strong id="EN-US_TASK_0172370670__b246129853214056">ipv4-family</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen987032125214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1178429891214056">*</span>PE2-vpn-instance-vpn1-af-ipv4] <strong id="EN-US_TASK_0172370670__b738589392214056">route-distinguisher 200:2</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen2082384750214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword167633002214056">*</span>PE2-vpn-instance-vpn1-af-ipv4] <strong id="EN-US_TASK_0172370670__b650427620214056">vpn-target 2:2 evpn</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1035138310214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1545447649214056">*</span>PE2-vpn-instance-vpn1-af-ipv4] <strong id="EN-US_TASK_0172370670__b946001646214056">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen203226146214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1584199055214056">*</span>PE2-vpn-instance-vpn1] <strong id="EN-US_TASK_0172370670__b1445673462214056">evpn mpls routing-enable</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1221389255214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword138576368214056">*</span>PE2-vpn-instance-vpn1] <strong id="EN-US_TASK_0172370670__b2009257516214056">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen997876501214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1678434600214056">*</span>PE2] <strong id="EN-US_TASK_0172370670__b1775883022214056">bridge-domain 10</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1535197050214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword689157122214056">*</span>PE2-bd10] <strong id="EN-US_TASK_0172370670__b1097343037214056">evpn binding vpn-instance evrf1</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1978443688214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1471731730214056">*</span>PE2-bd10] <strong id="EN-US_TASK_0172370670__b1083009378214056">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen258613396214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword201933806214056">*</span>PE2] <strong id="EN-US_TASK_0172370670__b413543572214056">commit</strong></pre>
</p></li><li id="EN-US_TASK_0172370670__step1833724365214056"><span id="EN-US_TASK_0172370670__cmd867584458214056">Configure a source address on each PE.</span><p><p id="EN-US_TASK_0172370670__p250040642214056"># Configure PE1.</p>
<pre class="screen" id="EN-US_TASK_0172370670__screen2135838434214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword943870505214056"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong id="EN-US_TASK_0172370670__b1119425959214056">evpn source-address 1.1.1.1</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1367738133214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1661902661214056">*</span>PE1] <strong id="EN-US_TASK_0172370670__b294596589214056">commit</strong></pre>
<p id="EN-US_TASK_0172370670__p1528109460214056"># Configure PE2.</p>
<pre class="screen" id="EN-US_TASK_0172370670__screen878424254214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword907249245214056"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong id="EN-US_TASK_0172370670__b2108522979214056">evpn source-address 3.3.3.3</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1947122915214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1035031908214056">*</span>PE2] <strong id="EN-US_TASK_0172370670__b1795126963214056">commit</strong></pre>
</p></li><li id="EN-US_TASK_0172370670__step857470608214056"><span id="EN-US_TASK_0172370670__cmd1893237286214056">Configure Layer 2 Ethernet sub-interfaces used by PEs to connect to CEs.</span><p><p id="EN-US_TASK_0172370670__p2118048278214056"># Configure PE1.</p>
<pre class="screen" id="EN-US_TASK_0172370670__screen1435726127214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword268294990214056"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong id="EN-US_TASK_0172370670__b1190764447214056">interface GigabitEthernet <span>0/1/0</span></strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1361130040214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1797055962214056">*</span>PE1-Gigabitethernet<span>0/1/0</span>] <strong id="EN-US_TASK_0172370670__b96896758214056">esi 0011.1111.1111.1111.1111</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen484394247214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1803144394214056">*</span>PE1-Gigabitethernet<span>0/1/0</span>] <strong id="EN-US_TASK_0172370670__b397559394214056">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen735078405214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1085567056214056">*</span>PE1] <strong id="EN-US_TASK_0172370670__b917681361214056">interface GigabitEthernet <span>0/1/0</span>.1 mode l2</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen614911519214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword242696884214056">*</span>PE1-GigabitEthernet <span>0/1/0</span>.1] <strong id="EN-US_TASK_0172370670__b1855447493214056">encapsulation dot1q vid 10</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen526139784214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword948078055214056">*</span>PE1-GigabitEthernet <span>0/1/0</span>.1] <strong id="EN-US_TASK_0172370670__b2146360962214056">rewrite pop single</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1070130807214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword808831510214056">*</span>PE1-GigabitEthernet <span>0/1/0</span>.1] <strong id="EN-US_TASK_0172370670__b1643560914214056">bridge-domain 10</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen657389137214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword65122202214056">*</span>PE1-GigabitEthernet <span>0/1/0</span>.1] <strong id="EN-US_TASK_0172370670__b1156302934214056">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen776988656214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword477968601214056">*</span>PE1] <strong id="EN-US_TASK_0172370670__b1240007645214056">commit</strong></pre>
<p id="EN-US_TASK_0172370670__p1941145891214056"># Configure PE2.</p>
<pre class="screen" id="EN-US_TASK_0172370670__screen2073042567214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword2125604032214056"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong id="EN-US_TASK_0172370670__b1798465924214056">interface GigabitEthernet <span>0/1/0</span></strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen2063319771214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1952930833214056">*</span>PE2-Gigabitethernet<span>0/1/0</span>] <strong id="EN-US_TASK_0172370670__b414081466214056">esi 0011.1111.1111.1111.2222</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen319373114214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword17083835214056">*</span>PE2-Gigabitethernet<span>0/1/0</span>] <strong id="EN-US_TASK_0172370670__b379048989214056">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1312033806214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1740106166214056">*</span>PE2] <strong id="EN-US_TASK_0172370670__b450811082214056">interface GigabitEthernet <span>0/1/0</span>.1 mode l2</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen497900342214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1508405435214056">*</span>PE2-GigabitEthernet <span>0/1/0</span>.1] <strong id="EN-US_TASK_0172370670__b1625211133214056">encapsulation dot1q vid 10</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1504246098214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1189509414214056">*</span>PE2-GigabitEthernet <span>0/1/0</span>.1] <strong id="EN-US_TASK_0172370670__b1407213509214056">rewrite pop single</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen899889197214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1175339255214056">*</span>PE2-GigabitEthernet <span>0/1/0</span>.1] <strong id="EN-US_TASK_0172370670__b774293702214056">bridge-domain 10</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen2006316438214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1223627440214056">*</span>PE2-GigabitEthernet <span>0/1/0</span>.1] <strong id="EN-US_TASK_0172370670__b1677512278214056">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1355328884214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1305468055214056">*</span>PE2] <strong id="EN-US_TASK_0172370670__b958338835214056">commit</strong></pre>
</p></li><li id="EN-US_TASK_0172370670__step214994679214056"><span id="EN-US_TASK_0172370670__cmd1348075699214056">Bind the VBDIF interface to a VPN instance on each PE.</span><p><p id="EN-US_TASK_0172370670__p406188183214056"># Configure PE1.</p>
<pre class="screen" id="EN-US_TASK_0172370670__screen347273102214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1543388253214056"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong id="EN-US_TASK_0172370670__b98280578214056">interface Vbdif10</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1820103899214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword140043524214056">*</span>PE1-Vbdif10] <strong id="EN-US_TASK_0172370670__b839095771214056">ip binding vpn-instance vpn1</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1626986732214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword140785576214056">*</span>PE1-Vbdif10] <strong id="EN-US_TASK_0172370670__b578750343214056">ip address 192.168.1.1 255.255.255.0</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen62101456161016">[<span class="keyword" id="EN-US_TASK_0172370670__keyword152492191119">*</span>PE1-Vbdif10] <strong id="EN-US_TASK_0172370670__b168561112161119">arp collect host enable</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen11422027214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword360114807214056">*</span>PE1-Vbdif10] <strong id="EN-US_TASK_0172370670__b408844808214056">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1585138165214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword269331589214056">*</span>PE1] <strong id="EN-US_TASK_0172370670__b1061166854214056">commit</strong></pre>
<p id="EN-US_TASK_0172370670__p1773826266214056"># Configure PE2.</p>
<pre class="screen" id="EN-US_TASK_0172370670__screen1245307833214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1954595478214056"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong id="EN-US_TASK_0172370670__b1912881267214056">interface Vbdif10</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1807488493214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword995240171214056">*</span>PE2-Vbdif10] <strong id="EN-US_TASK_0172370670__b1641894149214056">ip binding vpn-instance vpn1</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1556208873214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword92748746214056">*</span>PE2-Vbdif10] <strong id="EN-US_TASK_0172370670__b1936799046214056">ip address 192.168.2.1 255.255.255.0</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen117432412112">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1640312914112">*</span>PE2-Vbdif10] <strong id="EN-US_TASK_0172370670__b1363123481110">arp collect host enable</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1264082940214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword2055379629214056">*</span>PE2-Vbdif10] <strong id="EN-US_TASK_0172370670__b414854391214056">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen2133783243214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword346114691214056">*</span>PE2] <strong id="EN-US_TASK_0172370670__b1928430539214056">commit</strong></pre>
</p></li><li id="EN-US_TASK_0172370670__step252454775214056"><span id="EN-US_TASK_0172370670__cmd1727200600214056">Configure and apply a tunnel policy to enable EVPN service recursion to the SR-MPLS TE tunnel.</span><p><p id="EN-US_TASK_0172370670__p103639199214056"># Configure PE1.</p>
<pre class="screen" id="EN-US_TASK_0172370670__screen2983814214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword630910538214056"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong id="EN-US_TASK_0172370670__b1470457290214056">tunnel-policy srte</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1042805957214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword99423610214056">*</span>PE1-tunnel-policy-srte] <strong id="EN-US_TASK_0172370670__b1607625123214056">tunnel binding destination 3.3.3.3 te Tunnel1</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1809911183214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1605032256214056">*</span>PE1-tunnel-policy-srte] <strong id="EN-US_TASK_0172370670__b1831108120214056">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen2052546463214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1726789900214056">*</span>PE1] <strong id="EN-US_TASK_0172370670__b72926872214056">evpn vpn-instance evrf1 bd-mode</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen942916695214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword995497183214056">*</span>PE1-evpn-instance-evrf1] <strong id="EN-US_TASK_0172370670__b1190936008214056">tnl-policy srte</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen670814056214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword389953085214056">*</span>PE1-evpn-instance-evrf1] <strong id="EN-US_TASK_0172370670__b602377963214056">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1888080579214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword424619050214056">*</span>PE1] <strong id="EN-US_TASK_0172370670__b1375361300214056">ip vpn-instance vpn1</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen643621699214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1476194673214056">*</span>PE1-vpn-instance-vpn1] <strong id="EN-US_TASK_0172370670__b333170423214056">tnl-policy srte evpn</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1108408827214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword992011608214056">*</span>PE1-vpn-instance-vpn1] <strong id="EN-US_TASK_0172370670__b1564797628214056">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1887193726214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1107458438214056">*</span>PE1] <strong id="EN-US_TASK_0172370670__b848268511214056">commit</strong></pre>
<p id="EN-US_TASK_0172370670__p1478407378214056"># Configure PE2.</p>
<pre class="screen" id="EN-US_TASK_0172370670__screen1023615030214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword2053640238214056"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong id="EN-US_TASK_0172370670__b1177520044214056">tunnel-policy srte</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen176101802214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1123361171214056">*</span>PE2-tunnel-policy-srte] <strong id="EN-US_TASK_0172370670__b1544592958214056">tunnel binding destination 1.1.1.1 te Tunnel1</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen594488915214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword2050268703214056">*</span>PE2-tunnel-policy-srte] <strong id="EN-US_TASK_0172370670__b626588977214056">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen235083457214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword2067659814214056">*</span>PE2] <strong id="EN-US_TASK_0172370670__b1215627180214056">evpn vpn-instance evrf1 bd-mode</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen996249050214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1023771238214056">*</span>PE2-evpn-instance-evrf1] <strong id="EN-US_TASK_0172370670__b453357474214056">tnl-policy srte</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen790559593214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword555300037214056">*</span>PE2-evpn-instance-evrf1] <strong id="EN-US_TASK_0172370670__b1337449327214056">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen487792901214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword578700596214056">*</span>PE2] <strong id="EN-US_TASK_0172370670__b848195992214056">ip vpn-instance vpn1</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1502333880214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1348063395214056">*</span>PE2-vpn-instance-vpn1] <strong id="EN-US_TASK_0172370670__b547753136214056">tnl-policy srte evpn</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen2057123819214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword188727432214056">*</span>PE2-vpn-instance-vpn1] <strong id="EN-US_TASK_0172370670__b2077088732214056">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1254933189214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword2036909716214056">*</span>PE2] <strong id="EN-US_TASK_0172370670__b1481688378214056">commit</strong></pre>
</p></li><li id="EN-US_TASK_0172370670__step84055934214056"><span id="EN-US_TASK_0172370670__cmd1831326659214056">Establish a BGP EVPN peer relationship between PEs.</span><p><p id="EN-US_TASK_0172370670__p1600475811214056"># Configure PE1.</p>
<pre class="screen" id="EN-US_TASK_0172370670__screen334105883214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1837042311214056"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong id="EN-US_TASK_0172370670__b675062585214056">bgp 100</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen620855032214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1432016609214056">*</span>PE1-bgp] <strong id="EN-US_TASK_0172370670__b713259482214056">peer 3.3.3.3 as-number 100</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1362407640214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1105849071214056">*</span>PE1-bgp] <strong id="EN-US_TASK_0172370670__b1759895499214056">peer 3.3.3.3 connect-interface loopback 1</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen647624884214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1691861948214056">*</span>PE1-bgp] <strong id="EN-US_TASK_0172370670__b1038326686214056">l2vpn-family evpn</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1388270649214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1102814251214056">*</span>PE1-bgp-af-evpn] <strong id="EN-US_TASK_0172370670__b664222190214056">peer 3.3.3.3 enable</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1520869211214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword150286055214056">*</span>PE1-bgp-af-evpn] <strong id="EN-US_TASK_0172370670__b565780830214056">peer 3.3.3.3 advertise irb</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen2044414644214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword685602696214056">*</span>PE1-bgp-af-evpn] <strong id="EN-US_TASK_0172370670__b379742990214056">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen2077631366214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword988927136214056">*</span>PE1-bgp] <strong id="EN-US_TASK_0172370670__b223759528214056">ipv4-family vpn-instance vpn1</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen835540521214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword78015385214056">*</span>PE1-bgp-vpn1] <strong id="EN-US_TASK_0172370670__b395217628214056">import-route direct</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1336397728214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword473891025214056">*</span>PE1-bgp-vpn1] <strong id="EN-US_TASK_0172370670__b535577906214056">advertise l2vpn evpn</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen286879343214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword520087729214056">*</span>PE1-bgp-vpn1] <strong id="EN-US_TASK_0172370670__b1101793238214056">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1111574347214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword2063869993214056">*</span>PE1-bgp] <strong id="EN-US_TASK_0172370670__b1920434486214056">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1207526526214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword760727878214056">*</span>PE1] <strong id="EN-US_TASK_0172370670__b968438708214056">commit</strong></pre>
<p id="EN-US_TASK_0172370670__p1293956897214056"># Configure PE2.</p>
<pre class="screen" id="EN-US_TASK_0172370670__screen395082837214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1100171079214056"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong id="EN-US_TASK_0172370670__b667310381214056">bgp 100</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1120371312214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword600301580214056">*</span>PE2-bgp] <strong id="EN-US_TASK_0172370670__b111772146214056">peer 1.1.1.1 as-number 100</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1848672134214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1091495145214056">*</span>PE2-bgp] <strong id="EN-US_TASK_0172370670__b305596626214056">peer 1.1.1.1 connect-interface loopback 1</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen532692786214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1782971904214056">*</span>PE2-bgp] <strong id="EN-US_TASK_0172370670__b1231731636214056">l2vpn-family evpn</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen2116138026214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword742355069214056">*</span>PE2-bgp-af-evpn] <strong id="EN-US_TASK_0172370670__b1703228460214056">peer 1.1.1.1 enable</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen710583652214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1878561501214056">*</span>PE2-bgp-af-evpn] <strong id="EN-US_TASK_0172370670__b1572916621214056">peer 1.1.1.1 advertise irb</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen558266098214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1559580113214056">*</span>PE2-bgp-af-evpn] <strong id="EN-US_TASK_0172370670__b1065343591214056">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1229730626214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1193896112214056">*</span>PE2-bgp] <strong id="EN-US_TASK_0172370670__b1815065797214056">ipv4-family vpn-instance vpn1</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen583456673214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword523536377214056">*</span>PE2-bgp-vpn1] <strong id="EN-US_TASK_0172370670__b92485274214056">import-route direct</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen811264950214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword260009491214056">*</span>PE2-bgp-vpn1] <strong id="EN-US_TASK_0172370670__b735235028214056">advertise l2vpn evpn</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen748395689214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1260446050214056">*</span>PE2-bgp-vpn1] <strong id="EN-US_TASK_0172370670__b1053965055214056">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen246725591214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1113374673214056">*</span>PE2-bgp] <strong id="EN-US_TASK_0172370670__b1849071450214056">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1399466154214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1027321092214056">*</span>PE2] <strong id="EN-US_TASK_0172370670__b331790940214056">commit</strong></pre>
<p id="EN-US_TASK_0172370670__p802175298214056">After completing the configurations, run the <strong id="EN-US_TASK_0172370670__b165892939754011">display bgp evpn peer</strong> command. The command output shows that the BGP peer relationships are in the <strong id="EN-US_TASK_0172370670__b192890719754011">Established</strong> state, indicating that BGP peer relationships have been successfully established between the PEs. The following example uses the command output on PE1.</p>
<pre class="screen" id="EN-US_TASK_0172370670__screen935752241214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword66896349214056"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong id="EN-US_TASK_0172370670__b1680005042214056">display bgp evpn peer</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen631461349214056"> 
 BGP local router ID : 1.1.1.1
 Local AS number : 100
 Total number of peers : 1                 Peers in established state : 1

  Peer            V          AS  MsgRcvd  MsgSent  OutQ  Up/Down       State  PrefRcv
  3.3.3.3         4         100        9        9     0 00:00:02 Established        5</pre>
</p></li><li id="EN-US_TASK_0172370670__step375118767214056"><span id="EN-US_TASK_0172370670__cmd1756613024214056">Configure CEs and PEs to communicate.</span><p><p id="EN-US_TASK_0172370670__p421012427214056"># Configure CE1.</p>
<pre class="screen" id="EN-US_TASK_0172370670__screen919909502214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword397201931214056"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong id="EN-US_TASK_0172370670__b966227058214056">interface GigabitEthernet <span>0/1/0</span>.1 mode l2</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1330809115214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword918832146214056">*</span>CE1-GigabitEthernet<span>0/1/0</span>.1] <strong id="EN-US_TASK_0172370670__b2101110920214056">encapsulation dot1q vid 10</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen129392579214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1382549760214056">*</span>CE1-GigabitEthernet<span>0/1/0</span>.1] <strong id="EN-US_TASK_0172370670__b1749626117214056">rewrite pop single</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1090270130214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword813385883214056">*</span>CE1-GigabitEthernet<span>0/1/0</span>.1] <strong id="EN-US_TASK_0172370670__b1165270340214056">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen17259939131516">[<span class="keyword" id="EN-US_TASK_0172370670__keyword4954113951512">*</span>CE1] <strong id="EN-US_TASK_0172370670__b69541139171519">commit</strong></pre>
<p id="EN-US_TASK_0172370670__p241452959214056"># Configure CE2.</p>
<pre class="screen" id="EN-US_TASK_0172370670__screen359666155214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1070858165214056"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong id="EN-US_TASK_0172370670__b943066927214056">interface GigabitEthernet <span>0/1/0</span>.1 mode l2</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1033351776214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword2123544742214056">*</span>CE2-GigabitEthernet<span>0/1/0</span>.1] <strong id="EN-US_TASK_0172370670__b136681064214056">encapsulation dot1q vid 10</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1803058508214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword75242276214056">*</span>CE2-GigabitEthernet<span>0/1/0</span>.1] <strong id="EN-US_TASK_0172370670__b1747236895214056">rewrite pop single</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1139097483214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword844536406214056">*</span>CE2-GigabitEthernet<span>0/1/0</span>.1] <strong id="EN-US_TASK_0172370670__b55954250214056">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen1939274991518">[<span class="keyword" id="EN-US_TASK_0172370670__keyword1291165051512">*</span>CE2] <strong id="EN-US_TASK_0172370670__b32911501153">commit</strong></pre>
</p></li><li id="EN-US_TASK_0172370670__step309619172214056"><span id="EN-US_TASK_0172370670__cmd416547123214056">Verify the configuration.</span><p><p id="EN-US_TASK_0172370670__p1967703310214056">Run the <strong id="EN-US_TASK_0172370670__b256381563214056">display bgp evpn all routing-table</strong> command on each PE. The command output shows EVPN routes sent from the remote PE. The following example uses the command output on PE1.</p>
<pre class="screen" id="EN-US_TASK_0172370670__screen576970771214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword92178631214056"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong id="EN-US_TASK_0172370670__b506387588214056">display bgp evpn all routing-table</strong>

 Local AS number : 100

 BGP Local router ID is 1.1.1.1
 Status codes: * - valid, &gt; - best, d - damped, x - best external, a - add path,
               h - history,  i - internal, s - suppressed, S - Stale
               Origin : i - IGP, e - EGP, ? - incomplete

 
 EVPN address family:
 Number of A-D Routes: 4
 Route Distinguisher: 100:1
       Network(ESI/EthTagId)                                  NextHop
 *&gt;    0011.1111.1111.1111.1111:0                             127.0.0.1
 Route Distinguisher: 200:1
       Network(ESI/EthTagId)                                  NextHop
 *&gt;i   0011.1111.1111.1111.2222:0                             3.3.3.3
 Route Distinguisher: 1.1.1.1:0
       Network(ESI/EthTagId)                                  NextHop
 *&gt;    0011.1111.1111.1111.1111:4294967295                    127.0.0.1
 Route Distinguisher: 3.3.3.3:0
       Network(ESI/EthTagId)                                  NextHop
 *&gt;i   0011.1111.1111.1111.2222:4294967295                    3.3.3.3
    

 EVPN-Instance evrf1:
 Number of A-D Routes: 3
       Network(ESI/EthTagId)                                  NextHop
 *&gt;    0011.1111.1111.1111.1111:0                             127.0.0.1
 *&gt;i   0011.1111.1111.1111.2222:0                             3.3.3.3
 *&gt;i   0011.1111.1111.1111.2222:4294967295                    3.3.3.3
 
 EVPN address family:
 Number of Mac Routes: 2
 Route Distinguisher: 100:1
       Network(EthTagId/MacAddrLen/MacAddr/IpAddrLen/IpAddr)  NextHop
 *&gt;    0:48:00e0-fc12-7890:0:0.0.0.0                          0.0.0.0
 Route Distinguisher: 200:1
       Network(EthTagId/MacAddrLen/MacAddr/IpAddrLen/IpAddr)  NextHop
 *&gt;i   0:48:00e0-fc12-3456:0:0.0.0.0                          3.3.3.3
    

 EVPN-Instance evrf1:
 Number of Mac Routes: 2
       Network(EthTagId/MacAddrLen/MacAddr/IpAddrLen/IpAddr)  NextHop
 *&gt;i   0:48:00e0-fc12-3456:0:0.0.0.0                          3.3.3.3
 *&gt;    0:48:00e0-fc12-7890:0:0.0.0.0                          0.0.0.0
 
 EVPN address family:
 Number of Inclusive Multicast Routes: 2
 Route Distinguisher: 100:1
       Network(EthTagId/IpAddrLen/OriginalIp)                 NextHop
 *&gt;    0:32:1.1.1.1                                           127.0.0.1
 Route Distinguisher: 200:1
       Network(EthTagId/IpAddrLen/OriginalIp)                 NextHop
 *&gt;i   0:32:3.3.3.3                                           3.3.3.3
    

 EVPN-Instance evrf1:
 Number of Inclusive Multicast Routes: 2
       Network(EthTagId/IpAddrLen/OriginalIp)                 NextHop
 *&gt;    0:32:1.1.1.1                                           127.0.0.1
 *&gt;i   0:32:3.3.3.3                                           3.3.3.3
 
 EVPN address family:
 Number of ES Routes: 2
 Route Distinguisher: 1.1.1.1:0
       Network(ESI)                                           NextHop
 *&gt;    0011.1111.1111.1111.1111                               127.0.0.1
 Route Distinguisher: 3.3.3.3:0
       Network(ESI)                                           NextHop
 *&gt;i   0011.1111.1111.1111.2222                               3.3.3.3
    

 EVPN-Instance evrf1:
 Number of ES Routes: 1
       Network(ESI)                                           NextHop
 *&gt;    0011.1111.1111.1111.1111                               127.0.0.1
 
 EVPN address family:
 Number of Ip Prefix Routes: 2
 Route Distinguisher: 100:2
       Network(EthTagId/IpPrefix/IpPrefixLen)                 NextHop
 *&gt;    0:192.168.1.0:24                                       0.0.0.0
 Route Distinguisher: 200:2
       Network(EthTagId/IpPrefix/IpPrefixLen)                 NextHop
 *&gt;i   0:192.168.2.0:24                                       3.3.3.3</pre>
<p id="EN-US_TASK_0172370670__p2105595585214056">Run the <strong id="EN-US_TASK_0172370670__b2093616570214056">display bgp evpn all routing-table mac-route 0:48:00e0-fc12-3456:0:0.0.0.0</strong> or <strong id="EN-US_TASK_0172370670__b1992242776214056">display bgp evpn all routing-table prefix-route 0:192.168.2.0:24</strong> command on PE1 to check detailed information about MAC routes or IP prefix routes. The command output shows the name of the tunnel interfaces to which the routes recurse.</p>
<pre class="screen" id="EN-US_TASK_0172370670__screen624391269214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword51262720214056"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong id="EN-US_TASK_0172370670__b48431190213">display bgp evpn all routing-table mac-route 0:48:00e0-fc12-3456:0:0.0.0.0</strong>

 BGP local router ID : 1.1.1.1
 Local AS number : 100
 Total routes of Route Distinguisher(200:1): 1
 BGP routing table entry information of 0:48:00e0-fc12-3456:0:0.0.0.0:
 Label information (Received/Applied): 54011 48182/NULL
 From: 3.3.3.3 (10.2.1.2) 
 Route Duration: 0d20h42m36s
 Relay IP Nexthop: 10.1.1.2
 Relay IP Out-Interface: GigabitEthernet<span>0/2/0</span>
 Relay Tunnel Out-Interface: GigabitEthernet<span>0/2/0</span>
 Original nexthop: 3.3.3.3
 Qos information : 0x0
 Ext-Community: RT &lt;1 : 1&gt;, SoO &lt;3.3.3.3 : 0&gt;, Mac Mobility &lt;flag:1 seq:0 res:0&gt;
 AS-path Nil, origin incomplete, localpref 100, pref-val 0, valid, internal, best, select, pre 255, IGP cost 20
 Route Type: 2 (MAC Advertisement Route)
 Ethernet Tag ID: 0, MAC Address/Len: 00e0-fc12-3456/48, IP Address/Len: 0.0.0.0/0, ESI:0000.0000.0000.0000.0000
 Not advertised to any peer yet
 
    

 EVPN-Instance evrf1:
 Number of Mac Routes: 1
 BGP routing table entry information of 0:48:00e0-fc12-3456:0:0.0.0.0:
 Route Distinguisher: 200:1
 Remote-Cross route
 Label information (Received/Applied): 54011 48182/NULL
 From: 3.3.3.3 (10.2.1.2) 
 Route Duration: 0d20h42m36s
 Relay Tunnel Out-Interface: <strong id="EN-US_TASK_0172370670__b827515866214056">Tunnel1</strong>
 Original nexthop: 3.3.3.3
 Qos information : 0x0
 Ext-Community: RT &lt;1 : 1&gt;, SoO &lt;3.3.3.3 : 0&gt;, Mac Mobility &lt;flag:1 seq:0 res:0&gt;
 AS-path Nil, origin incomplete, localpref 100, pref-val 0, valid, internal, best, select, pre 255
 Route Type: 2 (MAC Advertisement Route)
 Ethernet Tag ID: 0, MAC Address/Len: 00e0-fc12-3456/48, IP Address/Len: 0.0.0.0/0, ESI:0000.0000.0000.0000.0000
 Not advertised to any peer yet</pre>
<pre class="screen" id="EN-US_TASK_0172370670__screen584953942214056">[<span class="keyword" id="EN-US_TASK_0172370670__keyword475981645214056"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong id="EN-US_TASK_0172370670__b1675135521214056">display bgp evpn all routing-table prefix-route 0:192.168.2.0:24</strong>

 BGP local router ID : 1.1.1.1
 Local AS number : 100
 Total routes of Route Distinguisher(200:2): 1
 BGP routing table entry information of 0:192.168.2.0:24:
 Label information (Received/Applied): 48185/NULL
 From: 3.3.3.3 (10.2.1.2) 
 Route Duration: 0d20h38m31s
 Relay IP Nexthop: 10.1.1.2
 Relay IP Out-Interface: GigabitEthernet<span>0/2/0</span>
 Relay Tunnel Out-Interface: GigabitEthernet<span>0/2/0</span>
 Original nexthop: 3.3.3.3
 Qos information : 0x0
 Ext-Community: RT &lt;2 : 2&gt;
 AS-path Nil, origin incomplete, MED 0, localpref 100, pref-val 0, valid, internal, best, select, pre 255, IGP cost 20
 Route Type: 5 (Ip Prefix Route)
 Ethernet Tag ID: 0, IP Prefix/Len: 192.168.2.0/24, ESI: 0000.0000.0000.0000.0000, GW IP Address: 0.0.0.0
 Not advertised to any peer yet</pre>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0172370670__file1"><a name="EN-US_TASK_0172370670__1.4.6"></a><a name="1.4.6"></a><h4 class="sectiontitle">Configuration Files</h4><ul id="EN-US_TASK_0172370670__ul705625894214056"><li id="EN-US_TASK_0172370670__li758715163214056"><p id="EN-US_TASK_0172370670__p2115332302214056"><a name="EN-US_TASK_0172370670__li758715163214056"></a><a name="li758715163214056"></a>PE1 configuration file</p>
<pre class="screen" id="EN-US_TASK_0172370670__screen414189794214056">#
sysname PE1
#
evpn vpn-instance evrf1 bd-mode
 route-distinguisher 100:1
 tnl-policy srte
 vpn-target 1:1 export-extcommunity
 vpn-target 1:1 import-extcommunity
#
ip vpn-instance vpn1
 ipv4-family
  route-distinguisher 100:2
<span>  apply-label per-instance</span>
  vpn-target 2:2 export-extcommunity evpn
  vpn-target 2:2 import-extcommunity evpn
  tnl-policy srte evpn
  evpn mpls routing-enable
#
mpls lsr-id 1.1.1.1
#
mpls
 mpls te
#
bridge-domain 10
 evpn binding vpn-instance evrf1
#
explicit-path pe1tope2
 next sid label 48121 type adjacency index 1
 next sid label 48120 type adjacency index 2
#
segment-routing
#
isis 1
 is-level level-2
 cost-style wide
 network-entity 00.1111.1111.1111.00
 traffic-eng level-2
 segment-routing mpls
 segment-routing global-block 153616 153800
#
interface Vbdif10
 ip binding vpn-instance vpn1
 ip address 192.168.1.1 255.255.255.0
<strong id="EN-US_TASK_0172370670__b13105185410111"> </strong>arp collect host enable
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 esi 0011.1111.1111.1111.1111
#
interface GigabitEthernet<span>0/1/0</span>.1 mode l2
 encapsulation dot1q vid 10
 rewrite pop single
 bridge-domain 10
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.1.1.1 255.255.255.0
 isis enable 1
#
interface LoopBack1
 ip address 1.1.1.1 255.255.255.255
 isis enable 1
 isis prefix-sid absolute 153700 
#
interface Tunnel1
 ip address unnumbered interface LoopBack1
 tunnel-protocol mpls te
 destination 3.3.3.3
 mpls te signal-protocol segment-routing
 mpls te reserved-for-binding
 mpls te tunnel-id 1
 mpls te path explicit-path pe1tope2  
#
bgp 100
 peer 3.3.3.3 as-number 100
 peer 3.3.3.3 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 3.3.3.3 enable
 #
 ipv4-family vpn-instance vpn1
  import-route direct
  advertise l2vpn evpn
 #
 l2vpn-family evpn
  policy vpn-target
  peer 3.3.3.3 enable
  peer 3.3.3.3 advertise irb
#
tunnel-policy srte
 tunnel binding destination 3.3.3.3 te Tunnel1
#
evpn source-address 1.1.1.1
#
return</pre>
</li><li id="EN-US_TASK_0172370670__li1190688807214056"><p id="EN-US_TASK_0172370670__p1654156503214056"><a name="EN-US_TASK_0172370670__li1190688807214056"></a><a name="li1190688807214056"></a>P configuration file</p>
<pre class="screen" id="EN-US_TASK_0172370670__screen1389968958214056">#
sysname P
#
mpls lsr-id 2.2.2.2
#
mpls
 mpls te
#
segment-routing
#
isis 1
 is-level level-2
 cost-style wide
 network-entity 00.1111.1111.2222.00
 traffic-eng level-2
 segment-routing mpls
 segment-routing global-block 153616 153800
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.1.2 255.255.255.0
 isis enable 1
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.2.1.1 255.255.255.0
 isis enable 1
#
interface LoopBack1
 ip address 2.2.2.2 255.255.255.255
 isis enable 1
 isis prefix-sid absolute 153710 
#
return</pre>
</li><li id="EN-US_TASK_0172370670__li821525005214056"><p id="EN-US_TASK_0172370670__p1198392472214056"><a name="EN-US_TASK_0172370670__li821525005214056"></a><a name="li821525005214056"></a>PE2 configuration file</p>
<pre class="screen" id="EN-US_TASK_0172370670__screen202510463214056">#
sysname PE2
#
evpn vpn-instance evrf1 bd-mode
 route-distinguisher 200:1
 tnl-policy srte
 vpn-target 1:1 export-extcommunity
 vpn-target 1:1 import-extcommunity
#
ip vpn-instance vpn1
 ipv4-family
  route-distinguisher 200:2
<span>  apply-label per-instance</span>
  vpn-target 2:2 export-extcommunity evpn
  vpn-target 2:2 import-extcommunity evpn
  tnl-policy srte evpn
  evpn mpls routing-enable
#
mpls lsr-id 3.3.3.3
#
mpls
 mpls te
#
bridge-domain 10
 evpn binding vpn-instance evrf1
#
explicit-path pe2tope1
 next sid label 48220 type adjacency index 1
 next sid label 48221 type adjacency index 2
#
segment-routing
#
isis 1
 is-level level-2
 cost-style wide
 network-entity 00.1111.1111.3333.00
 traffic-eng level-2
 segment-routing mpls
 segment-routing global-block 153616 153800
#
interface Vbdif10
 ip binding vpn-instance vpn1
 ip address 192.168.2.1 255.255.255.0
<strong id="EN-US_TASK_0172370670__b12391340141212"> </strong>arp collect host enable
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 esi 0011.1111.1111.1111.2222
#
interface GigabitEthernet<span>0/1/0</span>.1 mode l2
 encapsulation dot1q vid 10
 rewrite pop single
 bridge-domain 10
#               
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.2.1.2 255.255.255.0
 isis enable 1
#
interface LoopBack1
 ip address 3.3.3.3 255.255.255.255
 isis enable 1
 isis prefix-sid absolute 153720 
#
interface Tunnel1
 ip address unnumbered interface LoopBack1
 tunnel-protocol mpls te
 destination 1.1.1.1
 mpls te signal-protocol segment-routing
 mpls te reserved-for-binding
 mpls te tunnel-id 1
 mpls te path explicit-path pe2tope1  
#
bgp 100
 peer 1.1.1.1 as-number 100
 peer 1.1.1.1 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 1.1.1.1 enable
 #
 ipv4-family vpn-instance vpn1
  import-route direct
  advertise l2vpn evpn
 #
 l2vpn-family evpn
  policy vpn-target
  peer 1.1.1.1 enable
  peer 1.1.1.1 advertise irb
#
tunnel-policy srte
 tunnel binding destination 1.1.1.1 te Tunnel1
#
evpn source-address 3.3.3.3
#
return</pre>
</li><li id="EN-US_TASK_0172370670__li1404164734214056"><p id="EN-US_TASK_0172370670__p1098887455214056"><a name="EN-US_TASK_0172370670__li1404164734214056"></a><a name="li1404164734214056"></a>CE1 configuration file</p>
<pre class="screen" id="EN-US_TASK_0172370670__screen534665720214056">#
sysname CE1
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
#
interface GigabitEthernet<span>0/1/0</span>.1 mode l2
 encapsulation dot1q vid 10
 rewrite pop single
#
return</pre>
</li><li id="EN-US_TASK_0172370670__li821651942214056"><p id="EN-US_TASK_0172370670__p1184338984214056"><a name="EN-US_TASK_0172370670__li821651942214056"></a><a name="li821651942214056"></a>CE2 configuration file</p>
<pre class="screen" id="EN-US_TASK_0172370670__screen788308506214056">#
sysname CE2
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
#
interface GigabitEthernet<span>0/1/0</span>.1 mode l2
 encapsulation dot1q vid 10
 rewrite pop single
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0010.html">EVPN Configuration Examples
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_vpls_evpn-over-srv6_exp2.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0127.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>

<script language="JavaScript">
<!--
image_size('.imgResize');
var msg_imageMax = "view original image";
var msg_imageClose = "close";
//--></script></body>
</html>