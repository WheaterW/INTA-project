
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring EVPN ORF">
<meta name="abstract" content="This section provides an example for configuring EVPN ORF. This configuration reduces the EVPN route receiving pressure of devices and saves network resources.">
<meta name="description" content="This section provides an example for configuring EVPN ORF. This configuration reduces the EVPN route receiving pressure of devices and saves network resources.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0010.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0095.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0051.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="p00915595,w00800033,w00556928,l00468467,w00606909,evpnvrp,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="p00915595">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00878323">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172370612">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring EVPN ORF</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172370612"></a><a name="EN-US_TASK_0172370612"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring EVPN ORF</h1>
<div class="taskbody"><p>This section provides an example for configuring EVPN ORF. This configuration reduces the EVPN route receiving pressure of devices and saves network resources.</p>
<div class="context"><a name="EN-US_TASK_0172370612__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0172370612__fig154036585511">Figure 1</a>, to enable different sites to communicate with each other over the backbone network, EVPN is deployed on the network so that PEs can exchange EVPN routes to transmit service traffic. Two EVPN instances named evrf1 and evrf2 are configured on PE1. The EVPN instance named evrf1 is configured on PE2, and the EVPN instance named evrf2 is configured on PE3. To allow each PE to receive only desired routes and minimize system resource consumption in processing unwanted routes, EVPN ORF can be configured.</p>
<div class="fignone" id="EN-US_TASK_0172370612__fig154036585511"><a name="EN-US_TASK_0172370612__fig154036585511"></a><a name="fig154036585511"></a><span class="figcap"><b>Figure 1 </b>Configuring EVPN ORF</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 through 3 in this example represent GigabitEthernet<span>0/1/0</span>, GigabitEthernet<span>0/2/0</span>, and GigabitEthernet<span>0/3/0</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0000001218056152.png" width="NaN" height="NaN"></span><br></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172370612__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Precautions</h4><p>When configuring EVPN ORF, note the following:</p>
<ul><li><p>For the same EVPN instance, the export VPN target list of a site shares VPN targets with the import VPN target lists of the other sites; the import VPN target list of a site shares VPN targets with the export VPN target lists of the other sites.</p>
</li><li><p>Using the local loopback interface address of each PE as the source address is recommended.</p>
</li></ul>
</div></div>
<div class="context"><a name="EN-US_TASK_0172370612__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Assign an IP address to each PE interface, including the loopback interfaces.</p>
</li><li><p>Configure a routing protocol on each PE to ensure Layer 3 communication. OSPF is used in this example.</p>
</li><li><p>Configure MPLS LDP on each PE.</p>
</li><li><p>Configure EVPN instances on the PEs and bind each EVPN instance to a BD.</p>
</li><li><p>Configure a source address on each PE.</p>
</li><li><p>Configure each PE's sub-interface that connects to a CE.</p>
</li><li><p>Configure an ESI for each PE interface that connects to a CE.</p>
</li><li><p>Configure the CEs and PEs to communicate.</p>
</li><li><p>Configure BGP EVPN peer relationships between the PEs and RR, and configure the PEs as RR clients.</p>
</li><li><p>Configure EVPN ORF on each device.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172370612__1.4.4"></a><a name="1.4.4"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>PE1's EVPN instance names: evrf1 and evrf2; PE2's EVPN instance name: evrf1; PE3's EVPN instance name: evrf2</p>
</li><li><p>evrf1's RD (100:1) and RT (1:1); evrf2's RD (100:2) and RT (2:2)</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172370612__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Assign an IP address to each PE interface, including the loopback interfaces.</span><p><p>For detailed configurations, see <a href="#EN-US_TASK_0172370612__file1">Configuration Files</a>.</p>
</p></li><li><span>Configure a routing protocol on each PE to ensure Layer 3 communication. OSPF is used in this example.</span><p><p>For detailed configurations, see <a href="#EN-US_TASK_0172370612__file1">Configuration Files</a>.</p>
</p></li><li><span>Configure MPLS LDP on each PE.</span><p><p>For detailed configurations, see <a href="#EN-US_TASK_0172370612__file1">Configuration Files</a>.</p>
</p></li><li><span>Configure EVPN instances on the PEs and bind each EVPN instance to a BD.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>evpn vpn-instance evrf1 bd-mode</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-evpn-instance-evrf1] <strong>route-distinguisher 100:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-evpn-instance-evrf1] <strong>vpn-target 1:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-evpn-instance-evrf1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>evpn vpn-instance evrf2 bd-mode</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-evpn-instance-evrf2] <strong>route-distinguisher 100:2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-evpn-instance-evrf2] <strong>vpn-target 2:2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-evpn-instance-evrf2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bd10] <strong>evpn binding vpn-instance evrf1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bd10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>bridge-domain 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bd20] <strong>evpn binding vpn-instance evrf2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bd20] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>evpn vpn-instance evrf1 bd-mode</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-evpn-instance-evrf1] <strong>route-distinguisher 100:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-evpn-instance-evrf1] <strong>vpn-target 1:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-evpn-instance-evrf1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bd10] <strong>evpn binding vpn-instance evrf1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bd10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>evpn vpn-instance evrf2 bd-mode</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-evpn-instance-evrf2] <strong>route-distinguisher 100:2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-evpn-instance-evrf2] <strong>vpn-target 2:2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-evpn-instance-evrf2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>bridge-domain 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bd20] <strong>evpn binding vpn-instance evrf2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bd20] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
</p></li><li><span>Configure a source address on each PE.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>evpn source-address 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>evpn source-address 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>evpn source-address 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
</p></li><li><span>Configure each PE's sub-interface that connects to a CE.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface gigabitethernet<span>0/1/0</span>.1 mode l2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1] <strong>encapsulation dot1q vid 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1] <strong>rewrite pop single</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1] <strong>bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet<span>0/1/0</span>.2 mode l2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.2] <strong>encapsulation dot1q vid 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.2] <strong>rewrite pop single</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.2] <strong>bridge-domain 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>interface gigabitethernet<span>0/1/0</span>.1 mode l2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>.1] <strong>encapsulation dot1q vid 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>.1] <strong>rewrite pop single</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>.1] <strong>bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>interface gigabitethernet<span>0/2/0</span>.1 mode l2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/2/0</span>.1] <strong>encapsulation dot1q vid 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/2/0</span>.1] <strong>rewrite pop single</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/2/0</span>.1] <strong>bridge-domain 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/2/0</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
</p></li><li><span>Configure an ESI for each PE interface that connects to a CE.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>esi 0000.1111.1111.1111.1111</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>esi 0000.1111.2222.2222.2222</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>interface gigabitethernet<span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/2/0</span>] <strong>esi 0000.1111.3333.3333.3333</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
</p></li><li><span>Configure the CEs and PEs to communicate.</span><p><p># Configure CE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>interface gigabitethernet<span>0/1/0</span>.1 mode l2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>.1] <strong>encapsulation dot1q vid 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>.1] <strong>rewrite pop single</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>.1] <strong>bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>interface gigabitethernet<span>0/1/0</span>.2 mode l2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>.2] <strong>encapsulation dot1q vid 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>.2] <strong>rewrite pop single</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>.2] <strong>bridge-domain 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>.2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>commit</strong></pre>
<p># Configure CE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>interface gigabitethernet<span>0/1/0</span>.1 mode l2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>.1] <strong>encapsulation dot1q vid 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>.1] <strong>rewrite pop single</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>.1] <strong>bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>commit</strong></pre>
<p># Configure CE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE3] <strong>interface gigabitethernet<span>0/1/0</span>.1 mode l2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-GigabitEthernet<span>0/1/0</span>.1] <strong>encapsulation dot1q vid 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-GigabitEthernet<span>0/1/0</span>.1] <strong>rewrite pop single</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-GigabitEthernet<span>0/1/0</span>.1] <strong>bridge-domain 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-GigabitEthernet<span>0/1/0</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3] <strong>commit</strong></pre>
</p></li><li><span>Configure BGP EVPN peer relationships between the PEs and RR, and configure the PEs as RR clients.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 3.3.3.3 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 3.3.3.3 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>l2vpn-family evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-evpn] <strong>peer 3.3.3.3 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>peer 3.3.3.3 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>peer 3.3.3.3 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>l2vpn-family evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-evpn] <strong>peer 3.3.3.3 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>peer 3.3.3.3 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>peer 3.3.3.3 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>l2vpn-family evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp-af-evpn] <strong>peer 3.3.3.3 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp-af-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
<p># Configure the RR.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RR] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp] <strong>peer 1.1.1.1 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp] <strong>peer 1.1.1.1 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp] <strong>peer 2.2.2.2 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp] <strong>peer 2.2.2.2 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp] <strong>peer 4.4.4.4 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp] <strong>peer 4.4.4.4 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp] <strong>l2vpn-family evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp-af-evpn] <strong>peer 1.1.1.1 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp-af-evpn] <strong>peer 1.1.1.1 reflect-client</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp-af-evpn] <strong>peer 2.2.2.2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp-af-evpn] <strong>peer 2.2.2.2 reflect-client</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp-af-evpn] <strong>peer 4.4.4.4 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp-af-evpn] <strong>peer 4.4.4.4 reflect-client</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp-af-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR] <strong>commit</strong></pre>
<p># Run the <strong>display bgp evpn peer</strong> command on the RR. The command output shows that BGP peer relationships have been established between the PEs and RR and are in the <strong>Established</strong> state.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RR] <strong>display bgp evpn peer</strong></pre>
<pre class="screen">  
 BGP local router ID : 3.3.3.3
 Local AS number : 100
 Total number of peers : 3                 Peers in established state : 3

  Peer            V          AS  MsgRcvd  MsgSent  OutQ  Up/Down       State  PrefRcv
  1.1.1.1         4         100       10       33     0 00:00:19 Established        6
  2.2.2.2         4         100        8       33     0 00:00:20 Established        4
  4.4.4.4         4         100        8       33     0 00:00:21 Established        4</pre>
<p># Run the <strong>display bgp evpn all routing-table peer 2.2.2.2 advertised-routes</strong> and <strong>display bgp evpn all routing-table peer 4.4.4.4 advertised-routes</strong> commands on the RR to view routes advertised to PE2 and PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RR] <strong>display bgp evpn all routing-table peer 2.2.2.2 advertised-routes</strong></pre>
<pre class="screen"> Local AS number : 100

 BGP Local router ID is 3.3.3.3
 Status codes: * - valid, &gt; - best, d - damped, x - best external, a - add path,
               h - history,  i - internal, s - suppressed, S - Stale
               Origin : i - IGP, e - EGP, ? - incomplete

 
 EVPN address family:
 Number of A-D Routes: 7
 Route Distinguisher: 100:1
       Network(ESI/EthTagId)                                  NextHop
 *&gt;i   <strong>0000.1111.1111.1111.1111:0</strong>                         1.1.1.1
 *&gt;i   0000.1111.2222.2222.2222:0                             2.2.2.2
 Route Distinguisher: 100:2
       Network(ESI/EthTagId)                                  NextHop
 *&gt;i   <strong>0000.1111.1111.1111.1111:0</strong>                         1.1.1.1
 *&gt;i   <strong>0000.1111.3333.3333.3333:0</strong>                         4.4.4.4
 Route Distinguisher: 1.1.1.1:0
       Network(ESI/EthTagId)                                  NextHop
 *&gt;i   <strong>0000.1111.1111.1111.1111:4294967295</strong>               1.1.1.1
 Route Distinguisher: 2.2.2.2:0
       Network(ESI/EthTagId)                                  NextHop
 *&gt;i   0000.1111.2222.2222.2222:4294967295                    2.2.2.2
 Route Distinguisher: 4.4.4.4:0
       Network(ESI/EthTagId)                                  NextHop
 *&gt;i   <strong>0000.1111.3333.3333.3333:4294967295</strong>               4.4.4.4
 
 EVPN address family:
 Number of Inclusive Multicast Routes: 4
 Route Distinguisher: 100:1
       Network(EthTagId/IpAddrLen/OriginalIp)                 NextHop
 *&gt;i   <strong>0:32:1.1.1.1</strong>                                         1.1.1.1
 *&gt;i   0:32:2.2.2.2                                           2.2.2.2
 Route Distinguisher: 100:2
       Network(EthTagId/IpAddrLen/OriginalIp)                 NextHop
 *&gt;i   <strong>0:32:1.1.1.1</strong>                                         1.1.1.1
 *&gt;i   <strong>0:32:4.4.4.4</strong>                                         4.4.4.4
 
 EVPN address family:
 Number of ES Routes: 3
 Route Distinguisher: 1.1.1.1:0
       Network(ESI)                                           NextHop
 *&gt;i   <strong>0000.1111.1111.1111.1111</strong>                           1.1.1.1
 Route Distinguisher: 2.2.2.2:0
       Network(ESI)                                           NextHop
 *&gt;i   0000.1111.2222.2222.2222                               2.2.2.2
 Route Distinguisher: 4.4.4.4:0
       Network(ESI)                                           NextHop
 *&gt;i   <strong>0000.1111.3333.3333.3333</strong>                           4.4.4.4</pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RR] <strong>display bgp evpn all routing-table peer 4.4.4.4 advertised-routes</strong></pre>
<pre class="screen"> Local AS number : 100

 BGP Local router ID is 3.3.3.3
 Status codes: * - valid, &gt; - best, d - damped, x - best external, a - add path,
               h - history,  i - internal, s - suppressed, S - Stale
               Origin : i - IGP, e - EGP, ? - incomplete

 
 EVPN address family:
 Number of A-D Routes: 7
 Route Distinguisher: 100:1
       Network(ESI/EthTagId)                                  NextHop
 *&gt;i   <strong>0000.1111.1111.1111.1111:0</strong>                         1.1.1.1
 *&gt;i   <strong>0000.1111.2222.2222.2222:0</strong>                         2.2.2.2
 Route Distinguisher: 100:2
       Network(ESI/EthTagId)                                  NextHop
 *&gt;i   <strong>0000.1111.1111.1111.1111:0</strong>                         1.1.1.1
 *&gt;i   0000.1111.3333.3333.3333:0                             4.4.4.4
 Route Distinguisher: 1.1.1.1:0
       Network(ESI/EthTagId)                                  NextHop
 *&gt;i   <strong>0000.1111.1111.1111.1111:4294967295</strong>               1.1.1.1
 Route Distinguisher: 2.2.2.2:0
       Network(ESI/EthTagId)                                  NextHop
 *&gt;i   <strong>0000.1111.2222.2222.2222:4294967295</strong>               2.2.2.2
 Route Distinguisher: 4.4.4.4:0
       Network(ESI/EthTagId)                                  NextHop
 *&gt;i   0000.1111.3333.3333.3333:4294967295                    4.4.4.4
 
 EVPN address family:
 Number of Inclusive Multicast Routes: 4
 Route Distinguisher: 100:1
       Network(EthTagId/IpAddrLen/OriginalIp)                 NextHop
 *&gt;i   <strong>0:32:1.1.1.1</strong>                                         1.1.1.1
 *&gt;i   <strong>0:32:2.2.2.2</strong>                                         2.2.2.2
 Route Distinguisher: 100:2
       Network(EthTagId/IpAddrLen/OriginalIp)                 NextHop
 *&gt;i   <strong>0:32:1.1.1.1</strong>                                         1.1.1.1
 *&gt;i   0:32:4.4.4.4                                           4.4.4.4
 
 EVPN address family:
 Number of ES Routes: 3
 Route Distinguisher: 1.1.1.1:0
       Network(ESI)                                           NextHop
 *&gt;i   <strong>0000.1111.1111.1111.1111</strong>                           1.1.1.1
 Route Distinguisher: 2.2.2.2:0
       Network(ESI)                                           NextHop
 *&gt;i   <strong>0000.1111.2222.2222.2222</strong>                           2.2.2.2
 Route Distinguisher: 4.4.4.4:0
       Network(ESI)                                           NextHop
 *&gt;i   0000.1111.3333.3333.3333                               4.4.4.4</pre>
<p>The command output shows that the RR reflects all routes to PE2 and PE3. However, PE2 and PE3 do not have to receive all the routes. To resolve this problem, configure EVPN ORF on each device.</p>
</p></li><li><span>Configure EVPN ORF on each device.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>ipv4-family vpn-target</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-vpn-target] <strong>peer 3.3.3.3 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-vpn-target] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>l2vpn-family evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-evpn] <strong>vpn-orf enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>ipv4-family vpn-target</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-vpn-target] <strong>peer 3.3.3.3 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-vpn-target] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>l2vpn-family evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-evpn] <strong>vpn-orf enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>ipv4-family vpn-target</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp-af-vpn-target] <strong>peer 3.3.3.3 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp-af-vpn-target] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>l2vpn-family evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp-af-evpn] <strong>vpn-orf enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp-af-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
<p># Configure the RR.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RR] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp] <strong>ipv4-family vpn-target</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp-af-vpn-target] <strong>peer 1.1.1.1 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp-af-vpn-target] <strong>peer 1.1.1.1 reflect-client</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp-af-vpn-target] <strong>peer 2.2.2.2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp-af-vpn-target] <strong>peer 2.2.2.2 reflect-client</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp-af-vpn-target] <strong>peer 4.4.4.4 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp-af-vpn-target] <strong>peer 4.4.4.4 reflect-client</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp-af-vpn-target] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp] <strong>l2vpn-family evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp-af-evpn] <strong>vpn-orf enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp-af-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR] <strong>commit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p>Run the <strong>display bgp vpn-target routing-table</strong> command on the RR. The command output shows that the RR has received ORF routes.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RR] <strong>display bgp vpn-target routing-table</strong></pre>
<pre class="screen"> 
 Total number of routes from all PE: 7

 BGP Local router ID is 10.1.1.2
 Status codes: * - valid, &gt; - best, d - damped, x - best external, a - add path,
               h - history,  i - internal, s - suppressed, S - Stale
               Origin : i - IGP, e - EGP, ? - incomplete


 Origin AS: 100

 Total Number of Routes: 7
        Network                  NextHop        MED        LocPrf    PrefVal Path/Ogn
 *&gt;i    RT &lt;1 : 1&gt;               1.1.1.1         0          100        0       ?
 * i                             2.2.2.2         0          100        0       ?
 *&gt;i    RT &lt;2 : 2&gt;               1.1.1.1         0          100        0       ?
 * i                             4.4.4.4         0          100        0       ?
 *&gt;i    RT &lt;0011-1111-1111&gt;      1.1.1.1         0          100        0       ?
 *&gt;i    RT &lt;0011-1122-2222&gt;      2.2.2.2         0          100        0       ?
 *&gt;i    RT &lt;0011-1133-3333&gt;      4.4.4.4         0          100        0       ?</pre>
<p>Run the <strong>display bgp evpn all routing-table peer 2.2.2.2 advertised-routes</strong> and <strong>display bgp evpn all routing-table peer 4.4.4.4 advertised-routes</strong> commands on the RR again. The command output shows that the RR has advertised only requested routes to PE2 and PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RR] <strong>display bgp evpn all routing-table peer 2.2.2.2 advertised-routes</strong></pre>
<pre class="screen"> Local AS number : 100

 BGP Local router ID is 10.1.1.2
 Status codes: * - valid, &gt; - best, d - damped, x - best external, a - add path,
               h - history,  i - internal, s - suppressed, S - Stale
               Origin : i - IGP, e - EGP, ? - incomplete

 
 EVPN address family:
 Number of A-D Routes: 2
 Route Distinguisher: <strong>100:1</strong>
       Network(ESI/EthTagId)                                  NextHop
 *&gt;i   0000.1111.1111.1111.1111:0                             1.1.1.1
 Route Distinguisher: 1.1.1.1:0
       Network(ESI/EthTagId)                                  NextHop
 *&gt;i   0000.1111.1111.1111.1111:4294967295                    1.1.1.1
 
 EVPN address family:
 Number of Inclusive Multicast Routes: 1
 Route Distinguisher: <strong>100:1</strong>
       Network(EthTagId/IpAddrLen/OriginalIp)                 NextHop
 *&gt;i   0:32:1.1.1.1                                           1.1.1.1</pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RR] <strong>display bgp evpn all routing-table peer 4.4.4.4 advertised-routes</strong></pre>
<pre class="screen"> Local AS number : 100

 BGP Local router ID is 10.1.1.2
 Status codes: * - valid, &gt; - best, d - damped, x - best external, a - add path,
               h - history,  i - internal, s - suppressed, S - Stale
               Origin : i - IGP, e - EGP, ? - incomplete

 
 EVPN address family:
 Number of A-D Routes: 2
 Route Distinguisher: <strong>100:2</strong>
       Network(ESI/EthTagId)                                  NextHop
 *&gt;i   0000.1111.1111.1111.1111:0                             1.1.1.1
 Route Distinguisher: 1.1.1.1:0
       Network(ESI/EthTagId)                                  NextHop
 *&gt;i   0000.1111.1111.1111.1111:4294967295                    1.1.1.1
 
 EVPN address family:
 Number of Inclusive Multicast Routes: 1
 Route Distinguisher: <strong>100:2</strong>
       Network(EthTagId/IpAddrLen/OriginalIp)                 NextHop
 *&gt;i   0:32:1.1.1.1                                           1.1.1.1</pre>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0172370612__file1"><a name="EN-US_TASK_0172370612__file1"></a><a name="file1"></a><a name="EN-US_TASK_0172370612__1.4.6"></a><a name="1.4.6"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>PE1 configuration file</p>
<pre class="screen">#
sysname PE1
#
evpn vpn-instance evrf1 bd-mode
 route-distinguisher 100:1
 vpn-target 1:1 export-extcommunity
 vpn-target 1:1 import-extcommunity
#
evpn vpn-instance evrf2 bd-mode
 route-distinguisher 100:2
 vpn-target 2:2 export-extcommunity
 vpn-target 2:2 import-extcommunity
#
mpls lsr-id 1.1.1.1
#               
mpls
#
bridge-domain 10
 evpn binding vpn-instance evrf1
#
bridge-domain 20
 evpn binding vpn-instance evrf2
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 esi 0000.1111.1111.1111.1111
#
interface GigabitEthernet<span>0/1/0</span>.1 mode l2
 encapsulation dot1q vid 10
 rewrite pop single
 bridge-domain 10
#
interface GigabitEthernet<span>0/1/0</span>.2 mode l2
 encapsulation dot1q vid 20
 rewrite pop single
 bridge-domain 20
#               
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.1.1.1 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 1.1.1.1 255.255.255.255
#
bgp 100
 peer 3.3.3.3 as-number 100
 peer 3.3.3.3 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 3.3.3.3 enable
 #
 l2vpn-family evpn
  undo policy vpn-target
  vpn-orf enable
  peer 3.3.3.3 enable
 #
 ipv4-family vpn-target
  peer 3.3.3.3 enable
#
ospf 1
 area 0.0.0.0
  network 1.1.1.1 0.0.0.0
  network 10.1.1.0 0.0.0.255
#
evpn source-address 1.1.1.1
#
return</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#
sysname PE2
#
evpn vpn-instance evrf1 bd-mode
 route-distinguisher 100:1
 vpn-target 1:1 export-extcommunity
 vpn-target 1:1 import-extcommunity
#
mpls lsr-id 2.2.2.2
#
mpls
#
bridge-domain 10
 evpn binding vpn-instance evrf1
#               
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 esi 0000.1111.2222.2222.2222
#
interface GigabitEthernet<span>0/1/0</span>.1 mode l2
 encapsulation dot1q vid 10
 rewrite pop single
 bridge-domain 10
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.2.1.1 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 2.2.2.2 255.255.255.255
#
bgp 100
 peer 3.3.3.3 as-number 100
 peer 3.3.3.3 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 3.3.3.3 enable
 #
 l2vpn-family evpn
  undo policy vpn-target
  vpn-orf enable
  peer 3.3.3.3 enable
 #
 ipv4-family vpn-target
  peer 3.3.3.3 enable
#
ospf 1
 area 0.0.0.0
  network 2.2.2.2 0.0.0.0
  network 10.2.1.0 0.0.0.255
#
evpn source-address 2.2.2.2
#
return</pre>
</li><li><p>PE3 configuration file</p>
<pre class="screen">#
sysname PE3
#
evpn vpn-instance evrf2 bd-mode
 route-distinguisher 100:2
 vpn-target 2:2 export-extcommunity
 vpn-target 2:2 import-extcommunity
#
mpls lsr-id 4.4.4.4
#
mpls
#
bridge-domain 20
 evpn binding vpn-instance evrf2
#               
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown  
 ip address 10.3.1.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 esi 0000.1111.3333.3333.3333
#
interface GigabitEthernet<span>0/2/0</span>.1 mode l2
 encapsulation dot1q vid 20
 rewrite pop single
 bridge-domain 20
#
interface LoopBack1
 ip address 4.4.4.4 255.255.255.255
#
bgp 100
 peer 3.3.3.3 as-number 100
 peer 3.3.3.3 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 3.3.3.3 enable
 #
 l2vpn-family evpn
  undo policy vpn-target
  vpn-orf enable
  peer 3.3.3.3 enable
 #
 ipv4-family vpn-target
  peer 3.3.3.3 enable
#
ospf 1
 area 0.0.0.0
  network 4.4.4.4 0.0.0.0
  network 10.3.1.0 0.0.0.255
#
evpn source-address 4.4.4.4
#
return</pre>
</li><li><p>RR configuration file</p>
<pre class="screen">#
sysname RR
#
mpls lsr-id 3.3.3.3
#
mpls
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.1.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.2.1.2 255.255.255.0
 mpls           
 mpls ldp
#
interface GigabitEthernet<span>0/3/0</span>
 undo shutdown
 ip address 10.3.1.1 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 3.3.3.3 255.255.255.255
#
bgp 100
 peer 1.1.1.1 as-number 100
 peer 1.1.1.1 connect-interface LoopBack1
 peer 2.2.2.2 as-number 100
 peer 2.2.2.2 connect-interface LoopBack1
 peer 4.4.4.4 as-number 100
 peer 4.4.4.4 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 1.1.1.1 enable
  peer 2.2.2.2 enable
  peer 4.4.4.4 enable
 #
 l2vpn-family evpn
  undo policy vpn-target
  vpn-orf enable
  peer 1.1.1.1 enable
  peer 1.1.1.1 reflect-client
  peer 2.2.2.2 enable
  peer 2.2.2.2 reflect-client
  peer 4.4.4.4 enable
  peer 4.4.4.4 reflect-client
 #
 ipv4-family vpn-target
  peer 1.1.1.1 enable
  peer 1.1.1.1 reflect-client
  peer 2.2.2.2 enable
  peer 2.2.2.2 reflect-client
  peer 4.4.4.4 enable
  peer 4.4.4.4 reflect-client
#
ospf 1
 area 0.0.0.0
  network 3.3.3.3 0.0.0.0
  network 10.1.1.0 0.0.0.255
  network 10.2.1.0 0.0.0.255
  network 10.3.1.0 0.0.0.255
#               
return</pre>
</li><li><p>CE1 configuration file</p>
<pre class="screen">#
sysname CE1
#
bridge-domain 10
#
bridge-domain 20
#
interface Vbdif10
 ip address 192.168.1.11 255.255.255.0
#
interface Vbdif20
 ip address 192.168.2.11 255.255.255.0
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
#
interface GigabitEthernet<span>0/1/0</span>.1 mode l2
 encapsulation dot1q vid 10
 rewrite pop single
 bridge-domain 10
#
interface GigabitEthernet<span>0/1/0</span>.2 mode l2
 encapsulation dot1q vid 20
 rewrite pop single
 bridge-domain 20
#
return</pre>
</li><li><p>CE2 configuration file</p>
<pre class="screen">#
sysname CE2
#
bridge-domain 10
#
interface Vbdif10
 ip address 192.168.1.12 255.255.255.0
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
#
interface GigabitEthernet<span>0/1/0</span>.1 mode l2
 encapsulation dot1q vid 10
 rewrite pop single
 bridge-domain 10
#
return</pre>
</li><li><p>CE3 configuration file</p>
<pre class="screen">#
sysname CE3
#
bridge-domain 20
#
interface Vbdif20
 ip address 192.168.2.12 255.255.255.0
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
#
interface GigabitEthernet<span>0/1/0</span>.1 mode l2
 encapsulation dot1q vid 20
 rewrite pop single
 bridge-domain 20
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0010.html">EVPN Configuration Examples
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0095.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0051.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>