
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring Basic L2TPv3 over IPv4 Functions">
<meta name="abstract" content="L2TPv3 over IPv4 is used to establish L2TPv3 tunnels on an IPv4 public network, so that Layer 2 user packets can be transparently transmitted across the IPv4 public network.">
<meta name="description" content="L2TPv3 over IPv4 is used to establish L2TPv3 tunnels on an IPv4 public network, so that Layer 2 user packets can be transparently transmitted across the IPv4 public network.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2tpv3_cfg_000001.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2tpv3_cfg_000005.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2tpv3_cfg_000006.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,l2tpv3,w00556928,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="L2TPv3">
<meta name="featuretype" content="VPN">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="L2TPv3">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="L2TPv3">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="l00415692">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00415692">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172369195">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring Basic L2TPv3 over IPv4 Functions</title>
</head>
<body><a name="EN-US_TASK_0172369195"></a><a name="EN-US_TASK_0172369195"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring Basic L2TPv3 over IPv4 Functions</h1>
<div class="taskbody"><p>L2TPv3 over IPv4 is used to establish L2TPv3 tunnels on an IPv4 public network, so that Layer 2 user packets can be transparently transmitted across the IPv4 public network.</p>
<div class="context"><a name="EN-US_TASK_0172369195__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Usage Scenario</h4><p>L2TPv3 over IPv4 tunnels can be used to transparently transmit Layer 2 Ethernet services. Tags can be used for flexible access. L2TPv3 tunnels can be deployed on a PE to transmit users' Layer 2 Ethernet packets to a remote end.</p>
</div></div>
<div class="context"><a name="EN-US_TASK_0172369195__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle"><strong>Prerequisites</strong></h4><p>Before configuring L2TPv3 over IPv4, complete the following tasks:</p>
<ul><li><p>Configure interfaces and IPv4 addresses for them.</p>
</li><li><p>Configure IPv4 routes for devices to communicate.</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172369195__1.4.3"></a><a name="1.4.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li id="EN-US_TASK_0172369195__step393369227214049"><span id="EN-US_TASK_0172369195__cmd1401932723214049">Run <a href="cmdqueryname=system-view"><b><span class="cmdname" id="EN-US_TASK_0172369195__cmdname1092953564214049">system-view</span></b></a></span><p><p id="EN-US_TASK_0172369195__p1516441322318">The system view is displayed.</p>
</p></li><li id="EN-US_TASK_0172369195__step676036600214049"><span id="EN-US_TASK_0172369195__cmd1958643570214049">Run <a href="cmdqueryname=l2tpv3+enable"><b><span class="cmdname" id="EN-US_TASK_0172369195__cmdname2058652556214049">l2tpv3 enable</span></b></a></span><p><p id="EN-US_TASK_0172369195__p233992714234">L2TPv3 is enabled.</p>
</p><p></p></li><li id="EN-US_TASK_0172369195__step337487734214049"><span id="EN-US_TASK_0172369195__cmd652033611214049">Run <a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0172369195__cmdname2117293613214049">commit</span></b></a></span><p><p id="EN-US_TASK_0172369195__p097017529234">The configuration is committed.</p>
</p></li><li id="EN-US_TASK_0172369195__step1982399236214049"><span id="EN-US_TASK_0172369195__cmd2122659894214049">Run <a href="cmdqueryname=l2tpv3+pw"><b><span class="cmdname" id="EN-US_TASK_0172369195__cmdname938381017214049">l2tpv3 pw</span></b></a> <i><span class="varname" id="EN-US_TASK_0172369195__varname1283213436434">pwname</span></i></span><p><p id="EN-US_TASK_0172369195__p162048872419">An L2TPv3 tunnel is created, and its view is displayed.</p>
</p></li><li><span>(Optional) Run <a href="cmdqueryname=l2tpv3+local+session-id"><b><span class="cmdname">l2tpv3 local session-id</span></b></a> <i><span class="varname">local-session-id</span></i></span><p><p>The local session ID is configured.</p>
</p><p><p>In the L2TPv3 over IPv4 scenario, <i><span class="varname">local-session-id</span></i> must be globally unique.</p>
</p></li><li><span>(Optional) Run <a href="cmdqueryname=l2tpv3+remote+session-id"><b><span class="cmdname">l2tpv3 remote session-id</span></b></a> <i><span class="varname">remote-session-id</span></i></span><p><p>The remote session ID is configured.</p>
</p><p></p></li><li><span>Run <a href="cmdqueryname=source"><b><span class="cmdname">source</span></b></a> <strong><span>interface</span></strong> { <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i> | <i><span class="varname">interface-name</span></i> } <i><span class="varname">source-address</span></i></span><p><p>The source interface of the L2TPv3 tunnel is configured.</p>
</p><p><p>The IP address must be an IPv4 address.</p>
</p></li><li><span>Run <a href="cmdqueryname=destination"><b><span class="cmdname">destination</span></b></a> <i><span class="varname">ipv4-address</span></i></span><p><p>The destination IPv4 address of the L2TPv3 tunnel is configured.</p>
</p><p></p></li><li id="EN-US_TASK_0172369195__step1026509909214049"><span id="EN-US_TASK_0172369195__cmd1815904212214049">Configure L2TPv3 tunnel security. Cookies are used in security checks performed at the endpoints of a tunnel to prevent network spoofing and attacks.</span><ol type="a" id="EN-US_TASK_0172369195__substeps394230587214049"><li class="substepexpand" id="EN-US_TASK_0172369195__substep928490470214049"><span id="EN-US_TASK_0172369195__cmd1523150188214049">Run the <a href="cmdqueryname=l2tpv3+local+cookie"><b><span class="cmdname" id="EN-US_TASK_0172369195__cmdname1587780330214049">l2tpv3 local cookie</span></b></a> { <strong><span id="EN-US_TASK_0172369195__cmdparmname1770785341214049">key cipher</span></strong> <i><span class="varname" id="EN-US_TASK_0172369195__varname267462177214049">local-cookie</span></i> | <strong><span id="EN-US_TASK_0172369195__cmdparmname917125853214049">length 4 plain lower-value</span></strong> <i><span class="varname" id="EN-US_TASK_0172369195__varname1394704044214049">local-low-value</span></i> | <strong><span id="EN-US_TASK_0172369195__cmdparmname1145329906214049">length 8 plain lower-value</span></strong> <i><span class="varname" id="EN-US_TASK_0172369195__varname1380267454214049">local-low-value</span></i> <strong><span id="EN-US_TASK_0172369195__cmdparmname633482344214049">upper-value</span></strong> <i><span class="varname" id="EN-US_TASK_0172369195__varname1380799502214049">local-high-value</span></i> } command to configure the local cookie.</span><p><p id="EN-US_TASK_0172369195__p1375986334214049">Either an extended or standard cookie can be configured. The local cookie of the local device must be the same as the remote cookie of the remote device. The device compares the Cookie field of a packet with the pre-configured value. If the Cookie field does not match the pre-configured value, the device discards the packet.</p>
<div class="note" id="EN-US_TASK_0172369195__note1910367060214049"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0172369195__p511171123214049">You are advised to select the <strong id="EN-US_TASK_0172369195__b14707181011538">cipher</strong> mode. In <strong id="EN-US_TASK_0172369195__b17707181065317">plain</strong> mode, a value is saved in the configuration file in plaintext, posing a high risk. To ensure device security, change the cookie periodically.</p>
</div></div>
</p></li><li class="substepexpand" id="EN-US_TASK_0172369195__substep2146211740214049"><span id="EN-US_TASK_0172369195__cmd97895521214049">(Optional) Run <a href="cmdqueryname=l2tpv3+local+cookie+secondary"><b><span class="cmdname" id="EN-US_TASK_0172369195__cmdname647386609214049">l2tpv3 local cookie secondary</span></b></a> { <strong><span id="EN-US_TASK_0172369195__cmdparmname7350025014">key cipher</span></strong> <i><span class="varname" id="EN-US_TASK_0172369195__varname73511228018">local-cookie</span></i> | <strong><span id="EN-US_TASK_0172369195__cmdparmname203511821604">length 4 plain lower-value</span></strong> <i><span class="varname" id="EN-US_TASK_0172369195__varname43511121100">local-low-value</span></i> | <strong><span id="EN-US_TASK_0172369195__cmdparmname335172806">length 8 plain lower-value</span></strong> <i><span class="varname" id="EN-US_TASK_0172369195__varname13511322014">local-low-value</span></i> <strong><span id="EN-US_TASK_0172369195__cmdparmname1335172202">upper-value</span></strong> <i><span class="varname" id="EN-US_TASK_0172369195__varname6351423012">local-high-value</span></i> }</span><p><p id="EN-US_TASK_0172369195__p132931014102912">The local cookie is changed.</p>
</p><p><p id="EN-US_TASK_0172369195__p2100105380214049">After the local cookie is configured for the first time, you can run this command to change it without interrupting services</p>
<div class="note" id="EN-US_TASK_0172369195__note1187050868214049"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0172369195__p640857846214049">You are advised to select the <strong id="EN-US_TASK_0172369195__b128161949105911">cipher</strong> mode. In <strong id="EN-US_TASK_0172369195__b381684912596">plain</strong> mode, a value is saved in the configuration file in plaintext, which poses a high risk. To ensure device security, change the cookie periodically.</p>
</div></div>
</p></li><li class="substepexpand" id="EN-US_TASK_0172369195__substep1314426523214049"><span id="EN-US_TASK_0172369195__cmd402295372214049">Run the <a href="cmdqueryname=l2tpv3+remote+cookie"><b><span class="cmdname" id="EN-US_TASK_0172369195__cmdname887151807214049">l2tpv3 remote cookie</span></b></a> { <strong><span id="EN-US_TASK_0172369195__cmdparmname2070476889214049">key cipher</span></strong> <i><span class="varname" id="EN-US_TASK_0172369195__varname1739923565214049">remote-cookie</span></i> | <strong><span id="EN-US_TASK_0172369195__cmdparmname1989763510214049">length 4 plain lower-value</span></strong> <i><span class="varname" id="EN-US_TASK_0172369195__varname140596224214049">remote-low-value</span></i> | <strong><span id="EN-US_TASK_0172369195__cmdparmname289749367214049">length 8 plain lower-value</span></strong> <i><span class="varname" id="EN-US_TASK_0172369195__varname1734827330214049">remote-low-value</span></i> <strong><span id="EN-US_TASK_0172369195__cmdparmname1368804429214049">upper-value</span></strong> <i><span class="varname" id="EN-US_TASK_0172369195__varname1281045900214049">remote-high-value</span></i> } command to configure the remote cookie.</span><p><p id="EN-US_TASK_0172369195__p1543269736214049">Either an extended or standard cookie can be configured. The remote cookie of the local device must be the same as the local cookie of the remote device. The device compares the Cookie field of a packet with the pre-configured value. If the Cookie field does not match the pre-configured value, the device discards the packet.</p>
<div class="note" id="EN-US_TASK_0172369195__note1249251575214049"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0172369195__p223604306214049">You are advised to select the <strong id="EN-US_TASK_0172369195__b9548102725320">cipher</strong> mode. In <strong id="EN-US_TASK_0172369195__b654811276536">plain</strong> mode, a value is saved in the configuration file in plaintext, posing a high risk. To ensure device security, change the cookie periodically.</p>
</div></div>
</p></li><li class="substepexpand" id="EN-US_TASK_0172369195__substep71751718142415"><span id="EN-US_TASK_0172369195__cmd817571815249">Run <a href="cmdqueryname=quit"><b><span class="cmdname" id="EN-US_TASK_0172369195__cmdname16408524152411">quit</span></b></a></span><p><p id="EN-US_TASK_0172369195__p20835030173717">Return to the system view.</p>
</p></li></ol>
</li><li id="EN-US_TASK_0172369195__step1935349480214049"><span id="EN-US_TASK_0172369195__cmd1631392898214049">Bind services to the L2TPv3 PW.</span><ol type="a" id="EN-US_TASK_0172369195__substeps687149622214049"><li class="substepexpand" id="EN-US_TASK_0172369195__substep861769651214049"><span id="EN-US_TASK_0172369195__cmd1132808989214049">Run <a href="cmdqueryname=interface"><b><span class="cmdname" id="EN-US_TASK_0172369195__cmdname1721758625214049">interface</span></b></a> <i><span class="varname" id="EN-US_TASK_0172369195__varname1256712565214049">interface-type</span></i> <i><span class="varname" id="EN-US_TASK_0172369195__varname1252781051214049">interface-number</span></i> <strong><span id="EN-US_TASK_0172369195__cmdparmname1461764960214049">mode l2</span></strong></span><p><p id="EN-US_TASK_0172369195__p209165134310">The Layer 2 sub-interface view is displayed.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0172369195__substep1600037603214049"><span id="EN-US_TASK_0172369195__cmd1041765887214049">Run <a href="cmdqueryname=l2tpv3+instance"><b><span class="cmdname" id="EN-US_TASK_0172369195__cmdname1157458603214049">l2tpv3 instance</span></b></a> <i><span class="varname" id="EN-US_TASK_0172369195__varname1389911659214049">instance-name</span></i></span><p><p id="EN-US_TASK_0172369195__p126291127123111">An L2TPv3 instance is configured on the interface.</p>
</p><p><p id="EN-US_TASK_0172369195__p1223410076214049">The <i><span class="varname" id="EN-US_TASK_0172369195__varname1844710954214049">instance-name</span></i> value must begin with a letter.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0172369195__substep1689097194214049"><span id="EN-US_TASK_0172369195__cmd1070209865214049">Run <a href="cmdqueryname=l2tpv3+static+binding+pw"><b><span class="cmdname" id="EN-US_TASK_0172369195__cmdname1054621799214049">l2tpv3 static binding pw</span></b></a> <i><span class="varname" id="EN-US_TASK_0172369195__varname488124259214049">pwname</span></i></span><p><p id="EN-US_TASK_0172369195__p5147353143117">An L2TPv3 tunnel is bound to the L2TPv3 instance.</p>
</p><p></p></li></ol>
</li><li id="EN-US_TASK_0172369195__step858345411214049"><span id="EN-US_TASK_0172369195__cmd1563665778214049">Run <a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0172369195__cmdname1789462083214049">commit</span></b></a></span><p><p id="EN-US_TASK_0172369195__p12987559173218">The configuration is committed.</p>
</p></li><li id="EN-US_TASK_0172369195__step944807674214049"><span id="EN-US_TASK_0172369195__cmd888491000214049">Run <a href="cmdqueryname=quit"><b><span class="cmdname" id="EN-US_TASK_0172369195__cmdname1986658420214049">quit</span></b></a></span><p><p id="EN-US_TASK_0172369195__p1835652310339">Exit the L2TPv3 instance view.</p>
</p></li><li id="EN-US_TASK_0172369195__step1135177199214049"><span id="EN-US_TASK_0172369195__cmd678463645214049">Run <a href="cmdqueryname=encapsulation"><b><span class="cmdname" id="EN-US_TASK_0172369195__cmdname07393815512">encapsulation</span></b></a> [ <strong><span id="EN-US_TASK_0172369195__cmdparmname57363816517">default</span></strong> | <strong><span id="EN-US_TASK_0172369195__cmdparmname127333816511">dot1q</span></strong> [ <strong><span id="EN-US_TASK_0172369195__cmdparmname373153810513">vid</span></strong> <i><span class="varname" id="EN-US_TASK_0172369195__varname87311381857">low-pe-vid</span></i> [ <strong><span id="EN-US_TASK_0172369195__cmdparmname4731538257">to</span></strong> <i><span class="varname" id="EN-US_TASK_0172369195__varname137315381757">high-pe-vid</span></i> ] ] | <strong><span id="EN-US_TASK_0172369195__cmdparmname16736384513">qinq</span></strong> [ <strong><span id="EN-US_TASK_0172369195__cmdparmname117363816520">vid</span></strong> <i><span class="varname" id="EN-US_TASK_0172369195__varname17317386519">pe-vid</span></i> <strong id="EN-US_TASK_0172369195__b107313388510"><strong><span id="EN-US_TASK_0172369195__cmdparmname1373133812512">ce-vid</span></strong></strong> { <em id="EN-US_TASK_0172369195__i8732385516">l</em><i><span class="varname" id="EN-US_TASK_0172369195__varname5732387511">ow-ce-vid</span></i> [ <strong><span id="EN-US_TASK_0172369195__cmdparmname4745381654">to</span></strong> <i><span class="varname" id="EN-US_TASK_0172369195__varname16741838556">high-ce-vid</span></i> ] | <strong id="EN-US_TASK_0172369195__b17741138651">default</strong> } ] | <strong><span id="EN-US_TASK_0172369195__cmdparmname4749381254">untag</span></strong> ]</span><p><p id="EN-US_TASK_0172369195__p035615511156">The encapsulation type on an EVC Layer 2 sub-interface is configured.</p>
</p></li><li id="EN-US_TASK_0172369195__step117370177214049"><span id="EN-US_TASK_0172369195__cmd1250576893214049">Run <a href="cmdqueryname=rewrite+pop"><b><span class="cmdname" id="EN-US_TASK_0172369195__cmdname876545011214049">rewrite pop</span></b></a> { <strong><span id="EN-US_TASK_0172369195__cmdparmname1632102309214124">single</span></strong> | <strong><span id="EN-US_TASK_0172369195__cmdparmname101366980214124">double</span></strong> }</span><p><p id="EN-US_TASK_0172369195__p4626155813312">The traffic behavior is set to pop, enabling an EVC Layer 2 sub-interface removes VLAN tags from received packets.</p>
</p><p><div class="note" id="EN-US_TASK_0172369195__note2100001669214049"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0172369195__p834312438214049">If L2TPv3 is configured on a Layer 3 sub-interface, you only need to configure an encapsulation type for the sub-interface. Step 13 or 14 does not need to be performed.</p>
</div></div>
</p></li><li><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Exit the interface view.</p>
</p></li><li><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172369195__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p>Run the <a href="cmdqueryname=display+l2tpv3+pw"><b><span class="cmdname">display l2tpv3 pw</span></b></a> <i><span class="varname">pwname</span></i> command to check whether the L2TPv3 tunnel is correctly configured.</p>
<p>Run the <a href="cmdqueryname=display+l2tpv3+statistics+pw"><b><span class="cmdname">display l2tpv3 statistics pw</span></b></a> <i><span class="varname">pwname</span></i> command to check packet statistics about the L2TPv3 tunnel.</p>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2tpv3_cfg_000001.html">L2TPv3 Configuration
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2tpv3_cfg_000005.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2tpv3_cfg_000006.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>