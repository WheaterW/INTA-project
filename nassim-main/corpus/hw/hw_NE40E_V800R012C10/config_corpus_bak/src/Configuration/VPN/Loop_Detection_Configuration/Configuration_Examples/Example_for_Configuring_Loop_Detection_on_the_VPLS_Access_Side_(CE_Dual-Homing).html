
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Loop Detection on the VPLS Access Side (CE Dual-Homing)">
<meta name="abstract" content="In a CE dual-homing scenario, a CE is dual-homed to PE1 and PE2 through a switch. Together, PE1, PE2, and the switch form a physical ring network. To enable the devices to promptly eliminate loops and prevent subsequent broadcast storms in this case, you can deploy loop detection on the AC interfaces of PE1 and PE2 and specify blocking priorities for the interfaces on the primary and backup links.">
<meta name="description" content="In a CE dual-homing scenario, a CE is dual-homed to PE1 and PE2 through a switch. Together, PE1, PE2, and the switch form a physical ring network. To enable the devices to promptly eliminate loops and prevent subsequent broadcast storms in this case, you can deploy loop detection on the AC interfaces of PE1 and PE2 and specify blocking priorities for the interfaces on the primary and backup links.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_atn_loop-detect_cfg_0010.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="Loop Detection">
<meta name="featuretype" content="VPN">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="Loop Detection">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="Loop Detection">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="Loop Detection">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="l00415692">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00415692">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001738472312">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring Loop Detection on the VPLS Access Side (CE Dual-Homing)</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001738472312"></a><a name="EN-US_TASK_0000001738472312"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Loop Detection on the VPLS Access Side (CE Dual-Homing)</h1>
<div class="taskbody"><p>In a CE dual-homing scenario, a CE is dual-homed to PE1 and PE2 through a switch. Together, PE1, PE2, and the switch form a physical ring network. To enable the devices to promptly eliminate loops and prevent subsequent broadcast storms in this case, you can deploy loop detection on the AC interfaces of PE1 and PE2 and specify blocking priorities for the interfaces on the primary and backup links.</p>
<div class="context"><a name="EN-US_TASK_0000001738472312__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0000001738472312__fig7798133616113">Figure 1</a>, CE1 is dual-homed to PE1 and PE2 through a switch, and CE2 is directly connected to PE3. CE1 and CE2 belong to the same VPLS network. PWs are established with LDP as the VPLS signaling protocol, and VPLS is configured for CE1 and CE2 to communicate. Loop detection needs to be configured on PE1 and PE2 to prevent broadcast storms caused by loops formed by PE1, PE2, and the switch. The link between the switch and PE1 is the primary link, and that between the switch and PE2 is the backup link, which is blocked. If the primary link fails and no loop is detected on the backup link within the configured period of 10s, the backup link takes over traffic.</p>
<div class="fignone" id="EN-US_TASK_0000001738472312__fig7798133616113"><a name="EN-US_TASK_0000001738472312__fig7798133616113"></a><a name="fig7798133616113"></a><span class="figcap"><b>Figure 1 </b>Network diagram of configuring loop detection on the VPLS access side (CE dual-homing)</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface1, interface2, interface3, interface4, interface5, and subinterface1.1 represent GE<span>0/1/0</span>, GE<span>0/2/0</span>, GE<span>0/3/0</span>, GE<span>0/1/1</span>, GE<span>0/1/2</span>, and GE<span>0/1/0</span>.1, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0000001785392445.png" width="NaN" height="NaN"></span></div>
<h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li>Configure a routing protocol on the backbone network for communication between devices.</li><li>Establish a remote LDP session between PEs.</li><li>Enable MPLS L2VPN on PEs.</li><li>Create VSIs, set the signaling protocol to LDP, and bind AC interfaces to VSIs on PEs.</li><li>Configure loop detection on the AC interfaces of PEs.</li></ol>
<h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li>VSI names and IDs</li><li>Peer IP addresses and the tunnels used for setting up peer relationships</li><li>Names of interfaces bound to VSIs</li><li>Blocking priority and detection interval for unblocking an interface</li></ul>
</div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001738472312__1.4.2"></a><a name="1.4.2"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure IP addresses.</span><p><p>Configure IP addresses for involved physical interfaces and loopback interfaces according to <a href="#EN-US_TASK_0000001738472312__fig7798133616113">Figure 1</a>.</p>
<p>For detailed configurations, see <a href="#EN-US_TASK_0000001738472312__li18927104101117">Configuration Files</a>.</p>
</p></li><li><span>Configure an IGP on the MPLS backbone network. OSPF is used in this example.</span><p><p>During OSPF configuration, the 32-bit loopback addresses of PEs and the P must be advertised.</p>
<p>For detailed configurations, see <a href="#EN-US_TASK_0000001738472312__li18927104101117">Configuration Files</a>.</p>
</p></li><li><span>Configure basic MPLS functions and LDP.</span><p><p># Configure PE1.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname PE1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls lsr-id 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp] <strong>quit</strong> </pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface GigabitEthernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
</p><p><p># Configure PE2.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname PE2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>mpls lsr-id 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface GigabitEthernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
</p><p><p># Configure the P.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname P</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>mpls lsr-id 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>interface GigabitEthernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/0</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>interface GigabitEthernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/2/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/2/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/2/0</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>interface GigabitEthernet <span>0/3/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/3/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/3/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/3/0</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/3/0</span>] <strong>quit</strong></pre>
</p><p><p># Configure PE3.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname PE3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>mpls lsr-id 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>interface GigabitEthernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/2/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/2/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/2/0</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
</p></li><li><span>Establish remote LDP sessions between PEs.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>mpls ldp remote-peer pe2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp-remote-pe2] <strong>remote-ip 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp-remote-pe2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls ldp remote-peer pe3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp-remote-pe3] <strong>remote-ip 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp-remote-pe3] <strong>quit</strong></pre>
</p><p><p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>mpls ldp remote-peer pe1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-ldp-remote-pe1] <strong>remote-ip 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-ldp-remote-pe1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>mpls ldp remote-peer pe3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-ldp-remote-pe3] <strong>remote-ip 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-ldp-remote-pe3] <strong>quit</strong></pre>
</p><p><p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>mpls ldp remote-peer pe1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-mpls-ldp-remote-pe1] <strong>remote-ip 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-mpls-ldp-remote-pe1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>mpls ldp remote-peer pe2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-mpls-ldp-remote-pe2] <strong>remote-ip 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-mpls-ldp-remote-pe2] <strong>quit</strong></pre>
</p></li><li><span>Enable MPLS L2VPN on PEs.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-l2vpn] <strong>quit</strong></pre>
</p><p><p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-l2vpn] <strong>quit</strong></pre>
</p></li><li><span>Create VSIs, set the signaling protocol to LDP, and bind AC interfaces to VSIs on PEs.</span><p><p># Configure PE1.</p>
</p><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>vsi a2 static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-a2] <strong>pwsignal ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-a2-ldp] <strong>vsi-id 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-a2-ldp] <strong>peer 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-a2-ldp] <strong>peer 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-a2-ldp] <strong>mac-withdraw enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-a2-ldp] <strong>interface-status-change mac-withdraw enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-a2-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-a2]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet <span>0/1/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1] <strong>shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1] <strong>vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1] <strong>l2 binding vsi a2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1] <strong>quit</strong></pre>
</p><p><p># Configure PE2.</p>
</p><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>vsi a2 static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-a2] <strong>pwsignal ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-a2-ldp] <strong>vsi-id 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-a2-ldp] <strong>peer 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-a2-ldp] <strong>peer 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-a2-ldp] <strong>mac-withdraw enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-a2-ldp] <strong>interface-status-change mac-withdraw enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-a2-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-a2]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface gigabitethernet <span>0/1/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>.1] <strong>shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>.1] <strong>vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>.1] <strong>l2 binding vsi a2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>.1] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>.1] <strong>quit</strong></pre>
</p><p><p># Configure PE3.</p>
</p><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>vsi a2 static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-a2] <strong>pwsignal ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-a2-ldp] <strong>vsi-id 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-a2-ldp] <strong>peer 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-a2-ldp] <strong>peer 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-a2-ldp] <strong>mac-withdraw enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-a2-ldp] <strong>interface-status-change mac-withdraw enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-a2-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-a2]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>interface gigabitethernet <span>0/1/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/0</span>.1] <strong>shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/0</span>.1] <strong>vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/0</span>.1] <strong>l2 binding vsi a2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/0</span>.1] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/0</span>.1] <strong>quit</strong></pre>
</p><p><p>After the configuration is complete, check VSI connection information on a PE. The command output shows that two PWs have been successfully established.</p>
<div class="p">The following example uses the command output on PE1.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display vsi name a2 verbose</strong>
***VSI Name               : a2
    Administrator VSI      : no
    Isolate Spoken         : disable
    VSI Index              : 0
    PW Signaling           : ldp
    Member Discovery Style : static
    PW MAC Learn Style     : unqualify
    Encapsulation Type     : vlan
    MTU                    : 1500
    Diffserv Mode          : uniform
    Service Class          : --
    Color                  : --
    DomainId               : 255
    Domain Name            :
    Create Time            : 1 days, 15 hours, 11 minutes, 4 seconds
    VSI State              : up
    VSI ID                 : 2
   *Peer Router ID         : 2.2.2.2
    VC Label               : 23552
    Peer Type              : dynamic
    Session                : up
    Tunnel ID              : 0x1002000,
   *Peer Router ID         : 4.4.4.4
    VC Label               : 23553
    Peer Type              : dynamic
    Session                : up
    Tunnel ID              : 0x1002002,
    Interface Name         : GigabitEthernet<span>0/1/0</span>.1
    State                  : up
    Last Up Time           : 2020/10/27 18:10:44
    Total Up Time          : 1 days, 16 hours, 53 minutes, 33 seconds
   **PW Information:
   *Peer Ip Address        : 2.2.2.2
    PW State               : up
    Local VC Label         : 23552
    Remote VC Label        : 23552
    PW Type                : label
    Tunnel ID              : 0x1002000
   *Peer Ip Address        : 4.4.4.4
    PW State               : up
    Local VC Label         : 23553
    Remote VC Label        : 23552
    PW Type                : label
    Tunnel ID              : 0x1002002
    FIB Link-ID            : 1
    PW Last Up Time        : 2020/10/28 10:03:35
    PW Total Up Time       : 0 days, 11 hours, 15 minutes, 38 seconds</pre>
</div>
</p></li><li><span>Configure CEs to access the VPLS network.</span><p><p># Configure the switch.</p>
<p>Create VLAN 10 on the switch and add GE<span>0/1/0</span>, GE<span>0/1/1</span>, and GE<span>0/1/2</span> to VLAN 10.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname Switch</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Switch] <strong>vlan 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Switch-vlan10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Switch] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>Switch-GigabitEthernet<span>0/1/0</span>] <strong>port trunk allow-pass vlan 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Switch-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Switch] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>Switch-GigabitEthernet<span>0/1/1</span>] <strong>port trunk allow-pass vlan 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Switch-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Switch] <strong>interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>Switch-GigabitEthernet<span>0/1/2</span>] <strong>port trunk allow-pass vlan 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Switch-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
</p><p><p># Configure CE1.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname CE1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>interface gigabitethernet <span>0/1/0</span></strong><strong>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>.1] <strong>vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>.1] <strong>ip address 192.168.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>.1] <strong>quit</strong></pre>
</p><p><p># Configure CE2.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname CE2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>interface gigabitethernet <span>0/1/0</span></strong>.1</pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>.1] <strong>vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>.1] <strong>ip address 192.168.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>.1] <strong>quit</strong></pre>
</p></li><li><span>Configure loop detection on PEs.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>loop-detection enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet<span>0/1/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1] <strong>loop-detect enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1] <strong>loop-detect block 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1] <strong>loop-detect priority 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1] <strong>loop-detect trigger interface-down enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1] <strong>quit</strong></pre>
</p><p><p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>loop-detection enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface gigabitethernet<span>0/1/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>.1] <strong>loop-detect enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>.1] <strong>loop-detect block 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>.1] <strong>loop-detect priority 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>.1] <strong>loop-detect trigger interface-down enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>.1] <strong>quit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p>After the configuration is complete, run the <a href="cmdqueryname=display+loop-detect+block+all"><b><span class="cmdname">display loop-detect block all</span></b></a> command on PE1 and PE2. The command output shows that GE<span>0/1/0</span>.1 on PE2 is already blocked.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display loop-detect block all</strong>
Info: There is no block interface in this router.</pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>display loop-detect block all</strong>
Info: GigabitEthernet<span>0/1/0</span>.1 has been blocked.</pre>
</p><p><p>CE1 (192.168.1.1) can ping CE2 (192.168.1.2).</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>ping 192.168.1.2</strong>
PING 192.168.1.2: 56  data bytes, press CTRL_C to break
    Reply from 192.168.1.2: bytes=56 Sequence=1 ttl=255 time=90 ms
    Reply from 192.168.1.2: bytes=56 Sequence=2 ttl=255 time=77 ms
    Reply from 192.168.1.2: bytes=56 Sequence=3 ttl=255 time=34 ms
    Reply from 192.168.1.2: bytes=56 Sequence=4 ttl=255 time=46 ms
    Reply from 192.168.1.2: bytes=56 Sequence=5 ttl=255 time=94 ms
  --- 192.168.1.2 ping statistics ---
    5 packet(s) transmitted
    5 packet(s) received
    0.00% packet loss
    round-trip min/avg/max = 34/68/94 ms</pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001738472312__1.4.3"></a><a name="1.4.3"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li id="EN-US_TASK_0000001738472312__li18927104101117"><p><a name="EN-US_TASK_0000001738472312__li18927104101117"></a><a name="li18927104101117"></a>PE1 configuration file</p>
<pre class="screen">#
 sysname PE1
#
 mpls lsr-id 1.1.1.1
 mpls
#
 mpls l2vpn
#
vsi a2 static 
 pwsignal ldp 
  vsi-id 2
  peer 2.2.2.2
  peer 4.4.4.4
  mac-withdraw enable
  interface-status-change mac-withdraw enable
#
mpls ldp
#
mpls ldp remote-peer pe2
 remote-ip 2.2.2.2
#
mpls ldp remote-peer pe3
 remote-ip 4.4.4.4
#
loop-detection enable
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
#
interface GigabitEthernet<span>0/1/0</span>.1
 vlan-type dot1q 10
 l2 binding vsi a2
 loop-detect enable
 loop-detect block 10
 loop-detect priority 2
 loop-detect trigger interface-down enable
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.1.1.1 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 1.1.1.1 255.255.255.255
#
ospf 1
 area 0.0.0.0
  network 1.1.1.1 0.0.0.0
  network 10.1.1.0 0.0.0.255
#
return</pre>
</li></ul>
<ul><li><p>PE2 configuration file</p>
<pre class="screen">#
 sysname PE2
#
 mpls lsr-id 2.2.2.2
 mpls
#
 mpls l2vpn
#
vsi a2 static
 pwsignal ldp
  vsi-id 2
  peer 1.1.1.1
  peer 4.4.4.4
  mac-withdraw enable
  interface-status-change mac-withdraw enable
#
mpls ldp
#
mpls ldp remote-peer pe1
 remote-ip 1.1.1.1
#
mpls ldp remote-peer pe3
 remote-ip 4.4.4.4
#
loop-detection enable
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
#
interface GigabitEthernet<span>0/1/0</span>.1
 vlan-type dot1q 10
 l2 binding vsi a2
 loop-detect enable
 loop-detect block 10
 loop-detect priority 1
 loop-detect trigger interface-down enable
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.2.1.1 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 2.2.2.2 255.255.255.255
#
ospf 1
 area 0.0.0.0
  network 2.2.2.2 0.0.0.0
  network 10.2.1.0 0.0.0.255
#
return</pre>
</li></ul>
<ul><li><p>P configuration file</p>
<pre class="screen">#
 sysname P
#
 mpls lsr-id 3.3.3.3
 mpls
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.3.1.1 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.1.1.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/3/0</span>
 undo shutdown
 ip address 10.2.1.2 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 3.3.3.3 255.255.255.255
#
ospf 1
 area 0.0.0.0
  network 3.3.3.3 0.0.0.0
  network 10.1.1.0 0.0.0.255
  network 10.2.1.0 0.0.0.255
  network 10.3.1.0 0.0.0.255
#
return</pre>
</li></ul>
<ul><li><p>PE3 configuration file</p>
<pre class="screen">#
 sysname PE3
#
 mpls lsr-id 4.4.4.4
 mpls
#
 mpls l2vpn
#
vsi a2 static
 pwsignal ldp
  vsi-id 2
  peer 1.1.1.1
  peer 2.2.2.2
  mac-withdraw enable
  interface-status-change mac-withdraw enable
#
mpls ldp
#
mpls ldp remote-peer pe1
 remote-ip 1.1.1.1
#
mpls ldp remote-peer pe2
 remote-ip 2.2.2.2
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
#
interface GigabitEthernet<span>0/1/0</span>.1
 vlan-type dot1q 10
 l2 binding vsi a2
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.3.1.2 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 4.4.4.4 255.255.255.255
#
ospf 1
 area 0.0.0.0
  network 4.4.4.4 0.0.0.0
  network 10.3.1.0 0.0.0.255
#
return</pre>
</li></ul>
<ul><li><p>CE1 configuration file</p>
<pre class="screen">#
 sysname CE1
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
#
interface GigabitEthernet<span>0/1/0</span>.1
 vlan-type dot1q 10
 ip address 192.168.1.1 255.255.255.0
#
return</pre>
</li></ul>
<ul><li><p>CE2 configuration file</p>
<pre class="screen">#
 sysname CE2
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
#
interface GigabitEthernet<span>0/1/0</span>.1
 vlan-type dot1q 10
 ip address 192.168.1.2 255.255.255.0
#
return</pre>
</li></ul>
<ul><li><p>Switch configuration file</p>
<pre class="screen">#
 sysname Switch
#
 vlan batch 10
#
interface GigabitEthernet<span>0/1/0</span>
 port trunk allow-pass vlan 10
#
interface GigabitEthernet<span>0/1/1</span>
 port trunk allow-pass vlan 10
#
interface GigabitEthernet<span>0/1/2</span>
 port trunk allow-pass vlan 10
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_atn_loop-detect_cfg_0010.html">Configuration Examples
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
</div>
</div>
</body>
</html>