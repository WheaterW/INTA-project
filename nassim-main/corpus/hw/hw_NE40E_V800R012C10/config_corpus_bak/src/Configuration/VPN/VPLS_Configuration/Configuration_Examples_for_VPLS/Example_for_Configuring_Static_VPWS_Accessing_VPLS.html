
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Static VPWS Accessing VPLS">
<meta name="abstract" content="This section provides an example for configuring static VPWS accessing VPLS on an HVPLS network where UPEs do not support VPLS.">
<meta name="description" content="This section provides an example for configuring static VPWS accessing VPLS on an HVPLS network where UPEs do not support VPLS.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_5029.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_5033.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_5056.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="VPLS">
<meta name="featuretype" content="VPN">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="VPLS">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="VPLS">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="VPLS">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="l00415692">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00415692">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172370263">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring Static VPWS Accessing VPLS</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172370263"></a><a name="EN-US_TASK_0172370263"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Static VPWS Accessing VPLS</h1>
<div class="taskbody"><p>This section provides an example for configuring static VPWS accessing VPLS on an HVPLS network where UPEs do not support VPLS.</p>
<div class="context"><a name="EN-US_TASK_0172370263__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0172370263__fig_dc_vrp_vpls_cfg_603301">Figure 1</a>, UPEs do not support VPLS, but CE1 and CE2 need to communicate. To meet this requirement, configure static VPWS accessing VPLS. Specifically, configure SVC VPWS on UPEs and static VPLS on SPEs.</p>
<div class="fignone" id="EN-US_TASK_0172370263__fig_dc_vrp_vpls_cfg_603301"><a name="EN-US_TASK_0172370263__fig_dc_vrp_vpls_cfg_603301"></a><a name="fig_dc_vrp_vpls_cfg_603301"></a><span class="figcap"><b>Figure 1 </b>Configuring static VPWS accessing VPLS</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><ul><li><p>interface1, interface2, subinterface1.1, and subinterface2.1 in this example represent GE<span>0/1/0</span>, GE<span>0/2/0</span>, GE<span>0/1/0</span>.1, and GE<span>0/2/0</span>.1, respectively.</p>
</li></ul>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_vpls_cfg_603301.png"></span><br></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172370263__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure UPEs to access SPEs over SVC VPWS.</p>
</li><li><p>Configure static VPLS between SPEs.</p>
</li><li><p>Configure VPWS and a VSI on each SPE, and enable MAC Withdraw for the VSI.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172370263__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>VSI names and IDs</p>
</li><li><p>MPLS LSR IDs (as peer IP addresses) of UPEs and SPEs</p>
</li><li><p>Routing protocol</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172370263__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure interface IP addresses for CEs, UPEs, and SPEs. For details, see <a href="#EN-US_TASK_0172370263__dc_vrp_vpls_cfg_603301">Configuration Files</a>.</span></li><li><span>Configure IGP (OSPF in this example) on the MPLS backbone network.</span><p><p># Configure SPE1.</p>
<pre class="screen">&lt;SPE1&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE1] <strong>ospf</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-ospf-1] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-ospf-1-area-0.0.0.0] <strong>network 1.1.1.9 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-ospf-1-area-0.0.0.0] <strong>network 10.10.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-ospf-1-area-0.0.0.0] <strong>network 10.10.3.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-ospf-1-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-ospf-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>commit</strong></pre>
<p># Configure the P.</p>
<pre class="screen">&lt;P&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P] <strong>ospf</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-ospf-1] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-ospf-1-area-0.0.0.0] <strong>network 2.2.2.9 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-ospf-1-area-0.0.0.0] <strong>network 10.10.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-ospf-1-area-0.0.0.0] <strong>network 10.10.2.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-ospf-1-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-ospf-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>commit</strong></pre>
<p># Configure SPE2.</p>
<pre class="screen">&lt;SPE2&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE2] <strong>ospf</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-ospf-1] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-ospf-1-area-0.0.0.0] <strong>network 3.3.3.9 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-ospf-1-area-0.0.0.0] <strong>network 10.10.2.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-ospf-1-area-0.0.0.0] <strong>network 10.10.4.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-ospf-1-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-ospf-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2] <strong>commit</strong></pre>
<p># Configure UPE1.</p>
<pre class="screen">&lt;UPE1&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE1] <strong>ospf</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-ospf-1] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-ospf-1-area-0.0.0.0] <strong>network 4.4.4.9 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-ospf-1-area-0.0.0.0] <strong>network 10.10.3.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-ospf-1-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-ospf-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1] <strong>commit</strong></pre>
<p># Configure UPE2.</p>
<pre class="screen">&lt;UPE2&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE2] <strong>ospf</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-ospf-1] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-ospf-1-area-0.0.0.0] <strong>network 5.5.5.9 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-ospf-1-area-0.0.0.0] <strong>network 10.10.4.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-ospf-1-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-ospf-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2] <strong>commit</strong></pre>
<p>After completing the configurations, check OSPF routing table information. SPE1 is used as an example.</p>
<pre class="screen">&lt;SPE1&gt; <strong>display ospf routing</strong></pre>
<pre class="screen">          OSPF Process 1 with Router ID 10.10.3.1
                   Routing Tables

 Routing for Network
 Destination        Cost     Type       NextHop         AdvRouter       Area           
 1.1.1.9/32         0        Direct     1.1.1.9         10.10.3.1       0.0.0.0        
 2.2.2.9/32         1        Stub       10.10.1.2       10.10.1.2       0.0.0.0        
 3.3.3.9/32         2        Stub       10.10.1.2       10.10.2.2       0.0.0.0        
 4.4.4.9/32         1        Stub       10.10.3.2       10.10.3.2       0.0.0.0        
 5.5.5.9/32         3        Stub       10.10.1.2       10.10.4.2       0.0.0.0        
 10.10.1.0/24       1        Direct     10.10.1.1       10.10.3.1       0.0.0.0        
 10.10.2.0/24       2        Transit    10.10.1.2       10.10.1.2       0.0.0.0        
 10.10.3.0/24       1        Direct     10.10.3.1       10.10.3.1       0.0.0.0        
 10.10.4.0/24       3        Transit    10.10.1.2       10.10.2.2       0.0.0.0        

 Total Nets: 9
 Intra Area: 9  Inter Area: 0  ASE: 0  NSSA: 0
</pre>
</p></li><li><span>Configure basic MPLS functions on the MPLS backbone network.</span><p><p># Configure SPE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE1] <strong>mpls lsr-id 1.1.1.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-GigabitEthernet<span>0/1/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-GigabitEthernet<span>0/2/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-GigabitEthernet<span>0/2/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>commit</strong></pre>
<p># Configure the P.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P] <strong>mpls lsr-id 2.2.2.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/2/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/2/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>commit</strong></pre>
<p># Configure SPE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE2] <strong>mpls lsr-id 3.3.3.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-GigabitEthernet<span>0/1/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2] <strong>interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-GigabitEthernet<span>0/2/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-GigabitEthernet<span>0/2/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2] <strong>commit</strong></pre>
<p># Configure UPE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE1] <strong>mpls lsr-id 4.4.4.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-GigabitEthernet<span>0/1/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1] <strong>commit</strong></pre>
<p># Configure UPE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE2] <strong>mpls lsr-id 5.5.5.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-GigabitEthernet<span>0/1/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE2] <strong>commit</strong></pre>
<p>After the configuration is complete, run the <strong>display mpls ldp session</strong> command on SPE1, the P, and SPE2. The status of the peer relationship between SPE1 and the P or between SPE2 and the P is <strong>Operational</strong>, indicating that the peer relationship has been established. Run the <strong>display mpls lsp</strong> command. The command output shows whether LSPs have been set up.</p>
<p>The following example uses the command output on SPE1.</p>
<pre class="screen">&lt;SPE1&gt; <strong>display mpls ldp session</strong></pre>
<pre class="screen"> LDP Session(s) in Public Network
 Codes: LAM(Label Advertisement Mode), SsnAge Unit(DDDD:HH:MM)
 An asterisk (*) before a session means the session is being deleted.
--------------------------------------------------------------------------
 PeerID             Status       LAM  SsnRole  SsnAge       KASent/Rcv
--------------------------------------------------------------------------
 2.2.2.9:0          <strong>Operational</strong> DU   Passive  0000:00:38   154/154
 4.4.4.9:0          <strong>Operational</strong> DU   Passive  0000:00:16   69/69
--------------------------------------------------------------------------
TOTAL: 2 Session(s) Found.</pre>
<pre class="screen">&lt;SPE1&gt; <strong>display mpls lsp</strong></pre>
<pre class="screen">Flag after Out IF: (I) - RLFA Iterated LSP, (I*) - Normal and RLFA Iterated LSP 
Flag after LDP FRR: (L) - Logic FRR LSP
-------------------------------------------------------------------------------
                 LSP Information: LDP LSP
-------------------------------------------------------------------------------
FEC                In/Out Label    In/Out IF                      Vrf Name
1.1.1.9/32         3/NULL          -/-
2.2.2.9/32         NULL/3          -/GE<span>0/1/0</span>
2.2.2.9/32         32828/3         -/GE<span>0/1/0</span>
3.3.3.9/32         NULL/32829      -/GE<span>0/1/0</span>
3.3.3.9/32         32829/32829     -/GE<span>0/1/0</span>
4.4.4.9/32         NULL/3          -/GE<span>0/2/0</span>
4.4.4.9/32         32830/3         -/GE<span>0/2/0</span>
5.5.5.9/32         NULL/32831      -/GE<span>0/1/0</span>
5.5.5.9/32         32831/32831     -/GE<span>0/1/0</span></pre>
</p></li><li><span>Configure VPWS on UPEs for access to SPEs.</span><p><p># Configure UPE1.</p>
<pre class="screen">&lt;UPE1&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE1] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1] <strong>interface gigabitethernet <span>0/2/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-GigabitEthernet<span>0/2/0</span>.1] <strong>vlan-type dot1q 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-GigabitEthernet<span>0/2/0</span>.1] <strong>mpls static-l2vc destination 1.1.1.9 transmit-vpn-label 100 receive-vpn-label 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-GigabitEthernet<span>0/2/0</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1] <strong>commit</strong></pre>
<p># Configure UPE2.</p>
<pre class="screen">&lt;UPE2&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE2] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2] <strong>interface gigabitethernet <span>0/2/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-GigabitEthernet<span>0/2/0</span>.1] <strong>vlan-type dot1q 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-GigabitEthernet<span>0/2/0</span>.1] <strong>mpls static-l2vc destination 3.3.3.9 transmit-vpn-label 100 receive-vpn-label 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-GigabitEthernet<span>0/2/0</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2] <strong>commit</strong></pre>
</p></li><li><span># Configure VPLS on SPEs.</span><p><p># Configure SPE1.</p>
<pre class="screen">&lt;SPE1&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE1] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>vsi v100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-vsi-v100] <strong>pwsignal ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-vsi-v100-ldp] <strong>vsi-id 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-vsi-v100-ldp] <strong>mac-withdraw enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-vsi-v100-ldp] <strong>peer 3.3.3.9 static-npe trans 300 recv 400</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-vsi-v100-ldp] <strong>peer 4.4.4.9 static-upe trans 200 recv 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-vsi-v100-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-vsi-v100] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>commit</strong></pre>
<p># Configure SPE2.</p>
<pre class="screen">&lt;SPE2&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE2] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2] <strong>vsi v100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-vsi-v100] <strong>pwsignal ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-vsi-v100-ldp] <strong>vsi-id 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-vsi-v100-ldp] <strong>mac-withdraw enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-vsi-v100-ldp] <strong>peer 1.1.1.9 static-npe trans 400 recv 300</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-vsi-v100-ldp] <strong>peer 5.5.5.9 static-upe trans 200 recv 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-vsi-v100-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-vsi-v100] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2] <strong>commit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p>After completing the configurations, run the <a href="cmdqueryname=display+mpls+static-l2vc"><b><span class="cmdname">display mpls static-l2vc</span></b></a> command on a UPE. The command output shows that a PW has been established and <strong>VC State</strong> is <strong>up</strong>. The following example uses the command output on UPE1.</p>
<pre class="screen">&lt;UPE1&gt; <strong>display mpls static-l2vc</strong></pre>
<pre class="screen"> Total svc connections:  1,  1 up,  0 down

 *Client Interface     : GigabitEthernet<span>0/1/0</span>.1 is up
  AC Status            : up
  <strong>VC State           : up</strong>
  VC ID                : 0
  VC Type              : VLAN
  Destination          : 1.1.1.9
  Transmit VC Label    : 100
  Receive VC Label     : 200
  Label Status         : 0
  Token Status         : 0
  Control Word         : Disable
  VCCV Capability      : alert ttl lsp-ping bfd 
  active state         : active
  OAM Protocol         : --
  OAM Status           : --
  OAM Fault Type       : --
  PW APS ID            : --
  PW APS Status        : --
  TTL Value            : 1
  Link State           : up
  Tunnel Policy Name   : --
  PW Template Name     : --
  Main or Secondary    : Main
  load balance type    : flow
  Access-port          : false
  VC tunnel/token info : 1 tunnels/tokens
  NO.0  TNL Type       : ldp   , TNL ID : 0x0000000001004c4b42
  Create time          : 0 days, 0 hours, 11 minutes, 21 seconds
  UP time              : 0 days, 0 hours, 1 minutes, 29 seconds
  Last change time     : 0 days, 0 hours, 1 minutes, 29 seconds
  VC last up time      : 2015/05/30 17:34:22
  VC total up time     : 0 days, 0 hours, 1 minutes, 29 seconds
  CKey                 : 33
  NKey                 : 2818572439</pre>
<p>Run the <a href="cmdqueryname=display+vsi+name+v100+verbose"><b><span class="cmdname">display vsi name v100 verbose</span></b></a> command on an SPE. The command output shows that a VSI named <strong>v100</strong> is up and the corresponding PW is also up. The following example uses the command output on SPE1.</p>
<pre class="screen">&lt;SPE1&gt; <strong>display vsi name v100 verbose</strong></pre>
<pre class="screen"> ***VSI Name               : v100
    Work Mode              : normal
    Administrator VSI      : no
    Isolate Spoken         : disable
    VSI Index              : 1
    PW Signaling           : ldp
    Member Discovery Style : --
    Bridge-domain Mode     : disable
    PW MAC Learn Style     : unqualify
    Encapsulation Type     : vlan
    MTU                    : 1500
    Diffserv Mode          : uniform
    Service Class          : --
    Color                  : --
    DomainId               : 255
    Domain Name            : 
    Ignore AcState         : disable
    P2P VSI                : disable
    Create Time            : 0 days, 0 hours, 9 minutes, 44 seconds
    <strong>VSI State            : up</strong>
    Resource Status        : --

    VSI ID                 : 100
    LDP MAC-WITHDRAW       : mac-withdraw Enable
   *Peer Router ID         : 3.3.3.9
    primary or secondary   : primary
    ignore-standby-state   : no
    VC Label               : 400
    Peer Type              : static
    Tunnel ID              : 0x0000000001004c4b43 
    Broadcast Tunnel ID    : --
    Broad BackupTunnel ID  : -- 
    CKey                   : 1
    NKey                   : 1358954644
    Stp Enable             : 0
    PwIndex                : 1
    Control Word           : disable
   *Peer Router ID         : 4.4.4.9
    primary or secondary   : primary
    ignore-standby-state   : no
    VC Label               : 100
    Peer Type              : static
    Tunnel ID              : 0x0000000001004c4b44 
    Broadcast Tunnel ID    : --
    Broad BackupTunnel ID  : -- 
    CKey                   : 2
    NKey                   : 1358954645
    Stp Enable             : 0
    PwIndex                : 2
    Control Word           : disable
                
  **PW Information:
                
   *Peer Ip Address        : 3.3.3.9
    <strong>PW State             : up</strong>
    Local VC Label         : 400
    Remote VC Label        : 300
    Remote Control Word    : disable
    PW Type                : label
    Tunnel ID              : 0x0000000001004c4b43 
    Broadcast Tunnel ID    : --
    Broad BackupTunnel ID  : --
    Ckey                   : 1
    Nkey                   : 1358954644
    Main PW Token          : 0x0
    Slave PW Token         : 0x0
    Tnl Type               : ldp
    OutInterface           : 
    Backup OutInterface    : --
    Stp Enable             : 0
    Mac Flapping           : 0
    PW Last Up Time        : 2015/05/30 17:29:56
    PW Total Up Time       : 0 days, 0 hours, 9 minutes, 42 seconds
   *Peer Ip Address        : 4.4.4.9
    PW State               : up
    Local VC Label         : 100
    Remote VC Label        : 200
    Remote Control Word    : disable
    PW Type                : MEHVPLS
    Tunnel ID              : 0x0000000001004c4b44 
    Broadcast Tunnel ID    : --
    Broad BackupTunnel ID  : --
    Ckey                   : 2
    Nkey                   : 1358954645
    Main PW Token          : 0x0
    Slave PW Token         : 0x0
    Tnl Type               : ldp
    OutInterface           : 
    Backup OutInterface    : --
    Stp Enable             : 0
    Mac Flapping           : 0
    PW Last Up Time        : 2015/05/30 17:34:22
    PW Total Up Time       : 0 days, 0 hours, 3 minutes, 26 seconds</pre>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0172370263__dc_vrp_vpls_cfg_603301"><a name="EN-US_TASK_0172370263__dc_vrp_vpls_cfg_603301"></a><a name="dc_vrp_vpls_cfg_603301"></a><a name="EN-US_TASK_0172370263__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>CE1 configuration file</p>
<pre class="screen">#
sysname CE1
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
#
interface GigabitEthernet<span>0/1/0</span>.1
 undo shutdown
 vlan-type dot1q 1
 ip address 10.1.1.1 255.255.255.0
#
return</pre>
</li><li><p>CE2 configuration file</p>
<pre class="screen">#
sysname CE2
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
#
interface GigabitEthernet<span>0/1/0</span>.1
 undo shutdown
 vlan-type dot1q 1
 ip address 10.1.1.2 255.255.255.0
#
return</pre>
</li><li><p>UPE1 configuration file</p>
<pre class="screen">#
sysname UPE1
#
mpls lsr-id 4.4.4.9
#
mpls
#
mpls l2vpn
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown  
 ip address 10.10.3.2 255.255.255.0
 mpls           
 mpls ldp       
#               
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown  
#               
interface GigabitEthernet<span>0/2/0</span>.1
 vlan-type dot1q 1
 mpls static-l2vc destination 1.1.1.9 transmit-vpn-label 100 receive-vpn-label 200
#               
interface LoopBack1
 ip address 4.4.4.9 255.255.255.255
#               
ospf 1          
 area 0.0.0.0   
  network 4.4.4.9 0.0.0.0
  network 10.10.3.0 0.0.0.255
#               
return</pre>
</li><li><p>SPE1 configuration file</p>
<pre class="screen">#
sysname SPE1
#
mpls lsr-id 1.1.1.9
#
mpls
#
mpls l2vpn
#
vsi v100
 pwsignal ldp
  vsi-id 100
  mac-withdraw enable
  peer 3.3.3.9 static-npe trans 300 recv 400 
  peer 4.4.4.9 static-upe trans 200 recv 100 
#
mpls ldp        
#               
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown  
 ip address 10.10.1.1 255.255.255.0
 mpls           
 mpls ldp       
#               
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown  
 ip address 10.10.3.1 255.255.255.0
 mpls           
 mpls ldp       
#               
interface LoopBack1
 ip address 1.1.1.9 255.255.255.255
#               
ospf 1          
 area 0.0.0.0   
  network 1.1.1.9 0.0.0.0
  network 10.10.1.0 0.0.0.255
  network 10.10.3.0 0.0.0.255
#               
return</pre>
</li><li><p>P configuration file</p>
<pre class="screen">#
sysname P
#
mpls lsr-id 2.2.2.9
#
mpls
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown  
 ip address 10.10.1.2 255.255.255.0
 mpls           
 mpls ldp       
#               
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown  
 ip address 10.10.2.1 255.255.255.0
 mpls           
 mpls ldp       
#               
interface LoopBack1
 ip address 2.2.2.9 255.255.255.255
#               
ospf 1          
 area 0.0.0.0   
  network 2.2.2.9 0.0.0.0
  network 10.10.1.0 0.0.0.255
  network 10.10.2.0 0.0.0.255
#               
return</pre>
</li><li><p>SPE2 configuration file</p>
<pre class="screen">#
sysname SPE2
#
mpls lsr-id 3.3.3.9
#
mpls
#
mpls l2vpn
#
vsi v100
 pwsignal ldp
  vsi-id 100
  mac-withdraw enable
  peer 1.1.1.9 static-npe trans 400 recv 300 
  peer 5.5.5.9 static-upe trans 200 recv 100 
#
mpls ldp        
#               
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown  
 ip address 10.10.2.2 255.255.255.0
 mpls           
 mpls ldp       
#               
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown  
 ip address 10.10.4.1 255.255.255.0
 mpls           
 mpls ldp       
#               
interface LoopBack1
 ip address 3.3.3.9 255.255.255.255
#               
ospf 1          
 area 0.0.0.0   
  network 3.3.3.9 0.0.0.0
  network 10.10.2.0 0.0.0.255
  network 10.10.4.0 0.0.0.255
#               
return</pre>
</li><li><p>UPE2 configuration file</p>
<pre class="screen">#
sysname UPE2
#
mpls lsr-id 5.5.5.9
#
mpls
#
mpls l2vpn
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown  
 ip address 10.10.4.2 255.255.255.0
 mpls           
 mpls ldp       
#               
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown  
#               
interface GigabitEthernet<span>0/2/0</span>.1
 vlan-type dot1q 1
 mpls static-l2vc destination 3.3.3.9 transmit-vpn-label 100 receive-vpn-label 200
#               
interface LoopBack1
 ip address 5.5.5.9 255.255.255.255
#               
ospf 1          
 area 0.0.0.0   
  network 5.5.5.9 0.0.0.0
  network 10.10.4.0 0.0.0.255
#               
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_5029.html">Configuration Examples for VPLS
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_5033.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_5056.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>