
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring LDP HVPLS">
<meta name="abstract" content="If there are a large number of PEs on a VPLS network, you can use HVPLS networking to lower the performance requirements on the PEs.">
<meta name="description" content="If there are a large number of PEs on a VPLS network, you can use HVPLS networking to lower the performance requirements on the PEs.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_5029.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_5080.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_6035.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,vpls,w00556928,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="VPLS">
<meta name="featuretype" content="VPN">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="VPLS">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="VPLS">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="VPLS">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="l00415692">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00415692">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172370254">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring LDP HVPLS</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172370254"></a><a name="EN-US_TASK_0172370254"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring LDP HVPLS</h1>
<div class="taskbody"><p>If there are a large number of PEs on a VPLS network, you can use HVPLS networking to lower the performance requirements on the PEs.</p>
<div class="context"><a name="EN-US_TASK_0172370254__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0172370254__fig_dc_vrp_vpls_cfg_503201">Figure 1</a>, Site1, Site2, and Site3 belong to the same VPLS network; CE1 and CE2 access the basic full-mesh VPLS network through a UPE; CE3 accesses the network through a PE.</p>
<div class="fignone" id="EN-US_TASK_0172370254__fig_dc_vrp_vpls_cfg_503201"><a name="EN-US_TASK_0172370254__fig_dc_vrp_vpls_cfg_503201"></a><a name="fig_dc_vrp_vpls_cfg_503201"></a><span class="figcap"><b>Figure 1 </b>Configuring LDP HVPLS</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><ul><li><p>In this example, interface1, interface2, interface3, subinterface1.1, and subinterface2.1 represent GE<span>0/1/0</span>, GE<span>0/2/0</span>, GE<span>0/3/0</span>, GE<span>0/1/0</span>.1, and GE<span>0/2/0</span>.1, respectively.</p>
</li></ul>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_vpls_cfg_503201.png"></span><br></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172370254__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Precautions</h4><p>During the configuration, note the following:</p>
<ul><li>PEs belonging to the same L2VPN must have the same VSI ID.</li></ul>
</div></div>
<div class="context"><a name="EN-US_TASK_0172370254__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure LDP VPLS between the SPE and PE. For configuration details, see <a href="dc_vrp_vpls_cfg_5003.html">Configuring LDP VPLS</a>.</p>
</li><li><p>Establish an MPLS LDP peer relationship between the UPE and SPE.</p>
</li><li><p>Create a VSI on the SPE and specify the UPE as the lower-layer PE of the SPE.</p>
</li><li><p>Create a VSI on the UPE and specify the SPE as the VSI peer.</p>
</li><li><p>Configure CE1 and CE2 to access the UPE and configure CE3 to access the PE.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172370254__1.4.4"></a><a name="1.4.4"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>VSI names and IDs</p>
</li><li><p>MPLS LSR IDs (as peer IP addresses) of UPEs, SPEs, and PEs</p>
</li><li><p>Routing protocol</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172370254__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure an IGP.</span><p><p>OSPF is used in this example. For detailed configurations, see Configuration Files.</p>
<p>After the configuration is complete, run the <strong>display ip routing-table</strong> command on the UPE, SPE, and PE. The command output shows that the UPE, SPE, and PE have learned each other's loopback interface address.</p>
</p></li><li><span>Configure basic MPLS functions and LDP.</span><p><p>For detailed configurations, see Configuration Files.</p>
<p>After the configuration is complete, run the <strong>display mpls ldp session</strong> command on the UPE, SPE, and PE. The command output shows that <strong>Status</strong> is <strong>Operational</strong> for the peer relationship between the UPE and SPE and between the PE and SPE. Run the <strong>display mpls lsp</strong> command. The command output shows whether LSPs have been set up.</p>
</p></li><li><span>Enable MPLS L2VPN and configure a VSI.</span><p><p># Configure the UPE.</p>
<pre class="screen">&lt;UPE&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>vsi v123 </strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vsi-v123] <strong>pwsignal ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vsi-v123-ldp] <strong>vsi-id 123</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vsi-v123-ldp] <strong>peer 2.2.2.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vsi-v123-ldp] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vsi-v123-ldp] <strong>quit</strong></pre>
<p># Configure the SPE.</p>
<pre class="screen">&lt;SPE&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE] <strong>vsi v123 </strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE-vsi-v123] <strong>pwsignal ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE-vsi-v123-ldp] <strong>vsi-id 123</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE-vsi-v123-ldp] <strong>peer 3.3.3.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE-vsi-v123-ldp] <strong>peer 1.1.1.9 upe</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE-vsi-v123-ldp] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE-vsi-v123-ldp] <strong>quit</strong></pre>
<p># Configure the PE.</p>
<pre class="screen">&lt;PE&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE] <strong>vsi v123 </strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-vsi-v123] <strong>pwsignal ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-vsi-v123-ldp] <strong>vsi-id 123</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-vsi-v123-ldp] <strong>peer 2.2.2.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-vsi-v123-ldp] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-vsi-v123-ldp] <strong>quit</strong></pre>
</p></li><li><span>Bind AC interfaces to VSIs on the UPE and PE.</span><p><p># Configure the UPE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE]<strong> interface gigabitethernet<span>0/1/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/0</span>.1]<strong> shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/0</span>.1]<strong> vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet1<span>0/1/0</span>.1]<strong> l2 binding vsi v123</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/0</span>.1]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/0</span>.1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE]<strong> interface gigabitethernet<span>0/2/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/2/0</span>.1]<strong> shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/2/0</span>.1]<strong> vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/2/0</span>.1]<strong> l2 binding vsi v123</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/2/0</span>.1]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/2/0</span>.1]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/2/0</span>.1]<strong> quit</strong></pre>
<p># Configure the PE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE]<strong> interface gigabitethernet<span>0/2/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-GigabitEthernet<span>0/2/0</span>.1]<strong> shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-GigabitEthernet<span>0/2/0</span>.1]<strong> vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-GigabitEthernet<span>0/2/0</span>.1]<strong> l2 binding vsi v123</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-GigabitEthernet<span>0/2/0</span>.1]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-GigabitEthernet<span>0/2/0</span>.1]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-GigabitEthernet<span>0/2/0</span>.1]<strong> quit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p>After the configuration is complete, run the<strong> display vsi name v123 verbose</strong> command on the SPE. The command output shows that the status of a VSI named <strong>v123</strong> is <strong>up</strong>, and the status of the corresponding PW is also <strong>up</strong>.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE] <strong>display vsi name v123 verbose</strong></pre>
<pre class="screen"> ***VSI Name               : v123
    Administrator VSI      : no
    Isolate Spoken         : disable
    VSI Index              : 1
    PW Signaling           : ldp
    Member Discovery Style : --
<span>    Bridge-domain Mode     : disable</span>
<span>    PW MAC Learning Style  : unqualify</span>
    Encapsulation Type     : vlan
    MTU                    : 1500
    Diffserv Mode          : uniform
    Service Class          : --
    Color                  : --
    DomainId               : 255
    Domain Name            :
    Ignore AcState         : disable
    P2P VSI                : disable
    Create Time            : 0 days, 0 hours, 20 minutes, 49 seconds
    <strong>VSI State              : up</strong>
<span>    Resource Status        : --</span>

    VSI ID                 : 123
   *Peer Router ID         : 1.1.1.9
    primary or secondary   : primary
    ignore-standby-state   : no
    VC Label               : 19
    Peer Type              : dynamic
    Session                : up
    Tunnel ID              : 0x0000000001004c4b41
    Broadcast Tunnel ID    : --
    Broad BackupTunnel ID  : --
    CKey                   : 2
    NKey                   : 788529260
<span>    Stp Enable             : 0</span>
    PwIndex                : 2
<span>    Control Word           : disable</span>
   *Peer Router ID         : 3.3.3.9
    primary or secondary   : primary
    ignore-standby-state   : no
    VC Label               : 18
    Peer Type              : dynamic
    Session                : up
    Tunnel ID              : 0x0000000001004c4b42
    Broadcast Tunnel ID    : --
    Broad BackupTunnel ID  : --
    CKey                   : 1
    NKey                   : 788529259
<span>    Stp Enable             : 0</span>
    PwIndex                : 1
<span>    Control Word           : disable</span>

  **PW Information:

   *Peer Ip Address        : 1.1.1.9
    PW State               : up
    Local VC Label         : 19
    Remote VC Label        : 19
<span>    Remote Control Word    : disable</span>
    <strong>PW Type                : MEHVPLS</strong>
    Tunnel ID              : 0x0000000001004c4b41
    Broadcast Tunnel ID    : --
    Broad BackupTunnel ID  : --
    Ckey                   : 2
    Nkey                   : 788529260
    Main PW Token          : 0x0
    Slave PW Token         : 0x0
    Tnl Type               : ldp
    OutInterface           : LDP LSP
    Backup OutInterface    : --
<span>    Stp Enable             : 0</span>
    PW Last Up Time        : 2012/12/05 07:05:36
    PW Total Up Time       : 0 days, 0 hours, 18 minutes, 34 seconds
   *Peer Ip Address        : 3.3.3.9
    PW State               : up
    Local VC Label         : 18
    Remote VC Label        : 19
<span>    Remote Control Word    : disable</span>
    PW Type                : label
    Tunnel ID              : 0x0000000001004c4b42
    Broadcast Tunnel ID    : --
    Broad BackupTunnel ID  : --
    Ckey                   : 1
    Nkey                   : 788529259
    Main PW Token          : 0x0
    Slave PW Token         : 0x0
    Tnl Type               : ldp
    OutInterface           : LDP LSP
    Backup OutInterface    : --
<span>    Stp Enable             : 0</span>
    PW Last Up Time        : 2012/12/05 07:05:59
    PW Total Up Time       : 0 days, 0 hours, 18 minutes, 2 seconds</pre>
<p>CE1, CE2, and CE3 can ping each other. After you run the <strong>shutdown</strong> command on GE <span>0/2/0</span>.1 (to which the VSI is bound) of the UPE or the PE, CE2 and CE3 cannot ping each other. This means that user data is transmitted over the PW of this VSI.</p>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172370254__1.4.6"></a><a name="1.4.6"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>UPE configuration file</p>
<pre class="screen">#
sysname UPE
#
mpls lsr-id 1.1.1.9
#
mpls
#
mpls l2vpn
#
vsi v123 
 pwsignal ldp
  vsi-id 123
  peer 2.2.2.9
#
mpls ldp
#
mpls ldp remote-peer 2.2.2.9
 remote-ip 2.2.2.9
#
interface GigabitEthernet<span>0/1/0</span>.1
 undo shutdown
 vlan-type dot1q 10
 l2 binding vsi v123
#
interface GigabitEthernet<span>0/2/0</span>.1
 undo shutdown
 vlan-type dot1q 10
 l2 binding vsi v123
#
interface GigabitEthernet<span>0/3/0</span>
 undo shutdown
 ip address 10.10.1.1 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 1.1.1.9 255.255.255.255
#
ospf 1
 area 0.0.0.0
  network 1.1.1.9 0.0.0.0
  network 10.10.1.0 0.0.0.255
#
return</pre>
</li><li><p>SPE configuration file</p>
<pre class="screen">#
sysname SPE
#
mpls lsr-id 2.2.2.9
#
mpls
#
mpls l2vpn
#
vsi v123 
 pwsignal ldp
  vsi-id 123
  peer 3.3.3.9
  peer 1.1.1.9 upe
#
mpls ldp
#
mpls ldp remote-peer 1.1.1.9
 remote-ip 1.1.1.9
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.10.1.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.20.1.1 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 2.2.2.9 255.255.255.255
#
ospf 1
 area 0.0.0.0
  network 2.2.2.9 0.0.0.0
  network 10.20.1.0 0.0.0.255
  network 10.10.1.0 0.0.0.255
#
return</pre>
</li><li><p>PE configuration file</p>
<pre class="screen">#
sysname PE
#
mpls lsr-id 3.3.3.9
#
mpls
#
mpls l2vpn
#
vsi v123 
 pwsignal ldp
  vsi-id 123
  peer 2.2.2.9
#
mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>.1
 undo shutdown
 vlan-type dot1q 10
 l2 binding vsi v123
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.20.1.2 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 3.3.3.9 255.255.255.255
#
ospf 1
 area 0.0.0.0
  network 10.20.1.0 0.0.0.255
  network 3.3.3.9 0.0.0.0
#
return</pre>
</li><li><p>CE1 configuration file</p>
<pre class="screen">#
 sysname CE1
#
interface GigabitEthernet<span>0/1/0</span>.1
 undo shutdown
 vlan-type dot1q 10
 ip address 10.1.1.1 255.255.255.0
#
return</pre>
</li><li><p>CE2 configuration file</p>
<pre class="screen">#
 sysname CE2
#
interface GigabitEthernet<span>0/1/0</span>.1
 undo shutdown
 vlan-type dot1q 10
 ip address 10.1.1.2 255.255.255.0
#
return</pre>
</li><li><p>CE3 configuration file</p>
<pre class="screen">#
 sysname CE3
#
interface GigabitEthernet<span>0/1/0</span>.1
 undo shutdown
 vlan-type dot1q 10
 ip address 10.1.1.3 255.255.255.0
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_5029.html">Configuration Examples for VPLS
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_5080.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_6035.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>