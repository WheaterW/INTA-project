
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Dynamic VPWS Accessing VPLS">
<meta name="abstract" content="If UPEs do not support VPLS, you can configure VPWS accessing VPLS.">
<meta name="description" content="If UPEs do not support VPLS, you can configure VPWS accessing VPLS.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_5029.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_6035.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_6033.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="VPLS">
<meta name="featuretype" content="VPN">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="VPLS">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="VPLS">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="VPLS">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="l00415692">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00415692">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172370260">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring Dynamic VPWS Accessing VPLS</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172370260"></a><a name="EN-US_TASK_0172370260"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Dynamic VPWS Accessing VPLS</h1>
<div class="taskbody"><p>If UPEs do not support VPLS, you can configure VPWS accessing VPLS.</p>
<div class="context"><a name="EN-US_TASK_0172370260__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0172370260__fig_dc_vrp_vpls_cfg_503301">Figure 1</a>, UPEs access SPEs over VPWS; CE1 and CE2 access a full-mesh VPLS network through UPEs.</p>
<div class="fignone" id="EN-US_TASK_0172370260__fig_dc_vrp_vpls_cfg_503301"><a name="EN-US_TASK_0172370260__fig_dc_vrp_vpls_cfg_503301"></a><a name="fig_dc_vrp_vpls_cfg_503301"></a><span class="figcap"><b>Figure 1 </b>Configuring dynamic VPWS accessing VPLS</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><ul><li><p>In this example, interface1, interface2, subinterface1.1, and subinterface2.1 represent GE<span>0/1/0</span>, GE<span>0/2/0</span>, GE<span>0/1/0</span>.1, and GE<span>0/2/0</span>.1, respectively.</p>
</li></ul>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_vpls_cfg_503301.png"></span><br></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172370260__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Precautions</h4><p>During the configuration, note the following:</p>
<ul><li>PEs belonging to the same L2VPN must have the same VSI ID.</li></ul>
</div></div>
<div class="context"><a name="EN-US_TASK_0172370260__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure LDP VPLS between SPEs.</p>
</li><li><p>Configure basic MPLS L2VPN functions on UPEs and SPEs.</p>
</li><li><p>Configure VPWS and a VSI on each SPE, and enable MAC Withdraw for the VSI.</p>
</li><li><p>Configure UPEs to access SPEs over VPWS.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172370260__1.4.4"></a><a name="1.4.4"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>VSI names and IDs</p>
</li><li><p>MPLS LSR IDs (as peer IP addresses) of UPEs and SPEs</p>
</li><li><p>Routing protocol</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172370260__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure IP addresses.</span><p><p>Configure an IP address and mask for each interface, including the loopback interface, according to <a href="#EN-US_TASK_0172370260__fig_dc_vrp_vpls_cfg_503301">Figure 1</a>.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>UPEs function as switching devices. If all the interfaces on UPEs are Layer 2 GE interfaces, you cannot directly configure IP addressed for the interfaces. Instead, you need to add the interfaces to a VLAN, and then configure IP addresses for the VLANIF interfaces. For details, see "VLAN Configuration" in <em><span class="keyword">NE40E</span> Configuration Guide - LAN Access and MAN Access</em>.</p>
</div></div>
</p></li><li><span>Configure an IGP.</span><p><p>Configure OSPF on SPEs and P to advertise the network segment and the host routes of LSR IDs.</p>
<p># Configure SPE1.</p>
<pre class="screen">&lt;SPE1&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE1]<strong> ospf</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-ospf-1]<strong> area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-ospf-1-area-0.0.0.0]<strong> network 1.1.1.9 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-ospf-1-area-0.0.0.0]<strong> network 10.10.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-ospf-1-area-0.0.0.0]<strong> network 10.10.3.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-ospf-1-area-0.0.0.0]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-ospf-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1]<strong> commit</strong></pre>
<p># Configure the P.</p>
<pre class="screen">&lt;P&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P]<strong> ospf</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-ospf-1]<strong> area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-ospf-1-area-0.0.0.0]<strong> network 2.2.2.9 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-ospf-1-area-0.0.0.0]<strong> network 10.10.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-ospf-1-area-0.0.0.0]<strong> network 10.10.2.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-ospf-1-area-0.0.0.0]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-ospf-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P]<strong> commit</strong></pre>
<p># Configure SPE2.</p>
<pre class="screen">&lt;SPE2&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE2]<strong> ospf</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-ospf-1]<strong> area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-ospf-1-area-0.0.0.0]<strong> network 3.3.3.9 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-ospf-1-area-0.0.0.0]<strong> network 10.10.2.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-ospf-1-area-0.0.0.0]<strong> network 10.10.4.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-ospf-1-area-0.0.0.0]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-ospf-1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2]<strong> commit</strong></pre>
<p># Configure UPE1.</p>
<pre class="screen">&lt;UPE1&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE1]<strong> ospf</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-ospf-1]<strong> area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-ospf-1-area-0.0.0.0]<strong> network 4.4.4.9 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-ospf-1-area-0.0.0.0]<strong> network 10.10.3.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-ospf-1-area-0.0.0.0]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-ospf-1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1]<strong> commit</strong></pre>
<p># Configure UPE2.</p>
<pre class="screen">&lt;UPE2&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE2]<strong> ospf</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-ospf-1]<strong> area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-ospf-1-area-0.0.0.0]<strong> network 5.5.5.9 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-ospf-1-area-0.0.0.0]<strong> network 10.10.4.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-ospf-1-area-0.0.0.0]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-ospf-1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2]<strong> commit</strong></pre>
</p></li><li><span>Configure basic MPLS functions and LDP.</span><p><p># Configure SPE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE1]<strong> mpls lsr-id 1.1.1.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-mpls-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-GigabitEthernet<span>0/1/0</span>]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-GigabitEthernet<span>0/1/0</span>]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-GigabitEthernet<span>0/1/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1]<strong> interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-GigabitEthernet<span>0/2/0</span>]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-GigabitEthernet<span>0/2/0</span>]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-GigabitEthernet<span>0/2/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1]<strong> commit</strong></pre>
<p># Configure the P.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P]<strong> mpls lsr-id 2.2.2.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-mpls-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/0</span>]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/0</span>]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P]<strong> interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/2/0</span>]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/2/0</span>]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P]<strong> commit</strong></pre>
<p># Configure SPE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE2]<strong> mpls lsr-id 3.3.3.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-mpls-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-GigabitEthernet<span>0/1/0</span>]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-GigabitEthernet<span>0/1/0</span>]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-GigabitEthernet<span>0/1/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2]<strong> interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-GigabitEthernet<span>0/2/0</span>]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-GigabitEthernet<span>0/2/0</span>]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-GigabitEthernet<span>0/2/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2]<strong> commit</strong></pre>
<p># Configure UPE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE1]<strong> mpls lsr-id 4.4.4.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-mpls-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-GigabitEthernet<span>0/1/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1]<strong> commit</strong></pre>
<p># Configure UPE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE2] <strong>mpls lsr-id 5.5.5.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-mpls-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-GigabitEthernet<span>0/1/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE2]<strong> commit</strong></pre>
<p>After the configuration is complete, run the <strong>display mpls ldp session</strong> command on SPE1, the P, and SPE2. The command output shows that <strong>Status</strong> is <strong>Operational</strong> for the peer relationships between SPE1 and the P and between SPE2 and the P, indicating that the peer relationships have been set up. Run the <strong>display mpls lsp</strong> command. The command output shows whether LSPs have been set up.</p>
<p>The following example uses the command output on SPE1.</p>
<pre class="screen">&lt;SPE1&gt; <strong>display mpls ldp session</strong></pre>
<pre class="screen">LDP Session(s) in Public Network</pre>
<pre class="screen">Codes: LAM(Label Advertisement Mode), SsnAge Unit(DDDD:HH:MM)</pre>
<pre class="screen"><span> An asterisk (*) before a session means the session is being deleted.</span></pre>
<pre class="screen"> ------------------------------------------------------------------------------</pre>
<pre class="screen"> PeerID            Status      LAM  SsnRole  SsnAge      KASent/Rcv</pre>
<pre class="screen"> ------------------------------------------------------------------------------</pre>
<pre class="screen"> 2.2.2.9:0          <strong>Operational</strong> DU   Passive  000:00:01   7/7</pre>
<pre class="screen"> ------------------------------------------------------------------------------</pre>
<pre class="screen"> TOTAL: 1 session(s) Found.</pre>
<pre class="screen">&lt;SPE1&gt; <strong>display mpls lsp</strong></pre>
<pre class="screen">Flag after Out IF: (I) - RLFA Iterated LSP, (I*) - Normal and RLFA Iterated LSP </pre>
<pre class="screen">Flag after LDP FRR: (L) - Logic FRR LSP</pre>
<pre class="screen">----------------------------------------------------------------------</pre>
<pre class="screen">                 LSP Information: LDP LSP</pre>
<pre class="screen">----------------------------------------------------------------------</pre>
<pre class="screen">FEC                In/Out Label  In/Out IF                      Vrf Name</pre>
<pre class="screen">2.2.2.9/32         NULL/3        -/GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen">1.1.1.9/32         3/NULL        -/-</pre>
<pre class="screen">3.3.3.9/32         NULL/1025     -/GigabitEthernet<span>0/1/0</span></pre>
</p></li><li><span>Establish a remote LDP session between SPEs.</span><p><p># Configure SPE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE1] <strong>mpls ldp remote-peer 3.3.3.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-mpls-ldp-remote-3.3.3.9] <strong>remote-ip 3.3.3.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-mpls-ldp-remote-3.3.3.9] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1]<strong> commit</strong></pre>
<p># Configure SPE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE2]<strong> mpls ldp remote-peer 1.1.1.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-mpls-ldp-remote-1.1.1.9] <strong>remote-ip 1.1.1.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-mpls-ldp-remote-1.1.1.9] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2]<strong> commit</strong></pre>
<p>After the configuration is complete, run the <strong>display mpls ldp session</strong> command on SPE1 and SPE2. The status of the peer relationship between SPE1 and SPE2 is <strong>Operational</strong>, indicating that the peer relationship has been established.</p>
<p>The following example uses the command output on SPE1.</p>
<pre class="screen">&lt;SPE1&gt; <strong>display mpls ldp session</strong></pre>
<pre class="screen">LDP Session(s) in Public Network</pre>
<pre class="screen">Codes: LAM(Label Advertisement Mode), SsnAge Unit(DDDD:HH:MM)</pre>
<pre class="screen"><span> An asterisk (*) before a session means the session is being deleted.</span></pre>
<pre class="screen"> ------------------------------------------------------------------------------</pre>
<pre class="screen"> PeerID            Status      LAM  SsnRole  SsnAge      KASent/Rcv</pre>
<pre class="screen"> ------------------------------------------------------------------------------</pre>
<pre class="screen"> 2.2.2.9:0          Operational DU   Passive  000:00:05   24/24</pre>
<pre class="screen"> 3.3.3.9:0          Operational DU   Passive  000:00:01   5/5</pre>
<pre class="screen"> ------------------------------------------------------------------------------</pre>
<pre class="screen"> TOTAL: 2 session(s) Found.</pre>
</p></li><li><span>Enable MPLS L2VPN on UPEs and configure UPEs to access SPEs over VPWS.</span><p><p># Configure UPE1.</p>
<pre class="screen">&lt;UPE1&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE1]<strong> mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1] <strong>interface gigabitethernet <span>0/2/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-GigabitEthernet<span>0/2/0</span>.1] <strong>shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-GigabitEthernet<span>0/2/0</span>.1] <strong>vlan-type dot1q 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-GigabitEthernet<span>0/2/0</span>.1] <strong>mpls l2vc 1.1.1.9 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-GigabitEthernet<span>0/2/0</span>.1] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-GigabitEthernet<span>0/2/0</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1]<strong> commit</strong></pre>
<p># Configure UPE2.</p>
<pre class="screen">&lt;UPE2&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE2]<strong> mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2] <strong>interface gigabitethernet <span>0/2/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-GigabitEthernet<span>0/2/0</span>.1]<strong> shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-GigabitEthernet<span>0/2/0</span>.1] <strong>vlan-type dot1q 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-GigabitEthernet<span>0/2/0</span>.1] <strong>mpls l2vc 3.3.3.9 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-GigabitEthernet<span>0/2/0</span>.1]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-GigabitEthernet<span>0/2/0</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2]<strong> commit</strong></pre>
</p></li><li><span>Enable MPLS L2VPN and configure VSIs on SPEs.</span><p><p># Configure SPE1.</p>
<pre class="screen">&lt;SPE1&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE1]<strong> mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1]<strong> vsi v100 </strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-vsi-v100] <strong>pwsignal ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-vsi-v100-ldp] <strong>vsi-id 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-vsi-v100-ldp]<strong> mac-withdraw enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-vsi-v100-ldp] <strong>peer 3.3.3.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-vsi-v100-ldp] <strong>peer 4.4.4.9 upe</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-vsi-v100-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-vsi-v100]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1]<strong> commit</strong></pre>
<p># Configure SPE2.</p>
<pre class="screen">&lt;SPE2&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE2]<strong> mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2]<strong> vsi v100 </strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-vsi-v100]<strong> pwsignal ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-vsi-v100-ldp]<strong> vsi-id 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-vsi-v100-ldp] <strong>mac-withdraw enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-vsi-v100-ldp] <strong>peer 1.1.1.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-vsi-v100-ldp] <strong>peer 5.5.5.9 upe</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-vsi-v100-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-vsi-v100]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2]<strong> commit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p>After the configuration is complete, run the <strong>display mpls l2vc</strong> command on UPEs. The command output shows that a PW has been established and <strong>VC state</strong> is <strong>up</strong>. The following example uses the command output on UPE1.</p>
<pre class="screen">&lt;UPE1&gt;<strong> display mpls l2vc interface gigabitethernet <span>0/2/0</span>.1</strong></pre>
<pre class="screen">*client interface       : GigabitEthernet<span>0/2/0</span>.1 is up
 Administrator PW       : no
 session state          : up
 AC status              : up
 <strong>VC state               : up</strong>
 Label state            : 0
 Token state            : 0
 VC ID                  : 100
 VC type                : VLAN
 destination            : 1.1.1.9
 local group ID         : 0         remote group ID      : 0
 local VC label         : 23        remote VC label      : 24
 local AC OAM State     : up
 local PSN OAM State    : up
 local forwarding state : forwarding
 local status code      : 0x0 (forwarding)
 remote AC OAM State    : up
 remote PSN OAM state   : up
 remote forwarding state: forwarding
 remote status code     : 0x0 (forwarding)
 ignore standby state   : no
 BFD for PW             : unavailable
 VCCV State             : --
 manual fault           : not set
 active state           : active
 forwarding entry       : exist
 OAM Protocol           : --
 OAM Status             : --
 OAM Fault Type         : --
<span> PW APS ID              : --  </span>
<span> PW APS Status          : --</span>
 TTL Value              : 1
 link state             : up
 local VC MTU           : 1500      remote VC MTU        : 1500
 local VCCV             : alert ttl lsp-ping bfd
 remote VCCV            : alert lsp-ping
 local control word     : disable   remote control word  : disable
 tunnel policy name     : --
 PW template name       : --
 primary or secondary   : primary
 load balance type      : flow
 Access-port            : false
 Switchover Flag        : false
 VC tunnel info         : 1 tunnels
    NO.0 TNL type       : ldp, TNL ID : 0x0000000001004c4b61
 create time            : 0 days, 0 hours, 19 minutes, 17 seconds
 up time                : 0 days, 0 hours, 14 minutes, 34 seconds
 last change time       : 0 days, 0 hours, 14 minutes, 34 seconds
 VC last up time        : 2012/12/05 08:13:31
 VC total up time       : 0 days, 0 hours, 14 minutes, 34 seconds
 CKey                   : 65
 NKey                   : 1493172339
 PW redundancy mode     : frr
 AdminPw interface      : --
 AdminPw link state     : --
<span> Forward state          : send inactive, receive inactive </span>
 Diffserv Mode          : uniform
 Service Class          : --
 Color                  : --
 DomainId               : --
 Domain Name            : --</pre>
<p>Run the <strong>display vsi name v100 verbose </strong>command on SPEs. The command output shows that a VSI named <strong>v100</strong> is up and the corresponding PW is also up. The information displayed on SPE1 is used as an example.</p>
<pre class="screen">&lt;SPE1&gt; <strong>display vsi name v100 verbose</strong></pre>
<pre class="screen"> ***VSI Name               : v100
    Administrator VSI      : no
    Isolate Spoken         : disable
    VSI Index              : 2
    PW Signaling           : ldp
    Member Discovery Style : --
<span>    Bridge-domain Mode     : disable</span>
<span>    PW MAC Learning Style  : unqualify</span>
    Encapsulation Type     : vlan
    MTU                    : 1500
    Diffserv Mode          : uniform
    Service Class          : --
    Color                  : --
    DomainId               : 255
    Domain Name            :
    Ignore AcState         : disable
    P2P VSI                : disable
    Create Time            : 0 days, 0 hours, 4 minutes, 8 seconds
    <strong>VSI State              : up</strong>
<span>    Resource Status        : --</span>

    VSI ID                 : 100
   *Peer Router ID         : 3.3.3.9
    primary or secondary   : primary
    ignore-standby-state   : no
    VC Label               : 23
    Peer Type              : dynamic
    Session                : up
    Tunnel ID              : 0x0000000001004c4b62
    Broadcast Tunnel ID    : --
    Broad BackupTunnel ID  : --
    CKey                   : 33
    NKey                   : 788529266
    Stp Enable             : 0
    PwIndex                : 33
<span>    Control Word           : disable</span>
   *Peer Router ID         : 4.4.4.9
    primary or secondary   : primary
    ignore-standby-state   : no
    VC Label               : 24
    Peer Type              : dynamic
    Session                : up
    Tunnel ID              : 0x0000000001004c4b63
    Broadcast Tunnel ID    : --
    Broad BackupTunnel ID  : --
    CKey                   : 34
    NKey                   : 788529267
<span>    Stp Enable             : 0</span>
    PwIndex                : 34
<span>    Control Word           : disable</span>

  **PW Information:

   *Peer Ip Address        : 3.3.3.9
    <strong>PW State               : up</strong>
    Local VC Label         : 23
    Remote VC Label        : 19
<span>    Remote Control Word    : disable</span>
    PW Type                : label
    Tunnel ID              : 0x0000000001004c4b62
    Broadcast Tunnel ID    : --
    Broad BackupTunnel ID  : --
    Ckey                   : 33
    Nkey                   : 788529266
    Main PW Token          : 0x0
    Slave PW Token         : 0x0
    Tnl Type               : ldp
    OutInterface           : LDP LSP
    Backup OutInterface    : --
<span>    Stp Enable             : 0</span>
    PW Last Up Time        : 2012/12/05 08:14:03
    PW Total Up Time       : 0 days, 0 hours, 2 minutes, 20 seconds
   *Peer Ip Address        : 4.4.4.9
    PW State               : up
    Local VC Label         : 24
    Remote VC Label        : 23
<span>    Remote Control Word    : disable</span>
    PW Type                : MEHVPLS
    Tunnel ID              : 0x0000000001004c4b63
    Broadcast Tunnel ID    : --
    Broad BackupTunnel ID  : --
    Ckey                   : 34
    Nkey                   : 788529267
    Main PW Token          : 0x0
    Slave PW Token         : 0x0
    Tnl Type               : ldp
    OutInterface           : LDP LSP
    Backup OutInterface    : --
<span>    Stp Enable             : 0</span>
    PW Last Up Time        : 2012/12/05 08:13:30
    PW Total Up Time       : 0 days, 0 hours, 3 minutes, 7 seconds </pre>
<p>CE1 and CE2, which reside on the same network segment, can ping each other. After the <strong>shutdown</strong> command is run on GE <span>0/2/0</span>.1 that is bound to the VSI on the UPE or PE, CE1 and CE2 cannot ping each other. This indicates that service data is transmitted through the PW of the VSI.</p>
<p>Before GE <span>0/2/0</span> on SPE1 is shut down, check the MAC address table learned by the VSI on SPE2.</p>
<pre class="screen">&lt;SPE2&gt; <strong>display mac-address dynamic</strong></pre>
<pre class="screen">MAC address table of slot <span>1</span>:
-------------------------------------------------------------------------------
MAC Address    VLAN<span>/BD</span>/    PEVLAN CEVLAN Port                        Type      LSP/LSR-ID
               VSI/SI<span>/EVPN</span>                                                     MAC-Tunnel
-------------------------------------------------------------------------------
00e0-fc00-1234 V100        -      -      GigabitEthernet<span>0/2/0</span>        dynamic   10/51
00e0-fc00-3456 V100        -      -      GigabitEthernet<span>0/1/0</span>        dynamic   10/49
-------------------------------------------------------------------------------
Total matching items on slot <span>1</span> displayed = 2</pre>
<p>After GE <span>0/2/0</span> on SPE1 is shut down, the VSI becomes down. Check the MAC address table learned by the VSI on SPE2, and you can find that the MAC address learned by GE <span>0/2/0</span> is deleted.</p>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172370260__1.4.6"></a><a name="1.4.6"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>CE1 configuration file</p>
<pre class="screen">#
sysname CE1
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
#
interface GigabitEthernet<span>0/1/0</span>.1
 undo shutdown
 vlan-type dot1q 1
 ip address 10.1.1.1 255.255.255.0
#
return</pre>
</li><li><p>CE2 configuration file</p>
<pre class="screen">#
sysname CE2
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
#
interface GigabitEthernet<span>0/1/0</span>.1
 undo shutdown
 vlan-type dot1q 1
 ip address 10.1.1.2 255.255.255.0
#
return</pre>
</li><li><p>UPE1 configuration file</p>
<pre class="screen">#
sysname UPE1
#
mpls lsr-id 4.4.4.9
#
mpls
#
mpls l2vpn
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.10.3.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
#
interface GigabitEthernet<span>0/2/0</span>.1
 undo shutdown
 vlan-type dot1q 1
 mpls l2vc 1.1.1.9 100
#
interface LoopBack1
 ip address 4.4.4.9 255.255.255.255
#
ospf 1
 area 0.0.0.0
  network 4.4.4.9 0.0.0.0
  network 10.10.3.0 0.0.0.255
#
return</pre>
</li><li><p>SPE1 configuration file</p>
<pre class="screen">#
sysname SPE1
#
mpls lsr-id 1.1.1.9
#
mpls
#
mpls l2vpn
#
vsi v100 
 pwsignal ldp
  vsi-id 100
  mac-withdraw enable
  peer 3.3.3.9
  peer 4.4.4.9 upe
#
mpls ldp
#
mpls ldp remote-peer 3.3.3.9
 remote-ip 3.3.3.9
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.10.1.1 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.10.3.1 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 1.1.1.9 255.255.255.255
#
ospf 1
 area 0.0.0.0
  network 1.1.1.9 0.0.0.0
  network 10.10.1.0 0.0.0.255
  network 10.10.3.0 0.0.0.255
#
return</pre>
</li><li><p>P configuration file</p>
<pre class="screen">#
sysname P
#
mpls lsr-id 2.2.2.9
#
mpls
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.10.1.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.10.2.1 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 2.2.2.9 255.255.255.255
#
ospf 1
 area 0.0.0.0
  network 2.2.2.9 0.0.0.0
  network 10.10.1.0 0.0.0.255
  network 10.10.2.0 0.0.0.255
#
return</pre>
</li><li><p>SPE2 configuration file</p>
<pre class="screen">#
sysname SPE2
#
mpls lsr-id 3.3.3.9
#
mpls
#
mpls l2vpn
#
vsi v100 
 pwsignal ldp
  vsi-id 100
  mac-withdraw enable
  peer 1.1.1.9
  peer 5.5.5.9 upe
#
mpls ldp
#
mpls ldp remote-peer 1.1.1.9
 remote-ip 1.1.1.9
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.10.2.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.10.4.1 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 3.3.3.9 255.255.255.255
#
ospf 1
 area 0.0.0.0
  network 3.3.3.9 0.0.0.0
  network 10.10.2.0 0.0.0.255
  network 10.10.4.0 0.0.0.255
#
return</pre>
</li><li><p>UPE2 configuration file</p>
<pre class="screen">#
sysname UPE2
#
mpls lsr-id 5.5.5.9
#
mpls
#
mpls l2vpn
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.10.4.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
#
interface GigabitEthernet<span>0/2/0</span>.1
 undo shutdown
 vlan-type dot1q 1
 mpls l2vc 3.3.3.9 100
#
interface LoopBack1
 ip address 5.5.5.9 255.255.255.255
#
ospf 1
 area 0.0.0.0
  network 5.5.5.9 0.0.0.0
  network 10.10.4.0 0.0.0.255
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_5029.html">Configuration Examples for VPLS
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_6035.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_6033.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>