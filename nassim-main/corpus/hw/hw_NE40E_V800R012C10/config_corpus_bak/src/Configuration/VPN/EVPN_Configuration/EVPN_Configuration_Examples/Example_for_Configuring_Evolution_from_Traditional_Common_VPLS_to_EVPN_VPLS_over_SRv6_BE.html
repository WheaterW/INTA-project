
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Evolution from Traditional Common VPLS to EVPN VPLS over SRv6 BE">
<meta name="abstract" content="If a large number of traditional common VPLS services exist on the live network, you can configure evolution from traditional common VPLS to EVPN VPLS over SRv6 BE to prevent long-time traffic interruption caused by direct transition from traditional common VPLS to EVPN VPLS over SRv6 BE.">
<meta name="description" content="If a large number of traditional common VPLS services exist on the live network, you can configure evolution from traditional common VPLS to EVPN VPLS over SRv6 BE to prevent long-time traffic interruption caused by direct transition from traditional common VPLS to EVPN VPLS over SRv6 BE.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0010.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0068.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_dci_cfg_0034.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="p00915595">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="ccms">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001602532165">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>Example for Configuring Evolution from Traditional Common VPLS to EVPN VPLS over SRv6 BE</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001602532165"></a><a name="EN-US_TASK_0000001602532165"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Evolution from Traditional Common VPLS to EVPN VPLS over SRv6 BE</h1>
<div class="taskbody"><p>If a large number of traditional common VPLS services exist on the live network, you can configure evolution from traditional common VPLS to EVPN VPLS over SRv6 BE to prevent long-time traffic interruption caused by direct transition from traditional common VPLS to EVPN VPLS over SRv6 BE.</p>
<div class="context"><a name="EN-US_TASK_0000001602532165__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0000001602532165__fig_dc_vrp_bgp_cfg_407101">Figure 1</a>, traditional common VPLS services have been deployed. It is required that EVPN be deployed on PE1, PE2, and PE3, so that services can be carried over BGP EVPN between PEs. To meet this requirement, an EVPN instance needs to be configured and bound to the BD on PEs. Then, BGP EVPN peer relationships need to be established between PEs.</p>
<div class="fignone" id="EN-US_TASK_0000001602532165__fig_dc_vrp_bgp_cfg_407101"><a name="EN-US_TASK_0000001602532165__fig_dc_vrp_bgp_cfg_407101"></a><a name="fig_dc_vrp_bgp_cfg_407101"></a><span class="figcap"><b>Figure 1 </b>Configuring evolution from traditional VPLS to EVPN VPLS over SRv6 BE</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 through 3 in this example represent GE<span>0/1/0</span>, GE<span>0/2/0</span>, and GE<span>0/3/0</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0000001552827106.png" width="NaN" height="NaN"></span><div class="p">
<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" frame="border" border="1" rules="all"><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="12.58%" id="mcps1.4.1.3.4.1.1.4.1.1" liSelected="liSelected"><p>Device Name</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="22.1%" id="mcps1.4.1.3.4.1.1.4.1.2" liSelected="liSelected"><p>Interface</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="65.32%" id="mcps1.4.1.3.4.1.1.4.1.3" liSelected="liSelected"><p>IP Address</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" rowspan="3" valign="top" width="12.58%" headers="mcps1.4.1.3.4.1.1.4.1.1 "><p>PE1</p>
<p></p>
</td>
<td class="cellrowborder" valign="top" width="22.1%" headers="mcps1.4.1.3.4.1.1.4.1.2 "><p>Loopback 0</p>
</td>
<td class="cellrowborder" valign="top" width="65.32%" headers="mcps1.4.1.3.4.1.1.4.1.3 "><p>1.1.1.1/32</p>
<p>2001:DB8:1::1/128</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.3.4.1.1.4.1.2 "><p>GE <span>0/2/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.3.4.1.1.4.1.3 "><p>10.1.1.1/24</p>
<p>2001:DB8:10::1/64</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.3.4.1.1.4.1.2 "><p>GE <span>0/3/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.3.4.1.1.4.1.3 "><p>10.2.1.1/24</p>
<p>2001:DB8:20::1/64</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="3" valign="top" width="12.58%" headers="mcps1.4.1.3.4.1.1.4.1.1 "><p>PE2</p>
</td>
<td class="cellrowborder" valign="top" width="22.1%" headers="mcps1.4.1.3.4.1.1.4.1.2 "><p>Loopback 0</p>
</td>
<td class="cellrowborder" valign="top" width="65.32%" headers="mcps1.4.1.3.4.1.1.4.1.3 "><p>2.2.2.2/32</p>
<p>2001:DB8:2::2/128</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.3.4.1.1.4.1.2 "><p>GE <span>0/2/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.3.4.1.1.4.1.3 "><p>10.2.1.2/24</p>
<p>2001:DB8:20::2/64</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.3.4.1.1.4.1.2 "><p>GE <span>0/3/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.3.4.1.1.4.1.3 "><p>10.3.1.2/24</p>
<p>2001:DB8:30::2/64</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="3" valign="top" width="12.58%" headers="mcps1.4.1.3.4.1.1.4.1.1 "><p>PE3</p>
<p></p>
</td>
<td class="cellrowborder" valign="top" width="22.1%" headers="mcps1.4.1.3.4.1.1.4.1.2 "><p>Loopback 0</p>
</td>
<td class="cellrowborder" valign="top" width="65.32%" headers="mcps1.4.1.3.4.1.1.4.1.3 "><p>3.3.3.3/32</p>
<p>2001:DB8:3::3/128</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.3.4.1.1.4.1.2 "><p>GE <span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.3.4.1.1.4.1.3 "><p>10.1.1.3/24</p>
<p>2001:DB8:10::3/64</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.3.4.1.1.4.1.2 "><p>GE <span>0/2/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.3.4.1.1.4.1.3 "><p>10.3.1.3/24</p>
<p>2001:DB8:30::3/64</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001602532165__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Precautions</h4><p>During the configuration process, note the following:</p>
<ul><li><p>For the same EVPN instance, the export VPN target list of one site shares VPN targets with the import VPN target lists of the other sites. Conversely, the import VPN target list of one site shares VPN targets with the export VPN target lists of the other sites.</p>
</li><li><p>Using the local loopback interface address of each PE as the source address of the PE is recommended.</p>
</li></ul>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001602532165__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure LDP VPLS on PE1, PE2, CE1, and CE2.</p>
</li><li>Enable IPv6 forwarding and configure an IPv6 address for each involved interface on PE1 and PE2.</li><li><p>Enable IS-IS, configure an IS-IS level, and specify a network entity title (NET) on each of PE1 and PE2.</p>
</li><li><p>Establish a BGP EVPN peer relationship between PEs.</p>
</li><li>Configure BD EVPN on PEs.</li><li>Configure SRv6 BE on PEs.</li><li><p>Create a BD EVPN instance and a BD on each of PE1 and PE3, and bind the BD to the EVPN instance on each PE.</p>
</li><li><p>Configure a source address on each of PE1 and PE3.</p>
</li><li><p>Establish a BGP EVPN peer relationship between PE1 and PE3.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001602532165__1.4.4"></a><a name="1.4.4"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>EVPN instance name (evrf1)</p>
</li><li><p>RD and RT of the EVPN instance</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001602532165__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure an IPv4/IPv6 address for each involved interface and configure IGP on each device. Configure OSPF on PEs for IPv4 route reachability and IS-ISv6 on PEs for IPv6 route reachability.</span><p><p>For configuration details, see <a href="#EN-US_TASK_0000001602532165__en-us_task_0172368978_section_dc_vrp_srv6_cfg_all_002205">Configuration Files</a>.</p>
</p></li><li><span>Ensure that a non-EVC connection has been configured to carry a VPLS service. For configuration details, see <a href="#EN-US_TASK_0000001602532165__en-us_task_0172368978_section_dc_vrp_srv6_cfg_all_002205">Configuration Files</a>.</span><p><p>Run the <strong>display vsi name e1 verbose</strong> command on PE1. The command output shows that the VSI named <strong>e1</strong> has separate PWs to PE2 and PE3, and the VSI status and PW status are up.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display vsi name e1 verbose</strong>
 
 ***VSI Name               : e1
    Work Mode              : normal
    Administrator VSI      : no
    Isolate Spoken         : disable
    VSI Index              : 9
    PW Signaling           : ldp
    Member Discovery Style : --
    Bridge-domain Mode     : disable
    PW MAC Learn Style     : unqualify
    Encapsulation Type     : vlan
    MTU                    : 1500
    Diffserv Mode          : uniform
    Service Class          : --
    Color                  : --
    DomainId               : 255
    Domain Name            : 
    Ignore AcState         : disable
    P2P VSI                : disable
    Multicast Fast Switch  : disable
    Create Time            : 0 days, 0 hours, 7 minutes, 39 seconds
    VSI State              : <strong>up</strong>
    Resource Status        : --
 
    VSI ID                 : 10
   *Peer Router ID         : 2.2.2.2
    Negotiation-vc-id      : 10
    Encapsulation Type     : vlan
    primary or secondary   : primary
    ignore-standby-state   : no
    VC Label               : 48106
    Peer Type              : dynamic
    Session                : up
    Tunnel ID              : 0x0000000001004cab42 
    Broadcast Tunnel ID    : --
    Broad BackupTunnel ID  : --
    CKey                   : 641
    NKey                   : 16777840
    Stp Enable             : 0
    PwIndex                : 641
    Control Word           : disable
    BFD for PW             : unavailable
   *Peer Router ID         : 3.3.3.3
    Negotiation-vc-id      : 10
    Encapsulation Type     : vlan
    primary or secondary   : primary
    ignore-standby-state   : no
    VC Label               : 48107
    Peer Type              : dynamic
    Session                : up
    Tunnel ID              : 0x0000000001004cab43 
    Broadcast Tunnel ID    : --
    Broad BackupTunnel ID  : --
    CKey                   : 642
    NKey                   : 16777841
    Stp Enable             : 0
    PwIndex                : 642
    Control Word           : disable
    BFD for PW             : unavailable
 
    Interface Name         : Ethernet3/0/9.1
    State                  : up
    Ac Block State         : unblocked
    Access Port            : false
    Last Up Time           : 2023/04/18 14:20:16
    Total Up Time          : 0 days, 0 hours, 6 minutes, 35 seconds
 
  **PW Information:
 
   *Peer Ip Address        : 2.2.2.2
    PW State               : <strong>up</strong>
    Local VC Label         : 48106
    Remote VC Label        : 48099
    Remote Control Word    : disable
    PW Type                : label
    Local  VCCV            : alert lsp-ping bfd 
    Remote VCCV            : alert lsp-ping bfd 
    Tunnel ID              : 0x0000000001004cab42 
    Broadcast Tunnel ID    : --
    Broad BackupTunnel ID  : --
    Ckey                   : 641
    Nkey                   : 16777840
    Main PW Token          : 0x0
    Slave PW Token         : 0x0
    Tnl Type               : ldp
    OutInterface           : --
    Backup OutInterface    : --
    Stp Enable             : 0
    Mac Flapping           : 0
    Monitor Group Name     : --
    PW Last Up Time        : 2023/04/18 14:20:22
    PW Total Up Time       : 0 days, 0 hours, 6 minutes, 29 seconds
   *Peer Ip Address        : 3.3.3.3
    PW State               : <strong>up</strong>
    Local VC Label         : 48107
    Remote VC Label        : 48101
    Remote Control Word    : disable
    PW Type                : label
    Local  VCCV            : alert lsp-ping bfd 
    Remote VCCV            : alert lsp-ping bfd 
    Tunnel ID              : 0x0000000001004cab43 
    Broadcast Tunnel ID    : --
    Broad BackupTunnel ID  : --
    Ckey                   : 642
    Nkey                   : 16777841
    Main PW Token          : 0x0
    Slave PW Token         : 0x0
    Tnl Type               : ldp
    OutInterface           : --
    Backup OutInterface    : --
    Stp Enable             : 0
    Mac Flapping           : 0
    Monitor Group Name     : --
    PW Last Up Time        : 2023/04/18 14:20:51
    PW Total Up Time       : 0 days, 0 hours, 6 minutes, 0 seconds</pre>
</p></li><li><span>Establish a BGP EVPN peer relationship between PEs.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>router-id 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 2001:DB8:2::2 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 2001:DB8:2::2 connect-interface loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 2001:DB8:3::3 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 2001:DB8:3::3 connect-interface loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>l2vpn-family evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-evpn] <strong>peer 2001:DB8:2::2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-evpn] <strong>peer 2001:DB8:2::2 advertise encap-type srv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-evpn] <strong>peer 2001:DB8:3::3 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-evpn] <strong>peer 2001:DB8:3::3 advertise encap-type srv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>router-id 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>peer 2001:DB8:1::1 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>peer 2001:DB8:1::1 connect-interface loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>peer 2001:DB8:3::3 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>peer 2001:DB8:3::3 connect-interface loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>l2vpn-family evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-evpn] <strong>peer 2001:DB8:1::1 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-evpn] <strong>peer 2001:DB8:1::1 advertise encap-type srv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-evpn] <strong>peer 2001:DB8:3::3 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-evpn] <strong>peer 2001:DB8:3::3 advertise encap-type srv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>router-id 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>peer 2001:DB8:1::1 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>peer 2001:DB8:1::1 connect-interface loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>peer 2001:DB8:2::2 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>peer 2001:DB8:2::2 connect-interface loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>l2vpn-family evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp-af-evpn] <strong>peer 2001:DB8:1::1 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp-af-evpn] <strong>peer 2001:DB8:1::1 advertise encap-type srv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp-af-evpn] <strong>peer 2001:DB8:2::2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp-af-evpn] <strong>peer 2001:DB8:2::2 advertise encap-type srv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp-af-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
</p></li><li><span>Configure SRv6 BE and a BD EVPN instance on each PE.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>segment-routing ipv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing-ipv6] <strong>encapsulation source-address 2001:DB8:1::1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing-ipv6] <strong>locator PE1_BUM ipv6-prefix 2001:DB8:12:: 64 args 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing-ipv6-locator] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing-ipv6] <strong>locator PE1_UNICAST ipv6-prefix 2001:DB8:11:: 64</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing-ipv6-locator] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>segment-routing ipv6 locator PE1_UNICAST</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>segment-routing ipv6 locator PE1_BUM auto-sid-disable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>evpn vpn-instance evrf1 bd-mode</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-evpn-instance-evrf1] <strong>route-distinguisher 100:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-evpn-instance-evrf1] <strong>vpn-target 1:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-evpn-instance-evrf1] <strong>segment-routing ipv6 locator PE1_BUM unicast-locator PE1_UNICAST</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-evpn-instance-evrf1] <strong>segment-routing ipv6 best-effort</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-evpn-instance-evrf1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>segment-routing ipv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-segment-routing-ipv6] <strong>encapsulation source-address 2001:DB8:2::2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-segment-routing-ipv6] <strong>locator PE2_BUM ipv6-prefix 2001:DB8:22:: 64 args 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-segment-routing-ipv6-locator] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-segment-routing-ipv6] <strong>locator PE2_UNICAST ipv6-prefix 2001:DB8:21:: 64</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-segment-routing-ipv6-locator] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-segment-routing-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1] <strong>segment-routing ipv6 locator PE2_UNICAST</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1] <strong>segment-routing ipv6 locator PE2_BUM auto-sid-disable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>evpn vpn-instance evrf1 bd-mode</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-evpn-instance-evrf1] <strong>route-distinguisher 100:2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-evpn-instance-evrf1] <strong>vpn-target 1:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-evpn-instance-evrf1] <strong>segment-routing ipv6 locator PE2_BUM unicast-locator PE2_UNICAST</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-evpn-instance-evrf1] <strong>segment-routing ipv6 best-effort</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-evpn-instance-evrf1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>segment-routing ipv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-segment-routing-ipv6] <strong>encapsulation source-address 2001:DB8:3::3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-segment-routing-ipv6] <strong>locator PE3_BUM ipv6-prefix 2001:DB8:32:: 64 args 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-segment-routing-ipv6-locator] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-segment-routing-ipv6] <strong>locator PE3_UNICAST ipv6-prefix 2001:DB8:31:: 64</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-segment-routing-ipv6-locator] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-segment-routing-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-isis-1] <strong>segment-routing ipv6 locator PE3_UNICAST</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-isis-1] <strong>segment-routing ipv6 locator PE3_BUM auto-sid-disable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>evpn vpn-instance evrf1 bd-mode</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-evpn-instance-evrf1] <strong>route-distinguisher 100:3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-evpn-instance-evrf1] <strong>vpn-target 1:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-evpn-instance-evrf1] <strong>segment-routing ipv6 locator PE3_BUM unicast-locator PE3_UNICAST</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-evpn-instance-evrf1] <strong>segment-routing ipv6 best-effort</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-evpn-instance-evrf1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
</p></li><li><span>On PEs, create a BD, run a command to indicate that the BD is evolving from VPLS to EVPN, and bind the BD to VSIs and EVPN instances.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>evpn source-address 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bd10] <strong>vpls-to-evpn migration in-process</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bd10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet <span>0/1/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/0</span>.1] <strong>bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/0</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bd10] <strong>l2 binding vsi e1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bd10] <strong>evpn binding vpn-instance evrf1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bd10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>evpn source-address 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bd10] <strong>vpls-to-evpn migration in-process</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bd10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface gigabitethernet <span>0/1/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-GigabitEthernet<span>0/1/0</span>.1] <strong>bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-GigabitEthernet<span>0/1/0</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bd10] <strong>l2 binding vsi e1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bd10] <strong>evpn binding vpn-instance evrf1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bd10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>evpn source-address 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bd10] <strong>vpls-to-evpn migration in-process</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bd10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>interface gigabitethernet <span>0/3/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3-GigabitEthernet<span>0/3/0</span>.1] <strong>bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE13-GigabitEthernet<span>0/3/0</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bd10] <strong>l2 binding vsi e1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bd10] <strong>evpn binding vpn-instance evrf1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bd10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
</p></li><li><span>Verifying the Configuration</span><p><p>After completing the configurations, run the <strong>display bgp evpn peer</strong> command on PE1. The command output shows that BGP peer relationships are in the <strong>Established</strong> state, indicating that BGP peer relationships have been successfully established between PEs.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display bgp evpn peer</strong> 
 
 BGP local router ID : 1.1.1.1
 Local AS number : 100
 Total number of peers : 2                 Peers in established state : 2
 
  Peer                             V          AS  MsgRcvd  MsgSent  OutQ  Up/Down       State  PrefRcv
  2001:DB8:2::2                    4         100       63       65     0 00:48:30 Established        1
  2001:DB8:3::3                    4         100       64       65     0 00:47:36 Established        1</pre>
</p><p><p>Run the <strong>display bgp evpn all routing-table</strong> command on PE1. The command output shows information about inclusive multicast routes received from PE2 and PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display bgp evpn all routing-table</strong> 
 
 
 Local AS number : 100
 
 BGP Local router ID is 1.1.1.1
 Status codes: * - valid, &gt; - best, d - damped, x - best external, a - add path,
               h - history,  i - internal, s - suppressed, S - Stale
               Origin : i - IGP, e - EGP, ? - incomplete
 
 
 EVPN address family:
 Number of Inclusive Multicast Routes: 3
 Route Distinguisher: 100:1
       Network(EthTagId/IpAddrLen/OriginalIp)                 NextHop
 *&gt;    0:32:1.1.1.1                                           127.0.0.1                                    
 Route Distinguisher: 100:2
       Network(EthTagId/IpAddrLen/OriginalIp)                 NextHop
 *&gt;i   0:32:2.2.2.2                                           2001:DB8:2::2                                
 Route Distinguisher: 100:3
       Network(EthTagId/IpAddrLen/OriginalIp)                 NextHop
 *&gt;i   0:32:3.3.3.3                                           2001:DB8:3::3                                
    
 
 EVPN-Instance evrf1:
 Number of Inclusive Multicast Routes: 3
       Network(EthTagId/IpAddrLen/OriginalIp)                 NextHop
 *&gt;    0:32:1.1.1.1                                           127.0.0.1                                    
 *&gt;i   0:32:2.2.2.2                                           2001:DB8:2::2                                
 *&gt;i   0:32:3.3.3.3                                           2001:DB8:3::3</pre>
</p><p><p>Run the <strong>display vsi name e1 verbose</strong> command on PE1. The command output shows that the PWs from PE1 to PE2 and PE3 do not exist.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display vsi name e1 verbose</strong> 
 
 ***VSI Name               : e1
    Work Mode              : normal
    Administrator VSI      : no
    Isolate Spoken         : disable
    VSI Index              : 9
    PW Signaling           : ldp
    Member Discovery Style : --
    Bridge-domain Mode     : disable
    PW MAC Learn Style     : unqualify
    Encapsulation Type     : vlan
    MTU                    : 1500
    Diffserv Mode          : uniform
    Service Class          : --
    Color                  : --
    DomainId               : 255
    Domain Name            : 
    Ignore AcState         : disable
    P2P VSI                : disable
    Multicast Fast Switch  : disable
    Create Time            : 0 days, 0 hours, 46 minutes, 36 seconds
    VSI State              : up
    Resource Status        : --
 
    VSI ID                 : 10
   *Peer Router ID         : 2.2.2.2
    Negotiation-vc-id      : 10
    Encapsulation Type     : vlan
    primary or secondary   : primary
    ignore-standby-state   : no
    VC Label               : 48106
    Peer Type              : dynamic
    Session                : up
    Tunnel ID              : 0x0000000001004cab42 
    Broadcast Tunnel ID    : --
    Broad BackupTunnel ID  : --
    CKey                   : 641
    NKey                   : 16777840
    Stp Enable             : 0
    PwIndex                : 641
    Control Word           : disable
    BFD for PW             : unavailable
   *Peer Router ID         : 3.3.3.3
    Negotiation-vc-id      : 10
    Encapsulation Type     : vlan
    primary or secondary   : primary
    ignore-standby-state   : no
    VC Label               : 48107
    Peer Type              : dynamic
    Session                : up
    Tunnel ID              : 0x0000000001004cab43 
    Broadcast Tunnel ID    : --
    Broad BackupTunnel ID  : --
    CKey                   : 642
    NKey                   : 16777841
    Stp Enable             : 0
    PwIndex                : 642
    Control Word           : disable
    BFD for PW             : unavailable
 
    Interface Name         : Ethernet3/0/9.1
    State                  : up
    Ac Block State         : unblocked
    Access Port            : false
    Last Up Time           : 2023/04/18 14:20:16
    Total Up Time          : 0 days, 0 hours, 45 minutes, 32 seconds
 
    Access Bridge-domain   : Bridge-domain 10 
    Vac State              : up 
    Last Up Time           : 2023/04/18 14:20:16
    Total Up Time          : 0 days, 0 hours, 45 minutes, 32 seconds</pre>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0000001602532165__en-us_task_0172368978_section_dc_vrp_srv6_cfg_all_002205"><a name="EN-US_TASK_0000001602532165__en-us_task_0172368978_section_dc_vrp_srv6_cfg_all_002205"></a><a name="en-us_task_0172368978_section_dc_vrp_srv6_cfg_all_002205"></a><a name="EN-US_TASK_0000001602532165__1.4.6"></a><a name="1.4.6"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>PE1 configuration file</p>
<pre class="screen">#
sysname PE1
#
evpn vpn-instance evrf1 bd-mode
 route-distinguisher 100:1
 segment-routing ipv6 best-effort
 segment-routing ipv6 locator PE1_BUM unicast-locator PE1_UNICAST
 vpn-target 1:1 export-extcommunity
 vpn-target 1:1 import-extcommunity
#
mpls lsr-id 1.1.1.1
#
mpls
#
mpls l2vpn
#
vsi e1
 pwsignal ldp
  vsi-id 10
  peer 2.2.2.2
  peer 3.3.3.3
#
bridge-domain 10
 vpls-to-evpn migration in-process
 l2 binding vsi e1
 evpn binding vpn-instance evrf1
#
mpls ldp
 #
 ipv4-family
# 
segment-routing ipv6
 encapsulation source-address 2001:DB8:1::1
 locator PE1_BUM ipv6-prefix 2001:DB8:12:: 64 args 10
 locator PE1_UNICAST ipv6-prefix 2001:DB8:11:: 64
#
isis 1
 is-level level-1
 cost-style wide
 network-entity 10.0000.0000.0001.00
 #
 ipv6 enable topology ipv6
 segment-routing ipv6 locator PE1_UNICAST
 segment-routing ipv6 locator PE1_BUM auto-sid-disable
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
#
interface GigabitEthernet<span>0/1/0</span>.1
 vlan-type dot1q 10 
 bridge-domain 10
 l2 binding vsi e1 
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown 
 ipv6 enable
 ip address 10.1.1.1 255.255.255.0 
 ipv6 address 2001:DB8:10::1/64 
 isis ipv6 enable 1 
 mpls 
 mpls ldp
#
interface GigabitEthernet<span>0/3/0</span>
 undo shutdown 
 ipv6 enable
 ip address 10.2.1.1 255.255.255.0 
 ipv6 address 2001:DB8:20::1/64 
 isis ipv6 enable 1 
 mpls 
 mpls ldp
#
interface LoopBack0
 ipv6 enable
 ip address 1.1.1.1 255.255.255.255
 ipv6 address 2001:DB8:1::1/128
 isis ipv6 enable 1
#
bgp 100
 router-id 1.1.1.1
 peer 2001:DB8:2::2 as-number 100
 peer 2001:DB8:2::2 connect-interface LoopBack0
 peer 2001:DB8:3::3 as-number 100
 peer 2001:DB8:3::3 connect-interface LoopBack0
 #
 ipv4-family unicast
  undo synchronization
 #              
 l2vpn-family evpn
  policy vpn-target
  peer 2001:DB8:2::2 enable
  peer 2001:DB8:2::2 advertise encap-type srv6
  peer 2001:DB8:3::3 enable
  peer 2001:DB8:3::3 advertise encap-type srv6
#
ospf 1
 opaque-capability enable
 area 0.0.0.0
  network 1.1.1.1 0.0.0.0
  network 10.1.1.0 0.0.0.255
  network 10.2.1.0 0.0.0.255
#
evpn source-address 1.1.1.1
#
return</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#
sysname PE2
#
evpn vpn-instance evrf1 bd-mode
 route-distinguisher 100:2
 segment-routing ipv6 best-effort
 segment-routing ipv6 locator PE2_BUM unicast-locator PE2_UNICAST
 vpn-target 1:1 export-extcommunity
 vpn-target 1:1 import-extcommunity
#
mpls lsr-id 2.2.2.2
#
mpls
#
mpls l2vpn
#
vsi e1
 pwsignal bgp
  vsi-id 10
  peer 1.1.1.1
  peer 3.3.3.3
#
bridge-domain 10
 vpls-to-evpn migration in-process
 l2 binding vsi e1
 evpn binding vpn-instance evrf1
#
mpls ldp
 #
 ipv4-family
#
segment-routing ipv6
 encapsulation source-address 2001:DB8:2::2
 locator PE2_BUM ipv6-prefix 2001:DB8:22:: 64 args 10
 locator PE2_UNICAST ipv6-prefix 2001:DB8:21:: 64
#
isis 1
 is-level level-1
 cost-style wide
 network-entity 10.0000.0000.0002.00
 #
 ipv6 enable topology ipv6
 segment-routing ipv6 locator PE2_UNICAST
 segment-routing ipv6 locator PE2_BUM auto-sid-disable
 #
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
#               
interface GigabitEthernet<span>0/1/0</span>.1
 vlan-type dot1q 10
 bridge-domain 10
 l2 binding vsi e1
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ipv6 enable
 ip address 10.2.1.2 255.255.255.0
 ipv6 address 2001:DB8:20::2/64
 isis ipv6 enable 1
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/3/0</span>
 undo shutdown
 ipv6 enable
 ip address 10.3.1.2 255.255.255.0 
 ipv6 address 2001:DB8:30::2/64
 isis ipv6 enable 1
 mpls
 mpls ldp
#
interface LoopBack0
 ipv6 enable
 ip address 2.2.2.2 255.255.255.255
 ipv6 address 2001:DB8:2::2/128
 isis ipv6 enable 1 
#
bgp 100
 router-id 2.2.2.2
 peer 2001:DB8:1::1 as-number 100
 peer 2001:DB8:1::1 connect-interface LoopBack0
 peer 2001:DB8:3::3 as-number 100
 peer 2001:DB8:3::3 connect-interface LoopBack0 
 #
 ipv4-family unicast
  undo synchronization
 #
 l2vpn-family evpn 
  policy vpn-target 
  peer 2001:DB8:1::1 enable
  peer 2001:DB8:1::1 advertise encap-type srv6
  peer 2001:DB8:3::3 enable
  peer 2001:DB8:3::3 advertise encap-type srv6 
#
ospf 1 
  area 0.0.0.0 
   network 2.2.2.2 0.0.0.0 
   network 10.2.1.0 0.0.0.255 
   network 10.3.1.0 0.0.0.255 
 # 
evpn source-address 2.2.2.2
#
return</pre>
</li><li><p>PE3 configuration file</p>
<pre class="screen">#
sysname PE3
#
evpn vpn-instance evrf1 bd-mode
 route-distinguisher 100:3
 segment-routing ipv6 best-effort
 segment-routing ipv6 locator PE3_BUM unicast-locator PE3_UNICAST
 vpn-target 1:1 export-extcommunity
 vpn-target 1:1 import-extcommunity
#
mpls lsr-id 3.3.3.3
#
mpls
#
mpls l2vpn      
#
vsi e1
 pwsignal bgp
  vsi-id 10
  peer 1.1.1.1
  peer 2.2.2.2
#
bridge-domain 10
 vpls-to-evpn migration in-process
 l2 binding vsi e1
 evpn binding vpn-instance evrf1
#
mpls ldp
 #
 ipv4-family
#
segment-routing ipv6
 encapsulation source-address 2001:DB8:3::3
 locator PE3_BUM ipv6-prefix 2001:DB8:32:: 64 args 10
 locator PE3_UNICAST ipv6-prefix 2001:DB8:31:: 64 
 # 
 isis 1
 is-level level-1
 cost-style wide
 network-entity 10.0000.0000.0003.00
 #
 ipv6 enable topology ipv6
 segment-routing ipv6 locator PE3_UNICAST
 segment-routing ipv6 locator PE3_BUM auto-sid-disable 
 # 
# 
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ipv6 enable
 ip address 10.1.1.3 255.255.255.0 
 ipv6 address 2001:DB8:10::3/64
 isis ipv6 enable 1
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ipv6 enable
 ip address 10.3.1.3 255.255.255.0
 ipv6 address 2001:DB8:30::3/64
 isis ipv6 enable 1
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/3/0</span>
 undo shutdown
#
interface GigabitEthernet<span>0/3/0</span>.1
 vlan-type dot1q 10
 bridge-domain 10
 l2 binding vsi e1
#
interface LoopBack0
 ipv6 enable
 ip address 3.3.3.3 255.255.255.255
 ipv6 address 2001:DB8:3::3/128
 isis ipv6 enable 1 
#
bgp 100
 router-id 3.3.3.3 
 peer 2001:DB8:1::1 as-number 100 
 peer 2001:DB8:1::1 connect-interface LoopBack0
 peer 2001:DB8:2::2 as-number 100
 peer 2001:DB8:2::2 connect-interface LoopBack0 
 # 
 ipv4-family unicast 
  undo synchronization 
 # 
 l2vpn-family evpn 
  policy vpn-target 
  peer 2001:DB8:1::1 enable 
  peer 2001:DB8:1::1 advertise encap-type srv6 
  peer 2001:DB8:2::2 enable
  peer 2001:DB8:2::2 advertise encap-type srv6
#
ospf 1
 area 0.0.0.0   
  network 3.3.3.3 0.0.0.0
  network 10.1.1.0 0.0.0.255
  network 10.3.1.0 0.0.0.255
#
evpn source-address 3.3.3.3
#
return</pre>
</li><li><p>CE1 configuration file</p>
<pre class="screen">#
sysname CE1
#
interface GigabitEthernet<span>0/1/0</span>
 portswitch
 undo shutdown
 port link-type trunk
 port trunk allow-pass vlan 10
#
return</pre>
</li><li><p>CE2 configuration file</p>
<pre class="screen">#
sysname CE2
#
interface GigabitEthernet<span>0/1/0</span>
 portswitch
 undo shutdown
 port link-type trunk
 port trunk allow-pass vlan 10
#
return</pre>
</li><li><p>CE3 configuration file</p>
<pre class="screen">#
sysname CE3
#
interface GigabitEthernet<span>0/1/0</span>
 portswitch
 undo shutdown
 port link-type trunk
 port trunk allow-pass vlan 10
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0010.html">EVPN Configuration Examples
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0068.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_dci_cfg_0034.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>