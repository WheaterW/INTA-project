
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring EVPN to Use the AIGP Attribute for Route Selection">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0000.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0268.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0270.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="p00915595">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00878323">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001296810568">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring EVPN to Use the AIGP Attribute for Route Selection</title>
</head>
<body><a name="EN-US_TASK_0000001296810568"></a><a name="EN-US_TASK_0000001296810568"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring EVPN to Use the AIGP Attribute for Route Selection</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001296810568__1.3.1"></a><a name="1.3.1"></a>
<div class="p"><h4 class="sectiontitle">Usage Scenario</h4><div class="p">The Accumulated Interior Gateway Protocol Metric (AIGP) attribute is an optional non-transitive BGP route attribute. The IGP cost accumulates in the AIGP attribute during route transmission. After the AIGP attribute is configured in an AIGP domain, BGP selects routes based on costs in the same manner as IGP, and all devices in the domain forward data along the optimal routes. During BGP route selection, the AIGP attribute is used as follows:<ul><li>The preference of a route with the AIGP attribute is higher than that of a route without the AIGP attribute.</li><li>If all routes carry the AIGP attribute, the device selects the route whose AIGP value plus the cost of the IGP route to which the route recurses is smaller.</li></ul>
</div>
<p>The AIGP attribute can be added to routes only through routing policies. You can configure an apply clause for a routing policy using the <strong>apply aigp</strong> { [ + | - ]<em>cost</em> | <strong>inherit-cost</strong> } command to modify the AIGP value during route import, acceptance, or advertisement by BGP. If no AIGP value is configured, the IGP routes imported by BGP do not carry the AIGP attribute. </p>
<p>After EVPN is configured to use the AIGP attribute for route selection, if BGP LSPs to which routes recurse carry the AIGP attribute, EVPN public and private network routes are selected based on the preceding comparison rules.</p>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001296810568__1.3.2"></a><a name="1.3.2"></a>
<div class="p"><h4 class="sectiontitle">Pre-configuration Tasks</h4><div class="p">Before configuring EVPN to use the AIGP attribute for route selection, complete the following tasks:<ul><li><a href="dc_vrp_bgp_cfg_4101.html">Configure BGP to set an AIGP value based on a route-policy</a>.</li><li><a href="dc_vrp_bgp_cfg_4098.html">Configure BGP-LS</a>.</li><li>EVPN VPLS scenario: <a href="dc_vrp_evpn_cfg_0065.html">Configuring EVPN VPLS over MPLS (BD EVPN Instance)</a>, <a href="dc_vrp_srv6_cfg_all_0023_copy.html">Configuring EVPN VPLS over IS-IS SRv6 BE</a>, or <a href="dc_vrp_cfg_evpn-vpls_over_srv6-te_policy_copy.html">Configuring EVPN VPLS over SRv6 TE Policy</a></li><li>EVPN VPWS scenario: <a href="dc_vrp_evpn_cfg_0020.html">Configuring EVPN VPWS over MPLS</a>, <a href="dc_vrp_srv6_cfg_all_0021_copy.html">Configuring EVPN VPWS over IS-IS SRv6 BE</a>, or <a href="dc_vrp_cfg_evpn-vpws_over_srv6-te_policy_copy.html">Configuring EVPN VPWS over SRv6 TE Policy</a></li><li>EVPN L3VPN scenario: <a href="dc_vrp_evpn_cfg_0038.html">Configuring EVPN L3VPN over MPLS</a>, <a href="dc_vrp_srv6_cfg_all_0023_copy.html">Configuring EVPN VPLS over IS-IS SRv6 BE</a>, or <a href="dc_vrp_cfg_evpn-l3vpn_over_srv6-te_policy_copy.html">Configuring EVPN L3VPNv4 over SRv6 TE Policy</a></li></ul>
</div>
</div></div>
<div class="steps-unordered"><a name="EN-US_TASK_0000001296810568__1.3.3"></a><a name="1.3.3"></a><h4 class="sectiontitle">Procedure</h4>
<ul><li><span>Configure a device to use the AIGP attribute for route selection in an EVPN VPLS scenario.</span><ol><li><span>Run the <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a> command to enter the system view.</span></li><li><span>Run the <a href="cmdqueryname=evpn+vpn-instance"><b><span class="cmdname">evpn vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i> <strong><span>bd-mode</span></strong> command to enter the BD EVPN instance view.</span></li><li><span>Run the <a href="cmdqueryname=bestroute+nexthop-resolved+aigp"><b><span class="cmdname">bestroute nexthop-resolved aigp</span></b></a> command to allow EVPN private network routes to participate in route selection based on the AIGP attributes of the corresponding BGP LSPs.</span></li><li><span>Run the <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a> command to return to the system view.</span></li><li><span>Run the <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a> command to commit the configuration.</span></li></ol>
</li><li><span>Configure a device to use the AIGP attribute for route selection in an EVPN VPWS scenario.</span><ol><li><span>Run the <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a> command to enter the system view.</span></li><li><span>Run the <a href="cmdqueryname=evpn+vpn-instance"><b><span class="cmdname">evpn vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i> <strong><span>vpws</span></strong> command to enter the VPWS EVPN instance view.</span></li><li><span>Run the <a href="cmdqueryname=bestroute+nexthop-resolved+aigp"><b><span class="cmdname">bestroute nexthop-resolved aigp</span></b></a> command to allow EVPN private network routes to participate in route selection based on the AIGP attributes of the corresponding BGP LSPs.</span></li><li><span>Run the <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a> command to return to the system view.</span></li><li><span>Run the <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a> command to commit the configuration.</span></li></ol>
</li><li><span>Configure a device to use the AIGP attribute for route selection in an EVPN L3VPN scenario.</span><ol><li><span>Run the <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a> command to enter the system view.</span></li><li><span>Run the <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i> command to enter the BGP view.</span></li><li><span>Run the <a href="cmdqueryname=l2vpn-family+evpn"><b><span class="cmdname">l2vpn-family evpn</span></b></a> command to enter the BGP EVPN address family view.</span></li><li><span>Run the <a href="cmdqueryname=bestroute+nexthop-resolved+aigp"><b><span class="cmdname">bestroute nexthop-resolved aigp</span></b></a> command to allow EVPN public network routes to participate in route selection based on the AIGP attributes of the corresponding BGP LSPs.</span></li><li><span>Run the <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a> command to return to the system view.</span></li><li><span>Run the <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a> command to commit the configuration.</span></li></ol>
</li></ul></div>
<div class="example"><a name="EN-US_TASK_0000001296810568__1.3.4"></a><a name="1.3.4"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p>Run the <a href="cmdqueryname=display+bgp+evpn"><b><span class="cmdname">display bgp evpn</span></b></a> { <strong><span>all</span></strong> | <strong><span>route-distinguisher</span></strong> <i><span class="varname">route-distinguisher</span></i> | <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i> } <strong><span>routing-table</span></strong> [ { <strong><span>ad-route</span></strong> | <strong><span>es-route</span></strong> | <strong><span>inclusive-route</span></strong> | <strong><span>mac-route</span></strong> | <strong><span>prefix-route</span></strong> } <i><span class="varname">prefix</span></i> ] command to check that BGP EVPN route information contains <strong>resolving-AIGP</strong> information.</p>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0000.html">EVPN Configuration
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0268.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0270.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>