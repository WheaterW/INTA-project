
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring Traditional Common VPLS and EVPN VPLS over MPLS to Coexist">
<meta name="abstract" content="If both a traditional common VPLS network and an EVPN VPLS over MPLS network are deployed, you need to configure traditional common VPLS and EVPN VPLS over MPLS to coexist.">
<meta name="description" content="If both a traditional common VPLS network and an EVPN VPLS over MPLS network are deployed, you need to configure traditional common VPLS and EVPN VPLS over MPLS to coexist.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2vpn_to_evpn_cfg_0000.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2vpn_to_evpn_cfg_0015.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2vpn_to_evpn_cfg_0012.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="p00915595">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00878323">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001540902602">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring Traditional Common VPLS and EVPN VPLS over MPLS to Coexist</title>
</head>
<body><a name="EN-US_TASK_0000001540902602"></a><a name="EN-US_TASK_0000001540902602"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring Traditional Common VPLS and EVPN VPLS over MPLS to Coexist</h1>
<div class="taskbody"><p>If both a traditional common VPLS network and an EVPN VPLS over MPLS network are deployed, you need to configure traditional common VPLS and EVPN VPLS over MPLS to coexist.</p>
<div class="context"><a name="EN-US_TASK_0000001540902602__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>Traditional L2VPNs use VPLS over MPLS for Layer 2 communication. Compared with VPLS, EVPN â a next-generation VPN technology â has many advantages, such as support for multi-homing all-active networking and control plane-based MAC address learning. Therefore, VPLS over MPLS is gradually evolving to EVPN over MPLS. However, there are still a large number of existing traditional common VPLS services on the live network. If EVPN VPLS over MPLS services are added, you need to configure traditional common VPLS and EVPN VPLS over MPLS to coexist, so that both types of services can run properly.</p>
<p>On the network shown in <a href="#EN-US_TASK_0000001540902602__fig579251613147">Figure 1</a>, common VPLS over MPLS is deployed on PE3, and both traditional common VPLS over MPLS and EVPN VPLS over MPLS are deployed on PE1, PE2, and PE4. In this case, you need to configure traditional common VPLS and EVPN VPLS over MPLS to coexist on PE1, PE2, and PE4.</p>
<div class="fignone" id="EN-US_TASK_0000001540902602__fig579251613147"><a name="EN-US_TASK_0000001540902602__fig579251613147"></a><a name="fig579251613147"></a><span class="figcap"><b>Figure 1 </b>Configuring traditional common VPLS and EVPN VPLS over MPLS to coexist</span><br><span><img class="vsd" src="figure/en-us_image_0000001591462153.png"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001540902602__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Pre-configuration Tasks</h4><p>Before configuring traditional common VPLS and EVPN VPLS over MPLS to coexist, complete the following tasks:</p>
<ul><li><p><a href="dc_vrp_vpls_cfg_5003.html">Configure LDP VPLS</a> between PE3 and PE1, between PE3 and PE2, and between PE3 and PE4.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this task, a non-BD VSI must be created using the <a href="cmdqueryname=vsi"><b><span class="cmdname">vsi</span></b></a> <i><span class="varname">vsi-name</span></i> [ <strong><span>static</span></strong> | <strong><span>auto</span></strong> ] command.</p>
</div></div>
</li><li><p>Configure BGP EVPN peer relationships between PE1, PE2, and PE4 and create a BD EVPN instance on each of these devices.</p>
</li></ul>
<p>Perform the following steps on PE1, PE2, and PE4.</p>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001540902602__1.4.3"></a><a name="1.4.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Create a BD and configure evolution from common VPLS to EVPN.</span><ol type="a"><li><span>Run the <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a> command to enter the system view.</span></li><li><span>Run the <a href="cmdqueryname=bridge-domain"><b><span class="cmdname">bridge-domain</span></b></a> <i><span class="varname">bd-id</span></i> command to create a BD and enter its view.</span></li><li><span>Run the <a href="cmdqueryname=vpls-to-evpn+migration+in-process"><b><span class="cmdname">vpls-to-evpn migration in-process</span></b></a> command to indicate that the BD is evolving from VPLS to EVPN.</span></li><li><span>Run the <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a> command to return to the system view.</span></li><li><span>Run the <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a> command to commit the configuration.</span></li></ol>
</li><li><span>Add all AC interfaces to the BD (sub-interfaces are used as AC interfaces in this case).</span><ol type="a"><li><span>Run the <a href="cmdqueryname=interface"><b><span class="cmdname">interface</span></b></a> <i><span class="varname">interface-type interface-number.sub-number</span></i> command to enter the view of the AC interface that directly connects the PE to a CE.</span></li><li><span>Run the <a href="cmdqueryname=bridge-domain"><b><span class="cmdname">bridge-domain</span></b></a> <i><span class="varname">bd-id</span></i> command to add the AC interface to the BD.</span></li><li><span>Run the <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a> command to return to the system view.</span></li><li><span>Run the <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a> command to commit the configuration.</span></li></ol>
</li><li><span>(Optional) Configure TC notification on the AC interface's main interface.</span><p><p>If the <a href="cmdqueryname=stp+enable"><b><span class="cmdname">stp enable</span></b></a> command is run on the AC interface's main interface to enable STP but the <a href="cmdqueryname=stp+vpls-subinterface+enable"><b><span class="cmdname">stp vpls-subinterface enable</span></b></a> command is not run before the evolution, during the evolution, the AC interface may be blocked when the broadcast domain switches from the VSI to the BD, and a traffic loop may occur when the broadcast domain switches from the BD to the VSI. In response, you are advised to perform the following operations:</p>
</p><ol type="a"><li><span>Run the <a href="cmdqueryname=interface"><b><span class="cmdname">interface</span></b></a> <i><span class="varname">interface-type interface-number</span></i> command to enter the view of the AC interface's main interface.</span></li><li><span>Run the <a href="cmdqueryname=stp+vpls-subinterface+enable"><b><span class="cmdname">stp vpls-subinterface enable</span></b></a> command to enable TC notification on the main interface.</span></li><li><span>Run the <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a> command to return to the system view.</span></li><li><span>Run the <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a> command to commit the configuration.</span></li></ol>
</li><li><span>(Optional) Configure the maximum volume of unknown unicast traffic allowed by the BD.</span><p><p>During the evolution, broadcast domain switching occurs, resulting in MAC address relearning. In this case, traffic is forwarded in unknown unicast mode within a short period of time. In response, you are advised to configure unknown unicast traffic suppression in the BD.</p>
</p><ol type="a"><li><span>Run the <a href="cmdqueryname=bridge-domain"><b><span class="cmdname">bridge-domain</span></b></a> <i><span class="varname">bd-id</span></i> command to enter the BD view.</span></li><li><span>Run the <a href="cmdqueryname=unknown-unicast-suppression"><b><span class="cmdname">unknown-unicast-suppression</span></b></a> <strong><span>cir</span></strong> <i><span class="varname">cir-value</span></i> [ <strong><span>cbs</span></strong> <i><span class="varname">cbs-value</span></i> ] { <strong><span>uni-inbound</span></strong> | <strong><span>uni-outbound</span></strong> } command to configure the maximum unknown unicast traffic volume allowed by the BD.</span></li><li><span>Run the <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a> command to return to the system view.</span></li><li><span>Run the <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a> command to commit the configuration.</span></li></ol>
</li><li><span>Bind the BD to both the VSI and EVPN instance.</span><ol type="a"><li><span>Run the <a href="cmdqueryname=bridge-domain"><b><span class="cmdname">bridge-domain</span></b></a> <i><span class="varname">bd-id</span></i> command to enter the BD view.</span></li><li><span>Run the <a href="cmdqueryname=l2+binding"><b><span class="cmdname">l2 binding</span></b></a> <strong><span>vsi</span></strong> <i><span class="varname">vsi-name</span></i> command to bind the BD to the VSI.</span></li><li><span>Run the <a href="cmdqueryname=evpn+binding+vpn-instance"><b><span class="cmdname">evpn binding vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i> command to bind the BD to the EVPN instance.</span></li><li><span>Run the <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a> command to return to the system view.</span></li><li><span>Run the <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a> command to commit the configuration.</span></li></ol>
</li></ol></div>
<div class="postreq"><a name="EN-US_TASK_0000001540902602__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Verifying the Configuration</h4><ul><li><p>Run the <a href="cmdqueryname=display+bgp+evpn"><b><span class="cmdname">display bgp evpn</span></b></a> { <strong><span>all</span></strong> | <strong><span>route-distinguisher</span></strong> <i><span class="varname">route-distinguisher</span></i> } <strong><span>routing-table</span></strong> { <strong><span>ad-route</span></strong> | <strong><span>es-route</span></strong> | <strong><span>inclusive-route</span></strong> | <strong><span>mac-route</span></strong> | <strong><span>prefix-route</span></strong> } <i><span class="varname">prefix</span></i> command on the PE to check detailed BGP EVPN route information.</p>
</li><li>Run the <a href="cmdqueryname=display+bgp+evpn"><b><span class="cmdname">display bgp evpn</span></b></a> <strong><span>vpn-instance</span></strong> <i><span class="varname">evpn-name-value</span></i> <strong><span>routing-table</span></strong> { <strong><span>ad-route</span></strong> | <strong><span>es-route</span></strong> | <strong><span>inclusive-route</span></strong> | <strong><span>mac-route</span></strong> } <i><span class="varname">prefix</span></i> command on the PE to check the EVPN route information of the specified EVPN instance.</li><li><p>In a scenario where a CE is dual-homed to PEs, run the <a href="cmdqueryname=display+evpn+vpn-instance+name"><b><span class="cmdname">display evpn vpn-instance name</span></b></a> <i><span class="varname">vpn-instance-name</span></i> <strong><span>df result</span></strong> [ <strong><span>esi</span></strong> <i><span class="varname">esi</span></i> ] command on PEs to check the DF election result of the EVPN instance.</p>
</li></ul>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2vpn_to_evpn_cfg_0000.html">Configuring Evolution from Traditional L2VPN to EVPN
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2vpn_to_evpn_cfg_0015.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2vpn_to_evpn_cfg_0012.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>