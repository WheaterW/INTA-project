
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Static VPLS">
<meta name="abstract" content="To manually manage and allocate VC labels, you can configure static VPLS.">
<meta name="description" content="To manually manage and allocate VC labels, you can configure static VPLS.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_5029.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_5030.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,vpls,w00556928,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="VPLS">
<meta name="featuretype" content="VPN">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="VPLS">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="VPLS">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="VPLS">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="l00415692">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00415692">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172370220">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring Static VPLS</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172370220"></a><a name="EN-US_TASK_0172370220"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Static VPLS</h1>
<div class="taskbody"><p>To manually manage and allocate VC labels, you can configure static VPLS.</p>
<div class="context"><a name="EN-US_TASK_0172370220__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0172370220__fig_dc_vrp_vpls_cfg_600401">Figure 1</a>, VPLS is enabled on PE1 and PE2. CE1 connects to PE1, CE2 connects to PE2, and CE1 and CE2 reside on the same VPLS network. If PE1 and PE2 are unable to support large numbers of LDP sessions or you want to manually manage and allocate VC labels, configure a static VPLS PW for CE1 and CE2 to communicate. </p>
<div class="fignone" id="EN-US_TASK_0172370220__fig_dc_vrp_vpls_cfg_600401"><a name="EN-US_TASK_0172370220__fig_dc_vrp_vpls_cfg_600401"></a><a name="fig_dc_vrp_vpls_cfg_600401"></a><span class="figcap"><b>Figure 1 </b>Configuring static VPLS</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><ul><li><p>In this example, interface1, subinterface1.1, interface2, and subinterface2.1 represent GE<span>0/1/0</span>, GE<span>0/1/0</span>.1, GE<span>0/2/0</span>, and GE<span>0/2/0</span>1, respectively. </p>
</li></ul>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_vpls_cfg_600401.png"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172370220__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Precautions</h4><p>During the configuration, note the following:</p>
<ul><li>PEs belonging to the same L2VPN must have the same VSI ID. </li></ul>
</div></div>
<div class="context"><a name="EN-US_TASK_0172370220__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure a routing protocol on the backbone network to achieve connectivity between devices.</p>
</li><li><p>Establish tunnels between PEs to transmit service data.</p>
</li><li><p>Enable MPLS L2VPN on PEs.</p>
</li><li><p>Create VSIs, configure static VPLS, and bind AC interfaces to VSIs on PEs.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172370220__1.4.4"></a><a name="1.4.4"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>VSI names and IDs</p>
</li><li><p>IP addresses of peers and tunnel policies used for setting up peer relationships</p>
</li><li><p>Interfaces bound to VSIs</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172370220__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure an IP address for each involved interface on the PEs and P as described in <a href="#EN-US_TASK_0172370220__fig_dc_vrp_vpls_cfg_600401">Figure 1</a>, and configure an IGP. OSPF is used in this example.</span><p><p>Note that when configuring OSPF, you need to advertise 32-bit loopback interface addresses (LSR IDs) of PE1, the P, and PE2.</p>
<p>For detailed configurations, see Configuration Files.</p>
<p>After the configuration is complete, run the <strong>display ip routing-table</strong> command on PE1, P, and PE2. The command output shows the routes that the devices have learned from each other.</p>
</p></li><li><span>Configure basic MPLS functions and LDP.</span><p><p>For detailed configurations, see Configuration Files.</p>
<p>After the configuration is complete, run the <strong>display mpls ldp</strong> session command on PE1, the P, and PE2. The command output shows that <strong>Status</strong> is <strong>Operational</strong> for the peer relationships between PE1 and the P and between PE2 and the P, indicating that the peer relationships have been set up. Run the <strong>display mpls lsp</strong> command to check whether LSPs have been set up.</p>
</p></li><li><span>Enable MPLS L2VPN on PEs.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-l2vpn]<strong> commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-l2vpn] <strong>commit</strong></pre>
</p></li><li><span>Configure a VSI on each PE.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> vsi a2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-a2]<strong> pwsignal ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-a2-ldp]<strong> vsi-id 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-a2-ldp]<strong> peer 3.3.3.9 static-upe trans 100 recv 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-a2-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-a2]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2]<strong> vsi a2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-a2]<strong> pwsignal ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-a2-ldp]<strong> vsi-id 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-a2-ldp]<strong> peer 1.1.1.9 static-upe trans 100 recv 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-a2-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-a2]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> commit</strong></pre>
</p></li><li><span>Bind interfaces to VSIs on PEs.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> interface gigabitethernet<span>0/1/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1]<strong> shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1]<strong> vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1]<strong> l2 binding vsi a2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2]<strong> interface gigabitethernet<span>0/2/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>.1]<strong> shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>.1]<strong> vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>.1]<strong> l2 binding vsi a2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>.1]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>.1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> commit</strong></pre>
</p></li><li><span>Configure CEs.</span><p><p># Configure CE1.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname CE1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1]<strong> interface gigabitethernet<span>0/1/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>.1] <strong>vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>.1] <strong>ip address 10.1.1.1 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1]<strong> commit</strong></pre>
<p># Configure CE2.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname CE2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2]<strong> interface gigabitethernet<span>0/1/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>.1] <strong>vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>.1] <strong>ip address 10.1.1.2 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2]<strong> commit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p>After the configuration is complete, run the <strong>display vsi name a2 verbose</strong> command on PE1. The command output shows that a VSI named <strong>a2</strong> has set up a PW to PE2 and <strong>VSI State</strong> is <strong>up</strong>.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display vsi name a2 verbose</strong></pre>
<pre class="screen"> ***VSI Name               : a2
    Work Mode              : normal
    Administrator VSI      : no
    Isolate Spoken         : disable
    VSI Index              : 1
    PW Signaling           : --
    Member Discovery Style : --
    Bridge-domain Mode     : disable
    PW MAC Learn Style     : unqualify
    Encapsulation Type     : vlan
    MTU                    : 1500
    Diffserv Mode          : uniform
    Service Class          : --
    Color                  : --
    DomainId               : 255
    Domain Name            :
    Ignore AcState         : disable
    P2P VSI                : disable
    Multicast Fast Switch  : disable
    Create Time            : 0 days, 0 hours, 7 minutes, 10 seconds
    VSI State              : <strong>up</strong>
    Resource Status        : --

    VSI ID                 : 2
   *Peer Router ID         : 3.3.3.9
    primary or secondary   : primary
    ignore-standby-state   : no
    VC Label               : 100
    Peer Type              : <strong>static</strong>
    Session                : up
    Tunnel ID              : 0x0000000001004c4b44
    Broadcast Tunnel ID    : --
    Broad BackupTunnel ID  : --
    CKey                   : 1
    NKey                   : 1610612838
    Stp Enable             : 0
    PwIndex                : 0

    Interface Name         : GigabitEthernet<span>0/1/0</span>.1
    State                  : up
    Access Port            : false
    Last Up Time           : 2012/09/10 10:14:46
    Total Up Time          : 0 days, 0 hours, 2 minutes, 14 seconds

  **PW Information:

   *Peer Ip Address        : 3.3.3.9
    PW State               : <strong>up</strong>
    Local VC Label         : 100
    Remote VC Label        : 100
    PW Type                : MEHVPLS
    Tunnel ID              : 0x0000000001004c4b44
    Broadcast Tunnel ID    : --
    Broad BackupTunnel ID  : --
    Ckey                   : 1
    Nkey                   : 1610612838
    Main PW Token          : 0x0
    Slave PW Token         : 0x0
    Tnl Type               : ldp
    OutInterface           : GigabitEthernet<span>0/2/0</span>
    Backup OutInterface    : --
    Stp Enable             : 0
    Mac Flapping           : 0
    PW Last Up Time        : 2012/09/10 10:16:03
    PW Total Up Time       : 0 days, 0 hours, 1 minutes, 19 seconds </pre>
<p># Configure CE1 (10.1.1.1) to ping CE2 (10.1.1.2). The ping is successful.</p>
<pre class="screen">&lt;CE1&gt; <strong>ping 10.1.1.2</strong></pre>
<pre class="screen">  PING 10.1.1.2: 56  data bytes, press CTRL_C to break</pre>
<pre class="screen">    Reply from 10.1.1.2: bytes=56 Sequence=1 ttl=255 time=90 ms</pre>
<pre class="screen">    Reply from 10.1.1.2: bytes=56 Sequence=2 ttl=255 time=77 ms</pre>
<pre class="screen">    Reply from 10.1.1.2: bytes=56 Sequence=3 ttl=255 time=34 ms</pre>
<pre class="screen">    Reply from 10.1.1.2: bytes=56 Sequence=4 ttl=255 time=46 ms</pre>
<pre class="screen">    Reply from 10.1.1.2: bytes=56 Sequence=5 ttl=255 time=94 ms</pre>
<pre class="screen">  --- 10.1.1.2 ping statistics ---</pre>
<pre class="screen">    5 packet(s) transmitted</pre>
<pre class="screen">    5 packet(s) received</pre>
<pre class="screen">    0.00% packet loss</pre>
<pre class="screen">    round-trip min/avg/max = 34/68/94 ms </pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172370220__1.4.6"></a><a name="1.4.6"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>CE1 configuration file</p>
<pre class="screen">#
sysname CE1
#
interface GigabitEthernet<span>0/1/0</span>.1
 undo shutdown
 vlan-type dot1q 10
 ip address 10.1.1.1 255.255.255.0
#
return</pre>
</li><li><p>CE2 configuration file</p>
<pre class="screen">#
sysname CE2
#
interface GigabitEthernet<span>0/1/0</span>.1
 undo shutdown
 vlan-type dot1q 10
 ip address 10.1.1.2 255.255.255.0
#
return</pre>
</li><li><p>PE1 configuration file</p>
<pre class="screen">#
sysname PE1
#
mpls lsr-id 1.1.1.9
#
mpls
#
mpls l2vpn
#
vsi a2
 pwsignal ldp 
  vsi-id 2    
  peer 3.3.3.9 static-upe trans 100 recv 100
# 
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>.1
 undo shutdown
 vlan-type dot1q 10
 l2 binding vsi a2
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 192.168.10.1 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 1.1.1.9 255.255.255.255
#
ospf 1
 area 0.0.0.0
  network 1.1.1.9 0.0.0.0
  network 192.168.10.0 0.0.0.255
#
return</pre>
</li><li><p>P configuration file</p>
<pre class="screen">#
sysname P
#
mpls lsr-id 2.2.2.9
#
mpls
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 192.168.10.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 192.168.20.1 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 2.2.2.9 255.255.255.255
#
ospf 1
 area 0.0.0.0
  network 192.168.10.0 0.0.0.255
  network 192.168.20.0 0.0.0.255
  network 2.2.2.9 0.0.0.0
#
return</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#
sysname PE2
#
mpls lsr-id 3.3.3.9
#
mpls
#
mpls l2vpn
#
vsi a2
 pwsignal ldp  
  vsi-id 2     
  peer 1.1.1.9 static-upe trans 100 recv 100
# 
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 192.168.20.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>.1
 undo shutdown
 vlan-type dot1q 10
 l2 binding vsi a2
#
interface LoopBack1
 ip address 3.3.3.9 255.255.255.255
#
ospf 1
 area 0.0.0.0
  network 3.3.3.9 0.0.0.0
  network 192.168.20.0 0.0.0.255
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_5029.html">Configuration Examples for VPLS
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_5030.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>