
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring P2MP TE Tunnels to Carry Services (Dual-Root Protection of VPLS Multi-homing)">
<meta name="abstract" content="This section provides an example for configuring P2MP TE tunnels to carry services.">
<meta name="description" content="This section provides an example for configuring P2MP TE tunnels to carry services.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_5029.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_5073.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_6041.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="VPLS">
<meta name="featuretype" content="VPN">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="VPLS">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="VPLS">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="VPLS">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="l00415692">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00415692">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172370290">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>Example for Configuring P2MP TE Tunnels to Carry Services (Dual-Root Protection of VPLS Multi-homing)</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172370290"></a><a name="EN-US_TASK_0172370290"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring P2MP TE Tunnels to Carry Services (Dual-Root Protection of VPLS Multi-homing)</h1>
<div class="taskbody"><p>This section provides an example for configuring P2MP TE tunnels to carry services.</p>
<div class="context"><a name="EN-US_TASK_0172370290__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0172370290__fig_dc_vrp_vpls_cfg_605601">Figure 1</a>, in the P2MP dual-root protection scenario of VPLS multi-homing, PE1, PE2, PE3, and PE4 form a VPLS network in BGP multi-homing mode. The tunnel between PE1, PE3, and PE4 is the primary P2MP TE tunnel, and PE1 is the primary root node. The tunnel between PE2, PE3, and PE4 is the backup P2MP tunnel, and PE2 is the backup root node. The multicast source sends two copies of traffic. With the VPLS multi-homing function, PE2's AC interface blocks the received copy of traffic. Only PE1 receives a copy of traffic. After traffic reaches the leaf node, the leaf node sends it to the corresponding receiver. In this way, the receiver receives only one copy of traffic. If PE1's AC interface or the primary P2MP TE tunnel fails, services can quickly switch to the backup P2MP TE tunnel.</p>
<div class="fignone" id="EN-US_TASK_0172370290__fig_dc_vrp_vpls_cfg_605601"><a name="EN-US_TASK_0172370290__fig_dc_vrp_vpls_cfg_605601"></a><a name="fig_dc_vrp_vpls_cfg_605601"></a><span class="figcap"><b>Figure 1 </b>Configuring P2MP TE tunnels to carry services in a multicast VPLS multi-homing scenario</span><br><span><img class="vsd" src="images/fig_dc_vrp_vpls_cfg_605601.png"></span><br></div>

<div class="tableBorder"><a name="EN-US_TASK_0172370290__tab_dc_vrp_vpls_cfg_507301"></a><a name="tab_dc_vrp_vpls_cfg_507301"></a><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" id="EN-US_TASK_0172370290__tab_dc_vrp_vpls_cfg_507301" frame="border" border="1" rules="all"><caption><b>Table 1 </b>Interfaces and IP addresses</caption><thead align="left"><tr><th align="left" class="cellrowborder" char="." valign="top" width="20%" id="mcps1.4.1.4.2.4.1.1" liSelected="liSelected"><p><strong>Device</strong></p>
</th>
<th align="left" class="cellrowborder" char="." valign="top" width="60%" id="mcps1.4.1.4.2.4.1.2" liSelected="liSelected"><p><strong>Interface</strong></p>
</th>
<th align="left" class="cellrowborder" char="." valign="top" width="20%" id="mcps1.4.1.4.2.4.1.3" liSelected="liSelected"><p><strong>IP Address</strong></p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" rowspan="3" valign="middle" width="20%" headers="mcps1.4.1.4.2.4.1.1 "><p>PE1</p>
</td>
<td class="cellrowborder" char="." valign="top" width="60%" headers="mcps1.4.1.4.2.4.1.2 "><p>GE<span>0/1/0</span></p>
</td>
<td class="cellrowborder" char="." valign="top" width="20%" headers="mcps1.4.1.4.2.4.1.3 "><p>10.1.2.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.4.1.2 "><p>GE <span>0/1/2</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>10.1.3.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.4.1.2 "><p>GE <span>0/1/3</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>10.1.4.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="3" valign="middle" width="20%" headers="mcps1.4.1.4.2.4.1.1 "><p>PE2</p>
</td>
<td class="cellrowborder" char="." valign="top" width="60%" headers="mcps1.4.1.4.2.4.1.2 "><p>GE<span>0/1/0</span></p>
</td>
<td class="cellrowborder" char="." valign="top" width="20%" headers="mcps1.4.1.4.2.4.1.3 "><p>10.1.5.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.4.1.2 "><p>GE <span>0/1/2</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>10.1.6.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.4.1.2 "><p>GE <span>0/1/3</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>10.1.4.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="2" valign="middle" width="20%" headers="mcps1.4.1.4.2.4.1.1 "><p>PE3</p>
</td>
<td class="cellrowborder" char="." valign="top" width="60%" headers="mcps1.4.1.4.2.4.1.2 "><p>GE<span>0/1/0</span></p>
</td>
<td class="cellrowborder" char="." valign="top" width="20%" headers="mcps1.4.1.4.2.4.1.3 "><p>10.1.2.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.4.1.2 "><p>GE <span>0/1/2</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>10.1.6.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="2" valign="middle" width="20%" headers="mcps1.4.1.4.2.4.1.1 "><p>PE4</p>
</td>
<td class="cellrowborder" char="." valign="top" width="60%" headers="mcps1.4.1.4.2.4.1.2 "><p>GE<span>0/1/0</span></p>
</td>
<td class="cellrowborder" char="." valign="top" width="20%" headers="mcps1.4.1.4.2.4.1.3 "><p>10.1.5.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.4.1.2 "><p>GE<span>0/1/2</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>10.1.3.2/24</p>
</td>
</tr>
</tbody>
</table>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172370290__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li>Configure an IP address and a routing protocol for each involved interface to ensure IP connectivity at the network layer. This example uses OSPF as the routing protocol.</li><li>Configure an MPLS LSR ID and globally enable MPLS, MPLS TE, and P2MP TE.</li><li>Configure a local LDP session on each PE.</li><li>Establish a BGP multi-homing VPLS connection between PE1 and PE3, PE1 and PE4, PE2 and PE3, and PE2 and PE4.</li><li>Configure primary and backup P2MP TE tunnels.</li><li>Configure PE3 and PE4 as leaf nodes.</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172370290__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>IP addresses of all interfaces listed in <a href="#EN-US_TASK_0172370290__tab_dc_vrp_vpls_cfg_507301">Table 1</a></p>
</li><li><p>OSPF process ID (100) and area ID (0.0.0.0) for each node</p>
</li><li><p>BGP AS numbers of PE1, PE2, PE3, and PE4</p>
</li><li><p>VSI names, VPLS IDs, and VPN targets</p>
</li><li><p>Number of the interface bound to each VSI</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172370290__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure an IP address and a routing protocol for each involved interface to ensure IP connectivity at the network layer.</span><p><p>For detailed configurations, see <a href="#EN-US_TASK_0172370290__section_dc_vrp_vpls_cfg_507301">Configuration Files</a>.</p>
</p></li><li><span>Configure an MPLS LSR ID and globally enable MPLS and P2MP TE.</span><p><p># Configure an MPLS LSR ID and globally enable MPLS and P2MP TE on PE1.</p>
<pre class="screen">&lt;PE1&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>mpls lsr-id 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls] <strong>mpls rsvp-te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls] <strong>mpls te cspf</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls] <strong>mpls te p2mp-te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure an MPLS LSR ID and globally enable MPLS and P2MP TE on PE2.</p>
<pre class="screen">&lt;PE2&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>mpls lsr-id 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls] <strong>mpls rsvp-te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls] <strong>mpls te cspf</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls] <strong>mpls te p2mp-te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure an MPLS LSR ID and globally enable MPLS and P2MP TE on PE3.</p>
<pre class="screen">&lt;PE3&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>mpls lsr-id 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-mpls] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-mpls] <strong>mpls rsvp-te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-mpls] <strong>mpls te cspf</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-mpls] <strong>mpls te p2mp-te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
<p># Configure an MPLS LSR ID and globally enable MPLS and P2MP TE on PE4.</p>
<pre class="screen">&lt;PE4&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE4] <strong>mpls lsr-id 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-mpls] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-mpls] <strong>mpls rsvp-te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-mpls] <strong>mpls te cspf</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-mpls] <strong>mpls te p2mp-te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4] <strong>commit</strong></pre>
</p></li><li><span>Configure a local LDP session on each PE.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>mpls rsvp-te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet<span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/2</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/2</span>] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/2</span>] <strong>mpls rsvp-te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/2</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>mpls rsvp-te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface gigabitethernet<span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/2</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/2</span>] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/2</span>] <strong>mpls rsvp-te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/2</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/0</span>] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/0</span>] <strong>mpls rsvp-te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>interface gigabitethernet<span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/2</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/2</span>] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/2</span>] <strong>mpls rsvp-te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/2</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
<p># Configure PE4.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE4] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4] <strong>interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-GigabitEthernet<span>0/1/0</span>] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-GigabitEthernet<span>0/1/0</span>] <strong>mpls rsvp-te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-GigabitEthernet<span>0/1/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4] <strong>interface gigabitethernet<span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-GigabitEthernet<span>0/1/2</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-GigabitEthernet<span>0/1/2</span>] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-GigabitEthernet<span>0/1/2</span>] <strong>mpls rsvp-te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-GigabitEthernet<span>0/1/2</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4] <strong>commit</strong></pre>
</p></li><li><span>Establish a BGP multi-homing VPLS connection between PE1 and PE3, PE1 and PE4, PE2 and PE3, and PE2 and PE4.</span><p><p># Configure BGP multi-homing VPLS on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 2.2.2.2 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 2.2.2.2 connect-interface loopback1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 3.3.3.3 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 3.3.3.3 connect-interface loopback1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 4.4.4.4 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 4.4.4.4 connect-interface loopback1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>l2vpn-ad-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-l2vpn-ad] <strong>signaling vpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-l2vpn-ad] <strong>signaling multi-homing non-standard-compatible</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-l2vpn-ad] <strong>peer 2.2.2.2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-l2vpn-ad] <strong>peer 3.3.3.3 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-l2vpn-ad] <strong>peer 4.4.4.4 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-l2vpn-ad] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>vsi vsi1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1] <strong>pwsignal bgp multi-homing</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1-bgp] <strong>route-distinguisher 1:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1-bgp] <strong>vpn-target 2:2 import-extcommunity</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1-bgp] <strong>vpn-target 2:2 export-extcommunity</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1-bgp] <strong>site-range 1000 default-offset 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1-bgp] <strong>site name site2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1-bgp-site-site2] <strong>site-id 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1-bgp-site-site2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1-bgp] <strong>site name best</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1-bgp-site-best] <strong>site-id 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1-bgp-site-best] <strong>best-site</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1-bgp-site-best] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet<span>0/1/1</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>.1] <strong>vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>.1] <strong>l2 binding vsi vsi1 multi-homing-site site2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure BGP multi-homing VPLS on PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>peer 1.1.1.1 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>peer 1.1.1.1 connect-interface loopback1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>peer 3.3.3.3 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>peer 3.3.3.3 connect-interface loopback1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>peer 4.4.4.4 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>peer 4.4.4.4 connect-interface loopback1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>l2vpn-ad-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-l2vpn-ad] <strong>signaling vpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-l2vpn-ad] <strong>signaling multi-homing non-standard-compatible</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-l2vpn-ad] <strong>peer 1.1.1.1 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-l2vpn-ad] <strong>peer 3.3.3.3 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-l2vpn-ad] <strong>peer 4.4.4.4 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-l2vpn-ad] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>vsi vsi1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-vsi1] <strong>pwsignal bgp multi-homing</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-vsi1-bgp] <strong>route-distinguisher 1:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-vsi1-bgpa] <strong>vpn-target 2:2 import-extcommunity</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-vsi1-bgp] <strong>vpn-target 2:2 export-extcommunity</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-vsi1-bgp] <strong>site-range 1000 default-offset 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-vsi1-bgp] <strong>site name site2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-vsi1-bgp-site-site2] <strong>site-id 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-vsi1-bgp-site-site2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-vsi1-bgp] <strong>site name best</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-vsi1-bgp-site-best] <strong>site-id 11</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-vsi1-bgp-site-best] <strong>best-site</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-vsi1-bgp-site-best] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-vsi1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-vsi1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface gigabitethernet<span>0/1/1</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>.1] <strong>vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>.1] <strong>l2 binding vsi vsi1 multi-homing-site site2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure BGP multi-homing VPLS on PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>peer 1.1.1.1 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>peer 1.1.1.1 connect-interface loopback1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>peer 2.2.2.2 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>peer 2.2.2.2 connect-interface loopback1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>l2vpn-ad-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp-af-l2vpn-ad] <strong>signaling vpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp-af-l2vpn-ad] <strong>signaling multi-homing non-standard-compatible</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp-af-l2vpn-ad] <strong>peer 1.1.1.1 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp-af-l2vpn-ad] <strong>peer 2.2.2.2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp-af-l2vpn-ad] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>vsi vsi1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vsi1] <strong>pwsignal bgp multi-homing</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vsi1-bgp] <strong>route-distinguisher 1:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vsi1-bgp] <strong>vpn-target 2:2 import-extcommunity</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vsi1-bgp] <strong>vpn-target 2:2 export-extcommunity</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vsi1-bgp] <strong>site-range 1000 default-offset 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vsi1-bgp] <strong>site name site2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vsi1-bgp-site-site2] <strong>site-id 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vsi1-bgp-site-site2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vsi1-bgp] <strong>site name best</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vsi1-bgp-site-best] <strong>site-id 12</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vsi1-bgp-site-best] <strong>best-site</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vsi1-bgp-site-best] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vsi1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vsi1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>interface gigabitethernet<span>0/1/3</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/3</span>.1] <strong>vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/3</span>.1] <strong>l2 binding vsi vsi1 multi-homing-site site2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/3</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
<p># Configure BGP multi-homing VPLS on PE4.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE4] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-bgp] <strong>peer 1.1.1.1 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-bgp] <strong>peer 1.1.1.1 connect-interface loopback1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-bgp] <strong>peer 2.2.2.2 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-bgp] <strong>peer 2.2.2.2 connect-interface loopback1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-bgp] <strong>l2vpn-ad-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-bgp-af-l2vpn-ad] <strong>signaling vpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-bgp-af-l2vpn-ad] <strong>signaling multi-homing non-standard-compatible</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-bgp-af-l2vpn-ad] <strong>peer 1.1.1.1 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-bgp-af-l2vpn-ad] <strong>peer 2.2.2.2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-bgp-af-l2vpn-ad] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4] <strong>vsi vsi1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-vsi-vsi1] <strong>pwsignal bgp multi-homing</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-vsi-vsi1-bgp] <strong>route-distinguisher 1:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-vsi-vsi1-bgp] <strong>vpn-target 2:2 import-extcommunity</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-vsi-vsi1-bgpa] <strong>vpn-target 2:2 export-extcommunity</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-vsi-vsi1-bgp] <strong>site-range 1000 default-offset 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-vsi-vsi1-bgp] <strong>site name site2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-vsi-vsi1-bgp-site-site2] <strong>site-id 3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-vsi-vsi1-bgp-site-site2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-vsi-vsi1-bgp] <strong>site name best</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-vsi-vsi1-bgp-site-best] <strong>site-id 13</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-vsi-vsi1-bgp-site-best] <strong>best-site</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-vsi-vsi1-bgp-site-best] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-vsi-vsi1-bgpa] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-vsi-vsi1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4] <strong>interface gigabitethernet<span>0/1/3</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-GigabitEthernet<span>0/1/3</span>.1] <strong>vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-GigabitEthernet<span>0/1/3</span>.1] <strong>l2 binding vsi vsi1 multi-homing-site site2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-GigabitEthernet<span>0/1/3</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4] <strong>commit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p>After the configuration is complete, run the <a href="cmdqueryname=display+vsi+verbose"><b><span class="cmdname">display vsi verbose</span></b></a> command on PE1. The command output shows VPLS connection information in the VPLS multi-homing scenario.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display vsi verbose</strong></pre>
<pre class="screen"> ***VSI Name               : vsi1
    Work Mode              : normal
    Administrator VSI      : no
    Isolate Spoken         : disable
    VSI Index              : 1
    PW Signaling           : <strong>bgpmh</strong>
    Member Discovery Style : --
    Bridge-domain Mode     : disable
    PW MAC Learn Style     : unqualify
    Encapsulation Type     : vlan
    MTU                    : 1500
    Diffserv Mode          : uniform
    Service Class          : --
    Color                  : --
    DomainId               : 255
    Domain Name            : 
    Ignore AcState         : disable
    P2P VSI                : disable
    Create Time            : 0 days, 1 hours, 19 minutes, 41 seconds
    VSI State              : <strong>up</strong>
    Resource Status        : --

    BGP RD                 : 1:1
    Import vpn target      : 2:2                    
    Export vpn target      : 2:2 
    Interface Name         : GigabitEthernet<span>0/1/1</span>.1
    State                  : up
    Ac Block State         : unblocked
    Access Port            : false
    Last Up Time           : 2017/07/04 09:39:40
    Total Up Time          : 0 days, 1 hours, 12 minutes, 15 seconds
</pre>
</p></li><li><span>Configure P2MP TE tunnels on PE1 (primary root node) and PE2 (backup root node).</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls te p2mp-template pt1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-te-p2mp-template-pt1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>vsi vsi1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1] <strong>inclusive-provider-tunnel</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1-inclusive] <strong>root</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1-inclusive-root] <strong>mpls-te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1-inclusive-root-mplste] <strong>p2mp te-template pt1 </strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1-inclusive-root-mplste] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1-inclusive-root] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1-inclusive] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>mpls te p2mp-template pt1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-te-p2mp-template-pt1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>vsi vsi1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-vsi1] <strong>inclusive-provider-tunnel</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-vsi1-inclusive] <strong>root</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-vsi1-inclusive-root] <strong>mpls-te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-vsi1-inclusive-root-mplste] <strong>p2mp te-template pt1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-vsi1-inclusive-root-mplste] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-vsi1-inclusive-root] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-vsi1-inclusive] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-vsi1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</p></li><li><span>Configure PE3 and PE4 as leaf nodes and specify the primary and backup P2MP TE tunnels.</span><p><p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-mpls] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>vsi vsi1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vsi1] <strong>inclusive-provider-tunnel</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vsi1-inclusive] <strong>leaf</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vsi1-inclusive-leaf] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vsi1-inclusive] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vsi1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
<p># Configure PE4.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE4] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-mpls] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4] <strong>vsi vsi1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-vsi-vsi1] <strong>inclusive-provider-tunnel</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-vsi-vsi1-inclusive] <strong>leaf</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-vsi-vsi1-inclusive-leaf] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-vsi-vsi1-inclusive] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-vsi-vsi1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4] <strong>commit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p>After the configuration is complete, run the <strong>display vsi name inclusive-provider-tunnel</strong> command on PE1 to check multicast VPLS tunnel information.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong>display vsi name vsi1 inclusive-provider-tunnel</strong></pre>
<pre class="screen">VSI name: vsi1
  Ingress provider tunnel
  Egress provider tunnel
  Egress PMSI count: 2
   *PMSI type      : P2MP TE
    Ingress LSR ID : 3.3.3.3
    Session ID     : 32801
    P2MP ID        : 0x2020202
    <strong>State         : up</strong>
   *PMSI type      : P2MP TE
    Ingress LSR ID : 4.4.4.4
    Session ID     : 32769
    P2MP ID        : 0x3030303
    <strong>State         : up</strong></pre>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0172370290__section_dc_vrp_vpls_cfg_507301"><a name="EN-US_TASK_0172370290__section_dc_vrp_vpls_cfg_507301"></a><a name="section_dc_vrp_vpls_cfg_507301"></a><a name="EN-US_TASK_0172370290__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>PE1 configuration file</p>
<pre class="screen">#
sysname PE1
#
mpls lsr-id 1.1.1.1
#
mpls
 mpls te
 mpls rsvp-te
 mpls te cspf 
 mpls te p2mp-te
#
mpls l2vpn
#
mpls te p2mp-template pt1
#
vsi vsi1
 pwsignal bgp multi-homing
  route-distinguisher 1:1
  vpn-target 2:2 import-extcommunity
  vpn-target 2:2 export-extcommunity
  site-range 1000 default-offset 0
  site name site2
   site-id 1
  site name best
   site-id 10
   best-site
 inclusive-provider-tunnel
  root
   mpls-te
    p2mp te-template pt1
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.2.1 255.255.255.0        
 mpls
 mpls te
 mpls rsvp-te
 mpls ldp
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
#
interface GigabitEthernet<span>0/1/1</span>.1
 undo shutdown
 vlan-type dot1q 10  
 l2 binding vsi vsi1 multi-homing-site site2
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown                            
 ip address 10.1.3.1 255.255.255.0        
 mpls
 mpls te
 mpls rsvp-te
 mpls ldp
#
interface GigabitEthernet<span>0/1/3</span>
 undo shutdown                            
 ip address 10.1.4.1 255.255.255.0        
#
interface LoopBack1
 ip address 1.1.1.1 255.255.255.255
#
bgp 100
 peer 2.2.2.2 as-number 100
 peer 2.2.2.2 connect-interface LoopBack1 
 peer 3.3.3.3 as-number 100
 peer 3.3.3.3 connect-interface LoopBack1 
 peer 4.4.4.4 as-number 100
 peer 4.4.4.4 connect-interface LoopBack1 
 #
 l2vpn-ad-family
  signaling vpls
  signaling multi-homing non-standard-compatible
  peer 2.2.2.2 enable
  peer 3.3.3.3 enable
  peer 4.4.4.4 enable
 #
ospf 100                                  
 area 0.0.0.0                             
  network 1.1.1.1 0.0.0.0                 
  network 10.1.2.0 0.0.0.255              
  network 10.1.3.0 0.0.0.255
  network 10.1.4.0 0.0.0.255              
#
return</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#
sysname PE2
#
mpls lsr-id 2.2.2.2
#
mpls
 mpls te
 mpls rsvp-te
 mpls te cspf 
 mpls te p2mp-te
#
mpls l2vpn
#
mpls te p2mp-template pt1
#
vsi vsi1
 pwsignal bgp multi-homing
  route-distinguisher 1:1
  vpn-target 2:2 import-extcommunity
  vpn-target 2:2 export-extcommunity
  site-range 1000 default-offset 0
  site name site2
   site-id 1
  site name best
   site-id 11
   best-site 
 inclusive-provider-tunnel
  root
   mpls-te
    p2mp te-template pt1
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.5.1 255.255.255.0        
 mpls
 mpls te
 mpls rsvp-te
 mpls ldp
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
#
interface GigabitEthernet<span>0/1/1</span>.1
 undo shutdown
 vlan-type dot1q 10  
 l2 binding vsi vsi1 multi-homing-site site2
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ip address 10.1.6.1 255.255.255.0        
 mpls
 mpls te
 mpls rsvp-te
 mpls ldp
#
interface GigabitEthernet<span>0/1/3</span>
 undo shutdown                            
 ip address 10.1.4.2 255.255.255.0        
#
interface LoopBack1
 ip address 2.2.2.2 255.255.255.255
#
bgp 100
 peer 1.1.1.1 as-number 100
 peer 1.1.1.1 connect-interface LoopBack1 
 peer 3.3.3.3 as-number 100
 peer 3.3.3.3 connect-interface LoopBack1 
 peer 4.4.4.4 as-number 100
 peer 4.4.4.4 connect-interface LoopBack1 
 #
 l2vpn-ad-family
  signaling vpls
  signaling multi-homing non-standard-compatible
  peer 1.1.1.1 enable
  peer 3.3.3.3 enable
  peer 4.4.4.4 enable
 #
ospf 100                                  
 area 0.0.0.0                             
  network 2.2.2.2 0.0.0.0                 
  network 10.1.4.0 0.0.0.255              
  network 10.1.5.0 0.0.0.255              
  network 10.1.6.0 0.0.0.255
#
return</pre>
</li><li><p>PE3 configuration file</p>
<pre class="screen">#
sysname PE3
#
mpls lsr-id 3.3.3.3
#
mpls
 mpls te
 mpls rsvp-te
 mpls te cspf
 mpls te p2mp-te
#
mpls l2vpn
#
vsi vsi1
 pwsignal bgp multi-homing
  route-distinguisher 1:1
  vpn-target 2:2 import-extcommunity
  vpn-target 2:2 export-extcommunity
  site-range 1000 default-offset 0
  site name site2
   site-id 2
  site name best
   site-id 12
   best-site 
 inclusive-provider-tunnel
  leaf
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown                            
 ip address 10.1.2.2 255.255.255.0        
 mpls
 mpls te
 mpls rsvp-te
 mpls ldp
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown                            
 ip address 10.1.6.2 255.255.255.0        
 mpls
 mpls te
 mpls rsvp-te
 mpls ldp
#
interface GigabitEthernet<span>0/1/3</span>.1
 vlan-type dot1q 10  
 l2 binding vsi vsi1 multi-homing-site site2
#
interface LoopBack1
 ip address 3.3.3.3 255.255.255.255
#
bgp 100 
 peer 1.1.1.1 as-number 100
 peer 1.1.1.1 connect-interface LoopBack1 
 peer 2.2.2.2 as-number 100
 peer 2.2.2.2 connect-interface LoopBack1
#
 l2vpn-ad-family
  signaling vpls
  signaling multi-homing non-standard-compatible
  peer 1.1.1.1 enable
  peer 2.2.2.2 enable
 #
ospf 100                                  
 area 0.0.0.0                             
  network 3.3.3.3 0.0.0.0                 
  network 10.1.2.0 0.0.0.255
  network 10.1.6.0 0.0.0.255
#                                         
return</pre>
</li><li><p>PE4 configuration file</p>
<pre class="screen">#
sysname PE4
#
mpls lsr-id 4.4.4.4
#
mpls
 mpls te
 mpls rsvp-te
 mpls te cspf
 mpls te p2mp-te
#
mpls l2vpn
#
vsi vsi1
 pwsignal bgp multi-homing
  route-distinguisher 1:1
  vpn-target 2:2 import-extcommunity
  vpn-target 2:2 export-extcommunity
  site-range 1000 default-offset 0
  site name site2
   site-id 3
  site name best
   site-id 13
   best-site 
 inclusive-provider-tunnel
  leaf
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown                            
 ip address 10.1.5.2 255.255.255.0        
 mpls
 mpls te
 mpls rsvp-te
 mpls ldp
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown                            
 ip address 10.1.3.2 255.255.255.0        
 mpls
 mpls te
 mpls rsvp-te
 mpls ldp
#
interface GigabitEthernet<span>0/1/3</span>.1
 vlan-type dot1q 10  
 l2 binding vsi vsi1 multi-homing-site site2
#
interface LoopBack1
 ip address 4.4.4.4 255.255.255.255
#
bgp 100 
 peer 1.1.1.1 as-number 100
 peer 1.1.1.1 connect-interface LoopBack1 
 peer 2.2.2.2 as-number 100
 peer 2.2.2.2 connect-interface LoopBack1 
 #
 l2vpn-ad-family
  signaling vpls
  signaling multi-homing non-standard-compatible
  peer 1.1.1.1 enable
  peer 2.2.2.2 enable
#
ospf 100                                  
 area 0.0.0.0                             
  network 4.4.4.4 0.0.0.0                 
  network 10.1.5.0 0.0.0.255    
  network 10.1.3.0 0.0.0.255    
#                                         
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_5029.html">Configuration Examples for VPLS
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_5073.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_6041.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>