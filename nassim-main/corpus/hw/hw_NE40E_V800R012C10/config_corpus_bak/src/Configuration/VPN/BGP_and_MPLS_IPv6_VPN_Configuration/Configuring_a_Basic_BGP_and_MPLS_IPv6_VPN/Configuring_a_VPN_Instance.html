
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring a VPN Instance">
<meta name="abstract" content="A VPN instance of the IPv6 address family can be configured to manage IPv6 VPN routes.">
<meta name="description" content="A VPN instance of the IPv6 address family can be configured to manage IPv6 VPN routes.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v6_cfg_2057.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v6_cfg_2059.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,l3vpnvrp,w00556928,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="BGP/MPLS IPv6 VPN">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP/MPLS IPv6 VPN">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="BGP/MPLS IPv6 VPN">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="BGP/MPLS IPv6 VPN">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="h00847023">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00415692">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172369586">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring a VPN Instance</title>
</head>
<body><a name="EN-US_TASK_0172369586"></a><a name="EN-US_TASK_0172369586"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring a VPN Instance</h1>
<div class="taskbody"><p>A VPN instance of the IPv6 address family can be configured to manage IPv6 VPN routes.</p>
<div class="context"><a name="EN-US_TASK_0172369586__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>In BGP/MPLS IPv6 VPN, a separate instance is created for each VPN to store VPN forwarding information. Such an instance is known as a VPN instance or VPN routing and forwarding (VRF) table. In related standards, it may also be referred to as a per-site forwarding table.</p>
<p>VPN instances are used to isolate VPN routes from public network routes. Routes of different VPN instances are isolated from one another. VPN instances need to be configured in all types of BGP/MPLS IPv6 VPN networking solutions.</p>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172369586__1.4.2"></a><a name="1.4.2"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li><span>Run <a href="cmdqueryname=ip+vpn-instance"><b><span class="cmdname">ip vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i></span><p><p>A VPN instance is created, and the VPN instance view is displayed.</p>
</p><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The name of a VPN instance is case sensitive. For example, <strong>vpn1</strong> and <strong>VPN1</strong> are considered different VPN instances.</p>
</div></div>
</p></li><li><span>(Optional) Run <a href="cmdqueryname=description"><b><span class="cmdname">description</span></b></a> <i><span class="varname">description-information</span></i></span><p><p>A description about the VPN instance is configured.</p>
</p><p><p>Similar to a host name or an interface description, the VPN instance description helps users memorize the VPN instance.</p>
</p></li><li><span>(Optional) Run <a href="cmdqueryname=service-id"><b><span class="cmdname">service-id</span></b></a> <i><span class="varname">id</span></i></span><p><p>A service ID is created for the VPN instance.</p>
</p><p><p>A service ID is unique on a device. It distinguishes a VPN service from other VPN services on the network.</p>
</p></li><li><span>(Optional) Run <a href="cmdqueryname=vpn-id"><b><span class="cmdname">vpn-id</span></b></a> <i><span class="varname">vpn-id</span></i></span><p><p>A VPN ID is set.</p>
<p>You can run this command to create a globally unique ID for a VPN instance. In a CU separation scenario, you can run this command to set the same VPN ID for the control plane and forwarding plane to prevent VPN ID inconsistency.</p>
</p></li><li><span>Run <a href="cmdqueryname=ipv6-family"><b><span class="cmdname">ipv6-family</span></b></a></span><p><p>A VPN instance IPv6 address family is configured, and its view is displayed.</p>
</p><p><p>VPN instances support both the IPv4 and IPv6 address families. The VPN instance configuration is performed only after an address family is configured based on the types of routes to be advertised and data to be forwarded.</p>
</p></li><li><span>Run <a href="cmdqueryname=route-distinguisher"><b><span class="cmdname">route-distinguisher</span></b></a> <i><span class="varname">route-distinguisher</span></i></span><p><p>An RD is set for the VPN instance IPv6 address family.</p>
</p><p><p>A VPN instance IPv6 address family takes effect only after being assigned an RD. The RDs of different VPN instances on a PE must be different.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>If a large number of VPN instances need to be created and a large number of RDs need to be planned, run the <a href="cmdqueryname=route+route-distinguisher+auto"><b><span class="cmdname">route route-distinguisher auto</span></b></a> <i><span class="varname">rd-ip</span></i> command in the system view to enable automatic RD allocation and set the <i><span class="varname">rd-ip</span></i> parameter to an IPv4 address. Then the device can assign RDs in the format of <em>X.X.X.X:index</em> to all VPN instances that are not assigned RDs. The value of <em>index</em> is a 2-byte value automatically assigned in a range of 1 to 65535. Automatic RD allocation applies to VPN instances without manually configured RDs. If an RD has been configured for the IPv4 or IPv6 address family of a VPN instance using the <a href="cmdqueryname=route-distinguisher"><b><span class="cmdname">route-distinguisher</span></b></a> <i><span class="varname">route-distinguisher</span></i> command, the device will not dynamically allocate a new RD to that address family of the VPN instance.</p>
</div></div>
</p></li><li><span>Run <a href="cmdqueryname=vpn-target"><b><span class="cmdname">vpn-target</span></b></a> <i><span class="varname">vpn-target</span></i> &amp;&lt;1-8&gt; [ <strong><span>both</span></strong> | <strong><span>export-extcommunity</span></strong> | <strong><span>import-extcommunity</span></strong> ]</span><p><p>One or more import VPN targets, one or more export VPN targets, or both of import and export VPN targets are configured for the VPN instance IPv6 address family.</p>
</p><p><p>A VPN target is a BGP extended community attribute. It is used to control the advertisement or acceptance of VPN-IPv6 route information. A maximum of eight VPN targets can be configured using the <a href="cmdqueryname=vpn-target"><b><span class="cmdname">vpn-target</span></b></a> command. If you want to configure more VPN targets in the VPN instance IPv6 address family view, repeat running the <a href="cmdqueryname=vpn-target"><b><span class="cmdname">vpn-target</span></b></a> command.</p>
</p></li><li><span>(Optional) Run <a href="cmdqueryname=prefix+limit"><b><span class="cmdname">prefix limit</span></b></a> <i><span class="varname">number</span></i> { <i><span class="varname">alert-percent</span></i><span> [ <strong><span>route-unchanged</span></strong> ]</span> | <strong><span>simply-alert</span></strong> }</span><p><p>The maximum number of route prefixes supported by the VPN instance IPv6 address family is set.</p>
</p><p><div class="p">The configuration restricts the number of route prefixes imported from the CEs and other PEs into a VPN instance IPv6 address family on a PE, preventing the PE from receiving too many route prefixes.<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>After the number of route prefixes exceeds the maximum number, direct and static routes can still be added to the VPN routing table of the VPN instance IPv6 address family.</p>
</div></div>
</div>
</p></li><li><span>(Optional) Run <a href="cmdqueryname=import+route-policy"><b><span class="cmdname">import route-policy</span></b></a> <i><span class="varname">policy-name</span></i></span><p><p>An import route-policy is applied to the VPN instance IPv6 address family.</p>
</p><p><p>In addition to using VPN targets to control the import and export of VPN routes, you can use an import route-policy to better control the import of VPN routes. It filters routes to be imported into the VPN instance IPv6 address family.</p>
</p></li><li><span>(Optional) Run <a href="cmdqueryname=export+route-policy"><b><span class="cmdname">export route-policy</span></b></a> <i><span class="varname">policy-name</span></i><span> [ <strong><span>add-ert-first</span></strong> ]</span></span><p><p>An export route-policy is applied to the VPN instance IPv6 address family.</p>
</p><p><p>In addition to using a VPN target to control the import and export of VPN routes, you can use an export route-policy to better control the export of VPN routes to other PEs. The export route-policy filters routes before they are advertised to other PEs.</p>
<p>By default, export VPN targets are added to VPN routes after these routes match an export route-policy. If the export route-policy contains VPN target-related filter rules, the route-policy cannot apply to these routes. To prevent such rule-induced failures, configure the <strong><span>add-ert-first</span></strong> parameter to instruct the device to add export VPN targets to VPN routes before these routes are matched against the export route-policy.</p>
</p></li><li><span>(Optional) Run <a href="cmdqueryname=import+route-filter"><b><span class="cmdname">import route-filter</span></b></a> <i><span class="varname">route-filter-name</span></i></span><p><p>An import route-filter is configured for the VPN instance IPv6 address family.</p>
</p><p><p>In addition to using VPN targets to control the import and export of VPN routes, you can use an import route-filter to better control the import of VPN routes. An import route-filter can filter routes to be imported into the VPN instance IPv6 address family.</p>
</p></li><li><span>(Optional) Run <a href="cmdqueryname=export+route-filter"><b><span class="cmdname">export route-filter</span></b></a> <i><span class="varname">route-filter-name</span></i> [ <strong><span>add-ert-first</span></strong> ]</span><p><p>An export route-filter is configured for the VPN instance IPv6 address family.</p>
</p><p><p>In addition to using VPN targets to control the import and export of VPN routes, you can use an export route-filter to better control the export of VPN routes to other PEs. </p>
<p>By default, export VPN targets are added to VPN routes before these routes are matched against an export route-filter. If the export route-filter contains VPN target-related filtering rules, these rules cannot apply to these routes. If you want to apply the VPN target-related filter rules defined in an export route-filter to VPN routes, configure the <strong><span>add-ert-first</span></strong> parameter to configure the system to add export VPN targets to VPN routes before matching these routes against the export route-filter.</p>
</p></li><li><span>(Optional) Run <a href="cmdqueryname=tnl-policy"><b><span class="cmdname">tnl-policy</span></b></a> <i><span class="varname">policy-name</span></i></span><p><p>A tunnel policy is applied to the VPN instance IPv6 address family.</p>
</p><p><p>A tunnel can be specified for IPv6 VPN traffic forwarding when a tunnel policy is applied to the VPN instance IPv6 address family.</p>
</p></li><li><span>(Optional) Configure a label distribution mode for the VPN instance IPv6 address family.</span><p><ul><li>Run the <a href="cmdqueryname=apply-label+pop-go"><b><span class="cmdname">apply-label</span></b></a> { <strong><span>per-nexthop</span></strong> | <strong><span>per-route</span></strong> } <strong><span>pop-go</span></strong> command to configure the VPN instance IPv6 address family to assign a label to each route or routes with the same next hop and outgoing label before the routes are sent to a peer PE. After receiving a data packet with the label, the peer PE removes the label, searches the ILM table for an outbound interface, and forwards the packet through the outbound interface.</li><li>Run the <a href="cmdqueryname=apply-label"><b><span class="cmdname">apply-label</span></b></a> { <strong><span>per-instance</span></strong> | <strong><span>per-nexthop</span></strong> | <strong><span>per-route</span></strong> } command to configure a label distribution mode for the VPN instance IPv6 address family.</li></ul>
<p>The <a href="cmdqueryname=apply-label"><b><span class="cmdname">apply-label</span></b></a> { <strong><span>per-nexthop</span></strong> | <strong><span>per-route</span></strong> } <strong><span>pop-go</span></strong> command is mutually exclusive with the <a href="cmdqueryname=apply-label"><b><span class="cmdname">apply-label</span></b></a> { <strong><span>per-instance</span></strong> | <strong><span>per-nexthop</span></strong> | <strong><span>per-route</span></strong> }. If you run both commands, the later configuration overrides the previous one.</p>
</p></li><li><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v6_cfg_2057.html">Configuring a Basic BGP/MPLS IPv6 VPN
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v6_cfg_2059.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>