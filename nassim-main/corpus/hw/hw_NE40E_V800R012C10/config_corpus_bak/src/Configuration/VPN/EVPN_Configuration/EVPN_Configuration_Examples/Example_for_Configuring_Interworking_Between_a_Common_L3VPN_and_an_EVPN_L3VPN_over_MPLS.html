
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Interworking Between a Common L3VPN and an EVPN L3VPN over MPLS">
<meta name="abstract" content="This section provides an example for configuring interworking between a common L3VPN and an EVPN L3VPN to implement communication between the two networks.">
<meta name="description" content="This section provides an example for configuring interworking between a common L3VPN and an EVPN L3VPN to implement communication between the two networks.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0010.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0047.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0087.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="p00915595,w00800033,w00556928,l00468467,w00606909,evpnvrp,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="p00915595">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00878323">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172370655">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>Example for Configuring Interworking Between a Common L3VPN and an EVPN L3VPN over MPLS</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172370655"></a><a name="EN-US_TASK_0172370655"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Interworking Between a Common L3VPN and an EVPN L3VPN over MPLS</h1>
<div class="taskbody"><p>This section provides an example for configuring interworking between a common L3VPN and an EVPN L3VPN to implement communication between the two networks.</p>
<div class="context"><a name="EN-US_TASK_0172370655__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>Many metro networks deployed with L3VPN are evolving towards EVPN. If a metro network involves a large number of devices, E2E evolution may not be completed at one time. If this is the case, co-existence of L3VPN and EVPN arises. On the network shown in <a href="#EN-US_TASK_0172370655__fig6836194111119">Figure 1</a>, an L3VPN is deployed between the UPE and NPE1, and an EVPN is deployed between NPE1 and NPE2. To allow communication between the L3VPN and EVPN, configure the border device NPE1 between the two networks.</p>
<div class="fignone" id="EN-US_TASK_0172370655__fig6836194111119"><a name="EN-US_TASK_0172370655__fig6836194111119"></a><a name="fig6836194111119"></a><span class="figcap"><b>Figure 1 </b>Configuring interworking between common L3VPN and EVPN L3VPN over MPLS</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 and 2 in this example represent GE<span>0/1/0</span> and GE<span>0/2/0</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0000001224889809.png"></span><br></div>

<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" frame="border" border="1" rules="all"><caption><b>Table 1 </b>Interface IP addresses</caption><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="12.62126212621262%" id="mcps1.4.1.4.2.4.1.1" liSelected="liSelected"><p>Device</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="43.85438543854385%" id="mcps1.4.1.4.2.4.1.2" liSelected="liSelected"><p>Interface</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="43.52435243524352%" id="mcps1.4.1.4.2.4.1.3" liSelected="liSelected"><p>IP Address</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" rowspan="3" valign="middle" width="12.62126212621262%" headers="mcps1.4.1.4.2.4.1.1 "><p>UPE</p>
</td>
<td class="cellrowborder" valign="top" width="43.85438543854385%" headers="mcps1.4.1.4.2.4.1.2 "><p>GigabitEthernet <span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" width="43.52435243524352%" headers="mcps1.4.1.4.2.4.1.3 "><p>10.1.1.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.2 "><p>GigabitEthernet <span>0/2/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>192.168.20.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.2 "><p>LoopBack1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>1.1.1.1/32</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="3" valign="middle" width="12.62126212621262%" headers="mcps1.4.1.4.2.4.1.1 "><p>NPE1</p>
</td>
<td class="cellrowborder" valign="top" width="43.85438543854385%" headers="mcps1.4.1.4.2.4.1.2 "><p>GigabitEthernet <span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" width="43.52435243524352%" headers="mcps1.4.1.4.2.4.1.3 "><p>10.1.1.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.2 "><p>GigabitEthernet <span>0/2/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>10.2.1.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.2 "><p>LoopBack1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>2.2.2.2/32</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="3" valign="middle" width="12.62126212621262%" headers="mcps1.4.1.4.2.4.1.1 "><p>NPE2</p>
</td>
<td class="cellrowborder" valign="top" width="43.85438543854385%" headers="mcps1.4.1.4.2.4.1.2 "><p>GigabitEthernet <span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" width="43.52435243524352%" headers="mcps1.4.1.4.2.4.1.3 "><p>10.2.1.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.2 "><p>GigabitEthernet <span>0/2/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>192.168.30.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.2 "><p>LoopBack1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>3.3.3.3/32</p>
</td>
</tr>
</tbody>
</table>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172370655__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Deploy IGPs on the UPE, NPE1, and NPE2. In this example, OSPF runs between the UPE and NPE1, and IS-IS runs between NPE1 and NPE2.</p>
</li><li><p>Configure MPLS LDP on the UPE, NPE1, and NPE2.</p>
</li><li><p>Configure L3VPN instances on the UPE and NPE1, and establish a BGP VPNv4 connection between them.</p>
</li><li><p>Establish a BGP EVPN connection between NPE1 and NPE2.</p>
</li><li><p>Configure an L3VPN instance and binding it to a physical interface on NPE2 to access Layer 3 services.</p>
</li><li><p>Enable NPE1 to re-originate routes.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172370655__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>MPLS LSR IDs of the UPE and NPEs</p>
</li><li><p>VPN instance RD</p>
</li><li><p>VPN targets used for route import and export by the VPN instance</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172370655__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure IP addresses, including loopback interface addresses, on the UPE, NPE1, and NPE2.</span><p><p>For details about how to configure interface IP addresses and masks, see <a href="#EN-US_TASK_0172370655__dc_vrp_evpn_cfg_007001">Configuration Files</a> in this section.</p>
</p></li><li><span>Deploy IGPs on the UPE, NPE1, and NPE2. In this example, OSPF runs between the UPE and NPE1, and IS-IS runs between NPE1 and NPE2.</span><p><p>For configuration details, see <a href="#EN-US_TASK_0172370655__dc_vrp_evpn_cfg_007001">Configuration Files</a> in this section.</p>
</p></li><li><span>Configure MPLS LDP on the UPE, NPE1, and NPE2.</span><p><p>For configuration details, see <a href="#EN-US_TASK_0172370655__dc_vrp_evpn_cfg_007001">Configuration Files</a> in this section.</p>
</p></li><li><span>Configure L3VPN instances on the UPE and NPE1, and establish a BGP VPNv4 connection between them.</span><p><p># Configure the UPE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>ip vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vpn-instance-vpn1] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vpn-instance-vpn1-af-ipv4] <strong>route-distinguisher 10:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vpn-instance-vpn1-af-ipv4] <strong>vpn-target 1:1 both</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vpn-instance-vpn1-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vpn-instance-vpn1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>interface GigabitEthernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/2/0</span>] <strong>ip binding vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/2/0</span>] <strong>ip address 192.168.20.1 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-bgp] <strong>peer 2.2.2.2 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-bgp] <strong>peer 2.2.2.2 connect-interface LoopBack1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-bgp] <strong>ipv4-family vpnv4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-bgp-af-vpnv4] <strong>peer 2.2.2.2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-bgp-af-vpnv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-bgp] <strong>ipv4-family vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-bgp-vpn1] <strong>import-route direct</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-bgp-vpn1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>commit</strong></pre>
<p># Configure NPE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE1] <strong>ip vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-vpn-instance-vpn1] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-vpn-instance-vpn1-af-ipv4] <strong>route-distinguisher 10:2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-vpn-instance-vpn1-af-ipv4] <strong>vpn-target 1:1 both</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-vpn-instance-vpn1-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-vpn-instance-vpn1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-bgp] <strong>peer 1.1.1.1 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-bgp] <strong>peer 1.1.1.1 connect-interface LoopBack1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-bgp] <strong>ipv4-family vpnv4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-bgp-af-vpnv4] <strong>peer 1.1.1.1 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-bgp-af-vpnv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1] <strong>commit</strong></pre>
</p></li><li><span>Establish a BGP EVPN connection between NPE1 and NPE2.</span><p><p># Configure NPE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-bgp] <strong>peer 3.3.3.3 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-bgp] <strong>peer 3.3.3.3 connect-interface LoopBack1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-bgp] <strong>l2vpn-family evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-bgp-af-evpn] <strong>peer 3.3.3.3 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-bgp-af-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-bgp] <strong>ipv4-family vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-bgp-vpn1] <strong>advertise l2vpn evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1] <strong>commit</strong></pre>
<p># Configure NPE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE2] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2-bgp] <strong>peer 2.2.2.2 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2-bgp] <strong>peer 2.2.2.2 connect-interface LoopBack1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2-bgp] <strong>l2vpn-family evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2-bgp-af-evpn] <strong>peer 2.2.2.2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2-bgp-af-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2] <strong>commit</strong></pre>
</p></li><li><span>Configure an L3VPN instance and binding it to a physical interface on NPE2 to access Layer 3 services.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE2] <strong>ip vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2-vpn-instance-vpn1] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2-vpn-instance-vpn1-af-ipv4] <strong>route-distinguisher 20:2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2-vpn-instance-vpn1-af-ipv4] <strong>vpn-target 2:2 both evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2-vpn-instance-vpn1-af-ipv4] <strong>evpn mpls routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2-vpn-instance-vpn1-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2-vpn-instance-vpn1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2] <strong>interface GigabitEthernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2-GigabitEthernet<span>0/2/0</span>] <strong>ip binding vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2-GigabitEthernet<span>0/2/0</span>] <strong>ip address 192.168.30.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2-bgp] <strong>ipv4-family vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2-bgp-vpn1] <strong>advertise l2vpn evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2-bgp-vpn1] <strong>import-route direct</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2-bgp-vpn1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2] <strong>commit</strong></pre>
</p></li><li><span>Enable NPE1 to re-originate routes.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE1] <strong>ip vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-vpn-instance-vpn1] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-vpn-instance-vpn1-af-ipv4] <strong>vpn-target 2:2 both evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-vpn-instance-vpn1-af-ipv4] <strong>evpn mpls routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-pn-instance-vpn1-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-vpn-instance-vpn1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-bgp] <strong>ipv4-family vpnv4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-bgp-af-vpnv4] <strong>peer 1.1.1.1 reflect-client</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-bgp-af-vpnv4] <strong>peer 1.1.1.1 import reoriginate</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-bgp-af-vpnv4] <strong>peer 1.1.1.1 advertise route-reoriginated evpn mac-ip</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-bgp-af-vpnv4] <strong>peer 1.1.1.1 advertise route-reoriginated evpn ip</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-bgp-af-vpnv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-bgp] <strong>l2vpn-family evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-bgp-af-evpn] <strong>peer 3.3.3.3 advertise irb</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-bgp-af-evpn] <strong>peer 3.3.3.3 reflect-client</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-bgp-af-evpn] <strong>peer 3.3.3.3 import reoriginate</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-bgp-af-evpn] <strong>peer 3.3.3.3 advertise route-reoriginated vpnv4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-bgp-af-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1] <strong>commit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p>Run the <strong>display bgp evpn all routing-table</strong> command on NPE2. The command output shows EVPN routes received from the UPE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE2] <strong>display bgp evpn all routing-table</strong></pre>
<pre class="screen"> Local AS number : 100

 BGP Local router ID is 3.3.3.3
 Status codes: * - valid, &gt; - best, d - damped, x - best external, a - add path,
               h - history,  i - internal, s - suppressed, S - Stale
               Origin : i - IGP, e - EGP, ? - incomplete


 EVPN address family:
 Number of Ip Prefix Routes: 4
 Route Distinguisher: 10:1
       Network(EthTagId/IpPrefix/IpPrefixLen)                 NextHop
 *&gt;i   <strong>0:192.168.20.0:24</strong>                                   2.2.2.2
 Route Distinguisher: 10:2
       Network(EthTagId/IpPrefix/IpPrefixLen)                 NextHop
 *&gt;i   <strong>0:192.168.20.0:24</strong>                                   2.2.2.2
 *&gt;    0:192.168.30.0:24                                      0.0.0.0
 *&gt;    0:192.168.30.1:32                                      0.0.0.0
    </pre>
<p>Run the <strong>display ip routing-table vpn-instance vpn1</strong> command on NPE2. The command output shows VPN route information.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE2] <strong>display ip routing-table vpn-instance vpn1</strong></pre>
<pre class="screen">Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route
------------------------------------------------------------------------------
Routing Table : vpn1
         Destinations : 5        Routes : 5         

Destination/Mask    Proto   Pre  Cost        Flags NextHop         Interface

   <strong>192.168.20.0/24</strong>  IBGP    255  0             RD  2.2.2.2         GigabitEthernet<span>0/1/0</span>
   192.168.30.0/24  Direct  0    0             D   192.168.30.1    GigabitEthernet<span>0/2/0</span>
   192.168.30.1/32  Direct  0    0             D   127.0.0.1       GigabitEthernet<span>0/2/0</span>
 192.168.30.255/32  Direct  0    0             D   127.0.0.1       GigabitEthernet<span>0/2/0</span>
255.255.255.255/32  Direct  0    0             D   127.0.0.1       InLoopBack0</pre>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0172370655__dc_vrp_evpn_cfg_007001"><a name="EN-US_TASK_0172370655__dc_vrp_evpn_cfg_007001"></a><a name="dc_vrp_evpn_cfg_007001"></a><a name="EN-US_TASK_0172370655__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>UPE configuration file</p>
<pre class="screen">#
sysname UPE
#
ip vpn-instance vpn1
 ipv4-family
  route-distinguisher 10:1
<span>  apply-label per-instance</span>
  vpn-target 1:1 export-extcommunity
  vpn-target 1:1 import-extcommunity
#
mpls lsr-id 1.1.1.1
#
mpls
#               
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.1.1 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip binding vpn-instance vpn1
 ip address 192.168.20.1 255.255.255.0
#
interface LoopBack1
 ip address 1.1.1.1 255.255.255.255
#
bgp 100
 peer 2.2.2.2 as-number 100
 peer 2.2.2.2 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 2.2.2.2 enable
 #
 ipv4-family vpnv4
  policy vpn-target
  peer 2.2.2.2 enable
 #
 ipv4-family vpn-instance vpn1
  import-route direct
  peer 192.168.20.2 as-number 65410
#
ospf 1
 area 0.0.0.0
  network 1.1.1.1 0.0.0.0
  network 10.1.1.0 0.0.0.255
#
return</pre>
</li><li><p>NPE1 configuration file</p>
<pre class="screen">#
sysname NPE1
#
ip vpn-instance vpn1
 ipv4-family
  route-distinguisher 10:2
<span>  apply-label per-instance</span>
  vpn-target 1:1 export-extcommunity
  vpn-target 2:2 export-extcommunity evpn
  vpn-target 1:1 import-extcommunity
  vpn-target 2:2 import-extcommunity evpn
  evpn mpls routing-enable
#
mpls lsr-id 2.2.2.2
#
mpls
#
mpls ldp
#
isis 1
 network-entity 10.0000.0000.0002.00
#               
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.1.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.2.1.1 255.255.255.0
 isis enable 1
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 2.2.2.2 255.255.255.255
 isis enable 1
#
bgp 100
 peer 1.1.1.1 as-number 100
 peer 1.1.1.1 connect-interface LoopBack1
 peer 3.3.3.3 as-number 100
 peer 3.3.3.3 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 1.1.1.1 enable
  peer 3.3.3.3 enable
 #
 ipv4-family vpnv4
  policy vpn-target
  peer 1.1.1.1 enable
  peer 1.1.1.1 reflect-client
  peer 1.1.1.1 import reoriginate
  peer 1.1.1.1 advertise route-reoriginated evpn mac-ip
  peer 1.1.1.1 advertise route-reoriginated evpn ip
 #
 ipv4-family vpn-instance vpn1
  advertise l2vpn evpn
 #
 l2vpn-family evpn
  undo policy vpn-target
  peer 3.3.3.3 enable
  peer 3.3.3.3 advertise irb
  peer 3.3.3.3 reflect-client
  peer 3.3.3.3 import reoriginate
  peer 3.3.3.3 advertise route-reoriginated vpnv4
#
ospf 1
 area 0.0.0.0
  network 2.2.2.2 0.0.0.0
  network 10.1.1.0 0.0.0.255
#
return</pre>
</li><li><p>NPE2 configuration file</p>
<pre class="screen">#
sysname NPE2
#
ip vpn-instance vpn1
 ipv4-family
  route-distinguisher 20:2
<span>  apply-label per-instance</span>
  vpn-target 2:2 export-extcommunity evpn
  vpn-target 2:2 import-extcommunity evpn
  evpn mpls routing-enable
#
mpls lsr-id 3.3.3.3
#
mpls
#
mpls ldp
#
isis 1
 network-entity 10.0000.0000.0003.00
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.2.1.2 255.255.255.0
 isis enable 1
 mpls
 mpls ldp       
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip binding vpn-instance vpn1
 ip address 192.168.30.1 255.255.255.0
#
interface LoopBack1
 ip address 3.3.3.3 255.255.255.255
 isis enable 1
#
bgp 100
 peer 2.2.2.2 as-number 100
 peer 2.2.2.2 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 2.2.2.2 enable
 #
 ipv4-family vpn-instance vpn1
  import-route direct
  advertise l2vpn evpn
 #
 l2vpn-family evpn
  undo policy vpn-target
  peer 2.2.2.2 enable
  peer 2.2.2.2 advertise irb
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0010.html">EVPN Configuration Examples
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0047.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0087.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>