
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring a Static Route for GRE">
<meta name="abstract" content="This section provides an example for configuring static routes for GRE. The configuration allows traffic between users to be transmitted over GRE tunnels. Static routes are required between a device and its connected clients.">
<meta name="description" content="This section provides an example for configuring static routes for GRE. The configuration allows traffic between users to be transmitted over GRE tunnels. Static routes are required between a device and its connected clients.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_gre_cfg_2020.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_gre_cfg_2039.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,w00556928,grevrp,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="GRE">
<meta name="featuretype" content="VPN">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="GRE">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="GRE">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="GRE">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="h00847023">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00830487">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172369095">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring a Static Route for GRE</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172369095"></a><a name="EN-US_TASK_0172369095"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring a Static Route for GRE</h1>
<div class="taskbody"><p>This section provides an example for configuring static routes for GRE. The configuration allows traffic between users to be transmitted over GRE tunnels. Static routes are required between a device and its connected clients.</p>
<div class="context"><a name="EN-US_TASK_0172369095__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0172369095__fig_dc_vrp_gre_cfg_203101">Figure 1</a>, <span class="keyword">Device</span>A, <span class="keyword">Device</span>B, and <span class="keyword">Device</span>C belong to the VPN backbone network, and OSPF runs among them.</p>
<p>It is required that a direct link be established between <span class="keyword">Device</span>A and <span class="keyword">Device</span>C. To meet such a requirement, configure a GRE tunnel between <span class="keyword">Device</span>A and <span class="keyword">Device</span>C and specify the tunnel interface as the outbound interface of a static route, so that PC1 and PC2 can communicate with each other.</p>
<p>PC1 and PC2 respectively use <span class="keyword">Device</span>A and <span class="keyword">Device</span>C as their default gateways.</p>
<div class="fignone" id="EN-US_TASK_0172369095__fig_dc_vrp_gre_cfg_203101"><a name="EN-US_TASK_0172369095__fig_dc_vrp_gre_cfg_203101"></a><a name="fig_dc_vrp_gre_cfg_203101"></a><span class="figcap"><b>Figure 1 </b>Configuring static routes for GRE</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interfaces 1 through 3 represent GE<span>0/1/0</span>, GE<span>0/2/0</span>, and Tunnel1, respectively.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_gre_cfg_203101.png" width="NaN" height="NaN"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172369095__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure a dynamic routing protocol for <span class="keyword">Router</span>s to communicate.</p>
</li><li><p>Create tunnel interfaces on <span class="keyword">Device</span>A and <span class="keyword">Device</span>C, and specify the source and destination addresses of the tunnel interfaces. The tunnel source address is the IP address of the interface that sends packets, and the tunnel destination address is the IP address of the interface that receives packets.</p>
</li><li><p>To enable the tunnel to support dynamic routing protocols, you also need to configure an IP address for the tunnel interface.</p>
</li><li><p>To transmit traffic between PC1 and PC2 through the GRE tunnel, configure a static route to PC2 on <span class="keyword">Device</span>A and a static route to PC1 on <span class="keyword">Device</span>C, and specify the local tunnel interface as the outbound interface of the corresponding static route.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172369095__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>Data required for running OSPF</p>
</li><li><p>Source and destination addresses of the GRE tunnel, and tunnel interface IP addresses</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172369095__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure interface IP addresses.</span><p><p>Configure IP addresses for interfaces as shown in <a href="#EN-US_TASK_0172369095__fig_dc_vrp_gre_cfg_203101">Figure 1</a>. For detailed configurations, see Configuration Files.</p>
</p></li><li><span>Configure IGP on the VPN backbone network.</span><p><p># Configure <span class="keyword">Device</span>A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-ospf-1] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-ospf-1-area-0.0.0.0] <strong>network 172.20.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-ospf-1-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-ospf-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
<p># Configure <span class="keyword">Device</span>B.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-ospf-1] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-ospf-1-area-0.0.0.0] <strong>network 172.20.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-ospf-1-area-0.0.0.0] <strong>network 172.21.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-ospf-1-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-ospf-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>commit</strong></pre>
<p># Configure <span class="keyword">Device</span>C.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C] <strong>ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-ospf-1] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-ospf-1-area-0.0.0.0] <strong>network 172.21.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-ospf-1-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-ospf-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C] <strong>commit</strong></pre>
<p>After the configuration is complete, run the <strong>display ip routing-table</strong> command on <span class="keyword">Device</span>A and <span class="keyword">Device</span>C. The command output shows that they have learned the OSPF route to the network segment of each other's interconnection interface.</p>
<p># The following example uses the command output on <span class="keyword">Device</span>A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A]<strong> display ip routing-table</strong></pre>
<pre class="screen"><span class="keyword">Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route</span>
------------------------------------------------------------------------------
Routing Table : _public_
         Destinations : 11       Routes : 11

Destination/Mask    Proto   Pre  Cost        Flags NextHop         Interface

       10.1.1.0/24  Direct  0    0             D  10.1.1.2        GigabitEthernet<span>0/2/0</span>
       10.1.1.2/32  Direct  0    0             D  127.0.0.1       GigabitEthernet<span>0/2/0</span>
     10.1.1.255/32  Direct  0    0             D  127.0.0.1       GigabitEthernet<span>0/2/0</span>
     172.20.1.0/24  Direct  0    0             D  172.20.1.1      GigabitEthernet<span>0/1/0</span>
     172.20.1.1/32  Direct  0    0             D  127.0.0.1       GigabitEthernet<span>0/1/0</span>
   172.20.1.255/32  Direct  0    0             D  127.0.0.1       GigabitEthernet<span>0/1/0</span>
     172.21.1.0/24  OSPF    10   2             D  172.20.1.2      GigabitEthernet<span>0/1/0</span>
      127.0.0.0/8   Direct  0    0             D  127.0.0.1       InLoopBack0
      127.0.0.1/32  Direct  0    0             D  127.0.0.1       InLoopBack0
127.255.255.255/32  Direct  0    0             D  127.0.0.1       InLoopBack0
255.255.255.255/32  Direct  0    0             D  127.0.0.1       InLoopBack0</pre>
</p></li><li><span>Configure tunnel interfaces.</span><p><p># Configure <span class="keyword">Device</span>A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A]<strong> interface GigabitEthernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/0</span>]<strong> binding tunnel gre</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/0</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A]<strong> interface tunnel 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-Tunnel1]<strong> tunnel-protocol gre</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-Tunnel1]<strong> ip address 172.22.1.1 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-Tunnel1]<strong> source 172.20.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-Tunnel1]<strong> destination 172.21.1.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-Tunnel1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
<p># Configure <span class="keyword">Device</span>C.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C]<strong> interface GigabitEthernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C-GigabitEthernet<span>0/1/0</span>]<strong> binding tunnel gre</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-GigabitEthernet<span>0/1/0</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C-GigabitEthernet<span>0/1/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C]<strong> interface tunnel 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-Tunnel1]<strong> tunnel-protocol gre</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-Tunnel1]<strong> ip address 172.22.1.2 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-Tunnel1]<strong> source 172.21.1.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-Tunnel1]<strong> destination 172.20.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-Tunnel1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C] <strong>commit</strong></pre>
<p>After the configuration is complete, the tunnel interfaces go up and can ping each other.</p>
<p># The following example uses the command output on <span class="keyword">Device</span>A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A]<strong> ping -a 172.22.1.1 172.22.1.2</strong></pre>
<pre class="screen">  PING 172.22.1.2: 56  data bytes, press CTRL_C to break</pre>
<pre class="screen">    Reply from 172.22.1.2: bytes=56 Sequence=1 ttl=255 time=24 ms</pre>
<pre class="screen">    Reply from 172.22.1.2: bytes=56 Sequence=2 ttl=255 time=33 ms</pre>
<pre class="screen">    Reply from 172.22.1.2: bytes=56 Sequence=3 ttl=255 time=48 ms</pre>
<pre class="screen">    Reply from 172.22.1.2: bytes=56 Sequence=4 ttl=255 time=33 ms</pre>
<pre class="screen">    Reply from 172.22.1.2: bytes=56 Sequence=5 ttl=255 time=36 ms</pre>
<pre class="screen">  --- 172.22.1.2 ping statistics ---</pre>
<pre class="screen">    5 packet(s) transmitted</pre>
<pre class="screen">    5 packet(s) received</pre>
<pre class="screen">    0.00% packet loss</pre>
<pre class="screen">    round-trip min/avg/max = 24/34/48 ms</pre>
</p></li><li><span>Configure static routes.</span><p><p># Configure <span class="keyword">Device</span>A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A]<strong> ip route-static 10.2.1.0 255.255.255.0 tunnel1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
<p># Configure <span class="keyword">Device</span>C.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C]<strong> ip route-static 10.1.1.0 255.255.255.0 tunnel1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C] <strong>commit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p>After the configuration is complete, run the <strong>display</strong> <strong>ip routing-table</strong> command on <span class="keyword">Device</span>A and <span class="keyword">Device</span>C. The command output shows the static route from the local tunnel interface to the user-side network segment of the peer.</p>
<p># The following example uses the command output on <span class="keyword">Device</span>A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A]<strong> display ip routing-table</strong></pre>
<pre class="screen"><span class="keyword">Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route</span>
------------------------------------------------------------------------------
Routing Table : _public_
         Destinations : 15       Routes : 15

Destination/Mask    Proto   Pre  Cost        Flags NextHop         Interface

       10.1.1.0/24  Direct  0    0             D  10.1.1.2        GigabitEthernet<span>0/2/0</span>
       10.1.1.2/32  Direct  0    0             D  127.0.0.1       GigabitEthernet<span>0/2/0</span>
     10.1.1.255/32  Direct  0    0             D  127.0.0.1       GigabitEthernet<span>0/2/0</span>
    <strong>10.2.1.0/24</strong>  <strong>Static</strong>  <strong>60</strong>   <strong>0</strong>           <strong>D</strong> <strong> 172.22.1.1</strong>       <strong>Tunnel1</strong>
     172.20.1.0/24  Direct  0    0             D  172.20.1.1      GigabitEthernet<span>0/1/0</span>
     172.20.1.1/32  Direct  0    0             D  127.0.0.1       GigabitEthernet<span>0/1/0</span>
   172.20.1.255/32  Direct  0    0             D  127.0.0.1       GigabitEthernet<span>0/1/0</span>
     172.21.1.0/24  OSPF    10   2             D  172.20.1.2      GigabitEthernet<span>0/1/0</span>
     172.22.1.0/24  Direct  0    0             D  172.22.1.1      Tunnel1
     172.22.1.1/32  Direct  0    0             D  127.0.0.1       Tunnel1
   172.22.1.255/32  Direct  0    0             D  127.0.0.1       Tunnel1
      127.0.0.0/8   Direct  0    0             D  127.0.0.1       InLoopBack0
      127.0.0.1/32  Direct  0    0             D  127.0.0.1       InLoopBack0
127.255.255.255/32  Direct  0    0             D  127.0.0.1       InLoopBack0
255.255.255.255/32  Direct  0    0             D  127.0.0.1       InLoopBack0</pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172369095__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p><span class="keyword">Device</span>A configuration file</p>
<pre class="screen">#
sysname <span class="keyword">Device</span>A
#
interface GigabitEthernet <span>0/1/0</span>
 undo shutdown
 ip address 172.20.1.1 255.255.255.0
 binding tunnel gre
#
interface GigabitEthernet <span>0/2/0</span>
 undo shutdown
 ip address 10.1.1.2 255.255.255.0
#
interface Tunnel1
 ip address 172.22.1.1 255.255.255.0
 tunnel-protocol gre
 source 172.20.1.1
 destination 172.21.1.2
#
ospf 1
 area 0.0.0.0
  network 172.20.1.0 0.0.0.255
#
ip route-static 10.2.1.0 255.255.255.0 Tunnel1
#
return</pre>
</li><li><p><span class="keyword">Device</span>B configuration file</p>
<pre class="screen">#
sysname <span class="keyword">Device</span>B
#
interface GigabitEthernet <span>0/1/0</span>
 undo shutdown
 ip address 172.20.1.2 255.255.255.0
#
interface GigabitEthernet <span>0/2/0</span>
 undo shutdown
 ip address 172.21.1.1 255.255.255.0
#
ospf 1
 area 0.0.0.0
  network 172.20.1.0 0.0.0.255
  network 172.21.1.0 0.0.0.255
#
return</pre>
</li><li><p><span class="keyword">Device</span>C configuration file</p>
<pre class="screen">#
sysname <span class="keyword">Device</span>C
#
interface GigabitEthernet <span>0/1/0</span>
 undo shutdown
 ip address 172.21.1.2 255.255.255.0
 binding tunnel gre
#
interface GigabitEthernet <span>0/2/0</span>
 undo shutdown
 ip address 10.2.1.2 255.255.255.0
#
interface Tunnel1
 ip address 172.22.1.2 255.255.255.0
 tunnel-protocol gre
 source 172.21.1.2
 destination 172.20.1.1
#
ospf 1
 area 0.0.0.0
 network 172.21.1.0 0.0.0.255
#
ip route-static 10.1.1.0 255.255.255.0 Tunnel1
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_gre_cfg_2020.html">Configuration Examples for GRE
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_gre_cfg_2039.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>