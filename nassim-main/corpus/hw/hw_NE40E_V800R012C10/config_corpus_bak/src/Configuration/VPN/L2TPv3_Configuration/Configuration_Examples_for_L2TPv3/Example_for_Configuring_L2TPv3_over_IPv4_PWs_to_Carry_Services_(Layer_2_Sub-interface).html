
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring L2TPv3 over IPv4 PWs to Carry Services (Layer 2 Sub-interface)">
<meta name="abstract" content="An L2TPv3 PW supports multiple types of services and processes each differently.">
<meta name="description" content="An L2TPv3 PW supports multiple types of services and processes each differently.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2tpv3_cfg_000010.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2tpv3_cfg_000011.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2tpv3_cfg_000012.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,l2tpv3,w00556928,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="L2TPv3">
<meta name="featuretype" content="VPN">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="L2TPv3">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="L2TPv3">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="L2TPv3">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="l00415692">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00415692">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172369204">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>Example for Configuring L2TPv3 over IPv4 PWs to Carry Services (Layer 2 Sub-interface)</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172369204"></a><a name="EN-US_TASK_0172369204"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring L2TPv3 over IPv4 PWs to Carry Services<span> (Layer 2 Sub-interface)</span></h1>
<div class="taskbody"><p>An L2TPv3 PW supports multiple types of services and processes each differently.</p>
<div class="context"><a name="EN-US_TASK_0172369204__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><div class="p">On the network shown in <a href="#EN-US_TASK_0172369204__fig_037FBC9D">Figure 1</a>, an L2TPv3 PW needs to be established between PE1 and PE2, and another between PE1 and PE3. The L2TPv3 PW between PE1 and PE2 needs to support service access in S-tag+C-tag termination mode, and that between PE1 and PE3 needs to support service access in whole-interface mode. The AC interfaces of the two PWs need to be EVC Layer 2 sub-interfaces. A VLAN service needs to be configured on CEs.<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>An L2TPv3 PW supports the following service access modes: whole-interface, C-tag termination, S-tag termination, and S-tag+C-tag termination. The service encapsulation configurations vary according to service access modes, but the L2TPv3 PW configurations for different service access modes are similar. This configuration example uses the C-tag termination mode and whole-interface mode.</p>
</div></div>
<div class="fignone" id="EN-US_TASK_0172369204__fig_037FBC9D"><a name="EN-US_TASK_0172369204__fig_037FBC9D"></a><a name="fig_037FBC9D"></a><span class="figcap"><b>Figure 1 </b>L2TPv3 PW networking</span><br><span><img class="vsd" src="images/fig_dc_vrp_l2tpv3_cfg_00001102.png"></span></div>
</div>

<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" frame="border" border="1" rules="all"><thead align="left"><tr><th align="left" class="cellrowborder" char="." valign="top" width="9.33093309330933%" id="mcps1.4.1.3.1.4.1.1" liSelected="liSelected"><p>Device</p>
</th>
<th align="left" class="cellrowborder" char="." valign="top" width="69.33693369336935%" id="mcps1.4.1.3.1.4.1.2" liSelected="liSelected"><p>Interface</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="21.33213321332133%" id="mcps1.4.1.3.1.4.1.3" liSelected="liSelected"><p>IP Address</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" char="." valign="top" width="9.33093309330933%" headers="mcps1.4.1.3.1.4.1.1 "><p>CE1</p>
</td>
<td class="cellrowborder" char="." valign="top" width="69.33693369336935%" headers="mcps1.4.1.3.1.4.1.2 "><p>GE<span>0/1/1</span></p>
</td>
<td class="cellrowborder" valign="top" width="21.33213321332133%" headers="mcps1.4.1.3.1.4.1.3 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" width="9.33093309330933%" headers="mcps1.4.1.3.1.4.1.1 "><p>CE2</p>
</td>
<td class="cellrowborder" char="." valign="top" width="69.33693369336935%" headers="mcps1.4.1.3.1.4.1.2 "><p>GE<span>0/1/1</span></p>
</td>
<td class="cellrowborder" valign="top" width="21.33213321332133%" headers="mcps1.4.1.3.1.4.1.3 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" width="9.33093309330933%" headers="mcps1.4.1.3.1.4.1.1 "><p>CE3</p>
</td>
<td class="cellrowborder" char="." valign="top" width="69.33693369336935%" headers="mcps1.4.1.3.1.4.1.2 "><p>GE<span>0/1/1</span></p>
</td>
<td class="cellrowborder" valign="top" width="21.33213321332133%" headers="mcps1.4.1.3.1.4.1.3 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="6" char="." valign="top" width="9.33093309330933%" headers="mcps1.4.1.3.1.4.1.1 "><p>PE1</p>
</td>
<td class="cellrowborder" char="." valign="top" width="69.33693369336935%" headers="mcps1.4.1.3.1.4.1.2 "><p>GE<span>0/1/1</span>.4</p>
</td>
<td class="cellrowborder" valign="top" width="21.33213321332133%" headers="mcps1.4.1.3.1.4.1.3 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.3.1.4.1.2 "><p>GE<span>0/1/0</span>.4</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.3.1.4.1.3 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.3.1.4.1.2 "><p>Loopback2</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.3.1.4.1.3 "><p>1.1.1.1/32</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.3.1.4.1.2 "><p>Loopback3</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.3.1.4.1.3 "><p>2.2.2.2/32</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.3.1.4.1.2 "><p>GE<span>0/2/1</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.3.1.4.1.3 "><p>192.168.14.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.3.1.4.1.2 "><p>GE<span>0/3/1</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.3.1.4.1.3 "><p>192.168.24.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="3" char="." valign="top" width="9.33093309330933%" headers="mcps1.4.1.3.1.4.1.1 "><p>PE2</p>
</td>
<td class="cellrowborder" char="." valign="top" width="69.33693369336935%" headers="mcps1.4.1.3.1.4.1.2 "><p>Loopback4</p>
</td>
<td class="cellrowborder" valign="top" width="21.33213321332133%" headers="mcps1.4.1.3.1.4.1.3 "><p>3.3.3.3/32</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.3.1.4.1.2 "><p>GE<span>0/2/1</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.3.1.4.1.3 "><p>192.168.14.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.3.1.4.1.2 "><p>GE<span>0/1/1</span>.4</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.3.1.4.1.3 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="3" char="." valign="top" width="9.33093309330933%" headers="mcps1.4.1.3.1.4.1.1 "><p>PE3</p>
</td>
<td class="cellrowborder" valign="top" width="69.33693369336935%" headers="mcps1.4.1.3.1.4.1.2 "><p>Loopback5</p>
</td>
<td class="cellrowborder" valign="top" width="21.33213321332133%" headers="mcps1.4.1.3.1.4.1.3 "><p>4.4.4.4/32</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.3.1.4.1.2 "><p>GE<span>0/2/1</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.3.1.4.1.3 "><p>192.168.24.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.3.1.4.1.2 "><p>GE<span>0/1/1</span>.4</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.3.1.4.1.3 "><p>-</p>
</td>
</tr>
</tbody>
</table>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172369204__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure IS-IS on PEs.</p>
</li><li><p>Configure a VLAN service on CEs.</p>
</li><li><p>Enable L2TPv3 on PE1, PE2, and PE3.</p>
</li><li><p>Establish an L2TPv3 PW between PE1 and PE2 and another between PE1 and PE3, configure source and destination addresses and cookies for the PWs, and bind the PWs to service instances. Note that cookies need to be configured using the SHA256 algorithm.</p>
</li><li><p>Configure services on PE1, PE2, and PE3 to access L2TPv3 PWs.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172369204__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li>IS-IS process IDs on PEs</li><li>VLAN IDs on CEs</li><li><p>Source interfaces, source addresses, and destination addresses of L2TPv3 PWs</p>
</li><li><p>Cookies for L2TPv3 PWs</p>
</li><li><p>Service access types of L2TPv3 PWs</p>
</li><li><p>IDs of service instances to which L2TPv3 PWs are to be bound</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172369204__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure IS-IS on PEs.</span><p><div class="p"># Configure PE1.<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname PE1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>cost-style wide</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>network-entity 10.0000.0000.0002.00</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface loopback 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-loopback2] <strong>ip address 1.1.1.1 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-loopback2] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-loopback2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet<span>0/2/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Gigabitethernet<span>0/2/1</span>] <strong>ip address 192.168.14.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Gigabitethernet<span>0/2/1</span>] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Gigabitethernet<span>0/2/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface loopback 3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-loopback3] <strong>ip address 2.2.2.2 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-loopback3] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-loopback3] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet<span>0/3/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Gigabitethernet<span>0/3/1</span>] <strong>ip address 192.168.24.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Gigabitethernet<span>0/3/1</span>] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Gigabitethernet<span>0/3/1</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-Gigabitethernet<span>0/3/1</span>] <strong>quit</strong></pre>
</div>
</p><p><div class="p"># Configure PE2.<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname PE2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1] <strong>cost-style wide</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1] <strong>network-entity 10.0000.0000.0003.00</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface loopback 4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-loopback4] <strong>ip address 3.3.3.3 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-loopback4] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-loopback4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface gigabitethernet<span>0/2/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Gigabitethernet<span>0/2/1</span>] <strong>ip address 192.168.14.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Gigabitethernet<span>0/2/1</span>] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Gigabitethernet<span>0/2/1</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-Gigabitethernet<span>0/2/1</span>] <strong>quit</strong></pre>
</div>
</p><p><div class="p"># Configure PE3.<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname PE3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-isis-1] <strong>cost-style wide</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-isis-1] <strong>network-entity 10.0000.0000.0004.00</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>interface loopback 5</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-loopback5] <strong>ip address 4.4.4.4 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-loopback5] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-loopback5] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>interface gigabitethernet<span>0/2/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Gigabitethernet<span>0/2/1</span>] <strong>ip address 192.168.24.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Gigabitethernet<span>0/2/1</span>] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Gigabitethernet<span>0/2/1</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3-Gigabitethernet<span>0/2/1</span>] <strong>quit</strong></pre>
</div>
</p></li><li><span>Configure a VLAN service on CE1.</span><p><pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname CE1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>vlan 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-vlan2] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1-vlan2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1-GigabitEthernet<span>0/1/1</span>] <strong>portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/1</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/1</span>] <strong>port link-type trunk</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/1</span>] <strong>port trunk allow-pass vlan 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>commit</strong></pre>
</p></li><li><span>Enable L2TPv3 on PEs.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>l2tpv3 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>l2tpv3 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>l2tpv3 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
</p></li><li><span>Configure services on PE1 and PE2 to access L2TPv3 PWs in C-tag termination mode.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface gigabitethernet<span>0/1/1</span>.4 mode l2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Gigabitethernet<span>0/1/1</span>.4] <strong>encapsulation dot1q vid 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Gigabitethernet<span>0/1/1</span>.4] <strong>rewrite pop single</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Gigabitethernet<span>0/1/1</span>.4] <strong>commit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>To configure services on PE1 to access an L2TPv3 PW in whole-interface mode, run the following commands:</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface gigabitethernet<span>0/1/1</span>.4 mode l2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Gigabitethernet<span>0/1/1</span>.4] <strong>encapsulation default</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Gigabitethernet<span>0/1/1</span>.4] <strong>commit</strong></pre>
<p>To configure services on PE1 to access an L2TPv3 PW in C-tag termination mode, run the following commands:</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface gigabitethernet<span>0/1/1</span>.4 mode l2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Gigabitethernet<span>0/1/1</span>.4] <strong>encapsulation dot1q vid 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Gigabitethernet<span>0/1/1</span>.4] <strong>rewrite pop single</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Gigabitethernet<span>0/1/1</span>.4] <strong>commit</strong></pre>
<p>To configure services on PE1 to access an L2TPv3 PW in S-tag termination mode, run the following commands:</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface gigabitethernet<span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Gigabitethernet<span>0/1/1</span>] <strong>qinq protocol 88a8</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Gigabitethernet<span>0/1/1</span>] <strong>interface gigabitethernet<span>0/1/1</span>.4 mode l2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Gigabitethernet<span>0/1/1</span>.4] <strong>encapsulation dot1q vid 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Gigabitethernet<span>0/1/1</span>.4] <strong>rewrite pop single</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Gigabitethernet<span>0/1/1</span>.4] <strong>commit</strong></pre>
<p>To configure services on PE1 to access an L2TPv3 PW in S-tag+C-tag termination mode, run the following commands:</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface gigabitethernet<span>0/1/1</span>.4 mode l2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Gigabitethernet<span>0/1/1</span>.4] <strong>encapsulation qinq vid 2 ce-vid 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Gigabitethernet<span>0/1/1</span>.4] <strong>rewrite pop double</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Gigabitethernet<span>0/1/1</span>.4] <strong>commit</strong></pre>
</div></div>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface gigabitethernet<span>0/1/1</span>.4 mode l2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Gigabitethernet<span>0/1/1</span>.4] <strong>encapsulation dot1q vid 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Gigabitethernet<span>0/1/1</span>.4] <strong>rewrite pop single</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Gigabitethernet<span>0/1/1</span>.4] <strong>commit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>To configure services on PE2 to access an L2TPv3 PW in whole-interface mode, run the following commands:</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>interface gigabitethernet<span>0/1/1</span>.4 mode l2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Gigabitethernet<span>0/1/1</span>.4] <strong>encapsulation default</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Gigabitethernet<span>0/1/1</span>.4] <strong>commit</strong></pre>
<p>To configure services on PE2 to access an L2TPv3 PW in C-tag termination mode, run the following commands:</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>interface gigabitethernet<span>0/1/1</span>.4 mode l2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Gigabitethernet<span>0/1/1</span>.4] <strong>encapsulation dot1q vid 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Gigabitethernet<span>0/1/1</span>.4] <strong>rewrite pop single</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Gigabitethernet<span>0/1/1</span>.4] <strong>commit</strong></pre>
<p>To configure services on PE2 to access an L2TPv3 PW in S-tag termination mode, run the following commands:</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>interface gigabitethernet<span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Gigabitethernet<span>0/1/1</span>] <strong>qinq protocol 88a8</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Gigabitethernet<span>0/1/1</span>] <strong>interface gigabitethernet<span>0/1/1</span>.4 mode l2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Gigabitethernet<span>0/1/1</span>.4] <strong>encapsulation dot1q vid 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Gigabitethernet<span>0/1/1</span>.4] <strong>rewrite pop single</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Gigabitethernet<span>0/1/1</span>.4] <strong>commit</strong></pre>
<p>To configure services on PE2 to access an L2TPv3 PW in S-tag+C-tag termination mode, run the following commands:</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>interface gigabitethernet<span>0/1/1</span>.4 mode l2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Gigabitethernet<span>0/1/1</span>.4] <strong>encapsulation qinq vid 2 ce-vid 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Gigabitethernet<span>0/1/1</span>.4] <strong>rewrite pop double</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Gigabitethernet<span>0/1/1</span>.4] <strong>commit</strong></pre>
</div></div>
</p></li><li><span>Configure an L2TPv3 PW from PE1 to PE2.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>l2tpv3 pw pwabc</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-l2tpv3-pw-pwabc] <strong>source interface LoopBack 2 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-l2tpv3-pw-pwabc] <strong>destination 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-l2tpv3-pw-pwabc] <strong>l2tpv3 local cookie key cipher XTEOWSS-1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-l2tpv3-pw-pwabc] <strong>l2tpv3 remote cookie key cipher XTEOWSS-1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-l2tpv3-pw-pwabc] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet<span>0/1/1</span>.4 mode l2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Gigabitethernet<span>0/1/1</span>.4] <strong>l2tpv3 instance a123</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Gigabitethernet<span>0/1/1</span>.4-l2tpv3-instance-a123] <strong>l2tpv3 static binding pw pwabc</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Gigabitethernet<span>0/1/1</span>.4-l2tpv3-instance-a123] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-Gigabitethernet<span>0/1/1</span>.4-l2tpv3-instance-a123] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-Gigabitethernet<span>0/1/1</span>.4] <strong>quit</strong></pre>
</p></li><li><span>Configure an L2TPv3 PW from PE2 to PE1.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>l2tpv3 pw pwabc</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-l2tpv3-pw-pwabc] <strong>source interface loopback 4 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-l2tpv3-pw-pwabc] <strong>destination 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-l2tpv3-pw-pwabc] <strong>l2tpv3 local cookie key cipher XTEOWSS-1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-l2tpv3-pw-pwabc] <strong>l2tpv3 remote cookie key cipher XTEOWSS-1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-l2tpv3-pw-pwabc] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface gigabitethernet<span>0/1/1</span>.4 mode l2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Gigabitethernet<span>0/1/1</span>.4] <strong>l2tpv3 instance a234</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Gigabitethernet<span>0/1/1</span>.4-l2tpv3-instance-a234] <strong>l2tpv3 static binding pw pwabc</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Gigabitethernet<span>0/1/1</span>.4-l2tpv3-instance-a234] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-Gigabitethernet<span>0/1/1</span>.4-l2tpv3-instance-a234] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-Gigabitethernet<span>0/1/1</span>.4] <strong>quit</strong></pre>
</p></li><li><span>Configure CE2.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2-GigabitEthernet<span>0/1/1</span>] <strong>portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>] <strong>port link-type trunk</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>] <strong>port trunk allow-pass vlan 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>commit</strong></pre>
</p></li><li><span>Configure services on PE1 and PE3 to access L2TPv3 PWs in whole-interface mode.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet<span>0/1/0</span>.4 mode l2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Gigabitethernet<span>0/1/0</span>.4] <strong>encapsulation default</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Gigabitethernet<span>0/1/0</span>.4] <strong>commit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>To configure services on PE1 to access an L2TPv3 PW in S-tag+C-tag termination mode, run the following commands:</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface gigabitethernet<span>0/1/0</span>.4 mode l2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Gigabitethernet<span>0/1/0</span>.4] <strong>encapsulation qinq vid 2 ce-vid 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Gigabitethernet<span>0/1/0</span>.4] <strong>rewrite pop double</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Gigabitethernet<span>0/1/0</span>.4] <strong>commit</strong></pre>
<p>To configure services on PE1 to access an L2TPv3 PW in C-tag termination mode, run the following commands:</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface gigabitethernet<span>0/1/0</span>.4 mode l2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Gigabitethernet<span>0/1/0</span>.4] <strong>encapsulation dot1q vid 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Gigabitethernet<span>0/1/0</span>.4] <strong>rewrite pop single</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Gigabitethernet<span>0/1/0</span>.4] <strong>commit</strong></pre>
<p>To configure services on PE1 to access an L2TPv3 PW in S-tag termination mode, run the following commands:</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Gigabitethernet<span>0/1/0</span>] <strong>qinq protocol 88a8</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Gigabitethernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet<span>0/1/0</span>.4 mode l2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Gigabitethernet<span>0/1/0</span>.4] <strong>encapsulation dot1q vid 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Gigabitethernet<span>0/1/0</span>.4] <strong>rewrite pop single</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Gigabitethernet<span>0/1/0</span>.4] <strong>commit</strong></pre>
</div></div>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>interface gigabitethernet<span>0/1/1</span>.4 mode l2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Gigabitethernet<span>0/1/1</span>.4] <strong>encapsulation default</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Gigabitethernet<span>0/1/1</span>.4] <strong>commit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>To configure services on PE3 to access an L2TPv3 PW in S-tag+C-tag termination mode, run the following commands:</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>interface gigabitethernet<span>0/1/1</span>.4 mode l2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Gigabitethernet<span>0/1/1</span>.4] <strong>encapsulation qinq vid 2 ce-vid 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Gigabitethernet<span>0/1/1</span>.4] <strong>rewrite pop double</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Gigabitethernet<span>0/1/1</span>.4] <strong>commit</strong></pre>
<p>To configure services on PE3 to access an L2TPv3 PW in C-tag termination mode, run the following commands:</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>interface gigabitethernet<span>0/1/1</span>.4 mode l2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Gigabitethernet<span>0/1/1</span>.4] <strong>encapsulation dot1q vid 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Gigabitethernet<span>0/1/1</span>.4] <strong>rewrite pop single</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Gigabitethernet<span>0/1/1</span>.4] <strong>commit</strong></pre>
<p>To configure services on PE3 to access an L2TPv3 PW in S-tag termination mode, run the following commands:</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>interface gigabitethernet<span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Gigabitethernet<span>0/1/1</span>] <strong>qinq protocol 88a8</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Gigabitethernet<span>0/1/1</span>] <strong>interface gigabitethernet<span>0/1/1</span>.4 mode l2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Gigabitethernet<span>0/1/1</span>.4] <strong>encapsulation dot1q vid 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Gigabitethernet<span>0/1/1</span>.4] <strong>rewrite pop single</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Gigabitethernet<span>0/1/1</span>.4] <strong>commit</strong></pre>
</div></div>
</p></li><li><span>Configure an L2TPv3 PW from PE1 to PE3.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>l2tpv3 pw pwabc1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-l2tpv3-pw-pwabc1] <strong>l2tpv3 local session-id 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-l2tpv3-pw-pwabc1] <strong>source interface LoopBack 3 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-l2tpv3-pw-pwabc1] <strong>destination 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-l2tpv3-pw-pwabc1] <strong>l2tpv3 local cookie key cipher XTEOWSS-1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-l2tpv3-pw-pwabc1] <strong>l2tpv3 remote cookie key cipher XTEOWSS-1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-l2tpv3-pw-pwabc1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet<span>0/1/0</span>.4 mode l2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Gigabitethernet<span>0/1/0</span>.4] <strong>l2tpv3 instance a345</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Gigabitethernet<span>0/1/0</span>.4-l2tpv3-instance-a345] <strong>l2tpv3 static binding pw pwabc1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Gigabitethernet<span>0/1/0</span>.4-l2tpv3-instance-a345] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-Gigabitethernet<span>0/1/0</span>.4-l2tpv3-instance-a345] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-Gigabitethernet<span>0/1/0</span>.4] <strong>quit</strong></pre>
</p></li><li><span>Configure an L2TPv3 PW from PE3 to PE1.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>l2tpv3 pw pwabc1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-l2tpv3-pw-pwabc1] <strong>l2tpv3 remote session-id 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-l2tpv3-pw-pwabc1] <strong>source interface loopback 5 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-l2tpv3-pw-pwabc1] <strong>destination 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-l2tpv3-pw-pwabc1] <strong>l2tpv3 local cookie key cipher XTEOWSS-1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-l2tpv3-pw-pwabc1] <strong>l2tpv3 remote cookie key cipher XTEOWSS-1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-l2tpv3-pw-pwabc1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>interface gigabitethernet<span>0/1/1</span>.4 mode l2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Gigabitethernet<span>0/1/1</span>.4] <strong>l2tpv3 instance a456</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Gigabitethernet<span>0/1/1</span>.4-l2tpv3-instance-a456] <strong>l2tpv3 static binding pw pwabc1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Gigabitethernet<span>0/1/1</span>.4-l2tpv3-instance-a456] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3-Gigabitethernet<span>0/1/1</span>.4-l2tpv3-instance-a456] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3-Gigabitethernet<span>0/1/1</span>.4] <strong>quit</strong></pre>
</p></li><li><span>Configure CE3.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE3] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE3-GigabitEthernet<span>0/1/1</span>] <strong>portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-GigabitEthernet<span>0/1/1</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-GigabitEthernet<span>0/1/1</span>] <strong>port link-type trunk</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-GigabitEthernet<span>0/1/1</span>] <strong>port trunk allow-pass vlan 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3] <strong>commit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p>After the configuration is complete, run the <strong>display l2tpv3 pw</strong> command to check tunnel status. If <strong>Tunnel State</strong> is displayed as <strong>up</strong>, the L2TPv3 PWs are successfully configured.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display l2tpv3 pw pwabc</strong>
 Tunnel Name                   : pwabc
 Client interface              : GigabitEthernet<span>0/1/1</span>.4 
 Tunnel State                  : <strong>up</strong>
 Source Interface              : LoopBack2
 Source Address                : 1.1.1.1
 Destination Address           : 3.3.3.3
 Local Session ID              : 4294967295
 Remote Session ID             : 4294967295</pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display l2tpv3 pw pwabc1</strong>
 Tunnel Name                   : pwabc1
 Client interface              : GigabitEthernet<span>0/1/1</span>.4 
 Tunnel State                  : <strong>up</strong>
 Source Interface              : LoopBack3
 Source Address                : 2.2.2.2
 Destination Address           : 4.4.4.4
 Local Session ID              : 10
 Remote Session ID             : 4294967295</pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172369204__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>CE1 configuration file</p>
<pre class="screen">#
sysname CE1
#
vlan 2
#
interface GigabitEthernet<span>0/1/1</span>
 portswitch
 undo shutdown
 port link-type trunk
 port trunk allow-pass vlan 2
#
return</pre>
</li><li><p>PE1 configuration file</p>
<pre class="screen">#
sysname PE1
#
isis 1
 cost-style wide
 network-entity 10.0000.0000.0002.00
#
interface loopback 2
 ip address 1.1.1.1 32
 isis enable 1
#
interface loopback 3
ip address 2.2.2.2 32
 isis enable 1
#
interface gigabitethernet<span>0/2/1</span>
 ip address 192.168.14.1 24
 isis enable 1
#
interface gigabitethernet<span>0/3/1</span>
 ip address 192.168.24.1 24
 isis enable 1
#
l2tpv3 enable
#
l2tpv3 pw pwabc
 source interface LoopBack 2 1.1.1.1
 destination 3.3.3.3
 l2tpv3 local cookie key cipher %#%#1"*U8`%XqIko*T4Kj"}/8.j!Ge-"<font style="font-size:8pt" Face="Courier New" >~</font>KlLv=&lt;!p(!-%#%#
 l2tpv3 remote cookie key cipher %#%#ZM`lUZ0(E$diG3OR%[U&amp;Z_3!GBp&gt;24#caX%uAn^D%#%#
#
l2tpv3 pw pwabc1
 l2tpv3 local session-id 10
 source interface LoopBack 3 2.2.2.2
 destination 4.4.4.4
 l2tpv3 local cookie key cipher %#%#uOIwFI,!_&lt;-$&amp;.)+{Lq#zoI.OAoao+c$I3=huT&gt;:%#%#
 l2tpv3 remote cookie key cipher %#%#&gt;nJTCLh0U*#U%jF@i'0LqO}*JZYL]Mq=M($'&amp;}KL%#%#
#
interface Gigabitethernet<span>0/1/1</span>.4 mode l2
 encapsulation dot1q vid 2
 rewrite pop single
 l2tpv3 instance a123
  l2tpv3 static binding pw pwabc
#
interface Gigabitethernet<span>0/1/0</span>.4 mode l2
 encapsulation default
 l2tpv3 instance a345
  l2tpv3 static binding pw pwabc1
#
</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#
sysname PE2
#
isis 1
 cost-style wide
 network-entity 10.0000.0000.0003.00
#
interface loopback 4
 ip address 3.3.3.3 32
 isis enable 1
#
interface gigabitethernet<span>0/2/1</span>
 ip address 192.168.14.2 24
 isis enable 1
#
l2tpv3 enable
#
l2tpv3 pw pwabc
 source interface LoopBack 4 3.3.3.3
 destination 1.1.1.1
 l2tpv3 local cookie key cipher %#%#M;2^%B|jX,Ss!DM\]dc:Y45_!URg&gt;4M2/058ub+=%#%#
 l2tpv3 remote cookie key cipher %#%#8u.iEnZN^1Xj`ZS@S|@55%.3LN3=r)I_o{W<font style="font-size:8pt" Face="Courier New" >~</font>R8V"%#%#
#
interface GigabitEthernet<span>0/1/1</span>.4 mode l2
 encapsulation dot1q vid 2
 rewrite pop single
 l2tpv3 instance a234
  l2tpv3 static binding pw pwabc
#
</pre>
</li><li><p>CE2 configuration file</p>
<pre class="screen">#
sysname CE2
#
interface GigabitEthernet<span>0/1/1</span>
 portswitch
 undo shutdown
 port link-type trunk
 port trunk allow-pass vlan 2
#
return</pre>
</li><li><p>PE3 configuration file</p>
<pre class="screen">#
sysname PE3
#
isis 1
 cost-style wide
 network-entity 10.0000.0000.0004.00
#
interface loopback 5
 ip address 4.4.4.4 32
 isis enable 1
#
interface gigabitethernet<span>0/2/1</span>
 ip address 192.168.24.2 24
 isis enable 1
#
l2tpv3 enable
#
l2tpv3 pw pwabc1
 l2tpv3 remote session-id 10
 source interface LoopBack 5 4.4.4.4
 destination 2.2.2.2
 l2tpv3 local cookie key cipher %#%#8Hj5Wwpi80&amp;\BuS&lt;)1g1vscEDe\9gX-CVR$rGsYS%#%#
 l2tpv3 remote cookie key cipher %#%#6v3(+'}M%Cn]3'&gt;g\&gt;v$1,h`LfZ'AV,JoI.-%I,Q%#%#
#
interface Gigabitethernet<span>0/1/1</span>.4 mode l2
 encapsulation default
 l2tpv3 instance a456
  l2tpv3 static binding pw pwabc1
#
</pre>
</li><li><p>CE3 configuration file</p>
<pre class="screen">#
sysname CE3
#
interface GigabitEthernet<span>0/1/1</span>
 portswitch
 undo shutdown
 port link-type trunk
 port trunk allow-pass vlan 2
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2tpv3_cfg_000010.html">Configuration Examples for L2TPv3
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2tpv3_cfg_000011.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2tpv3_cfg_000012.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>