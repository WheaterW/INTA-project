
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Dual-Homing Active-Active EVPN VPLS over MPLS (VLAN-Aware Access)">
<meta name="abstract" content="The VLAN-aware mode allows different VLANs configured on different physical interfaces to access the same EVPN instance while ensuring that traffic from these VLANs remains isolated.">
<meta name="description" content="The VLAN-aware mode allows different VLANs configured on different physical interfaces to access the same EVPN instance while ensuring that traffic from these VLANs remains isolated.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0010.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0025-new.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0026-new.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="p00915595,w00800033,w00556928,l00468467,w00606909,evpnvrp,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="p00915595">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00878323">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172370639">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring Dual-Homing Active-Active EVPN VPLS over MPLS (VLAN-Aware Access)</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172370639"></a><a name="EN-US_TASK_0172370639"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Dual-Homing Active-Active EVPN VPLS over MPLS (VLAN-Aware Access)</h1>
<div class="taskbody"><p>The VLAN-aware mode allows different VLANs configured on different physical interfaces to access the same EVPN instance while ensuring that traffic from these VLANs remains isolated.</p>
<div class="context"><a name="EN-US_TASK_0172370639__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0172370639__fig_dc_vrp_evpn_cfg_006601">Figure 1</a>, Layer 2 traffic is transmitted within Site1 and Site2. To allow Site1 and Site2 to communicate at Layer 2 over the backbone network, configure EVPN functions. If sites belong to the same subnet, create an EVPN instance on each PE to store EVPN routes and implement Layer 2 forwarding based on MAC addresses. A route reflector (RR) is configured to reflect EVPN routes. To load-balance unicast traffic destined for CE1 between PE1 and PE2, configure PE1 and PE2 to use Eth-Trunk sub-interfaces to connect to Site1. To allow different VLANs configured on different physical interfaces to access the same EVPN instance while ensuring that traffic from these VLANs remains isolated, configure the CE to access PEs in VLAN-aware mode.</p>
<div class="fignone" id="EN-US_TASK_0172370639__fig_dc_vrp_evpn_cfg_006601"><a name="EN-US_TASK_0172370639__fig_dc_vrp_evpn_cfg_006601"></a><a name="fig_dc_vrp_evpn_cfg_006601"></a><span class="figcap"><b>Figure 1 </b>Configuring dual-homing active-active EVPN VPLS over MPLS (VLAN-aware access)</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 through 3 in this example represent GigabitEthernet<span>0/1/0</span>, GigabitEthernet<span>0/2/0</span>, and GigabitEthernet<span>0/3/0</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_evpn_cfg_006601.png" width="NaN" height="NaN"></span><br></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172370639__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Precautions</h4><p>During the configuration process, note the following:</p>
<ul><li><p>For the same EVPN instance, the export VPN target list of one site shares VPN targets with the import VPN target lists of the other sites. Conversely, the import VPN target list of one site shares VPN targets with the export VPN target lists of the other sites.</p>
</li><li><p>Using each PE's local loopback interface address as its EVPN source address is recommended.</p>
</li></ul>
</div></div>
<div class="context"><a name="EN-US_TASK_0172370639__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure an IGP on the backbone network to enable PEs and the RR to communicate.</p>
</li><li><p>Configure basic MPLS functions and enable MPLS LDP to establish LDP LSPs on the MPLS backbone network.</p>
</li><li><p>Create a BD EVPN instance and a BD, bind the BD to the EVPN instance, and set the BD tag on each PE.</p>
</li><li><p>Configure a source address on each PE.</p>
</li><li><p>Configure the ESI and E-Trunk for dual-homing active-active networking. The E-Trunk uses the default encryption mode <strong>enhanced-hmac-sha256</strong> for authentication.</p>
</li><li>Configure local-remote FRR for MAC routes.</li><li>On PE1 and PE2, configure one BFD session for Eth-Trunk member interface detection and another BFD session for association with the access-side Eth-Trunk interface.</li><li><p>Configure BGP EVPN peer relationships between the PEs and RR, and on the RR, specify the PEs as RR clients.</p>
</li><li><p>Configure CEs and PEs to communicate.</p>
</li><li>Configure IP addresses of the same network segment for CE1 and CE2. Then perform a ping operation on the network segment to trigger the local and remote PEs to learn CE-side MAC addresses.</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172370639__1.4.4"></a><a name="1.4.4"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>EVPN instance name: evrf1</p>
</li><li><p>EVPN instance evrf1's RDs (100:1, 200:1, and 300:1) and RTs (1:1) on each PE (PE1, PE2, and PE3)</p>
</li><li>Hold-down time on the access-side interface of each PE, which is the time elapsed before a PE waits for the EVPN service on the network side to recover and then responds after the interface goes up: 600000 ms</li><li>UDP port number for EVPN pruning status negotiation between active-active PEs: 1345</li><li>Name of the BFD session for Eth-Trunk member interface detection: PEtoCE; names of BFD sessions for association with access-side Eth-Trunk interfaces: pe1tope2 and pe2tope1</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172370639__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure interface addresses on the RR and PEs according to <a href="#EN-US_TASK_0172370639__fig_dc_vrp_evpn_cfg_006601">Figure 1</a>. For detailed configurations, see <a href="#EN-US_TASK_0172370639__file1">Configuration Files</a>.</span></li><li><span>Configure an IGP on the backbone network to enable PEs and the RR to communicate. OSPF is used as an IGP in this example.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1-area-0.0.0.0] <strong>network 10.1.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1-area-0.0.0.0] <strong>network 1.1.1.1 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1-area-0.0.0.0] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-ospf-1-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-ospf-1] <strong>quit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-1] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-1-area-0.0.0.0] <strong>network 10.2.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-1-area-0.0.0.0] <strong>network 2.2.2.2 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-1-area-0.0.0.0] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-ospf-1-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-ospf-1] <strong>quit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-ospf-1] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-ospf-1-area-0.0.0.0] <strong>network 10.3.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-ospf-1-area-0.0.0.0] <strong>network 4.4.4.4 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-ospf-1-area-0.0.0.0] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3-ospf-1-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3-ospf-1] <strong>quit</strong></pre>
<p># Configure the RR.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RR] <strong>ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-ospf-1]<strong> area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-ospf-1-area-0.0.0.0] <strong>network 10.1.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-ospf-1-area-0.0.0.0] <strong>network 10.2.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-ospf-1-area-0.0.0.0] <strong>network 10.3.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-ospf-1-area-0.0.0.0] <strong>network 3.3.3.3 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-ospf-1-area-0.0.0.0] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RR-ospf-1-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RR-ospf-1] <strong>quit</strong></pre>
<p>After the configurations are complete, PE1, PE2, and PE3 can establish OSPF neighbor relationships with the RR. Run the <strong>display ospf peer</strong> command. The command output shows that <strong>State</strong> is <strong>Full</strong>. Run the <strong>display ip routing-table</strong> command. The command output shows that the RR and PEs have learned the routes destined for each other's loopback interfaces.</p>
<p>The following example uses the command output on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display ospf peer</strong></pre>
<pre class="screen">(M) Indicates MADJ neighbor


          OSPF Process 1 with Router ID 10.1.1.1
                Neighbors

 Area 0.0.0.0 interface 10.1.1.1 (GE<span>0/2/0</span>)'s neighbors
 Router ID: 10.1.1.2             Address: 10.1.1.2         
   State: Full           Mode:Nbr is Master     Priority: 1
   DR: 10.1.1.1          BDR: 10.1.1.2          MTU: 0
   Dead timer due in  32  sec
   Retrans timer interval: 5
   Neighbor is up for 02h56m15s
   Authentication Sequence: [ 0 ]
</pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display ip routing-table</strong></pre>
<pre class="screen"><span class="keyword">Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route</span>
------------------------------------------------------------------------------
Routing Table : _public_
         Destinations : 13       Routes : 13        

Destination/Mask    Proto   Pre  Cost        Flags NextHop         Interface

        1.1.1.1/32  Direct  0    0             D   127.0.0.1       LoopBack0
        2.2.2.2/32  OSPF    10   2             D   10.1.1.2        GigabitEthernet<span>0/2/0</span>
        3.3.3.3/32  OSPF    10   1             D   10.1.1.2        GigabitEthernet<span>0/2/0</span>
        4.4.4.4/32  OSPF    10   2             D   10.1.1.2        GigabitEthernet<span>0/2/0</span>
       10.1.1.0/24  Direct  0    0             D   10.1.1.1        GigabitEthernet<span>0/2/0</span>
       10.1.1.1/32  Direct  0    0             D   127.0.0.1       GigabitEthernet<span>0/2/0</span>
     10.1.1.255/32  Direct  0    0             D   127.0.0.1       GigabitEthernet<span>0/2/0</span>
       10.2.1.0/24  OSPF    10   2             D   10.1.1.2        GigabitEthernet<span>0/2/0</span>
       10.3.1.0/24  OSPF    10   2             D   10.1.1.2        GigabitEthernet<span>0/2/0</span>
      127.0.0.0/8   Direct  0    0             D   127.0.0.1       InLoopBack0
      127.0.0.1/32  Direct  0    0             D   127.0.0.1       InLoopBack0
127.255.255.255/32  Direct  0    0             D   127.0.0.1       InLoopBack0
255.255.255.255/32  Direct  0    0             D   127.0.0.1       InLoopBack0
</pre>
</p></li><li><span>Configure basic MPLS functions and enable MPLS LDP to establish LDP LSPs on the MPLS backbone network.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>mpls lsr-id 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>mpls lsr-id 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<p># Configure the RR.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RR] <strong>mpls lsr-id 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-GigabitEthernet<span>0/1/0</span>]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR] <strong>interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-GigabitEthernet<span>0/2/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-GigabitEthernet<span>0/2/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR] <strong>interface gigabitethernet <span>0/3/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-GigabitEthernet<span>0/3/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-GigabitEthernet<span>0/3/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-GigabitEthernet<span>0/3/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RR-GigabitEthernet<span>0/3/0</span>] <strong>quit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>mpls lsr-id 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-mpls]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-mpls-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<p>After the configurations are complete, LDP sessions are established between the PEs (PE1, PE2, and PE3) and RR. Run the <strong>display mpls ldp session</strong> command. The command output shows that <strong>Status</strong> is <strong>Operational</strong>. Run the <strong>display mpls ldp lsp</strong> command. The command output shows that an LDP LSP has been successfully established.</p>
<p>The following example uses the command output on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> display mpls ldp session</strong></pre>
<pre class="screen"> LDP Session(s) in Public Network
 Codes: LAM(Label Advertisement Mode), SsnAge Unit(DDDD:HH:MM)
 An asterisk (*) before a session means the session is being deleted.
 --------------------------------------------------------------------------
 PeerID             Status      LAM  SsnRole  SsnAge       KASent/Rcv
 --------------------------------------------------------------------------
 3.3.3.3:0          Operational DU   Passive  0000:02:56   709/709
 --------------------------------------------------------------------------
 TOTAL: 1 Session(s) Found.</pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display mpls ldp lsp</strong></pre>
<pre class="screen"> LDP LSP Information
 -------------------------------------------------------------------------------
 Flag after Out IF: (I) - RLFA Iterated LSP, (I*) - Normal and RLFA Iterated LSP
 -------------------------------------------------------------------------------
 DestAddress/Mask   In/OutLabel    UpstreamPeer    NextHop          OutInterface
 -------------------------------------------------------------------------------
 1.1.1.1/32         3/NULL         3.3.3.3         127.0.0.1        Loop1
*1.1.1.1/32         Liberal/32828                  DS/3.3.3.3       
 2.2.2.2/32         NULL/32829     -               10.1.1.2         GE<span>0/2/0</span>
 2.2.2.2/32         32829/32829    3.3.3.3         10.1.1.2         GE<span>0/2/0</span>
 3.3.3.3/32         NULL/3         -               10.1.1.2         GE<span>0/2/0</span>
 3.3.3.3/32         32828/3        3.3.3.3         10.1.1.2         GE<span>0/2/0</span>
 4.4.4.4/32         NULL/32830     -               10.1.1.2         GE<span>0/2/0</span>
 4.4.4.4/32         32830/32830    3.3.3.3         10.1.1.2         GE<span>0/2/0</span>
 -------------------------------------------------------------------------------
 TOTAL: 7 Normal LSP(s) Found.
 TOTAL: 1 Liberal LSP(s) Found.
 TOTAL: 0 FRR LSP(s) Found.
 An asterisk (*) before an LSP means the LSP is not established
 An asterisk (*) before a Label means the USCB or DSCB is stale
 An asterisk (*) before an UpstreamPeer means the session is stale
 An asterisk (*) before a DS means the session is stale
 An asterisk (*) before a NextHop means the LSP is FRR LSP</pre>
</p></li><li><span>Configure an EVPN instance on each PE.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>evpn vpn-instance evrf1 bd-mode</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-evpn-instance-evrf1] <strong>route-distinguisher 100:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-evpn-instance-evrf1] <strong>vpn-target 1:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-evpn-instance-evrf1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bd10] <strong>evpn binding vpn-instance evrf1 bd-tag 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bd10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>bridge-domain 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bd20] <strong>evpn binding vpn-instance evrf1 bd-tag 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bd20] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>evpn vpn-instance evrf1 bd-mode</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-evpn-instance-evrf1] <strong>route-distinguisher 200:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-evpn-instance-evrf1] <strong>vpn-target 1:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-evpn-instance-evrf1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bd10] <strong>evpn binding vpn-instance evrf1 bd-tag 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bd10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>bridge-domain 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bd20] <strong>evpn binding vpn-instance evrf1 bd-tag 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bd20] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>evpn vpn-instance evrf1 bd-mode</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-evpn-instance-evrf1] <strong>route-distinguisher 300:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-evpn-instance-evrf1] <strong>vpn-target 1:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-evpn-instance-evrf1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bd10] <strong>evpn binding vpn-instance evrf1 bd-tag 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bd10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>bridge-domain 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bd20] <strong>evpn binding vpn-instance evrf1 bd-tag 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bd20] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
</p></li><li><span>Configure a source address on each PE.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>evpn source-address 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>evpn source-address 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>evpn source-address 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
</p></li><li><span>Configure the ESI and E-Trunk for dual-homing active-active networking.</span><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>For security purposes, you are not advised to use weak security algorithms in this feature. If you need to use such an algorithm, run the <a href="cmdqueryname=undo+crypto+weak-algorithm+disable"><b><span class="cmdname">undo crypto weak-algorithm disable</span></b></a> command to enable the weak security algorithm function.</p>
</div></div>
</p><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>lacp e-trunk system-id 00e0-fc00-0000</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>lacp e-trunk priority 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>e-trunk 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-e-trunk-1] <strong>peer-address 2.2.2.2 source-address 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-e-trunk-1] <strong>security-key cipher YsHsjx_202206</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-e-trunk-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface eth-trunk 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Eth-Trunk10] <strong>mode lacp-static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Eth-Trunk10] <strong>e-trunk 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Eth-Trunk10] <strong>e-trunk mode force-master</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Eth-Trunk10] <strong>esi 0000.1111.2222.1111.1111</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Eth-Trunk10] <strong>timer es-recovery 120</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Eth-Trunk10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface eth-trunk 10.1 mode l2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Eth-Trunk10.1] <strong>encapsulation dot1q vid 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Eth-Trunk10.1] <strong>bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Eth-Trunk10.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface eth-trunk 10.2 mode l2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Eth-Trunk10.2] <strong>encapsulation dot1q vid 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Eth-Trunk10.2] <strong>bridge-domain 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Eth-Trunk10.2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>eth-trunk 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>carrier up-hold-time 600000</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>evpn enhancement port 1345</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>lacp e-trunk system-id 00e0-fc00-0000</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>lacp e-trunk priority 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>e-trunk 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-e-trunk-1] <strong>peer-address 1.1.1.1 source-address 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-e-trunk-1] <strong>security-key cipher YsHsjx_202206</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-e-trunk-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface eth-trunk 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Eth-Trunk10] <strong>mode lacp-static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Eth-Trunk10] <strong>e-trunk 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Eth-Trunk10] <strong>e-trunk mode force-master</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Eth-Trunk10] <strong>esi 0000.1111.2222.1111.1111</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Eth-Trunk10] <strong>timer es-recovery 120</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Eth-Trunk10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface eth-trunk 10.1 mode l2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Eth-Trunk10.1] <strong>encapsulation dot1q vid 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Eth-Trunk10.1] <strong>bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Eth-Trunk10.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface eth-trunk 10.2 mode l2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Eth-Trunk10.2] <strong>encapsulation dot1q vid 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Eth-Trunk10.2] <strong>bridge-domain 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Eth-Trunk10.2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>eth-trunk 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>carrier up-hold-time 600000</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>evpn enhancement port 1345</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>interface eth-trunk 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Eth-Trunk10] <strong>esi 0000.1111.3333.4444.5555</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Eth-Trunk10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>interface eth-trunk 10.1 mode l2</strong>
[<span class="keyword">*</span>PE3-Eth-Trunk10.1] <strong>encapsulation dot1q vid 100</strong>
[<span class="keyword">*</span>PE3-Eth-Trunk10.1] <strong>bridge-domain 10</strong>
[<span class="keyword">*</span>PE3-Eth-Trunk10.1] <strong>quit</strong>
[<span class="keyword">*</span>PE3] <strong>interface eth-trunk 10.2 mode l2</strong>
[<span class="keyword">*</span>PE3-Eth-Trunk10.2] <strong>encapsulation dot1q vid 200</strong>
[<span class="keyword">*</span>PE3-Eth-Trunk10.2] <strong>bridge-domain 20</strong>
[<span class="keyword">*</span>PE3-Eth-Trunk10.2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/2/0</span>] <strong>eth-trunk 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
</p></li><li><span>Configure local-remote FRR for MAC routes.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-evpn] <strong>vlan-extend private enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-evpn] <strong>vlan-extend redirect enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-evpn] <strong>local-remote frr enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</p><p><p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-evpn] <strong>vlan-extend private enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-evpn] <strong>vlan-extend redirect enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-evpn] <strong>local-remote frr enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</p></li><li><span>On PE1 and PE2, configure one BFD session for Eth-Trunk member interface detection and another BFD session for association with the access-side Eth-Trunk interface.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bfd</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bfd] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>bfd PE1toCE bind peer-ip default-ip interface GigabitEthernet<span>0/1/0</span></strong> </pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bfd-session-PE1toCE] <strong>discriminator local 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bfd-session-PE1toCE] <strong>discriminator remote 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bfd-session-PE1toCE] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>bfd pe1tope2 bind peer-ip 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bfd-session-pe1tope2] <strong>discriminator local 5</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bfd-session-pe1tope2] <strong>discriminator remote 6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bfd-session-pe1tope2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>bfd pe2tope1 bind peer-ip 2.2.2.2</strong> <strong>track-interface interface Eth-Trunk10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bfd-session-pe2tope1] <strong>discriminator local 7</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bfd-session-pe2tope1] <strong>discriminator remote 8</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bfd-session-pe2tope1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface eth-trunk 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Eth-Trunk10] <strong>es track bfd pe1tope2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Eth-Trunk10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>bfd</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bfd] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>bfd PE2toCE bind peer-ip default-ip interface GigabitEthernet<span>0/1/0</span></strong> </pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bfd-session-PE2toCE] <strong>discriminator local 3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bfd-session-PE2toCE] <strong>discriminator remote 4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bfd-session-PE2toCE] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>bfd pe1tope2 bind peer-ip 1.1.1.1</strong> <strong>track-interface interface Eth-Trunk10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bfd-session-pe1tope2] <strong>discriminator local 6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bfd-session-pe1tope2] <strong>discriminator remote 5</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bfd-session-pe1tope2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>bfd pe2tope1 bind peer-ip 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bfd-session-pe2tope1] <strong>discriminator local 8</strong>
[<span class="keyword">*</span>PE2-bfd-session-pe2tope1] <strong>discriminator remote 7</strong>
[<span class="keyword">*</span>PE2-bfd-session-pe2tope1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface eth-trunk 10</strong>
[<span class="keyword">*</span>PE2-Eth-Trunk10] <strong>es track bfd pe2tope1</strong>
[<span class="keyword">*</span>PE2-Eth-Trunk10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</p></li><li><span>Configure BGP EVPN peer relationships between the PEs and RR, and on the RR, specify the PEs as RR clients.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 3.3.3.3 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 3.3.3.3 connect-interface loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>l2vpn-family evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-evpn] <strong>peer 3.3.3.3 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-evpn] <strong>timer df-delay 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>peer 3.3.3.3 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>peer 3.3.3.3 connect-interface loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>l2vpn-family evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-evpn] <strong>peer 3.3.3.3 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-evpn] <strong>timer df-delay 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>peer 3.3.3.3 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>peer 3.3.3.3 connect-interface loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>l2vpn-family evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp-af-evpn] <strong>peer 3.3.3.3 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp-af-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
<p># Configure the RR.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RR] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp] <strong>peer 1.1.1.1 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp] <strong>peer 1.1.1.1 connect-interface loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp] <strong>peer 2.2.2.2 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp] <strong>peer 2.2.2.2 connect-interface loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp] <strong>peer 4.4.4.4 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp] <strong>peer 4.4.4.4 connect-interface loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp] <strong>l2vpn-family evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp-af-evpn] <strong>undo policy vpn-target</strong>
[<span class="keyword">*</span>RR-bgp-af-evpn] <strong>peer 1.1.1.1 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp-af-evpn] <strong>peer 1.1.1.1 reflect-client</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp-af-evpn] <strong>peer 2.2.2.2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp-af-evpn] <strong>peer 2.2.2.2 reflect-client</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp-af-evpn] <strong>peer 4.4.4.4 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp-af-evpn] <strong>peer 4.4.4.4 reflect-client</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp-af-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR] <strong>commit</strong></pre>
<p>After completing the configurations, run the <strong>display bgp evpn peer</strong> command on the RR. The command output shows that BGP peer relationships are in the <strong>Established</strong> state, indicating that BGP peer relationships have been successfully established between the PEs and RR.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RR] <strong>display bgp evpn peer</strong></pre>
<pre class="screen"> 
 BGP local router ID : 10.1.1.2
 Local AS number : 100
 Total number of peers : 3                 Peers in established state : 3

  Peer            V          AS  MsgRcvd  MsgSent  OutQ  Up/Down       State  PrefRcv
  1.1.1.1         4         100      231      253     0 03:07:26 Established        6
  2.2.2.2         4         100      231      256     0 03:07:44 Established        6
  4.4.4.4         4         100      232      254     0 03:07:54 Established        6</pre>
</p></li><li><span>Configure CEs and PEs to communicate.</span><p><p># Configure CE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>interface Eth-Trunk20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-Eth-Trunk20] <strong>mode lacp-static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-Eth-Trunk20] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bd10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>bridge-domain 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bd20] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>interface Eth-Trunk20.1 mode l2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-Eth-Trunk20.1] <strong>encapsulation dot1q vid 100</strong>
[<span class="keyword">*</span>CE1-Eth-Trunk20.1] <strong>rewrite pop single</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-Eth-Trunk20.1] <strong>bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-Eth-Trunk20.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>interface Eth-Trunk20.2 mode l2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-Eth-Trunk20.2] <strong>encapsulation dot1q vid 200</strong>
[<span class="keyword">*</span>CE1-Eth-Trunk20.2] <strong>rewrite pop single</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-Eth-Trunk20.2] <strong>bridge-domain 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-Eth-Trunk20.2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>] <strong>eth-trunk 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>interface gigabitethernet<span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/2/0</span>] <strong>eth-trunk 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong>
[<span class="keyword">*</span>CE1] <strong>bfd CEtoPE1 bind peer-ip default-ip interface GigabitEthernet<span>0/1/0</span></strong> 
[<span class="keyword">*</span>CE1-bfd-session-CEtoPE1] <strong>discriminator local 2</strong>
[<span class="keyword">*</span>CE1-bfd-session-CEtoPE1] <strong>discriminator remote 1</strong>
[<span class="keyword">*</span>CE1-bfd-session-CEtoPE1] <strong>quit</strong>
[<span class="keyword">*</span>CE1] <strong>bfd CEtoPE2 bind peer-ip default-ip interface GigabitEthernet<span>0/2/0</span></strong> 
[<span class="keyword">*</span>CE1-bfd-session-CEtoPE2] <strong>discriminator local 4</strong>
[<span class="keyword">*</span>CE1-bfd-session-CEtoPE2] <strong>discriminator remote 3</strong>
[<span class="keyword">*</span>CE1-bfd-session-CEtoPE2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>commit</strong></pre>
<p># Configure CE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>interface Eth-Trunk 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-Eth-Trunk10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-bd10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>interface Eth-Trunk 10.1 mode l2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-Eth-Trunk10.1] <strong>encapsulation dot1q vid 100</strong>
[<span class="keyword">*</span>CE2-Eth-Trunk10.1] <strong>rewrite pop single</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-Eth-Trunk10.1] <strong>bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-Eth-Trunk10.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>interface Eth-Trunk 10.2 mode l2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-Eth-Trunk10.2] <strong>encapsulation dot1q vid 200</strong>
[<span class="keyword">*</span>CE2-Eth-Trunk10.2] <strong>rewrite pop single</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-Eth-Trunk10.2] <strong>bridge-domain 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-Eth-Trunk10.2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>] <strong>eth-trunk 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>commit</strong></pre>
</p></li><li><span>Configure IP addresses on the same network segment on CE1 and CE2 and perform a ping operation on the same network segment.</span><p><p># Configure CE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>interface vbdif10</strong>
[<span class="keyword">*</span>CE1-Vbdif10] <strong>ip address 192.168.1.11 24</strong>
[<span class="keyword">*</span>CE1-Vbdif10] <strong>quit</strong>
[<span class="keyword">*</span>CE1] <strong>interface vbdif20</strong>
[<span class="keyword">*</span>CE1-Vbdif20] <strong>ip address 192.168.2.11 24</strong>
[<span class="keyword">*</span>CE1-Vbdif20] <strong>quit</strong>
[<span class="keyword">*</span>CE1] <strong>commit</strong></pre>
</p><p><p># Configure CE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>interface </strong><strong>vbdif10</strong>
[<span class="keyword">*</span>CE2-Vbdif10] <strong>ip address 192.168.1.12 24</strong>
[<span class="keyword">*</span>CE2-Vbdif10] <strong>quit</strong>
[<span class="keyword">*</span>CE2] <strong>interface vbdif20</strong>
[<span class="keyword">*</span>CE2-Vbdif20] <strong>ip address 192.168.2.12 24</strong>
[<span class="keyword">*</span>CE2-Vbdif20] <strong>quit</strong>
[<span class="keyword">*</span>CE2] <strong>commit</strong></pre>
<p># Ping CE2 from CE1 (with the source and destination IP addresses being on the same network segment). The following example uses the command output on CE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>ping 192.168.1.12</strong> </pre>
<pre class="screen"> PING 192.168.1.12: 56 data bytes, press CTRL_C to break
 Reply from 192.168.1.12: bytes=56 Sequence=1 ttl=255 time=1 ms
 Reply from 192.168.1.12: bytes=56 Sequence=2 ttl=255 time=1 ms
 Reply from 192.168.1.12: bytes=56 Sequence=3 ttl=255 time=1 ms
 Reply from 192.168.1.12: bytes=56 Sequence=4 ttl=255 time=1 ms
 Reply from 192.168.1.12: bytes=56 Sequence=5 ttl=255 time=1 ms

 --- 192.168.1.12 ping statistics ---
 5 packet(s) transmitted
 5 packet(s) received
 0.00% packet loss
 round-trip min/avg/max = 1/1/1 ms</pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>ping 192.168.2.12</strong></pre>
<pre class="screen"> PING 192.168.2.12: 56 data bytes, press CTRL_C to break
 Reply from 192.168.2.12: bytes=56 Sequence=1 ttl=255 time=1 ms
 Reply from 192.168.2.12: bytes=56 Sequence=2 ttl=255 time=1 ms
 Reply from 192.168.2.12: bytes=56 Sequence=3 ttl=255 time=1 ms
 Reply from 192.168.2.12: bytes=56 Sequence=4 ttl=255 time=1 ms
 Reply from 192.168.2.12: bytes=56 Sequence=5 ttl=255 time=1 ms

 --- 192.168.2.12 ping statistics ---
 5 packet(s) transmitted
 5 packet(s) received
 0.00% packet loss
 round-trip min/avg/max = 1/1/1 ms</pre>
</p></li><li><span>Verify the configuration.</span><p><p>Run the <strong>display bgp evpn all routing-table</strong> command on PE3. The command output shows that EVPN routes carrying Ethernet tag IDs are received from the remote PEs.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>display bgp evpn all routing-table</strong></pre>
<pre class="screen"> Local AS number : 100

 BGP Local router ID is 10.3.1.2
 Status codes: * - valid, &gt; - best, d - damped, x - best external, a - add path,
               h - history,  i - internal, s - suppressed, S - Stale
               Origin : i - IGP, e - EGP, ? - incomplete


 EVPN address family:
 Number of A-D Routes: 9
 Route Distinguisher: 100:1
 Network(ESI/EthTagId)                                     NextHop
 *&gt;i 0000.1111.2222.1111.1111:<strong>100</strong>                          1.1.1.1 
 *&gt;i 0000.1111.2222.1111.1111:<strong>200</strong>                          1.1.1.1 
 Route Distinguisher: 200:1
 Network(ESI/EthTagId) NextHop
 *&gt;i 0000.1111.2222.1111.1111:<strong>100</strong>                          2.2.2.2 
 *&gt;i 0000.1111.2222.1111.1111:<strong>200</strong>                          2.2.2.2 
 Route Distinguisher: 1.1.1.1:0
 Network(ESI/EthTagId)                                     NextHop
 *&gt;i 0000.1111.2222.1111.1111:4294967295                   1.1.1.1 
 Route Distinguisher: 300:1
 Network(ESI/EthTagId)                                     NextHop
 *&gt; 0000.1111.3333.4444.5555:<strong>100</strong>                           127.0.0.1 
 *&gt; 0000.1111.3333.4444.5555:<strong>200</strong>                           127.0.0.1 
 Route Distinguisher: 2.2.2.2:0
 Network(ESI/EthTagId)                                     NextHop
 *&gt;i 0000.1111.2222.1111.1111:4294967295                   2.2.2.2 
 Route Distinguisher: 4.4.4.4:0
 Network(ESI/EthTagId)                                     NextHop
 *&gt; 0000.1111.3333.4444.5555:4294967295                    127.0.0.1 


 EVPN-Instance evrf1:
 Number of A-D Routes: 8
 Network(ESI/EthTagId)                                     NextHop
 *&gt;i 0000.1111.2222.1111.1111:<strong>100</strong>                          1.1.1.1 
 * i                                                       2.2.2.2 
 *&gt;i 0000.1111.2222.1111.1111:<strong>200</strong>                          1.1.1.1 
 * i                                                       2.2.2.2 
 *&gt;i 0000.1111.2222.1111.1111:4294967295                   1.1.1.1 
 * i                                                       2.2.2.2 
 *&gt; 0000.1111.3333.4444.5555:<strong>100</strong>                          127.0.0.1 
 *&gt; 0000.1111.3333.4444.5555:<strong>200</strong>                          127.0.0.1 
 
 EVPN address family:
 Number of Mac Routes: 4
 Route Distinguisher: 100:1
 Network(EthTagId/MacAddrLen/MacAddr/IpAddrLen/IpAddr)     NextHop
 *&gt;i <strong>100</strong>:48:2019-0211-3313:0:0.0.0.0                       1.1.1.1 
 *&gt;i <strong>200</strong>:48:2019-0211-3313:0:0.0.0.0                       1.1.1.1 
 Route Distinguisher: 300:1
 Network(EthTagId/MacAddrLen/MacAddr/IpAddrLen/IpAddr)     NextHop
 *&gt; 100:48:2019-0211-3314:0:0.0.0.0                        0.0.0.0 
 *&gt; 200:48:2019-0211-3314:0:0.0.0.0                        0.0.0.0 


 EVPN-Instance evrf1:
 Number of Mac Routes: 4
 Network(EthTagId/MacAddrLen/MacAddr/IpAddrLen/IpAddr)     NextHop
 *&gt;i <strong>100</strong>:48:2019-0211-3313:0:0.0.0.0                       1.1.1.1 
 *&gt;  <strong>100</strong>:48:2019-0211-3314:0:0.0.0.0                       0.0.0.0 
 *&gt;i <strong>200</strong>:48:2019-0211-3313:0:0.0.0.0                       1.1.1.1 
 *&gt;  <strong>200</strong>:48:2019-0211-3314:0:0.0.0.0                       0.0.0.0 
 
 EVPN address family:
 Number of Inclusive Multicast Routes: 6
 Route Distinguisher: 100:1
 Network(EthTagId/IpAddrLen/OriginalIp)                    NextHop
 *&gt;i <strong>100</strong>:32:1.1.1.1                                        1.1.1.1 
 *&gt;i <strong>200</strong>:32:1.1.1.1                                        1.1.1.1 
 Route Distinguisher: 200:1
 Network(EthTagId/IpAddrLen/OriginalIp)                    NextHop
 *&gt;i <strong>100</strong>:32:2.2.2.2                                        2.2.2.2 
 *&gt;i <strong>200</strong>:32:2.2.2.2                                        2.2.2.2 
 Route Distinguisher: 300:1
 Network(EthTagId/IpAddrLen/OriginalIp)                    NextHop
 *&gt; <strong>100</strong>:32:4.4.4.4                                         127.0.0.1 
 *&gt; <strong>200</strong>:32:4.4.4.4                                         127.0.0.1 


 EVPN-Instance evrf1:
 Number of Inclusive Multicast Routes: 6
 Network(EthTagId/IpAddrLen/OriginalIp)                    NextHop
 *&gt;i <strong>100</strong>:32:1.1.1.1                                        1.1.1.1 
 *&gt;i <strong>100</strong>:32:2.2.2.2                                        2.2.2.2 
 *&gt;  <strong>100</strong>:32:4.4.4.4                                        127.0.0.1 
 *&gt;i <strong>200</strong>:32:1.1.1.1                                        1.1.1.1 
 *&gt;i <strong>200</strong>:32:2.2.2.2                                        2.2.2.2 
 *&gt;  <strong>200</strong>:32:4.4.4.4                                        127.0.0.1 
 
 EVPN address family:
 Number of ES Routes: 1
 Route Distinguisher: 4.4.4.4:0
 Network(ESI)                                              NextHop
 *&gt; 0000.1111.3333.4444.5555                               127.0.0.1 


 EVPN-Instance evrf1:
 Number of ES Routes: 1
 Network(ESI)                                              NextHop
 *&gt; 0000.1111.3333.4444.5555                               127.0.0.1 </pre>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0172370639__file1"><a name="EN-US_TASK_0172370639__file1"></a><a name="file1"></a><a name="EN-US_TASK_0172370639__1.4.6"></a><a name="1.4.6"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>PE1 configuration file</p>
<pre class="screen">#
sysname PE1
#
lacp e-trunk system-id 00e0-fc00-0000
lacp e-trunk priority 1</pre>
<pre class="screen">#
evpn enhancement port 1345</pre>
<pre class="screen">#
evpn
 vlan-extend private enable
 vlan-extend redirect enable
 local-remote frr enable
#
evpn vpn-instance evrf1 bd-mode
 route-distinguisher 100:1
 vpn-target 1:1 export-extcommunity
 vpn-target 1:1 import-extcommunity</pre>
<pre class="screen">#
bfd</pre>
<pre class="screen">#
mpls lsr-id 1.1.1.1
#
mpls
#
bridge-domain 10
 evpn binding vpn-instance evrf1 bd-tag 100
#
bridge-domain 20
 evpn binding vpn-instance evrf1 bd-tag 200
#
mpls ldp
#
e-trunk 1
 peer-address 2.2.2.2 source-address 1.1.1.1
 security-key cipher %^%#4sTf&amp;{QHhMK"uZMOn&gt;r;3&amp;5<font style="font-size:8pt" Face="Courier New" >~</font>&amp;0,1&gt;:7fGZ9h<font style="font-size:8pt" Face="Courier New" >~</font>@1X%^%#
 authentication-mode enhanced-hmac-sha256
#
interface Eth-Trunk10
 mode lacp-static
 e-trunk 1
 e-trunk mode force-master
 esi 0000.1111.2222.1111.1111
 es track bfd pe1tope2
 timer es-recovery 120
#
interface Eth-Trunk10.1 mode l2
 encapsulation dot1q vid 100
 bridge-domain 10
#
interface Eth-Trunk10.2 mode l2
 encapsulation dot1q vid 200
 bridge-domain 20
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 carrier up-hold-time 600000
 eth-trunk 10
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.1.1.1 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack0
 ip address 1.1.1.1 255.255.255.255</pre>
<pre class="screen">#
bfd pe1tope2 bind peer-ip 2.2.2.2
 discriminator local 5
 discriminator remote 6
#
bfd pe2tope1 bind peer-ip 2.2.2.2 track-interface interface Eth-Trunk10
 discriminator local 7
 discriminator remote 8
#
bfd PE1toCE bind peer-ip default-ip interface GigabitEthernet<span>0/1/0</span>
 discriminator local 1
 discriminator remote 2</pre>
<pre class="screen">#
bgp 100
 peer 3.3.3.3 as-number 100
 peer 3.3.3.3 connect-interface LoopBack0
 #
 ipv4-family unicast
  undo synchronization
  peer 3.3.3.3 enable
 #
 l2vpn-family evpn
  policy vpn-target
  timer df-delay 0
  peer 3.3.3.3 enable
#
ospf 1
 area 0.0.0.0
  network 1.1.1.1 0.0.0.0
  network 10.1.1.0 0.0.0.255
#
evpn source-address 1.1.1.1
#
return</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#
sysname PE2
#
lacp e-trunk system-id 00e0-fc00-0000
lacp e-trunk priority 1</pre>
<pre class="screen">#
evpn enhancement port 1345</pre>
<pre class="screen">#
evpn
 vlan-extend private enable
 vlan-extend redirect enable
 local-remote frr enable
#
evpn vpn-instance evrf1 bd-mode
 route-distinguisher 200:1
 vpn-target 1:1 export-extcommunity
 vpn-target 1:1 import-extcommunity</pre>
<pre class="screen">#
bfd</pre>
<pre class="screen">#
mpls lsr-id 2.2.2.2
#
mpls
#
bridge-domain 10
 evpn binding vpn-instance evrf1 bd-tag 100
#
bridge-domain 20
 evpn binding vpn-instance evrf1 bd-tag 200
#
mpls ldp
#
e-trunk 1
 peer-address 1.1.1.1 source-address 2.2.2.2
 security-key cipher %^%#4sTf&amp;{QHhMK"uZMOn&gt;r;3&amp;5<font style="font-size:8pt" Face="Courier New" >~</font>&amp;0,1&gt;:7fGZ9h<font style="font-size:8pt" Face="Courier New" >~</font>@1X%^%#
 authentication-mode enhanced-hmac-sha256
#
interface Eth-Trunk10
 mode lacp-static
 e-trunk 1
 e-trunk mode force-master
 esi 0000.1111.2222.1111.1111
 es track bfd pe2tope1
 timer es-recovery 120
#
interface Eth-Trunk10.1 mode l2
 encapsulation dot1q vid 100
 bridge-domain 10
#
interface Eth-Trunk10.2 mode l2
 encapsulation dot1q vid 200
 bridge-domain 20
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 carrier up-hold-time 600000
 eth-trunk 10
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.2.1.1 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack0
 ip address 2.2.2.2 255.255.255.0</pre>
<pre class="screen">#
bfd pe1tope2 bind peer-ip 1.1.1.1 track-interface interface Eth-Trunk10
 discriminator local 6
 discriminator remote 5
#
bfd pe2tope1 bind peer-ip 1.1.1.1
 discriminator local 8
 discriminator remote 7
#
bfd PE2toCE bind peer-ip default-ip interface GigabitEthernet<span>0/1/0</span>
 discriminator local 3
 discriminator remote 4</pre>
<pre class="screen">#
bgp 100
 peer 3.3.3.3 as-number 100
 peer 3.3.3.3 connect-interface LoopBack0
 #
 ipv4-family unicast
  undo synchronization
  peer 3.3.3.3 enable
 #
 l2vpn-family evpn
  policy vpn-target
  timer df-delay 0
  peer 3.3.3.3 enable
#
ospf 1
 area 0.0.0.0
  network 2.2.2.2 0.0.0.0
  network 10.2.1.0 0.0.0.255
#
evpn source-address 2.2.2.2
#
return</pre>
</li><li><p>PE3 configuration file</p>
<pre class="screen">#
sysname PE3
#
evpn vpn-instance evrf1 bd-mode
 route-distinguisher 300:1
 vpn-target 1:1 export-extcommunity
 vpn-target 1:1 import-extcommunity
#
mpls lsr-id 4.4.4.4
#
mpls
#
bridge-domain 10
 evpn binding vpn-instance evrf1 bd-tag 100
#
bridge-domain 20
 evpn binding vpn-instance evrf1 bd-tag 200
#
mpls ldp
#
interface Eth-Trunk10
 esi 0000.1111.3333.4444.5555
#
interface Eth-Trunk10.1 mode l2
 encapsulation dot1q vid 100
 bridge-domain 10
#
interface Eth-Trunk10.2 mode l2
 encapsulation dot1q vid 200
 bridge-domain 20
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.3.1.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 eth-trunk 10
#
interface LoopBack0
 ip address 4.4.4.4 255.255.255.255
#
bgp 100
 peer 3.3.3.3 as-number 100
 peer 3.3.3.3 connect-interface LoopBack0
 #              
 ipv4-family unicast
  undo synchronization
  peer 3.3.3.3 enable
 #
 l2vpn-family evpn
  policy vpn-target
  peer 3.3.3.3 enable
#
ospf 1
 area 0.0.0.0
  network 4.4.4.4 0.0.0.0
  network 10.3.1.0 0.0.0.255
#
evpn source-address 4.4.4.4
#
return</pre>
</li><li><p>RR configuration file</p>
<pre class="screen">#
sysname RR
#
mpls lsr-id 3.3.3.3
#
mpls
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.1.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown  
 ip address 10.2.1.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/3/0</span>
 undo shutdown
 ip address 10.3.1.1 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack0
 ip address 3.3.3.3 255.255.255.255
#
bgp 100
 peer 1.1.1.1 as-number 100
 peer 1.1.1.1 connect-interface LoopBack0
 peer 2.2.2.2 as-number 100
 peer 2.2.2.2 connect-interface LoopBack0
 peer 4.4.4.4 as-number 100
 peer 4.4.4.4 connect-interface LoopBack0
 #
 ipv4-family unicast
  undo synchronization
  peer 1.1.1.1 enable
  peer 2.2.2.2 enable
  peer 4.4.4.4 enable
 #
 l2vpn-family evpn
  undo policy vpn-target
  peer 1.1.1.1 enable
  peer 1.1.1.1 reflect-client
  peer 2.2.2.2 enable
  peer 2.2.2.2 reflect-client
  peer 4.4.4.4 enable
  peer 4.4.4.4 reflect-client
#
ospf 1
 area 0.0.0.0
  network 3.3.3.3 0.0.0.0
  network 10.1.1.0 0.0.0.255
  network 10.2.1.0 0.0.0.255
  network 10.3.1.0 0.0.0.255
#
return</pre>
</li><li><p>CE1 configuration file</p>
<pre class="screen">#
sysname CE1
#
bridge-domain 10
#
bridge-domain 20
#
bfd
#
interface Vbdif10
 ip address 192.168.1.11 255.255.255.0
#
interface Vbdif20
 ip address 192.168.2.11 255.255.255.0
#
interface Eth-Trunk20
 mode lacp-static
#
interface Eth-Trunk20.1 mode l2
 encapsulation dot1q vid 100
 rewrite pop single
 bridge-domain 10
#
interface Eth-Trunk20.2 mode l2
 encapsulation dot1q vid 200
 rewrite pop single
 bridge-domain 20
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 eth-trunk 20
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 eth-trunk 20
#
bfd CEtoPE1 bind peer-ip default-ip interface GigabitEthernet<span>0/1/0</span>
 discriminator local 2
 discriminator remote 1
#
bfd CEtoPE2 bind peer-ip default-ip interface GigabitEthernet<span>0/2/0</span>
 discriminator local 4
 discriminator remote 3
#
return</pre>
</li><li><p>CE2 configuration file</p>
<pre class="screen">#
sysname CE2
#
bridge-domain 10
#
bridge-domain 20
#
interface Vbdif10
 ip address 192.168.1.12 255.255.255.0
#
interface Vbdif20
 ip address 192.168.2.12 255.255.255.0
#
interface Eth-Trunk10
#
interface Eth-Trunk10.1 mode l2
 encapsulation dot1q vid 100
 rewrite pop single
 bridge-domain 10
#
interface Eth-Trunk10.2 mode l2
 encapsulation dot1q vid 200
 rewrite pop single
 bridge-domain 20
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 eth-trunk 10
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0010.html">EVPN Configuration Examples
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0025-new.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0026-new.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>