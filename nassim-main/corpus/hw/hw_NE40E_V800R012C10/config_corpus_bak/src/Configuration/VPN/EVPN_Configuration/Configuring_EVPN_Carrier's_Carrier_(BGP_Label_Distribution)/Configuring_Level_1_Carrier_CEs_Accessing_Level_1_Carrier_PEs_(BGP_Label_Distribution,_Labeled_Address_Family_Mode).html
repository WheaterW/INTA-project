
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring Level 1 Carrier CEs Accessing Level 1 Carrier PEs (BGP Label Distribution, Labeled Address Family Mode)">
<meta name="abstract" content="If the Level 1 and Level 2 carriers are in different ASs, the Level 1 carrier takes the Level 2 carrier as its VPN user.">
<meta name="description" content="If the Level 1 and Level 2 carriers are in different ASs, the Level 1 carrier takes the Level 2 carrier as its VPN user.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_csc_0003.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_csc_0015.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_csc_0017.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,f00454608,w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="p00915595">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00878323">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001168831742">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring Level 1 Carrier CEs Accessing Level 1 Carrier PEs (BGP Label Distribution, Labeled Address Family Mode)</title>
</head>
<body><a name="EN-US_TASK_0000001168831742"></a><a name="EN-US_TASK_0000001168831742"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring Level 1 Carrier CEs Accessing Level 1 Carrier PEs (BGP Label Distribution, Labeled Address Family Mode)</h1>
<div class="taskbody"><p>If the Level 1 and Level 2 carriers are in different ASs, the Level 1 carrier takes the Level 2 carrier as its VPN user.</p>
<div class="steps-unordered"><a name="EN-US_TASK_0000001168831742__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Procedure</h4>
<ul><li><span>Create a VPN instance on Level 1 carrier PEs.</span><ol><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ip+vpn-instance"><b><span class="cmdname">ip vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i></span><p><p>A VPN instance is created, and its view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ipv4-family"><b><span class="cmdname">ipv4-family</span></b></a></span><p><p>The VPN instance IPv4 address family is enabled, and its view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=route-distinguisher"><b><span class="cmdname">route-distinguisher</span></b></a> <i><span class="varname">route-distinguisher</span></i></span><p><p>An RD is configured for the VPN instance <span>IPv4 address family</span>.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=apply-label"><b><span class="cmdname">apply-label</span></b></a> <strong><span>per-route evpn</span></strong></span><p><p>The label distribution mode is set to one-label-per-route.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=vpn-target"><b><span class="cmdname">vpn-target</span></b></a> <i><span class="varname">vpn-target</span></i> &amp;&lt;1-8&gt; [ <strong><span>both</span></strong> | <strong><span>export-extcommunity</span></strong> | <strong><span>import-extcommunity</span></strong> ] <strong>evpn</strong></span><p><p>VPN targets are configured for EVPN routes in the VPN instance<span> IPv4 address family</span>.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=evpn+mpls+routing-enable"><b><span class="cmdname">evpn mpls routing-enable</span></b></a></span><p><p>EVPN is enabled to generate and advertise IP prefix routes and IRB routes.</p>
</p><p><p>In an EVPN L3VPN service scenario where MPLS or SR-MPLS tunnels are used as public network tunnels (including interworking scenarios), you need to run this command to enable EVPN to generate and advertise IP prefix routes and IRB routes, so that the local device can advertise IP prefix routes and IRB routes to its EVPN peers.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Return to the system view.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=interface"><b><span class="cmdname">interface</span></b></a> <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i></span><p><p>The view of the interface connected to the Level 1 carrier CE is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ip+binding+vpn-instance"><b><span class="cmdname">ip binding vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i></span><p><p>The interface is associated with the VPN instance.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ip+address"><b><span class="cmdname">ip address</span></b></a> <i><span class="varname">ip-address</span></i> { <i><span class="varname">mask</span></i> | <i><span class="varname">mask-length</span></i> }</span><p><p>An IP address is configured for the interface.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=mpls"><b><span class="cmdname">mpls</span></b></a></span><p><p>MPLS is enabled on the interface.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li><span>Configure labeled BGP on Level 1 carrier PEs.</span><ol><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> { <i><span class="varname">as-number-plain1</span></i> | <i><span class="varname">as-number-dot1</span></i> }</span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=vpn-instance"><b><span class="cmdname">vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i></span><p><p>A BGP VPN instance is created, and its view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer+as-number"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <strong><span>as-number</span></strong> { <i><span class="varname">as-number-plain2</span></i> | <i><span class="varname">as-number-dot2</span></i> }</span><p><p>The Level 1 carrier CE is configured as an EBGP peer in the BGP VPN instance view.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Return to the BGP view.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ipv4-family"><b><span class="cmdname">ipv4-family</span></b></a> <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i></span><p><p>The BGP-VPN instance IPv4 address family view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=import-rib+vpn-instance"><b><span class="cmdname">import-rib vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i> <strong><span>labeled-unicast</span></strong> [ <strong><span>valid-route</span></strong> ] { <strong><span>route-policy</span></strong> <i><span class="varname">route-policy-name</span></i><span> | <strong><span>route-filter</span></strong> <i><span class="varname">route-filter-name</span></i></span> }</span><p><p>The function to import labeled BGP VPN routes to the BGP VPN routing table is enabled.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=advertise+l2vpn+evpn"><b><span class="cmdname">advertise l2vpn evpn</span></b></a></span><p><p>The VPN instance is configured to advertise EVPN IP prefix routes.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Return to the BGP view.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ipv4-labeled-unicast"><b><span class="cmdname">ipv4-labeled-unicast</span></b></a> <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i></span><p><p>The BGP-labeled-VPN instance IPv4 address family view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer+enable"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <strong><span>enable</span></strong></span><p><p>The BGP peer relationship is enabled in the BGP-labeled-VPN instance IPv4 address family view, enabling the Level 1 carrier PE to exchange labeled BGP routes with Level 1 carrier CE.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=import-rib"><b><span class="cmdname">import-rib</span></b></a> <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i> <strong><span>include-label-route</span></strong> [ <strong><span>valid-route</span></strong> ] [ <strong><span>route-policy</span></strong> <i><span class="varname">route-policy-name</span></i><span> | <strong><span>route-filter</span></strong> <i><span class="varname">route-filter-name</span></i></span> ]</span><p><p>The device is configured to import BGP labeled routes leaked to the VPN instance to the routing table of the BGP-labeled-VPN instance IPv4 address family.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li><span>Perform the following steps on Level 1 carrier CEs for the deployment of labeled BGP between Level 1 carrier CEs and Level 1 carrier PEs.</span><ol><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=interface"><b><span class="cmdname">interface</span></b></a> <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i></span><p><p>The view of the interface connected to the Level 1 carrier PE is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ip+address"><b><span class="cmdname">ip address</span></b></a> <i><span class="varname">ip-address</span></i> { <i><span class="varname">mask</span></i> | <i><span class="varname">mask-length</span></i> }</span><p><p>An IP address is configured for the interface.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=mpls"><b><span class="cmdname">mpls</span></b></a></span><p><p>MPLS is enabled on the interface.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Return to the system view.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> { <i><span class="varname">as-number-plain2</span></i> | <i><span class="varname">as-number-dot2</span></i> }</span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer+as-number"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <strong><span>as-number</span></strong> { <i><span class="varname">as-number-plain1</span></i> | <i><span class="varname">as-number-dot1</span></i> }</span><p><p>The Level 1 carrier PE is configured as an EBGP peer.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=import-rib+public"><b><span class="cmdname">import-rib public</span></b></a> <strong><span>labeled-unicast</span></strong> [ <strong><span>valid-route</span></strong> ] { <strong><span>route-policy</span></strong> <i><span class="varname">route-policy-name</span></i> }</span><p><p>The device is configured to import BGP VPN labeled routes into the BGP public network routing table.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ipv4-family+labeled-unicast"><b><span class="cmdname">ipv4-family labeled-unicast</span></b></a></span><p><p>The BGP-labeled address family view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer+enable"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <strong><span>enable</span></strong></span><p><p>The peer relationship is enabled in the BGP-labeled address family view, enabling the Level 1 carrier CE to exchange labeled BGP routes with the Level 1 carrier PE.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=peer+allow-as-loop"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ip-address</span></i> <strong><span>allow-as-loop</span></strong> [ <i><span class="varname">number</span></i> ]</span><p><p>Routing loops are permitted.</p>
</p><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Perform this step if the Level 1 and Level 2 carriers belong to different ASs but Level 2 carriers belong to the same AS.</p>
</div></div>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li><span>Perform the following steps on Level 1 carrier CEs for the deployment of labeled BGP between Level 1 carrier CEs and Level 2 carrier PEs.</span><ol><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> { <i><span class="varname">as-number-plain2</span></i> | <i><span class="varname">as-number-dot2</span></i> }</span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer+as-number"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <strong><span>as-number</span></strong> { <i><span class="varname">as-number-plain2</span></i> | <i><span class="varname">as-number-dot2</span></i> }</span><p><p>The Level 2 carrier PE is configured as an IBGP peer.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer+connect-interface"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <strong><span>connect-interface loopback</span></strong> <i><span class="varname">interface-number</span></i></span><p><p>The interface for setting up a TCP connection is specified.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ipv4-family+labeled-unicast"><b><span class="cmdname">ipv4-family labeled-unicast</span></b></a></span><p><p>The BGP-labeled address family view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer+enable"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <strong><span>enable</span></strong></span><p><p>The peer relationship is enabled in the BGP-labeled address family view, enabling the Level 1 carrier CE to exchange labeled BGP routes with the Level 2 carrier PE.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=import-route"><b><span class="cmdname">import-route</span></b></a> <i><span class="varname">protocol</span></i> <i><span class="varname">process-id</span></i></span><p><p>The device is configured to import routes from the Level 2 carrier network.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li><span>Configure labeled BGP on Level 2 carrier PEs.</span><ol><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> { <i><span class="varname">as-number-plain2</span></i> | <i><span class="varname">as-number-dot2</span></i> }</span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer+as-number"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <strong><span>as-number</span></strong> { <i><span class="varname">as-number-plain2</span></i> | <i><span class="varname">as-number-dot2</span></i> }</span><p><p>The Level 1 carrier CE is configured as an IBGP peer.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer+connect-interface"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <strong><span>connect-interface loopback</span></strong> <i><span class="varname">interface-number</span></i></span><p><p>The interface for setting up a TCP connection is specified.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ipv4-family+labeled-unicast"><b><span class="cmdname">ipv4-family labeled-unicast</span></b></a></span><p><p>The BGP-labeled address family view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer+enable"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <strong><span>enable</span></strong></span><p><p>The peer relationship is enabled in the BGP-labeled address family view, enabling the Level 2 carrier PE to exchange labeled BGP routes with the Level 1 carrier CE.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li></ul></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_csc_0003.html">Configuring EVPN Carrier's Carrier (BGP Label Distribution)
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_csc_0015.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_csc_0017.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>