
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring an L2VPN to Access L3VPNs Through Sub-interfaces for QinQ Termination">
<meta name="abstract" content="This section describes how to configure an L2VPN to access multiple L3VPNs through sub-interfaces for QinQ VLAN tag termination.">
<meta name="description" content="This section describes how to configure an L2VPN to access multiple L3VPNs through sub-interfaces for QinQ VLAN tag termination.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2-l3_cfg_5013.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2-l3_cfg_5028.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,w00556928,w00606909,l00455378,l2-l3">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="L2VPN Accessing L3VPN">
<meta name="featuretype" content="VPN">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="L2VPN Accessing L3VPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="L2VPN Accessing L3VPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="L2VPN Accessing L3VPN">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="l00415692">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00830487">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172370388">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring an L2VPN to Access L3VPNs Through Sub-interfaces for QinQ Termination</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172370388"></a><a name="EN-US_TASK_0172370388"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring an L2VPN to Access L3VPNs Through Sub-interfaces for QinQ Termination</h1>
<div class="taskbody"><p>This section describes how to configure an L2VPN to access multiple L3VPNs through sub-interfaces for QinQ VLAN tag termination.</p>
<div class="context"><a name="EN-US_TASK_0172370388__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0172370388__fig_dc_vrp_l2-l3_cfg_502501">Figure 1</a>, the NPE and PE function as the PEs of the IP/MPLS backbone network; the UPE functions as the PE of the VPWS access network; a VPWS connection is established between the UPE and NPE with LDP as the signaling protocol.</p>
<p>CE1 and CE2 are two sites of the same user, and they carry different types of services. The inner VLAN tags 10 and 20 are used to distinguish the services. The user service packets are tagged with outer VLAN tag 100 after aggregation by the switch. The UPE sends the packets to the NPE over the specified VPWS connection on the access network based on the outer VLAN tag.</p>
<div class="p">Create VE<span>0/2/0</span> and VE<span>0/2/1</span> on the NPE. VE<span>0/2/0</span> is the L2VE interface used to terminate the VPWS service, and VE<span>0/2/1</span> is the L3VE interface used to access the MPLS L3VPN. Create two VE sub-interfaces on VE<span>0/2/1</span>. VE<span>0/2/1</span>.1 terminates the QinQ user packets with inner VLAN tag 10, and connects to VPN1; VE<span>0/2/1</span>.2 terminates the QinQ user packets with inner VLAN tag 20, and connects to VPN2. Then, CE1 can communicate with CE3, and CE2 can communicate with CE4.<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0172370388__en-us_task_0172370368_p3507024143810">This example uses VE interfaces to implement L2VPN accessing L3VPN. Because VE interfaces are bound to only one board, services are interrupted when the board fails. To improve service reliability, create two global VE interfaces on NPEs: Global-VE1 (L2VE interface used to terminate L2VPN services) and Global-VE2 (L3VE interface used to access an L3VPN network). Other configurations do not need to be changed.</p>
</div></div>
</div>
<div class="fignone" id="EN-US_TASK_0172370388__fig_dc_vrp_l2-l3_cfg_502501"><a name="EN-US_TASK_0172370388__fig_dc_vrp_l2-l3_cfg_502501"></a><a name="fig_dc_vrp_l2-l3_cfg_502501"></a><span class="figcap"><b>Figure 1 </b>Configuring an L2VPN to access multiple L3VPNs through sub-interfaces for QinQ VLAN tag termination</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface1, subinterface1.1, interface2, interface3, and interface4 represent GE<span>0/1/0</span>, GE<span>0/1/0</span>.1, GE<span>0/2/0</span>, GE<span>0/3/0</span>, and GE<span>0/1/1</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_l2-l3_cfg_502501.png"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172370388__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure the MPLS L3VPN backbone network.</p>
</li><li><p>Create an L2VE interface on the NPE to terminate the VPWS service and an L3VE interface to access the L3VPN. Bind them to the same VE group.</p>
</li><li><p>Configure LDP VPWS on the access network, which involves the following operations:</p>
<ul><li><p>Configure routing protocols for devices (UPE, P, and NPE) on the access network to communicate, and enable MPLS.</p>
</li><li><p>The default tunnel policy is used, and LSPs are established to transmit service data.</p>
</li><li><p>Enable MPLS L2VPN on the UPE and NPE, and establish VCs.</p>
</li></ul>
</li><li><p>Configure Layer 2 forwarding and QinQ on the switch.</p>
</li><li><p>Configure CEs to access the MPLS L3VPN.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172370388__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>VE group number</p>
</li><li><p>IP addresses of VE interfaces</p>
</li><li><p>Names of VPN instances for the MPLS L3VPN</p>
</li><li><p>Inner and outer VLAN tags of service packets</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172370388__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure interface IP addresses. The configuration details are not mentioned here.</span><p><p>Configure IP addresses for physical interfaces and loopback interfaces according to <a href="#EN-US_TASK_0172370388__fig_dc_vrp_l2-l3_cfg_502501">Figure 1</a>. The configuration details are not mentioned here.</p>
</p></li><li><span>Create VE<span>0/2/0</span> and VE<span>0/2/1</span> on the NPE, and bind them to the same VE group.</span><p><p># Create VE<span>0/2/0</span> for MPLS L2VPN termination.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname NPE</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE]<strong> interface virtual-ethernet<span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-Virtual-Ethernet<span>0/2/0</span>]<strong> ve-group 1 l2-terminate</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-Virtual-Ethernet<span>0/2/0</span>] <strong>quit</strong></pre>
<p># Create VE<span>0/2/1</span> for MPLS L3VPN access.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE]<strong> interface virtual-ethernet<span>0/2/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-Virtual-Ethernet<span>0/2/1</span>]<strong> ve-group 1 <span><strong>l3-access</strong></span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-Virtual-Ethernet<span>0/2/1</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE]<strong> commit</strong></pre>
<p>After completing the configurations, run the <strong>display virtual-ethernet ve-group</strong> command on the NPE. The command output shows the binding relationships between the VE interfaces and VE group.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE]<strong> display virtual-ethernet ve-group</strong></pre>
<pre class="screen"> Ve-groupID    TerminateVE                   AccessVE</pre>
<pre class="screen"> 1               Virtual-Ethernet<span>0/2/0</span>   Virtual-Ethernet<span>0/2/1</span></pre>
<pre class="screen">Total 1, 1 printed</pre>
</p></li><li><span>Configure an IGP on the VPWS access network. OSPF is used in this example. The configuration details are not mentioned here.</span><p><p>Note that when configuring OSPF, you need to configure OSPF to advertise the 32-bit loopback interface addresses of the UPE and NPE.</p>
<p>For configuration details, see the configuration files.</p>
</p></li><li><span>Configure basic MPLS functions and LDP on the VPWS access network.</span><p><p># Configure the UPE.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname UPE</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE]<strong> mpls lsr-id 1.1.1.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-mpls]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-mpls-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE]<strong> interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/2/0</span>]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/2/0</span>]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/2/0</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/2/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE]<strong> commit</strong></pre>
<p># Configure the NPE.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname NPE</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE]<strong> mpls lsr-id 2.2.2.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-mpls]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-mpls-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE]<strong> interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-GigabitEthernet<span>0/2/0</span>]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-GigabitEthernet<span>0/2/0</span>]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-GigabitEthernet<span>0/2/0</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-GigabitEthernet<span>0/2/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE]<strong> commit</strong></pre>
</p></li><li><span>Enable MPLS L2VPN on PEs and create VC connections.</span><p><p># Configure the UPE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE]<strong> mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-l2vpn]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE]<strong> interface gigabitethernet <span>0/1/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/0</span>.1]<strong> shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/0</span>.1]<strong> vlan-type dot1q 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/0</span>.1]<strong> mpls l2vc 2.2.2.9 101</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/0</span>.1] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/0</span>.1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE]<strong> commit</strong></pre>
<p># Configure the NPE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE]<strong> mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-l2vpn]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE] <strong>interface virtual-ethernet<span>0/2/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-Virtual-Ethernet<span>0/2/0</span>.1] <strong>vlan-type dot1q 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-Virtual-Ethernet<span>0/2/0</span>.1]<strong> mpls l2vc 1.1.1.9 101</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-Virtual-Ethernet<span>0/2/0</span>.1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE]<strong> commit</strong></pre>
<p>After completing the configurations, check VPWS connection information on the UPE and NPE. You can find that an L2VC has been established.</p>
<p>The following example uses the command output on the NPE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE]<strong> display mpls l2vc</strong></pre>
<pre class="screen">Total ldp vc : 1     1 up       0 down</pre>
<pre class="screen"> *Client Interface          : Virtual-Ethernet<span>0/2/0</span>.1 is up</pre>
<pre class="screen">  Administrator PW          : no</pre>
<pre class="screen">  Session State             : up</pre>
<pre class="screen">  AC Status                 : up</pre>
<pre class="screen">  VC State                  : up</pre>
<pre class="screen">  VC ID                     : 101</pre>
<pre class="screen">  VC Type                   : vlan</pre>
<pre class="screen">  Destination               : 1.1.1.9</pre>
<pre class="screen">  local VC label            : 140288       remote VC label      : 140292</pre>
<pre class="screen">  control word              : disable</pre>
<pre class="screen">  remote control word       : disable</pre>
<pre class="screen">  forwarding entry          : exist</pre>
<pre class="screen">  local group ID            : 0</pre>
<pre class="screen">  remote group ID           : 0
  local AC OAM State        : up
  local PSN OAM State       : up
  local forwarding state    : forwarding
  local status code         : 0x0
  remote AC OAM state       : up
  remote PSN OAM state      : up
  remote forwarding state   : forwarding
  remote status code        : 0x0
  ignore standby state      : no
  BFD for PW                : unavailable
  VCCV State                : up</pre>
<pre class="screen">  manual fault              : not set</pre>
<pre class="screen">  active state              : active</pre>
<pre class="screen">  OAM Protocol           : --
  OAM Status             : --
  OAM Fault Type         : --
  PW APS ID              : --
  PW APS Status          : --
  TTL Value              : 1</pre>
<pre class="screen">  link state                : up</pre>
<pre class="screen">  local VC MTU              : 1500         remote VC MTU        : 1500</pre>
<pre class="screen">  local VCCV                : alert ttl lsp-ping bfd
  remote VCCV               : alert ttl lsp-ping bfd</pre>
<pre class="screen">  tunnel policy name        : --
  PW template name          : --
  primary or secondary      : primary
  load balance type         : flow
  Access-port               : false</pre>
<pre class="screen">  Switchover Flag           : false
  VC tunnel info            : 1 tunnels
    NO.0  TNL type          : ldp   , TNL ID : 0x0000000001004c4e42</pre>
<pre class="screen">  create time               : 0 days, 0 hours, 30 minutes, 18 seconds</pre>
<pre class="screen">  up time                   : 0 days, 0 hours, 0 minutes, 0 seconds</pre>
<pre class="screen">  last change time          : 0 days, 0 hours, 30 minutes, 18 seconds
  VC last up time           : 2012/07/24 12:31:31
  VC total up time          : 0 days, 2 hours, 12 minutes, 51 seconds</pre>
<pre class="screen">  CKey                      : 11                                                   
  NKey                      : 10     </pre>
<pre class="screen">  PW redundancy mode        : frr</pre>
<pre class="screen">  AdminPw interface         : --
  AdminPw link state        : --
<span>  Forward state             : send inactive, receive inactive </span>
  Diffserv Mode             : uniform
  Service Class             : --
  Color                     : --
  DomainId                  : --
  Domain Name               : --</pre>
</p></li><li><span>Enable QinQ to add double tags to packets sent to the UPE by the switch.</span><p><p># Configure the switch.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname Switch</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Switch] <strong>vlan 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Switch-vlan100] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Switch] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>Switch-GigabitEthernet<span>0/1/0</span>] <strong>port trunk allow-pass vlan 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Switch-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Switch] <strong>interface gigabitethernet <span>0/3/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>Switch-GigabitEthernet<span>0/3/0</span>] <strong>port vlan-stacking vlan 10 stack-vlan 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Switch-GigabitEthernet<span>0/3/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Switch] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>Switch-GigabitEthernet<span>0/1/1</span>] <strong>port vlan-stacking vlan 20 stack-vlan 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Switch-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Switch]<strong> commit</strong></pre>
<p># Configure CE1.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname CE1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>interface gigabitethernet <span>0/1/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>.1] <strong>ip address 10.10.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>.1] <strong>vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1]<strong> commit</strong></pre>
<p># Configure CE2.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname CE2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>interface gigabitethernet <span>0/1/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>.1] <strong>ip address 10.20.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>.1] <strong>vlan-type dot1q 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2]<strong> commit</strong></pre>
</p></li><li><span>Configure IGP on the MPLS backbone network. IS-IS is used as IGP in this example. The configuration details are not mentioned here.</span><p><p>When configuring IS-IS, advertise the 32-bit loopback interface addresses of the PE and NPE.</p>
<p>For configuration details, see the configuration files.</p>
</p></li><li><span>Create VPN instances, and configure CEs to access the instances.</span><p><p># Configure the NPE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE] <strong>ip vpn-instance VPN1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-vpn-instance-VPN1] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-vpn-instance-VPN1-af-ipv4] <strong>route-distinguisher 100:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-vpn-instance-VPN1-af-ipv4] <strong>vpn-target 111:1 both</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-vpn-instance-VPN1-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-vpn-instance-VPN1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE] <strong>ip vpn-instance VPN2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-vpn-instance-VPN2] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-vpn-instance-VPN2-af-ipv4] <strong>route-distinguisher 200:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-vpn-instance-VPN2-af-ipv4] <strong>vpn-target 222:1 both</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-vpn-instance-VPN2-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-vpn-instance-VPN2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE] <strong>interface virtual-ethernet<span>0/2/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-Virtual-Ethernet<span>0/2/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE] <strong>interface virtual-ethernet<span>0/2/1</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-Virtual-Ethernet<span>0/2/1</span>.1] <strong>control-vid 1 qinq-termination</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-Virtual-Ethernet<span>0/2/1</span>.1] <strong>qinq termination pe-vid 100 ce-vid 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-Virtual-Ethernet<span>0/2/1</span>.1] <strong>ip binding vpn-instance VPN1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-Virtual-Ethernet<span>0/2/1</span>.1] <strong>ip address 10.10.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-Virtual-Ethernet<span>0/2/1</span>.1] <strong>arp broadcast enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-Virtual-Ethernet<span>0/2/1</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE] <strong>interface virtual-ethernet<span>0/2/1</span>.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-Virtual-Ethernet<span>0/2/1</span>.2] <strong>control-vid 1 qinq-termination</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-Virtual-Ethernet<span>0/2/1</span>.2] <strong>qinq termination pe-vid 100 ce-vid 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-Virtual-Ethernet<span>0/2/1</span>.2] <strong>ip binding vpn-instance VPN2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-Virtual-Ethernet<span>0/2/1</span>.2] <strong>ip address 10.20.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-Virtual-Ethernet<span>0/2/1</span>.2] <strong>arp broadcast enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-Virtual-Ethernet<span>0/2/1</span>.2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE]<strong> commit</strong></pre>
<p># Configure the PE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE] <strong>ip vpn-instance VPN1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-vpn-instance-VPN1] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-vpn-instance-VPN1-af-ipv4] <strong>route-distinguisher 100:2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-vpn-instance-VPN1-af-ipv4] <strong>vpn-target 111:1 both</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-vpn-instance-VPN1-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-vpn-instance-VPN1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE] <strong>ip vpn-instance VPN2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-vpn-instance-VPN2] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-vpn-instance-VPN2-af-ipv4] <strong>route-distinguisher 200:2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-vpn-instance-VPN2-af-ipv4] <strong>vpn-target 222:1 both</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-vpn-instance-VPN2-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-vpn-instance-VPN2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE] <strong>interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-GigabitEthernet<span>0/1/0</span>] <strong>ip binding vpn-instance VPN1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-GigabitEthernet<span>0/1/0</span>] <strong>ip address 10.30.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-GigabitEthernet<span>0/1/0</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE] <strong>interface gigabitethernet<span>0/3/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-GigabitEthernet<span>0/3/0</span>] <strong>ip binding vpn-instance VPN2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-GigabitEthernet<span>0/3/0</span>] <strong>ip address 10.40.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-GigabitEthernet<span>0/3/0</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-GigabitEthernet<span>0/3/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE]<strong> commit</strong></pre>
<p># Configure CE3.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname CE3</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE3] <strong>interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-GigabitEthernet<span>0/1/0</span>] <strong>ip address 10.30.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-GigabitEthernet<span>0/1/0</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3]<strong> commit</strong></pre>
<p># Configure CE4.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname CE4</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE4] <strong>interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE4-GigabitEthernet<span>0/1/0</span>] <strong>ip address 10.40.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE4-GigabitEthernet<span>0/1/0</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE4-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE4]<strong> commit</strong></pre>
</p></li><li><span>Configure OSPF between PEs and CEs, and import VPN routes.</span><p><p># Configure the NPE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE] <strong>ospf 100 vpn-instance VPN1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-ospf-100] <strong>domain-id 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-ospf-100] <strong>import-route bgp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-ospf-100] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-ospf-100-area-0.0.0.0] <strong>network 10.10.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-ospf-100-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-ospf-100] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE] ospf 200 <strong>vpn-instance VPN2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-ospf-200] <strong>domain-id 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-ospf-200] <strong>import-route bgp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-ospf-200] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-ospf-200-area-0.0.0.0] <strong>network 10.20.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-ospf-200-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-ospf-200] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-bgp] <strong>ipv4-family vpn-instance VPN1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-bgp-VPN1] <strong>import-route direct</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-bgp-VPN1] <strong>import-route ospf 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-bgp-VPN1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-bgp] <strong>ipv4-family vpn-instance VPN2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-bgp-VPN2] <strong>import-route direct</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-bgp-VPN2] <strong>import-route ospf 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-bgp-VPN2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE]<strong> commit</strong></pre>
<p># Configure CE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>ospf 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-ospf-100] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-ospf-100-area-0.0.0.0] <strong>network 10.10.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-ospf-100-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-ospf-100] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1]<strong> commit</strong></pre>
<p># Configure CE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>ospf 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-ospf-200] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-ospf-200-area-0.0.0.0] <strong>network 10.20.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-ospf-200-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-ospf-200] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1]<strong> commit</strong></pre>
<p># Configure the PE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE] <strong>ospf 100 vpn-instance VPN1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-ospf-100] <strong>domain-id 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-ospf-100] <strong>import-route bgp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-ospf-100] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-ospf-100-area-0.0.0.0] <strong>network 10.30.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-ospf-100-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-ospf-100] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE] <strong>ospf 200 vpn-instance VPN2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-ospf-200] <strong>domain-id 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-ospf-200] <strong>import-route bgp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-ospf-200] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-ospf-200-area-0.0.0.0] <strong>network 10.40.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-ospf-200-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-ospf-200] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-bgp] <strong>ipv4-family vpn-instance VPN1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-bgp-VPN1] <strong>import-route direct</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-bgp-VPN1] <strong>import-route ospf 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-bgp-VPN1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-bgp] <strong>ipv4-family vpn-instance VPN2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-bgp-VPN2] <strong>import-route direct</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-bgp-VPN2] <strong>import-route ospf 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-bgp-VPN2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE]<strong> commit</strong></pre>
<p># Configure CE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE3] <strong>ospf 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-ospf-100] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-ospf-100-area-0.0.0.0] <strong>network 10.30.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-ospf-100-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-ospf-100] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3]<strong> commit</strong></pre>
<p># Configure CE4.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE4] <strong>ospf 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE4-ospf-200] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE4-ospf-200-area-0.0.0.0] <strong>network 10.40.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE4-ospf-200-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE4-ospf-200] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE4]<strong> commit</strong></pre>
</p></li><li><span>Establish MP-IBGP peer relationships between the NPE and PE.</span><p><p># Configure the NPE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-bgp] <strong>peer 3.3.3.9 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-bgp] <strong>peer 3.3.3.9 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-bgp] <strong>ipv4-family vpnv4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-bgp-af-vpnv4] <strong>peer 3.3.3.9 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-bgp-af-vpnv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE]<strong> commit</strong></pre>
<p># Configure the PE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-bgp] <strong>peer 2.2.2.9 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-bgp] <strong>peer 2.2.2.9 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-bgp] <strong>ipv4-family vpnv4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-bgp-af-vpnv4] <strong>peer 2.2.2.9 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-bgp-af-vpnv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE]<strong> commit</strong></pre>
<p>After completing the configurations, run the <strong>display bgp peer</strong> command on the PE or NPE. The command output shows that the BGP peer relationship between the PE and NPE has been established and the status of the peer relationship is <strong>Established</strong>. The following example uses the command output on the NPE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE] <strong>display bgp peer</strong></pre>
<pre class="screen"> BGP local router ID : 2.2.2.9</pre>
<pre class="screen"> Local AS number : 100</pre>
<pre class="screen"> Total number of peers : 1          Peers in established state : 1</pre>
<pre class="screen">  Peer            V   AS  MsgRcvd  MsgSent  OutQ  Up/Down       State PrefRcv</pre>
<pre class="screen">  3.3.3.9        4   100         2         6     0 00:00:12 <strong>Established</strong>       2</pre>
</p></li><li><span>Verify the configuration.</span><p><p># Run the <strong>display ip routing-table vpn-instance</strong> command on the PE or NPE. The command output shows the routes to remote CEs.</p>
<p>The following example uses the command output on the NPE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE] <strong>display ip routing-table vpn-instance VPN1</strong></pre>
<pre class="screen"><span class="keyword">Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route</span></pre>
<pre class="screen">------------------------------------------------------------------------------</pre>
<pre class="screen">Routing Table: VPN1</pre>
<pre class="screen">         Destinations : 4        Routes : 4</pre>
<pre class="screen">Destination/Mask    Proto   Pre  Cost   Flags NextHop      Interface</pre>
<pre class="screen">10.10.1.0/24        Direct  0    0      D     10.10.1.2    Virtual-Ethernet<span>0/2/1</span>.1</pre>
<pre class="screen">10.10.1.2/32        Direct  0    0      D     127.0.0.1    InLoopBack0</pre>
<pre class="screen">10.30.1.0/24        IBGP    255  0      RD    3.3.3.9      GigabitEthernet<span>0/1/0</span>
255.255.255.255/32  Direct  0    0      D     127.0.0.1    InLoopBack0</pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE] <strong>display ip routing-table vpn-instance VPN2</strong></pre>
<pre class="screen"><span class="keyword">Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route</span></pre>
<pre class="screen">------------------------------------------------------------------------------</pre>
<pre class="screen">Routing Table: VPN2</pre>
<pre class="screen">         Destinations : 4        Routes : 4</pre>
<pre class="screen">Destination/Mask    Proto   Pre  Cost  Flags NextHop      Interface</pre>
<pre class="screen">10.20.1.0/24        Direct  0    0      D    10.20.1.2    Virtual-Ethernet<span>0/2/1</span>.2</pre>
<pre class="screen">10.20.1.2/32        Direct  0    0      D    127.0.0.1    InLoopBack0</pre>
<pre class="screen">10.40.1.0/24        IBGP    255  0      RD   3.3.3.9      GigabitEthernet<span>0/1/0</span>
255.255.255.255/32  Direct  0    0      D    127.0.0.1    InLoopBack0</pre>
<p># The ping operations between CE1 and CE3 and between CE2 and CE4 are successful.</p>
<p>The following example uses the command output on CE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>ping 10.30.1.1</strong></pre>
<pre class="screen">  PING 10.30.1.1: 56  data bytes, press CTRL_C to break</pre>
<pre class="screen">    Reply from 10.30.1.1: bytes=56 Sequence=1 ttl=255 time=31 ms</pre>
<pre class="screen">    Reply from 10.30.1.1: bytes=56 Sequence=2 ttl=255 time=10 ms</pre>
<pre class="screen">    Reply from 10.30.1.1: bytes=56 Sequence=3 ttl=255 time=5 ms</pre>
<pre class="screen">    Reply from 10.30.1.1: bytes=56 Sequence=4 ttl=255 time=2 ms</pre>
<pre class="screen">    Reply from 10.30.1.1: bytes=56 Sequence=5 ttl=255 time=28 ms</pre>
<pre class="screen">  --- 10.30.1.1 ping statistics ---</pre>
<pre class="screen">    5 packet(s) transmitted</pre>
<pre class="screen">    5 packet(s) received</pre>
<pre class="screen">    0.00% packet loss</pre>
<pre class="screen">    round-trip min/avg/max = 2/15/31 ms</pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172370388__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>UPE configuration file</p>
<pre class="screen">#</pre>
<pre class="screen"> sysname UPE</pre>
<pre class="screen">#</pre>
<pre class="screen"> mpls lsr-id 1.1.1.9</pre>
<pre class="screen"> mpls</pre>
<pre class="screen">#</pre>
<pre class="screen"> mpls l2vpn</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls ldp</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span>.1</pre>
<pre class="screen"> vlan-type dot1q 100</pre>
<pre class="screen"> mpls l2vc 2.2.2.9 101</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/2/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.1.1.1 255.255.255.0</pre>
<pre class="screen"> mpls</pre>
<pre class="screen"> mpls ldp</pre>
<pre class="screen">#</pre>
<pre class="screen">interface LoopBack1</pre>
<pre class="screen"> ip address 1.1.1.9 255.255.255.255</pre>
<pre class="screen">#</pre>
<pre class="screen">ospf 1</pre>
<pre class="screen"> area 0.0.0.0</pre>
<pre class="screen">  network 1.1.1.9 0.0.0.0</pre>
<pre class="screen">  network 10.1.1.0 0.0.0.255</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p>NPE configuration file</p>
<pre class="screen">#</pre>
<pre class="screen"> sysname NPE</pre>
<pre class="screen">#</pre>
<pre class="screen">ip vpn-instance VPN1</pre>
<pre class="screen"> ipv4-family</pre>
<pre class="screen"> route-distinguisher 100:1</pre>
<pre class="screen"> apply-label per-instance</pre>
<pre class="screen"> vpn-target 111:1 export-extcommunity</pre>
<pre class="screen"> vpn-target 111:1 import-extcommunity</pre>
<pre class="screen">#</pre>
<pre class="screen">ip vpn-instance VPN2</pre>
<pre class="screen"> ipv4-family</pre>
<pre class="screen"> route-distinguisher 200:1</pre>
<pre class="screen"> apply-label per-instance</pre>
<pre class="screen"> vpn-target 222:1 export-extcommunity</pre>
<pre class="screen"> vpn-target 222:1 import-extcommunity</pre>
<pre class="screen">#</pre>
<pre class="screen"> mpls lsr-id 2.2.2.9</pre>
<pre class="screen"> mpls</pre>
<pre class="screen">#</pre>
<pre class="screen"> mpls l2vpn</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls ldp</pre>
<pre class="screen">#</pre>
<pre class="screen">isis 1</pre>
<pre class="screen"> network-entity 10.0000.0000.0001.00</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.2.2.1 255.255.255.0</pre>
<pre class="screen"> isis enable 1</pre>
<pre class="screen"> mpls</pre>
<pre class="screen"> mpls ldp</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/2/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.1.1.2 255.255.255.0</pre>
<pre class="screen"> mpls</pre>
<pre class="screen"> mpls ldp</pre>
<pre class="screen">#</pre>
<pre class="screen">interface Virtual-Ethernet<span>0/2/0</span></pre>
<pre class="screen"> ve-group 1 l2-terminate</pre>
<pre class="screen"> quit </pre>
<pre class="screen">#
interface Virtual-Ethernet<span>0/2/0</span>.1
 vlan-type dot1q 100
 mpls l2vc 1.1.1.9 101</pre>
<pre class="screen">#</pre>
<pre class="screen">interface Virtual-Ethernet<span>0/2/1</span></pre>
<pre class="screen"> ve-group 1 <span>l3-access</span></pre>
<pre class="screen">#</pre>
<pre class="screen">interface Virtual-Ethernet<span>0/2/1</span>.1</pre>
<pre class="screen">control-vid 1 qinq-termination</pre>
<pre class="screen"> encapsulation qinq-termination</pre>
<pre class="screen"> qinq termination pe-vid 100 ce-vid 10</pre>
<pre class="screen"> ip binding vpn-instance VPN1</pre>
<pre class="screen"> ip address 10.10.1.2 255.255.255.0</pre>
<pre class="screen"> arp broadcast enable</pre>
<pre class="screen">#</pre>
<pre class="screen">interface Virtual-Ethernet<span>0/2/1</span>.2</pre>
<pre class="screen">control-vid 1 qinq-termination</pre>
<pre class="screen"> encapsulation qinq-termination</pre>
<pre class="screen"> qinq termination pe-vid 100 ce-vid 20</pre>
<pre class="screen"> ip binding vpn-instance VPN2</pre>
<pre class="screen"> ip address 10.20.1.2 255.255.255.0</pre>
<pre class="screen"> arp broadcast enable</pre>
<pre class="screen">#</pre>
<pre class="screen">interface LoopBack1</pre>
<pre class="screen"> ip address 2.2.2.9 255.255.255.255</pre>
<pre class="screen"> isis enable 1</pre>
<pre class="screen">#</pre>
<pre class="screen">bgp 100</pre>
<pre class="screen"> peer 3.3.3.9 as-number 100</pre>
<pre class="screen"> peer 3.3.3.9 connect-interface LoopBack1</pre>
<pre class="screen"> #</pre>
<pre class="screen"> ipv4-family unicast</pre>
<pre class="screen">  undo synchronization</pre>
<pre class="screen">  peer 3.3.3.9 enable</pre>
<pre class="screen">#</pre>
<pre class="screen"> ipv4-family vpnv4</pre>
<pre class="screen">  policy vpn-target</pre>
<pre class="screen">  peer 3.3.3.9 enable</pre>
<pre class="screen">#</pre>
<pre class="screen">ipv4-family vpn-instance VPN1</pre>
<pre class="screen">  import-route ospf 100</pre>
<pre class="screen">  import-route direct</pre>
<pre class="screen">#</pre>
<pre class="screen">ipv4-family vpn-instance VPN2</pre>
<pre class="screen">  import-route ospf 200</pre>
<pre class="screen">  import-route direct</pre>
<pre class="screen">#</pre>
<pre class="screen">ospf 1</pre>
<pre class="screen"> area 0.0.0.0</pre>
<pre class="screen">  network 2.2.2.9 0.0.0.0</pre>
<pre class="screen">  network 10.1.1.0 0.0.0.255</pre>
<pre class="screen">#</pre>
<pre class="screen">ospf 100 vpn-instance VPN1</pre>
<pre class="screen"> import-route bgp</pre>
<pre class="screen"> domain-id 0.0.0.10</pre>
<pre class="screen"> area 0.0.0.0</pre>
<pre class="screen">  network 10.10.1.0 0.0.0.255</pre>
<pre class="screen">#</pre>
<pre class="screen">ospf 200 vpn-instance VPN2</pre>
<pre class="screen"> import-route bgp</pre>
<pre class="screen"> domain-id 0.0.0.20</pre>
<pre class="screen"> area 0.0.0.0</pre>
<pre class="screen">  network 10.20.1.0 0.0.0.255</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p>PE configuration file</p>
<pre class="screen">#</pre>
<pre class="screen"> sysname PE</pre>
<pre class="screen">#</pre>
<pre class="screen">ip vpn-instance VPN1</pre>
<pre class="screen"> route-distinguisher 100:2</pre>
<pre class="screen"> apply-label per-instance</pre>
<pre class="screen"> ipv4-family</pre>
<pre class="screen"> vpn-target 111:1 export-extcommunity</pre>
<pre class="screen"> vpn-target 111:1 import-extcommunity</pre>
<pre class="screen">#</pre>
<pre class="screen">ip vpn-instance VPN2</pre>
<pre class="screen"> route-distinguisher 200:2</pre>
<pre class="screen"> apply-label per-instance</pre>
<pre class="screen"> ipv4-family</pre>
<pre class="screen"> vpn-target 222:1 export-extcommunity</pre>
<pre class="screen"> vpn-target 222:1 import-extcommunity</pre>
<pre class="screen">#</pre>
<pre class="screen"> mpls lsr-id 3.3.3.9</pre>
<pre class="screen"> mpls</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls ldp</pre>
<pre class="screen">#</pre>
<pre class="screen">isis 1</pre>
<pre class="screen"> network-entity 10.0000.0000.0002.00</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip binding vpn-instance VPN1</pre>
<pre class="screen"> ip address 10.30.1.2 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/3/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip binding vpn-instance VPN2</pre>
<pre class="screen"> ip address 10.40.1.2 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/2/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.2.2.2 255.255.255.0</pre>
<pre class="screen"> isis enable 1</pre>
<pre class="screen"> mpls</pre>
<pre class="screen"> mpls ldp</pre>
<pre class="screen">#</pre>
<pre class="screen">interface LoopBack1</pre>
<pre class="screen"> ip address 3.3.3.9 255.255.255.255</pre>
<pre class="screen"> isis enable 1</pre>
<pre class="screen">#</pre>
<pre class="screen">bgp 100</pre>
<pre class="screen"> peer 2.2.2.9 as-number 100</pre>
<pre class="screen"> peer 2.2.2.9 connect-interface LoopBack1</pre>
<pre class="screen"> #</pre>
<pre class="screen"> ipv4-family unicast</pre>
<pre class="screen">  undo synchronization</pre>
<pre class="screen">  peer 2.2.2.9 enable</pre>
<pre class="screen">#</pre>
<pre class="screen"> ipv4-family vpnv4</pre>
<pre class="screen">  policy vpn-target</pre>
<pre class="screen">  peer 2.2.2.9 enable</pre>
<pre class="screen">#</pre>
<pre class="screen">ipv4-family vpn-instance VPN1</pre>
<pre class="screen">  import-route ospf 100</pre>
<pre class="screen">  import-route direct</pre>
<pre class="screen">#</pre>
<pre class="screen">ipv4-family vpn-instance VPN2</pre>
<pre class="screen">  import-route ospf 200</pre>
<pre class="screen">  import-route direct</pre>
<pre class="screen">#</pre>
<pre class="screen">ospf 100 vpn-instance VPN1</pre>
<pre class="screen"> import-route bgp</pre>
<pre class="screen"> domain-id 0.0.0.10</pre>
<pre class="screen"> area 0.0.0.0</pre>
<pre class="screen">  network 10.30.1.0 0.0.0.255</pre>
<pre class="screen">#</pre>
<pre class="screen">ospf 200 vpn-instance VPN2</pre>
<pre class="screen"> import-route bgp</pre>
<pre class="screen"> domain-id 0.0.0.20</pre>
<pre class="screen"> area 0.0.0.0</pre>
<pre class="screen">  network 10.40.1.0 0.0.0.255</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p>Switch configuration file</p>
<pre class="screen">#</pre>
<pre class="screen"> sysname Switch</pre>
<pre class="screen">#</pre>
<pre class="screen"> vlan batch 100</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> port trunk allow-pass vlan 100</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/3/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> port vlan-stacking vlan 10 stack-vlan 100</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/1</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> port vlan-stacking vlan 20 stack-vlan 100</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p>CE1 configuration file</p>
<pre class="screen">#</pre>
<pre class="screen"> sysname CE1</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span>.1</pre>
<pre class="screen"> vlan-type dot1q 10</pre>
<pre class="screen"> ip address 10.10.1.1 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">ospf 100</pre>
<pre class="screen"> area 0.0.0.0</pre>
<pre class="screen">  network 10.10.1.0 0.0.0.255</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p>CE2 configuration file</p>
<pre class="screen">#</pre>
<pre class="screen"> sysname CE2</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span>.1</pre>
<pre class="screen"> vlan-type dot1q 20</pre>
<pre class="screen"> ip address 10.20.1.1 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">ospf 200</pre>
<pre class="screen"> area 0.0.0.0</pre>
<pre class="screen">  network 10.20.1.0 0.0.0.255</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p>CE3 configuration file</p>
<pre class="screen">#</pre>
<pre class="screen"> sysname CE3</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.30.1.1 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">ospf 100</pre>
<pre class="screen"> area 0.0.0.0</pre>
<pre class="screen">  network 10.30.1.0 0.0.0.255</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p>CE4 configuration file</p>
<pre class="screen">#</pre>
<pre class="screen"> sysname CE4</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.40.1.1 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">ospf 200</pre>
<pre class="screen"> area 0.0.0.0</pre>
<pre class="screen">  network 10.40.1.0 0.0.0.255</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2-l3_cfg_5013.html">Configuration Examples for L2VPN Accessing L3VPN
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2-l3_cfg_5028.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>
</body>
</html>