
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring EVPN L3VPN HoVPN over MPLS">
<meta name="abstract" content="On an EVPN L3VPN HoVPN over MPLS network, the UPE only needs to obtain a default route from the SPE. This implementation reduces the route storage space required on the UPE while ensuring route isolation.">
<meta name="description" content="On an EVPN L3VPN HoVPN over MPLS network, the UPE only needs to obtain a default route from the SPE. This implementation reduces the route storage space required on the UPE while ensuring route isolation.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0079.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0081.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="p00915595,w00800033,w00556928,l00468467,w00606909,evpnvrp,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="p00915595">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00878323">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172370557">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring EVPN L3VPN HoVPN over MPLS</title>
</head>
<body><a name="EN-US_TASK_0172370557"></a><a name="EN-US_TASK_0172370557"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring EVPN L3VPN HoVPN over MPLS</h1>
<div class="taskbody"><p>On an EVPN L3VPN HoVPN over MPLS network, the UPE only needs to obtain a default route from the SPE. This implementation reduces the route storage space required on the UPE while ensuring route isolation.</p>
<div class="context"><a name="EN-US_TASK_0172370557__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><div class="p">In EVPN L3VPN HoVPN over MPLS networking, you need to perform the following configurations:<ol><li><div class="p"><a href="dc_vrp_evpn_cfg_0039.html">Create a VPN instance</a> on the UPE, SPE, and NPE. Then bind access-side interfaces to an <a href="dc_vrp_mpls-l3vpn-v4_cfg_0156.html">IPv4 VPN instance</a><span> or <a href="dc_vrp_mpls-l3vpn-v6_cfg_2059.html">IPv6 VPN instance</a></span> on the UPE and NPE. <div class="note" id="EN-US_TASK_0172370557__note_transit_vpn"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0172370557__p570058839214055">According to related standards, the VPN instance status obtained through an NMS can be up only when at least one interface bound to the VPN instance is up. In an HoVPN scenario, an SPE does not require any interface to be bound to a VPN instance. Consequently, the VPN instance status obtained by an NMS is down according to the standards, which is opposite to the actual VPN instance status. In this case, you can run the <a href="cmdqueryname=transit-vpn"><b><span class="cmdname" id="EN-US_TASK_0172370557__cmdname1753245486214055">transit-vpn</span></b></a> command in the VPN instance view or VPN instance IPv4<span>/IPv6</span> address family view on the SPE. Then, the VPN instance status obtained by the NMS remains up, regardless of the binding status between the VPN instance and interface.</p>
</div></div>
</div>
</li><li><p>Configure BGP EVPN peer relationships between the UPE and SPE and between the SPE and NPE. For details, see <a href="dc_vrp_evpn_cfg_0006.html">Configuring BGP EVPN Peer Relationships</a>.</p>
</li><li><p>Configure routing protocols for the NPE and UPE to exchange routes with connected CEs. This configuration is similar to configuring the PE and CE to exchange routes on a basic BGP/MPLS IP VPN. For details, see <a href="dc_vrp_mpls-l3vpn-v4_cfg_0158.html">Configuring Route Exchange Between PEs and CEs</a><span> or <a href="dc_vrp_mpls-l3vpn-v6_cfg_2061.html">Configuring IPv6 Route Exchange Between PEs and CEs</a></span>.</p>
</li><li><p>Configure the SPE to advertise only default or summary routes to the UPE. For details, see <a href="#EN-US_TASK_0172370557__process1">Procedure</a>.</p>
</li></ol>
</div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172370557__1.4.2"></a><a name="1.4.2"></a><h4 class="sectiontitle">Procedure</h4>
<a name="EN-US_TASK_0172370557__process1"></a><a name="process1"></a><ol id="EN-US_TASK_0172370557__process1"><li><span>Configure the SPE to advertise only default or summary routes to the UPE.</span><p><ul><li><p>Configure the SPE to advertise the default route to the UPE.</p>
<ol type="a"><li><p>Run the <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a> command to enter the system view.</p>
</li><li><p>Run the <a href="cmdqueryname=ip+route-static+vpn-instance"><b><span class="cmdname">ip route-static vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i> <strong>0.0.0.0</strong> { <strong>0.0.0.0</strong> | <strong>0</strong> } { <i><span class="varname">nexthop-address</span></i> | <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i> [ <i><span class="varname">nexthop-address</span></i> ] }<span> or <a href="cmdqueryname=ipv6+route-static+vpn-instance"><b><span class="cmdname">ipv6 route-static vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i> <strong>0::0</strong> <strong>0</strong> { <i><span class="varname">nexthop-ipv6-address</span></i> | <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i> [ <i><span class="varname">nexthop-ipv6-address</span></i> ] }</span> command to create the default VPN IPv4<span>/IPv6</span> static route.</p>
</li><li><p>Run the <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i> command to enter the BGP view.</p>
</li><li><p>Run the <a href="cmdqueryname=ipv4-family"><b><span class="cmdname">ipv4-family</span></b></a> <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i><span> or <a href="cmdqueryname=ipv6-family"><b><span class="cmdname">ipv6-family</span></b></a> <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i></span> command to enter the BGP-VPN instance IPv4<span>/IPv6</span> address family view.</p>
</li><li><p>Run the <a href="cmdqueryname=network"><b><span class="cmdname">network</span></b></a> <strong>0.0.0.0</strong> [ <strong>0.0.0.0</strong> | <strong>0</strong> ] [ <strong><span>route-policy</span></strong> <i><span class="varname">route-policy-name</span></i> ]<span> or <a href="cmdqueryname=network"><b><span class="cmdname">network</span></b></a> <strong>0::0</strong> <strong>0</strong> [ <strong><span>route-policy</span></strong> <i><span class="varname">route-policy-name</span></i> ]</span> command to import the default routes into the VRF table of the IPv4<span>/IPv6</span> VPN instance.</p>
</li><li><p>Run the <a href="cmdqueryname=advertise+l2vpn+evpn"><b><span class="cmdname">advertise l2vpn evpn</span></b></a> command to configure the device to advertise IP prefix routes.</p>
</li><li><p>Run the <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a> command to return to the BGP view.</p>
</li><li><p>Run the <a href="cmdqueryname=l2vpn-family+evpn"><b><span class="cmdname">l2vpn-family evpn</span></b></a> command to enter the BGP EVPN address family view.</p>
</li><li><p>Run the <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>upe</span></strong> command to configure the UPE as the device's peer.</p>
</li><li><p>Run the <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a> command to commit the configuration.</p>
</li></ol>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this case, you also need to configure a routing policy on the NPE to prevent it from receiving the default route.</p>
</div></div>
</li><li><p>Configure the SPE to advertise a summary route to the UPE.</p>
<ol type="a"><li><p>Run the <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a> command to enter the system view.</p>
</li><li><p>Run the <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i> command to enter the BGP view.</p>
</li><li><p>Run the <a href="cmdqueryname=ipv4-family"><b><span class="cmdname">ipv4-family</span></b></a> <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i><span> or <a href="cmdqueryname=ipv6-family"><b><span class="cmdname">ipv6-family</span></b></a> <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i></span> command to enter the BGP-VPN instance IPv4<span>/IPv6</span> address family view.</p>
</li><li><p>Run the <a href="cmdqueryname=aggregate"><b><span class="cmdname">aggregate</span></b></a> <i><span class="varname">ipv4-address</span></i> { <i><span class="varname">mask</span></i> | <i><span class="varname">mask-length</span></i> } [ <strong><span>as-set</span></strong> | <strong><span>attribute-policy</span></strong> <i><span class="varname">route-policy-name1</span></i> | <strong><span>detail-suppressed</span></strong> | <strong><span>origin-policy</span></strong> <i><span class="varname">route-policy-name2</span></i> | <strong><span>suppress-policy</span></strong> <i><span class="varname">route-policy-name3</span></i> ] <sup>*</sup><span> or <a href="cmdqueryname=aggregate"><b><span class="cmdname">aggregate</span></b></a> <i><span class="varname">ipv6-address</span></i> <i><span class="varname">prefix-length</span></i> [ <strong><span>as-set</span></strong> | <strong><span>attribute-policy</span></strong> <i><span class="varname">route-policy-name1</span></i> | <strong><span>detail-suppressed</span></strong> | <strong><span>origin-policy</span></strong> <i><span class="varname">route-policy-name2</span></i> | <strong><span>suppress-policy</span></strong> <i><span class="varname">route-policy-name3</span></i> ] <sup>*</sup></span> command to configure a summary route.</p>
</li><li><p>Run the <a href="cmdqueryname=advertise+l2vpn+evpn"><b><span class="cmdname">advertise l2vpn evpn</span></b></a> command to configure the device to advertise IP prefix routes.</p>
</li><li><p>Run the <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a> Return to the BGP view.</p>
</li><li><p>Run the <a href="cmdqueryname=l2vpn-family+evpn"><b><span class="cmdname">l2vpn-family evpn</span></b></a> command to enter the BGP EVPN address family view.</p>
</li><li><p>Run the <a href="cmdqueryname=peer+upe"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>upe</span></strong> command to configure the UPE as the device's peer.</p>
</li><li><p>Run the <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a> command to commit the configuration.</p>
</li></ol>
</li></ul>
</p></li><li><span>(Optional) Configure the SPE to change the next hops of routes. If the UPE and NPE are not in the same IGP routing domain, perform this step on the SPE.</span><p><ol type="a"><li><p>Run the <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a> command to enter the system view.</p>
</li><li><p>Run the <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i> command to enter the BGP view.</p>
</li><li><p>Run the <a href="cmdqueryname=l2vpn-family+evpn"><b><span class="cmdname">l2vpn-family evpn</span></b></a> command to enter the BGP EVPN address family view.</p>
</li><li><p>Run the <a href="cmdqueryname=peer+next-hop-local"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>next-hop-local</span></strong> command to configure the device to change the next hop address of a route to its own address before advertising the route to the NPE.</p>
</li><li><p>Run the <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a> command to commit the configuration.</p>
</li></ol>
</p></li></ol></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0079.html">Configuring EVPN L3VPN HVPN over MPLS
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0081.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>