
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="(Optional) Setting a Redundancy Mode and DF Priority per ESI Instance">
<meta name="abstract" content="In a scenario where multiple CEs are dual-homed to PEs, if you want to use different transmission modes (load balancing and non-load balancing) to send unicast traffic to different CEs or if you want to specify DFs for traffic forwarding by setting priority values, you can set a redundancy mode and DF priority values based on ESIs.">
<meta name="description" content="In a scenario where multiple CEs are dual-homed to PEs, if you want to use different transmission modes (load balancing and non-load balancing) to send unicast traffic to different CEs or if you want to specify DFs for traffic forwarding by setting priority values, you can set a redundancy mode and DF priority values based on ESIs.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0003.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0007.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0076.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="p00915595,w00800033,w00556928,l00468467,w00606909,evpnvrp,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="p00915595">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="p00915595">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172370442">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>(Optional) Setting a Redundancy Mode and DF Priority per ESI Instance</title>
</head>
<body><a name="EN-US_TASK_0172370442"></a><a name="EN-US_TASK_0172370442"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">(Optional) Setting a Redundancy Mode and DF Priority per ESI Instance</h1>
<div class="taskbody" id="taskbody1149643255214055"><p id="shortdesc2140509917214055">In a scenario where multiple CEs are dual-homed to PEs, if you want to use different transmission modes (load balancing and non-load balancing) to send unicast traffic to different CEs or if you want to specify DFs for traffic forwarding by setting priority values, you can set a redundancy mode and DF priority values based on ESIs.</p>
<div class="context"><a name="EN-US_TASK_0172370442__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p" id="EN-US_TASK_0172370442__context1967975585214055"><p id="EN-US_TASK_0172370442__p222526001214055">On the network shown in <a href="#EN-US_TASK_0172370442__fig_dc_vrp_evpn_cfg_011001">Figure 1</a>, CE1 and CE2 are each dual-homed to PE1 and PE2. The PE interfaces that connect to CE1 have ESI1 (shown in green), and the PE interfaces that connect to CE2 have ESI2 (shown in blue). If you want CE3-to-CE1 unicast traffic and CE3-to-CE2 unicast traffic to be transmitted in load balancing and non-load balancing modes, respectively, you can set a redundancy mode per ESI instance. Specifically, you can set the redundancy mode of the ESI1 instance to all-active and that of the ESI2 instance to single-active.</p>
<p id="EN-US_TASK_0172370442__p563631462411">If you want CE3-to-CE2 BUM traffic to be forwarded by PE1, configure ESI-based DF priority election on PE1 and PE2 and specify PE1 as the primary DF.</p>
<div class="fignone" id="EN-US_TASK_0172370442__fig_dc_vrp_evpn_cfg_011001"><a name="EN-US_TASK_0172370442__fig_dc_vrp_evpn_cfg_011001"></a><a name="fig_dc_vrp_evpn_cfg_011001"></a><span class="figcap"><b>Figure 1 </b>Setting a redundancy mode per ESI instance</span><br><span><img class="vsd" id="EN-US_TASK_0172370442__image1469940459214055" src="images/fig_dc_vrp_evpn_cfg_011001.png" width="NaN" height="NaN"></span></div>
<p id="EN-US_TASK_0172370442__p637419325214055">An ESI can be dynamically generated or statically configured. A redundancy mode per ESI instance must be set based on the ESI generation mode.</p>
</div></div>
<div class="steps-unordered"><a name="EN-US_TASK_0172370442__1.4.2"></a><a name="1.4.2"></a><h4 class="sectiontitle">Procedure</h4>
<ul id="EN-US_TASK_0172370442__steps-unordered944818927214055"><li id="EN-US_TASK_0172370442__step1832618846214055"><span id="EN-US_TASK_0172370442__cmd1614479448214055">Set a redundancy mode based on a statically configured ESI.</span><ol id="EN-US_TASK_0172370442__substeps1037877543214055"><li class="substepexpand" id="EN-US_TASK_0172370442__substep793890155214055"><span id="EN-US_TASK_0172370442__cmd595936274214055">Run <a href="cmdqueryname=system-view"><b><span class="cmdname" id="EN-US_TASK_0172370442__cmdname765019293214055">system-view</span></b></a></span><p><p id="EN-US_TASK_0172370442__p13713155517372">The system view is displayed.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0172370442__substep1413976041214055"><span id="EN-US_TASK_0172370442__cmd641283385214055">Run <a href="cmdqueryname=evpn+%28system+view%29"><b><span class="cmdname" id="EN-US_TASK_0172370442__cmdname77014159214055">evpn</span></b></a></span><p><p id="EN-US_TASK_0172370442__p3563105983719">The EVPN global configuration view is displayed.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0172370442__substep397979184214055"><span id="EN-US_TASK_0172370442__cmd1572068730214055">Run <a href="cmdqueryname=esi"><b><span class="cmdname" id="EN-US_TASK_0172370442__cmdname1188066149214055">esi</span></b></a> <i><span class="varname" id="EN-US_TASK_0172370442__varname7638201710359">esi</span></i></span><p><p id="EN-US_TASK_0172370442__p1223853133814">A static ESI instance name is configured. The <i><span class="varname" id="EN-US_TASK_0172370442__varname260764917401">esi</span></i> value must be the same as the name of the statically configured ESI.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0172370442__substep811913758214055"><span id="EN-US_TASK_0172370442__cmd723437668214055">Run <a href="cmdqueryname=evpn+redundancy-mode"><b><span class="cmdname" id="EN-US_TASK_0172370442__cmdname1520784002214055">evpn redundancy-mode</span></b></a> { <strong><span id="EN-US_TASK_0172370442__cmdparmname18637162513510">single-active</span></strong> | <strong><span id="EN-US_TASK_0172370442__cmdparmname063722511358">all-active</span></strong> }</span><p><p id="EN-US_TASK_0172370442__p1529984183811">A redundancy mode is configured for the static ESI instance.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0172370442__substep161316445244"><span id="EN-US_TASK_0172370442__cmd51394402417">(Optional) Run <a href="cmdqueryname=df-election+type+preference-based"><b><span class="cmdname" id="EN-US_TASK_0172370442__cmdname1828612382451">df-election type preference-based</span></b></a></span><p><p id="EN-US_TASK_0172370442__p3795125183815">Priority-based DF election is enabled.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0172370442__substep17548540182617"><span id="EN-US_TASK_0172370442__cmd454914408268">(Optional) Run <a href="cmdqueryname=preference"><b><span class="cmdname" id="EN-US_TASK_0172370442__cmdname8545122154615">preference</span></b></a> <i><span class="varname" id="EN-US_TASK_0172370442__varname2750174315357">preference</span></i></span><p><p id="EN-US_TASK_0172370442__p16365177143814">A priority value is set. A larger value indicates a higher priority.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0172370442__substep550132102717"><span id="EN-US_TASK_0172370442__cmd650122112714">(Optional) Run the <a href="cmdqueryname=non-revertive"><b><span class="cmdname" id="EN-US_TASK_0172370442__cmdname6694050114619">non-revertive</span></b></a> command to enable the non-revertive mode.</span><p><p id="EN-US_TASK_0172370442__p248113612272">As shown in <a href="#EN-US_TASK_0172370442__fig_dc_vrp_evpn_cfg_011001">Figure 1</a>, CE2 is dual-homed to PE1 and PE2. PE1 is elected as the primary DF to forward traffic because it has a higher priority. If PE1 fails, traffic is switched to PE2 for forwarding. After PE1 recovers, traffic is switched back to PE1. To reduce traffic switching times and maintain service topology stability, run the <a href="cmdqueryname=non-revertive"><b><span class="cmdname" id="EN-US_TASK_0172370442__cmdname14698145115527">non-revertive</span></b></a> command to disable traffic switchback.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0172370442__substep387282752214055"><span id="EN-US_TASK_0172370442__cmd38278807214055">Run <a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0172370442__cmdname1300385420214055">commit</span></b></a></span><p><p id="EN-US_TASK_0172370442__p946221383812">The configuration is committed.</p>
</p></li></ol>
</li><li id="EN-US_TASK_0172370442__step1022442789214055"><span id="EN-US_TASK_0172370442__cmd31811429214055">Set a redundancy mode based on a dynamically generated ESI.</span><ol id="EN-US_TASK_0172370442__substeps126764722214055"><li class="substepexpand" id="EN-US_TASK_0172370442__substep314527681214055"><span id="EN-US_TASK_0172370442__cmd1309479300214055">Run <a href="cmdqueryname=system-view"><b><span class="cmdname" id="EN-US_TASK_0172370442__cmdname1591847230214055">system-view</span></b></a></span><p><p id="EN-US_TASK_0172370442__p139962014133818">The system view is displayed.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0172370442__substep89071866214055"><span id="EN-US_TASK_0172370442__cmd234749903214055">Run <a href="cmdqueryname=evpn+%28system+view%29"><b><span class="cmdname" id="EN-US_TASK_0172370442__cmdname15983346214055">evpn</span></b></a></span><p><p id="EN-US_TASK_0172370442__p183516173817">The EVPN global configuration view is displayed.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0172370442__substep1613787007214055"><span id="EN-US_TASK_0172370442__cmd199765039214055">Run <a href="cmdqueryname=esi+dynamic-name"><b><span class="cmdname" id="EN-US_TASK_0172370442__cmdname812593514214055">esi dynamic-name</span></b></a> <i><span class="varname" id="EN-US_TASK_0172370442__varname329071193619">esi-name</span></i></span><p><p id="EN-US_TASK_0172370442__p5977141683811">A dynamic ESI instance name is configured.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0172370442__substep9686566214055"><span id="EN-US_TASK_0172370442__cmd1740841237214055">Run <a href="cmdqueryname=evpn+redundancy-mode"><b><span class="cmdname" id="EN-US_TASK_0172370442__cmdname1768223978214055">evpn redundancy-mode</span></b></a> { <strong><span id="EN-US_TASK_0172370442__cmdparmname1126213543613">single-active</span></strong> | <strong><span id="EN-US_TASK_0172370442__cmdparmname02671520361">all-active</span></strong> }</span><p><p id="EN-US_TASK_0172370442__p2023315188388">A redundancy mode is configured for the dynamic ESI instance.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0172370442__substep1667654216296"><span id="EN-US_TASK_0172370442__cmd867794212920">(Optional) Run <a href="cmdqueryname=df-election+type+preference-based"><b><span class="cmdname" id="EN-US_TASK_0172370442__cmdname730118816470">df-election type preference-based</span></b></a></span><p><p id="EN-US_TASK_0172370442__p95421319143816">Priority-based DF election is enabled.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0172370442__substep1894151053018"><span id="EN-US_TASK_0172370442__cmd119419101307">(Optional) Run <a href="cmdqueryname=preference"><b><span class="cmdname" id="EN-US_TASK_0172370442__cmdname20852327473">preference</span></b></a> <i><span class="varname" id="EN-US_TASK_0172370442__varname078992693616">preference</span></i></span><p><p id="EN-US_TASK_0172370442__p1240020208381">A priority value is set. A larger value indicates a higher priority.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0172370442__substep37312360309"><span id="EN-US_TASK_0172370442__cmd873123673018">(Optional) Run <a href="cmdqueryname=non-revertive"><b><span class="cmdname" id="EN-US_TASK_0172370442__cmdname1665874217476">non-revertive</span></b></a></span><p><p id="EN-US_TASK_0172370442__p15764156185619">The non-revertive mode is enabled.</p>
</p><p><p id="EN-US_TASK_0172370442__p1926653715232">As shown in <a href="#EN-US_TASK_0172370442__fig_dc_vrp_evpn_cfg_011001">Figure 1</a>, CE2 is dual-homed to PE1 and PE2. PE1 is elected as the primary DF to forward traffic because it has a higher priority. If PE1 fails, traffic is switched to PE2 for forwarding. After PE1 recovers, traffic is switched back to PE1. To reduce traffic switching times and maintain service topology stability, run the <a href="cmdqueryname=non-revertive"><b><span class="cmdname" id="EN-US_TASK_0172370442__cmdname1749195655218">non-revertive</span></b></a> command to disable traffic switchback.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0172370442__substep65248177214055"><span id="EN-US_TASK_0172370442__cmd1409450869214055">Run <a href="cmdqueryname=quit"><b><span class="cmdname" id="EN-US_TASK_0172370442__cmdname1728130678214055">quit</span></b></a></span><p><p id="EN-US_TASK_0172370442__p3769122612382">Return to the ESI-dynamic view.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0172370442__substep957047263214055"><span id="EN-US_TASK_0172370442__cmd440833211214055">Run <a href="cmdqueryname=quit"><b><span class="cmdname" id="EN-US_TASK_0172370442__cmdname1210211015359">quit</span></b></a></span><p><p id="EN-US_TASK_0172370442__p3850132703815">Return to the EVPN global configuration view.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0172370442__substep401492185214055"><span id="EN-US_TASK_0172370442__cmd485534421214055">Run <a href="cmdqueryname=quit"><b><span class="cmdname" id="EN-US_TASK_0172370442__cmdname1730255248214055">quit</span></b></a></span><p><p id="EN-US_TASK_0172370442__p4826162815384">Return to the system view.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0172370442__substep1624443525214055"><span id="EN-US_TASK_0172370442__cmd1062720364214055">Run <a href="cmdqueryname=interface+eth-trunk"><b><span class="cmdname" id="EN-US_TASK_0172370442__cmdname204570394214055">interface eth-trunk</span></b></a> <i><span class="varname" id="EN-US_TASK_0172370442__varname11539218372">trunk-id</span></i></span><p><p id="EN-US_TASK_0172370442__p89331293385">The Eth-Trunk interface view is displayed.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0172370442__substep2129479375214055"><span id="EN-US_TASK_0172370442__cmd197394723214055">Run <a href="cmdqueryname=esi+dynamic"><b><span class="cmdname" id="EN-US_TASK_0172370442__cmdname546648372214055">esi dynamic</span></b></a> <i><span class="varname" id="EN-US_TASK_0172370442__varname1146016453716">esi-name</span></i></span><p><p id="EN-US_TASK_0172370442__p11964143243816">A dynamic ESI instance is bound to the Eth-Trunk interface.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0172370442__substep610545692214055"><span id="EN-US_TASK_0172370442__cmd764580078214055">Run <a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0172370442__cmdname683865138214055">commit</span></b></a></span><p><p id="EN-US_TASK_0172370442__p64593223814">The configuration is committed.</p>
</p></li></ol>
</li></ul></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0003.html">Configuring EVPN VPLS over MPLS (Common EVPN Instance)
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0007.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0076.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>