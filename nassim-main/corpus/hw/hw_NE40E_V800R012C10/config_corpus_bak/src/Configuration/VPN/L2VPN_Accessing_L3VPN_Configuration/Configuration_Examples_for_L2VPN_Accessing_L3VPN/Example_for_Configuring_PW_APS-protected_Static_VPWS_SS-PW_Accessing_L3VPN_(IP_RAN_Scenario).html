
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring PW APS-protected Static VPWS SS-PW Accessing L3VPN (IP RAN Scenario)">
<meta name="abstract" content="This section provides an example for configuring a static VPWS PW with PW APS protection on the L2VPN side to access an L3VPN.">
<meta name="description" content="This section provides an example for configuring a static VPWS PW with PW APS protection on the L2VPN side to access an L3VPN.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2-l3_cfg_5013.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2-l3_cfg_5017.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2-l3_cfg_5025.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,w00556928,w00606909,l00455378,l2-l3">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="L2VPN Accessing L3VPN">
<meta name="featuretype" content="VPN">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="L2VPN Accessing L3VPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="L2VPN Accessing L3VPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="L2VPN Accessing L3VPN">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="l00415692">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00415692">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172370385">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>Example for Configuring PW APS-protected Static VPWS SS-PW Accessing L3VPN (IP RAN Scenario)</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172370385"></a><a name="EN-US_TASK_0172370385"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring PW APS-protected Static VPWS SS-PW Accessing L3VPN (IP RAN Scenario)</h1>
<div class="taskbody"><p>This section provides an example for configuring a static VPWS PW with PW APS protection on the L2VPN side to access an L3VPN.</p>
<div class="context"><a name="EN-US_TASK_0172370385__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><div class="p">To enable an Ethernet base station to communicate with an EPC device, you can configure L2VPN accessing L3VPN. Specifically, you can create a VE group consisting of one L2VE interface and one L3VE interface on each ASG and use the L2VE interface to terminate the L2VPN and the L3VE interface to access the L3VPN. In addition, you can configure PW APS on the CSG and ASGs to protect static PWs and configure VPN FRR to protect L3VPN services. <a href="#EN-US_TASK_0172370385__fig_dc_vrp_l2-l3_cfg_502802">Figure 1</a> shows a simplified single-ring network.<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0172370385__en-us_task_0172370377_p13122204117209">This example uses VE interfaces to implement L2VPN accessing L3VPN. Because VE interfaces are bound to only one board, services are interrupted when the board fails. To improve service reliability, create two global VE interfaces on each ASG: Global-VE1 (L2VE interface used to terminate L2VPN services) and Global-VE2 (L3VE interface used to access an L3VPN network). Other configurations do not need to be changed.</p>
</div></div>
</div>
<div class="fignone" id="EN-US_TASK_0172370385__fig_dc_vrp_l2-l3_cfg_502802"><a name="EN-US_TASK_0172370385__fig_dc_vrp_l2-l3_cfg_502802"></a><a name="fig_dc_vrp_l2-l3_cfg_502802"></a><span class="figcap"><b>Figure 1 </b>Configuring PW APS-protected static VPWS SS-PW accessing L3VPN (IP RAN scenario)</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><div class="p"><ul><li>In this example, interface1 and interface2 represent GE<span>0/1/0</span> and GE<span>0/1/3</span>, respectively.</li></ul>
</div>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_l2-l3_cfg_502801.png"></span></div>

<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" frame="border" border="1" rules="all"><caption><b>Table 1 </b>Device interfaces and their IP addresses</caption><thead align="left"><tr><th align="left" class="cellrowborder" char="." valign="top" width="25.06250625062506%" id="mcps1.4.1.4.2.5.1.1" liSelected="liSelected"><p>Device</p>
</th>
<th align="left" class="cellrowborder" char="." valign="top" width="40.35403540354036%" id="mcps1.4.1.4.2.5.1.2" liSelected="liSelected"><p>Interface</p>
</th>
<th align="left" class="cellrowborder" char="." valign="top" width="17.291729172917293%" id="mcps1.4.1.4.2.5.1.3" liSelected="liSelected"><p>Peer Device</p>
</th>
<th align="left" class="cellrowborder" char="." valign="top" width="17.291729172917293%" id="mcps1.4.1.4.2.5.1.4" liSelected="liSelected"><p>IP Address</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" rowspan="3" char="." valign="top" width="25.06250625062506%" headers="mcps1.4.1.4.2.5.1.1 "><p>CSG</p>
</td>
<td class="cellrowborder" char="." valign="top" width="40.35403540354036%" headers="mcps1.4.1.4.2.5.1.2 "><p>GE<span>0/1/1</span></p>
</td>
<td class="cellrowborder" char="." valign="top" width="17.291729172917293%" headers="mcps1.4.1.4.2.5.1.3 "><p>ASG1</p>
</td>
<td class="cellrowborder" char="." valign="top" width="17.291729172917293%" headers="mcps1.4.1.4.2.5.1.4 "><p>172.16.1.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.5.1.2 "><p>GE<span>0/1/2</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.5.1.3 "><p>ASG2</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.5.1.4 "><p>172.16.4.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.5.1.2 "><p>GE<span>0/1/3</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.5.1.3 "><p>eNodeB</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.5.1.4 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="4" char="." valign="top" width="25.06250625062506%" headers="mcps1.4.1.4.2.5.1.1 "><p>ASG1</p>
</td>
<td class="cellrowborder" char="." valign="top" width="40.35403540354036%" headers="mcps1.4.1.4.2.5.1.2 "><p>GE<span>0/1/0</span></p>
</td>
<td class="cellrowborder" char="." valign="top" width="17.291729172917293%" headers="mcps1.4.1.4.2.5.1.3 "><p>ASG2</p>
</td>
<td class="cellrowborder" char="." valign="top" width="17.291729172917293%" headers="mcps1.4.1.4.2.5.1.4 "><p>172.16.2.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.5.1.2 "><p>GE<span>0/1/1</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.5.1.3 "><p>CSG</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.5.1.4 "><p>172.16.1.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.5.1.2 "><p>GE<span>0/1/3</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.5.1.3 "><p>RSG1</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.5.1.4 "><p>172.16.3.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.5.1.2 "><p>GE<span>0/1/4</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.5.1.3 "><p>RSG2</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.5.1.4 "><p>172.16.8.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="4" char="." valign="top" width="25.06250625062506%" headers="mcps1.4.1.4.2.5.1.1 "><p>ASG2</p>
</td>
<td class="cellrowborder" char="." valign="top" width="40.35403540354036%" headers="mcps1.4.1.4.2.5.1.2 "><p>GE<span>0/1/0</span></p>
</td>
<td class="cellrowborder" char="." valign="top" width="17.291729172917293%" headers="mcps1.4.1.4.2.5.1.3 "><p>ASG1</p>
</td>
<td class="cellrowborder" char="." valign="top" width="17.291729172917293%" headers="mcps1.4.1.4.2.5.1.4 "><p>172.16.2.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.5.1.2 "><p>GE<span>0/1/2</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.5.1.3 "><p>CSG</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.5.1.4 "><p>172.16.4.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.5.1.2 "><p>GE<span>0/1/3</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.5.1.3 "><p>RSG2</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.5.1.4 "><p>172.16.6.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.5.1.2 "><p>GE<span>0/1/4</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.5.1.3 "><p>RSG1</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.5.1.4 "><p>172.16.7.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="4" char="." valign="top" width="25.06250625062506%" headers="mcps1.4.1.4.2.5.1.1 "><p>RSG1</p>
</td>
<td class="cellrowborder" char="." valign="top" width="40.35403540354036%" headers="mcps1.4.1.4.2.5.1.2 "><p>GE<span>0/1/0</span></p>
</td>
<td class="cellrowborder" char="." valign="top" width="17.291729172917293%" headers="mcps1.4.1.4.2.5.1.3 "><p>RSG2</p>
</td>
<td class="cellrowborder" char="." valign="top" width="17.291729172917293%" headers="mcps1.4.1.4.2.5.1.4 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.5.1.2 "><p>GE<span>0/1/1</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.5.1.3 "><p>ASG1</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.5.1.4 "><p>172.16.3.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.5.1.2 "><p>GE<span>0/1/2</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.5.1.3 "><p>ASG2</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.5.1.4 "><p>172.16.7.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.5.1.2 "><p>GE<span>0/1/3</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.5.1.3 "><p>EPC</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.5.1.4 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="4" char="." valign="top" width="25.06250625062506%" headers="mcps1.4.1.4.2.5.1.1 "><p>RSG2</p>
</td>
<td class="cellrowborder" char="." valign="top" width="40.35403540354036%" headers="mcps1.4.1.4.2.5.1.2 "><p>GE<span>0/1/0</span></p>
</td>
<td class="cellrowborder" char="." valign="top" width="17.291729172917293%" headers="mcps1.4.1.4.2.5.1.3 "><p>RSG1</p>
</td>
<td class="cellrowborder" char="." valign="top" width="17.291729172917293%" headers="mcps1.4.1.4.2.5.1.4 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.5.1.2 "><p>GE<span>0/1/1</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.5.1.3 "><p>ASG2</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.5.1.4 "><p>172.16.6.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.5.1.2 "><p>GE<span>0/1/2</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.5.1.3 "><p>ASG1</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.5.1.4 "><p>172.16.8.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.5.1.2 "><p>GE<span>0/1/3</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.5.1.3 "><p>EPC</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.5.1.4 "><p>-</p>
</td>
</tr>
</tbody>
</table>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172370385__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li>Configure IP addresses on each device.</li><li>Configure IGP routes on each device.</li><li>Configure MPLS and public network tunnels. Specifically:<ul><li>Configure a static bidirectional co-routed LSP between the CSG and ASG1, between the CSG and ASG2, and between ASG1 and ASG2.</li><li>Configure LSPs between ASGs and RSGs.</li></ul>
</li><li>Configure static VPWS on the CSG and ASGs.</li><li>Configure PW APS on the CSG and ASGs.</li><li><p>Configure an L3VPN.</p>
<ul><li>Configure VPN instances on ASGs and RSGs.</li><li>Configure a VE group on each ASG, and bind the L3VE sub-interface in the group to the VPN instance on each ASG.</li><li>Establish MP-IBGP peer relationships between ASGs and RSGs.</li><li>Import direct routes into VPN instances on ASGs and RSGs.</li><li>Configure VPN FRR.</li></ul>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172370385__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>Interface numbers, interface IP addresses, and OSPF process IDs</p>
</li><li><p>L2VCs' destination addresses, VC IDs, and VC types</p>
</li><li><p>Names, local discriminators, and remote discriminators of BFD sessions</p>
</li><li><p>VE group number</p>
</li><li><p>Numbers and priorities of VRRP groups</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172370385__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure IP addresses for the CSG, ASGs, and RSGs. For configuration details, see <a href="#EN-US_TASK_0172370385__dc_vrp_l2-l3_cfg_502801">Configuration Files</a> in this section.</span></li><li><span>Configure an IGP on the CSG, ASGs, and RSGs. In this example, OSPF is used.</span><p><p># Configure the CSG.</p>
<pre class="screen">&lt;CSG&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CSG] <strong>ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-ospf-1] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-ospf-1-area-0.0.0.0] <strong>network 1.1.1.1 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-ospf-1-area-0.0.0.0] <strong>network 172.16.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-ospf-1-area-0.0.0.0] <strong>network 172.16.4.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-ospf-1-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-ospf-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG] <strong>commit</strong></pre>
<p># Configure ASG1.</p>
<pre class="screen">&lt;ASG1&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASG1] <strong>ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-ospf-1] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-ospf-1-area-0.0.0.0] <strong>network 2.2.2.2 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-ospf-1-area-0.0.0.0] <strong>network 172.16.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-ospf-1-area-0.0.0.0] <strong>network 172.16.2.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-ospf-1-area-0.0.0.0] <strong>network 172.16.3.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-ospf-1-area-0.0.0.0] <strong>network 172.16.8.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-ospf-1-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-ospf-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1] <strong>commit</strong></pre>
<p># Configure ASG2.</p>
<pre class="screen">&lt;ASG2&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASG2] <strong>ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-ospf-1] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-ospf-1-area-0.0.0.0] <strong>network 3.3.3.3 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-ospf-1-area-0.0.0.0] <strong>network 172.16.2.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-ospf-1-area-0.0.0.0] <strong>network 172.16.4.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-ospf-1-area-0.0.0.0] <strong>network 172.16.6.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-ospf-1-area-0.0.0.0] <strong>network 172.16.7.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-ospf-1-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-ospf-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2] <strong>commit</strong></pre>
<p># Configure RSG1.</p>
<pre class="screen">&lt;RSG1&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RSG1] <strong>ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-ospf-1] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-ospf-1-area-0.0.0.0] <strong>network 4.4.4.4 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-ospf-1-area-0.0.0.0] <strong>network 172.16.3.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-ospf-1-area-0.0.0.0] <strong>network 172.16.7.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-ospf-1-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-ospf-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1] <strong>commit</strong></pre>
<p># Configure RSG2.</p>
<pre class="screen">&lt;RSG2&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RSG2] <strong>ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG2-ospf-1] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG2-ospf-1-area-0.0.0.0] <strong>network 5.5.5.5 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG2-ospf-1-area-0.0.0.0] <strong>network 172.16.6.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG2-ospf-1-area-0.0.0.0] <strong>network 172.16.8.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG2-ospf-1-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG2-ospf-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG2] <strong>commit</strong></pre>
<p>After completing the configurations, check OSPF route information. The following example uses the command output on ASG1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASG1] <strong>display ospf routing</strong></pre>
<pre class="screen">          OSPF Process 1 with Router ID 172.16.1.2
                   Routing Tables

 Routing for Network
 Destination        Cost     Type       NextHop         AdvRouter       Area           
 1.1.1.1/32         1        Stub       172.16.1.1      172.16.1.1      0.0.0.0        
 2.2.2.2/32         0        Direct     2.2.2.2         172.16.1.2      0.0.0.0        
 3.3.3.3/32         1        Stub       172.16.2.1      172.16.4.2      0.0.0.0        
 172.16.1.0/24      1        Direct     172.16.1.2      172.16.1.2      0.0.0.0        
 172.16.2.0/24      1        Direct     172.16.2.2      172.16.1.2      0.0.0.0        
 172.16.4.0/24      2        Transit    172.16.1.1      172.16.1.1      0.0.0.0        
 172.16.4.0/24      2        Transit    172.16.2.1      172.16.1.1      0.0.0.0        

 Total Nets: 6
 Intra Area: 6  Inter Area: 0  ASE: 0  NSSA: 0</pre>
</p></li><li><span>Configure basic MPLS functions and public network tunnels.</span><ol type="a"><li class="substepexpand"><span>Configure a static bidirectional co-routed LSP between the CSG and ASG1, between the CSG and ASG2, and between ASG1 and ASG2.</span><p><p>Enable MPLS and MPLS TE both globally and per interface on nodes along the TE tunnel.</p>
<p># Configure the CSG.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CSG] <strong>mpls lsr-id 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-mpls] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-GigabitEthernet<span>0/1/1</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-GigabitEthernet<span>0/1/1</span>] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG] <strong>interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-GigabitEthernet<span>0/1/2</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-GigabitEthernet<span>0/1/2</span>] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG] <strong>commit</strong></pre>
<p># Configure ASG1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASG1] <strong>mpls lsr-id 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-mpls] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-GigabitEthernet<span>0/1/0</span>] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-GigabitEthernet<span>0/1/1</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-GigabitEthernet<span>0/1/1</span>] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1] <strong>commit</strong></pre>
<p># Configure ASG2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASG2] <strong>mpls lsr-id 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-mpls] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-GigabitEthernet<span>0/1/0</span>] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-GigabitEthernet<span>0/1/1</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-GigabitEthernet<span>0/1/1</span>] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2] <strong>commit</strong></pre>
<p>Configure MPLS TE tunnel interfaces.</p>
<p># On the CSG, configure two MPLS TE tunnels, one to ASG1 and the other to ASG2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CSG] <strong>interface Tunnel10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-Tunnel10] <strong>ip address unnumbered interface loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-Tunnel10] <strong>tunnel-protocol mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-Tunnel10] <strong>destination 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-Tunnel10] <strong>mpls te tunnel-id 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-Tunnel10] <strong>mpls te signal-protocol cr-static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-Tunnel10] <strong>mpls te bidirectional</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-Tunnel10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG] <strong>interface Tunnel11</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-Tunnel11] <strong>ip address unnumbered interface loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-Tunnel11] <strong>tunnel-protocol mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-Tunnel11] <strong>destination 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-Tunnel11] <strong>mpls te tunnel-id 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-Tunnel11] <strong>mpls te signal-protocol cr-static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-Tunnel11] <strong>mpls te bidirectional</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-Tunnel11] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG] <strong>commit</strong></pre>
<p># On ASG1, configure two MPLS TE tunnels, one to the CSG and the other to ASG2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASG1] <strong>interface Tunnel10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-Tunnel10] <strong>ip address unnumbered interface loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-Tunnel10] <strong>tunnel-protocol mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-Tunnel10] <strong>destination 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-Tunnel10] <strong>mpls te tunnel-id 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-Tunnel10] <strong>mpls te signal-protocol cr-static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-Tunnel10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1] <strong>interface Tunnel12</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-Tunnel12] <strong>ip address unnumbered interface loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-Tunnel12] <strong>tunnel-protocol mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-Tunnel12] <strong>destination 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-Tunnel12] <strong>mpls te tunnel-id 300</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-Tunnel12] <strong>mpls te signal-protocol cr-static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-Tunnel12] <strong>mpls te bidirectional</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-Tunnel12] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1] <strong>commit</strong></pre>
<p># On ASG2, configure two MPLS TE tunnels, one to the CSG and the other to ASG1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASG2] <strong>interface Tunnel11</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-Tunnel11] <strong>ip address unnumbered interface loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-Tunnel11] <strong>tunnel-protocol mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-Tunnel11] <strong>destination 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-Tunnel11] <strong>mpls te tunnel-id 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-Tunnel11] <strong>mpls te signal-protocol cr-static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-Tunnel11] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2] <strong>interface Tunnel12</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-Tunnel12] <strong>ip address unnumbered interface loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-Tunnel12] <strong>tunnel-protocol mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-Tunnel12] <strong>destination 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-Tunnel12] <strong>mpls te tunnel-id 300</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-Tunnel12] <strong>mpls te signal-protocol cr-static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-Tunnel12] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2]<strong>commit</strong></pre>
<p>Configure the ingress and egress for each static bidirectional co-routed LSP.</p>
<p># Configure the CSG as the ingress for the static bidirectional co-routed LSPs from the CSG to ASG1 and from the CSG to ASG2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CSG] <strong>bidirectional static-cr-lsp ingress Tunnel10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-bi-static-ingress-Tunnel10] <strong>forward outgoing-interface gigabitethernet <span>0/1/1</span> nexthop 172.16.1.2 out-label 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-bi-static-ingress-Tunnel10] <strong>backward in-label 30 lsrid 2.2.2.2 tunnel-id 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG] <strong>bidirectional static-cr-lsp ingress Tunnel11</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-bi-static-ingress-Tunnel11] <strong>forward outgoing-interface gigabitethernet <span>0/1/2</span> nexthop 172.16.4.2 out-label 40</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-bi-static-ingress-Tunnel11] <strong>backward in-label 50 lsrid 3.3.3.3 tunnel-id 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-bi-static-ingress-Tunnel11] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG] <strong>commit</strong></pre>
<p># Configure ASG1 as the egress for the static bidirectional co-routed LSP from the CSG to ASG1 and as the ingress for the static bidirectional co-routed LSP from ASG1 to ASG2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASG1] <strong>bidirectional static-cr-lsp egress Tunnel10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-bi-static-egress-Tunnel10] <strong>forward in-label 20 lsrid 1.1.1.1 tunnel-id 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-bi-static-egress-Tunnel10] <strong>backward outgoing-interface gigabitethernet <span>0/1/1</span> nexthop 172.16.1.1 out-label 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1] <strong>bidirectional static-cr-lsp ingress Tunnel12</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-bi-static-ingress-Tunnel12] <strong>forward outgoing-interface gigabitethernet <span>0/1/0</span> nexthop 172.16.2.1 out-label 60</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-bi-static-ingress-Tunnel12] <strong>backward in-label 70 lsrid 3.3.3.3 tunnel-id 300</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-bi-static-ingress-Tunnel12] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1] <strong>commit</strong></pre>
<p># Configure ASG2 as the egress for the static bidirectional co-routed LSP from the CSG to ASG2 and from ASG1 to ASG2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASG2] <strong>bidirectional static-cr-lsp egress Tunnel11 </strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-bi-static-egress-Tunnel11] <strong>forward in-label 40 lsrid 1.1.1.1 tunnel-id 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-bi-static-egress-Tunnel11] <strong>backward outgoing-interface gigabitethernet <span>0/1/2</span> nexthop 172.16.4.1 out-label 50</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-bi-static-egress-Tunnel11] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2] <strong>bidirectional static-cr-lsp egress Tunnel12 </strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-bi-static-egress-Tunnel12] <strong>forward in-label 60 lsrid 2.2.2.2 tunnel-id 300</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-bi-static-egress-Tunnel12] <strong>backward outgoing-interface gigabitethernet <span>0/1/0</span> nexthop 172.16.2.2 out-label 70</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-bi-static-egress-Tunnel12] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2] <strong>commit</strong></pre>
<p>Configure reverse tunnel binding on ASG1 and ASG2.</p>
<p># Configure ASG1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASG1] <strong>interface Tunnel10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-Tunnel10] <strong>mpls te passive-tunnel</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-Tunnel10] <strong>mpls te binding bidirectional static-cr-lsp egress Tunnel10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-Tunnel10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2] <strong>commit</strong></pre>
<p># Configure ASG2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASG2] <strong>interface Tunnel11</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-Tunnel11] <strong>mpls te passive-tunnel</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-Tunnel11] <strong>mpls te binding bidirectional static-cr-lsp egress Tunnel11</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-Tunnel11] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2] <strong>interface Tunnel12</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-Tunnel12] <strong>mpls te passive-tunnel</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-Tunnel12] <strong>mpls te binding bidirectional static-cr-lsp egress Tunnel12</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-Tunnel12] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2] <strong>commit</strong></pre>
</p></li><li class="substepexpand"><span>Configure LSPs between ASGs and RSGs.</span><p><p># Configure ASG1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASG1] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-mpls] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1] <strong>interface gigabitethernet <span>0/1/3</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-GigabitEthernet<span>0/1/3</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-GigabitEthernet<span>0/1/3</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-GigabitEthernet<span>0/1/3</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1] <strong>interface gigabitethernet <span>0/1/4</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-GigabitEthernet<span>0/1/4</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-GigabitEthernet<span>0/1/4</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-GigabitEthernet<span>0/1/4</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1] <strong>commit</strong></pre>
<p># Configure ASG2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASG2] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-mpls] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2] <strong>interface gigabitethernet <span>0/1/3</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-GigabitEthernet<span>0/1/3</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-GigabitEthernet<span>0/1/3</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-GigabitEthernet<span>0/1/3</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2] <strong>interface gigabitethernet <span>0/1/4</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-GigabitEthernet<span>0/1/4</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-GigabitEthernet<span>0/1/4</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-GigabitEthernet<span>0/1/4</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2] <strong>commit</strong></pre>
<p># Configure RSG1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RSG1] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-mpls] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-GigabitEthernet<span>0/1/1</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-GigabitEthernet1<span>0/1/1</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1] <strong>interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-GigabitEthernet<span>0/1/2</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-GigabitEthernet<span>0/1/2</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2] <strong>commit</strong></pre>
<p># Configure RSG2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RSG2] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG2-mpls] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG2-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG2] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG2-GigabitEthernet<span>0/1/1</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG2-GigabitEthernet<span>0/1/1</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG2-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG2] <strong>interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG2-GigabitEthernet<span>0/1/2</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG2-GigabitEthernet<span>0/1/2</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG2-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG2] <strong>commit</strong></pre>
<p>After completing the configurations, check static bidirectional co-routed LSP information. The following example uses the command output on ASG1.</p>
<pre class="screen">[<span class="keyword">*</span>ASG1] <strong>display mpls te bidirectional static-cr-lsp</strong></pre>
<pre class="screen">TOTAL          : 2     STATIC CRLSP(S)
UP             : 2     STATIC CRLSP(S)
DOWN           : 0     STATIC CRLSP(S)
Name                FEC                I/O Label        I/O If                     Status
lsp1                1.1.1.1/32         20/NULL          GE<span>0/1/1</span>/                   
                                       NULL/30          /GE<span>0/1/1</span>                   Up
Tunnel12         3.3.3.3/32         NULL/60          /GE<span>0/1/0</span>                   
                                       70/NULL          GE<span>0/1/0</span>/                   Up</pre>
</p></li></ol>
</li><li><span>Configure a static PW protection group.</span><p><p># Configure a pair of primary and secondary static PWs on the CSG.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CSG] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG] <strong>interface gigabitethernet<span>0/1/3</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-GigabitEthernet<span>0/1/3</span>.1] <strong>vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-GigabitEthernet<span>0/1/3</span>.1] <strong>mpls static-l2vc destination 2.2.2.2 1 transmit-vpn-label 100 receive-vpn-label 200 </strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-GigabitEthernet<span>0/1/3</span>.1] <strong>mpls static-l2vc destination 3.3.3.3 2 transmit-vpn-label 300 receive-vpn-label 400 secondary</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-GigabitEthernet<span>0/1/3</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG] <strong>commit</strong></pre>
<p># Configure the primary and bypass PWs on ASG1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASG1] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1] <strong>interface virtual-ethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-Virtual-Ethernet<span>0/1/0</span>] <strong>ve-group 1 l2-terminate</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-Virtual-Ethernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1] <strong>interface virtual-ethernet <span>0/1/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-Virtual-Ethernet<span>0/1/0</span>.1] <strong>vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-Virtual-Ethernet<span>0/1/0</span>.1] <strong>mpls static-l2vc destination 1.1.1.1 1 transmit-vpn-label 200 receive-vpn-label 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-Virtual-Ethernet<span>0/1/0</span>.1] <strong>mpls static-l2vc destination 3.3.3.3 3 transmit-vpn-label 500 receive-vpn-label 600 bypass</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-Virtual-Ethernet<span>0/1/0</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1] <strong>commit</strong></pre>
<p># Configure the secondary and bypass PWs on ASG2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASG2] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2] <strong>interface virtual-ethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-Virtual-Ethernet<span>0/1/0</span>] <strong>ve-group 1 l2-terminate</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-Virtual-Ethernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2] <strong>interface virtual-ethernet <span>0/1/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-Virtual-Ethernet<span>0/1/0</span>.1] <strong>vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-Virtual-Ethernet<span>0/1/0</span>.1] <strong>mpls static-l2vc destination 1.1.1.1 2 transmit-vpn-label 400 receive-vpn-label 300</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-Virtual-Ethernet<span>0/1/0</span>.1] <strong>mpls static-l2vc destination 2.2.2.2 3 transmit-vpn-label 600 receive-vpn-label 500 bypass</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-Virtual-Ethernet<span>0/1/0</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2] <strong>commit</strong></pre>
</p></li><li><span>Configure PW APS on the CSG and ASGs.</span><p><p># Configure the CSG.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CSG] <strong>pw-aps 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-pw-aps-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG] <strong>interface gigabitethernet<span>0/1/3</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-GigabitEthernet<span>0/1/3</span>.1] <strong>mpls l2vpn pw-aps 1 admin</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-GigabitEthernet<span>0/1/3</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG] <strong>commit</strong></pre>
<p># Configure ASG1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASG1] <strong>pw-aps 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-pw-aps-1] <strong>role slave</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-pw-aps-1] <strong>remote-aps 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-pw-aps-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1] <strong>interface virtual-ethernet <span>0/1/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-Virtual-Ethernet<span>0/1/0</span>.1] <strong>mpls l2vpn pw-aps 1 admin</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-Virtual-Ethernet<span>0/1/0</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1] <strong>commit</strong></pre>
<p># Configure ASG2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASG2] <strong>pw-aps 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-pw-aps-1] <strong>role master</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-pw-aps-1] <strong>remote-aps 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-pw-aps-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2] <strong>interface virtual-ethernet <span>0/1/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-Virtual-Ethernet<span>0/1/0</span>.1] <strong>mpls l2vpn pw-aps 1 admin</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-Virtual-Ethernet<span>0/1/0</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2] <strong>commit</strong></pre>
</p></li><li><span>Configure MPLS OAM to detect PW status.</span><p><p># Configure the CSG.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CSG] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-mpls] <strong>mpls oam</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG] <strong>mpls-oam</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-mpls-oam] <strong>mpls oam l2vc peer-ip 2.2.2.2 vc-id 1 vc-type vlan type cv</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-mpls-oam] <strong>mpls oam l2vc peer-ip 2.2.2.2 vc-id 2 vc-type vlan type cv</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-mpls-oam] <strong>mpls oam l2vc enable receive peer-ip 2.2.2.2 vc-id 1 vc-type vlan</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-mpls-oam] <strong>mpls oam l2vc enable receive peer-ip 3.3.3.3 vc-id 2 vc-type vlan</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-mpls-oam] <strong>mpls oam l2vc enable send peer-ip 2.2.2.2 vc-id 1 vc-type vlan</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-mpls-oam] <strong>mpls oam l2vc enable send peer-ip 3.3.3.3 vc-id 2 vc-type vlan</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-mpls-oam] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG] <strong>commit</strong></pre>
<p># Configure ASG1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASG1] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-mpls] <strong>mpls oam</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1] <strong>mpls-oam</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-mpls-oam] <strong>mpls oam l2vc peer-ip 1.1.1.1 vc-id 1 vc-type vlan type cv</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-mpls-oam] <strong>mpls oam l2vc peer-ip 3.3.3.3 vc-id 3 vc-type vlan type cv</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-mpls-oam] <strong>mpls oam l2vc enable receive peer-ip 1.1.1.1 vc-id 1 vc-type vlan</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-mpls-oam] <strong>mpls oam l2vc enable receive peer-ip 3.3.3.3 vc-id 3 vc-type vlan</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-mpls-oam] <strong>mpls oam l2vc enable send peer-ip 1.1.1.1 vc-id 1 vc-type vlan</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-mpls-oam] <strong>mpls oam l2vc enable send peer-ip 3.3.3.3 vc-id 3 vc-type vlan</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-mpls-oam] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1] <strong>commit</strong></pre>
<p># Configure ASG2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASG2] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-mpls] <strong>mpls oam</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2] <strong>mpls-oam</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-mpls-oam] <strong>mpls oam l2vc peer-ip 1.1.1.1 vc-id 2 vc-type vlan type cv</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-mpls-oam] <strong>mpls oam l2vc peer-ip 2.2.2.2 vc-id 3 vc-type vlan type cv</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-mpls-oam] <strong>mpls oam l2vc enable receive peer-ip 1.1.1.1 vc-id 2 vc-type vlan</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-mpls-oam] <strong>mpls oam l2vc enable receive peer-ip 2.2.2.2 vc-id 3 vc-type vlan</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-mpls-oam] <strong>mpls oam l2vc enable send peer-ip 1.1.1.1 vc-id 2 vc-type vlan</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-mpls-oam] <strong>mpls oam l2vc enable send peer-ip 2.2.2.2 vc-id 3 vc-type vlan</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-mpls-oam] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2] <strong>commit</strong></pre>
<p>Check MPLS OAM information on ASG1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASG1] <strong>display mpls oam l2vc all</strong></pre>
<pre class="screen">--------------------------------------------------------------------------------

Total Oam Num:                    2
Total Start Oam Num:              2
Total Defect Oam Num:             0
--------------------------------------------------------------------------------
No.  Peer IP        VC Type             VC ID          Status
--------------------------------------------------------------------------------
1    2.2.2.2        vlan                1              Start/Non-defect
2    3.3.3.3        vlan                2              Start/Non-defect     </pre>
</p></li><li><span>Configure an L3VPN.</span><ol type="a"><li class="substepexpand"><span>Configure a VPN instance on each ASG and RSG, and bind interfaces to VPN instances.</span><p><p># Configure ASG1. The configuration of ASG2 is similar to that of ASG1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASG1] <strong>ip vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-vpn-instance-vpna] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-vpn-instance-vpna-af-ipv4] <strong>route-distinguisher 1:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-vpn-instance-vpna-af-ipv4] <strong>vpn-target 1:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-vpn-instance-vpna-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-vpn-instance-vpna] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1] <strong>interface virtual-ethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-Virtual-Ethernet<span>0/1/1</span>] <strong>ve-group 10 l3-access</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-Virtual-Ethernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1] <strong>interface virtual-ethernet <span>0/1/1</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-Virtual-Ethernet<span>0/1/1</span>.1] <strong>vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-Virtual-Ethernet<span>0/1/1</span>.1] <strong>ip binding vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-Virtual-Ethernet<span>0/1/1</span>.1] <strong>ip address 10.10.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-Virtual-Ethernet<span>0/1/1</span>.1] <strong>direct-route track pw-state degrade-cost 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-Virtual-Ethernet<span>0/1/1</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1] <strong>commit</strong></pre>
<p># Configure RSG1. The configuration of RSG2 is similar to that of RSG1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RSG1] <strong>ip vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-vpn-instance-vpna] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-vpn-instance-vpna-af-ipv4] <strong>route-distinguisher 1:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-vpn-instance-vpna-af-ipv4] <strong>vpn-target 1:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-vpn-instance-vpna-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-vpn-instance-vpna] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1] <strong>interface gigabitethernet <span>0/1/3</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-GigabitEthernet<span>0/1/3</span>] <strong>portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-GigabitEthernet<span>0/1/3</span>] <strong>port link-type trunk</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-GigabitEthernet<span>0/1/3</span>] <strong>port trunk allow-pass vlan 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-GigabitEthernet<span>0/1/3</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-GigabitEthernet<span>0/1/0</span>] <strong>portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-GigabitEthernet<span>0/1/0</span>] <strong>port link-type trunk</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-GigabitEthernet<span>0/1/0</span>] <strong>port trunk allow-pass vlan 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1] <strong>vlan 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-vlan10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1] <strong>interface vlanif 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-Vlanif10] <strong>ip binding vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-Vlanif10] <strong>ip address 10.10.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-Vlanif10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1] <strong>commit</strong></pre>
</p></li><li class="substepexpand"><span>Establish MP-IBGP peer relationships between ASGs and RSGs.</span><p><p># Configure ASG2. The configuration of ASG1 is similar to that of ASG2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASG2] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-bgp] <strong>graceful-restart</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-bgp] <strong>peer 2.2.2.2 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-bgp] <strong>peer 2.2.2.2 connect-interface loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-bgp] <strong>peer 4.4.4.4 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-bgp] <strong>peer 4.4.4.4 connect-interface loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-bgp] <strong>peer 4.4.4.4 tracking delay 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-bgp] <strong>peer 5.5.5.5 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-bgp] <strong>peer 5.5.5.5 connect-interface loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-bgp] <strong>peer 5.5.5.5 tracking delay 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-bgp] <strong>ipv4-family vpnv4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-bgp-af-vpnv4] <strong>peer 2.2.2.2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-bgp-af-vpnv4] <strong>peer 4.4.4.4 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-bgp-af-vpnv4] <strong>peer 5.5.5.5 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2-bgp-af-vpnv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG2] <strong>commit</strong></pre>
<p># Configure RSG1. The configuration of RSG2 is similar to that of RSG1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RSG1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-bgp] <strong>graceful-restart</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-bgp] <strong>peer 2.2.2.2 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-bgp] <strong>peer 2.2.2.2 connect-interface loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-bgp] <strong>peer 2.2.2.2 tracking delay 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-bgp] <strong>peer 3.3.3.3 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-bgp] <strong>peer 3.3.3.3 connect-interface loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-bgp] <strong>peer 3.3.3.3 tracking delay 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-bgp] <strong>peer 5.5.5.5 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-bgp] <strong>peer 5.5.5.5 connect-interface loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-bgp] <strong>ipv4-family vpnv4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-bgp-af-vpnv4] <strong>peer 2.2.2.2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-bgp-af-vpnv4] <strong>peer 3.3.3.3 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-bgp-af-vpnv4] <strong>peer 5.5.5.5 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-bgp-af-vpnv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1] <strong>commit</strong></pre>
</p></li><li class="substepexpand"><span>Import direct routes into VPN instances on ASGs and RSGs.</span><p><p># Configure ASG1. The configuration of ASG2 is similar to that of ASG1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASG1-bgp] <strong>ipv4-family vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-bgp-vpna] <strong>import-route direct</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-bgp-vpna] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASG1] <strong>commit</strong></pre>
<p># Configure RSG1. The configuration of RSG2 is similar to that of RSG1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RSG1-bgp] <strong>ipv4-family vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-bgp-vpna] <strong>import-route direct</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-bgp-vpna] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1] <strong>commit</strong></pre>
</p></li><li class="substepexpand"><span>Configure VPN FRR.</span><p><p># Configure RSG1. The configurations of the other RSG and each ASG are similar to that of RSG1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RSG1] <strong>ip vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-vpn-instance-vpna] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-vpn-instance-vpna-af-ipv4] <strong>vpn frr</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-vpn-instance-vpna-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1-vpn-instance-vpna] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RSG1] <strong>commit</strong></pre>
</p></li></ol>
</li><li><span>For details about how to configure VRRP on ASG1 and ASG2, see <a href="#EN-US_TASK_0172370385__dc_vrp_l2-l3_cfg_502801">Configuration Files</a> in this section.</span></li><li><span>For details about how to configure VRRP on each RSG, see <a href="#EN-US_TASK_0172370385__dc_vrp_l2-l3_cfg_502801">Configuration Files</a> in this section.</span></li></ol></div>
<div class="example" id="EN-US_TASK_0172370385__dc_vrp_l2-l3_cfg_502801"><a name="EN-US_TASK_0172370385__dc_vrp_l2-l3_cfg_502801"></a><a name="dc_vrp_l2-l3_cfg_502801"></a><a name="EN-US_TASK_0172370385__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>CSG configuration file</p>
<pre class="screen">#
sysname CSG
#
mpls lsr-id 1.1.1.1
#
mpls
 mpls te
 mpls oam
#
bidirectional static-cr-lsp ingress Tunnel10
 forward outgoing-interface GigabitEthernet<span>0/1/1</span> nexthop 172.16.1.2 out-label 20
 backward in-label 30 lsrid 2.2.2.2 tunnel-id 100
#
bidirectional static-cr-lsp ingress Tunnel11
 forward outgoing-interface GigabitEthernet<span>0/1/2</span> nexthop 172.16.4.2 out-label 40
 backward in-label 50 lsrid 3.3.3.3 tunnel-id 200
#
mpls l2vpn
#
pw-aps 1        
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 172.16.1.1 255.255.255.0
 mpls           
 mpls te        
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ip address 172.16.4.1 255.255.255.0
 mpls           
 mpls te        
#
interface GigabitEthernet<span>0/1/3</span>
 undo shutdown
#
interface GigabitEthernet<span>0/1/3</span>.1
 vlan-type dot1q 10
 mpls static-l2vc destination 2.2.2.2 1 transmit-vpn-label 100 receive-vpn-label 200
 mpls static-l2vc destination 3.3.3.3 2 transmit-vpn-label 300 receive-vpn-label 400 secondary
 mpls l2vpn pw-aps 1 admin
#
interface LoopBack0
 ip address 1.1.1.1 255.255.255.255
#               
interface Tunnel10
 ip address unnumbered interface LoopBack0
 tunnel-protocol mpls te
 destination 2.2.2.2
 mpls te signal-protocol cr-static
 mpls te tunnel-id 100
 mpls te bidirectional
#               
interface Tunnel11
 ip address unnumbered interface LoopBack0
 tunnel-protocol mpls te
 destination 3.3.3.3
 mpls te signal-protocol cr-static
 mpls te tunnel-id 200
 mpls te bidirectional
#
ospf 1
 area 0.0.0.0
  network 1.1.1.1 0.0.0.0
  network 172.16.1.0 0.0.0.255
  network 172.16.4.0 0.0.0.255
#               
mpls-oam        
 mpls oam l2vc peer-ip 2.2.2.2 vc-id 1 vc-type vlan type cv
 mpls oam l2vc enable send peer-ip 2.2.2.2 vc-id 1 vc-type vlan
 mpls oam l2vc enable receive peer-ip 2.2.2.2 vc-id 1 vc-type vlan
 mpls oam l2vc peer-ip 2.2.2.2 vc-id 2 vc-type vlan type cv
 mpls oam l2vc enable send peer-ip 3.3.3.3 vc-id 2 vc-type vlan
 mpls oam l2vc enable receive peer-ip 3.3.3.3 vc-id 2 vc-type vlan
#
return</pre>
</li><li><p>ASG1 configuration file</p>
<pre class="screen">#
sysname ASG1
#
ip vpn-instance vpna
 ipv4-family
  route-distinguisher 1:1
  apply-label per-instance
  vpn frr
  vpn-target 1:1 export-extcommunity
  vpn-target 1:1 import-extcommunity
#
mpls lsr-id 2.2.2.2
#
mpls
 mpls te
 mpls oam
#
bidirectional static-cr-lsp egress Tunnel10
 forward in-label 20 lsrid 1.1.1.1 tunnel-id 100
 backward outgoing-interface GigabitEthernet<span>0/1/1</span> nexthop 172.16.1.1 out-label 30
 mpls l2vpn
#
bidirectional static-cr-lsp ingress Tunnel12
 forward outgoing-interface GigabitEthernet<span>0/1/2</span> nexthop 172.16.2.1 out-label 60
 backward in-label 70 lsrid 3.3.3.3 tunnel-id 300
#
mpls l2vpn
#
pw-aps 1
 role slave
 remote-aps 1
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 mpls           
 mpls te        
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 172.16.1.2 255.255.255.0
 mpls
 mpls te
 mpls rsvp-te
 mpls rsvp-te hello
#
interface GigabitEthernet<span>0/1/3</span>
 undo shutdown
 ip address 172.16.3.1 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/4</span>
 undo shutdown
 ip address 172.16.8.1 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack0
 ip address 2.2.2.2 255.255.255.255
#
interface Tunnel10
 ip address unnumbered interface LoopBack0
 tunnel-protocol mpls te
 destination 1.1.1.1
 mpls te signal-protocol cr-static
 mpls te tunnel-id 100
 mpls te passive-tunnel
 mpls te binding bidirectional static-cr-lsp egress Tunnel10
#               
interface Tunnel12
 ip address unnumbered interface LoopBack0
 tunnel-protocol mpls te
 destination 3.3.3.3
 mpls te signal-protocol cr-static
 mpls te tunnel-id 300
 mpls te bidirectional
#            
interface Virtual-Ethernet<span>0/1/0</span>
 ve-group 1 l2-terminate
#
interface Virtual-Ethernet<span>0/1/0</span>.1
 vlan-type dot1q 10
 mpls static-l2vc destination 1.1.1.1 1 transmit-vpn-label 200 receive-vpn-label 100
 mpls static-l2vc destination 3.3.3.3 3 transmit-vpn-label 500 receive-vpn-label 600 bypass
 mpls l2vpn pw-aps 1 admin
#
interface Virtual-Ethernet<span>0/1/1</span>
 ve-group 10 l3-access
#
interface Virtual-Ethernet<span>0/1/1</span>.1
 vlan-type dot1q 10
 ip binding vpn-instance vpna
 ip address 10.10.1.2 255.255.255.0
 direct-route track pw-state degrade-cost 30
 vrrp vrid 10 virtual-ip 10.10.1.3
 vrrp vrid 10 track admin-vrrp interface GigabitEthernet<span>0/1/0</span> vrid 20
#
bgp 100
 graceful-restart
 peer 3.3.3.3 as-number 100
 peer 3.3.3.3 connect-interface LoopBack0
 peer 4.4.4.4 as-number 100
 peer 4.4.4.4 connect-interface LoopBack0
 peer 5.5.5.5 as-number 100
 peer 5.5.5.5 connect-interface LoopBack0
 #
 ipv4-family unicast
 peer 3.3.3.3 enable
  peer 4.4.4.4 enable
  peer 5.5.5.5 enable
 #
 ipv4-family vpnv4
  policy vpn-target
  peer 3.3.3.3 enable
  peer 4.4.4.4 enable
  peer 5.5.5.5 enable
 #
 ipv4-family vpn-instance vpna
  import-route direct
#
ospf 1
 area 0.0.0.0
  network 2.2.2.2 0.0.0.0
  network 172.16.1.0 0.0.0.255
  network 172.16.3.0 0.0.0.255
  network 172.16.2.0 0.0.0.255
  network 172.16.8.0 0.0.0.255
#
mpls-oam        
 mpls oam l2vc peer-ip 1.1.1.1 vc-id 1 vc-type vlan type cv
 mpls oam l2vc enable send peer-ip 1.1.1.1 vc-id 1 vc-type vlan
 mpls oam l2vc enable receive peer-ip 1.1.1.1 vc-id 1 vc-type vlan
 mpls oam l2vc peer-ip 3.3.3.3 vc-id 3 vc-type vlan type cv
 mpls oam l2vc enable send peer-ip 3.3.3.3 vc-id 3 vc-type vlan
 mpls oam l2vc enable receive peer-ip 3.3.3.3 vc-id 3 vc-type vlan
#
return</pre>
</li><li><p>ASG2 configuration file</p>
<pre class="screen">#
sysname ASG2
#
ip vpn-instance vpna
 ipv4-family
  route-distinguisher 1:1
  apply-label per-instance
  vpn frr
  vpn-target 1:1 export-extcommunity
  vpn-target 1:1 import-extcommunity
#
mpls lsr-id 3.3.3.3
#
mpls
 mpls te
 mpls oam
#
bidirectional static-cr-lsp egress Tunnel11
 forward in-label 40 lsrid 1.1.1.1 tunnel-id 200
 backward outgoing-interface GigabitEthernet<span>0/1/2</span> nexthop 172.16.4.1 out-label 50
#
bidirectional static-cr-lsp egress Tunnel12
 forward in-label 60 lsrid 2.2.2.2 tunnel-id 300
 backward outgoing-interface GigabitEthernet<span>0/1/0</span> nexthop 172.16.2.2 out-label 70
#
mpls l2vpn
#
pw-aps 1
 role master
 remote-aps 1
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown  
 ip address 172.16.2.1 255.255.255.0
 mpls           
 mpls te        
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown  
 ip address 172.16.4.2 255.255.255.0
 mpls           
 mpls te        
#
interface GigabitEthernet<span>0/1/3</span>
 undo shutdown
 ip address 172.16.6.1 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/4</span>
 undo shutdown
 ip address 172.16.7.1 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack0
 ip address 3.3.3.3 255.255.255.255
#
interface Tunnel11
 ip address unnumbered interface LoopBack0
 tunnel-protocol mpls te
 destination 1.1.1.1
 mpls te signal-protocol cr-static
 mpls te tunnel-id 200
 mpls te passive-tunnel
 mpls te binding bidirectional static-cr-lsp egress Tunnel11
#               
interface Tunnel12
 ip address unnumbered interface LoopBack0
 tunnel-protocol mpls te
 destination 2.2.2.2
 mpls te signal-protocol cr-static
 mpls te tunnel-id 300
 mpls te passive-tunnel
 mpls te binding bidirectional static-cr-lsp egress Tunnel12
#
interface Virtual-Ethernet<span>0/1/0</span>
 ve-group 1 l2-terminate
#
interface Virtual-Ethernet<span>0/1/0</span>.1
 vlan-type dot1q 10
mpls static-l2vc destination 1.1.1.1 2 transmit-vpn-label 400 receive-vpn-label 300
 mpls static-l2vc destination 2.2.2.2 3 transmit-vpn-label 600 receive-vpn-label 500 bypass
 mpls l2vpn pw-aps 1 admin
#
interface Virtual-Ethernet<span>0/1/1</span>
 ve-group 1 l3-access
#
interface Virtual-Ethernet<span>0/1/1</span>.1
 vlan-type dot1q 10
 ip binding vpn-instance vpna
 ip address 10.10.1.4 255.255.255.0
 vrrp vrid 10 virtual-ip 10.10.1.3
 vrrp vrid 10 track admin-vrrp interface GigabitEthernet<span>0/1/0</span> vrid 20
#
bgp 100
 graceful-restart
 peer 2.2.2.2 as-number 100
 peer 2.2.2.2 connect-interface LoopBack0
 peer 4.4.4.4 as-number 100
 peer 4.4.4.4 connect-interface LoopBack0
 peer 4.4.4.4 tracking delay 30
 peer 5.5.5.5 as-number 100
 peer 5.5.5.5 connect-interface LoopBack0
 peer 5.5.5.5 tracking delay 30
#
ipv4-family unicast
 undo synchronization
 peer 2.2.2.2 enable
 peer 4.4.4.4 enable
 peer 5.5.5.5 enable
#
ipv4-family vpnv4
 policy vpn-target
 peer 2.2.2.2 enable
 peer 4.4.4.4 enable
 peer 5.5.5.5 enable
#
ipv4-family vpn-instance vpna
 import-route direct
#
ospf 1
 area 0.0.0.0
  network 3.3.3.3 0.0.0.0
  network 172.16.2.0 0.0.0.255
  network 172.16.7.0 0.0.0.255
  network 172.16.4.0 0.0.0.255
  network 172.16.6.0 0.0.0.255
#
mpls-oam        
 mpls oam l2vc peer-ip 1.1.1.1 vc-id 2 vc-type vlan type cv
 mpls oam l2vc enable send peer-ip 1.1.1.1 vc-id 2 vc-type vlan
 mpls oam l2vc enable receive peer-ip 1.1.1.1 vc-id 2 vc-type vlan
 mpls oam l2vc peer-ip 2.2.2.2 vc-id 3 vc-type vlan type cv
 mpls oam l2vc enable send peer-ip 2.2.2.2 vc-id 3 vc-type vlan
 mpls oam l2vc enable receive peer-ip 2.2.2.2 vc-id 3 vc-type vlan
#
return</pre>
</li><li><p>RSG1 configuration file</p>
<pre class="screen">#
sysname RSG1
#
vlan batch 10
#
ip vpn-instance vpna
 ipv4-family
  route-distinguisher 1:1
  apply-label per-instance
  vpn frr
  vpn-target 1:1 export-extcommunity
  vpn-target 1:1 import-extcommunity
#
mpls lsr-id 4.4.4.4
#
 mpls l2vpn
#
mpls ldp
#
interface Vlanif10
 ip binding vpn-instance vpna
 ip address 10.10.1.1 255.255.255.0
 vrrp vrid 1 virtual-ip 10.0.1.3
 vrrp vrid 1 priority 150
#
interface GigabitEthernet<span>0/1/0</span>
 portswitch
 undo shutdown
 port link-type trunk
 port trunk allow-pass vlan 10
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 172.16.3.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ip address 172.16.7.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/3</span>
 portswitch
 undo shutdown
 port link-type trunk
 port trunk allow-pass vlan 10
#
interface LoopBack0
 ip address 4.4.4.4 255.255.255.255
#
bgp 100
 graceful-restart
 peer 2.2.2.2 as-number 100
 peer 2.2.2.2 connect-interface LoopBack0
 peer 2.2.2.2 tracking delay 30
 peer 3.3.3.3 as-number 100
 peer 3.3.3.3 connect-interface LoopBack0
 peer 3.3.3.3 tracking delay 30
 peer 5.5.5.5 as-number 100
 peer 5.5.5.5 connect-interface LoopBack0
#
ipv4-family unicast
 undo synchronization
 peer 2.2.2.2 enable
 peer 3.3.3.3 enable
 peer 5.5.5.5 enable
#
ipv4-family vpnv4
 policy vpn-target
 peer 2.2.2.2 enable
 peer 3.3.3.3 enable
 peer 5.5.5.5 enable
#
ipv4-family vpn-instance vpna
 import-route direct
#
ospf 1
 area 0.0.0.0
  network 4.4.4.4 0.0.0.0
  network 172.16.3.0 0.0.0.255
  network 172.16.7.0 0.0.0.255
  mpls-te enable
#
return</pre>
</li><li><p>RSG2 configuration file</p>
<pre class="screen">#
sysname RSG2
#
vlan batch 10
#
ip vpn-instance vpna
 ipv4-family
  route-distinguisher 11
  apply-label per-instance
  vpn frr
  vpn-target 11 export-extcommunity
  vpn-target 11 import-extcommunity
#
mpls lsr-id 5.5.5.5
#
mpls l2vpn
#
mpls ldp
#
interface Vlanif10
 ip binding vpn-instance vpna
 ip address 10.10.1.2 255.255.255.0
 vrrp vrid 1 virtual-ip 10.0.1.3
#
interface GigabitEthernet<span>0/1/0</span>
 portswitch
 undo shutdown
 port link-type trunk
 port trunk allow-pass vlan 10
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 172.16.6.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ip address 172.16.8.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/3</span>
 portswitch
 undo shutdown
 port link-type trunk
 port trunk allow-pass vlan 10
#
interface LoopBack0
 ip address 5.5.5.5 255.255.255.255
#
bgp 100
 graceful-restart
 peer 2.2.2.2 as-number 100
 peer 2.2.2.2 connect-interface LoopBack0
 peer 2.2.2.2 tracking delay 30
 peer 3.3.3.3 as-number 100
 peer 3.3.3.3 connect-interface LoopBack0
 peer 3.3.3.3 tracking delay 30
 peer 4.4.4.4 as-number 100
 peer 4.4.4.4 connect-interface LoopBack0
#
ipv4-family unicast
 undo synchronization
 peer 2.2.2.2 enable
 peer 3.3.3.3 enable
 peer 4.4.4.4 enable
#
ipv4-family vpnv4
 policy vpn-target
 peer 2.2.2.2 enable
 peer 3.3.3.3 enable
 peer 4.4.4.4 enable
#
ipv4-family vpn-instance vpna
 import-route direct
#
ospf 1
 area 0.0.0.0
  network 5.5.5.5 0.0.0.0
  network 172.16.8.0 0.0.0.255
  network 172.16.6.0 0.0.0.255
  mpls-te enable
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2-l3_cfg_5013.html">Configuration Examples for L2VPN Accessing L3VPN
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2-l3_cfg_5017.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2-l3_cfg_5025.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>