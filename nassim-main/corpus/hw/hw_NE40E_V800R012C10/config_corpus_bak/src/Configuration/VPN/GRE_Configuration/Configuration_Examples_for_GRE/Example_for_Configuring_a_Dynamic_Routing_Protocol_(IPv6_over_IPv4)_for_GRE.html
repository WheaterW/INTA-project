
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring a Dynamic Routing Protocol (IPv6 over IPv4) for GRE">
<meta name="abstract" content="This section provides an example for configuring GRE dynamic routes, so that IPv6 traffic between users can be transmitted over IPv4 GRE tunnels. Static routes are required between a device and its connected clients.">
<meta name="description" content="This section provides an example for configuring GRE dynamic routes, so that IPv6 traffic between users can be transmitted over IPv4 GRE tunnels. Static routes are required between a device and its connected clients.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_gre_cfg_2020.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_gre_cfg_2032.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="GRE">
<meta name="featuretype" content="VPN">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="GRE">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="GRE">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="GRE">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="h00847023">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00415692">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0287364703">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring a Dynamic Routing Protocol (IPv6 over IPv4) for GRE</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0287364703"></a><a name="EN-US_TASK_0287364703"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring a Dynamic Routing Protocol (IPv6 over IPv4) for GRE</h1>
<div class="taskbody"><p>This section provides an example for configuring GRE dynamic routes, so that IPv6 traffic between users can be transmitted over IPv4 GRE tunnels. Static routes are required between a device and its connected clients.</p>
<div class="context"><a name="EN-US_TASK_0287364703__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0287364703__fig_dc_vrp_gre_cfg_203101">Figure 1</a>, DeviceA, DeviceB, and DeviceC belong to the IPv4 backbone network and run OSPF.</p>
<p>It is required that an IPv6 direct link be established between DeviceA and DeviceC. To meet such a requirement, configure an IPv6 over IPv4 GRE tunnel between DeviceA and DeviceC and specify the tunnel interface as the outbound interface of an IPv6 static route. PC1 and PC2 can then communicate.</p>
<p>DeviceA and DeviceC are the default gateways of PC1 and PC2, respectively.</p>
<div class="fignone" id="EN-US_TASK_0287364703__fig_dc_vrp_gre_cfg_203101"><a name="EN-US_TASK_0287364703__fig_dc_vrp_gre_cfg_203101"></a><a name="fig_dc_vrp_gre_cfg_203101"></a><span class="figcap"><b>Figure 1 </b>Configuring a dynamic routing protocol (IPv6 over IPv4) for GRE</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface 1 and interface 2 stand for GE <span>0/1/0</span> and GE <span>0/2/0</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0287364845.png"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0287364703__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure an IPv4 dynamic routing protocol for communication between backbone network devices.</p>
</li><li><p>Create tunnel interfaces on DeviceA and DeviceC and specify the tunnel source and destination addresses. The tunnel source address is the IPv4 address of the interface that sends packets, and the tunnel destination address is the IPv4 address of the interface that receives packets.</p>
</li><li><p>Configure IPv6 addresses for the tunnel interfaces, so that the tunnel can advertise IPv6 routes.</p>
</li><li><p>Configure an IPv6 static route between DeviceA and PC1 and between DeviceC and PC2 and specify the local tunnel interface as the outbound interface of the corresponding static route, so that IPv6 traffic between PC1 and PC2 can be transmitted through the GRE tunnel.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0287364703__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>Data required for running OSPF</p>
</li><li><p>Source and destination addresses of the GRE tunnel, and tunnel interface IP addresses</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0287364703__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure IPv4 or IPv6 addresses for interfaces.</span><p><p>Configure IP addresses for interfaces as shown in <a href="#EN-US_TASK_0287364703__fig_dc_vrp_gre_cfg_203101">Figure 1</a>. For detailed configurations, see Configuration Files.</p>
</p></li><li><span>Configure IGP on the VPN backbone network.</span><p><p># Configure DeviceA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceA-ospf-1] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceA-ospf-1-area-0.0.0.0] <strong>network 10.20.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceA-ospf-1-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceA-ospf-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceA] <strong>commit</strong></pre>
<p># Configure DeviceB.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB] <strong>ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceB-ospf-1] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceB-ospf-1-area-0.0.0.0] <strong>network 10.20.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceB-ospf-1-area-0.0.0.0] <strong>network 10.21.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceB-ospf-1-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceB-ospf-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceB] <strong>commit</strong></pre>
<p># Configure DeviceC.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceC] <strong>ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceC-ospf-1] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceC-ospf-1-area-0.0.0.0] <strong>network 10.21.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceC-ospf-1-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceC-ospf-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceC] <strong>commit</strong></pre>
<p>After the configuration is complete, run the <strong>display ip routing-table</strong> command on DeviceA and DeviceC. The command outputs show that they have learned the OSPF routes destined for each other.</p>
<p># The following example uses the command output on DeviceA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA]<strong> display ip routing-table</strong></pre>
<pre class="screen"><span class="keyword">Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route</span>
------------------------------------------------------------------------------
Routing Table : _public_
         Destinations : 8       Routes : 8

Destination/Mask    Proto   Pre  Cost        Flags NextHop         Interface

      10.20.1.0/24  Direct  0    0             D  10.20.1.1       GigabitEthernet<span>0/1/0</span>
      10.20.1.1/32  Direct  0    0             D  127.0.0.1       GigabitEthernet<span>0/1/0</span>
    10.20.1.255/32  Direct  0    0             D  127.0.0.1       GigabitEthernet<span>0/1/0</span>
      10.21.1.0/24  OSPF    10   2             D  10.20.1.2       GigabitEthernet<span>0/1/0</span>
      127.0.0.0/8   Direct  0    0             D  127.0.0.1       InLoopBack0
      127.0.0.1/32  Direct  0    0             D  127.0.0.1       InLoopBack0
127.255.255.255/32  Direct  0    0             D  127.0.0.1       InLoopBack0
255.255.255.255/32  Direct  0    0             D  127.0.0.1       InLoopBack0</pre>
</p></li><li><span>Configure tunnel interfaces.</span><p><p># Configure DeviceA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA]<strong> interface GigabitEthernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA-GigabitEthernet<span>0/1/0</span>]<strong> binding tunnel gre</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceA-GigabitEthernet<span>0/1/0</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA-GigabitEthernet<span>0/1/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA]<strong> interface tunnel 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceA-Tunnel1]<strong> tunnel-protocol gre</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceA-Tunnel1]<strong> ipv6 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceA-Tunnel1]<strong> ipv6 address 2001:DB8:4::1</strong><strong> 64</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceA-Tunnel1]<strong> source 10.20.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceA-Tunnel1]<strong> destination 10.21.1.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceA-Tunnel1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceA] <strong>commit</strong></pre>
<p># Configure DeviceC.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceC]<strong> interface GigabitEthernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceC-GigabitEthernet<span>0/1/0</span>]<strong> binding tunnel gre</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceC-GigabitEthernet<span>0/1/0</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceC-GigabitEthernet<span>0/1/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceC]<strong> interface tunnel 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceC-Tunnel1]<strong> tunnel-protocol gre</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceC-Tunnel1]<strong> ipv6 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceC-Tunnel1]<strong> ipv</strong><strong>6 address 2001:DB8:4::2 64</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceC-Tunnel1]<strong> source 10.21.1.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceC-Tunnel1]<strong> destination 10.20.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceC-Tunnel1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceC] <strong>commit</strong></pre>
<p>After the configuration is complete, the IPv6 status of tunnel interfaces becomes up and the tunnel interfaces can ping each other.</p>
<p># The following example uses the command output on DeviceA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA]<strong> ping ipv6 -a 2001:DB8:4::1 2001:DB8:4::2</strong></pre>
<pre class="screen">  PING 2001:DB8:4::2 : 56  data bytes, press CTRL_C to break
    Reply from 2001:DB8:4::2
    bytes=56 Sequence=1 hop limit=64 time=409 ms
    Reply from 2001:DB8:4::2
    bytes=56 Sequence=2 hop limit=64 time=14 ms
    Reply from 2001:DB8:4::2
    bytes=56 Sequence=3 hop limit=64 time=12 ms
    Reply from 2001:DB8:4::2
    bytes=56 Sequence=4 hop limit=64 time=16 ms
    Reply from 2001:DB8:4::2
    bytes=56 Sequence=5 hop limit=64 time=14 ms

  --- 2001:DB8:4::2 ping statistics---
    5 packet(s) transmitted
    5 packet(s) received
    0.00% packet loss
    round-trip min/avg/max=12/93/409 ms</pre>
</p></li><li><span>Configure static routes.</span><p><p># Configure DeviceA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA]<strong> ipv6 route-static 2001:DB8:2:: 64 tunnel1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceA] <strong>commit</strong></pre>
<p># Configure DeviceC.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceC]<strong> ipv6 route-static 2001:DB8:1:: 64 tunnel1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceC] <strong>commit</strong></pre>
</p></li><li><span>Verifying the Configuration</span><p><p>After the configuration is complete, run the <strong>display</strong> <strong>ipv6 routing-table</strong> command on DeviceA and DeviceC. In the command output, you can find a static route with the next hop being the tunnel interface and destination being the user-side network segment of the peer.</p>
<p># The following example uses the command output on DeviceA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA]<strong> display ipv6 routing-table</strong></pre>
<pre class="screen">Routing Table : _public_
         Destinations : 7        Routes : 7         

Destination  : ::1                                     PrefixLength : 128
NextHop      : ::1                                     Preference   : 0
Cost         : 0                                       Protocol     : Direct
RelayNextHop : ::                                      TunnelID     : 0x0
Interface    : InLoopBack0                             Flags        : D

Destination  : ::FFFF:127.0.0.0                        PrefixLength : 104
NextHop      : ::FFFF:127.0.0.1                        Preference   : 0
Cost         : 0                                       Protocol     : Direct
RelayNextHop : ::                                      TunnelID     : 0x0
Interface    : InLoopBack0                             Flags        : D

Destination  : ::FFFF:127.0.0.1                        PrefixLength : 128
NextHop      : ::1                                     Preference   : 0
Cost         : 0                                       Protocol     : Direct
RelayNextHop : ::                                      TunnelID     : 0x0
Interface    : InLoopBack0                             Flags        : D

Destination  : 2001:DB8:2::                            PrefixLength : 64
NextHop      : 2001:DB8:4::1                           Preference   : 60
Cost         : 0                                       Protocol     : Static
RelayNextHop : ::                                      TunnelID     : 0x0
Interface    : Tunnel1                                 Flags        : D

Destination  : 2001:DB8:4::                            PrefixLength : 64
NextHop      : 2001:DB8:4::1                           Preference   : 0
Cost         : 0                                       Protocol     : Direct
RelayNextHop : ::                                      TunnelID     : 0x0
Interface    : Tunnel1                                 Flags        : D

Destination  : 2001:DB8:4::1                           PrefixLength : 128
NextHop      : ::1                                     Preference   : 0
Cost         : 0                                       Protocol     : Direct
RelayNextHop : ::                                      TunnelID     : 0x0
Interface    : Tunnel1                                 Flags        : D

Destination  : FE80::                                  PrefixLength : 10
NextHop      : ::                                      Preference   : 0
Cost         : 0                                       Protocol     : Direct
RelayNextHop : ::                                      TunnelID     : 0x0
Interface    : NULL0                                   Flags        : DB</pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0287364703__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>DeviceA configuration file</p>
<pre class="screen">#
sysname DeviceA
#
interface GigabitEthernet <span>0/1/0</span>
 undo shutdown
 ip address 10.20.1.1 255.255.255.0
 binding tunnel gre
#
interface GigabitEthernet <span>0/2/0</span>
 undo shutdown
 ipv6 enable
 ipv6 address 2001:DB8:3::1/64
#
interface Tunnel1
 ipv6 enable
 ipv6 address 2001:DB8:4::1/64
 tunnel-protocol gre
 source 10.20.1.1
 destination 10.21.1.2
#
ospf 1
 area 0.0.0.0
  network 10.20.1.0 0.0.0.255
#
ipv6 route-static 2001:DB8:2:: 64 Tunnel1
#
return</pre>
</li><li><p>DeviceB configuration file</p>
<pre class="screen">#
sysname DeviceB
#
interface GigabitEthernet <span>0/1/0</span>
 undo shutdown
 ip address 10.20.1.2 255.255.255.0
#
interface GigabitEthernet <span>0/2/0</span>
 undo shutdown
 ip address 10.21.1.1 255.255.255.0
#
ospf 1
 area 0.0.0.0
  network 10.20.1.0 0.0.0.255
  network 10.21.1.0 0.0.0.255
#
return</pre>
</li><li><p>DeviceC configuration file</p>
<pre class="screen">#
sysname DeviceC
#
interface GigabitEthernet <span>0/1/0</span>
 undo shutdown
 ip address 10.21.1.2 255.255.255.0
 binding tunnel gre
#
interface GigabitEthernet <span>0/2/0</span>
 undo shutdown
 ipv6 enable
 ipv6 address 2001:DB8:5::1/64
#
interface Tunnel1
 ipv6 enable
 ipv6 address 2001:DB8:4::2/64
 tunnel-protocol gre
 source 10.21.1.2
 destination 10.20.1.1
#
ospf 1
 area 0.0.0.0
 network 10.21.1.0 0.0.0.255
#
ipv6 route-static 2001:DB8:1:: 64 Tunnel1
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_gre_cfg_2020.html">Configuration Examples for GRE
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_gre_cfg_2032.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>
</body>
</html>