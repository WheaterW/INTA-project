
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring EVPN VPLS over mLDP P2MP Tunnels">
<meta name="abstract" content="An EVPN can carry multicast services. To reduce redundant traffic and conserve bandwidth resources, you can configure EVPN to use mLDP P2MP tunnels for service transmission.">
<meta name="description" content="An EVPN can carry multicast services. To reduce redundant traffic and conserve bandwidth resources, you can configure EVPN to use mLDP P2MP tunnels for service transmission.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0091.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0092.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="p00915595,w00800033,w00556928,l00468467,w00606909,evpnvrp,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="p00915595">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00878323">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172370496">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring EVPN VPLS over mLDP P2MP Tunnels</title>
</head>
<body><a name="EN-US_TASK_0172370496"></a><a name="EN-US_TASK_0172370496"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring EVPN VPLS over mLDP P2MP Tunnels</h1>
<div class="taskbody"><p>An EVPN can carry multicast services. To reduce redundant traffic and conserve bandwidth resources, you can configure EVPN to use mLDP P2MP tunnels for service transmission.</p>
<div class="context"><a name="EN-US_TASK_0172370496__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Usage Scenario</h4><p>Multicast services, such as IPTV, multimedia conferencing, and Massive Multiplayer Online Role Playing Game (MMORPG) services, are becoming more and more common. As a result, the number of multicast services carried over EVPNs is growing. On the network shown in <a href="#EN-US_TASK_0172370496__fig81422167111">Figure 1</a>, PE1 is the root node, and PE2 and PE3 are leaf nodes. The multicast source and the receiver are on the access side. By default, an EVPN sends multicast service traffic from PE1 to PE2 and PE3 by means of ingress replication. Specifically, PE1 replicates a multicast packet into two copies and sends them to the P. The P then sends one copy to PE2 and the other copy to PE3. For each additional receiver, an additional copy of the multicast packet is sent. This increases the volume of traffic on the link between PE1 and the P, consuming bandwidth resources. To conserve bandwidth resources, you can configure EVPN to use mLDP P2MP tunnels to transmit multicast services. After the configuration is complete, PE1 sends only one copy of multicast traffic to the P. The P replicates the multicast traffic into copies and sends them to the leaf nodes, reducing the volume of traffic between PE1 and P.</p>
<div class="fignone" id="EN-US_TASK_0172370496__fig81422167111"><a name="EN-US_TASK_0172370496__fig81422167111"></a><a name="fig81422167111"></a><span class="figcap"><b>Figure 1 </b>Carrying multicast services over an EVPN</span><br><span><img class="vsd" src="figure/en-us_image_0000001189114700.png" width="NaN" height="NaN"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172370496__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Pre-configuration Tasks</h4><p>Before configuring EVPN VPLS over mLDP P2MP tunnels, complete the following task:</p>
<ul><li><p><a href="dc_vrp_evpn_cfg_0065.html">Configure BD EVPN functions</a> on the EVPN.</p>
</li></ul>
</div></div>
<div class="steps-unordered"><a name="EN-US_TASK_0172370496__1.4.3"></a><a name="1.4.3"></a><h4 class="sectiontitle">Procedure</h4>
<ul><li><span>Perform the following steps on the root node:</span><ol><li class="substepexpand"><span>Run <span><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=evpn+vpn-instance"><b><span class="cmdname">evpn vpn-instance</span></b></a> <em>vpn-instance-name</em> <strong>bd-mode</strong></span></span><p><p>The view of a BD EVPN instance is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=inclusive-provider-tunnel"><b><span class="cmdname">inclusive-provider-tunnel</span></b></a></span></span><p><p>The EVI-IPMSI view is created and displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=root"><b><span class="cmdname">root</span></b></a></span></span><p><p>The current device is specified as the root node for the multicast EVPN, and the EVI I-PMSI root view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=mldp+p2mp"><b><span class="cmdname">mldp p2mp</span></b></a></span></span><p><p>An mLDP P2MP tunnel is specified for the BD EVPN instance to carry multicast services, and the EVI-IPMSI-ROOT-MLDP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=root-ip"><b><span class="cmdname">root-ip</span></b></a> <i><span class="varname">ip-address</span></i></span></span><p><p>An IP address is specified for the root node of the mLDP P2MP tunnel.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Return to the EVI-IPMSI-ROOT view.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <span><a href="cmdqueryname=data-delay-time"><b><span class="cmdname">data-delay-time</span></b></a> <i><span class="varname">delay-time</span></i></span></span><p><p>A hold-off time for the mLDP P2MP tunnel to go up is set. If you want the mLDP P2MP tunnel to go up after all leaf nodes are configured, run this command to set a hold-off time for the mLDP P2MP tunnel to go up.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <span><a href="cmdqueryname=data-switch+disable"><b><span class="cmdname">data-switch disable</span></b></a></span></span><p><p>Multicast traffic is disabled from being forwarded through a P2P tunnel if the mLDP P2MP tunnel goes Down.</p>
<p>Before an mLDP P2MP tunnel carries multicast services, you can establish a bypass tunnel to provide mLDP P2MP FRR protection for the primary mLDP P2MP tunnel. The bypass tunnel is a P2P tunnel. If both the primary P2MP tunnel and bypass P2P tunnel go down, the backup mLDP P2MP tunnel carries multicast services. After the bypass P2P tunnel for the primary mLDP P2MP tunnel goes Up, the P2P tunnel carries multicast services. Because the primary mLDP P2MP tunnel remains Down, a leaf node also receives multicast traffic from the backup mLDP P2MP tunnel. As a result, the leaf node receives and forwards duplicate copies of traffic. To prevent this issue, run this command to disable multicast traffic from being forwarded through a P2P tunnel when the mLDP P2MP tunnel goes Down.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li><span>Perform the following steps on each leaf node:</span><ol><li class="substepexpand"><span>Run <span><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=evpn+vpn-instance"><b><span class="cmdname">evpn vpn-instance</span></b></a> <em>vpn-instance-name</em> <strong>bd-mode</strong></span><p><p>The view of a BD EVPN instance is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=inclusive-provider-tunnel"><b><span class="cmdname">inclusive-provider-tunnel</span></b></a></span></span><p><p>The EVI I-PMSI view is created and displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=leaf"><b><span class="cmdname">leaf</span></b></a></span></span><p><p>The current device is specified as a leaf node for the multicast EVPN.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <span><a href="cmdqueryname=root-ip"><b><span class="cmdname">root-ip</span></b></a> <i><span class="varname">root-ip</span></i> <strong><span>use-next-hop</span></strong></span></span><p><p>In a cross-IGP-area EVPN VPLS scenario, you must run this command on a leaf node to configure the next hop of a BGP EVPN route as the root node IP address, which is used as the IP address of the ABR on the area border. Without this configuration, EVPN cannot use an mLDP P2MP tunnel for service transmission.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li></ul></div>
<div class="postreq"><a name="EN-US_TASK_0172370496__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p>Run the <a href="cmdqueryname=display+evpn+vpn-instance"><b><span class="cmdname">display evpn vpn-instance</span></b></a> <strong><span>name</span></strong> <i><span class="varname">vpn-instance-name</span></i> <strong><span>inclusive-provider-tunnel</span></strong> <strong><span>verbose</span></strong> command to check information about tunnels to which a multicast EVPN recurses.</p>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0091.html">Configuring IGMP Snooping over EVPN MPLS
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0092.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>