
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring E-PW APS for Static SS-PWs">
<meta name="abstract" content="In E-PW APS scenarios, MPLS OAM is used to detect the status of static SS-PWs.">
<meta name="description" content="In E-PW APS scenarios, MPLS OAM is used to detect the status of static SS-PWs.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpws_cfg_3012.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpws_cfg_6011.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpws_cfg_6039.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="VPWS">
<meta name="featuretype" content="VPN">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="VPWS">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="VPWS">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="VPWS">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="l00415692">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00415692">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172369981">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring E-PW APS for Static SS-PWs</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172369981"></a><a name="EN-US_TASK_0172369981"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring E-PW APS for Static SS-PWs</h1>
<div class="taskbody"><p>In E-PW APS scenarios, MPLS OAM is used to detect the status of static SS-PWs.</p>
<div class="context"><a name="EN-US_TASK_0172369981__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the public network shown in <a href="#EN-US_TASK_0172369981__fig_dc_vrp_vpws_cfg_603801">Figure 1</a>, three PEs belong to the same IGP domain, and static bidirectional co-routed LSPs must be deployed. In addition, CE1 and CE2 need to reliably communicate through the three PEs on the public network.</p>
<p>To meet this requirement, use E-PW APS for static PWs to ensure service reliability. As the three PEs belong to the same IGP domain, the PWs can be SS-PWs.</p>
<div class="fignone" id="EN-US_TASK_0172369981__fig_dc_vrp_vpws_cfg_603801"><a name="EN-US_TASK_0172369981__fig_dc_vrp_vpws_cfg_603801"></a><a name="fig_dc_vrp_vpws_cfg_603801"></a><span class="figcap"><b>Figure 1 </b>Configuring E-PW APS for static SS-PWs</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><div class="p"><ul><li><p>In this example, interface1, subinterface1.1, interface2, and interface3 represent GE<span>0/1/0</span>, GE<span>0/1/0</span>.1, GE<span>0/1/1</span>, and GE<span>0/1/2</span>, respectively.</p>
</li></ul>
</div>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_vpws_cfg_603801.png" width="NaN" height="NaN"></span><br></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172369981__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure interface IP addresses and a routing protocol.</p>
</li><li><p>Configure MPLS and public network tunnels.</p>
<p>In this example, static bidirectional co-routed LSPs are used between PE1 and PE2, between PE1 and PE3, and between PE2 and PE3. The specific configurations include:</p>
<ul><li><p>Configure basic MPLS functions and enable MPLS TE.</p>
</li><li><p>Configure MPLS TE tunnel interfaces.</p>
</li><li><p>Configure the ingress and egress for each static bidirectional co-routed LSP.</p>
</li><li><p>Configure reverse tunnel binding on PE2 and PE3.</p>
</li></ul>
</li><li><p>Configure a PW protection group (static PWs are used in this example), which includes:</p>
<ul><li><p>Configure a primary PW between PE1 and PE2.</p>
</li><li><p>Configure a secondary PW between PE1 and PE3.</p>
</li><li><p>Configure a bypass PW between PE2 and PE3.</p>
</li></ul>
</li><li><p>Configure E-PW APS, which includes:</p>
<ul><li><p>Configure a PW APS instance on PE1.</p>
</li><li><p>Configure an E-PW APS instance on PE2 and PE3.</p>
</li><li><p>Bind PWs to PW APS instances.</p>
</li></ul>
</li><li><p>Configure MPLS OAM to detect PW status.</p>
</li><li><p>Configure CEs to access the L2VPN through VLANs on the AC side.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172369981__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>PEs' interface numbers, IP addresses and OSPF process IDs</p>
</li><li><p>PEs' LSR IDs, tunnel interface numbers and IP addresses, incoming and outgoing tunnel labels, next hop address or outbound interface on the ingress of each static bidirectional co-routed LSP, and inbound interface on the egress of each static bidirectional co-routed LSP</p>
</li><li><p>Destination IP addresses, VC IDs, and VC types of L2VCs and transmit/receive labels of static PWs</p>
</li><li><p>APS instance numbers and the roles, local numbers, and remote numbers of the E-PW APS instances on PEs (the E-PW APS instance role is slave on PE2 and master on PE1).</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172369981__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure interface IP addresses and a routing protocol.</span><p><p>Configure an IP address and mask for each involved interface. For detailed configurations, see Configuration Files.</p>
<p>In this example, OSPF is used as the IGP for PE1, PE2, and PE3 to communicate at the network layer. The configuration details are not provided here.</p>
</p></li><li><span>Configure MPLS and public network tunnels.</span><p><p>In this example, static bidirectional co-routed LSPs are used between PE1, PE2, and PE3.</p>
</p><ol type="a"><li class="substepexpand"><span>Configure basic MPLS functions and enable MPLS TE.</span><p><p>Enable MPLS and MPLS TE both globally and per interface on nodes along the TE tunnel.</p>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>mpls lsr-id 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/2</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/2</span>] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p>The configurations of PE2 and PE3 are similar to that of PE1. For detailed configurations, see Configuration Files.</p>
</p></li><li class="substepexpand"><span>Configure MPLS TE tunnel interfaces.</span><p><p># Configure an MPLS TE tunnel from PE1 to PE2 and from PE1 to PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface Tunnel10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel10] <strong>ip address unnumbered interface loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel10] <strong>tunnel-protocol mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel10] <strong>destination 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel10] <strong>mpls te tunnel-id 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel10] <strong>mpls te signal-protocol cr-static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel10] <strong>mpls te bidirectional</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface Tunnel11</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel11] <strong>ip address unnumbered interface loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel11] <strong>tunnel-protocol mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel11] <strong>destination 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel11] <strong>mpls te tunnel-id 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel11] <strong>mpls te signal-protocol cr-static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel11] <strong>mpls te bidirectional</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel11] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure an MPLS TE tunnel from PE2 to PE1 and from PE2 to PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>interface Tunnel10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Tunnel10] <strong>ip address unnumbered interface loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Tunnel10] <strong>tunnel-protocol mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Tunnel10] <strong>destination 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Tunnel10] <strong>mpls te tunnel-id 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Tunnel10] <strong>mpls te signal-protocol cr-static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Tunnel10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface Tunnel12</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Tunnel12] <strong>ip address unnumbered interface loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Tunnel12] <strong>tunnel-protocol mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Tunnel12] <strong>destination 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Tunnel12] <strong>mpls te tunnel-id 300</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Tunnel12] <strong>mpls te signal-protocol cr-static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Tunnel12] <strong>mpls te bidirectional</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Tunnel12] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure an MPLS TE tunnel from PE3 to PE1 and from PE3 to PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>interface Tunnel11</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Tunnel11] <strong>ip address unnumbered interface loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Tunnel11] <strong>tunnel-protocol mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Tunnel11] <strong>destination 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Tunnel11] <strong>mpls te tunnel-id 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Tunnel11] <strong>mpls te signal-protocol cr-static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Tunnel11] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>interface Tunnel12</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Tunnel12] <strong>ip address unnumbered interface loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Tunnel12] <strong>tunnel-protocol mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Tunnel12] <strong>destination 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Tunnel12] <strong>mpls te tunnel-id 300</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Tunnel12] <strong>mpls te signal-protocol cr-static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Tunnel12] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
</p></li><li class="substepexpand"><span>Configure the ingress and egress for each static bidirectional co-routed LSP.</span><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>A static bidirectional co-routed LSP can go up on the ingress only when the LSP name is the same as the tunnel interface name on the ingress. Note that the first letter of the tunnel interface name must be uppercase. The transit nodes and egress do not have this restriction.</p>
</div></div>
<p># Configure PE1 as the ingress for the static bidirectional co-routed LSP from PE1 to PE2 and that from PE1 to PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bidirectional static-cr-lsp ingress Tunnel10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bi-static-ingress-Tunnel10] <strong>forward outgoing-interface GigabitEthernet<span>0/1/1</span> nexthop 10.1.2.2 out-label 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bi-static-ingress-Tunnel10] <strong>backward in-label 30 lsrid 2.2.2.2 tunnel-id 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>bidirectional static-cr-lsp ingress Tunnel11</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bi-static-ingress-Tunnel11] <strong>forward outgoing-interface GigabitEthernet<span>0/1/2</span> nexthop 10.1.3.2 out-label 40</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bi-static-ingress-Tunnel11] <strong>backward in-label 50 lsrid 3.3.3.3 tunnel-id 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bi-static-ingress-Tunnel11] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2 as the egress of the static bidirectional co-routed LSP from PE2 to PE1 and as the ingress of the static bidirectional co-routed LSP from PE2 to PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>bidirectional static-cr-lsp egress Tunnel10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bi-static-egress-Tunnel10] <strong>forward outgoing-interface GigabitEthernet<span>0/1/0</span> in-label 20 lsrid 1.1.1.1 tunnel-id 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bi-static-egress-Tunnel10] <strong>backward nexthop 10.1.2.1 out-label 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>bidirectional static-cr-lsp ingress Tunnel12</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bi-static-ingress-Tunnel12] <strong>forward outgoing-interface GigabitEthernet<span>0/1/1</span> nexthop 10.1.4.2 out-label 60</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bi-static-ingress-Tunnel12] <strong>backward in-label 70 lsrid 3.3.3.3 tunnel-id 300</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bi-static-ingress-Tunnel12] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure PE3 as the egress for the static bidirectional co-routed LSP from PE1 to PE3 and that from PE2 to PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>bidirectional static-cr-lsp egress Tunnel11 </strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bi-static-egress-Tunnel11] <strong>forward outgoing-interface GigabitEthernet<span>0/1/0</span> in-label 40 lsrid 1.1.1.1 tunnel-id 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bi-static-egress-Tunnel11] <strong>backward nexthop 10.1.2.1 out-label 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bi-static-egress-Tunnel11] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>bidirectional static-cr-lsp egress Tunnel12 </strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bi-static-egress-Tunnel12] <strong>forward outgoing-interface GigabitEthernet<span>0/1/1</span> in-label 60 lsrid 2.2.2.2 tunnel-id 300</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bi-static-egress-Tunnel12] <strong>backward nexthop 10.1.4.1 out-label 70</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bi-static-egress-Tunnel12] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
</p></li><li class="substepexpand"><span>Configure reverse tunnel binding on PE2 and PE3.</span><p><p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>interface Tunnel10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Tunnel10] <strong>mpls te passive-tunnel</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Tunnel10] <strong>mpls te binding bidirectional static-cr-lsp egress Tunnel10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Tunnel10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>interface Tunnel11</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Tunnel11] <strong>mpls te passive-tunnel</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Tunnel11] <strong>mpls te binding bidirectional static-cr-lsp egress Tunnel11</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Tunnel11] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>interface Tunnel12</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Tunnel12] <strong>mpls te passive-tunnel</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Tunnel12] <strong>mpls te binding bidirectional static-cr-lsp egress Tunnel12</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Tunnel12] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
<p>Run the <strong>display mpls te bidirectional static-cr-lsp</strong> command on PE1, PE2, and PE3 to check information about static bidirectional co-routed LSPs.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display mpls te bidirectional static-cr-lsp</strong></pre>
<pre class="screen">TOTAL          : 2     STATIC CRLSP(S)
UP             : 2     STATIC CRLSP(S)
DOWN           : 0     STATIC CRLSP(S)
Name                FEC                I/O Label    I/O If                Status
Tunnel10         2.2.2.2/32         NULL/20      -/GE<span>0/1/1</span>
                                       30/NULL      GE<span>0/1/1</span>/-             <strong>Up</strong>
Tunnel11         3.3.3.3/32         NULL/40      -/GE<span>0/1/2</span>
                                       50/NULL      GE<span>0/1/2</span>/-             <strong>Up</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>display mpls te bidirectional static-cr-lsp</strong></pre>
<pre class="screen">TOTAL          : 2     STATIC CRLSP(S)
UP             : 2     STATIC CRLSP(S)
DOWN           : 0     STATIC CRLSP(S)
Name                FEC                I/O Label    I/O If                Status
Tunnel10         -/32               20/NULL      GE<span>0/1/0</span>/-
                                       NULL/30      -/GE<span>0/1/0</span>             <strong>Up</strong>
Tunnel12         3.3.3.3/32         NULL/60      -/GE<span>0/1/1</span>
                                       70/NULL      GE<span>0/1/1</span>/-             <strong>Up</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>display mpls te bidirectional static-cr-lsp</strong></pre>
<pre class="screen">TOTAL          : 2     STATIC CRLSP(S)
UP             : 2     STATIC CRLSP(S)
DOWN           : 0     STATIC CRLSP(S)
Name                FEC                I/O Label    I/O If                Status
Tunnel11         -/32               40/NULL      GE<span>0/1/0</span>/-
                                       NULL/50      -/GE<span>0/1/0</span>             <strong>Up</strong>
Tunnel12         -/32               60/NULL      GE<span>0/1/1</span>/-
                                       NULL/300     -/GE<span>0/1/1</span>             <strong>Up</strong></pre>
</p></li></ol>
</li><li><span>Configure a PW protection group.</span><p><p>Static PWs are used in this example.</p>
</p><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>When configuring a static PW, you must specify the VC ID. Otherwise, the PW cannot be bound to a PW APS instance.</p>
</div></div>
<p># Configure the primary and secondary PWs on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>tunnel-policy 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-tunnel-policy-1] <strong>tunnel binding destination 2.2.2.2 te Tunnel10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-tunnel-policy-1] <strong>tunnel binding destination 3.3.3.3 te Tunnel11</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-tunnel-policy-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet <span>0/1/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1] <strong>vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1] <strong>mpls static-l2vc destination 2.2.2.2 1 transmit-vpn-label 100 receive-vpn-label 200 tunnel-policy 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1] <strong>mpls static-l2vc destination 3.3.3.3 2 transmit-vpn-label 300 receive-vpn-label 400 tunnel-policy 1 secondary</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure the primary and bypass PWs on PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>tunnel-policy 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-tunnel-policy-1] <strong>tunnel binding destination 1.1.1.1 te Tunnel10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-tunnel-policy-1] <strong>tunnel binding destination 3.3.3.3 te Tunnel12</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-tunnel-policy-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface eth-trunk 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Eth-Trunk10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface eth-trunk 10.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Eth-Trunk10.1] <strong>vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Eth-Trunk10.1] <strong>mpls static-l2vc destination 1.1.1.1 1 transmit-vpn-label 200 receive-vpn-label 100 tunnel-policy 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Eth-Trunk10.1] <strong>mpls static-l2vc destination 3.3.3.3 3 transmit-vpn-label 500 receive-vpn-label 600 tunnel-policy 1 bypass</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Eth-Trunk10.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure the primary and bypass PWs on PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>tunnel-policy 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-tunnel-policy-1] <strong>tunnel binding destination 1.1.1.1 te Tunnel11</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-tunnel-policy-1] <strong>tunnel binding destination 2.2.2.2 te Tunnel12</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-tunnel-policy-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>interface eth-trunk 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Eth-Trunk10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>interface eth-trunk 10.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Eth-Trunk10.1] <strong>vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Eth-Trunk10.1] <strong>mpls static-l2vc destination 1.1.1.1 2 transmit-vpn-label 400 receive-vpn-label 300 tunnel-policy 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Eth-Trunk10.1] <strong>mpls static-l2vc destination 2.2.2.2 3 transmit-vpn-label 600 receive-vpn-label 500 tunnel-policy 1 bypass</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Eth-Trunk10.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
</p></li><li><span>Configure E-PW APS.</span><ol type="a"><li class="substepexpand"><span>Configure PW APS instances.</span><p><p>Configure a PW APS instance on PE1 and an E-PW APS instance on PE2 and PE3.</p>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>pw-aps 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-pw-aps-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>pw-aps 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-pw-aps-2] <strong>role slave</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-pw-aps-2] <strong>remote-aps 3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-pw-aps-2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>pw-aps 3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-pw-aps-3] <strong>role master</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-pw-aps-3] <strong>remote-aps 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-pw-aps-3] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
</p></li><li class="substepexpand"><span>Bind PWs to PW APS instances.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface gigabitethernet <span>0/1/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1] <strong>mpls l2vpn pw-aps 1 admin</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>interface eth-trunk 10.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Eth-Trunk10.1] <strong>mpls l2vpn pw-aps 2 admin</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Eth-Trunk10.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>interface eth-trunk 10.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Eth-Trunk10.1] <strong>mpls l2vpn pw-aps 3 admin</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Eth-Trunk10.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
<p>Run the <strong>display mpls l2vpn pw-aps verbose</strong> command on PE1, PE2, and PE3. The command output shows information about PW APS instances and their associated PWs.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display mpls l2vpn pw-aps verbose</strong></pre>
<pre class="screen">                                                                                
 APS Information:                                                               
   Description            :--                                                     
   Local Id               : 1                                                   
   Status                 : <strong>NR</strong>                                                  
   Work Path Status       : NoDefect
   Protect Path Status    : NoDefect
   Far End Status         : NR                                                  
   Request Result         : Work                                                
   Wtr Interval(s)        : 300                                                 
   HoldOff Interval(ms)   : 0                                                   
   Operation Type         : Revertive                                           
   Role                   : --                                                  
   Remote Id              : --                                                  
   Alarm Info             : None                                                
   Total VPN Number       : 1                                                   
 ----------------------------------------                                       
 PW Information:                                                                
   Number                 : 1                                                   
   Client Interface       : GigabitEthernet<span>0/1/0</span>.1                              
   Bind Type              : <strong>admin</strong>                                               
  Primary PW:                                                                   
    VC ID                 : 1                                                   
    VC Type               : VLAN                                                
    Destination           : 2.2.2.2                                             
    VC State              : up                                                  
  Secondary PW:                                                                 
    VC ID                 : 2                                                   
    VC Type               : VLAN                                                
    Destination           : 3.3.3.3                                             
    VC State              : up     </pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>display mpls l2vpn pw-aps verbose</strong></pre>
<pre class="screen"> APS Information:
   Description            :--
   Local Id               : 1
   Status                 : --
   Work Path Status       : --
   Protect Path Status    : --
   Far End Status         : --
   Request Result         : Work
   Wtr Interval(s)        : 300
   HoldOff Interval(ms)   : 0
   Operation Type         : Revertive
   Role                   : <strong>Slave</strong>
   Remote Id              : 3
   Alarm Info             : None
   Total VPN Number       : 1
 ----------------------------------------
 PW Information:
   Number                 : 1
   Client Interface       : Eth-Trunk10.1
   Bind Type              : <strong>admin</strong>
  Primary PW:
    VC ID                 : 1
    VC Type               : VLAN
    Destination           : 1.1.1.1
    VC State              : up
  Secondary PW:
    VC ID                 : 3
    VC Type               : VLAN
    Destination           : 3.3.3.3
    VC State              : up  </pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>display mpls l2vpn pw-aps verbose</strong></pre>
<pre class="screen"> APS Information:
   Description            :--
   Local Id               : 1
   Status                 : <strong>NR</strong>
   Work Path Status       : NoDefect
   Protect Path Status    : NoDefect
   Far End Status         : NR
   Request Result         : Work
   Wtr Interval(s)        : 300
   HoldOff Interval(ms)   : 0
   Operation Type         : Revertive
   Role                   : <strong>Master</strong>
   Remote Id              : 2
   Alarm Info             : None
   Total VPN Number       : 1
 ----------------------------------------
 PW Information:
   Number                 : 1
   Client Interface       : Eth-Trunk10.1
   Bind Type              : <strong>admin</strong>
  Primary PW:
    VC ID                 : 2
    VC Type               : VLAN
    Destination           : 1.1.1.1
    VC State              : up
  Secondary PW:
    VC ID                 : 3
    VC Type               : VLAN
    Destination           : 2.2.2.2
    VC State              : up   </pre>
</p></li></ol>
</li><li><span>Configure MPLS OAM to detect PW status.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls] <strong>mpls oam</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls-oam</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-oam] <strong>mpls oam l2vc peer-ip 2.2.2.2 vc-id 1 vc-type vlan type cv</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-oam] <strong>mpls oam l2vc peer-ip 3.3.3.3 vc-id 2 vc-type vlan type cv</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-oam] <strong>mpls oam l2vc enable send peer-ip 2.2.2.2 vc-id 1 vc-type vlan </strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-oam] <strong>mpls oam l2vc enable receive peer-ip 3.3.3.3 vc-id 2 vc-type vlan</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-oam] <strong>mpls oam l2vc enable receive peer-ip 2.2.2.2 vc-id 1 vc-type vlan</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-oam] <strong>mpls oam l2vc enable send peer-ip 3.3.3.3 vc-id 2 vc-type vlan</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-oam] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls] <strong>mpls oam</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>mpls-oam</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-oam] <strong>mpls oam l2vc peer-ip 1.1.1.1 vc-id 1 vc-type vlan type cv</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-oam] <strong>mpls oam l2vc peer-ip 3.3.3.3 vc-id 3 vc-type vlan type cv</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-oam] <strong>mpls oam l2vc enable receive peer-ip 1.1.1.1 vc-id 1 vc-type vlan</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-oam] <strong>mpls oam l2vc enable send peer-ip 1.1.1.1 vc-id 1 vc-type vlan</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-oam] <strong>mpls oam l2vc enable receive peer-ip 3.3.3.3 vc-id 3 vc-type vlan</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-oam] <strong>mpls oam l2vc enable send peer-ip 3.3.3.3 vc-id 3 vc-type vlan</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-oam] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-mpls] <strong>mpls oam</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>mpls-oam</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-mpls-oam] <strong>mpls oam l2vc peer-ip 1.1.1.1 vc-id 2 vc-type vlan type cv</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-mpls-oam] <strong>mpls oam l2vc peer-ip 2.2.2.2 vc-id 3 vc-type vlan type cv</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-mpls-oam] <strong>mpls oam l2vc enable receive peer-ip 1.1.1.1 vc-id 2 vc-type vlan</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-mpls-oam] <strong>mpls oam l2vc enable send peer-ip 1.1.1.1 vc-id 2 vc-type vlan</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-mpls-oam] <strong>mpls oam l2vc enable receive peer-ip 2.2.2.2 vc-id 3 vc-type vlan</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-mpls-oam] <strong>mpls oam l2vc enable send peer-ip 2.2.2.2 vc-id 3 vc-type vlan</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-mpls-oam] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
<p>Check MPLS OAM information on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display mpls oam l2vc all</strong></pre>
<pre class="screen">--------------------------------------------------------------------------------

Total Oam Num:                    2
Total Start Oam Num:              2
Total Defect Oam Num:             0
--------------------------------------------------------------------------------

No.  Peer IP        VC Type             VC ID          Status
--------------------------------------------------------------------------------

1    2.2.2.2        vlan                1              Start/Non-defect
2    3.3.3.3        vlan                2              Start/Non-defect     </pre>
</p></li><li><span>Configure dual-homing protection on the AC side.</span><ol type="a"><li class="substepexpand"><span>Configure Eth-Trunk interfaces.</span><p><p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/2</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface eth-trunk 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Eth-Trunk10] <strong>mode lacp-static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Eth-Trunk10] <strong>trunkport gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Eth-Trunk10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/2</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>interface eth-trunk 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Eth-Trunk10] <strong>mode lacp-static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Eth-Trunk10] <strong>trunkport gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Eth-Trunk10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
<p># Configure CE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2-GigabitEthernet<span>0/1/0</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>interface eth-trunk 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-Eth-Trunk10] <strong>portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-Eth-Trunk10] <strong>mode lacp-static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-Eth-Trunk10] <strong>port trunk allow-pass vlan 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-Eth-Trunk10] <strong>trunkport gigabitethernet <span>0/1/0</span> to <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-Eth-Trunk10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>vlan 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-vlan10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>commit</strong></pre>
</p></li><li class="substepexpand"><span>Configure E-Trunk.</span><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>For security purposes, you are advised not to use weak security algorithms in this feature. If you need to use such an algorithm, run the <a href="cmdqueryname=undo+crypto+weak-algorithm+disable"><b><span class="cmdname">undo crypto weak-algorithm disable</span></b></a> command to enable the weak security algorithm function.</p>
</div></div>
</p><p><p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>lacp e-trunk system-id 00e0-fc00-0000</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>lacp e-trunk priority 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>e-trunk 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-e-trunk-10] <strong>security-key cipher </strong><strong>YsHsjx_202206</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-e-trunk-10] <strong>priority 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-e-trunk-10] <strong>peer-address 3.3.3.3 source-address 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-e-trunk-10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface eth-trunk 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Eth-Trunk10] <strong>e-trunk 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Eth-Trunk10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>lacp e-trunk system-id 00e0-fc00-0000</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>lacp e-trunk priority 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>e-trunk 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-e-trunk-10] <strong>security-key cipher </strong><strong>YsHsjx_202206</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-e-trunk-10] <strong>priority 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-e-trunk-10] <strong>peer-address 2.2.2.2 source-address 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-e-trunk-10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>interface eth-trunk 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Eth-Trunk10] <strong>e-trunk 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Eth-Trunk10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
</p></li></ol>
</li><li><span>Verify the configuration.</span><p><p>Configure CE1 to ping the <span>VLANIF</span> interface address on CE2.</p>
<p># Configure CE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2]<strong>interface <span>gigabitethernet <span>0/1/0</span></span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-<span>Vlanif10</span>] <strong>ip address 10.1.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-<span>Vlanif10</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>commit</strong></pre>
<p># Perform the ping operation.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>ping 10.1.1.2</strong></pre>
<pre class="screen">PING 10.1.1.2: 56  data bytes, press CTRL_C to break
    Reply from 10.1.1.2: bytes=56 Sequence=1 ttl=255 time=40 ms
    Reply from 10.1.1.2: bytes=56 Sequence=2 ttl=255 time=30 ms
    Reply from 10.1.1.2: bytes=56 Sequence=3 ttl=255 time=40 ms
    Reply from 10.1.1.2: bytes=56 Sequence=4 ttl=255 time=1 ms
    Reply from 10.1.1.2: bytes=56 Sequence=5 ttl=255 time=1 ms

  --- 10.1.1.2 ping statistics ---
    5 packet(s) transmitted
    5 packet(s) received
    0.00% packet loss
    round-trip min/avg/max = 1/22/40 ms  </pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172369981__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>CE1 configuration file</p>
<pre class="screen">#                                                                               
sysname CE1                                                                     
#                                                                               
interface GigabitEthernet<span>0/1/0</span>                                                  
 undo shutdown                                                                  
#                                                                               
interface GigabitEthernet<span>0/1/0</span>.1                                                
 vlan-type dot1q 10                                                             
 ip address 10.1.1.1 255.255.255.0                                              
#                                                                               
return                 </pre>
</li><li><p>PE1 configuration file</p>
<pre class="screen">#                                                                               
sysname PE1                                                                     
#                                                                               
mpls lsr-id 1.1.1.1
#                                                             
mpls                                                                            
 mpls te
 mpls oam                                                                        
#                                                                               
mpls l2vpn                                                                      
#                                                                               
pw-aps 1                                                                        
#                                                                               
bidirectional static-cr-lsp ingress Tunnel10                                 
 forward outgoing-interface GigabitEthernet<span>0/1/1</span> nexthop 10.1.2.2 out-label 20                      
 backward in-label 30 lsrid 2.2.2.2 tunnel-id 100                                                           
#                                                                               
bidirectional static-cr-lsp ingress Tunnel11                                 
 forward outgoing-interface GigabitEthernet<span>0/1/2</span> nexthop 10.1.3.2 out-label 40                      
 backward in-label 50 lsrid 3.3.3.3 tunnel-id 200                                                           
#                                                                               
mpls ldp                                                                        
#                                                                               
mpls ldp remote-peer 2.2.2.2                                                    
 remote-ip 2.2.2.2                                                              
#                                                                               
mpls ldp remote-peer 3.3.3.3                                                    
 remote-ip 3.3.3.3                                                              
#                                                                               
interface GigabitEthernet<span>0/1/0</span>                                                  
 undo shutdown                                                                  
#                                                                               
interface GigabitEthernet<span>0/1/0</span>.1                                                
 vlan-type dot1q 10                                                             
 mpls static-l2vc destination 2.2.2.2 1 transmit-vpn-label 100 receive-vpn-label 200 <span>tunnel-policy 1</span>                                         
 mpls static-l2vc destination 3.3.3.3 2 transmit-vpn-label 300 receive-vpn-label 400 <span>tunnel-policy 1</span> secondary                               
 mpls l2vpn pw-aps 1 admin                                                      
#                                                                               
interface GigabitEthernet<span>0/1/1</span>                                                  
 undo shutdown                                                                  
 ip address 10.1.2.1 255.255.255.0                                              
 mpls                                                                           
 mpls te                                                                                                                        
#                                                                               
interface GigabitEthernet<span>0/1/2</span>                                                  
 undo shutdown                                                                  
 ip address 10.1.3.1 255.255.255.0                                              
 mpls                                                                           
 mpls te                                                                                                                            
#                                                                               
interface LoopBack0                                                             
 ip address 1.1.1.1 255.255.255.255                                             
#                                                                               
interface Tunnel10                                                           
 ip address unnumbered interface LoopBack0                                      
 tunnel-protocol mpls te                                                        
 destination 2.2.2.2                                                            
 mpls te signal-protocol cr-static                                              
 mpls te tunnel-id 100                                                          
 mpls te bidirectional                                                          
 mpls te reserved-for-binding                                                   
#                                                                               
interface Tunnel11                                                           
 ip address unnumbered interface LoopBack0                                      
 tunnel-protocol mpls te                                                        
 destination 3.3.3.3                                                            
 mpls te signal-protocol cr-static                                              
 mpls te tunnel-id 200                                                          
 mpls te bidirectional                                                          
 mpls te reserved-for-binding                                                   
#                                                                               
ospf 1                                                                          
 area 0.0.0.0                                                                   
  network 10.1.2.0 0.0.0.255                                                    
  network 1.1.1.1 0.0.0.0                                                       
  network 10.1.3.0 0.0.0.255                                                    
#                                                                               
tunnel-policy 1                                                           
 tunnel binding destination 2.2.2.2 te Tunnel10                              
 tunnel binding destination 3.3.3.3 te Tunnel11                              
#                                                                               
mpls-oam                                                                        
 mpls oam l2vc peer-ip 2.2.2.2 vc-id 1 vc-type vlan type cv
 mpls oam l2vc peer-ip 3.3.3.3 vc-id 2 vc-type vlan type cv
 mpls oam l2vc enable receive peer-ip 2.2.2.2 vc-id 1 vc-type vlan
 mpls oam l2vc enable send peer-ip 2.2.2.2 vc-id 1 vc-type vlan
 mpls oam l2vc enable receive peer-ip 3.3.3.3 vc-id 2 vc-type vlan
 mpls oam l2vc enable send peer-ip 3.3.3.3 vc-id 2 vc-type vlan
#                                                                               
return   </pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#                                                                               
sysname PE2                                                                     
#                                                                               
lacp e-trunk system-id 00e0-fc00-0000                                           
lacp e-trunk priority 100                                                       
#                                                                               
mpls lsr-id 2.2.2.2
#                                                             
mpls                                                                            
 mpls te
 mpls oam                                                                        
#                                                                               
mpls l2vpn                                                                      
#                                                                               
pw-aps 2                                                                        
 role slave                                                                     
 remote-aps 3                                                                   
#                                                                               
bidirectional static-cr-lsp egress Tunnel10
 forward outgoing-interface GigabitEthernet<span>0/1/0</span> in-label 20 lsrid 1.1.1.1 tunnel-id 100
 backward nexthop 10.1.2.1 out-label 30                                                           
#                                                                               
bidirectional static-cr-lsp ingress Tunnel12                                  
 forward outgoing-interface GigabitEthernet<span>0/1/1</span> nexthop 10.1.4.2 out-label 60           
 backward in-label 70 lsrid 3.3.3.3 tunnel-id 300                     
#                                                                               
mpls ldp                                                                        
#                                                                               
mpls ldp remote-peer 1.1.1.1                                                    
 remote-ip 1.1.1.1                                                              
#                                                                               
mpls ldp remote-peer 3.3.3.3                                                    
 remote-ip 3.3.3.3                                                              
#                                                                               
e-trunk 10   
 security-key cipher YsHsjx_202206                                                                   
 priority 10                                                                    
 peer-address 3.3.3.3 source-address 2.2.2.2                                    
#                                                                               
interface Eth-Trunk10                                                           
 mode lacp-static                                                               
 e-trunk 10                                                                     
#                                                                               
interface Eth-Trunk10.1                                                         
 vlan-type dot1q 10                                                             
 mpls static-l2vc destination 1.1.1.1 1 transmit-vpn-label 200 receive-vpn-label 100 <span>tunnel-policy 1</span>                            
 mpls static-l2vc destination 3.3.3.3 3 transmit-vpn-label 500 receive-vpn-label 600 <span>tunnel-policy 1</span> bypass                     
 mpls l2vpn pw-aps 2 admin                                                      
#                                                                               
interface GigabitEthernet<span>0/1/0</span>                                                  
 undo shutdown                                                                  
 ip address 10.1.2.2 255.255.255.0                                              
 mpls                                                                           
 mpls te                                                                                                                           
#                                                                               
interface GigabitEthernet<span>0/1/1</span>                                                  
 undo shutdown                                                                  
 ip address 10.1.4.1 255.255.255.0                                              
 mpls                                                                           
 mpls te                                                                                                                           
#                                                                               
interface GigabitEthernet<span>0/1/2</span>                                                  
 undo shutdown                                                                  
 eth-trunk 10                                                                   
#                                                                               
interface LoopBack0                                                             
 ip address 2.2.2.2 255.255.255.255                                             
#                                                                               
interface Tunnel10                                                           
 ip address unnumbered interface LoopBack0                                      
 tunnel-protocol mpls te                                                        
 destination 1.1.1.1                                                            
 mpls te signal-protocol cr-static                                              
 mpls te tunnel-id 100                                                          
 mpls te passive-tunnel                                                         
 mpls te binding bidirectional static-cr-lsp egress Tunnel10                 
 mpls te reserved-for-binding                                                   
#                                                                               
interface Tunnel12                                                           
 ip address unnumbered interface LoopBack0                                      
 tunnel-protocol mpls te                                                        
 destination 3.3.3.3                                                            
 mpls te signal-protocol cr-static                                              
 mpls te tunnel-id 300                                                          
 mpls te bidirectional                                                          
 mpls te reserved-for-binding                                                   
#                                                                               
ospf 1                                                                          
 area 0.0.0.0                                                                   
  network 2.2.2.2 0.0.0.0                                                       
  network 10.1.4.0 0.0.0.255                                                    
  network 10.1.2.0 0.0.0.255                                                    
#                                                                               
tunnel-policy 1                                                           
 tunnel binding destination 1.1.1.1 te Tunnel10                              
 tunnel binding destination 3.3.3.3 te Tunnel12                              
#                                                                               
mpls-oam                                                                        
 mpls oam l2vc peer-ip 1.1.1.1 vc-id 1 vc-type vlan type cv
 mpls oam l2vc peer-ip 3.3.3.3 vc-id 3 vc-type vlan type cv
 mpls oam l2vc enable receive peer-ip 1.1.1.1 vc-id 1 vc-type vlan
 mpls oam l2vc enable send peer-ip 1.1.1.1 vc-id 1 vc-type vlan
 mpls oam l2vc enable receive peer-ip 3.3.3.3 vc-id 3 vc-type vlan
 mpls oam l2vc enable send peer-ip 3.3.3.3 vc-id 3 vc-type vlan
#
return </pre>
</li><li><p>PE3 configuration file</p>
<pre class="screen">#                                                                               
sysname PE3                                                                     
#                                                                               
lacp e-trunk system-id 00e0-fc00-0000                                           
lacp e-trunk priority 100                                                       
#                                                                               
mpls lsr-id 3.3.3.3
#                                                             
mpls                                                                            
 mpls te
 mpls oam                                                                        
#                                                                               
mpls l2vpn                                                                      
#                                                                               
pw-aps 3                                                                        
 role master                                                                    
 remote-aps 2                                                                   
#                                                                               
bidirectional static-cr-lsp egress Tunnel11                                  
 forward outgoing-interface GigabitEthernet<span>0/1/0</span> in-label 40 lsrid 1.1.1.1 tunnel-id 200                                
 backward nexthop 10.1.2.1 out-label 30                     
#                                                                               
bidirectional static-cr-lsp egress Tunnel12                                  
 forward outgoing-interface GigabitEthernet<span>0/1/1</span> in-label 60 lsrid 2.2.2.2 tunnel-id 300                                
 backward nexthop 10.1.4.1 out-label 70                     
#                                                                               
mpls ldp                                                                        
#                                                                               
mpls ldp remote-peer 1.1.1.1                                                    
 remote-ip 1.1.1.1                                                              
#                                                                               
mpls ldp remote-peer 2.2.2.2                                                    
 remote-ip 2.2.2.2                                                              
#                                                                               
e-trunk 10     
 security-key cipher YsHsjx_202206                                                                 
 priority 20                                                                    
 peer-address 2.2.2.2 source-address 3.3.3.3                                    
#                                                                               
interface Eth-Trunk10                                                           
 mode lacp-static                                                               
 e-trunk 10                                                                     
#
interface Eth-Trunk10.1                                                         
 vlan-type dot1q 10                                                             
 mpls static-l2vc destination 1.1.1.1 2 transmit-vpn-label 400 receive-vpn-label 300 <span>tunnel-policy 1</span>                            
 mpls static-l2vc destination 2.2.2.2 3 transmit-vpn-label 600 receive-vpn-label 500 <span>tunnel-policy 1</span> bypass
 mpls l2vpn pw-aps 3 admin                                                      
#                                                                               
interface GigabitEthernet<span>0/1/0</span>                                                  
 undo shutdown                                                                  
 ip address 10.1.3.2 255.255.255.0                                              
 mpls                                                                           
 mpls te                                                                                                                           
#                                                                               
interface GigabitEthernet<span>0/1/1</span>                                                  
 undo shutdown                                                                  
 ip address 10.1.4.2 255.255.255.0                                              
 mpls                                                                           
 mpls te                                                                                                                           
#                                                                               
interface GigabitEthernet<span>0/1/2</span>                                                  
 undo shutdown                                                                  
 eth-trunk 10                                                                   
#                                                                               
interface LoopBack0                                                             
 ip address 3.3.3.3 255.255.255.255                                             
#                                                                               
interface Tunnel11                                                           
 ip address unnumbered interface LoopBack0                                      
 tunnel-protocol mpls te                                                        
 destination 1.1.1.1                                                            
 mpls te signal-protocol cr-static                                              
 mpls te tunnel-id 200                                                          
 mpls te passive-tunnel                                                         
 mpls te binding bidirectional static-cr-lsp egress Tunnel11                 
 mpls te reserved-for-binding                                                   
#                                                                               
interface Tunnel12                                                           
 ip address unnumbered interface LoopBack0                                      
 tunnel-protocol mpls te                                                        
 destination 2.2.2.2                                                            
 mpls te signal-protocol cr-static                                              
 mpls te tunnel-id 300                                                          
 mpls te passive-tunnel                                                         
 mpls te binding bidirectional static-cr-lsp egress Tunnel12                 
 mpls te reserved-for-binding                                                   
#                                                                               
ospf 1                                                                          
 area 0.0.0.0                                                                   
  network 3.3.3.3 0.0.0.0                                                       
  network 10.1.3.0 0.0.0.255                                                    
  network 10.1.4.0 0.0.0.255                                                    
#                                                                               
static-cr-lsp egress 1to2 incoming-interface GigabitEthernet<span>0/1/1</span> in-label 20   
#                                                                               
tunnel-policy 1                                                           
 tunnel binding destination 1.1.1.1 te Tunnel11                              
 tunnel binding destination 2.2.2.2 te Tunnel12                              
#                                                                               
mpls-oam                                                                        
 mpls oam l2vc peer-ip 1.1.1.1 vc-id 2 vc-type vlan type cv
 mpls oam l2vc peer-ip 2.2.2.2 vc-id 3 vc-type vlan type cv
 mpls oam l2vc enable receive peer-ip 1.1.1.1 vc-id 2 vc-type vlan
 mpls oam l2vc enable send peer-ip 1.1.1.1 vc-id 2 vc-type vlan
 mpls oam l2vc enable receive peer-ip 2.2.2.2 vc-id 3 vc-type vlan
 mpls oam l2vc enable send peer-ip 2.2.2.2 vc-id 3 vc-type vlan
#
return </pre>
</li><li><p>CE2 configuration file</p>
<pre class="screen">#                                                                               
sysname CE2  
#
vlan 10                                                                   
#                                                                               
interface <span>Vlanif10</span>
 ip address 10.1.1.2 255.255.255.0                                              
#                                                                               
interface Eth-Trunk10                                                           
 portswitch                                                                     
 port trunk allow-pass vlan 10                                                  
 mode lacp-static                                                               
#                                                                               
interface GigabitEthernet<span>0/1/0</span>                                                  
 undo shutdown                                                                  
 eth-trunk 10                                                                   
#                                                                               
interface GigabitEthernet<span>0/1/1</span>                                                  
 undo shutdown                                                                  
 eth-trunk 10                                                                   
#                                                                               
return </pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpws_cfg_3012.html">Configuration Examples for VPWS
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpws_cfg_6011.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpws_cfg_6039.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>