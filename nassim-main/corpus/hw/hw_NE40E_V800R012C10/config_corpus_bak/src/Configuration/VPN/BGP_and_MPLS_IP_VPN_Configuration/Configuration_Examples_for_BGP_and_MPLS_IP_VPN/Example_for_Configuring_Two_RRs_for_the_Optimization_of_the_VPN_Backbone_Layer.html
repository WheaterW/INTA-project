
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Two RRs for the Optimization of the VPN Backbone Layer">
<meta name="abstract" content="If a great number of MP-IBGP connections exist between PEs, you can configure RRs to reduce the number of MP-IBGP connections and the workload of PEs, optimizing the VPN backbone layer.">
<meta name="description" content="If a great number of MP-IBGP connections exist between PEs, you can configure RRs to reduce the number of MP-IBGP connections and the workload of PEs, optimizing the VPN backbone layer.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0101.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0106.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0108.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,l3vpnvrp,w00556928,l00468467,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="h00847023">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="h00847023">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172369463">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring Two RRs for the Optimization of the VPN Backbone Layer</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172369463"></a><a name="EN-US_TASK_0172369463"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Two RRs for the Optimization of the VPN Backbone Layer</h1>
<div class="taskbody"><p>If a great number of MP-IBGP connections exist between PEs, you can configure RRs to reduce the number of MP-IBGP connections and the workload of PEs, optimizing the VPN backbone layer.</p>
<div class="context"><a name="EN-US_TASK_0172369463__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>When deploying a VPN, you can configure two RRs on the VPN to improve reliability. To achieve this, you need to configure two Ps in the same AS on the backbone network as RRs and ensure that the two RRs back up each other and reflect VPNv4 and public network routes.</p>
<div class="fignone" id="EN-US_TASK_0172369463__fig_dc_vrp_mpls-l3vpn-v4_cfg_010701"><a name="EN-US_TASK_0172369463__fig_dc_vrp_mpls-l3vpn-v4_cfg_010701"></a><a name="fig_dc_vrp_mpls-l3vpn-v4_cfg_010701"></a><span class="figcap"><b>Figure 1 </b>Configuring two RRs for the optimization of the VPN backbone layer</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 through 3 in this example represent GE<span>0/1/0</span>, GE<span>0/2/0</span>, and GE<span>0/3/0</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_mpls-l3vpn-v4_cfg_010701.png"></span></div>
<p>On the network shown in <a href="#EN-US_TASK_0172369463__fig_dc_vrp_mpls-l3vpn-v4_cfg_010701">Figure 1</a>, PE1, PE2, RR1, and RR2 are in AS 100 of the backbone network. CE1 and CE2 belong to vpna. It is required that RR1 and RR2 be configured as RRs.</p>
</div></div>
<div class="context"><a name="EN-US_TASK_0172369463__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Notes</h4><p>When configuring two RRs for the optimization of the VPN backbone layer, ensure that:</p>
<ul><li><p>The RRs do not filter the received VPNv4 routes based on VPN targets.</p>
</li><li><p>The RRs that back up each other are configured with the same cluster ID.</p>
</li></ul>
</div></div>
<div class="context"><a name="EN-US_TASK_0172369463__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure IGP and enable MPLS and MPLS LDP on the MPLS backbone network to set up LDP LSPs.</p>
</li><li><p>Set up MP-IBGP connections between the PEs and RRs. There is no need to set up an MP-IBGP connection between PEs.</p>
</li><li><p>Set up an EBGP connection between each PE and CE.</p>
</li><li><p>Configure RR1 and RR2 to back up each other and configure them with the same cluster ID.</p>
</li><li><p>Configure RR1 and RR2 to receive all VPNv4 routes without filtering them based on VPN targets, because RR1 and RR2 must save all VPNv4 routes and advertise them to PEs.</p>
</li></ol>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>On a VPN with two RRs, there must be at least two paths not sharing the same network segment or node between each RR and PE. Otherwise, configuring two RRs is unnecessary.</p>
</div></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172369463__1.4.4"></a><a name="1.4.4"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>MPLS LSR IDs of the PEs and RRs</p>
</li><li><p>Names, RDs, and VPN targets of the VPN instances on PE1 and PE2</p>
</li><li><p>AS numbers of the PEs and CEs</p>
</li><li><p>BGP peer group name</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172369463__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure IGP on the MPLS backbone network for devices along the LSP to communicate.</span><p><p>This example uses OSPF as the IGP. For configuration details, see the configuration files.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The loopback interface IP addresses used as LSR IDs must be advertised.</p>
</div></div>
<p>After the configurations are complete, the devices along the LSP can learn the IP address of each other's loopback interface.</p>
<p>The following example uses the command output on PE1.</p>
<pre class="screen">&lt;PE1&gt; <strong>display ip routing-table</strong></pre>
<pre class="screen"><span class="keyword">Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route</span>
------------------------------------------------------------------------------
Routing Table: _public_
         Destinations : 17       Routes : 19

  Destination/Mask  Proto  Pre  Cost         Flags  NextHop         Interface
</pre>
<pre class="screen">        1.1.1.9/32  Direct 0    0                D  127.0.0.1       InLoopBack1
        2.2.2.9/32  OSPF   10   2                D  10.10.2.2       GigabitEthernet<span>0/1/0</span>
        3.3.3.9/32  OSPF   10   2                D  10.10.3.2       GigabitEthernet<span>0/3/0</span>
        4.4.4.9/32  OSPF   10   3                D  10.10.2.2       GigabitEthernet<span>0/1/0</span>
                    OSPF   10   3                D  10.10.3.2       GigabitEthernet<span>0/3/0</span>
      10.10.2.0/24  Direct 0    0                D  10.10.2.1       GigabitEthernet<span>0/1/0</span>
      10.10.2.1/32  Direct 0    0                D  127.0.0.1       GigabitEthernet<span>0/1/0</span>
    10.10.2.255/32  Direct 0    0                D  127.0.0.1       GigabitEthernet<span>0/1/0</span>
      10.10.3.0/24  Direct 0    0                D  10.10.3.1       GigabitEthernet<span>0/3/0</span>
      10.10.3.1/32  Direct 0    0                D  127.0.0.1       GigabitEthernet<span>0/3/0</span>
    10.10.3.255/32  Direct 0    0                D  127.0.0.1       GigabitEthernet<span>0/3/0</span>
      10.20.3.0/24  OSPF   10   2                D  10.10.2.2       GigabitEthernet<span>0/1/0</span>
                    OSPF   10   2                D  10.10.3.2       GigabitEthernet<span>0/3/0</span>
      10.20.4.0/24  OSPF   10   2                D  10.10.2.2       GigabitEthernet<span>0/1/0</span>
      10.30.4.0/24  OSPF   10   2                D  10.10.3.2       GigabitEthernet<span>0/3/0</span>
      127.0.0.0/8   Direct 0    0                D  127.0.0.1       InLoopBack0
      127.0.0.1/32  Direct 0    0                D  127.0.0.1       InLoopBack0
127.255.255.255/32  Direct 0    0                D  127.0.0.1       InLoopBack0
127.255.255.255/32  Direct 0    0                D  127.0.0.1       InLoopBack0</pre>
</p></li><li><span>Set up LSPs on the MPLS backbone network.</span><p><p>Enable MPLS and MPLS LDP on the devices and interfaces along the LSP. For detailed configurations, see Configuration Files.</p>
<p>After completing the configurations, run the <strong>display mpls ldp session</strong> command on the PEs and RRs. The command output shows that the session status is <strong>Operational</strong>.</p>
<p>The following example uses the command output on PE1 and RR1.</p>
<p>Set up LSPs on the MPLS backbone network.</p>
<p>Enable MPLS and MPLS LDP on the devices and interfaces along the LSP. For detailed configurations, see Configuration Files.</p>
<p>After completing the configurations, run the <strong>display mpls ldp session</strong> command on the PEs and RRs. The command output shows that the session status is <strong>Operational</strong>.</p>
<p>The following example uses the command output on PE1 and RR1.</p>
<pre class="screen">&lt;PE1&gt; <strong>display mpls ldp session</strong></pre>
<pre class="screen">               LDP Session(s) in Public Network
 Codes: LAM(Label Advertisement Mode), SsnAge Unit(DDDD:HH:MM)
<span> An asterisk (*) before a session means the session is being deleted.</span>
----------------------------------------------------------------------
 Peer-ID            Status      LAM  SsnRole  SsnAge      KA-Sent/Rcv
----------------------------------------------------------------------
<strong> 2.2.2.9:0</strong>         <strong>Operational</strong> DU   Passive  0000:00:01   8/8
 <strong>3.3.3.9:0</strong>         <strong>Operational</strong> DU   Passive  0000:00:00   4/4
----------------------------------------------------------------------
 TOTAL: 2 session(s) Found.</pre>
<p></p>
<pre class="screen">&lt;RR1&gt; <strong>display mpls ldp session</strong></pre>
<pre class="screen">               LDP Session(s) in Public Network
 Codes: LAM(Label Advertisement Mode), SsnAge Unit(DDDD:HH:MM)
<span> An asterisk (*) before a session means the session is being deleted.</span>
----------------------------------------------------------------------
 Peer-ID            Status      LAM  SsnRole  SsnAge      KA-Sent/Rcv
----------------------------------------------------------------------
 <strong>1.1.1.9:0</strong>         <strong>Operational</strong> DU   Active  0000:00:02   11/11
 <strong>3.3.3.9:0</strong>         <strong>Operational</strong> DU   Passive 0000:00:01   8/8
 <strong>4.4.4.9:0</strong>         <strong>Operational</strong> DU   Passive 0000:00:00   4/4
----------------------------------------------------------------------
 TOTAL: 3 session(s) Found.</pre>
</p></li><li><span>Set up an MP-IBGP peer relationship between each PE and RR.</span><p><p># Configure PE1.</p>
<pre class="screen">&lt;PE1&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 2.2.2.9 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 2.2.2.9 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 3.3.3.9 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 3.3.3.9 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>ipv4-family vpnv4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-vpnv4] <strong>peer 2.2.2.9 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-vpnv4] <strong>peer 3.3.3.9 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-vpnv4] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp-af-vpnv4] <strong>quit</strong></pre>
<p># Configure RR1.</p>
<pre class="screen">&lt;RR1&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RR1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR1-bgp] <strong>peer 1.1.1.9 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR1-bgp] <strong>peer 1.1.1.9 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR1-bgp] <strong>peer 3.3.3.9 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR1-bgp] <strong>peer 3.3.3.9 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR1-bgp] <strong>peer 4.4.4.9 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR1-bgp] <strong>peer 4.4.4.9 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR1-bgp] <strong>ipv4-family vpnv4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR1-bgp-af-vpnv4] <strong>peer 1.1.1.9 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR1-bgp-af-vpnv4] <strong>peer 3.3.3.9 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR1-bgp-af-vpnv4] <strong>peer 4.4.4.9 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR1-bgp-af-vpnv4] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RR1-bgp-af-vpnv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RR1-bgp] <strong>quit</strong></pre>
<p># Configure RR2.</p>
<pre class="screen">&lt;RR2&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RR2]<strong> bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR2-bgp] <strong>peer 1.1.1.9 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR2-bgp] <strong>peer 1.1.1.9 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR2-bgp] <strong>peer 2.2.2.9 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR2-bgp] <strong>peer 2.2.2.9 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR2-bgp] <strong>peer 4.4.4.9 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR2-bgp] <strong>peer 4.4.4.9 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR2-bgp] <strong>ipv4-family vpnv4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR2-bgp-af-vpnv4] <strong>peer 1.1.1.9 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR2-bgp-af-vpnv4] <strong>peer 2.2.2.9 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR2-bgp-af-vpnv4] <strong>peer 4.4.4.9 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR2-bgp-af-vpnv4] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RR2-bgp-af-vpnv4]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RR2-bgp] <strong>quit</strong></pre>
<p># Configure PE2.</p>
<p>The configuration of PE2 is similar to the configuration of PE1. For configuration details, see the configuration files.</p>
<p>After completing the configurations, run the <strong>display bgp vpnv4 all peer</strong> command on PEs. The command output shows that the IBGP peer relationship is established between each PE and RR, and the EBGP peer relationship is established between each PE and CE.</p>
<p>The following example uses the command output on PE1.</p>
<pre class="screen">&lt;PE1&gt; <strong>display bgp vpnv4 all peer</strong></pre>
<pre class="screen"> 
 BGP local router ID : 1.1.1.9
 Local AS number : 100
 Total number of peers : 3                 Peers in established state : 3
  Peer          V    AS  MsgRcvd  MsgSent  OutQ  Up/Down       State  PrefRcv
  <strong>2.2.2.9</strong>       4   100        2        4     0 00:00:31 <strong>Established</strong>        0
  <strong>3.3.3.9</strong>       4   100        3        5     0 00:01:23 <strong>Established</strong>        1</pre>
</p></li><li><span>Set up EBGP peer relationships between PEs and CEs to import VPN routes.</span><p><p>For details, see <a href="dc_vrp_mpls-l3vpn-v4_cfg_0102.html">Example for Configuring BGP/MPLS IP VPN</a>.</p>
</p></li><li><span>Configure a VPN instance<span> enabled with the IPv4 address family</span> on each PE.</span><p><p>For details, see <a href="dc_vrp_mpls-l3vpn-v4_cfg_0102.html">Example for Configuring BGP/MPLS IP VPN</a>.</p>
</p></li><li><span>Configure route reflection on RR1 and RR2.</span><p><p># Configure RR1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RR1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RR1-bgp] <strong>ipv4-family vpnv4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR1-bgp-af-vpnv4] <strong>reflector cluster-id 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR1-bgp-af-vpnv4] <strong>peer 1.1.1.9 reflect-client</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR1-bgp-af-vpnv4] <strong>peer 3.3.3.9 reflect-client</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR1-bgp-af-vpnv4] <strong>peer 4.4.4.9 reflect-client</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR1-bgp-af-vpnv4] <strong>undo policy vpn-target</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR1-bgp-af-vpnv4] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RR1-bgp-af-vpnv4] <strong>quit</strong></pre>
<p># Configure RR2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RR2]<strong> bgp 100</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RR2-bgp] <strong>ipv4-family vpnv4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR2-bgp-af-vpnv4] <strong>reflector cluster-id 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR2-bgp-af-vpnv4] <strong>peer 1.1.1.9 reflect-client</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR2-bgp-af-vpnv4] <strong>peer 2.2.2.9 reflect-client</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR2-bgp-af-vpnv4] <strong>peer 4.4.4.9 reflect-client</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR2-bgp-af-vpnv4] <strong>undo policy vpn-target</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR2-bgp-af-vpnv4] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RR2-bgp-af-vpnv4] <strong>quit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p>Check the VPN routing table on the PEs. The command output shows routes to the loopback interfaces of the remote CEs.</p>
<p>The following example uses the command output on PE1.</p>
<pre class="screen">&lt;PE1&gt; <strong>display ip routing-table vpn-instance vpna</strong></pre>
<pre class="screen"><span class="keyword">Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route</span>
------------------------------------------------------------------------------
Routing Table: vpna
         Destinations : 7        Routes : 7

  Destination/Mask  Proto  Pre  Cost         Flags NextHop         Interface

       10.1.1.0/24  Direct  0    0             D   10.1.1.2        GigabitEthernet<span>0/2/0</span>
       10.1.1.2/32  Direct  0    0             D   127.0.0.1       GigabitEthernet<span>0/2/0</span>
     10.1.1.255/32  Direct  0    0             D   127.0.0.1       GigabitEthernet<span>0/2/0</span>
    11.11.11.11/32  EBGP    255  0             RD  10.1.1.1        GigabitEthernet<span>0/2/0</span>
    22.22.22.22/32  IBGP    255  0             RD  4.4.4.9         GigabitEthernet<span>0/3/0</span>
                    IBGP    255  0             RD  4.4.4.9         GigabitEthernet<span>0/1/0</span>
      127.0.0.0/8   Direct  0    0             D   127.0.0.1       InLoopBack0
255.255.255.255/32  Direct  0    0             D   127.0.0.1       InLoopBack0</pre>
<p>CE1 and CE2 can successfully ping each other, indicating that the configuration succeeds.</p>
<pre class="screen">&lt;CE1&gt;ping -a 11.11.11.11 22.22.22.22
  PING 22.22.22.22: 56  data bytes, press CTRL_C to break
    Reply from 22.22.22.22: bytes=56 Sequence=1 ttl=252 time=352 ms
    Reply from 22.22.22.22: bytes=56 Sequence=2 ttl=252 time=88 ms
    Reply from 22.22.22.22: bytes=56 Sequence=3 ttl=252 time=2 ms
    Reply from 22.22.22.22: bytes=56 Sequence=4 ttl=252 time=3 ms
    Reply from 22.22.22.22: bytes=56 Sequence=5 ttl=252 time=2 ms</pre>
<p>After the <strong>shutdown</strong> command is run in the view of GE<span>0/3/0</span> on PE1 or GE<span>0/3/0</span> on PE2, CE1 and CE2 can still successfully ping each other. This indicates that the two RRs are successfully configured.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]interface GigabitEthernet<span>0/3/0</span></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/3/0</span>]<strong> shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/3/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/3/0</span>] <strong>quit</strong></pre>
<pre class="screen">&lt;CE1&gt;ping -a 11.11.11.11 22.22.22.22
  PING 22.22.22.22: 56  data bytes, press CTRL_C to break
    Reply from 22.22.22.22: bytes=56 Sequence=1 ttl=252 time=4 ms
    Reply from 22.22.22.22: bytes=56 Sequence=2 ttl=252 time=2 ms
    Reply from 22.22.22.22: bytes=56 Sequence=3 ttl=252 time=3 ms
    Reply from 22.22.22.22: bytes=56 Sequence=4 ttl=252 time=2 ms
    Reply from 22.22.22.22: bytes=56 Sequence=5 ttl=252 time=2 ms

  --- 22.22.22.22 ping statistics ---
    5 packet(s) transmitted
    5 packet(s) received
    0.00% packet loss
    round-trip min/avg/max = 2/2/4 ms</pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172369463__1.4.6"></a><a name="1.4.6"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>PE1 configuration file</p>
<pre class="screen">#
sysname PE1
#
ip vpn-instance vpna
 ipv4-family
  route-distinguisher 100:1
  apply-label per-instance
  vpn-target 1:1 export-extcommunity
  vpn-target 1:1 import-extcommunity
#
mpls lsr-id 1.1.1.9
#
mpls
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.10.2.1 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip binding vpn-instance vpna
 ip address 10.1.1.2 255.255.255.0
#
interface GigabitEthernet<span>0/3/0</span>
 undo shutdown
 ip address 10.10.3.1 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 1.1.1.9 255.255.255.255
#
bgp 100
 peer 2.2.2.9 as-number 100
 peer 2.2.2.9 connect-interface LoopBack1
 peer 3.3.3.9 as-number 100
 peer 3.3.3.9 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 2.2.2.9 enable
  peer 3.3.3.9 enable
 #
 ipv4-family vpnv4
  policy vpn-target
  peer 2.2.2.9 enable
  peer 3.3.3.9 enable
 #
 ipv4-family vpn-instance vpna
  peer 10.1.1.1 as-number 65410
#
ospf 1
 area 0.0.0.0
  network 1.1.1.9 0.0.0.0
  network 10.10.2.0 0.0.0.255
  network 10.10.3.0 0.0.0.255
#
return </pre>
</li><li><p>RR1 configuration file</p>
<pre class="screen">#
sysname RR1
#
mpls lsr-id 2.2.2.9
#
mpls
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.10.2.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.20.3.1 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/3/0</span>
 undo shutdown
 ip address 10.20.4.1 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 2.2.2.9 255.255.255.255
#
bgp 100
 peer 1.1.1.9 as-number 100
 peer 1.1.1.9 connect-interface loopback 1
 peer 3.3.3.9 as-number 100
 peer 3.3.3.9 connect-interface loopback 1
 peer 4.4.4.9 as-number 100
 peer 4.4.4.9 connect-interface loopback 1
 #
 ipv4-family unicast
  undo synchronization
  peer 1.1.1.9 enable
  peer 3.3.3.9 enable
  peer 4.4.4.9 enable
 #
 ipv4-family vpnv4
  reflector cluster-id 100
  undo policy vpn-target
  peer 1.1.1.9 enable
  peer 1.1.1.9 reflect-client
  peer 3.3.3.9 enable
  peer 3.3.3.9 reflect-client
  peer 4.4.4.9 enable
  peer 4.4.4.9 reflect-client
#
ospf 1
 area 0.0.0.0
  network 10.10.2.0 0.0.0.255
  network 10.20.3.0 0.0.0.255
  network 10.20.4.0 0.0.0.255
  network 2.2.2.9 0.0.0.0
#
return</pre>
</li><li><p>RR2 configuration file</p>
<pre class="screen">#
sysname RR2
#
mpls lsr-id 3.3.3.9
#
mpls
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.20.3.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.30.4.1 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/3/0</span>
 undo shutdown
 ip address 10.10.3.2 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 3.3.3.9 255.255.255.255
#
bgp 100
 peer 1.1.1.9 as-number 100
 peer 1.1.1.9 connect-interface LoopBack1
 peer 2.2.2.9 as-number 100
 peer 2.2.2.9 connect-interface LoopBack1
 peer 4.4.4.9 as-number 100
 peer 4.4.4.9 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 1.1.1.9 enable
  peer 2.2.2.9 enable
  peer 4.4.4.9 enable
 #
 ipv4-family vpnv4
  reflector cluster-id 100
  undo policy vpn-target
  peer 1.1.1.9 enable
  peer 1.1.1.9 reflect-client
  peer 2.2.2.9 enable
  peer 2.2.2.9 reflect-client
  peer 4.4.4.9 enable
  peer 4.4.4.9 reflect-client
#
ospf 1
 area 0.0.0.0
  network 10.20.3.0 0.0.0.255
  network 10.30.4.0 0.0.0.255
  network 10.10.3.0 0.0.0.255
  network 3.3.3.9 0.0.0.0
#
return</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#
sysname PE2
#
ip vpn-instance vpna
 ipv4-family
  route-distinguisher 200:1
  apply-label per-instance
  vpn-target 1:1 export-extcommunity
  vpn-target 1:1 import-extcommunity
#
mpls lsr-id 4.4.4.9
#
mpls
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.30.4.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip binding vpn-instance vpna
 ip address 10.2.1.2 255.255.255.0
#
interface GigabitEthernet<span>0/3/0</span>
 undo shutdown
 ip address 10.20.4.2 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 4.4.4.9 255.255.255.255
#
bgp 100
 peer 2.2.2.9 as-number 100
 peer 2.2.2.9 connect-interface LoopBack1
 peer 3.3.3.9 as-number 100
 peer 3.3.3.9 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 2.2.2.9 enable
  peer 3.3.3.9 enable
 #
 ipv4-family vpnv4
  policy vpn-target
  peer 2.2.2.9 enable
  peer 3.3.3.9 enable
 #
 ipv4-family vpn-instance vpna
  peer 10.2.1.1 as-number 65420
#
ospf 1
 area 0.0.0.0
  network 4.4.4.9 0.0.0.0
  network 10.30.4.0 0.0.0.255
  network 10.20.4.0 0.0.0.255
#
return</pre>
</li><li><p>CE1 configuration file</p>
<pre class="screen">#
sysname CE1
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.1.1 255.255.255.0
#
interface Loopback 1
 undo shutdown
 ip address 11.11.11.11 255.255.255.255
#
bgp 65410
 peer 10.1.1.2 as-number 100
 #
 ipv4-family unicast
  undo synchronization
  network 11.11.11.11 255.255.255.255
  peer 10.1.1.2 enable
#
return</pre>
</li><li><p>CE2 configuration file</p>
<pre class="screen">#
sysname CE2
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.2.1.1 255.255.255.0
#
interface Loopback 1
 undo shutdown
 ip address 22.22.22.22 255.255.255.255
#
bgp 65420
 peer 10.2.1.2 as-number 100
 #
 ipv4-family unicast
  undo synchronization
  network 22.22.22.22 255.255.255.255
  peer 10.2.1.2 enable
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0101.html">Configuration Examples for BGP/MPLS IP VPN
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0106.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0108.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>