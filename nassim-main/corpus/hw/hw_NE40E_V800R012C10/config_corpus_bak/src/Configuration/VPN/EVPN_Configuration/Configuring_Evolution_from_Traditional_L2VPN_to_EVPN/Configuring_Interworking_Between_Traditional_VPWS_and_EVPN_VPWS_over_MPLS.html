
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring Interworking Between Traditional VPWS and EVPN VPWS over MPLS">
<meta name="abstract" content="The aggregation layer of a network still uses traditional VPWS, whereas the core network has evolved to EVPN. To allow communication between different layers, interworking between traditional VPWS and EVPN VPWS over MPLS must be configured.">
<meta name="description" content="The aggregation layer of a network still uses traditional VPWS, whereas the core network has evolved to EVPN. To allow communication between different layers, interworking between traditional VPWS and EVPN VPWS over MPLS must be configured.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2vpn_to_evpn_cfg_0000.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2vpn_to_evpn_cfg_0001.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2vpn_to_evpn_cfg_0004.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="p00915595,w00800033,w00556928,l00468467,w00606909,evpnvrp,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="p00915595">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00878323">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172370520">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring Interworking Between Traditional VPWS and EVPN VPWS over MPLS</title>
</head>
<body><a name="EN-US_TASK_0172370520"></a><a name="EN-US_TASK_0172370520"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring Interworking Between Traditional VPWS and EVPN VPWS over MPLS</h1>
<div class="taskbody"><p>The aggregation layer of a network still uses traditional VPWS, whereas the core network has evolved to EVPN. To allow communication between different layers, interworking between traditional VPWS and EVPN VPWS over MPLS must be configured.</p>
<div class="context"><a name="EN-US_TASK_0172370520__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>As the metro network evolves to EVPN, a large number of devices at the aggregation layer still use traditional VPWS, making it difficult to complete E2E evolution to EVPN at one time. However, the core network has evolved to EVPN, necessitating interworking between traditional VPWS and EVPN VPWS over MPLS. This section describes how to configure interworking between traditional VPWS and EVPN VPWS over MPLS.</p>
<p>On the network shown in <a href="#EN-US_TASK_0172370520__fig583817311216">Figure 1</a>, CE1 with two sites attached is connected to a UPE through a NID (switch). The UPE and NPEs are connected through an MPLS network at the aggregation layer, and services are carried using a VPWS. NPE1, NPE2, and NPE3 are connected through an MPLS network at the core layer, and services are carried through EVPN VPWS over MPLS.</p>
<div class="fignone" id="EN-US_TASK_0172370520__fig583817311216"><a name="EN-US_TASK_0172370520__fig583817311216"></a><a name="fig583817311216"></a><span class="figcap"><b>Figure 1 </b>Configuring interworking between traditional VPWS and EVPN VPWS over MPLS</span><br><span><img class="vsd" src="figure/en-us_image_0000001181213328.png" width="NaN" height="NaN"></span></div>
<ul><li><p>A UPE is dual-homed to NPE1 and NPE2, which improves access reliability. The UPE establishes a pair of primary and secondary PWs with the master and backup NPEs, respectively. Traffic is sent through the primary PW, and the UPE is enabled to receive traffic through both the primary and secondary PWs.</p>
</li><li><p>On NPEs, VPWS accesses EVPN VPWS over MPLS through PW VE interfaces. Specifically, VPWS is configured on PW VE interfaces, PW VE sub-interfaces are bound to EVPL instances, and EVPL instances are bound to EVPN instances. PW VE sub-interfaces are configured with QinQ or dot1q VLAN tag termination to import traffic into EVPN VPWS over MPLS.</p>
</li></ul>
</div></div>
<div class="context"><a name="EN-US_TASK_0172370520__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Pre-configuration Tasks</h4><p>Before configuring interworking between traditional VPWS and EVPN VPWS over MPLS, complete the following tasks:</p>
<ul><li><p>Configure interfaces and their IP addresses on NPE1, NPE2, NPE3, and the UPE.</p>
</li><li><p>Configure an IGP on NPE1, NPE2, NPE3, and the UPE to ensure route reachability.</p>
</li><li><p><a href="dc_vrp_vpws_cfg_5008.html">Configure master/slave PW redundancy</a> on the UPE.</p>
</li><li><p><a href="dc_vrp_evpn_cfg_0020.html">Configure EVPN VPWS over MPLS</a> on NPE1, NPE2, and NPE3.</p>
</li><li><p>Configure basic MPLS LDP functions on NPE1, NPE2, NPE3, and the UPE.</p>
</li><li><p><a href="dc_vrp_evpn_cfg_0021.html">Configure EVPL instances</a> on each of NPE1, NPE2, and NPE3.</p>
</li></ul>
<p>Perform the following steps on the NPE.</p>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172370520__1.4.3"></a><a name="1.4.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li><span>Run <a href="cmdqueryname=interface"><b><span class="cmdname">interface</span></b></a> <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i></span><p><p>The PW VE interface view is displayed.</p>
</p></li><li><span>Run the <span><span><a href="cmdqueryname=mpls+l2vc"><b><span class="cmdname">mpls l2vc</span></b></a></span> <span>[ <strong><span>instance-name</span></strong> <i><span class="varname">instance-name</span></i> ]</span> { <i><span class="varname">ip-address</span></i> | <strong><span>pw-template</span></strong> <i><span class="varname">template-name</span></i> } <sup>*</sup> <i><span class="varname">vc-id</span></i> [ <strong><span>tunnel-policy</span></strong> <i><span class="varname">policy-name</span></i><span> [ { <strong><span>endpoint</span></strong> <i><span class="varname">endpoint-address</span></i><span> | [ <strong><span>endpoint</span></strong> <i><span class="varname">endpoint4-address</span></i> ] }</span> <strong><span>color</span></strong> <i><span class="varname">color-value</span></i> ]</span> | [ <strong><span>control-word</span></strong> | <strong><span>no-control-word</span></strong> ] | [ <strong><span>raw</span></strong> | <strong><span>tagged</span></strong><strong><span> </span></strong>] | <strong><span>access-port</span></strong> | <strong><span>ignore-standby-state</span></strong> ]</span> command to create a VPWS connection.</span></li><li><span>Run <a href="cmdqueryname=esi"><b><span class="cmdname">esi</span></b></a> <i><span class="varname">esi</span></i></span><p><p>An ESI is configured.</p>
</p></li><li><span>Run <span><a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span></span><p><p>Return to the system view.</p>
</p></li><li><span>Run <a href="cmdqueryname=interface"><b><span class="cmdname">interface</span></b></a> <i><span class="varname">interface-type interface-number.subnum</span></i></span><p><p>A PW VE sub-interface is created, and the PW-VE sub-interface view is displayed.</p>
</p><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Before running this command, ensure that the Layer 2 main interface does not have the <a href="cmdqueryname=port+link-type"><b><span class="cmdname">port link-type</span></b></a> <strong><span>dot1q-tunnel</span></strong> command configuration. If the configuration exists, run the <a href="cmdqueryname=undo+port+link-type"><b><span class="cmdname">undo port link-type</span></b></a> command to delete the configuration.</p>
<p>In addition to a Layer 2 sub-interface, an Ethernet main interface, Layer 3 sub-interface, or Eth-Trunk interface can also function as an AC interface.</p>
</div></div>
</p></li><li><span>Configure an encapsulation type for the PW VE sub-interface.</span><p><ol type="a"><li>Run the <a href="cmdqueryname=encapsulation"><b><span class="cmdname">encapsulation</span></b></a> <strong><span>dot1q-termination</span></strong> [ <strong><span>rt-protocol</span></strong> ] command to configure the dot1q encapsulation type for a VLAN tag termination sub-interface.<p>To enable the dot1q VLAN tag termination sub-interface to support routing protocols, configure <strong><span>rt-protocol</span></strong>.</p>
</li><li>Configure the dot1q VLAN tag termination sub-interface<span> using one or more of the following commands</span> based on site requirements:<ul><li>To configure a dot1q VLAN tag termination sub-interface, run the <a href="cmdqueryname=dot1q+termination+vid"><b><span class="cmdname">dot1q termination vid</span></b></a> <i><span class="varname">low-pe-vid</span></i> [ <strong><span>vlan-group</span></strong> <i><span class="varname">group-id</span></i> ] command.</li><li>To configure a dot1q VLAN tag termination sub-interface and a matching policy for the sub-interface, run the <a href="cmdqueryname=dot1q+termination+vid"><b><span class="cmdname">dot1q termination vid</span></b></a> <i><span class="varname">low-pe-vid</span></i> { <strong><span>8021p</span></strong> { <i><span class="varname">8val8021p1</span></i> [ <strong><span>to</span></strong> <em>val8021p2</em> ] } &amp;&lt;1-8&gt; | <strong><span>dscp</span></strong> { <em>valdscp1</em> [ <strong><span>to</span></strong> <em>valdscp2</em> ] } &amp;&lt;1-10&gt; | <strong><span>eth-type pppoe</span></strong> | <strong><span>default</span></strong> } [ <strong><span>vlan-group</span></strong> <i><span class="varname">group-id</span></i> ] command.</li><li>To configure a dot1q VLAN tag termination sub-interface and a matching policy for the sub-interface, run the <a href="cmdqueryname=dot1q+termination+vid"><b><span class="cmdname">dot1q termination vid</span></b></a> <i><span class="varname">low-pe-vid</span></i> { <strong><span>8021p</span></strong> { <em>val8021p1</em> [ <strong><span>to</span></strong> <em>val8021p2</em> ] } &amp;&lt;1-8&gt; | <strong><span>dscp</span></strong> { <em>valdscp1</em> [ <strong><span>to</span></strong> <em>valdscp2</em> ] } &amp;&lt;1-10&gt; | <strong><span>default</span></strong> } [ <strong><span>vlan-group</span></strong> <i><span class="varname">group-id</span></i> ] command.</li></ul>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>If you do not configure a matching policy, the dot1q VLAN tag termination sub-interface terminates the VLAN tags of packets carrying the specified VLAN ID. If you configure a matching policy, the dot1q VLAN tag termination sub-interface terminates the VLAN tags of packets carrying the specified VLAN ID+802.1p value/DSCP value/EthType.</p>
</div></div>
</li></ol>
</p></li><li><span>Run <a href="cmdqueryname=evpl+instance"><b><span class="cmdname">evpl instance</span></b></a> <i><span class="varname">evpl-id</span></i></span><p><p>The PW VE sub-interface is bound to the EVPL instance.</p>
</p><p></p></li><li><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol></div>
<div class="postreq"><a name="EN-US_TASK_0172370520__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p>Run the <a href="cmdqueryname=display+bgp+evpn+all+routing-table"><b><span class="cmdname">display bgp evpn all routing-table</span></b></a> command on the NPEs and check for EVI AD routes received by the NPEs.</p>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2vpn_to_evpn_cfg_0000.html">Configuring Evolution from Traditional L2VPN to EVPN
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2vpn_to_evpn_cfg_0001.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2vpn_to_evpn_cfg_0004.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>