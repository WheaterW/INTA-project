
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring BGP AD VPLS">
<meta name="abstract" content="BGP AD VPLS applies to scenarios where PEs can use BGP as the VPLS signaling. BGP AD VPLS allows automatic discovery of VPLS PEs based on VPN targets.">
<meta name="description" content="BGP AD VPLS applies to scenarios where PEs can use BGP as the VPLS signaling. BGP AD VPLS allows automatic discovery of VPLS PEs based on VPN targets.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_5029.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_5056.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_5068.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,vpls,w00556928,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="VPLS">
<meta name="featuretype" content="VPN">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="VPLS">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="VPLS">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="VPLS">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="l00415692">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00415692">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172370269">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring BGP AD VPLS</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172370269"></a><a name="EN-US_TASK_0172370269"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring BGP AD VPLS</h1>
<div class="taskbody"><p>BGP AD VPLS applies to scenarios where PEs can use BGP as the VPLS signaling. BGP AD VPLS allows automatic discovery of VPLS PEs based on VPN targets.</p>
<div class="context"><a name="EN-US_TASK_0172370269__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>Conventional VPLS networks are classified into LDP and BGP VPLS networks.</p>
<ul><li>LDP VPLS networks require that VPLS members be manually deployed and PWs be established by using LDP signaling. The configurations of LDP VPLS are complex because multiple PEs deployed on a full-mesh network, making the network difficult to expand.</li><li>BGP VPLS uses BGP to dynamically discover members. This wastes labels and increases operating expense (OPEX) on managing site IDs.</li></ul>
<p>BGP AD VPLS prevents the preceding problems. BGP AD VPLS obtains the advantages of both BGP and LDP VPLS. BGP AD VPLS exchanges extended BGP packets to automatically discover VSI members, and uses LDP FEC 129 to negotiate the creation of PWs. This allows VPLS services to be automatically deployed. This simplifies network configurations and reduces OPEX.</p>
<p>On the network shown in <a href="#EN-US_TASK_0172370269__fig_dc_vrp_vpls_cfg_506201">Figure 1</a>, BGP AD VPLS is configured on PE1, PE2, and PE3. CE1 is connected to PE1; CE2 is connected to PE2; CE3 is connected to PE3. CE1, CE2, and CE3 belong to the same VPLS network.</p>
<div class="fignone" id="EN-US_TASK_0172370269__fig_dc_vrp_vpls_cfg_506201"><a name="EN-US_TASK_0172370269__fig_dc_vrp_vpls_cfg_506201"></a><a name="fig_dc_vrp_vpls_cfg_506201"></a><span class="figcap"><b>Figure 1 </b>Configuring BGP AD VPLS</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><ul><li><p>In this example, subinterface1.1, interface2, and interface3 represent GE<span>0/1/0</span>.1, GE<span>0/2/0</span>, and GE<span>0/1/3</span>, respectively.</p>
</li></ul>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_vpls_cfg_506201.png"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172370269__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>On the backbone network, configure a routing protocol to implement connectivity between devices and configure basic MPLS functions.</p>
</li><li><p>Establish LSPs between PEs.</p>
</li><li><p>Enable MPLS L2VPN on PEs.</p>
</li><li><p>Enable BGP peers (PEs) to exchange VPLS information.</p>
</li><li><p>Create a VSI on each PE, specify BGP signaling, and specify the VPLS ID and VPN targets.</p>
</li><li><p>Bind AC interfaces to VSIs.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172370269__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>Peer IP addresses</p>
</li><li><p>VSI names on PE1, PE2, and PE3</p>
</li><li><p>BGP AS numbers of PE1, PE2, and PE3</p>
</li><li><p>VSI signaling protocol (BGP)</p>
</li><li><p>VPLS ID and VPN target on each PE</p>
</li><li><p>Names and VLAN IDs of the interfaces to be bound to VSIs</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172370269__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure an IGP. In this example, OSPF is used.</span><p><p>Assign an IP address to each interface on PEs as shown in <a href="#EN-US_TASK_0172370269__fig_dc_vrp_vpls_cfg_506201">Figure 1</a>. Configure OSPF and advertise 32-bit loopback interface addresses (LSR IDs) of PE1, PE2, and PE3.</p>
<p>After the configuration is complete, run the <a href="cmdqueryname=display+ip+routing-table"><b><span class="cmdname">display ip routing-table</span></b></a> command on PE1, PE2, and PE3. The command output shows that they have learned routes from each other.</p>
<p>For detailed configurations, see <a href="#EN-US_TASK_0172370269__dc_vrp_vpls_cfg_506207">Configuration Files</a>.</p>
</p></li><li><span>Configure basic MPLS functions and LDP.</span><p><p>For detailed configurations, see <a href="#EN-US_TASK_0172370269__dc_vrp_vpls_cfg_506207">Configuration Files</a>.</p>
<p>After the configuration is complete, run the <a href="cmdqueryname=display+mpls+ldp+peer"><b><span class="cmdname">display mpls ldp peer</span></b></a> command on PE1, PE2, and PE3. The command output shows that LDP peer relationships have been set up between PE1 and PE2, between PE1 and PE3, and between PE2 and PE3. Run the <a href="cmdqueryname=display+mpls+ldp+session"><b><span class="cmdname">display mpls ldp session</span></b></a> command on PE1, PE2, and PE3. The command output shows that LDP sessions have been set up between these peers. Run the <a href="cmdqueryname=display+mpls+lsp"><b><span class="cmdname">display mpls lsp</span></b></a> command. The command output shows whether LSPs have been set up.</p>
</p></li><li><span>Enable BGP peers to exchange VPLS information.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp]<strong> peer 2.2.2.9 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp]<strong> peer 3.3.3.9 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp]<strong> peer 2.2.2.9 connect-interface loopback1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp]<strong> peer 3.3.3.9 connect-interface loopback1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp]<strong> l2vpn-ad-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-l2vpn-ad]<strong> peer 2.2.2.9 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-l2vpn-ad]<strong> peer 3.3.3.9 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-l2vpn-ad]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2]<strong> bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp]<strong> peer 1.1.1.9 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp]<strong> peer 3.3.3.9 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp]<strong> peer 1.1.1.9 connect-interface loopback1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp]<strong> peer 3.3.3.9 connect-interface loopback1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp]<strong> l2vpn-ad-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-l2vpn-ad]<strong> peer 1.1.1.9 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-l2vpn-ad]<strong> peer 3.3.3.9 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-l2vpn-ad]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> commit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3]<strong> bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp]<strong> peer 1.1.1.9 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp]<strong> peer 2.2.2.9 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp]<strong> peer 1.1.1.9 connect-interface loopback1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp]<strong> peer 2.2.2.9 connect-interface loopback1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp]<strong> l2vpn-ad-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp-af-l2vpn-ad]<strong> peer 1.1.1.9 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp-af-l2vpn-ad]<strong> peer 2.2.2.9 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp-af-l2vpn-ad]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3]<strong> commit</strong></pre>
</p></li><li><span>Enable MPLS L2VPN on PEs.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2]<strong> mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> commit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3]<strong> mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3]<strong> commit</strong></pre>
</p></li><li><span>Configure a VSI on each PE.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> vsi vplsad1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vplsad1]<strong>bgp-ad</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vplsad1-bgpad]<strong> vpls-id 10.10.1.1:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vplsad1-bgpad]<strong> vpn-target 100:1 import-extcommunity</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vplsad1-bgpad]<strong> vpn-target 100:1 export-extcommunity</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vplsad1-bgpad]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vplsad1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> vsi vplsad1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-vplsad1]<strong>bgp-ad</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-vplsad1-bgpad]<strong> vpls-id 10.10.1.1:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-vplsad1-bgpad]<strong> vpn-target 100:1 import-extcommunity</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-vplsad1-bgpad]<strong> vpn-target 100:1 export-extcommunity</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-vplsad1-bgpad]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-vplsad1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> commit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3]<strong> vsi vplsad1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vplsad1]<strong>bgp-ad</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vplsad1-bgpad]<strong> vpls-id 10.10.1.1:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vplsad1-bgpad]<strong> vpn-target 100:1 import-extcommunity</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vplsad1-bgpad]<strong> vpn-target 100:1 export-extcommunity</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vplsad1-bgpad]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vplsad1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3]<strong> commit</strong></pre>
</p></li><li><span>Bind AC interfaces to VSIs on PEs.</span><p><p># Create a sub-interface on PE1, add this sub-interface to VLAN 10, and bind this sub-interface to the VSI.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> interface gigabitethernet<span>0/1/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1]<strong> shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1]<strong> vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1]<strong> l2 binding vsi vplsad1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> commit</strong></pre>
<p># Create a sub-interface on PE2, add this sub-interface to VLAN 10, and bind this sub-interface to the VSI.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2]<strong> interface gigabitethernet<span>0/1/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>.1]<strong> shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>.1]<strong> vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>.1]<strong> l2 binding vsi vplsad1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>.1]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>.1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> commit</strong></pre>
<p># Create a sub-interface on PE3, add this sub-interface to VLAN 10, and bind this sub-interface to the VSI.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3]<strong> interface gigabitethernet<span>0/1/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/0</span>.1]<strong> shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/0</span>.1]<strong> vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/0</span>.1]<strong> l2 binding vsi vplsad1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/0</span>.1]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/0</span>.1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3]<strong> commit</strong></pre>
</p></li><li><span>Configure CEs.</span><p><p># Configure CE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname CE1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1]<strong> interface gigabitethernet<span>0/1/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>.1] <strong>shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>.1] <strong>vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>.1] <strong>ip address 10.1.1.1 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>.1] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>commit</strong></pre>
<p># Configure CE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname CE2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2]<strong> interface gigabitethernet<span>0/1/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>.1] <strong>shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>.1] <strong>vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>.1] <strong>ip address 10.1.1.2 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>.1] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>commit</strong></pre>
<p># Configure CE3.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>sysname CE3</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE3]<strong> interface gigabitethernet<span>0/1/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-GigabitEthernet<span>0/1/0</span>.1] <strong>shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-GigabitEthernet<span>0/1/0</span>.1] <strong>vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-GigabitEthernet<span>0/1/0</span>.1] <strong>ip address 10.1.1.3 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-GigabitEthernet<span>0/1/0</span>.1] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-GigabitEthernet<span>0/1/0</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3] <strong>commit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p>After the configurations are complete, run the <a href="cmdqueryname=display+vsi+name+vplsad1+verbose"><b><span class="cmdname">display vsi name vplsad1 verbose</span></b></a> command on PE1. The command output shows that a VSI named <strong>vplsad1</strong> is up. In this VSI, PWs have been established successfully between PE1 and PE2, PE1 and PE3, and between PE2 and PE3.</p>
<pre class="screen">&lt;PE1&gt; <strong>display vsi name vplsad1 verbose</strong></pre>
<pre class="screen"> ***VSI Name               : vplsad1
    Administrator VSI      : no
    Isolate Spoken         : disable
    VSI Index              : 0
    PW Signaling           : ad
    Member Discovery Style : --
<span>    Bridge-domain Mode     : disable</span>
    PW MAC Learn Style     : unqualify
    Encapsulation Type     : vlan
    MTU                    : 1500
    Diffserv Mode          : uniform
    Service Class          : --
    Color                  : --
    DomainId               : 255
    Domain Name            :
    Ignore AcState         : disable
    Create Time            : 0 days, 18 hours, 5 minutes, 30 seconds
    VSI State              : up
<span>    Resource Status        : --</span>

    VPLS ID                : 10.10.1.1:1
    RD                     : 10.10.1.1:1
    Import vpn target      : 100:1
    Export vpn target      : 100:1
    VSI ID                 : 1.1.1.9

   *Peer Router ID         : 2.2.2.9
    VPLS ID                : 10.10.1.1:1
    SAII                   : 1.1.1.9
    TAII                   : 2.2.2.9
    VC Label               : 1024
    Peer Type              : dynamic
    Session                : up
    Tunnel ID              : 0x80003f
    Broadcast Tunnel ID    : 0x80003f
    CKey                   : 2
    NKey                   : 1

   *Peer Router ID         : 3.3.3.9
    VPLS ID                : 10.10.1.1:1
    SAII                   : 1.1.1.9
    TAII                   : 3.3.3.9
    VC Label               : 1025
    Peer Type              : dynamic
    Session                : up
    Tunnel ID              : 0x800033
    Broadcast Tunnel ID    : 0x800033
    CKey                   : 4
    NKey                   : 3

    Interface Name         : GigabitEthernet<span>0/1/0</span>.1
    State                  : up
    Last Up Time           : 2010/10/18 15:54:46
    Total Up Time          : 0 days, 17 hours, 58 minutes, 24 seconds

   **PW Information:

   *Peer Ip Address        : 3.3.3.9
    PW State               : up
    Local VC Label         : 1025
    Remote VC Label        : 1025
    PW Type                : label
    Tunnel ID              : 0x800033
    Broadcast Tunnel ID    : 0x800033
    Broad BackupTunnel ID  : 0x0
    Ckey                   : 0x4
    Nkey                   : 0x3
    Main PW Token          : 0x800033
    Slave PW Token         : 0x0
    Tnl Type               : LSP
    OutInterface           : GigabitEthernet<span>0/1/3</span>
    Backup OutInterface    :
<span>    Stp Enable             : 0</span>
    PW Last Up Time        : 2010/10/18 18:22:01
    PW Total Up Time       : 62 days, 6 hours, 48 minutes, 45 seconds
   *Peer Ip Address        : 2.2.2.9
    PW State               : up
    Local VC Label         : 1024
    Remote VC Label        : 1024
    PW Type                : label
    Tunnel ID              : 0x80003f
    Broadcast Tunnel ID    : 0x80003f
    Broad BackupTunnel ID  : 0x0
    Ckey                   : 0x2
    Nkey                   : 0x1
    Main PW Token          : 0x80003f
    Slave PW Token         : 0x0
    Tnl Type               : LSP
    OutInterface           : GigabitEthernet<span>0/2/0</span>
    Backup OutInterface    :
<span>    Stp Enable             : 0</span>
    PW Last Up Time        : 2010/10/18 18:24:23
    PW Total Up Time       : 38 days, 13 hours, 46 minutes, 13 seconds  
</pre>
<p># Configure CE1, CE2, and CE3 to ping each other. The ping operations are all successful. The following information shows that CE1 (10.1.1.1) successfully pings CE2 (10.1.1.2).</p>
<pre class="screen">&lt;CE1&gt; <strong>ping 10.1.1.2</strong></pre>
<pre class="screen">  PING 10.1.1.2: 56  data bytes, press CTRL_C to break
    Reply from 10.1.1.2: bytes=56 Sequence=1 ttl=255 time=140 ms
    Reply from 10.1.1.2: bytes=56 Sequence=2 ttl=255 time=140 ms
    Reply from 10.1.1.2: bytes=56 Sequence=3 ttl=255 time=140 ms
    Reply from 10.1.1.2: bytes=56 Sequence=4 ttl=255 time=190 ms
    Reply from 10.1.1.2: bytes=56 Sequence=5 ttl=255 time=110 ms

  --- 10.1.1.2 ping statistics ---
    5 packet(s) transmitted
    5 packet(s) received
    0.00% packet loss
    round-trip min/avg/max = 110/144/190 ms </pre>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0172370269__dc_vrp_vpls_cfg_506207"><a name="EN-US_TASK_0172370269__dc_vrp_vpls_cfg_506207"></a><a name="dc_vrp_vpls_cfg_506207"></a><a name="EN-US_TASK_0172370269__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>CE1 configuration file</p>
<pre class="screen">#
sysname CE1
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown    
#
interface GigabitEthernet<span>0/1/0</span>.1
 vlan-type dot1q 10
 ip address 10.1.1.1 255.255.255.0
#
return</pre>
</li><li><p>CE2 configuration file</p>
<pre class="screen">#
sysname CE2
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown    
#
interface GigabitEthernet<span>0/1/0</span>.1
 vlan-type dot1q 10
 ip address 10.1.1.2 255.255.255.0
#
return
</pre>
</li><li><p>CE3 configuration file</p>
<pre class="screen">#
sysname CE3
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown    
#
interface GigabitEthernet<span>0/1/0</span>.1
 vlan-type dot1q 10
 ip address 10.1.1.3 255.255.255.0
#
return</pre>
</li><li><p>PE1 configuration file</p>
<pre class="screen">#
sysname PE1
#
mpls lsr-id 1.1.1.9
#
mpls
#
mpls l2vpn
#
vsi vplsad1
 bgp-ad
  vpls-id 10.10.1.1:1
  vpn-target 100:1 import-extcommunity
  vpn-target 100:1 export-extcommunity
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
#
interface GigabitEthernet<span>0/1/0</span>.1
 vlan-type dot1q 10
 l2 binding vsi vplsad1
#
interface GigabitEthernet<span>0/2/0</span>
 ip address 10.10.2.1 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/3</span>
 ip address 10.10.1.1 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack1 
 ip address 1.1.1.9 255.255.255.255
#
bgp 100 
 peer 2.2.2.9 as-number 100
 peer 2.2.2.9 connect-interface LoopBack1
 peer 3.3.3.9 as-number 100
 peer 3.3.3.9 connect-interface LoopBack1
 #
 ipv4-family unicast
  peer 2.2.2.9 enable
  peer 3.3.3.9 enable
 #
 l2vpn-ad-family
  policy vpn-target
  peer 2.2.2.9 enable
  peer 3.3.3.9 enable
#
ospf 1
 area 0.0.0.0
  network 1.1.1.9 0.0.0.0
  network 10.10.1.0 0.0.0.255
  network 10.10.2.0 0.0.0.255
#
return</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#
sysname PE2
#
mpls lsr-id 2.2.2.9
#
mpls
#
mpls l2vpn
#
vsi vplsad1
 bgp-ad
  vpls-id 10.10.1.1:1
  vpn-target 100:1 import-extcommunity
  vpn-target 100:1 export-extcommunity
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
#
interface GigabitEthernet<span>0/1/0</span>.1
 vlan-type dot1q 10
 l2 binding vsi vplsad1
#
interface GigabitEthernet<span>0/2/0</span>
 ip address 10.10.2.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/3</span>
 ip address 10.20.3.1 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 2.2.2.9 255.255.255.255
#
bgp 100 
 peer 1.1.1.9 as-number 100
 peer 1.1.1.9 connect-interface LoopBack1
 peer 3.3.3.9 as-number 100
 peer 3.3.3.9 connect-interface LoopBack1
 #
 ipv4-family unicast
  peer 1.1.1.9 enable
  peer 3.3.3.9 enable
 #
 l2vpn-ad-family
  policy vpn-target
  peer 1.1.1.9 enable
  peer 3.3.3.9 enable
#
ospf 1
 area 0.0.0.0
  network 2.2.2.9 0.0.0.0
  network 10.10.2.0 0.0.0.255
  network 10.20.3.0 0.0.0.255
#
return</pre>
</li><li><p>PE3 configuration file</p>
<pre class="screen">#
sysname PE3
#
mpls lsr-id 3.3.3.9
#
mpls
#
mpls l2vpn
#
vsi vplsad1
 bgp-ad
  vpls-id 10.10.1.1:1
  vpn-target 100:1 import-extcommunity
  vpn-target 100:1 export-extcommunity
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
#
interface GigabitEthernet<span>0/1/0</span>.1
 vlan-type dot1q 10
 l2 binding vsi vplsad1
#
interface GigabitEthernet<span>0/2/0</span>
 ip address 10.20.3.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/3</span>
 ip address 10.10.1.2 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 3.3.3.9 255.255.255.255
#
bgp 100 
 peer 1.1.1.9 as-number 100
 peer 1.1.1.9 connect-interface LoopBack1
 peer 2.2.2.9 as-number 100
 peer 2.2.2.9 connect-interface LoopBack1
 #
 ipv4-family unicast
  peer 1.1.1.9 enable
  peer 2.2.2.9 enable
 #
 l2vpn-ad-family
  policy vpn-target
  peer 1.1.1.9 enable
  peer 2.2.2.9 enable
#
ospf 1
 area 0.0.0.0
  network 3.3.3.9 0.0.0.0
  network 10.20.3.0 0.0.0.255
  network 10.10.1.0 0.0.0.255
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_5029.html">Configuration Examples for VPLS
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_5056.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_5068.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>