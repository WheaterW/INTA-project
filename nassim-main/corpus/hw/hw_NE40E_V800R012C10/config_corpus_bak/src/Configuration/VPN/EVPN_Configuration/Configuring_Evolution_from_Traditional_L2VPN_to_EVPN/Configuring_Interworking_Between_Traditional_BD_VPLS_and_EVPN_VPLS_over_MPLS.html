
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring Interworking Between Traditional BD VPLS and EVPN VPLS over MPLS">
<meta name="abstract" content="On an IP RAN where traditional BD VPLS is still used at the access layer but the aggregation network has evolved to MPLS EVPN, you need to configure interworking between traditional BD VPLS and EVPN VPLS over MPLS.">
<meta name="description" content="On an IP RAN where traditional BD VPLS is still used at the access layer but the aggregation network has evolved to MPLS EVPN, you need to configure interworking between traditional BD VPLS and EVPN VPLS over MPLS.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2vpn_to_evpn_cfg_0000.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2vpn_to_evpn_cfg_0005.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2vpn_to_evpn_cfg_0007.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="l00425560">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00878323">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172370524">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring Interworking Between Traditional BD VPLS and EVPN VPLS over MPLS</title>
</head>
<body><a name="EN-US_TASK_0172370524"></a><a name="EN-US_TASK_0172370524"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring Interworking Between Traditional BD VPLS and EVPN VPLS over MPLS</h1>
<div class="taskbody"><p>On an IP RAN where traditional BD VPLS is still used at the access layer but the aggregation network has evolved to MPLS EVPN, you need to configure interworking between traditional BD VPLS and EVPN VPLS over MPLS.</p>
<div class="context"><a name="EN-US_TASK_0172370524__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>During IP RAN evolution toward EVPN, if traditional BD VPLS is still widely used on access-layer devices, it is difficult to evolve the IP RAN to MPLS EVPN in an E2E manner at one time. If the aggregation network has evolved to MPLS EVPN, you need to configure interworking between traditional BD VPLS and EVPN VPLS over MPLS on the IP RAN.</p>
<p>On the network shown in <a href="#EN-US_TASK_0172370524__fig18509102501920">Figure 1</a>, VPLS is deployed to carry services on the access network between CSGs and ASGs, and BD EVPN is deployed to carry services on the aggregation network between ASGs and RSGs. On ASGs, a BD needs to be configured and bound to a BD EVPN instance and a VSI to achieve interworking between traditional BD VPLS and EVPN VPLS over MPLS.</p>
<div class="fignone" id="EN-US_TASK_0172370524__fig18509102501920"><a name="EN-US_TASK_0172370524__fig18509102501920"></a><a name="fig18509102501920"></a><span class="figcap"><b>Figure 1 </b>Configuring interworking between traditional BD VPLS and EVPN VPLS over MPLS</span><br><span><img class="vsd" src="figure/en-us_image_0000001232035217.png" width="NaN" height="NaN"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172370524__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Pre-configuration Tasks</h4><p>Before configuring interworking between traditional BD VPLS and EVPN VPLS over MPLS, complete the following tasks:</p>
<ul><li><p><a href="dc_vrp_vpls_cfg_5003.html">Configure LDP VPLS</a> between CSGs and ASGs.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>A BD VSI must be configured using the <a href="cmdqueryname=vsi+bd-mode"><b><span class="cmdname">vsi bd-mode</span></b></a> command here.</p>
</div></div>
</li><li><p>Configure <a href="dc_vrp_evpn_cfg_0065.html">EVPN VPLS over MPLS (BD EVPN instance)</a> between ASGs and RSGs.</p>
</li></ul>
<p>Perform the following operations on each ASG:</p>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172370524__1.4.3"></a><a name="1.4.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure an ESI instance and set its redundancy mode to single-active.</span><ol type="a"><li><span>Run the <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a> command to enter the system view.</span></li><li><span>Run the <a href="cmdqueryname=evpn"><b><span class="cmdname">evpn</span></b></a> command to enter the global EVPN configuration view.</span></li><li><span>Run the <a href="cmdqueryname=esi"><b><span class="cmdname">esi</span></b></a> <i><span class="varname">esi</span></i> command to configure a static ESI instance name.</span></li><li><span>Run the <a href="cmdqueryname=evpn+redundancy-mode"><b><span class="cmdname">evpn redundancy-mode</span></b></a> <strong><span>single-active</span></strong> command to set the redundancy mode of the static ESI instance to single-active.</span></li><li><span>Run the <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a> command to return to the global EVPN configuration view.</span></li><li><span>Run the <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a> command to return to the system view.</span></li><li><span>Run the <strong>commit</strong> command to commit the configuration.</span></li></ol>
</li><li><span>Configure a specified CSG as a UPE and configure an ESI for the VSI.</span><ol type="a"><li class="substepexpand"><span>Run the <a href="cmdqueryname=vsi"><b><span class="cmdname">vsi</span></b></a> <i><span class="varname">vsi-name</span></i> <strong><span>bd-mode</span></strong> command to enter the VSI view.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=pwsignal"><b><span class="cmdname">pwsignal</span></b></a> <strong><span>ldp</span></strong> command to configure LDP as the PW signaling protocol and enter the VSI-LDP view.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=vsi-id"><b><span class="cmdname">vsi-id</span></b></a> <i><span class="varname">vsi-id</span></i> command to configure a VSI ID.</span></li><li class="substepexpand"><span>Configure a specified CSG as a UPE.</span><p><ul><li>Run the <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">peer-address</span></i> [ <strong><span>negotiation-vc-id</span></strong> <i><span class="varname">vc-id</span></i> ] [ <strong><span>tnl-policy</span></strong> <i><span class="varname">policy-name</span></i> ] <strong><span>upe</span></strong> command to configure a specified CSG as a UPE.</li><li>Run the <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">peer-address</span></i> [ <strong><span>negotiation-vc-id</span></strong> <i><span class="varname">vc-id</span></i> ] [ <strong><span>tnl-policy</span></strong> <i><span class="varname">policy-name</span></i> ] <strong><span>static-npe</span></strong> <strong><span>trans</span></strong> <i><span class="varname">transmit-label</span></i> <strong><span>recv</span></strong> <i><span class="varname">receive-label</span></i> command to configure a static VPLS PW.</li></ul>
</p></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">peer-address</span></i> [ <strong><span>negotiation-vc-id</span></strong> <i><span class="varname">vc-id</span></i> ] <strong><span>pw</span></strong> <i><span class="varname">pw-name</span></i> command to create a PW and enter the VSI-LDP-PW view.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=esi"><b><span class="cmdname">esi</span></b></a> <i><span class="varname">esi</span></i> command to configure an ESI for the PW interface. The value of <i><span class="varname">esi</span></i> must be the same as the name of the static ESI instance.</span></li><li class="substepexpand"><span>(Optional) Run the <a href="cmdqueryname=evpn+e-tree-leaf"><b><span class="cmdname">evpn e-tree-leaf</span></b></a> command to configure the leaf attribute for the PW interface. If you do not want the traffic sent from CE1 to CSG1 to be sent back to CE1 through ASG1, ASG2, and CSG2, you can configure the leaf attribute in the VSI-LDP-PW view of ASG1 and ASG2.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a> command to return to the VSI-LDP view.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a> command to return to the VSI view.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a> command to return to the system view.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a> command to commit the configuration.</span></li></ol>
</li><li><span>Bind the BD to the VSI and EVPN instance.</span><ol type="a"><li><span>Run the <a href="cmdqueryname=bridge-domain"><b><span class="cmdname">bridge-domain</span></b></a> <i><span class="varname">bd-id</span></i> command to enter the BD view.</span></li><li><span>Run the <a href="cmdqueryname=l2+binding"><b><span class="cmdname">l2 binding</span></b></a> <strong><span>vsi</span></strong> <i><span class="varname">vsi-name</span></i> [ <strong><span>pw-tag</span></strong> <i><span class="varname">pw-tag-value</span></i> ] command to bind the BD to the VSI.</span></li><li><span>Run the <a href="cmdqueryname=evpn+binding+vpn-instance"><b><span class="cmdname">evpn binding vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i> command to bind the BD to the EVPN instance.</span></li><li><span>Run the <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a> command to return to the system view.</span></li><li><span>Run the <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a> command to commit the configuration.</span></li></ol>
</li></ol></div>
<div class="postreq"><a name="EN-US_TASK_0172370524__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Verifying the Configuration</h4><ul><li><p>Run the <a href="cmdqueryname=display+bgp+evpn"><b><span class="cmdname">display bgp evpn</span></b></a> { <strong><span>all</span></strong> | <strong><span>route-distinguisher</span></strong> <i><span class="varname">route-distinguisher</span></i> } <strong><span>routing-table</span></strong> { <strong><span>ad-route</span></strong> | <strong><span>es-route</span></strong> | <strong><span>inclusive-route</span></strong> | <strong><span>mac-route</span></strong> | <strong><span>prefix-route</span></strong> } <i><span class="varname">prefix</span></i> command on the ASG to check detailed BGP EVPN route information, including PW information.</p>
</li><li>Run the <a href="cmdqueryname=display+bgp+evpn"><b><span class="cmdname">display bgp evpn</span></b></a> <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i> <strong><span>routing-table</span></strong> { <strong><span>ad-route</span></strong> | <strong><span>es-route</span></strong> | <strong><span>inclusive-route</span></strong> | <strong><span>mac-route</span></strong> } <i><span class="varname">prefix</span></i> command on the ASG to check the EVPN route information (including PW information) of the specified EVPN instance.</li><li><p>Run the <a href="cmdqueryname=display+evpn+vpn-instance+name"><b><span class="cmdname">display evpn vpn-instance name</span></b></a> <i><span class="varname">vpn-instance-name</span></i> <strong><span>df result</span></strong> [ <strong><span>esi</span></strong> <i><span class="varname">esi</span></i> ] command on an ASG to check the DF election result (including access-side PW information) of an EVPN instance.</p>
</li></ul>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2vpn_to_evpn_cfg_0000.html">Configuring Evolution from Traditional L2VPN to EVPN
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2vpn_to_evpn_cfg_0005.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2vpn_to_evpn_cfg_0007.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>