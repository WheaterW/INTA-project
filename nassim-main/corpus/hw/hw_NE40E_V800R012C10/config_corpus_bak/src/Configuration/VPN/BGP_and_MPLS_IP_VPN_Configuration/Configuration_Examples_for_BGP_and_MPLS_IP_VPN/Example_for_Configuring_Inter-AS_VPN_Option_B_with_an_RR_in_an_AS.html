
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Inter-AS VPN Option B with an RR in an AS">
<meta name="abstract" content="A single-hop MP-EBGP peer relationship can be set up between ASBRs to implement inter-AS VPN Option B, and an RR can be configured in each AS to reflect VPNv4 routes.">
<meta name="description" content="A single-hop MP-EBGP peer relationship can be set up between ASBRs to implement inter-AS VPN Option B, and an RR can be configured in each AS to reflect VPNv4 routes.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0101.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0112.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0114.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,l3vpnvrp,w00556928,l00468467,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="h00847023">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00830487">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172369500">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>Example for Configuring Inter-AS VPN Option B with an RR in an AS</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172369500"></a><a name="EN-US_TASK_0172369500"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Inter-AS VPN Option B with an RR in an AS</h1>
<div class="taskbody"><p>A single-hop MP-EBGP peer relationship can be set up between ASBRs to implement inter-AS VPN Option B, and an RR can be configured in each AS to reflect VPNv4 routes.</p>
<div class="context"><a name="EN-US_TASK_0172369500__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="dc_vrp_mpls-l3vpn-v4_cfg_0113.html#EN-US_TASK_0172369500__fig_dc_vrp_mpls-l3vpn-v4_cfg_011301">Figure 1</a>, CE1, CE2, and CE3 belong to the same VPN; PE1 and PE3 are in the same AS. It is required that inter-AS VPN Option B be configured and an RR be configured in AS 100 to reflect VPNv4 routes between PEs and between PEs and the ASBR to reduce MP-IBGP connections in AS 100.</p>
<div class="fignone" id="EN-US_TASK_0172369500__fig_dc_vrp_mpls-l3vpn-v4_cfg_011301"><a name="EN-US_TASK_0172369500__fig_dc_vrp_mpls-l3vpn-v4_cfg_011301"></a><a name="fig_dc_vrp_mpls-l3vpn-v4_cfg_011301"></a><span class="figcap"><b>Figure 1 </b>Inter-AS VPN Option B with an RR in an AS</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interfaces 1 through 3 represent GE<span>0/1/0</span>, GE<span>0/2/0</span>, and GE<span>0/3/0</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0199401133.png"></span></div>

<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" frame="border" border="1" rules="all"><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="13.24867513248675%" id="mcps1.4.1.4.1.4.1.1" liSelected="liSelected"><p>Device Name</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="37.08629137086292%" id="mcps1.4.1.4.1.4.1.2" liSelected="liSelected"><p>Interface</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="49.66503349665034%" id="mcps1.4.1.4.1.4.1.3" liSelected="liSelected"><p>IP Address</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" rowspan="2" valign="top" width="13.24867513248675%" headers="mcps1.4.1.4.1.4.1.1 "><p>CE1</p>
<p></p>
</td>
<td class="cellrowborder" valign="top" width="37.08629137086292%" headers="mcps1.4.1.4.1.4.1.2 "><p>Loopback1</p>
</td>
<td class="cellrowborder" valign="top" width="49.66503349665034%" headers="mcps1.4.1.4.1.4.1.3 "><p>11.11.11.11/32</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.2 "><p>GE<span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.3 "><p>10.1.1.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="3" valign="top" width="13.24867513248675%" headers="mcps1.4.1.4.1.4.1.1 "><p>PE1</p>
<p></p>
<p></p>
</td>
<td class="cellrowborder" valign="top" width="37.08629137086292%" headers="mcps1.4.1.4.1.4.1.2 "><p>Loopback1</p>
</td>
<td class="cellrowborder" valign="top" width="49.66503349665034%" headers="mcps1.4.1.4.1.4.1.3 "><p>1.1.1.1/32</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.2 "><p>GE<span>0/2/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.3 "><p>10.1.1.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.2 "><p>GE<span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.3 "><p>10.10.1.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="4" valign="top" width="13.24867513248675%" headers="mcps1.4.1.4.1.4.1.1 "><p>RR</p>
<p></p>
<p></p>
<p></p>
</td>
<td class="cellrowborder" valign="top" width="37.08629137086292%" headers="mcps1.4.1.4.1.4.1.2 "><p>Loopback1</p>
</td>
<td class="cellrowborder" valign="top" width="49.66503349665034%" headers="mcps1.4.1.4.1.4.1.3 "><p>4.4.4.4/32</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.2 "><p>GE<span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.3 "><p>10.10.1.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.2 "><p>GE<span>0/2/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.3 "><p>10.20.1.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.2 "><p>GE<span>0/3/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.3 "><p>10.30.1.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="2" valign="top" width="13.24867513248675%" headers="mcps1.4.1.4.1.4.1.1 "><p>CE3</p>
<p></p>
</td>
<td class="cellrowborder" valign="top" width="37.08629137086292%" headers="mcps1.4.1.4.1.4.1.2 "><p>Loopback1</p>
</td>
<td class="cellrowborder" valign="top" width="49.66503349665034%" headers="mcps1.4.1.4.1.4.1.3 "><p>33.33.33.33/32</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.2 "><p>GE<span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.3 "><p>10.3.1.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="3" valign="top" width="13.24867513248675%" headers="mcps1.4.1.4.1.4.1.1 "><p>PE3</p>
<p></p>
<p></p>
</td>
<td class="cellrowborder" valign="top" width="37.08629137086292%" headers="mcps1.4.1.4.1.4.1.2 "><p>Loopback1</p>
</td>
<td class="cellrowborder" valign="top" width="49.66503349665034%" headers="mcps1.4.1.4.1.4.1.3 "><p>3.3.3.3/32</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.2 "><p>GE<span>0/2/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.3 "><p>10.3.1.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.2 "><p>GE<span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.3 "><p>10.30.1.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="3" valign="top" width="13.24867513248675%" headers="mcps1.4.1.4.1.4.1.1 "><p>ASBR1</p>
<p></p>
<p></p>
</td>
<td class="cellrowborder" valign="top" width="37.08629137086292%" headers="mcps1.4.1.4.1.4.1.2 "><p>Loopback1</p>
</td>
<td class="cellrowborder" valign="top" width="49.66503349665034%" headers="mcps1.4.1.4.1.4.1.3 "><p>5.5.5.5/32</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.2 "><p>GE<span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.3 "><p>10.20.1.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.2 "><p>GE<span>0/2/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.3 "><p>12.12.12.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="3" valign="top" width="13.24867513248675%" headers="mcps1.4.1.4.1.4.1.1 "><p>ASBR2</p>
<p></p>
<p></p>
</td>
<td class="cellrowborder" valign="top" width="37.08629137086292%" headers="mcps1.4.1.4.1.4.1.2 "><p>Loopback1</p>
</td>
<td class="cellrowborder" valign="top" width="49.66503349665034%" headers="mcps1.4.1.4.1.4.1.3 "><p>6.6.6.6/32</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.2 "><p>GE<span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.3 "><p>10.40.1.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.2 "><p>GE<span>0/2/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.3 "><p>12.12.12.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="2" valign="top" width="13.24867513248675%" headers="mcps1.4.1.4.1.4.1.1 "><p>CE2</p>
<p></p>
</td>
<td class="cellrowborder" valign="top" width="37.08629137086292%" headers="mcps1.4.1.4.1.4.1.2 "><p>Loopback1</p>
</td>
<td class="cellrowborder" valign="top" width="49.66503349665034%" headers="mcps1.4.1.4.1.4.1.3 "><p>22.22.22.22/32</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.2 "><p>GE<span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.3 "><p>10.2.1.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="3" valign="top" width="13.24867513248675%" headers="mcps1.4.1.4.1.4.1.1 "><p>PE2</p>
<p></p>
<p></p>
</td>
<td class="cellrowborder" valign="top" width="37.08629137086292%" headers="mcps1.4.1.4.1.4.1.2 "><p>Loopback1</p>
</td>
<td class="cellrowborder" valign="top" width="49.66503349665034%" headers="mcps1.4.1.4.1.4.1.3 "><p>2.2.2.2/32</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.2 "><p>GE<span>0/2/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.3 "><p>10.2.1.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.2 "><p>GE<span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.3 "><p>10.40.1.2/24</p>
</td>
</tr>
</tbody>
</table>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172369500__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Notes</h4><p>When configuring inter-AS VPN Option B with an RR in an AS, note the following:</p>
<ul><li><p>There is no need to create VPN instances on ASBRs or configure ASBRs to filter VPNv4 routes based on VPN targets.</p>
</li><li><p>PE1, PE3, and ASBR1 must be configured as clients for the RR.</p>
</li></ul>
</div></div>
<div class="context"><a name="EN-US_TASK_0172369500__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure IGP on the MPLS backbone network for communication between <span class="keyword">Router</span>s in the same AS, and set up an MPLS LDP LSP between them.</p>
</li><li><p>Set up EBGP peer relationships between PEs and CEs and set up an MP-IBGP peer relationship between each PE and the RR and between the ASBR and RR in the same AS.</p>
</li><li><p>Enable route reflection for VPNv4 routes on the RR.</p>
</li><li><p>Configure VPN instances on PEs, but not on ASBRs or the RR.</p>
</li><li><p>Enable MPLS on the interface connected to ASBRs. Set up the MP-EBGP peer relationship between ASBRs. Configure no VPN-Target filtration on the received VPNv4 routes.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172369500__1.4.4"></a><a name="1.4.4"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>AS numbers of PEs and CEs</p>
</li><li><p>MPLS LSR IDs of the PEs and the ASBRs</p>
</li><li><p>Names, RDs, and VPN targets of the VPN instances created on PE1 and PE2</p>
</li></ul>
</div></div>
<div class="context"><a name="EN-US_TASK_0172369500__1.4.5"></a><a name="1.4.5"></a>
<div class="p"><h4 class="sectiontitle">Procedure</h4><ol><li><p>Configure IGP on the MPLS backbone networks in AS 100 and AS 200 for IP connectivity between nodes on each MPLS backbone network. This example uses OSPF. For configuration details, see the configuration files.</p>
<p>After the configurations are complete, the OSPF neighbor relationship can be established between the devices on the backbone network. Run the <strong>display ospf peer</strong> command. The command output shows that the neighbor relationship is in the <strong>Full</strong> state. Run the <a href="cmdqueryname=display+ip+routing-table"><b><span class="cmdname">display ip routing-table</span></b></a> command. The command output shows that PEs have learned the routes to each other's loopback interface.</p>
</li><li><p>Configure MPLS and MPLS LDP both globally and per interface on each node of the backbone networks in AS 100 and AS 200 to establish LDP LSPs.</p>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>mpls lsr-id 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<p>The configurations of PE2 and PE3 are similar to the configuration of PE1. For configuration details, see the configuration files.</p>
<p># Configure the RR.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RR] <strong>mpls lsr-id 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-GigabitEthernet<span>0/1/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR] <strong>interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-GigabitEthernet<span>0/2/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-GigabitEthernet<span>0/2/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR] <strong>interface gigabitethernet <span>0/3/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-GigabitEthernet<span>0/3/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-GigabitEthernet<span>0/3/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-GigabitEthernet<span>0/3/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR] <strong>commit</strong></pre>
<p># Configure ASBR1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1] <strong>mpls lsr-id 5.5.5.5</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-GigabitEthernet<span>0/1/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1] <strong>commit</strong></pre>
<p>The configuration of ASBR2 is similar to the configuration of ASBR1. For detailed configurations, see the configuration files.</p>
<p>After the configurations are complete, the LDP peer relationship is established between PEs or between the ASBR and RR. Run the <strong>display mpls ldp session</strong> command on each <span class="keyword">Router</span>. The command output shows that the session status is <strong>Operational</strong>. The following example uses the command output on PE1.</p>
<pre class="screen">&lt;PE1&gt;<strong> display mpls ldp session</strong>

 LDP Session(s) in Public Network
 Codes: LAM(Label Advertisement Mode), SsnAge Unit(DDDD:HH:MM)
<span> An asterisk (*) before a session means the session is being deleted.</span>
 -------------------------------------------------------------------------
 PeerID             Status      LAM  SsnRole  SsnAge      KASent/Rcv
 -------------------------------------------------------------------------
 4.4.4.4:0          <strong>Operational</strong> DU   Passive  0000:00:01  5/5
 -------------------------------------------------------------------------
 TOTAL: 1 session(s) Found.</pre>
</li><li><p>Establish MP-IBGP peer relationships between the PE, ASBR, and RR in AS 100, and between the PE and ASBR in AS 200.</p>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 4.4.4.4 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 4.4.4.4 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>ipv4-family vpnv4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-vpnv4] <strong>peer 4.4.4.4 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-vpnv4] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp-af-vpnv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp] <strong>quit</strong></pre>
<p>The configurations of PE2 and PE3 are similar to the configuration of PE1. For configuration details, see the configuration files.</p>
<p># Configure ASBR1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp] <strong>peer 4.4.4.4 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp] <strong>peer 4.4.4.4 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp] <strong>ipv4-family vpnv4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp-af-vpnv4] <strong>peer 4.4.4.4 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp-af-vpnv4] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1-bgp-af-vpnv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1-bgp] <strong>quit</strong></pre>
<p>The configuration of ASBR2 is similar to the configuration of ASBR1. For detailed configurations, see Configuration Scripts.</p>
<p>Configure the RR to establish MP-IBGP peer relationships with peers.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RR] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp] <strong>peer 1.1.1.1 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp] <strong>peer 1.1.1.1 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp] <strong>peer 3.3.3.3 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp] <strong>peer 3.3.3.3 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp] <strong>peer 5.5.5.5 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp] <strong>peer 5.5.5.5 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp] <strong>ipv4-family vpnv4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp-af-vpnv4] <strong>peer 1.1.1.1 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp-af-vpnv4] <strong>peer 3.3.3.3 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp-af-vpnv4] <strong>peer 5.5.5.5 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp-af-vpnv4] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RR-bgp-af-vpnv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RR-bgp] <strong>quit</strong></pre>
<p>After the configurations are complete, run the <strong>display bgp peer</strong> or <strong>display bgp vpnv4 all peer</strong> command on the PE, RR, or ASBR. The command output shows that BGP peer relationships have been established between the PE (ASBR) and RR in AS 100 and between the PE and ASBR in AS 200. Use the RR as an example:</p>
<pre class="screen">&lt;RR&gt; <strong>display bgp vpnv4 all peer</strong>
BGP local router ID : 4.4.4.4
 Local AS number : 100
 Total number of peers : 3                 Peers in established state : 3
  Peer            V    AS  MsgRcvd  MsgSent    OutQ  Up/Down    State        PrefRcv
  1.1.1.1         4   100   12      18         0     00:09:38   <strong>Established</strong>   0
  3.3.3.3         4   100   12      18         0     00:09:38   <strong>Established</strong>   0
  5.5.5.5         4   100   12      18         0     00:09:38   <strong>Established</strong>   0</pre>
</li><li><p>Enable VPNv4 route reflection on the RR.</p>
<p># Configure the RR.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RR] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RR-bgp] <strong>ipv4-family vpnv4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp-af-vpnv4] <strong>undo policy vpn-target</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp-af-vpnv4] <strong>peer 1.1.1.1 reflect-client</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp-af-vpnv4] <strong>peer 3.3.3.3 reflect-client</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp-af-vpnv4] <strong>peer 5.5.5.5 reflect-client</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp-af-vpnv4] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RR-bgp-af-vpnv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RR-bgp] <strong>quit</strong></pre>
</li><li><p>Configure VPN instances on PEs and configure CEs to access PEs.</p>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>ip vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpna] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpna-af-ipv4] <strong>route-distinguisher 100:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpna-af-ipv4] <strong>vpn-target 111:1 both</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpna-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpna] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>ip binding vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>ip address 10.1.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p>The configurations of PE2 and PE3 are similar to the configuration of PE1. For configuration details, see the configuration files.</p>
<p>After the configurations are complete, run the <strong>display ip vpn-instance verbose</strong> command on each PE to check VPN instance configurations.</p>
<pre class="screen">&lt;PE1&gt; <strong>display ip vpn-instance verbose</strong>
 Total VPN-Instances configured : 1
 Total IPv4 VPN-Instances configured : 1 
 Total IPv6 VPN-Instances configured : 0

 VPN-Instance Name and ID : vpna, 1
  Interfaces : GigabitEthernet<span>0/2/0</span>
 Address family ipv4 
  Create date : 2009/09/18 11:30:35
  Up time : 0 days, 00 hours, 05 minutes and 19 seconds
  Vrf Status : UP
  Route Distinguisher : 100:1
  Export VPN Targets :  111:1
  Import VPN Targets :  111:1
  Label policy: label per route
  The diffserv-mode Information is : uniform
  The ttl-mode Information is : pipe</pre>
</li><li><p>Establish EBGP peer relationships between PEs and CEs, and import loopback routes from CEs.</p>
<p># Configure CE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-Loopback1] <strong>ip address 11.11.11.11 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-Loopback1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>bgp 65001</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp] <strong>peer 10.1.1.2 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp] <strong>network 11.11.11.11 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>commit</strong></pre>
<p>The configurations of CE2 and CE3 are similar to the configuration of CE1. For configuration details, see the configuration files.</p>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp] <strong>ipv4-family vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-vpna] <strong>peer 10.1.1.1 as-number 65001</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-vpna] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp-vpna] <strong>quit</strong></pre>
<p>The configurations of PE2 and PE3 are similar to the configuration of PE1. For configuration details, see the configuration files.</p>
<p>After the configurations are complete, run the <strong>display bgp vpnv4 vpn-instance peer</strong> command on PEs to check whether BGP peer relationships have been established between the PEs and CEs. The command output shows that the BGP peer relationships have been established between the PEs and CEs and are in the <strong>Established</strong> state.</p>
<p>The following example uses the command output on PE1 to show that a BGP peer relationship has been established between PE1 and CE1.</p>
<pre class="screen">&lt;PE1&gt; <strong>display bgp vpnv4 vpn-instance vpna peer</strong>

 BGP local router ID : 1.1.1.1
 Local AS number : 100
 Total number of peers : 1            Peers in established state : 1
  Peer            V    AS  MsgRcvd  MsgSent    OutQ  Up/Down    State        PrefRcv
  10.1.1.1        4   65001  11     9          0     00:06:37   <strong>Established</strong>  1</pre>
</li><li><p><span>Enable MPLS on the interconnection interfaces between ASBRs and </span>establish an MP-EBGP peer relationship between the ASBRs. Configure the ASBRs not to filter received VPNv4 routes based on VPN targets.</p>
<div class="p"># Configure ASBR1. Enable MPLS on GE<span>0/2/0</span> connected to ASBR2.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1] <strong>interface GigabitEthernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1-GigabitEthernet<span>0/2/0</span>] <strong>ip address 12.12.12.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-GigabitEthernet<span>0/2/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1] <strong>commit</strong></pre>
</div>
<p># Configure ASBR1 to establish an MP-EBGP peer with ASBR2, and disable ASBR1 from filtering received VPNv4 routes based on VPN targets.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1-bgp]<strong> peer 12.12.12.2 as-number 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp] <strong>ipv4-family vpnv4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp-af-vpnv4] <strong>peer 12.12.12.2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp-af-vpnv4]<strong> undo policy vpn-target</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp-af-vpnv4] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1-bgp-af-vpnv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1-bgp] <strong>quit</strong></pre>
<p>The configuration of ASBR2 is similar to the configuration of ASBR1. For detailed configurations, see Configuration Scripts.</p>
</li><li><p>Verifying the Configuration</p>
<p>After the configurations are complete, CEs can learn routes to each other's loopback interface and ping each other.</p>
<p>The following example uses the command output on CE1.</p>
<pre class="screen">&lt;CE1&gt; <strong>display ip routing-table</strong>
<span class="keyword">Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route</span>
------------------------------------------------------------------------------
Routing Table: _public_
         Destinations : 10        Routes : 10
Destination/Mask    Proto  Pre  Cost      Flags  NextHop         Interface
       10.1.1.0/24  Direct 0    0             D  10.1.1.1        GigabitEthernet<span>0/1/0</span>
       10.1.1.1/32  Direct 0    0             D  127.0.0.1       GigabitEthernet<span>0/1/0</span>
     10.1.1.255/32  Direct 0    0             D  127.0.0.1       GigabitEthernet<span>0/1/0</span>
    11.11.11.11/32  Direct 0    0             D  127.0.0.1       LoopBack1
   <strong>22.22.22.22/32</strong>  EBGP   255  0             D  10.1.1.2        GigabitEthernet<span>0/1/0</span>
   <strong>33.33.33.33/32</strong>  EBGP   255  0             D  10.1.1.2        GigabitEthernet<span>0/1/0</span>
      127.0.0.0/8   Direct 0    0             D  127.0.0.1       InLoopBack0
      127.0.0.1/32  Direct 0    0             D  127.0.0.1       InLoopBack0
127.255.255.255/32  Direct 0    0             D  127.0.0.1       InLoopBack0
255.255.255.255/32  Direct 0    0             D  127.0.0.1       InLoopBack0</pre>
<pre class="screen">&lt;CE1&gt; <strong>ping -a 11.11.11.11 22.22.22.22</strong>
  PING 22.22.22.22: 56  data bytes, press CTRL_C to break
    Reply from 22.22.22.22: bytes=56 Sequence=1 ttl=252 time=120 ms
    Reply from 22.22.22.22: bytes=56 Sequence=2 ttl=252 time=73 ms
    Reply from 22.22.22.22: bytes=56 Sequence=3 ttl=252 time=111 ms
    Reply from 22.22.22.22: bytes=56 Sequence=4 ttl=252 time=86 ms
    Reply from 22.22.22.22: bytes=56 Sequence=5 ttl=252 time=110 ms
  --- 22.22.22.22 ping statistics ---
    5 packet(s) transmitted
    5 packet(s) received
    0.00% packet loss
    round-trip min/avg/max = 73/100/120 ms </pre>
<p>Run the <strong>display bgp vpnv4 all routing-table</strong> command on the RR or ASBR. The command output shows VPNv4 routes on the RR or ASBR.</p>
<pre class="screen">&lt;RR&gt;<strong> display bgp vpnv4 all routing-table</strong>
 BGP Local router ID is 4.4.4.4
 Status codes: * - valid, &gt; - best, d - damped,<span> x - best external,</span><span> a - add path,</span>
               h - history,  i - internal, s - suppressed, S - Stale
               Origin : i - IGP, e - EGP, ? - incomplete


 Total number of routes from all PE: 3
 Route Distinguisher: 100:1


      Network            NextHop        MED        LocPrf    PrefVal Path/Ogn

 *&gt;i  11.11.11.11/32     1.1.1.1         0          100        0      65001i
 Route Distinguisher: 200:2


      Network            NextHop        MED        LocPrf    PrefVal Path/Ogn

 *&gt;i  22.22.22.22/32     5.5.5.5         0          100        0      200 65002i
 Route Distinguisher: 100:3


      Network            NextHop        MED        LocPrf    PrefVal Path/Ogn

 *&gt;i  33.33.33.33/32     3.3.3.3         0          100        0      65003i</pre>
</li></ol>
</div></div>
<div class="example"><a name="EN-US_TASK_0172369500__1.4.6"></a><a name="1.4.6"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>CE1 configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname CE1</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.1.1.1 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">interface Loopback 1</pre>
<pre class="screen"> ip address 11.11.11.11 255.255.255.255</pre>
<pre class="screen">#</pre>
<pre class="screen">bgp 65001</pre>
<pre class="screen"> peer 10.1.1.2 as-number 100</pre>
<pre class="screen"> #</pre>
<pre class="screen"> ipv4-family unicast
  undo synchronization
  network 11.11.11.11 255.255.255.255
  peer 10.1.1.2 enable</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p>PE1 configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname PE1</pre>
<pre class="screen">#</pre>
<pre class="screen">ip vpn-instance vpna</pre>
<pre class="screen"> ipv4-family</pre>
<pre class="screen">  route-distinguisher 100:1</pre>
<pre class="screen">  apply-label per-instance</pre>
<pre class="screen">  vpn-target 111:1 export-extcommunity</pre>
<pre class="screen">  vpn-target 111:1 import-extcommunity</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls lsr-id 1.1.1.1</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls ldp</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.10.1.2 255.255.255.0</pre>
<pre class="screen"> mpls</pre>
<pre class="screen"> mpls ldp</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/2/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip binding vpn-instance vpna</pre>
<pre class="screen"> ip address 10.1.1.2 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">interface LoopBack1</pre>
<pre class="screen"> ip address 1.1.1.1 255.255.255.255</pre>
<pre class="screen">#</pre>
<pre class="screen">bgp 100</pre>
<pre class="screen"> peer 4.4.4.4 as-number 100</pre>
<pre class="screen"> peer 4.4.4.4 connect-interface LoopBack1</pre>
<pre class="screen"> #</pre>
<pre class="screen"> ipv4-family unicast</pre>
<pre class="screen">  undo synchronization
  peer 4.4.4.4 enable</pre>
<pre class="screen"> #</pre>
<pre class="screen"> ipv4-family vpnv4</pre>
<pre class="screen">  policy vpn-target</pre>
<pre class="screen">  peer 4.4.4.4 enable</pre>
<pre class="screen">#</pre>
<pre class="screen"> ipv4-family vpn-instance vpna</pre>
<pre class="screen">  peer 10.1.1.1 as-number 65001</pre>
<pre class="screen">#</pre>
<pre class="screen">ospf 1</pre>
<pre class="screen"> area 0.0.0.0</pre>
<pre class="screen">  network 10.10.1.0 0.0.0.255</pre>
<pre class="screen">  network 1.1.1.1 0.0.0.0</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p>PE3 configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname PE3</pre>
<pre class="screen">#</pre>
<pre class="screen">ip vpn-instance vpna</pre>
<pre class="screen"> ipv4-family</pre>
<pre class="screen">  route-distinguisher 100:3</pre>
<pre class="screen">  apply-label per-instance</pre>
<pre class="screen">  vpn-target 111:1 export-extcommunity</pre>
<pre class="screen">  vpn-target 111:1 import-extcommunity</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls lsr-id 3.3.3.3</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls ldp</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.30.1.2 255.255.255.0</pre>
<pre class="screen"> mpls</pre>
<pre class="screen"> mpls ldp</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/2/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip binding vpn-instance vpna</pre>
<pre class="screen"> ip address 10.3.1.2 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">interface LoopBack1</pre>
<pre class="screen"> ip address 3.3.3.3 255.255.255.255</pre>
<pre class="screen">#</pre>
<pre class="screen">bgp 100</pre>
<pre class="screen"> peer 4.4.4.4 as-number 100</pre>
<pre class="screen"> peer 4.4.4.4 connect-interface LoopBack1</pre>
<pre class="screen"> #</pre>
<pre class="screen"> ipv4-family unicast</pre>
<pre class="screen">  undo synchronization
  peer 4.4.4.4 enable</pre>
<pre class="screen"> #</pre>
<pre class="screen"> ipv4-family vpnv4</pre>
<pre class="screen">  policy vpn-target</pre>
<pre class="screen">  peer 4.4.4.4 enable</pre>
<pre class="screen">#</pre>
<pre class="screen"> ipv4-family vpn-instance vpna</pre>
<pre class="screen">  peer 10.3.1.1 as-number 65003</pre>
<pre class="screen">#</pre>
<pre class="screen">ospf 1</pre>
<pre class="screen"> area 0.0.0.0</pre>
<pre class="screen">  network 3.3.3.3 0.0.0.0</pre>
<pre class="screen">  network 10.30.1.0 0.0.0.255</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p>CE3 configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname CE3</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.3.1.1 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">interface Loopback 1</pre>
<pre class="screen"> ip address 33.33.33.33 255.255.255.255</pre>
<pre class="screen">#</pre>
<pre class="screen">bgp 65003</pre>
<pre class="screen"> peer 10.3.1.2 as-number 100</pre>
<pre class="screen"> network 33.33.33.33 255.255.255.255</pre>
<pre class="screen"> #</pre>
<pre class="screen"> ipv4-family unicast</pre>
<pre class="screen">  undo synchronization
  peer 10.3.1.2 enable</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p>RR configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname RR</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls lsr-id 4.4.4.4</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls ldp</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.10.1.1 255.255.255.0</pre>
<pre class="screen"> mpls</pre>
<pre class="screen"> mpls ldp</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/2/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.20.1.1 255.255.255.0</pre>
<pre class="screen"> mpls</pre>
<pre class="screen"> mpls ldp</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/3/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.30.1.1 255.255.255.0</pre>
<pre class="screen"> mpls</pre>
<pre class="screen"> mpls ldp</pre>
<pre class="screen">#</pre>
<pre class="screen">interface LoopBack1</pre>
<pre class="screen"> ip address 4.4.4.4 255.255.255.255</pre>
<pre class="screen">#</pre>
<pre class="screen">bgp 100</pre>
<pre class="screen"> peer 1.1.1.1 as-number 100</pre>
<pre class="screen"> peer 1.1.1.1 connect-interface LoopBack1</pre>
<pre class="screen"> peer 3.3.3.3 as-number 100</pre>
<pre class="screen"> peer 3.3.3.3 connect-interface LoopBack1</pre>
<pre class="screen"> peer 5.5.5.5 as-number 100</pre>
<pre class="screen"> peer 5.5.5.5 connect-interface LoopBack1</pre>
<pre class="screen"> #</pre>
<pre class="screen"> ipv4-family unicast</pre>
<pre class="screen">  undo synchronization
  peer 1.1.1.1 enable</pre>
<pre class="screen">  peer 3.3.3.3 enable</pre>
<pre class="screen">  peer 5.5.5.5 enable</pre>
<pre class="screen"> #</pre>
<pre class="screen"> ipv4-family vpnv4</pre>
<pre class="screen">  undo policy vpn-target</pre>
<pre class="screen">  peer 1.1.1.1 enable</pre>
<pre class="screen">  peer 1.1.1.1 reflect-client</pre>
<pre class="screen">  peer 3.3.3.3 enable</pre>
<pre class="screen">  peer 3.3.3.3 reflect-client</pre>
<pre class="screen">  peer 5.5.5.5 enable</pre>
<pre class="screen">  peer 5.5.5.5 reflect-client</pre>
<pre class="screen">#</pre>
<pre class="screen">ospf 1</pre>
<pre class="screen"> area 0.0.0.0</pre>
<pre class="screen">  network 4.4.4.4 0.0.0.0</pre>
<pre class="screen">  network 10.10.1.0 0.0.0.255</pre>
<pre class="screen">  network 10.20.1.0 0.0.0.255</pre>
<pre class="screen">  network 10.30.1.0 0.0.0.255</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p>ASBR1 configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname ASBR1</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls lsr-id 5.5.5.5</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls ldp</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.20.1.2 255.255.255.0</pre>
<pre class="screen"> mpls</pre>
<pre class="screen"> mpls ldp</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/2/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 12.12.12.1 255.255.255.0</pre>
<pre class="screen"> mpls</pre>
<pre class="screen">#</pre>
<pre class="screen">interface LoopBack1</pre>
<pre class="screen"> ip address 5.5.5.5 255.255.255.255</pre>
<pre class="screen">#</pre>
<pre class="screen">bgp 100</pre>
<pre class="screen"> peer 4.4.4.4 as-number 100</pre>
<pre class="screen"> peer 4.4.4.4 connect-interface LoopBack1</pre>
<pre class="screen"> peer 12.12.12.2 as-number 200</pre>
<pre class="screen"> #</pre>
<pre class="screen"> ipv4-family unicast</pre>
<pre class="screen">  undo synchronization
  peer 4.4.4.4 enable</pre>
<pre class="screen">  peer 12.12.12.2 enable</pre>
<pre class="screen"> #</pre>
<pre class="screen"> ipv4-family vpnv4</pre>
<pre class="screen">  undo policy vpn-target</pre>
<pre class="screen">  peer 4.4.4.4 enable</pre>
<pre class="screen">  peer 12.12.12.2 enable</pre>
<pre class="screen">#</pre>
<pre class="screen">ospf 1</pre>
<pre class="screen"> area 0.0.0.0</pre>
<pre class="screen">  network 5.5.5.5 0.0.0.0</pre>
<pre class="screen">  network 10.20.1.0 0.0.0.255</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p>ASBR2 configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname ASBR1</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls lsr-id 6.6.6.6</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls ldp</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.40.1.1 255.255.255.0</pre>
<pre class="screen"> mpls</pre>
<pre class="screen"> mpls ldp</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/2/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 12.12.12.2 255.255.255.0</pre>
<pre class="screen"> mpls</pre>
<pre class="screen">#</pre>
<pre class="screen">interface LoopBack1</pre>
<pre class="screen"> ip address 6.6.6.6 255.255.255.255</pre>
<pre class="screen">#</pre>
<pre class="screen">bgp 200</pre>
<pre class="screen"> peer 2.2.2.2 as-number 200</pre>
<pre class="screen"> peer 2.2.2.2 connect-interface LoopBack1</pre>
<pre class="screen"> peer 12.12.12.1 as-number 100</pre>
<pre class="screen"> #</pre>
<pre class="screen"> ipv4-family unicast</pre>
<pre class="screen">  undo synchronization
  peer 2.2.2.2 enable</pre>
<pre class="screen">  peer 12.12.12.1 enable</pre>
<pre class="screen"> #</pre>
<pre class="screen"> ipv4-family vpnv4</pre>
<pre class="screen">  undo policy vpn-target</pre>
<pre class="screen">  peer 2.2.2.2 enable</pre>
<pre class="screen">  peer 12.12.12.1 enable</pre>
<pre class="screen">#</pre>
<pre class="screen">ospf 1</pre>
<pre class="screen"> area 0.0.0.0</pre>
<pre class="screen">  network 6.6.6.6 0.0.0.0</pre>
<pre class="screen">  network 10.40.1.0 0.0.0.255</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname PE2</pre>
<pre class="screen">#</pre>
<pre class="screen">ip vpn-instance vpna</pre>
<pre class="screen"> ipv4-family</pre>
<pre class="screen">  route-distinguisher 200:2</pre>
<pre class="screen">  apply-label per-instance</pre>
<pre class="screen">  vpn-target 111:1 export-extcommunity</pre>
<pre class="screen">  vpn-target 111:1 import-extcommunity</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls lsr-id 2.2.2.2</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls ldp</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.40.1.2 255.255.255.0</pre>
<pre class="screen"> mpls</pre>
<pre class="screen"> mpls ldp</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/2/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip binding vpn-instance vpna</pre>
<pre class="screen"> ip address 10.2.1.2 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">interface LoopBack1</pre>
<pre class="screen"> ip address 2.2.2.2 255.255.255.255</pre>
<pre class="screen">#</pre>
<pre class="screen">bgp 200</pre>
<pre class="screen"> peer 6.6.6.6 as-number 200</pre>
<pre class="screen"> peer 6.6.6.6 connect-interface LoopBack1</pre>
<pre class="screen"> #</pre>
<pre class="screen"> ipv4-family unicast</pre>
<pre class="screen">  undo synchronization
  peer 6.6.6.6 enable</pre>
<pre class="screen"> #</pre>
<pre class="screen"> ipv4-family vpnv4</pre>
<pre class="screen">  policy vpn-target</pre>
<pre class="screen">  peer 6.6.6.6 enable</pre>
<pre class="screen">#</pre>
<pre class="screen"> ipv4-family vpn-instance vpna</pre>
<pre class="screen">  peer 10.2.1.1 as-number 65002</pre>
<pre class="screen">#</pre>
<pre class="screen">ospf 1</pre>
<pre class="screen"> area 0.0.0.0</pre>
<pre class="screen">  network 10.40.1.0 0.0.0.255</pre>
<pre class="screen">  network 2.2.2.2 0.0.0.0</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p>CE2 configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname CE2</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.2.1.1 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">interface Loopback 1</pre>
<pre class="screen"> ip address 22.22.22.22 255.255.255.255</pre>
<pre class="screen">#</pre>
<pre class="screen">bgp 65002</pre>
<pre class="screen"> peer 10.2.1.2 as-number 200</pre>
<pre class="screen"> #</pre>
<pre class="screen"> ipv4-family unicast
  undo synchronization
  network 22.22.22.22 255.255.255.255
  peer 10.2.1.2 enable</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0101.html">Configuration Examples for BGP/MPLS IP VPN
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0112.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0114.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>