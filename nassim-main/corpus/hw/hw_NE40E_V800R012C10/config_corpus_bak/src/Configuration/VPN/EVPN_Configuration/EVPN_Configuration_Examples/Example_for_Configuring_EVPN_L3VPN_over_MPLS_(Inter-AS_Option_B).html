
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring EVPN L3VPN over MPLS (Inter-AS Option B)">
<meta name="abstract" content="This section describes how to configure EVPN L3VPN over MPLS (inter-AS Option B) to carry inter-AS Layer 3 service traffic.">
<meta name="description" content="This section describes how to configure EVPN L3VPN over MPLS (inter-AS Option B) to carry inter-AS Layer 3 service traffic.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0010.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0086_IPv6.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0095.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="p00915595,w00800033,w00556928,l00468467,w00606909,evpnvrp,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="p00915595">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00878323">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172370618">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring EVPN L3VPN over MPLS (Inter-AS Option B)</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172370618"></a><a name="EN-US_TASK_0172370618"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring EVPN L3VPN over MPLS (Inter-AS Option B)</h1>
<div class="taskbody"><p>This section describes how to configure EVPN L3VPN over MPLS (inter-AS Option B) to carry inter-AS Layer 3 service traffic.</p>
<div class="context"><a name="EN-US_TASK_0172370618__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0172370618__fig7286154194118">Figure 1</a>, CE1 and CE2 belong to the same VPN. CE1 is connected to PE1 in AS 100, and CE2 is connected to PE2 in AS 200. An EBGP EVPN peer relationship is configured between ASBRs to exchange EVPN routes so that an inter-AS Option B EVPN can carry Layer 3 service traffic.</p>
<div class="fignone" id="EN-US_TASK_0172370618__fig7286154194118"><a name="EN-US_TASK_0172370618__fig7286154194118"></a><a name="fig7286154194118"></a><span class="figcap"><b>Figure 1 </b>Configuring EVPN L3VPN over MPLS (inter-AS Option B)</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 and 2 in this example represent GE<span>0/1/0</span> and GE<span>0/2/0</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0000001185390354.png" width="NaN" height="NaN"></span><br></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172370618__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Notes</h4><p>During the configuration process, note the following:</p>
<ul><li><p>Establish an EBGP EVPN peer relationship between ASBR1 and ASBR2 and configure ASBR1 not to filter received EVPN routes based on VPN targets.</p>
</li></ul>
</div></div>
<div class="context"><a name="EN-US_TASK_0172370618__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure an IGP on the MPLS backbone networks in AS 100 and AS 200 to implement intra-AS communication.</p>
</li><li><p>Configure basic MPLS capabilities and MPLS LDP on the MPLS backbone networks of AS 100 and AS 200 to establish LDP LSPs.</p>
</li><li><p>Configure an L3VPN instance on each PE.</p>
</li><li><p>Establish BGP EVPN peer relationships between PEs and ASBRs.</p>
</li><li><p>Configure VPN BGP peer relationships between PEs and CEs.</p>
</li><li><p>Enable MPLS on the interfaces that connect ASBRs to each other, establish EBGP EVPN peer relationships between ASBRs, and configure ASBRs not to filter received EVPN routes based on VPN targets.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172370618__1.4.4"></a><a name="1.4.4"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>Interface names and IP address</p>
</li><li><p>MPLS LSR IDs of the PEs and ASBRs</p>
</li><li><p>Names (vpn1), RDs (100:1 and 200:1), and VPN targets (1:1) of the L3VPN instances created on PE1 and PE2</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172370618__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure an IGP on the MPLS backbone networks in AS 100 and AS 200 to implement intra-AS communication.</span><p><p>In this example, OSPF is used in AS 100, and IS-IS is used in AS 200. For configuration details, see <a href="#EN-US_TASK_0172370618__file_1">Configuration Files</a> in this section.</p>
</p></li><li><span>Configure basic MPLS capabilities and MPLS LDP on the MPLS backbone networks of AS 100 and AS 200 to establish LDP LSPs.</span><p><p>For configuration details, see <a href="#EN-US_TASK_0172370618__file_1">Configuration Files</a> in this section.</p>
</p></li><li><span>Configure an L3VPN instance on each PE.</span><p><div class="p"># Configure PE1.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>ip vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpn1] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpn1-af-ipv4] <strong>route-distinguisher 100:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpn1-af-ipv4] <strong>vpn-target 1:1 evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpn1-af-ipv4] <strong>evpn mpls routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpn1-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpn1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</div>
<p>The configuration of PE2 is similar to that of PE1. For configuration details, see <a href="#EN-US_TASK_0172370618__file_1">Configuration Files</a> in this section.</p>
</p></li><li><span>Establish BGP EVPN peer relationships between PEs and ASBRs.</span><p><div class="p"># Configure PE1.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 2.2.2.9 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 2.2.2.9 connect-interface LoopBack1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>l2vpn-family evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-evpn] <strong>peer 2.2.2.9 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>commit</strong></pre>
</div>
<p>The configurations of ASBR1, ASBR2, and PE2 are similar to that of PE1. For configuration details, see <a href="#EN-US_TASK_0172370618__file_1">Configuration Files</a> in this section.</p>
</p></li><li><span>Configure VPN BGP peer relationships between PEs and CEs.</span><p><div class="p"># Configure PE1.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp] <strong>ipv4-family vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-vpn1] <strong>import-route direct</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-vpn1] <strong>advertise l2vpn evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-vpn1] <strong>peer 192.168.1.2 as-number 65410</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-vpn1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</div>
<p>The configuration of PE2 is similar to that of PE1. For configuration details, see <a href="#EN-US_TASK_0172370618__file_1">Configuration Files</a> in this section.</p>
<div class="p"># Configure CE1.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>bgp 65410</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp] <strong>peer 192.168.1.1 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp] <strong>import-route direct</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>commit</strong></pre>
</div>
<p>The configuration of CE2 is similar to that of CE1. For detailed configurations, see <a href="#EN-US_TASK_0172370618__file_1">Configuration Files</a>.</p>
</p></li><li><span>Enable MPLS on the interfaces that connect ASBRs to each other, establish EBGP EVPN peer relationships between ASBRs, and configure ASBRs not to filter received EVPN routes based on VPN targets.</span><p><div class="p"># Configure ASBR1.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp] <strong>peer 10.2.1.2 as-number 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp] <strong>l2vpn-family evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp-af-evpn] <strong>peer 10.2.1.2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp-af-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1] <strong>interface GigabitEthernet<span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-GigabitEthernet<span>0/2/0</span>] <strong>ip address 10.2.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-GigabitEthernet<span>0/2/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1] <strong>commit</strong></pre>
</div>
<p>The configuration of ASBR2 is similar to the configuration of ASBR1. For configuration details, see <a href="#EN-US_TASK_0172370618__file_1">Configuration Files</a> in this section.</p>
</p></li><li><span>Verify the configuration.</span><p><p># After completing the configuration, run the <strong>display ip routing-table</strong> command on each CE to view the route to the remote CE. The following example uses the command output on CE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>display ip routing-table</strong></pre>
<pre class="screen">Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route
------------------------------------------------------------------------------
Routing Table : _public_
         Destinations : 10       Routes : 10        

Destination/Mask    Proto   Pre  Cost        Flags NextHop         Interface

    10.10.10.10/32  Direct  0    0             D   127.0.0.1       LoopBack1
   <strong>10.20.20.20</strong>/32  EBGP    255  0             RD  192.168.1.1    GigabitEthernet<span>0/1/0</span>
      127.0.0.0/8   Direct  0    0             D   127.0.0.1       InLoopBack0
      127.0.0.1/32  Direct  0    0             D   127.0.0.1       InLoopBack0
127.255.255.255/32  Direct  0    0             D   127.0.0.1       InLoopBack0
    192.168.1.0/24  Direct  0    0             D   192.168.1.2     GigabitEthernet<span>0/1/0</span>
    192.168.1.2/32  Direct  0    0             D   127.0.0.1       GigabitEthernet<span>0/1/0</span>
  192.168.1.255/32  Direct  0    0             D   127.0.0.1       GigabitEthernet<span>0/1/0</span>
    192.168.2.0/24  EBGP    255  0             RD  192.168.1.1     GigabitEthernet<span>0/1/0</span>
255.255.255.255/32  Direct  0    0             D   127.0.0.1       InLoopBack0</pre>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0172370618__file_1"><a name="EN-US_TASK_0172370618__file_1"></a><a name="file_1"></a><a name="EN-US_TASK_0172370618__1.4.6"></a><a name="1.4.6"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>PE1 configuration file</p>
<pre class="screen">#
sysname PE1
#
ip vpn-instance vpn1
 ipv4-family
  route-distinguisher 100:1
<span>  apply-label per-instance</span>
  vpn-target 1:1 export-extcommunity evpn
  vpn-target 1:1 import-extcommunity evpn
  evpn mpls routing-enable
#
mpls lsr-id 1.1.1.9
#
mpls
#
mpls ldp        
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip binding vpn-instance vpn1
 ip address 192.168.1.1 255.255.255.0
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.1.1.2 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 1.1.1.9 255.255.255.255
#
bgp 100
 peer 2.2.2.9 as-number 100
 peer 2.2.2.9 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 2.2.2.9 enable
 #
 ipv4-family vpn-instance vpn1
  import-route direct
  advertise l2vpn evpn
  peer 192.168.1.2 as-number 65410
 #
 l2vpn-family evpn
  undo policy vpn-target
  peer 2.2.2.9 enable
#
ospf 1
 area 0.0.0.0
  network 1.1.1.9 0.0.0.0
  network 10.1.1.0 0.0.0.255
#
evpn source-address 1.1.1.9
#
return</pre>
</li><li><p>ASBR1 configuration file</p>
<pre class="screen">#
sysname ASBR1
#
mpls lsr-id 2.2.2.9
#
mpls
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.1.1 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.2.1.1 255.255.255.0
 mpls
#
interface LoopBack1
 ip address 2.2.2.9 255.255.255.255
#
bgp 100         
 peer 1.1.1.9 as-number 100
 peer 1.1.1.9 connect-interface LoopBack1
 peer 10.2.1.2 as-number 200
 #
 ipv4-family unicast
  undo synchronization
  peer 1.1.1.9 enable
  peer 10.2.1.2 enable
 #
 l2vpn-family evpn
  undo policy vpn-target
  peer 1.1.1.9 enable
  peer 10.2.1.2 enable
#
ospf 1
 area 0.0.0.0
  network 2.2.2.9 0.0.0.0
  network 10.1.1.0 0.0.0.255
#
return</pre>
</li><li><p>ASBR2 configuration file</p>
<pre class="screen">#
sysname ASBR2
#
mpls lsr-id 3.3.3.9
#
mpls
#
mpls ldp
#
isis 1
 network-entity 00.1111.1111.1111.00
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.3.1.2 255.255.255.0
 isis enable 1
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.2.1.2 255.255.255.0
 mpls
#
interface LoopBack1
 ip address 3.3.3.9 255.255.255.255
 isis enable 1
#
bgp 200
 peer 4.4.4.9 as-number 200
 peer 4.4.4.9 connect-interface LoopBack1
 peer 10.2.1.1 as-number 100
 #
 ipv4-family unicast
  undo synchronization
  peer 4.4.4.9 enable
  peer 10.2.1.1 enable
 #
 l2vpn-family evpn
  undo policy vpn-target
  peer 4.4.4.9 enable
  peer 10.2.1.1 enable
#               
return</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#
sysname PE2
#
ip vpn-instance vpn1
 ipv4-family
  route-distinguisher 200:1
<span>  apply-label per-instance</span>
  vpn-target 1:1 export-extcommunity evpn
  vpn-target 1:1 import-extcommunity evpn
  evpn mpls routing-enable
#
mpls lsr-id 4.4.4.9
#
mpls
#
mpls ldp        
#
isis 1
 network-entity 00.1111.1111.2222.00
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.3.1.1 255.255.255.0
 isis enable 1
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip binding vpn-instance vpn1
 ip address 192.168.2.1 255.255.255.0
#
interface LoopBack1
 ip address 4.4.4.9 255.255.255.255
 isis enable 1
#
bgp 200
 peer 3.3.3.9 as-number 200
 peer 3.3.3.9 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 3.3.3.9 enable
 #
 ipv4-family vpn-instance vpn1
  import-route direct
  advertise l2vpn evpn
  peer 192.168.2.2 as-number 65420
 #
 l2vpn-family evpn
  undo policy vpn-target
  peer 3.3.3.9 enable
#
evpn source-address 4.4.4.9
#
return</pre>
</li><li><p>CE1 configuration file</p>
<pre class="screen">#
sysname CE1
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 192.168.1.2 255.255.255.0
#
interface LoopBack1
 ip address 10.10.10.10 255.255.255.255
#
bgp 65410
 peer 192.168.1.1 as-number 100
 #
 ipv4-family unicast
  undo synchronization
  import-route direct
  peer 192.168.1.1 enable
#
return</pre>
</li><li><p>CE2 configuration file</p>
<pre class="screen">#
sysname CE2
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 192.168.2.2 255.255.255.0
#
interface LoopBack1
 ip address 10.20.20.20 255.255.255.255
#
bgp 65420
 peer 192.168.2.1 as-number 200
 #
 ipv4-family unicast
  undo synchronization
  import-route direct
  peer 192.168.2.1 enable
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0010.html">EVPN Configuration Examples
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0086_IPv6.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0095.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>