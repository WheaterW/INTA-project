
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring VPN IP FRR">
<meta name="abstract" content="This section describes how to configure VPN IP FRR. At a VPN site where multiple CEs connect to the same PE, this feature can immediately switch traffic to another PE-CE link when the next hop of the active route is unreachable.">
<meta name="description" content="This section describes how to configure VPN IP FRR. At a VPN site where multiple CEs connect to the same PE, this feature can immediately switch traffic to another PE-CE link when the next hop of the active route is unreachable.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0000.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_2017.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_2013.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,l3vpnvrp,w00556928,l00468467,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="h00847023">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00830487">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172369422">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring VPN IP FRR</title>
</head>
<body><a name="EN-US_TASK_0172369422"></a><a name="EN-US_TASK_0172369422"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring VPN IP FRR</h1>
<div class="taskbody"><p>This section describes how to configure VPN IP FRR. At a VPN site where multiple CEs connect to the same PE, this feature can immediately switch traffic to another PE-CE link when the next hop of the active route is unreachable.</p>
<div class="context"><a name="EN-US_TASK_0172369422__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Usage Scenario</h4><p>This feature is suitable for IP services that are sensitive to the packet loss and delay on a VPN. After VPN IP FRR is configured, traffic is immediately switched to another PE-CE link when the next hop of the active route is unreachable. This reduces IP service interruption time.</p>
<p>On the network shown in <a href="dc_vrp_mpls-l3vpn-v4_cfg_2012.html#EN-US_TASK_0172369422__fig_dc_vrp_mpls-l3vpn-v4_cfg_201201">Figure 1</a>, in normal situations, the PE selects Link_A to forward traffic to site vpn1 and uses Link_B as the backup link. If the PE detects that the route to CE1 is unreachable, it immediately switches traffic to Link_B and performs VPN route convergence, minimizing the impact on VPN services.</p>
<div class="fignone" id="EN-US_TASK_0172369422__fig_dc_vrp_mpls-l3vpn-v4_cfg_201201"><a name="EN-US_TASK_0172369422__fig_dc_vrp_mpls-l3vpn-v4_cfg_201201"></a><a name="fig_dc_vrp_mpls-l3vpn-v4_cfg_201201"></a><span class="figcap"><b>Figure 1 </b>VPN IP FRR</span><br><span><img class="vsd" src="images/fig_dc_vrp_mpls-l3vpn-v4_cfg_201201.png"></span></div>
<p>At present, the <span class="keyword">NE40E</span> supports the following VPN IP FRR modes:</p>
<ul><li><p>IP FRR: applies to the networking where different PE-CE pairs use different routing protocols.</p>
</li><li><p>VPN BGP auto FRR: applies to the networking where BGP runs between the PEs and CE.</p>
</li></ul>
</div></div>
<div class="context"><a name="EN-US_TASK_0172369422__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Pre-configuration Tasks</h4><p>Before configuring VPN IP FRR, complete the following tasks:</p>
<ul><li><p>Configure a BGP/MPLS IP VPN.</p>
</li><li><p>Configure the PE to learn VPN routes with the same prefix from different CEs attached to it.</p>
</li></ul>
</div></div>
<div class="steps-unordered"><a name="EN-US_TASK_0172369422__1.4.3"></a><a name="1.4.3"></a><h4 class="sectiontitle">Procedure</h4>
<ul><li><span>Configure IP FRR.</span><ol><li><span>Run the <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a> command to enter the system view.</span></li><li><span>Run the <a href="cmdqueryname=ip+vpn-instance"><b><span class="cmdname">ip vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i> command to enter the VPN instance view.</span></li><li><span>Run the <a href="cmdqueryname=ipv4-family"><b><span class="cmdname">ipv4-family</span></b></a> command to enter the VPN instance IPv4 address family view.</span></li><li><span>Run the <a href="cmdqueryname=ip+frr"><b><span class="cmdname">ip frr</span></b></a> command to enable VPN IP FRR.</span></li><li><span>Run the <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a> command to commit the configuration.</span></li></ol>
</li><li><span>Configure VPN BGP auto FRR.</span><ol><li><span>Run the <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a> command to enter the system view.</span></li><li><span>Run the <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i> command to enter the BGP view.</span></li><li><span>Run the <a href="cmdqueryname=ipv4-family"><b><span class="cmdname">ipv4-family</span></b></a> <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i> command to enter the BGP VPN instance IPv4 address family view.</span></li><li><span>Run the <a href="cmdqueryname=auto-frr"><b><span class="cmdname">auto-frr</span></b></a> command to enable BGP auto FRR.</span></li><li><span>(Optional) Run the <a href="cmdqueryname=route-select+delay"><b><span class="cmdname">route-select delay</span></b></a> <i><span class="varname">delay-value</span></i> command to configure a route selection delay. Delayed route selection ensures that after the primary path recovers, the device on the primary path performs route selection only after the corresponding forwarding entries on the device are stable. This prevents traffic loss during traffic switchback.</span></li><li><span>Run the <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a> command to commit the configuration.</span></li></ol>
</li><li><span>(Optional) Enable IP FRR poison reverse.</span><p><p>In <a href="#EN-US_TASK_0172369422__fig20345859153119">Figure 2</a>, IP FRR is deployed on the IP ring network, and the traffic enters the ring network from DeviceD and leaves the ring network from DeviceA. The primary and backup next hops of DeviceD are DeviceC and DeviceE, respectively. The primary and backup next hops of DeviceC are DeviceB and DeviceD, respectively. If the link between DeviceB and DeviceC fails, DeviceC forwards the traffic received from DeviceD back to DeviceD. However, before the route convergence is complete, DeviceD cannot detect the link failure between DeviceB and DeviceC, and continues to forward the traffic to DeviceC. As a result, an instantaneous traffic storm is generated between DeviceC and DeviceD. After DeviceD detects the link failure between DeviceB and DeviceC through route convergence, the traffic is forwarded from DeviceD to the backup next hop, DeviceE.</p>
<div class="fignone" id="EN-US_TASK_0172369422__fig20345859153119"><a name="EN-US_TASK_0172369422__fig20345859153119"></a><a name="fig20345859153119"></a><span class="figcap"><b>Figure 2 </b>IP ring network</span><br><span><img class="vsd" src="figure/en-us_image_0174096154.png"></span></div>
<div class="fignone"><span class="figcap"><b>Figure 3 </b>IP ring network with IP FRR poison reverse enabled</span><br><span><img class="vsd" src="figure/en-us_image_0174096222.png"></span></div>
</p><ol><li class="substepexpand"><span>Run the <a href="cmdqueryname=interface"><b><span class="cmdname">interface</span></b></a> <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i> command to enter the interface or sub-interface view.</span><p><p>The view can be the Eth-Trunk interface, Eth-Trunk sub-interface, GE interface, or GE sub-interface view.</p>
</p></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=poison-reverse+enable"><b><span class="cmdname">poison-reverse enable</span></b></a> command to enable IP FRR poison reverse.</span><p><p>On an IP ring network configured with IP FRR, this command is used to prevent instantaneous traffic storms caused by route convergence.</p>
<p>In a load balancing scenario, poison reverse does not take effect.</p>
</p></li></ol>
</li></ul></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0000.html">BGP/MPLS IP VPN Configuration
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_2017.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_2013.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>