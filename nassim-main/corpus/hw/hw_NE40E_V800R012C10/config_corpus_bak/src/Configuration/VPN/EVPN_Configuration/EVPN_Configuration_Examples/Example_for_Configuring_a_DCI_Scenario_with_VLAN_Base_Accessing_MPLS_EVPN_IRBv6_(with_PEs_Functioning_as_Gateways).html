
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring a DCI Scenario with VLAN Base Accessing MPLS EVPN IRBv6 (with PEs Functioning as Gateways)">
<meta name="abstract" content="Underlay VLAN accessing DCI uses different cloud management platforms, and Ethernet sub-interfaces are associated with VLANs for access to the DCI backbone network. DCI-PEs and DC GWs are integrated to form DCI-PE-GWs. BGP EVPN is deployed between DCI-PE-GWs to transmit IRBv6 routes, ensuring service communication.">
<meta name="description" content="Underlay VLAN accessing DCI uses different cloud management platforms, and Ethernet sub-interfaces are associated with VLANs for access to the DCI backbone network. DCI-PEs and DC GWs are integrated to form DCI-PE-GWs. BGP EVPN is deployed between DCI-PE-GWs to transmit IRBv6 routes, ensuring service communication.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0010.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_dci_cfg_0032.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0078.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="l00425560">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00878323">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172370690">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>Example for Configuring a DCI Scenario with VLAN Base Accessing MPLS EVPN IRBv6 (with PEs Functioning as Gateways)</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172370690"></a><a name="EN-US_TASK_0172370690"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring a DCI Scenario with VLAN Base Accessing MPLS EVPN IRBv6 (with PEs Functioning as Gateways)</h1>
<div class="taskbody"><p>Underlay VLAN accessing DCI uses different cloud management platforms, and Ethernet sub-interfaces are associated with VLANs for access to the DCI backbone network. DCI-PEs and DC GWs are integrated to form DCI-PE-GWs. BGP EVPN is deployed between DCI-PE-GWs to transmit IRBv6 routes, ensuring service communication. </p>
<div class="context"><a name="EN-US_TASK_0172370690__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>A device functions as both a DC GW and a DCI-PE and directly connects to a DC device. On the network shown in <a href="#EN-US_TASK_0172370690__fig_dc_vrp_dci_cfg_003201">Figure 1</a>, a DCI-PE-GW functions as both a DC GW and a DCI-PE. A DCI-PE-GW connects to the P on the DCI backbone network on one side and directly connects to a DC device on the other side. A VXLAN tunnel is established in each DC to implement intra-DC VM communication. To implement inter-DC VM communication, create L3VPN and EVPN instances on DCI-PE-GWs and deploy BGP EVPN between the DCI-PE-GWs on the DCI backbone network.</p>
<div class="fignone" id="EN-US_TASK_0172370690__fig_dc_vrp_dci_cfg_003201"><a name="EN-US_TASK_0172370690__fig_dc_vrp_dci_cfg_003201"></a><a name="fig_dc_vrp_dci_cfg_003201"></a><span class="figcap"><b>Figure 1 </b>Configuring a DCI scenario with VLAN base accessing MPLS EVPN IRBv6 (PEs also functioning as gateways)</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface1, interface2, and sub-interface1.1 represent GE<span>0/1/0</span>, GE<span>0/2/0</span>, and GE<span>0/1/0</span>.1, respectively.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_dci_cfg_003201.png" width="NaN" height="NaN"></span><br></div>

<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" frame="border" border="1" rules="all"><caption><b>Table 1 </b>Interface IP addresses</caption><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="12.62126212621262%" id="mcps1.4.1.4.2.4.1.1" liSelected="liSelected"><p>Device</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="43.85438543854385%" id="mcps1.4.1.4.2.4.1.2" liSelected="liSelected"><p>Interface</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="43.52435243524352%" id="mcps1.4.1.4.2.4.1.3" liSelected="liSelected"><p>IP Address</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" rowspan="3" valign="middle" width="12.62126212621262%" headers="mcps1.4.1.4.2.4.1.1 "><p>DCI-PE1-GW1</p>
</td>
<td class="cellrowborder" valign="top" width="43.85438543854385%" headers="mcps1.4.1.4.2.4.1.2 "><p>GigabitEthernet <span>0/1/0</span>.1</p>
</td>
<td class="cellrowborder" valign="top" width="43.52435243524352%" headers="mcps1.4.1.4.2.4.1.3 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.2 "><p>GigabitEthernet <span>0/2/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>192.168.1.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.2 "><p>LoopBack1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>1.1.1.1/32</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="3" valign="middle" width="12.62126212621262%" headers="mcps1.4.1.4.2.4.1.1 "><p>P</p>
</td>
<td class="cellrowborder" valign="top" width="43.85438543854385%" headers="mcps1.4.1.4.2.4.1.2 "><p>GigabitEthernet <span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" width="43.52435243524352%" headers="mcps1.4.1.4.2.4.1.3 "><p>192.168.1.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.2 "><p>GigabitEthernet <span>0/2/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>192.168.10.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.2 "><p>LoopBack1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>2.2.2.2/32</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="3" valign="middle" width="12.62126212621262%" headers="mcps1.4.1.4.2.4.1.1 "><p>DCI-PE2-GW2</p>
</td>
<td class="cellrowborder" valign="top" width="43.85438543854385%" headers="mcps1.4.1.4.2.4.1.2 "><p>GigabitEthernet <span>0/1/0</span>.1</p>
</td>
<td class="cellrowborder" valign="top" width="43.52435243524352%" headers="mcps1.4.1.4.2.4.1.3 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.2 "><p>GigabitEthernet <span>0/2/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>192.168.10.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.2 "><p>LoopBack1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>3.3.3.3/32</p>
</td>
</tr>
</tbody>
</table>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172370690__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure OSPF on the DCI backbone network to implement communication between DCI-PE-GWs.</p>
</li><li><p>Configure an MPLS TE tunnel on the DCI backbone network.</p>
</li><li><p>Configure VPN instances on DCI-PE-GWs and apply tunnel policies to these VPN instances.</p>
</li><li><p>Create VBDIF interfaces and bind these interfaces to VPN instances on DCI-PE-GWs.</p>
</li><li><p>Configure DCI-PE-GWs to advertise IPv6 prefix routes.</p>
</li><li><p>Configure EVPN instances on DCI-PE-GWs, establish a BGP EVPN peer relationship between the DCI-PE-GWs, and advertise IRBv6 routes.</p>
</li><li><p>Configure a source address on each DCI-PE-GW.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172370690__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>MPLS LSR IDs of the DCI-PE-GWs and P</p>
</li><li><p>VPN instance RD</p>
</li><li><p>VPN targets used for route import and export by the VPN instance</p>
</li><li><p>EVPN instance RD</p>
</li><li><p>VPN targets used for route import and export by the EVPN instance</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172370690__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure interface IP addresses, including loopback interface addresses, on each node.</span><p><p>For detailed configurations, see <a href="#EN-US_TASK_0172370690__dc_vrp_dci_cfg_0012_section">Configuration Files</a>.</p>
</p></li><li><span>Configure an IGP on the DCI backbone network. OSPF is used in this example.</span><p><p>For detailed configurations, see <a href="#EN-US_TASK_0172370690__dc_vrp_dci_cfg_0012_section">Configuration Files</a>.</p>
</p></li><li><span>Configure an MPLS TE tunnel on the DCI backbone network.</span><p><p>For detailed configurations, see <a href="#EN-US_TASK_0172370690__dc_vrp_dci_cfg_0012_section">Configuration Files</a>.</p>
</p></li><li><span>Configure VPN instances on DCI-PE-GWs and apply tunnel policies to these VPN instances.</span><p><p># Configure DCI-PE1-GW1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DCI-PE1-GW1] <strong>tunnel-policy te-lsp1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE1-GW1-tunnel-policy-te-lsp1] <strong>tunnel select-seq cr-lsp load-balance-number 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE1-GW1-tunnel-policy-te-lsp1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE1-GW1] <strong>ip vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE1-GW1-vpn-instance-vpn1] <strong>ipv6-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE1-GW1-vpn-instance-vpn1-af-ipv6] <strong>route-distinguisher 11:11</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE1-GW1-vpn-instance-vpn1-af-ipv6] <strong>tnl-policy te-lsp1 evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE1-GW1-vpn-instance-vpn1-af-ipv6] <strong>vpn-target 11:1 both evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE1-GW1-vpn-instance-vpn1-af-ipv6] <strong>evpn mpls routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE1-GW1-vpn-instance-vpn1-af-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE1-GW1-vpn-instance-vpn1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE1-GW1] <strong>commit</strong></pre>
<p># Configure DCI-PE2-GW2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DCI-PE2-GW2] <strong>tunnel-policy te-lsp1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE2-GW2-tunnel-policy-te-lsp1] <strong>tunnel select-seq cr-lsp load-balance-number 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE2-GW2-tunnel-policy-te-lsp1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE2-GW2] <strong>ip vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE2-GW2-vpn-instance-vpn1] <strong>ipv6-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE2-GW2-vpn-instance-vpn1-af-ipv6] <strong>route-distinguisher 11:11</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE2-GW2-vpn-instance-vpn1-af-ipv6] <strong>tnl-policy te-lsp1 evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE2-GW2-vpn-instance-vpn1-af-ipv6] <strong>vpn-target 11:1 both evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE2-GW2-vpn-instance-vpn1-af-ipv6] <strong>evpn mpls routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE2-GW2-vpn-instance-vpn1-af-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE2-GW2-vpn-instance-vpn1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE2-GW2] <strong>commit</strong></pre>
</p></li><li><span>Configure DCI-PE-GWs to advertise IP prefix routes.</span><p><p># Configure DCI-PE1-GW1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DCI-PE1-GW1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE1-GW1-bgp] <strong>ipv6-family vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE1-GW1-bgp-6-vpn1] <strong>import-route direct</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE1-GW1-bgp-6-vpn1] <strong>advertise l2vpn evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE1-GW1-bgp-6-vpn1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE1-GW1] <strong>commit</strong></pre>
<p># Configure DCI-PE2-GW2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DCI-PE2-GW2] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE2-GW2-bgp] <strong>ipv6-family vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE2-GW2-bgp-6-vpn1] <strong>import-route direct</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE2-GW2-bgp-6-vpn1] <strong>advertise l2vpn evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE2-GW2-bgp-6-vpn1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE2-GW2] <strong>commit</strong></pre>
</p></li><li><span>Configure EVPN instances on DCI-PE-GWs, establish a BGP EVPN peer relationship between the DCI-PE-GWs, and advertise IRBv6 routes.</span><p><p># Configure DCI-PE1-GW1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DCI-PE1-GW1] <strong>evpn vpn-instance evrf1 bd-mode</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE1-GW1-evpn-instance-evrf1] <strong>route-distinguisher 10:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE1-GW1-evpn-instance-evrf1] <strong>vpn-target 11:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE1-GW1-evpn-instance-evrf1] <strong>tnl-policy te-lsp1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE1-GW1-evpn-instance-evrf1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE1-GW1] <strong>bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE1-GW1-bd10] <strong>evpn binding vpn-instance evrf1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE1-GW1-bd10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE1-GW1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE1-GW1-bgp] <strong>peer 3.3.3.3 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE1-GW1-bgp] <strong>peer 3.3.3.3 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE1-GW1-bgp] <strong>l2vpn-family evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE1-GW1-bgp-af-evpn] <strong>peer 3.3.3.3 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE1-GW1-bgp-af-evpn] <strong>peer 3.3.3.3 advertise irbv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE1-GW1-bgp-af-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE1-GW1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE1-GW1] <strong>commit</strong></pre>
<p># Configure DCI-PE2-GW2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DCI-PE2-GW2] <strong>evpn vpn-instance evrf1 bd-mode</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE2-GW2-evpn-instance-evrf1] <strong>route-distinguisher 10:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE2-GW2-evpn-instance-evrf1] <strong>vpn-target 11:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE2-GW1-evpn-instance-evrf1] <strong>tnl-policy te-lsp1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE2-GW2-evpn-instance-evrf1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE2-GW2] <strong>bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE2-GW2-bd10] <strong>evpn binding vpn-instance evrf1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE2-GW2-bd10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE2-GW2] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE2-GW2-bgp] <strong>peer 1.1.1.1 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE2-GW2-bgp] <strong>peer 1.1.1.1 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE2-GW2-bgp] <strong>l2vpn-family evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE2-GW2-bgp-af-evpn] <strong>peer 1.1.1.1 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE2-GW2-bgp-af-evpn] <strong>peer 1.1.1.1 advertise irbv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE2-GW2-bgp-af-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE2-GW2-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE2-GW2] <strong>commit</strong></pre>
</p></li><li><span>Create VBDIF interfaces on DCI-PE-GWs.</span><p><p># Configure DCI-PE1-GW1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DCI-PE1-GW1] <strong>interface gigabitethernet <span>0/1/0</span>.1 mode l2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE1-GW1-GigabitEthernet<span>0/1/0</span>.1] <strong>encapsulation dot1q vid 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE1-GW1-GigabitEthernet<span>0/1/0</span>.1] <strong>rewrite pop single</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE1-GW1-GigabitEthernet<span>0/1/0</span>.1] <strong>bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE1-GW1-GigabitEthernet<span>0/1/0</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE1-GW1] <strong>interface Vbdif10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE1-GW1-Vbdif10] <strong>ip binding vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE1-GW1-Vbdif10] <strong>ipv6 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE1-GW1-Vbdif10] <strong>ipv6 address 2001:DB8:10::1 64</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE1-GW1-Vbdif10] <strong>ipv6 nd collect host enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE1-GW1-Vbdif10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE1-GW1] <strong>commit</strong></pre>
<p># Configure DCI-PE2-GW2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DCI-PE2-GW2] <strong>interface gigabitethernet <span>0/1/0</span>.1 mode l2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE2-GW2-GigabitEthernet<span>0/1/0</span>.1] <strong>encapsulation dot1q vid 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE2-GW2-GigabitEthernet<span>0/1/0</span>.1] <strong>rewrite pop single</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE2-GW2-GigabitEthernet<span>0/1/0</span>.1] <strong>bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE2-GW2-GigabitEthernet<span>0/1/0</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE2-GW2] <strong>interface Vbdif10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE2-GW2-Vbdif10] <strong>ip binding vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE1-GW2-Vbdif10] <strong>ipv6 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE1-GW2-Vbdif10] <strong>ipv6 address 2001:DB8:20::1 64</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE2-GW2-Vbdif10] <strong>ipv6 nd collect host enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE2-GW2-Vbdif10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE2-GW2] <strong>commit</strong></pre>
</p></li><li><span>Configure a source address on each DCI-PE-GW.</span><p><p># Configure DCI-PE-GW1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DCI-PE-GW1] <strong>evpn source-address 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE-GW1] <strong>commit</strong></pre>
<p># Configure DCI-PE-GW2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DCI-PE-GW2] <strong>evpn source-address 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCI-PE-GW2] <strong>commit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p>Run the <strong>display bgp evpn all routing-table</strong> command on a DCI-PE-GW. The command output shows that the DCI-PE-GW has received EVPN IRBv6 routes from the remote DCI-PE-GW. The following example uses the command output on DCI-PE1-GW1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DCI-PE1-GW1] <strong>display bgp evpn all routing-table</strong></pre>
<pre class="screen"> Local AS number : 100

 BGP Local router ID is 192.168.1.1
 Status codes: * - valid, &gt; - best, d - damped, x - best external, a - add path,
               h - history,  i - internal, s - suppressed, S - Stale
               Origin : i - IGP, e - EGP, ? - incomplete

 
 EVPN address family:
 Number of Mac Routes: 4
 Route Distinguisher: 10:1
       Network(EthTagId/MacAddrLen/MacAddr/IpAddrLen/IpAddr)  NextHop
 *&gt;i   0:48:00e0-fc12-3456:0:0.0.0.0                          3.3.3.3
 *&gt;i   0:48:00e0-fc12-3456:32:20.1.1.1                        3.3.3.3
 *&gt;    0:48:00e0-fc12-7890:0:0.0.0.0                          0.0.0.0
 *&gt;    0:48:00e0-fc12-7890:32:10.1.1.1                        0.0.0.0
    
    

 EVPN-Instance evrf1:
 Number of Mac Routes: 4
       Network(EthTagId/MacAddrLen/MacAddr/IpAddrLen/IpAddr)  NextHop
 *&gt;i   0:48:00e0-fc12-3456:0:0.0.0.0                          3.3.3.3
 *&gt;i   0:48:00e0-fc12-3456:32:20.1.1.1                        3.3.3.3
 *&gt;    0:48:00e0-fc12-7890:0:0.0.0.0                          0.0.0.0
 *&gt;    0:48:00e0-fc12-7890:32:10.1.1.1                        0.0.0.0
 
 EVPN address family:
 Number of Inclusive Multicast Routes: 2
 Route Distinguisher: 10:1
       Network(EthTagId/IpAddrLen/OriginalIp)                 NextHop
 *&gt;    0:32:1.1.1.1                                           127.0.0.1
 *&gt;i   0:32:3.3.3.3                                           3.3.3.3
    

 EVPN-Instance evrf1:
 Number of Inclusive Multicast Routes: 2
       Network(EthTagId/IpAddrLen/OriginalIp)                 NextHop
 *&gt;    0:32:1.1.1.1                                           127.0.0.1
 *&gt;i   0:32:3.3.3.3                                           3.3.3.3
 
 EVPN address family:
 Number of Ip Prefix Routes: 2
 Route Distinguisher: 11:11
       Network(EthTagId/IpPrefix/IpPrefixLen)                 NextHop
 *&gt;    0:10.1.1.0:24                                          0.0.0.0
 *&gt;i   0:10.2.1.0:24                                          3.3.3.3
    
</pre>
<p>Run the <strong>display ipv6 routing-table vpn-instance</strong> command on a DCI-PE-GW. The command output shows that the DCI-PE-GW has received VPN routes from the remote DCI-PE-GW. The following example uses the command output on DCI-PE1-GW1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DCI-PE1-GW1] <strong>display ipv6 routing-table vpn-instance vpn1</strong></pre>
<pre class="screen">Routing Table : vpn1
         Destinations : 4        Routes : 4         

Destination  : 2001:DB8:10::                           PrefixLength : 64
NextHop      : 2001:DB8:10::1                          Preference   : 0
Cost         : 0                                       Protocol     : Direct
RelayNextHop : ::                                      TunnelID     : 0x0
Interface    : Vbdif10                                 Flags        : D

Destination  : 2001:DB8:10::1                          PrefixLength : 128
NextHop      : ::1                                     Preference   : 0
Cost         : 0                                       Protocol     : Direct
RelayNextHop : ::                                      TunnelID     : 0x0
Interface    : Vbdif10                                 Flags        : D

Destination  : 2001:DB8:20::                           PrefixLength : 64
NextHop      : ::FFFF:3.3.3.3                          Preference   : 255
Cost         : 0                                       Protocol     : IBGP
RelayNextHop : ::FFFF:0.0.0.0                          TunnelID     : 0x000000000300000001
Interface    : Tunnel1                                 Flags        : RD

Destination  : FE80::                                  PrefixLength : 10
NextHop      : ::                                      Preference   : 0
Cost         : 0                                       Protocol     : Direct
RelayNextHop : ::                                      TunnelID     : 0x0
Interface    : NULL0                                   Flags        : DB</pre>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0172370690__dc_vrp_dci_cfg_0012_section"><a name="EN-US_TASK_0172370690__dc_vrp_dci_cfg_0012_section"></a><a name="dc_vrp_dci_cfg_0012_section"></a><a name="EN-US_TASK_0172370690__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>DCI-PE1-GW1 configuration file</p>
<pre class="screen">#
sysname DCI-PE1-GW1
#
evpn vpn-instance evrf1 bd-mode
 route-distinguisher 10:1
 tnl-policy te-lsp1
 vpn-target 11:1 export-extcommunity
 vpn-target 11:1 import-extcommunity
#
ip vpn-instance vpn1
 ipv6-family
  route-distinguisher 11:11
<span>  apply-label per-instance</span>
  vpn-target 11:1 export-extcommunity evpn
  vpn-target 11:1 import-extcommunity evpn
  tnl-policy te-lsp1 evpn
  evpn mpls routing-enable
#
mpls lsr-id 1.1.1.1
#
mpls
 mpls te
 mpls rsvp-te
 mpls te cspf
#
bridge-domain 10
 evpn binding vpn-instance evrf1
#
interface Vbdif10
 ip binding vpn-instance vpn1
 ipv6 enable
 ipv6 address 2001:DB8:10::1/64
 ipv6 nd collect host enable
#
interface GigabitEthernet<span>0/1/0</span>.1 mode l2
 encapsulation dot1q vid 10
 rewrite pop single
 bridge-domain 10
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 192.168.1.1 255.255.255.0
 mpls
 mpls te
 mpls rsvp-te
#
interface LoopBack1
 ip address 1.1.1.1 255.255.255.255
#
interface Tunnel1
 ip address unnumbered interface LoopBack1
 tunnel-protocol mpls te
 destination 3.3.3.3
 mpls te tunnel-id 100
#
bgp 100
 peer 3.3.3.3 as-number 100
 peer 3.3.3.3 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 3.3.3.3 enable
 #
 ipv6-family vpn-instance vpn1
  import-route direct
  advertise l2vpn evpn
 #
 l2vpn-family evpn
  undo policy vpn-target
  peer 3.3.3.3 enable
  peer 3.3.3.3 advertise irbv6
#               
ospf 1
 opaque-capability enable
 area 0.0.0.0
  network 1.1.1.1 0.0.0.0
  network 192.168.1.0 0.0.0.255
  mpls-te enable
#
tunnel-policy te-lsp1
 tunnel select-seq cr-lsp load-balance-number 1
#
evpn source-address 1.1.1.1
#
return</pre>
</li><li><p>P configuration file</p>
<pre class="screen">#
sysname P
#
mpls lsr-id 2.2.2.2
#
mpls
 mpls te
 mpls rsvp-te
 mpls te cspf
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 192.168.1.2 255.255.255.0
 mpls
 mpls te
 mpls rsvp-te
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 192.168.10.1 255.255.255.0
 mpls
 mpls te
 mpls rsvp-te
#
interface LoopBack1
 ip address 2.2.2.2 255.255.255.255
#
ospf 1
 opaque-capability enable
 area 0.0.0.0
  network 2.2.2.2 0.0.0.0
  network 192.168.1.0 0.0.0.255
  network 192.168.10.0 0.0.0.255
  mpls-te enable
#
return</pre>
</li><li><p>DCI-PE2-GW2 configuration file</p>
<pre class="screen">#
sysname DCI-PE2-GW2
#
evpn vpn-instance evrf1 bd-mode
 route-distinguisher 10:1
 tnl-policy te-lsp1
 vpn-target 11:1 export-extcommunity
 vpn-target 11:1 import-extcommunity
#
ip vpn-instance vpn1
 ipv6-family
  route-distinguisher 11:11
<span>  apply-label per-instance</span>
  vpn-target 11:1 export-extcommunity evpn
  vpn-target 11:1 import-extcommunity evpn
  tnl-policy te-lsp1 evpn
  evpn mpls routing-enable
#
mpls lsr-id 3.3.3.3
#
mpls
 mpls te
 mpls rsvp-te
 mpls te cspf
#
bridge-domain 10
 evpn binding vpn-instance evrf1
#
interface Vbdif10
 ip binding vpn-instance vpn1
 ipv6 enable
 ipv6 address 2001:DB8:20::1/64
 ipv6 nd collect host enable
#
interface GigabitEthernet<span>0/1/0</span>.1 mode l2
 encapsulation dot1q vid 10
 rewrite pop single
 bridge-domain 10
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 192.168.10.2 255.255.255.0
 mpls
 mpls te
 mpls rsvp-te
#
interface LoopBack1
 ip address 3.3.3.3 255.255.255.255
#
interface Tunnel1
 ip address unnumbered interface LoopBack1
 tunnel-protocol mpls te
 destination 1.1.1.1
 mpls te tunnel-id 100
#
bgp 100
 peer 1.1.1.1 as-number 100
 peer 1.1.1.1 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 1.1.1.1 enable
 #
 ipv6-family vpn-instance vpn1
  import-route direct
  advertise l2vpn evpn
 #
 l2vpn-family evpn
  undo policy vpn-target
  peer 1.1.1.1 enable
  peer 1.1.1.1 advertise irbv6
#               
ospf 1
 opaque-capability enable
 area 0.0.0.0
  network 3.3.3.3 0.0.0.0
  network 192.168.10.0 0.0.0.255
  mpls-te enable
#
tunnel-policy te-lsp1
 tunnel select-seq cr-lsp load-balance-number 1
#
evpn source-address 3.3.3.3
#
return</pre>
</li><li><p>Device1 configuration file</p>
<p>See the configuration file of a DC device.</p>
</li><li><p>Device2 configuration file</p>
<p>See the configuration file of a DC device.</p>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0010.html">EVPN Configuration Examples
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_dci_cfg_0032.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0078.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>