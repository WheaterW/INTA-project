
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Associating E-VRRP with 4PE PW Redundancy">
<meta name="abstract" content="In 4PE PW redundancy scenarios, the mVRRP status determines the master/backup status of PEs.">
<meta name="description" content="In 4PE PW redundancy scenarios, the mVRRP status determines the master/backup status of PEs.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpws_cfg_3012.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpws_cfg_6017.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpws_cfg_6053.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="VPWS">
<meta name="featuretype" content="VPN">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="VPWS">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="VPWS">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="VPWS">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="l00415692">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00415692">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172369969">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>Example for Associating E-VRRP with 4PE PW Redundancy</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172369969"></a><a name="EN-US_TASK_0172369969"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Associating E-VRRP with 4PE PW Redundancy</h1>
<div class="taskbody"><p>In 4PE PW redundancy scenarios, the mVRRP status determines the master/backup status of PEs.</p>
<div class="context"><a name="EN-US_TASK_0172369969__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0172369969__fig_dc_vrp_vpws_cfg_601801">Figure 1</a>, PE1 and PE2 are connected over a bypass PW, and PE3 and PE4 are connected over another bypass PW. To allow communication between CEs and PEs in case a public network link or PE fails, associate E-VRRP with 4PE PW redundancy.</p>
<div class="fignone" id="EN-US_TASK_0172369969__fig_dc_vrp_vpws_cfg_601801"><a name="EN-US_TASK_0172369969__fig_dc_vrp_vpws_cfg_601801"></a><a name="fig_dc_vrp_vpws_cfg_601801"></a><span class="figcap"><b>Figure 1 </b>Associating E-VRRP with 4PE PW redundancy</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><div class="p"><ul><li>In this example, interfaces 1 through 4 represent GE<span>0/1/0</span>, GE<span>0/1/1</span>, GE<span>0/1/2</span>, and GE<span>0/1/3</span>, respectively.</li></ul>
</div>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_vpws_cfg_601801.png"></span><br><div class="p">
<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" frame="border" border="1" rules="all"><caption><b>Table 1 </b>Interfaces and IP addresses</caption><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="16.666666666666664%" id="mcps1.4.1.3.4.1.2.7.1.1" liSelected="liSelected"><p>Device</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="16.666666666666664%" id="mcps1.4.1.3.4.1.2.7.1.2" liSelected="liSelected"><p>Interface</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="16.666666666666664%" id="mcps1.4.1.3.4.1.2.7.1.3" liSelected="liSelected"><p>IP Address</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="16.666666666666664%" id="mcps1.4.1.3.4.1.2.7.1.4" liSelected="liSelected"><p>Device</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="16.666666666666664%" id="mcps1.4.1.3.4.1.2.7.1.5" liSelected="liSelected"><p>Interface</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="16.666666666666664%" id="mcps1.4.1.3.4.1.2.7.1.6" liSelected="liSelected"><p>IP Address</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" rowspan="2" valign="top" width="16.666666666666664%" headers="mcps1.4.1.3.4.1.2.7.1.1 "><p>CE1</p>
</td>
<td class="cellrowborder" valign="top" width="16.666666666666664%" headers="mcps1.4.1.3.4.1.2.7.1.2 "><p>GE <span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" width="16.666666666666664%" headers="mcps1.4.1.3.4.1.2.7.1.3 "><p>-</p>
</td>
<td class="cellrowborder" rowspan="2" valign="top" width="16.666666666666664%" headers="mcps1.4.1.3.4.1.2.7.1.4 "><p>CE2</p>
</td>
<td class="cellrowborder" valign="top" width="16.666666666666664%" headers="mcps1.4.1.3.4.1.2.7.1.5 "><p>GE <span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" width="16.666666666666664%" headers="mcps1.4.1.3.4.1.2.7.1.6 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.3.4.1.2.7.1.2 "><p>GE <span>0/1/1</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.3.4.1.2.7.1.3 "><p>-</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.3.4.1.2.7.1.5 "><p>GE <span>0/1/1</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.3.4.1.2.7.1.6 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="4" valign="top" width="16.666666666666664%" headers="mcps1.4.1.3.4.1.2.7.1.1 "><p>PE1</p>
</td>
<td class="cellrowborder" valign="top" width="16.666666666666664%" headers="mcps1.4.1.3.4.1.2.7.1.2 "><p>GE <span>0/1/0</span>.2</p>
</td>
<td class="cellrowborder" valign="top" width="16.666666666666664%" headers="mcps1.4.1.3.4.1.2.7.1.3 "><p>10.1.1.1/24</p>
</td>
<td class="cellrowborder" rowspan="4" valign="top" width="16.666666666666664%" headers="mcps1.4.1.3.4.1.2.7.1.4 "><p>PE2</p>
</td>
<td class="cellrowborder" valign="top" width="16.666666666666664%" headers="mcps1.4.1.3.4.1.2.7.1.5 "><p>GE <span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" width="16.666666666666664%" headers="mcps1.4.1.3.4.1.2.7.1.6 "><p>10.7.1.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.3.4.1.2.7.1.2 "><p>GE <span>0/1/1</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.3.4.1.2.7.1.3 "><p>10.4.1.1/24</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.3.4.1.2.7.1.5 "><p>GE <span>0/1/1</span>.2</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.3.4.1.2.7.1.6 "><p>10.1.1.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.3.4.1.2.7.1.2 "><p>GE <span>0/1/2</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.3.4.1.2.7.1.3 "><p>10.3.1.1/24</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.3.4.1.2.7.1.5 "><p>GE <span>0/1/2</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.3.4.1.2.7.1.6 "><p>10.3.1.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.3.4.1.2.7.1.2 "><p>GE <span>0/1/3</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.3.4.1.2.7.1.3 "><p>10.5.1.1/24</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.3.4.1.2.7.1.5 "><p>GE <span>0/1/3</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.3.4.1.2.7.1.6 "><p>10.6.1.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="4" valign="top" width="16.666666666666664%" headers="mcps1.4.1.3.4.1.2.7.1.1 "><p>PE3</p>
</td>
<td class="cellrowborder" valign="top" width="16.666666666666664%" headers="mcps1.4.1.3.4.1.2.7.1.2 "><p>GE <span>0/1/0</span>.2</p>
</td>
<td class="cellrowborder" valign="top" width="16.666666666666664%" headers="mcps1.4.1.3.4.1.2.7.1.3 "><p>10.2.1.1/24</p>
</td>
<td class="cellrowborder" rowspan="4" valign="top" width="16.666666666666664%" headers="mcps1.4.1.3.4.1.2.7.1.4 "><p>PE4</p>
</td>
<td class="cellrowborder" valign="top" width="16.666666666666664%" headers="mcps1.4.1.3.4.1.2.7.1.5 "><p>GE <span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" width="16.666666666666664%" headers="mcps1.4.1.3.4.1.2.7.1.6 "><p>10.7.1.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.3.4.1.2.7.1.2 "><p>GE <span>0/1/1</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.3.4.1.2.7.1.3 "><p>10.4.1.3/24</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.3.4.1.2.7.1.5 "><p>GE <span>0/1/1</span>.2</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.3.4.1.2.7.1.6 "><p>10.2.1.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.3.4.1.2.7.1.2 "><p>GE <span>0/1/2</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.3.4.1.2.7.1.3 "><p>10.8.1.3/24</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.3.4.1.2.7.1.5 "><p>GE <span>0/1/2</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.3.4.1.2.7.1.6 "><p>10.8.1.4/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.3.4.1.2.7.1.2 "><p>GE <span>0/1/3</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.3.4.1.2.7.1.3 "><p>10.6.1.3/24</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.3.4.1.2.7.1.5 "><p>GE <span>0/1/3</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.3.4.1.2.7.1.6 "><p>10.5.1.4/24</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172369969__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure IP addresses and a routing protocol and enable MPLS on the PEs.</p>
</li><li><p>Configure public network tunnels.</p>
</li><li><p>Configure service PWs.</p>
</li><li><p>Configure BFD for PW to detect PW connectivity.</p>
</li><li><p>Determine the VRRP master/backup status.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172369969__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>Interface numbers and types</p>
</li><li><p>PE's LSR IDs</p>
</li><li><p>L2VC's destination IP addresses, VC IDs, and VC types</p>
</li><li><p>BFD session name and local and remote BFD session discriminators</p>
</li><li><p>VRRP group ID and priority</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172369969__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Assign an IP address to each interface and configure a routing protocol.</span><p><p>Configure an IP address and mask for each involved interface according to <a href="#EN-US_TASK_0172369969__fig_dc_vrp_vpws_cfg_601801">Figure 1</a>. For detailed configurations, see Configuration Files.</p>
<p>IS-IS is used in this example. For detailed configurations, see <a href="#EN-US_TASK_0172369969__sec_dc_vrp_vpws_cfg_601801">Configuration Files</a>.</p>
</p></li><li><span>Configure public network tunnels.</span><ol type="a"><li class="substepexpand"><span>Enable MPLS, MPLS TE, and RSVP-TE globally on each node.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>mpls lsr-id 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls rsvp-te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls te cspf</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>mpls rsvp-te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>mpls rsvp-te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/2</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/2</span>] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/2</span>] <strong>mpls rsvp-te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet <span>0/1/3</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/3</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/3</span>] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/3</span>] <strong>mpls rsvp-te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/3</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<div class="p"><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The configurations of PE2, PE3, and PE4 are similar to that of PE1. For detailed configurations, see <a href="#EN-US_TASK_0172369969__sec_dc_vrp_vpws_cfg_601801">Configuration Files</a>.</p>
</div></div>
</div>
</p></li><li class="substepexpand"><span>Establish LDP LSPs and configure remote LDP sessions.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/2</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/2</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls ldp remote-peer 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp-remote-1.1.1.1] <strong>remote-ip 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp-remote-1.1.1.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<div class="p"><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The configurations of PE2, PE3, and PE4 are similar to that of PE1. For detailed configurations, see <a href="#EN-US_TASK_0172369969__sec_dc_vrp_vpws_cfg_601801">Configuration Files</a>.</p>
</div></div>
</div>
<p># Verify the configuration. Run the <a href="cmdqueryname=display+mpls+ldp+session"><b><span class="cmdname">display mpls ldp session</span></b></a> command on PE1 and PE2 to check whether the LDP session status is <strong>Operational</strong>. The following example uses the command output on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display mpls ldp session</strong></pre>
<pre class="screen"> LDP Session(s) in Public Network
 Codes: LAM(Label Advertisement Mode), SsnAge Unit(DDDD:HH:MM)
<span> An asterisk (*) before a session means the session is being deleted.</span>
 ------------------------------------------------------------------------------
 PeerID             Status      LAM  SsnRole  SsnAge      KASent/Rcv
 ------------------------------------------------------------------------------
 3.3.3.3:0          <strong>Operational</strong> DU   Passive  0000:00:46  187/187
 ------------------------------------------------------------------------------
 TOTAL: 1 session(s) Found.   </pre>
</p></li></ol>
</li><li><span>Configure PWE3.</span><ol type="a"><li class="substepexpand"><span>Create PW templates.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>tunnel-policy 4pe2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-tunnel-policy-4pe2] <strong>tunnel select-seq te load-balance-number 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-tunnel-policy-4pe2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>tunnel-policy 4pe3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-tunnel-policy-4pe3] <strong>tunnel select-seq te load-balance-number 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-tunnel-policy-4pe3] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>tunnel-policy 4pe4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-tunnel-policy-4pe4] <strong>tunnel select-seq te load-balance-number 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-tunnel-policy-4pe4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>pw-template 4pe2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-pw-template-4pe2] <strong>peer-address 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-pw-template-4pe2] <strong>control-word</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-pw-template-4pe2] <strong>tnl-policy 4pe2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-pw-template-4pe2] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-pw-template-4pe2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>pw-template 4pe3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-pw-template-4pe3] <strong>peer-address 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-pw-template-4pe3] <strong>control-word</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-pw-template-4pe3] <strong>tnl-policy 4pe3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-pw-template-4pe3] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-pw-template-4pe3] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>pw-template 4pe4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-pw-template-4pe4] <strong>peer-address 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-pw-template-4pe4] <strong>control-word</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-pw-template-4pe4] <strong>tnl-policy 4pe4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-pw-template-4pe4] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-pw-template-4pe4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The configurations of PE2, PE3, and PE4 are similar to that of PE1. For detailed configurations, see <a href="#EN-US_TASK_0172369969__sec_dc_vrp_vpws_cfg_601801">Configuration Files</a>.</p>
</div></div>
</p></li><li class="substepexpand"><span>Create VCs.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong><strong>interface gigabitethernet <span>0/1/0</span>.1</strong></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1] <strong>vlan-type dot1q 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1] <strong>mpls l2vc pw-template 4pe3 300</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1] <strong>mpls l2vc pw-template 4pe4 400 secondary</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1] <strong>mpls l2vpn redundancy independent</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1] <strong>mpls l2vc pw-template 4pe2 ac-bypass 200 pw-bypass 500</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1] <strong>mpls l2vpn stream-dual-receiving</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The configurations of PE2, PE3, and PE4 are similar to that of PE1. For detailed configurations, see <a href="#EN-US_TASK_0172369969__sec_dc_vrp_vpws_cfg_601801">Configuration Files</a>.</p>
</div></div>
</p></li></ol>
</li><li><span>Configure BFD for ACs.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bfd</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bfd] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>bfd link1 bind peer-ip 10.1.1.3 interface gigabitethernet <span>0/1/0</span>.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bfd-lsp-session-link1] <strong>discriminator local 15</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bfd-lsp-session-link1] <strong>discriminator remote 51</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bfd-lsp-session-link1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bfd-lsp-session-link1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>bfd peer bind peer-ip 10.1.1.2 interface gigabitethernet <span>0/1/0</span>.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bfd-lsp-session-peer] <strong>discriminator local 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bfd-lsp-session-peer] <strong>discriminator remote 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bfd-lsp-session-peer] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bfd-lsp-session-peer] <strong>quit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The configurations of PE2, PE3, and PE4 are similar to that of PE1. For detailed configurations, see <a href="#EN-US_TASK_0172369969__sec_dc_vrp_vpws_cfg_601801">Configuration Files</a>.</p>
</div></div>
</p></li><li><span>Determine the VRRP master/backup status.</span><ol type="a"><li class="substepexpand"><span>Configure mVRRP to determine the master/backup status of the PEs.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface gigabitethernet <span>0/1/0</span>.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.2] <strong>vlan-type dot1q 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.2] <strong>ip address 10.1.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.2] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.2] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.2] <strong>vrrp vrid 1 virtual-ip 10.1.1.254</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.2] <strong>vrrp vrid 1 priority 120</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.2] <strong>admin-vrrp vrid 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Verify the configuration. Run the <a href="cmdqueryname=display+vrrp"><b><span class="cmdname">display vrrp</span></b></a> command on PE1 and PE2 to check the master/backup status of them. The following example uses the command output on PE1. As PE1 has the VRRP priority of 120 and PE2 has the default VRRP priority of 100, the VRRP status of PE1 is <strong>Master</strong>.</p>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>display vrrp</strong></pre>
<pre class="screen">  GigabitEthernet<span>0/1/1</span> | Virtual Router 1
    State           : <strong>Master</strong>
    Virtual IP      : 10.1.1.254
    Master IP       : 10.1.1.1
    Local IP        : 10.1.1.1
    PriorityRun     : 120
    PriorityConfig  : 120
    MasterPriority  : 120
    Preempt         : YES           Delay Time : 0
    Hold Multiplier : 3
    TimerRun        : 1
    TimerConfig     : 1
    Auth Type       : NONE
    Virtual Mac     :  00e0-fc00-1234
    Check TTL       : YES
    Config type     : admin-vrrp
    Config track link-bfd down-number : 0
    Create time      : 2011-04-21 11:23:10
    Last change time : 0000-00-00 00:00:00</pre>
</p></li><li class="substepexpand"><span>Bind the service PWs to the mVRRP group.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface gigabitethernet <span>0/1/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/0</span>.1] <strong>mpls l2vc track admin-vrrp interface gigabitethernet <span>0/1/0</span>.2 vrid 1 pw-redundancy</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1] <strong>mpls l2vc track admin-vrrp secondary</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The configurations of PE2, PE3, and PE4 are similar to that of PE1. For detailed configurations, see <a href="#EN-US_TASK_0172369969__sec_dc_vrp_vpws_cfg_601801">Configuration Files</a>.</p>
</div></div>
</p></li></ol>
</li><li><span>Verify the configuration.</span><ol type="a"><li class="substepexpand"><span>Ping the virtual IP address of a service VRRP group from CE1.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>ping 10.2.1.254</strong></pre>
<pre class="screen">PING 10.2.1.254: 56  data bytes, press CTRL_C to break
    Reply from 10.2.1.254: bytes=56 Sequence=1 ttl=255 time=40 ms
    Reply from 10.2.1.254: bytes=56 Sequence=2 ttl=255 time=30 ms
    Reply from 10.2.1.254: bytes=56 Sequence=3 ttl=255 time=40 ms
    Reply from 10.2.1.254: bytes=56 Sequence=4 ttl=255 time=1 ms
    Reply from 10.2.1.254: bytes=56 Sequence=5 ttl=255 time=1 ms

  --- 10.2.1.254 ping statistics ---
    5 packet(s) transmitted
    5 packet(s) received
    0.00% packet loss
    round-trip min/avg/max = 1/22/40 ms  </pre>
</p></li><li class="substepexpand"><span>Simulate an interface fault and an interface fault recovery.</span><p><p># Disable GE <span>0/1/0</span> on PE1 to simulate an AC interface fault.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>This step is used only to verify the configuration. Do not do this in practice.</p>
</div></div>
<p>As the primary AC interface fails, the upstream traffic is transmitted along the path CE1 -&gt; PE2 -&gt; PE3 -&gt; CE2. Run the <strong>display mpls l2vc track admin-vrrp</strong> command on PE1. The command output shows that the VRRP status is <strong>Initialize</strong>.</p>
<p>[<span class="keyword">~</span>PE1] <strong>display mpls l2vc track admin-vrrp</strong></p>
<pre class="screen">Interface: GigabitEthernet<span>0/1/0</span>.2, admin-vrrp vrid: 1, state: <strong>Initialize</strong>
  PW Number : 2
 *Client Interface     : GigabitEtherne<span>0/1/0</span>.1
  VC State             : up
  VC ID                : 300
  VC Type              : VLAN
  Link State           : up

 *Client Interface     : GigabitEthernet<span>0/1/0</span>.1
  VC State             : up
  VC ID                : 400
  VC Type              : VLAN
  Link State           : down</pre>
</p></li></ol>
</li></ol></div>
<div class="example" id="EN-US_TASK_0172369969__sec_dc_vrp_vpws_cfg_601801"><a name="EN-US_TASK_0172369969__sec_dc_vrp_vpws_cfg_601801"></a><a name="sec_dc_vrp_vpws_cfg_601801"></a><a name="EN-US_TASK_0172369969__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>CE1 configuration file</p>
<pre class="screen">#
 sysname CE1
#
bfd
#
interface Vlanif2
 ip address 10.1.1.3 255.255.255.0
#
interface GigabitEthernet<span>0/1/0</span>
 portswitch
 undo shutdown
 port trunk allow-pass vlan 2
#
interface GigabitEthernet<span>0/1/1</span>
 portswitch
 undo shutdown
 port trunk allow-pass vlan 2
#
bfd link1 bind peer-ip 10.1.1.1 interface Vlanif2
 discriminator local 51
 discriminator remote 15
bfd link2 bind peer-ip 10.1.1.2 interface Vlanif2
 discriminator local 52
 discriminator remote 25
#
return                       </pre>
</li><li><p>CE2 configuration file</p>
<pre class="screen">#
 sysname CE2
#
bfd
#
interface Vlanif2
 ip address 10.2.1.3 255.255.255.0
#
interface GigabitEthernet<span>0/1/0</span>
 portswitch
 undo shutdown
 port trunk allow-pass vlan 2
#
interface GigabitEthernet<span>0/1/1</span>
 portswitch
 undo shutdown
 port trunk allow-pass vlan 2
#
bfd link1 bind peer-ip 10.2.1.1 interface Vlanif2
 discriminator local 61
 discriminator remote 16
bfd link2 bind peer-ip 10.2.1.2 interface Vlanif2
 discriminator local 62
 discriminator remote 26
#
return                       </pre>
</li><li><p>PE1 configuration file</p>
<pre class="screen">#                                                                               
sysname PE1                                                                    
#                                                                               
bfd                                                                            
#                                                                               
mpls lsr-id 1.1.1.1 
#                                                           
mpls                                                                           
 mpls te                                                                       
 mpls rsvp-te                                                                  
 mpls te cspf                                                                  
#                                                                               
mpls l2vpn                                                                     
#
pw-template 4pe2
 peer-address 2.2.2.2 
 control-word 
 tnl-policy 4pe2
#
pw-template 4pe3
 peer-address 3.3.3.3 
 control-word 
 tnl-policy 4pe3
#
pw-template 4pe4
 peer-address 4.4.4.4 
 control-word 
 tnl-policy 4pe4
#
mpls ldp                                                                        
#                                                                               
mpls ldp remote-peer 1.1.1.1                                                   
 remote-ip 2.2.2.2
#                                                                               
isis 1
 is-level level-1
 cost-style wide
 network-entity 00.0008.0000.0001.00
 traffic-eng level-1
#
interface LoopBack0
 ip address 1.1.1.1 255.255.255.255
 isis enable 1
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ip address 10.3.1.1 255.255.255.0
 isis enable 1
 mpls
 mpls te
 mpls rsvp-te
 mpls ldp
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 10.4.1.1 255.255.255.0
 isis enable 1
 mpls
 mpls te
 mpls rsvp-te
 mpls ldp
#
interface GigabitEthernet<span>0/1/3</span>
 undo shutdown
 ip address 10.5.1.1 255.255.255.0
 isis enable 1
 mpls
 mpls te
 mpls rsvp-te
 mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
#
bfd link1 bind peer-ip 10.1.1.3 interface GigabitEthernet<span>0/1/0</span>.2
 discriminator local 15
 discriminator remote 51
#
bfd peer bind peer-ip 10.1.1.2 interface GigabitEthernet<span>0/1/0</span>.2
 discriminator local 1
 discriminator remote 2
#
interface GigabitEthernet<span>0/1/0</span>.2
 vlan-type dot1q 2
 ip address 10.1.1.1 255.255.255.0
 vrrp vrid 1 virtual-ip 10.1.1.254
 admin-vrrp vrid 1
 vrrp vrid 1 priority 120
#
interface GigabitEthernet<span>0/1/0</span>.1
 vlan-type dot1q 1
 mpls l2vc pw-template 4pe3 300
 mpls l2vc track admin-vrrp interface Gigabitethernet<span>0/1/0</span>.2 vrid 1 pw-redundancy
 mpls l2vc pw-template 4pe4 400 secondary
 mpls l2vc track admin-vrrp secondary
 mpls l2vpn redundancy independent
 mpls l2vc pw-template 4pe2 ac-bypass 200 pw-bypass 500
 mpls l2vpn stream-dual-receiving
#
tunnel-policy 4pe2
 tunnel select-seq te load-balance-number 1
#
tunnel-policy 4pe3
 tunnel select-seq te load-balance-number 1
#
tunnel-policy 4pe4
 tunnel select-seq te load-balance-number 1
#
return                                                                          
</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#                                                                               
sysname PE2                                                                   
#                                                                               
bfd                                                                            
#                                                                               
mpls lsr-id 2.2.2.2
#                                                           
mpls                                                                           
 mpls te                                                                       
 mpls rsvp-te                                                                  
 mpls te cspf                                                                  
#                                                                               
mpls l2vpn                                                                     
#
pw-template 4pe1
 peer-address 1.1.1.1 
 control-word 
 tnl-policy 4pe1
#
pw-template 4pe3
 peer-address 3.3.3.3 
 control-word 
 tnl-policy 4pe3 
#
pw-template 4pe4
 peer-address 4.4.4.4 
 control-word 
 tnl-policy 4pe4
#
mpls ldp
#
isis 1
 is-level level-1
 cost-style wide
 network-entity 00.0008.0000.0002.00
 traffic-eng level-1
#
interface LoopBack0
 ip address 2.2.2.2 255.255.255.255
 isis enable 1
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ip address 10.3.1.2 255.255.255.0
 isis enable 1
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/3</span>
 undo shutdown
 ip address 10.6.1.2 255.255.255.0
 isis enable 1
 mpls
 mpls te
 mpls rsvp-te
 mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.7.1.2 255.255.255.0
 isis enable 1
 mpls
 mpls te
 mpls rsvp-te
 mpls ldp
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
#
bfd link2 bind peer-ip 10.1.1.3 interface GigabitEthernet<span>0/1/1</span>.2
 discriminator local 25
 discriminator remote 52
#
bfd peer bind peer-ip 10.1.1.1 interface GigabitEthernet<span>0/1/1</span>.2
 discriminator local 2
 discriminator remote 1
#
interface GigabitEthernet<span>0/1/1</span>.1
 vlan-type dot1q 1
 mpls l2vc pw-template 4pe3 600
 mpls l2vc track admin-vrrp interface Gigabitethernet<span>0/1/1</span>.2 vrid 1 pw-redundancy
 mpls l2vc pw-template 4pe4 700 secondary
 mpls l2vc track admin-vrrp secondary
 mpls l2vpn redundancy independent
 mpls l2vc pw-template 4pe1 ac-bypass 500 pw-bypass 200
 mpls l2vpn stream-dual-receiving
#
interface GigabitEthernet<span>0/1/1</span>.2
 vlan-type dot1q 2
 ip address 10.1.1.2 255.255.255.0
 vrrp vrid 1 virtual-ip 10.1.1.254
 admin-vrrp vrid 1
#
tunnel-policy 4pe1
 tunnel select-seq te load-balance-number 1
#
tunnel-policy 4pe3
 tunnel select-seq te load-balance-number 1
#
tunnel-policy 4pe4
 tunnel select-seq te load-balance-number 1
#
return
</pre>
</li><li><p>PE3 configuration file</p>
<pre class="screen">#                                                                               
sysname PE3                                                                   
#                                                                               
bfd                                                                            
#                                                                               
mpls lsr-id 3.3.3.3
#                                                            
mpls                                                                           
 mpls te                                                                       
 mpls rsvp-te    
 mpls rsvp-te hello
 mpls te cspf                                                                  
#                                                                               
mpls l2vpn                                                                     
#
pw-template 4pe1  
 peer-address 1.1.1.1 
 control-word 
 tnl-policy 4pe1 
#
pw-template 4pe2  
 peer-address 2.2.2.2 
 control-word 
 tnl-policy 4pe2 
#
pw-template 4pe4  
 peer-address 4.4.4.4 
 control-word 
 tnl-policy 4pe4 
#                                                                               
mpls ldp                                                                        
#                                                                               
isis 1
 is-level level-1
 cost-style wide
 network-entity 00.0008.0000.0003.00
 traffic-eng level-1
#
interface LoopBack0
 ip address 3.3.3.3 255.255.255.255
 isis enable 1
#
interface GigabitEthernet<span>0/1/3</span>
 undo shutdown
 ip address 10.6.1.3 255.255.255.0
 isis enable 1
 mpls
 mpls te
 mpls rsvp-te
 mpls rsvp-te hello
 mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 10.4.1.3 255.255.255.0
 isis enable 1
 mpls
 mpls te
 mpls rsvp-te
 mpls rsvp-te hello
 mpls ldp
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ip address 10.8.1.3 255.255.255.0
 isis enable 1
 mpls
 mpls ldp
#
bfd link1 bind peer-ip 10.2.1.3 interface GigabitEthernet<span>0/1/0</span>.2
 discriminator local 16
 discriminator remote 61
#
bfd peer bind peer-ip 10.2.1.2 interface GigabitEthernet<span>0/1/0</span>.2
 discriminator local 26
 discriminator remote 62
#
interface GigabitEthernet<span>0/1/0</span>.1
 vlan-type dot1q 1
 mpls l2vc pw-template 4pe1 300
 mpls l2vc track admin-vrrp interface Gigabitethernet<span>0/1/0</span>.2 vrid 1 pw-redundancy
 mpls l2vc pw-template 4pe2 600 secondary
 mpls l2vc track admin-vrrp secondary
 mpls l2vpn redundancy independent
 mpls l2vc pw-template 4pe4 ac-bypass 200 pw-bypass 500
 mpls l2vpn stream-dual-receiving
#
interface GigabitEthernet<span>0/1/0</span>.2
 vlan-type dot1q 2
 ip address 10.2.1.1 255.255.255.0
 vrrp vrid 1 virtual-ip 10.2.1.254
 admin-vrrp vrid 1
 vrrp vrid 1 priority 120
#
tunnel-policy 4pe1
 tunnel select-seq te  load-balance-number 1
#
tunnel-policy 4pe2
 tunnel select-seq te load-balance-number 1
#
tunnel-policy 4pe4
 tunnel select-seq te load-balance-number 1
#
return
</pre>
</li><li><p>PE4 configuration file</p>
<pre class="screen">#                                                                               
sysname PE4                                                                   
#                                                                               
bfd                                                                            
#                                                                               
mpls lsr-id 4.4.4.4
#
mpls
 mpls te
 mpls rsvp-te
 mpls rsvp-te hello
 mpls te cspf
#
mpls l2vpn
#
pw-template 4pe1  
 peer-address 1.1.1.1 
 control-word 
 tnl-policy 4pe1 
#
pw-template 4pe2  
 peer-address 2.2.2.2 
 control-word 
 tnl-policy 4pe2 
#
pw-template 4pe3  
 peer-address 3.3.3.3 
 control-word 
 tnl-policy 4pe3 
#
mpls ldp
 #
 ipv4-family
#
e-trunk 1
 peer-address 3.3.3.3 source-address 4.4.4.4
 timer revert delay 10
#
isis 1
 is-level level-1
 cost-style wide
 network-entity 00.0008.0000.0004.00
 traffic-eng level-1
#
interface Eth-Trunk1
 mode lacp-static
 e-trunk 1
#
interface LoopBack0
 ip address 4.4.4.4 255.255.255.255
 isis enable 1
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.7.1.4 255.255.255.0
 isis enable 1
 mpls
 mpls te
 mpls rsvp-te
 mpls rsvp-te hello
 mpls ldp
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ip address 10.8.1.4 255.255.255.0
 isis enable 1
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/3</span>
 undo shutdown
 ip address 10.5.1.4 255.255.255.0
 isis enable 1
 mpls
 mpls te
 mpls rsvp-te
 mpls rsvp-te hello
 mpls ldp
#
bfd link2 bind peer-ip 10.2.1.3 interface GigabitEthernet<span>0/1/1</span>.2
 discriminator local 61
 discriminator remote 16
#
bfd peer bind peer-ip 10.2.1.1 interface GigabitEthernet<span>0/1/1</span>.2
 discriminator local 62
 discriminator remote 26
#
interface GigabitEthernet<span>0/1/1</span>.1
 vlan-type dot1q 1
 mpls l2vc pw-template 4pe2 700 
 mpls l2vc track admin-vrrp interface Gigabitethernet<span>0/1/1</span>.2 vrid 1 pw-redundancy
 mpls l2vc pw-template 4pe1 400 secondary
 mpls l2vc track admin-vrrp secondary
 mpls l2vpn redundancy independent
 mpls l2vc pw-template 4pe3 ac-bypass 500 pw-bypass 200
 mpls l2vpn stream-dual-receiving
#
interface GigabitEthernet<span>0/1/1</span>.2
 vlan-type dot1q 2
 ip address 10.2.1.2 255.255.255.0
 vrrp vrid 1 virtual-ip 10.2.1.254
 admin-vrrp vrid 1
#
tunnel-policy 4pe1
 tunnel select-seq te load-balance-number 1
#
tunnel-policy 4pe2
 tunnel select-seq te load-balance-number 1
#
tunnel-policy 4pe3
 tunnel select-seq te load-balance-number 1
#
return
</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpws_cfg_3012.html">Configuration Examples for VPWS
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpws_cfg_6017.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpws_cfg_6053.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>