
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring the IPv6 NFVI Distributed Gateway Function (Segmented SR Tunnels)">
<meta name="abstract" content="This section provides an example for configuring the IPv6 NFVI distributed gateway function to carry service traffic over segmented SR tunnels.">
<meta name="description" content="This section provides an example for configuring the IPv6 NFVI distributed gateway function to carry service traffic over segmented SR tunnels.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0010.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0127.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0138.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="p00915595,w00800033,w00556928,l00468467,w00606909,evpnvrp,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="p00915595">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00878323">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172370676">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>Example for Configuring the IPv6 NFVI Distributed Gateway Function (Segmented SR Tunnels)</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172370676"></a><a name="EN-US_TASK_0172370676"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring the IPv6 NFVI Distributed Gateway Function (Segmented SR Tunnels)</h1>
<div class="taskbody"><p>This section provides an example for configuring the IPv6 NFVI distributed gateway function to carry service traffic over segmented SR tunnels.</p>
<div class="context"><a name="EN-US_TASK_0172370676__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>The NFVI telco cloud solution uses the DCI + DCN networking. A large amount of IPv6 UE traffic is sent to vUGWs and vMSEs on the DCN. After being processed by the vUGWs and vMSEs, the UE traffic is forwarded over the DCN to destination devices on the Internet. The destination devices send traffic to UEs in similar ways. To achieve these functions and ensure traffic load balancing on the DCN, you need to deploy the NFVI distributed gateway function.</p>
<p><a href="#EN-US_TASK_0172370676__fig_01">Figure 1</a> shows NFVI distributed gateway networking (segmented SR tunnels). DC GWs, which are the border gateways of the DCN, exchange Internet routes with external devices through PEs. L2GW/L3GW1 and L2GW/L3GW2 are connected to VNFs. VNF1 and VNF2 that function as virtualized NEs are deployed to implement the vUGW and vMSE functions, respectively. VNF1 and VNF2 each connect to L2GW/L3GW1 and L2GW/L3GW2 through IPUs. SR tunnels are established between PEs and DC GWs and between DC GWs and L2GWs/L3GWs to carry IPv6 service traffic.</p>
<div class="fignone" id="EN-US_TASK_0172370676__fig_01"><a name="EN-US_TASK_0172370676__fig_01"></a><a name="fig_01"></a><span class="figcap"><b>Figure 1 </b>Configuring the IPv6 NFVI distributed gateway function (segmented SR tunnels)</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 through 6 in this example represent GigabitEthernet<span>0/1/1</span>, GigabitEthernet<span>0/1/2</span>, GigabitEthernet<span>0/1/3</span>, GigabitEthernet<span>0/1/4</span>, GigabitEthernet<span>0/1/5</span>, and GigabitEthernet<span>0/1/6</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_evpn_cfg_012701.png" width="NaN" height="NaN"></span><br></div>

<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" frame="border" border="1" rules="all"><caption><b>Table 1 </b>IP address planning</caption><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="12.62126212621262%" id="mcps1.4.1.5.2.4.1.1" liSelected="liSelected"><p>Device</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="43.85438543854385%" id="mcps1.4.1.5.2.4.1.2" liSelected="liSelected"><p>Interface</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="43.52435243524352%" id="mcps1.4.1.5.2.4.1.3" liSelected="liSelected"><p>IP Address</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" rowspan="4" valign="top" width="12.62126212621262%" headers="mcps1.4.1.5.2.4.1.1 "><p>PE1</p>
</td>
<td class="cellrowborder" valign="top" width="43.85438543854385%" headers="mcps1.4.1.5.2.4.1.2 "><p>GigabitEthernet <span>0/1/1</span></p>
</td>
<td class="cellrowborder" valign="top" width="43.52435243524352%" headers="mcps1.4.1.5.2.4.1.3 "><p>10.6.7.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.2 "><p>GigabitEthernet <span>0/1/2</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.3 "><p>10.6.5.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.2 "><p>GigabitEthernet<span>0/1/3</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.3 "><p>2001:DB8:7::1/64</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.2 "><p>LoopBack1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.3 "><p>7.7.7.7</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="4" valign="top" width="12.62126212621262%" headers="mcps1.4.1.5.2.4.1.1 "><p>PE2</p>
</td>
<td class="cellrowborder" valign="top" width="43.85438543854385%" headers="mcps1.4.1.5.2.4.1.2 "><p>GigabitEthernet <span>0/1/1</span></p>
</td>
<td class="cellrowborder" valign="top" width="43.52435243524352%" headers="mcps1.4.1.5.2.4.1.3 "><p>10.6.7.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.2 "><p>GigabitEthernet <span>0/1/2</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.3 "><p>10.6.6.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.2 "><p>GigabitEthernet<span>0/1/3</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.3 "><p>2001:DB8:8::1/64</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.2 "><p>LoopBack1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.3 "><p>8.8.8.8</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="5" valign="top" width="12.62126212621262%" headers="mcps1.4.1.5.2.4.1.1 "><p>DCGW1</p>
</td>
<td class="cellrowborder" valign="top" width="43.85438543854385%" headers="mcps1.4.1.5.2.4.1.2 "><p>GigabitEthernet <span>0/1/1</span></p>
</td>
<td class="cellrowborder" valign="top" width="43.52435243524352%" headers="mcps1.4.1.5.2.4.1.3 "><p>10.6.1.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.2 "><p>GigabitEthernet <span>0/1/2</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.3 "><p>10.6.2.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.2 "><p>GigabitEthernet<span>0/1/3</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.3 "><p>10.6.5.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.2 "><p>LoopBack1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.3 "><p>3.3.3.3/32</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.2 "><p>LoopBack2</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.3 "><p>2001:DB8:33::33/128</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="5" valign="top" width="12.62126212621262%" headers="mcps1.4.1.5.2.4.1.1 "><p>DCGW2</p>
</td>
<td class="cellrowborder" valign="top" width="43.85438543854385%" headers="mcps1.4.1.5.2.4.1.2 "><p>GigabitEthernet <span>0/1/1</span></p>
</td>
<td class="cellrowborder" valign="top" width="43.52435243524352%" headers="mcps1.4.1.5.2.4.1.3 "><p>10.6.1.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.2 "><p>GigabitEthernet <span>0/1/2</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.3 "><p>10.6.3.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.2 "><p>GigabitEthernet<span>0/1/3</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.3 "><p>10.6.6.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.2 "><p>LoopBack1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.3 "><p>4.4.4.4/32</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.2 "><p>LoopBack2</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.3 "><p>2001:DB8:44::44/32</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="7" valign="top" width="12.62126212621262%" headers="mcps1.4.1.5.2.4.1.1 "><p>L2GW/L3GW1</p>
</td>
<td class="cellrowborder" valign="top" width="43.85438543854385%" headers="mcps1.4.1.5.2.4.1.2 "><p>GigabitEthernet <span>0/1/1</span></p>
</td>
<td class="cellrowborder" valign="top" width="43.52435243524352%" headers="mcps1.4.1.5.2.4.1.3 "><p>10.6.4.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.2 "><p>GigabitEthernet <span>0/1/2</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.3 "><p>10.6.2.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.2 "><p>GigabitEthernet<span>0/1/3</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.3 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.2 "><p>GigabitEthernet<span>0/1/4</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.3 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.2 "><p>GigabitEthernet<span>0/1/5</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.3 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.2 "><p>GigabitEthernet<span>0/1/6</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.3 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.2 "><p>LoopBack1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.3 "><p>1.1.1.1/32</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="7" valign="top" width="12.62126212621262%" headers="mcps1.4.1.5.2.4.1.1 "><p>L2GW/L3GW2</p>
</td>
<td class="cellrowborder" valign="top" width="43.85438543854385%" headers="mcps1.4.1.5.2.4.1.2 "><p>GigabitEthernet <span>0/1/1</span></p>
</td>
<td class="cellrowborder" valign="top" width="43.52435243524352%" headers="mcps1.4.1.5.2.4.1.3 "><p>10.6.4.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.2 "><p>GigabitEthernet <span>0/1/2</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.3 "><p>10.6.3.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.2 "><p>GigabitEthernet<span>0/1/3</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.3 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.2 "><p>GigabitEthernet<span>0/1/4</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.3 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.2 "><p>GigabitEthernet<span>0/1/5</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.3 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.2 "><p>GigabitEthernet<span>0/1/6</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.3 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.2 "><p>LoopBack1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.3 "><p>2.2.2.2/32</p>
</td>
</tr>
</tbody>
</table>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172370676__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li>Configure a routing protocol between PEs, DC GWs, and L2GWs/L3GWs to ensure Layer 3 connectivity within each AS.</li><li>Establish EBGP peer relationships between PEs and DC GWs and IBGP peer relationships between DC GWs and L2GWs/L3GWs.</li><li>Configure SR-MPLS TE tunnels between PEs and DC GWs and between DC GWs and L2GWs/L3GWs.</li><li>Configure EVPN instances on DC GWs and L2GWs/L3GWs and bind BDs to these EVPN instances.</li><li>Configure L3VPN instances on DC GWs and L2GWs/L3GWs and bind VBDIF interfaces to these L3VPN instances.</li><li>Configure a tunnel policy on PEs, DC GWs, and L2GWs/L3GWs.</li><li>Configure BGP EVPN on DC GWs and L2GWs/L3GWs.</li><li>Configure BGP VPNv6 on DC GWs and PEs.</li><li>Configure Layer 2 sub-interfaces on DC GWs and L2GWs/L3GWs and configure the static VPN routes destined for VNFs on L2GWs/L3GWs.</li><li>Configure L2GWs/L3GWs to import static VPN routes through BGP EVPN. Configure and apply a route-policy for L3VPN instances so that the static VPN routes can retain the original next hops.</li><li>Configure static default VPN routes and loopback addresses on DC GWs. The loopback addresses are used to establish BGP VPN peer relationships with VNFs. Configure and apply a route-policy for L3VPN instances so that DC GWs can advertise static default VPN routes and VPN loopback routes only through BGP EVPN.</li><li>Establish BGP VPN peer relationships between DC GWs and VNFs.</li><li>Configure load balancing on PEs, DC GWs, and L2GWs/L3GWs.</li></ol>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172370676__1.4.3"></a><a name="1.4.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure IP addresses for all interfaces, including loopback interfaces, on PEs, DC GWs, and L2GWs/L3GWs.</span><p><p>For detailed configurations, see <a href="#EN-US_TASK_0172370676__dc_vrp_evpn_cfg_012801">Configuration Files</a>.</p>
</p></li><li><span>Configure a routing protocol between PEs, DC GWs, and L2GWs/L3GWs to ensure Layer 3 connectivity within each AS.</span><p><p>For detailed configurations, see <a href="#EN-US_TASK_0172370676__dc_vrp_evpn_cfg_012801">Configuration Files</a>.</p>
</p></li><li><span>Establish EBGP peer relationships between PEs and DC GWs and IBGP peer relationships between DC GWs and L2GWs/L3GWs.</span><p><p>For detailed configurations, see <a href="#EN-US_TASK_0172370676__dc_vrp_evpn_cfg_012801">Configuration Files</a>.</p>
</p></li><li><span>Configure SR-MPLS TE tunnels between PEs and L2GWs/L3GWs and between DC GWs and L2GWs/L3GWs.</span><p><p>For detailed configurations, see <a href="#EN-US_TASK_0172370676__dc_vrp_evpn_cfg_012801">Configuration Files</a>.</p>
</p></li><li><span>Configure EVPN instances on DC GWs and L2GWs/L3GWs and bind BDs to these EVPN instances.</span><p><p># Configure DC-GW1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DCGW1] <strong>evpn vpn-instance evrf1 bd-mode</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-evpn-instance-evrf1] <strong>route-distinguisher 1:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-evpn-instance-evrf1] <strong>vpn-target 1:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-evpn-instance-evrf1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1] <strong>evpn vpn-instance evrf2 bd-mode</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-evpn-instance-evrf2] <strong>route-distinguisher 2:2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-evpn-instance-evrf2] <strong>vpn-target 2:2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-evpn-instance-evrf2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1] <strong>evpn vpn-instance evrf3 bd-mode</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-evpn-instance-evrf3] <strong>route-distinguisher 3:3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-evpn-instance-evrf3] <strong>vpn-target 3:3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-evpn-instance-evrf3] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1] <strong>evpn vpn-instance evrf4 bd-mode</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-evpn-instance-evrf4] <strong>route-distinguisher 4:4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-evpn-instance-evrf4] <strong>vpn-target 4:4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-evpn-instance-evrf4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1] <strong>bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-bd10] <strong>evpn binding vpn-instance evrf1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-bd10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1] <strong>bridge-domain 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-bd20] <strong>evpn binding vpn-instance evrf2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-bd20] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1] <strong>bridge-domain 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-bd30] <strong>evpn binding vpn-instance evrf3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-bd30] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1] <strong>bridge-domain 40</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-bd40] <strong>evpn binding vpn-instance evrf4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-bd40] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1] <strong>commit</strong></pre>
<p>The configurations of DC-GW2 and L2GWs/L3GWs are similar to that of DC-GW1. For detailed configurations, see <a href="#EN-US_TASK_0172370676__dc_vrp_evpn_cfg_012801">Configuration Files</a>.</p>
</p></li><li><span>Configure L3VPN instances on DC GWs and L2GWs/L3GWs.</span><p><p># Configure DC-GW1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DCGW1] <strong>ip vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-vpn-instance-vpn1] <strong>ipv6-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-vpn-instance-vpn1-af-ipv6] <strong>route-distinguisher 33:33</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-vpn-instance-vpn1-af-ipv6] <strong>vpn-target 11:1 evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-vpn-instance-vpn1-af-ipv6] <strong>evpn mpls routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-vpn-instance-vpn1-af-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-vpn-instance-vpn1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1] <strong>interface vbdif10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-Vbdif10] <strong>ip binding vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-Vbdif10] <strong>ipv6 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-Vbdif10] <strong>ipv6 address 2001:db8:1::1 64</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-Vbdif10] <strong>ipv6 nd generate-rd-table enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-Vbdif10] <strong>anycast-gateway enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-Vbdif10] <strong>mac-address 00e0-fc00-0003</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-Vbdif10] <strong>ipv6 nd dad attempts 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-Vbdif10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1] <strong>interface vbdif20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-Vbdif20] <strong>ip binding vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-Vbdif20] <strong>ipv6 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-Vbdif20] <strong>ipv6 address 2001:db8:2::1 64</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-Vbdif20] <strong>ipv6 nd generate-rd-table enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-Vbdif20] <strong>anycast-gateway enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-Vbdif20] <strong>mac-address 00e0-fc00-0004</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-Vbdif20] <strong>ipv6 nd dad attempts 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-Vbdif20] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1] <strong>interface vbdif30</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-Vbdif30] <strong>ip binding vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-Vbdif30] <strong>ipv6 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-Vbdif30] <strong>ipv6 address 2001:db8:3::1 64</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-Vbdif30] <strong>ipv6 nd generate-rd-table enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-Vbdif30] <strong>anycast-gateway enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-Vbdif30] <strong>mac-address 00e0-fc00-0001</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-Vbdif30] <strong>ipv6 nd dad attempts 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-Vbdif30] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1] <strong>interface vbdif40</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-Vbdif40] <strong>ip binding vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-Vbdif40] <strong>ipv6 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-Vbdif40] <strong>ipv6 address 2001:db8:4::1 64</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-Vbdif40] <strong>ipv6 nd generate-rd-table enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-Vbdif40] <strong>anycast-gateway enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-Vbdif40] <strong>mac-address 00e0-fc00-0005</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-Vbdif40] <strong>ipv6 nd dad attempts 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-Vbdif40] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1] <strong>commit</strong></pre>
<p>The configuration of DC-GW2 is similar to that of DC-GW1. For detailed configurations, see <a href="#EN-US_TASK_0172370676__dc_vrp_evpn_cfg_012801">Configuration Files</a>.</p>
<p># Configure L2GW/L3GW1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>L2GW/L3GW1] <strong>ip vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-vpn-instance-vpn1] <strong>ipv6-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-vpn-instance-vpn1-af-ipv6] <strong>route-distinguisher 11:11</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-vpn-instance-vpn1-af-ipv6] <strong>vpn-target 11:1 evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-vpn-instance-vpn1-af-ipv6] <strong>evpn mpls routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-vpn-instance-vpn1-af-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-vpn-instance-vpn1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1] <strong>interface vbdif10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-Vbdif10] <strong>ip binding vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-Vbdif10] <strong>ipv6 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-Vbdif10] <strong>ipv6 address 2001:db8:1::1 64</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-Vbdif10] <strong>ipv6 nd generate-rd-table enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-Vbdif10] <strong>anycast-gateway enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-Vbdif10] <strong>mac-address 00e0-fc00-0003</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-Vbdif10] <strong>ipv6 nd collect host enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-Vbdif10] <strong>ipv6 nd dad attempts 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-Vbdif10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1] <strong>interface vbdif20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-Vbdif20] <strong>ip binding vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-Vbdif20] <strong>ipv6 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-Vbdif20] <strong>ipv6 address 2001:db8:2::1 64</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-Vbdif20] <strong>ipv6 nd generate-rd-table enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-Vbdif20] <strong>anycast-gateway enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-Vbdif20] <strong>mac-address 00e0-fc00-0004</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-Vbdif20] <strong>ipv6 nd collect host enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-Vbdif20] <strong>ipv6 nd dad attempts 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-Vbdif20] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1] <strong>interface vbdif30</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-Vbdif30] <strong>ip binding vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-Vbdif30] <strong>ipv6 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-Vbdif30] <strong>ipv6 address 2001:db8:3::1 64</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-Vbdif30] <strong>ipv6 nd generate-rd-table enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-Vbdif30] <strong>anycast-gateway enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-Vbdif30] <strong>mac-address 00e0-fc00-0001</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-Vbdif30] <strong>ipv6 nd collect host enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-Vbdif30] <strong>ipv6 nd dad attempts 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-Vbdif30] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1] <strong>interface vbdif40</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-Vbdif40] <strong>ip binding vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-Vbdif40] <strong>ipv6 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-Vbdif40] <strong>ipv6 address 2001:db8:4::1 64</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-Vbdif40] <strong>ipv6 nd generate-rd-table enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-Vbdif40] <strong>anycast-gateway enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-Vbdif40] <strong>mac-address 00e0-fc00-0005</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-Vbdif40] <strong>ipv6 nd collect host enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-Vbdif40] <strong>ipv6 nd dad attempts 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-Vbdif40] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1] <strong>commit</strong></pre>
<p>The configuration of L2GW/L3GW2 is similar to that of L2GW/L3GW1. For detailed configurations, see <a href="#EN-US_TASK_0172370676__dc_vrp_evpn_cfg_012801">Configuration Files</a>.</p>
</p></li><li><span>Configure a tunnel policy on PEs, DC GWs, and L2GWs/L3GWs.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>tunnel-policy srte</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-tunnel-policy-srte] <strong>tunnel select-seq sr-te load-balance-number 3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-tunnel-policy-srte] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>ip vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpn1] <strong>ipv6-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpn1-af-ipv6] <strong>tnl-policy srte</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpn1-af-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpn1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p>The configuration of PE2 is similar to that of PE1. For detailed configurations, see <a href="#EN-US_TASK_0172370676__dc_vrp_evpn_cfg_012801">Configuration Files</a>.</p>
<p># Configure DC-GW1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DCGW1] <strong>tunnel-policy srte</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-tunnel-policy-srte] <strong>tunnel select-seq sr-te load-balance-number 3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-tunnel-policy-srte] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1] <strong>ip vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-vpn-instance-vpn1] <strong>ipv6-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-vpn-instance-vpn1-af-ipv6] <strong>tnl-policy srte evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-vpn-instance-vpn1-af-ipv6] <strong>tnl-policy srte</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-vpn-instance-vpn1-af-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-vpn-instance-vpn1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1] <strong>commit</strong></pre>
<p>The configuration of DC-GW2 is similar to that of DC-GW1. For detailed configurations, see <a href="#EN-US_TASK_0172370676__dc_vrp_evpn_cfg_012801">Configuration Files</a>.</p>
<p># Configure L2GW/L3GW1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>L2GW/L3GW1] <strong>tunnel-policy srte</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-tunnel-policy-srte] <strong>tunnel select-seq sr-te load-balance-number 3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-tunnel-policy-srte] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1] <strong>ip vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-vpn-instance-vpn1] <strong>ipv6-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-vpn-instance-vpn1-af-ipv6] <strong>tnl-policy srte evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-vpn-instance-vpn1-af-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-vpn-instance-vpn1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1] <strong>commit</strong></pre>
<p>The configuration of L2GW/L3GW2 is similar to that of L2GW/L3GW1. For detailed configurations, see <a href="#EN-US_TASK_0172370676__dc_vrp_evpn_cfg_012801">Configuration Files</a>.</p>
</p></li><li><span>Configure BGP EVPN on DC GWs and L2GWs/L3GWs.</span><p><p># Configure DC-GW1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DCGW1] <strong>ip ipv6-prefix uIP index 10 permit 2001:DB8:10::10 128</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1] <strong>route-policy stopuIP deny node 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-route-policy] <strong>if-match ipv6 address prefix-list uIP</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-route-policy] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1] <strong>route-policy stopuIP permit node 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-route-policy] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-bgp] <strong>l2vpn-family evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-bgp-af-evpn] <strong>peer 1.1.1.1 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-bgp-af-evpn] <strong>peer 2.2.2.2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-bgp-af-evpn] <strong>peer 4.4.4.4 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-bgp-af-evpn] <strong>peer 4.4.4.4 route-policy stopuIP export</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-bgp-af-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1] <strong>commit</strong></pre>
<p>The configuration of DC-GW2 is similar to that of DC-GW1. For detailed configurations, see <a href="#EN-US_TASK_0172370676__dc_vrp_evpn_cfg_012801">Configuration Files</a>.</p>
<p># Configure L2GW/L3GW1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>L2GW/L3GW1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-bgp] <strong>l2vpn-family evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-bgp-af-evpn] <strong>peer 2.2.2.2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-bgp-af-evpn] <strong>peer 2.2.2.2 advertise nd</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-bgp-af-evpn] <strong>peer 3.3.3.3 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-bgp-af-evpn] <strong>peer 3.3.3.3 advertise nd</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-bgp-af-evpn] <strong>peer 4.4.4.4 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-bgp-af-evpn] <strong>peer 4.4.4.4 advertise nd</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-bgp-af-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1] <strong>evpn source-address 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1] <strong>evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-evpn] <strong>vlan-extend private enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-evpn] <strong>vlan-extend redirect enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-evpn] <strong>local-remote frr enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1] <strong>commit</strong></pre>
<p>The configuration of L2GW/L3GW2 is similar to that of L2GW/L3GW1. For detailed configurations, see <a href="#EN-US_TASK_0172370676__dc_vrp_evpn_cfg_012801">Configuration Files</a>.</p>
</p></li><li><span>Configure BGP VPNv6 on DC GWs and PEs.</span><p><p># Configure DC-GW1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DCGW1] <strong>ip vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DCGW1-vpn-instance-vpn1] <strong>ipv6-family</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DCGW1-vpn-instance-vpn1-af-ipv6] <strong>vpn-target 10:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-vpn-instance-vpn1-af-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DCGW1-vpn-instance-vpn1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-bgp] <strong>ipv6-family vpnv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-bgp-af-vpnv6] <strong>peer 7.7.7.7 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-bgp-af-vpnv6] <strong>peer 8.8.8.8 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-bgp-af-vpnv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1] <strong>commit</strong></pre>
<p>The configuration of DC-GW2 is similar to that of DC-GW1. For detailed configurations, see <a href="#EN-US_TASK_0172370676__dc_vrp_evpn_cfg_012801">Configuration Files</a>.</p>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>ip vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpn1] <strong>ipv6-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpn1-af-ipv6] <strong>route-distinguisher 77:77</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpn1-af-ipv6] <strong>vpn-target 10:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpn1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface GigabitEthernet<span>0/1/3</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/3</span>] <strong>ip binding vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/3</span>] <strong>ipv6 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/3</span>] <strong>ipv6 address 2001:DB8:7::1 64</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/3</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>bgp 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>ipv6-family vpnv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-vpnv6] <strong>peer 3.3.3.3 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-vpnv6] <strong>peer 4.4.4.4 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-vpnv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>ipv6-family vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-6-vpn1] <strong>import-route direct</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-6-vpn1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p>The configuration of PE2 is similar to that of PE1. For detailed configurations, see <a href="#EN-US_TASK_0172370676__dc_vrp_evpn_cfg_012801">Configuration Files</a>.</p>
</p></li><li><span>Configure Layer 2 sub-interfaces on DC GWs and L2GWs/L3GWs and configure the static VPN routes destined for VNFs on L2GWs/L3GWs.</span><p><div class="p"># Configure DC-GW1.<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, a sub-interface of the physical interface of DC-GW1 is bound to a BD to ensure that the VBDIF interface is up. In actual situations, bind service-irrelevant interfaces to BDs to ensure network reliability.</p>
</div></div>
</div>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DCGW1] <strong>interface GigabitEthernet<span>0/1/2</span>.1 mode l2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-GigabitEthernet<span>0/1/2</span>.1] <strong>encapsulation dot1q vid 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-GigabitEthernet<span>0/1/2</span>.1] <strong>rewrite pop single</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-GigabitEthernet<span>0/1/2</span>.1] <strong>bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-GigabitEthernet<span>0/1/2</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1] <strong>interface GigabitEthernet<span>0/1/2</span>.2 mode l2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-GigabitEthernet<span>0/1/2</span>.2] <strong>encapsulation dot1q vid 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-GigabitEthernet<span>0/1/2</span>.2] <strong>rewrite pop single</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-GigabitEthernet<span>0/1/2</span>.2] <strong>bridge-domain 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-GigabitEthernet<span>0/1/2</span>.2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1] <strong>interface GigabitEthernet<span>0/1/1</span>.1 mode l2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-GigabitEthernet<span>0/1/1</span>.1] <strong>encapsulation dot1q vid 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-GigabitEthernet<span>0/1/1</span>.1] <strong>rewrite pop single</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-GigabitEthernet<span>0/1/1</span>.1] <strong>bridge-domain 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-GigabitEthernet<span>0/1/1</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1] <strong>interface GigabitEthernet<span>0/1/1</span>.2 mode l2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-GigabitEthernet<span>0/1/1</span>.2] <strong>encapsulation dot1q vid 40</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-GigabitEthernet<span>0/1/1</span>.2] <strong>rewrite pop single</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-GigabitEthernet<span>0/1/1</span>.2] <strong>bridge-domain 40</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-GigabitEthernet<span>0/1/1</span>.2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1] <strong>commit</strong></pre>
<p>The configuration of DC-GW2 is similar to that of DC-GW1. For detailed configurations, see <a href="#EN-US_TASK_0172370676__dc_vrp_evpn_cfg_012801">Configuration Files</a>.</p>
<p># Configure L2GW/L3GW1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>L2GW/L3GW1] <strong>lacp e-trunk system-id 00e0-fc00-0002</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1] <strong>lacp e-trunk priority 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1] <strong>e-trunk 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-e-trunk-1] <strong>peer-address 2.2.2.2 source-address 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-e-trunk-1] <strong>priority 5</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-e-trunk-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1] <strong>interface Eth-Trunk 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-Eth-Trunk10] <strong>mode lacp-static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-Eth-Trunk10] <strong>e-trunk 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-Eth-Trunk10] <strong>e-trunk mode force-master</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-Eth-Trunk10] <strong>esi 0000.1111.1111.1111.1111</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-Eth-Trunk10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1] <strong>interface Eth-Trunk 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-Eth-Trunk20] <strong>mode lacp-static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-Eth-Trunk20] <strong>e-trunk 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-Eth-Trunk20] <strong>e-trunk mode force-master</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-Eth-Trunk20] <strong>esi 0000.2222.2222.2222.2222</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-Eth-Trunk20] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1] <strong>interface Eth-Trunk 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-Eth-Trunk30] <strong>mode lacp-static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-Eth-Trunk30] <strong>e-trunk 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-Eth-Trunk30] <strong>e-trunk mode force-master</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-Eth-Trunk30] <strong>esi 0000.3333.3333.3333.3333</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-Eth-Trunk30] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1] <strong>interface Eth-Trunk 40</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-Eth-Trunk40] <strong>mode lacp-static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-Eth-Trunk40] <strong>e-trunk 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-Eth-Trunk40] <strong>e-trunk mode force-master</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-Eth-Trunk40] <strong>esi 0000.4444.4444.4444.4444</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-Eth-Trunk40] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1] <strong>interface Eth-Trunk 10.1 mode l2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-Eth-Trunk10.1] <strong>encapsulation dot1q vid 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-Eth-Trunk10.1] <strong>rewrite pop single</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-Eth-Trunk10.1] <strong>bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-Eth-Trunk10.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1] <strong>interface Eth-Trunk 20.1 mode l2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-Eth-Trunk20.1] <strong>encapsulation dot1q vid 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-Eth-Trunk20.1] <strong>rewrite pop single</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-Eth-Trunk20.1] <strong>bridge-domain 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-Eth-Trunk20.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1] <strong>interface Eth-Trunk 30.1 mode l2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-Eth-Trunk30.1] <strong>encapsulation dot1q vid 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-Eth-Trunk30.1] <strong>rewrite pop single</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-Eth-Trunk30.1] <strong>bridge-domain 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-Eth-Trunk30.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1] <strong>interface Eth-Trunk 40.1 mode l2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-Eth-Trunk40.1] <strong>encapsulation dot1q vid 40</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-Eth-Trunk40.1] <strong>rewrite pop single</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-Eth-Trunk40.1] <strong>bridge-domain 40</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-Eth-Trunk40.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>L2GW/L3GW1] <strong>interface GigabitEthernet<span>0/1/3</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-GigabitEthernet<span>0/1/3</span>] <strong>eth-trunk 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-GigabitEthernet<span>0/1/3</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1] <strong>interface GigabitEthernet<span>0/1/4</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-GigabitEthernet<span>0/1/4</span>] <strong>eth-trunk 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-GigabitEthernet<span>0/1/4</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>L2GW/L3GW1] <strong>interface GigabitEthernet<span>0/1/5</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-GigabitEthernet<span>0/1/5</span>] <strong>eth-trunk 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-GigabitEthernet<span>0/1/5</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1] <strong>interface GigabitEthernet<span>0/1/6</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-GigabitEthernet<span>0/1/6</span>] <strong>eth-trunk 40</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-GigabitEthernet<span>0/1/6</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1] <strong>ipv6 route-static vpn-instance vpn1 2001:DB8:5::5 128 2001:DB8:1::2 preference 255 tag 1000 inter-protocol-ecmp </strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1] <strong>ipv6 route-static vpn-instance vpn1 2001:DB8:5::5 128 2001:DB8:2::2 preference 255 tag 1000 inter-protocol-ecmp </strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1] <strong>ipv6 route-static vpn-instance vpn1 2001:DB8:6::6 128 2001:DB8:3::2 preference 255 tag 1000 inter-protocol-ecmp </strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1] <strong>ipv6 route-static vpn-instance vpn1 2001:DB8:6::6 128 2001:DB8:4::2 preference 255 tag 1000 inter-protocol-ecmp </strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1] <strong>commit</strong></pre>
<p>The configuration of L2GW/L3GW2 is similar to that of L2GW/L3GW1. For detailed configurations, see <a href="#EN-US_TASK_0172370676__dc_vrp_evpn_cfg_012801">Configuration Files</a>.</p>
</p></li><li><span>Configure L2GWs/L3GWs to import static VPN routes through BGP EVPN. Configure and apply a route-policy for L3VPN instances so that the static VPN routes can retain the original next hops.</span><p><p># Configure L2GW/L3GW1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>L2GW/L3GW1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-bgp] <strong>ipv6-family vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-bgp-6-vpn1] <strong>import-route static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-bgp-6-vpn1] <strong>advertise l2vpn evpn import-route-multipath</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-bgp-6-vpn1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1] <strong>route-policy sp permit node 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-route-policy] <strong>if-match tag 1000</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-route-policy] <strong>apply ipv6 gateway-ip origin-nexthop</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-route-policy] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1] <strong>route-policy sp deny node 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-route-policy] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1] <strong>ip vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-vpn-instance-vpn1] <strong>ipv6-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-vpn-instance-vpn1-af-ipv6] <strong>export route-policy sp evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-vpn-instance-vpn1-af-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-vpn-instance-vpn1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1] <strong>commit</strong></pre>
<p>The configuration of L2GW/L3GW2 is similar to that of L2GW/L3GW1. For detailed configurations, see <a href="#EN-US_TASK_0172370676__dc_vrp_evpn_cfg_012801">Configuration Files</a>.</p>
</p></li><li><span>Configure static default VPN routes and loopback addresses on DC GWs. The loopback addresses are used to establish BGP VPN peer relationships with VNFs. Configure and apply a route-policy for L3VPN instances so that DC GWs can advertise static default VPN routes and VPN loopback routes only through BGP EVPN.</span><p><p># Configure DC-GW1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DCGW1] <strong>ipv6 route-static vpn-instance vpn1 :: 0 NULL0 tag 2000</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1] <strong>interface LoopBack2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-LoopBack2] <strong>ip binding vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-LoopBack2] <strong>ipv6 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-LoopBack2] <strong>ipv6 address 2001:db8:33::33 128</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-LoopBack2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-bgp] <strong>ipv6-family vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-bgp-6-vpn1] <strong>advertise l2vpn evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-bgp-6-vpn1] <strong>import-route direct</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-bgp-6-vpn1] <strong>network :: 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-bgp-6-vpn1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1] <strong>ip ipv6-prefix lp index 10 permit 2001:db8:33::33 128</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1] <strong>route-policy dp permit node 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-route-policy] <strong>if-match tag 2000</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-route-policy] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1] <strong>route-policy dp permit node 15</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-route-policy] <strong>if-match ipv6 address prefix-list lp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-route-policy] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1] <strong>ip vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-vpn-instance-vpn1] <strong>ipv6-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-vpn-instance-vpn1-af-ipv6] <strong>export route-policy dp evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-vpn-instance-vpn1-af-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-vpn-instance-vpn1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1] <strong>commit</strong></pre>
<p>The configuration of DC-GW2 is similar to that of DC-GW1. For detailed configurations, see <a href="#EN-US_TASK_0172370676__dc_vrp_evpn_cfg_012801">Configuration Files</a>.</p>
</p></li><li><span>Establish BGP VPN peer relationships between DC GWs and VNFs.</span><p><p># Configure DC-GW1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DCGW1] <strong>route-policy p1 deny node 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-route-policy] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-bgp] <strong>ipv6-family vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-bgp-6-vpn1] <strong>peer 2001:db8:5::5 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-bgp-6-vpn1] <strong>peer 2001:db8:5::5 connect-interface LoopBack2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-bgp-6-vpn1] <strong>peer 2001:db8:5::5 route-policy p1 export</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-bgp-6-vpn1] <strong>peer 2001:db8:6::6 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-bgp-6-vpn1] <strong>peer 2001:db8:6::6 connect-interface LoopBack2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-bgp-6-vpn1] <strong>peer 2001:db8:6::6 route-policy p1 export</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-bgp-6-vpn1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1] <strong>commit</strong></pre>
<p># Configure DC-GW2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DCGW2] <strong>route-policy p1 deny node 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW2-route-policy] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW2] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW2-bgp] <strong>ipv6-family vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW2-bgp-6-vpn1] <strong>peer 2001:db8:5::5 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW2-bgp-6-vpn1] <strong>peer 2001:db8:5::5 connect-interface LoopBack2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW2-bgp-6-vpn1] <strong>peer 2001:db8:5::5 route-policy p1 export</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW2-bgp-6-vpn1] <strong>peer 2001:db8:6::6 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW2-bgp-6-vpn1] <strong>peer 2001:db8:6::6 connect-interface LoopBack2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW2-bgp-6-vpn1] <strong>peer 2001:db8:6::6 route-policy p1 export</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW2-bgp-6-vpn1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW2-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW2] <strong>commit</strong></pre>
</p></li><li><span>Configure load balancing on PEs, DC GWs, and L2GWs/L3GWs.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>ipv6-family vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-6-vpn1] <strong>maximum load-balancing 16</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-6-vpn1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p>The configuration of PE2 is similar to that of PE1. For detailed configurations, see <a href="#EN-US_TASK_0172370676__dc_vrp_evpn_cfg_012801">Configuration Files</a>.</p>
<p># Configure DC-GW1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DCGW1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-bgp] <strong>ipv6-family vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-bgp-6-vpn1] <strong>maximum load-balancing 16</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-bgp-6-vpn1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-bgp] <strong>l2vpn-family evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-bgp-af-evpn] <strong>peer 1.1.1.1 capability-advertise add-path both</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-bgp-af-evpn] <strong>peer 1.1.1.1 advertise add-path path-number 16</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-bgp-af-evpn] <strong>peer 2.2.2.2 capability-advertise add-path both</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-bgp-af-evpn] <strong>peer 2.2.2.2 advertise add-path path-number 16</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-bgp-af-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DCGW1] <strong>commit</strong></pre>
<p>The configuration of DC-GW2 is similar to that of DC-GW1. For detailed configurations, see <a href="#EN-US_TASK_0172370676__dc_vrp_evpn_cfg_012801">Configuration Files</a>.</p>
<p># Configure L2GW/L3GW1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>L2GW/L3GW1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-bgp] <strong>ipv6-family vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-bgp-6-vpn1] <strong>maximum load-balancing 16</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-bgp-6-vpn1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-bgp] <strong>l2vpn-family evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-bgp-af-evpn] <strong>bestroute add-path path-number 16</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-bgp-af-evpn] <strong>peer 3.3.3.3 capability-advertise add-path both</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-bgp-af-evpn] <strong>peer 3.3.3.3 advertise add-path path-number 16</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-bgp-af-evpn] <strong>peer 4.4.4.4 capability-advertise add-path both</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-bgp-af-evpn] <strong>peer 4.4.4.4 advertise add-path path-number 16</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-bgp-af-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2GW/L3GW1] <strong>commit</strong></pre>
<p>The configuration of L2GW/L3GW2 is similar to that of L2GW/L3GW1. For detailed configurations, see <a href="#EN-US_TASK_0172370676__dc_vrp_evpn_cfg_012801">Configuration Files</a>.</p>
</p></li><li><span>Verify the configuration.</span><p><p>After completing the configurations, run the <strong>display ipv6 routing-table vpn-instance vpn1</strong> command on PEs to view the UE and VNF route information in VPN routing tables.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display ipv6 routing-table vpn-instance vpn1</strong></pre>
<pre class="screen">Routing Table : vpn1
         Destinations : 9        Routes : 12         

Destination  : ::                                      PrefixLength : 0
NextHop      : ::                                      Preference   : 60
Cost         : 0                                       Protocol     : Static
RelayNextHop : ::                                      TunnelID     : 0x0
Interface    : NULL0                                   Flags        : DB

Destination  : <strong>2001:DB8:5::5</strong>                           PrefixLength : 128
NextHop      : ::FFFF:3.3.3.3                          Preference   : 255
Cost         : 0                                       Protocol     : EBGP
RelayNextHop : ::FFFF:0.0.0.0                          TunnelID     : 0x000000000300000001
Interface    : Tunnel1                                 Flags        : RD

Destination  : <strong>2001:DB8:5::5</strong>                           PrefixLength : 128
NextHop      : ::FFFF:4.4.4.4                          Preference   : 255
Cost         : 0                                       Protocol     : EBGP
RelayNextHop : ::FFFF:0.0.0.0                          TunnelID     : 0x000000000300000002
Interface    : Tunnel2                                 Flags        : RD

Destination  : <strong>2001:DB8:6::6</strong>                           PrefixLength : 128
NextHop      : ::FFFF:3.3.3.3                          Preference   : 255
Cost         : 0                                       Protocol     : EBGP
RelayNextHop : ::FFFF:0.0.0.0                          TunnelID     : 0x000000000300000001
Interface    : Tunnel1                                 Flags        : RD

Destination  : <strong>2001:DB8:6::6</strong>                           PrefixLength : 128
NextHop      : ::FFFF:4.4.4.4                          Preference   : 255
Cost         : 0                                       Protocol     : EBGP
RelayNextHop : ::FFFF:0.0.0.0                          TunnelID     : 0x000000000300000002
Interface    : Tunnel2                                 Flags        : RD

Destination  : 2001:DB8:7::                            PrefixLength : 64
NextHop      : 2001:DB8:7::1                           Preference   : 0
Cost         : 0                                       Protocol     : Direct
RelayNextHop : ::                                      TunnelID     : 0x0
Interface    : GigabitEthernet<span>0/1/3</span>                    Flags        : D

Destination  : 2001:DB8:7::1                           PrefixLength : 128
NextHop      : ::1                                     Preference   : 0
Cost         : 0                                       Protocol     : Direct
RelayNextHop : ::                                      TunnelID     : 0x0
Interface    : GigabitEthernet<span>0/1/3</span>                    Flags        : D

Destination  : <strong>2001:DB8:10::10</strong>                         PrefixLength : 128
NextHop      : ::FFFF:3.3.3.3                          Preference   : 255
Cost         : 0                                       Protocol     : EBGP
RelayNextHop : ::FFFF:0.0.0.0                          TunnelID     : 0x000000000300000001
Interface    : Tunnel1                                 Flags        : RD

Destination  : <strong>2001:DB8:10::10</strong>                         PrefixLength : 128
NextHop      : ::FFFF:4.4.4.4                          Preference   : 255
Cost         : 0                                       Protocol     : EBGP
RelayNextHop : ::FFFF:0.0.0.0                          TunnelID     : 0x000000000300000002
Interface    : Tunnel2                                 Flags        : RD

Destination  : 2001:DB8:33::33                         PrefixLength : 128
NextHop      : ::FFFF:3.3.3.3                          Preference   : 255
Cost         : 0                                       Protocol     : EBGP
RelayNextHop : ::FFFF:10.6.5.1                         TunnelID     : 0x000000000c00600000
Interface    : GigabitEthernet<span>0/1/2</span>                    Flags        : RD

Destination  : 2001:DB8:44::44                         PrefixLength : 128
NextHop      : ::FFFF:4.4.4.4                          Preference   : 255
Cost         : 0                                       Protocol     : EBGP
RelayNextHop : ::FFFF:10.6.7.2                         TunnelID     : 0x000000000c00600001
Interface    : GigabitEthernet<span>0/1/1</span>                    Flags        : RD

Destination  : FE80::                                  PrefixLength : 10
NextHop      : ::                                      Preference   : 0
Cost         : 0                                       Protocol     : Direct
RelayNextHop : ::                                      TunnelID     : 0x0
Interface    : NULL0                                   Flags        : DB</pre>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0172370676__dc_vrp_evpn_cfg_012801"><a name="EN-US_TASK_0172370676__dc_vrp_evpn_cfg_012801"></a><a name="dc_vrp_evpn_cfg_012801"></a><a name="EN-US_TASK_0172370676__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>PE1</p>
<pre class="screen">#
sysname PE1
#
ip vpn-instance vpn1
 ipv6-family
  route-distinguisher 77:77
<span>  apply-label per-instance</span>
  tnl-policy srte
  vpn-target 10:1 export-extcommunity
  vpn-target 10:1 import-extcommunity
#
mpls lsr-id 7.7.7.7
#
mpls
 mpls te
#
explicit-path PtoD74
 next sid label 48092 type adjacency
 next sid label 48091 type adjacency
#
explicit-path PtoD73
 next sid label 48090 type adjacency
#
segment-routing
#
isis 1
 is-level level-2
 cost-style wide
 network-entity 10.0000.0000.0007.00
 traffic-eng level-2
 segment-routing mpls
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 10.6.7.1 255.255.255.0
 mpls
 mpls te
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ip address 10.6.5.2 255.255.255.0
 mpls
 mpls te
#
interface GigabitEthernet<span>0/1/3</span>
 undo shutdown
 ip binding vpn-instance vpn1
 ipv6 enable
 ipv6 address 2001:DB8:7::1/64
#
interface LoopBack1
 ip address 7.7.7.7 255.255.255.255
 isis enable 1
 isis prefix-sid absolute 16100
#
interface Tunnel1
 ip address unnumbered interface LoopBack1
 tunnel-protocol mpls te
 destination 3.3.3.3
 mpls te signal-protocol segment-routing
 mpls te tunnel-id 100
 mpls te path explicit-path PtoD73
#
interface Tunnel2
 ip address unnumbered interface LoopBack1
 tunnel-protocol mpls te
 destination 4.4.4.4
 mpls te signal-protocol segment-routing
 mpls te tunnel-id 200
 mpls te path explicit-path PtoD74
#
bgp 200
 peer 3.3.3.3 as-number 100
 peer 3.3.3.3 ebgp-max-hop 255
 peer 3.3.3.3 connect-interface LoopBack1
 peer 3.3.3.3 egress-engineering
 peer 4.4.4.4 as-number 100
 peer 4.4.4.4 ebgp-max-hop 255
 peer 4.4.4.4 connect-interface LoopBack1
 peer 4.4.4.4 egress-engineering
 #
 ipv4-family unicast
  undo synchronization
  network 7.7.7.7 255.255.255.255
  network 10.6.5.0 255.255.255.0
  network 10.6.7.0 255.255.255.0
  peer 3.3.3.3 enable
  peer 4.4.4.4 enable
 #
 link-state-family unicast
 #
 ipv6-family vpnv6
  policy vpn-target
  peer 3.3.3.3 enable
  peer 4.4.4.4 enable
 #
 ipv6-family vpn-instance vpn1
  import-route direct
  import-route static
  maximum load-balancing 16
#
ip route-static 3.3.3.3 255.255.255.255 10.6.5.1
ip route-static 4.4.4.4 255.255.255.255 10.6.7.2
ip route-static 8.8.8.8 255.255.255.255 10.6.7.2
#
ipv6 route-static vpn-instance vpn1 :: 0 NULL0 tag 2000
#
tunnel-policy srte
 tunnel select-seq sr-te load-balance-number 3
#
return</pre>
</li><li><p>PE2</p>
<pre class="screen">#
sysname PE2
#
ip vpn-instance vpn1
 ipv6-family
  route-distinguisher 88:88
<span>  apply-label per-instance</span>
  tnl-policy srte
  vpn-target 10:1 export-extcommunity
  vpn-target 10:1 import-extcommunity
#
mpls lsr-id 8.8.8.8
#
mpls
 mpls te
#
explicit-path PtoD83
 next sid label 48092 type adjacency
 next sid label 48090 type adjacency
#
explicit-path PtoD84
 next sid label 48091 type adjacency
#
segment-routing
#
isis 1
 is-level level-2
 cost-style wide
 network-entity 10.0000.0000.0008.00
 traffic-eng level-2
 segment-routing mpls
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 10.6.7.2 255.255.255.0
 mpls
 mpls te
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ip address 10.6.6.2 255.255.255.0
 mpls
 mpls te
#
interface GigabitEthernet<span>0/1/3</span>
 undo shutdown
 ip binding vpn-instance vpn1
 ipv6 enable
 ipv6 address 2001:DB8:8::1/64
#
interface LoopBack1
 ip address 8.8.8.8 255.255.255.255
 isis enable 1
 isis prefix-sid absolute 16200
#
interface Tunnel1
 ip address unnumbered interface LoopBack1
 tunnel-protocol mpls te
 destination 3.3.3.3
 mpls te signal-protocol segment-routing
 mpls te tunnel-id 100
 mpls te path explicit-path PtoD83  
#
interface Tunnel2
 ip address unnumbered interface LoopBack1
 tunnel-protocol mpls te
 destination 4.4.4.4
 mpls te signal-protocol segment-routing
 mpls te tunnel-id 200
 mpls te path explicit-path PtoD84  
#
bgp 200
 peer 3.3.3.3 as-number 100
 peer 3.3.3.3 ebgp-max-hop 255
 peer 3.3.3.3 connect-interface LoopBack1
 peer 3.3.3.3 egress-engineering
 peer 4.4.4.4 as-number 100
 peer 4.4.4.4 ebgp-max-hop 255
 peer 4.4.4.4 connect-interface LoopBack1
 peer 4.4.4.4 egress-engineering
 #
 ipv4-family unicast
  undo synchronization
  network 8.8.8.8 255.255.255.255
  network 10.6.6.0 255.255.255.0
  network 10.6.7.0 255.255.255.0
  peer 3.3.3.3 enable
  peer 4.4.4.4 enable
 #
 link-state-family unicast
 #
 ipv6-family vpnv6
  policy vpn-target
  peer 3.3.3.3 enable
  peer 4.4.4.4 enable
 #
 ipv6-family vpn-instance vpn1
  import-route direct
  import-route static
  maximum load-balancing 16
#
ip route-static 3.3.3.3 255.255.255.255 10.6.7.1
ip route-static 4.4.4.4 255.255.255.255 10.6.6.1
ip route-static 7.7.7.7 255.255.255.255 10.6.7.1
#
ipv6 route-static vpn-instance vpn1 :: 0 NULL0 tag 2000
#
tunnel-policy srte
 tunnel select-seq sr-te load-balance-number 3
#
return</pre>
</li><li><p>DC-GW1 configuration file</p>
<pre class="screen">#
sysname DCGW1
#
evpn vpn-instance evrf1 bd-mode
 route-distinguisher 1:1
 tnl-policy srte
 vpn-target 1:1 export-extcommunity
 vpn-target 1:1 import-extcommunity
#
evpn vpn-instance evrf2 bd-mode
 route-distinguisher 2:2
 tnl-policy srte
 vpn-target 2:2 export-extcommunity
 vpn-target 2:2 import-extcommunity
#
evpn vpn-instance evrf3 bd-mode
 route-distinguisher 3:3
 tnl-policy srte
 vpn-target 3:3 export-extcommunity
 vpn-target 3:3 import-extcommunity
#
evpn vpn-instance evrf4 bd-mode
 route-distinguisher 4:4
 tnl-policy srte
 vpn-target 4:4 export-extcommunity
 vpn-target 4:4 import-extcommunity
#
ip vpn-instance vpn1
 ipv6-family
  route-distinguisher 33:33
<span>  apply-label per-instance</span>
  tnl-policy srte
  export route-policy dp evpn
  vpn-target 11:1 export-extcommunity evpn
  vpn-target 10:1 export-extcommunity
  vpn-target 11:1 import-extcommunity evpn
  vpn-target 10:1 import-extcommunity
  tnl-policy srte evpn
  evpn mpls routing-enable
#
mpls lsr-id 3.3.3.3
#
mpls
 mpls te
#
bridge-domain 10
 evpn binding vpn-instance evrf1
#
bridge-domain 20
 evpn binding vpn-instance evrf2
#
bridge-domain 30
 evpn binding vpn-instance evrf3
#
bridge-domain 40
 evpn binding vpn-instance evrf4
#
explicit-path DtoL31
 next sid label 48003 type adjacency
#
explicit-path DtoL32
 next sid label 48002 type adjacency
 next sid label 48003 type adjacency
#
explicit-path DtoP37
 next sid label 48121 type adjacency
#
explicit-path DtoP38
 next sid label 48002 type adjacency
 next sid label 48121 type adjacency
#
segment-routing
#
interface Vbdif10
 ip binding vpn-instance vpn1
 ipv6 enable
 ipv6 address 2001:DB8:1::1/64
 mac-address 00e0-fc00-0003
 ipv6 nd dad attempts 0
 ipv6 nd generate-rd-table enable
 anycast-gateway enable
#
interface Vbdif20
 ip binding vpn-instance vpn1
 ipv6 enable
 ipv6 address 2001:DB8:2::1/64
 mac-address 00e0-fc00-0004
 ipv6 nd dad attempts 0
 ipv6 nd generate-rd-table enable
 anycast-gateway enable
#
interface Vbdif30
 ip binding vpn-instance vpn1
 ipv6 enable
 ipv6 address 2001:DB8:3::1/64
 mac-address 00e0-fc00-0001
 ipv6 nd dad attempts 0
 ipv6 nd generate-rd-table enable
 anycast-gateway enable
#
interface Vbdif40
 ip binding vpn-instance vpn1
 ipv6 enable
 ipv6 address 2001:DB8:4::1/64
 mac-address 00e0-fc00-0005
 ipv6 nd dad attempts 0
 ipv6 nd generate-rd-table enable
 anycast-gateway enable
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 10.6.1.1 255.255.255.0
 mpls
 mpls te
#
interface GigabitEthernet<span>0/1/1</span>.1 mode l2
 encapsulation dot1q vid 20
 rewrite pop single
 bridge-domain 20
#
interface GigabitEthernet<span>0/1/1</span>.2 mode l2
 encapsulation dot1q vid 40
 rewrite pop single
 bridge-domain 40
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ip address 10.6.2.1 255.255.255.0
 mpls
 mpls te
#
interface GigabitEthernet<span>0/1/2</span>.1 mode l2
 encapsulation dot1q vid 10
 rewrite pop single
 bridge-domain 10
#
interface GigabitEthernet<span>0/1/2</span>.2 mode l2
 encapsulation dot1q vid 30
 rewrite pop single
 bridge-domain 30
#
interface GigabitEthernet<span>0/1/3</span>
 undo shutdown
 ip address 10.6.5.1 255.255.255.0
 mpls
 mpls te
#
interface LoopBack1
 ip address 3.3.3.3 255.255.255.255
 ospf prefix-sid index 30
#
interface LoopBack2
 ip binding vpn-instance vpn1
 ipv6 enable
 ipv6 address 2001:DB8:33::33/128
#
interface Tunnel1
 ip address unnumbered interface LoopBack1
 tunnel-protocol mpls te
 destination 1.1.1.1
 mpls te signal-protocol segment-routing
 mpls te tunnel-id 1
 mpls te path explicit-path DtoL31  
#
interface Tunnel2
 ip address unnumbered interface LoopBack1
 tunnel-protocol mpls te
 destination 2.2.2.2
 mpls te signal-protocol segment-routing
 mpls te tunnel-id 2
 mpls te path explicit-path DtoL32  
#
interface Tunnel7
 ip address unnumbered interface LoopBack1
 tunnel-protocol mpls te
 destination 7.7.7.7
 mpls te signal-protocol segment-routing
 mpls te tunnel-id 7
 mpls te path explicit-path DtoP37  
#
interface Tunnel8
 ip address unnumbered interface LoopBack1
 tunnel-protocol mpls te
 destination 8.8.8.8
 mpls te signal-protocol segment-routing
 mpls te tunnel-id 8
 mpls te path explicit-path DtoP38  
#
bgp 100
 peer 1.1.1.1 as-number 100
 peer 1.1.1.1 connect-interface LoopBack1
 peer 2.2.2.2 as-number 100
 peer 2.2.2.2 connect-interface LoopBack1
 peer 4.4.4.4 as-number 100
 peer 4.4.4.4 connect-interface LoopBack1
 peer 7.7.7.7 as-number 200
 peer 7.7.7.7 ebgp-max-hop 255
 peer 7.7.7.7 connect-interface LoopBack1
 peer 7.7.7.7 egress-engineering
 peer 8.8.8.8 as-number 200
 peer 8.8.8.8 ebgp-max-hop 255
 peer 8.8.8.8 connect-interface LoopBack1
 peer 8.8.8.8 egress-engineering
 #
 ipv4-family unicast
  undo synchronization
  network 10.6.1.0 255.255.255.0
  network 10.6.5.0 255.255.255.0
  import-route static
  import-route ospf 100
  peer 1.1.1.1 enable
  peer 2.2.2.2 enable
  peer 4.4.4.4 enable
  peer 7.7.7.7 enable
  peer 8.8.8.8 enable
 #              
 link-state-family unicast
 #
 ipv6-family vpnv6
  policy vpn-target
  peer 7.7.7.7 enable
  peer 7.7.7.7 advertise route-reoriginated evpn ipv6
  peer 8.8.8.8 enable
  peer 8.8.8.8 advertise route-reoriginated evpn ipv6
 #
 ipv6-family vpn-instance vpn1
  network :: 0
  import-route direct
  maximum load-balancing 16
  advertise l2vpn evpn
  peer 2001:DB8:5::5 as-number 100
  peer 2001:DB8:5::5 connect-interface LoopBack2
  peer 2001:DB8:5::5 route-policy p1 export
  peer 2001:DB8:6::6 as-number 100
  peer 2001:DB8:6::6 connect-interface LoopBack2
  peer 2001:DB8:6::6 route-policy p1 export
 #
 l2vpn-family evpn
  undo policy vpn-target
  peer 1.1.1.1 enable
  peer 1.1.1.1 capability-advertise add-path both
  peer 1.1.1.1 advertise add-path path-number 16
  peer 1.1.1.1 import reoriginate
  peer 2.2.2.2 enable
  peer 2.2.2.2 capability-advertise add-path both
  peer 2.2.2.2 advertise add-path path-number 16
  peer 2.2.2.2 import reoriginate
  peer 4.4.4.4 enable
  peer 4.4.4.4 route-policy stopuIP export
#
ospf 100
 opaque-capability enable
 segment-routing mpls
 segment-routing global-block 160000 161000
 area 0.0.0.0
  network 3.3.3.3 0.0.0.0
  network 10.6.1.0 0.0.0.255
  network 10.6.2.0 0.0.0.255
  mpls-te enable
#
ip ipv6-prefix lp index 10 permit 2001:DB8:33::33 128
ip ipv6-prefix uIP index 10 permit 2001:DB8:10::10 128
#
route-policy dp permit node 10
 if-match tag 2000
#
route-policy dp permit node 15
 if-match ipv6 address prefix-list lp
#
route-policy p1 deny node 10
#
route-policy stopuIP deny node 10
 if-match ipv6 address prefix-list uIP
#
route-policy stopuIP permit node 20
#
ip route-static 7.7.7.7 255.255.255.255 10.6.5.2
ip route-static 8.8.8.8 255.255.255.255 10.6.1.2
#
ipv6 route-static vpn-instance vpn1 :: 0 NULL0 tag 2000
#
tunnel-policy srte
 tunnel select-seq sr-te load-balance-number 3
#
return</pre>
</li><li><p>DC-GW2 configuration file</p>
<pre class="screen">#
sysname DCGW2
#
evpn vpn-instance evrf1 bd-mode
 route-distinguisher 1:1
 tnl-policy srte
 vpn-target 1:1 export-extcommunity
 vpn-target 1:1 import-extcommunity
#
evpn vpn-instance evrf2 bd-mode
 route-distinguisher 2:2
 tnl-policy srte
 vpn-target 2:2 export-extcommunity
 vpn-target 2:2 import-extcommunity
#
evpn vpn-instance evrf3 bd-mode
 route-distinguisher 3:3
 tnl-policy srte
 vpn-target 3:3 export-extcommunity
 vpn-target 3:3 import-extcommunity
#
evpn vpn-instance evrf4 bd-mode
 route-distinguisher 4:4
 tnl-policy srte
 vpn-target 4:4 export-extcommunity
 vpn-target 4:4 import-extcommunity
#
ip vpn-instance vpn1
 ipv6-family
  route-distinguisher 44:44
<span>  apply-label per-instance</span>
  tnl-policy srte
  export route-policy dp evpn
  vpn-target 11:1 export-extcommunity evpn
  vpn-target 10:1 export-extcommunity
  vpn-target 11:1 import-extcommunity evpn
  vpn-target 10:1 import-extcommunity
  tnl-policy srte evpn
  evpn mpls routing-enable
#
mpls lsr-id 4.4.4.4
#
mpls
 mpls te
#
bridge-domain 10
 evpn binding vpn-instance evrf1
#
bridge-domain 20
 evpn binding vpn-instance evrf2
#
bridge-domain 30
 evpn binding vpn-instance evrf3
#
bridge-domain 40
 evpn binding vpn-instance evrf4
#
explicit-path DtoL41
 next sid label 48020 type adjacency
 next sid label 48021 type adjacency
#
explicit-path DtoL42
 next sid label 48021 type adjacency
#
explicit-path DtoP47
 next sid label 48002 type adjacency
 next sid label 48121 type adjacency
#
explicit-path DtoP48
 next sid label 48121 type adjacency
#
segment-routing
#
interface Vbdif10
 ip binding vpn-instance vpn1
 ipv6 enable
 ipv6 address 2001:DB8:1::1/64
 mac-address 00e0-fc00-0003
 ipv6 nd dad attempts 0
 ipv6 nd generate-rd-table enable
 anycast-gateway enable
#
interface Vbdif20
 ip binding vpn-instance vpn1
 ipv6 enable
 ipv6 address 2001:DB8:2::1/64
 mac-address 00e0-fc00-0004
 ipv6 nd dad attempts 0
 ipv6 nd generate-rd-table enable
 anycast-gateway enable
#
interface Vbdif30
 ip binding vpn-instance vpn1
 ipv6 enable    
 ipv6 address 2001:DB8:3::1/64
 mac-address 00e0-fc00-0001
 ipv6 nd dad attempts 0
 ipv6 nd generate-rd-table enable
 anycast-gateway enable
#
interface Vbdif40
 ip binding vpn-instance vpn1
 ipv6 enable
 ipv6 address 2001:DB8:4::1/64
 mac-address 00e0-fc00-0005
 ipv6 nd dad attempts 0
 ipv6 nd generate-rd-table enable
 anycast-gateway enable
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 10.6.1.2 255.255.255.0
 mpls
 mpls te
#
interface GigabitEthernet<span>0/1/1</span>.1 mode l2
 encapsulation dot1q vid 10
 rewrite pop single
 bridge-domain 10
#
interface GigabitEthernet<span>0/1/1</span>.2 mode l2
 encapsulation dot1q vid 30
 rewrite pop single
 bridge-domain 30
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown  
 ip address 10.6.3.1 255.255.255.0
 mpls
 mpls te
#
interface GigabitEthernet<span>0/1/2</span>.1 mode l2
 encapsulation dot1q vid 20
 rewrite pop single
 bridge-domain 20
#
interface GigabitEthernet<span>0/1/2</span>.2 mode l2
 encapsulation dot1q vid 40
 rewrite pop single
 bridge-domain 40
#
interface GigabitEthernet<span>0/1/3</span>
 undo shutdown
 ip address 10.6.6.1 255.255.255.0
 mpls
 mpls te
#
interface LoopBack1
 ip address 4.4.4.4 255.255.255.255
 ospf prefix-sid index 40
#
interface LoopBack2
 ip binding vpn-instance vpn1
 ipv6 enable
 ipv6 address 2001:DB8:44::44/128
#
interface Tunnel1
 ip address unnumbered interface LoopBack1
 tunnel-protocol mpls te
 destination 1.1.1.1
 mpls te signal-protocol segment-routing
 mpls te tunnel-id 1
 mpls te path explicit-path DtoL41
#
interface Tunnel2
 ip address unnumbered interface LoopBack1
 tunnel-protocol mpls te
 destination 2.2.2.2
 mpls te signal-protocol segment-routing
 mpls te tunnel-id 2
 mpls te path explicit-path DtoL42
#
interface Tunnel7
 ip address unnumbered interface LoopBack1
 tunnel-protocol mpls te
 destination 7.7.7.7
 mpls te signal-protocol segment-routing
 mpls te tunnel-id 7
 mpls te path explicit-path DtoP47
#
interface Tunnel8
 ip address unnumbered interface LoopBack1
 tunnel-protocol mpls te
 destination 8.8.8.8
 mpls te signal-protocol segment-routing
 mpls te tunnel-id 8
 mpls te path explicit-path DtoP48
#
bgp 100
 peer 1.1.1.1 as-number 100
 peer 1.1.1.1 connect-interface LoopBack1
 peer 2.2.2.2 as-number 100
 peer 2.2.2.2 connect-interface LoopBack1
 peer 3.3.3.3 as-number 100
 peer 3.3.3.3 connect-interface LoopBack1
 peer 7.7.7.7 as-number 200
 peer 7.7.7.7 ebgp-max-hop 255
 peer 7.7.7.7 connect-interface LoopBack1
 peer 7.7.7.7 egress-engineering
 peer 8.8.8.8 as-number 200
 peer 8.8.8.8 ebgp-max-hop 255
 peer 8.8.8.8 connect-interface LoopBack1
 peer 8.8.8.8 egress-engineering
 #
 ipv4-family unicast
  undo synchronization
  network 10.6.1.0 255.255.255.0
  network 10.6.5.0 255.255.255.0
  import-route static
  import-route ospf 100
  peer 1.1.1.1 enable
  peer 2.2.2.2 enable
  peer 3.3.3.3 enable
  peer 7.7.7.7 enable
  peer 8.8.8.8 enable
 #
 link-state-family unicast
 #
 ipv6-family vpnv6
  policy vpn-target
  peer 7.7.7.7 enable
  peer 7.7.7.7 advertise route-reoriginated evpn ipv6  
  peer 8.8.8.8 enable
  peer 8.8.8.8 advertise route-reoriginated evpn ipv6
 #
 ipv6-family vpn-instance vpn1
  network :: 0
  import-route direct
  maximum load-balancing 16
  advertise l2vpn evpn
  peer 2001:DB8:5::5 as-number 100
  peer 2001:DB8:5::5 connect-interface LoopBack2
  peer 2001:DB8:5::5 route-policy p1 export
  peer 2001:DB8:6::6 as-number 100
  peer 2001:DB8:6::6 connect-interface LoopBack2
  peer 2001:DB8:6::6 route-policy p1 export
 #
 l2vpn-family evpn
  undo policy vpn-target
  peer 1.1.1.1 enable
  peer 1.1.1.1 capability-advertise add-path both
  peer 1.1.1.1 advertise add-path path-number 16
  peer 1.1.1.1 import reoriginate
  peer 2.2.2.2 enable
  peer 2.2.2.2 capability-advertise add-path both
  peer 2.2.2.2 advertise add-path path-number 16
  peer 2.2.2.2 import reoriginate
  peer 3.3.3.3 enable
  peer 3.3.3.3 route-policy stopuIP export
#
ospf 100
 opaque-capability enable
 segment-routing mpls
 segment-routing global-block 160000 161000
 area 0.0.0.0
  network 4.4.4.4 0.0.0.0
  network 10.6.1.0 0.0.0.255
  network 10.6.3.0 0.0.0.255
  mpls-te enable
#
ip ipv6-prefix lp index 10 permit 2001:DB8:44::44 128
ip ipv6-prefix uIP index 10 permit 2001:DB8:10::10 128
#
route-policy dp permit node 10
 if-match tag 2000
#
route-policy dp permit node 15
 if-match ipv6 address prefix-list lp
#
route-policy p1 deny node 10
#
route-policy stopuIP deny node 10
 if-match ipv6 address prefix-list uIP
#
route-policy stopuIP permit node 20
#
ip route-static 7.7.7.7 255.255.255.255 10.6.1.1
ip route-static 8.8.8.8 255.255.255.255 10.6.6.2
#
ipv6 route-static vpn-instance vpn1 :: 0 NULL0 tag 2000
#
tunnel-policy srte
 tunnel select-seq sr-te load-balance-number 3
#
return</pre>
</li><li><p>L2GW/L3GW1 configuration file</p>
<pre class="screen">#
sysname L2GW/L3GW1
#
lacp e-trunk system-id 00e0-fc00-0002
lacp e-trunk priority 1
#
evpn
 vlan-extend private enable
 vlan-extend redirect enable
 local-remote frr enable
 #
 mac-duplication
#
evpn vpn-instance evrf1 bd-mode
 route-distinguisher 1:1
 vpn-target 1:1 export-extcommunity
 vpn-target 1:1 import-extcommunity
#
evpn vpn-instance evrf2 bd-mode
 route-distinguisher 2:2
 vpn-target 2:2 export-extcommunity
 vpn-target 2:2 import-extcommunity
#
evpn vpn-instance evrf3 bd-mode
 route-distinguisher 3:3
 vpn-target 3:3 export-extcommunity
 vpn-target 3:3 import-extcommunity
#
evpn vpn-instance evrf4 bd-mode
 route-distinguisher 4:4
 vpn-target 4:4 export-extcommunity
 vpn-target 4:4 import-extcommunity
#
ip vpn-instance vpn1
 ipv6-family
  route-distinguisher 11:11
<span>  apply-label per-instance</span>
  export route-policy sp evpn
  vpn-target 11:1 export-extcommunity evpn
  vpn-target 11:1 import-extcommunity evpn
  tnl-policy srte evpn
  evpn mpls routing-enable
#
mpls lsr-id 1.1.1.1
#
mpls
 mpls te
#
bridge-domain 10
 evpn binding vpn-instance evrf1
#
bridge-domain 20
 evpn binding vpn-instance evrf2
#
bridge-domain 30
 evpn binding vpn-instance evrf3
#
bridge-domain 40
 evpn binding vpn-instance evrf4
#
explicit-path LtoD13
 next sid label 48002 type adjacency
#
explicit-path LtoD14
 next sid label 48003 type adjacency
 next sid label 48003 type adjacency
#
explicit-path LtoL
 next sid label 48003 type adjacency
#
e-trunk 1
 priority 5
 peer-address 2.2.2.2 source-address 1.1.1.1
#
segment-routing
#
interface Vbdif10
 ip binding vpn-instance vpn1
 ipv6 enable
 ipv6 address 2001:DB8:1::1/64
 mac-address 00e0-fc00-0003
 ipv6 nd dad attempts 0
 ipv6 nd collect host enable
 ipv6 nd generate-rd-table enable
 anycast-gateway enable
#
interface Vbdif20
 ip binding vpn-instance vpn1
 ipv6 enable
 ipv6 address 2001:DB8:2::1/64
 mac-address 00e0-fc00-0004
 ipv6 nd dad attempts 0
 ipv6 nd collect host enable
 ipv6 nd generate-rd-table enable
 anycast-gateway enable
#
interface Vbdif30
 ip binding vpn-instance vpn1
 ipv6 enable
 ipv6 address 2001:DB8:3::1/64
 mac-address 00e0-fc00-0001
 ipv6 nd dad attempts 0
 ipv6 nd collect host enable
 ipv6 nd generate-rd-table enable
 anycast-gateway enable
#
interface Vbdif40
 ip binding vpn-instance vpn1
 ipv6 enable
 ipv6 address 2001:DB8:4::1/64
 mac-address 00e0-fc00-0005
 ipv6 nd dad attempts 0
 ipv6 nd collect host enable
 ipv6 nd generate-rd-table enable
 anycast-gateway enable
#
interface Eth-Trunk10
 mode lacp-static
 e-trunk 1
 e-trunk mode force-master
 esi 0000.1111.1111.1111.1111
#
interface Eth-Trunk10.1 mode l2
 encapsulation dot1q vid 10
 rewrite pop single
 bridge-domain 10
#
interface Eth-Trunk20
 mode lacp-static
 e-trunk 1
 e-trunk mode force-master
 esi 0000.2222.2222.2222.2222
#
interface Eth-Trunk20.1 mode l2
 encapsulation dot1q vid 20
 rewrite pop single
 bridge-domain 20
#
interface Eth-Trunk30
 mode lacp-static
 e-trunk 1
 e-trunk mode force-master
 esi 0000.3333.3333.3333.3333
#
interface Eth-Trunk30.1 mode l2
 encapsulation dot1q vid 30
 rewrite pop single
 bridge-domain 30
#
interface Eth-Trunk40
 mode lacp-static
 e-trunk 1
 e-trunk mode force-master
 esi 0000.4444.4444.4444.4444
#
interface Eth-Trunk40.1 mode l2
 encapsulation dot1q vid 40
 rewrite pop single
 bridge-domain 40
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 10.6.4.1 255.255.255.0
 mpls
 mpls te
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ip address 10.6.2.2 255.255.255.0
 mpls
 mpls te
#
interface GigabitEthernet<span>0/1/3</span>
 undo shutdown
 eth-trunk 10
#
interface GigabitEthernet<span>0/1/4</span>
 undo shutdown
 eth-trunk 20
#
interface GigabitEthernet<span>0/1/5</span>
 undo shutdown
 eth-trunk 30
#
interface GigabitEthernet<span>0/1/6</span>
 undo shutdown
 eth-trunk 40
#
interface LoopBack1
 ip address 1.1.1.1 255.255.255.255
 ospf prefix-sid index 10
#
interface Tunnel1
 ip address unnumbered interface LoopBack1
 tunnel-protocol mpls te
 destination 3.3.3.3
 mpls te signal-protocol segment-routing
 mpls te tunnel-id 1
 mpls te path explicit-path LtoD13
#
interface Tunnel2
 ip address unnumbered interface LoopBack1
 tunnel-protocol mpls te
 destination 4.4.4.4
 mpls te signal-protocol segment-routing
 mpls te tunnel-id 2
 mpls te path explicit-path LtoD14
#
interface Tunnel3
 ip address unnumbered interface LoopBack1
 tunnel-protocol mpls te
 destination 2.2.2.2
 mpls te signal-protocol segment-routing
 mpls te tunnel-id 3
 mpls te path explicit-path LtoL
#
bgp 100
 peer 2.2.2.2 as-number 100
 peer 2.2.2.2 connect-interface LoopBack1
 peer 3.3.3.3 as-number 100
 peer 3.3.3.3 connect-interface LoopBack1
 peer 4.4.4.4 as-number 100
 peer 4.4.4.4 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 2.2.2.2 enable
  peer 3.3.3.3 enable
  peer 4.4.4.4 enable
 #
 ipv6-family vpn-instance vpn1
  import-route direct
  import-route static
  maximum load-balancing 16  
  advertise l2vpn evpn import-route-multipath
 #              
 l2vpn-family evpn
  undo policy vpn-target
  bestroute add-path path-number 16
  peer 2.2.2.2 enable
  peer 2.2.2.2 advertise nd
  peer 3.3.3.3 enable
  peer 3.3.3.3 advertise nd
  peer 3.3.3.3 capability-advertise add-path both
  peer 3.3.3.3 advertise add-path path-number 16
  peer 4.4.4.4 enable
  peer 4.4.4.4 advertise nd
  peer 4.4.4.4 capability-advertise add-path both
  peer 4.4.4.4 advertise add-path path-number 16
#
ospf 100
 opaque-capability enable
 segment-routing mpls
 segment-routing global-block 160000 161000
 area 0.0.0.0
  network 1.1.1.1 0.0.0.0
  network 10.6.2.0 0.0.0.255
  network 10.6.4.0 0.0.0.255
  mpls-te enable
#
route-policy sp permit node 10
 if-match tag 1000
 apply ipv6 gateway-ip origin-nexthop
#
route-policy sp deny node 20
#
ipv6 route-static vpn-instance vpn1 2001:DB8:5::5 128 2001:DB8:1::2 preference 255 tag 1000 inter-protocol-ecmp
ipv6 route-static vpn-instance vpn1 2001:DB8:5::5 128 2001:DB8:2::2 preference 255 tag 1000 inter-protocol-ecmp
ipv6 route-static vpn-instance vpn1 2001:DB8:6::6 128 2001:DB8:3::2 preference 255 tag 1000 inter-protocol-ecmp
ipv6 route-static vpn-instance vpn1 2001:DB8:6::6 128 2001:DB8:4::2 preference 255 tag 1000 inter-protocol-ecmp
#
tunnel-policy srte
 tunnel select-seq sr-te load-balance-number 3
#
evpn source-address 1.1.1.1
#
return</pre>
</li><li><p>L2GW/L3GW2 configuration file</p>
<pre class="screen">#
sysname L2GW/L3GW2
#
lacp e-trunk system-id 00e0-fc00-0002
lacp e-trunk priority 1
#
evpn
 vlan-extend private enable
 vlan-extend redirect enable
 local-remote frr enable
 #
 mac-duplication
#
evpn vpn-instance evrf1 bd-mode
 route-distinguisher 1:1
 vpn-target 1:1 export-extcommunity
 vpn-target 1:1 import-extcommunity
#               
evpn vpn-instance evrf2 bd-mode
 route-distinguisher 2:2
 vpn-target 2:2 export-extcommunity
 vpn-target 2:2 import-extcommunity
#
evpn vpn-instance evrf3 bd-mode
 route-distinguisher 3:3
 vpn-target 3:3 export-extcommunity
 vpn-target 3:3 import-extcommunity
#
evpn vpn-instance evrf4 bd-mode
 route-distinguisher 4:4
 vpn-target 4:4 export-extcommunity
 vpn-target 4:4 import-extcommunity
#
ip vpn-instance vpn1
 ipv6-family
  route-distinguisher 22:22
<span>  apply-label per-instance</span>
  export route-policy sp evpn
  vpn-target 11:1 export-extcommunity evpn
  vpn-target 11:1 import-extcommunity evpn
  tnl-policy srte evpn
  evpn mpls routing-enable
#
mpls lsr-id 2.2.2.2
#
mpls
 mpls te
#
bridge-domain 10
 evpn binding vpn-instance evrf1
#
bridge-domain 20
 evpn binding vpn-instance evrf2
#
bridge-domain 30
 evpn binding vpn-instance evrf3
#
bridge-domain 40
 evpn binding vpn-instance evrf4
#
explicit-path LtoD23
 next sid label 48004 type adjacency
 next sid label 48002 type adjacency
#
explicit-path LtoD24
 next sid label 48003 type adjacency
#
explicit-path LtoL
 next sid label 48004 type adjacency
#
e-trunk 1
 priority 5
 peer-address 1.1.1.1 source-address 2.2.2.2
#
segment-routing
#
interface Vbdif10
 ip binding vpn-instance vpn1
 ipv6 enable
 ipv6 address 2001:DB8:1::1/64
 mac-address 00e0-fc00-0003
 ipv6 nd dad attempts 0
 ipv6 nd collect host enable
 ipv6 nd generate-rd-table enable
 anycast-gateway enable
#
interface Vbdif20
 ip binding vpn-instance vpn1
 ipv6 enable
 ipv6 address 2001:DB8:2::1/64
 mac-address 00e0-fc00-0004
 ipv6 nd dad attempts 0
 ipv6 nd collect host enable
 ipv6 nd generate-rd-table enable
 anycast-gateway enable
#
interface Vbdif30
 ip binding vpn-instance vpn1
 ipv6 enable
 ipv6 address 2001:DB8:3::1/64
 mac-address 00e0-fc00-0001
 ipv6 nd dad attempts 0
 ipv6 nd collect host enable
 ipv6 nd generate-rd-table enable
 anycast-gateway enable
#
interface Vbdif40
 ip binding vpn-instance vpn1
 ipv6 enable
 ipv6 address 2001:DB8:4::1/64
 mac-address 00e0-fc00-0005
 ipv6 nd dad attempts 0
 ipv6 nd collect host enable
 ipv6 nd generate-rd-table enable
 anycast-gateway enable
#
interface Eth-Trunk10
 mode lacp-static
 e-trunk 1
 e-trunk mode force-master
 esi 0000.1111.1111.1111.1111
#
interface Eth-Trunk10.1 mode l2
 encapsulation dot1q vid 10
 rewrite pop single
 bridge-domain 10
#
interface Eth-Trunk20
 mode lacp-static
 e-trunk 1
 e-trunk mode force-master
 esi 0000.2222.2222.2222.2222
#
interface Eth-Trunk20.1 mode l2
 encapsulation dot1q vid 20
 rewrite pop single
 bridge-domain 20
#
interface Eth-Trunk30
 mode lacp-static
 e-trunk 1
 e-trunk mode force-master
 esi 0000.3333.3333.3333.3333
#
interface Eth-Trunk30.1 mode l2
 encapsulation dot1q vid 30
 rewrite pop single
 bridge-domain 30
#
interface Eth-Trunk40
 mode lacp-static
 e-trunk 1
 e-trunk mode force-master
 esi 0000.4444.4444.4444.4444
#
interface Eth-Trunk40.1 mode l2
 encapsulation dot1q vid 40
 rewrite pop single
 bridge-domain 40
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 10.6.4.2 255.255.255.0
 mpls
 mpls te
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ip address 10.6.3.2 255.255.255.0
 mpls
 mpls te
#
interface GigabitEthernet<span>0/1/3</span>
 undo shutdown
 eth-trunk 10
#               
interface GigabitEthernet<span>0/1/4</span>
 undo shutdown
 eth-trunk 20
#
interface GigabitEthernet<span>0/1/5</span>
 undo shutdown
 eth-trunk 30
#
interface GigabitEthernet<span>0/1/6</span>
 undo shutdown
 eth-trunk 40
#
interface LoopBack1
 ip address 2.2.2.2 255.255.255.255
 ospf prefix-sid index 20
#
interface Tunnel1
 ip address unnumbered interface LoopBack1
 tunnel-protocol mpls te
 destination 3.3.3.3
 mpls te signal-protocol segment-routing
 mpls te tunnel-id 1
 mpls te path explicit-path LtoD23
#
interface Tunnel2
 ip address unnumbered interface LoopBack1
 tunnel-protocol mpls te
 destination 4.4.4.4
 mpls te signal-protocol segment-routing
 mpls te tunnel-id 2
 mpls te path explicit-path LtoD24  
#
interface Tunnel3
 ip address unnumbered interface LoopBack1
 tunnel-protocol mpls te
 destination 1.1.1.1
 mpls te signal-protocol segment-routing
 mpls te tunnel-id 3
 mpls te path explicit-path LtoL
#
bgp 100
 peer 1.1.1.1 as-number 100
 peer 1.1.1.1 connect-interface LoopBack1
 peer 3.3.3.3 as-number 100
 peer 3.3.3.3 connect-interface LoopBack1
 peer 4.4.4.4 as-number 100
 peer 4.4.4.4 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 1.1.1.1 enable
  peer 3.3.3.3 enable
  peer 4.4.4.4 enable
 #
 ipv6-family vpn-instance vpn1
  import-route direct
  import-route static
  maximum load-balancing 16  
  advertise l2vpn evpn import-route-multipath
 #              
 l2vpn-family evpn
  undo policy vpn-target
  bestroute add-path path-number 16
  peer 1.1.1.1 enable
  peer 1.1.1.1 advertise nd
  peer 3.3.3.3 enable
  peer 3.3.3.3 advertise nd
  peer 3.3.3.3 capability-advertise add-path both
  peer 3.3.3.3 advertise add-path path-number 16
  peer 4.4.4.4 enable
  peer 4.4.4.4 advertise nd
  peer 4.4.4.4 capability-advertise add-path both
  peer 4.4.4.4 advertise add-path path-number 16
#
ospf 100
 opaque-capability enable
 segment-routing mpls
 segment-routing global-block 160000 161000
 area 0.0.0.0
  network 2.2.2.2 0.0.0.0
  network 10.6.3.0 0.0.0.255
  network 10.6.4.0 0.0.0.255
  mpls-te enable
#
route-policy sp permit node 10
 if-match tag 1000
 apply ipv6 gateway-ip origin-nexthop
#
ipv6 route-static vpn-instance vpn1 2001:DB8:5::5 128 2001:DB8:1::2 preference 255 tag 1000 inter-protocol-ecmp
ipv6 route-static vpn-instance vpn1 2001:DB8:5::5 128 2001:DB8:2::2 preference 255 tag 1000 inter-protocol-ecmp
ipv6 route-static vpn-instance vpn1 2001:DB8:6::6 128 2001:DB8:3::2 preference 255 tag 1000 inter-protocol-ecmp
ipv6 route-static vpn-instance vpn1 2001:DB8:6::6 128 2001:DB8:4::2 preference 255 tag 1000 inter-protocol-ecmp
#
tunnel-policy srte
 tunnel select-seq sr-te load-balance-number 3
#
evpn source-address 2.2.2.2
#
return</pre>
</li><li><p>VNF1 configuration file</p>
<p>For details, see the configuration file of the corresponding product.</p>
</li><li><p>VNF2 configuration file</p>
<p>For details, see the configuration file of the corresponding product.</p>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0010.html">EVPN Configuration Examples
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0127.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0138.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>