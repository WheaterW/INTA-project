
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring EVPN VPWS over MPLS/EVPN VPWS over SRv6 Dual-Stack Tunnels">
<meta name="abstract" content="In IPv4/IPv6 dual-stack scenarios, you can configure EVPN VPWS over MPLS/EVPN VPWS over SRv6 dual-stack tunnels to prevent traffic interruption caused by direct switching from an IPv4 MPLS network to an SRv6 network.">
<meta name="description" content="In IPv4/IPv6 dual-stack scenarios, you can configure EVPN VPWS over MPLS/EVPN VPWS over SRv6 dual-stack tunnels to prevent traffic interruption caused by direct switching from an IPv4 MPLS network to an SRv6 network.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0000.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0240.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0188.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="p00915595">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00878323">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001150003980">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring EVPN VPWS over MPLS/EVPN VPWS over SRv6 Dual-Stack Tunnels</title>
</head>
<body><a name="EN-US_TASK_0000001150003980"></a><a name="EN-US_TASK_0000001150003980"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring EVPN VPWS over MPLS/EVPN VPWS over SRv6 Dual-Stack Tunnels</h1>
<div class="taskbody" id="taskbody0000001150003980"><p id="en-us_task_0179342422_shortdesc938385501214049">In IPv4/IPv6 dual-stack scenarios, you can configure EVPN VPWS over MPLS/EVPN VPWS over SRv6 dual-stack tunnels to prevent traffic interruption caused by direct switching from an IPv4 MPLS network to an SRv6 network.</p>
<div class="context"><a name="EN-US_TASK_0000001150003980__1.4.1"></a><a name="1.4.1"></a>
<div class="p" id="EN-US_TASK_0000001150003980__en-us_task_0179342422_context181470335214049"><h4 class="sectiontitle">Usage Scenario</h4><p id="EN-US_TASK_0000001150003980__p173005615473">As IPv4 addresses are gradually depleted, the deployment of IPv6 networks has become a trend. However, network evolution cannot be completed at once, and IPv4 and IPv6 services will coexist for some time.</p>
<p id="EN-US_TASK_0000001150003980__p04592093917">EVPN over SRv6 is today's mainstream transport solution for 5G services. To prevent live network services from being affected, a new transport solution must be deployed based on these services. In a scenario where a large number of EVPN VPWS over MPLS services exist on the live network, to prevent traffic interruption caused by direct switching from the IPv4 MPLS network to an SRv6 network (IPv4 and IPv6 networks coexist), configure IPv4/IPv6 dual-stack. This facilitates evolution from EVPN VPWS over MPLS to EVPN VPWS over SRv6.</p>
<p id="EN-US_TASK_0000001150003980__p1045834619422">On the network shown in <a href="#EN-US_TASK_0000001150003980__fig79406277579">Figure 1</a>, the transition process is essentially as follows:</p>
<ol id="EN-US_TASK_0000001150003980__ol162393119816"><li id="EN-US_TASK_0000001150003980__li62313311288">Initially, IPv4 MPLS is configured on the public network, and only EVPN VPWS over MPLS services exist.</li><li id="EN-US_TASK_0000001150003980__li12310311989">During the transition, EVPN VPWS over MPLS and EVPN VPWS over SRv6 dual-stack tunnels coexist. Routes are selected based on the priorities of next hop addresses. PEs preferentially select SRv6 EVPN routes.</li><li id="EN-US_TASK_0000001150003980__li723103114816">Finally, IPv4 MPLS is deleted from the public network, and only EVPN VPWS over SRv6 services remain.</li></ol>
<div class="fignone" id="EN-US_TASK_0000001150003980__fig79406277579"><a name="EN-US_TASK_0000001150003980__fig79406277579"></a><a name="fig79406277579"></a><span class="figcap"><b>Figure 1 </b>EVPN VPWS over MPLS/EVPN VPWS over SRv6 dual-stack tunnels</span><br><span><img class="vsd" id="EN-US_TASK_0000001150003980__image420302214577" src="figure/en-us_image_0000001232368545.png" width="NaN" height="NaN"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001150003980__1.4.2"></a><a name="1.4.2"></a>
<div class="p" id="EN-US_TASK_0000001150003980__en-us_task_0179342422_context1210194704214049"><h4 class="sectiontitle">Pre-configuration Tasks</h4><p id="EN-US_TASK_0000001150003980__p141152517214050">Before configuring EVPN VPWS over MPLS/EVPN VPWS over SRv6 dual-stack tunnels, complete the following tasks:</p>
<ul id="EN-US_TASK_0000001150003980__ul06801829152219"><li id="EN-US_TASK_0000001150003980__li14233132319238">Configure Layer 3 route reachability on the IPv4 network.</li><li id="EN-US_TASK_0000001150003980__li16663152913234">Configure IPv6 IS-IS on the PEs and P. For detailed configurations, see <a href="dc_vrp_isis_cfg_1023.html">Configuring Basic IS-IS Functions (IPv6)</a>.</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001150003980__1.4.3"></a><a name="1.4.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol id="EN-US_TASK_0000001150003980__en-us_task_0179342422_steps1464562016214049"><li id="EN-US_TASK_0000001150003980__step1362946058214032"><span id="EN-US_TASK_0000001150003980__cmd1973817904214032">Configure EVPN VPWS over MPLS between PEs. For detailed configurations, see <a href="dc_vrp_evpn_cfg_0020.html">Configuring EVPN VPWS over MPLS</a>.</span><p><div class="note" id="EN-US_TASK_0000001150003980__note12144202823618"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><div class="p" id="EN-US_TASK_0000001150003980__p6833761354">If an RR exists on the network, perform the following configurations on the RR and PEs:<blockquote id="EN-US_TASK_0000001150003980__lq134859187413">1. To enable PEs to receive all routes from IPv4 and IPv6 peers, configure the Add-Path function:</blockquote>
<blockquote id="EN-US_TASK_0000001150003980__lq1517562744114">a. Run the <a href="cmdqueryname=bestroute+add-path"><b><span class="cmdname" id="EN-US_TASK_0000001150003980__cmdname177021124214038">bestroute add-path</span></b></a> <strong><span id="EN-US_TASK_0000001150003980__cmdparmname104747518285">path-number</span></strong> <i><span class="varname" id="EN-US_TASK_0000001150003980__varname17474115117280">path-number</span></i>, <a href="cmdqueryname=peer"><b><span class="cmdname" id="EN-US_TASK_0000001150003980__cmdname1856764737214038">peer</span></b></a> { <i><span class="varname" id="EN-US_TASK_0000001150003980__varname1147405122817">ipv4-address</span></i> | <i><span class="varname" id="EN-US_TASK_0000001150003980__varname1447417513285">ipv6-address</span></i> | <i><span class="varname" id="EN-US_TASK_0000001150003980__varname6474155119289">group-name</span></i> } <strong><span id="EN-US_TASK_0000001150003980__cmdparmname4474185114286">capability-advertise</span></strong> <strong><span id="EN-US_TASK_0000001150003980__cmdparmname16474851102815">add-path</span></strong> <strong><span id="EN-US_TASK_0000001150003980__cmdparmname4475165192817">send</span></strong>, and <a href="cmdqueryname=peer"><b><span class="cmdname" id="EN-US_TASK_0000001150003980__cmdname1680411108233">peer</span></b></a> { <i><span class="varname" id="EN-US_TASK_0000001150003980__varname04753519281">ipv4-address</span></i> | <i><span class="varname" id="EN-US_TASK_0000001150003980__varname10475195111281">ipv6-address</span></i> | <i><span class="varname" id="EN-US_TASK_0000001150003980__varname134756513288">group-name</span></i> } <strong><span id="EN-US_TASK_0000001150003980__cmdparmname64751951112818">advertise add-path path-number</span></strong> <i><span class="varname" id="EN-US_TASK_0000001150003980__varname947514512287">number</span></i> commands in the EVPN address family view of the RR.</blockquote>
<blockquote id="EN-US_TASK_0000001150003980__lq198913248535">b. Run the <a href="cmdqueryname=peer"><b><span class="cmdname" id="EN-US_TASK_0000001150003980__cmdname1606452509214038">peer</span></b></a> { <i><span class="varname" id="EN-US_TASK_0000001150003980__varname5458185482817">ipv4-address</span></i> | <i><span class="varname" id="EN-US_TASK_0000001150003980__varname14458115410283">ipv6-address</span></i> | <i><span class="varname" id="EN-US_TASK_0000001150003980__varname7458105419282">group-name</span></i> } <strong><span id="EN-US_TASK_0000001150003980__cmdparmname3459254112818">capability-advertise</span></strong> <strong><span id="EN-US_TASK_0000001150003980__cmdparmname7459155422813">add-path</span></strong> <strong><span id="EN-US_TASK_0000001150003980__cmdparmname44599542287">receive</span></strong> command in the EVPN address family view of each PE to enable the function to receive Add-Path routes from a specified peer.</blockquote>
<blockquote id="EN-US_TASK_0000001150003980__lq8131156932">2. In an Option B scenario, to ensure service continuity, run the <a href="cmdqueryname=peer"><b><span class="cmdname" id="EN-US_TASK_0000001150003980__cmdname1689624251214055">peer</span></b></a> <i><span class="varname" id="EN-US_TASK_0000001150003980__varname710955752816">peerIpv4Addr</span></i> <strong><span id="EN-US_TASK_0000001150003980__cmdparmname81091757112820">high-priority</span></strong> command in the EVPN address family view of the RR to control route priorities.</blockquote>
</div>
</div></div>
</p></li><li id="EN-US_TASK_0000001150003980__step2545115873620"><span id="EN-US_TASK_0000001150003980__cmd11545145853620">Configure priority-based route selection on PEs.</span><p><ol type="a" id="EN-US_TASK_0000001150003980__ol6545358153613"><li id="EN-US_TASK_0000001150003980__li7545958183620"><p id="EN-US_TASK_0000001150003980__p20545165816361"><a name="EN-US_TASK_0000001150003980__li7545958183620"></a><a name="li7545958183620"></a>Run the <a href="cmdqueryname=system-view"><b><span class="cmdname" id="EN-US_TASK_0000001150003980__cmdname15545125817361">system-view</span></b></a> command to enter the system view.</p>
</li><li id="EN-US_TASK_0000001150003980__li8545958143610">Run the <a href="cmdqueryname=evpn+vpn-instance"><b><span class="cmdname" id="EN-US_TASK_0000001150003980__cmdname6545145817366">evpn vpn-instance</span></b></a> <i><span class="varname" id="EN-US_TASK_0000001150003980__varname2545175803615">vpn-instance-name</span></i> <strong><span id="EN-US_TASK_0000001150003980__cmdparmname155458589369">vpws</span></strong> command to enter the view of an existing VPWS EVPN instance.</li><li id="EN-US_TASK_0000001150003980__li115451958193617">Run the <a href="cmdqueryname=bestroute+nexthop-priority"><b><span class="cmdname" id="EN-US_TASK_0000001150003980__cmdname95458586366">bestroute nexthop-priority </span></b></a><strong><span id="EN-US_TASK_0000001150003980__cmdparmname454518587366">ipv6</span></strong><strong><span id="EN-US_TASK_0000001150003980__cmdparmname1812915340371"> high-level</span></strong> command to configure the device to prefer the routes with IPv6 next hop addresses after the routes learned from IPv4 or IPv6 peers are leaked into the EVPN instance.</li><li id="EN-US_TASK_0000001150003980__li2717155311447">Run the <a href="cmdqueryname=srv6-local-route+advertise-to-mpls"><b><span class="cmdname" id="EN-US_TASK_0000001150003980__cmdname1699255710442">srv6-local-route advertise-to-mpls </span></b></a><strong><span id="EN-US_TASK_0000001150003980__cmdparmname106307222196">enable</span></strong> command to enable the function to advertise locally generated SRv6 routes to both BGP EVPN IPv4 and BGP EVPN IPv6 peers.</li><li id="EN-US_TASK_0000001150003980__li1654516583360">Run the <a href="cmdqueryname=quit"><b><span class="cmdname" id="EN-US_TASK_0000001150003980__cmdname9545155820363">quit</span></b></a> command to return to the system view.</li><li id="EN-US_TASK_0000001150003980__li1545135853618"><p id="EN-US_TASK_0000001150003980__p7545175873611"><a name="EN-US_TASK_0000001150003980__li1545135853618"></a><a name="li1545135853618"></a>Run the <a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001150003980__cmdname5545115873610">commit</span></b></a> command to commit the configuration.</p>
<div class="note" id="EN-US_TASK_0000001150003980__note25623419288"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><ul id="EN-US_TASK_0000001150003980__ul66001457196"><li id="EN-US_TASK_0000001150003980__li1260011571914">In a scenario where IPv4 services smoothly evolve to IPv6 services, to ensure service continuity, run the <a href="cmdqueryname=srv6-local-route+advertise-to-mpls"><b><span class="cmdname" id="EN-US_TASK_0000001150003980__cmdname03584910229">srv6-local-route advertise-to-mpls </span></b></a><strong><span id="EN-US_TASK_0000001150003980__cmdparmname10359294221">enable</span></strong> command to enable the device to advertise BGP EVPN routes carrying SIDs to both BGP EVPN IPv4 and BGP EVPN IPv6 peers, and then configure EVPN VPWS over SRv6.</li><li id="EN-US_TASK_0000001150003980__li4947424181914">If a large number of EVPN VPWS services on a device need evolution, perform the following operations in the EVPN global view to simplify the configuration.<p id="EN-US_TASK_0000001150003980__p873310159335"><a name="EN-US_TASK_0000001150003980__li4947424181914"></a><a name="li4947424181914"></a>Run the <a href="cmdqueryname=srv6-local-route+advertise-to-mpls"><b><span class="cmdname" id="EN-US_TASK_0000001150003980__cmdname2996619132214">srv6-local-route advertise-to-mpls </span></b></a><strong><span id="EN-US_TASK_0000001150003980__cmdparmname109966195220">evpn-vpws</span></strong> command to enable all VPWS EVPN instances on the device to advertise BGP EVPN routes carrying SIDs to both BGP EVPN IPv4 and BGP EVPN IPv6 peers.</p>
<p id="EN-US_TASK_0000001150003980__p19707125432516">Run the <a href="cmdqueryname=bestroute+nexthop-priority"><b><span class="cmdname" id="EN-US_TASK_0000001150003980__cmdname49241594429">bestroute nexthop-priority</span></b></a> <strong><span id="EN-US_TASK_0000001150003980__cmdparmname1892420919420">ipv6</span></strong> <strong><span id="EN-US_TASK_0000001150003980__cmdparmname1192459154211">high-level</span></strong> command to enable the device to prefer routes with IPv6 next hop addresses when routes learned by all VPWS EVPN instances are leaked locally.</p>
</li></ul>
</div></div>
</li></ol>
</p></li><li id="EN-US_TASK_0000001150003980__step445815117325"><span id="EN-US_TASK_0000001150003980__cmd204582515326">Configure EVPN VPWS over SRv6 between PEs. For detailed configurations, see <a href="dc_vrp_srv6_cfg_all_0021_copy.html">Configuring EVPN VPWS over IS-IS SRv6 BE</a> or <a href="dc_vrp_cfg_evpn-vpws_over_srv6-te_policy_copy.html">Configuring EVPN VPWS over SRv6 TE Policy</a>.</span></li></ol></div>
<div class="postreq"><a name="EN-US_TASK_0000001150003980__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Verifying the Configuration</h4><ul id="EN-US_TASK_0000001150003980__en-us_task_0179342422_ul2120760647214049"><li id="EN-US_TASK_0000001150003980__li865504443214055">Run the <a href="cmdqueryname=display+bgp+evpn+evpl"><b><span class="cmdname" id="EN-US_TASK_0000001150003980__cmdname1848816975215">display bgp evpn evpl</span></b></a> command to check information about all EVPL instances.</li><li id="EN-US_TASK_0000001150003980__li95541625135210">Run the <a href="cmdqueryname=display+bgp+evpn"><b><span class="cmdname" id="EN-US_TASK_0000001150003980__cmdname179574512529">display bgp evpn</span></b></a> { <strong><span id="EN-US_TASK_0000001150003980__cmdparmname69572513527">all</span></strong> | <strong><span id="EN-US_TASK_0000001150003980__cmdparmname49581251185219">route-distinguisher</span></strong> <i><span class="varname" id="EN-US_TASK_0000001150003980__varname13958125195218">route-distinguisher</span></i> | <strong><span id="EN-US_TASK_0000001150003980__cmdparmname395855135213">vpn-instance</span></strong> <i><span class="varname" id="EN-US_TASK_0000001150003980__varname195865135214">vpn-instance-name</span></i> } <strong><span id="EN-US_TASK_0000001150003980__cmdparmname1895820513523">routing-table</span></strong> [ { <strong><span id="EN-US_TASK_0000001150003980__cmdparmname1295825175210">ad-route</span></strong> | <strong><span id="EN-US_TASK_0000001150003980__cmdparmname49581351175219">es-route</span></strong> | <strong><span id="EN-US_TASK_0000001150003980__cmdparmname13958165111528">inclusive-route</span></strong> | <strong><span id="EN-US_TASK_0000001150003980__cmdparmname195885119528">mac-route</span></strong> } <i><span class="varname" id="EN-US_TASK_0000001150003980__varname16958105113524">prefix</span></i> ] command to check BGP EVPN route information.</li><li id="EN-US_TASK_0000001150003980__li1294131740214055">Run the <a href="cmdqueryname=display+segment-routing+ipv6+local-sid"><b><span class="cmdname" id="EN-US_TASK_0000001150003980__cmdname12753705316">display segment-routing ipv6 local-sid</span></b></a> <strong><span id="EN-US_TASK_0000001150003980__cmdparmname1727516715318">end-dx2</span></strong> <strong><span id="EN-US_TASK_0000001150003980__cmdparmname12756715320">evpl-instance</span></strong> <i><span class="varname" id="EN-US_TASK_0000001150003980__varname1275157105311">evpl-id</span></i> <strong><span id="EN-US_TASK_0000001150003980__cmdparmname527515720530">forwarding</span></strong> command to check SRv6 BE local SID table information.</li><li id="EN-US_TASK_0000001150003980__li3103515175314">Run the <a href="cmdqueryname=display+evpn+vpn-instance"><b><span class="cmdname" id="EN-US_TASK_0000001150003980__cmdname149641516125414">display evpn vpn-instance</span></b></a> [ <strong id="EN-US_TASK_0000001150003980__b0964121665412">name </strong><i><span class="varname" id="EN-US_TASK_0000001150003980__varname2018843111597">vpn-instance-name</span></i> ] <strong id="EN-US_TASK_0000001150003980__b1896412166544">tunnel-info</strong> command to check information about the tunnel associated with an EVPN instance.</li><li id="EN-US_TASK_0000001150003980__li01537725412">Run the <a href="cmdqueryname=display+evpn+vpn-instance+name"><b><span class="cmdname" id="EN-US_TASK_0000001150003980__cmdname65881427195417">display evpn vpn-instance name</span></b></a><strong id="EN-US_TASK_0000001150003980__b5666101110419"> </strong><i><span class="varname" id="EN-US_TASK_0000001150003980__varname466618118412">vpn-instance-name</span></i> <strong id="EN-US_TASK_0000001150003980__b1858819273542">tunnel-info</strong><strong id="EN-US_TASK_0000001150003980__b14588727115417"> nexthop</strong><em id="EN-US_TASK_0000001150003980__i15881327175413"> <i><span class="varname" id="EN-US_TASK_0000001150003980__varname191979341607">nexthopIpv6Addr</span></i></em> command to check information about the tunnel that is associated with a specified EVPN instance and matches a specified next hop.</li></ul>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0000.html">EVPN Configuration
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0240.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0188.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>