
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring Delayed Resending of MAC-Withdraw Messages">
<meta name="abstract" content="This section describes how to configure delayed resending of MAC-Withdraw messages. This configuration allows a device to resend a MAC-Withdraw message to the peer PE after a specified delay if the VRRP status changes to backup.">
<meta name="description" content="This section describes how to configure delayed resending of MAC-Withdraw messages. This configuration allows a device to resend a MAC-Withdraw message to the peer PE after a specified delay if the VRRP status changes to backup.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_5018.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_5063.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_5022.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,vpls,w00556928,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="VPLS">
<meta name="featuretype" content="VPN">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="VPLS">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="VPLS">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="VPLS">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="l00415692">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="z00545680">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172370157">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring Delayed Resending of MAC-Withdraw Messages</title>
</head>
<body><a name="EN-US_TASK_0172370157"></a><a name="EN-US_TASK_0172370157"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring Delayed Resending of MAC-Withdraw Messages</h1>
<div class="taskbody"><p>This section describes how to configure delayed resending of MAC-Withdraw messages. This configuration allows a device to resend a MAC-Withdraw message to the peer PE after a specified delay if the VRRP status changes to backup.</p>
<div class="context"><a name="EN-US_TASK_0172370157__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><div class="p">On the network shown in <a href="#EN-US_TASK_0172370157__en-us_cliref_0172382168_fig_dc_vrp_vpls_cfg_500305">Figure 1</a>, the CE is dual-homed to PE1 and PE2. VRRP runs between the PEs, with PE1 functioning as the master device and PE2 the backup device. If the link between the CE and PE1 fails, a master/backup VRRP switchover is performed. PE1 then switches to the backup state, and PE2 transits to the master state. After the link between the CE and PE1 recovers, a master/backup VRRP switchback is performed if the VRRP group works in preemption mode. Then, PE1 returns to the master state, and PE2 to the backup state.<div class="fignone" id="EN-US_TASK_0172370157__en-us_cliref_0172382168_fig_dc_vrp_vpls_cfg_500305"><a name="EN-US_TASK_0172370157__en-us_cliref_0172382168_fig_dc_vrp_vpls_cfg_500305"></a><a name="en-us_cliref_0172382168_fig_dc_vrp_vpls_cfg_500305"></a><span class="figcap"><b>Figure 1 </b>VPLS dual-homing networking</span><br><span><img class="vsd" src="figure/en-us_image_0000001229985187.png" width="NaN" height="NaN"></span><br></div>
Take a master/backup VRRP switchback as an example. When PE2 changes from the master state to the backup state, the PE2 interface connecting to PE3 goes down and sends a MAC Withdraw message to PE3 to clear the corresponding MAC address entries on PE3. Normally, PE3 no longer receives packets forwarded by PE2. Instead, PE3 receives only upstream packets forwarded by the master device PE1, and records the mapping between the CE's MAC address and PW1. However, during the switchback, the interface's forwarding status table on PE2 is updated slowly. As a result, PE2 still sends a few packets to PE3 after the switchback. Upon receipt, PE3 records the mapping between the CE's MAC address and PW2 again. In this case, PE3 incorrectly sends the downstream packets destined for the CE to PE2 through PW2. As a result, packets are lost, and packet forwarding can recover only after the local MAC address entry ages.</div>
<p>To solve this problem, configure delayed resending on PE1 and PE2. After the VRRP status changes to backup and then the specified resending delay elapses, PE2 resends a MAC Withdraw message to PE3 to clear the corresponding MAC address entries on PE3. This ensures that PE3 learns the correct mapping between the CE MAC address and the PW and sends downstream packets to the master device to prevent packet loss.</p>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172370157__1.4.2"></a><a name="1.4.2"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li><span>Run <a href="cmdqueryname=vsi"><b><span class="cmdname">vsi</span></b></a> <i><span class="varname">vsi-name</span></i></span><p><p>The VSI view is displayed.</p>
</p></li><li><span>Run <a href="cmdqueryname=vrrp-backup+mac-withdraw"><b><span class="cmdname">vrrp-backup mac-withdraw</span></b></a> <strong><span>retry-interval</span></strong> <i><span class="varname">retry-interval-time</span></i></span><p><p>Delayed resending of MAC-Withdraw messages is configured.</p>
</p></li><li><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_5018.html">Managing VSI-based MAC Addresses
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_5063.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_5022.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>