
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring a DCI Scenario with EVPN L3VPN over VXLAN Accessing Common L3VPN">
<meta name="abstract" content="The DCI scenario with EVPN L3VPN over VXLAN accessing common L3VPN involves different cloud management platforms, and a VXLAN tunnel is used to access the DCI backbone network.">
<meta name="description" content="The DCI scenario with EVPN L3VPN over VXLAN accessing common L3VPN involves different cloud management platforms, and a VXLAN tunnel is used to access the DCI backbone network.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_dci_cfg_0002.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_dci_cfg_0004.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_dci_cfg_0029.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="wwx1238417">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="c00648116,w00437000">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00878323">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172363953">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring a DCI Scenario with EVPN L3VPN over VXLAN Accessing Common L3VPN</title>
</head>
<body><a name="EN-US_TASK_0172363953"></a><a name="EN-US_TASK_0172363953"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring a DCI Scenario with EVPN L3VPN over VXLAN Accessing Common L3VPN</h1>
<div class="taskbody"><p>The DCI scenario with EVPN L3VPN over VXLAN accessing common L3VPN involves different cloud management platforms, and a VXLAN tunnel is used to access the DCI backbone network.</p>
<div class="context"><a name="EN-US_TASK_0172363953__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>Gateways and DCI-PEs are separately deployed. EVPN is used as the control plane protocol to dynamically establish VXLAN tunnels. A DCI-PE runs EVPN to learn a VM's host IP route information from a DC and uses VPNv4<span>/VPNv6</span> to send received host IP routes to the peer DCI-PE, allowing VM host packets to be forwarded at Layer 3.</p>
<p>In <a href="#EN-US_TASK_0172363953__fig_dc_vrp_dci_cfg_000501">Figure 1</a>, DC gateways GW1 and GW2 connect to the DCI backbone network. To enable inter-DC VM communication, BGP/MPLS IP<span>v4/IPv6</span> VPN functions are deployed on the DCI backbone network, and EVPN and VXLAN tunnels are deployed between the gateways and DCI-PEs to transmit VM host IP routes.</p>
<div class="fignone" id="EN-US_TASK_0172363953__fig_dc_vrp_dci_cfg_000501"><a name="EN-US_TASK_0172363953__fig_dc_vrp_dci_cfg_000501"></a><a name="fig_dc_vrp_dci_cfg_000501"></a><span class="figcap"><b>Figure 1 </b>Configuring a DCI scenario with EVPN L3VPN over VXLAN accessing common L3VPN</span><br><span><img class="vsd" src="images/fig_dc_vrp_dci_cfg_000501.png" width="NaN" height="NaN"></span></div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172363953__1.4.2"></a><a name="1.4.2"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure a VXLAN tunnel between each DCI-PE and the corresponding gateway. For detailed configurations, see <a href="dc_vrp_vxlan_cfg_1216.html">Configuring VXLAN</a>.</span></li><li><span>Configure basic L3VPN functions on the DCI backbone network. For detailed configurations, see <a href="dc_vrp_mpls-l3vpn-v4_cfg_0154.html">Configuring a Basic BGP/MPLS IP VPN</a><span> or <a href="dc_vrp_mpls-l3vpn-v6_cfg_2057.html">Configuring a Basic BGP/MPLS IPv6 VPN</a></span>.</span></li><li><span>Configure DCI-PEs to send routes re-originated in the EVPN address family to a VPNv4<span>/VPNv6</span> peer.</span><ol type="a"><li class="substepexpand"><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=l2vpn-family+evpn"><b><span class="cmdname">l2vpn-family evpn</span></b></a></span></span><p><p>The BGP-EVPN address family view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer+import+reoriginate"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>import</span></strong> <strong><span>reoriginate</span></strong></span><p><p>The device is configured to add a re-origination flag to routes received from a BGP EVPN peer.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span></span><p><p>Return to the BGP view.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ipv4-family"><b><span class="cmdname">ipv4-family</span></b></a> <strong><span>vpnv4</span></strong><span> or <a href="cmdqueryname=ipv6-family"><b><span class="cmdname">ipv6-family</span></b></a> <strong><span>vpnv6</span></strong></span></span><p><p>The BGP-VPNv4<span>/VPNv6</span> address family view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer+advertise+route-reoriginated"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>advertise</span></strong> <strong><span>route-reoriginated</span></strong> <strong><span>evpn</span></strong> { <strong><span>mac-ip</span></strong> | <strong><span>ip</span></strong><span> | <strong><span>mac-ipv6</span></strong> | <strong><span>ipv6</span></strong></span> }</span><p><p>The device is configured to send routes re-originated in the EVPN address family to a VPNv4<span>/VPNv6</span> peer.</p>
<p>After the <a href="cmdqueryname=peer+advertise+route-reoriginated"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>advertise</span></strong> <strong><span>route-reoriginated</span></strong> <strong><span>evpn</span></strong> { <strong><span>mac-ip</span></strong> | <strong><span>ip</span></strong><span> | <strong><span>mac-ipv6</span></strong> | <strong><span>ipv6</span></strong></span> } command is run and EVPN routes received from the DC side and carrying the VXLAN encapsulation attribute are re-originated on the DCI-PE, the DCI-PE advertises VPNv4<span>/VPNv6</span> routes that carry the MPLS encapsulation attribute to the VPNv4<span>/VPNv6</span> peer on the DCI backbone network.</p>
</p></li></ol>
</li><li><span>Configure the DCI-PE to send routes re-originated in the VPNv4<span>/VPNv6</span> address family to a BGP EVPN peer.</span><ol type="a"><li class="substepexpand"><span>Run <span><a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span></span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ipv4-family"><b><span class="cmdname">ipv4-family</span></b></a> <strong><span>vpnv4</span></strong><span> or <a href="cmdqueryname=ipv6-family"><b><span class="cmdname">ipv6-family</span></b></a> <strong><span>vpnv6</span></strong></span></span><p><p>The BGP-VPNv4<span>/VPNv6</span> address family view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer+import+reoriginate"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>import</span></strong> <strong><span>reoriginate</span></strong></span><p><p>The device is configured to add a re-origination flag to routes received from a VPNv4<span>/VPNv6</span> peer.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span></span><p><p>Return to the BGP view.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=l2vpn-family+evpn"><b><span class="cmdname">l2vpn-family evpn</span></b></a></span></span><p><p>The BGP-EVPN address family view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer+advertise+route-reoriginated"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>advertise</span></strong> <strong><span>route-reoriginated</span></strong> <span>{ </span><strong><span>vpnv4</span></strong><span> | <strong><span>vpnv6</span></strong> }</span></span><p><p>The device is configured to send routes re-originated in the VPNv4<span>/VPNv6</span> address family to a BGP EVPN peer.</p>
</p><p><p>After the <a href="cmdqueryname=peer+advertise+route-reoriginated"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>advertise</span></strong> <strong><span>route-reoriginated</span></strong> <span>{ </span><strong><span>vpnv4</span></strong><span> | <strong><span>vpnv6</span></strong> }</span> command is run and VPNv4<span>/VPNv6</span> routes received from the DCI backbone network and carrying the MPLS encapsulation attribute are re-originated on the DCI-PE, the DCI-PE advertises EVPN routes that carry the VXLAN encapsulation attribute to the BGP EVPN peer in the DC.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer+advertise+encap-type"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>advertise encap-type vxlan</span></strong></span><p><p>EVPN routes that carry the VXLAN encapsulation attribute are sent to the EVPN peer on the DC side.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Exit the BGP-EVPN address family view.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Exit the BGP view.</p>
</p></li></ol>
</li><li id="EN-US_TASK_0172363953__step139010580413"><span id="EN-US_TASK_0172363953__cmd14721171334214">(Optional) Configure AC access to the DCI backbone network on the DCI-PE. This enables flexible device deployment on the network.</span><ol type="a" id="EN-US_TASK_0172363953__substeps1264615107424"><li class="substepexpand" id="EN-US_TASK_0172363953__substep772171313421"><span id="EN-US_TASK_0172363953__cmd57212138420">Run <a href="cmdqueryname=evpn"><b><span class="cmdname" id="EN-US_TASK_0172363953__cmdname26321941185419">evpn</span></b></a></span><p><p id="EN-US_TASK_0172363953__p127201711113818">The EVPN global configuration view is displayed.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0172363953__substep29391615164813"><span id="EN-US_TASK_0172363953__cmd49393150488">Run <a href="cmdqueryname=dci+local-route+advertise-to-mpls"><b><span class="cmdname" id="EN-US_TASK_0172363953__cmdname392218055517">dci local-route advertise-to-mpls</span></b></a></span><p><p id="EN-US_TASK_0172363953__p426111973818">The device is enabled to advertise local routes carrying the VXLAN attribute based on the encapsulation type on the peer end.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0172363953__substep1586612331252"><span id="EN-US_TASK_0172363953__cmd208661333102513">Run <a href="cmdqueryname=advertise+vxlan-tunnel+mac"><b><span class="cmdname" id="EN-US_TASK_0172363953__cmdname569782617230">advertise vxlan-tunnel mac</span></b></a></span><p><p id="EN-US_TASK_0172363953__p093616298383">The function to advertise MAC routes learned from the static VXLAN side based on the encapsulation type on the peer end is enabled.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0172363953__substep14267123884913"><span id="EN-US_TASK_0172363953__cmd72676389490">Run <a href="cmdqueryname=quit"><b><span class="cmdname" id="EN-US_TASK_0172363953__cmdname9442736205419">quit</span></b></a></span><p><p id="EN-US_TASK_0172363953__p194281138163811">Exit the EVPN global configuration view.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0172363953__substep1666817595491"><span id="EN-US_TASK_0172363953__cmd866805964919">Run <a href="cmdqueryname=bridge-domain"><b><span class="cmdname" id="EN-US_TASK_0172363953__cmdname707268957214055">bridge-domain</span></b></a> <i><span class="varname" id="EN-US_TASK_0172363953__varname15502522182712">bd-id</span></i></span><p><p id="EN-US_TASK_0172363953__p2087412457384">The view of the BD to be bound to the EVPN instance is displayed.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0172363953__substep99779713502"><span id="EN-US_TASK_0172363953__cmd189779755014">Run <a href="cmdqueryname=vxlan+vni+vni-id+split-horizon-mode"><b><span class="cmdname" id="EN-US_TASK_0172363953__cmdname22801818165611">vxlan vni vni-id split-horizon-mode</span></b></a></span><p><p id="EN-US_TASK_0172363953__p1453275918388">A VNI is created and bound to a BD, and split horizon is configured for packet forwarding.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0172363953__substep1541871620501"><span id="EN-US_TASK_0172363953__cmd541851695011">Run <a href="cmdqueryname=evpn+binding+vpn-instance"><b><span class="cmdname" id="EN-US_TASK_0172363953__cmdname210306542214055">evpn binding vpn-instance</span></b></a> <i><span class="varname" id="EN-US_TASK_0172363953__varname918335492214055">vpn-instance-name</span></i><span> [ <strong><span id="EN-US_TASK_0172363953__cmdparmname1193540718214055">bd-tag</span></strong> <i><span class="varname" id="EN-US_TASK_0172363953__varname1669198868214055">bd-tag</span></i> ]</span></span><p><p id="EN-US_TASK_0172363953__p974651013397">The BD is bound to an EVPN instance. By specifying different <strong id="EN-US_TASK_0172363953__b10252714143918">bd-tag</strong> values, you can bind multiple BDs to the same EVPN instance. In this way, VLAN services of different BDs can access the same EVPN instance while remaining isolated.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0172363953__substep11730165425014"><span id="EN-US_TASK_0172363953__cmd117301054115011">Run <a href="cmdqueryname=evpn-dci+support+ac-access"><b><span class="cmdname" id="EN-US_TASK_0172363953__cmdname860802571">evpn-dci support ac-access</span></b></a></span><p><p id="EN-US_TASK_0172363953__p1412032011392">AC access is configured on the interworking node.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0172363953__substep13867132825011"><span id="EN-US_TASK_0172363953__cmd78672282507">Run <a href="cmdqueryname=quit"><b><span class="cmdname" id="EN-US_TASK_0172363953__cmdname116829195419">quit</span></b></a></span><p><p id="EN-US_TASK_0172363953__p2997294394">Exit the BD view.</p>
</p></li></ol>
</li><li><span>Run <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span></span><p><p>The configuration is committed.</p>
</p></li></ol></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_dci_cfg_0002.html">Configuring DCI Functions
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_dci_cfg_0004.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_dci_cfg_0029.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>