
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Inter-NAT DSVPN">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_cfg_dsvpn_0015.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_cfg_dsvpn_0016_03.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_cfg_dsvpn_0018.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="dsvpn,w00800033,w00556928,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="DSVPN">
<meta name="featuretype" content="VPN">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="DSVPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="DSVPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="DSVPN">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="l00415692">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00415692">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172369163">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring Inter-NAT DSVPN</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172369163"></a><a name="EN-US_TASK_0172369163"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Inter-NAT DSVPN</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0172369163__1.3.1"></a><a name="1.3.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>An enterprise has an HQ (Hub) and multiple branches (represented by Spoke 1 and Spoke 2 in this example). Spoke 1 and Spoke 2 connect to Hub over the public network after address translation by the NAT device. The translated addresses of Spoke 1 and Spoke 2 are unknown. The HQ hub and branch spokes are located in different areas, and the subnet environments of the HQ and branches change frequently. The enterprise wants to use a VPN for communication between branch spokes. To meet this requirement, deploy dynamic routing (OSPF) based on enterprise network planning and configure inter-NAT DSVPN to realize direct communication between Spoke 1 and Spoke 2. <a href="#EN-US_TASK_0172369163__fig_dc_cfg_dsvpn_001701">Figure 1</a> shows the related networking.</p>
<div class="fignone" id="EN-US_TASK_0172369163__fig_dc_cfg_dsvpn_001701"><a name="EN-US_TASK_0172369163__fig_dc_cfg_dsvpn_001701"></a><a name="fig_dc_cfg_dsvpn_001701"></a><span class="figcap"><b>Figure 1 </b>Configuring inter-NAT DSVPN</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface1 represents GE<span>0/1/0</span>.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_cfg_dsvpn_001701.png" width="NaN" height="NaN"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172369163__1.3.2"></a><a name="1.3.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><div class="p">The configuration roadmap is as follows:<ol><li><p>Because branches access the public network after NAT processing, branches are unaware of each other's public IP address after NAT processing. In this situation, configure inter-NAT DSVPN to interconnect branches.</p>
</li><li><p>Because a large number of branches exist, configure DSVPN in shortcut mode.</p>
</li><li><p>Because the subnet environments of the HQ and branches frequently change, deploy OSPF based on enterprise network planning for communication between the HQ and branches to simplify maintenance.</p>
</li></ol>
</div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172369163__1.3.3"></a><a name="1.3.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure interface IP addresses.</span><p><p>Configure interface IP addresses on each device.</p>
<div class="p"># Configure interface IP addresses on Hub. <pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname Hub</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Hub] <strong>interface GigabitEthernet <span>0/1/0</span></strong>
[<span class="keyword">*</span>Hub-GigabitEthernet<span>0/1/0</span>] <strong>ip address 10.10.1.10 255.255.255.0</strong>
[<span class="keyword">*</span>Hub-GigabitEthernet<span>0/1/0</span>] <strong>binding tunnel gre</strong>
[<span class="keyword">*</span>Hub-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong>
[<span class="keyword">*</span>Hub] <strong>interface tunnel 0</strong>
[<span class="keyword">*</span>Hub-Tunnel<span>0</span>] <strong>ip address 172.16.1.1 255.255.255.0</strong>
[<span class="keyword">*</span>Hub-Tunnel<span>0</span>] <strong>quit</strong>
[<span class="keyword">*</span>Hub] <strong>interface loopback 0</strong>
[<span class="keyword">*</span>Hub-LoopBack0] <strong>ip address 192.168.0.1 255.255.255.255</strong>
[<span class="keyword">*</span>Hub-LoopBack0] <strong>quit</strong>
[<span class="keyword">*</span>Hub] <strong>commit</strong></pre>
</div>
<p>Configure IP addresses for interfaces on Spoke 1, Spoke 2, NAT1, and NAT2 according to <a href="#EN-US_TASK_0172369163__fig_dc_cfg_dsvpn_001701">Figure 1</a>. The configurations of the spokes and NAT devices are the similar to the configuration of the hub.</p>
</p></li><li><span>Configure public network routes between devices to implement connectivity.</span><p><p>Configure OSPF on each device to ensure that the public network routes are available.</p>
<p># Configure OSPF on Hub.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Hub] <strong>ospf 2 router-id 10.10.1.10</strong>
[<span class="keyword">*</span>Hub-ospf-2] <strong>area 0.0.0.1</strong>
[<span class="keyword">*</span>Hub-ospf-2-area-0.0.0.1] <strong>network 10.10.1.0 0.0.0.255</strong>
[<span class="keyword">*</span>Hub-ospf-2-area-0.0.0.1] <strong>quit</strong>
[<span class="keyword">*</span>Hub-ospf-2] <strong>quit</strong>
[<span class="keyword">*</span>Hub] <strong>commit</strong></pre>
<p># Configure OSPF on Spoke 1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Spoke1] <strong>ospf 2 router-id 10.1.1.1</strong>
[<span class="keyword">*</span>Spoke1-ospf-2] <strong>area 0.0.0.1</strong>
[<span class="keyword">*</span>Spoke1-ospf-2-area-0.0.0.1] <strong>network 10.1.1.0 0.0.0.255</strong>
[<span class="keyword">*</span>Spoke1-ospf-2-area-0.0.0.1] <strong>quit</strong>
[<span class="keyword">*</span>Spoke1-ospf-2] <strong>quit</strong>
[<span class="keyword">*</span>Spoke1] <strong>commit</strong></pre>
<p># Configure OSPF on Spoke 2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Spoke2] <strong>ospf 2 router-id 10.2.2.2</strong>
[<span class="keyword">*</span>Spoke2-ospf-2] <strong>area 0.0.0.1</strong>
[<span class="keyword">*</span>Spoke2-ospf-2-area-0.0.0.1] <strong>network 10.2.2.0 0.0.0.255</strong>
[<span class="keyword">*</span>Spoke2-ospf-2-area-0.0.0.1] <strong>quit</strong>
[<span class="keyword">*</span>Spoke2-ospf-2] <strong>quit</strong>
[<span class="keyword">*</span>Spoke2] <strong>commit</strong></pre>
</p></li><li><span>Configure basic OSPF functions.</span><p><p id="EN-US_TASK_0172369163__en-us_task_0172369157_p831125174214049"># Configure Hub.</p>
<pre class="screen" id="EN-US_TASK_0172369163__en-us_task_0172369157_screen124691877214049">[<span class="keyword" id="EN-US_TASK_0172369163__en-us_task_0172369157_keyword1503238002214049"><font style="font-size:8pt" Face="Courier New" >~</font></span>Hub] <strong id="EN-US_TASK_0172369163__en-us_task_0172369157_b1794936651214049">ospf 1 router-id 172.16.1.1</strong>
[<span class="keyword" id="EN-US_TASK_0172369163__en-us_task_0172369157_keyword1070582681214049">*</span>Hub-ospf-1] <strong id="EN-US_TASK_0172369163__en-us_task_0172369157_b1896487750214049">area 0.0.0.0</strong>
[<span class="keyword" id="EN-US_TASK_0172369163__en-us_task_0172369157_keyword811069411214049">*</span>Hub-ospf-1-area-0.0.0.0] <strong id="EN-US_TASK_0172369163__en-us_task_0172369157_b759179767214049">network 172.16.1.0 0.0.0.255</strong>
[<span class="keyword" id="EN-US_TASK_0172369163__en-us_task_0172369157_keyword962041007214049">*</span>Hub-ospf-1-area-0.0.0.0] <strong id="EN-US_TASK_0172369163__en-us_task_0172369157_b351767081214049">network 192.168.0.0 0.0.0.255</strong>
[<span class="keyword" id="EN-US_TASK_0172369163__en-us_task_0172369157_keyword1238263447214049">*</span>Hub-ospf-1-area-0.0.0.0] <strong id="EN-US_TASK_0172369163__en-us_task_0172369157_b2054954505214049">quit</strong>
[<span class="keyword" id="EN-US_TASK_0172369163__en-us_task_0172369157_keyword1818188545214049">*</span>Hub-ospf-1] <strong id="EN-US_TASK_0172369163__en-us_task_0172369157_b1366962852214049">quit</strong>
[<span class="keyword" id="EN-US_TASK_0172369163__en-us_task_0172369157_keyword459779514214049">*</span>Hub] <strong id="EN-US_TASK_0172369163__en-us_task_0172369157_b655197126214049">commit</strong></pre>
<p id="EN-US_TASK_0172369163__en-us_task_0172369157_p1057613753214049"># Configure Spoke 1.</p>
<pre class="screen" id="EN-US_TASK_0172369163__en-us_task_0172369157_screen1673776566214049">[<span class="keyword" id="EN-US_TASK_0172369163__en-us_task_0172369157_keyword724784985214049"><font style="font-size:8pt" Face="Courier New" >~</font></span>Spoke1] <strong id="EN-US_TASK_0172369163__en-us_task_0172369157_b1731468654214049">ospf 1 router-id 172.16.1.2</strong>
[<span class="keyword" id="EN-US_TASK_0172369163__en-us_task_0172369157_keyword378538032214049">*</span>Spoke1-ospf-1] <strong id="EN-US_TASK_0172369163__en-us_task_0172369157_b982145383214049">area 0.0.0.0</strong>
[<span class="keyword" id="EN-US_TASK_0172369163__en-us_task_0172369157_keyword1211351093214049">*</span>Spoke1-ospf-1-area-0.0.0.0] <strong id="EN-US_TASK_0172369163__en-us_task_0172369157_b940655536214049">network 172.16.1.0 0.0.0.255</strong>
[<span class="keyword" id="EN-US_TASK_0172369163__en-us_task_0172369157_keyword759826265214049">*</span>Spoke1-ospf-1-area-0.0.0.0] <strong id="EN-US_TASK_0172369163__en-us_task_0172369157_b582361683214049">network 192.168.1.0 0.0.0.255</strong>
[<span class="keyword" id="EN-US_TASK_0172369163__en-us_task_0172369157_keyword251807070214049">*</span>Spoke1-ospf-1-area-0.0.0.0] <strong id="EN-US_TASK_0172369163__en-us_task_0172369157_b57147615214049">quit</strong>
[<span class="keyword" id="EN-US_TASK_0172369163__en-us_task_0172369157_keyword96105721214049">*</span>Spoke1-ospf-1] <strong id="EN-US_TASK_0172369163__en-us_task_0172369157_b2079288678214049">quit</strong>
[<span class="keyword" id="EN-US_TASK_0172369163__en-us_task_0172369157_keyword1023651117214049">*</span>Spoke1] <strong id="EN-US_TASK_0172369163__en-us_task_0172369157_b1633078592214049">commit</strong></pre>
<p id="EN-US_TASK_0172369163__en-us_task_0172369157_p1455932091214049"># Configure Spoke 2.</p>
<pre class="screen" id="EN-US_TASK_0172369163__en-us_task_0172369157_screen2011752017214049">[<span class="keyword" id="EN-US_TASK_0172369163__en-us_task_0172369157_keyword1307244963214049"><font style="font-size:8pt" Face="Courier New" >~</font></span>Spoke2] <strong id="EN-US_TASK_0172369163__en-us_task_0172369157_b2135275617214049">ospf 1 router-id 172.16.1.3</strong>
[<span class="keyword" id="EN-US_TASK_0172369163__en-us_task_0172369157_keyword1199333901214049">*</span>Spoke2-ospf-1] <strong id="EN-US_TASK_0172369163__en-us_task_0172369157_b1251242333214049">area 0.0.0.0</strong>
[<span class="keyword" id="EN-US_TASK_0172369163__en-us_task_0172369157_keyword366210507214049">*</span>Spoke2-ospf-1-area-0.0.0.0] <strong id="EN-US_TASK_0172369163__en-us_task_0172369157_b183754803214049">network 172.16.1.0 0.0.0.255</strong>
[<span class="keyword" id="EN-US_TASK_0172369163__en-us_task_0172369157_keyword269938390214049">*</span>Spoke2-ospf-1-area-0.0.0.0] <strong id="EN-US_TASK_0172369163__en-us_task_0172369157_b1622482704214049">network 192.168.2.0 0.0.0.255</strong>
[<span class="keyword" id="EN-US_TASK_0172369163__en-us_task_0172369157_keyword669561190214049">*</span>Spoke2-ospf-1-area-0.0.0.0] <strong id="EN-US_TASK_0172369163__en-us_task_0172369157_b2059665051214049">quit</strong>
[<span class="keyword" id="EN-US_TASK_0172369163__en-us_task_0172369157_keyword1019420245214049">*</span>Spoke2-ospf-1] <strong id="EN-US_TASK_0172369163__en-us_task_0172369157_b463136257214049">quit</strong>
[<span class="keyword" id="EN-US_TASK_0172369163__en-us_task_0172369157_keyword1483238421214049">*</span>Spoke2] <strong id="EN-US_TASK_0172369163__en-us_task_0172369157_b402228882214049">commit</strong></pre>
<div class="note" id="EN-US_TASK_0172369163__en-us_task_0172369157_note2104014285214049"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0172369163__en-us_task_0172369157_p1702356493214049">The configuration on a spoke subnet is given as an example. Perform the same configuration on other spoke subnets. If a spoke subnet is changed, you only need to configure the dynamic routing policy on the local device.</p>
</div></div>
</p></li><li><span>Enable NHRP globally.</span><p><p id="EN-US_TASK_0172369163__en-us_task_0172369154_p1167536300214049"># Configure Hub.</p>
<pre class="screen" id="EN-US_TASK_0172369163__en-us_task_0172369154_screen1028335826214049">[<span class="keyword" id="EN-US_TASK_0172369163__en-us_task_0172369154_keyword43842734214049"><font style="font-size:8pt" Face="Courier New" >~</font></span>Hub] <strong id="EN-US_TASK_0172369163__en-us_task_0172369154_b550849294214049">nhrp enable</strong></pre>
<p id="EN-US_TASK_0172369163__en-us_task_0172369154_p587930736214049">The configurations of the spokes are similar to the configuration of the hub. For detailed configurations, see Configuration Files.</p>
</p></li><li><span>Configure tunnel interfaces.</span><p><p>Set the OSPF network type to P2MP on the hub and spokes. Enable the NHRP redirection function on Hub. Configure static NHRP peer entries (mapped to Hub) and enable the NHRP shortcut function on Spoke 1 and Spoke 2.</p>
<div class="p"># Configure a tunnel interface and OSPF route attributes and enable the NHRP redirection function on Hub.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Hub] <strong>interface tunnel 0</strong>
[<span class="keyword">*</span>Hub-Tunnel0] <strong>tunnel-protocol gre p2mp</strong>
[<span class="keyword">*</span>Hub-Tunnel0] <strong>nhrp enable</strong>
[<span class="keyword">*</span>Hub-Tunnel0] <strong>source gigabitethernet </strong><strong><span>0/1/0</span></strong>
[<span class="keyword">*</span>Hub-Tunnel0] <strong>nhrp entry multicast dynamic</strong>
[<span class="keyword">*</span>Hub-Tunnel0] <strong>ospf network-type p2mp</strong>
[<span class="keyword">*</span>Hub-Tunnel0] <strong>nhrp redirect</strong>
[<span class="keyword">*</span>Hub-Tunnel0] <strong>quit</strong>
[<span class="keyword">*</span>Hub] <strong>commit</strong></pre>
</div>
<div class="p"># Configure a tunnel interface, OSPF route attributes, and a static NHRP peer entry (mapped to Hub), and enable the NHRP shortcut function on Spoke 1.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Spoke1] <strong>interface tunnel 0</strong>
[<span class="keyword">*</span>Spoke1-Tunnel0] <strong>tunnel-protocol gre p2mp</strong>
[<span class="keyword">*</span>Spoke1-Tunnel0] <strong>nhrp enable</strong>
[<span class="keyword">*</span>Spoke1-Tunnel0] <strong>source gigabitethernet </strong><strong><span>0/1/0</span></strong>
[<span class="keyword">*</span>Spoke1-Tunnel0] <strong>nhrp entry 172.16.1.1 10.10.1.10 register</strong>
[<span class="keyword">*</span>Spoke1-Tunnel0] <strong>ospf network-type p2mp</strong>
[<span class="keyword">*</span>Spoke1-Tunnel0] <strong>nhrp shortcut</strong>
[<span class="keyword">*</span>Spoke1-Tunnel0] <strong>quit</strong>
[<span class="keyword">*</span>Spoke1] <strong>commit</strong></pre>
</div>
<div class="p"># Configure a tunnel interface, OSPF route attributes, and a static NHRP peer entry (mapped to Hub), and enable the NHRP shortcut function on Spoke 2.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Spoke2] <strong>interface tunnel 0</strong>
[<span class="keyword">*</span>Spoke2-Tunnel0] <strong>tunnel-protocol gre p2mp</strong>
[<span class="keyword">*</span>Spoke1-Tunnel0] <strong>nhrp enable</strong>
[<span class="keyword">*</span>Spoke2-Tunnel0] <strong>source gigabitethernet </strong><strong><span>0/1/0</span></strong>
[<span class="keyword">*</span>Spoke2-Tunnel0] <strong>nhrp entry 172.16.1.1 10.10.1.10 register</strong>
[<span class="keyword">*</span>Spoke2-Tunnel0] <strong>ospf network-type p2mp</strong>
[<span class="keyword">*</span>Spoke2-Tunnel0] <strong>nhrp shortcut</strong>
[<span class="keyword">*</span>Spoke2-Tunnel0] <strong>quit</strong>
[<span class="keyword">*</span>Spoke2] <strong>commit</strong></pre>
</div>
</p></li><li><span>Verify the DSVPN configuration.</span><p><p>After the configuration is complete, verify NHRP peer information on spokes.</p>
<div class="p"># Run the <strong>display nhrp peer all</strong> command on Spoke 1. The command output is as follows.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Spoke1] <strong>display nhrp peer all</strong>
-------------------------------------------------------------------------------
Protocol-addr   Mask  NBMA-addr       NextHop-addr    Type         Flag
-------------------------------------------------------------------------------
172.16.1.1      32    10.10.1.10      172.16.1.1       hub          up
-------------------------------------------------------------------------------
Tunnel interface: Tunnel0 (VPN instance: _public_) 
Created time    : 00:10:58
Expire time     : --

Number of nhrp peers: 1
</pre>
</div>
<div class="p"># Run the <strong>display nhrp peer all</strong> command on Spoke 2. The command output is as follows.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Spoke2] <strong>display nhrp peer all</strong>
-------------------------------------------------------------------------------
Protocol-addr   Mask  NBMA-addr       NextHop-addr    Type         Flag
-------------------------------------------------------------------------------
172.16.1.1      32    10.10.1.10      172.16.1.1       hub          up
-------------------------------------------------------------------------------
Tunnel interface: Tunnel0 (VPN instance: _public_)
Created time    : 00:07:55
Expire time     : --

Number of nhrp peers: 1
</pre>
</div>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>After the configuration is complete, the <strong>display nhrp peer all</strong> command output shows only the static NHRP peer entries mapped to Hub on Spoke 1 and Spoke 2.</p>
</div></div>
<p>On Hub, verify registration information about Spoke 1 and Spoke 2.</p>
<div class="p"># Run the <strong>display nhrp peer all</strong> command on Hub. The command output is as follows.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Hub] <strong>display nhrp peer all</strong>
-------------------------------------------------------------------------------
Protocol-addr   Mask  NBMA-addr       NextHop-addr    Type         Flag
-------------------------------------------------------------------------------
172.16.1.2      32    10.10.2.10      172.16.1.2      registered   up|unique
-------------------------------------------------------------------------------
Tunnel interface: Tunnel0 (VPN instance: _public_)
Created time    : 00:02:02
Expire time     : 01:57:58
-------------------------------------------------------------------------------
Protocol-addr   Mask  NBMA-addr       NextHop-addr    Type         Flag
-------------------------------------------------------------------------------
172.16.1.3      32    10.10.3.10      172.16.1.3      registered   up|unique
-------------------------------------------------------------------------------
Tunnel interface: Tunnel0 (VPN instance: _public_)
Created time    : 00:01:53
Expire time     : 01:59:35

Number of nhrp peers: 2
</pre>
</div>
</p></li><li><span>Run the <strong>ping</strong> command and check the configuration result.</span><p><p>On Spoke 1, ping the subnet address 192.168.2.1 of Spoke 2. Then, verify the dynamic NHRP peer entries of Spoke 1 and Spoke 2.</p>
<p># Run the <strong>ping -a 192.168.1.1 192.168.2.1</strong> command on Spoke 1. The command output is as follows.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Spoke1] <strong>ping -a 192.168.1.1 192.168.2.1</strong>
  PING 192.168.2.1: 56  data bytes, press CTRL_C to break
    Reply from 192.168.2.1: bytes=56 Sequence=1 ttl=254 time=2 ms
    Reply from 192.168.2.1: bytes=56 Sequence=2 ttl=255 time=2 ms
    Reply from 192.168.2.1: bytes=56 Sequence=3 ttl=255 time=1 ms
    Reply from 192.168.2.1: bytes=56 Sequence=4 ttl=255 time=2 ms
    Reply from 192.168.2.1: bytes=56 Sequence=5 ttl=255 time=1 ms

  --- 192.168.2.1 ping statistics ---
    5 packet(s) transmitted
    5 packet(s) received
    0.00% packet loss
    round-trip min/avg/max = 1/1/2 ms
                                                                                                     
</pre>
<p># Run the <strong>display nhrp peer all</strong> command on Spoke 1. The command output is as follows.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Spoke1] <strong>display nhrp peer all</strong>
-------------------------------------------------------------------------------
Protocol-addr   Mask  NBMA-addr       NextHop-addr    Type         Flag
-------------------------------------------------------------------------------
172.16.1.1      32    10.10.1.10      172.16.1.1      hub           up
-------------------------------------------------------------------------------
Tunnel interface: Tunnel0 (VPN instance: _public_)
Created time    : 00:39:32
Expire time     : --
-------------------------------------------------------------------------------
Protocol-addr   Mask  NBMA-addr       NextHop-addr    Type           Flag
-------------------------------------------------------------------------------
192.168.2.1     32    10.10.3.10      172.16.1.3      remote-network up
-------------------------------------------------------------------------------
Tunnel interface: Tunnel0 (VPN instance: _public_)
Before NAT NBMA-addr: 10.2.2.2
Created time    : 00:00:13
Expire time     : 01:59:47
-------------------------------------------------------------------------------
Protocol-addr   Mask  NBMA-addr       NextHop-addr    Type         Flag
-------------------------------------------------------------------------------
172.16.1.3      32    10.10.3.10      172.16.1.3      remote       up

-------------------------------------------------------------------------------
Tunnel interface: Tunnel0 (VPN instance: _public_)
Before NAT NBMA-addr: 10.2.2.2
Created time    : 00:00:13
Expire time     : 01:59:47
-------------------------------------------------------------------------------
Protocol-addr   Mask  NBMA-addr       NextHop-addr    Type         Flag
-------------------------------------------------------------------------------
192.168.1.1     32    10.1.1.1        172.16.1.2      local        up

-------------------------------------------------------------------------------
Tunnel interface: Tunnel0 (VPN instance: _public_)
Created time    : 00:00:13
Expire time     : 01:59:47

Number of nhrp peers: 4
</pre>
<p># Run the <strong>display nhrp peer all</strong> command on Spoke 2. The command output is as follows.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Spoke2] <strong>display nhrp peer all</strong>
-------------------------------------------------------------------------------
Protocol-addr   Mask  NBMA-addr       NextHop-addr    Type         Flag
-------------------------------------------------------------------------------
172.16.1.1      32    10.10.1.10      172.16.1.1      hub           up
-------------------------------------------------------------------------------
Tunnel interface: Tunnel0 (VPN instance: _public_)
Created time    : 00:41:08
Expire time     : --
-------------------------------------------------------------------------------
Protocol-addr   Mask  NBMA-addr       NextHop-addr    Type           Flag
-------------------------------------------------------------------------------
192.168.1.1     32    10.10.2.10      172.16.1.2      remote-network up
-------------------------------------------------------------------------------
Tunnel interface: Tunnel0 (VPN instance: _public_)
Before NAT NBMA-addr: 10.1.1.1
Created time    : 00:00:52
Expire time     : 01:59:08
-------------------------------------------------------------------------------
Protocol-addr   Mask  NBMA-addr       NextHop-addr    Type         Flag
-------------------------------------------------------------------------------
172.16.1.2      32    10.10.2.10      172.16.1.2      remote       up
-------------------------------------------------------------------------------
Tunnel interface: Tunnel0 (VPN instance: _public_)
Before NAT NBMA-addr: 10.1.1.1
Created time    : 00:00:52
Expire time     : 01:59:08
-------------------------------------------------------------------------------
Protocol-addr   Mask  NBMA-addr       NextHop-addr    Type         Flag
-------------------------------------------------------------------------------
192.168.2.1     32    10.2.2.2        172.16.1.3      local        up
-------------------------------------------------------------------------------
Tunnel interface: Tunnel0 (VPN instance: _public_)
Created time    : 00:00:52
Expire time     : 01:59:08

Number of nhrp peers: 4
</pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172369163__1.3.4"></a><a name="1.3.4"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>Hub configuration file</p>
<pre class="screen">#
sysname Hub
# 
nhrp enable
#
interface GigabitEthernet<span>0/1/0</span>
 ip address 10.10.1.10 255.255.255.0
 binding tunnel gre
#
interface LoopBack0
 ip address 192.168.0.1 255.255.255.255
# 
interface Tunnel0
 ip address 172.16.1.1 255.255.255.0
 tunnel-protocol gre p2mp
 source GigabitEthernet<span>0/1/0</span>
 ospf network-type p2mp
 nhrp enable
 nhrp redirect
 nhrp entry multicast dynamic
# 
ospf 1 router-id 172.16.1.1
 area 0.0.0.0
  network 172.16.1.0 0.0.0.255
  network 192.168.0.0 0.0.0.255
# 
ospf 2 router-id 10.10.1.10
 area 0.0.0.1
  network 10.10.1.0 0.0.0.255
# 
return
</pre>
</li><li><p>Spoke 1 configuration file</p>
<pre class="screen">#
sysname Spoke1
# 
nhrp enable
#
interface GigabitEthernet<span>0/1/0</span>
 ip address 10.1.2.10 255.255.255.0
 binding tunnel gre
#
interface LoopBack0
 ip address 192.168.1.1 255.255.255.255
# 
interface Tunnel0
 ip address 172.16.1.2 255.255.255.0
 tunnel-protocol gre p2mp
 source GigabitEthernet<span>0/1/0</span>
 ospf network-type p2mp
 nhrp enable
 nhrp shortcut
 nhrp entry 172.16.1.1 10.10.1.10 register
# 
ospf 1 router-id 172.16.1.2
 area 0.0.0.0
  network 172.16.1.0 0.0.0.255
  network 192.168.1.0 0.0.0.255
# 
ospf 2 router-id 10.1.1.1
 area 0.0.0.1
  network 10.1.1.0 0.0.0.255
# 
return
</pre>
</li><li><p>Spoke 2 configuration file</p>
<pre class="screen">#
sysname Spoke2
# 
nhrp enable
#
interface GigabitEthernet<span>0/1/0</span>
 ip address 10.1.3.10 255.255.255.0
 binding tunnel gre
#
interface LoopBack0
 ip address 192.168.2.1 255.255.255.255
# 
interface Tunnel0
 ip address 172.16.1.3 255.255.255.0
 tunnel-protocol gre p2mp
 source GigabitEthernet<span>0/1/0</span>
 ospf network-type p2mp
 nhrp enable
 nhrp shortcut
 nhrp entry 172.16.1.1 10.10.1.10 register
# 
ospf 1 router-id 172.16.1.3
 area 0.0.0.0
  network 172.16.1.0 0.0.0.255
  network 192.168.2.0 0.0.0.255
# 
ospf 2 router-id 10.2.2.2
 area 0.0.0.1
  network 10.2.2.0 0.0.0.255
# 
return
</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_cfg_dsvpn_0015.html">Configuration Examples for DSVPN
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_cfg_dsvpn_0016_03.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_cfg_dsvpn_0018.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>