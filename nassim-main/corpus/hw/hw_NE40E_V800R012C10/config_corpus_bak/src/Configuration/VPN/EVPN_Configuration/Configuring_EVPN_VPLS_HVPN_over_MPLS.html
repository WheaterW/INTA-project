
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring EVPN VPLS HVPN over MPLS">
<meta name="abstract" content="EVPN VPLS HVPN over MPLS can be configured as a replacement of HVPLS to carry Layer 2 services on a hierarchical network.">
<meta name="description" content="EVPN VPLS HVPN over MPLS can be configured as a replacement of HVPLS to carry Layer 2 services on a hierarchical network.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0000.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_evpn-vpls_over_srv6-te_policy_copy.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0029.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="p00915595,w00800033,w00556928,l00468467,w00606909,evpnvrp,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="p00915595">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00878323">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172370527">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring EVPN VPLS HVPN over MPLS</title>
</head>
<body><a name="EN-US_TASK_0172370527"></a><a name="EN-US_TASK_0172370527"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring EVPN VPLS HVPN over MPLS</h1>
<div class="taskbody"><p>EVPN VPLS HVPN over MPLS can be configured as a replacement of HVPLS to carry Layer 2 services on a hierarchical network.</p>
<div class="context"><a name="EN-US_TASK_0172370527__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>To evolve from VPLS to EVPN on an HVPLS-deployed network, deploy EVPN HVPN VPLS over MPLS as a replacement of HVPLS to carry Layer 2 services.</p>
<p>As shown in <a href="#EN-US_TASK_0172370527__fig1079394911920">Figure 1</a>, an access network is deployed between UPEs and SPEs, and an aggregation network is deployed between SPEs and NPEs. An IGP needs to be deployed on both the access network and aggregation network to achieve route communication at each layer. The BD EVPN function needs to be deployed between neighboring devices. In addition, the EVPN RR function can be deployed on SPEs to allow CE1 and CE2 to transmit information, such as the MAC address.</p>
<div class="fignone" id="EN-US_TASK_0172370527__fig1079394911920"><a name="EN-US_TASK_0172370527__fig1079394911920"></a><a name="fig1079394911920"></a><span class="figcap"><b>Figure 1 </b>Configuring EVPN VPLS HVPN over MPLS</span><br><span><img class="vsd" src="figure/en-us_image_0000001182556782.png" width="NaN" height="NaN"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172370527__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Pre-configuration Tasks</h4><p>Before configuring EVPN VPLS HVPN over MPLS, complete the following tasks:</p>
<ul><li>Configure <a href="dc_vrp_evpn_cfg_0065.html">EVPN VPLS over MPLS (BD EVPN instance)</a> between SPEs and NPEs.</li><li>Perform the following operations on each SPE to implement the EVPN RR function.</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172370527__1.4.3"></a><a name="1.4.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span><p><p>The BGP view is displayed.</p>
</p></li><li><span>Run <a href="cmdqueryname=l2vpn-family+evpn"><b><span class="cmdname">l2vpn-family evpn</span></b></a></span><p><p>The BGP-EVPN address family view is displayed.</p>
</p></li><li><span>Specify a UPE and an RR client.</span><p><ul><li><p>Run the <a href="cmdqueryname=peer+upe"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>upe</span></strong> command to configure the UPE as a peer.</p>
</li><li><p>Specify an RR client.</p>
<ol type="a"><li><p>Run the <a href="cmdqueryname=peer+reflect-client"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <a href="cmdqueryname=reflect-client"><b><span class="cmdname">reflect-client</span></b></a> command to configure the RR function and specify the UPE as an RR client.</p>
</li><li><p>Run the <a href="cmdqueryname=peer+next-hop-local"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <a href="cmdqueryname=next-hop-local"><b><span class="cmdname">next-hop-local</span></b></a> command to configure a device to use its own IP address as the next hop IP address during route advertisement.</p>
<p>To allow an SPE to use its own address as the next-hop address when advertising routes to UPEs and NPEs, run the <a href="cmdqueryname=peer+next-hop-local"><b><span class="cmdname">peer next-hop-local</span></b></a> command on the SPE twice with different parameters specified for UPEs and NPEs.</p>
</li></ol>
</li></ul>
</p></li><li><span>(Optional) Run <a href="cmdqueryname=apply-label+per-nexthop"><b><span class="cmdname">apply-label per-nexthop</span></b></a></span><p><p>One-label-per-next-hop label distribution is enabled for EVPN routes.</p>
</p><p><p>In an EVPN HVPN scenario, if an SPE needs to send a large number of EVPN routes but the MPLS labels are insufficient, one-label-per-next-hop label distribution can be configured on the SPE to conserve MPLS label resources.</p>
<div class="notice"><span class="noticetitle"><img src="../../../../public_sys-resources/notice_3.0-en-us.png"> </span><div class="noticebody"><p>After one-label-per-next-hop label distribution is enabled or disabled, the label allocated by the SPE changes, causing packet loss.</p>
</div></div>
</p></li><li><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172370527__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Follow-up Procedure</h4><p>On NPEs, configure the MAC-based load balancing function to improve network resource utilization.</p>
<ol><li><p>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></p>
<p>The system view is displayed.</p>
</li><li><p>Enter the EVPN instance or BD EVPN instance view.</p>
<ul><li><p>Run the <a href="cmdqueryname=evpn+vpn-instance"><b><span class="cmdname">evpn vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i> command to enter the EVPN instance view.</p>
</li><li><p>Run the <a href="cmdqueryname=evpn+vpn-instance"><b><span class="cmdname">evpn vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i> <strong><span>bd-mode</span></strong> command to enter the BD EVPN instance view.</p>
</li></ul>
</li><li><p>Run <a href="cmdqueryname=mac+load-balancing"><b><span class="cmdname">mac load-balancing</span></b></a></p>
<p>MAC route-based load balancing is enabled.</p>
</li><li><p>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></p>
<p>The configuration is committed.</p>
</li></ol>
</div>
<div class="postreq"><a name="EN-US_TASK_0172370527__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Verifying the Configuration</h4><ul><li><p>Run the <a href="cmdqueryname=display+bgp+evpn"><b><span class="cmdname">display bgp evpn</span></b></a> { <strong><span>all</span></strong> | <strong><span>route-distinguisher</span></strong> <i><span class="varname">route-distinguisher</span></i> } <strong><span>routing-table</span></strong> { <strong><span>ad-route</span></strong> | <strong><span>es-route</span></strong> | <strong><span>inclusive-route</span></strong> | <strong><span>mac-route</span></strong> | <strong><span>prefix-route</span></strong> } <i><span class="varname">prefix</span></i> command on the SPE to check detailed BGP EVPN route information.</p>
</li><li>Run the <a href="cmdqueryname=display+bgp+evpn"><b><span class="cmdname">display bgp evpn</span></b></a> <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i> <strong><span>routing-table</span></strong> { <strong><span>ad-route</span></strong> | <strong><span>es-route</span></strong> | <strong><span>inclusive-route</span></strong> | <strong><span>mac-route</span></strong> } <i><span class="varname">prefix</span></i> command on the SPE to check the EVPN route information of the specified EVPN instance.</li></ul>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0000.html">EVPN Configuration
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_evpn-vpls_over_srv6-te_policy_copy.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0029.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>