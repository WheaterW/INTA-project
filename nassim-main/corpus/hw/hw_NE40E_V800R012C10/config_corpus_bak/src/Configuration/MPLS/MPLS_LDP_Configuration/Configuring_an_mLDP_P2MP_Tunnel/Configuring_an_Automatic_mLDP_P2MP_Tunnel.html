
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring an Automatic mLDP P2MP Tunnel">
<meta name="abstract" content="Automatic mLDP P2MP tunnels can only transmit NG MVPN and multicast VPLS traffic.">
<meta name="description" content="Automatic mLDP P2MP tunnels can only transmit NG MVPN and multicast VPLS traffic.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ldp-p2p_cfg_0060.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ldp-p2p_cfg_0061.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_te-p2p_cfg_6014-ldp2.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="ldp-p2pvrp,w00800033,z00545680,w00556928,w00606909,z00809835,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="MPLS LDP">
<meta name="featurename" content="MPLS TE">
<meta name="featuretype" content="MPLS">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="MPLS LDP">
<meta name="featurename" content="MPLS TE">
<meta name="featuretype" content="MPLS">
<meta name="featurename" content="MPLS LDP">
<meta name="featurename" content="MPLS TE">
<meta name="featuretype" content="MPLS">
<meta name="featurename" content="MPLS LDP">
<meta name="featuretype" content="MPLS">
<meta name="OWNER" content="z00809835">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="b00896120">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172368536">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring an Automatic mLDP P2MP Tunnel</title>
</head>
<body><a name="EN-US_TASK_0172368536"></a><a name="EN-US_TASK_0172368536"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring an Automatic mLDP P2MP Tunnel</h1>
<div class="taskbody"><p>Automatic mLDP P2MP tunnels can only transmit NG MVPN and multicast VPLS traffic.</p>
<div class="context"><a name="EN-US_TASK_0172368536__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>There is no need to manually specify leaf nodes before automatic mLDP P2MP tunnels are triggered.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>After the configuration is complete, preparation for an automatic mLDP tunnel is ready. Automatic mLDP P2MP tunnels can be established automatically when NG MVPN or multicast VPLS is being deployed.</p>
</div></div>
</div></div>
<div class="steps-unordered"><a name="EN-US_TASK_0172368536__1.4.2"></a><a name="1.4.2"></a><h4 class="sectiontitle">Procedure</h4>
<ul><li><span>Enable mLDP P2MP globally.</span><ol id="EN-US_TASK_0172368536__en-us_task_0172368535_substeps429169241214047"><li class="substepexpand" id="EN-US_TASK_0172368536__en-us_task_0172368535_substep1503714125214047"><span id="EN-US_TASK_0172368536__en-us_task_0172368535_cmd1335740979214047">Run <a href="cmdqueryname=system-view"><b><span class="cmdname" id="EN-US_TASK_0172368536__en-us_task_0172368535_cmdname1953882560214047">system-view</span></b></a></span><p><p id="EN-US_TASK_0172368536__en-us_task_0172368535_p146068319273">The system view is displayed.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0172368536__en-us_task_0172368535_substep1947610509214047"><span id="EN-US_TASK_0172368536__en-us_task_0172368535_cmd1544077189214047">Run <a href="cmdqueryname=mpls+ldp"><b><span class="cmdname" id="EN-US_TASK_0172368536__en-us_task_0172368535_cmdname350850855214047">mpls ldp</span></b></a></span><p><p id="EN-US_TASK_0172368536__en-us_task_0172368535_p7274145313262">The MPLS-LDP view is displayed.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0172368536__en-us_task_0172368535_substep1999747460214047"><span id="EN-US_TASK_0172368536__en-us_task_0172368535_cmd1636484670214047">Run <a href="cmdqueryname=mldp+p2mp"><b><span class="cmdname" id="EN-US_TASK_0172368536__en-us_task_0172368535_cmdname1765230099214047">mldp p2mp</span></b></a></span><p><p id="EN-US_TASK_0172368536__en-us_task_0172368535_p23421142192617">mLDP P2MP is enabled globally.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0172368536__en-us_task_0172368535_substep1678459143214047"><span id="EN-US_TASK_0172368536__en-us_task_0172368535_cmd517629409214047">(Optional) Run <a href="cmdqueryname=mldp+make-before-break"><b><span class="cmdname" id="EN-US_TASK_0172368536__en-us_task_0172368535_cmdname1154732772214047">mldp make-before-break</span></b></a></span><p><p id="EN-US_TASK_0172368536__en-us_task_0172368535_p19263113112619">The mLDP make-before-break (MBB) capability is enabled.</p>
</p><p><p id="EN-US_TASK_0172368536__en-us_task_0172368535_p191189848214047">If the optimal route between a non-root node and a root node on an mLDP P2MP network changes, the non-root node re-selects an upstream node and by default tears down the current P2MP LSP. As a result, traffic is dropped before a new P2MP LSP is established. To prevent traffic loss, the mLDP MBB capability can be enabled. If the optimal route to the root node changes, the node does not delete the original P2MP LSP until a new P2MP LSP is established. This minimizes traffic loss.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0172368536__en-us_task_0172368535_substep301104151214047"><span id="EN-US_TASK_0172368536__en-us_task_0172368535_cmd1185993525214047">Run <a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0172368536__en-us_task_0172368535_cmdname65749370214047">commit</span></b></a></span><p><p id="EN-US_TASK_0172368536__en-us_task_0172368535_p4295182072612">The configuration is committed.</p>
</p></li></ol>
</li><li><span>(Optional) Disable mLDP P2MP on an interface.</span><p><p id="EN-US_TASK_0172368536__en-us_task_0172368535_p2123108507214047">To flexibly control the path of a P2MP LSP, you can disable mLDP P2MP on a specified interface.</p>
<p id="EN-US_TASK_0172368536__en-us_task_0172368535_p2144734831214047">Disabling mLDP P2MP on an interface helps you plan a network. For example, if links balance traffic on a network, to enable P2MP traffic to travel along a specific link, disable mLDP P2MP on the interfaces connected to other links.</p>
</p><ol id="EN-US_TASK_0172368536__en-us_task_0172368535_substeps1428372214047"><li class="substepexpand" id="EN-US_TASK_0172368536__en-us_task_0172368535_substep1918831680214047"><span id="EN-US_TASK_0172368536__en-us_task_0172368535_cmd1042118761214047">Run <a href="cmdqueryname=system-view"><b><span class="cmdname" id="EN-US_TASK_0172368536__en-us_task_0172368535_cmdname1727515077214047">system-view</span></b></a></span><p><p id="EN-US_TASK_0172368536__en-us_task_0172368535_p3969156192514">The system view is displayed.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0172368536__en-us_task_0172368535_substep2074034667214047"><span id="EN-US_TASK_0172368536__en-us_task_0172368535_cmd346090165214047">Run <a href="cmdqueryname=interface"><b><span class="cmdname" id="EN-US_TASK_0172368536__en-us_task_0172368535_cmdname1722718787214047">interface</span></b></a> <i><span class="varname" id="EN-US_TASK_0172368536__en-us_task_0172368535_varname4621165915264">interface-type</span></i> <i><span class="varname" id="EN-US_TASK_0172368536__en-us_task_0172368535_varname1862125942620">interface-number</span></i></span><p><p id="EN-US_TASK_0172368536__en-us_task_0172368535_p77917882610">The interface view is displayed.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0172368536__en-us_task_0172368535_substep1960007866214047"><span id="EN-US_TASK_0172368536__en-us_task_0172368535_cmd1600542529214047">Run <a href="cmdqueryname=mpls+mldp+p2mp+disable"><b><span class="cmdname" id="EN-US_TASK_0172368536__en-us_task_0172368535_cmdname201282593214047">mpls mldp p2mp disable</span></b></a></span><p><p id="EN-US_TASK_0172368536__en-us_task_0172368535_p157696429323">mLDP P2MP is disabled on the interface.</p>
</p><p><p id="EN-US_TASK_0172368536__en-us_task_0172368535_p726583078214047">Disabling mLDP P2MP on an interface affects the establishment of P2MP LSPs, but does not cause the reestablishment of other P2P LDP sessions.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0172368536__en-us_task_0172368535_substep1241343996214047"><span id="EN-US_TASK_0172368536__en-us_task_0172368535_cmd464910167214047">Run <a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0172368536__en-us_task_0172368535_cmdname112635598214047">commit</span></b></a></span><p><p id="EN-US_TASK_0172368536__en-us_task_0172368535_p6277161013313">The configuration is committed.</p>
</p></li></ol>
</li><li><span>(Optional) Configure a tunnel establishment policy that allows mLDP to select an upstream node based on peer IDs.</span><p><p id="EN-US_TASK_0172368536__en-us_task_0172368535_p122801562134">By default, a leaf or transit node selects the next hop on the optimal route to the root node as its upstream node during P2MP tunnel establishment. If routes work in load balancing mode, more than one such upstream node exists, and a leaf or transit node randomly selects an upstream node among the candidates. If you want a leaf or transit node to select a specific upstream node, configure a tunnel establishment policy that allows mLDP to select an upstream node based on peer IDs â an upstream node with the largest or smallest peer ID.</p>
<p id="EN-US_TASK_0172368536__en-us_task_0172368535_p981018123395">Both NG MVPN over mLDP P2MP and VPLS over mLDP P2MP have the dual-root 1+1 protection mechanism. If the routes to the primary and backup roots work in load balancing mode and share some links, an upstream node may be selected by mLDP for both the primary and backup mLDP tunnels. In this case, if the shared link where the selected upstream node resides becomes faulty, dual-root 1+1 protection fails to take effect. To prevent such a protection failure in the scenario with co-routed primary and backup mLDP tunnels, run the <a href="cmdqueryname=mldp+upstream-lsr-select+highest"><b><span class="cmdname" id="EN-US_TASK_0172368536__en-us_task_0172368535_cmdname18267859114716">mldp upstream-lsr-select highest</span></b></a> command for one tunnel and the <a href="cmdqueryname=mldp+upstream-lsr-select+lowest"><b><span class="cmdname" id="EN-US_TASK_0172368536__en-us_task_0172368535_cmdname192460816483">mldp upstream-lsr-select lowest</span></b></a> command for the other tunnel.</p>
<ol id="EN-US_TASK_0172368536__en-us_task_0172368535_ol7438818185318"><li id="EN-US_TASK_0172368536__en-us_task_0172368535_li19801169204914">Run <a href="cmdqueryname=system-view"><b><span class="cmdname" id="EN-US_TASK_0172368536__en-us_task_0172368535_cmdname19889563231">system-view</span></b></a><p id="EN-US_TASK_0172368536__en-us_task_0172368535_p1035967122315">The system view is displayed.</p>
</li><li id="EN-US_TASK_0172368536__en-us_task_0172368535_li1643861811538">Run <a href="cmdqueryname=ip+ip-prefix+permit+deny"><b><span class="cmdname" id="EN-US_TASK_0172368536__en-us_task_0172368535_cmdname16609323234">ip ip-prefix</span></b></a><strong id="EN-US_TASK_0172368536__en-us_task_0172368535_b9609225232"> </strong><i><span class="varname" id="EN-US_TASK_0172368536__en-us_task_0172368535_varname11609112102312">ip-prefix-name</span></i><em id="EN-US_TASK_0172368536__en-us_task_0172368535_i1860922132317"> </em>{ <strong><span id="EN-US_TASK_0172368536__en-us_task_0172368535_cmdparmname2609122162311">permit</span></strong> | <strong><span id="EN-US_TASK_0172368536__en-us_task_0172368535_cmdparmname1160952182314">deny</span></strong> } <i><span class="varname" id="EN-US_TASK_0172368536__en-us_task_0172368535_varname060912162314">ip-address</span></i><p id="EN-US_TASK_0172368536__en-us_task_0172368535_p52610302310">A policy for selecting tunnels to specified root nodes is configured.</p>
</li><li id="EN-US_TASK_0172368536__en-us_task_0172368535_li069112651814">Run <a href="cmdqueryname=mpls"><b><span class="cmdname" id="EN-US_TASK_0172368536__en-us_task_0172368535_cmdname1595795822212">mpls</span></b></a><p id="EN-US_TASK_0172368536__en-us_task_0172368535_p64561759172213">MPLS is enabled, and the MPLS view is displayed.</p>
</li><li id="EN-US_TASK_0172368536__en-us_task_0172368535_li2448791478">Run <a href="cmdqueryname=mpls+ldp"><b><span class="cmdname" id="EN-US_TASK_0172368536__en-us_task_0172368535_cmdname52631155192219">mpls ldp</span></b></a><p id="EN-US_TASK_0172368536__en-us_task_0172368535_p1788855202213">The MPLS-LDP view is displayed.</p>
</li><li id="EN-US_TASK_0172368536__en-us_task_0172368535_li09932045124813">Run <a href="cmdqueryname=mldp+p2mp"><b><span class="cmdname" id="EN-US_TASK_0172368536__en-us_task_0172368535_cmdname16807151192210">mldp p2mp</span></b></a><p id="EN-US_TASK_0172368536__en-us_task_0172368535_p14776165211225">mLDP P2MP is enabled globally.</p>
</li><li id="EN-US_TASK_0172368536__en-us_task_0172368535_li610711566525">Configure a tunnel establishment policy that allows mLDP to select an upstream node based on peer IDs.<div class="note" id="EN-US_TASK_0172368536__en-us_task_0172368535_note6253151417416"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0172368536__en-us_task_0172368535_p1325317147411">If both the <a href="cmdqueryname=mldp+upstream-lsr-select+highest"><b><span class="cmdname" id="EN-US_TASK_0172368536__en-us_task_0172368535_cmdname62501836154115">mldp upstream-lsr-select highest</span></b></a> and <a href="cmdqueryname=mldp+upstream-lsr-select+lowest"><b><span class="cmdname" id="EN-US_TASK_0172368536__en-us_task_0172368535_cmdname1639284134110">mldp upstream-lsr-select lowest</span></b></a> commands are run and the same mLDP root node is specified in them, only the <a href="cmdqueryname=mldp+upstream-lsr-select+highest"><b><span class="cmdname" id="EN-US_TASK_0172368536__en-us_task_0172368535_cmdname1090054612412">mldp upstream-lsr-select highest</span></b></a> command configuration takes effect.</p>
</div></div>
<ul id="EN-US_TASK_0172368536__en-us_task_0172368535_ul1172615619596"><li id="EN-US_TASK_0172368536__en-us_task_0172368535_li772695625919">Run the <a href="cmdqueryname=mldp+upstream-lsr-select+lowest+ip-prefix"><b><span class="cmdname" id="EN-US_TASK_0172368536__en-us_task_0172368535_cmdname1849294017014">mldp upstream-lsr-select lowest ip-prefix</span></b></a> <i><span class="varname" id="EN-US_TASK_0172368536__en-us_task_0172368535_varname153591254600">ip-prefix-name</span></i> command to configure a tunnel establishment policy that allows mLDP to select an upstream node with the smallest peer ID.</li><li id="EN-US_TASK_0172368536__en-us_task_0172368535_li1881063418">Run the <a href="cmdqueryname=mldp+upstream-lsr-select+highest+ip-prefix"><b><span class="cmdname" id="EN-US_TASK_0172368536__en-us_task_0172368535_cmdname10881461544">mldp upstream-lsr-select highest ip-prefix</span></b></a> <i><span class="varname" id="EN-US_TASK_0172368536__en-us_task_0172368535_varname0881961142">ip-prefix-name</span></i> command to configure a tunnel establishment policy that allows mLDP to select an upstream node with the largest peer ID.</li></ul>
</li><li id="EN-US_TASK_0172368536__en-us_task_0172368535_li239115512610">Run <a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0172368536__en-us_task_0172368535_cmdname33710427224">commit</span></b></a><p id="EN-US_TASK_0172368536__en-us_task_0172368535_p13951143182213">The configuration is committed.</p>
</li></ol>
</p></li><li><span>(Optional) Disabling mLDP from Using the Default Route to Establish Tunnels</span><p><p id="EN-US_TASK_0172368536__en-us_task_0172368535_p1149591116194">In a scenario where mLDP P2MP uses intra-AS routes or inter-AS BGP routes to tunnel root nodes to establish mLDP tunnels, you can configure mLDP not to use the default route 0.0.0.0/0 to establish an mLDP tunnel if such a tunnel is not expected.</p>
<ol id="EN-US_TASK_0172368536__en-us_task_0172368535_ol59431492113"><li id="EN-US_TASK_0172368536__en-us_task_0172368535_li0597528112114"><p id="EN-US_TASK_0172368536__en-us_task_0172368535_p89295614452"><a name="EN-US_TASK_0172368536__en-us_task_0172368535_li0597528112114"></a><a name="en-us_task_0172368535_li0597528112114"></a>Run <a href="cmdqueryname=system-view"><b><span class="cmdname" id="EN-US_TASK_0172368536__en-us_task_0172368535_cmdname79212564451">system-view</span></b></a></p>
<p id="EN-US_TASK_0172368536__en-us_task_0172368535_p11351957174518">The system view is displayed.</p>
</li><li id="EN-US_TASK_0172368536__en-us_task_0172368535_li55986282217"><p id="EN-US_TASK_0172368536__en-us_task_0172368535_p101417010462"><a name="EN-US_TASK_0172368536__en-us_task_0172368535_li55986282217"></a><a name="en-us_task_0172368535_li55986282217"></a>Run <a href="cmdqueryname=mpls"><b><span class="cmdname" id="EN-US_TASK_0172368536__en-us_task_0172368535_cmdname2141705464">mpls</span></b></a></p>
<p id="EN-US_TASK_0172368536__en-us_task_0172368535_p65921802461">MPLS is enabled, and the MPLS view is displayed.</p>
</li><li id="EN-US_TASK_0172368536__en-us_task_0172368535_li063753611213"><p id="EN-US_TASK_0172368536__en-us_task_0172368535_p1428420734617"><a name="EN-US_TASK_0172368536__en-us_task_0172368535_li063753611213"></a><a name="en-us_task_0172368535_li063753611213"></a>Run <a href="cmdqueryname=quit"><b><span class="cmdname" id="EN-US_TASK_0172368536__en-us_task_0172368535_cmdname11284117174611">quit</span></b></a></p>
<p id="EN-US_TASK_0172368536__en-us_task_0172368535_p118072712469">Return to the system view.</p>
</li><li id="EN-US_TASK_0172368536__en-us_task_0172368535_li14383623112213"><p id="EN-US_TASK_0172368536__en-us_task_0172368535_p44081711154616"><a name="EN-US_TASK_0172368536__en-us_task_0172368535_li14383623112213"></a><a name="en-us_task_0172368535_li14383623112213"></a>Run <a href="cmdqueryname=mpls+ldp"><b><span class="cmdname" id="EN-US_TASK_0172368536__en-us_task_0172368535_cmdname14081611154618">mpls ldp</span></b></a></p>
<p id="EN-US_TASK_0172368536__en-us_task_0172368535_p17903111114469">The MPLS-LDP view is displayed.</p>
</li><li id="EN-US_TASK_0172368536__en-us_task_0172368535_li216653411221"><p id="EN-US_TASK_0172368536__en-us_task_0172368535_p1591314154613"><a name="EN-US_TASK_0172368536__en-us_task_0172368535_li216653411221"></a><a name="en-us_task_0172368535_li216653411221"></a>Run <a href="cmdqueryname=mldp+p2mp"><b><span class="cmdname" id="EN-US_TASK_0172368536__en-us_task_0172368535_cmdname059914114616">mldp p2mp</span></b></a></p>
<p id="EN-US_TASK_0172368536__en-us_task_0172368535_p11548151410467">mLDP P2MP is enabled globally.</p>
</li><li id="EN-US_TASK_0172368536__en-us_task_0172368535_li15276203613225"><p id="EN-US_TASK_0172368536__en-us_task_0172368535_p1024771815463"><a name="EN-US_TASK_0172368536__en-us_task_0172368535_li15276203613225"></a><a name="en-us_task_0172368535_li15276203613225"></a>Run <strong id="EN-US_TASK_0172368536__en-us_task_0172368535_b12247141824612"><a href="cmdqueryname=mldp+default-route-match+ignore"><b><span class="cmdname" id="EN-US_TASK_0172368536__en-us_task_0172368535_cmdname152478183468">mldp default-route-match ignore</span></b></a></strong></p>
<p id="EN-US_TASK_0172368536__en-us_task_0172368535_p08079184468">mLDP is disabled from using the default route to establish tunnels.</p>
</li><li id="EN-US_TASK_0172368536__en-us_task_0172368535_li1533252817245"><p id="EN-US_TASK_0172368536__en-us_task_0172368535_p1570532114615"><a name="EN-US_TASK_0172368536__en-us_task_0172368535_li1533252817245"></a><a name="en-us_task_0172368535_li1533252817245"></a>Run <a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0172368536__en-us_task_0172368535_cmdname1470552117469">commit</span></b></a></p>
<p id="EN-US_TASK_0172368536__en-us_task_0172368535_p520619227467">The configuration is committed.</p>
</li></ol>
</p></li></ul></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ldp-p2p_cfg_0060.html">Configuring an mLDP P2MP Tunnel
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ldp-p2p_cfg_0061.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_te-p2p_cfg_6014-ldp2.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>