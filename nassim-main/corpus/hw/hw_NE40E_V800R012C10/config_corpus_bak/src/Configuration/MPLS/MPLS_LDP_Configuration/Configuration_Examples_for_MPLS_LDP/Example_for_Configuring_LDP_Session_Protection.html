
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring LDP Session Protection">
<meta name="abstract" content="This session provides an example for configuring LDP session protection. The configuration involves configuring a local LDP session and the LDP session protection function.">
<meta name="description" content="This session provides an example for configuring LDP session protection. The configuration involves configuring a local LDP session and the LDP session protection function.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ldp-p2p_cfg_0038.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ldp-p2p_cfg_0054.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ldp-p2p_cfg_0045.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="ldp-p2pvrp,w00800033,z00545680,w00556928,w00606909,z00809835,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="MPLS LDP">
<meta name="featurename" content="MPLS TE">
<meta name="featuretype" content="MPLS">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="MPLS LDP">
<meta name="featurename" content="MPLS TE">
<meta name="featuretype" content="MPLS">
<meta name="featurename" content="MPLS LDP">
<meta name="featurename" content="MPLS TE">
<meta name="featuretype" content="MPLS">
<meta name="featurename" content="MPLS LDP">
<meta name="featuretype" content="MPLS">
<meta name="OWNER" content="z00809835">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="b00896120">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172368595">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>Example for Configuring LDP Session Protection</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172368595"></a><a name="EN-US_TASK_0172368595"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring LDP Session Protection</h1>
<div class="taskbody"><p>This session provides an example for configuring LDP session protection. The configuration involves configuring a local LDP session and the LDP session protection function.</p>
<div class="context"><a name="EN-US_TASK_0172368595__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0172368595__fig_dc_vrp_ldp-p2p_cfg_008001">Figure 1</a>, PE1 and PE2 are directly connected, and a redundancy link is deployed between them. The customer requires that the LDP session between PE1 and PE2 and and their peer relationship remain connected if the direct link between the PEs fails. To meet this requirement, you can configure LDP session protection.</p>
<div class="fignone" id="EN-US_TASK_0172368595__fig_dc_vrp_ldp-p2p_cfg_008001"><a name="EN-US_TASK_0172368595__fig_dc_vrp_ldp-p2p_cfg_008001"></a><a name="fig_dc_vrp_ldp-p2p_cfg_008001"></a><span class="figcap"><b>Figure 1 </b>Networking diagram of LDP session protection</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 and 2 in this example represent GE <span>0/1/0</span> and GE <span>0/1/1</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0279183714.png" width="NaN" height="NaN"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172368595__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Assign an IP address to each interface and configure an IGP.</p>
</li><li><p>Configure a local LDP session.</p>
</li><li><p>Configure LDP session protection.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172368595__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>

<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" frame="border" border="1" rules="all"><caption><b>Table 1 </b>Data to be prepared</caption><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="17.66823317668233%" id="mcps1.4.3.3.2.4.1.1" liSelected="liSelected"><p>Device Name</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="34.66653334666533%" id="mcps1.4.3.3.2.4.1.2" liSelected="liSelected"><p>Parameter</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="47.66523347665233%" id="mcps1.4.3.3.2.4.1.3" liSelected="liSelected"><p>Value</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" valign="top" width="17.66823317668233%" headers="mcps1.4.3.3.2.4.1.1 "><p><strong>PE1</strong></p>
</td>
<td class="cellrowborder" valign="top" width="34.66653334666533%" headers="mcps1.4.3.3.2.4.1.2 "><p>Session hold time</p>
</td>
<td class="cellrowborder" valign="top" width="47.66523347665233%" headers="mcps1.4.3.3.2.4.1.3 "><p>Infinite</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="17.66823317668233%" headers="mcps1.4.3.3.2.4.1.1 "><p><strong>PE2</strong></p>
</td>
<td class="cellrowborder" valign="top" width="34.66653334666533%" headers="mcps1.4.3.3.2.4.1.2 "><p>Session hold time</p>
</td>
<td class="cellrowborder" valign="top" width="47.66523347665233%" headers="mcps1.4.3.3.2.4.1.3 "><p>Infinite</p>
</td>
</tr>
</tbody>
</table>
</div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172368595__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Assign an IP address to each interface and configure an IGP. For configuration details, see <a href="#EN-US_TASK_0172368595__example_01">Configuration Files</a> in this section.</span></li><li><span>Configure a local LDP session.</span><p><p># Configure PE1.</p>
<pre class="screen">&lt;PE1&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> mpls lsr-id 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>commit</strong></pre>
<p># Repeat this step for PE2. For configuration details, see <a href="#EN-US_TASK_0172368595__example_01">Configuration Files</a> in this section.</p>
</p></li><li><span>Configure LDP session protection.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp] <strong>session protection duration infinite</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-mpls-ldp] <strong>quit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-ldp] <strong>session protection duration infinite</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-ldp] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-mpls-ldp] <strong>quit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><div class="p"># Shut down GE <span>0/1/1</span> on PE1 to simulate a link fault. Run the <a href="cmdqueryname=display+mpls+ldp+remote-peer"><b><span class="cmdname">display mpls ldp remote-peer</span></b></a> command. The command output shows that LDP session protection has taken effect.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display mpls ldp remote-peer </strong></pre>
<pre class="screen">                         LDP Remote Entity Information
 ------------------------------------------------------------------------------
 Remote Peer Name  : pe2
 Description       : ----
 Remote Peer IP    : 3.3.3.3              LDP ID        : 1.1.1.1:0
 Transport Address : 1.1.1.1              Entity Status : Active

 Configured Keepalive Hold Timer : 45 Sec
 Configured Keepalive Send Timer : ----
 Configured Hello Hold Timer     : 45 Sec
 Negotiated Hello Hold Timer     : 45 Sec
 Configured Hello Send Timer     : ----
 Configured Delay Timer          : 10 Sec
 Hello Packet sent/received      : 91/86
 Label Advertisement Mode        : Downstream Unsolicited
 Auto-config                     : Session-Protect
 Manual-config                   : effective
 Session-Protect effect          : <strong>YES</strong>
 Session-Protect Duration        : infinite
 Session-Protect Remain          : ----
 ------------------------------------------------------------------------------
 TOTAL: 1 Remote-Peer(s) Found.</pre>
</div>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0172368595__example_01"><a name="EN-US_TASK_0172368595__example_01"></a><a name="example_01"></a><a name="EN-US_TASK_0172368595__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>PE1 configuration file</p>
<pre class="screen">#
sysname PE1
#
mpls lsr-id 1.1.1.1
#
mpls
#
mpls ldp
 session protection duration infinite
 #
 ipv4-family
#
isis 1
 is-level level-2
 network-entity 10.0000.0000.0001.00
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.1.1 255.255.255.252
 isis enable 1
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 10.1.2.1 255.255.255.252
 isis enable 1
 mpls
 mpls ldp
#
interface LoopBack0
 ip address 1.1.1.1 255.255.255.255
 isis enable 1
#
return</pre>
</li><li><p>PE3 configuration file</p>
<pre class="screen">#
sysname PE3
#
isis 1
 is-level level-2
 network-entity 10.0000.0000.0003.00
#               
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.1.2 255.255.255.252
 isis enable 1
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 10.1.3.1 255.255.255.252
 isis enable 1
#
interface LoopBack0
 ip address 2.2.2.2 255.255.255.255
 isis enable 1
#
return</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#
sysname PE2
#
mpls lsr-id 3.3.3.3
#
mpls
#
mpls ldp
 session protection duration infinite
 #
 ipv4-family
#
isis 1
 is-level level-2
 network-entity 10.0000.0000.0002.00
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.3.2 255.255.255.252
 isis enable 1
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 10.1.2.2 255.255.255.252
 isis enable 1
 mpls
 mpls ldp
#
interface LoopBack0
 ip address 3.3.3.3 255.255.255.255
 isis enable 1
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ldp-p2p_cfg_0038.html">Configuration Examples for MPLS LDP
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ldp-p2p_cfg_0054.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ldp-p2p_cfg_0045.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>