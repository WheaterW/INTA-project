
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="(Optional) Configuring the Protection Switching Function">
<meta name="abstract" content="A protection switching function, such as link or node protection, can be configured to provide high availability for an inter-AS seamless MPLS network.">
<meta name="description" content="A protection switching function, such as link or node protection, can be configured to provide high availability for an inter-AS seamless MPLS network.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_seamless_mpls_cfg_0013.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_seamless_mpls_cfg_0035.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_seamless_mpls_cfg_0043-1.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="Seamless MPLS">
<meta name="featuretype" content="MPLS">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="Seamless MPLS">
<meta name="featuretype" content="MPLS">
<meta name="featurename" content="Seamless MPLS">
<meta name="featuretype" content="MPLS">
<meta name="featurename" content="Seamless MPLS">
<meta name="featuretype" content="MPLS">
<meta name="OWNER" content="l00425560">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="b00896120">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172368656">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>(Optional) Configuring the Protection Switching Function</title>
</head>
<body><a name="EN-US_TASK_0172368656"></a><a name="EN-US_TASK_0172368656"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">(Optional) Configuring the Protection Switching Function</h1>
<div class="taskbody"><p>A protection switching function, such as link or node protection, can be configured to provide high availability for an inter-AS seamless MPLS network.</p>
<div class="context"><a name="EN-US_TASK_0172368656__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><div class="p">On an inter-AS seamless MPLS network that has protection switching enabled, if a link or node fails, traffic switches to a backup path, which implements uninterrupted traffic transmission.
<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" frame="border" border="1" rules="all"><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="19.68%" id="mcps1.4.1.1.1.1.6.1.1" liSelected="liSelected"><p>Tunnel Type</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="20.080000000000002%" id="mcps1.4.1.1.1.1.6.1.2" liSelected="liSelected"><p>Protected Object</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="20.080000000000002%" id="mcps1.4.1.1.1.1.6.1.3" liSelected="liSelected"><p>Nodes to Be Configured</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="20.080000000000002%" id="mcps1.4.1.1.1.1.6.1.4" liSelected="liSelected"><p>Detection Method</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="20.080000000000002%" id="mcps1.4.1.1.1.1.6.1.5" liSelected="liSelected"><p>Protection Function</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" valign="top" width="19.68%" headers="mcps1.4.1.1.1.1.6.1.1 "><p>MPLS TE tunnel (without Ps on links at the network layer)</p>
</td>
<td class="cellrowborder" align="left" valign="top" width="20.080000000000002%" headers="mcps1.4.1.1.1.1.6.1.2 "><p>Protects access rings, aggregation rings, and links at the core layer.</p>
</td>
<td class="cellrowborder" align="left" valign="top" width="20.080000000000002%" headers="mcps1.4.1.1.1.1.6.1.3 "><p>All nodes</p>
</td>
<td class="cellrowborder" valign="top" width="20.080000000000002%" headers="mcps1.4.1.1.1.1.6.1.4 "><p><a href="#EN-US_TASK_0172368656__BFD_interface">Configure BFD for interface.</a></p>
</td>
<td class="cellrowborder" align="left" valign="middle" width="20.080000000000002%" headers="mcps1.4.1.1.1.1.6.1.5 "><p>Configure either of the following TE FRR functions:</p>
<ul><li><p><a href="#EN-US_TASK_0172368656__TE_FRR1">Configure TE manual FRR.</a></p>
</li><li><p><a href="#EN-US_TASK_0172368656__TE_FRR2">Configure MPLS TE Auto FRR.</a></p>
</li></ul>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="19.68%" headers="mcps1.4.1.1.1.1.6.1.1 "><p>MPLS TE tunnel (with Ps on links at the network layer)</p>
</td>
<td class="cellrowborder" valign="top" width="20.080000000000002%" headers="mcps1.4.1.1.1.1.6.1.2 "><p>Protects access rings, aggregation rings, and links at the core layer.</p>
</td>
<td class="cellrowborder" valign="top" width="20.080000000000002%" headers="mcps1.4.1.1.1.1.6.1.3 "><p>All nodes</p>
</td>
<td class="cellrowborder" valign="top" width="20.080000000000002%" headers="mcps1.4.1.1.1.1.6.1.4 "><p><a href="#EN-US_TASK_0172368656__BFD_CR-LSP1">Configure static BFD for CR-LSP</a> or <a href="#EN-US_TASK_0172368656__BFD_CR-LSP2">dynamic BFD for CR-LSP.</a></p>
</td>
<td class="cellrowborder" align="left" valign="middle" width="20.080000000000002%" headers="mcps1.4.1.1.1.1.6.1.5 "><p><a href="#EN-US_TASK_0172368656__Hotstandby2">Configure CR-LSP hot standby.</a></p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="19.68%" headers="mcps1.4.1.1.1.1.6.1.1 "><p>MPLS TE tunnel</p>
</td>
<td class="cellrowborder" valign="top" width="20.080000000000002%" headers="mcps1.4.1.1.1.1.6.1.2 "><p>Protects AGGs, AGG ASBRs, and core ASBRs.</p>
</td>
<td class="cellrowborder" valign="top" width="20.080000000000002%" headers="mcps1.4.1.1.1.1.6.1.3 "><p>CSGs, AGGs, AGG ASBRs, and MASGs</p>
</td>
<td class="cellrowborder" valign="top" width="20.080000000000002%" headers="mcps1.4.1.1.1.1.6.1.4 "><p><a href="#EN-US_TASK_0172368656__BFD_TE">Configure BFD for TE.</a></p>
</td>
<td class="cellrowborder" align="left" valign="middle" width="20.080000000000002%" headers="mcps1.4.1.1.1.1.6.1.5 "><p>Configure BGP LSP FRR.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="19.68%" headers="mcps1.4.1.1.1.1.6.1.1 "><p>MPLS LDP LSP</p>
</td>
<td class="cellrowborder" valign="top" width="20.080000000000002%" headers="mcps1.4.1.1.1.1.6.1.2 "><p>Protects access rings and aggregation rings, as well as links, AGGs, AGG ASBRs, and core ASBRs at the core layer.</p>
</td>
<td class="cellrowborder" valign="top" width="20.080000000000002%" headers="mcps1.4.1.1.1.1.6.1.3 "><p>All nodes</p>
</td>
<td class="cellrowborder" valign="middle" width="20.080000000000002%" headers="mcps1.4.1.1.1.1.6.1.4 "><p><a href="#EN-US_TASK_0172368656__BFD_LDP1">Configure static BFD to monitor an LDP LSP</a> or <a href="#EN-US_TASK_0172368656__BFD_LDP2">dynamic BFD for LDP LSPs.</a></p>
</td>
<td class="cellrowborder" align="left" valign="middle" width="20.080000000000002%" headers="mcps1.4.1.1.1.1.6.1.5 "><p>Configure BGP LSP FRR.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="19.68%" headers="mcps1.4.1.1.1.1.6.1.1 "><p>MPLS TE tunnel or MPLS LDP LSP</p>
</td>
<td class="cellrowborder" valign="top" width="20.080000000000002%" headers="mcps1.4.1.1.1.1.6.1.2 "><p>Protect links between each pair of an AGG ASBR and a core ASBR.</p>
</td>
<td class="cellrowborder" valign="top" width="20.080000000000002%" headers="mcps1.4.1.1.1.1.6.1.3 "><p>AGG ASBRs and core ASBRs</p>
</td>
<td class="cellrowborder" valign="top" width="20.080000000000002%" headers="mcps1.4.1.1.1.1.6.1.4 "><p><a href="#EN-US_TASK_0172368656__BFD_interface">Configure BFD for interface.</a></p>
</td>
<td class="cellrowborder" valign="top" width="20.080000000000002%" headers="mcps1.4.1.1.1.1.6.1.5 "><p>Configure BGP LSP FRR.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="19.68%" headers="mcps1.4.1.1.1.1.6.1.1 "><p>MPLS TE tunnel or MPLS LDP LSP</p>
</td>
<td class="cellrowborder" valign="top" width="20.080000000000002%" headers="mcps1.4.1.1.1.1.6.1.2 "><p>Protects a whole BGP LSP and MP-BGP peers on an L3VPN.</p>
</td>
<td class="cellrowborder" valign="top" width="20.080000000000002%" headers="mcps1.4.1.1.1.1.6.1.3 "><p>CSGs and MASGs</p>
</td>
<td class="cellrowborder" valign="top" width="20.080000000000002%" headers="mcps1.4.1.1.1.1.6.1.4 "><p><a href="#EN-US_TASK_0172368656__BFD_BGPLSP">Configure BFD for BGP tunnel.</a></p>
</td>
<td class="cellrowborder" valign="top" width="20.080000000000002%" headers="mcps1.4.1.1.1.1.6.1.5 "><p>Configure either of the following VPN FRR functions:</p>
<ul><li><p><a href="#EN-US_TASK_0172368656__VPN1">Enable VPN FRR in the VPN instance IPv4 address family view.</a></p>
</li><li><a href="#EN-US_TASK_0172368656__VPN2">Enable VPN FRR in the BGP-VPN instance IPv4 address family view.</a></li></ul>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div></div>
<div class="steps-unordered"><a name="EN-US_TASK_0172368656__1.4.2"></a><a name="1.4.2"></a><h4 class="sectiontitle">Procedure</h4>
<ul><li id="EN-US_TASK_0172368656__BFD_interface"><span id="EN-US_TASK_0172368656__">Configure BFD for interface.</span><ol><li class="substepexpand"><span>Run <span><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=bfd+bind+peer-ip+vpn-instance+interface+source-ip"><b><span class="cmdname">bfd</span></b></a> <i><span class="varname">session-name</span></i> <strong><span>bind</span></strong> <strong><span>peer-ip</span></strong> <i><span class="varname">peer-ip</span></i> [ <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-name</span></i> ] <strong><span>interface</span></strong> <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i> [ <strong><span>source-ip</span></strong> <i><span class="varname">source-ip</span></i> ]</span></span><p><p>A BFD session for IPv4 is bound to an interface.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=discriminator+local"><b><span class="cmdname">discriminator</span></b></a> <strong><span>local</span></strong> <i><span class="varname">discr-value</span></i></span></span><p><p>The local discriminator of the BFD session is created.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=discriminator+remote"><b><span class="cmdname">discriminator</span></b></a> <strong><span>remote</span></strong> <i><span class="varname">discr-value</span></i></span></span><p><p>The remote discriminator of the BFD session is configured.</p>
</p><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The local and remote discriminators on the two ends of a BFD session must be correctly associated. That is, the local discriminator of the local device must be the same as the remote discriminator of the remote device, and the remote discriminator of the local device must be the same as the local discriminator of the remote device. If the association is incorrect, a BFD session cannot be set up.</p>
</div></div>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li id="EN-US_TASK_0172368656__TE_FRR1"><span id="EN-US_TASK_0172368656__">Configure TE manual FRR.</span><p><p>Perform the following steps on the ingress of the primary tunnel:</p>
</p><ol><li class="substepexpand"><span>Run <span><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=interface+tunnel"><b><span class="cmdname">interface tunnel</span></b></a> <i><span class="varname">tunnel-number</span></i></span></span><p><p>The tunnel interface view of the primary tunnel is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=mpls+te+fast-reroute+bandwidth"><b><span class="cmdname">mpls te fast-reroute</span></b></a> [ <strong><span>bandwidth</span></strong> ]</span></span><p><p>The TE FRR function is enabled.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span></span><p><p>The configuration is committed.</p>
</p></li></ol>
<p><p>Configure an FRR bypass tunnel.</p>
</p><ol><li class="substepexpand"><span>Run <span><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=interface+tunnel"><b><span class="cmdname">interface tunnel</span></b></a> <i><span class="varname">tunnel-number</span></i></span></span><p><p>The tunnel interface view of a bypass tunnel is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=tunnel-protocol+mpls+te"><b><span class="cmdname">tunnel-protocol mpls te</span></b></a></span></span><p><p>MPLS TE is configured as a tunnel protocol.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=destination"><b><span class="cmdname">destination</span></b></a> <i><span class="varname">ip-address</span></i></span></span><p><p>The LSR ID of an MP is configured as the destination address of the bypass tunnel.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=mpls+te+tunnel-id"><b><span class="cmdname">mpls te tunnel-id</span></b></a> <i><span class="varname">tunnel-id</span></i></span></span><p><p>A tunnel ID of the bypass tunnel is set.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <span><a href="cmdqueryname=mpls+te+path+explicit-path"><b><span class="cmdname">mpls te path explicit-path</span></b></a> <i><span class="varname">path-name</span></i></span></span><p><p>An explicit path is specified for the bypass tunnel.</p>
</p><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Physical links of a bypass tunnel cannot overlap protected physical links of the primary tunnel.</p>
</div></div>
</p></li><li class="substepexpand"><span>(Optional) Run <span><a href="cmdqueryname=mpls+te+bandwidth+ct0"><b><span class="cmdname">mpls te bandwidth</span></b></a> <strong><span>ct0</span></strong> <i><span class="varname">bandwidth</span></i></span></span><p><p>The bandwidth is set for the bypass tunnel.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=mpls+te+bypass-tunnel"><b><span class="cmdname">mpls te bypass-tunnel</span></b></a></span></span><p><p>The bypass tunnel function is enabled.</p>
<p>After a bypass tunnel is configured, the device automatically records routes related to the bypass tunnel.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Note the following settings to prevent a protection failure:</p>
<ul><li><p>A tunnel interface can only be used by either a bypass tunnel or a backup tunnel. That is, you can configure either the <a href="cmdqueryname=mpls+te+bypass-tunnel"><b><span class="cmdname">mpls te bypass-tunnel</span></b></a> command or <a href="cmdqueryname=mpls+te+backup"><b><span class="cmdname">mpls te backup</span></b></a> command.</p>
</li><li><p>A tunnel interface can only be used by either a bypass tunnel or a primary tunnel. That is, you can configure either the <a href="cmdqueryname=mpls+te+bypass-tunnel"><b><span class="cmdname">mpls te bypass-tunnel</span></b></a> command or <a href="cmdqueryname=mpls+te+fast-reroute"><b><span class="cmdname">mpls te fast-reroute</span></b></a> command.</p>
</li></ul>
</div></div>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=mpls+te+protected-interface"><b><span class="cmdname">mpls te protected-interface</span></b></a> <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i></span></span><p><p>The interface on which traffic is protected by the bypass tunnel is specified.</p>
</p><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><ul><li><p>A tunnel interface can only be used by either a bypass tunnel or a backup tunnel. That is, you can configure either the <a href="cmdqueryname=mpls+te+protected-interface"><b><span class="cmdname">mpls te protected-interface</span></b></a> command or <a href="cmdqueryname=mpls+te+backup"><b><span class="cmdname">mpls te backup</span></b></a> command.</p>
</li><li><p>A tunnel interface can only be used by either a bypass tunnel or a backup tunnel. That is, you can configure either the <a href="cmdqueryname=mpls+te+protected-interface"><b><span class="cmdname">mpls te protected-interface</span></b></a> command or <a href="cmdqueryname=mpls+te+fast-reroute"><b><span class="cmdname">mpls te fast-reroute</span></b></a> command.</p>
</li></ul>
</div></div>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li id="EN-US_TASK_0172368656__TE_FRR2"><span id="EN-US_TASK_0172368656__">Configure MPLS TE Auto FRR.</span><p><p>Perform the following steps on the ingress or a transit node of a primary tunnel:</p>
</p><ol><li class="substepexpand"><span>Run <span><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=mpls"><b><span class="cmdname">mpls</span></b></a></span></span><p><p>The MPLS view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=mpls+te+auto-frr"><b><span class="cmdname">mpls te auto-frr</span></b></a></span></span><p><p>MPLS TE Auto FRR is enabled globally.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span></span><p><p>Return to the system view.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=interface"><b><span class="cmdname">interface</span></b></a> <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i></span></span><p><p>The view of the outbound interface on the primary tunnel is displayed.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <span><a href="cmdqueryname=mpls+te+auto-frr+link+node+default"><b><span class="cmdname">mpls te auto-frr</span></b></a> { <strong><span>link</span></strong> | <strong><span>node</span></strong> | <strong><span>default</span></strong> }</span></span><p><p>TE Auto FRR is enabled on the interface.</p>
<p>By default, all MPLS TE-enabled interfaces support TE Auto FRR after MPLS TE Auto FRR is enabled globally. To disable TE Auto FRR on interfaces, run the <a href="cmdqueryname=mpls+te+auto-frr+block"><b><span class="cmdname">mpls te auto-frr</span></b></a> <strong><span>block</span></strong> command on these interfaces. The <a href="cmdqueryname=mpls+te+auto-frr+block"><b><span class="cmdname">mpls te auto-frr</span></b></a> <strong><span>block</span></strong> command disables TE Auto FRR on interfaces, even if TE Auto FRR is enabled or re-enabled globally.</p>
<p>By default, TE Auto FRR is disabled.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><ul><li><p>If the <a href="cmdqueryname=mpls+te+auto-frr+default"><b><span class="cmdname">mpls te auto-frr</span></b></a> <strong><span>default</span></strong> command is run, the interface Auto FRR capability status is the same as the global Auto FRR capability status.</p>
</li></ul>
</div></div>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=mpls+te+fast-reroute+bandwidth"><b><span class="cmdname">mpls te fast-reroute</span></b></a> <span>[ <strong><span>bandwidth</span></strong> ]</span></span></span><p><p>The TE FRR function is enabled.</p>
<p>The <strong><span>bandwidth</span></strong> parameter can be configured to enable FRR bandwidth protection for the primary tunnel.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <span><a href="cmdqueryname=mpls+te+bypass-attributes+bandwidth+priority"><b><span class="cmdname">mpls te bypass-attributes</span></b></a> <strong><span>bandwidth</span></strong> <i><span class="varname">bandwidth</span></i> [ <strong><span>priority</span></strong> <i><span class="varname">setup-priority</span></i> [ <i><span class="varname">hold-priority</span></i> ] ]</span></span><p><p>Attributes for the Auto FRR bypass tunnel are set.</p>
</p><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><ul><li><p>These attributes for the Auto FRR bypass tunnel can be set only after the <a href="cmdqueryname=mpls+te+fast-reroute+bandwidth"><b><span class="cmdname">mpls te fast-reroute</span></b></a> <strong><span>bandwidth</span></strong> command is run for the primary tunnel.</p>
</li><li>The Auto FRR bypass tunnel bandwidth cannot exceed the primary tunnel bandwidth.</li><li>If no attributes are configured for an Auto FRR bypass tunnel, the Auto FRR bypass tunnel by default uses the same bandwidth as that of the primary tunnel.</li><li><p>The setup priority of the bypass tunnel cannot be higher than the holding priority. Each priority of the bypass tunnel cannot be higher than that of the primary tunnel.</p>
</li><li><p>If the primary tunnel bandwidth is changed or FRR is disabled, the bypass tunnel attributes are automatically deleted.</p>
</li><li><p>On one TE tunnel interface, the bypass tunnel bandwidth and the multi-CT are mutually exclusive.</p>
</li></ul>
</div></div>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li id="EN-US_TASK_0172368656__BFD_CR-LSP1"><span id="EN-US_TASK_0172368656__">Configure static BFD for CR-LSP.</span><ol><li class="substepexpand"><span>Run <span><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=bfd"><b><span class="cmdname">bfd</span></b></a></span></span><p><p>BFD is enabled globally on the local node, and the BFD view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Return to the system view.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=bfd+bind+mpls-te+interface+tunnel+te-lsp+backup"><b><span class="cmdname">bfd</span></b></a> <i><span class="varname">session-name</span></i> <strong><span>bind</span></strong> <strong><span>mpls-te</span></strong> <strong><span>interface</span></strong> <strong><span>tunnel</span></strong> <i><span class="varname">interface-number</span></i> <strong><span>te-lsp</span></strong> [ <strong><span>backup</span></strong> ]</span></span><p><p>The BFD session is bound to the primary or backup CR-LSP of the specified tunnel.</p>
<p>If the <strong><span>backup</span></strong> parameter is specified, the BFD session is bound to the backup CR-LSP.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=discriminator+local"><b><span class="cmdname">discriminator</span></b></a> <strong><span>local</span></strong> <i><span class="varname">discr-value</span></i></span></span><p><p>The local discriminator of the BFD session is configured.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=discriminator+remote"><b><span class="cmdname">discriminator</span></b></a> <strong><span>remote</span></strong> <i><span class="varname">discr-value</span></i></span></span><p><p>The remote discriminator of the BFD session is configured.</p>
</p><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The local discriminator of the local device and the remote discriminator of the remote device are the same, and the remote discriminator of the local device and the local discriminator of the remote device are the same. A discriminator inconsistency causes the BFD session to fail to be established.</p>
</div></div>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=process-pst"><b><span class="cmdname">process-pst</span></b></a></span></span><p><p>BFD is enabled to modify the port status table or link status table.</p>
</p><p><p>If the BFD session on a trunk or VLAN member interface allows BFD to modify the port status table or link status table, and the interface is configured with the BFD session, you must configure the WTR time for the BFD session for detecting the interface. This prevents the BFD session on the interface from flapping when the member interface joins or leave the interface.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=min-tx-interval"><b><span class="cmdname">min-tx-interval</span></b></a> <i><span class="varname">tx-interval</span></i></span><p><p>The minimum interval at which BFD packets are sent is configured.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=min-rx-interval"><b><span class="cmdname">min-rx-interval</span></b></a> <i><span class="varname">rx-interval</span></i></span><p><p>The local minimum interval at which BFD packets are received is configured.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <span><a href="cmdqueryname=detect-multiplier"><b><span class="cmdname">detect-multiplier</span></b></a> <i><span class="varname">multiplier</span></i></span></span><p><p>The local BFD detection multiplier is configured.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li id="EN-US_TASK_0172368656__BFD_CR-LSP2"><span id="EN-US_TASK_0172368656__">Configure dynamic BFD for CR-LSP.</span><ol><li class="substepexpand"><span>Run <span><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=bfd"><b><span class="cmdname">bfd</span></b></a></span></span><p><p>BFD is enabled globally on the local node, and the BFD view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=interface+tunnel"><b><span class="cmdname">interface tunnel</span></b></a> <i><span class="varname">interface-number</span></i></span><p><p>The tunnel interface view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=mpls+te+bfd+enable"><b><span class="cmdname">mpls te bfd enable</span></b></a></span></span><p><p>The capability of dynamically creating BFD sessions is enabled on the TE tunnel.</p>
<p>The command configured in the tunnel interface view takes effect only on the current tunnel interface.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li id="EN-US_TASK_0172368656__Hotstandby2"><span id="EN-US_TASK_0172368656__">Configure CR-LSP hot standby.</span><ol><li class="substepexpand"><span>Run <span><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=interface+tunnel"><b><span class="cmdname">interface tunnel</span></b></a> <i><span class="varname">tunnel-number</span></i></span></span><p><p>The MPLS TE tunnel interface view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=mpls+te+backup+hot-standby+mode+revertive+wtr+non-revertive"><b><span class="cmdname">mpls te backup</span></b></a> <strong><span>hot-standby</span></strong> [ <strong><span>mode</span></strong> { <strong><span>revertive</span></strong> [ <strong><span>wtr</span></strong> <i><span class="varname">interval</span></i> ] | <strong><span>non-revertive</span></strong> } | <strong><span>overlap-path</span></strong> | <strong><span>wtr</span></strong> [ <i><span class="varname">interval</span></i> ] | <strong><span>dynamic-bandwidth</span></strong> ]</span></span><p><p>CR-LSP hot standby is configured.</p>
</p><p><div class="p">Select the following parameters as needed to enable sub-functions:<ul><li><p><strong><span>mode</span></strong> <strong><span>revertive</span></strong> [ <strong><span>wtr</span></strong> <i><span class="varname">interval</span></i> ]: enables a device to switch traffic back to the primary CR-LSP.</p>
</li><li><p><strong><span>mode</span></strong> <strong><span>non-revertive</span></strong>: disables a device from switching traffic back to the primary CR-LSP.</p>
</li><li><p><strong><span>overlap-path</span></strong>: allows a hot-standby CR-LSP to overlap the primary CR-LSP if no available path is provided for the hot-standby CR-LSP.</p>
</li><li><p><strong><span>wtr</span></strong> <i><span class="varname">interval</span></i>: sets the time before a traffic switchback is performed.</p>
</li><li><p><strong><span>dynamic-bandwidth</span></strong>: enables a hot-standby CR-LSP to obtain bandwidth resources only after the hot-standby CR-LSP takes over traffic from a faulty primary CR-LSP. This function helps efficiently use network resources and reduce network costs.</p>
</li></ul>
</div>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li id="EN-US_TASK_0172368656__BFD_TE"><span id="EN-US_TASK_0172368656__">Configure BFD for TE.</span><ol><li class="substepexpand"><span>Run <span><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=bfd"><b><span class="cmdname">bfd</span></b></a></span></span><p><p>BFD is enabled globally on the local node, and the BFD view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Return to the system view.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=bfd+bind+mpls-te+interface+tunnel"><b><span class="cmdname">bfd</span></b></a> <i><span class="varname">session-name</span></i> <strong><span>bind</span></strong> <strong><span>mpls-te</span></strong> <strong><span>interface</span></strong> <strong><span>tunnel</span></strong> <i><span class="varname">interface-number</span></i></span></span><p><p>The TE tunnel to be detected by BFD sessions is specified.</p>
</p><p><p>When the TE tunnel is in the Down state, a BFD session cannot be established.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=discriminator+local"><b><span class="cmdname">discriminator</span></b></a> <strong><span>local</span></strong> <i><span class="varname">discr-value</span></i></span></span><p><p>The local discriminator of the BFD session is configured.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=discriminator+remote"><b><span class="cmdname">discriminator</span></b></a> <strong><span>remote</span></strong> <i><span class="varname">discr-value</span></i></span></span><p><p>The remote discriminator of the BFD session is configured.</p>
</p><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The local discriminator of the local device and the remote discriminator of the remote device are the same, and the remote discriminator of the local device and the local discriminator of the remote device are the same. A discriminator inconsistency causes the BFD session to fail to be established.</p>
</div></div>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=process-pst"><b><span class="cmdname">process-pst</span></b></a></span></span><p><p>BFD is enabled to modify the port status table or link status table.</p>
</p><p><p>If the BFD session on a trunk or VLAN member interface allows BFD to modify the port status table or link status table, and the interface is configured with the BFD session, you must configure the WTR time for the BFD session for detecting the interface. This prevents the BFD session on the interface from flapping when the member interface joins or leave the interface.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=min-tx-interval"><b><span class="cmdname">min-tx-interval</span></b></a> <i><span class="varname">tx-interval</span></i></span><p><p>The minimum interval at which BFD packets are sent is configured.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=min-rx-interval"><b><span class="cmdname">min-rx-interval</span></b></a> <i><span class="varname">rx-interval</span></i></span><p><p>The local minimum interval at which BFD packets are received is configured.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <span><a href="cmdqueryname=detect-multiplier"><b><span class="cmdname">detect-multiplier</span></b></a> <i><span class="varname">multiplier</span></i></span></span><p><p>The local BFD detection multiplier is configured.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li id="EN-US_TASK_0172368656__BFD_LDP1"><span id="EN-US_TASK_0172368656__">Configure static BFD to monitor an LDP LSP.</span><ol><li class="substepexpand"><span>Run <span><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=bfd"><b><span class="cmdname">bfd</span></b></a></span></span><p><p>BFD is enabled globally on the local node, and the BFD view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Return to the system view.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=bfd+bind+ldp-lsp+peer-ip+nexthop+interface"><b><span class="cmdname">bfd</span></b></a> <i><span class="varname">session-name</span></i> <strong><span>bind</span></strong> <strong><span>ldp-lsp</span></strong> <strong><span>peer-ip</span></strong> <i><span class="varname">ip-address</span></i> <strong><span>nexthop</span></strong> <i><span class="varname">ip-address</span></i> [ <strong><span>interface</span></strong> <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i> ]</span></span><p><p>A BFD session is bound to an LDP LSP.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=discriminator+local"><b><span class="cmdname">discriminator</span></b></a> <strong><span>local</span></strong> <i><span class="varname">discr-value</span></i></span></span><p><p>The local discriminator of the BFD session is configured.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=discriminator+remote"><b><span class="cmdname">discriminator</span></b></a> <strong><span>remote</span></strong> <i><span class="varname">discr-value</span></i></span></span><p><p>The remote discriminator of the BFD session is configured.</p>
</p><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The local discriminator of the local device and the remote discriminator of the remote device are the same, and the remote discriminator of the local device and the local discriminator of the remote device are the same. A discriminator inconsistency causes the BFD session to fail to be established.</p>
</div></div>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=process-pst"><b><span class="cmdname">process-pst</span></b></a></span></span><p><p>BFD is enabled to modify the port status table or link status table.</p>
</p><p><p>If the BFD session on a trunk or VLAN member interface allows BFD to modify the port status table or link status table, and the interface is configured with the BFD session, you must configure the WTR time for the BFD session for detecting the interface. This prevents the BFD session on the interface from flapping when the member interface joins or leave the interface.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=min-tx-interval"><b><span class="cmdname">min-tx-interval</span></b></a> <i><span class="varname">tx-interval</span></i></span><p><p>The minimum interval at which BFD packets are sent is configured.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=min-rx-interval"><b><span class="cmdname">min-rx-interval</span></b></a> <i><span class="varname">rx-interval</span></i></span><p><p>The local minimum interval at which BFD packets are received is configured.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <span><a href="cmdqueryname=detect-multiplier"><b><span class="cmdname">detect-multiplier</span></b></a> <i><span class="varname">multiplier</span></i></span></span><p><p>The local BFD detection multiplier is configured.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li id="EN-US_TASK_0172368656__BFD_LDP2"><span id="EN-US_TASK_0172368656__">Configure dynamic BFD for LDP LSPs.</span><p><p>Perform the following steps on the ingress:</p>
</p><ol><li class="substepexpand"><span>Run <span><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=bfd"><b><span class="cmdname">bfd</span></b></a></span></span><p><p>BFD is enabled globally.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span></span><p><p>Return to the system view.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=mpls"><b><span class="cmdname">mpls</span></b></a></span></span><p><p>The MPLS view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=mpls+bfd+enable"><b><span class="cmdname">mpls bfd enable</span></b></a></span></span><p><p>The capability of dynamically establishing a BFD session is configured on the ingress.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=mpls+bfd-trigger+host+fec-list"><b><span class="cmdname">mpls bfd-trigger</span></b></a> { <strong><span>host</span></strong> | <strong><span>fec-list</span></strong> <i><span class="varname">list-name</span></i> }</span><p><p>A policy for establishing an LDP BFD session is configured.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span></span><p><p>The configuration is committed.</p>
</p></li></ol>
<p><p>Perform the following steps on the egress:</p>
</p><ol><li class="substepexpand"><span>Run <span><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=bfd"><b><span class="cmdname">bfd</span></b></a></span></span><p><p>BFD is enabled globally, and the BFD view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=mpls-passive"><b><span class="cmdname">mpls-passive</span></b></a></span></span><p><p>The capability of passively creating a BFD session is configured on the egress.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li><span>Configure BGP LSP FRR.</span><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In a seamless MPLS scenario, BGP LSP FRR must be configured on both the ingress and a transit node.</p>
</div></div>
</p><p><p>Perform the following steps on the ingress:</p>
</p><ol><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ipv4-family+unicast"><b><span class="cmdname">ipv4-family</span></b></a> <strong><span>unicast</span></strong></span><p><p>The BGP-IPv4 unicast address family view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=auto-frr"><b><span class="cmdname">auto-frr</span></b></a></span><p><p>BGP Auto FRR is enabled for unicast routes.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bestroute+nexthop-resolved+tunnel"><b><span class="cmdname">bestroute nexthop-resolved</span></b></a> <strong><span>tunnel</span></strong><span> [ <strong><span>inherit-ip-cost</span></strong> ]</span></span><p><p>Labeled BGP IPv4 unicast routes can participate in route selection only when their next hops recurse to tunnels.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ingress-lsp+protect-mode+bgp-frr"><b><span class="cmdname">ingress-lsp protect-mode bgp-frr</span></b></a></span><p><p>BGP LSP FRR is enabled.</p>
</p><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Perform this step on each CSG and MASG to enable the protection switching function for the whole BGP LSP.</p>
</div></div>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=route-select+delay"><b><span class="cmdname">route-select delay</span></b></a> <i><span class="varname">delay-value</span></i></span><p><p>A delay for selecting a route to the intermediate device on the primary path is configured. After the primary path recovers, an appropriate delay ensures that traffic switches back to the primary path after the intermediate device completes refreshing forwarding entries.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
<p><p>Perform the following steps on the transit node:</p>
</p><ol><li class="substepexpand"><span>Run <span><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=ipv4-family+unicast"><b><span class="cmdname">ipv4-family</span></b></a> <strong><span>unicast</span></strong></span></span><p><p>The BGP-IPv4 unicast address family view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=auto-frr"><b><span class="cmdname">auto-frr</span></b></a></span></span><p><p>BGP Auto FRR is enabled for unicast routes.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bestroute+nexthop-resolved+tunnel"><b><span class="cmdname">bestroute nexthop-resolved</span></b></a> <strong><span>tunnel</span></strong><span> [ <strong><span>inherit-ip-cost</span></strong> ]</span></span><p><p>Labeled BGP IPv4 unicast routes can participate in route selection only when their next hops recurse to tunnels.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=route-select+delay"><b><span class="cmdname">route-select delay</span></b></a> <i><span class="varname">delay-value</span></i></span><p><p>A delay for selecting a route to the intermediate device on the primary path is configured. After the primary path recovers, an appropriate delay ensures that traffic switches back to the primary path after the intermediate device completes refreshing forwarding entries.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li id="EN-US_TASK_0172368656__BFD_BGPLSP"><span id="EN-US_TASK_0172368656__">Configure BFD for BGP tunnel.</span><p><p>Perform the following steps on the ingress of an E2E BGP tunnel:</p>
</p><ol><li class="substepexpand"><span>Run <span><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=bfd"><b><span class="cmdname">bfd</span></b></a></span></span><p><p>BFD is enabled globally.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span></span><p><p>Return to the system view.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=mpls"><b><span class="cmdname">mpls</span></b></a></span></span><p><p>The MPLS view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=mpls+bgp+bfd+enable"><b><span class="cmdname">mpls bgp bfd enable</span></b></a></span></span><p><p>The capability of dynamically establishing BGP BFD sessions is enabled on the ingress.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=mpls+bgp+bfd-trigger-tunnel+host+ip-prefix"><b><span class="cmdname">mpls bgp bfd-trigger-tunnel</span></b></a> { <strong><span>host</span></strong> | <strong><span>ip-prefix</span></strong> <i><span class="varname">ip-prefix-name</span></i> }</span></span><p><p>A policy for dynamically establishing a BGP BFD session is configured.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span></span><p><p>The configuration is committed.</p>
</p></li></ol>
<p><p>Perform the following steps on the egress of an E2E BGP tunnel:</p>
</p><ol><li class="substepexpand"><span>Run <span><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=bfd"><b><span class="cmdname">bfd</span></b></a></span></span><p><p>BFD is enabled globally, and the BFD view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=mpls-passive"><b><span class="cmdname">mpls-passive</span></b></a></span></span><p><p>The capability of passively creating a BFD session is configured on the egress.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li id="EN-US_TASK_0172368656__VPN1"><span id="EN-US_TASK_0172368656__">Enable VPN FRR in the VPN instance IPv4 address family view.</span><ol><li class="substepexpand"><span>Run <span><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=ip+vpn-instance"><b><span class="cmdname">ip vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i></span></span><p><p>The VPN instance view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=ipv4-family"><b><span class="cmdname">ipv4-family</span></b></a></span></span><p><p>The VPN instance IPv4 address family view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=vpn+frr"><b><span class="cmdname">vpn frr</span></b></a></span></span><p><p>VPN FRR is enabled.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <span><a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span></span><p><p>Return to the VPN instance view.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <span><a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span></span><p><p>Return to the system view.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=peer+mpls-local-ifnet+disable"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">group-name</span></i> | <i><span class="varname">ipv4-address</span></i> } <strong><span>mpls-local-ifnet</span></strong> <strong><span>disable</span></strong></span><p><p>The capability of establishing an MPLS local IFNET tunnel between a CSG and MASG is disabled.</p>
</p><p><p>In the inter-AS seamless MPLS network transmitting L3VPN services, a CSG and MASG establish an MP-EBGP peer relationship. Therefore, an MPLS local IFNET tunnel between the CSG and MASG is automatically established over the MP-EBGP peer relationship. The MPLS local IFNET tunnel fails to transmit traffic because the CSG and MASG are indirectly connected.</p>
<p>If a fault occurs on the tunnel between the CSG and MASG, traffic recurses to the MPLS local IFNET tunnel, not a backup tunnel or an FRR bypass tunnel. As the MPLS local IFNET tunnel cannot forward traffic, traffic is interrupted. To prevent the traffic interruption, run the <a href="cmdqueryname=peer+mpls-local-ifnet+disable"><b><span class="cmdname">peer mpls-local-ifnet disable</span></b></a> command to disable the establishment of an MPLS local IFNET tunnel between the CSG and MASG.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <span><a href="cmdqueryname=ipv4-family+vpn-instance"><b><span class="cmdname">ipv4-family</span></b></a> <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i></span></span><p><p>The BGP-VPN instance IPv4 address family view is displayed.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <span><a href="cmdqueryname=route-select+delay"><b><span class="cmdname">route-select delay</span></b></a> <i><span class="varname">delay-value</span></i></span></span><p><p>A delay for selecting a route to the intermediate device on the primary path is configured. After the primary path recovers, an appropriate delay ensures that traffic switches back to the primary path after the intermediate device completes refreshing forwarding entries.</p>
<p>The <i><span class="varname">delay-value</span></i> is an integer ranging from 0 to 3600, in seconds. The default <i><span class="varname">delay-value</span></i> is 0, indicating that the device on which FRR is configured selects a route to the intermediate device on the primary path without a delay.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li id="EN-US_TASK_0172368656__VPN2"><span id="EN-US_TASK_0172368656__">Enable VPN FRR in the BGP-VPN instance IPv4 address family view.</span><ol><li class="substepexpand"><span>Run <span><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=peer+mpls-local-ifnet+disable"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">group-name</span></i> | <i><span class="varname">ipv4-address</span></i> } <strong><span>mpls-local-ifnet</span></strong> <strong><span>disable</span></strong></span><p><p>The capability of establishing an MPLS local IFNET tunnel between a CSG and MASG is disabled.</p>
<p>In the inter-AS seamless MPLS network transmitting L3VPN services, a CSG and MASG establish an MP-EBGP peer relationship. Therefore, an MPLS local IFNET tunnel between the CSG and MASG is automatically established over the MP-EBGP peer relationship. The MPLS local IFNET tunnel fails to transmit traffic because the CSG and MASG are indirectly connected.</p>
<p>If a fault occurs on the tunnel between the CSG and MASG, traffic recurses to the MPLS local IFNET tunnel, not a backup tunnel or an FRR bypass tunnel. As the MPLS local IFNET tunnel cannot forward traffic, traffic is interrupted. To prevent the traffic interruption, run the <a href="cmdqueryname=peer+mpls-local-ifnet+disable"><b><span class="cmdname">peer mpls-local-ifnet disable</span></b></a> command to disable the establishment of an MPLS local IFNET tunnel between the CSG and MASG.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=ipv4-family+vpn-instance"><b><span class="cmdname">ipv4-family</span></b></a> <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i></span></span><p><p>The BGP-VPN instance IPv4 address family view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=auto-frr"><b><span class="cmdname">auto-frr</span></b></a></span></span><p><p>VPN Auto FRR is enabled.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <span><a href="cmdqueryname=route-select+delay"><b><span class="cmdname">route-select delay</span></b></a> <i><span class="varname">delay-value</span></i></span></span><p><p>A delay for selecting a route to the intermediate device on the primary path is configured. After the primary path recovers, an appropriate delay ensures that traffic switches back to the primary path after the intermediate device completes refreshing forwarding entries.</p>
<p>The <i><span class="varname">delay-value</span></i> is an integer ranging from 0 to 3600, in seconds. The default <i><span class="varname">delay-value</span></i> is 0, indicating that the device on which FRR is configured selects a route to the intermediate device on the primary path without a delay.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li></ul></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_seamless_mpls_cfg_0013.html">Configuring Inter-AS Seamless MPLS
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_seamless_mpls_cfg_0035.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_seamless_mpls_cfg_0043-1.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>