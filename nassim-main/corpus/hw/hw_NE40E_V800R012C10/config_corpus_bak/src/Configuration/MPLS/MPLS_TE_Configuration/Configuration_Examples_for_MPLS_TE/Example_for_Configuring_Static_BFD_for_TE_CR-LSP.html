
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Static BFD for TE CR-LSP">
<meta name="abstract" content="By configuring static BFD for TE CR-LSP, enable a device to switch traffic to the backup CR-LSP if the primary CR-LSP fails. When the primary CR-LSP recovers, the traffic can switch back from the backup CR-LSP to the primary CR-LSP.">
<meta name="description" content="By configuring static BFD for TE CR-LSP, enable a device to switch traffic to the backup CR-LSP if the primary CR-LSP fails. When the primary CR-LSP recovers, the traffic can switch back from the backup CR-LSP to the primary CR-LSP.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_te-p2p_cfg_0093.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_te-p2p_cfg_0172.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_te-p2p_cfg_0150.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,te-p2pvrp,w00556928,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="MPLS TE">
<meta name="featuretype" content="MPLS">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="MPLS TE">
<meta name="featuretype" content="MPLS">
<meta name="featurename" content="MPLS TE">
<meta name="featuretype" content="MPLS">
<meta name="featurename" content="MPLS TE">
<meta name="featuretype" content="MPLS">
<meta name="OWNER" content="l00468467">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="w00845984">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172368357">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring Static BFD for TE CR-LSP</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172368357"></a><a name="EN-US_TASK_0172368357"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Static BFD for TE CR-LSP</h1>
<div class="taskbody"><p>By configuring static BFD for TE CR-LSP, enable a device to switch traffic to the backup CR-LSP if the primary CR-LSP fails. When the primary CR-LSP recovers, the traffic can switch back from the backup CR-LSP to the primary CR-LSP.</p>
<div class="context"><a name="EN-US_TASK_0172368357__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><div class="p"><a href="#EN-US_TASK_0172368357__fig_dc_vrp_te-p2p_cfg_013001">Figure 1</a> illustrates CR-LSP hot standby. A TE tunnel between PE1 and PE2 is established. The tunnel is enabled with hot standby and configured with the best-effort path. The following requirements must be met: <ul><li><p>The primary CR-LSP is PE1 â P1 â PE2.</p>
</li><li><p>The backup CR-LSP is PE1 â P2 â PE2.</p>
</li></ul>
If the primary CR-LSP fails, traffic switches to the backup CR-LSP. After the primary CR-LSP recovers, traffic switches back to the primary CR-LSP after a 15-second delay. If both the primary and backup CR-LSPs fail, traffic switches to the best-effort path. Explicit paths can be configured for the primary and backup CR-LSPs. A best-effort path can be generated automatically. In this example, the best-effort path is PE1 -&gt; P2 -&gt; P1 -&gt; PE2. The calculated best-effort path varies according to the faulty node.</div>
<p>Two static BFD sessions are established to monitor the primary and backup CR-LSPs. After the configuration, the following objects are achieved:</p>
<ul><li><p>If the primary CR-LSP fails, traffic is rapidly switched to the backup CR-LSP.</p>
</li><li><p>If the primary CR-LSP recovers and the backup CR-LSP fails during the switchover time (15s), traffic switches back to the primary CR-LSP.</p>
</li></ul>
<div class="fignone" id="EN-US_TASK_0172368357__fig_dc_vrp_te-p2p_cfg_013001"><a name="EN-US_TASK_0172368357__fig_dc_vrp_te-p2p_cfg_013001"></a><a name="fig_dc_vrp_te-p2p_cfg_013001"></a><span class="figcap"><b>Figure 1 </b>Networking diagram for CR-LSP hot standby</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 through 3 in this example represent GE <span>0/1/0</span>, GE <span>0/2/0</span>, and GE <span>0/3/0</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_te-p2p_cfg_013001.png"></span><br></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172368357__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Precautions</h4><p>None.</p>
</div></div>
<div class="context"><a name="EN-US_TASK_0172368357__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure CR-LSP hot standby.</p>
</li><li>Configure reverse CR-LSPs for a BFD session.<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>A reverse CR-LSP must be established for each of the primary and hot-standby CR-LSPs.</p>
</div></div>
</li><li><p>On PE1, establish two BFD sessions and bind one to the primary CR-LSP and the other to the hot-standby CR-LSP; on PE2, establish two BFD sessions and bind both sessions to the IP link (PE2 â PE1).</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172368357__1.4.4"></a><a name="1.4.4"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>Name of a BFD session</p>
</li><li><p>Local and remote discriminators of BFD sessions</p>
</li><li><p>Minimum intervals at which BFD packets are sent and received</p>
</li><li><p>For other data, see "Example for Configure a Hot-standby CR-LSP."</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172368357__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure CR-LSP hot standby.</span><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>For configuration details, see "Example for Configuring a Hot-standby CR-LSP."</p>
</div></div>
</p></li><li><span>Configure reverse CR-LSPs.</span><p><p>The reverse CR-LSP configuration on PE2 is similar to the forward CR-LSP configuration on PE1. For configuration details, see <a href="#EN-US_TASK_0172368357__section_dc_vrp_te-p2p_cfg_013005">Configuration Files</a> in this section.</p>
</p></li><li><span>Configure BFD for TE CR-LSP.</span><p><p># Establish BFD sessions between PE1 and PE2 to monitor the primary and backup CR-LSPs. Bind the BFD sessions on PE1 to the primary and backup CR-LSP and the BFD session on PE2 to the IP link. Set the minimum intervals at which BFD packets are sent and received to 100 milliseconds.</p>
<p># Configure PE1.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname PE1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>bfd</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bfd] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> bfd mainlsptope2 bind mpls-te interface tunnel 1 te-lsp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bfd-lsp-session-mainlsptope2] <strong>discriminator local 413</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bfd-lsp-session-mainlsptope2] <strong>discriminator remote 314</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bfd-lsp-session-mainlsptope2] <strong>min-tx-interval 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bfd-lsp-session-mainlsptope2] <strong>min-rx-interval 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bfd-lsp-session-mainlsptope2] <strong>process-pst</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bfd-lsp-session-mainlsptope2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> bfd backuplsptope2 bind mpls-te interface tunnel 1 te-lsp backup</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bfd-lsp-session-backuplsptope2] <strong>discriminator local 423</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bfd-lsp-session-backuplsptope2] <strong>discriminator remote 324</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bfd-lsp-session-backuplsptope2] <strong>min-tx-interval 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bfd-lsp-session-backuplsptope2] <strong>min-rx-interval 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bfd-lsp-session-backuplsptope2] <strong>process-pst</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bfd-lsp-session-backuplsptope2] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bfd-lsp-session-backuplsptope2] <strong>quit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname PE2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>bfd</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bfd] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> bfd mainlsptope2 bind mpls-te interface Tunnel2 te-lsp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bfd-lsp-session-mainlsptope2]<strong> discriminator local 314</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bfd-lsp-session-mainlsptope2]<strong> discriminator remote 413</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bfd-lsp-session-mainlsptope2]<strong> min-tx-interval 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bfd-lsp-session-mainlsptope2]<strong> min-rx-interval 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bfd-lsp-session-mainlsptope2]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> bfd backuplsptope2 bind mpls-te interface Tunnel2 te-lsp backup</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bfd-lsp-session-backuplsptope2]<strong> discriminator local 324</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bfd-lsp-session-backuplsptope2]<strong> discriminator remote 423</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bfd-lsp-session-backuplsptope2]<strong> min-tx-interval 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bfd-lsp-session-backuplsptope2]<strong> min-rx-interval 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bfd-lsp-session-backuplsptope2]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bfd-lsp-session-backuplsptope2]<strong> quit</strong></pre>
<p># After completing the configuration, run the <strong>display bfd session discriminator</strong> <em>local-discriminator-value</em> command on PE1 and PE2. The status of BFD sessions is Up.</p>
<p>The following example uses the command output on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> display bfd session discriminator 413</strong></pre>
<pre class="screen"><span>(w): State in WTR 
(*): State is invalid</span>
--------------------------------------------------------------------------------
Local Remote     PeerIpAddr      State     Type        InterfaceName 
--------------------------------------------------------------------------------
413   314        3.3.3.3         <strong>Up</strong>        S_TE_LSP    Tunnel1
--------------------------------------------------------------------------------</pre>
<pre class="screen">--------------------------------------------------------------------------------</pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display bfd session discriminator 423</strong></pre>
<pre class="screen"><span>(w): State in WTR 
(*): State is invalid</span>
--------------------------------------------------------------------------------
Local Remote     PeerIpAddr      State     Type        InterfaceName 
--------------------------------------------------------------------------------
423   324        3.3.3.3         <strong>Up</strong>        S_TE_LSP    Tunnel1
--------------------------------------------------------------------------------</pre>
</p></li><li><span>Verify the configuration.</span><p><p>Connect port 1 and port 2 on a tester to PE1 and PE2, respectively. Set correct label values. Inject MPLS traffic destined for port 2 into port 1. After the cable is removed from GE <span>0/2/0</span> on PE1 or GE <span>0/2/0</span> on P1, the fault is rectified within milliseconds.</p>
<p>After inserting the cable into GE <span>0/2/0</span> and then removing the cable from GE <span>0/1/0</span> on PE1 within 15 seconds, the fault is rectified in milliseconds.</p>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0172368357__section_dc_vrp_te-p2p_cfg_013005"><a name="EN-US_TASK_0172368357__section_dc_vrp_te-p2p_cfg_013005"></a><a name="section_dc_vrp_te-p2p_cfg_013005"></a><a name="EN-US_TASK_0172368357__1.4.6"></a><a name="1.4.6"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>PE1 configuration file</p>
<pre class="screen">#
sysname PE1
#
bfd
#
mpls lsr-id 4.4.4.4
#
mpls
 mpls te
 mpls rsvp-te
 mpls te cspf
#
 explicit-path backup
  next hop 10.3.1.2
  next hop 10.5.1.2
  next hop 3.3.3.3
#
 explicit-path main
  next hop 10.4.1.2
  next hop 10.2.1.2
  next hop 3.3.3.3
#
isis 1
 cost-style wide
 network-entity 10.0000.0000.0004.00
 traffic-eng level-1-2
#
interface GigabitEthernet<span>0/1/0</span>
 ip address 10.3.1.1 255.255.255.252
 isis enable 1
 mpls
 mpls te
 mpls rsvp-te
#
interface GigabitEthernet<span>0/2/0</span>
 ip address 10.4.1.1 255.255.255.252
 isis enable 1
 mpls
 mpls te
 mpls rsvp-te
#
interface LoopBack1
 ip address 4.4.4.4 255.255.255.255
 isis enable 1
#
interface Tunnel 1
 ip address unnumbered interface LoopBack1
 tunnel-protocol mpls te
 destination 3.3.3.3
 mpls te tunnel-id 100
 mpls te record-route
 mpls te path explicit-path main
 mpls te path explicit-path backup secondary
 mpls te backup hot-standby wtr 15
 mpls te backup ordinary best-effort
#
bfd mainlsptope2 bind mpls-te interface Tunnel1 te-lsp
 discriminator local 413
 discriminator remote 314
 min-tx-interval 100
 min-rx-interval 100
 process-pst
#
bfd backuplsptope2 bind mpls-te interface Tunnel1 te-lsp backup
 discriminator local 423
 discriminator remote 324
 min-tx-interval 100
 min-rx-interval 100
 process-pst
#
return</pre>
</li><li><p>P1 configuration file</p>
<pre class="screen">#
sysname P1
#
mpls lsr-id 1.1.1.1
#
mpls
 mpls te
 mpls rsvp-te
#
isis 1
 cost-style wide
 network-entity 10.0000.0000.0001.00
 traffic-eng level-1-2
#
interface GigabitEthernet<span>0/1/0</span>
 ip address 10.1.1.1 255.255.255.252
 isis enable 1
 mpls
 mpls te
 mpls rsvp-te
#
interface GigabitEthernet<span>0/2/0</span>
 ip address 10.4.1.2 255.255.255.252
 isis enable 1
 mpls
 mpls te
 mpls rsvp-te
#
interface GigabitEthernet<span>0/3/0</span>
 ip address 10.2.1.1 255.255.255.252
 isis enable 1
 mpls
 mpls te
 mpls rsvp-te
#
interface LoopBack1
 ip address 1.1.1.1 255.255.255.255
 isis enable 1
#
return</pre>
</li><li><p>P2 configuration file</p>
<pre class="screen">#
sysname P2
#
mpls lsr-id 2.2.2.2
#
mpls
 mpls te
 mpls rsvp-te
#
isis 1
 cost-style wide
 network-entity 10.0000.0000.0002.00
 traffic-eng level-1-2
#
interface GigabitEthernet<span>0/1/0</span>
 ip address 10.1.1.2 255.255.255.252
 isis enable 1
 mpls
 mpls te
 mpls rsvp-te
#
interface GigabitEthernet<span>0/2/0</span>
 ip address 10.5.1.1 255.255.255.252
 isis enable 1
 mpls
 mpls te
 mpls rsvp-te
#
interface GigabitEthernet<span>0/3/0</span>
 ip address 10.3.1.2 255.255.255.252
 isis enable 1
 mpls
 mpls te
 mpls rsvp-te
#
interface LoopBack1
 ip address 2.2.2.2 255.255.255.255
 isis enable 1
#
return</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#
sysname PE2
#
bfd
#
mpls lsr-id 3.3.3.3
#
mpls
 mpls te
 mpls rsvp-te
 mpls te cspf
#
isis 1
 cost-style wide
 network-entity 10.0000.0000.0003.00
 traffic-eng level-1-2
#
interface GigabitEthernet<span>0/1/0</span>
 ip address 10.2.1.2 255.255.255.252
 isis enable 1
 mpls
 mpls te
 mpls rsvp-te
#
interface GigabitEthernet<span>0/2/0</span>
 ip address 10.5.1.2 255.255.255.252
 isis enable 1
 mpls
 mpls te
 mpls rsvp-te
#
interface LoopBack1
 ip address 3.3.3.3 255.255.255.255
 isis enable 1
#
interface Tunnel2
 ip address unnumbered interface LoopBack1
 tunnel-protocol mpls te
 destination 4.4.4.4
 mpls te record-route
 mpls te backup ordinary best-effort
 mpls te backup hot-standby 
 mpls te tunnel-id 502
#
bfd mainlsptope2 bind mpls-te interface Tunnel2 te-lsp
 discriminator local 314
 discriminator remote 413
 min-tx-interval 100
 min-rx-interval 100
 process-pst
#
bfd backuplsptope2 bind mpls-te interface Tunnel2 te-lsp backup
 discriminator local 324
 discriminator remote 423
 min-tx-interval 100
 min-rx-interval 100
 process-pst
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_te-p2p_cfg_0093.html">Configuration Examples for MPLS TE
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_te-p2p_cfg_0172.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_te-p2p_cfg_0150.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>