
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring the Affinity Attribute of an MPLS TE Tunnel">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_te-p2p_cfg_0093.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_te-p2p_cfg_0210.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_te-p2p_cfg_0098.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,te-p2pvrp,w00556928,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="MPLS TE">
<meta name="featuretype" content="MPLS">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="MPLS TE">
<meta name="featuretype" content="MPLS">
<meta name="featurename" content="MPLS TE">
<meta name="featuretype" content="MPLS">
<meta name="featurename" content="MPLS TE">
<meta name="featuretype" content="MPLS">
<meta name="OWNER" content="l00468467">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="w00845984">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172368324">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring the Affinity Attribute of an MPLS TE Tunnel</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172368324"></a><a name="EN-US_TASK_0172368324"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring the Affinity Attribute of an MPLS TE Tunnel</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0172368324__1.3.1"></a><a name="1.3.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0172368324__fig_dc_vrp_te-p2p_cfg_009501">Figure 1</a>, the bandwidth of the link between LSRA and LSRB is 50 Mbit/s. The maximum reservable bandwidth of other links is 100 Mbit/s, and BC0 bandwidth is 100 Mbit/s.</p>
<p>Two tunnels named Tunnel1 and Tunnel2 from LSRA to LSRC are established on LSRA. Both tunnels require 40 Mbit/s of bandwidth. The combined bandwidth of these two tunnels is 80 Mbit/s, higher than the bandwidth of 50 Mbit/s provided by the shared link between LSRA and LSRB. In addition, Tunnel2 has a higher priority than Tunnel1, and preemption is enabled.</p>
<p>In this example, administrative group attributes, affinities, and masks for links are used to allow Tunnel1 and Tunnel2 on LSRA to use separate links between LSRB and LSRC.</p>
<div class="fignone" id="EN-US_TASK_0172368324__fig_dc_vrp_te-p2p_cfg_009501"><a name="EN-US_TASK_0172368324__fig_dc_vrp_te-p2p_cfg_009501"></a><a name="fig_dc_vrp_te-p2p_cfg_009501"></a><span class="figcap"><b>Figure 1 </b>Networking diagram for an MPLS TE tunnel with the affinity property</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 through 3 in this example represent GE <span>0/1/0</span>, GE <span>0/2/0</span>, and GE <span>0/3/0</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_te-p2p_cfg_009501.png" width="NaN" height="NaN"></span><br></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172368324__1.3.2"></a><a name="1.3.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Notes</h4><p>None.</p>
</div></div>
<div class="context"><a name="EN-US_TASK_0172368324__1.3.3"></a><a name="1.3.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure an RSVP-TE tunnel. See "Configuration Roadmap" in <a href="dc_vrp_te-p2p_cfg_0094.html">Example for Configuring an RSVP-TE Tunnel</a>.</p>
</li><li><p>Configure an administrative group attribute on an outbound interface of every LSR along each RSVP TE tunnel.</p>
</li><li><p>Configure the affinity and mask for each tunnel based on the administrative groups of links and networking requirements.</p>
</li><li><p>Set a priority value for each tunnel.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172368324__1.3.4"></a><a name="1.3.4"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>OSPF process ID and area ID for every LSR</p>
</li><li><p>Maximum <span>reservable</span> bandwidth and <span>BC</span> bandwidth for every link along each tunnel</p>
</li><li><p>Administrative groups for links between LSRA and LSRB and between LSRB and LSRC</p>
</li><li><p>Affinity and mask for each tunnel</p>
</li><li><p>Tunnel interface number, source and destination IP addresses, bandwidth, priority values, and RSVP-TE signaling protocol of the tunnel</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172368324__1.3.5"></a><a name="1.3.5"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Assign an IP address and its mask to every interface.</span><p><p>Assign an IP address and its mask to every physical interface and configure a loopback interface address as an LSR ID on every node according to <a href="#EN-US_TASK_0172368324__fig_dc_vrp_te-p2p_cfg_009501">Figure 1</a>.</p>
<p>For configuration details, see <a href="#EN-US_TASK_0172368324__section_dc_vrp_cfg_00383805">Configuration Files</a> in this section.</p>
</p></li><li><span>Configure an IGP.</span><p><p>Configure OSPF on every LSR to advertise every network segment route and host route.</p>
<p>For configuration details, see <a href="#EN-US_TASK_0172368324__section_dc_vrp_cfg_00383805">Configuration Files</a> in this section.</p>
</p></li><li><span>Configure basic MPLS functions, enable MPLS TE, RSVP-TE, and OSPF TE on every LSR, and enable CSPF on the ingress.</span><p><p># Configure basic MPLS functions and enable MPLS TE and RSVP-TE on every LSR.</p>
<p>The following example uses the command output on LSRA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA]<strong> mpls lsr-id 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-mpls] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-mpls] <strong>mpls rsvp-te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-GigabitEthernet<span>0/1/0</span>] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-GigabitEthernet<span>0/1/0</span>] <strong>mpls rsvp-te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-GigabitEthernet<span>0/1/0</span>]<strong> quit</strong></pre>
<p># Enable OSPF TE on every LSR. The following example uses the command output on LSRA.</p>
<pre class="screen">[<span class="keyword">*</span>LSRA] <strong>ospf</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-ospf-1]<strong> opaque-capability enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-ospf-1] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-ospf-1-area-0.0.0.0]<strong> mpls-te enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-ospf-1-area-0.0.0.0]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-ospf-1]<strong> quit</strong></pre>
<p>Repeat this step for LSRB and LSRC. For configuration details, see <a href="#EN-US_TASK_0172368324__section_dc_vrp_cfg_00383805">Configuration Files</a> in this section.</p>
<p># Enable CSPF on the ingress LSRA.</p>
<pre class="screen">[<span class="keyword">*</span>LSRA]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-mpls]<strong> mpls te cspf</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-mpls]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA-mpls] <strong>quit</strong></pre>
</p></li><li><span>Configure MPLS TE attributes on the outbound interface of every LSR.</span><p><p># Set the maximum reservable link bandwidth and BC0 bandwidth to 50 Mbit/s on LSRA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA-GigabitEthernet<span>0/1/0</span>] <strong>mpls te bandwidth max-reservable-bandwidth 50000</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-GigabitEthernet<span>0/1/0</span>]<strong> mpls te bandwidth bc0 50000</strong></pre>
<p># Set the administrative group to 0x10001 on LSRA.</p>
<pre class="screen">[<span class="keyword">*</span>LSRA-GigabitEthernet<span>0/1/0</span>] <strong>mpls te link administrative group 10001</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-GigabitEthernet<span>0/1/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA-GigabitEthernet<span>0/1/0</span>]<strong> quit</strong></pre>
<p># Configure MPLS TE attributes on LSRB.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRB]<strong> interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRB-GigabitEthernet<span>0/2/0</span>] <strong>mpls te bandwidth max-reservable-bandwidth 100000</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRB-GigabitEthernet<span>0/2/0</span>]<strong> mpls te bandwidth bc0 100000</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRB-GigabitEthernet<span>0/2/0</span>] <strong>mpls te link administrative group 10101</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRB-GigabitEthernet<span>0/2/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRB]<strong> interface gigabitethernet <span>0/3/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRB-GigabitEthernet<span>0/3/0</span>] <strong>mpls te bandwidth max-reservable-bandwidth 100000</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRB-GigabitEthernet<span>0/3/0</span>]<strong> mpls te bandwidth bc0 100000</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRB-GigabitEthernet<span>0/3/0</span>] <strong>mpls te link administrative group 10011</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRB-GigabitEthernet<span>0/3/0</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRB-GigabitEthernet<span>0/3/0</span>]<strong> quit</strong></pre>
<p>After completing the configurations, run the <a href="cmdqueryname=display+mpls+te+cspf+tedb+node"><b><span class="cmdname">display mpls te cspf tedb node</span></b></a> command on LSRA. TEDB information contains maximum available and reservable bandwidth for every link, and the administrative group attribute in the <strong>Color</strong> field.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA] <strong>display mpls te cspf tedb node</strong></pre>
<pre class="screen"> Router ID: 1.1.1.1
 IGP Type: OSPF      Process ID: 1      IGP Area: 0
  MPLS-TE Link Count: 1
  Link[1]:
    OSPF Router ID: 192.168.1.1      Opaque LSA ID: 1.0.0.1
    Interface IP Address: 192.168.1.1
    DR Address: 192.168.1.2
    IGP Area: 0
    Link  Type: Multi-access  Link Status: Active
    IGP Metric: 1               TE Metric: 1           <strong>Color: 0x10001</strong>
    Bandwidth Allocation Model : -
    <strong>Maximum Link-Bandwidth: 50000 (kbps)</strong>
    <strong>Maximum Reservable Bandwidth: 50000 (kbps)</strong>
    Operational Mode of Router: TE
    Bandwidth Constraints:         Local Overbooking Multiplier:
        BC[0]:       50000 (kbps)           LOM[0]:          1
    BW  Unreserved:
        Class  ID:
        [0]:       50000 (kbps),            [1]:       50000 (kbps)
        [2]:       50000 (kbps),            [3]:       50000 (kbps)
        [4]:       50000 (kbps),            [5]:       50000 (kbps)
        [6]:       50000 (kbps),            [7]:       50000 (kbps)
 Router ID: 2.2.2.2
 IGP Type: OSPF      Process ID: 1      IGP Area: 0
  MPLS-TE Link Count: 3
  Link[1]:
    OSPF Router ID: 192.168.1.2      Opaque LSA ID: 1.0.0.1
    Interface IP Address: 192.168.1.2
    DR Address: 192.168.1.2
    IGP Area: 0
    Link  Type: Multi-access  Link Status: Active
    IGP Metric: 1               TE Metric: 1           Color: 0x0
    Bandwidth Allocation Model : -
    Maximum Link-Bandwidth: 0 (kbps)
    Maximum Reservable Bandwidth: 0 (kbps)
    Operational Mode of Router: TE
    Bandwidth Constraints:         Local Overbooking Multiplier:
        BC[0]:           0 (kbps)           LOM[0]:          1
    BW  Unreserved:
        Class  ID:
        [0]:           0 (kbps),            [1]:           0 (kbps)
        [2]:           0 (kbps),            [3]:           0 (kbps)
        [4]:           0 (kbps),            [5]:           0 (kbps)
        [6]:           0 (kbps),            [7]:           0 (kbps)
  Link[2]:
    OSPF Router ID: 192.168.1.2      Opaque LSA ID: 1.0.0.3
    Interface IP Address: 192.168.2.1
    DR Address: 192.168.2.1
    IGP Area: 0
    Link  Type: Multi-access  Link Status: Active
    IGP Metric: 1               TE Metric: 1           Color: 0x10101
    Bandwidth Allocation Model : -
    Maximum Link-Bandwidth: 100000 (kbps)
    Maximum Reservable Bandwidth: 100000 (kbps)
    Operational Mode of Router: TE
    Bandwidth Constraints:         Local Overbooking Multiplier:
        BC[0]:      100000 (kbps)           LOM[0]:          1
    BW  Unreserved:
        Class  ID:
        [0]:      100000 (kbps),            [1]:      100000 (kbps)
        [2]:      100000 (kbps),            [3]:      100000 (kbps)
        [4]:      100000 (kbps),            [5]:      100000 (kbps)
        [6]:      100000 (kbps),            [7]:      100000 (kbps)
  Link[3]:
    OSPF Router ID: 192.168.1.2      Opaque LSA ID: 1.0.0.2
    Interface IP Address: 192.168.3.1
    DR Address: 192.168.3.1
    IGP Area: 0
    Link  Type: Multi-access  Link Status: Active
    IGP Metric: 1               TE Metric: 1           Color: 0x10011
    Bandwidth Allocation Model : -
    Maximum Link-Bandwidth: 100000 (kbps)
    Maximum Reservable Bandwidth: 100000 (kbps)
    Operational Mode of Router: TE
    Bandwidth Constraints:         Local Overbooking Multiplier:
        BC[0]:      100000 (kbps)           LOM[0]:          1
    BW  Unreserved:
        Class  ID:
        [0]:      100000 (kbps),            [1]:      100000 (kbps)
        [2]:      100000 (kbps),            [3]:      100000 (kbps)
        [4]:      100000 (kbps),            [5]:      100000 (kbps)
        [6]:      100000 (kbps),            [7]:      100000 (kbps)
 Router ID: 3.3.3.3
 IGP Type: OSPF      Process ID: 1      IGP Area: 0
  MPLS-TE Link Count: 2
  Link[1]:
    OSPF Router ID: 4.4.4.4      Opaque LSA ID: 1.0.0.2
    Interface IP Address: 192.168.2.2
    DR Address: 192.168.2.1
    IGP Area: 0
    Link  Type: Multi-access  Link Status: Active
    IGP Metric: 1               TE Metric: 1           Color: 0x0
    Bandwidth Allocation Model : -
    Maximum Link-Bandwidth: 0 (kbps)
    Maximum Reservable Bandwidth: 0 (kbps)
    Operational Mode of Router: TE
    Bandwidth Constraints:         Local Overbooking Multiplier:
        BC[0]:           0 (kbps)           LOM[0]:          1
    BW  Unreserved:
        Class  ID:
        [0]:           0 (kbps),            [1]:           0 (kbps)
        [2]:           0 (kbps),            [3]:           0 (kbps)
        [4]:           0 (kbps),            [5]:           0 (kbps)
        [6]:           0 (kbps),            [7]:           0 (kbps)
  Link[2]:
    OSPF Router ID: 4.4.4.4      Opaque LSA ID: 1.0.0.1
    Interface IP Address: 192.168.3.2
    DR Address: 192.168.3.1
    IGP Area: 0
    Link  Type: Multi-access  Link Status: Active
    IGP Metric: 1               TE Metric: 1           Color: 0x0
    Bandwidth Allocation Model : -
    Maximum Link-Bandwidth: 0 (kbps)
    Maximum Reservable Bandwidth: 0 (kbps)
    Operational Mode of Router: TE
    Bandwidth Constraints:         Local Overbooking Multiplier:
        BC[0]:           0 (kbps)           LOM[0]:          1
    BW  Unreserved:
        Class  ID:
        [0]:           0 (kbps),            [1]:           0 (kbps)
        [2]:           0 (kbps),            [3]:           0 (kbps)
        [4]:           0 (kbps),            [5]:           0 (kbps)
        [6]:           0 (kbps),            [7]:           0 (kbps)</pre>
</p></li><li><span>Configure an MPLS TE tunnel.</span><p><p># Configure a tunnel named <strong>Tunnel1</strong> on LSRA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA]<strong> interface tunnel1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-Tunnel1] <strong>ip address unnumbered interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-Tunnel1] <strong>tunnel-protocol mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-Tunnel1]<strong> destination 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-Tunnel1]<strong> mpls te tunnel-id 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-Tunnel1]<strong> mpls te bandwidth <span>ct0 </span>40000</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-Tunnel1]<strong> mpls te affinity property 10101 mask 11011</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-Tunnel1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA-Tunnel1]<strong> quit</strong></pre>
<p>The default setup and hold priorities (lowest: 7) are used.</p>
<p>The mask of Tunnel1's affinity attribute is 0x11011. As such, the first two bits of the affinity attribute value need to be compared, so do the last two bits. In contrast, the third bit in the middle is ignored. Because the affinity value of Tunnel1 is 0x10101, this tunnel selects the link with the second and fourth bits of the administrative group attribute being 0 and at least one of the first and fifth bits being 1. According to the preceding rules, if the value of the administrative group attribute is 0x10001, 0x10000, 0x00001, 0x10101, 0x10100, or 0x00101, the value meets requirements. Tunnel1 then selects the link between GE <span>0/1/0</span> of LSRA (the administrative group value is 0x10001) and GE <span>0/2/0</span> of LSRB (the administrative group value is 0x10101).</p>
<p>After completing the configuration, run the <a href="cmdqueryname=display+mpls+te+tunnel-interface"><b><span class="cmdname">display mpls te tunnel-interface</span></b></a> command on LSRA. The tunnel status is displayed.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA]<strong> display mpls te tunnel-interface</strong></pre>
<pre class="screen">    Tunnel Name       : Tunnel1
    Signalled Tunnel Name: -
    Tunnel State Desc : CR-LSP is Up
    Tunnel Attributes   :     
    Active LSP          : Primary LSP                                       
    Traffic Switch      : - 
    Session ID          : 1
    Ingress LSR ID      : 1.1.1.1               Egress LSR ID: 3.3.3.3
    Admin State         : UP                    Oper State   : UP
    Signaling Protocol  : RSVP
    FTid                : 1
    Tie-Breaking Policy : None                  Metric Type  : None
    Bfd Cap             : None                  
    Reopt               : Disabled              Reopt Freq   : -              
<span>    Inter-area Reopt    : Disabled </span>
    Auto BW             : Disabled              Threshold    : 0 percent
    Current Collected BW: 0 kbps                Auto BW Freq : 0
    Min BW              : 0 kbps                Max BW       : 0 kbps
    Offload             : Disabled              Offload Freq : - 
    Low Value           : -                     High Value   : - 
    Readjust Value      : - 
    Offload Explicit Path Name: 
    Tunnel Group        : -                                              
    Interfaces Protected: -
    Excluded IP Address : -
    Referred LSP Count  : 0  
    Primary Tunnel      : -                     Pri Tunn Sum : -              
    Backup Tunnel       : -                                                    
    Group Status        : Up                    Oam Status   : -             
    IPTN InLabel        : -                     Tunnel BFD Status : -                               
    BackUp LSP Type     : None                  BestEffort   : Enabled
    Secondary HopLimit  : -
    BestEffort HopLimit  : -
    Secondary Explicit Path Name: -
    Secondary Affinity Prop/Mask: 0x0/0x0
    BestEffort Affinity Prop/Mask: 0x0/0x0  
    IsConfigLspConstraint: -
    Hot-Standby Revertive Mode:  Revertive
    Hot-Standby Overlap-path:  Disabled
    Hot-Standby Switch State:  CLEAR
    Bit Error Detection:  Disabled
    Bit Error Detection Switch Threshold:  -
    Bit Error Detection Resume Threshold:  -
    Ip-Prefix Name    : -
    P2p-Template Name : -
    PCE Delegate      : No             LSP Control Status : Local control
    Path Verification : --
    Entropy Label     : None 
    Auto BW Remain Time : 200 s   Reopt Remain Time  : 100 s
<span>    Metric Inherit IGP : None</span>
<span>    Binding Sid       : -                     Reverse Binding Sid : - </span>
    Self-Ping         : Disable               Self-Ping Duration : 1800 sec
    FRR Attr Source   : -                     Is FRR degrade down : No

    Primary LSP ID      : 1.1.1.1:19
    LSP State           : UP                    LSP Type     : Primary
    Setup Priority      : 7                     Hold Priority: 7
    IncludeAll          : 0x0
    IncludeAny          : 0x0
    ExcludeAny          : 0x0
    Affinity Prop/Mask  : 0x0/0x0               Resv Style   :  SE
    Configured Bandwidth Information:
    CT0 Bandwidth(Kbit/sec): 10000           CT1 Bandwidth(Kbit/sec): 0
    CT2 Bandwidth(Kbit/sec): 0               CT3 Bandwidth(Kbit/sec): 0
    CT4 Bandwidth(Kbit/sec): 0               CT5 Bandwidth(Kbit/sec): 0
    CT6 Bandwidth(Kbit/sec): 0               CT7 Bandwidth(Kbit/sec): 0
    Actual Bandwidth Information:
    CT0 Bandwidth(Kbit/sec): 10000           CT1 Bandwidth(Kbit/sec): 0
    CT2 Bandwidth(Kbit/sec): 0               CT3 Bandwidth(Kbit/sec): 0
    CT4 Bandwidth(Kbit/sec): 0               CT5 Bandwidth(Kbit/sec): 0
    CT6 Bandwidth(Kbit/sec): 0               CT7 Bandwidth(Kbit/sec): 0
    Explicit Path Name  : -                                Hop Limit: -
    Record Route        : Disabled              Record Label : Disabled
    Route Pinning       : Disabled
    FRR Flag            : Disabled
    IdleTime Remain     : -
    BFD Status          : -
    Soft Preemption     : Enabled 
    Reroute Flag        : Disabled
    Pce Flag      : Normal  <span>
    Path Setup Type     : CSPF</span>
    Create Modify LSP Reason: -
    Self-Ping Status    : -</pre>
<p>Run the <a href="cmdqueryname=display+mpls+te+cspf+tedb+node"><b><span class="cmdname">display mpls te cspf tedb node</span></b></a> command on LSRA. TEDB information contains bandwidth for every link.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA] <strong>display mpls te cspf tedb node</strong></pre>
<pre class="screen"> Router ID: 1.1.1.1
 IGP Type: OSPF      Process ID: 1      IGP Area: 0
  MPLS-TE Link Count: 1
  Link[1]:
    OSPF Router ID: 192.168.1.1      Opaque LSA ID: 1.0.0.1
    Interface IP Address: 192.168.1.1
    DR Address: 192.168.1.2
    IGP Area: 0
    Link  Type: Multi-access  Link Status: Active
    IGP Metric: 1               TE Metric: 1           Color: 0x10001
    Bandwidth Allocation Model : -
    Maximum Link-Bandwidth: 50000 (kbps)
    Maximum Reservable Bandwidth: 50000 (kbps)
    Operational Mode of Router: TE
    Bandwidth Constraints:         Local Overbooking Multiplier:
        BC[0]:       50000 (kbps)           LOM[0]:          1
    BW  Unreserved:
        Class  ID:
        [0]:       50000 (kbps),            [1]:       50000 (kbps)
        [2]:       50000 (kbps),            [3]:       50000 (kbps)
        [4]:       50000 (kbps),            [5]:       50000 (kbps)
        [6]:       50000 (kbps),            [7]:       10000 (kbps)
 Router ID: 2.2.2.2
 IGP Type: OSPF      Process ID: 1      IGP Area: 0
  MPLS-TE Link Count: 3
  Link[1]:
    OSPF Router ID: 192.168.1.2      Opaque LSA ID: 1.0.0.1
    Interface IP Address: 192.168.1.2
    DR Address: 192.168.1.2
    IGP Area: 0
    Link  Type: Multi-access  Link Status: Active
    IGP Metric: 1               TE Metric: 1           Color: 0x0
    Bandwidth Allocation Model : -
    Maximum Link-Bandwidth: 0 (kbps)
    Maximum Reservable Bandwidth: 0 (kbps)
    Operational Mode of Router: TE
    Bandwidth Constraints:         Local Overbooking Multiplier:
        BC[0]:           0 (kbps)           LOM[0]:          1
    BW  Unreserved:
        Class  ID:
        [0]:           0 (kbps),            [1]:           0 (kbps)
        [2]:           0 (kbps),            [3]:           0 (kbps)
        [4]:           0 (kbps),            [5]:           0 (kbps)
        [6]:           0 (kbps),            [7]:           0 (kbps)
  Link[2]:
    OSPF Router ID: 192.168.1.2      Opaque LSA ID: 1.0.0.3
    Interface IP Address: 192.168.2.1
    DR Address: 192.168.2.1
    IGP Area: 0
    Link  Type: Multi-access  Link Status: Active
    IGP Metric: 1               TE Metric: 1           Color: 0x10101
    Bandwidth Allocation Model : -
    Maximum Link-Bandwidth: 100000 (kbps)
    Maximum Reservable Bandwidth: 100000 (kbps)
    Operational Mode of Router: TE
    Bandwidth Constraints:         Local Overbooking Multiplier:
        BC[0]:      100000 (kbps)           LOM[0]:          1
    BW  Unreserved:
        Class  ID:
        [0]:      100000 (kbps),            [1]:      100000 (kbps)
        [2]:      100000 (kbps),            [3]:      100000 (kbps)
        [4]:      100000 (kbps),            [5]:      100000 (kbps)
        [6]:      100000 (kbps),            [7]:       <strong>60000 (kbps)</strong>
  Link[3]:
    OSPF Router ID: 192.168.1.2      Opaque LSA ID: 1.0.0.2
    Interface IP Address: 192.168.3.1
    DR Address: 192.168.3.1
    IGP Area: 0
    Link  Type: Multi-access  Link Status: Active
    IGP Metric: 1               TE Metric: 1           Color: 0x10011
    Bandwidth Allocation Model : -
    Maximum Link-Bandwidth: 100000 (kbps)
    Maximum Reservable Bandwidth: 100000 (kbps)
    Operational Mode of Router: TE
    Bandwidth Constraints:         Local Overbooking Multiplier:
        BC[0]:      100000 (kbps)           LOM[0]:          1
    BW  Unreserved:
        Class  ID:
        [0]:      100000 (kbps),            [1]:      100000 (kbps)
        [2]:      100000 (kbps),            [3]:      100000 (kbps)
        [4]:      100000 (kbps),            [5]:      100000 (kbps)
        [6]:      100000 (kbps),            [7]:      100000 (kbps)
 Router ID: 3.3.3.3
 IGP Type: OSPF      Process ID: 1      IGP Area: 0
  MPLS-TE Link Count: 2
  Link[1]:
    OSPF Router ID: 4.4.4.4      Opaque LSA ID: 1.0.0.2
    Interface IP Address: 192.168.2.2
    DR Address: 192.168.2.1
    IGP Area: 0
    Link  Type: Multi-access  Link Status: Active
    IGP Metric: 1               TE Metric: 1           Color: 0x0
    Bandwidth Allocation Model : -
    Maximum Link-Bandwidth: 0 (kbps)
    Maximum Reservable Bandwidth: 0 (kbps)
    Operational Mode of Router: TE
    Bandwidth Constraints:         Local Overbooking Multiplier:
        BC[0]:           0 (kbps)           LOM[0]:          1
    BW  Unreserved:
        Class  ID:
        [0]:           0 (kbps),            [1]:           0 (kbps)
        [2]:           0 (kbps),            [3]:           0 (kbps)
        [4]:           0 (kbps),            [5]:           0 (kbps)
        [6]:           0 (kbps),            [7]:           0 (kbps)
  Link[2]:
    OSPF Router ID: 4.4.4.4      Opaque LSA ID: 1.0.0.1
    Interface IP Address: 192.168.3.2
    DR Address: 192.168.3.1
    IGP Area: 0
    Link  Type: Multi-access  Link Status: Active
    IGP Metric: 1               TE Metric: 1           Color: 0x0
    Bandwidth Allocation Model : -
    Maximum Link-Bandwidth: 0 (kbps)
    Maximum Reservable Bandwidth: 0 (kbps)
    Operational Mode of Router: TE
    Bandwidth Constraints:         Local Overbooking Multiplier:
        BC[0]:           0 (kbps)           LOM[0]:          1
    BW  Unreserved:
        Class  ID:
        [0]:           0 (kbps),            [1]:           0 (kbps)
        [2]:           0 (kbps),            [3]:           0 (kbps)
        [4]:           0 (kbps),            [5]:           0 (kbps)
        [6]:           0 (kbps),            [7]:           0 (kbps)</pre>
<p>The <strong>BW Unreserved</strong> field indicates the remaining bandwidth reserved for tunnel links with various priorities. The command output shows that the value of [7] changes on the outbound interface of each node along the tunnel, indicating that bandwidth of 40 Mbit/s has been successfully reserved, with the priority being 7. The bandwidth information also matches the path of a tunnel. This proves that the affinity and mask match the administrative group of each link.</p>
<p>Alternatively, run the <a href="cmdqueryname=display+mpls+te+tunnel+diagnostic"><b><span class="cmdname">display mpls te tunnel diagnostic</span></b></a> command to check the outbound interfaces of links along the tunnel on LSRB.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRB]<strong>display mpls te tunnel diagnostic</strong></pre>
<pre class="screen">* means the LSP is detour LSP
--------------------------------------------------------------------------------
LSP-Id                         Destination      In/Out-If
--------------------------------------------------------------------------------
1.1.1.1:1:3                    3.3.3.3          GE<span>0/1/0</span>/GE<span>0/2/0</span>
--------------------------------------------------------------------------------        </pre>
<p># Configure a tunnel named <strong>Tunnel2</strong> on LSRA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA] <strong>interface tunnel2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-Tunnel2] <strong>ip address unnumbered interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-Tunnel2] <strong>tunnel-protocol mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-Tunnel2]<strong> destination 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-Tunnel2] <strong>mpls te tunnel-id 101</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-Tunnel2]<strong> mpls te bandwidth <span>ct0 </span>40000</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-Tunnel2]<strong> mpls te affinity property 10011 mask 11101</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-Tunnel2] <strong>mpls te priority 6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-Tunnel2] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA-Tunnel2] <strong>quit</strong></pre>
<p>The mask of Tunnel2's affinity attribute is 0x11101. As such, the first three bits of the affinity attribute value need to be compared, so do the last bit. In contrast, the fourth bit is ignored. Because the affinity value of Tunnel2 is 0x10011, this tunnel selects the link with the second and third bits of the administrative group attribute being 0 and at least one of the first and fifth bits being 1. According to the preceding rules, if the value of the administrative group attribute is 0x10001, 0x10000, 0x00001, 0x10011, 0x10010, or 0x00011, the value meets requirements. Tunnel2 then selects the link between GE <span>0/1/0</span> of LSRA (the administrative group value is 0x10001) and GE <span>0/3/0</span> of LSRB (the administrative group value is 0x10011).</p>
</p></li><li><span>Verify the configuration.</span><p><p>After completing the configurations, run the <a href="cmdqueryname=display+interface+tunnel"><b><span class="cmdname">display interface tunnel</span></b></a> or <a href="cmdqueryname=display+mpls+te+tunnel-interface"><b><span class="cmdname">display mpls te tunnel-interface</span></b></a> command on LSRA. The status of Tunnel1 is <strong>Down</strong>. This is because since the maximum reservable bandwidth is insufficient, Tunnel2 is of a higher priority and has preempted the bandwidth reserved for Tunnel1.</p>
<p>Run the <a href="cmdqueryname=display+mpls+te+cspf+tedb+node"><b><span class="cmdname">display mpls te cspf tedb node</span></b></a> command. TEDB information contains the bandwidth for every link, which indicates that Tunnel2 indeed passes through GE <span>0/3/0</span> of LSRB.</p>
<p>Alternatively, run the <a href="cmdqueryname=display+mpls+te+tunnel+diagnostic"><b><span class="cmdname">display mpls te tunnel diagnostic</span></b></a> command to check outbound interfaces of links along the tunnel on LSRB.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRB] <strong>display mpls te tunnel diagnostic</strong></pre>
<pre class="screen">* means the LSP is detour LSP
--------------------------------------------------------------------------------
LSP-Id                         Destination      In/Out-If
--------------------------------------------------------------------------------
1.1.1.1:1:4                    3.3.3.3          GE<span>0/1/0</span>/GE<span>0/3/0</span>
--------------------------------------------------------------------------------        </pre>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0172368324__section_dc_vrp_cfg_00383805"><a name="EN-US_TASK_0172368324__section_dc_vrp_cfg_00383805"></a><a name="section_dc_vrp_cfg_00383805"></a><a name="EN-US_TASK_0172368324__1.3.6"></a><a name="1.3.6"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>LSRA configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname LSRA</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls lsr-id 1.1.1.1</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls</pre>
<pre class="screen"> mpls te</pre>
<pre class="screen"> mpls te cspf</pre>
<pre class="screen"> mpls rsvp-te</pre>
<pre class="screen">#</pre>
<pre class="screen">ospf 1</pre>
<pre class="screen"> opaque-capability enable</pre>
<pre class="screen"> area 0.0.0.0</pre>
<pre class="screen">  mpls-te enable</pre>
<pre class="screen">  network 1.1.1.1 0.0.0.0</pre>
<pre class="screen">  network 192.168.1.0 0.0.0.255</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 192.168.1.1 255.255.255.0</pre>
<pre class="screen"> mpls</pre>
<pre class="screen"> mpls te</pre>
<pre class="screen"> mpls te link administrative group 10001</pre>
<pre class="screen"> mpls te <span>bandwidth max-reservable-bandwidth</span> 50000</pre>
<pre class="screen"> mpls te <span>bandwidth bc0 50000</span></pre>
<pre class="screen"> mpls rsvp-te</pre>
<pre class="screen">#</pre>
<pre class="screen">interface LoopBack1</pre>
<pre class="screen"> ip address 1.1.1.1 255.255.255.255</pre>
<pre class="screen">#</pre>
<pre class="screen">interface Tunnel1</pre>
<pre class="screen"> ip address unnumbered interface LoopBack1</pre>
<pre class="screen"> tunnel-protocol mpls te</pre>
<pre class="screen"> destination 3.3.3.3</pre>
<pre class="screen"> mpls te tunnel-id 1</pre>
<pre class="screen"> mpls te affinity property 10101 mask 11011</pre>
<pre class="screen"> mpls te bandwidth ct0 40000</pre>
<pre class="screen">#</pre>
<pre class="screen">interface Tunnel2</pre>
<pre class="screen"> ip address unnumbered interface LoopBack1</pre>
<pre class="screen"> tunnel-protocol mpls te</pre>
<pre class="screen"> destination 3.3.3.3</pre>
<pre class="screen"> mpls te tunnel-id 101</pre>
<pre class="screen"> mpls te priority 6</pre>
<pre class="screen"> mpls te affinity property 10011 mask 11101</pre>
<pre class="screen"> mpls te bandwidth ct0 40000</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p>LSRB configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname LSRB</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls lsr-id 2.2.2.2</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls</pre>
<pre class="screen"> mpls te</pre>
<pre class="screen"> mpls rsvp-te</pre>
<pre class="screen">#</pre>
<pre class="screen">ospf 1</pre>
<pre class="screen"> opaque-capability enable</pre>
<pre class="screen"> area 0.0.0.0</pre>
<pre class="screen">  mpls-te enable</pre>
<pre class="screen">  network 2.2.2.2 0.0.0.0</pre>
<pre class="screen">  network 192.168.1.0 0.0.0.255</pre>
<pre class="screen">  network 192.168.2.0 0.0.0.255</pre>
<pre class="screen">  network 192.168.3.0 0.0.0.255</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 192.168.1.2 255.255.255.0</pre>
<pre class="screen"> mpls</pre>
<pre class="screen"> mpls te</pre>
<pre class="screen"> mpls rsvp-te</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/2/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 192.168.2.1 255.255.255.0</pre>
<pre class="screen"> mpls</pre>
<pre class="screen"> mpls te</pre>
<pre class="screen"> mpls te link administrative group 10101</pre>
<pre class="screen"> mpls te bandwidth max-reservable-bandwidth 100000</pre>
<pre class="screen"> mpls te bandwidth bc0 100000</pre>
<pre class="screen"> mpls rsvp-te</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/3/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 192.168.3.1 255.255.255.0</pre>
<pre class="screen"> mpls</pre>
<pre class="screen"> mpls te</pre>
<pre class="screen"> mpls te link administrative group 10011</pre>
<pre class="screen"> mpls te bandwidth max-reservable-bandwidth 100000</pre>
<pre class="screen"> mpls te bandwidth bc0 100000</pre>
<pre class="screen"> mpls rsvp-te</pre>
<pre class="screen">#</pre>
<pre class="screen">interface LoopBack1</pre>
<pre class="screen"> ip address 2.2.2.2 255.255.255.255</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p>LSRC configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname LSRC</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls lsr-id 3.3.3.3</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls</pre>
<pre class="screen"> mpls te</pre>
<pre class="screen"> mpls rsvp-te</pre>
<pre class="screen">#</pre>
<pre class="screen">ospf 1</pre>
<pre class="screen"> opaque-capability enable</pre>
<pre class="screen"> area 0.0.0.0</pre>
<pre class="screen">  mpls-te enable</pre>
<pre class="screen">  network 3.3.3.3 0.0.0.0</pre>
<pre class="screen">  network 192.168.2.0 0.0.0.255</pre>
<pre class="screen">  network 192.168.3.0 0.0.0.255</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown </pre>
<pre class="screen"> ip address 192.168.2.2 255.255.255.0</pre>
<pre class="screen"> mpls</pre>
<pre class="screen"> mpls te</pre>
<pre class="screen"> mpls rsvp-te</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/2/0</span></pre>
<pre class="screen"> undo shutdown </pre>
<pre class="screen"> ip address 192.168.3.2 255.255.255.0</pre>
<pre class="screen"> mpls</pre>
<pre class="screen"> mpls te</pre>
<pre class="screen"> mpls rsvp-te</pre>
<pre class="screen">#</pre>
<pre class="screen">interface LoopBack1</pre>
<pre class="screen"> ip address 3.3.3.3 255.255.255.255</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_te-p2p_cfg_0093.html">Configuration Examples for MPLS TE
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_te-p2p_cfg_0210.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_te-p2p_cfg_0098.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>