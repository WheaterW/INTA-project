
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring CBTS in a VPLS over TE Scenario">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_te-p2p_cfg_0093.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_te-p2p_cfg_6005.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="MPLS TE">
<meta name="featuretype" content="MPLS">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="MPLS TE">
<meta name="featuretype" content="MPLS">
<meta name="featurename" content="MPLS TE">
<meta name="featuretype" content="MPLS">
<meta name="featurename" content="MPLS TE">
<meta name="featuretype" content="MPLS">
<meta name="OWNER" content="l00425560">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="w00845984">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172368387">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring CBTS in a VPLS over TE Scenario</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172368387"></a><a name="EN-US_TASK_0172368387"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring CBTS in a VPLS over TE Scenario</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0172368387__1.3.1"></a><a name="1.3.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>In <a href="#EN-US_TASK_0172368387__fig_dc_ne_te-p2p_cfg_600601">Figure 1</a>, CE1 and CE2 belong to the same VPLS network. They access the MPLS backbone network through PE1 and PE2, respectively. OSPF is used as an IGP on the MPLS backbone network.</p>
<p>It is required that an LDP VPLS tunnel and the dynamic signaling protocol RSVP-TE be used to establish two MPLS TE tunnels between PE1 and PE2 to transmit VPLS services. Each TE tunnel is assigned a specific priority. Interfaces that receive VPLS packets have behavior aggregate classification enabled and trust 802.1p priority values so that they can forward VPLS packets with a specific priority to a specific tunnel.</p>
<p>TE1 tunnel with ID 100 is established over the path PE1 â&gt; P1 â&gt; PE2, and TE2 tunnel with ID 200 is established over the path PE1 â&gt; P2 â&gt; PE2. AF1 is configured for TE1 tunnel, and AF2 is configured for TE2 tunnel. This configuration allows PE1 to forward traffic with service class AF1 along the TE1 tunnel and traffic with service class AF2 along the TE2 tunnel. The two tunnels can load-balance traffic based on priority values. The requirements of PE2 are similar to the requirements of PE1.</p>
<p>Note that if multiple tunnels with AF1 are established between PE1 and PE2, packets mapped to AF1 are load-balanced among these tunnels.</p>
<div class="notice"><span class="noticetitle"><img src="../../../../public_sys-resources/notice_3.0-en-us.png"> </span><div class="noticebody"><p>If the CBTS function is configured, you are advised not to configure the following services at the same time:</p>
<ul><li>Dynamic load balancing</li></ul>
</div></div>
<div class="fignone" id="EN-US_TASK_0172368387__fig_dc_ne_te-p2p_cfg_600601"><a name="EN-US_TASK_0172368387__fig_dc_ne_te-p2p_cfg_600601"></a><a name="fig_dc_ne_te-p2p_cfg_600601"></a><span class="figcap"><b>Figure 1 </b>CBTS networking in a VPLS over TE scenario</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 through 3 in this example represent GE <span>0/1/0</span>, GE <span>0/2/0</span>, and GE <span>0/3/0</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_ne_te-p2p_cfg_600501.png" width="NaN" height="NaN"></span><br></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172368387__1.3.2"></a><a name="1.3.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ul><li><p>Enable a routing protocol on the MPLS backbone network devices (PEs and Ps) for them to communicate with each other and enable MPLS.</p>
</li><li><p>Establish MPLS TE tunnels and configure a tunnel policy. </p>
</li><li><p>Enable MPLS Layer 2 virtual private network (L2VPN) on the PEs.</p>
</li><li><p>Create a virtual switching instance (VSI), configure LDP as a signaling protocol, and bind the VSI to an AC interface on each PE.</p>
</li><li><p>Configure MPLS TE tunnels to transmit VSI packets.</p>
</li></ul>
</div></div>
<div class="context"><a name="EN-US_TASK_0172368387__1.3.3"></a><a name="1.3.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>OSPF area enabled with TE</p>
</li><li><p>VSI name and VSI ID</p>
</li><li><p>IP addresses of peers and tunnel policy</p>
</li><li><p>Names of AC interfaces bound to the VSI</p>
</li><li><p>Interface number and IP address of each tunnel interface, as well as destination IP address, tunnel ID, tunnel signaling protocol (RSVP-TE), and tunnel bandwidth to be specified on each tunnel interface</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172368387__1.3.4"></a><a name="1.3.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Assign an IP address to each interface on the backbone network. For configuration details, see <a href="#EN-US_TASK_0172368387__section_dc_ne_te-p2p_cfg_600604">Configuration Files</a> in this section.</span></li><li><span>Enable MPLS, MPLS TE, MPLS RSVP-TE, and MPLS CSPF.</span><p><p>On the nodes along each MPLS TE tunnel, enable MPLS, MPLS TE, and MPLS RSVP-TE both in the system view and the interface view. On the ingress node of each tunnel, enable MPLS CSPF in the system view.</p>
<p># Configure PE1.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE1] <strong>mpls lsr-id 1.1.1.9</strong></pre>
<pre class="screen">[*PE1] <strong>mpls</strong></pre>
<pre class="screen">[*PE1-mpls]<strong> mpls te</strong></pre>
<pre class="screen">[*PE1-mpls]<strong> mpls rsvp-te</strong></pre>
<pre class="screen">[*PE1-mpls] <strong>mpls te cspf</strong></pre>
<pre class="screen">[*PE1-mpls]<strong> quit</strong></pre>
<pre class="screen">[*PE1]<strong> interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[*PE1-GigabitEthernet<span>0/1/0</span>]<strong> mpls</strong></pre>
<pre class="screen">[*PE1-GigabitEthernet<span>0/1/0</span>]<strong> mpls te</strong></pre>
<pre class="screen">[*PE1-GigabitEthernet<span>0/1/0</span>]<strong> mpls rsvp-te</strong></pre>
<pre class="screen">[*PE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[*PE1]<strong> interface gigabitethernet<span>0/3/0</span></strong></pre>
<pre class="screen">[*PE1-GigabitEthernet<span>0/3/0</span>]<strong> mpls</strong></pre>
<pre class="screen">[*PE1-GigabitEthernet<span>0/3/0</span>]<strong> mpls te</strong></pre>
<pre class="screen">[*PE1-GigabitEthernet<span>0/3/0</span>]<strong> mpls rsvp-te</strong></pre>
<pre class="screen">[*PE1-GigabitEthernet<span>0/3/0</span>] <strong>quit</strong></pre>
<pre class="screen">[*PE1] <strong>commit</strong></pre>
<p># Configure P1.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>P1] <strong>mpls lsr-id 2.2.2.9</strong></pre>
<pre class="screen">[*P1] <strong>mpls</strong></pre>
<pre class="screen">[*P1-mpls]<strong> mpls te</strong></pre>
<pre class="screen">[*P1-mpls]<strong> mpls rsvp-te</strong></pre>
<pre class="screen">[*P1-mpls]<strong> quit</strong></pre>
<pre class="screen">[*P1]<strong> interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[*P1-GigabitEthernet<span>0/1/0</span>]<strong> mpls</strong></pre>
<pre class="screen">[*P1-GigabitEthernet<span>0/1/0</span>]<strong> mpls te</strong></pre>
<pre class="screen">[*P1-GigabitEthernet<span>0/1/0</span>]<strong> mpls rsvp-te</strong></pre>
<pre class="screen">[*P1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[*P1]<strong> interface gigabitethernet<span>0/2/0</span></strong></pre>
<pre class="screen">[*P1-GigabitEthernet<span>0/2/0</span>]<strong> mpls</strong></pre>
<pre class="screen">[*P1-GigabitEthernet<span>0/2/0</span>]<strong> mpls te</strong></pre>
<pre class="screen">[*P1-GigabitEthernet<span>0/2/0</span>]<strong> mpls rsvp-te</strong></pre>
<pre class="screen">[*P1-GigabitEthernet<span>0/2/0</span>]<strong> quit</strong></pre>
<pre class="screen">[*P1] <strong>commit</strong></pre>
<p># Configure P2.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>P2] <strong>mpls lsr-id 3.3.3.9</strong></pre>
<pre class="screen">[*P2] <strong>mpls</strong></pre>
<pre class="screen">[*P2-mpls]<strong> mpls te</strong></pre>
<pre class="screen">[*P2-mpls]<strong> mpls rsvp-te</strong></pre>
<pre class="screen">[*P2-mpls]<strong> quit</strong></pre>
<pre class="screen">[*P2]<strong> interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[*P2-GigabitEthernet<span>0/1/0</span>]<strong> mpls</strong></pre>
<pre class="screen">[*P2-GigabitEthernet<span>0/1/0</span>]<strong> mpls te</strong></pre>
<pre class="screen">[*P2-GigabitEthernet<span>0/1/0</span>]<strong> mpls rsvp-te</strong></pre>
<pre class="screen">[*P2-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[*P2]<strong> interface gigabitethernet<span>0/2/0</span></strong></pre>
<pre class="screen">[*P2-GigabitEthernet<span>0/2/0</span>]<strong> mpls</strong></pre>
<pre class="screen">[*P2-GigabitEthernet<span>0/2/0</span>]<strong> mpls te</strong></pre>
<pre class="screen">[*P2-GigabitEthernet<span>0/2/0</span>]<strong> mpls rsvp-te</strong></pre>
<pre class="screen">[*P2-GigabitEthernet<span>0/2/0</span>]<strong> quit</strong></pre>
<pre class="screen">[*P2] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE2] <strong>mpls lsr-id 4.4.4.9</strong></pre>
<pre class="screen">[*PE2] <strong>mpls</strong></pre>
<pre class="screen">[*PE2-mpls]<strong> mpls te</strong></pre>
<pre class="screen">[*PE2-mpls]<strong> mpls rsvp-te</strong></pre>
<pre class="screen">[*PE2-mpls] <strong>mpls te cspf</strong></pre>
<pre class="screen">[*PE2-mpls]<strong> quit</strong></pre>
<pre class="screen">[*PE2]<strong> interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[*PE2-GigabitEthernet<span>0/1/0</span>]<strong> mpls</strong></pre>
<pre class="screen">[*PE2-GigabitEthernet<span>0/1/0</span>]<strong> mpls te</strong></pre>
<pre class="screen">[*PE2-GigabitEthernet<span>0/1/0</span>]<strong> mpls rsvp-te</strong></pre>
<pre class="screen">[*PE2-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[*PE2]<strong> interface gigabitethernet<span>0/3/0</span></strong></pre>
<pre class="screen">[*PE2-GigabitEthernet<span>0/3/0</span>]<strong> mpls</strong></pre>
<pre class="screen">[*PE2-GigabitEthernet<span>0/3/0</span>]<strong> mpls te</strong></pre>
<pre class="screen">[*PE2-GigabitEthernet<span>0/3/0</span>]<strong> mpls rsvp-te</strong></pre>
<pre class="screen">[*PE2-GigabitEthernet<span>0/3/0</span>] <strong>quit</strong></pre>
<pre class="screen">[*PE2] <strong>commit</strong></pre>
</p></li><li><span>Enable OSPF and OSPF TE on the MPLS backbone network.</span><p><p># Configure PE1.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE1] <strong>ospf</strong></pre>
<pre class="screen">[*PE1-ospf-1] <strong>opaque-capability enable</strong></pre>
<pre class="screen">[*PE1-ospf-1]<strong> area 0.0.0.0</strong></pre>
<pre class="screen">[*PE1-ospf-1-area-0.0.0.0]<strong> network 1.1.1.9 0.0.0.0</strong></pre>
<pre class="screen">[*PE1-ospf-1-area-0.0.0.0] <strong>network 10.1.2.0 0.0.0.255</strong></pre>
<pre class="screen">[*PE1-ospf-1-area-0.0.0.0] <strong>network 10.1.3.0 0.0.0.255</strong></pre>
<pre class="screen">[*PE1-ospf-1-area-0.0.0.0]<strong> mpls-te enable</strong></pre>
<pre class="screen">[*PE1-ospf-1-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[*PE1-ospf-1]<strong> quit</strong></pre>
<pre class="screen">[*PE1] <strong>commit</strong></pre>
<p># Configure P1.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>P1] <strong>ospf</strong></pre>
<pre class="screen">[*P1-ospf-1] <strong>opaque-capability enable</strong></pre>
<pre class="screen">[*P1-ospf-1]<strong> area 0.0.0.0</strong></pre>
<pre class="screen">[*P1-ospf-1-area-0.0.0.0]<strong> network 2.2.2.9 0.0.0.0</strong></pre>
<pre class="screen">[*P1-ospf-1-area-0.0.0.0] <strong>network 10.1.4.0 0.0.0.255</strong></pre>
<pre class="screen">[*P1-ospf-1-area-0.0.0.0] <strong>network 10.1.2.0 0.0.0.255</strong></pre>
<pre class="screen">[*P1-ospf-1-area-0.0.0.0]<strong> mpls-te enable</strong></pre>
<pre class="screen">[*P1-ospf-1-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[*P1-ospf-1]<strong> quit</strong></pre>
<pre class="screen">[*P1] <strong>commit</strong></pre>
<p># Configure P2.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>P2] <strong>ospf</strong></pre>
<pre class="screen">[*P2-ospf-1] <strong>opaque-capability enable</strong></pre>
<pre class="screen">[*P2-ospf-1]<strong> area 0.0.0.0</strong></pre>
<pre class="screen">[*P2-ospf-1-area-0.0.0.0]<strong> network 3.3.3.9 0.0.0.0</strong></pre>
<pre class="screen">[*P2-ospf-1-area-0.0.0.0] <strong>network 10.1.3.0 0.0.0.255</strong></pre>
<pre class="screen">[*P2-ospf-1-area-0.0.0.0] <strong>network 10.1.5.0 0.0.0.255</strong></pre>
<pre class="screen">[*P2-ospf-1-area-0.0.0.0]<strong> mpls-te enable</strong></pre>
<pre class="screen">[*P2-ospf-1-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[*P2-ospf-1]<strong> quit</strong></pre>
<pre class="screen">[*P2] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE2] <strong>ospf</strong></pre>
<pre class="screen">[*PE2-ospf-1] <strong>opaque-capability enable</strong></pre>
<pre class="screen">[*PE2-ospf-1]<strong> area 0.0.0.0</strong></pre>
<pre class="screen">[*PE2-ospf-1-area-0.0.0.0]<strong> network 4.4.4.9 0.0.0.0</strong></pre>
<pre class="screen">[*PE2-ospf-1-area-0.0.0.0] <strong>network 10.1.4.0 0.0.0.255</strong></pre>
<pre class="screen">[*PE2-ospf-1-area-0.0.0.0] <strong>network 10.1.5.0 0.0.0.255</strong></pre>
<pre class="screen">[*PE2-ospf-1-area-0.0.0.0]<strong> mpls-te enable</strong></pre>
<pre class="screen">[*PE2-ospf-1-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[*PE2-ospf-1]<strong> quit</strong></pre>
<pre class="screen">[*PE2] <strong>commit</strong></pre>
</p></li><li><span>Configure tunnel interfaces.</span><p><p># Create tunnel interfaces on PEs, configure MPLS TE as the tunnel protocol and RSVP-TE as a signaling protocol, and specify priorities.</p>
<p># Configure PE1.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE1]<strong> interface Tunnel 10</strong></pre>
<pre class="screen">[*PE1-Tunnel10]<strong> ip address unnumbered interface loopback1</strong></pre>
<pre class="screen">[*PE1-Tunnel10]<strong> tunnel-protocol mpls te</strong></pre>
<pre class="screen">[*PE1-Tunnel10]<strong> destination 4.4.4.9</strong></pre>
<pre class="screen">[*PE1-Tunnel10]<strong> mpls te tunnel-id 100</strong></pre>
<pre class="screen">[*PE1-Tunnel10]<strong> mpls te service-class af1</strong></pre>
<pre class="screen">[*PE1-Tunnel10]<strong> quit</strong></pre>
<pre class="screen">[*PE1]<strong> interface Tunnel 20</strong></pre>
<pre class="screen">[*PE1-Tunnel20]<strong> ip address unnumbered interface loopback1</strong></pre>
<pre class="screen">[*PE1-Tunnel20]<strong> tunnel-protocol mpls te</strong></pre>
<pre class="screen">[*PE1-Tunnel20]<strong> destination 4.4.4.9</strong></pre>
<pre class="screen">[*PE1-Tunnel20]<strong> mpls te tunnel-id 200</strong></pre>
<pre class="screen">[*PE1-Tunnel20]<strong> mpls te service-class af2</strong></pre>
<pre class="screen">[*PE1-Tunnel20]<strong> quit</strong></pre>
<pre class="screen">[*PE1]<strong> commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE2]<strong> interface Tunnel 10</strong></pre>
<pre class="screen">[*PE2-Tunnel10]<strong> ip address unnumbered interface loopback1</strong></pre>
<pre class="screen">[*PE2-Tunnel10]<strong> tunnel-protocol mpls te</strong></pre>
<pre class="screen">[*PE2-Tunnel10]<strong> destination 1.1.1.9</strong></pre>
<pre class="screen">[*PE2-Tunnel10]<strong> mpls te tunnel-id 100</strong></pre>
<pre class="screen">[*PE2-Tunnel10]<strong> mpls te service-class af1</strong></pre>
<pre class="screen">[*PE2-Tunnel10]<strong> quit</strong></pre>
<pre class="screen">[*PE2]<strong> interface Tunnel 20</strong></pre>
<pre class="screen">[*PE2-Tunnel20]<strong> ip address unnumbered interface loopback1</strong></pre>
<pre class="screen">[*PE2-Tunnel20]<strong> tunnel-protocol mpls te</strong></pre>
<pre class="screen">[*PE2-Tunnel20]<strong> destination 1.1.1.9</strong></pre>
<pre class="screen">[*PE2-Tunnel20]<strong> mpls te tunnel-id 200</strong></pre>
<pre class="screen">[*PE2-Tunnel20]<strong> mpls te service-class af2</strong></pre>
<pre class="screen">[*PE2-Tunnel20]<strong> quit</strong></pre>
<pre class="screen">[*PE2]<strong> commit</strong></pre>
<p>After completing the preceding configurations, run the <strong>display this interface</strong> command in the tunnel interface view. The command output shows that <strong>Line protocol current state</strong> is <strong>UP</strong>, indicating that an MPLS TE tunnel has been established.</p>
<p>Run the <strong>display tunnel-info all</strong> command on PE1. The command output shows that two TE tunnels destined for PE2 with the LSR ID of 4.4.4.9 have been established. The command output on PE2 is similar to that on PE1.</p>
<pre class="screen">&lt;PE1&gt; <strong>display tunnel-info all</strong></pre>
<pre class="screen">Tunnel ID           Type                 Destination           Status</pre>
<pre class="screen">----------------------------------------------------------------------</pre>
<pre class="screen">0xc2060404          te                    4.4.4.9               UP</pre>
<pre class="screen">0xc2060405          te                    4.4.4.9               UP</pre>
</p></li><li><span>Configure MPLS TE explicit paths.</span><p><p>Specify an explicit path for each tunnel.</p>
<p># Configure PE1. Specify a physical interface on the P as the first next hop and a physical interface on PE2 as the second next hop to ensure that the two tunnels are built over different links.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE1] <strong>explicit-path t1</strong></pre>
<pre class="screen">[*PE1-explicit-path-t1] <strong>next hop</strong> <strong>10.1.2.2</strong></pre>
<pre class="screen">[*PE1-explicit-path-t1] <strong>next hop 10.1.4.2</strong></pre>
<pre class="screen">[*PE1-explicit-path-t1] <strong>quit</strong></pre>
<pre class="screen">[*PE1] <strong>explicit-path t2</strong></pre>
<pre class="screen">[*PE1-explicit-path-t2] <strong>next hop 10.1.3.2</strong></pre>
<pre class="screen">[*PE1-explicit-path-t2] <strong>next hop 10.1.5.2</strong></pre>
<pre class="screen">[*PE1-explicit-path-t2] <strong>quit</strong></pre>
<pre class="screen">[*PE1] <strong>interface Tunnel 10</strong></pre>
<pre class="screen">[*PE1-Tunnel10] <strong>mpls te path explicit-path t1</strong></pre>
<pre class="screen">[*PE1-Tunnel10] <strong>quit</strong></pre>
<pre class="screen">[*PE1] <strong>interface Tunnel 20</strong></pre>
<pre class="screen">[*PE1-Tunnel20] <strong>mpls te path explicit-path t2</strong></pre>
<pre class="screen">[*PE1-Tunnel20] <strong>quit</strong></pre>
<pre class="screen">[*PE1] <strong>commit</strong></pre>
<p># Configure PE2. Specify a physical interface on the P as the first next hop and a physical interface on PE1 as the second next hop to ensure that the two tunnels are built over different links.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE2] <strong>explicit-path t1</strong></pre>
<pre class="screen">[*PE2-explicit-path-t1] <strong>next hop</strong> <strong>10.1.4.1</strong></pre>
<pre class="screen">[*PE2-explicit-path-t1] <strong>next hop 10.1.2.1</strong></pre>
<pre class="screen">[*PE2-explicit-path-t1] <strong>quit</strong></pre>
<pre class="screen">[*PE2] <strong>explicit-path t2</strong></pre>
<pre class="screen">[*PE2-explicit-path-t2] <strong>next hop 10.1.5.1</strong></pre>
<pre class="screen">[*PE2-explicit-path-t2] <strong>next hop 10.1.3.1</strong></pre>
<pre class="screen">[*PE2-explicit-path-t2] <strong>quit</strong></pre>
<pre class="screen">[*PE2] <strong>interface Tunnel 10</strong></pre>
<pre class="screen">[*PE2-Tunnel10] <strong>mpls te path explicit-path t1</strong></pre>
<pre class="screen">[*PE2-Tunnel10] <strong>quit</strong></pre>
<pre class="screen">[*PE2] <strong>interface Tunnel 20</strong></pre>
<pre class="screen">[*PE2-Tunnel20] <strong>mpls te path explicit-path t2</strong></pre>
<pre class="screen">[*PE2-Tunnel20] <strong>quit</strong></pre>
<pre class="screen">[*PE2] <strong>commit</strong></pre>
</p></li><li><span>Configure a remote LDP session.</span><p><p>Establish a remote LDP session between PE1 and PE2.</p>
<div class="p"># Configure PE1.<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE1] <strong>mpls ldp</strong></pre>
<pre class="screen">[*PE1-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[*PE1] <strong>mpls ldp remote-peer DTB1</strong></pre>
<pre class="screen">[*PE1-mpls-ldp-remote-DTB1] <strong>remote-ip 4.4.4.9</strong></pre>
<pre class="screen">[*PE1-mpls-ldp-remote-DTB1] <strong>quit</strong></pre>
<pre class="screen">[*PE1] <strong>commit</strong></pre>
</div>
<p># Configure PE2.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE2] <strong>mpls ldp</strong></pre>
<pre class="screen">[*PE2-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[*PE2] <strong>mpls ldp remote-peer DTB2</strong></pre>
<pre class="screen">[*PE2-mpls-ldp-remote-DTB2] <strong>remote-ip 1.1.1.9</strong></pre>
<pre class="screen">[*PE2-mpls-ldp-remote-DTB2] <strong>quit</strong></pre>
<pre class="screen">[*PE2] <strong>commit</strong></pre>
<p>After completing this step, run the <strong>display mpls ldp peer</strong> command. A remote LDP session has been established between the two PEs.</p>
<p>The following example uses the command output on PE1.</p>
<pre class="screen">&lt;PE1&gt; <strong>display mpls ldp peer</strong></pre>
<pre class="screen"> LDP Peer Information in Public network 
 <span>An asterisk (*) before a peer means the peer is being deleted. </span>
 ------------------------------------------------------------------------------ 
 PeerID                TransportAddress   DiscoverySource 
 ------------------------------------------------------------------------------ 
 4.4.4.9:0             4.4.4.9           Remote Peer : DTB1 
 ------------------------------------------------------------------------------ 
 TOTAL: 1 Peer(s) Found.</pre>
</p></li><li><span>Configure a tunnel policy.</span><p><p># Configure PE1.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE1] <strong>tunnel-policy p1</strong></pre>
<pre class="screen">[*PE1-tunnel-policy-p1] <strong>tunnel select-seq cr-lsp load-balance-number 2</strong></pre>
<pre class="screen">[*PE1-tunnel-policy-p1] <strong>quit</strong></pre>
<pre class="screen">[*PE1] <strong>commit</strong></pre>
</p><p><p># Configure PE2.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE2] <strong>tunnel-policy p1</strong></pre>
<pre class="screen">[*PE2-tunnel-policy-p1] <strong>tunnel select-seq cr-lsp load-balance-number 2</strong></pre>
<pre class="screen">[*PE2-tunnel-policy-p1] <strong>quit</strong></pre>
<pre class="screen">[*PE2] <strong>commit</strong></pre>
</p></li><li><span>Enable MPLS L2VPN on PEs.</span><p><p># Configure PE1.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE1] <strong> mpls l2vpn</strong></pre>
<pre class="screen">[*PE1-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[*PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE2] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[*PE2-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[*PE2] <strong>commit</strong></pre>
</p></li><li><span>Create a VSI on PEs and bind it to the tunnel policy.</span><p><p># Configure PE1.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE1] <strong>vsi a2 static</strong></pre>
<pre class="screen">[*PE1-vsi-a2] <strong>pwsignal ldp</strong></pre>
<pre class="screen">[*PE1-vsi-a2-ldp] <strong>vsi-id 2</strong></pre>
<pre class="screen">[*PE1-vsi-a2-ldp] <strong>peer 4.4.4.9 tnl-policy p1</strong></pre>
<pre class="screen">[*PE1-vsi-a2-ldp] <strong>quit</strong></pre>
<pre class="screen">[*PE1-vsi-a2] <strong>quit</strong></pre>
<pre class="screen">[*PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE2] <strong>vsi a2 static</strong></pre>
<pre class="screen">[*PE2-vsi-a2] <strong>pwsignal ldp</strong></pre>
<pre class="screen">[*PE2-vsi-a2-ldp] <strong>vsi-id 2</strong></pre>
<pre class="screen">[*PE2-vsi-a2-ldp] <strong>peer 1.1.1.9 tnl-policy p1</strong></pre>
<pre class="screen">[*PE2-vsi-a2-ldp] <strong>quit</strong></pre>
<pre class="screen">[*PE2-vsi-a2]<strong> quit</strong></pre>
<pre class="screen">[*PE2] <strong>commit</strong></pre>
</p></li><li><span>Bind the VSI to the interfaces of the PEs.</span><p><p># Configure PE1.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE1] <strong>interface gigabitethernet<span>0/2/0</span>.1</strong></pre>
<pre class="screen">[*PE1-GigabitEthernet<span>0/2/0</span>.1] <strong>vlan-type dot1q 10</strong></pre>
<pre class="screen">[*PE1-GigabitEthernet<span>0/2/0</span>.1] <strong>l2 binding vsi a2</strong></pre>
<pre class="screen">[*PE1-GigabitEthernet<span>0/2/0</span>.1] <strong>trust upstream default</strong></pre>
<pre class="screen">[*PE1-GigabitEthernet<span>0/2/0</span>.1] <strong>trust 8021p</strong></pre>
<pre class="screen">[*PE1-GigabitEthernet<span>0/2/0</span>.1] <strong>undo shutdown</strong></pre>
<pre class="screen">[*PE1-GigabitEthernet<span>0/2/0</span>.1] <strong>commit</strong></pre>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE1-GigabitEthernet<span>0/2/0</span>.1] <strong>quit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE2] <strong>interface gigabitethernet<span>0/2/0</span>.1</strong></pre>
<pre class="screen">[*PE2-GigabitEthernet<span>0/2/0</span>.1] <strong>vlan-type dot1q 10</strong></pre>
<pre class="screen">[*PE2-GigabitEthernet<span>0/2/0</span>.1] <strong>l2 binding vsi a2</strong></pre>
<pre class="screen">[*PE2-GigabitEthernet<span>0/2/0</span>.1] <strong>trust upstream default</strong></pre>
<pre class="screen">[*PE2-GigabitEthernet<span>0/2/0</span>.1] <strong>trust 8021p</strong></pre>
<pre class="screen">[*PE2-GigabitEthernet<span>0/2/0</span>.1] <strong>undo shutdown</strong></pre>
<pre class="screen">[*PE2-GigabitEthernet<span>0/2/0</span>.1] <strong>commit</strong></pre>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE2-GigabitEthernet<span>0/2/0</span>.1] <strong>quit</strong></pre>
<p># Configure CE1.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>CE1] <strong>interface gigabitethernet<span>0/1/0</span>.1</strong></pre>
<pre class="screen">[*CE1-GigabitEthernet<span>0/1/0</span>.1] <strong>shutdown</strong></pre>
<pre class="screen">[*CE1-GigabitEthernet<span>0/1/0</span>.1] <strong>vlan-type dot1q 10</strong></pre>
<pre class="screen">[*CE1-GigabitEthernet<span>0/1/0</span>.1] <strong>ip address 10.1.1.1 255.255.255.0</strong></pre>
<pre class="screen">[*CE1-GigabitEthernet<span>0/1/0</span>.1] <strong>undo shutdown</strong></pre>
<pre class="screen">[*CE1-GigabitEthernet<span>0/1/0</span>.1] <strong>commit</strong></pre>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>CE1-GigabitEthernet<span>0/1/0</span>.1] <strong>quit</strong></pre>
<p># Configure CE2.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>CE2]<strong> interface gigabitethernet<span>0/1/0</span>.1</strong></pre>
<pre class="screen">[*CE2-GigabitEthernet<span>0/1/0</span>.1]<strong>shutdown</strong></pre>
<pre class="screen">[*CE2-GigabitEthernet<span>0/1/0</span>.1] <strong>vlan-type dot1q 10</strong></pre>
<pre class="screen">[*CE2-GigabitEthernet<span>0/1/0</span>.1] <strong>ip address 10.1.1.2 255.255.255.0</strong></pre>
<pre class="screen">[*CE2-GigabitEthernet<span>0/1/0</span>.1] <strong>undo shutdown</strong></pre>
<pre class="screen">[*CE2-GigabitEthernet<span>0/1/0</span>.1] <strong>commit</strong></pre>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>CE1-GigabitEthernet<span>0/1/0</span>.1] <strong>quit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p>After completing the preceding configurations, run the <strong>display vsi name a2 verbose</strong> command on PE1. The command output shows that <strong>VSI State</strong> is <strong>up</strong> and that there are two tunnel IDs, indicating that two tunnels have been established between PE1 and PE2.</p>
<pre class="screen">&lt;PE1&gt; <strong>display vsi name a2 verbose</strong></pre>
<pre class="screen"> ***VSI Name               : a2
    Administrator VSI      : no
    Isolate Spoken         : disable
    VSI Index              : 0
    PW Signaling           : ldp
    Member Discovery Style : static
    PW MAC Learn Style     : unqualify
    Encapsulation Type     : vlan
    MTU                    : 1500
......
    VSI State              : up
......
    VSI ID                 : 2
......
   *Peer Router ID         : 4.4.4.9
    VC Label               : 162816
    Peer Type              : dynamic
    Session                : up
    Tunnel ID              : 0xc2060404 0xc2060405
......
   **PW Information:
   *Peer Ip Address        : 4.4.4.9
    PW State               : up
    Local VC Label         : 162816
    Remote VC Label        : 162816
    PW Type                : label
    Tunnel ID              : 0xc2060404 0xc2060405
......</pre>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0172368387__section_dc_ne_te-p2p_cfg_600604"><a name="EN-US_TASK_0172368387__section_dc_ne_te-p2p_cfg_600604"></a><a name="section_dc_ne_te-p2p_cfg_600604"></a><a name="EN-US_TASK_0172368387__1.3.5"></a><a name="1.3.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>PE1 configuration file</p>
<pre class="screen">#
sysname PE1
#
mpls lsr-id 1.1.1.9
#
mpls
 mpls te
 mpls rsvp-te
 mpls te cspf
#
explicit-path t1
 next hop 10.1.2.2
 next hop 10.1.4.2
#
explicit-path t2
 next hop 10.1.3.2
 next hop 10.1.5.2
#
mpls l2vpn
#
mpls ldp
 #
 ipv4-family
#
mpls ldp remote-peer DTB1
 remote-ip 4.4.4.9
#
vsi a2 static
 pwsignal ldp
  vsi-id 2
  peer 4.4.4.9 tnl-policy p1
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.2.1 255.255.255.0
 mpls
 mpls te
 mpls rsvp-te
#
interface GigabitEthernet<span>0/2/0</span>.1
 undo shutdown
 vlan-type dot1q 10
 l2 binding vsi a2
 trust upstream default
 trust 8021p
#
interface GigabitEthernet<span>0/3/0</span>
 undo shutdown
 ip address 10.1.3.1 255.255.255.0
 mpls
 mpls te
 mpls rsvp-te
#
interface LoopBack1
 ip address 1.1.1.9 255.255.255.255
#
interface Tunnel10
 ip address unnumbered interface LoopBack1
 tunnel-protocol mpls te
 destination 4.4.4.9
 mpls te path explicit-path t1
 mpls te tunnel-id 100
 mpls te service-class af1
#
interface Tunnel20
 ip address unnumbered interface LoopBack1
 tunnel-protocol mpls te
 destination 4.4.4.9
 mpls te path explicit-path t2
 mpls te tunnel-id 200
 mpls te service-class af2
#
ospf 1
 opaque-capability enable
 area 0.0.0.0
  network 1.1.1.9 0.0.0.0
  network 10.1.2.0 0.0.0.255
  network 10.1.3.0 0.0.0.255
  mpls-te enable
#
tunnel-policy p1
 tunnel select-seq cr-lsp load-balance-number 2
#
return</pre>
</li><li><p>P1 configuration file</p>
<pre class="screen">#
sysname P1
#
mpls lsr-id 2.2.2.9
#
mpls
 mpls te
 mpls rsvp-te
 mpls te cspf
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.2.2 255.255.255.0
 mpls
 mpls te
 mpls rsvp-te
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.1.4.1 255.255.255.0
 mpls
 mpls te
 mpls rsvp-te
#
interface LoopBack1
 ip address 2.2.2.9 255.255.255.255
#
ospf 1
 opaque-capability enable
 area 0.0.0.0
  network 2.2.2.9 0.0.0.0
  network 10.1.2.0 0.0.0.255
  network 10.1.4.0 0.0.0.255
  mpls-te enable
#
return</pre>
</li><li><p>P2 configuration file</p>
<pre class="screen">#
sysname P2
#
mpls lsr-id 3.3.3.9
#
mpls
 mpls te
 mpls rsvp-te
 mpls te cspf
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.3.2 255.255.255.0
 mpls
 mpls te
 mpls rsvp-te
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.1.5.1 255.255.255.0
 mpls
 mpls te
 mpls rsvp-te
#
interface LoopBack1
 ip address 3.3.3.9 255.255.255.255
#
ospf 1
 opaque-capability enable
  area 0.0.0.0
  network 3.3.3.9 0.0.0.0
  network 10.1.3.0 0.0.0.255
  network 10.1.5.0 0.0.0.255
  mpls-te enable
#
return</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#
sysname PE2
#
mpls lsr-id 4.4.4.9
#
mpls
 mpls te
 mpls rsvp-te
 mpls te cspf
#
explicit-path t1
 next hop 10.1.4.1
 next hop 10.1.2.1
#
explicit-path t2
 next hop 10.1.5.1
 next hop 10.1.3.1
#
mpls l2vpn
#
vsi a2 static
 pwsignal ldp
  vsi-id 2
  peer 1.1.1.9 tnl-policy p1
#
mpls ldp
 #
 ipv4-family
#
mpls ldp remote-peer DTB2
 remote-ip 1.1.1.9
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.4.2 255.255.255.0
 mpls
 mpls te
 mpls rsvp-te
#
interface GigabitEthernet<span>0/2/0</span>.1
 undo shutdown
 vlan-type dot1q 10
 l2 binding vsi a2
 trust upstream default
 trust 8021p 
#
interface GigabitEthernet<span>0/3/0</span>
 undo shutdown
 ip address 10.1.5.2 255.255.255.0
 mpls
 mpls te
 mpls rsvp-te
#
interface LoopBack1
 ip address 4.4.4.9 255.255.255.255
#
interface Tunnel10
 ip address unnumbered interface LoopBack1
 tunnel-protocol mpls te
 destination 1.1.1.9
 mpls te path explicit-path t1
 mpls te tunnel-id 100
 mpls te service-class af1
#
interface Tunnel20
 ip address unnumbered interface LoopBack1
 tunnel-protocol mpls te
 destination 1.1.1.9
 mpls te path explicit-path t2
 mpls te tunnel-id 200
 mpls te service-class af2
#
ospf 1
 opaque-capability enable
 area 0.0.0.0
  network 4.4.4.9 0.0.0.0
  network 10.1.4.0 0.0.0.255
  network 10.1.5.0 0.0.0.255
  mpls-te enable
#
tunnel-policy p1
 tunnel select-seq cr-lsp load-balance-number 2
#
return</pre>
</li><li><p>CE1 configuration file</p>
<pre class="screen">#
sysname CE1
#
interface GigabitEthernet<span>0/1/0</span>.1
 undo shutdown
 vlan-type dot1q 10
 ip address 10.1.1.1 255.255.255.0
#
return</pre>
</li><li><p>CE2 configuration file</p>
<pre class="screen">#
sysname CE2
#
interface GigabitEthernet<span>0/1/0</span>.1
 undo shutdown
 vlan-type dot1q 10
 ip address 10.1.1.2 255.255.255.0
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_te-p2p_cfg_0093.html">Configuration Examples for MPLS TE
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_te-p2p_cfg_6005.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>
</body>
</html>