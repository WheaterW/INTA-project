
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Inter-AS Seamless MPLS">
<meta name="abstract" content="When the access and aggregation layers belong to one AS, and the core layer belongs to another AS, inter-AS seamless MPLS can be configured to implement the service connectivity between base stations and an MME or SGW.">
<meta name="description" content="When the access and aggregation layers belong to one AS, and the core layer belongs to another AS, inter-AS seamless MPLS can be configured to implement the service connectivity between base stations and an MME or SGW.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_seamless_mpls_cfg_0030.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_seamless_mpls_cfg_0031.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_seamless_mpls_cfg_0033.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,z00545680,w00556928,seamlessvrp,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="Seamless MPLS">
<meta name="featuretype" content="MPLS">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="Seamless MPLS">
<meta name="featuretype" content="MPLS">
<meta name="featurename" content="Seamless MPLS">
<meta name="featuretype" content="MPLS">
<meta name="featurename" content="Seamless MPLS">
<meta name="featuretype" content="MPLS">
<meta name="OWNER" content="z00809835">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="b00896120">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172368687">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring Inter-AS Seamless MPLS</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172368687"></a><a name="EN-US_TASK_0172368687"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Inter-AS Seamless MPLS</h1>
<div class="taskbody"><p>When the access and aggregation layers belong to one AS, and the core layer belongs to another AS, inter-AS seamless MPLS can be configured to implement the service connectivity between base stations and an MME or SGW.</p>
<div class="context"><a name="EN-US_TASK_0172368687__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>In <a href="#EN-US_TASK_0172368687__fig_dc_vrp_seamless_mpls_cfg_003202">Figure 1</a>, the access and aggregation layers belong to AS 100, and the core layer belongs to AS 200. Base stations and an MME or SGW can communicate with each other through a VPN. To meet this requirement, inter-AS seamless MPLS can be configured.</p>
<div class="fignone" id="EN-US_TASK_0172368687__fig_dc_vrp_seamless_mpls_cfg_003202"><a name="EN-US_TASK_0172368687__fig_dc_vrp_seamless_mpls_cfg_003202"></a><a name="fig_dc_vrp_seamless_mpls_cfg_003202"></a><span class="figcap"><b>Figure 1 </b>Inter-AS seamless MPLS networking (1)</span><br><span><img class="vsd" src="images/fig_dc_vrp_seamless_mpls_cfg_003202.png"></span></div>
<p>Addresses of interfaces are planned for the CSGs, AGGs, AGG ASBRs, core ASBRs, and MASGs shown in <a href="#EN-US_TASK_0172368687__fig_dc_vrp_seamless_mpls_cfg_003201">Figure 2</a>.</p>
<div class="fignone" id="EN-US_TASK_0172368687__fig_dc_vrp_seamless_mpls_cfg_003201"><a name="EN-US_TASK_0172368687__fig_dc_vrp_seamless_mpls_cfg_003201"></a><a name="fig_dc_vrp_seamless_mpls_cfg_003201"></a><span class="figcap"><b>Figure 2 </b>Inter-AS seamless MPLS networking (2)</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 and 2 in this example are GE<span>0/1/0</span> and GE<span>0/2/0</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_seamless_mpls_cfg_003201.png"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172368687__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure IGP protocols at the access, aggregation, and core layers to implement network connectivity at each layer.</p>
</li><li><p>Configure MPLS and MPLS LDP and establish MPLS LSPs at the access, aggregation, and core layers.</p>
</li><li><p>Establish IBGP peer relationships at each layer and enable devices to exchange labeled routes.</p>
</li><li><p>Configure an EBGP peer relationship for each AGG ASBR-and-core ASBR pair and enable these devices to exchange labeled routes across ASs.</p>
</li><li><p>Configure each AGG as an RR to help the CSG and MASG obtain the route destined for each other's loopback interface.</p>
</li><li><p>Configure a routing policy to control label distribution for a BGP LSP to be established on each device. The egress of the BGP LSP to be established needs to assign an MPLS label to the route advertised to an upstream node. If a transit node receives a labeled IPv4 route from downstream, the downstream node must re-assign an MPLS label to the transit node.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172368687__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>OSPF process ID (1) at the access layer, IS-IS process ID (1) at the aggregation layer, and OSPF process ID (2) at the core layer</p>
</li><li><p>MPLS LSR IDs: 1.1.1.1 for the CSG, 2.2.2.2 for the AGG, 3.3.3.3 for the AGG ASBR, 4.4.4.4 for the core ASBR, and 5.5.5.5 for the MASG.</p>
</li><li><p>Name of a routing policy (policy1)</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172368687__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Assign an IP address to each interface.</span><p><p>Configure interface IP addresses and masks; configure a loopback interface address as an LSR ID on every device shown in <a href="#EN-US_TASK_0172368687__fig_dc_vrp_seamless_mpls_cfg_003201">Figure 2</a>; configure OSPF and IS-IS to advertise the route to the network segment of each interface and a host route to each loopback interface address (LSR ID). For configuration details, see Configuration Files in this section.</p>
</p></li><li><span>Enable MPLS and LDP globally on each device.</span><p><p># Configure the CSG.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CSG]<strong> mpls lsr-id 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-mpls]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG] <strong>interface GigabitEthernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-GigabitEthernet<span>0/1/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG] <strong>commit</strong></pre>
<p># Configure the AGG.</p>
<pre class="screen">&lt;AGG&gt; <strong>system-view </strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>AGG]<strong> mpls lsr-id 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG-mpls]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG] <strong>interface GigabitEthernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG-GigabitEthernet<span>0/1/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG] <strong>interface GigabitEthernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG-GigabitEthernet<span>0/2/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG-GigabitEthernet<span>0/2/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG] <strong>commit</strong></pre>
<p># Configure the AGG ASBR.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>AGG ASBR]<strong> mpls lsr-id 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG ASBR] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG ASBR-mpls]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG ASBR]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG ASBR-mpls-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG ASBR] <strong>interface GigabitEthernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG ASBR-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG ASBR-GigabitEthernet<span>0/1/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG ASBR-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG ASBR] <strong>commit</strong></pre>
<p># Configure the core ASBR.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Core ASBR]<strong> mpls lsr-id 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Core ASBR] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Core ASBR-mpls]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Core ASBR]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Core ASBR-mpls-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Core ASBR] <strong>interface GigabitEthernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>Core ASBR-GigabitEthernet<span>0/2/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Core ASBR-GigabitEthernet<span>0/2/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Core ASBR-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Core ASBR] <strong>commit</strong></pre>
<p># Configure the MASG.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>MASG]<strong> mpls lsr-id 5.5.5.5</strong></pre>
<pre class="screen">[<span class="keyword">*</span>MASG] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>MASG-mpls]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>MASG]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>MASG-mpls-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>MASG] <strong>interface GigabitEthernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>MASG-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>MASG-GigabitEthernet<span>0/1/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>MASG-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>MASG] <strong>commit</strong></pre>
</p></li><li><span>Establish IBGP peer relationships at each layer and enable devices to exchange labeled routes.</span><p><p># Configure the CSG.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CSG] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-bgp] <strong>peer 2.2.2.2 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-bgp] <strong>peer 2.2.2.2 connect-interface LoopBack 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-bgp] <strong>peer 2.2.2.2 label-route-capability</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-bgp] <strong>network 1.1.1.1 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG] <strong>commit</strong></pre>
<p># Configure the AGG.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>AGG] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG-bgp] <strong>peer 1.1.1.1 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG-bgp] <strong>peer 1.1.1.1 connect-interface LoopBack 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG-bgp] <strong>peer 1.1.1.1 label-route-capability</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG-bgp] <strong>peer 3.3.3.3 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG-bgp] <strong>peer 3.3.3.3 connect-interface LoopBack 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG-bgp] <strong>peer 3.3.3.3 label-route-capability</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG] <strong>commit</strong></pre>
<p># Configure the AGG ASBR.</p>
<pre class="screen">&lt;AGG ASBR&gt; <strong>system-view </strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>AGG ASBR] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG ASBR-bgp] <strong>peer 2.2.2.2 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG ASBR-bgp] <strong>peer 2.2.2.2 connect-interface LoopBack 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG ASBR-bgp] <strong>peer 2.2.2.2 label-route-capability</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG ASBR-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG ASBR] <strong>commit</strong></pre>
<p># Configure the core ASBR.</p>
<pre class="screen">&lt;Core ASBR&gt; <strong>system-view </strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Core ASBR] <strong>bgp 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Core ASBR-bgp] <strong>peer 5.5.5.5 as-number 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Core ASBR-bgp] <strong>peer 5.5.5.5 connect-interface LoopBack 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Core ASBR-bgp] <strong>peer 5.5.5.5 label-route-capability</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Core ASBR-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Core ASBR] <strong>commit</strong></pre>
<p># Configure the MASG.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>MASG] <strong>bgp 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>MASG-bgp] <strong>peer 4.4.4.4 as-number 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>MASG-bgp] <strong>peer 4.4.4.4 connect-interface LoopBack 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>MASG-bgp] <strong>peer 4.4.4.4 label-route-capability</strong></pre>
<pre class="screen">[<span class="keyword">*</span>MASG-bgp] <strong>network 5.5.5.5 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>MASG-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>MASG] <strong>commit</strong></pre>
</p></li><li><span>Establish an EBGP peer relationship for each AGG ASBR-and-core ASBR pair and enable these devices to exchange labeled routes.</span><p><p># Configure the AGG ASBR.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>AGG ASBR] <strong>interface GigabitEthernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>AGG ASBR-GigabitEthernet<span>0/2/0</span>] <strong>ip address 10.3.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG ASBR-GigabitEthernet<span>0/2/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG ASBR-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG ASBR] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG ASBR-bgp] <strong>peer 10.3.1.2 as-number 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG ASBR-bgp] <strong>peer 10.3.1.2 label-route-capability check-tunnel-reachable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG ASBR-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG ASBR] <strong>commit</strong></pre>
<p># Configure the core ASBR.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Core ASBR] <strong>interface GigabitEthernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Core ASBR-GigabitEthernet<span>0/1/0</span>] <strong>ip address 10.3.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Core ASBR-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Core ASBR-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Core ASBR] <strong>bgp 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Core ASBR-bgp] <strong>peer 10.3.1.1 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Core ASBR-bgp] <strong>peer 10.3.1.1 label-route-capability check-tunnel-reachable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Core ASBR-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Core ASBR] <strong>commit</strong></pre>
</p></li><li><span>Configure each AGG as an RR to help the CSG and MASG obtain the route destined for each other's loopback interface.</span><p><p># Configure the AGG.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>AGG] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>AGG-bgp] <strong>peer 1.1.1.1 reflect-client</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG-bgp] <strong>peer 1.1.1.1 next-hop-local</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG-bgp] <strong>peer 3.3.3.3 reflect-client</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG-bgp] <strong>peer 3.3.3.3 next-hop-local</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG] <strong>commit</strong></pre>
</p></li><li><span>Configure a routing policy on each device to establish a BGP LSP.</span><p><p># Configure a routing policy for advertising routes matching Route-Policy conditions to the CSG's BGP peer.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CSG] <strong>route-policy policy1 permit node 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-route-policy] <strong>apply mpls-label</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-route-policy] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-bgp] <strong>peer 2.2.2.2 route-policy policy1 export</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CSG] <strong>quit</strong></pre>
<p>Repeat this step for the MASG. For configuration details, see Configuration Files in this section.</p>
<p># Configure a routing policy for advertising routes matching Route-Policy conditions to the AGG's BGP peer.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>AGG] <strong>route-policy policy1 permit node 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG-route-policy] <strong>if-match mpls-label</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG-route-policy] <strong>apply mpls-label</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG-route-policy]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG-bgp] <strong>peer 1.1.1.1 route-policy policy1 export</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG-bgp] <strong>peer 3.3.3.3 route-policy policy1 export</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG] <strong>commit</strong></pre>
<p>Repeat this step for the AGG ASBR and core ASBR. For configuration details, see Configuration Files in this section.</p>
</p></li><li><span>Verify the configuration.</span><p><p>After completing the configuration, run the <strong>display ip routing-table</strong> command on a CSG or MASG to view information about a route to the BGP peer's loopback interface.</p>
<p>The following example uses the command output on the CSG.</p>
<pre class="screen">&lt;CSG&gt; <strong>display ip routing-table</strong></pre>
<pre class="screen"><span class="keyword">Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route</span>
------------------------------------------------------------------------------
Routing Table : _public_
         Destinations : 10       Routes : 10

Destination/Mask    Proto   Pre  Cost        Flags NextHop         Interface

        1.1.1.1/32  Direct  0    0             D  127.0.0.1       LoopBack1
        2.2.2.2/32  OSPF    10   1             D  10.1.1.2        GigabitEthernet<span>0/1/0</span>
        5.5.5.5/32  IBGP    255  0             RD 2.2.2.2         GigabitEthernet<span>0/1/0</span>
       10.1.1.0/24  Direct  0    0             D  10.1.1.1        GigabitEthernet<span>0/1/0</span>
       10.1.1.1/32  Direct  0    0             D  127.0.0.1       GigabitEthernet<span>0/1/0</span>
     10.1.1.255/32  Direct  0    0             D  127.0.0.1       GigabitEthernet<span>0/1/0</span>
      127.0.0.0/8   Direct  0    0             D  127.0.0.1       InLoopBack0
      127.0.0.1/32  Direct  0    0             D  127.0.0.1       InLoopBack0
127.255.255.255/32  Direct  0    0             D  127.0.0.1       InLoopBack0
255.255.255.255/32  Direct  0    0             D  127.0.0.1       InLoopBack0</pre>
<p>Run the <strong>display mpls lsp</strong> command on the CSG or MASG to view LSP information.</p>
<p>The following example uses the command output on the CSG.</p>
<pre class="screen">&lt;CSG&gt; <strong>display mpls lsp</strong></pre>
<pre class="screen">Flag after Out IF: (I) - RLFA Iterated LSP, (I*) - Normal and RLFA Iterated LSP 
Flag after LDP FRR: (L) - Logic FRR LSP
-------------------------------------------------------------------------------
                 LSP Information: LDP LSP
-------------------------------------------------------------------------------
FEC                In/Out Label    In/Out IF                      Vrf Name
1.1.1.1/32         3/NULL          -/-
2.2.2.2/32         NULL/3          -/GE<span>0/1/0</span>
2.2.2.2/32         32828/3         -/GE<span>0/1/0</span>
-------------------------------------------------------------------------------
                 LSP Information: BGP LSP
-------------------------------------------------------------------------------
FEC                In/Out Label    In/Out IF                      Vrf Name
1.1.1.1/32         32830/NULL      -/-
5.5.5.5/32         NULL/32835      -/-</pre>
<div class="p">Run the <strong>ping lsp</strong> command on the CSG or MASG to check BGP LSP connectivity. The following example uses the command output on the CSG.<pre class="screen">&lt;CSG&gt; <strong>ping lsp bgp 5.5.5.5 32</strong></pre>
<pre class="screen">  LSP PING FEC: BGP LABLED IPV4 PREFIX 5.5.5.5/32/ : 100  data bytes, press CTRL_C to break
    Reply from 5.5.5.5: bytes=100 Sequence=1 time=94 ms
    Reply from 5.5.5.5: bytes=100 Sequence=2 time=4 ms
    Reply from 5.5.5.5: bytes=100 Sequence=3 time=4 ms
    Reply from 5.5.5.5: bytes=100 Sequence=4 time=4 ms
    Reply from 5.5.5.5: bytes=100 Sequence=5 time=4 ms

  --- FEC: BGP LABLED IPV4 PREFIX 5.5.5.5/32 ping statistics ---
    5 packet(s) transmitted
    5 packet(s) received
    0.00% packet loss
    round-trip min/avg/max = 4/22/94 ms</pre>
</div>
<p></p>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172368687__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>CSG configuration file</p>
<pre class="screen">#
sysname CSG
#
mpls lsr-id 1.1.1.1
#
mpls
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.1.1 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 1.1.1.1 255.255.255.255
#
bgp 100
 peer 2.2.2.2 as-number 100
 peer 2.2.2.2 connect-interface LoopBack1
 #
 ipv4-family unicast
  network 1.1.1.1 255.255.255.255
  peer 2.2.2.2 enable
  peer 2.2.2.2 route-policy policy1 export
  peer 2.2.2.2 label-route-capability
#
ospf 1
 area 0.0.0.0
  network 1.1.1.1 0.0.0.0
  network 10.1.1.0 0.0.0.255
#
route-policy policy1 permit node 1
 apply mpls-label
#
return</pre>
</li><li><p>AGG configuration file</p>
<pre class="screen">#
sysname AGG
#
mpls lsr-id 2.2.2.2
#
mpls
#
mpls ldp
#
isis 1
 network-entity 10.0000.0000.0000.0010.00
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.1.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.2.1.1 255.255.255.0
 isis enable 1
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 2.2.2.2 255.255.255.255
 isis enable 1
#
bgp 100
 peer 1.1.1.1 as-number 100
 peer 1.1.1.1 connect-interface LoopBack1
 peer 3.3.3.3 as-number 100
 peer 3.3.3.3 connect-interface LoopBack1
 #
 ipv4-family unicast
  peer 1.1.1.1 enable
  peer 1.1.1.1 route-policy policy1 export
  peer 1.1.1.1 reflect-client
  peer 1.1.1.1 next-hop-local
  peer 1.1.1.1 label-route-capability
  peer 3.3.3.3 enable
  peer 3.3.3.3 route-policy policy1 export
  peer 3.3.3.3 reflect-client
  peer 3.3.3.3 next-hop-local
  peer 3.3.3.3 label-route-capability
#
ospf 1
 area 0.0.0.0
  network 2.2.2.2 0.0.0.0
  network 10.1.1.0 0.0.0.255
#
route-policy policy1 permit node 1
 if-match mpls-label
 apply mpls-label
#
return</pre>
</li><li><p>AGG ASBR configuration file</p>
<pre class="screen">#
sysname AGG ASBR
#
mpls lsr-id 3.3.3.3
#
mpls
#
mpls ldp
#
isis 1
 network-entity 10.0000.0000.0000.0020.00
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.2.1.2 255.255.255.0
 isis enable 1
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.3.1.1 255.255.255.0
 mpls
#
interface LoopBack1
 ip address 3.3.3.3 255.255.255.255
 isis enable 1
#
bgp 100
 peer 2.2.2.2 as-number 100
 peer 2.2.2.2 connect-interface LoopBack1
 peer 10.3.1.2 as-number 200
 #
 ipv4-family unicast
  peer 2.2.2.2 enable
  peer 2.2.2.2 route-policy policy1 export
  peer 2.2.2.2 label-route-capability
  peer 10.3.1.2 enable
  peer 10.3.1.2 route-policy policy1 export
  peer 10.3.1.2 label-route-capability check-tunnel-reachable
#
route-policy policy1 permit node 1
 if-match mpls-label
 apply mpls-label
#
return</pre>
</li><li><p>Core ASBR configuration file</p>
<pre class="screen">#
sysname Core ASBR
#
mpls lsr-id 4.4.4.4
#
mpls
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.3.1.2 255.255.255.0
 mpls
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.4.1.1 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 4.4.4.4 255.255.255.255
#
bgp 200
 peer 5.5.5.5 as-number 200
 peer 5.5.5.5 connect-interface LoopBack1
 peer 10.3.1.1 as-number 100
 #
 ipv4-family unicast
  peer 5.5.5.5 enable
  peer 5.5.5.5 route-policy policy1 export
  peer 5.5.5.5 label-route-capability
  peer 10.3.1.1 enable
  peer 10.3.1.1 route-policy policy1 export
  peer 10.3.1.1 label-route-capability check-tunnel-reachable
#
ospf 2
 area 0.0.0.0
  network 4.4.4.4 0.0.0.0
  network 10.4.1.0 0.0.0.255
#
route-policy policy1 permit node 1
 if-match mpls-label
 apply mpls-label
#
return</pre>
</li><li><p>MASG configuration file</p>
<pre class="screen">#
sysname MASG
#
mpls lsr-id 5.5.5.5
#
mpls
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.4.1.2 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 5.5.5.5 255.255.255.255
#
bgp 200
 peer 4.4.4.4 as-number 200
 peer 4.4.4.4 connect-interface LoopBack1
 #
 ipv4-family unicast
  network 5.5.5.5 255.255.255.255
  peer 4.4.4.4 enable
  peer 4.4.4.4 route-policy policy1 export
  peer 4.4.4.4 label-route-capability
#
ospf 2
 area 0.0.0.0
  network 5.5.5.5 0.0.0.0
  network 10.4.1.0 0.0.0.255
#
route-policy policy1 permit node 1
 apply mpls-label
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_seamless_mpls_cfg_0030.html">Configuration Examples
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_seamless_mpls_cfg_0031.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_seamless_mpls_cfg_0033.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>