
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring an LDP Inbound Policy">
<meta name="abstract" content="This section provides an example for configuring an LDP inbound policy. The configuration procedure involves enabling MPLS and MPLS LDP globally.">
<meta name="description" content="This section provides an example for configuring an LDP inbound policy. The configuration procedure involves enabling MPLS and MPLS LDP globally.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ldp-p2p_cfg_0038.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ldp-p2p_cfg_0042.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ldp-p2p_cfg_0048.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="ldp-p2pvrp,w00800033,z00545680,w00556928,w00606909,z00809835,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="MPLS LDP">
<meta name="featurename" content="MPLS TE">
<meta name="featuretype" content="MPLS">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="MPLS LDP">
<meta name="featurename" content="MPLS TE">
<meta name="featuretype" content="MPLS">
<meta name="featurename" content="MPLS LDP">
<meta name="featurename" content="MPLS TE">
<meta name="featuretype" content="MPLS">
<meta name="featurename" content="MPLS LDP">
<meta name="featuretype" content="MPLS">
<meta name="OWNER" content="z00809835">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="b00896120">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172368569">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring an LDP Inbound Policy</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172368569"></a><a name="EN-US_TASK_0172368569"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring an LDP Inbound Policy</h1>
<div class="taskbody"><p>This section provides an example for configuring an LDP inbound policy. The configuration procedure involves enabling MPLS and MPLS LDP globally.</p>
<div class="context"><a name="EN-US_TASK_0172368569__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>MPLS LDP services are deployed on the network shown in <a href="#EN-US_TASK_0172368569__fig_dc_vrp_ldp-p2p_cfg_204801">Figure 1</a>. LSRD is a low-performance DSLAM for user access. By default, LSRD receives Label Mapping messages from all peers and uses the routing information in these messages to establish a large number of LSPs. As a result, memory on LSRD is overused and LSRD is overburdened. Configure an LDP inbound policy to allow LSRD to receive only Label Mapping messages destined for LSRC. This ensures that LSRD establishes LSPs only to LSRC, reducing resource consumption.</p>
<div class="fignone" id="EN-US_TASK_0172368569__fig_dc_vrp_ldp-p2p_cfg_204801"><a name="EN-US_TASK_0172368569__fig_dc_vrp_ldp-p2p_cfg_204801"></a><a name="fig_dc_vrp_ldp-p2p_cfg_204801"></a><span class="figcap"><b>Figure 1 </b>Configuring an LDP inbound policy</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 through 3 in this example represent GE <span>0/1/0</span>, GE <span>0/1/1</span>, and GE <span>0/1/2</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_ldp-p2p_cfg_204801.png" width="NaN" height="NaN"></span><br></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172368569__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Assign an IP address to each interface, including the loopback interface on each node.</p>
</li><li><p>Configure OSPF to advertise the route to the network segment of each interface and to advertise the host route to each LSR ID.</p>
</li><li><p>Enable MPLS and MPLS LDP on each node and interfaces.</p>
</li><li><p>Configure an LDP inbound policy.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172368569__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>IP address of each interface on each LSR (as shown in <a href="#EN-US_TASK_0172368569__fig_dc_vrp_ldp-p2p_cfg_204801">Figure 1</a>), OSPF process ID, and area ID</p>
</li><li><p>LSR ID of each node</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172368569__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Assign an IP address to each interface and configure an IGP.</span><p><p>Assign an IP address and mask to each interface (as shown in <a href="#EN-US_TASK_0172368569__fig_dc_vrp_ldp-p2p_cfg_204801">Figure 1</a>), including the loopback interfaces. Configure OSPF to advertise the route to the network segment to which each interface is connected and the host route to each LSR ID.</p>
</p></li><li><span>Enable MPLS and MPLS LDP globally and on the interfaces of each node.</span><p><p># Configure LSRA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA]<strong> mpls lsr-id 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-mpls]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-GigabitEthernet<span>0/1/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA] <strong>commit</strong></pre>
<p># Configure LSRB.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRB]<strong> mpls lsr-id 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRB]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRB-mpls]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRB]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRB-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRB]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRB-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRB-GigabitEthernet<span>0/1/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRB-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRB]<strong> interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRB-GigabitEthernet<span>0/1/1</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRB-GigabitEthernet<span>0/1/1</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRB-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRB]<strong> interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRB-GigabitEthernet<span>0/1/2</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRB-GigabitEthernet<span>0/1/2</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRB-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRB] <strong>commit</strong></pre>
<p># Configure LSRC.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRC]<strong> mpls lsr-id 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRC] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRC-mpls]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRC]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRC-mpls-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRC]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRC-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRC-GigabitEthernet<span>0/1/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRC-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRC] <strong>commit</strong></pre>
<p># Configure LSRD.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRD]<strong> mpls lsr-id 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRD] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRD-mpls]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRD]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRD-mpls-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRD]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRD-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRD-GigabitEthernet<span>0/1/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRD-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRD] <strong>commit</strong></pre>
<p># After completing the preceding configuration, run the <a href="cmdqueryname=display+mpls+lsp"><b><span class="cmdname">display mpls lsp</span></b></a> command on LSRD to check information about established LSPs.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRD] <strong>display mpls lsp</strong></pre>
<pre class="screen">Flag after Out IF: (I) - RLFA Iterated LSP, (I*) - Normal and RLFA Iterated LSP 
Flag after LDP FRR: (L) - Logic FRR LSP
-------------------------------------------------------------------------------
                 LSP Information: LDP LSP
-------------------------------------------------------------------------------
FEC                In/Out Label    In/Out IF                      Vrf Name
1.1.1.1/32         NULL/32829      -/GE<span>0/1/0</span>                     
1.1.1.1/32         32828/32829     -/GE<span>0/1/0</span>                     
2.2.2.2/32         NULL/3          -/GE<span>0/1/0</span>                     
2.2.2.2/32         32829/3         -/GE<span>0/1/0</span>                     
3.3.3.3/32         NULL/32830      -/GE<span>0/1/0</span>                     
3.3.3.3/32         32830/32830     -/GE<span>0/1/0</span>                     
4.4.4.4/32         3/NULL          -/-  </pre>
<p>The command output shows that LSPs to LSRA, LSRB, and LSRC have been established on LSRD.</p>
</p></li><li><span>Configure an LDP inbound policy.</span><p><p># Configure an IP prefix list on LSRD to permit only the routes to LSRC.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRD] <strong>ip ip-prefix prefix1 permit 3.3.3.3 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRD] <strong>commit</strong></pre>
<p># Configure an inbound policy on LSRD to allow LSRD to receive Label Mapping messages for the routes only to LSRC.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRD] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRD-mpls-ldp] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRD-mpls-ldp-ipv4] <strong>inbound peer 2.2.2.2 fec ip-prefix prefix1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRD-mpls-ldp-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRD-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRD] <strong>commit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p>After completing the preceding configuration, run the <a href="cmdqueryname=display+mpls+lsp"><b><span class="cmdname">display mpls lsp</span></b></a> command on LSRD. The command output shows that only an LSP to LSRC is established.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRD] <strong>display mpls lsp</strong></pre>
<pre class="screen">Flag after Out IF: (I) - RLFA Iterated LSP, (I*) - Normal and RLFA Iterated LSP 
Flag after LDP FRR: (L) - Logic FRR LSP
-------------------------------------------------------------------------------
                 LSP Information: LDP LSP
-------------------------------------------------------------------------------
FEC                In/Out Label    In/Out IF                      Vrf Name
3.3.3.3/32         NULL/32830      -/GE<span>0/1/0</span>                     
3.3.3.3/32         32830/32830     -/GE<span>0/1/0</span>                     
4.4.4.4/32         3/NULL          -/-  </pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172368569__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>LSRA configuration file</p>
<pre class="screen">#
sysname LSRA
#
mpls lsr-id 1.1.1.1
mpls
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.1.1 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 1.1.1.1 255.255.255.255
#
ospf 1
 area 0.0.0.0
  network 1.1.1.1 0.0.0.0
  network 10.1.1.0 0.0.0.255
#
return</pre>
</li><li><p>LSRB configuration file</p>
<pre class="screen">#
sysname LSRB
#
mpls lsr-id 2.2.2.2
 mpls
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.1.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 10.1.2.1 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ip address 10.1.3.2 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 2.2.2.2 255.255.255.255
#
ospf 1
 area 0.0.0.0
  network 2.2.2.2 0.0.0.0
  network 10.1.1.0 0.0.0.255
  network 10.1.2.0 0.0.0.255
  network 10.1.3.0 0.0.0.255
#
return</pre>
</li><li><p>LSRC configuration file</p>
<pre class="screen">#
sysname LSRC
#
mpls lsr-id 3.3.3.3
mpls
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.2.2 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 3.3.3.3 255.255.255.255
#
ospf 1
 area 0.0.0.0
  network 3.3.3.3 0.0.0.0
  network 10.1.2.0 0.0.0.255
#
return</pre>
</li><li><p>LSRD configuration file</p>
<pre class="screen">#
sysname LSRD
#
mpls lsr-id 4.4.4.4
mpls
#
mpls ldp
 ipv4-family
  inbound peer 2.2.2.2 fec ip-prefix prefix1
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.3.1 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 4.4.4.4 255.255.255.255
#
ospf 1
 area 0.0.0.0
  network 4.4.4.4 0.0.0.0
  network 10.1.3.0 0.0.0.255
#
ip ip-prefix prefix1 index 10 permit 3.3.3.3 32
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ldp-p2p_cfg_0038.html">Configuration Examples for MPLS LDP
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ldp-p2p_cfg_0042.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ldp-p2p_cfg_0048.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>