
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring the IP-Prefix Tunnel Function to Automatically Establish MPLS TE Tunnels in a Batch">
<meta name="abstract" content="This section provides an example for configuring the IP-prefix tunnel function to automatically establish MPLS TE tunnels in a batch.">
<meta name="description" content="This section provides an example for configuring the IP-prefix tunnel function to automatically establish MPLS TE tunnels in a batch.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_te-p2p_cfg_0093.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_te-p2p_cfg_0099.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_te-p2p_cfg_0095.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,te-p2pvrp,w00556928,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="MPLS TE">
<meta name="featuretype" content="MPLS">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="MPLS TE">
<meta name="featuretype" content="MPLS">
<meta name="featurename" content="MPLS TE">
<meta name="featuretype" content="MPLS">
<meta name="featurename" content="MPLS TE">
<meta name="featuretype" content="MPLS">
<meta name="OWNER" content="l00468467">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="w00845984">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172368318">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>Example for Configuring the IP-Prefix Tunnel Function to Automatically Establish MPLS TE Tunnels in a Batch</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172368318"></a><a name="EN-US_TASK_0172368318"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring the IP-Prefix Tunnel Function to Automatically Establish MPLS TE Tunnels in a Batch</h1>
<div class="taskbody"><p>This section provides an example for configuring the IP-prefix tunnel function to automatically establish MPLS TE tunnels in a batch.</p>
<div class="context"><a name="EN-US_TASK_0172368318__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>In <a href="#EN-US_TASK_0172368318__fig_dc_vrp_te-p2p_cfg_021001">Figure 1</a>, a customer expects to establish MPLS TE tunnels to form a full-mesh network and configure Auto FRR for each tunnel. Establishing tunnels one by one is laborious and complex. In this case, the IP-prefix tunnel function can be configured to automatically establish MPLS tunnels in a batch.</p>
<div class="fignone" id="EN-US_TASK_0172368318__fig_dc_vrp_te-p2p_cfg_021001"><a name="EN-US_TASK_0172368318__fig_dc_vrp_te-p2p_cfg_021001"></a><a name="fig_dc_vrp_te-p2p_cfg_021001"></a><span class="figcap"><b>Figure 1 </b>Configuring the IP-prefix tunnel function to automatically establish MPLS TE tunnels in a batch</span><br><span><img class="vsd" src="images/fig_dc_vrp_te-p2p_cfg_021001.png"></span></div>

<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" frame="border" border="1" rules="all"><caption><b>Table 1 </b>Interfaces and their IP addresses on each device</caption><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="17.330000000000002%" id="mcps1.4.1.4.2.4.1.1" liSelected="liSelected"><p>Device Name</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="49.669999999999995%" id="mcps1.4.1.4.2.4.1.2" liSelected="liSelected"><p>Interface Name</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="33%" id="mcps1.4.1.4.2.4.1.3" liSelected="liSelected"><p>IP Address and Mask</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" rowspan="3" valign="top" width="17.330000000000002%" headers="mcps1.4.1.4.2.4.1.1 "><p>LSRA</p>
</td>
<td class="cellrowborder" valign="top" width="49.669999999999995%" headers="mcps1.4.1.4.2.4.1.2 "><p>Loopback0</p>
</td>
<td class="cellrowborder" valign="top" width="33%" headers="mcps1.4.1.4.2.4.1.3 "><p>1.1.1.9/32</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.2 "><p>GE <span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>10.1.1.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.2 "><p>GE <span>0/1/1</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>10.1.2.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="3" valign="top" width="17.330000000000002%" headers="mcps1.4.1.4.2.4.1.1 "><p>LSRB</p>
</td>
<td class="cellrowborder" valign="top" width="49.669999999999995%" headers="mcps1.4.1.4.2.4.1.2 "><p>Loopback0</p>
</td>
<td class="cellrowborder" valign="top" width="33%" headers="mcps1.4.1.4.2.4.1.3 "><p>2.2.2.9/32</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.2 "><p>GE <span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>10.1.1.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.2 "><p>GE <span>0/1/1</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>10.1.3.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="3" valign="top" width="17.330000000000002%" headers="mcps1.4.1.4.2.4.1.1 "><p>LSRC</p>
</td>
<td class="cellrowborder" valign="top" width="49.669999999999995%" headers="mcps1.4.1.4.2.4.1.2 "><p>Loopback0</p>
</td>
<td class="cellrowborder" valign="top" width="33%" headers="mcps1.4.1.4.2.4.1.3 "><p>3.3.3.9/32</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.2 "><p>GE <span>0/1/1</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>10.1.2.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.2 "><p>GE <span>0/1/2</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>10.1.3.2/24</p>
</td>
</tr>
</tbody>
</table>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172368318__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure IS-IS and IS-IS TE.</p>
</li><li><p>Enable MPLS TE and BFD globally on each device.</p>
</li><li><p>Configure an IP prefix list.</p>
</li><li><p>Configure a P2P TE tunnel template.</p>
</li><li><p>Configure the automatic primary tunnel function.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172368318__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>IP address of each interface on each node: values shown in <a href="#EN-US_TASK_0172368318__fig_dc_vrp_te-p2p_cfg_021001">Figure 1</a></p>
</li><li><p>LSR ID of each node: loopback addresses shown in <a href="#EN-US_TASK_0172368318__fig_dc_vrp_te-p2p_cfg_021001">Figure 1</a></p>
</li><li><p>IS-IS process number (1), IS-IS level (level-2), and network entity name of each node:</p>
<ul><li>LSRA: 10.0000.0000.0001.00</li><li>LSRC: 10.0000.0000.0002.00</li><li>LSRB: 10.0000.0000.0003.00</li></ul>
</li><li><p>IP prefix name on each node: te-tunnel</p>
</li><li><p>P2P TE tunnel template name on each node: te-tunnel</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172368318__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Assign an IP address to each interface. For configuration details, see <a href="#EN-US_TASK_0172368318__example_01">Configuration Files</a> in this section.</span></li><li><span>Configure IS-IS and IS-IS TE. For configuration details, see <a href="#EN-US_TASK_0172368318__example_01">Configuration Files</a> in this section.</span></li><li><span>Enable MPLS TE and Auto FRR globally on each device. For configuration details, see <a href="#EN-US_TASK_0172368318__example_01">Configuration Files</a> in this section.</span></li><li><span>Configure an IP prefix list.</span><p><p># Configure LSRA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA] <strong>ip ip-prefix te-tunnel permit 2.2.2.9 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA] <strong>ip ip-prefix te-tunnel permit 3.3.3.9 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA] <strong>commit</strong></pre>
<p>The configurations on LSRB and LSRC are similar to the configuration on LSRA. For configuration details, see <a href="#EN-US_TASK_0172368318__example_01">Configuration Files</a> in this section.</p>
</p></li><li><span>Configure a P2P TE tunnel template.</span><p><p># Configure LSRA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA] <strong>mpls te p2p-template te-tunnel </strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-te-p2p-template-te-tunnel] <strong>bandwidth ct0 1000</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-te-p2p-template-te-tunnel] <strong>fast-reroute</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-te-p2p-template-te-tunnel] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA-te-p2p-template-te-tunnel] <strong>quit</strong></pre>
<p>The configurations on LSRB and LSRC are similar to the configuration on LSRA. For configuration details, see <a href="#EN-US_TASK_0172368318__example_01">Configuration Files</a> in this section.</p>
</p></li><li><span>Configure the automatic primary tunnel function.</span><p><p># Configure LSRA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA] <strong>mpls te auto-primary-tunnel ip-prefix te-tunnel p2p-template te-tunnel </strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA] <strong>commit</strong></pre>
<p>The configurations on LSRB and LSRC are similar to the configuration on LSRA. For configuration details, see <a href="#EN-US_TASK_0172368318__example_01">Configuration Files</a> in this section.</p>
</p></li><li><span>Verify the configuration.</span><p><div class="p"># After completing the preceding configuration, run the <a href="cmdqueryname=display+mpls+te+tunnel"><b><span class="cmdname">display mpls te tunnel</span></b></a> command on LSRA. The command output shows that MPLS TE tunnels have been established.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA] <strong>display mpls te tunnel</strong>
* means the LSP is detour LSP
-------------------------------------------------------------------------------
Ingress LsrId   Destination     LSPID In/OutLabel     R Tunnel-name
-------------------------------------------------------------------------------
1.1.1.9         2.2.2.9         16    -/3             I AutoTunnel32769
2.2.2.9         1.1.1.9         10    3/-             E AutoTunnel32769
1.1.1.9         3.3.3.9         17    -/3             I AutoTunnel32770
3.3.3.9         1.1.1.9         9     3/-             E AutoTunnel32770
1.1.1.9         2.2.2.9         13    -/48060         I AutoBypassTunnel_1.1.1.9_2.2.2.9_32771
2.2.2.9         3.3.3.9         8     48061/3         T AutoBypassTunnel_2.2.2.9_3.3.3.9_32771
3.3.3.9         2.2.2.9         7     48060/3         T AutoBypassTunnel_3.3.3.9_2.2.2.9_32771
1.1.1.9         3.3.3.9         15    -/48060         I AutoBypassTunnel_1.1.1.9_3.3.3.9_32772
2.2.2.9         1.1.1.9         9     3/-             E AutoBypassTunnel_2.2.2.9_1.1.1.9_32772
3.3.3.9         1.1.1.9         8     3/-             E AutoBypassTunnel_3.3.3.9_1.1.1.9_32772
-------------------------------------------------------------------------------
R: Role, I: Ingress, T: Transit, E: Egress</pre>
</div>
<p>Obtain a tunnel name, for example, <strong>AutoTunnel32769</strong>, displayed in the <strong>Tunnel-name</strong> column. Run the <strong>display mpls te tunnel-interface auto-primary-tunnel AutoTunnel32769</strong> command to view detailed information about the specified tunnel.</p>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0172368318__example_01"><a name="EN-US_TASK_0172368318__example_01"></a><a name="example_01"></a><a name="EN-US_TASK_0172368318__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>LSRA configuration file</p>
<pre class="screen">#
sysname LSRA
#
mpls lsr-id 1.1.1.9
#
mpls
 mpls te
 mpls te auto-frr
 mpls rsvp-te
 mpls te cspf
#
mpls te p2p-template te-tunnel
 record-route label
 bandwidth ct0 1000
 fast-reroute
#
mpls te auto-primary-tunnel ip-prefix te-tunnel p2p-template te-tunnel
#
isis 1
 is-level level-2
 cost-style wide
 network-entity 10.0000.0000.0001.00
 traffic-eng level-2
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown  
 ip address 10.1.1.1 255.255.255.0
 isis enable 1
 mpls
 mpls te
 mpls te bandwidth max-reservable-bandwidth 10000
 mpls te bandwidth bc0 10000
 mpls rsvp-te
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 10.1.2.1 255.255.255.0
 isis enable 1
 mpls
 mpls te
 mpls te bandwidth max-reservable-bandwidth 10000
 mpls te bandwidth bc0 10000
 mpls rsvp-te
#
interface LoopBack0
 ip address 1.1.1.9 255.255.255.255
 isis enable 1
 #
ip ip-prefix te-tunnel index 10 permit 2.2.2.9 32 
ip ip-prefix te-tunnel index 20 permit 3.3.3.9 32 
#
return</pre>
</li><li><p>LSRB configuration file</p>
<pre class="screen">#
sysname LSRB
#
mpls lsr-id 2.2.2.9
#
mpls
 mpls te
 mpls te auto-frr
 mpls rsvp-te
 mpls te cspf
#
mpls te p2p-template te-tunnel
 record-route label
 bandwidth ct0 1000
 fast-reroute
#
mpls te auto-primary-tunnel ip-prefix te-tunnel p2p-template te-tunnel
#
isis 1
 is-level level-2
 cost-style wide
 network-entity 10.0000.0000.0002.00
 traffic-eng level-2
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown  
 ip address 10.1.1.2 255.255.255.0
 isis enable 1
 mpls
 mpls te
 mpls te bandwidth max-reservable-bandwidth 10000
 mpls te bandwidth bc0 10000
 mpls rsvp-te
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 10.1.3.1 255.255.255.0
 isis enable 1
 mpls
 mpls te
 mpls te bandwidth max-reservable-bandwidth 10000
 mpls te bandwidth bc0 10000
 mpls rsvp-te
#
interface LoopBack0
 ip address 2.2.2.9 255.255.255.255
 isis enable 1
#               
ip ip-prefix te-tunnel index 10 permit 1.1.1.9 32 
ip ip-prefix te-tunnel index 20 permit 3.3.3.9 32 
#
return</pre>
</li><li><p>LSRC configuration file</p>
<pre class="screen">#
sysname LSRC
#
mpls lsr-id 3.3.3.9
#
mpls
 mpls te
 mpls te auto-frr
 mpls rsvp-te
 mpls te cspf
#
mpls te p2p-template te-tunnel
 record-route label
 bandwidth ct0 1000
 fast-reroute
#
mpls te auto-primary-tunnel ip-prefix te-tunnel p2p-template te-tunnel
#
isis 1
 is-level level-2
 cost-style wide
 network-entity 10.0000.0000.0003.00
 traffic-eng level-2
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 10.1.2.2 255.255.255.0
 isis enable 1
 mpls
 mpls te
 mpls te bandwidth max-reservable-bandwidth 10000
 mpls te bandwidth bc0 10000
 mpls rsvp-te
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ip address 10.1.3.2 255.255.255.0
 isis enable 1
 mpls
 mpls te
 mpls te bandwidth max-reservable-bandwidth 10000
 mpls te bandwidth bc0 10000
 mpls rsvp-te
#
interface LoopBack0
 ip address 3.3.3.9 255.255.255.255
 isis enable 1
#
ip ip-prefix te-tunnel index 10 permit 1.1.1.9 32 
ip ip-prefix te-tunnel index 20 permit 2.2.2.9 32 
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_te-p2p_cfg_0093.html">Configuration Examples for MPLS TE
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_te-p2p_cfg_0099.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_te-p2p_cfg_0095.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>