
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="(Optional) Configuring the Egress Protection Function">
<meta name="abstract" content="The egress protection function reduces E2E BFD sessions to be established, bandwidth resources to be consumed, and the burden on devices.">
<meta name="description" content="The egress protection function reduces E2E BFD sessions to be established, bandwidth resources to be consumed, and the burden on devices.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_seamless_mpls_cfg_0005.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_seamless_mpls_cfg_0010.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_seamless_mpls_cfg_0011.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,z00545680,w00556928,seamlessvrp,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="Seamless MPLS">
<meta name="featuretype" content="MPLS">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="Seamless MPLS">
<meta name="featuretype" content="MPLS">
<meta name="featurename" content="Seamless MPLS">
<meta name="featuretype" content="MPLS">
<meta name="featurename" content="Seamless MPLS">
<meta name="featuretype" content="MPLS">
<meta name="OWNER" content="z00809835">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="b00896120">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172368645">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>(Optional) Configuring the Egress Protection Function</title>
</head>
<body><a name="EN-US_TASK_0172368645"></a><a name="EN-US_TASK_0172368645"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">(Optional) Configuring the Egress Protection Function</h1>
<div class="taskbody" id="taskbody839794512214047"><p id="shortdesc127448931214047">The egress protection function reduces E2E BFD sessions to be established, bandwidth resources to be consumed, and the burden on devices.</p>
<div class="context"><a name="EN-US_TASK_0172368645__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p" id="EN-US_TASK_0172368645__context1295468824214047"><p id="EN-US_TASK_0172368645__p1755311682214047">In seamless MPLS scenarios, when an egress MASG fails, E2E BFD for BGP tunnel is used to instruct a CSG to perform VPN FRR switching. In this protection solution, both BGP LSPs and BFD sessions are in great numbers, which consumes a lot of bandwidth resources and burdens the device. To optimize the solution, the egress protection function can be configured on the master and backup MASGs. With this function enabled, both the master and backup MASGs assign the same private network label value to a core ASBR. If the master MASG fails, BFD for LDP LSP or BFD for TE can instruct a core ASBR to perform BGP FRR protection switching. After traffic is switched to the backup MASG, the MASG removes the BGP public network label and uses the private network label the same as that on the faulty master MASG to search for a matching VPN instance. Traffic can then be properly forwarded.</p>
<p id="EN-US_TASK_0172368645__p65102483214047">The egress protection function is configured on both the master and backup MASGs.</p>
<div class="note" id="EN-US_TASK_0172368645__note1"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0172368645__p1380642305214047">If the egress protection function is configured on egress MASGs between which a tunnel exists and a route imported by BGP on one of the MASGs recurses to the tunnel, this MASG then recurses the route to another tunnel of a different type. In this case, traffic is directed to the other MASG, which slows down traffic switchover. As a result, the egress protection function does not take effect. To address this problem, specify <strong><span id="EN-US_TASK_0172368645__cmdparmname4790142710466">non-relay-tunnel</span></strong> when running the <a href="cmdqueryname=import-route"><b><span class="cmdname" id="EN-US_TASK_0172368645__cmdname279011275465">import-route</span></b></a> or <a href="cmdqueryname=network"><b><span class="cmdname" id="EN-US_TASK_0172368645__cmdname8790927174613">network</span></b></a> command to prevent the routes imported by BGP from recursing to tunnels.</p>
</div></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172368645__1.4.2"></a><a name="1.4.2"></a>
<div class="p" id="EN-US_TASK_0172368645__context1786060290214047"><h4 class="sectiontitle">Prerequisites</h4><p id="EN-US_TASK_0172368645__p1900962150214047">Before configuring the egress protection function, complete the following tasks:</p>
<ul id="EN-US_TASK_0172368645__ul1191591018214047"><li id="EN-US_TASK_0172368645__li1887603320214047"><p id="EN-US_TASK_0172368645__p173082109214047"><a name="EN-US_TASK_0172368645__li1887603320214047"></a><a name="li1887603320214047"></a>Configure a loopback interface on each of the master and backup MASGs. The IP address of each loopback interface on an MASG is used to establish a remote BGP peer relationship with a remote device.</p>
</li><li id="EN-US_TASK_0172368645__li1582997943214047"><p id="EN-US_TASK_0172368645__p271525318214047"><a name="EN-US_TASK_0172368645__li1582997943214047"></a><a name="li1582997943214047"></a>Host routes to the loopback interfaces are imported into the BGP routing table, and both the master and backup MASGs assigns BGP labeled routes to a core ASBR. Therefore, the core ASBR has two BGP labeled routes destined for the same loopback interface. A routing policy is configured to enable the core ASBR to select one route to implement BGP FRR.</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172368645__1.4.3"></a><a name="1.4.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol id="EN-US_TASK_0172368645__steps1198984669214047"><li id="EN-US_TASK_0172368645__step811375804214047"><span id="EN-US_TASK_0172368645__cmd2020662864214334">Run <span><a href="cmdqueryname=system-view"><b><span class="cmdname" id="EN-US_TASK_0172368645__cmdname859548814214334">system-view</span></b></a></span></span><p><p id="EN-US_TASK_0172368645__p2009495740214334">The system view is displayed.</p>
</p></li><li id="EN-US_TASK_0172368645__step654768015214047"><span id="EN-US_TASK_0172368645__cmd2128849229214334">Run <span><a href="cmdqueryname=ip+vpn-instance"><b><span class="cmdname" id="EN-US_TASK_0172368645__cmdname1252397588214334">ip vpn-instance</span></b></a> <i><span class="varname" id="EN-US_TASK_0172368645__varname2141089470214334">vpn-instance-name</span></i></span></span><p><p id="EN-US_TASK_0172368645__p1879924611214334">The VPN instance view is displayed.</p>
</p></li><li id="EN-US_TASK_0172368645__step235744871214047"><span id="EN-US_TASK_0172368645__cmd1171703303214334">Run <span><a href="cmdqueryname=ipv4-family"><b><span class="cmdname" id="EN-US_TASK_0172368645__cmdname1675680722214334">ipv4-family</span></b></a></span></span><p><p id="EN-US_TASK_0172368645__p444273028214334">The VPN instance IPv4 address family view is displayed.</p>
</p></li><li id="EN-US_TASK_0172368645__step2106098502214047"><span id="EN-US_TASK_0172368645__cmd1684269929214334">Run <a href="cmdqueryname=route-distinguisher"><b><span class="cmdname" id="EN-US_TASK_0172368645__cmdname382653307214047">route-distinguisher</span></b></a> <i><span class="varname" id="EN-US_TASK_0172368645__varname697352286214047">route-distinguisher</span></i></span><p><p id="EN-US_TASK_0172368645__p1037368022214334">An RD is configured for the VPN instance IPv4 address family.</p>
</p></li><li id="EN-US_TASK_0172368645__step2085247289214047"><span id="EN-US_TASK_0172368645__cmd1965550830214047">Run <span><a href="cmdqueryname=apply-label+per-instance+static"><b><span class="cmdname" id="EN-US_TASK_0172368645__cmdname1419840094214047">apply-label per-instance static</span></b></a> <i><span class="varname" id="EN-US_TASK_0172368645__varname1199468903214334">static-label-value</span></i></span></span><p><p id="EN-US_TASK_0172368645__p1286396384214334">A device is enabled to assign the same static label to all routes destined for a remote PE in a VPN instance IPv4 address family.</p>
<p id="EN-US_TASK_0172368645__p57396071214334">The same static label value must be set on both the master and backup MASGs.</p>
<div class="note" id="EN-US_TASK_0172368645__note289746243214047"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0172368645__p1419678352214047">A change in the label allocation mode leads to re-advertising of IPv4 address family routes in a VPN instance. This step causes a temporary service interruption. Exercise caution when using this command.</p>
</div></div>
</p></li><li id="EN-US_TASK_0172368645__step931288655214047"><span id="EN-US_TASK_0172368645__cmd1587941765214334">Run <span><a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0172368645__cmdname2082575389214334">commit</span></b></a></span></span><p><p id="EN-US_TASK_0172368645__p1944285990214334">The configuration is committed.</p>
</p></li></ol></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_seamless_mpls_cfg_0005.html">Configuring Intra-AS Seamless MPLS
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_seamless_mpls_cfg_0010.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_seamless_mpls_cfg_0011.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>