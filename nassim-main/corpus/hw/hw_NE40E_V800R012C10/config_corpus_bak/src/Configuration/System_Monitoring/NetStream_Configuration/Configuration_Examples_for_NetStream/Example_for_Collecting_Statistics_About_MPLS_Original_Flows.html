
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Collecting Statistics About MPLS Original Flows">
<meta name="abstract" content="This section provides an example for configuring NetStream to collect statistics about MPLS original flows with a specified label.">
<meta name="description" content="This section provides an example for configuring NetStream to collect statistics about MPLS original flows with a specified label.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ns_cfg_0030.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ns_cfg_0038.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ns_cfg_0035.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="NetStream">
<meta name="featuretype" content="System Monitor">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="NetStream">
<meta name="featuretype" content="System Monitor">
<meta name="featurename" content="NetStream">
<meta name="featuretype" content="System Monitor">
<meta name="featurename" content="Netstream">
<meta name="featuretype" content="System Monitor">
<meta name="OWNER" content="l00425560">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00799643">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172373028">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Collecting Statistics About MPLS Original Flows</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172373028"></a><a name="EN-US_TASK_0172373028"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Collecting Statistics About MPLS Original Flows</h1>
<div class="taskbody"><p>This section provides an example for configuring NetStream to collect statistics about MPLS original flows with a specified label.</p>
<div class="context"><a name="EN-US_TASK_0172373028__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0172373028__fig_dc_vrp_ns_cfg_003401">Figure 1</a>, <span class="keyword">Device</span>A, <span class="keyword">Device</span>B, and <span class="keyword">Device</span>C support MPLS and use OSPF as IGP on the MPLS backbone network.</p>
<p>Local Label Distribution Protocol (LDP) sessions are established between <span class="keyword">Device</span>A and <span class="keyword">Device</span>B and between <span class="keyword">Device</span>B and <span class="keyword">Device</span>C. A remote LDP session is established between <span class="keyword">Device</span>A and <span class="keyword">Device</span>C. NetStream is enabled on <span class="keyword">Device</span>B to collect statistics about MPLS flows.</p>
<div class="fignone" id="EN-US_TASK_0172373028__fig_dc_vrp_ns_cfg_003401"><a name="EN-US_TASK_0172373028__fig_dc_vrp_ns_cfg_003401"></a><a name="fig_dc_vrp_ns_cfg_003401"></a><span class="figcap"><b>Figure 1 </b>Collecting statistics about MPLS original flows</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><ul><li>In this example, interfaces 1 and 2 represent GE<span>0/1/0</span> and GE<span>0/2/0</span>, respectively.</li></ul>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0183113639.png" width="NaN" height="NaN"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172373028__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure an LDP session between every two <span class="keyword">Router</span>s.</p>
</li><li><p>Specify the remote peer and its address on the two <span class="keyword">Router</span>s that have established a remote LDP session.</p>
</li><li><p>Specify the destination address, destination port number, and source address of the output NetStream flows</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172373028__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>IP addresses of interfaces on each <span class="keyword">Router</span> as shown in <a href="#EN-US_TASK_0172373028__fig_dc_vrp_ns_cfg_003401">Figure 1</a>, OSPF process ID (1), and area (Area0)</p>
</li><li><p><span class="keyword">Device</span>A's remote peer (<span class="keyword">Device</span>C) with name <span class="keyword">Device</span>c and IP address 3.3.3.9</p>
</li><li><p><span class="keyword">Device</span>C's remote peer (<span class="keyword">Device</span>A) with name <span class="keyword">Device</span>a and IP address 1.1.1.9</p>
</li><li><p>ID of the slot in which the NetStream service processing board resides (In this example, the NetStream service processing board is in slot <span>3</span>.)</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172373028__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Assign an IP address to each involved interface.</span><p><p># Assign an IP address and a mask to each interface (including loopback interfaces) according to <a href="#EN-US_TASK_0172373028__fig_dc_vrp_ns_cfg_003401">Figure 1</a>. The configuration details are not provided here.</p>
</p></li><li><span>Configure an LDP session between every two <span class="keyword">Router</span>s.</span><p><p># Configure OSPF to advertise host routes to the specified label switching router (LSR) ID and of the network segments to which interfaces on the <span class="keyword">Router</span> are connected. Enable basic MPLS functions and LDP on each <span class="keyword">Router</span> and its interfaces.</p>
<p>For configurations of the static MPLS TE tunnel, see "Basic MPLS Configurations" in <em><span class="keyword">NE40E</span> Configuration Guide &gt; MPLS</em>.</p>
</p></li><li><span>Enable NetStream statistics collection on GigabitEthernet <span>0/1/0</span> of <span class="keyword">Device</span>B.</span><p><p># Specify the distributed NetStream sampling mode on a board.</p>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>slot <span>3</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-slot-<span>3</span>]<strong> ip netstream sampler to slot self</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-slot-<span>3</span>]<strong> quit</strong></pre>
<p># Configure NetStream to collect statistics about incoming and outgoing packets on GigabitEthernet <span>0/1/0</span> of <span class="keyword">Device</span>B.</p>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B]<strong> interface GigabitEthernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/0</span>]<strong> ip netstream inbound</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/0</span>]<strong> ip netstream outbound</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/0</span>]<strong> quit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0172373028__en-us_task_0172373022_p7233155631010">NetStream enabled on a main interface cannot collect traffic statistics about its sub-interface.</p>
</div></div>
<p># Configure NetStream to sample both inner IP packets and labels of MPLS packets.</p>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B]<strong> ip netstream mpls-aware label-and-ip</strong></pre>
<p># Specify the destination address, destination port number, and source address for the output flows.</p>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B]<strong> ip netstream export host 192.168.1.2 2100</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B]<strong> ip netstream export source 10.1.2.1</strong></pre>
<p># Enable NetStream sampling and configure the fixed packet sampling mode.</p>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B]<strong> ip netstream sampler fix-packets 10000 inbound</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>ip netstream sampler fix-packets 10000 outbound</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>commit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p># Run the <a href="cmdqueryname=display+ip+netstream+cache+origin+slot"><b><span class="cmdname">display ip netstream cache origin slot</span></b></a><strong> <span>3</span></strong> command after completing the configuration. The command output shows information about the NetStream flow buffer and statistics about output packets.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B]<strong> display ip netstream cache origin slot <span>3</span></strong>


 DstIf                         
 SrcIf                           
 DstP                          Msk          Pro            Tos 
 SrcP                          Msk          Flags          <span>Ttl</span>
 Packets                                                   Bytes
 NextHop                                                   Direction
 DstIP                                                     DstAs
 SrcIP                                                     SrcAs
 BGP: BGP NextHop                                          TopLabelType
 Label1                        Exp1         Bottom1
 Label2                        Exp2         Bottom2
 Label3                        Exp3         Bottom3
 TopLabelIpAddress                          VlanId         VniId
<span> CreateFlowTime                LastRefreshTime</span><span>             VPN</span>(direct)
 FlowLabel                     Rdvalue
 ForwardStatus
  --------------------------------------------------------------------------

 GigabitEthernet<span>0/2/0</span>                                                          
 GigabitEthernet<span>0/1/0</span>                                            
 0                             24            253            0
 0                             24            0              <span>60</span>
 3                                                          384       
 10.1.2.1                                                   in
 10.1.1.5                                                   0         
 192.168.1.4                                                0         
 0.0.0.0                                                    UNKNOWN             
 0                             0            0         
 0                             0            0         
 0                             0            0         
 0.0.0.0                                    0               0        
<span> 2018-05-09 11:38:07           2018-05-09 11:40:30          --</span>
 --                            -:-
 66(Forwarded Not Fragmented)</pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172373028__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p><span class="keyword">Device</span>A configuration file</p>
<pre class="screen">#</pre>
<pre class="screen"> sysname <span class="keyword">Device</span>A</pre>
<pre class="screen">#</pre>
<pre class="screen"> mpls lsr-id 1.1.1.9</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls</pre>
<pre class="screen"> lsp-trigger all</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls ldp</pre>
<pre class="screen">#</pre>
<pre class="screen"> mpls ldp remote-peer <span class="keyword">Device</span>c</pre>
<pre class="screen"> remote-ip 3.3.3.9</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.1.1.1 255.255.255.0</pre>
<pre class="screen"> mpls</pre>
<pre class="screen"> mpls ldp</pre>
<pre class="screen">#</pre>
<pre class="screen">interface LoopBack1</pre>
<pre class="screen"> ip address 1.1.1.9 255.255.255.255</pre>
<pre class="screen">#</pre>
<pre class="screen">ospf 1</pre>
<pre class="screen"> area 0.0.0.0</pre>
<pre class="screen">  network 10.1.1.0 0.0.0.255</pre>
<pre class="screen">  network 1.1.1.9 0.0.0.0</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p><span class="keyword">Device</span>B configuration file</p>
<pre class="screen"># </pre>
<pre class="screen">slot <span>3</span></pre>
<pre class="screen"> ip netstream sampler to slot self</pre>
<pre class="screen">#</pre>
<pre class="screen"> sysname <span class="keyword">Device</span>B</pre>
<pre class="screen">#</pre>
<pre class="screen"> ip netstream mpls-aware label-and-ip</pre>
<pre class="screen"># </pre>
<pre class="screen">ip netstream sampler fix-packets 10000 inbound</pre>
<pre class="screen">ip netstream sampler fix-packets 10000 outbound </pre>
<pre class="screen">ip netstream export host 192.168.1.2 2100</pre>
<pre class="screen">ip netstream export source 10.1.2.1</pre>
<pre class="screen">#</pre>
<pre class="screen"> mpls lsr-id 2.2.2.9</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls</pre>
<pre class="screen"> lsp-trigger all</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls ldp</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.1.1.2 255.255.255.0</pre>
<pre class="screen"> ip netstream inbound</pre>
<pre class="screen"> ip netstream outbound</pre>
<pre class="screen"> mpls</pre>
<pre class="screen"> mpls ldp</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/2/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.1.2.1 255.255.255.0</pre>
<pre class="screen"> mpls</pre>
<pre class="screen"> mpls ldp</pre>
<pre class="screen">#</pre>
<pre class="screen">interface LoopBack1</pre>
<pre class="screen"> ip address 2.2.2.9 255.255.255.255</pre>
<pre class="screen">#</pre>
<pre class="screen">ospf 1</pre>
<pre class="screen"> area 0.0.0.0</pre>
<pre class="screen">  network 10.1.1.0 0.0.0.255</pre>
<pre class="screen">  network 10.1.2.0 0.0.0.255</pre>
<pre class="screen">  network 2.2.2.9 0.0.0.0</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p><span class="keyword">Device</span>C configuration file</p>
<pre class="screen">#</pre>
<pre class="screen"> sysname <span class="keyword">Device</span>C</pre>
<pre class="screen">#</pre>
<pre class="screen"> mpls lsr-id 3.3.3.9</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls</pre>
<pre class="screen"> lsp-trigger all</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls ldp</pre>
<pre class="screen">#</pre>
<pre class="screen"> mpls ldp remote-peer <span class="keyword">Device</span>A</pre>
<pre class="screen"> remote-ip 1.1.1.9</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.1.2.2 255.255.255.0</pre>
<pre class="screen"> mpls</pre>
<pre class="screen"> mpls ldp</pre>
<pre class="screen">#</pre>
<pre class="screen">interface LoopBack1</pre>
<pre class="screen"> ip address 3.3.3.9 255.255.255.255</pre>
<pre class="screen">#</pre>
<pre class="screen">ospf 1</pre>
<pre class="screen"> area 0.0.0.0</pre>
<pre class="screen">  network 4.1.1.0 0.0.0.255</pre>
<pre class="screen">  network 3.3.3.9 0.0.0.0</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ns_cfg_0030.html">Configuration Examples for NetStream
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ns_cfg_0038.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ns_cfg_0035.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>