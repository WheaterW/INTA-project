
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Peer Locator-based IFIT in an L3VPN Service Scenario">
<meta name="abstract" content="This section provides an example for configuring IFIT to implement end-to-end packet loss and delay measurement based on the peer locator on an L3VPN over SRv6 network.">
<meta name="description" content="This section provides an example for configuring IFIT to implement end-to-end packet loss and delay measurement based on the peer locator on an L3VPN over SRv6 network.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ifit_cfg_0040.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ifit_cfg_0019.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="IFIT">
<meta name="featuretype" content="System Monitor">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="IFIT">
<meta name="featuretype" content="System Monitor">
<meta name="featurename" content="IFIT">
<meta name="featuretype" content="System Monitor">
<meta name="featurename" content="IFIT">
<meta name="featuretype" content="System Monitor">
<meta name="featurename" content="IFIT">
<meta name="featuretype" content="System Monitor">
<meta name="OWNER" content="l00425560">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="c00511010">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0203265102">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring Peer Locator-based IFIT in an L3VPN Service Scenario</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0203265102"></a><a name="EN-US_TASK_0203265102"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Peer Locator-based IFIT in an L3VPN Service Scenario</h1>
<div class="taskbody"><p>This section provides an example for configuring IFIT to implement end-to-end packet loss and delay measurement based on the peer locator on an L3VPN over SRv6 network.</p>
<div class="context"><a name="EN-US_TASK_0203265102__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>L3VPN over SRv6 uses public network SRv6 tunnels to carry L3VPN services. To meet users' higher requirements on service quality, IFIT is required on an L3VPN over SRv6 network to monitor the packet loss rate and delay of links between PEs in real time. This enables timely responses to service quality deterioration.</p>
<p>On the L3VPN over SRv6 network shown in <a href="#EN-US_TASK_0203265102__fig_dc_vrp_ifit_cfg_001301">Figure 1</a>, service flows enter the network through PE1, traverse the P, and leave the network through PE2.</p>
<div class="fignone" id="EN-US_TASK_0203265102__fig_dc_vrp_ifit_cfg_001301"><a name="EN-US_TASK_0203265102__fig_dc_vrp_ifit_cfg_001301"></a><a name="fig_dc_vrp_ifit_cfg_001301"></a><span class="figcap"><b>Figure 1 </b>Configuring peer locator-based IFIT on an L3VPN over SRv6 network</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interface1, interface2, and interface3 in this example represent GE<span>0/1/0</span>, GE<span>0/2/0</span>, and GE<span>0/3/0</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0217893802.png" width="NaN" height="NaN"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0203265102__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><div class="p">The configuration roadmap is as follows:<ol><li>Configure an L3VPN over SRv6 network on each PE and the P. Specifically:<ol type="a"><li>Enable IPv6 forwarding on each device and configure IPv6 addresses for involved interfaces.</li><li>Enable IS-IS, configure an IS-IS level, and specify a network entity on each device.</li><li>Configure the IS-IS SRv6 capability on each device.</li><li>Configure a VPN instance on the PEs.</li><li>Establish an EBGP peer relationship between each PE and its connected CE.</li><li>Establish an MP-IBGP peer relationship between the PEs.</li><li>Configure SRv6 BE on PEs.</li></ol>
</li><li><p>Configure basic 1588v2 functions to synchronize clocks among all devices.</p>
</li><li><p>Configure packet loss and delay measurement on the PEs to collect packet loss rate and delay statistics at intervals. </p>
</li><li>Configure the device to send statistics to the NMS through telemetry.</li></ol>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0203265102__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><div class="p">To complete the configuration, you need the following data:<ul><li><p>IPv6 address of each interface as listed in <a href="#EN-US_TASK_0203265102__fig_dc_vrp_ifit_cfg_001301">Figure 1</a></p>
</li><li><p>Area numbers of the PEs and P</p>
</li><li>Levels on the PEs and P</li><li>Name, RD, and RT of the VPN instance on each PE</li><li><p>IFIT instance ID (1) and measurement interval (10s)</p>
</li><li><p>Peer locator (2001:db8:40::1/64) of the IFIT instance</p>
</li><li id="EN-US_TASK_0203265102__li9112142593714">NMS's IPv6 address (2001:db8:101::1) and port number (10001), and reachable routes between the NMS and device</li></ul>
</div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0203265102__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure an L3VPN over SRv6 network on each PE and the P. For configuration details, see <a href="#EN-US_TASK_0203265102__section_05">Configuration Files</a>.</span></li><li><span>Configure 1588v2 to synchronize the clocks of the P and PEs. For detailed configurations, see <a href="#EN-US_TASK_0203265102__section_05">Configuration Files</a>.</span></li><li><span>Configure IFIT for the link between PE1 and PE2.</span><p><p># Configure PE1.</p>
<pre class="screen">&lt;PE1&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>ifit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ifit]<strong> node-id 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ifit]<strong> instance 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ifit-instance-1] <strong>measure-mode e2e</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ifit-instance-1] <strong>interval 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ifit-instance-1] <strong>flow unidirectional source any destination any vpn-instance vpna peer-locator <span>2001:DB8:40::1</span> 64</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ifit-instance-1] <strong>binding interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ifit-instance-1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-ifit-instance-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-ifit] <strong>quit</strong></pre>
<div class="p"># Run the <a href="cmdqueryname=display+ifit+static"><b><span class="cmdname">display ifit static</span></b></a> command to check the configuration and status of PE1.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display ifit static instance 1</strong></pre>
<pre class="screen">-------------------------------------------------------------------------
Flow Classification                     : static
Instance Id                             : 1
Instance Name                           : 1 
Instance Type                           : instance
Flow Id                                 : 1572865
Flow Monitor Id                         : 524289
Flow Node Id                            : 1
Flow Type                               : unidirectional
Source IP Address/Mask Length           : any(IPv4)
Destination IP Address/Mask Length      : any(IPv4)
Protocol                                : any
Source Port                             : any
Destination Port                        : any
Gtp                                     : disable
Gtp TeId                                : --
Dscp                                    : --
Interface                               : GigabitEthernet<span>0/2/0</span>
vpn-instance                            : vpna
Measure State                           : enable 
Loss Measure                            : enable
Delay Measure                           : enable
Delay Per packet Measure                : disable
Disorder Measure                        : disable
Gtpu Sequence Measure                   : disable
Single Device Measure                   : disable
Measure Mode                            : e2e
Interval                                : 10(s)
Tunnel Type                             : SRv6
Flow Match Priority                     : 0
Peer Locator:                           : <span>2001:DB8:40::1</span>/64</pre>
</div>
<div class="p"># Configure PE2.<pre class="screen">&lt;PE2&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>ifit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ifit]<strong> node-id 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ifit] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-ifit] <strong>quit</strong></pre>
</div>
<p># Run the <a href="cmdqueryname=display+ifit+dynamic-hop"><b><span class="cmdname">display ifit dynamic-hop</span></b></a> command to check the configuration and status of PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>display ifit dynamic-hop</strong></pre>
<pre class="screen">-------------------------------------------------------------------------
Flow Classification                     : dynamic-hop
Instance Id                             : 514
Instance Type                           : instance
Flow Id                                 : 1572865
Flow Monitor Id                         : 524289
Flow Node Id                            : 1
Flow Type                               : unidirectional
Interface                               : GigabitEthernet<span>0/2/0</span>
Direction                               : egress
Loss Measure                            : enable
Delay Measure                           : enable
Disorder Measure                        : disable
Interval                                : 10(s)</pre>
</p></li><li><span>Configure the device to send statistics to the NMS through telemetry. The following uses PE1 as an example.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>telemetry</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-telemetry] <strong>destination-group ifit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-telemetry-destination-group-ifit] <strong>ipv6-address 2001:DB8:101::1 port 10001 protocol grpc</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-telemetry-destination-group-ifit] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-telemetry] <strong>sensor-group ifit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-telemetry-sensor-group-ifit] <strong>sensor-path huawei-ifit:ifit/huawei-ifit-statistics:flow-locator-statistics/flow-locator-statistic</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-telemetry-sensor-group-ifit-path] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-telemetry-sensor-group-ifit] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-telemetry] <strong>subscription ifit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-telemetry-subscription-ifit] <strong>sensor-group ifit</strong> <strong>sample-interval 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-telemetry-subscription-ifit] <strong>destination-group ifit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-telemetry-subscription-ifit] <strong>commit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>You are advised to configure devices to send data using a secure TLS encryption mode. For details, see <em>Telemetry Configuration</em>.</p>
</div></div>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0203265102__section_05"><a name="EN-US_TASK_0203265102__section_05"></a><a name="section_05"></a><a name="EN-US_TASK_0203265102__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>PE1 configuration file</p>
<pre class="screen">#
sysname PE1
#
ptp enable
ptp domain 1
ptp device-type bc
#
clock source ptp synchronization enable
clock source ptp priority 1
#
ip vpn-instance vpna
 ipv4-family
  route-distinguisher 100:1
  apply-label per-instance
  vpn-target 111:1 export-extcommunity
  vpn-target 111:1 import-extcommunity
#               
segment-routing ipv6
 encapsulation source-address 2001:DB8:1::1
 locator as1 ipv6-prefix 2001:DB8:100::1 64 static 32
#               
isis 1          
 is-level level-1
 cost-style wide
 network-entity 10.0000.0000.0001.00
 #
 ipv6 enable topology ipv6
<span> segment-routing ipv6 locator as1</span>              
 #
#               
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown  
 ipv6 enable    
 ipv6 address 2001:DB8:10::1/96
 isis ipv6 enable 1
 ptp enable
#               
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown  
 ip binding vpn-instance vpna
 ip address 10.1.1.1 255.255.255.0
 ptp enable
#               
interface LoopBack1
 ipv6 enable    
 ipv6 address 2001:DB8:1::1/64
 isis ipv6 enable 1
#               
bgp 100         
 router-id 1.1.1.1
 peer 2001:DB8:3::3 as-number 100
 peer 2001:DB8:3::3 connect-interface LoopBack1
 #              
 ipv4-family unicast
  undo synchronization
 #              
 ipv6-family unicast
  undo synchronization
 #              
 ipv4-family vpnv4
  policy vpn-target
  peer 2001:DB8:3::3 enable
  peer 2001:DB8:3::3 prefix-sid
 #              
 ipv4-family vpn-instance vpna
  import-route direct
  segment-routing ipv6 locator as1
  segment-routing ipv6 best-effort
  peer 10.1.1.2 as-number 65410
#
ifit
 node-id 1
 instance 1
  interval 10                                                          
<strong> </strong> flow unidirectional source any destination any vpn-instance vpna peer-locator <span>2001:DB8:40::1</span> 64
  binding interface GigabitEthernet<span>0/2/0</span>
#
telemetry
 #
 sensor-group ifit
  sensor-path huawei-ifit:ifit/huawei-ifit-statistics:flow-locator-statistics/flow-locator-statistic
 #
 destination-group ifit
  ipv6-address 2001:DB8:101::1 port 10001 protocol grpc
 #
 subscription ifit
  sensor-group ifit sample-interval 0
  destination-group ifit
#
return</pre>
</li><li><p>P configuration file</p>
<pre class="screen">#
sysname P        
#
ptp enable
ptp domain 1
ptp device-type bc
#
clock source bits0 synchronization enable
clock source bits0 priority 1
clock source ptp synchronization enable
clock source ptp priority 1
clock bits-type bits0 2mhz
#
isis 1          
 is-level level-1
 cost-style wide
 network-entity 10.0000.0000.0002.00
 #
 ipv6 enable topology ipv6
 #
# 
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown  
 ipv6 enable    
 ipv6 address 2001:DB8:10::2/96
 isis ipv6 enable 1 
 ptp enable
# 
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown  
 ipv6 enable    
 ipv6 address 2001:DB8:20::1/96
 isis ipv6 enable 1 
 ptp enable
#
interface GigabitEthernet<span>0/3/0</span>
 undo shutdown  
 ipv6 enable    
 ipv6 address 2001:DB8:30::1/96
 ptp enable
#               
interface LoopBack1
 ipv6 enable    
 ipv6 address 2001:DB8:2::2/64
 isis ipv6 enable 1
#               
return </pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#
sysname PE2
#
ptp enable
ptp domain 1
ptp device-type bc
#
clock source ptp synchronization enable
clock source ptp priority 1
#
ip vpn-instance vpna
 ipv4-family
  route-distinguisher 200:1
  apply-label per-instance
  vpn-target 111:1 export-extcommunity
  vpn-target 111:1 import-extcommunity
#               
segment-routing ipv6
 encapsulation source-address 2001:DB8:3::3
 locator as1 ipv6-prefix <span>2001:DB8:40::1</span> 64 static 32
#               
isis 1          
 is-level level-1
 cost-style wide
 network-entity 10.0000.0000.0003.00
 #
 ipv6 enable topology ipv6
<span> segment-routing ipv6 locator as1</span>              
 #
#               
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown  
 ipv6 enable    
 ipv6 address 2001:DB8:20::2/96
 isis ipv6 enable 1
 ptp enable
#               
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown  
 ip binding vpn-instance vpna
 ip address 10.2.1.1 255.255.255.0
 ptp enable
#               
interface LoopBack1
 ipv6 enable    
 ipv6 address 2001:DB8:3::3/64
 isis ipv6 enable 1
#               
bgp 100         
 router-id 2.2.2.2
 peer 2001:DB8:1::1 as-number 100
 peer 2001:DB8:1::1 connect-interface LoopBack1
 #              
 ipv4-family unicast
  undo synchronization
 #              
 ipv6-family unicast
  undo synchronization
 #              
 ipv4-family vpnv4
  policy vpn-target
  peer 2001:DB8:1::1 enable
  peer 2001:DB8:1::1 prefix-sid
 #              
 ipv4-family vpn-instance vpna
  import-route direct
  segment-routing ipv6 locator as1
  segment-routing ipv6 best-effort
  peer 10.2.1.2 as-number 65420
#
ifit
 node-id 2
#
telemetry
 #
 sensor-group ifit
  sensor-path huawei-ifit:ifit/huawei-ifit-statistics:flow-locator-statistics/flow-locator-statistic
 #
 destination-group ifit
  ipv6-address 2001:DB8:101::1 port 10001 protocol grpc
 #
 subscription ifit
  sensor-group ifit sample-interval 0
  destination-group ifit
#               
return</pre>
</li><li>CE1 configuration file<pre class="screen">#
sysname CE1
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown  
 ip address 10.1.1.2 255.255.255.0
#               
interface LoopBack1
 ip address 11.11.11.11 255.255.255.255
#               
bgp 65410       
 peer 10.1.1.1 as-number 100
 #              
 ipv4-family unicast
  undo synchronization
  network 11.11.11.11 255.255.255.255
  peer 10.1.1.1 enable
#               
return </pre>
</li><li>CE2 configuration file<pre class="screen">#
sysname CE2
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.2.1.2 255.255.255.0
#
interface LoopBack1
 ip address 22.22.22.22 255.255.255.255
#
bgp 65420
 peer 10.2.1.1 as-number 100
 #
 ipv4-family unicast
  undo synchronization
  network 22.22.22.22 255.255.255.255
  peer 10.2.1.1 enable
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ifit_cfg_0040.html">Examples for Configuring Performance Measurement Based on SRH-encapsulated Static IFIT Flows on an SRv6 Network
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ifit_cfg_0019.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>