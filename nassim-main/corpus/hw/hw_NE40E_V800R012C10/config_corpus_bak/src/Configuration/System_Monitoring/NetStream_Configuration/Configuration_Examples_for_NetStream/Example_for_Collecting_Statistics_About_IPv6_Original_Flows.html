
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Collecting Statistics About IPv6 Original Flows">
<meta name="abstract" content="This section provides an example for deploying NetStream to collect statistics about original flows. This example uses the configurations on an IPv6 network.">
<meta name="description" content="This section provides an example for deploying NetStream to collect statistics about original flows. This example uses the configurations on an IPv6 network.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ns_cfg_0030.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ns_cfg_0035.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ns_cfg_0069.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,netstream_vrp,w00556928,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="NetStream">
<meta name="featuretype" content="System Monitor">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="NetStream">
<meta name="featuretype" content="System Monitor">
<meta name="featurename" content="NetStream">
<meta name="featuretype" content="System Monitor">
<meta name="featurename" content="Netstream">
<meta name="featuretype" content="System Monitor">
<meta name="OWNER" content="l00799643">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00799643">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172373034">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Collecting Statistics About IPv6 Original Flows</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172373034"></a><a name="EN-US_TASK_0172373034"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Collecting Statistics About IPv6 Original Flows</h1>
<div class="taskbody"><p>This section provides an example for deploying NetStream to collect statistics about original flows. This example uses the configurations on an IPv6 network.</p>
<div class="context"><a name="EN-US_TASK_0172373034__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>As the Internet continues to develop rapidly, carrier networks support higher bandwidth and predictable QoS parameters. As such, carriers need to provide finer-grained management and accounting services. To implement classified monitoring over networks more effectively, you can configure NetStream monitoring services to output traffic statistics collected on specified interfaces to specified NSCs and NDAs for analysis. This enables collected statistics to be output to multiple addresses.</p>
<p>As shown in <a href="#EN-US_TASK_0172373034__fig_dc_vrp_ns_cfg_005101">Figure 1</a>, GE<span>0/1/0</span> and GE<span>0/2/0</span> on <span class="keyword">Device</span>C are connected to two IPv6 networks through <span class="keyword">Device</span>A and <span class="keyword">Device</span>B, respectively. <span class="keyword">Device</span>C collects traffic statistics, aggregates the statistics, and sends them to NMS1 and NMS2.</p>
<p>To collect flow-specific statistics, configure NetStream monitoring services in the inbound direction of GE <span>0/1/0</span> and GE <span>0/2/0</span> on <span class="keyword">Device</span>C. Traffic statistics collected on GE <span>0/1/0</span> are sent to NMS1 with an IPv4 address and traffic statistics collected on GE <span>0/2/0</span> are sent to NMS2 with an IPv6 address.</p>
<div class="fignone" id="EN-US_TASK_0172373034__fig_dc_vrp_ns_cfg_005101"><a name="EN-US_TASK_0172373034__fig_dc_vrp_ns_cfg_005101"></a><a name="fig_dc_vrp_ns_cfg_005101"></a><span class="figcap"><b>Figure 1 </b>Network diagram of NetStream traffic statistics collection</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><ul><li>In this example, interface1 and interface2 represent GE <span>0/1/0</span> and GE <span>0/2/0</span>, respectively.</li></ul>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_ns_cfg_005101.png" width="NaN" height="NaN"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172373034__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Assign an IP address to each interface on each <span class="keyword">Router</span>.</p>
</li><li><p>Enable NetStream statistics collection on <span class="keyword">Router</span>C.</p>
</li><li><p>Configure NetStream monitoring services on <span class="keyword">Router</span>C.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172373034__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>IP address of each interface on each <span class="keyword">Router</span></p>
</li><li><p>Version for outputting NetStream flows</p>
</li><li><p>Source and destination addresses, destination port number, and monitoring view name of the output NetStream flows</p>
</li><li><p>ID of the slot in which the NetStream service processing board resides (In this example, the NetStream service processing board is in slot <span>3</span>.)</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172373034__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure IP addresses for each <span class="keyword">Router</span>. The configuration details are not provided here.</span></li><li><span>Enable NetStream statistics collection on <span class="keyword">Device</span>C.</span><p><p># Configure the board to process NetStream services in distributed mode.</p>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C]<strong> slot <span>3</span> </strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-slot-<span>3</span>]<strong> ipv6 netstream sampler to slot self</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-slot-<span>3</span>]<strong> quit </strong></pre>
<p># Collect statistics about TCP flags in original flows.</p>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C]<strong> ipv6 netstream tcp-flag enable</strong></pre>
<p># Enable NetStream sampling and configure the fixed packet sampling mode.</p>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C]<strong> ipv6 netstream sampler fix-packets 10000 inbound</strong></pre>
<p># Set the version number and source address of the output packets carrying original flow statistics.</p>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C] <strong>ipv6 netstream export version 9</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C] <strong>ipv6 netstream export source ipv6 2001:db8:100::1</strong></pre>
<p># Configure NetStream to collect statistics about incoming flows on GE <span>0/1/0</span> and GE <span>0/2/0</span>.</p>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C]<strong> interface GigabitEthernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-GigabitEthernet<span>0/1/0</span>]<strong> undo shutdown </strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-GigabitEthernet<span>0/1/0</span>]<strong> ipv6 netstream inbound</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-GigabitEthernet<span>0/1/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C]<strong> interface GigabitEthernet<span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-GigabitEthernet<span>0/2/0</span>]<strong> undo shutdown </strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-GigabitEthernet<span>0/2/0</span>]<strong> ipv6 netstream inbound</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-GigabitEthernet<span>0/2/0</span>]<strong> quit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0172373034__en-us_task_0172373022_p7233155631010">NetStream enabled on a main interface cannot collect traffic statistics about its sub-interface.</p>
</div></div>
</p></li><li><span>Configure NetStream monitoring services.</span><p><pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C] <strong>ipv6 netstream monitor monitor1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-monitor-monitor1] <strong>ipv6 netstream export host 192.168.0.2 6000</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-monitor-monitor1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C] <strong>ipv6 netstream monitor monitor2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-monitor-monitor2] <strong>ipv6 netstream export host ipv6 2001:db8:100::1 6000</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-monitor-monitor2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-GigabitEthernet<span>0/1/0</span>] <strong>ipv6 netstream monitor monitor1 inbound</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C] <strong>interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-GigabitEthernet<span>0/2/0</span>] <strong>ipv6 netstream monitor monitor2 inbound</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C]<strong> commit </strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p>Run the <a href="cmdqueryname=display+ipv6+netstream+monitor+all"><b><span class="cmdname">display ipv6 netstream monitor all</span></b></a> command to check information about all NetStream monitoring services.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C] <strong>display ipv6 netstream monitor all</strong></pre>
<pre class="screen">Monitor monitor1
 ID        : 1
 AppCount  : 1

 Address                                   Port            
 192.168.0.2                               6000            
------------------------------------------------------------
Monitor monitor2
 ID        : 2
 AppCount  : 1

 Address                                   Port            
 2001:DB8:100::1                           6000            
------------------------------------------------------------</pre>
<p># Run the <strong>display ipv6 netstream cache origin slot <span>3</span></strong> command to check information about various original flows in the NetStream flow buffer.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C] <strong>display ipv6 netstream cache origin slot <span>3</span></strong></pre>
<pre class="screen">

 DstIf                         
 SrcIf                           
 DstP                          Msk          Pro            Tos 
 SrcP                          Msk          Flags          <span>Ttl</span>
 Packets                                                   Bytes
 NextHop                                                   Direction
 DstIP                                                     DstAs
 SrcIP                                                     SrcAs
 BGP: BGP NextHop                                          TopLabelType
 Label1                        Exp1         Bottom1
 Label2                        Exp2         Bottom2
 Label3                        Exp3         Bottom3
 TopLabelIpAddress                          VlanId         VniId
<span> CreateFlowTime                LastRefreshTime</span><span>             VPN</span>(direct)
 FlowLabel                     Rdvalue
 ForwardStatus
 --------------------------------------------------------------------------

 GigabitEthernet<span>0/2/0</span>                                                        
 GigabitEthernet<span>0/1/0</span>                                          
 0                             0            59             0  
 0                             0            0              <span>100</span>
 443426                                                    56758528  
 ::                                                        in
 2001:DB8:20::1                                            0         
 2001:DB8:80::1                                            0         
 ::                                                        UNKNOWN             
 0                             0            0         
 0                             0            0         
 0                             0            0         
 0.0.0.0                                    0              0
<span> 2018-05-09 11:38:07           2018-05-09 11:40:30         --</span>
 112706                        -:-
 64(Forwarded Unknown)</pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172373034__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p><span class="keyword">Device</span>A configuration file</p>
<pre class="screen"># 
sysname <span class="keyword">Device</span>A
# 
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ipv6 enable
 ipv6 address 2001:DB8:200::2/96
#
return</pre>
</li><li><p><span class="keyword">Device</span>B configuration file</p>
<pre class="screen"># 
sysname <span class="keyword">Device</span>B
# 
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ipv6 enable
 ipv6 address 2001:DB8:300::2/96
#
return</pre>
</li><li><p><span class="keyword">Device</span>C configuration file</p>
<pre class="screen"># 
sysname <span class="keyword">Device</span>C
 # 
ipv6 netstream tcp-flag enable
ipv6 netstream sampler fix-packets 10000 inbound 
ipv6 netstream export version 9
ipv6 netstream export source ipv6 2001:DB8:100::1
 # 
ipv6 netstream monitor monitor1
 ipv6 netstream export host 192.168.0.2 6000
#
ipv6 netstream monitor monitor2
 ipv6 netstream export host ipv6 2001:DB8:100::1 6000
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ipv6 enable
 ipv6 address 2001:DB8:200::1/96
 ipv6 netstream inbound
 ipv6 netstream monitor monitor1 inbound
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ipv6 enable
 ipv6 address 2001:DB8:300::1/96
 ipv6 netstream inbound
 ipv6 netstream monitor monitor2 inbound
<span>#
</span>slot <span>3</span>
 ipv6 netstream sampler to slot self
#      
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ns_cfg_0030.html">Configuration Examples for NetStream
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ns_cfg_0035.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ns_cfg_0069.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>