
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring IFIT Measurement Based on Dynamic Flow Learning">
<meta name="abstract" content="This section uses an L3VPN as an example to describe how to implement end-to-end packet loss and delay measurement through IFIT dynamic flow learning.">
<meta name="description" content="This section uses an L3VPN as an example to describe how to implement end-to-end packet loss and delay measurement through IFIT dynamic flow learning.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ifit_cfg_0029.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ifit_cfg_0041.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="IFIT">
<meta name="featuretype" content="System Monitor">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="IFIT">
<meta name="featuretype" content="System Monitor">
<meta name="featurename" content="IFIT">
<meta name="featuretype" content="System Monitor">
<meta name="featurename" content="IFIT">
<meta name="featuretype" content="System Monitor">
<meta name="OWNER" content="c00511010">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="c00511010">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0319067886">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring IFIT Measurement Based on Dynamic Flow Learning</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0319067886"></a><a name="EN-US_TASK_0319067886"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring IFIT Measurement Based on Dynamic Flow Learning</h1>
<div class="taskbody"><p>This section uses an L3VPN as an example to describe how to implement end-to-end packet loss and delay measurement through IFIT dynamic flow learning.</p>
<div class="context"><a name="EN-US_TASK_0319067886__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>To meet users' higher requirements on service quality, IFIT is required on an L3VPN to monitor the packet loss rate and delay on links between PEs in real time. This enables timely responses to service quality deterioration. IFIT supports automatic learning of dynamic flows on the ingress by using the mask or exact match of the source or destination address. In addition, IFIT can flexibly monitor service quality in real time by configuring a learning whitelist.</p>
<p><a href="#EN-US_TASK_0319067886__fig_dc_vrp_ifit_cfg_001301">Figure 1</a> shows an L3VPN where service flows enter the network through PE1, traverse the P, and leave the network through PE2.</p>
<div class="fignone" id="EN-US_TASK_0319067886__fig_dc_vrp_ifit_cfg_001301"><a name="EN-US_TASK_0319067886__fig_dc_vrp_ifit_cfg_001301"></a><a name="fig_dc_vrp_ifit_cfg_001301"></a><span class="figcap"><b>Figure 1 </b>Configuring IFIT measurement based on dynamic flow learning</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interface1, interface2, and interface3 in this example represent GE <span>0/1/0</span>, GE <span>0/2/0</span>, and GE <span>0/3/0</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0319067887.png" width="NaN" height="NaN"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0319067886__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><div class="p">The configuration roadmap is as follows:<ol><li>Configure an L3VPN on the P and each PE. Specifically:<ol type="a"><li>Configure an IP address and a routing protocol for each interface so that all devices can communicate at the network layer. This example uses IS-IS as the routing protocol.</li><li>Configure MPLS and public network tunnels to carry L3VPN services. In this example, SR-MPLS TE tunnels are used.</li><li>Configure a VPN instance on each PE, enable the IPv4 address family for the instance, and bind the instance to the interface connecting the PE to a CE.</li><li>Establish an MP-IBGP peer relationship between the PEs for them to exchange routing information.</li><li>Establish an EBGP peer relationship between each CE and PE pair for them to exchange routing information.</li></ol>
</li><li><p>Configure basic 1588v2 functions to synchronize the clocks across all devices.</p>
</li><li><p>Configure packet loss and delay measurement on the PEs to collect packet loss rate and delay statistics at intervals.</p>
</li><li>Configure the device to send statistics to the NMS through telemetry.</li></ol>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0319067886__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><div class="p">To complete the configuration, you need the following data:<ul><li><p>IP address of each interface as listed in <a href="#EN-US_TASK_0319067886__fig_dc_vrp_ifit_cfg_001301">Figure 1</a></p>
</li><li><p>MPLS LSR IDs on the PEs and P</p>
</li><li><p>SRGB ranges on the PEs and P</p>
</li><li>Name, VPN target, and RD of the VPN instance on each PE</li><li><p>Whitelist group (1) for IFIT performance measurement</p>
</li><li><p>Source IP address (10.11.1.1) and destination IP address (10.22.2.2) of dynamic flows learned by IFIT</p>
</li><li>NMS's IPv4 address (192.168.100.100) and port number (10001), and reachable routes between the NMS and devices</li></ul>
</div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0319067886__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure an L3VPN on each PE and the P. For configuration details, see <a href="#EN-US_TASK_0319067886__section_05">Configuration Files</a>.</span></li><li><span>Configure 1588v2 to synchronize the clocks of the P and PEs. For detailed configurations, see <a href="#EN-US_TASK_0319067886__section_05">Configuration Files</a>.</span></li><li><span>Configure IFIT dynamic flow learning on PE1.</span><p><p># Configure PE1.</p>
<pre class="screen">&lt;PE1&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>ifit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ifit]<strong> node-id 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ifit] <strong>encapsulation nexthop</strong> <strong>3.3.3.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ifit] <strong>whitelist-group</strong><strong> 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ifit-whitelist-group-1]<strong> rule rule1 ipv4 source 10.11.1.1 32 destination 10.22.2.2 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ifit-whitelist-group-1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-ifit-whitelist-group-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-ifit] <strong>flow-learning vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ifit-vpn-instance-vpna] <strong>flow-learning</strong> <strong>unidirectional</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ifit-vpn-instance-vpna] <strong>flow-learning </strong><strong>interface all</strong> <strong>whitelist-group 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ifit-vpn-instance-vpna] <strong>commit</strong> </pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-ifit-vpn-instance-vpna] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-ifit] <strong>quit</strong></pre>
<div class="p"># Run the <a href="cmdqueryname=display+ifit+dynamic"><b><span class="cmdname">display ifit dynamic</span></b></a> command to check statistics about dynamic flows learned on PE1.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display ifit dynamic</strong></pre>
<pre class="screen">-------------------------------------------------------------------------
Flow Classification                     : dynamic
Instance Id                             : 10
Instance Type                           : instance
Flow Id                                 : 1572865
Flow Monitor Id                         : 524289
Flow Node Id                            : 1
Flow Type                               : unidirectional
Source IP Address/Mask Length           : 10.11.1.1/32
Destination IP Address/Mask Length      : 10.22.2.2/32
Protocol                                : any
Source Port                             : any
Destination Port                        : any
Gtp                                     : disable
Gtp TeId                                : --
Dscp                                    : --
Interface                               : GigabitEthernet<span>0/1/0</span>
vpn-instance                            : vpna
Measure State                           : enable 
Loss Measure                            : enable
Delay Measure                           : enable
Delay Per packet Measure                : disable
Disorder Measure                        : disable
Gtpu Sequence Measure                   : disable
Single Device Measure                   : disable
Measure Mode                            : e2e
Interval                                : 60(s)
Tunnel Type                             : --</pre>
</div>
<div class="p"># Configure PE2.<pre class="screen">&lt;PE2&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>ifit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ifit]<strong> node-id 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ifit] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-ifit] <strong>quit</strong></pre>
</div>
<p># Run the <a href="cmdqueryname=display+ifit+dynamic-hop"><b><span class="cmdname">display ifit dynamic-hop</span></b></a> command to check the configuration and status of PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>display ifit dynamic-hop</strong></pre>
<pre class="screen">-------------------------------------------------------------------------
Flow Classification                     : dynamic-hop
Instance Id                             : 514
Instance Type                           : instance
Flow Id                                 : 1572865
Flow Monitor Id                         : 524289
Flow Node Id                            : 1
Flow Type                               : unidirectional
Interface                               : GigabitEthernet<span>0/1/0</span>
Direction                               : egress
Loss Measure                            : enable
Delay Measure                           : enable
Disorder Measure                        : disable
Interval                                : 60(s)</pre>
</p></li><li><span>Configure the device to send statistics to the NMS through telemetry. The following uses PE1 as an example.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>telemetry</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-telemetry] <strong>destination-group ifit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-telemetry-destination-group-ifit] <strong>ipv4-address 192.168.100.100 port 10001 protocol</strong><strong> grpc</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-telemetry-destination-group-ifit] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-telemetry] <strong>sensor-group ifit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-telemetry-sensor-group-ifit] <strong>sensor-path huawei-ifit:ifit/huawei-ifit-statistics:flow-statistics/flow-statistic</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-telemetry-sensor-group-ifit-path] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-telemetry-sensor-group-ifit] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-telemetry] <strong>subscription ifit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-telemetry-subscription-ifit] <strong>sensor-group ifit</strong> <strong>sample-interval 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-telemetry-subscription-ifit] <strong>destination-group ifit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-telemetry-subscription-ifit] <strong>commit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>You are advised to configure devices to send data using a secure TLS encryption mode. For details, see <em>Telemetry Configuration</em>.</p>
</div></div>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0319067886__section_05"><a name="EN-US_TASK_0319067886__section_05"></a><a name="section_05"></a><a name="EN-US_TASK_0319067886__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>PE1 configuration file</p>
<pre class="screen">#
sysname PE1
#                                                                               
ptp enable
ptp domain 1
ptp device-type bc
#
clock source ptp synchronization enable
clock source ptp priority 1
#
ip vpn-instance vpna
 ipv4-family
  route-distinguisher 100:1
  apply-label per-instance
  tnl-policy p1
  vpn-target 111:1 export-extcommunity
  vpn-target 111:1 import-extcommunity
#
mpls lsr-id 1.1.1.9
#               
mpls            
 mpls te
#             
explicit-path pe2
 next sid label 16200 type prefix
 next sid label 16300 type prefix
#               
segment-routing 
#               
isis 1
 is-level level-2
 cost-style wide
 network-entity 10.0000.0000.0001.00
 traffic-eng level-2
 segment-routing mpls
 segment-routing global-block 16000 20000
#               
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown  
 ip binding vpn-instance vpna
 ip address 10.1.1.2 255.255.255.0
 ptp enable
#               
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 172.16.1.1 255.255.255.0
 isis enable 1
 ptp enable
#              
interface LoopBack1
 ip address 1.1.1.9 255.255.255.255
 isis enable 1
 isis prefix-sid absolute 16100 
#               
bgp 100         
 peer 3.3.3.9 as-number 100
 peer 3.3.3.9 connect-interface LoopBack1
 #              
 ipv4-family unicast
  undo synchronization
  peer 3.3.3.9 enable
 #              
 ipv4-family vpnv4
  policy vpn-target
  peer 3.3.3.9 enable
 #              
 ipv4-family vpn-instance vpna
  import-route direct
  peer 10.1.1.1 as-number 65410
#
interface Tunnel1
 ip address unnumbered interface LoopBack1
 tunnel-protocol mpls te
 destination 3.3.3.9
 mpls te signal-protocol segment-routing
 mpls te tunnel-id 1
 mpls te path explicit-path pe2
#
ifit
 node-id 1
 encapsulation nexthop 3.3.3.9
 whitelist-group 1
  rule rule1 ipv4 source 10.11.1.1 32 destination 10.22.2.2 32
 flow-learning vpn-instance vpna
  flow-learning unidirectional
  flow-learning interface all whitelist-group 1
#
tunnel-policy p1
 tunnel select-seq sr-te load-balance-number 1
#
telemetry
 #
 sensor-group ifit
  sensor-path huawei-ifit:ifit/huawei-ifit-statistics:flow-statistics/flow-statistic
 #
 destination-group ifit
  ipv4-address 192.168.100.100 port 10001 protocol grpc
 #
 subscription ifit
  sensor-group ifit sample-interval 0
  destination-group ifit
#
return</pre>
</li><li><p>P configuration file</p>
<pre class="screen">#
sysname P
#                                                                               
ptp enable
ptp domain 1
ptp device-type bc
#
clock source bits0 synchronization enable
clock source bits0 priority 1
clock source ptp synchronization enable
clock source ptp priority 1
clock bits-type bits0 2mhz
#
mpls lsr-id 2.2.2.9
#               
mpls            
 mpls te        
#               
segment-routing 
#               
isis 1
 is-level level-2
 cost-style wide
 network-entity 10.0000.0000.0002.00
 traffic-eng level-2
 segment-routing mpls
 segment-routing global-block 16000 20000
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown  
 ip address 172.16.1.2 255.255.255.0
 isis enable 1 
 ptp enable 
#               
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown  
 ip address 172.17.1.1 255.255.255.0
 isis enable 1
 ptp enable  
# 
interface GigabitEthernet<span>0/3/0</span>                                                  
 undo shutdown                                                                  
 ip address 172.18.1.1 255.255.255.0                                             
 ptp enable
# 
interface LoopBack1
 ip address 2.2.2.9 255.255.255.255
 isis enable 1
 isis prefix-sid absolute 16200 
#
return</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#
sysname PE2
#
ptp enable
ptp domain 1
ptp device-type bc
#
clock source ptp synchronization enable
clock source ptp priority 1
#
ip vpn-instance vpna
 ipv4-family
  route-distinguisher 200:1
  apply-label per-instance
  tnl-policy p1
  vpn-target 111:1 export-extcommunity
  vpn-target 111:1 import-extcommunity
#
mpls lsr-id 3.3.3.9
#               
mpls            
 mpls te  
#
explicit-path pe1
 next sid label 16200 type prefix
 next sid label 16100 type prefix
#               
segment-routing 
#               
isis 1
 is-level level-2
 cost-style wide
 network-entity 10.0000.0000.0003.00
 traffic-eng level-2
 segment-routing mpls
 segment-routing global-block 16000 20000
#               
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown  
 ip binding vpn-instance vpna
 ip address 10.2.1.2 255.255.255.0
 ptp enable
#               
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown  
 ip address 172.17.1.2 255.255.255.0
 isis enable 1  
 ptp enable
#               
interface LoopBack1
 ip address 3.3.3.9 255.255.255.255
 isis enable 1
 isis prefix-sid absolute 16300
#
interface Tunnel1
 ip address unnumbered interface LoopBack1
 tunnel-protocol mpls te
 destination 1.1.1.9
 mpls te signal-protocol segment-routing
 mpls te tunnel-id 1
 mpls te path explicit-path pe1 
#               
bgp 100         
 peer 1.1.1.9 as-number 100
 peer 1.1.1.9 connect-interface LoopBack1
 #              
 ipv4-family unicast
  undo synchronization
  peer 1.1.1.9 enable
 #              
 ipv4-family vpnv4
  policy vpn-target
  peer 1.1.1.9 enable
 #              
 ipv4-family vpn-instance vpna
  import-route direct 
  peer 10.2.1.1 as-number 65420
#
ifit
 node-id 2
#
tunnel-policy p1
 tunnel select-seq sr-te load-balance-number 1
#
telemetry
 #
 sensor-group ifit
  sensor-path huawei-ifit:ifit/huawei-ifit-statistics:flow-statistics/flow-statistic
 #
 destination-group ifit
  ipv4-address 192.168.100.100 port 10001 protocol grpc
 #
 subscription ifit
  sensor-group ifit sample-interval 0
  destination-group ifit
#
return</pre>
</li><li>CE1 configuration file<pre class="screen">#
sysname CE1
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.1.1 255.255.255.0
#
interface LoopBack1
 ip address 10.11.1.1 255.255.255.255
#
bgp 65410
 peer 10.1.1.2 as-number 100
 #
 ipv4-family unicast
  undo synchronization
  peer 10.1.1.2 enable
  network 10.11.1.1 255.255.255.255
#
return</pre>
</li><li>CE2 configuration file<pre class="screen">#
sysname CE2
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.2.1.1 255.255.255.0
#
interface LoopBack1
 ip address 10.22.2.2 255.255.255.255
#
bgp 65420
 peer 10.2.1.2 as-number 100
 #
 ipv4-family unicast
  undo synchronization
  peer 10.2.1.2 enable
  network 10.22.2.2 255.255.255.255
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ifit_cfg_0029.html">Configuration Examples for IFIT Application-Level Quality Measurement
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ifit_cfg_0041.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>
</body>
</html>