
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Collecting Statistics About IPv4 Original Flows">
<meta name="abstract" content="This section provides an example for configuring NetStream traffic statistics collection, helping you rapidly analyze the type and location of abnormal traffic.">
<meta name="description" content="This section provides an example for configuring NetStream traffic statistics collection, helping you rapidly analyze the type and location of abnormal traffic.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ns_cfg_0030.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ns_cfg_0038.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="NetStream">
<meta name="featuretype" content="System Monitor">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="NetStream">
<meta name="featuretype" content="System Monitor">
<meta name="featurename" content="NetStream">
<meta name="featuretype" content="System Monitor">
<meta name="featurename" content="Netstream">
<meta name="featuretype" content="System Monitor">
<meta name="OWNER" content="l00425560">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00799643">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172373022">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Collecting Statistics About IPv4 Original Flows</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172373022"></a><a name="EN-US_TASK_0172373022"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Collecting Statistics About IPv4 Original Flows</h1>
<div class="taskbody"><p>This section provides an example for configuring NetStream traffic statistics collection, helping you rapidly analyze the type and location of abnormal traffic.</p>
<div class="context"><a name="EN-US_TASK_0172373022__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0172373022__fig_dc_vrp_ns_cfg_003101">Figure 1</a>, NetStream is configured to collect statistics about the source IP address, destination IP address, port, and protocol information of network packets on the user side. Such statistics help analyze users' behaviors and detect virus-infected terminals, source and destination of denial of service (DoS) and distributed denial of service (DDoS) attacks, source of spams, and unauthorized websites. Based on other characteristics of NetStream data flows, other network devices can filter out and restrict the spread of virus-infected traffic.</p>
<div class="fignone" id="EN-US_TASK_0172373022__fig_dc_vrp_ns_cfg_003101"><a name="EN-US_TASK_0172373022__fig_dc_vrp_ns_cfg_003101"></a><a name="fig_dc_vrp_ns_cfg_003101"></a><span class="figcap"><b>Figure 1 </b>Network diagram of NetStream traffic statistics collection</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><ul><li>In this example, interfaces 1 and 2 represent GE<span>0/1/0</span> and GE<span>0/2/0</span>, respectively.</li></ul>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_ns_cfg_003101.png" width="NaN" height="NaN"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172373022__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure the PE and CE to communicate.</p>
</li><li><p>Configure NetStream to collect statistics about incoming and outgoing packets on the user-side interface of the PE.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172373022__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>Name of the user-side interface of the PE</p>
</li><li><p>Version for outputting NetStream packets</p>
</li><li><p>Destination address, destination port number, and source address of the output NetStream flows</p>
</li><li><p>ID of the slot in which the NetStream service processing board resides (In this example, the NetStream service processing board is in slot <span>3</span>.)</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172373022__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure the PE and CE to communicate.</span><p><p>Assign an IP address and a mask to each interface according to <a href="#EN-US_TASK_0172373022__fig_dc_vrp_ns_cfg_003101">Figure 1</a>. The configuration details are not provided.</p>
</p></li><li><span>Enable NetStream statistics collection on GE <span>0/1/0</span> of the PE.</span><p><p># Configure the board to process NetStream services in distributed mode.</p>
<pre class="screen">[<span class="keyword">*</span>PE] <strong>slot <span>3</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-slot-<span>3</span>]<strong> ip netstream sampler to slot self</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-slot-<span>3</span>]<strong> quit</strong></pre>
<p># Collect statistics about TCP flags in original flows.</p>
<pre class="screen">[<span class="keyword">*</span>PE]<strong><strong> ip netstream tcp-flag enable</strong></strong></pre>
<p># Set the version for outputting NetStream flows to V5, and specify the source and destination addresses and destination port number for the output flows.</p>
<pre class="screen">[<span class="keyword">*</span>PE]<strong> ip netstream export host 192.168.2.2 9001</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE]<strong> ip netstream export source 192.168.2.1</strong></pre>
<p># Enable NetStream sampling and configure the fixed packet sampling mode.</p>
<pre class="screen">[<span class="keyword">*</span>PE]<strong> ip netstream sampler fix-packets 10000 inbound</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE] <strong>ip netstream sampler fix-packets 10000 outbound</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE] <strong>commit</strong></pre>
<p># Configure NetStream to collect statistics about incoming and outgoing flows on GigabitEthernet <span>0/1/0</span> of the PE.</p>
<pre class="screen">[<span class="keyword">*</span>PE]<strong> interface GigabitEthernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-GigabitEthernet<span>0/1/0</span>]<strong> undo shutdown </strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-GigabitEthernet<span>0/1/0</span>]<strong> ip netstream inbound</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-GigabitEthernet<span>0/1/0</span>]<strong> ip netstream outbound</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-GigabitEthernet<span>0/1/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE] <strong>commit</strong></pre>
<div class="note" id="EN-US_TASK_0172373022__note92331256141010"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0172373022__p7233155631010">NetStream enabled on a main interface cannot collect traffic statistics about its sub-interface.</p>
</div></div>
</p></li><li><span>Verify the configuration.</span><p><p># Run the <a href="cmdqueryname=display+ip+netstream+cache+origin+slot"><b><span class="cmdname">display ip netstream cache origin slot</span></b></a><strong> <span>3</span></strong> command after completing the configuration. The command output shows information about various original flows in the NetStream flow buffer.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE]<strong> display ip netstream cache origin slot <span>3</span></strong>


DstIf                         
 SrcIf                           
 DstP                          Msk          Pro            Tos 
 SrcP                          Msk          Flags          <span>Ttl</span>
 Packets                                                   Bytes
 NextHop                                                   Direction
 DstIP                                                     DstAs
 SrcIP                                                     SrcAs
 BGP: BGP NextHop                                          TopLabelType
 Label1                        Exp1         Bottom1
 Label2                        Exp2         Bottom2
 Label3                        Exp3         Bottom3
 TopLabelIpAddress                          VlanId         VniId
<span> CreateFlowTime                LastRefreshTime</span><span>             VPN</span>(direct)
 FlowLabel                     Rdvalue
 ForwardStatus
  --------------------------------------------------------------------------

 GigabitEthernet<span>0/2/0</span>                                                         
 GigabitEthernet<span>0/1/0</span>                                            
 0                             24            253            0
 0                             24            0              <span>60</span>
 3                                                          384       
 192.168.2.1                                                in
 192.168.1.3                                                0         
 192.168.1.4                                                0         
 0.0.0.0                                                    UNKNOWN             
 0                             0            0         
 0                             0            0         
 0                             0            0         
 0.0.0.0                                    0               0        
<span> 2018-05-09 11:38:07           2018-05-09 11:40:30          --</span>
 --                            -:-
 66(Forwarded Not Fragmented)</pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172373022__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>CE configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname CE</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet <span>0/1/0</span></pre>
<pre class="screen"> ip address 192.168.1.2 255.255.255.0</pre>
<pre class="screen"># </pre>
<pre class="screen">return </pre>
</li><li><p>PE configuration file</p>
<pre class="screen"># </pre>
<pre class="screen">slot <span>3</span></pre>
<pre class="screen"> ip netstream sampler to slot self</pre>
<pre class="screen">#</pre>
<pre class="screen">sysname PE</pre>
<pre class="screen">#</pre>
<pre class="screen">ip netstream tcp-flag enable</pre>
<pre class="screen">ip netstream sampler fix-packets 10000 inbound </pre>
<pre class="screen">ip netstream sampler fix-packets 10000 outbound</pre>
<pre class="screen">ip netstream export source 192.168.2.1</pre>
<pre class="screen">ip netstream export host 192.168.2.2 9001</pre>
<pre class="screen">#</pre>
<pre class="screen">interface gigabitethernet <span>0/2/0</span></pre>
<pre class="screen"> ip address 192.168.2.1 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet <span>0/1/0</span></pre>
<pre class="screen"> ip address 192.168.1.1 255.255.255.0</pre>
<pre class="screen"> ip netstream inbound</pre>
<pre class="screen"> ip netstream outbound</pre>
<pre class="screen"># </pre>
<pre class="screen">return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ns_cfg_0030.html">Configuration Examples for NetStream
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ns_cfg_0038.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>