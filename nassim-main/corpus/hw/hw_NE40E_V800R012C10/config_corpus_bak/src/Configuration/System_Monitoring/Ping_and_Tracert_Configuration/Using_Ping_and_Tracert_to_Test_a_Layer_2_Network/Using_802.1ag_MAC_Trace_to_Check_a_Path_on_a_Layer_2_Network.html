
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Using 802.1ag MAC Trace to Check a Path on a Layer 2 Network">
<meta name="abstract" content="802.1ag MAC trace monitors the connectivity between MEPs or between MEPs and MIPs within an MA and provides information used to locate faults.">
<meta name="description" content="802.1ag MAC trace monitors the connectivity between MEPs or between MEPs and MIPs within an MA and provides information used to locate faults.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ping_cfg_0016.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ping_cfg_0025.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="Ping/Tracert">
<meta name="featuretype" content="System Monitor">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="Ping/Tracert">
<meta name="featuretype" content="System Monitor">
<meta name="featurename" content="Ping/Tracert">
<meta name="featuretype" content="System Monitor">
<meta name="featurename" content="Ping/Tracert">
<meta name="featuretype" content="System Monitor">
<meta name="OWNER" content="l00425560">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="c00511010">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172373187">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Using 802.1ag MAC Trace to Check a Path on a Layer 2 Network</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172373187"></a><a name="EN-US_TASK_0172373187"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Using 802.1ag MAC Trace to Check a Path on a Layer 2 Network</h1>
<div class="taskbody"><p>802.1ag MAC trace monitors the connectivity between MEPs or between MEPs and MIPs within an MA and provides information used to locate faults.</p>
<div class="context"><a name="EN-US_TASK_0172373187__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>Similar to traceroute or tracert, 802.1ag MAC trace tests the path between the local device and a destination device or locates failure points by sending test packets and receiving reply packets.</p>
<p>Before performing 802.1ag MAC trace, ensure that 802.1ag has been configured. For details, see <a href="dc_vrp_cfm_cfg_000004.html">Configuring Basic Ethernet CFM Functions</a>.</p>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172373187__1.4.2"></a><a name="1.4.2"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>A device is usually configured with multiple MDs and MAs. To determine the forwarding path for sending packets from a MEP to another MEP or a MIP in an MA or failure points, perform either of the following operations on the <span class="keyword">Router</span> with a MEP at one end of the link to be tested.</span><p><ul><li><p>In the MA view:</p>
<ol type="a"><li>Run <span><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p>The system view is displayed.</p>
</li><li><p>(Optional) Run <a href="cmdqueryname=cfm+portid-tlv+type"><b><span class="cmdname">cfm portid-tlv type</span></b></a> { <strong><strong><span>interface-name</span></strong></strong> | <strong><strong><span>local</span></strong></strong> }</p>
<p>The portid-tlv type in trace packets is configured.</p>
</li><li>Run the <a href="cmdqueryname=cfm+enable"><b><span class="cmdname">cfm enable</span></b></a> command to globally enable the CFM function on the device.</li><li>Run <span><a href="cmdqueryname=cfm+md"><b><span class="cmdname">cfm md</span></b></a> <i><span class="varname">md-name</span></i></span><p>The MD view is displayed.</p>
</li><li>Run <span><a href="cmdqueryname=ma"><b><span class="cmdname">ma</span></b></a> <i><span class="varname">ma-name</span></i></span><p>The MA view is displayed.</p>
</li><li>Run the <a href="cmdqueryname=trace+mac-8021ag"><b><span class="cmdname">trace mac-8021ag</span></b></a> <strong><span>mep</span></strong> <strong><span>mep-id</span></strong> <i><span class="varname">mep-id</span></i> [ <strong><span>md</span></strong> <i><span class="varname">md-name</span></i> <strong><span>ma</span></strong> <i><span class="varname">ma-name</span></i> ] { <strong><span>mac</span></strong> <i><span class="varname">mac-address</span></i> | <strong><span>remote-mep</span></strong> <strong><span>mep-id</span></strong> <i><span class="varname">mep-id</span></i> } [ <strong><span>-t</span></strong> <i><span class="varname">timeout</span></i> | <strong><span>ttl</span></strong> <i><span class="varname">ttl</span></i> ] <sup>*</sup> command to locate the connectivity fault between the local and peer devices.<ul><li><p>Run the <b><span class="cmdname">trace mac-8021ag</span></b> command without <strong><span>md</span></strong> <i><span class="varname">md-name</span></i> <strong><span>ma</span></strong> <i><span class="varname">ma-name</span></i> specified in the MA view to monitor a forwarding path or locate a failure point in the current MA.</p>
</li><li><p>Run the <b><span class="cmdname">trace mac-8021ag</span></b> <strong><span>md</span></strong> <i><span class="varname">md-name</span></i> <strong><span>ma</span></strong> <i><span class="varname">ma-name</span></i> command in the MA view to monitor a forwarding path or locate a failure point in the specified MA.</p>
<p>An example is as follows:</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong> 
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>cfm enable</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>cfm md md1</strong> 
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-md-md1] <strong>ma ma1</strong> 
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-md-md1-ma-ma1] <strong>trace mac-8021ag mep mep-id 1 md md1 ma ma1 remote-mep mep-id 8</strong>
Tracing the route to 00e0-fc12-3458 over a maximum of 64 hops: 
 Hops  Ingress Mac    Ingress Port                Ingress Action    Relay Action
       Egress Mac     Egress Port                 Egress Action     Ismep 
 1     00e0-fc23-3459 GigabitEthernet<span>0/1/1</span>        IngOK             RlyFDB
       00e0-fc22-3459 GigabitEthernet<span>0/1/2</span>        EgrOK             NoMep 
 2     --             --                          --                RlyHit
       00e0-fc12-3458 GigabitEthernet<span>0/1/3</span>        EgrOK             IsMep 
Info: Succeeded in tracing the destination address 00e0-fc12-3458. </pre>
</li></ul>
</li></ol>
</li><li><p>In all views except the MA view:</p>
<ol type="a"><li>(Optional) Run <a href="cmdqueryname=cfm+portid-tlv+type"><b><span class="cmdname">cfm portid-tlv type</span></b></a> { <strong>interface-name</strong> | <strong>local</strong> }<p>The portid-tlv type for trace packets is set.</p>
</li><li>Run <span><b><span class="cmdqueryname"></span></b><strong><span></span></strong><strong><span></span></strong><i><span class="varname"></span></i><strong><span></span></strong><i><span class="varname"></span></i><strong><span></span></strong><i><span class="varname"></span></i><strong><span></span></strong><i><span class="varname"></span></i><strong><span></span></strong><strong><span></span></strong><i><span class="varname"></span></i><strong><span></span></strong><i><span class="varname"></span></i><strong><span></span></strong><i><span class="varname"></span></i><sup></sup><a href="cmdqueryname=trace+mac-8021ag"><b><span class="cmdname">trace mac-8021ag</span></b></a> <strong><span>mep</span></strong> <strong><span>mep-id</span></strong> <i><span class="varname">mep-id</span></i> <strong><span>md</span></strong> <i><span class="varname">md-name</span></i> <strong><span>ma</span></strong> <i><span class="varname">ma-name</span></i> { <strong><span>mac</span></strong> <i><span class="varname">mac-address</span></i> | <strong><span>remote-mep</span></strong> <strong><span>mep-id</span></strong> <i><span class="varname">mep-id</span></i> } [ <strong><span>-t</span></strong> <i><span class="varname">timeout</span></i> | <strong><span>ttl</span></strong> <i><span class="varname">ttl</span></i> ] *</span><p>The connectivity fault between the local and the remote devices is located.</p>
</li></ol>
</li></ul>
<p>When implementing 802.1ag MAC trace, ensure that:</p>
<ul><li><p>The MEP is configured in the MA.</p>
</li><li><p>If the destination node is an RMEP, either <strong><span>mac</span></strong> <i><span class="varname">mac-address</span></i> or <strong><span>remote-mep</span></strong> <strong><span>mep-id</span></strong> <i><span class="varname">mep-id</span></i> can be specified. If <strong><span>remote-mep</span></strong> <strong><span>mep-id</span></strong> <i><span class="varname">mep-id</span></i> is selected, the RMEP must already be created using the <a href="cmdqueryname=remote-mep"><b><span class="cmdname">remote-mep</span></b></a> command.</p>
</li><li><p>If the destination node is a MIP, select <strong><span>mac</span></strong> <i><span class="varname">mac-address</span></i>.</p>
</li><li><p>If the forwarding entry of the destination node does not exist in the MAC address table, <strong><span>interface</span></strong> <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i> must be specified.</p>
</li></ul>
</p></li><li><span>(Optional) Run the <a href="cmdqueryname=display+cfm+statistics+lblt"><b><span class="cmdname">display cfm statistics lblt</span></b></a> command to check 802.1ag protocol packet statistics.</span><p><p>If the test using the <a href="cmdqueryname=trace+mac-8021ag"><b><span class="cmdname">trace mac-8021ag</span></b></a> command fails, you can run this command to check whether a link fault or a device fault occurs.</p>
</p></li><li><span>(Optional) Run the <a href="cmdqueryname=reset+cfm+statistics+lblt"><b><span class="cmdname">reset cfm statistics lblt</span></b></a> command to clear the 802.1ag protocol packet statistics.</span></li></ol></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ping_cfg_0016.html">Using Ping/Tracert to Test a Layer 2 Network
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ping_cfg_0025.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>
</body>
</html>