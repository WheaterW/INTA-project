
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring DSCP-based Path Detection on a VXLAN Network">
<meta name="abstract" content="This section uses an IPv4 NFVI distributed gateway as an example to describe how to implement DSCP-based path detection on a VXLAN network.">
<meta name="description" content="This section uses an IPv4 NFVI distributed gateway as an example to describe how to implement DSCP-based path detection on a VXLAN network.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cfg_path-detect_0006.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="Path Detect">
<meta name="featuretype" content="System Monitor">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="Path Detect">
<meta name="featuretype" content="System Monitor">
<meta name="featurename" content="Path Detect">
<meta name="featuretype" content="System Monitor">
<meta name="featurename" content="Path Detect">
<meta name="featuretype" content="System Monitor">
<meta name="OWNER" content="c00511010">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="j00923990">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0253270076">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>Example for Configuring DSCP-based Path Detection on a VXLAN Network</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0253270076"></a><a name="EN-US_TASK_0253270076"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring DSCP-based Path Detection on a VXLAN Network</h1>
<div class="taskbody"><p>This section uses an IPv4 NFVI distributed gateway as an example to describe how to implement DSCP-based path detection on a VXLAN network.</p>
<div class="context"><a name="EN-US_TASK_0253270076__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>The NFVI telco cloud solution is based on Data Center Interconnect (DCI) + data center network (DCN) networking, as shown in <a href="#EN-US_TASK_0253270076__fig_01">Figure 1</a>.</p>
<ul><li>DCGWs are the DCN's border gateways and can exchange Internet routes with the external network.</li><li>L2GW/L3GW1 and L2GW/L3GW2 access the virtualized network functions (VNFs).</li><li>VNF1 and VNF2 can be deployed as virtualized NEs to implement the vUGW and vMSE functions and connect to L2GW/L3GW1 and L2GW/L3GW2 through the interface processing unit (IPU).</li></ul>
<p>Assume that the detected path is DCGW2 -&gt; L2GW/L3GW2 -&gt; VNF2. DSCP-based IPv4 path detection is enabled on all devices along the path, and a detection packet is constructed and forwarded on DCGW2 (ingress).</p>
<p>Generally, the <span class="keyword">NE40E</span> is used as the DCGW for path detection.</p>
<div class="fignone" id="EN-US_TASK_0253270076__fig_01"><a name="EN-US_TASK_0253270076__fig_01"></a><a name="fig_01"></a><span class="figcap"><b>Figure 1 </b>Configuring DSCP-based path detection in IPv4 NFVI distributed gateway networking</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 through 5 in this example represent GE<span>0/1/1</span>, GE<span>0/1/2</span>, GE<span>0/1/3</span>, GE<span>0/1/4</span>, and GE<span>0/1/5</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0253408691.png" width="NaN" height="NaN"></span></div>

<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" frame="border" border="1" rules="all"><caption><b>Table 1 </b>IP addresses of interfaces</caption><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="12.62126212621262%" id="mcps1.4.1.7.2.4.1.1" liSelected="liSelected"><p>Device Name</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="43.85438543854385%" id="mcps1.4.1.7.2.4.1.2" liSelected="liSelected"><p>Interface</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="43.52435243524352%" id="mcps1.4.1.7.2.4.1.3" liSelected="liSelected"><p>IP Address</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" rowspan="6" valign="top" width="12.62126212621262%" headers="mcps1.4.1.7.2.4.1.1 "><p>DCGW1</p>
</td>
<td class="cellrowborder" valign="top" width="43.85438543854385%" headers="mcps1.4.1.7.2.4.1.2 "><p>GigabitEthernet <span>0/1/1</span></p>
</td>
<td class="cellrowborder" valign="top" width="43.52435243524352%" headers="mcps1.4.1.7.2.4.1.3 "><p>10.6.1.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.7.2.4.1.2 "><p>GigabitEthernet <span>0/1/2</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.7.2.4.1.3 "><p>10.6.2.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.7.2.4.1.2 "><p>GigabitEthernet<span>0/1/3</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.7.2.4.1.3 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.7.2.4.1.2 "><p>LoopBack0</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.7.2.4.1.3 "><p>9.9.9.9/32</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.7.2.4.1.2 "><p>LoopBack1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.7.2.4.1.3 "><p>3.3.3.3/32</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.7.2.4.1.2 "><p>LoopBack2</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.7.2.4.1.3 "><p>33.33.33.33/32</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="6" valign="top" width="12.62126212621262%" headers="mcps1.4.1.7.2.4.1.1 "><p>DCGW2</p>
</td>
<td class="cellrowborder" valign="top" width="43.85438543854385%" headers="mcps1.4.1.7.2.4.1.2 "><p>GigabitEthernet <span>0/1/1</span></p>
</td>
<td class="cellrowborder" valign="top" width="43.52435243524352%" headers="mcps1.4.1.7.2.4.1.3 "><p>10.6.1.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.7.2.4.1.2 "><p>GigabitEthernet <span>0/1/2</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.7.2.4.1.3 "><p>10.6.3.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.7.2.4.1.2 "><p>GigabitEthernet<span>0/1/3</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.7.2.4.1.3 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.7.2.4.1.2 "><p>LoopBack0</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.7.2.4.1.3 "><p>9.9.9.9/32</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.7.2.4.1.2 "><p>LoopBack1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.7.2.4.1.3 "><p>4.4.4.4/32</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.7.2.4.1.2 "><p>LoopBack2</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.7.2.4.1.3 "><p>44.44.44.44/32</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="6" valign="top" width="12.62126212621262%" headers="mcps1.4.1.7.2.4.1.1 "><p>L2GW/L3GW1</p>
</td>
<td class="cellrowborder" valign="top" width="43.85438543854385%" headers="mcps1.4.1.7.2.4.1.2 "><p>GigabitEthernet <span>0/1/1</span></p>
</td>
<td class="cellrowborder" valign="top" width="43.52435243524352%" headers="mcps1.4.1.7.2.4.1.3 "><p>10.6.4.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.7.2.4.1.2 "><p>GigabitEthernet <span>0/1/2</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.7.2.4.1.3 "><p>10.6.2.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.7.2.4.1.2 "><p>GigabitEthernet <span>0/1/3</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.7.2.4.1.3 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.7.2.4.1.2 "><p>GigabitEthernet <span>0/1/4</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.7.2.4.1.3 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.7.2.4.1.2 "><p>GigabitEthernet <span>0/1/5</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.7.2.4.1.3 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.7.2.4.1.2 "><p>LoopBack1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.7.2.4.1.3 "><p>1.1.1.1/32</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="5" valign="top" width="12.62126212621262%" headers="mcps1.4.1.7.2.4.1.1 "><p>L2GW/L3GW2</p>
</td>
<td class="cellrowborder" valign="top" width="43.85438543854385%" headers="mcps1.4.1.7.2.4.1.2 "><p>GigabitEthernet <span>0/1/1</span></p>
</td>
<td class="cellrowborder" valign="top" width="43.52435243524352%" headers="mcps1.4.1.7.2.4.1.3 "><p>10.6.4.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.7.2.4.1.2 "><p>GigabitEthernet <span>0/1/2</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.7.2.4.1.3 "><p>10.6.3.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.7.2.4.1.2 "><p>GigabitEthernet <span>0/1/3</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.7.2.4.1.3 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.7.2.4.1.2 "><p>GigabitEthernet <span>0/1/4</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.7.2.4.1.3 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.7.2.4.1.2 "><p>LoopBack1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.7.2.4.1.3 "><p>2.2.2.2/32</p>
</td>
</tr>
</tbody>
</table>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0253270076__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li>Assign an IP address to each device interface, including the loopback interfaces.</li><li>Configure a routing protocol on each DCGW and each L2GW/L3GW to ensure Layer 3 communication. OSPF is used in this example.</li><li>Configure IPv4 NFVI distributed gateway networking on DCGWs and L2GWs/L3GWs.</li><li>Configure DSCP-based IPv4 path detection on DCGW2 and L2GW/L3GW2.</li><li>Configure DCGW2 to construct and forward IPv4 detection packets.</li></ol>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Before the configuration, ensure that a NETCONF connection has been established between the controller and device.</p>
</div></div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0253270076__1.4.3"></a><a name="1.4.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Assign an IP address to each device interface, including the loopback interfaces.</span><p><p>For configuration details, see <a href="#EN-US_TASK_0253270076__dc_vrp_evpn_cfg_010701">Configuration Files</a>.</p>
</p></li><li><span>Configure a routing protocol on each DCGW and each L2GW/L3GW to ensure Layer 3 communication. OSPF is used in this example.</span><p><p>For configuration details, see <a href="#EN-US_TASK_0253270076__dc_vrp_evpn_cfg_010701">Configuration Files</a>.</p>
</p></li><li><span>Configure IPv4 NFVI distributed gateway networking on DCGWs and L2GWs/L3GWs.</span><p><p>For the configuration roadmap, see <a href="../vrp/dc_vrp_vxlan_cfg_1082.html">VXLAN Configuration</a>. For configuration details, see <a href="#EN-US_TASK_0253270076__dc_vrp_evpn_cfg_010701">Configuration Files</a>.</p>
</p></li><li><span>Configure DSCP-based IPv4 path detection on DCGW2 and L2GW/L3GW2.</span><p><p># Configure DCGW2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DCGW2] <strong>ip path detection</strong> <strong>enable</strong> <strong>dscp 3</strong></pre>
<p># Configure L2GW/L3GW2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>L2GW/L3GW2] <strong>ip path detection</strong> <strong>enable</strong> <strong>dscp 3</strong></pre>
</p></li><li><span>Configure DCGW2 to construct and forward IPv4 detection packets.</span><p><pre class="screen">[<span class="keyword">*</span>DCGW2] <strong>ip path detection send-packet src-mac 00e0-fc12-3456 dst-mac 00e0-fc12-7890 pe-vlan 10 src-ip 10.1.1.1 dst-ip 10.2.2.2 protocol udp src-port 1000 dst-port 2000 dscp 3 vpn-instance vpn1 interface GigabitEthernet<span>0/1/3</span> testid 2</strong></pre>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0253270076__dc_vrp_evpn_cfg_010701"><a name="EN-US_TASK_0253270076__dc_vrp_evpn_cfg_010701"></a><a name="dc_vrp_evpn_cfg_010701"></a><a name="EN-US_TASK_0253270076__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>DCGW1 configuration file</p>
<pre class="screen">#
sysname DCGW1
#
evpn
 bypass-vxlan enable
#
evpn vpn-instance evrf1 bd-mode
 route-distinguisher 1:1
 vpn-target 1:1 export-extcommunity
 vpn-target 1:1 import-extcommunity
#
evpn vpn-instance evrf2 bd-mode
 route-distinguisher 2:2
 vpn-target 2:2 export-extcommunity
 vpn-target 2:2 import-extcommunity
#
evpn vpn-instance evrf3 bd-mode
 route-distinguisher 3:3
 vpn-target 3:3 export-extcommunity
 vpn-target 3:3 import-extcommunity
#
evpn vpn-instance evrf4 bd-mode
 route-distinguisher 4:4
 vpn-target 4:4 export-extcommunity
 vpn-target 4:4 import-extcommunity
#
ip vpn-instance vpn1
 ipv4-family
  route-distinguisher 11:11
<span>  apply-label per-instance</span>
  export route-policy dp evpn
  vpn-target 11:1 export-extcommunity evpn
  vpn-target 11:1 import-extcommunity evpn
 vxlan vni 200  
#
bridge-domain 10
 vxlan vni 100 split-horizon-mode
 evpn binding vpn-instance evrf1
#
bridge-domain 20
 vxlan vni 110 split-horizon-mode
 evpn binding vpn-instance evrf2
#
bridge-domain 30
 vxlan vni 120 split-horizon-mode
 evpn binding vpn-instance evrf3
#
bridge-domain 40
 vxlan vni 130 split-horizon-mode
 evpn binding vpn-instance evrf4
#
interface Vbdif10
 ip binding vpn-instance vpn1
 ip address 10.1.1.1 255.255.255.0
 arp generate-rd-table enable
 mac-address 00e0-fc00-0002
 vxlan anycast-gateway enable
#
interface Vbdif20
 ip binding vpn-instance vpn1
 ip address 10.2.1.1 255.255.255.0
 arp generate-rd-table enable
 mac-address 00e0-fc00-0003
 vxlan anycast-gateway enable
#
interface Vbdif30
 ip binding vpn-instance vpn1
 ip address 10.3.1.1 255.255.255.0
 arp generate-rd-table enable
 mac-address 00e0-fc00-0001
 vxlan anycast-gateway enable
#
interface Vbdif40
 ip binding vpn-instance vpn1
 ip address 10.4.1.1 255.255.255.0
 arp generate-rd-table enable
 mac-address 00e0-fc00-0004
 vxlan anycast-gateway enable
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 10.6.1.1 255.255.255.0 
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ip address 10.6.2.1 255.255.255.0
#
interface GigabitEthernet<span>0/1/3</span>
 undo shutdown
#
interface GigabitEthernet<span>0/1/3</span>.1 mode l2
  encapsulation dot1q vid 20
  rewrite pop single
  bridge-domain 20
# 
interface GigabitEthernet<span>0/1/3</span>.2 mode l2
  encapsulation dot1q vid 40
  rewrite pop single
  bridge-domain 40
#
interface LoopBack0
 ip address 9.9.9.9 255.255.255.255
#
interface LoopBack1
 ip address 3.3.3.3 255.255.255.255
#
interface LoopBack2
 ip binding vpn-instance vpn1
 ip address 33.33.33.33 255.255.255.255
#
interface Nve1
 source 9.9.9.9
 bypass source 3.3.3.3
 mac-address 00e0-fc00-0009
 vni 100 head-end peer-list protocol bgp
 vni 110 head-end peer-list protocol bgp
 vni 120 head-end peer-list protocol bgp
 vni 130 head-end peer-list protocol bgp
#
bgp 100
 peer 1.1.1.1 as-number 100
 peer 1.1.1.1 connect-interface LoopBack1
 peer 2.2.2.2 as-number 100
 peer 2.2.2.2 connect-interface LoopBack1
 peer 4.4.4.4 as-number 100
 peer 4.4.4.4 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 1.1.1.1 enable
  peer 2.2.2.2 enable
  peer 4.4.4.4 enable
 #
 ipv4-family vpn-instance vpn1
  network 0.0.0.0 0
  import-route direct
  maximum load-balancing 16  
  advertise l2vpn evpn
  peer 5.5.5.5 as-number 100
  peer 5.5.5.5 connect-interface LoopBack2
  peer 5.5.5.5 route-policy p1 export
  peer 6.6.6.6 as-number 100
  peer 6.6.6.6 connect-interface LoopBack2
  peer 6.6.6.6 route-policy p1 export
 #
 l2vpn-family evpn
  undo policy vpn-target
  peer 1.1.1.1 enable
  peer 1.1.1.1 capability-advertise add-path both
  peer 1.1.1.1 advertise add-path path-number 16
  peer 1.1.1.1 advertise encap-type vxlan
  peer 2.2.2.2 enable
  peer 2.2.2.2 capability-advertise add-path both
  peer 2.2.2.2 advertise add-path path-number 16
  peer 2.2.2.2 advertise encap-type vxlan
  peer 4.4.4.4 enable
  peer 4.4.4.4 advertise encap-type vxlan
  peer 4.4.4.4 route-policy stopuIP export
#
ospf 1
 area 0.0.0.0
  network 3.3.3.3 0.0.0.0
  network 9.9.9.9 0.0.0.0
  network 10.6.1.0 0.0.0.255
  network 10.6.2.0 0.0.0.255
#
ip ip-prefix lp index 10 permit 33.33.33.33 32
ip ip-prefix uIP index 10 permit 10.10.10.10 32
#
route-policy dp permit node 10
 if-match tag 2000
#
route-policy dp permit node 15
 if-match ip-prefix lp
#
route-policy dp deny node 20
#
route-policy p1 deny node 10
#
route-policy stopuIP deny node 10
 if-match ip-prefix uIP
#
route-policy stopuIP permit node 20
#
ip route-static vpn-instance vpn1 0.0.0.0 0.0.0.0 NULL0 tag 2000
#
return</pre>
</li><li><p>DCGW2 configuration file</p>
<pre class="screen">#
sysname DCGW2
#
evpn
 bypass-vxlan enable
#
evpn vpn-instance evrf1 bd-mode
 route-distinguisher 1:1
 vpn-target 1:1 export-extcommunity
 vpn-target 1:1 import-extcommunity
#
evpn vpn-instance evrf2 bd-mode
 route-distinguisher 2:2
 vpn-target 2:2 export-extcommunity
 vpn-target 2:2 import-extcommunity
#
evpn vpn-instance evrf3 bd-mode
 route-distinguisher 3:3
 vpn-target 3:3 export-extcommunity
 vpn-target 3:3 import-extcommunity
#
evpn vpn-instance evrf4 bd-mode
 route-distinguisher 4:4
 vpn-target 4:4 export-extcommunity
 vpn-target 4:4 import-extcommunity
#
ip vpn-instance vpn1
 ipv4-family
  route-distinguisher 11:11
<span>  apply-label per-instance</span>
  export route-policy dp evpn
  vpn-target 11:1 export-extcommunity evpn
  vpn-target 11:1 import-extcommunity evpn
 vxlan vni 200  
#
bridge-domain 10
 vxlan vni 100 split-horizon-mode
 evpn binding vpn-instance evrf1
#
bridge-domain 20
 vxlan vni 110 split-horizon-mode
 evpn binding vpn-instance evrf2
#
bridge-domain 30
 vxlan vni 120 split-horizon-mode
 evpn binding vpn-instance evrf3
#
bridge-domain 40
 vxlan vni 130 split-horizon-mode
 evpn binding vpn-instance evrf4
#
interface Vbdif10
 ip binding vpn-instance vpn1
 ip address 10.1.1.1 255.255.255.0
 arp generate-rd-table enable
 mac-address 00e0-fc00-0002
 vxlan anycast-gateway enable
#
interface Vbdif20
 ip binding vpn-instance vpn1
 ip address 10.2.1.1 255.255.255.0
 arp generate-rd-table enable
 mac-address 00e0-fc00-0003
 vxlan anycast-gateway enable
#
interface Vbdif30
 ip binding vpn-instance vpn1
 ip address 10.3.1.1 255.255.255.0
 arp generate-rd-table enable
 mac-address 00e0-fc00-0001
 vxlan anycast-gateway enable
#
interface Vbdif40
 ip binding vpn-instance vpn1
 ip address 10.4.1.1 255.255.255.0
 arp generate-rd-table enable
 mac-address 00e0-fc00-0004
 vxlan anycast-gateway enable
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 10.6.1.2 255.255.255.0
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ip address 10.6.3.1 255.255.255.0
#
interface GigabitEthernet<span>0/1/3</span>
 undo shutdown
#
interface GigabitEthernet<span>0/1/3</span>.1 mode l2
  encapsulation dot1q vid 10
  rewrite pop single
  bridge-domain 10 
# 
interface GigabitEthernet<span>0/1/3</span>.2 mode l2
  encapsulation dot1q vid 30
  rewrite pop single
  bridge-domain 30
#
interface LoopBack0
 ip address 9.9.9.9 255.255.255.255
#
interface LoopBack1
 ip address 4.4.4.4 255.255.255.255
#
interface LoopBack2
 ip binding vpn-instance vpn1
 ip address 44.44.44.44 255.255.255.255
#
interface Nve1
 source 9.9.9.9
 bypass source 4.4.4.4
 mac-address 00e0-fc00-0009
 vni 100 head-end peer-list protocol bgp
 vni 110 head-end peer-list protocol bgp
 vni 120 head-end peer-list protocol bgp
 vni 130 head-end peer-list protocol bgp
#
bgp 100
 peer 1.1.1.1 as-number 100
 peer 1.1.1.1 connect-interface LoopBack1
 peer 2.2.2.2 as-number 100
 peer 2.2.2.2 connect-interface LoopBack1
 peer 3.3.3.3 as-number 100
 peer 3.3.3.3 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 1.1.1.1 enable
  peer 2.2.2.2 enable
  peer 3.3.3.3 enable
 #
 ipv4-family vpn-instance vpn1
  network 0.0.0.0 0
  import-route direct
  maximum load-balancing 16  
  advertise l2vpn evpn
  peer 5.5.5.5 as-number 100
  peer 5.5.5.5 connect-interface LoopBack2
  peer 5.5.5.5 route-policy p1 export
  peer 6.6.6.6 as-number 100
  peer 6.6.6.6 connect-interface LoopBack2
  peer 6.6.6.6 route-policy p1 export
 #
 l2vpn-family evpn
  undo policy vpn-target
  peer 1.1.1.1 enable
  peer 1.1.1.1 capability-advertise add-path both
  peer 1.1.1.1 advertise add-path path-number 16
  peer 1.1.1.1 advertise encap-type vxlan
  peer 2.2.2.2 enable
  peer 2.2.2.2 capability-advertise add-path both
  peer 2.2.2.2 advertise add-path path-number 16
  peer 2.2.2.2 advertise encap-type vxlan
  peer 3.3.3.3 enable
  peer 3.3.3.3 advertise encap-type vxlan
  peer 3.3.3.3 route-policy stopuIP export
#
ospf 1
 area 0.0.0.0
  network 4.4.4.4 0.0.0.0
  network 9.9.9.9 0.0.0.0
  network 10.6.1.0 0.0.0.255
  network 10.6.3.0 0.0.0.255
#
ip ip-prefix lp index 10 permit 44.44.44.44 32
ip ip-prefix uIP index 10 permit 10.10.10.10 32
#
route-policy dp permit node 10
 if-match tag 2000
#
route-policy dp permit node 15
 if-match ip-prefix lp
#
route-policy dp deny node 20
#
route-policy p1 deny node 10
#
route-policy stopuIP deny node 10
 if-match ip-prefix uIP
#
route-policy stopuIP permit node 20
#
ip route-static vpn-instance vpn1 0.0.0.0 0.0.0.0 NULL0 tag 2000
#
ip path detection enable dscp 3
#
return</pre>
</li><li><p>L2GW/L3GW1 configuration file</p>
<pre class="screen">#
sysname L2GW/L3GW1
#
evpn vpn-instance evrf1 bd-mode
 route-distinguisher 1:1
 vpn-target 1:1 export-extcommunity
 vpn-target 1:1 import-extcommunity
#
evpn vpn-instance evrf2 bd-mode
 route-distinguisher 2:2
 vpn-target 2:2 export-extcommunity
 vpn-target 2:2 import-extcommunity
#
evpn vpn-instance evrf3 bd-mode
 route-distinguisher 3:3
 vpn-target 3:3 export-extcommunity
 vpn-target 3:3 import-extcommunity
#
evpn vpn-instance evrf4 bd-mode
 route-distinguisher 4:4
 vpn-target 4:4 export-extcommunity
 vpn-target 4:4 import-extcommunity
#
ip vpn-instance vpn1
 ipv4-family
  route-distinguisher 11:11
<span>  apply-label per-instance</span>
  export route-policy sp evpn
  vpn-target 11:1 export-extcommunity evpn
  vpn-target 11:1 import-extcommunity evpn
 vxlan vni 200
#
bridge-domain 10
 vxlan vni 100 split-horizon-mode
 evpn binding vpn-instance evrf1
#
bridge-domain 20
 vxlan vni 110 split-horizon-mode
 evpn binding vpn-instance evrf2
#
bridge-domain 30
 vxlan vni 120 split-horizon-mode
 evpn binding vpn-instance evrf3
#
bridge-domain 40
 vxlan vni 130 split-horizon-mode
 evpn binding vpn-instance evrf4
#
interface Vbdif10
 ip binding vpn-instance vpn1
 ip address 10.1.1.1 255.255.255.0
 arp generate-rd-table enable
 mac-address 00e0-fc00-0002
 vxlan anycast-gateway enable
 arp collect host enable
#
interface Vbdif20
 ip binding vpn-instance vpn1
 ip address 10.2.1.1 255.255.255.0
 arp generate-rd-table enable
 mac-address 00e0-fc00-0003
 vxlan anycast-gateway enable
 arp collect host enable
#
interface Vbdif30
 ip binding vpn-instance vpn1
 ip address 10.3.1.1 255.255.255.0
 arp generate-rd-table enable
 mac-address 00e0-fc00-0001
 vxlan anycast-gateway enable
 arp collect host enable
#
interface Vbdif40
 ip binding vpn-instance vpn1
 ip address 10.4.1.1 255.255.255.0
 arp generate-rd-table enable
 mac-address 00e0-fc00-0004
 vxlan anycast-gateway enable
 arp collect host enable
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 10.6.4.1 255.255.255.0
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ip address 10.6.2.2 255.255.255.0
#
interface GigabitEthernet<span>0/1/3</span>.1 mode l2
 encapsulation dot1q vid 10
 rewrite pop single
 bridge-domain 10
#
interface GigabitEthernet<span>0/1/4</span>.1 mode l2
 encapsulation dot1q vid 20
 rewrite pop single
 bridge-domain 20
#
interface GigabitEthernet<span>0/1/5</span>.1 mode l2
 encapsulation dot1q vid 10
 rewrite pop single
 bridge-domain 10
#
interface LoopBack1
 ip address 1.1.1.1 255.255.255.255
#
interface Nve1
 source 1.1.1.1
 vni 100 head-end peer-list protocol bgp
 vni 110 head-end peer-list protocol bgp
 vni 120 head-end peer-list protocol bgp
 vni 130 head-end peer-list protocol bgp
#
bgp 100
 peer 2.2.2.2 as-number 100
 peer 2.2.2.2 connect-interface LoopBack1
 peer 3.3.3.3 as-number 100
 peer 3.3.3.3 connect-interface LoopBack1
 peer 4.4.4.4 as-number 100
 peer 4.4.4.4 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 2.2.2.2 enable
  peer 3.3.3.3 enable
  peer 4.4.4.4 enable
 #
 ipv4-family vpn-instance vpn1
  import-route static
  maximum load-balancing 16  
  advertise l2vpn evpn import-route-multipath
 #
 l2vpn-family evpn
  undo policy vpn-target
  bestroute add-path path-number 16
  peer 2.2.2.2 enable
  peer 2.2.2.2 advertise arp
  peer 2.2.2.2 advertise encap-type vxlan
  peer 3.3.3.3 enable
  peer 3.3.3.3 advertise arp
  peer 3.3.3.3 capability-advertise add-path both
  peer 3.3.3.3 advertise add-path path-number 16
  peer 3.3.3.3 advertise encap-type vxlan
  peer 4.4.4.4 enable
  peer 4.4.4.4 advertise arp
  peer 4.4.4.4 capability-advertise add-path both
  peer 4.4.4.4 advertise add-path path-number 16
  peer 4.4.4.4 advertise encap-type vxlan
#
ospf 1
 area 0.0.0.0
  network 1.1.1.1 0.0.0.0
  network 10.6.2.0 0.0.0.255
  network 10.6.4.0 0.0.0.255
#
route-policy sp permit node 10
 if-match tag 1000
 apply gateway-ip origin-nexthop
#
route-policy sp deny node 20
#
ip route-static vpn-instance vpn1 5.5.5.5 255.255.255.255 10.1.1.2 tag 1000
ip route-static vpn-instance vpn1 5.5.5.5 255.255.255.255 10.2.1.2 tag 1000
ip route-static vpn-instance vpn1 6.6.6.6 255.255.255.255 10.1.1.3 tag 1000
#
return</pre>
</li><li><p>L2GW/L3GW2 configuration file</p>
<pre class="screen">#
sysname L2GW/L3GW2
#
evpn vpn-instance evrf1 bd-mode
 route-distinguisher 1:1
 vpn-target 1:1 export-extcommunity
 vpn-target 1:1 import-extcommunity
#
evpn vpn-instance evrf2 bd-mode
 route-distinguisher 2:2
 vpn-target 2:2 export-extcommunity
 vpn-target 2:2 import-extcommunity
#
evpn vpn-instance evrf3 bd-mode
 route-distinguisher 3:3
 vpn-target 3:3 export-extcommunity
 vpn-target 3:3 import-extcommunity
#
evpn vpn-instance evrf4 bd-mode
 route-distinguisher 4:4
 vpn-target 4:4 export-extcommunity
 vpn-target 4:4 import-extcommunity
#
ip vpn-instance vpn1
 ipv4-family
  route-distinguisher 11:11
<span>  apply-label per-instance</span>
  export route-policy sp evpn
  vpn-target 11:1 export-extcommunity evpn
  vpn-target 11:1 import-extcommunity evpn
 vxlan vni 200
#
bridge-domain 10
 vxlan vni 100 split-horizon-mode
 evpn binding vpn-instance evrf1
#
bridge-domain 20
 vxlan vni 110 split-horizon-mode
 evpn binding vpn-instance evrf2
#
bridge-domain 30
 vxlan vni 120 split-horizon-mode
 evpn binding vpn-instance evrf3
#
bridge-domain 40
 vxlan vni 130 split-horizon-mode
 evpn binding vpn-instance evrf4
#
interface Vbdif10
 ip binding vpn-instance vpn1
 ip address 10.1.1.1 255.255.255.0
 arp generate-rd-table enable
 mac-address 00e0-fc00-0002
 vxlan anycast-gateway enable
 arp collect host enable
#
interface Vbdif20
 ip binding vpn-instance vpn1
 ip address 10.2.1.1 255.255.255.0
 arp generate-rd-table enable
 mac-address 00e0-fc00-0003
 vxlan anycast-gateway enable
 arp collect host enable
#
interface Vbdif30
 ip binding vpn-instance vpn1
 ip address 10.3.1.1 255.255.255.0
 arp generate-rd-table enable
 mac-address 00e0-fc00-0001
 vxlan anycast-gateway enable
 arp collect host enable
#
interface Vbdif40
 ip binding vpn-instance vpn1
 ip address 10.4.1.1 255.255.255.0
 arp generate-rd-table enable
 mac-address 00e0-fc00-0004
 vxlan anycast-gateway enable
 arp collect host enable
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 10.6.4.2 255.255.255.0
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ip address 10.6.3.2 255.255.255.0
#
interface GigabitEthernet<span>0/1/3</span>.1 mode l2
 encapsulation dot1q vid 30
 rewrite pop single
 bridge-domain 30
#
interface GigabitEthernet<span>0/1/4</span>.1 mode l2
 encapsulation dot1q vid 40
 rewrite pop single
 bridge-domain 40
#
interface LoopBack1
 ip address 2.2.2.2 255.255.255.255
#               
interface Nve1
 source 2.2.2.2
 vni 100 head-end peer-list protocol bgp
 vni 110 head-end peer-list protocol bgp
 vni 120 head-end peer-list protocol bgp
 vni 130 head-end peer-list protocol bgp
#
bgp 100
 peer 1.1.1.1 as-number 100
 peer 1.1.1.1 connect-interface LoopBack1
 peer 3.3.3.3 as-number 100
 peer 3.3.3.3 connect-interface LoopBack1
 peer 4.4.4.4 as-number 100
 peer 4.4.4.4 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 1.1.1.1 enable
  peer 3.3.3.3 enable
  peer 4.4.4.4 enable
 #
 ipv4-family vpn-instance vpn1
  import-route static
  maximum load-balancing 16  
  advertise l2vpn evpn import-route-multipath
 #
 l2vpn-family evpn
  undo policy vpn-target
  bestroute add-path path-number 16
  peer 1.1.1.1 enable
  peer 1.1.1.1 advertise arp
  peer 1.1.1.1 advertise encap-type vxlan
  peer 3.3.3.3 enable
  peer 3.3.3.3 advertise arp
  peer 3.3.3.3 capability-advertise add-path both
  peer 3.3.3.3 advertise add-path path-number 16
  peer 3.3.3.3 advertise encap-type vxlan
  peer 4.4.4.4 enable
  peer 4.4.4.4 advertise arp
  peer 4.4.4.4 capability-advertise add-path both
  peer 4.4.4.4 advertise add-path path-number 16
  peer 4.4.4.4 advertise encap-type vxlan
#
ospf 1
 area 0.0.0.0
  network 2.2.2.2 0.0.0.0
  network 10.6.3.0 0.0.0.255
  network 10.6.4.0 0.0.0.255
#
route-policy sp permit node 10
 if-match tag 1000
 apply gateway-ip origin-nexthop
#
route-policy sp deny node 20
#
ip route-static vpn-instance vpn1 6.6.6.6 255.255.255.255 10.3.1.2 tag 1000
ip route-static vpn-instance vpn1 6.6.6.6 255.255.255.255 10.4.1.2 tag 1000
#
ip path detection enable dscp 3
#
return</pre>
</li><li><p>VNF1 configuration file</p>
<p>For details, see the configuration file of the specific device model.</p>
</li><li><p>VNF2 configuration file</p>
<p>For details, see the configuration file of the specific device model.</p>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cfg_path-detect_0006.html">Configuration Examples for Path Detection
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
</div>
</div>
</body>
</html>