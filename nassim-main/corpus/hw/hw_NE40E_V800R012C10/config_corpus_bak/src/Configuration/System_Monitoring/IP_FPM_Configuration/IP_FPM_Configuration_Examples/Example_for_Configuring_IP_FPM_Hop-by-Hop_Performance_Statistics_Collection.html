
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring IP FPM Hop-by-Hop Performance Statistics Collection">
<meta name="abstract" content="This section provides an example for configuring IP Flow Performance Monitor (FPM) hop-by-hop performance statistics collection.">
<meta name="description" content="This section provides an example for configuring IP Flow Performance Monitor (FPM) hop-by-hop performance statistics collection.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ipfpm_cfg_0012.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ipfpm_cfg_0013.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="ipfpm_vrp,w00800033,w00556928,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="IP FPM">
<meta name="featuretype" content="System Monitor">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="IP FPM">
<meta name="featuretype" content="System Monitor">
<meta name="featurename" content="IP FPM">
<meta name="featuretype" content="System Monitor">
<meta name="featurename" content="IP FPM">
<meta name="featuretype" content="System Monitor">
<meta name="OWNER" content="c00511010">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="c00511010">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172372902">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>Example for Configuring IP FPM Hop-by-Hop Performance Statistics Collection</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172372902"></a><a name="EN-US_TASK_0172372902"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring IP FPM Hop-by-Hop Performance Statistics Collection</h1>
<div class="taskbody"><p>This section provides an example for configuring IP Flow Performance Monitor (FPM) hop-by-hop performance statistics collection.</p>
<div class="context"><a name="EN-US_TASK_0172372902__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><div class="p">As networks rapidly develop and applications become diversified, various value-added services are widely used. Link connectivity and network performance directly affect services carried over the networks. Therefore, performance measurement is especially important for service transmission channels.<ul><li><p>When voice services are deployed, users will not detect any change in the voice quality if the packet loss rate on links is lower than 5%. If the packet loss rate is higher than 10%, the voice quality will deteriorate significantly.</p>
</li><li><p>Real-time services, such as VoIP, online games, and video conferencing, require a delay lower than 100 ms, or even 50 ms. As the delay increases, user experience worsens.</p>
</li></ul>
To meet higher quality requirements for real-time services, such as VoIP, online gaming, and online video, it is required that the network node where a performance fault occurs be quickly located when service quality deteriorates, so that the fault can be promptly rectified and user experience improved.</div>
<p>The IPRAN network shown in <a href="#EN-US_TASK_0172372902__fig_dc_vrp_ipfpm_cfg_001401">Figure 1</a> transmits video services. A unidirectional service flow enters the network through the UPE, travels across SPE1, and leaves the network through the NPE.</p>
<p>To locate faults when network performance deteriorates, configure hop-by-hop packet loss and delay measurement on the UPE and NPE to locate faults segment by segment.</p>
<div class="fignone" id="EN-US_TASK_0172372902__fig_dc_vrp_ipfpm_cfg_001401"><a name="EN-US_TASK_0172372902__fig_dc_vrp_ipfpm_cfg_001401"></a><a name="fig_dc_vrp_ipfpm_cfg_001401"></a><span class="figcap"><b>Figure 1 </b>IP FPM hop-by-hop performance statistics collection</span><br><span><img class="vsd" src="images/fig_dc_vrp_ipfpm_cfg_001401.png"></span></div>

<div class="tableBorder"><a name="EN-US_TASK_0172372902__tab_dc_vrp_ipfpm_cfg_001401"></a><a name="tab_dc_vrp_ipfpm_cfg_001401"></a><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" id="EN-US_TASK_0172372902__tab_dc_vrp_ipfpm_cfg_001401" frame="border" border="1" rules="all"><caption><b>Table 1 </b>Interfaces connecting devices and their IP addresses</caption><thead align="left"><tr><th align="left" class="cellrowborder" char="." valign="top" width="19.31613677264547%" id="mcps1.4.1.6.2.6.1.1" liSelected="liSelected"><p>Device (Role)</p>
</th>
<th align="left" class="cellrowborder" char="." valign="top" width="19.31613677264547%" id="mcps1.4.1.6.2.6.1.2" liSelected="liSelected"><p>Interface Name</p>
</th>
<th align="left" class="cellrowborder" char="." valign="top" width="19.31613677264547%" id="mcps1.4.1.6.2.6.1.3" liSelected="liSelected"><p>Interface</p>
</th>
<th align="left" class="cellrowborder" char="." valign="top" width="22.735452909418115%" id="mcps1.4.1.6.2.6.1.4" liSelected="liSelected"><p>Remote Device (Role)</p>
</th>
<th align="left" class="cellrowborder" char="." valign="top" width="19.31613677264547%" id="mcps1.4.1.6.2.6.1.5" liSelected="liSelected"><p>IP Address</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" rowspan="4" char="." valign="top" width="19.31613677264547%" headers="mcps1.4.1.6.2.6.1.1 "><p>UPE (DCP1/MCP)</p>
</td>
<td class="cellrowborder" char="." valign="top" width="19.31613677264547%" headers="mcps1.4.1.6.2.6.1.2 "><p>-</p>
</td>
<td class="cellrowborder" char="." valign="top" width="19.31613677264547%" headers="mcps1.4.1.6.2.6.1.3 "><p>Loopback1</p>
</td>
<td class="cellrowborder" char="." valign="top" width="22.735452909418115%" headers="mcps1.4.1.6.2.6.1.4 "><p>-</p>
</td>
<td class="cellrowborder" char="." valign="top" width="19.31613677264547%" headers="mcps1.4.1.6.2.6.1.5 "><p>1.1.1.1/32</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.6.1.2 "><p>interface1</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.6.1.3 "><p>GE<span>0/1/0</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.6.1.4 "><p>eNodeB</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.6.1.5 "><p>192.168.1.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.6.1.2 "><p>interface2</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.6.1.3 "><p>GE<span>0/1/1</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.6.1.4 "><p>SPE1 (DCP2)</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.6.1.5 "><p>172.16.1.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.6.1.2 "><p>interface3</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.6.1.3 "><p>GE<span>0/1/2</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.6.1.4 "><p>SPE2</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.6.1.5 "><p>172.16.2.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="5" char="." valign="top" width="19.31613677264547%" headers="mcps1.4.1.6.2.6.1.1 "><p>SPE1 (DCP2)</p>
</td>
<td class="cellrowborder" char="." valign="top" width="19.31613677264547%" headers="mcps1.4.1.6.2.6.1.2 "><p>-</p>
</td>
<td class="cellrowborder" char="." valign="top" width="19.31613677264547%" headers="mcps1.4.1.6.2.6.1.3 "><p>Loopback1</p>
</td>
<td class="cellrowborder" char="." valign="top" width="22.735452909418115%" headers="mcps1.4.1.6.2.6.1.4 "><p>-</p>
</td>
<td class="cellrowborder" char="." valign="top" width="19.31613677264547%" headers="mcps1.4.1.6.2.6.1.5 "><p>2.2.2.2/32</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.6.1.2 "><p>interface1</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.6.1.3 "><p>GE<span>0/1/1</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.6.1.4 "><p>UPE (DCP1/MCP)</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.6.1.5 "><p>172.16.1.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.6.1.2 "><p>interface2</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.6.1.3 "><p>GE<span>0/1/2</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.6.1.4 "><p>NPE (DCP3)</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.6.1.5 "><p>172.16.4.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.6.1.2 "><p>interface3</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.6.1.3 "><p>GE<span>0/1/3</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.6.1.4 "><p>SPE2</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.6.1.5 "><p>172.16.3.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.6.1.2 "><p>interface4</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.6.1.3 "><p>GE<span>0/1/4</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.6.1.4 "><p>BITS</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.6.1.5 "><p>172.16.6.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="4" char="." valign="top" width="19.31613677264547%" headers="mcps1.4.1.6.2.6.1.1 "><p>SPE2</p>
</td>
<td class="cellrowborder" char="." valign="top" width="19.31613677264547%" headers="mcps1.4.1.6.2.6.1.2 "><p>-</p>
</td>
<td class="cellrowborder" char="." valign="top" width="19.31613677264547%" headers="mcps1.4.1.6.2.6.1.3 "><p>Loopback1</p>
</td>
<td class="cellrowborder" char="." valign="top" width="22.735452909418115%" headers="mcps1.4.1.6.2.6.1.4 "><p>-</p>
</td>
<td class="cellrowborder" char="." valign="top" width="19.31613677264547%" headers="mcps1.4.1.6.2.6.1.5 "><p>3.3.3.3/32</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.6.1.2 "><p>interface1</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.6.1.3 "><p>GE<span>0/1/1</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.6.1.4 "><p>NPE (DCP3)</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.6.1.5 "><p>172.16.5.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.6.1.2 "><p>interface2</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.6.1.3 "><p>GE<span>0/1/2</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.6.1.4 "><p>UPE (DCP1/MCP)</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.6.1.5 "><p>172.16.2.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.6.1.2 "><p>interface3</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.6.1.3 "><p>GE<span>0/1/3</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.6.1.4 "><p>SPE1 (DCP2)</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.6.1.5 "><p>172.16.3.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="4" char="." valign="top" width="19.31613677264547%" headers="mcps1.4.1.6.2.6.1.1 "><p>NPE (DCP3)</p>
</td>
<td class="cellrowborder" char="." valign="top" width="19.31613677264547%" headers="mcps1.4.1.6.2.6.1.2 "><p>-</p>
</td>
<td class="cellrowborder" char="." valign="top" width="19.31613677264547%" headers="mcps1.4.1.6.2.6.1.3 "><p>Loopback1</p>
</td>
<td class="cellrowborder" char="." valign="top" width="22.735452909418115%" headers="mcps1.4.1.6.2.6.1.4 "><p>-</p>
</td>
<td class="cellrowborder" char="." valign="top" width="19.31613677264547%" headers="mcps1.4.1.6.2.6.1.5 "><p>4.4.4.4/32</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.6.1.2 "><p>interface1</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.6.1.3 "><p>GE<span>0/1/1</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.6.1.4 "><p>SPE2</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.6.1.5 "><p>172.16.5.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.6.1.2 "><p>interface2</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.6.1.3 "><p>GE<span>0/1/2</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.6.1.4 "><p>SPE1 (DCP2)</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.6.1.5 "><p>172.16.4.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.6.1.2 "><p>interface3</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.6.1.3 "><p>GE<span>0/1/3</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.6.1.4 "><p>EPC</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.6.1.5 "><p>192.168.2.1/24</p>
</td>
</tr>
</tbody>
</table>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172372902__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><div class="p">The configuration roadmap is as follows:<ol><li><p>Configure an IP address and a routing protocol for each interface so that all provider edge devices (PEs) can communicate at the network layer. This example uses Open Shortest Path First (OSPF) as the routing protocol.</p>
</li><li><p>Configure MPLS functions and public network tunnels to carry L3VPN services. In this example, RSVP-TE tunnels are established between the UPE and SPEs, and Label Distribution Protocol (LDP) LSPs are established between the SPEs and between the NPE and SPEs.</p>
</li><li><p>Create a VPN instance on the UPE and NPE and import the local direct routes on the UPE and NPE to their respective VPN instance routing tables.</p>
</li><li><p>Establish MP-IBGP peer relationships between the UPE and SPEs and between the NPE and SPEs.</p>
</li><li><p>Configure the SPEs as route reflectors (RRs) and specify the UPE and NPE as RR clients.</p>
</li><li><p>Configure VPN FRR on the UPE and NPE.</p>
</li><li><p>Configure the Network Time Protocol (1588v2) to synchronize the clocks of the UPE, SPE1, and the NPE.</p>
</li><li><p>Configure hop-by-hop packet loss and delay measurement on the UPE and NPE to locate faults segment by segment.</p>
</li><li><p>Configure the packet loss and two-way delay alarm thresholds and clear alarm thresholds on the UPE.</p>
</li></ol>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172372902__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><div class="p">To complete the configuration, you need the following data:<ul><li><p>IP address of each interface listed in <a href="#EN-US_TASK_0172372902__tab_dc_vrp_ipfpm_cfg_001401">Table 1</a></p>
</li><li><p>IGP type (OSPF), process ID (1), and area ID (0)</p>
</li><li><p>Label switching router (LSR) IDs of the UPE (1.1.1.1), SPE1 (2.2.2.2), and SPE2 (3.3.3.3)</p>
</li><li><p>Tunnel interface names (Tunnel11), tunnel IDs (100), and tunnel interface addresses (loopback interface addresses) for the forward and reverse tunnels between the UPE and SPE1</p>
</li><li>Tunnel interface names (Tunnel12), tunnel IDs (200), and tunnel interface addresses (loopback interface addresses) for the forward and reverse tunnels between the UPE and SPE2</li><li><p>Tunnel policy names (policy1) for the tunnels between the UPE and SPEs and tunnel selector names (BindTE) on the SPEs</p>
</li><li><p>Name (vpna), RD (100:1), and VPN targets (1:1) of the VPN instances on the UPE and NPE</p>
</li><li><p>UPE's DCP ID and MCP ID (both 1.1.1.1); SPE1's DCP ID (2.2.2.2); NPE's MCP ID (4.4.4.4)</p>
</li><li><p>IP FPM instance ID (1) and statistical period (10s)</p>
</li><li><p>Target flow's source IP address (10.1.1.1) and destination IP address (10.2.1.1)</p>
</li><li><p>ACH1 {TLP100, TLP200} and ACH2 {TLP200, TLP310}</p>
</li><li><div class="p">Packet loss and delay measurement flags (respectively the third and fourth bits in the ToS field of the IPv4 packet header)<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Before you deploy IP FPM for packet loss and delay measurement, if two or more bits in the IPv4 packet header have not been planned for other purposes, they can be used for packet loss and delay measurement at the same time. If only one bit in the IPv4 packet header has not been planned, it can be used for either packet loss or delay measurement in one IP FPM instance.</p>
</div></div>
</div>
</li><li><p>Authentication mode (HMAC-SHA256), password (YsHsjx_202206), key ID (1), and UDP port number (2048) on the UPE, SPE, and NPE.</p>
</li><li><p>Hop-by-hop packet loss and delay measurement intervals (30s)</p>
</li><li><p>Packet loss alarm threshold and its clear alarm threshold (respectively 10% and 5%); two-way delay alarm threshold and its clear alarm threshold (respectively 100 ms and 50 ms)</p>
</li></ul>
</div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172372902__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure interface IP addresses.</span><p><p>Assign an IP address to each interface according to <a href="#EN-US_TASK_0172372902__tab_dc_vrp_ipfpm_cfg_001401">Table 1</a> and create a loopback interface on each node. For configuration details, see <a href="#EN-US_TASK_0172372902__section_05">Configuration Files</a> in this section.</p>
</p></li><li><span>Configure OSPF.</span><p><p>Configure OSPF on each node to allow the nodes to communicate at the network layer. For detailed configurations, see <a href="#EN-US_TASK_0172372902__section_05">Configuration Files</a> in this section.</p>
</p></li><li><span>Configure basic MPLS functions and public network tunnels.</span><p><ul><li><p>Configure basic MPLS functions and enable MPLS TE, RSVP-TE, and Constraint Shortest Path First (CSPF).</p>
<p># Configure the UPE.</p>
<pre class="screen">&lt;UPE&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>mpls lsr-id 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-mpls] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-mpls] <strong>mpls rsvp-te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-mpls] <strong>mpls te cspf</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/1</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/1</span>] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/1</span>] <strong>mpls rsvp-te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/2</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/2</span>] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/2</span>] <strong>mpls rsvp-te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-ospf-1] <strong>opaque-capability enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-ospf-1] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-ospf-1-area-0.0.0.0] <strong>mpls-te enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-ospf-1-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-ospf-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>commit</strong></pre>
<p># Configure SPE1.</p>
<pre class="screen">&lt;SPE1&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE1] <strong>mpls lsr-id 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-mpls] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-mpls] <strong>mpls rsvp-te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-mpls] <strong>mpls te cspf</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-GigabitEthernet<span>0/1/1</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-GigabitEthernet<span>0/1/1</span>] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-GigabitEthernet<span>0/1/1</span>] <strong>mpls rsvp-te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>interface gigabitethernet <span>0/1/3</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-GigabitEthernet<span>0/1/3</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-GigabitEthernet<span>0/1/3</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-GigabitEthernet<span>0/1/3</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-ospf-1] <strong>opaque-capability enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-ospf-1] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-ospf-1-area-0.0.0.0] <strong>mpls-te enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-ospf-1-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-ospf-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>commit</strong></pre>
<p># Configure SPE2.</p>
<pre class="screen">&lt;SPE2&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE2] <strong>mpls lsr-id 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-mpls] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-mpls] <strong>mpls rsvp-te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-mpls] <strong>mpls te cspf</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2] <strong>interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-GigabitEthernet<span>0/1/2</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-GigabitEthernet<span>0/1/2</span>] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-GigabitEthernet<span>0/1/2</span>] <strong>mpls rsvp-te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2] <strong>interface gigabitethernet <span>0/1/3</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-GigabitEthernet<span>0/1/3</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-GigabitEthernet<span>0/1/3</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-GigabitEthernet<span>0/1/3</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2] <strong>ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-ospf-1] <strong>opaque-capability enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-ospf-1] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-ospf-1-area-0.0.0.0] <strong>mpls-te enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-ospf-1-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-ospf-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2] <strong>commit</strong></pre>
<p># Configure NPE.</p>
<pre class="screen">&lt;NPE&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE] <strong>mpls lsr-id 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-GigabitEthernet<span>0/1/1</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-GigabitEthernet<span>0/1/1</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE] <strong>interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-GigabitEthernet<span>0/1/2</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-GigabitEthernet<span>0/1/2</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE] <strong>commit</strong></pre>
</li><li><p>Enable the egress of each unidirectional tunnel to be created to assign a non-null label to the penultimate hop.</p>
<div class="p"># Configure the UPE.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-mpls] <strong>label advertise non-null</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>commit</strong></pre>
</div>
<div class="p"># Configure SPE1.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE1] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-mpls] <strong>label advertise non-null</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>commit</strong></pre>
</div>
<div class="p"># Configure SPE2.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE2] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-mpls] <strong>label advertise non-null</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2] <strong>commit</strong></pre>
</div>
</li><li><p>Configure MPLS TE tunnel interfaces.</p>
<p># Configure the UPE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>interface Tunnel 11</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-Tunnel11] <strong>ip address unnumbered interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-Tunnel11] <strong>tunnel-protocol mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-Tunnel11] <strong>destination 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-Tunnel11] <strong>mpls te tunnel-id 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-Tunnel11] <strong>mpls te signal-protocol rsvp-te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-Tunnel11] <strong>mpls te reserved-for-binding</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-Tunnel11] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>interface Tunnel 12</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-Tunnel12] <strong>ip address unnumbered interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-Tunnel12] <strong>tunnel-protocol mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-Tunnel12] <strong>destination 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-Tunnel12] <strong>mpls te tunnel-id 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-Tunnel12] <strong>mpls te signal-protocol rsvp-te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-Tunnel12] <strong>mpls te reserved-for-binding</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-Tunnel12] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>commit</strong></pre>
<p># Configure SPE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE1] <strong>interface Tunnel 11</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-Tunnel11] <strong>ip address unnumbered interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-Tunnel11] <strong>tunnel-protocol mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-Tunnel11] <strong>destination 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-Tunnel11] <strong>mpls te tunnel-id 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-Tunnel11] <strong>mpls te signal-protocol rsvp-te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-Tunnel11] <strong>mpls te reserved-for-binding</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-Tunnel11] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>commit</strong></pre>
<p># Configure SPE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE2] <strong>interface Tunnel 12</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-Tunnel12] <strong>ip address unnumbered interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-Tunnel12] <strong>tunnel-protocol mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-Tunnel12] <strong>destination 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-Tunnel12] <strong>mpls te tunnel-id 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-Tunnel12] <strong>mpls te signal-protocol rsvp-te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-Tunnel12] <strong>mpls te reserved-for-binding</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-Tunnel12] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2] <strong>commit</strong></pre>
</li><li><p>Configure tunnel policies.</p>
<p># Configure the UPE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>tunnel-policy policy1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-tunnel-policy-policy1] <strong>tunnel binding destination 2.2.2.2 te Tunnel 11</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-tunnel-policy-policy1] <strong>tunnel binding destination 3.3.3.3 te Tunnel 12</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-tunnel-policy-policy1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>commit</strong></pre>
<p># Configure SPE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE1] <strong>tunnel-policy policy1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-tunnel-policy-policy1] <strong>tunnel binding destination 1.1.1.1 te Tunnel 11</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-tunnel-policy-policy1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>commit</strong></pre>
<p># Configure SPE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE2] <strong>tunnel-policy policy1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-tunnel-policy-policy1] <strong>tunnel binding destination 1.1.1.1 te Tunnel 12</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-tunnel-policy-policy1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2] <strong>commit</strong></pre>
</li></ul>
</p></li><li><span>Create a VPN instance on the UPE and NPE and import the local direct routes on the UPE and NPE to their respective VPN instance routing tables.</span><p><p># Configure the UPE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>ip vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vpn-instance-vpna] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vpn-instance-vpna-af-ipv4] <strong>route-distinguisher 100:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vpn-instance-vpna-af-ipv4] <strong>vpn-target 1:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vpn-instance-vpna-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vpn-instance-vpna] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/0</span>] <strong>ip binding vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/0</span>] <strong>ip address 192.168.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE]<strong> bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-bgp]<strong> ipv4-family vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-bgp-vpna] <strong>import-route direct</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-bgp-vpna] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>commit</strong></pre>
<p># Configure the NPE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE] <strong>ip vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-vpn-instance-vpna] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-vpn-instance-vpna-af-ipv4] <strong>route-distinguisher 100:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-vpn-instance-vpna-af-ipv4] <strong>vpn-target 1:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-vpn-instance-vpna-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-vpn-instance-vpna] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE]<strong> interface gigabitethernet <span>0/1/3</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-GigabitEthernet<span>0/1/3</span>] <strong>ip binding vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-GigabitEthernet<span>0/1/3</span>] <strong>ip address 192.168.2.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-GigabitEthernet<span>0/1/3</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE]<strong> bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-bgp]<strong> ipv4-family vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-bgp-vpna]<strong> import-route direct</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-bgp-vpna] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE] <strong>commit</strong></pre>
</p></li><li><span>Establish MP-IBGP peer relationships between the UPE and SPEs and between the NPE and SPEs.</span><p><p># Configure the UPE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE]<strong> bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-bgp] <strong>router-id 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-bgp]<strong> peer 2.2.2.2 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-bgp]<strong> peer 2.2.2.2 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-bgp]<strong> peer 3.3.3.3 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-bgp]<strong> peer 3.3.3.3 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-bgp]<strong> ipv4-family vpnv4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-bgp-af-vpnv4]<strong> peer 2.2.2.2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-bgp-af-vpnv4]<strong> peer 3.3.3.3 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-bgp-af-vpnv4]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-bgp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE]<strong> commit</strong></pre>
<p># Configure SPE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE1]<strong> bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-bgp] <strong>router-id 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-bgp]<strong> peer 1.1.1.1 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-bgp]<strong> peer 1.1.1.1 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-bgp]<strong> peer 3.3.3.3 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-bgp]<strong> peer 3.3.3.3 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-bgp]<strong> peer 4.4.4.4 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-bgp]<strong> peer 4.4.4.4 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-bgp]<strong> ipv4-family vpnv4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-bgp-af-vpnv4]<strong> undo policy vpn-target</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-bgp-af-vpnv4]<strong> peer 1.1.1.1 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-bgp-af-vpnv4]<strong> peer 3.3.3.3 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-bgp-af-vpnv4]<strong> peer 4.4.4.4 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-bgp-af-vpnv4]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-bgp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1]<strong> commit</strong></pre>
<p>The configuration of SPE2 is similar to the configuration of SPE1. For configuration details, see <a href="#EN-US_TASK_0172372902__section_05">Configuration Files</a> in this section.</p>
<p># Configure the NPE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE]<strong> bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-bgp] <strong>router-id 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-bgp]<strong> peer 2.2.2.2 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-bgp]<strong> peer 2.2.2.2 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-bgp]<strong> peer 3.3.3.3 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-bgp]<strong> peer 3.3.3.3 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-bgp]<strong> ipv4-family vpnv4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-bgp-af-vpnv4]<strong> peer 2.2.2.2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-bgp-af-vpnv4]<strong> peer 3.3.3.3 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-bgp-af-vpnv4]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-bgp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE]<strong> commit</strong></pre>
</p></li><li><span>Configure SPEs as RRs and specify UPEs and NPEs as RR clients. This step uses SPE1 as an example.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE1]<strong> bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-bgp]<strong> ipv4-family vpnv4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-bgp-af-vpnv4]<strong> peer 1.1.1.1 reflect-client</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-bgp-af-vpnv4]<strong> peer 1.1.1.1 next-hop-local</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-bgp-af-vpnv4]<strong> peer 4.4.4.4 reflect-client</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-bgp-af-vpnv4]<strong> peer 4.4.4.4 next-hop-local</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-bgp-af-vpnv4]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-bgp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1]<strong> commit</strong></pre>
</p></li><li><span>Apply the tunnel policy on the UPE and configure a tunnel selector on each SPE because SPEs do not have VPN instances, so that the UPE and SPEs use RSVP-TE tunnels to transmit traffic.</span><p><p># Apply the tunnel policy on the UPE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>ip vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vpn-instance-vpna] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vpn-instance-vpna-af-ipv4] <strong>route-distinguisher 100:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vpn-instance-vpna-af-ipv4] <strong>tnl-policy policy1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vpn-instance-vpna-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vpn-instance-vpna] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>commit</strong></pre>
<p># Configure a tunnel selector on SPE1 to use TE tunnels to transmit traffic.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE1] <strong>tunnel-selector bindTE permit node 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-tunnel-selector] <strong>apply tunnel-policy policy1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-tunnel-selector] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-bgp] <strong>ipv4-family vpnv4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-bgp-af-vpnv4] <strong>tunnel-selector bindTE</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-bgp-af-vpnv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>commit</strong></pre>
<p>The configuration of SPE2 is similar to the configuration of SPE1. For configuration details, see <a href="#EN-US_TASK_0172372902__section_05">Configuration Files</a>.</p>
</p></li><li><span>Configure VPN FRR on the UPE and NPE.</span><p><p># Configure the UPE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-bgp] <strong>ipv4-family vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-bgp-vpna] <strong>auto-frr</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-bgp-vpna] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>commit</strong></pre>
</p><p><div class="p">After completing the configurations, run the <a href="cmdqueryname=display+bgp+vpnv4+vpn-instance+vpna+routing-table"><b><span class="cmdname">display bgp vpnv4 vpn-instance vpna routing-table</span></b></a> command on the UPE and NPE to view detailed information about received routes.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>display bgp vpnv4 vpn-instance vpna routing-table</strong></pre>
<pre class="screen"> BGP Local router ID is 1.1.1.1
 Status codes: * - valid, &gt; - best, d - damped,
               h - history,  i - internal, s - suppressed, S - Stale
               Origin : i - IGP, e - EGP, ? - incomplete
<span> RPKI validation codes: V - valid, I - invalid, N - not-found</span>


 VPN-Instance vpna, Router ID 1.1.1.1:

 Total Number of Routes: 4
      Network            NextHop        MED        LocPrf    PrefVal Path/Ogn

 *&gt;   192.168.1.0/24       0.0.0.0         0                     0      ?
 *&gt;   192.168.1.1/32       0.0.0.0         0                     0      ?
 *&gt;i  192.168.2.0/24       2.2.2.2         0          100        0      ?
 * i                       3.3.3.3         0          100        0      ? </pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE] <strong>display bgp vpnv4 vpn-instance vpna routing-table</strong></pre>
<pre class="screen"> BGP Local router ID is 4.4.4.4
 Status codes: * - valid, &gt; - best, d - damped,
               h - history,  i - internal, s - suppressed, S - Stale
               Origin : i - IGP, e - EGP, ? - incomplete
<span> RPKI validation codes: V - valid, I - invalid, N - not-found</span>


 VPN-Instance vpna, Router ID 4.4.4.4:

 Total Number of Routes: 4
      Network            NextHop        MED        LocPrf    PrefVal Path/Ogn

 *&gt;i  192.168.1.0/24       2.2.2.2         0          100        0      ?
 * i                       3.3.3.3         0          100        0      ?
 *&gt;   192.168.2.0/24       0.0.0.0         0                     0      ?
 *&gt;   192.168.2.1/32       0.0.0.0         0                     0      ?</pre>
</div>
<p>The command output shows that the UPE and NPE both preferentially select the routes advertised by SPE1 and use UPE-SPE1-NPE as the primary path.</p>
</p></li><li><span>Configure 1588v2 to synchronize the clocks of the UPE, SPE1, and the NPE.</span><p><ol type="a"><li><p># Import BITS0 signals to SPE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE1] <strong>clock bits-type bits0 2mhz</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>clock source bits0 synchronization enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>clock source bits0 priority 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>commit</strong></pre>
</li><li><p># Enable 1588v2 globally.</p>
<div class="p"># Configure SPE1.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE1] <strong>ptp enable </strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>ptp domain 1 </strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>ptp device-type bc</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>ptp clock-source local clock-class 185</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>clock source ptp synchronization enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>clock source ptp priority 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>commit</strong></pre>
</div>
<div class="p"># Configure UPE.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>ptp enable </strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>ptp domain 1 </strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>ptp device-type bc</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>ptp clock-source local clock-class 185</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>clock source ptp synchronization enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>clock source ptp priority 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>commit</strong></pre>
</div>
<div class="p"># Configure NPE.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE] <strong>ptp enable </strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE] <strong>ptp domain 1 </strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE] <strong>ptp device-type bc</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE] <strong>ptp clock-source local clock-class 185</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE] <strong>clock source ptp synchronization enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE] <strong>clock source ptp priority 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE] <strong>commit</strong></pre>
</div>
</li><li><p>Enable 1588v2 on an interface.</p>
<div class="p"># Configure SPE1.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE1] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE1-GigabitEthernet<span>0/1/1</span>] <strong>ptp enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-GigabitEthernet<span>0/1/1</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE1-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE1] <strong>interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE1-GigabitEthernet<span>0/1/2</span>] <strong>ptp enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-GigabitEthernet<span>0/1/2</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE1-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE1] <strong>interface gigabitethernet <span>0/1/4</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE1-GigabitEthernet<span>0/1/4</span>] <strong>ptp enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-GigabitEthernet<span>0/1/4</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE1-GigabitEthernet<span>0/1/4</span>] <strong>quit</strong></pre>
</div>
<div class="p"># Configure UPE.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE-GigabitEthernet<span>0/1/0</span>] <strong>ptp enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE-GigabitEthernet<span>0/1/1</span>] <strong>ptp enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/1</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
</div>
<div class="p"># Configure NPE.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE] <strong>interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE-GigabitEthernet<span>0/1/2</span>] <strong>ptp enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-GigabitEthernet<span>0/1/2</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE] <strong>interface gigabitethernet <span>0/1/3</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE-GigabitEthernet<span>0/1/3</span>] <strong>ptp enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-GigabitEthernet<span>0/1/3</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE-GigabitEthernet<span>0/1/3</span>] <strong>quit</strong></pre>
</div>
</li></ol>
</p></li><li><span>Configure hop-by-hop packet loss and delay measurement on the UPE, SPE1, and the NPE; configure two ACHs on the link between the UPE and NPE: ACH1 {TLP100, TLP200} and ACH2 {TLP200, TLP310}.</span><p><div class="p"># Configure UPE.<ul><li><div class="p">Configure the MCP.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>nqa ipfpm mcp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-nqa-ipfpm-mcp] <strong>mcp id 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-nqa-ipfpm-mcp] <strong>protocol udp port 2048</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-nqa-ipfpm-mcp] <strong>authentication-mode hmac-sha256 key-id 1 cipher YsHsjx_202206</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-nqa-ipfpm-mcp] <strong>instance 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-nqa-ipfpm-mcp] <strong>description Instanceforpoint-by-pointtest</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-nqa-ipfpm-mcp-instance-1] <strong>dcp 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-nqa-ipfpm-mcp-instance-1] <strong>dcp 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-nqa-ipfpm-mcp-instance-1] <strong>dcp 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-nqa-ipfpm-mcp-instance-1] <strong>ach 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-nqa-ipfpm-mcp-instance-1-ach-1] <strong>flow forward</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-nqa-ipfpm-mcp-instance-1-ach-1] <strong>in-group dcp 1.1.1.1 tlp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-nqa-ipfpm-mcp-instance-1-ach-1] <strong>out-group dcp 2.2.2.2 tlp 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-nqa-ipfpm-mcp-instance-1-ach-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-nqa-ipfpm-mcp-instance-1] <strong>ach 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-nqa-ipfpm-mcp-instance-1-ach-2] <strong>flow forward</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-nqa-ipfpm-mcp-instance-1-ach-2] <strong>in-group dcp 2.2.2.2 tlp 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-nqa-ipfpm-mcp-instance-1-ach-2] <strong>out-group dcp 4.4.4.4 tlp 310</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-nqa-ipfpm-mcp-instance-1-ach-2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-nqa-ipfpm-mcp-instance-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-nqa-ipfpm-mcp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>commit</strong></pre>
</div>
<div class="p">After completing the configuration, run the <a href="cmdqueryname=display+ipfpm+mcp"><b><span class="cmdname">display ipfpm mcp</span></b></a> command on the UPE. The command output shows MCP configurations on the UPE.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>display ipfpm mcp</strong></pre>
<pre class="screen">Specification Information:
 Max Instance Number                       :64
 Max DCP Number Per Instance               :256
 Max ACH Number Per Instance               :16
 Max TLP Number Per ACH                    :16

Configuration Information:
 MCP ID                                    :1.1.1.1
 Status                                    :Active
 Protocol Port                             :2048
 Current Instance Number                   :1</pre>
</div>
</li><li><div class="p">Configure a DCP.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>nqa ipfpm dcp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-nqa-ipfpm-dcp] <strong>dcp id 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-nqa-ipfpm-dcp] <strong>mcp 1.1.1.1 port 2048</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-nqa-ipfpm-dcp] <strong>authentication-mode hmac-sha256 key-id 1 cipher YsHsjx_202206</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-nqa-ipfpm-dcp] <strong>color-flag loss-measure tos-bit 3 delay-measure tos-bit 4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-nqa-ipfpm-dcp] <strong>instance 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-nqa-ipfpm-dcp-instance-1] <strong>description Instanceforpointbypointtest</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-nqa-ipfpm-dcp-instance-1] <strong>interval 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-nqa-ipfpm-dcp-instance-1] <strong>flow forward source 10.1.1.1 destination 10.2.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-nqa-ipfpm-dcp-instance-1] <strong>tlp 100 in-point ingress</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-nqa-ipfpm-dcp-instance-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-nqa-ipfpm-dcp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>commit</strong></pre>
</div>
<div class="p">After completing the configuration, run the <a href="cmdqueryname=display+ipfpm+dcp"><b><span class="cmdname">display ipfpm dcp</span></b></a> command on the UPE. The command output shows DCP configurations on the UPE.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>display ipfpm dcp</strong></pre>
<pre class="screen">Specification Information(Main Board):
 Max Instance Number                       :64
 Max 10s Instance Number                   :64
 Max 1s Instance Number                    :--
 Max TLP Number                            :512
 Max TLP Number Per Instance               :8

Configuration Information:
 DCP ID                                    : 1.1.1.1
 Loss-measure Flag                         : tos-bit3
 Delay-measure Flag                        : tos-bit4
 Authentication Mode                       : hmac-sha256
 Test Instances MCP ID                     : 1.1.1.1
 Test Instances MCP Port                   : 2048
 Current Instance Number                   : 1</pre>
</div>
</li><li>Bind the TLP to an interface.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>interface GigabitEthernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE-GigabitEthernet<span>0/1/0</span>] <strong>ipfpm tlp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>commit</strong></pre>
</li><li>Enable hop-by-hop packet loss and delay measurement.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>nqa ipfpm dcp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-nqa-ipfpm-dcp] <strong>instance 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-nqa-ipfpm-dcp-instance-1] <strong>loss-measure enable time-range 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-nqa-ipfpm-dcp-instance-1] <strong>delay-measure enable one-way tlp 100 time-range 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-nqa-ipfpm-dcp-instance-1] <strong>commit</strong></pre>
</li></ul>
</div>
<div class="p"># Configure SPE1.<ul><li><div class="p">Configure a DCP.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE1] <strong>nqa ipfpm dcp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-nqa-ipfpm-dcp] <strong>dcp id 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-nqa-ipfpm-dcp] <strong>authentication-mode hmac-sha256 key-id 1 cipher YsHsjx_202206</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-nqa-ipfpm-dcp] <strong>color-flag loss-measure tos-bit 3 delay-measure tos-bit 4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-nqa-ipfpm-dcp] <strong>mcp 1.1.1.1 port 2048</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-nqa-ipfpm-dcp] <strong>instance 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-nqa-ipfpm-dcp-instance-1] <strong>description Instanceforpointbypointtest</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-nqa-ipfpm-dcp-instance-1] <strong>interval 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-nqa-ipfpm-dcp-instance-1] <strong>flow forward source 10.1.1.1 destination 10.2.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-nqa-ipfpm-dcp-instance-1] <strong>tlp 200 mid-point flow forward ingress vpn-label 17 lsp-label 18</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-nqa-ipfpm-dcp-instance-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-nqa-ipfpm-dcp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>commit</strong></pre>
</div>
<div class="p">After completing the configuration, run the <a href="cmdqueryname=display+ipfpm+dcp"><b><span class="cmdname">display ipfpm dcp</span></b></a> command on SPE1. The command output shows DCP configurations on SPE1.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE1] <strong>display ipfpm dcp</strong></pre>
<pre class="screen">Specification Information(Main Board):
 Max Instance Number                       :64
 Max 10s Instance Number                   :64
 Max 1s Instance Number                    :--
 Max TLP Number                            :512
 Max TLP Number Per Instance               :8

Configuration Information:
 DCP ID                                    : 2.2.2.2
 Loss-measure Flag                         : tos-bit3
 Delay-measure Flag                        : tos-bit4
 Authentication Mode                       : hmac-sha256
 Test Instances MCP ID                     : 1.1.1.1
 Test Instances MCP Port                   : 2048
 Current Instance Number                   : 1 </pre>
</div>
</li><li>Bind the TLP to an interface.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE1] <strong>interface GigabitEthernet<span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE1-GigabitEthernet<span>0/1/1</span>] <strong>ipfpm tlp 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>commit</strong></pre>
</li><li>Enable hop-by-hop packet loss and delay measurement.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE1] <strong>nqa ipfpm dcp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-nqa-ipfpm-dcp] <strong>instance 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-nqa-ipfpm-dcp-instance-1] <strong>loss-measure enable mid-point time-range 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-nqa-ipfpm-dcp-instance-1] <strong>delay-measure enable one-way tlp mid-point time-range 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-nqa-ipfpm-dcp-instance-1] <strong>commit</strong></pre>
</li></ul>
</div>
<div class="p"># Configure the NPE.<ul><li><div class="p">Configure a DCP.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE] <strong>nqa ipfpm dcp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-nqa-ipfpm-dcp] <strong>dcp id 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-nqa-ipfpm-dcp] <strong>authentication-mode hmac-sha256 key-id 1 cipher YsHsjx_202206</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-nqa-ipfpm-dcp] <strong>color-flag loss-measure tos-bit 3 delay-measure tos-bit 4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-nqa-ipfpm-dcp] <strong>mcp 1.1.1.1 port 2048</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-nqa-ipfpm-dcp] <strong>instance 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-nqa-ipfpm-dcp-instance-1] <strong>description Instanceforpointbypointtest</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-nqa-ipfpm-dcp-instance-1] <strong>interval 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-nqa-ipfpm-dcp-instance-1] <strong>flow forward source 10.1.1.1 destination 10.2.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-nqa-ipfpm-dcp-instance-1] <strong>tlp 310 out-point egress</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-nqa-ipfpm-dcp-instance-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-nqa-ipfpm-dcp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE] <strong>commit</strong></pre>
</div>
<div class="p">After completing the configuration, run the <a href="cmdqueryname=display+ipfpm+dcp"><b><span class="cmdname">display ipfpm dcp</span></b></a> command on the NPE. The command output shows DCP configurations on the NPE.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE] <strong>display ipfpm dcp</strong></pre>
<pre class="screen">Specification Information(Main Board):
 Max Instance Number                       :64
 Max 10s Instance Number                   :64
 Max 1s Instance Number                    :--
 Max TLP Number                            :512
 Max TLP Number Per Instance               :8

Configuration Information:
 DCP ID                                    : 4.4.4.4
 Loss-measure Flag                         : tos-bit3
 Delay-measure Flag                        : tos-bit4
 Authentication Mode                       : hmac-sha256
 Test Instances MCP ID                     : 1.1.1.1
 Test Instances MCP Port                   : 2048
 Current Instance Number                   : 1</pre>
</div>
</li><li>Bind the TLPs to interfaces.<pre class="screen">[<span class="keyword">*</span>NPE] <strong>interface GigabitEthernet<span>0/1/3</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-GigabitEthernet<span>0/1/3</span>] <strong>ipfpm tlp 310</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-GigabitEthernet<span>0/1/3</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE] <strong>commit</strong></pre>
</li><li>Enable hop-by-hop packet loss and delay measurement.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE] <strong>nqa ipfpm dcp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-nqa-ipfpm-dcp] <strong>instance 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-nqa-ipfpm-dcp-instance-1] <strong>loss-measure enable time-range 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-nqa-ipfpm-dcp-instance-1] <strong>delay-measure enable one-way tlp 310 time-range 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-nqa-ipfpm-dcp-instance-1] <strong>commit</strong></pre>
</li></ul>
</div>
</p></li><li><span>Configure alarm thresholds and clear alarm thresholds for IP FPM performance counters on the UPE.</span><p><div class="p"># Configure the packet loss alarm threshold and its clear alarm threshold.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>nqa ipfpm mcp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-nqa-ipfpm-mcp] <strong>instance 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-nqa-ipfpm-mcp-instance-1] <strong>loss-measure ratio-threshold upper-limit 10 lower-limit 5</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-nqa-ipfpm-mcp-instance-1] <strong>commit</strong></pre>
</div>
<div class="p"># Configure the two-way delay alarm threshold and its clear alarm threshold.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE-nqa-ipfpm-mcp-instance-1] <strong>delay-measure two-way delay-threshold upper-limit 100000 lower-limit 50000</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-nqa-ipfpm-mcp-instance-1] <strong>commit</strong></pre>
</div>
</p></li><li><span>Verify the configuration.</span><p><div class="p">Run the <a href="cmdqueryname=display+ipfpm+statistic-type"><b><span class="cmdname">display ipfpm statistic-type</span></b></a> { <strong><span>loss</span></strong> | <strong><span>oneway-delay</span></strong> } <strong><span>instance</span></strong> <i><span class="varname">instance-id</span></i> <strong><span>ach</span></strong> <i><span class="varname">ach-id</span></i> command on the UPE to check the performance statistics for a specified IP FPM instance.<ul><li><p># The following example uses the packet loss statistics for ACH1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>display ipfpm statistic-type loss instance 1 ach 1</strong></pre>
<pre class="screen">Latest loss statistics of forward flow:
Unit: p - packet, b - byte
------------------------------------------------------------------------------------------
 Period               Loss(p)              LossRatio(p)  Loss(b)              LossRatio(b)
------------------------------------------------------------------------------------------
 136190088            10                   10.000000%    1000                 10.000000%
 136190087            10                   10.000000%    1000                 10.000000%
 136190086            10                   10.000000%    1000                 10.000000%
 136190085            10                   10.000000%    1000                 10.000000%
 136190084            10                   10.000000%    1000                 10.000000%
 136190083            10                   10.000000%    1000                 10.000000%
 136190082            10                   10.000000%    1000                 10.000000%

Latest loss statistics of backward flow:
Unit: p - packet, b - byte
------------------------------------------------------------------------------------------
 Period               Loss(p)              LossRatio(p)  Loss(b)              LossRatio(b)
------------------------------------------------------------------------------------------</pre>
</li><li># The following example uses the delay statistics for ACH1.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>display ipfpm statistic-type oneway-delay instance 1 ach 1</strong></pre>
<pre class="screen">Latest one-way delay statistics of forward flow:
--------------------------------------------------
 Period               Delay(usec) Delay
                                  Variation(usec)
--------------------------------------------------
 136190120            100         0
 136190119            100         0
 136190118            100         0
 136190117            100         0
 136190116            100         0
 136190115            100         0
 136190114            100         0

Latest one-way delay statistics of backward flow:
--------------------------------------------------
 Period               Delay(usec) Delay
                                  Variation(usec)
--------------------------------------------------</pre>
</li></ul>
</div>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0172372902__section_05"><a name="EN-US_TASK_0172372902__section_05"></a><a name="section_05"></a><a name="EN-US_TASK_0172372902__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>UPE configuration file</p>
<pre class="screen">#                                                                               
sysname UPE                                                                 
#
ptp enable
ptp domain 1
ptp device-type bc
ptp clock-source local clock-class 185
#
clock source ptp synchronization enable
clock source ptp priority 1
#                                                                               
ip vpn-instance vpna                                                            
 ipv4-family                                                                    
  route-distinguisher 100:1
  apply-label per-instance                                                   
  tnl-policy policy1                                                            
  vpn-target 1:1 export-extcommunity                                            
  vpn-target 1:1 import-extcommunity                                            
#                                                                               
mpls lsr-id 1.1.1.1                                                             
mpls                                                                            
 mpls te                                                                        
 label advertise non-null                                                       
 mpls rsvp-te                                                                   
 mpls te cspf                                                                   
#                                                                               
ntp-service sync-interval 180                    
ntp-service refclock-master 1                                                   
#                                                                               
interface GigabitEthernet<span>0/1/0</span>                                                 
 undo shutdown                                                                  
 ip binding vpn-instance vpna                                                   
 ip address 192.168.1.1 255.255.255.0                                             
 ptp enable
 ipfpm tlp 100                                                                 
#                                                                               
interface GigabitEthernet<span>0/1/1</span>                                                  
 undo shutdown                                                                  
 ip address 172.16.1.1 255.255.255.0                                             
 mpls                                                                           
 mpls te                                                                        
 mpls rsvp-te                                                                   
 ptp enable
#                                                                               
interface GigabitEthernet<span>0/1/2</span>                                                  
 undo shutdown                                                                  
 ip address 172.16.2.1 255.255.255.0                                             
 mpls                                                                           
 mpls te                                                                        
 mpls rsvp-te                                                                   
#                                                                               
interface LoopBack1                                                             
 ip address 1.1.1.1 255.255.255.255                                             
#                                                                               
interface Tunnel11                                                           
 ip address unnumbered interface LoopBack1                                      
 tunnel-protocol mpls te                                                        
 destination 2.2.2.2                                                            
 mpls te tunnel-id 100                                                          
 mpls te reserved-for-binding                                                   
#                                                                               
interface Tunnel12                                                           
 ip address unnumbered interface LoopBack1                                      
 tunnel-protocol mpls te                                                        
 destination 3.3.3.3                                                            
 mpls te tunnel-id 200                                                          
 mpls te reserved-for-binding                                                   
#                                                                               
bgp 100                                                                         
 router-id 1.1.1.1                                                              
 peer 2.2.2.2 as-number 100                                                     
 peer 2.2.2.2 connect-interface LoopBack1                                       
 peer 3.3.3.3 as-number 100                                                     
 peer 3.3.3.3 connect-interface LoopBack1                                       
 #                                                                              
 ipv4-family unicast                                                            
  undo synchronization
  peer 2.2.2.2 enable                                                           
  peer 3.3.3.3 enable                                                           
 #                                                                              
 ipv4-family vpnv4                                                              
  policy vpn-target                                                             
  peer 2.2.2.2 enable                                                           
  peer 3.3.3.3 enable                                                           
 #                                                                              
 ipv4-family vpn-instance vpna                                                  
  import-route direct                                                           
  auto-frr                                                                      
#                                                                               
ospf 1                                                                          
 opaque-capability enable                                                       
 area 0.0.0.0                                                                   
  network 1.1.1.1 0.0.0.0                                                       
  network 172.16.1.0 0.0.0.255                                                   
  network 172.16.2.0 0.0.0.255                                                   
  mpls-te enable                                                                
#                                                                               
tunnel-policy policy1                                                           
 tunnel binding destination 2.2.2.2 te Tunnel11                              
 tunnel binding destination 3.3.3.3 te Tunnel12                              
#                                                                               
nqa ipfpm dcp                                                                   
 dcp id 1.1.1.1                                                                 
 mcp 1.1.1.1 port 2048                                                          
 authentication-mode hmac-sha256 key-id 1 cipher <span>#%#%=%uP:z;!;4\TdYHU#$z/1IR]#%#%</span>
 color-flag loss-measure tos-bit 3 delay-measure tos-bit 4 
 instance 1                                                                     
  description Instanceforpointbypointtest                                       
  flow forward source 10.1.1.1 destination 10.2.1.1                           
  tlp 100 in-point ingress                                                               
#                                                                               
nqa ipfpm mcp                                                                   
 mcp id 1.1.1.1                                                                 
 protocol udp port 2048                                                         
 authentication-mode hmac-sha256 key-id 1 cipher <span>#%#%i`R&lt;&lt;=hGt&gt;i:|a;Ypy%<font style="font-size:8pt" Face="Courier New" >~</font>1E(U#%#%</span>
 instance 1                                                                     
  description Instanceforpoint-by-pointtest                                     
  dcp 1.1.1.1     
  dcp 2.2.2.2    
  dcp 4.4.4.4   
  loss-measure ratio-threshold upper-limit 10.000000 lower-limit 5.000000       
  delay-measure two-way delay-threshold upper-limit 100000 lower-limit 50000    
  ach 1   
   flow forward      
   in-group dcp 1.1.1.1 tlp 100                                             
   out-group dcp 2.2.2.2 tlp 200                                           
  ach 2                                                                         
   flow forward                                                                 
   in-group dcp 2.2.2.2 tlp 200                                           
   out-group dcp 4.4.4.4 tlp 310                                          
#                                                                               
return </pre>
</li><li><p>SPE1 configuration file</p>
<pre class="screen">#                                                                               
sysname SPE1                                                                 
#
ptp enable
ptp domain 1
ptp device-type bc
ptp clock-source local clock-class 185
#
clock source bits0 synchronization enable
clock source bits0 priority 1
clock source ptp synchronization enable
clock source ptp priority 1
clock bits-type bits0 2mhz
#                                                                               
tunnel-selector bindTE permit node 10                                           
 apply tunnel-policy policy1                                                    
#                                                                               
mpls lsr-id 2.2.2.2                                                             
mpls                                                                            
 mpls te                                                                        
 label advertise non-null                                                       
 mpls rsvp-te                                                                   
 mpls te cspf                                                                   
#                                                                               
mpls ldp                                                                        
#                                                                               
ntp-service sync-interval 180                    
ntp-service unicast-server 172.16.1.1                                            
#                                                                               
interface GigabitEthernet<span>0/1/1</span>                                                  
 undo shutdown                                                                  
 ip address 172.16.1.2 255.255.255.0                                             
 mpls                                                                           
 mpls te                                                                        
 mpls rsvp-te                                                                   
 ptp enable
 ipfpm tlp 200                                                                       
#                                                                               
interface GigabitEthernet<span>0/1/2</span>                                                  
 undo shutdown                                                                  
 ip address 172.16.4.1 255.255.255.0                                             
 mpls                                                                           
 mpls ldp                                                                       
 ptp enable
#                                                                               
interface GigabitEthernet<span>0/1/3</span>                                                  
 undo shutdown                                                                  
 ip address 172.16.3.1 255.255.255.0                                             
 mpls                                                                           
 mpls ldp                                                                       
#                                                                               
interface GigabitEthernet<span>0/1/4</span>                                                  
 undo shutdown                                                                  
 ip address 172.16.6.1 255.255.255.0                                             
 ptp enable
#                                                                               
interface LoopBack1                                                             
 ip address 2.2.2.2 255.255.255.255                                                 
#                                                                               
interface Tunnel11                                                           
 ip address unnumbered interface LoopBack1                                      
 tunnel-protocol mpls te                                                        
 destination 1.1.1.1                                                            
 mpls te tunnel-id 100                                                          
 mpls te reserved-for-binding                                                   
#                                                                               
bgp 100                                                                         
 router-id 2.2.2.2                                                              
 peer 1.1.1.1 as-number 100                                                     
 peer 1.1.1.1 connect-interface LoopBack1                                       
 peer 3.3.3.3 as-number 100                                                     
 peer 3.3.3.3 connect-interface LoopBack1                                       
 peer 4.4.4.4 as-number 100                                                     
 peer 4.4.4.4 connect-interface LoopBack1                                       
 #                                                                              
 ipv4-family unicast                                                            
  undo synchronization
  peer 1.1.1.1 enable                                                           
  peer 3.3.3.3 enable                                                           
  peer 4.4.4.4 enable                                                           
 #                                                                              
 ipv4-family vpnv4                                                              
  undo policy vpn-target                                                        
  tunnel-selector bindTE                                                        
  peer 1.1.1.1 enable                                                           
  peer 1.1.1.1 reflect-client                                                   
  peer 1.1.1.1 next-hop-local                                                   
  peer 3.3.3.3 enable                                                           
  peer 4.4.4.4 enable                                                           
  peer 4.4.4.4 reflect-client                                                   
  peer 4.4.4.4 next-hop-local                                                   
#                                                                               
ospf 1                                                                          
 opaque-capability enable                                                       
 area 0.0.0.0                                                                   
  network 2.2.2.2 0.0.0.0                                                       
  network 172.16.1.0 0.0.0.255                                                   
  network 172.16.3.0 0.0.0.255                                                   
  network 172.16.4.0 0.0.0.255                                                   
  mpls-te enable                                                                
#                                                                               
tunnel-policy policy1                                                           
 tunnel binding destination 1.1.1.1 te Tunnel11                              
#                                                                               
nqa ipfpm dcp                                                                   
 dcp id 2.2.2.2                                                                 
 mcp 1.1.1.1 port 2048                                                          
 authentication-mode hmac-sha256 key-id 1 cipher <span>#%#%/#(8ARUz1+=(sUrXdsM1P.x#%#%</span> 
 color-flag loss-measure tos-bit 3 delay-measure tos-bit 4 
 instance 1                                                                     
  description Instanceforpointbypointtest                                       
  flow forward source 10.1.1.1 destination 10.2.1.1                           
  tlp 200 mid-point flow forward ingress vpn-label 17 lsp-label 18  
#                                                                               
return</pre>
</li><li><p>SPE2 configuration file</p>
<pre class="screen">#                                                                               
sysname SPE2                                                                 
#                                                                               
tunnel-selector bindTE permit node 10                                           
 apply tunnel-policy policy1                                                    
#                                                                               
mpls lsr-id 3.3.3.3                                                             
mpls                                                                            
 mpls te                                                                        
 label advertise non-null                                                       
 mpls rsvp-te                                                                   
 mpls te cspf                                                                   
#                                                                               
mpls ldp                                                                        
#                                                                               
interface GigabitEthernet<span>0/1/1</span>                                                  
 undo shutdown                                                                  
 ip address 172.16.5.1 255.255.255.0                                             
 mpls                                                                           
 mpls ldp                                                                       
#                                                                               
interface GigabitEthernet<span>0/1/2</span>                                                  
 undo shutdown                                                                  
 ip address 172.16.2.2 255.255.255.0                                             
 mpls                                                                           
 mpls te                                                                        
 mpls rsvp-te                                                                   
#                                                                               
interface GigabitEthernet<span>0/1/3</span>                                                  
 undo shutdown                                                                  
 ip address 172.16.3.2 255.255.255.0                                             
 mpls                                                                           
 mpls te                                                                        
 mpls ldp                                                                       
#                                                                               
interface LoopBack1                                                             
 ip address 3.3.3.3 255.255.255.255                                             
#                                                                               
interface Tunnel12                                                           
 ip address unnumbered interface LoopBack1                                      
 tunnel-protocol mpls te                                                        
 destination 1.1.1.1                                                            
 mpls te tunnel-id 200                                                          
 mpls te reserved-for-binding                                                   
#                                                                               
bgp 100                                                                         
 router-id 3.3.3.3                                                              
 peer 1.1.1.1 as-number 100                                                     
 peer 1.1.1.1 connect-interface LoopBack1                                       
 peer 2.2.2.2 as-number 100                                                     
 peer 2.2.2.2 connect-interface LoopBack1                                       
 peer 4.4.4.4 as-number 100                                                     
 peer 4.4.4.4 connect-interface LoopBack1                                       
 #                                                                              
 ipv4-family unicast                                                            
  undo synchronization
  peer 1.1.1.1 enable                                                           
  peer 2.2.2.2 enable                                                           
  peer 4.4.4.4 enable                                                           
 #                                                                              
 ipv4-family vpnv4                                                              
  undo policy vpn-target                                                        
  tunnel-selector bindTE                                                        
  peer 1.1.1.1 enable                                                           
  peer 1.1.1.1 reflect-client                                                   
  peer 1.1.1.1 next-hop-local                                                   
  peer 2.2.2.2 enable                                                           
  peer 4.4.4.4 enable                                                           
  peer 4.4.4.4 reflect-client                                                   
  peer 4.4.4.4 next-hop-local                                                   
#                                                                               
ospf 1                                                                          
 opaque-capability enable                                                       
 area 0.0.0.0                                                                   
  network 3.3.3.3 0.0.0.0                                                       
  network 172.16.2.0 0.0.0.255                                                   
  network 172.16.3.0 0.0.0.255                                                   
  network 172.16.5.0 0.0.0.255                                                   
  mpls-te enable                                                                
#                                                                               
tunnel-policy policy1                                                           
 tunnel binding destination 1.1.1.1 te Tunnel12                              
#                                                                               
return</pre>
</li><li><p>NPE configuration file</p>
<pre class="screen">#
sysname NPE
#
ptp enable
ptp domain 1
ptp device-type bc
ptp clock-source local clock-class 185
#
clock source ptp synchronization enable
clock source ptp priority 1
#
ip vpn-instance vpna
 ipv4-family
  route-distinguisher 100:1
  apply-label per-instance
  vpn-target 1:1 export-extcommunity
  vpn-target 1:1 import-extcommunity
#
mpls lsr-id 4.4.4.4
mpls
#
mpls ldp
#
ntp-service sync-interval 180
ntp-service unicast-server 172.16.4.1
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 172.16.5.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ip address 172.16.4.2 255.255.255.0
 mpls
 mpls ldp
 ptp enable
#
interface GigabitEthernet<span>0/1/3</span>
 undo shutdown
 ip binding vpn-instance vpna
 ip address 192.168.2.1 255.255.255.0
 ptp enable
 ipfpm tlp 310
#
interface LoopBack1
 ip address 4.4.4.4 255.255.255.255
#
bgp 100
 router-id 4.4.4.4
 peer 2.2.2.2 as-number 100
 peer 2.2.2.2 connect-interface LoopBack1
 peer 3.3.3.3 as-number 100
 peer 3.3.3.3 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 2.2.2.2 enable
  peer 3.3.3.3 enable
 #
 ipv4-family vpnv4
  policy vpn-target
  peer 2.2.2.2 enable
  peer 3.3.3.3 enable
 #
 ipv4-family vpn-instance vpna
  import-route direct
  auto-frr
#
ospf 1
 area 0.0.0.0
  network 4.4.4.4 0.0.0.0
  network 172.16.4.0 0.0.0.255
  network 172.16.5.0 0.0.0.255
#
nqa ipfpm dcp
 dcp id 4.4.4.4
 mcp 1.1.1.1 port 2048
 authentication-mode hmac-sha256 key-id 1 cipher <span>#%#%Se9P&gt;q&gt;D&gt;<font style="font-size:8pt" Face="Courier New" >~</font>v\Es$K{z2H1VW##%#%</span>
 color-flag loss-measure tos-bit 3 delay-measure tos-bit 4
 instance 1
  description Instanceforpointbypointtest
  flow forward source 10.1.1.1 destination 10.2.1.1 
  tlp 310 out-point egress
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ipfpm_cfg_0012.html">IP FPM Configuration Examples
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ipfpm_cfg_0013.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>
</body>
</html>