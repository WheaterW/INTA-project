
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring 1588 ATR Time Synchronization in Server-and-Client Mode">
<meta name="abstract" content="">
<meta name="description" content="">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_atr_cfg_9010.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_atr_cfg_9011.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="1588 ATR">
<meta name="featuretype" content="System Management">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="1588 ATR">
<meta name="featuretype" content="System Management">
<meta name="featurename" content="1588 ATR">
<meta name="featuretype" content="System Management">
<meta name="OWNER" content="w00845984,l00587852">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="w00845984">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001782197726">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring 1588 ATR Time Synchronization in Server-and-Client Mode</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001782197726"></a><a name="EN-US_TASK_0000001782197726"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring 1588 ATR Time Synchronization in Server-and-Client Mode</h1>
<div class="taskbody"><p></p>
<div class="context"><a name="EN-US_TASK_0000001782197726__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0000001782197726__fig169571636162013">Figure 1</a>, the <span class="keyword">NE40E</span> can be directly connected to a time server and be configured to work in 1588 ATR server-and-client mode. The T-BC can be connected to a base station or a hierarchical node to output time signals to the downstream device. The interface that directly connects T-BC1 to the time server needs to be configured to work in G.8275.1 mode. Some NEs on the intermediate microwave network do not support clock synchronization, but network devices can properly communicate with each other.</p>
<div class="fignone" id="EN-US_TASK_0000001782197726__fig169571636162013"><a name="EN-US_TASK_0000001782197726__fig169571636162013"></a><a name="fig169571636162013"></a><span class="figcap"><b>Figure 1 </b>T-BC time synchronization</span><br><span><img class="vsd" src="figure/en-us_image_0000001782197738.png"></span></div>
<h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ul><li>On the upstream device:</li></ul>
<ol><li>Enable ITU-T G.8275.1, set the device type to T-BC, and enable 1588 ATR time source synchronization.</li><li>Enable 1588 ATR.</li><li>Configure the device to support ITU-T G.8275.2.</li><li>Configure the device to work in server-and-client mode.</li><li>Configure the local IP address of the master-only-vport.</li><li>Configure an IP address for the outbound interface and enable ATR on the interface.</li><li>Enable unicast negotiation.</li><li>Verify the configuration.</li></ol>
<ul><li>On the downstream device:</li></ul>
<ol><li>Enable 1588v2, set the device type to BC, and enable 1588 ATR time synchronization.</li><li>Enable 1588 ATR.</li><li>Configure the device to support ITU-T G.8275.2.</li><li>Configure the device to work in server-and-client mode.</li><li>Configure the local IP address of the vport and the list of remote clock servers that support negotiation.</li><li>Configure an IP address for the inbound interface and enable ATR on the interface.</li><li>Enable unicast negotiation.</li><li><p>Verify the configuration.</p>
</li></ol>
<h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>Local IP address of the upstream device</p>
</li><li>Local IP address of the downstream device</li><li><p>Outbound interface of upstream 1588 ATR packets</p>
</li><li>Inbound interface of downstream 1588 ATR packets</li></ul>
</div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001782197726__1.4.2"></a><a name="1.4.2"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Enable ITU-T G.8275.1 and 1588 ATR time source synchronization on T-BC1.</span><p><pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>ptp enable</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>ptp profile g-8275-1 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>ptp device-type t-bc</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>]<strong> ptp clock-source atr enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>]<strong> commit</strong></pre>
</p></li><li><span>Enable 1588 ATR time source synchronization on T-BC2.</span><p><pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>ptp enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>ptp device-type bc</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>]<strong> ptp clock-source atr enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>]<strong> commit</strong></pre>
</p></li><li><span>Enable 1588 ATR on the device, configure the device to support ITU-T G.8275.2, and configure the device to work in server-and-client mode.</span><p><p># Configure T-BC1.</p>
</p><p><pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname</strong> <strong>T-BC1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>T-BC1] <strong>ptp-adaptive enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>T-BC1] <strong>ptp-adaptive time profile</strong> </pre>
<pre class="screen">[<span class="keyword">*</span>T-BC1] <strong>ptp-adaptive </strong><strong>device-type server-and-client</strong></pre>
<pre class="screen">[<span class="keyword">*</span>T-BC1]<strong> commit</strong></pre>
<p># Enable 1588 ATR on T-BC2, configure T-BC2 to support ITU-T G.8275.2, and configure T-BC2 to work in server-and-client mode. The configuration is similar to that on T-BC1.</p>
</p></li><li><span>Configure the master-only-vport information on T-BC1.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>T-BC1] <strong>ip vpn-instance vpn1</strong> </pre>
<pre class="screen">[<span class="keyword">*</span>T-BC1-vpn-instance-vpn1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>T-BC1-vpn-instance-vpn1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>T-BC1] <strong>ptp-adaptive master-only-vport 1 port-ip 10.1.1.2</strong> <strong>vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>T-BC1]<strong> commit</strong></pre>
</p></li><li><span>Configure the vport of T-BC2 and the list of remote clock servers.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>T-BC2] <strong>ip vpn-instance vpn1</strong> </pre>
<pre class="screen">[<span class="keyword">*</span>T-BC2-vpn-instance-vpn1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>T-BC2-vpn-instance-vpn1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>T-BC2] <strong>ptp-adaptive vport 1</strong> <strong>port-ip</strong> <strong>10.1.1.1</strong> <strong>vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>T-BC2] <strong>ptp-adaptive vport 1</strong> <strong>remote-port-ip 10.1.1.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>T-BC2]<strong> commit</strong></pre>
</p></li><li><span>Enable ATR on an interface and configure a local IP address for the interface.</span><p><p># Configure T-BC1.</p>
</p><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>T-BC1] <strong>interface gigabitethernet <span>0/2/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>T-BC1-GigabitEthernet<span>0/2/1</span>] <strong>ptp-adaptive atr enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>T-BC1-GigabitEthernet<span>0/2/1</span>] <strong>ip binding vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>T-BC1-GigabitEthernet<span>0/2/1</span>] <strong>ip address</strong> <strong>10.1.1.2</strong> <strong>24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>T-BC1-GigabitEthernet<span>0/2/1</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>T-BC1-GigabitEthernet<span>0/2/1</span>]<strong> quit</strong></pre>
<p># Configure T-BC2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>T-BC2] <strong>interface gigabitethernet <span>0/2/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>T-BC2-GigabitEthernet<span>0/2/1</span>] <strong>ptp-adaptive atr enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>T-BC2-GigabitEthernet<span>0/2/1</span>] <strong>ip binding vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>T-BC2-GigabitEthernet<span>0/2/1</span>] <strong>ip address</strong> <strong>10.1.1.1</strong> <strong>24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>T-BC2-GigabitEthernet<span>0/2/1</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>T-BC2-GigabitEthernet<span>0/2/1</span>]<strong> quit</strong></pre>
</p></li><li><span>Enable unicast negotiation.</span><p><p># Configure T-BC1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>T-BC1] <strong>ptp-adaptive atr unicast-negotiate enable</strong> 
[<span class="keyword">*</span>T-BC1]<strong> commit</strong></pre>
<p># Enable unicast negotiation on T-BC2. The configuration is similar to that on T-BC1.</p>
</p></li><li><span>Verify the configuration.</span><p><p># Display all configurations of the 1588 ATR module.</p>
<pre class="screen">&lt;T-BC1&gt; <strong>display ptp-adaptive all</strong></pre>
<pre class="screen">Device config info                                                                                                                
  ------------------------------------------------------------------------------                                                    
  Ptp adaptive state      :enable           Device type        :server-and-client
  Sync mode               :time             Current state      :master+slave
  Packet dscp             :56               Domain value       :44                                                                  
  Announce interval       :10               Announce duration  :300s                                                                
  Sync interval           :3                Sync duration      :300s                                                                
  Delay_resp interval     :3                Delay_resp duration:300s                                                                
  Announce receipt timeout:3                One-way or two-way :two-way                                                             
  Profile                 :time                                                                
  
  BMCA run info                                                                                                                     
  ------------------------------------------------------------------------------                                                    
  Current trace source    :local                                                                                                    

  Vport list                                                                                                                        
  ------------------------------------------------------------------------------                                                    
  ID  Port state   Negotiate state                                                                                                  

  Master-only-vport list                                                                                                            
  ------------------------------------------------------------------------------                                                    
  ID  Ip Address      VPN                                      Client number                                                        
  1   10.1.1.2        vpn1                                     1  </pre>
<p># Display information about successful negotiation of T-BC2.</p>
<pre class="screen">&lt;T-BC2&gt; <strong>display ptp-adaptive all</strong></pre>
<pre class="screen">  Device config info                                                                                                                
  ------------------------------------------------------------------------------                                                    
  Ptp adaptive state      :enable         Device type        :server-and-client                                                     
  Sync mode               :time           Current state      :master+slave                                                          
  Packet dscp             :56             Domain value       :44                                                                    
  Announce interval       :10             Announce duration  :300s                                                                  
  Sync interval           :3              Sync duration      :300s                                                                  
  Delay_resp interval     :3              Delay_resp duration:300s                                                                  
  Announce receipt timeout:3              One-way or two-way :two-way                                                               
  Profile                 :time                                                                                                     

  BMCA run info                                                                                                                     
  ------------------------------------------------------------------------------                                                    
  Current trace source    :vport 1                                                                                                  

  Time performance statistics                                                                                                       
  ------------------------------------------------------------------------------                                                    
  Realtime(T2-T1)   :+0s, 127ns                                                                                                     
  Max(T2-T1)        :+11163s, 2057757ns                                                                                             
  Min(T2-T1)        :-0s, 62882358ns                                                                                                
  Realtime(T4-T3)   :+0s, 119ns                                                                                                     
  Max(T4-T3)        :+114224s, 804881946ns                                                                                          
  Min(T4-T3)        :-0s, 110ns                                                                                                     

  Vport list                                                                                                                        
  ------------------------------------------------------------------------------                                                    
  ID  Port state   Negotiate state                                                                                                  
  1   slave        Nego success</pre>
<p># Display 1588 ATR vport information.</p>
<pre class="screen">&lt;T-BC1&gt; <strong>display ptp-adaptive </strong><strong>master-only-vport</strong></pre>
<pre class="screen">  Master-only-vport list                                                                                                            
  ------------------------------------------------------------------------------                                                    
  ID  Ip Address      VPN                                      Client number                                                        
  1   10.1.1.2        vpn1                                     1                                                                    

  Master-only-vport 1 client list                                                                                                   
      ID  Ip Address      Clock ID          Mode     Announce  Sync  Delay_resp                                                     
  ------------------------------------------------------------------------------                                                    
  0   14  10.1.1.1        202008fffe261204  two-way  0         -7    -7   </pre>
<p># Display vport information on the downstream device.</p>
<pre class="screen">&lt;T-BC2&gt; <strong>display ptp-adaptive vport</strong></pre>
<pre class="screen">  Vport 1                                                                                                                           
  ------------------------------------------------------------------------------                                                    
  VPN                     :vpn1 
  Local ip                :10.1.1.1         Remote port ip     :10.1.1.2                                                            
  Negotiate state         :Nego success                                                                                             
  Port state              :slave            Clock Class        :6                                                                   
  Pri2                    :128              Accuracy           :0xFE                                                                
  Local priority          :128              Asymmetry(ns)      :0    </pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001782197726__1.4.3"></a><a name="1.4.3"></a><h4 class="sectiontitle">Configuration Files</h4><p>T-BC1 configuration file</p>
<pre class="screen">#
sysname T-BC1
#
ptp-adaptive enable
ptp-adaptive time profile
ptp-adaptive device-type server-and-client                                                                                          
ptp-adaptive atr unicast-negotiate enable                                                                                           
ptp-adaptive master-only-vport 1 port-ip 10.1.1.2  
#                                                                                                                             
ptp enable                                                                                                                          
ptp profile g-8275-1 enable
ptp device-type t-bc
ptp clock-source atr enable
#   
interface GigabitEthernet<span>0/2/1</span>
 undo shutdown
 ip binding vpn-instance vpn1
 ip address 10.1.1.2 255.255.255.0
 ptp-adaptive atr enable
#
return</pre>
<p>T-BC2 configuration file</p>
<pre class="screen">#
sysname T-BC2
#
ptp-adaptive enable
ptp-adaptive time profile
ptp-adaptive device-type server-and-client                                                                                          
ptp-adaptive atr unicast-negotiate enable                                                                                           
ptp-adaptive vport 1 port-ip 10.1.1.1                                                                                               
ptp-adaptive vport 1 remote-port-ip 10.1.1.2 
#
ptp enable                                                                                                                          
ptp device-type bc   
                                                                                                               
ptp clock-source atr enable
# 
interface GigabitEthernet<span>0/2/1</span>
 undo shutdown
 ip binding vpn-instance vpn1
 ip address 10.1.1.1 255.255.255.0
 ptp-adaptive atr enable
# 
return</pre>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_atr_cfg_9010.html">Configuration Examples for 1588 ATR
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_atr_cfg_9011.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>
</body>
</html>