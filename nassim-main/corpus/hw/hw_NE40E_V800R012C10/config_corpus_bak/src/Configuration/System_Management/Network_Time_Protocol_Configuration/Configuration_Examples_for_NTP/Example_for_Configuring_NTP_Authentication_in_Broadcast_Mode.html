
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring NTP Authentication in Broadcast Mode">
<meta name="abstract" content="On a LAN, the device with high clock precision functions as the NTP server, and other devices are synchronized to the clock of the NTP server. In the broadcast mode, you do not need to specify a server for the client, and the client listens to packets sent from the broadcast server in real time.">
<meta name="description" content="On a LAN, the device with high clock precision functions as the NTP server, and other devices are synchronized to the clock of the NTP server. In the broadcast mode, you do not need to specify a server for the client, and the client listens to packets sent from the broadcast server in real time.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ntp_cfg_0026.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ntp_cfg_0028.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ntp_cfg_0030.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,jwx1168690,w00556928,w00437000,w00845984,w00606909,l00455378,ntpvrp">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="NTP">
<meta name="featuretype" content="System Management">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="NTP">
<meta name="featuretype" content="System Management">
<meta name="featurename" content="NTP">
<meta name="featuretype" content="System Management">
<meta name="OWNER" content="w00845984,lwx1238418,l00587852">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="lWX1238418">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001800928874">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring NTP Authentication in Broadcast Mode</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001800928874"></a><a name="EN-US_TASK_0000001800928874"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring NTP Authentication in Broadcast Mode</h1>
<div class="taskbody"><p>On a LAN, the device with high clock precision functions as the NTP server, and other devices are synchronized to the clock of the NTP server. In the broadcast mode, you do not need to specify a server for the client, and the client listens to packets sent from the broadcast server in real time.</p>
<div class="context"><a name="EN-US_TASK_0000001800928874__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0000001800928874__fig_dc_vrp_ntp_cfg_002901">Figure 1</a>:</p>
<ul><li><p><span class="keyword">Device</span>C and <span class="keyword">Device</span>D are on the same network segment.</p>
</li><li><p><span class="keyword">Device</span>C functions as an NTP broadcast server, and its clock is a stratum 3 NTP master clock. Broadcast packets are sent from GE<span>0/1/0</span>.</p>
</li><li><p><span class="keyword">Device</span>D listens to broadcast messages on GE<span>0/1/0</span>.</p>
</li><li><p>NTP authentication needs to be enabled on <span class="keyword">Device</span>C and <span class="keyword">Device</span>D.</p>
</li></ul>
<div class="fignone" id="EN-US_TASK_0000001800928874__fig_dc_vrp_ntp_cfg_002901"><a name="EN-US_TASK_0000001800928874__fig_dc_vrp_ntp_cfg_002901"></a><a name="fig_dc_vrp_ntp_cfg_002901"></a><span class="figcap"><b>Figure 1 </b>Configuring NTP authentication in broadcast mode</span><br><span><img class="vsd" src="figure/en-us_image_0000001847727717.png" width="NaN" height="NaN"></span></div>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface1 represents GE<span>0/1/0</span>.</p>
</div></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001800928874__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Precautions</h4><p>Before configuring a key on the client and server, ensure that the key already exists.</p>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001800928874__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure <span class="keyword">Device</span>C as an NTP broadcast server.</p>
</li><li><p>Configure <span class="keyword">Device</span>D as an NTP broadcast client.</p>
</li><li><p>Configure NTP authentication on <span class="keyword">Device</span>C and <span class="keyword">Device</span>D.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001800928874__1.4.4"></a><a name="1.4.4"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>Interface IP addresses of <span class="keyword">Router</span>s</p>
</li><li><p>Stratum of the NTP master clock</p>
</li><li><p>Authentication key and key ID. The HMAC-SHA256 algorithm is used to verify the key.</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001800928874__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure an IP address for each <span class="keyword">Router</span>.</span><p><p>Configure IP addresses based on <a href="#EN-US_TASK_0000001800928874__fig_dc_vrp_ntp_cfg_002901">Figure 1</a>. For configuration details, see Configuration Files.</p>
</p></li><li><span>Configure an NTP broadcast server and enable NTP authentication on it.</span><p><p># Set the local clock on <span class="keyword">Device</span>C as a stratum 3 NTP master clock.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname DeviceC</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong> </pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C]<strong> ntp-service refclock-master 3</strong></pre>
<p># Specify a listening interface on <span class="keyword">Device</span>C.</p>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C] <strong>ntp-service server source-interface gigabitethernet <span>0/1/0</span> </strong></pre>
<p># Enable NTP authentication.</p>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C]<strong> ntp-service authentication enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C]<strong> ntp-service authentication-keyid 16 authentication-mode hmac-sha256 cipher Hello123</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C]<strong> ntp-service reliable authentication-keyid 16</strong></pre>
<p># Configure <span class="keyword">Device</span>C to be an NTP broadcast server. Broadcast packets are encrypted by using the authentication key ID 16 and then sent from GE<span>0/1/0</span>.</p>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-GigabitEthernet<span>0/1/0</span>]<strong> ntp-service broadcast-server authentication-keyid 16</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-GigabitEthernet<span>0/1/0</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
</p></li><li><span>Configure <span class="keyword">Device</span>D as an NTP broadcast client which is on the same network segment as that of the NTP server.</span><p><p># Enable NTP authentication.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname DeviceD</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong> </pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>D]<strong> ntp-service authentication enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D]<strong> ntp-service authentication-keyid 16 authentication-mode hmac-sha256 cipher Hello123</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D]<strong> ntp-service reliable authentication-keyid 16</strong></pre>
<p># Configure <span class="keyword">Device</span>D as an NTP broadcast client. <span class="keyword">Device</span>D listens to the broadcast packets on GE<span>0/1/0</span>.</p>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-GigabitEthernet<span>0/1/0</span>]<strong> ntp-service broadcast-client</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-GigabitEthernet<span>0/1/0</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>D-GigabitEthernet<span>0/1/0</span>]<strong> quit</strong></pre>
<p>After the configurations are complete, the clock on <span class="keyword">Device</span>D can be synchronized with the clock on <span class="keyword">Device</span>C.</p>
</p></li><li><span>Verify the configuration.</span><p><p>After completing the configurations, check that <span class="keyword">Device</span>D can synchronize its clock with <span class="keyword">Device</span>C.</p>
<p>Check the NTP status on <span class="keyword">Device</span>D. You can find that the clock status is <strong>synchronized</strong>. The stratum of the clock is 4, one stratum lower than that on <span class="keyword">Device</span>C.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>D]<strong> display ntp-service status</strong></pre>
<pre class="screen"> clock status: synchronized</pre>
<pre class="screen"> clock stratum: 4</pre>
<pre class="screen"> reference clock ID: 10.0.1.31</pre>
<pre class="screen"> nominal frequency: 60.0002 Hz</pre>
<pre class="screen"> actual frequency: 60.0002 Hz</pre>
<pre class="screen"> clock precision: 2^18</pre>
<pre class="screen"> clock offset: 0.0000 ms</pre>
<pre class="screen"> root delay: 0.00 ms</pre>
<pre class="screen"> root dispersion: 0.42 ms</pre>
<pre class="screen"> peer dispersion: 0.00 ms</pre>
<pre class="screen"> reference time: 12:17:21.773 UTC Mar 7 2006(C7B7F851.C5EAF25B)</pre>
<pre class="screen"> synchronization state: clock synchronized</pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001800928874__1.4.6"></a><a name="1.4.6"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p><span class="keyword">Device</span>C configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname <span class="keyword">Device</span>C</pre>
<pre class="screen">#</pre>
<pre class="screen">ntp-service authentication-keyid 16 authentication-mode hmac-sha256 cipher %#%#&gt;hD8))_H-XZVut2u3!_0lq3,+Ph=:OE}pX;T2M'9%#%#</pre>
<pre class="screen">ntp-service reliable authentication-keyid 16</pre>
<pre class="screen">ntp-service refclock-master 3</pre>
<pre class="screen">ntp-service authentication enable</pre>
<pre class="screen">ntp-service server source-interface gigabitethernet <span>0/1/0</span> </pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.0.1.31 255.255.255.0</pre>
<pre class="screen"> ntp-service broadcast-server authentication-keyid 16</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p><span class="keyword">Device</span>D configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname <span class="keyword">Device</span>D</pre>
<pre class="screen">#</pre>
<pre class="screen">ntp-service authentication-keyid 16 authentication-mode hmac-sha256 cipher %#%#m:fVJfk*r&amp;3x"1J`21^K`Y;LH;B+g(t2&lt;ZX^}Q_<font style="font-size:8pt" Face="Courier New" >~</font>%#%#</pre>
<pre class="screen">ntp-service reliable authentication-keyid 16</pre>
<pre class="screen">ntp-service authentication enable</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.0.1.32 255.255.255.0</pre>
<pre class="screen"> ntp-service broadcast-client</pre>
<pre class="screen">#</pre>
<pre class="screen">Return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ntp_cfg_0026.html">Configuration Examples for NTP
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ntp_cfg_0028.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ntp_cfg_0030.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>