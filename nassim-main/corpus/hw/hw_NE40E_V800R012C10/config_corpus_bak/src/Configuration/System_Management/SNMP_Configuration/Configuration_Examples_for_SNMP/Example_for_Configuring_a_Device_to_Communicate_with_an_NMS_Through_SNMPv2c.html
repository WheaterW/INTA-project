
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring a Device to Communicate with an NMS Through SNMPv2c">
<meta name="abstract" content="This section provides an example to describe how to configure a device to communicate with an NMS through SNMPv2c and how to specify the MIB objects that can be managed by the NMS.">
<meta name="description" content="This section provides an example to describe how to configure a device to communicate with an NMS through SNMPv2c and how to specify the MIB objects that can be managed by the NMS.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_snmp_cfg_0022.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_snmp_cfg_0023.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_snmp_cfg_0025.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,jwx1168690,w00556928,w00437000,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="SNMP">
<meta name="featuretype" content="System Management">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="SNMP">
<meta name="featuretype" content="System Management">
<meta name="featurename" content="SNMP">
<meta name="featuretype" content="System Management">
<meta name="featurename" content="SNMP">
<meta name="OWNER" content="j00655225">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="j00655225">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172361038">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring a Device to Communicate with an NMS Through SNMPv2c</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172361038"></a><a name="EN-US_TASK_0172361038"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring a Device to Communicate with an NMS Through SNMPv2c</h1>
<div class="taskbody"><p>This section provides an example to describe how to configure a device to communicate with an NMS through SNMPv2c and how to specify the MIB objects that can be managed by the NMS.</p>
<div class="context"><a name="EN-US_TASK_0172361038__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0172361038__fig_dc_vrp_snmp_cfg_002401">Figure 1</a>, two NMSs (NMS1 and NMS2) and the <span class="keyword">Router</span> are connected across a public network. According to the network planning, NMS2 can manage every MIB object on the <span class="keyword">Router</span>, and NMS1 does not manage the <span class="keyword">Router</span>.</p>
<p>On the <span class="keyword">Router</span>, only the modules that are enabled by default are allowed to send alarms to NMS2. This prevents an excess of unwanted alarms from being sent to NMS2. Excessive alarms make fault location difficult. Inform messages need to be used to ensure that alarms are received by NMS2 because alarms sent by the <span class="keyword">Router</span> have to travel across the public network to reach NMS2.</p>
<p>Contact information of the device administrator needs to be configured on the <span class="keyword">Router</span>. This helps the NMS administrator contact the device administrator if a fault occurs.</p>
<div class="fignone" id="EN-US_TASK_0172361038__fig_dc_vrp_snmp_cfg_002401"><a name="EN-US_TASK_0172361038__fig_dc_vrp_snmp_cfg_002401"></a><a name="fig_dc_vrp_snmp_cfg_002401"></a><span class="figcap"><b>Figure 1 </b>Networking diagram for configuring a device to communicate with an NMS through SNMPv2c</span><br><span><img class="vsd" src="images/fig_dc_vrp_snmp_cfg_002401.png"></span><br></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172361038__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Enable the SNMP agent.</p>
</li><li><p>Configure the <span class="keyword">Router</span> to run SNMPv2c.</p>
</li><li>Configure a source interface for SNMP to receive and respond to NMS request packets.</li><li><p>Configure an ACL to allow NMS2 to manage every MIB object on the <span class="keyword">Router</span>.</p>
</li><li><p>Configure the Inform function to allow the <span class="keyword">Router</span> to send Inform messages to NMS2.</p>
</li><li><p>Configure the contact information of the device administrator.</p>
</li><li><p>Configure NMS2.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172361038__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>SNMP version</p>
</li><li><p>Community name</p>
</li><li><p>ACL number</p>
</li><li><p>IP address of the NMS</p>
</li><li><p>Contact information of the device administrator</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172361038__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure available routes between the <span class="keyword">Router</span> and the NMSs. Details for the configuration procedure are not provided here.</span></li><li><span>Enable the SNMP agent.</span><p><pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt;<strong> system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname <span class="keyword">Device</span>A</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>snmp-agent password min-length 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>snmp-agent</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
</p></li><li><span>Configure the <span class="keyword">Router</span> to run SNMPv2c.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>snmp-agent sys-info version v2c</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
<p># Check the configured SNMP version.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>display snmp-agent sys-info version</strong></pre>
<pre class="screen">SNMP version running in the system:</pre>
<pre class="screen">           SNMPv2c SNMPv3</pre>
</p></li><li><span>Configure a source interface for SNMP to receive and respond to NMS request packets.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>snmp-agent protocol source-interface</strong> <strong>Loopback0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
</p></li><li><span>Configure access permissions of the NMSs.</span><p><div class="p"># Configure an ACL to allow NMS2 to manage and disallow NMS1 from managing the <span class="keyword">Router</span>.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>acl 2001</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-acl4-basic-2001] <strong>rule 5 permit source 1.1.1.2 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-acl4-basic-2001] <strong>rule 6 deny source 1.1.1.1 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-acl4-basic-2001] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-acl4-basic-2001] <strong>quit</strong></pre>
</div>
<p># Configure a MIB view.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>snmp-agent mib-view excluded allexthgmp 1.3.6.1.4.1.2011.6.7</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
<p># Configure a community name<span> to reference an ACL</span> to allow NMS2 to manage the objects in the MIB view.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>snmp-agent community write adminnms2 mib-view allexthgmp<span> acl 2001</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
</p></li><li><span>Configure the trap function.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>snmp-agent target-host inform address udp-domain 1.1.1.2 params securityname cipher YsHsjx_202206 v2c</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>snmp-agent inform timeout 5 resend-times 6 pending 7</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>snmp-agent trap enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>snmp-agent notification-log enable</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>snmp-agent notification-log global-ageout 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
</p></li><li><span>Configure the contact information of the device administrator.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>snmp-agent sys-info contact call Operator at 010-12345678</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
</p></li><li><span>Configure NMS2.</span><p><p>For details on how to configure NMS2, see the relevant NMS configuration guide.</p>
</p></li><li><span>Verify the configuration.</span><p><p>After the configuration is complete, run the following commands to verify that the configuration has taken effect.</p>
<p># Check the configured SNMP version.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>display snmp-agent sys-info version</strong></pre>
<pre class="screen">SNMP version running in the system:</pre>
<pre class="screen">           SNMPv2c</pre>
<p># Check information about the SNMP community name.</p>
<pre class="screen">&lt;<span class="keyword">Device</span>A&gt; <strong>display snmp-agent community</strong></pre>
<pre class="screen">   Community name: %#%#qTp*MccD#Z[sHw4"pbzVHzAfO]gWN;h#30K=)%}X1jIHNF&lt;QdMskYG$9xj:9k\EZN6Mi!Hrt@\Oa8tqP%#%#
       Group name: %#%#qTp*MccD#Z[sHw4"pbzVHzAfO]gWN;h#30K=)%}X1jIHNF&lt;QdMskYG$9xj:9k\EZN6Mi!Hrt@\Oa8tqP%#%#
<span>       Acl: 2001 </span>       Storage-type: nonVolatile</pre>
<div class="p"># Check the configured ACL.<pre class="screen">&lt;<span class="keyword">Device</span>A&gt; <strong>display acl 2001</strong></pre>
<pre class="screen">Basic ACL 2001, 2 rules
Acl's step is 5
 rule 5 permit source 1.1.1.2 0 (0 times matched)
 rule 6 deny source 1.1.1.1 0 (0 times matched)</pre>
</div>
<p># Check the MIB view.</p>
<pre class="screen">&lt;<span class="keyword">Device</span>A&gt; <strong>display snmp-agent mib-view viewname allexthgmp</strong></pre>
<pre class="screen">View name: allexthgmp
       MIB Subtree: huaweiUtility.7
       Subtree mask: FF80(Hex)
       Storage-type: nonVolatile
       View Type: excluded
       View status: active 
</pre>
<p># Check the target host.</p>
<pre class="screen">&lt;<span class="keyword">Device</span>A&gt; <strong>display snmp-agent target-host</strong>
Target-host NO. 1
---------------------------------------------------------------------------
  Host-name                        : -
  IP-address                       : 1.1.1.1
  Source interface                 : -
  VPN instance                     : -
  Security name                    : <span>%#%#&amp;NchK)p777^{b1BQtds=_&lt;$O.&lt;<font style="font-size:8pt" Face="Courier New" >~</font>qR.DDbwYS3_G6%#%#</span>
  Port                             : 162
  Type                             : inform
  Version                          : v2c
  Level                            : No authentication and privacy
  NMS type                         : NMS
<span>  With ext-vb                      : Yes</span>
<span>  Notification filter profile name : -</span>
---------------------------------------------------------------------------</pre>
<p># Check the contact information of the device administrator.</p>
<pre class="screen">&lt;<span class="keyword">Device</span>A&gt; <strong>display snmp-agent sys-info contact</strong>
The contact person for this managed node:
           call Operator at 010-12345678 </pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172361038__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><pre class="screen">#
sysname <span class="keyword">Device</span>A
<span># </span>
<span>acl number 2001</span>
 <span>rule 5 permit source 1.1.1.2 0.0.0.0</span>
 <span>rule 6 deny source 1.1.1.1 0.0.0.0</span>
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 1.1.2.1 255.255.255.0
#
interface loopback0
 ip address 1.1.3.1 255.255.255.255
#
ospf 1
 area 0.0.0.0
  network 1.1.2.0 0.0.0.255
  network 1.1.3.1 0.0.0.0
#
snmp-agent
snmp-agent password min-length 10
snmp-agent local-engineid 800007DB03360102101100
snmp-agent community write <span>%#%#qTp*MccD#Z[sHw4"pbzVHzAfO]gWN;h#30K=)%}X1jIHNF&lt;QdMskYG$9xj:9k\EZN6Mi!Hrt@\Oa8tqP%#%#</span> mib-view allexthgmp<span> acl 2001</span>
#
snmp-agent protocol source-interface Loopback0
#
snmp-agent sys-info contact call Operator at 010-12345678
snmp-agent sys-info version v2c
snmp-agent target-host inform address udp-domain 1.1.1.2 params securityname cipher <span>%#%#&amp;NchK)p777^{b1BQtds=_&lt;$O.&lt;<font style="font-size:8pt" Face="Courier New" >~</font>qR.DDbwYS3_G6%#%#</span> v2c
#
snmp-agent mib-view excluded allexthgmp hwCluster
#
snmp-agent inform timeout 5
snmp-agent inform resend-times 6
snmp-agent inform pending 7    
<span>snmp-agent notification-log enable</span>
<span>snmp-agent notification-log global-ageout 24</span>
#
snmp-agent trap enable
#
return</pre>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_snmp_cfg_0022.html">Configuration Examples for SNMP
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_snmp_cfg_0023.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_snmp_cfg_0025.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>