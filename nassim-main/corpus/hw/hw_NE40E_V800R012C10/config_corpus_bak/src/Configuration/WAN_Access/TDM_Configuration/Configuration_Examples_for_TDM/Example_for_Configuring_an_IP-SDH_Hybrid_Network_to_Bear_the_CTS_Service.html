
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring an IP-SDH Hybrid Network to Bear the CTS Service">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_tdm_cfg_0009.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_tdm_cfg_0010.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_tdm_cfg_0023.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,tdmne,w00556928,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="TDM">
<meta name="featuretype" content="WAN Access">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="TDM">
<meta name="featuretype" content="WAN Access">
<meta name="featurename" content="TDM">
<meta name="featuretype" content="WAN Access">
<meta name="featurename" content="TDM">
<meta name="featuretype" content="WAN Access">
<meta name="OWNER" content="f00453093">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="m00605382">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172364258">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/thickbox.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/imageResize.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery-migrate-1.2.1.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery-ui.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery.mousewheel.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/thickbox.js"></script>
<title>Example for Configuring an IP-SDH Hybrid Network to Bear the CTS Service</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172364258"></a><a name="EN-US_TASK_0172364258"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring an IP-SDH Hybrid Network to Bear the CTS Service</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0172364258__1.3.1"></a><a name="1.3.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>The Cordless Telephony System (CTS) is a dispatch phone service for railway networks. On the network shown in <a href="#EN-US_TASK_0172364258__fig_01">Figure 1</a>, both IP and SDH devices are deployed, a dispatch phone is single-homed to a UPE, the UPE is dual-homed to SPEs, and the SPEs are connected to the SDH devices on the transmission backbone network. To bear the CTS service in this scenario, implement the communication between the IP and SDH devices, configure primary and secondary PWs between the UPE and SPEs, and configure dual feed and selective receiving on the UPE. In addition, configure BFD sessions on the IP network to monitor link status and enable SNCP on the SDH network (the SNCP configuration is not provided in this section) to improve service reliability.</p>
<div class="fignone" id="EN-US_TASK_0172364258__fig_01"><a name="EN-US_TASK_0172364258__fig_01"></a><a name="fig_01"></a><span class="figcap"><b>Figure 1 </b>Configuring an IP-SDH hybrid network to bear the CTS service</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>On the example network, the device models of SPE1 and SPE2 are <span class="keyword">NE40E</span>s.</p>
<p>Interface 0, interface 1, interface 2, and interface 3 stand for serial <span>0/2/1</span>:0, GE <span>0/1/1</span>, GE <span>0/1/2</span>, and serial <span>0/2/1</span>/1:0, respectively.</p>
</div></div>
<br><span><img class="imgResize" src="images/fig_dc_ne_tdm_cfg_002201.png" width="525.35" title="Click to enlarge"></span><br><div class="tableBorder"><table cellpadding="4" cellspacing="0" summary=""><tr><td valign="top"><p>Device</p>
</td>
<td valign="top"><p>Interface</p>
</td>
<td valign="top"><p>IP Address</p>
</td>
</tr>
<tr><td valign="top"><p>UPE</p>
</td>
<td valign="top"><p>GE <span>0/1/1</span></p>
<p>GE <span>0/1/2</span></p>
<p>Loopback0</p>
</td>
<td valign="top"><p>10.1.1.1/24</p>
<p>10.1.2.1/24</p>
<p>1.1.1.1/32</p>
</td>
</tr>
<tr><td valign="top"><p>SPE1</p>
</td>
<td valign="top"><p>GE <span>0/1/1</span></p>
<p>Loopback0</p>
</td>
<td valign="top"><p>10.1.1.2/24</p>
<p>2.2.2.2/32</p>
</td>
</tr>
<tr><td valign="top"><p>SPE2</p>
</td>
<td valign="top"><p>GE <span>0/1/2</span></p>
<p>Loopback0</p>
</td>
<td valign="top"><p>10.1.2.2/24</p>
<p>3.3.3.3/32</p>
</td>
</tr>
</table></div>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172364258__1.3.2"></a><a name="1.3.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure an IP address and a routing protocol for each interface on the UPE, SPE1, and SPE2, allowing the devices to communicate at the network layer. This example uses OSPF as the routing protocol.</p>
</li><li><p>Configure basic MPLS functions and public tunnels to bear PWs.</p>
</li><li><p>Configure remote MPLS LDP sessions and PWs between the UPE and SPEs.</p>
</li><li><p>Configure BFD sessions to monitor the PWs.</p>
</li><li><p>Configure fast alarm detection.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172364258__1.3.3"></a><a name="1.3.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li>IP addresses for interfaces on the UPE, SPE1, and SPE2</li><li>LSR IDs for the UPE, SPE1, and SPE2</li><li>L2VC IDs for each PW (must be the same on the two ends of the PW)</li><li>BFD parameters</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172364258__1.3.4"></a><a name="1.3.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure an IP address and a routing protocol for each interface on the UPE, SPE1, and SPE2, allowing the devices to communicate at the network layer. For configuration details, see "<a href="#EN-US_TASK_0172364258__section_05">Configuration Files</a>" in this section.</span></li><li><span>Configure basic MPLS functions and public network tunnels.</span><ol type="a"><li class="substepexpand"><span>Configure basic MPLS functions and enable MPLS LDP and MPLS TE.</span><p><p># Configure the UPE.</p>
<pre class="screen">&lt;UPE&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>mpls lsr-id 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-mpls] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/1</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/1</span>] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/2</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/2</span>] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>ospf 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-ospf-100] <strong>opaque-capability enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-ospf-100] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-ospf-100-area-0.0.0.0] <strong>mpls-te enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-ospf-100-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-ospf-100] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>commit</strong></pre>
<p>The configurations of SPE1 and SPE2 are similar to the configuration of the UPE. For configuration details, see "<a href="#EN-US_TASK_0172364258__section_05">Configuration Files</a>" in this section.</p>
</p></li><li class="substepexpand"><span>Configure TE tunnels.</span><p><p># Configure the UPE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>interface tunnel 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-Tunnel1] <strong>ip address unnumbered interface loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-Tunnel1] <strong>tunnel-protocol mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-Tunnel1] <strong>destination 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-Tunnel1] <strong>mpls te tunnel-id 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-Tunnel1] <strong>mpls te reserved-for-binding</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-Tunnel1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>interface tunnel 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-Tunnel2] <strong>ip address unnumbered interface loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-Tunnel2] <strong>tunnel-protocol mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-Tunnel2] <strong>destination 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-Tunnel2] <strong>mpls te tunnel-id 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-Tunnel2] <strong>mpls te reserved-for-binding</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-Tunnel2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>tunnel-policy policy1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-tunnel-policy-policy1] <strong>tunnel binding destination 2.2.2.2 te Tunnel 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-tunnel-policy-policy1] <strong>tunnel binding destination 3.3.3.3 te Tunnel 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-tunnel-policy-policy1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>commit</strong></pre>
<p># Configure SPE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE1] <strong>interface tunnel 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-Tunnel1] <strong>ip address unnumbered interface loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-Tunnel1] <strong>tunnel-protocol mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-Tunnel1] <strong>destination 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-Tunnel1] <strong>mpls te tunnel-id 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-Tunnel1] <strong>mpls te reserved-for-binding</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-Tunnel1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE1] <strong>tunnel-policy policy1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-tunnel-policy-policy1] <strong>tunnel binding destination 1.1.1.1 te Tunnel 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-tunnel-policy-policy1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>commit</strong></pre>
<p># Configure SPE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE2] <strong>interface tunnel 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-Tunnel2] <strong>ip address unnumbered interface loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-Tunnel2] <strong>tunnel-protocol mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-Tunnel2] <strong>destination 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-Tunnel2] <strong>mpls te tunnel-id 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-Tunnel2] <strong>mpls te reserved-for-binding</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-Tunnel2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE2] <strong>tunnel-policy policy1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-tunnel-policy-policy1] <strong>tunnel binding destination 1.1.1.1 te Tunnel 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-tunnel-policy-policy1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2] <strong>commit</strong></pre>
</p></li></ol>
</li><li><span>Configure remote MPLS LDP sessions and PWs.</span><ol type="a"><li class="substepexpand"><span>Configure a remote MPLS LDP session between the UPE and each SPE.</span><p><p># Configure the UPE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>mpls ldp remote-peer 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-mpls-ldp-remote-2.2.2.2] <strong>remote-ip 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-mpls-ldp-remote-2.2.2.2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>mpls ldp remote-peer 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-mpls-ldp-remote-3.3.3.3] <strong>remote-ip 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-mpls-ldp-remote-3.3.3.3] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>commit</strong></pre>
<p># Configure SPE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE1] <strong>mpls ldp remote-peer 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-mpls-ldp-remote-1.1.1.1] <strong>remote-ip 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-mpls-ldp-remote-1.1.1.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>commit</strong></pre>
<p># Configure SPE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE2] <strong>mpls ldp remote-peer 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-mpls-ldp-remote-1.1.1.1] <strong>remote-ip 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-mpls-ldp-remote-1.1.1.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2] <strong>commit</strong></pre>
</p></li><li class="substepexpand"><span>Configure PWs.</span><p><p># Configure the UPE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>controller e1 <span>0/2/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-E1 <span>0/2/1</span>] <strong>channel-set 0 timeslot-list 1-31</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-E1 <span>0/2/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>interface serial <span>0/2/1</span>:0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-Serial<span>0/2/1</span>:0] <strong>link-protocol tdm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-Serial<span>0/2/1</span>:0] <strong>mpls l2vc 2.2.2.2 1 tunnel-policy policy1 control-word</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-Serial<span>0/2/1</span>:0] <strong>mpls l2vc 3.3.3.3 2 secondary tunnel-policy policy1 control-word secondary</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-Serial<span>0/2/1</span>:0] <strong>mpls l2vpn stream-dual-receiving</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-Serial<span>0/2/1</span>:0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>commit</strong></pre>
<p># Configure SPE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE1] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>controller cpos <span>0/2/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-Cpos<span>0/2/1</span>] <strong>e1 1 channel-set 0 timeslot-list 1-31</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-Cpos<span>0/2/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>interface serial <span>0/2/1</span>/1:0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-Serial<span>0/2/1</span>/1:0] <strong>link-protocol tdm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-Serial<span>0/2/1</span>/1:0] <strong>mpls l2vc 1.1.1.1 1 tunnel-policy policy1 control-word</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-Serial<span>0/2/1</span>/1:0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>commit</strong></pre>
<p># Configure SPE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE2] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2] <strong>controller cpos <span>0/2/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-Cpos<span>0/2/1</span>] <strong>e1 1 channel-set 0 timeslot-list 1-31</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-Cpos<span>0/2/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2] <strong>interface serial <span>0/2/1</span>/1:0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-Serial<span>0/2/1</span>/1:0] <strong>link-protocol tdm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-Serial<span>0/2/1</span>/1:0] <strong>mpls l2vc 1.1.1.1 1 tunnel-policy policy1 control-word</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-Serial<span>0/2/1</span>/1:0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2] <strong>commit</strong></pre>
</p></li></ol>
</li><li><span>Configure BFD sessions to monitor the PWs.</span><p><p># Configure the UPE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>bfd</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-bfd] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>bfd master bind pw interface Serial <span>0/2/1</span>:0 remote-peer 2.2.2.2 pw-ttl auto-calculate</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-bfd-lsp-session-master] <strong>discriminator local 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-bfd-lsp-session-master] <strong>discriminator remote 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-bfd-lsp-session-master] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>bfd slave bind pw interface Serial <span>0/2/1</span>:0 remote-peer 3.3.3.3 pw-ttl auto-calculate</strong><strong> secondary</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-bfd-lsp-session-slave] <strong>discriminator local 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-bfd-lsp-session-slave] <strong>discriminator remote 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-bfd-lsp-session-slave] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>commit</strong></pre>
<p># Configure SPE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE1] <strong>bfd</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-bfd] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>bfd pw1 bind pw interface serial <span>0/2/1</span>/1:0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-bfd-lsp-session-pw1] <strong>discriminator local 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-bfd-lsp-session-pw1] <strong>discriminator remote 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-bfd-lsp-session-pw1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>commit</strong></pre>
<p># Configure SPE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE2] <strong>bfd</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-bfd] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2] <strong>bfd pw2 bind pw interface serial <span>0/2/1</span>/1:0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-bfd-lsp-session-pw2] <strong>discriminator local 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-bfd-lsp-session-pw2] <strong>discriminator remote 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-bfd-lsp-session-pw2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2] <strong>commit</strong></pre>
</p></li><li><span>Configure fast alarm detection on SPE1 and SPE2.</span><p><p># Configure SPE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE1] <strong>interface serial <span>0/2/1</span>/1:0</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE1-Serial<span>0/2/1</span>/1:0] <strong>fast-alarm-detect enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-Serial<span>0/2/1</span>/1:0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>commit</strong></pre>
<p># Configure SPE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE2] <strong>interface serial <span>0/2/1</span>/1:0</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE2-Serial<span>0/2/1</span>/1:0] <strong>fast-alarm-detect enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-Serial<span>0/2/1</span>/1:0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2] <strong>commit</strong></pre>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0172364258__section_05"><a name="EN-US_TASK_0172364258__section_05"></a><a name="section_05"></a><a name="EN-US_TASK_0172364258__1.3.5"></a><a name="1.3.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>UPE configuration file</p>
<pre class="screen">#                                                                               
sysname UPE                                                                     
#                                                                               
bfd                                                                             
#
mpls lsr-id 1.1.1.1
#                                                                               
mpls
  mpls te
#                                                                               
mpls l2vpn                                                                      
#                                                                               
mpls ldp
#                                                                               
mpls ldp remote-peer 2.2.2.2                                                    
 remote-ip 2.2.2.2                                                              
#                                                                               
mpls ldp remote-peer 3.3.3.3                                                    
 remote-ip 3.3.3.3                                                              
#
controller e1 <span>0/2/1</span>
 channel-set 0 timeslot-list 1-31                                                                          
# 
interface serial <span>0/2/1</span>:0 
 link-protocol tdm                           
 mpls l2vc 2.2.2.2 1 tunnel-policy policy1 control-word
 mpls l2vc 3.3.3.3 2 secondary tunnel-policy policy1 control-word secondary
 mpls l2vpn stream-dual-receiving
<span> mpls l2vpn stream-dual-send</span>                                              
#                                                                               
interface GigabitEthernet <span>0/1/1</span>                                            
 undo shutdown                                                                  
 ip address 10.1.1.1 255.255.255.0                                             
 mpls                                                                           
 mpls te                                                                        
#                                                                               
interface GigabitEthernet <span>0/1/2</span> 
 undo shutdown                                                                  
 ip address 10.1.2.1 255.255.255.0                                             
 mpls                                                                           
 mpls te                                                                        
# 
interface LoopBack0                                                             
 ip address 1.1.1.1 255.255.255.255                                             
#                                                                               
interface Tunnel 1                                                    
 ip address unnumbered interface LoopBack0
 tunnel-protocol mpls te
 destination 2.2.2.2
 mpls te reserved-for-binding
 mpls te bit-error-detection
 mpls te tunnel-id 100 
#                                                                               
ospf 100                                                                        
 opaque-capability enable                                                       
 area 0.0.0.0                                                                   
  network 1.1.1.1 0.0.0.0                                                       
  network 10.1.1.0 0.0.0.255                                                   
  network 10.1.2.0 0.0.0.255                                                   
  mpls-te enable                                                                
#                                                                               
interface Tunnel 2                                                     
 ip address unnumbered interface LoopBack0
 tunnel-protocol mpls te
 destination 3.3.3.3
 mpls te reserved-for-binding
 mpls te bit-error-detection
 mpls te tunnel-id 200                                                                
#                                                       
tunnel-policy policy1                                                           
 tunnel binding destination 2.2.2.2 te Tunnel 1                          
 tunnel binding destination 3.3.3.3 te Tunnel 2         
#                                                                               
bfd master bind pw interface serial <span>0/2/1</span>:0 remote-peer 2.2.2.2 pw-ttl auto-calculate
 discriminator local 2
 discriminator remote 2
#
bfd slave bind pw interface serial <span>0/2/1</span>:0 remote-peer 3.3.3.3 pw-ttl auto-calculate secondary
 discriminator local 2
 discriminator remote 2
# 
return</pre>
</li><li><p>SPE1 configuration file</p>
<pre class="screen">#                                                                               
sysname SPE1                                                                    
#                                                                               
bfd                                                                             
#                                                                               
mpls lsr-id 2.2.2.2
#
mpls
 mpls te
#                                                                               
mpls l2vpn                                                                      
#                                                                               
mpls ldp
#                                                                               
mpls ldp remote-peer 1.1.1.1                                                    
 remote-ip 1.1.1.1                                                              
#                                                                               
interface GigabitEthernet <span>0/1/1</span>   
 undo shutdown  
 ip address 10.1.1.2 255.255.255.0
 mpls           
 mpls te                                                                                      
#                                                                               
interface LoopBack0                                                             
 ip address 2.2.2.2 255.255.255.255                                                       
#
controller cpos <span>0/2/1</span>
 e1 1 channel-set 0 timeslot-list 1-31                                                                     
# 
interface serial <span>0/2/1</span>/1:0 
 link-protocol tdm
 mpls l2vc 1.1.1.1 1 tunnel-policy policy1 control-word
 mpls l2vpn pw bit-error-detection
 fast-alarm-detect enable
#
interface Tunnel 1 
 ip address unnumbered interface LoopBack0
 tunnel-protocol mpls te
 destination 1.1.1.1
 mpls te reserved-for-binding
 mpls te bit-error-detection
 mpls te tunnel-id 100
#
ospf 100                                                                        
 opaque-capability enable                                                       
 graceful-restart                                                               
 area 0.0.0.0                                                                   
  network 2.2.2.2 0.0.0.0                                                       
  network 10.1.1.0 0.0.0.255          
  mpls-te enable
#                                                                     
tunnel-policy policy1                                                           
 tunnel binding destination 1.1.1.1 te Tunnel 1               
#                                                                               
bfd pw1 bind pw interface serial <span>0/2/1</span>/1:0
 discriminator local 2
 discriminator remote 2                                                                        
#                                                                               
return</pre>
</li><li><p>SPE2 configuration file</p>
<pre class="screen">#                                                                               
sysname SPE2                                                                    
#                                                                               
bfd                                                                             
#                                                                               
mpls lsr-id 3.3.3.3
#
mpls
 mpls te
#                                                                               
mpls l2vpn                                                                      
#                                                                               
mpls ldp
#                                                                               
mpls ldp remote-peer 1.1.1.1                                                    
 remote-ip 1.1.1.1                                                                        
#                                                                               
interface GigabitEthernet <span>0/1/2</span>        
 undo shutdown  
 ip address 10.1.2.2 255.255.255.0
 mpls           
 mpls te        
#                                                                               
interface LoopBack0                                                             
 ip address 3.3.3.3 255.255.255.255                                             
#                                                                               
controller cpos <span>0/2/1</span>
 e1 1 channel-set 0 timeslot-list 1-31                                                                     
# 
interface serial <span>0/2/1</span>/1:0 
 link-protocol tdm
 mpls l2vc 1.1.1.1 1 tunnel-policy policy1 control-word
 mpls l2vpn pw bit-error-detection
 fast-alarm-detect enable
#
interface Tunnel 2         
 ip address unnumbered interface LoopBack0
 tunnel-protocol mpls te
 destination 1.1.1.1
 mpls te record-route
 mpls te reserved-for-binding
 mpls te bit-error-detection
 mpls te tunnel-id 200
#
ospf 100        
 opaque-capability enable
 area 0.0.0.0   
  network 3.3.3.3 0.0.0.0
  network 10.1.2.0 0.0.0.255
  network 10.1.3.0 0.0.0.255
  mpls-te enable
#                              
tunnel-policy policy1                                                           
 tunnel binding destination 1.1.1.1 te Tunnel 2                          
#                                                                               
bfd pw2 bind pw interface serial <span>0/2/1</span>/1:0
 discriminator local 2
 discriminator remote 2
#                                                                              
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_tdm_cfg_0009.html">Configuration Examples for TDM
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_tdm_cfg_0010.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_tdm_cfg_0023.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>

<script language="JavaScript">
<!--
image_size('.imgResize');
var msg_imageMax = "view original image";
var msg_imageClose = "close";
//--></script></body>
</html>