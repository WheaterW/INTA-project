
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="concept">
<meta name="DC.Title" content="Solution to the Low Equal-Cost Route Specification on the Remote Device Without Interrupting Services">
<meta name="abstract" content="">
<meta name="description" content="">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_loadba_cfg_2008.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/load-balance_feature_055.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,56630517l00801610,z00485179,w00556928,w00606909,">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="Load Balance">
<meta name="featuretype" content="IP Services">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="Load Balance">
<meta name="featuretype" content="IP Services">
<meta name="featurename" content="Load Balance">
<meta name="featuretype" content="IP Services">
<meta name="featurename" content="Load Balance">
<meta name="featuretype" content="IP Services">
<meta name="OWNER" content="z00485179,z00648985">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="z00485179">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_CONCEPT_0172365040">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Solution to the Low Equal-Cost Route Specification on the Remote Device Without Interrupting Services</title>
</head>
<body><a name="EN-US_CONCEPT_0172365040"></a><a name="EN-US_CONCEPT_0172365040"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Solution to the Low Equal-Cost Route Specification on the Remote Device Without Interrupting Services</h1>
<div><p></p>
<div class="section"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_CONCEPT_0172365040__fig_load-balance_feature_05601">Figure 1</a>, the two egresses of AS 100 are Huawei <span class="keyword">NE40E</span>s. Each of the two egresses was connected to AS 200 through six links, and then the number of links was doubled for expansion. However, the two egresses received traffic along only eight links from the remote device after the expansion because the remote device supports only eight equal-cost routes to the same network segment. It is required that services run uninterrupted. Therefore, the six links cannot be added to a trunk.</p>
<div class="fignone" id="EN-US_CONCEPT_0172365040__fig_load-balance_feature_05601"><a name="EN-US_CONCEPT_0172365040__fig_load-balance_feature_05601"></a><a name="fig_load-balance_feature_05601"></a><span class="figcap"><b>Figure 1 </b>Link expansion</span><br><span><img class="vsd" src="images/fig_load-balance_feature_05601.png" width="NaN" height="NaN"></span></div>
</div>
<div class="section"><h4 class="sectiontitle">Solution</h4><p>No more links can be added for load balancing because of the equal-cost route specification of the remote device. In this situation, deploy a BGP route-policy. The EBGP peer address of egress 1 is 1.1.1.1. A new loopback interface with IP address 1.1.1.2 is configured on the remote device, and a new EBGP peer relationship is established between the new loopback interface and egress 1. Perform the following operations:</p>
<ol><li>Configure a pair of loopback interfaces at both ends and establish EBGP peer relationships.<ol type="a"><li>Run the <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a> command to enter the system view.</li><li>Run the <a href="cmdqueryname=interface+loopback"><b><span class="cmdname">interface loopback</span></b></a> <em>interface-number</em> command to create a loopback interface.</li><li>Run the <a href="cmdqueryname=ip+address"><b><span class="cmdname">ip address</span></b></a> <em>ip-address</em> { <em>mask</em> | <em>mask-length</em> } command to configure an IP address for the loopback interface.</li><li>Run the <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a> command to enter the system view.</li><li>Run the <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <em>as-number</em> command to enter the BGP view.</li><li>Run the <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <strong>1.1.1.2</strong> <strong>as-number</strong> <em>as-number</em> command to set the IP address of the EBGP peer to the new loopback interface IP address on the remote end.</li><li>Run the <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <strong>1.1.1.2</strong> <strong>connect-interface loopback</strong> <em>interface-number</em> command to configure the new loopback interface as the source interface of the TCP session used by the BGP connection.</li></ol>
</li><li>Configure two groups of static routes for the EBGP peers, with six static routes to each EBGP peer.<ol type="a"><li>Run the <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a> command to enter the system view.</li><li>Run the <a href="cmdqueryname=ip+route-static"><b><span class="cmdname">ip route-static</span></b></a> <strong>1.1.1.1</strong> { <em>mask</em> | <em>mask-length</em> } { <em>nexthop-address</em> | <em>interface-type interface-number</em> [ <em>nexthop-address</em> ] } command to configure six static routes to 1.1.1.1, with the same outbound interfaces and next hops as those of the original links.</li><li>Run the <a href="cmdqueryname=ip+route-static"><b><span class="cmdname">ip route-static</span></b></a> <strong>1.1.1.2</strong> { <em>mask</em> | <em>mask-length</em> } { <em>nexthop-address</em> | <em>interface-type interface-number</em> [ <em>nexthop-address</em> ] } command to configure six static routes to 1.1.1.2, with the same outbound interfaces and next hops as those of the new links.</li></ol>
<p>Therefore, BGP routes can recurse to the two groups of equal-cost routes to both EBGP peers.</p>
</li><li>Configure a route-policy and set the next hops of some routes to the new loopback interface of the remote device for load balancing.<ol type="a"><li>Run the <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a> command to enter the system view.</li><li>Run the <a href="cmdqueryname=ip+ip-prefix"><b><span class="cmdname">ip ip-prefix</span></b></a> <strong>prefix1</strong> <strong>index</strong> <em>index-number</em> <em>ipv4-address</em> <em>mask-length</em> [ <strong>greater-equal</strong> <em>greater-equal-value</em> ] [ <strong>less-equal</strong> <em>less-equal-value</em> ] command to configure an IP prefix list to match the destinations of routes to be switched to the new links.</li><li>Run the <a href="cmdqueryname=route-policy"><b><span class="cmdname">route-policy</span></b></a> <strong>new-policy</strong> <strong>permit node 10</strong> command to configure a route-policy and create node 10 for it.</li><li>Run the <a href="cmdqueryname=if-match+ip-prefix"><b><span class="cmdname">if-match ip-prefix</span></b></a> <strong>prefix1</strong> command to apply the IP prefix list to the route-policy.</li><li>Run the <a href="cmdqueryname=apply+ip-address+next-hop"><b><span class="cmdname">apply ip-address next-hop</span></b></a> <strong>1.1.1.2</strong> command to set the next hops of the routes that match the route-policy to the new loopback interface of the remote device.</li></ol>
</li><li>Configure a route-policy so that the original six links carry the rest traffic.<ol type="a"><li>Run the <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a> command to enter the system view.</li><li>Run the <a href="cmdqueryname=route-policy"><b><span class="cmdname">route-policy</span></b></a> <strong>old-policy</strong> <strong>deny node 10</strong> command to configure a route-policy and create node 10 for it.</li><li>Run the <a href="cmdqueryname=if-match+ip-prefix"><b><span class="cmdname">if-match ip-prefix</span></b></a> <strong>prefix1</strong> command to apply the IP prefix list to the route-policy.</li><li>Run the <a href="cmdqueryname=route-policy"><b><span class="cmdname">route-policy</span></b></a> <strong>old-policy</strong> <strong>permit node 20</strong> command to configure node 20 for the route-policy.</li><li>Run the <a href="cmdqueryname=apply+ip-address+next-hop"><b><span class="cmdname">apply ip-address next-hop</span></b></a> <strong>1.1.1.1</strong> command to set the next hops of the routes that match the route-policy to the original loopback interface of the remote device.</li></ol>
</li><li>Apply the route-policy to the routes to be advertised to the EBGP peer.<ol type="a"><li>Run the <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a> command to enter the system view.</li><li>Run the <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <em>as-number</em> command to enter the BGP view.</li><li>Run the <a href="cmdqueryname=ipv4-family"><b><span class="cmdname">ipv4-family</span></b></a> <strong>unicast</strong> command to enter the BGP IPv4 unicast address family view.</li><li>Run the <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <strong>1.1.1.1 route-policy old-policy export</strong> command to apply the route-policy to the original EBGP peer.</li><li>Run the <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <strong>1.1.1.2 route-policy new-policy export</strong> command to apply the route-policy to the new EBGP peer.</li></ol>
</li><li>Run the <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a> command to commit the configuration.</li></ol>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, an IP prefix list is configured to filter routes. You can also configure an ACL, AS_Path filter, community filter, extcommunity filter, or RD filter. The extcommunity filter and RD filter take effect only on VPNv4<span> and VPNv6</span> routes, and the rest filters take effect on both VPN and public routes.</p>
</div></div>
</div>
<div class="section"><h4 class="sectiontitle">Follow-up Procedure</h4><p>Run the <a href="cmdqueryname=save"><b><span class="cmdname">save</span></b></a> command to save the current configuration to the configuration file when a set of configuration is finished and the expected functions have been achieved.</p>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_loadba_cfg_2008.html">Load Balancing Configuration Examples
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/load-balance_feature_055.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>
</body>
</html>