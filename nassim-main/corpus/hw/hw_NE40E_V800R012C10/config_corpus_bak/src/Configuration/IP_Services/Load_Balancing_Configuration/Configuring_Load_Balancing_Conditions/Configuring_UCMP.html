
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="concept">
<meta name="DC.Title" content="Configuring UCMP">
<meta name="abstract" content="">
<meta name="description" content="">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/load-balance_feature_043.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/load-balance_feature_048.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,56630517l00801610,z00485179,w00556928,w00606909,">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="Load Balance">
<meta name="featuretype" content="IP Services">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="Load Balance">
<meta name="featuretype" content="IP Services">
<meta name="featurename" content="Load Balance">
<meta name="featuretype" content="IP Services">
<meta name="featurename" content="Load Balance">
<meta name="featuretype" content="IP Services">
<meta name="OWNER" content="z00485179,z00648985">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="z00485179">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_CONCEPT_0172365024">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>Configuring UCMP</title>
</head>
<body><a name="EN-US_CONCEPT_0172365024"></a><a name="EN-US_CONCEPT_0172365024"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring UCMP</h1>
<div><p></p>
<p>UCMP can be configured using the following methods:</p>
<div class="section"><h4 class="sectiontitle">Enabling UCMP Globally</h4><ol><li>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a><p>The system view is displayed.</p>
</li><li><p>Run <a href="cmdqueryname=load-balance+unequal-cost+enable"><b><span class="cmdname">load-balance unequal-cost enable</span></b></a></p>
<p>UCMP is enabled globally.</p>
</li><li>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a><p>The configuration is committed.</p>
</li></ol>
</div>
<div class="section"><h4 class="sectiontitle">Enabling UCMP Based on the Configuration Bandwidth Globally</h4><ol><li>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a><p>The system view is displayed.</p>
</li><li>Run <a href="cmdqueryname=interface"><b><span class="cmdname">interface</span></b></a> <em>interface-type interface-number</em><p>The interface view is displayed.</p>
</li><li>Run <a href="cmdqueryname=bandwidth"><b><span class="cmdname">bandwidth</span></b></a> <em>bandwidth</em><p>The configuration bandwidth is set for the interface.</p>
</li><li>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a><p>Return to the system view.</p>
</li><li><p>Run <a href="cmdqueryname=load-balance+unequal-cost+bandwidth-config+enable"><b><span class="cmdname">load-balance unequal-cost bandwidth-config enable</span></b></a></p>
<p>UCMP based on the configuration bandwidth is enabled.</p>
</li><li>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a><p>The configuration is committed.</p>
</li></ol>
</div>
<div class="section"><h4 class="sectiontitle">Enabling UCMP on an Interface</h4><p></p>
<ol><li>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a><p>The system view is displayed.</p>
</li><li><p>Run <a href="cmdqueryname=interface"><b><span class="cmdname">interface</span></b></a> <em>interface-type interface-number</em></p>
<p>The interface view is displayed.</p>
<p>UCMP can be separately enabled only on physical interfaces.</p>
</li><li>Run <a href="cmdqueryname=load-balance+unequal-cost+enable"><b><span class="cmdname">load-balance unequal-cost enable</span></b></a><p>UCMP is enabled on the interface.</p>
</li><li><p>Run <a href="cmdqueryname=shutdown"><b><span class="cmdname">shutdown</span></b></a> and <a href="cmdqueryname=undo+shutdown"><b><span class="cmdname">undo shutdown</span></b></a></p>
<p>The interface is restarted for the UCMP configuration to take effect.</p>
<p>Enabling/Disabling UCMP on a physical interface through commands does not immediately trigger routes and FIB entries to be updated. You must restart the interface.</p>
</li><li>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a><p>The configuration is committed.</p>
</li></ol>
</div>
<div class="section"><h4 class="sectiontitle">Enabling UCMP on the P Node of an MPLS LSP/Tunnel</h4><ol><li><p>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></p>
<p>The system view is displayed.</p>
</li><li><p>Run <a href="cmdqueryname=load-balance+mpls+unequal-cost+enable"><b><span class="cmdname">load-balance mpls unequal-cost enable</span></b></a></p>
<p>UCMP is enabled on the MPLS P node (excluding the P node on a BGP LSP).</p>
<p>If UCMP is enabled and the MPLS P node (excluding the P node on the BGP LSP) has multiple outbound interfaces, UCMP is performed among the outbound interfaces based on bandwidth weights. If UCMP is disabled and the MPLS P node has multiple outbound interfaces, ECMP is performed among the outbound interfaces.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>This command does not support sub-interfaces.</p>
</div></div>
</li></ol>
</div>
<div class="section"><h4 class="sectiontitle">Enabling UCMP for MPLS TE Tunnels</h4><p>MPLS TE tunnels include static MPLS TE and P2P RSVP-TE tunnels. When multiple MPLS TE tunnels are destined for a downstream device, you can configure UCMP weights or CT bandwidths to load-balance traffic among the MPLS TE tunnels in UCMP mode.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>If UCMP is globally enabled for static MPLS TE and P2P RSVP-TE tunnels and UCMP weights are configured for all the tunnels, UCMP is preferentially performed based on the weights. If no load balancing weight is configured for some tunnels but UCMP is globally enabled and CT bandwidths are configured for all tunnels, UCMP is performed based on the CT bandwidths. If neither weights nor CT bandwidths are configured for tunnels, equal-cost load balancing is performed by default.</p>
<p>When UCMP is performed based on weights, the actual weight of a tunnel is calculated using the following formula: Actual weight of this tunnel = 100 x (Weight of this tunnel/Sum of weights of all tunnels).</p>
<p>The volume of traffic carried by a single tunnel in load balancing mode (known as load balancing traffic volume of the tunnel, for short) is calculated using the following formula: Load balancing traffic volume of a tunnel = Total traffic volume x (Actual weight of the tunnel/Sum of weights of all tunnels). Because the sum of load balancing weights of all TE tunnels may not be exactly divided by the weight of a single TE tunnel, the actual load balancing traffic volume of a TE tunnel may be slightly different from the calculated value.</p>
</div></div>
<ol><li><p>Run <a href="cmdqueryname=interface+tunnel"><b><span class="cmdname">interface tunnel</span></b></a> <i><span class="varname">tunnel-number</span></i></p>
<p>The MPLS TE tunnel interface view is displayed.</p>
</li><li><p>Run <span><a href="cmdqueryname=load-balance+unequal-cost+enable"><b><span class="cmdname">load-balance unequal-cost enable</span></b></a></span></p>
<p>UCMP is enabled globally.</p>
</li><li><p>Configure UCMP for MPLS TE tunnels. For details, see <a href="#EN-US_CONCEPT_0172365024__table7246163215374">Table 1</a>.</p>
<p>You can perform one or more steps in <a href="#EN-US_CONCEPT_0172365024__table7246163215374">Table 1</a>.</p>

<div class="tableBorder"><a name="EN-US_CONCEPT_0172365024__table7246163215374"></a><a name="table7246163215374"></a><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" id="EN-US_CONCEPT_0172365024__table7246163215374" frame="border" border="1" rules="all"><caption><b>Table 1 </b>Configuring UCMP for MPLS TE tunnels</caption><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="33.33333333333333%" id="mcps1.4.6.4.3.3.2.4.1.1" liSelected="liSelected"><p>Operation</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="33.33333333333333%" id="mcps1.4.6.4.3.3.2.4.1.2" liSelected="liSelected"><p>Command</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="33.33333333333333%" id="mcps1.4.6.4.3.3.2.4.1.3" liSelected="liSelected"><p>Description</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.6.4.3.3.2.4.1.1 "><p>Configure a UCMP weight for each MPLS TE tunnel.</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.6.4.3.3.2.4.1.2 "><p><a href="cmdqueryname=load-balance+unequal-cost+weight"><b><span class="cmdname">load-balance unequal-cost weight</span></b></a> <i><span class="varname">weight</span></i></p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.6.4.3.3.2.4.1.3 "><p>This function takes effect only when UCMP weights are configured for all tunnels.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.6.4.3.3.2.4.1.1 "><p>Configure a bandwidth for each MPLS TE tunnel.</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.6.4.3.3.2.4.1.2 "><p><strong><a href="cmdqueryname=mpls+te+bandwidth"><b><span class="cmdname">mpls te bandwidth</span></b></a> </strong><em>ctType</em><em> <i><span class="varname">ctValue</span></i></em></p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.6.4.3.3.2.4.1.3 "><p>This function takes effect only when bandwidths are configured for all tunnels.</p>
</td>
</tr>
</tbody>
</table>
</div>
</li><li><p>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></p>
<p>The configuration is committed.</p>
</li></ol>
</div>
<div class="section"><h4 class="sectiontitle">Enabling UCMP for SR-MPLS</h4><p>To implement UCMP for a transit P node of a tunnel (such as an SR-MPLS BE or SR-MPLS TE tunnel), run the <a href="cmdqueryname=load-balance+mpls+unequal-cost+enable"><b><span class="cmdname">load-balance mpls unequal-cost enable</span></b></a> command.</p>
<p>UCMP on the ingress of an SR-MPLS TE Policy is performed among multiple segment lists in the SR-MPLS TE Policy. You only need to configure weights for the segment lists. For configuration details, see <a href="../vrp/dc_vrp_sr_all_cfg_0062.html">Configuring an SR-MPLS TE Policy</a> and <a href="../vrp/dc_vrp_sr_all_cfg_0409.html">Example for Configuring EVPN L3VPN over Static SR-MPLS TE Policy and UCMP</a>.</p>
<p>To implement UCMP for a transit P node of an SR-MPLS TE Policy, run the <a href="cmdqueryname=load-balance+mpls+unequal-cost+enable"><b><span class="cmdname">load-balance mpls unequal-cost enable</span></b></a> command.</p>
</div>
<div class="section"><h4 class="sectiontitle">Enabling UCMP for SRv6</h4><p>In an SRv6 BE scenario, the <a href="cmdqueryname=load-balance+unequal-cost+enable"><b><span class="cmdname">load-balance unequal-cost enable</span></b></a> command needs to be run to globally enable UCMP on the ingress and transit nodes.</p>
<p>UCMP on the ingress of an SRv6 TE Policy is performed among multiple segment lists in the SRv6 TE Policy. You only need to configure weights for the segment lists. For configuration details, see <a href="../vrp/dc_vrp_srv6_cfg_all_0112.html">Configuring an SRv6 TE Policy</a> and <a href="../vrp/dc_vrp_srv6_cfg_all_0140.html">Example for Configuring EVPN L3VPNv4 over SRv6 TE Policy (Manual Configuration + UCMP Scenario)</a>.</p>
<p>For the transit P node of an SRv6 TE Policy, UCMP is not supported in an End.X SID scenario. To globally enable UCMP in an End SID scenario, run the <a href="cmdqueryname=load-balance+unequal-cost+enable"><b><span class="cmdname">load-balance unequal-cost enable</span></b></a> command.</p>
</div>
<div class="section"><h4 class="sectiontitle">Follow-up Procedure</h4><p>Run the <a href="cmdqueryname=save"><b><span class="cmdname">save</span></b></a> command to save the current configuration to the configuration file when a set of configuration is finished and the expected functions have been achieved.</p>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/load-balance_feature_043.html">Configuring Load Balancing Conditions
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/load-balance_feature_048.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>
</body>
</html>