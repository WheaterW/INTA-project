
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring DHCP Relay">
<meta name="abstract" content="After a DHCP relay agent is configured, it can forward DHCP Request messages from DHCP clients to the DHCP server on a different network segment.">
<meta name="description" content="After a DHCP relay agent is configured, it can forward DHCP Request messages from DHCP clients to the DHCP server on a different network segment.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_dhcp_relay_cfg_0003.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_dhcp_relay_cfg_0200.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,z00485179,w00556928,w00606909,dhcpvrp">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="DHCP">
<meta name="featuretype" content="IP Services">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="DHCP">
<meta name="featuretype" content="IP Services">
<meta name="featurename" content="DHCP">
<meta name="featuretype" content="IP Services">
<meta name="featurename" content="DHCP">
<meta name="featuretype" content="IP Services">
<meta name="OWNER" content="z00485179,x00504385">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="x00504385">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172364690">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring DHCP Relay</title>
</head>
<body><a name="EN-US_TASK_0172364690"></a><a name="EN-US_TASK_0172364690"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring DHCP Relay</h1>
<div class="taskbody"><p>After a DHCP relay agent is configured, it can forward DHCP Request messages from DHCP clients to the DHCP server on a different network segment.</p>
<div class="context"><a name="EN-US_TASK_0172364690__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>If the DHCP clients and DHCP server reside on different network segments, configure DHCP relay on an interface to forward DHCP Request messages from the DHCP clients to the DHCP server so that the clients can dynamically obtain IP addresses from the DHCP server.</p>
<p>When multiple clients are connected to the DHCP relay agent and multiple interfaces on the DHCP relay agent function as gateways, each gateway uses a public IP address, which wastes resources. If the relay interface on a routing device uses an unnumbered address as the gateway address, public IP address resources can be saved.</p>
<div class="p">If a relay interface uses an unnumbered IP address, the DHCP relay agent performs the following operations to ensure DHCP message forwarding:<ul><li>The DHCP relay agent generates a user table for the users who go online from the relay interface and saves information, such as users' MAC addresses, online interface, and belonging VLAN.</li><li>Upon receipt of a response message from the server, the DHCP relay agent searches the user table based on the chaddr field for the corresponding online interface and forwards the response message from this interface.</li></ul>
</div>
<ul><li>In addition, after receiving the response message from the server, the DHCP relay agent generates two entries. In this way, when forwarding network-to-user traffic, the DHCP relay agent can find host routes based on the destination IP addresses (IP addresses assigned to users) and locate the outbound interfaces (user access interfaces) for DHCP response messages. Based on the ARP entries, the relay agent can obtain the MAC addresses of users.<ul><li>ARP entry used to notify the ARP module of adding online users</li><li>Entry used to notify the route management module of delivering the user's host routes</li></ul>
</li></ul>
</div></div>
<div class="steps-unordered"><a name="EN-US_TASK_0172364690__1.4.2"></a><a name="1.4.2"></a><h4 class="sectiontitle">Procedure</h4>
<ul><li><span>Configure basic DHCP relay functions on a common interface.</span><ol><li class="substepexpand"><span>Run <span><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=dhcp+enable"><b><span class="cmdname">dhcp enable</span></b></a></span></span><p><p>DHCP is enabled globally.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=dhcp-server+packet-distribute+giaddr"><b><span class="cmdname">dhcp-server packet-distribute giaddr</span></b></a></span><p><p>The relay agent is enabled to distribute reply messages based on the GIADDR field value.</p>
</p><p><p>In a scenario where a DHCP client applies for IP addresses from the DHCP server through a DHCP relay agent, if the DHCP client uses the same MAC address but different sub-interfaces to request for IP addresses in different network segments through the BRAS and DHCP relay agent, the DHCP relay agent may send return messages to the BAS user upon receipt of DHCP reply messages from the DHCP server. This is because the MAC address of the BRAS is the same as that of the DHCP relay agent. As a result, the DHCP relay user fails to go online. To address this problem, run the <a href="cmdqueryname=dhcp-server+packet-distribute+giaddr"><b><span class="cmdname">dhcp-server packet-distribute giaddr</span></b></a> command to enable the DHCP relay agent to determine whether to distribute the DHCP reply messages received from the DHCP server to the BAS user or DHCP relay user based on the GIADDR field value.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=interface"><b><span class="cmdname">interface</span></b></a> <i><span class="varname">interface-type interface-number</span></i></span></span><p><p>The interface view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=ip+address"><b><span class="cmdname">ip address</span></b></a> <i><span class="varname">ip-address</span></i> { <i><span class="varname">mask</span></i> | <i><span class="varname">mask-length</span></i> }</span></span><p><p>The primary IP address is configured for the interface.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <span><a href="cmdqueryname=ip+address"><b><span class="cmdname">ip address</span></b></a> <i><span class="varname">ip-address</span></i> { <i><span class="varname">mask</span></i> | <i><span class="varname">mask-length</span></i> } <strong><span>sub</span></strong></span></span><p><p>The secondary IP address is configured for the interface.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=dhcp+select+relay"><b><span class="cmdname">dhcp select relay</span></b></a></span></span><p><p>DHCP relay is enabled on the interface.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ip+relay+address"><b><span class="cmdname">ip relay address</span></b></a> <i><span class="varname">ip-address</span></i><span> [ <strong><span>dhcp-option</span></strong> { <i><span class="varname">code_60</span></i> [ <i><span class="varname">option-text</span></i> ] | <i><span class="varname">code_1to59</span></i> | <i><span class="varname">code_61to254</span></i> } ]</span></span><p><p>A DHCP server address is associated with the relay interface based on a DHCP option or Option 60.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=ip+relay+giaddr"><b><span class="cmdname">ip relay giaddr</span></b></a> <i><span class="varname">ip-address</span></i> [ <strong><span>dhcp-option</span></strong> { <i><span class="varname">code_60</span></i> [ <i><span class="varname">option-text</span></i> ] | <i><span class="varname">code_1to59</span></i> | <i><span class="varname">code_61to254</span></i> } ]</span><p><p>A DHCP relay gateway address is configured for the interface.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=dhcp+relay+source-ip-address"><b><span class="cmdname">dhcp relay source-ip-address</span></b></a> <i><span class="varname">ip-address</span></i> [ <strong><span>dhcp-option</span></strong> { <i><span class="varname">code_60</span></i> [ <i><span class="varname">option-text</span></i> ] | <i><span class="varname">code_1to59</span></i> | <i><span class="varname">code_61to254</span></i> } ]</span><p><p>A DHCP relay source IP address is configured for the interface.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span></span><p><p>Return to the system view.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <strong><a href="cmdqueryname=dhcp+rate-limit"><b><span class="cmdname">dhcp rate-limit</span></b></a></strong> { <strong>disable</strong> | <em>rateLimitValue</em> }</span><p><p>Global rate limiting is disabled for DHCP messages or a rate limit is configured for DHCP messages.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li><span>Configure basic DHCP relay functions on an unnumbered interface.</span><ol><li class="substepexpand"><span>Run <span><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=dhcp+enable"><b><span class="cmdname">dhcp enable</span></b></a></span></span><p><p>DHCP is enabled globally.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=interface"><b><span class="cmdname">interface</span></b></a> <i><span class="varname">interface-type interface-number</span></i></span></span><p><p>The unnumbered interface view is displayed.</p>
</p><p><p>Currently, an unnumbered interface can be an Ethernet physical interface, Ethernet physical sub-interface<span>, VLANIF interface</span>, and Ethernet trunk sub-interface.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ip+address"><b><span class="cmdname">ip address</span></b></a> <i><span class="varname">ip-address</span></i> { <i><span class="varname">mask</span></i> | <i><span class="varname">mask-length</span></i> }</span><p><p>The primary IP address of the interface is configured.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span></span><p><p>Return to the system view.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=interface"><b><span class="cmdname">interface</span></b></a> <i><span class="varname">interface-type interface-number</span></i></span></span><p><p>The interface view in which DHCP relay is to be enabled is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=ip+address+unnumbered"><b><span class="cmdname">ip address unnumbered</span></b></a> <strong><span>interface</span></strong> <i><span class="varname">interface-type interface-number</span></i></span></span><p><p>The unnumbered IP address of the relay interface is configured.</p>
</p><p><p>The interface specified by the <strong><span>interface</span></strong> <i><span class="varname">interface-type interface-number</span></i> parameter must be the same as the unnumbered interface specified in Step 3.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=dhcp+select+relay"><b><span class="cmdname">dhcp select relay</span></b></a></span></span><p><p>DHCP relay is enabled on the interface.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ip+relay+address"><b><span class="cmdname">ip relay address</span></b></a> <i><span class="varname">ip-address</span></i><span> [ <strong><span>dhcp-option</span></strong> { <i><span class="varname">code_60</span></i> [ <i><span class="varname">option-text</span></i> ] | <i><span class="varname">code_1to59</span></i> | <i><span class="varname">code_61to254</span></i> } ]</span></span><p><p>A DHCP server address is associated with the relay interface based on a DHCP option or Option 60.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=ip+relay+giaddr"><b><span class="cmdname">ip relay giaddr</span></b></a> <i><span class="varname">ip-address</span></i> [ <strong><span>dhcp-option</span></strong> { <i><span class="varname">code_60</span></i> [ <i><span class="varname">option-text</span></i> ] | <i><span class="varname">code_1to59</span></i> | <i><span class="varname">code_61to254</span></i> } ]</span><p><p>A DHCP relay gateway address is configured for the interface.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=dhcp+relay+source-ip-address"><b><span class="cmdname">dhcp relay source-ip-address</span></b></a> <i><span class="varname">ip-address</span></i><span> [ <strong><span>dhcp-option</span></strong> { <i><span class="varname">code_60</span></i> [ <i><span class="varname">option-text</span></i> ] | <i><span class="varname">code_1to59</span></i> | <i><span class="varname">code_61to254</span></i> } ]</span></span><p><p>A DHCP relay source IP address is configured for the interface.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <span><a href="cmdqueryname=dhcp+option82+subscriber-id+insert+enable"><b><span class="cmdname">dhcp option82 subscriber-id insert enable</span></b></a> <strong><span>self-define</span></strong> <i><span class="varname">self-define-value</span></i></span></span><p><p>The function to insert the Option 82 Subscriber-ID into DHCP request messages is enabled.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span></span><p><p>Return to the system view.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <strong><a href="cmdqueryname=dhcp+rate-limit"><b><span class="cmdname">dhcp rate-limit</span></b></a></strong> { <strong>disable</strong> | <em>rateLimitValue</em> }</span><p><p>Global rate limiting is disabled for DHCP messages or a rate limit is configured for DHCP messages.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=dhcp+relay+arp+user-detect+interval"><b><span class="cmdname">dhcp relay arp user-detect interval</span></b></a> <i><span class="varname">interval</span></i></span><p><p>The ARP probe time for the DHCP relay user table is configured.</p>
</p></li><li class="substepexpand"><span>(Optional) Perform the following steps as required:</span><p><ul><li>To enable the DHCP relay agent to store user entries, run the <a href="cmdqueryname=dhcp+relay+unnumbered+table+autosave"><b><span class="cmdname">dhcp relay unnumbered table autosave</span></b></a> command.<p>When DHCP relay users go online in address unnumbered scenarios, device faults may result in data loss. To prevent such loss, you can enable the DHCP relay agent to store user entries. In this case, the system generates a backup file <strong>dhcpr_user.dat</strong> in the <strong>/home/dhcp</strong> directory.</p>
</li><li>To configure an interval at which the DHCP relay agent stores user entries, run the <a href="cmdqueryname=dhcp+relay+unnumbered+table+write-delay"><b><span class="cmdname">dhcp relay unnumbered table write-delay </span></b></a><i><span class="varname">interval-value</span></i> command.</li></ul>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li></ul></div>
<div class="postreq"><a name="EN-US_TASK_0172364690__1.4.3"></a><a name="1.4.3"></a><h4 class="sectiontitle">Follow-up Procedure</h4>
<div class="p"><ul><li><p>(Optional) Run <span><a href="cmdqueryname=dhcp+dscp-outbound"><b><span class="cmdname">dhcp dscp-outbound</span></b></a> <i><span class="varname">dscp</span></i></span></p>
<p>The differentiated services code point (DSCP) value is set for DHCP messages.</p>
</li><li><p>(Optional) Run <span><a href="cmdqueryname=dhcp+ip-ttl"><b><span class="cmdname">dhcp ip-ttl</span></b></a> <i><span class="varname">ttl-value</span></i></span></p>
<p>The time to live (TTL) value is set for DHCP messages.</p>
</li><li><p>(Optional) Run <span><a href="cmdqueryname=dhcp+relay+reply+broadcast-always"><b><span class="cmdname">dhcp relay reply broadcast-always</span></b></a></span></p>
<p>The DHCP relay agent is enabled to broadcast response messages upon receipt of client requests.</p>
</li><li><p>(Optional) Run <span><a href="cmdqueryname=dhcp+option-82+ignore-hostname-match"><b><span class="cmdname">dhcp option-82 ignore-hostname-match</span></b></a></span></p>
<p>The device is configured to ignore the host name matching check when parsing the Option 82 field.</p>
<p>If dot1q or QinQ VLAN tag termination sub-interfaces are configured for user access and the messages exchanged between a client and a server are transmitted through different upstream and downstream paths, you can configure an upstream DHCP relay agent to insert the Option 82 field carrying user VLAN information to messages and configure a downstream DHCP relay agent to ignore the host name matching check so that users can successfully go online. However, the host name carried in the Option 82 is the host name of the upstream relay agent. Therefore, the downstream relay agent may fail to parse the Option 82 because the host name carried in the Option 82 is different from the host name of the local device. In this case, you need to configure the downstream relay agent to ignore the host name matching check, so that the user VLAN information can be correctly parsed from the Option 82.</p>
</li></ul>
</div></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_dhcp_relay_cfg_0003.html">Configuring DHCP Relay
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_dhcp_relay_cfg_0200.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>