
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring the BGP Community Attribute">
<meta name="abstract" content="By setting the community attribute, you can flexibly control BGP route selection.">
<meta name="description" content="By setting the community attribute, you can flexibly control BGP route selection.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_3070.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_4076.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_4078.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,bgpvrp,w00556928,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Route">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Route">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Route">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing Basis">
<meta name="OWNER" content="w00604599">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00615954">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172366379">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring the BGP Community Attribute</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172366379"></a><a name="EN-US_TASK_0172366379"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring the BGP Community Attribute</h1>
<div class="taskbody"><p>By setting the community attribute, you can flexibly control BGP route selection.</p>
<div class="context"><a name="EN-US_TASK_0172366379__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>Enterprises A, B, and C belong to different ASs, and enterprise B's network communicates with the networks of the other two enterprises through EBGP connections. Enterprise A and C are rivals, and enterprise A requires that the routes it sends to enterprise B be transmitted only within enterprise B. In this situation, you can configure the community attribute on the router in enterprise A that sends routes to enterprise B.</p>
<p>In <a href="#EN-US_TASK_0172366379__fig_dc_vrp_bgp_cfg_407701">Figure 1</a>, EBGP connections are established between <span class="keyword">Device</span> B and <span class="keyword">Device</span> A, and between <span class="keyword">Device</span> B and <span class="keyword">Device</span> C. It is required that the routes advertised from AS 10 to AS 20 are not advertised to other ASs by AS 20. In this situation, configure the community attribute No_Export on <span class="keyword">Device</span> A.</p>
<div class="fignone" id="EN-US_TASK_0172366379__fig_dc_vrp_bgp_cfg_407701"><a name="EN-US_TASK_0172366379__fig_dc_vrp_bgp_cfg_407701"></a><a name="fig_dc_vrp_bgp_cfg_407701"></a><span class="figcap"><b>Figure 1 </b>Configuring the BGP community attribute</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 through 3 in this example are GE <span>0/1/0</span>, GE <span>0/2/0</span>, and GE <span>0/3/0</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_bgp_cfg_407701.png"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172366379__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Precautions</h4><p>To improve security, you are advised to deploy BGP security measures. For details, see "Configuring BGP Security." Keychain authentication is used as an example. For details, see "Example for Configuring BGP Keychain."</p>
</div></div>
<div class="context"><a name="EN-US_TASK_0172366379__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Establish EBGP connections between <span class="keyword">Device</span> A and<span class="keyword">Device</span> B, and between <span class="keyword">Device</span> B and <span class="keyword">Device</span> C.</p>
</li><li><p>Configure a routing policy on <span class="keyword">Device</span> A to advertise the community attribute No_Export.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172366379__1.4.4"></a><a name="1.4.4"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>Router ID and AS number of <span class="keyword">Device</span> A</p>
</li><li><p>Router ID and AS number of <span class="keyword">Device</span> B</p>
</li><li><p>Router ID and AS number of <span class="keyword">Device</span> C</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172366379__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure an IP address for each interface. For configuration details, see <a href="#EN-US_TASK_0172366379__section_dc_vrp_bgp_cfg_407705">Configuration Files</a> in this section.</span></li><li><span>Configure EBGP connections.</span><p><p># Configure <span class="keyword">Device</span> A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>bgp 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp] <strong>router-id 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp] <strong>peer 10.1.2.2 as-number 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp]<strong> ipv4-family unicast</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp-af-ipv4]<strong> network 10.5.1.0 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp-af-ipv4]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-bgp-af-ipv4] <strong>quit</strong></pre>
<p># Configure <span class="keyword">Device</span> B.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>bgp 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp] <strong>router-id 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp] <strong>peer 10.1.2.1 as-number 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp] <strong>peer 10.1.3.2 as-number 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-bgp] <strong>quit</strong></pre>
<p># Configure <span class="keyword">Device</span> C.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C]<strong> bgp 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp]<strong> router-id 3.3.3.3 </strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp] <strong>peer 10.1.3.1 as-number 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C-bgp] <strong>quit</strong></pre>
<p># Check the routing table of <span class="keyword">Device</span> B.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>display bgp routing-table 10.5.1.0</strong>

BGP local router ID : 2.2.2.2
 Local AS number : 20
 Paths:   1 available, 1 best, 1 select
 BGP routing table entry information of 10.5.1.0/24:
 From: 10.1.2.1 (1.1.1.1)
 Route Duration: 0d00h00m37s
 Direct Out-interface: GigabitEthernet<span>0/2/0</span>
 Original nexthop: 10.1.2.1
 Qos information : 0x0
 AS-path 10, origin igp, MED 0, pref-val 0, valid, external, best, select, pre 255
 <strong>Advertised to such 2 peers:</strong>
    <strong>10.1.2.1</strong>
    <strong>10.1.3.2</strong></pre>
<p>The command output shows that <span class="keyword">Device</span> B advertises the received routes to <span class="keyword">Device</span> C in AS 30.</p>
<p># Check the routing table of <span class="keyword">Device</span> C.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C] <strong>display bgp routing-table</strong>

 BGP Local router ID is 3.3.3.3
 Status codes: * - valid, &gt; - best, d - damped,<span> x - best external,</span><span> a - add path,</span>
               h - history,  i - internal, s - suppressed, S - Stale
               Origin : i - IGP, e - EGP, ? - incomplete
 RPKI validation codes: V - valid, I - invalid, N - not-found


 Total Number of Routes: 1
      Network            NextHop        MED        LocPrf    PrefVal Path/Ogn

 *&gt;   <strong>10.5.1.0/24</strong>        10.1.3.1                             0      20 10i</pre>
<p>In the routing table, you can view that <span class="keyword">Device</span> C learns the route to 10.5.1.0/24 from <span class="keyword">Device</span> B.</p>
</p></li><li><span>Configure the BGP community attribute.</span><p><p># Configure a routing policy on <span class="keyword">Device</span> A to ensure that the routes advertised by <span class="keyword">Device</span> A to <span class="keyword">Device</span> B are not advertised by <span class="keyword">Device</span> B to any other AS.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>route-policy comm_policy permit node 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-route-policy] <strong>apply community no-export</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-route-policy] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-route-policy] <strong>quit</strong></pre>
<p># Apply the routing policy.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>bgp 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp] <strong>ipv4-family unicast</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp-af-ipv4] <strong>peer 10.1.2.2 route-policy comm_policy export</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp-af-ipv4] <strong>peer 10.1.2.2 advertise-community</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp-af-ipv4] <strong>commit</strong></pre>
<p># Check the routing table of <span class="keyword">Device</span> B.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>display bgp routing-table 10.5.1.0</strong>

BGP local router ID : 2.2.2.2
 Local AS number : 20
 Paths:   1 available, 1 best, 1 select
 BGP routing table entry information of 10.5.1.0/24:
 From: 10.1.2.1 (1.1.1.1)
 Route Duration: 0d00h00m12s
 Direct Out-interface: GigabitEthernet<span>0/2/0</span>
 Original nexthop: 10.1.2.1
 Qos information : 0x0
 <strong>Community:no-export</strong>
 AS-path 10, origin igp, MED 0, pref-val 0, valid, external, best, select, pre 255
 <strong>Not advertised to any peers yet</strong></pre>
<p>The command output on <span class="keyword">Device</span>B shows the configured community attribute and that the route to 10.5.1.0/24 has not been advertised to <span class="keyword">Device</span>C.</p>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0172366379__section_dc_vrp_bgp_cfg_407705"><a name="EN-US_TASK_0172366379__section_dc_vrp_bgp_cfg_407705"></a><a name="section_dc_vrp_bgp_cfg_407705"></a><a name="EN-US_TASK_0172366379__1.4.6"></a><a name="1.4.6"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p><span class="keyword">Device</span> A configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname <span class="keyword">Device</span>A</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.5.1.1 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/2/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.1.2.1 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">bgp 10</pre>
<pre class="screen"> router-id 1.1.1.1</pre>
<pre class="screen"> peer 10.1.2.2 as-number 20</pre>
<pre class="screen"> #</pre>
<pre class="screen"> ipv4-family unicast</pre>
<pre class="screen">  undo synchronization 
  network 10.5.1.0 255.255.255.0</pre>
<pre class="screen">  peer 10.1.2.2 enable</pre>
<pre class="screen">  peer 10.1.2.2 route-policy comm_policy export</pre>
<pre class="screen">  peer 10.1.2.2 advertise-community</pre>
<pre class="screen">#</pre>
<pre class="screen">route-policy comm_policy permit node 10</pre>
<pre class="screen"> apply community no-export</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p><span class="keyword">Device</span> B configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname <span class="keyword">Device</span>B</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/2/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.1.2.2 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/3/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.1.3.1 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">bgp 20</pre>
<pre class="screen"> router-id 2.2.2.2</pre>
<pre class="screen"> peer 10.1.2.1 as-number 10</pre>
<pre class="screen"> peer 10.1.3.2 as-number 30</pre>
<pre class="screen"> #</pre>
<pre class="screen"> ipv4-family unicast</pre>
<pre class="screen">  undo synchronization 
  peer 10.1.2.1 enable</pre>
<pre class="screen">  peer 10.1.3.2 enable</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p><span class="keyword">Device</span> C configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname <span class="keyword">Device</span>C</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/3/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.1.3.2 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">bgp 30</pre>
<pre class="screen"> router-id 3.3.3.3</pre>
<pre class="screen"> peer 10.1.3.1 as-number 20</pre>
<pre class="screen"> #</pre>
<pre class="screen"> ipv4-family unicast</pre>
<pre class="screen">  undo synchronization 
  peer 10.1.3.1 enable</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_3070.html">Configuration Examples for BGP
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_4076.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_4078.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>