
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring Flapping Suppression Involved in BGP Next Hop Recursion">
<meta name="abstract" content="Flapping suppression involved in next-hop recursion prevents the system from frequently processing changes in routes that recurse to a frequently flapping next hop, thereby reducing system resource consumption and CPU usage.">
<meta name="description" content="Flapping suppression involved in next-hop recursion prevents the system from frequently processing changes in routes that recurse to a frequently flapping next hop, thereby reducing system resource consumption and CPU usage.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_3000.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_5012.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_4098.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,bgpvrp,w00556928,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Route">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Route">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing Basis">
<meta name="OWNER" content="w00604599">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00615954">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172366279">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring Flapping Suppression Involved in BGP Next Hop Recursion</title>
</head>
<body><a name="EN-US_TASK_0172366279"></a><a name="EN-US_TASK_0172366279"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring Flapping Suppression Involved in BGP Next Hop Recursion</h1>
<div class="taskbody"><p>Flapping suppression involved in next-hop recursion prevents the system from frequently processing changes in routes that recurse to a frequently flapping next hop, thereby reducing system resource consumption and CPU usage.</p>
<div class="context"><a name="EN-US_TASK_0172366279__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Usage Scenario</h4><p>If a large number of routes recurse to the same next hop that flaps frequently, the system will be busy processing changes of these routes, which consumes excessive system resources and leads to high CPU usage. To address this problem, configure flapping suppression involved in next-hop recursion.</p>
<div class="p">By default, flapping suppression involved in next-hop recursion is enabled. After this function is enabled, BGP calculates the penalty value that starts from 0 by comparing the flapping interval with configured intervals if next hop flapping occurs. When the penalty value exceeds 10, BGP suppresses route recursion to the corresponding next hop. For example, if the intervals for increasing, retaining, and clearing the penalty value are T1, T2, and T3, respectively, BGP calculates the penalty value as follows:<ul><li>Increases the penalty value by 1 if the flapping interval is less than T1.</li><li>Retains the penalty value if the flapping interval is greater than or equal to T1, but less than T2.</li><li>Reduces the penalty value by 1 if the flapping interval is greater than or equal to T2, but less than T3.</li><li>Clears the penalty value if the flapping interval is greater than or equal to T3.</li></ul>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172366279__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Pre-configuration tasks</h4><p>Before configuring flapping suppression involved in BGP next-hop recursion, <a href="dc_vrp_bgp_cfg_3004.html">configure basic BGP functions</a>.</p>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172366279__1.4.3"></a><a name="1.4.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Run <span><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span></span><p><p>The system view is displayed.</p>
</p></li><li><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span><p><p>The BGP view is displayed.</p>
</p></li><li><span>Run <span><a href="cmdqueryname=ipv4-family+unicast"><b><span class="cmdname">ipv4-family</span></b></a> <strong><span>unicast</span></strong></span></span><p><p>The IPv4 unicast address family view is displayed.</p>
</p></li><li><span>Run <span><a href="cmdqueryname=undo+nexthop+recursive-lookup+restrain+disable"><b><span class="cmdname">undo nexthop recursive-lookup restrain disable</span></b></a></span></span><p><p>Flapping suppression involved in next hop recursion is enabled.</p>
</p><p><p>If you do not want to slow down route recursion processing and high CPU usage due to route recursion change processing is not a concern, you can disable flapping suppression involved in next-hop recursion using the <a href="cmdqueryname=nexthop+recursive-lookup+restrain+disable"><b><span class="cmdname">nexthop recursive-lookup restrain disable</span></b></a> command.</p>
</p></li><li><span>Run <span><a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span></span><p><p>Return to the BGP view.</p>
</p></li><li><span>Run <span><a href="cmdqueryname=nexthop+recursive-lookup+restrain+suppress-interval"><b><span class="cmdname">nexthop recursive-lookup restrain</span></b></a> <strong><span>suppress-interval</span></strong> <i><span class="varname">add-count-time</span></i> <strong><span>hold-interval</span></strong> <i><span class="varname">hold-count-time</span></i> <strong><span>clear-interval</span></strong> <i><span class="varname">clear-count-time</span></i></span></span><p><p>The intervals are configured for increasing, retaining, and clearing the penalty value for flapping suppression involved in next hop recursion.</p>
</p></li><li><span>Run <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span></span><p><p>The configuration is committed.</p>
</p></li></ol></div>
<div class="postreq"><a name="EN-US_TASK_0172366279__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p>After the configuration is complete, verify it.</p>
<ul><li>Run the <a href="cmdqueryname=display+bgp+routing-table"><b><span class="cmdname">display bgp routing-table</span></b></a> command to check BGP public network route information.</li><li>Run the <a href="cmdqueryname=display+bgp+vpnv4+routing-table"><b><span class="cmdname">display bgp vpnv4 routing-table</span></b></a> command to check BGP VPNv4 and BGP VPN route information.</li></ul>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_3000.html">BGP Configuration
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_5012.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_4098.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>