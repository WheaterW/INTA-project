
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring BGP ADD-PATH">
<meta name="abstract" content="With BGP ADD-PATH, a route reflector (RR) can send two or more routes with the same prefix to a specified IBGP peer. After reaching the IBGP peer, these routes can back up each other or load-balance traffic, which ensures high reliability in data transmission.">
<meta name="description" content="With BGP ADD-PATH, a route reflector (RR) can send two or more routes with the same prefix to a specified IBGP peer. After reaching the IBGP peer, these routes can back up each other or load-balance traffic, which ensures high reliability in data transmission.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_3070.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_4084.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_3085.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,bgpvrp,w00556928,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Route">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Route">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Route">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing Basis">
<meta name="OWNER" content="w00604599">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00615954">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172366406">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>Example for Configuring BGP ADD-PATH</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172366406"></a><a name="EN-US_TASK_0172366406"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring BGP ADD-PATH</h1>
<div class="taskbody"><p>With BGP ADD-PATH, a route reflector (RR) can send two or more routes with the same prefix to a specified IBGP peer. After reaching the IBGP peer, these routes can back up each other or load-balance traffic, which ensures high reliability in data transmission.</p>
<div class="context"><a name="EN-US_TASK_0172366406__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>In a scenario with an RR and clients, if the RR has multiple routes to the same destination (with the same prefix), the RR selects an optimal route from these routes and then sends only the optimal route to its clients. Therefore, the clients have only one route to the destination. If a link along this route fails, route convergence takes a long time, which cannot meet the requirements for high reliability.</p>
<p>To address this issue, deploy the BGP ADD-PATH feature on the RR. With BGP ADD-PATH, the RR can send two or more routes with the same prefix to a specified IBGP peer. These routes can back up each other or load-balance traffic, which ensures high reliability in data transmission.</p>
<p>On the network shown in <a href="#EN-US_TASK_0172366406__fig_dc_vrp_bgp_cfg_309701">Figure 1</a>, <span class="keyword">Device</span> A, <span class="keyword">Device</span> B, and <span class="keyword">Device</span> C are clients of the RR, and <span class="keyword">Device</span> D is an EBGP peer of <span class="keyword">Device</span> B and <span class="keyword">Device</span> C. </p>
<p>To ensure high reliability in data transmission, configure BGP Add-Path on the RR and enable <span class="keyword">Device</span>A to receive Add-Path routes from the RR so that <span class="keyword">Device</span>A can have multiple routes with the same prefix. </p>
<div class="fignone" id="EN-US_TASK_0172366406__fig_dc_vrp_bgp_cfg_309701"><a name="EN-US_TASK_0172366406__fig_dc_vrp_bgp_cfg_309701"></a><a name="fig_dc_vrp_bgp_cfg_309701"></a><span class="figcap"><b>Figure 1 </b>Networking for configuring BGP ADD-PATH</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 through 6 in this example represent GE <span>0/3/0</span>, GE <span>0/3/2</span>, GE <span>0/3/3</span>, GE <span>0/1/1</span>, GE <span>0/1/2</span>, and GE <span>0/1/3</span>, respectively. </p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_bgp_cfg_309701.png" width="NaN" height="NaN"></span><br></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172366406__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Precautions</h4><p>When configuring the BGP Add-Path function, enable the capability of sending Add-Path routes on the route sender and the capability of receiving Add-Path routes on the route receiver so that Add-Path routes can be exchanged between the two ends. If BGP Add-Path is enabled and the device is also configured to change the next hops of the routes to be advertised to the local address, a routing loop may occur.</p>
<p>To improve security, you are advised to deploy BGP security measures. For details, see "Configuring BGP Security." Keychain authentication is used as an example. For details, see "Example for Configuring BGP Keychain."</p>
</div></div>
<div class="context"><a name="EN-US_TASK_0172366406__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure an IP address for each interface on each <span class="keyword">Router</span>.</p>
</li><li><p>Configure basic BGP functions on each <span class="keyword">Router</span>.</p>
</li><li><p>Enable BGP ADD-PATH on the RR, enable the RR to send ADD-PATH routes to <span class="keyword">Device</span> A, and configure the number of routes that the RR can send to <span class="keyword">Device</span> A.</p>
</li><li><p>Enable <span class="keyword">Device</span> A to receive BGP ADD-PATH routes from the RR.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172366406__1.4.4"></a><a name="1.4.4"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>Router IDs of <span class="keyword">Device</span> A, <span class="keyword">Device</span> B, <span class="keyword">Device</span> C, <span class="keyword">Device</span> D, and the RR, and their AS numbers, as listed in <a href="#EN-US_TASK_0172366406__table_dc_vrp_bgp_cfg_309701">Table 1</a></p>
</li></ul>

<div class="tableBorder"><a name="EN-US_TASK_0172366406__table_dc_vrp_bgp_cfg_309701"></a><a name="table_dc_vrp_bgp_cfg_309701"></a><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" id="EN-US_TASK_0172366406__table_dc_vrp_bgp_cfg_309701" frame="border" border="1" rules="all"><caption><b>Table 1 </b>Configurations of each device</caption><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="20%" id="mcps1.4.4.4.2.6.1.1" liSelected="liSelected"><p>Device</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="20%" id="mcps1.4.4.4.2.6.1.2" liSelected="liSelected"><p>Router ID</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="20%" id="mcps1.4.4.4.2.6.1.3" liSelected="liSelected"><p>Interface</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="20%" id="mcps1.4.4.4.2.6.1.4" liSelected="liSelected"><p>IP Address</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="20%" id="mcps1.4.4.4.2.6.1.5" liSelected="liSelected"><p>AS Number</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" rowspan="3" valign="middle" width="20%" headers="mcps1.4.4.4.2.6.1.1 "><p><span class="keyword">Device</span> A</p>
</td>
<td class="cellrowborder" rowspan="3" valign="middle" width="20%" headers="mcps1.4.4.4.2.6.1.2 "><p>1.1.1.1</p>
</td>
<td class="cellrowborder" valign="top" width="20%" headers="mcps1.4.4.4.2.6.1.3 "><p>GigabitEthernet <span>0/3/0</span></p>
</td>
<td class="cellrowborder" valign="top" width="20%" headers="mcps1.4.4.4.2.6.1.4 "><p>172.16.3.1/24</p>
</td>
<td class="cellrowborder" rowspan="3" valign="middle" width="20%" headers="mcps1.4.4.4.2.6.1.5 "><p>AS 65008</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.4.4.2.6.1.3 "><p>GigabitEthernet <span>0/1/1</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.4.4.2.6.1.4 "><p>172.16.2.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.4.4.2.6.1.3 "><p>GigabitEthernet <span>0/1/3</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.4.4.2.6.1.4 "><p>172.16.1.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="3" valign="middle" width="20%" headers="mcps1.4.4.4.2.6.1.1 "><p><span class="keyword">Device</span> B</p>
</td>
<td class="cellrowborder" rowspan="3" valign="middle" width="20%" headers="mcps1.4.4.4.2.6.1.2 "><p>2.2.2.2</p>
</td>
<td class="cellrowborder" valign="top" width="20%" headers="mcps1.4.4.4.2.6.1.3 "><p>GigabitEthernet <span>0/3/0</span></p>
</td>
<td class="cellrowborder" valign="top" width="20%" headers="mcps1.4.4.4.2.6.1.4 "><p>172.16.3.2/24</p>
</td>
<td class="cellrowborder" rowspan="3" valign="middle" width="20%" headers="mcps1.4.4.4.2.6.1.5 "><p>AS 65008</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.4.4.2.6.1.3 "><p>GigabitEthernet <span>0/3/2</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.4.4.2.6.1.4 "><p>172.16.7.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.4.4.2.6.1.3 "><p>GigabitEthernet <span>0/1/2</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.4.4.2.6.1.4 "><p>172.16.5.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="3" valign="middle" width="20%" headers="mcps1.4.4.4.2.6.1.1 "><p><span class="keyword">Device</span> C</p>
</td>
<td class="cellrowborder" rowspan="3" valign="middle" width="20%" headers="mcps1.4.4.4.2.6.1.2 "><p>3.3.3.3</p>
</td>
<td class="cellrowborder" valign="top" width="20%" headers="mcps1.4.4.4.2.6.1.3 "><p>GigabitEthernet <span>0/3/0</span></p>
</td>
<td class="cellrowborder" valign="top" width="20%" headers="mcps1.4.4.4.2.6.1.4 "><p>172.16.6.1/24</p>
</td>
<td class="cellrowborder" rowspan="3" valign="middle" width="20%" headers="mcps1.4.4.4.2.6.1.5 "><p>AS 65008</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.4.4.2.6.1.3 "><p>GigabitEthernet <span>0/3/3</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.4.4.2.6.1.4 "><p>172.16.4.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.4.4.2.6.1.3 "><p>GigabitEthernet <span>0/1/3</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.4.4.2.6.1.4 "><p>172.16.1.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="3" valign="middle" width="20%" headers="mcps1.4.4.4.2.6.1.1 "><p><span class="keyword">Device</span> D</p>
</td>
<td class="cellrowborder" rowspan="3" valign="middle" width="20%" headers="mcps1.4.4.4.2.6.1.2 "><p>4.4.4.4</p>
</td>
<td class="cellrowborder" valign="top" width="20%" headers="mcps1.4.4.4.2.6.1.3 "><p>GigabitEthernet <span>0/3/0</span></p>
</td>
<td class="cellrowborder" valign="top" width="20%" headers="mcps1.4.4.4.2.6.1.4 "><p>172.16.6.2/24</p>
</td>
<td class="cellrowborder" rowspan="3" valign="middle" width="20%" headers="mcps1.4.4.4.2.6.1.5 "><p>AS 65009</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.4.4.2.6.1.3 "><p>GigabitEthernet <span>0/3/2</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.4.4.2.6.1.4 "><p>172.16.7.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.4.4.2.6.1.3 "><p>LoopBack0</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.4.4.2.6.1.4 "><p>1.1.1.1/32</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="3" valign="middle" width="20%" headers="mcps1.4.4.4.2.6.1.1 "><p>RR</p>
</td>
<td class="cellrowborder" rowspan="3" valign="middle" width="20%" headers="mcps1.4.4.4.2.6.1.2 "><p>5.5.5.5</p>
</td>
<td class="cellrowborder" valign="top" width="20%" headers="mcps1.4.4.4.2.6.1.3 "><p>GigabitEthernet <span>0/3/3</span></p>
</td>
<td class="cellrowborder" valign="top" width="20%" headers="mcps1.4.4.4.2.6.1.4 "><p>172.16.4.1/24</p>
</td>
<td class="cellrowborder" rowspan="3" valign="middle" width="20%" headers="mcps1.4.4.4.2.6.1.5 "><p>AS 65008</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.4.4.2.6.1.3 "><p>GigabitEthernet <span>0/1/1</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.4.4.2.6.1.4 "><p>172.16.2.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.4.4.2.6.1.3 "><p>GigabitEthernet <span>0/1/2</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.4.4.2.6.1.4 "><p>172.16.5.1/24</p>
</td>
</tr>
</tbody>
</table>
</div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172366406__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure an IP address for each interface on each <span class="keyword">Router</span>. For configuration details, see <a href="#EN-US_TASK_0172366406__section_dc_vrp_bgp_cfg_309705">Configuration Files</a> in this section.</span></li><li><span>Configure basic BGP functions. Establish an IBGP peer relationship between <span class="keyword">Device</span>A and the RR, between <span class="keyword">Device</span>B and the RR, and between <span class="keyword">Device</span>C and the RR. Configure <span class="keyword">Device</span>A, <span class="keyword">Device</span>B, and <span class="keyword">Device</span>C as clients of the RR. Establish an EBGP peer relationship between <span class="keyword">Device</span>B and <span class="keyword">Device</span>D, and between <span class="keyword">Device</span>C and <span class="keyword">Device</span>D.</span><p><p># Configure <span class="keyword">Device</span> A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A]<strong> bgp 65008</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp]<strong> router-id 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp]<strong> peer 172.16.2.2 as-number 65008</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp]<strong> import-route direct</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-bgp]<strong> quit</strong></pre>
<p># Configure <span class="keyword">Device</span> B.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B]<strong> bgp 65008</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp]<strong> router-id 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp]<strong> peer 172.16.5.1 as-number 65008</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp]<strong> peer 172.16.7.2 as-number 65009</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp]<strong> import-route direct</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-bgp]<strong> quit</strong></pre>
<p># Configure <span class="keyword">Device</span> C.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C]<strong> bgp 65008</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp]<strong> router-id 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp]<strong> peer 172.16.4.1 as-number 65008</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp]<strong> peer 172.16.6.2 as-number 65009</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp]<strong> import-route direct</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C-bgp]<strong> quit</strong></pre>
<p># Configure <span class="keyword">Device</span> D.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>D]<strong> bgp 65009</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-bgp]<strong> router-id 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-bgp]<strong> peer 172.16.6.1 as-number 65008</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-bgp]<strong> peer 172.16.7.1 as-number 65008</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-bgp]<strong> import-route direct</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-bgp]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>D-bgp]<strong> quit</strong></pre>
<p># Configure the RR.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RR]<strong> bgp 65008</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp]<strong> router-id 5.5.5.5</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp]<strong> peer 172.16.2.1 as-number 65008</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp]<strong> peer 172.16.4.2 as-number 65008</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp]<strong> peer 172.16.5.2 as-number 65008</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp]<strong> peer 172.16.2.1 reflect-client</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp]<strong> peer 172.16.4.2 reflect-client</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp]<strong> peer 172.16.5.2 reflect-client</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp]<strong> import-route direct</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RR-bgp]<strong> quit</strong></pre>
<p># Display information about the routes to 1.1.1.1 on <span class="keyword">Device</span> A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A]<strong> display bgp routing-table 1.1.1.1</strong>

 BGP local router ID : 1.1.1.1
 Local AS number : 65008
 Paths:   1 available, 1 best, 1 select<span>, 0 best-external</span><span>, 0 add-path</span>
 BGP routing table entry information of 1.1.1.1/32:
 From: 172.16.2.2 (5.5.5.5)
 Route Duration: 0d00h00m25s
 Relay IP Nexthop: 172.16.2.2
 Relay IP Out-interface: GigabitEthernet<span>0/1/1</span>
 Original nexthop: 172.16.7.2
 Qos information : 0x0
 AS-path 65009, origin incomplete, MED 0, localpref 100, pref-val 0, valid, inte
rnal, best, select, pre 255
 Originator: 2.2.2.2
 Cluster list: 5.5.5.5
 Not advertised to any peer yet</pre>
<p>The command output shows that <span class="keyword">Device</span> A received only one BGP route to 1.1.1.1 from the RR before BGP ADD-PATH is configured.</p>
</p></li><li><span>Enable BGP ADD-PATH on the RR and enable <span class="keyword">Device</span> A to receive BGP ADD-PATH routes from the RR.</span><p><p># Configure the RR.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RR]<strong> bgp 65008</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RR-bgp]<strong> bestroute add-path path-number 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp]<strong> peer 172.16.2.1 capability-advertise add-path send</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp]<strong> peer 172.16.2.1 advertise add-path path-number 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RR-bgp]<strong> quit</strong></pre>
<p># Configure <span class="keyword">Device</span> A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A]<strong> bgp 65008</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-bgp]<strong> peer 172.16.2.2 capability-advertise add-path receive</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-bgp]<strong> quit</strong></pre>
<p># Display information about the routes to 1.1.1.1 on <span class="keyword">Device</span> A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A]<strong> display bgp routing-table 1.1.1.1</strong>

 BGP local router ID : 1.1.1.1
 Local AS number : 65008
 Paths:   2 available, 1 best, 1 select<span>, 0 best-external</span><span>, 0 add-path</span>
 BGP routing table entry information of 1.1.1.1/32:
 From: 172.16.2.2 (5.5.5.5)
 Route Duration: 0d00h00m48s
 Relay IP Nexthop: 172.16.2.2
 Relay IP Out-interface: GigabitEthernet<span>0/1/1</span>
 Original nexthop: <strong>172.16.7.2</strong>
 Qos information : 0x0
 AS-path 65009, origin incomplete, MED 0, localpref 100, pref-val 0, valid, inte
rnal, best, select, pre 255
 Received path-id: 0
 Originator: 2.2.2.2
 Cluster list: 5.5.5.5
 Not advertised to any peer yet

 BGP routing table entry information of 1.1.1.1/32:
 From: 172.16.2.2 (5.5.5.5)
 Route Duration: 0d00h00m48s
 Relay IP Nexthop: 172.16.2.2
 Relay IP Out-interface: GigabitEthernet<span>0/1/1</span>
 Original nexthop: <strong>172.16.6.2</strong>
 Qos information : 0x0
 AS-path 65009, origin incomplete, MED 0, localpref 100, pref-val 0, valid, inte
rnal, pre 255, not preferred for router ID
 Received path-id: 1
 Originator: 3.3.3.3
 Cluster list: 5.5.5.5
 Not advertised to any peer yet</pre>
<p>The command output shows that <span class="keyword">Device</span> A received two routes from the RR. The route with the original nexthop 172.16.7.2 is the optimal route selected by the RR, and the other one with the original nexthop 172.16.6.2 is an ADD-PATH route.</p>
<p># Display information about the routes to 1.1.1.1 on the RR.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RR]<strong> display bgp routing-table 1.1.1.1</strong>

BGP local router ID : 5.5.5.5
 Local AS number : 65008
 Paths:   2 available, 1 best, 1 select, 0 best-external, <strong>1 add-path</strong>
 BGP routing table entry information of 1.1.1.1/32:
 RR-client route.
 From: 172.16.5.2 (2.2.2.2)
 Route Duration: 0d00h19m39s
 Relay IP Nexthop: 172.16.5.2
 Relay IP Out-interface: GigabitEthernet<span>0/1/2</span>
 Original nexthop: 172.16.7.2
 Qos information : 0x0
 AS-path 65009, origin incomplete, MED 0, localpref 100, pref-val 0, valid, inte
rnal, best, select, pre 255
 Advertised to such 3 peers:
    172.16.5.2
    172.16.4.2
    172.16.2.1

 BGP routing table entry information of 1.1.1.1/32:
 RR-client route.
 From: 172.16.4.2 (3.3.3.3)
 Route Duration: 0d00h19m41s
 Relay IP Nexthop: 172.16.4.2
 Relay IP Out-interface: GigabitEthernet<span>0/3/3</span>
 Original nexthop: 172.16.6.2
 Qos information : 0x0
 AS-path 65009, origin incomplete, MED 0, localpref 100, pref-val 0, valid, inte
rnal, <strong>add-path</strong>, pre 255, not preferred for router ID
 Advertised to such 1 peers:
    <strong>172.16.2.1</strong></pre>
<p>The command output shows that the RR sent the optimal route to all its clients but sent the ADD-PATH route only to <span class="keyword">Device</span> A.</p>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0172366406__section_dc_vrp_bgp_cfg_309705"><a name="EN-US_TASK_0172366406__section_dc_vrp_bgp_cfg_309705"></a><a name="section_dc_vrp_bgp_cfg_309705"></a><a name="EN-US_TASK_0172366406__1.4.6"></a><a name="1.4.6"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p><span class="keyword">Device</span> A configuration file</p>
<pre class="screen">#
sysname <span class="keyword">Device</span>A
#
interface GigabitEthernet<span>0/3/0</span>
 undo shutdown
 ip address 172.16.3.1 255.255.255.0
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 172.16.2.1 255.255.255.0
#
interface GigabitEthernet<span>0/1/3</span>
 undo shutdown
 ip address 172.16.1.1 255.255.255.0
#
bgp 65008
 router-id 1.1.1.1
 peer 172.16.2.2 as-number 65008
 #
 ipv4-family unicast
<span>  undo synchronization</span>
  import-route direct
  peer 172.16.2.2 enable
  peer 172.16.2.2 capability-advertise add-path receive
#
return</pre>
</li><li><p><span class="keyword">Device</span> B configuration file</p>
<pre class="screen">#
sysname <span class="keyword">Device</span>B
#
interface GigabitEthernet<span>0/3/0</span>
 undo shutdown
 ip address 172.16.3.2 255.255.255.0
#
interface GigabitEthernet<span>0/3/2</span>
 undo shutdown
 ip address 172.16.7.1 255.255.255.0
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ip address 172.16.5.2 255.255.255.0
#
bgp 65008
 router-id 2.2.2.2
 peer 172.16.5.1 as-number 65008
 peer 172.16.7.2 as-number 65009
 #
 ipv4-family unicast
<span>  undo synchronization</span>
  import-route direct
  peer 172.16.5.1 enable
  peer 172.16.7.2 enable
#
return</pre>
</li><li><p><span class="keyword">Device</span> C configuration file</p>
<pre class="screen">#
sysname <span class="keyword">Device</span>C
#
interface GigabitEthernet<span>0/3/0</span>
 undo shutdown
 ip address 172.16.6.1 255.255.255.0
#
interface GigabitEthernet<span>0/3/3</span>
 undo shutdown
 ip address 172.16.4.2 255.255.255.0
#
interface GigabitEthernet<span>0/1/3</span>
 undo shutdown
 ip address 172.16.1.2 255.255.255.0
#
bgp 65008
 router-id 3.3.3.3
 peer 172.16.4.1 as-number 65008
 peer 172.16.6.2 as-number 65009
 #
 ipv4-family unicast
<span>  undo synchronization</span>
  import-route direct
  peer 172.16.4.1 enable
  peer 172.16.6.2 enable
#
return</pre>
</li><li><p><span class="keyword">Device</span> D configuration file</p>
<pre class="screen">#
sysname <span class="keyword">Device</span>D
#
interface GigabitEthernet<span>0/3/0</span>
 undo shutdown
 ip address 172.16.6.2 255.255.255.0
#
interface GigabitEthernet<span>0/3/2</span>
 undo shutdown
 ip address 172.16.7.2 255.255.255.0
#
interface LoopBack0
 ip address 1.1.1.1 255.255.255.255
#
bgp 65009
 router-id 4.4.4.4
 peer 172.16.6.1 as-number 65008
 peer 172.16.7.1 as-number 65008
 #
 ipv4-family unicast
<span>  undo synchronization</span>
  import-route direct
  peer 172.16.6.1 enable
  peer 172.16.7.1 enable
#
return</pre>
</li><li><p>RR configuration file</p>
<pre class="screen">#
sysname RR
#
interface GigabitEthernet<span>0/3/3</span>
 undo shutdown
 ip address 172.16.4.1 255.255.255.0
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 172.16.2.2 255.255.255.0
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ip address 172.16.5.1 255.255.255.0
#
bgp 65008
 router-id 5.5.5.5
 peer 172.16.2.1 as-number 65008
 peer 172.16.4.2 as-number 65008
 peer 172.16.5.2 as-number 65008
 #
 ipv4-family unicast
<span>  undo synchronization</span>
  import-route direct
  bestroute add-path path-number 2
  peer 172.16.2.1 enable
  peer 172.16.2.1 reflect-client
  peer 172.16.2.1 capability-advertise add-path send
  peer 172.16.2.1 advertise add-path path-number 2
  peer 172.16.4.2 enable
  peer 172.16.4.2 reflect-client
  peer 172.16.5.2 enable
  peer 172.16.5.2 reflect-client
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_3070.html">Configuration Examples for BGP
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_4084.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_3085.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>