
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring a BGP SR LSP">
<meta name="abstract" content="Deploying a complete BGP SR LSP on devices in the same AS helps implement end-to-end service interworking.">
<meta name="description" content="Deploying a complete BGP SR LSP on devices in the same AS helps implement end-to-end service interworking.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_3000.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_0084.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_3054.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Route">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Route">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing Basis">
<meta name="OWNER" content="l00425560">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00615954">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001167360277">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring a BGP SR LSP</title>
</head>
<body><a name="EN-US_TASK_0000001167360277"></a><a name="EN-US_TASK_0000001167360277"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring a BGP SR LSP</h1>
<div class="taskbody"><p>Deploying a complete BGP SR LSP on devices in the same AS helps implement end-to-end service interworking.</p>
<div class="context"><a name="EN-US_TASK_0000001167360277__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Usage Scenario</h4><p>On the network shown in <a href="#EN-US_TASK_0000001167360277__fig142771575412">Figure 1</a>, OSPF runs between DeviceA and DeviceB, between DeviceB and DeviceC, and between DeviceD and DeviceE. IS-IS runs between DeviceC and DeviceD. Basic MPLS capabilities and MPLS LDP are configured on DeviceA through DeviceE so that LDP LSPs are established between loopback interfaces of devices in each IGP area. Therefore, traffic between loopback interfaces of devices in each IGP area is encapsulated using MPLS. However, traffic cannot be transmitted across IGP areas because devices cannot ping each other across IGP areas. For example, DeviceA cannot ping DeviceE. To solve this problem, you need to configure an inner MPLS tunnel (BGP SR LSP) from 1.1.1.1 to 5.5.5.5 so that the traffic from 1.1.1.1 to 5.5.5.5 is forwarded through MPLS.</p>
<div class="fignone" id="EN-US_TASK_0000001167360277__fig142771575412"><a name="EN-US_TASK_0000001167360277__fig142771575412"></a><a name="fig142771575412"></a><span class="figcap"><b>Figure 1 </b>Configuring a BGP SR LSP</span><br><span><img class="vsd" src="figure/en-us_image_0000001120600478.png" width="NaN" height="NaN"></span></div>
</div></div>
<div class="steps-unordered"><a name="EN-US_TASK_0000001167360277__1.4.2"></a><a name="1.4.2"></a><h4 class="sectiontitle">Procedure</h4>
<ul><li><span>Configure an SRGB.</span><p><ol><li>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a><p>The system view is displayed.</p>
</li><li>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i><p>BGP is started (with the local AS number specified), and the BGP view is displayed.</p>
</li><li>Run <a href="cmdqueryname=segment-routing+global-block"><b><span class="cmdname">segment-routing global-block</span></b></a> <i><span class="varname">begin-value</span></i> <i><span class="varname">end-value</span></i><p>A BGP SRGB is configured.</p>
</li><li>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a><p>The configuration is committed.</p>
</li></ol>
</p></li><li><span>Configure a BGP peer relationship.</span><p><ol><li>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a><p>The system view is displayed.</p>
</li><li>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i><p>The BGP view is displayed.</p>
</li><li>Run <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <a href="cmdqueryname=as-number"><b><span class="cmdname">as-number</span></b></a> <i><span class="varname">as-number</span></i><p>The IP address of a peer and the number of the AS where the peer resides are specified.</p>
</li><li>Run <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <a href="cmdqueryname=connect-interface"><b><span class="cmdname">connect-interface</span></b></a> <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i> [ <i><span class="varname">ipv4-source-address</span></i> ]<p>A source interface and a source address to set up a TCP connection with the BGP peer are specified.</p>
</li><li>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a><p>The configuration is committed.</p>
</li></ol>
</p></li><li><span>Configure DeviceC and DeviceD as RRs.</span><p><ol><li>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a><p>The system view is displayed.</p>
</li><li>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i><p>The BGP view is displayed.</p>
</li><li>Run <a href="cmdqueryname=ipv4-family+unicast"><b><span class="cmdname">ipv4-family</span></b></a> <strong><span>unicast</span></strong><p>The BGP-IPv4 unicast address family view is displayed.</p>
</li><li>Run <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <a href="cmdqueryname=reflect-client"><b><span class="cmdname">reflect-client</span></b></a><p>An RR is configured, and its peer is specified as a client.</p>
<p>Configure DeviceA and DeviceD as clients of DeviceC, and configure DeviceC and DeviceE as clients of DeviceD.</p>
</li><li>Run <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <a href="cmdqueryname=next-hop-local"><b><span class="cmdname">next-hop-local</span></b></a><p>The device is configured to set the next hop address to its own address when advertising routes to clients.</p>
<p>To enable DeviceC or DeviceD to change the next hop address of a route to the local address before advertising the route to clients, run the <a href="cmdqueryname=peer+next-hop-local"><b><span class="cmdname">peer next-hop-local</span></b></a> command on DeviceC or DeviceD for each related client.</p>
</li><li>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a><p>The configuration is committed.</p>
</li></ol>
</p></li><li><span>Enable the function to exchange labeled IPv4 routes.</span><p><ol><li>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a><p>The system view is displayed.</p>
</li><li>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i><p>The BGP view is displayed.</p>
</li><li>Run <a href="cmdqueryname=peer+label-route-capability+check-tunnel-reachable"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>label-route-capability</span></strong> [ <strong><span>check-tunnel-reachable</span></strong> ]<p>The device is configured to exchange labeled IPv4 routes with a specified BGP peer.</p>
</li><li>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a><p>The configuration is committed.</p>
</li></ol>
</p></li><li><span>Configure the ingress for a BGP SR LSP.</span><p><ol><li>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a><p>The system view is displayed.</p>
</li><li>Run <a href="cmdqueryname=route-policy"><b><span class="cmdname">route-policy</span></b></a> <i><span class="varname">route-policy-name</span></i> <i><span class="varname">matchMode</span></i> <strong><span>node</span></strong> <i><span class="varname">node</span></i><p>A route-policy with a node is created, and the route-policy view is displayed.</p>
</li><li>Run <a href="cmdqueryname=apply+mpls-label"><b><span class="cmdname">apply mpls-label</span></b></a><p>The device is configured to allocate labels to IPv4 routes.</p>
</li><li>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a><p>Return to the system view.</p>
</li><li>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i><p>The BGP view is displayed.</p>
</li><li>Run <a href="cmdqueryname=network+route-policy+label-index"><b><span class="cmdname">network</span></b></a> <i><span class="varname">ipv4-address</span></i> [ <i><span class="varname">mask</span></i> | <i><span class="varname">mask-length</span></i> ] [ <strong><span>route-policy</span></strong> <i><span class="varname">route-policy-name</span></i><span> | <strong><span>route-filter</span></strong> <i><span class="varname">route-filter-name</span></i></span> ]<span> [ <strong><span>non-relay-tunnel</span></strong> ]</span> <strong><span>label-index</span></strong> <i><span class="varname"> label-index-value</span></i><p>BGP is configured to import a local route, and an offset is specified for the SRGB.</p>
</li><li>Run <a href="cmdqueryname=peer+route-policy+export"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>route-policy</span></strong> <i><span class="varname">route-policy-name</span></i> <strong><span>export</span></strong><p>The route-policy is applied to the routes to be advertised to the specified BGP peer.</p>
</li><li>Run <strong>ipv4-family unicast</strong><p>The BGP-IPv4 unicast address family view is displayed.</p>
</li><li>Run <a href="cmdqueryname=peer+prefix-sid"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">peerIpv4Addr</span></i> <strong><span>prefix-sid</span></strong><p>The device is configured to exchange prefix SID information with the specified IPv4 peer.</p>
</li><li>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a><p>The configuration is committed.</p>
</li></ol>
</p></li><li><span>Configure a transit node for the BGP SR LSP.</span><p><ol><li>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a><p>The system view is displayed.</p>
</li><li>Run <a href="cmdqueryname=route-policy+node"><b><span class="cmdname">route-policy</span></b></a> <i><span class="varname">route-policy-name</span></i> <em><i><span class="varname">matchMode</span></i></em> <strong><span>node</span></strong> <i><span class="varname">node</span></i><p>A route-policy with a node is created, and the route-policy view is displayed.</p>
</li><li>Run <a href="cmdqueryname=if-match+mpls-label"><b><span class="cmdname">if-match mpls-label</span></b></a><p>Labeled IPv4 routes are matched.</p>
</li><li>Run <a href="cmdqueryname=apply+mpls-label"><b><span class="cmdname">apply mpls-label</span></b></a><p>The device is configured to allocate labels to IPv4 routes.</p>
</li><li>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a><p>Return to the system view.</p>
</li><li>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i><p>The BGP view is displayed.</p>
</li><li>Run <a href="cmdqueryname=peer+route-policy+export"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>route-policy</span></strong> <i><span class="varname">route-policy-name</span></i> <strong><span>export</span></strong><p>The route-policy is applied to the routes to be advertised to the specified BGP peer.</p>
</li><li>Run <strong>ipv4-family unicast</strong><p>The BGP-IPv4 unicast address family view is displayed.</p>
</li><li>Run <a href="cmdqueryname=peer+prefix-sid"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">peerIpv4Addr</span></i> <strong><span>prefix-sid</span></strong><p>The device is configured to exchange prefix SID information with the specified IPv4 peer.</p>
</li><li>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a><p>The configuration is committed.</p>
</li></ol>
</p></li></ul></div>
<div class="example"><a name="EN-US_TASK_0000001167360277__1.4.3"></a><a name="1.4.3"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p>After the configuration is complete, verify it.</p>
<ul><li>Run the <a href="cmdqueryname=display+bgp+routing-table+prefix-sid+srgb"><b><span class="cmdname">display bgp routing-table</span></b></a> <i><span class="varname">ipv4-address</span></i> [ <i><span class="varname">mask</span></i> | <i><span class="varname">mask-length</span></i> ] <strong><span>prefix-sid</span></strong> <strong><span>srgb</span></strong> command to check SRGB information of the BGP routes with a specified destination address.</li></ul>
<ul><li>Run the <a href="cmdqueryname=display+mpls+lsp"><b><span class="cmdname">display mpls lsp</span></b></a> command to check BGP SR LSP information.</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_3000.html">BGP Configuration
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_0084.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_3054.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>