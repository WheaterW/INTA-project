
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Enabling GR for BGP Peers">
<meta name="abstract" content="After the GR capability is configured for a BGP peer, a BGP speaker can negotiate with the peer to establish a BGP session with the GR capability.">
<meta name="description" content="After the GR capability is configured for a BGP peer, a BGP speaker can negotiate with the peer to establish a BGP session with the GR capability.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_3000.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_3058.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_5113_1.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Route">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Route">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing Basis">
<meta name="OWNER" content="l00425560">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00615954">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0209610513">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Enabling GR for BGP Peers</title>
</head>
<body><a name="EN-US_TASK_0209610513"></a><a name="EN-US_TASK_0209610513"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Enabling GR for BGP Peers</h1>
<div class="taskbody"><p>After the GR capability is configured for a BGP peer, a BGP speaker can negotiate with the peer to establish a BGP session with the GR capability.</p>
<div class="context"><a name="EN-US_TASK_0209610513__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Usage Scenario</h4><p>A BGP restart causes re-establishment of all the involved peer relationships, resulting in traffic interruption. Enabling GR globally can prevent traffic interruption. However, this will disconnect all the BGP peer relationships on a device and cause the device to re-negotiate the GR capability with these peers, which affects all the BGP-dependent services running on the live network. To prevent this problem, you can enable GR on a BGP speaker for specified BGP peers so that the BGP speaker can establish GR-capable BGP sessions with the specified peers through negotiation.</p>
</div></div>
<div class="steps"><a name="EN-US_TASK_0209610513__1.4.2"></a><a name="1.4.2"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span><p><p>The BGP view is displayed.</p>
</p></li><li><span>Run <a href="cmdqueryname=peer+capability-advertise+graceful-restart"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address </span></i>| <i><span class="varname">group-name</span></i> }<strong><span> capability-advertise graceful-restart</span></strong></span><p><p>GR is enabled, and the device is configured to advertise the GR capability to the specified BGP peer or peer group.</p>
</p><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>If a specified peer group contains peers that do not support GR, you can run the <strong><span>peer</span></strong> <i><span class="varname">group-name</span></i><strong><span> local-graceful-restart enable</span></strong> command to enable local GR for the specified peer group.</p>
</div></div>
</p></li><li><span>(Optional) Run <a href="cmdqueryname=peer+graceful-restart+timer+restart"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address </span></i>| <i><span class="varname">group-name</span></i> } <strong><span>graceful-restart timer restart</span></strong> <i><span class="varname">time-value</span></i></span><p><p>The maximum duration is set for a specified peer or peer group to wait for the local BGP peer relationship to be re-established, and the device is configured to advertise the duration to the peer or peer group.</p>
</p><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>If the specified peer does not support GR, run the <a href="cmdqueryname=peer+graceful-restart+timer+restart"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i><strong><span> local-graceful-restart timer restart</span></strong> <i><span class="varname">restart-time</span></i> command to set the maximum duration for the device to wait for its BGP peer relationship to be re-established with the specified peer.</p>
<p>If a peer in a specified peer group does not support GR, you can run the <a href="cmdqueryname=peer+graceful-restart+timer+restart"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">group-name</span></i> <strong><span>local-graceful-restart timer restart</span></strong> <i><span class="varname">restart-time</span></i> command to set the maximum duration for the local device to wait for its peer relationships to be re-established with the specified BGP peer group.</p>
</div></div>
</p></li><li><span>(Optional) Run <a href="cmdqueryname=peer+graceful-restart+peer-reset"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address </span></i>| <i><span class="varname">group-name</span></i> } <a href="cmdqueryname=graceful-restart+peer-reset"><b><span class="cmdname">graceful-restart peer-reset</span></b></a></span><p><p>The device is enabled to use the GR mode to reset the BGP connection with the specified peer or each peer in the specified group.</p>
</p><p><p>Currently, BGP does not support dynamic capability negotiation. Therefore, BGP capability changes cause peer relationships to be re-established and routing entries to be deleted, interrupting services. If a BGP capability changes when BGP IPv4 unicast peer relationships have been established and IPv4 services are running properly, the BGP IPv4 unicast peer relationships will be reestablished, affecting the ongoing IPv4 services. To solve this problem, perform this step to enable the router to reset BGP connections in GR mode after GR is enabled for the BGP peer.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>If the <a href="cmdqueryname=peer+capability-advertise+graceful-restart"><b><span class="cmdname">peer capability-advertise graceful-restart</span></b></a> command is run but the <a href="cmdqueryname=peer+graceful-restart+peer-reset"><b><span class="cmdname">peer graceful-restart peer-reset</span></b></a> command is not run, the BGP connection is not reset in GR mode for the peer relationship reestablishment triggered by the <a href="cmdqueryname=reset+bgp"><b><span class="cmdname">reset bgp</span></b></a> command or dynamic capability negotiation. The BGP connection is reset in GR mode for the peer relationship reestablishment triggered by the <a href="cmdqueryname=reset+bgp"><b><span class="cmdname">reset bgp</span></b></a> command or dynamic capability negotiation only if both the <a href="cmdqueryname=peer+capability-advertise+graceful-restart"><b><span class="cmdname">peer capability-advertise graceful-restart</span></b></a> and <a href="cmdqueryname=peer+graceful-restart+peer-reset"><b><span class="cmdname">peer graceful-restart peer-reset</span></b></a> commands are run.</p>
</div></div>
</p></li><li><span>(Optional) Run <a href="cmdqueryname=peer+graceful-restart+timer+wait-for-rib"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address </span></i>| <i><span class="varname">group-name</span></i> } <a href="cmdqueryname=graceful-restart+timer+wait-for-rib"><b><span class="cmdname">graceful-restart timer wait-for-rib</span></b></a> <i><span class="varname">time-value</span></i></span><p><p>The maximum duration is set for the device to wait for the End-of-RIB flag from the specified peer.</p>
</p><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>If the specified peer does not support GR, you can run the <a href="cmdqueryname=peer+graceful-restart+timer+wait-for-rib"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i><strong><span> local-graceful-restart</span></strong> <strong><span>timer wait-for-rib</span></strong> <i><span class="varname">wfrtime</span></i> command to set the duration for the local end to wait for the End-of-RIB flag from the specified peer.</p>
<p>If a specified peer group contains a peer that does not support GR, you can run the <a href="cmdqueryname=peer+graceful-restart+timer+wait-for-rib"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">group-name</span></i> <strong><span>local-graceful-restart</span></strong> <strong><span>timer wait-for-rib</span></strong> <i><span class="varname">wfrtime</span></i> command to set the duration for the local end to wait for the End-of-RIB flag from the specified peer group.</p>
</div></div>
</p></li><li><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol></div>
<div class="postreq"><a name="EN-US_TASK_0209610513__1.4.3"></a><a name="1.4.3"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p>After the configuration is complete, verify it.</p>
<ul><li>Run the <a href="cmdqueryname=display+bgp+peer+verbose"><b><span class="cmdname">display bgp peer</span></b></a> <strong><span>verbose</span></strong> command to check the BGP GR status.</li><li>Run the <a href="cmdqueryname=display+bgp+graceful-restart+status"><b><span class="cmdname">display bgp</span></b></a> <strong><span>graceful-restart status</span></strong> command to check GR information on the BGP speaker.</li><li>Run the <a href="cmdqueryname=display+bgp+local-graceful-restart+status"><b><span class="cmdname">display bgp</span></b></a> <strong><span>local-graceful-restart status</span></strong> command to check information about local GR on the BGP speaker.</li></ul>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_3000.html">BGP Configuration
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_3058.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_5113_1.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>