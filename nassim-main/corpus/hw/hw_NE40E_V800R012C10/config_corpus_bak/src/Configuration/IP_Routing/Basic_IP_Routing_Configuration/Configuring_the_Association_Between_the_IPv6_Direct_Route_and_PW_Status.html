
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring the Association Between the IPv6 Direct Route and PW Status">
<meta name="abstract" content="This section describes how to configure the association between the IPv6 direct route and pseudo wire (PW) status. During traffic switchback after the primary PW recovers, this configuration minimizes traffic loss and improves network reliability.">
<meta name="description" content="This section describes how to configure the association between the IPv6 direct route and pseudo wire (PW) status. During traffic switchback after the primary PW recovers, this configuration minimizes traffic loss and improves network reliability.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ip-route_cfg_0000.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ip-route_cfg_0034.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ip-route_cfg_0052.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,w00556928,ip-routevrp,s00526617,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="IP Routing Basis">
<meta name="featuretype" content="IP Route">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="IP Routing Basis">
<meta name="featuretype" content="IP Route">
<meta name="featurename" content="IP Routing Basis">
<meta name="featuretype" content="IP Routing Basis">
<meta name="OWNER" content="z00809835">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="h00414125">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172365350">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring the Association Between the IPv6 Direct Route and PW Status</title>
</head>
<body><a name="EN-US_TASK_0172365350"></a><a name="EN-US_TASK_0172365350"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring the Association Between the IPv6 Direct Route and PW Status</h1>
<div class="taskbody"><p>This section describes how to configure the association between the IPv6 direct route and pseudo wire (PW) status. During traffic switchback after the primary PW recovers, this configuration minimizes traffic loss and improves network reliability.</p>
<div class="context"><a name="EN-US_TASK_0172365350__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Usage Scenario</h4><p>As shown in <a href="#EN-US_TASK_0172365350__fig_dc_vrp_ip-route_cfg_005901">Figure 1</a>, PWs are set up between access aggregation gateways (AGGs) and the cell site gateway (CSG), while BGP virtual private network version 6 (VPNv6) peer relationships are set up between AGGs and radio network controller site gateways (RSGs). Layer 3 Virtual Ethernet (L3VE) interfaces are configured on AGGs and VPN instances are bound to the L3VE interfaces, so that the CSG can access the Layer 3 virtual private network (L3VPN). BGP is configured on AGGs to import IPv6 direct routes between the CSG and AGGs. These IPv6 direct routes are converted to BGP VPNv6 routes and advertised to RSGs.</p>
<div class="fignone" id="EN-US_TASK_0172365350__fig_dc_vrp_ip-route_cfg_005901"><a name="EN-US_TASK_0172365350__fig_dc_vrp_ip-route_cfg_005901"></a><a name="fig_dc_vrp_ip-route_cfg_005901"></a><span class="figcap"><b>Figure 1 </b>Networking of the association between the IPv6 direct route and PW status</span><br><span><img class="vsd" src="images/fig_dc_vrp_ip-route_cfg_005901.png" width="NaN" height="NaN"></span><br></div>
<p>AGG1 is used as the master device in the preceding figure. In normal cases, RSGs select routes advertised by AGG1 and traffic travels along LinkA. If AGG1 or the CSG-AGG1 link fails, traffic is switched over to LinkB. After AGG1 or the CSG-AGG1 link recovers, the L3VE interface on AGG1 goes from Down to Up, and AGG1 immediately generates an IPv6 direct route destined for the CSG and advertises the route to RSGs. Downstream traffic is then switched over to LinkA. However, AGG1 has not learned the MAC addresses of the base stations yet and PW1 is standing by, so downstream traffic will be lost.</p>
<p>After you configure the association between the IPv6 direct route and PW status, when the L3VE interface on AGG1 goes from Down to Up, PW1 does not become the primary PW immediately, and the cost of the IPv6 direct route between the CSG and AGG1 increases. In this case, RSGs do not preferentially select routes advertised by AGG1 and downstream traffic still travels along LinkB. After PW1 between the CSG and AGG1 becomes the primary PW, the cost of the IPv6 direct route between the CSG and AGG1 is restored to the default value 0. Then, RSGs preferentially select routes advertised by AGG1 and downstream traffic is switched over to LinkA. At this time, AGG1 has learned the MAC addresses of the base stations, downstream traffic loss will be reduced after the traffic is switched back.</p>
</div></div>
<div class="context"><a name="EN-US_TASK_0172365350__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Pre-configuration Tasks</h4><p>Before configuring the association between the IPv6 direct route and PW status, complete the following tasks:</p>
<ul><li><p>Configure link-layer protocol parameters and IP addresses for interfaces to ensure that the link layer protocol status of each interface is up.</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172365350__1.4.3"></a><a name="1.4.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Run <span><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span></span><p><p>The system view is displayed.</p>
</p></li><li><span>Run <span><a href="cmdqueryname=interface+virtual-ethernet"><b><span class="cmdname">interface virtual-ethernet</span></b></a> <i><span class="varname">interface-number</span></i></span></span><p><p>A VE interface is created, and the VE interface view is displayed.</p>
</p></li><li><span>Run <span><a href="cmdqueryname=ve-group"><b><span class="cmdname">ve-group</span></b></a> <i><span class="varname">ve-group-id</span></i> <span><strong><span>l3-access</span></strong></span></span></span><p><p>The VE interface is configured as an L3VE interface for MPLS L3VPN access and bound to a VE-group.</p>
</p><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The L2VPN can access the L3VPN only if the L2VE and L3VE interfaces are bound to the same VE-group and reside on the same board.</p>
</div></div>
</p></li><li><span>Run <span><a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span></span><p><p>Return to the system view.</p>
</p></li><li><span>Run <span><a href="cmdqueryname=interface+virtual-ethernet"><b><span class="cmdname">interface virtual-ethernet</span></b></a> <i><span class="varname">interface-number.subinterface-number</span></i></span></span><p><p>An L3VE sub-interface is created, and its view is displayed.</p>
</p></li><li><span>Run <span><a href="cmdqueryname=ipv6+enable"><b><span class="cmdname">ipv6 enable</span></b></a></span></span><p><p>The IPv6 capability is enabled.</p>
</p></li><li><span>Run <span><a href="cmdqueryname=direct-route+ipv6+track+pw-state"><b><span class="cmdname">direct-route ipv6 track pw-state</span></b></a> <strong><span>degrade-cost</span></strong> <i><span class="varname">cost</span></i></span></span><p><p>The association between the IPv6 direct route and PW status is configured.</p>
</p><p><p>After you run the <a href="cmdqueryname=direct-route+ipv6+track+pw-state"><b><span class="cmdname">direct-route ipv6 track pw-state</span></b></a> command on an interface, the system adjusts the cost of the IPv6 direct route on an interface based on the PW status. If the PW is standby, the system modifies the IPv6 direct route cost to the configured value <i><span class="varname">cost</span></i>. If the PW is active, the system restores the IPv6 direct route cost to the default value 0.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The <a href="cmdqueryname=direct-route+ipv6+track+pw-state"><b><span class="cmdname">direct-route ipv6 track pw-state</span></b></a> command and the <a href="cmdqueryname=direct-route+ipv6+degrade-delay"><b><span class="cmdname">direct-route ipv6 degrade-delay</span></b></a> command cannot be both configured on one L3VE interface.</p>
</div></div>
</p></li><li><span>Run <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span></span><p><p>The configuration is committed.</p>
</p></li></ol></div>
<div class="postreq"><a name="EN-US_TASK_0172365350__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p>If a PW has recovered but has not become active, run the <a href="cmdqueryname=display+ipv6+routing-table+vpn-instance"><b><span class="cmdname">display ipv6 routing-table vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i> [ <i><span class="varname">ipv6-address</span></i> ] [ <strong><span>verbose</span></strong> ] command on an AGG. The command output shows that the IPv6 direct route to the L3VE interface has the configured cost. After a PW becomes active, run the <a href="cmdqueryname=display+ipv6+routing-table+vpn-instance"><b><span class="cmdname">display ipv6 routing-table vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i> [ <i><span class="varname">ipv6-address</span></i> ] [ <strong><span>verbose</span></strong> ] command on an AGG. The command output shows that the IPv6 direct route to the L3VE interface has the default cost 0.</p>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ip-route_cfg_0000.html">Basic IP Routing Configuration
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ip-route_cfg_0034.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ip-route_cfg_0052.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>