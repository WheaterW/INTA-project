
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring NQA for IPv4 Static Routes">
<meta name="abstract" content="NQA for IPv4 static routes can fast detect network faults and control the advertisement of static routes.">
<meta name="description" content="NQA for IPv4 static routes can fast detect network faults and control the advertisement of static routes.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_static-route_disjoin_cfg_0016.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_static-route_disjoin_cfg_0029.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_static-route_disjoin_cfg_0064.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="Static Route">
<meta name="featuretype" content="IP Route">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="Static Route">
<meta name="featuretype" content="IP Route">
<meta name="featurename" content="Static Route">
<meta name="featuretype" content="IP Route">
<meta name="featurename" content="Static Route">
<meta name="featuretype" content="IP Routing Basis">
<meta name="OWNER" content="l00425560">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="s00826690">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172365461">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>Example for Configuring NQA for IPv4 Static Routes</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172365461"></a><a name="EN-US_TASK_0172365461"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring NQA for IPv4 Static Routes</h1>
<div class="taskbody"><p>NQA for IPv4 static routes can fast detect network faults and control the advertisement of static routes.</p>
<div class="context"><a name="EN-US_TASK_0172365461__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On a simple network or when the <span class="keyword">Router</span> cannot use a dynamic routing protocol to generate routes, you can configure static routes. Unlike dynamic routing protocols, static routes do not have a detection mechanism. If a link fails, a network administrator must manually delete the corresponding static route from the IP routing table, which delays link switchovers and causes a lengthy service interruption.</p>
<p>Bidirectional Forwarding Detection (BFD) for static routes is adaptable to link changes but requires that both ends of a link support BFD. If either end of a link does not support BFD, configure NQA for IPv4 static routes. If an NQA test instance detects a link fault, it instructs the routing management module to delete the associated static route from the IPv4 routing table. Then traffic is switched to a backup route to prevent lengthy service interruptions.</p>
<div class="p">In <a href="#EN-US_TASK_0172365461__fig_dc_vrp_static-route_disjoin_cfg_004101">Figure 1</a>, backup links are deployed on the IP metropolitan area network (MAN).<ul><li>Static routes are configured on <span class="keyword">Device</span>B and <span class="keyword">Device</span>C. <span class="keyword">Device</span>B is the active device, while <span class="keyword">Device</span>C is the standby device.</li><li>In most cases, traffic is transmitted over the primary link (<span class="keyword">Device</span>B -&gt; SwitchA).</li><li>If the primary link fails, traffic switches to the backup link (<span class="keyword">Device</span>C -&gt; SwitchA).</li></ul>
</div>
<div class="fignone" id="EN-US_TASK_0172365461__fig_dc_vrp_static-route_disjoin_cfg_004101"><a name="EN-US_TASK_0172365461__fig_dc_vrp_static-route_disjoin_cfg_004101"></a><a name="fig_dc_vrp_static-route_disjoin_cfg_004101"></a><span class="figcap"><b>Figure 1 </b>NQA for IPv4 static routes</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 through 5 in this example represent GE <span>0/1/0</span>, GE <span>0/1/1</span>, GE <span>0/1/2</span>, GE <span>0/1/3</span>, and GE <span>0/2/3</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_static-route_disjoin_cfg_004101.png" width="NaN" height="NaN"></span></div>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, switches A and B are used for user access. In actual networking, users can also access the network through the OLT, DSLAM, MSAN, or xDSL. The configurations on <span class="keyword">Device</span>A, <span class="keyword">Device</span>B, and <span class="keyword">Device</span>C are the same.</p>
</div></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172365461__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Create an Internet Control Message Protocol (ICMP) NQA test instance to monitor the status of the primary link.</p>
<p>Create an ICMP NQA test instance on the NQA client <span class="keyword">Device</span>B to test whether the primary link is running properly.</p>
</li><li><p>Configure static routes and associate the static route along the primary link with the ICMP NQA test instance.</p>
<p>Configure static routes on <span class="keyword">Device</span>B and <span class="keyword">Device</span>C, and associate the static route configured on <span class="keyword">Device</span>B with the ICMP NQA test instance. If the ICMP NQA test instance detects a link fault, it instructs the routing management module to delete the associated static route from the IPv4 routing table.</p>
</li><li><p>Configure a dynamic routing protocol.</p>
<p>Configure a dynamic routing protocol on <span class="keyword">Device</span>A, <span class="keyword">Device</span>B, and <span class="keyword">Device</span>C so that they can learn routes from one another.</p>
</li><li><p>Configure OSPF to import static routes and set a smaller cost for the static route along the primary link than for the one along the backup link.</p>
<p>Configure OSPF on <span class="keyword">Device</span>B and <span class="keyword">Device</span>C to import static routes, and set a higher cost for the static route imported by <span class="keyword">Device</span>C than for the one imported by <span class="keyword">Device</span>B. This configuration allows <span class="keyword">Device</span>A to preferentially select the link (<span class="keyword">Device</span>B -&gt; SwitchA).</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172365461__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li>IP address of each interface</li><li>NQA item values (for details, see <a href="#EN-US_TASK_0172365461__table_02">Table 1</a>)
<div class="tableBorder"><a name="EN-US_TASK_0172365461__table_02"></a><a name="table_02"></a><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" id="EN-US_TASK_0172365461__table_02" frame="border" border="1" rules="all"><caption><b>Table 1 </b>NQA item values</caption><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="50%" id="mcps1.4.3.3.2.2.2.3.1.1" liSelected="liSelected"><p>Item</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="50%" id="mcps1.4.3.3.2.2.2.3.1.2" liSelected="liSelected"><p>Value</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.3.3.2.2.2.3.1.1 "><p>Administrator name</p>
</td>
<td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.3.3.2.2.2.3.1.2 "><p>user</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.3.3.2.2.2.3.1.1 "><p>Name of the test instance</p>
</td>
<td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.3.3.2.2.2.3.1.2 "><p>test</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.3.3.2.2.2.3.1.1 "><p>Test type</p>
</td>
<td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.3.3.2.2.2.3.1.2 "><p>ICMP</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.3.3.2.2.2.3.1.1 "><p>Destination address</p>
</td>
<td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.3.3.2.2.2.3.1.2 "><p>172.16.1.2</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.3.3.2.2.2.3.1.1 "><p>Interval at which the NQA test automatically runs</p>
</td>
<td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.3.3.2.2.2.3.1.2 "><p>10 seconds</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.3.3.2.2.2.3.1.1 "><p>Number of probes</p>
</td>
<td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.3.3.2.2.2.3.1.2 "><p>2</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.3.3.2.2.2.3.1.1 "><p>Interval at which probe packets are sent</p>
</td>
<td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.3.3.2.2.2.3.1.2 "><p>5 seconds</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.3.3.2.2.2.3.1.1 "><p>Timeout period</p>
</td>
<td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.3.3.2.2.2.3.1.2 "><p>4 seconds</p>
</td>
</tr>
</tbody>
</table>
</div>
</li><li>OSPF backbone area (Area 0) of <span class="keyword">Device</span>A, <span class="keyword">Device</span>B, and <span class="keyword">Device</span>C, and their router IDs (1.1.1.1, 2.2.2.2, and 3.3.3.3)</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172365461__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure interface IPv4 addresses. For configuration details, see <a href="#EN-US_TASK_0172365461__title_01">Configuration Files</a> in this section.</span></li><li><span>Create an NQA test instance on <span class="keyword">Device</span>B to test the link between <span class="keyword">Device</span>B and SwitchA.</span><p><pre class="screen">&lt;<span class="keyword">Device</span>B&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B]<strong> nqa test-instance user test</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-nqa-user-test]<strong> test-type icmp</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-nqa-user-test]<strong> destination-address ipv4 172.16.1.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-nqa-user-test]<strong> frequency 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-nqa-user-test]<strong> probe-count 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-nqa-user-test]<strong> interval seconds 5</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-nqa-user-test]<strong> timeout 4</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-nqa-user-test]<strong> start now</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-nqa-user-test]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-nqa-user-test]<strong> quit</strong></pre>
</p></li><li><span>Configure IPv4 static routes.</span><p><p># Configure an IPv4 static route on <span class="keyword">Device</span>B and associate it with the NQA test instance.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>ip route-static 172.16.7.0 255.255.255.0 GigabitEthernet <span>0/1/1</span> 172.16.1.2 track nqa user test</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>commit</strong></pre>
<p># Configure an IPv4 static route on <span class="keyword">Device</span>C.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C] <strong>ip route-static 172.16.7.0 255.255.255.0 GigabitEthernet <span>0/1/0</span> 172.16.6.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C] <strong>commit</strong></pre>
</p></li><li><span>Configure a dynamic routing protocol on <span class="keyword">Device</span>A, <span class="keyword">Device</span>B, and <span class="keyword">Device</span>C. OSPF is used in this example.</span><p><p># Configure OSPF on <span class="keyword">Device</span>A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-ospf-1] <strong>area 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-ospf-1-area-0.0.0.0] <strong>network 172.16.3.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-ospf-1-area-0.0.0.0] <strong>network 172.16.4.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-ospf-1-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-ospf-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
<p># Configure OSPF on <span class="keyword">Device</span>B.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-ospf-1] <strong>area 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-ospf-1-area-0.0.0.0] <strong>network 172.16.3.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-ospf-1-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-ospf-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>commit</strong></pre>
<p># Configure OSPF on <span class="keyword">Device</span>C.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C] <strong>ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-ospf-1] <strong>area 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-ospf-1-area-0.0.0.0] <strong>network 172.16.4.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-ospf-1-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-ospf-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C] <strong>commit</strong></pre>
</p></li><li><span>Configure OSPF on <span class="keyword">Device</span>B and <span class="keyword">Device</span>C to import static routes.</span><p><p># Configure OSPF on <span class="keyword">Device</span>B to import a static route, and set the cost to 10 for the static route.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-ospf-1] <strong>import-route static cost 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-ospf-1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-ospf-1] <strong>quit</strong></pre>
<p># Configure OSPF on <span class="keyword">Device</span>C to import a static route, and set the cost to 20 for the static route.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C] <strong>ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-ospf-1] <strong>import-route static cost 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-ospf-1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C-ospf-1] <strong>quit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p>After the configuration is complete, run the <strong>display current-configuration | include nqa</strong> command on <span class="keyword">Device</span>B in the system view. The command output shows that the IPv4 static route has been associated with the NQA test instance. Run the <strong>display nqa results</strong> command. The command output shows that an NQA test instance has been created.</p>
<p># Display configurations of NQA for IPv4 static routes.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>display current-configuration | include nqa</strong></pre>
<pre class="screen"> ip route-static 172.16.7.0 255.255.255.0 GigabitEthernet <span>0/1/1</span> 172.16.1.2 track nqa user test
 nqa test-instance user test</pre>
<p># Display NQA test results.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>display nqa results test-instance user test</strong></pre>
<pre class="screen"> NQA entry(user, test) : testflag is active ,testtype is icmp
  1 . Test 6645 result   The test is finished
   Send operation times: 2                Receive response times: 2
   <strong>Completion:success</strong>                   RTD OverThresholds number:0
   Attempts number:1                      Drop operation number:0
   Disconnect operation number:0          Operation timeout number:0
   System busy operation number:0         Connection fail number:0
   Operation sequence errors number:0     RTT Stats errors number:0
   Destination ip address:172.16.1.2
   Min/Max/Average Completion Time: 1/1/1
   Sum/Square-Sum  Completion Time: 2/2
   Last Good Probe Time: 2012-11-14 04:20:36.9
   <strong>Lost packet ratio: 0 %</strong></pre>
<p>The command output shows "Lost packet ratio 0 %," indicating that the link is running properly.</p>
<p># Display the routing table on <span class="keyword">Device</span>B.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>display ip routing-table</strong></pre>
<pre class="screen"><span class="keyword">Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route</span>
------------------------------------------------------------------------------
Routing Table : _public_
         Destinations : 15       Routes : 15

Destination/Mask    Proto   Pre  Cost        Flags NextHop         Interface

      127.0.0.0/8   Direct  0    0             D  127.0.0.1       InLoopBack0
      127.0.0.1/32  Direct  0    0             D  127.0.0.1       InLoopBack0
127.255.255.255/32  Direct  0    0             D  127.0.0.1       InLoopBack0
     172.16.1.0/24  Direct  0    0             D  172.16.1.1      GigabitEthernet<span>0/1/1</span>
     172.16.1.1/32  Direct  0    0             D  127.0.0.1       GigabitEthernet<span>0/1/1</span>
   172.16.1.255/32  Direct  0    0             D  127.0.0.1       GigabitEthernet<span>0/1/1</span>
     172.16.3.0/24  Direct  0    0             D  172.16.3.2      GigabitEthernet<span>0/1/0</span>
     172.16.3.2/32  Direct  0    0             D  127.0.0.1       GigabitEthernet<span>0/1/0</span>
   172.16.3.255/32  Direct  0    0             D  127.0.0.1       GigabitEthernet<span>0/1/0</span>
     172.16.4.0/24  OSPF    10   2             D  172.16.3.1      GigabitEthernet<span>0/1/0</span>
     172.16.5.0/24  Direct  0    0             D  172.16.5.1      GigabitEthernet<span>0/1/3</span>
     172.16.5.1/32  Direct  0    0             D  127.0.0.1       GigabitEthernet<span>0/1/3</span>
   172.16.5.255/32  Direct  0    0             D  127.0.0.1       GigabitEthernet<span>0/1/3</span>
   <strong>172.16.7.0/24</strong>  Static  60   0             D  172.16.1.2      GigabitEthernet<span>0/1/1</span>
255.255.255.255/32  Direct  0    0             D  127.0.0.1       InLoopBack0</pre>
<p>The command output shows that the static route exists in the routing table.</p>
<p># Display the routing table on <span class="keyword">Device</span>A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>display ip routing-table</strong></pre>
<pre class="screen"><span class="keyword">Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route</span>
------------------------------------------------------------------------------
Routing Table : _public_
         Destinations : 11       Routes : 11

Destination/Mask    Proto   Pre  Cost        Flags NextHop         Interface

      127.0.0.0/8   Direct  0    0             D  127.0.0.1       InLoopBack0
      127.0.0.1/32  Direct  0    0             D  127.0.0.1       InLoopBack0
127.255.255.255/32  Direct  0    0             D  127.0.0.1       InLoopBack0
     172.16.3.0/24  Direct  0    0             D  172.16.3.1      GigabitEthernet<span>0/1/0</span>
     172.16.3.1/32  Direct  0    0             D  127.0.0.1       GigabitEthernet<span>0/1/0</span>
   172.16.3.255/32  Direct  0    0             D  127.0.0.1       GigabitEthernet<span>0/1/0</span>
     172.16.4.0/24  Direct  0    0             D  172.16.4.1      GigabitEthernet<span>0/2/3</span>
     172.16.4.1/32  Direct  0    0             D  127.0.0.1       GigabitEthernet<span>0/2/3</span>
   172.16.4.255/32  Direct  0    0             D  127.0.0.1       GigabitEthernet<span>0/2/3</span>
     172.16.7.0/24  O_ASE   150  10            D  <strong>172.16.3.2</strong>     GigabitEthernet<span>0/1/0</span>
255.255.255.255/32  Direct  0    0             D  127.0.0.1       InLoopBack0</pre>
<p>The command output shows that a route to 172.16.7.0/24 exists in the routing table. The route's next hop address is 172.16.3.2 and the cost is 10. Traffic is preferentially transmitted along the link <span class="keyword">Device</span>B -&gt; SwitchA.</p>
<p># Shut down GE <span>0/1/1</span> on <span class="keyword">Device</span>B to simulate a link fault.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>interface GigabitEthernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/1</span>] <strong>shutdown</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/1</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>quit</strong></pre>
<p># Display NQA test results.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>display nqa results test-instance user test</strong></pre>
<pre class="screen"> NQA entry(user, test) : testflag is active ,testtype is icmp
  1 . Test 7160 result   The test is finished
   Send operation times: 2                Receive response times: 0
   <strong>Completion:failed</strong>                    RTD OverThresholds number:0
   Attempts number:1                      Drop operation number:0
   Disconnect operation number:0          Operation timeout number:2
   System busy operation number:0         Connection fail number:0
   Operation sequence errors number:0     RTT Stats errors number:0
   Destination ip address:172.16.1.2
   Min/Max/Average Completion Time: 0/0/0
   Sum/Square-Sum  Completion Time: 0/0
   Last Good Probe Time: 0000-00-00 00:00:00.0
   <strong>Lost packet ratio: 100 %</strong></pre>
<p>The command output shows "Completion:failed" and "Lost packet ratio is 100 %," indicating that the link is faulty.</p>
<p># Display the routing table on <span class="keyword">Device</span>B.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>display ip routing-table</strong></pre>
<pre class="screen"><span class="keyword">Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route</span>
------------------------------------------------------------------------------
Routing Table : _public_
         Destinations : 12       Routes : 12

Destination/Mask    Proto   Pre  Cost        Flags NextHop         Interface

      127.0.0.0/8   Direct  0    0             D  127.0.0.1       InLoopBack0
      127.0.0.1/32  Direct  0    0             D  127.0.0.1       InLoopBack0
127.255.255.255/32  Direct  0    0             D  127.0.0.1       InLoopBack0
     172.16.3.0/24  Direct  0    0             D  172.16.3.2      GigabitEthernet<span>0/1/0</span>
     172.16.3.2/32  Direct  0    0             D  127.0.0.1       GigabitEthernet<span>0/1/0</span>
   172.16.3.255/32  Direct  0    0             D  127.0.0.1       GigabitEthernet<span>0/1/0</span>
     172.16.4.0/24  OSPF    10   2             D  172.16.3.1      GigabitEthernet<span>0/1/0</span>
     172.16.5.0/24  Direct  0    0             D  172.16.5.1      GigabitEthernet<span>0/1/3</span>
     172.16.5.1/32  Direct  0    0             D  127.0.0.1       GigabitEthernet<span>0/1/3</span>
   172.16.5.255/32  Direct  0    0             D  127.0.0.1       GigabitEthernet<span>0/1/3</span>
     172.16.7.0/24  O_ASE   150  20            D  172.16.3.1      GigabitEthernet<span>0/1/0</span>
255.255.255.255/32  Direct  0    0             D  127.0.0.1       InLoopBack0</pre>
<p>The command output shows that the static route has been deleted.</p>
<p># Display the routing table on <span class="keyword">Device</span>A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>display ip routing-table</strong></pre>
<pre class="screen"><span class="keyword">Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route</span>
------------------------------------------------------------------------------
Routing Table : _public_
         Destinations : 11       Routes : 11

Destination/Mask    Proto   Pre  Cost        Flags NextHop         Interface

      127.0.0.0/8   Direct  0    0             D  127.0.0.1       InLoopBack0
      127.0.0.1/32  Direct  0    0             D  127.0.0.1       InLoopBack0
127.255.255.255/32  Direct  0    0             D  127.0.0.1       InLoopBack0
     172.16.3.0/24  Direct  0    0             D  172.16.3.1      GigabitEthernet<span>0/1/0</span>
     172.16.3.1/32  Direct  0    0             D  127.0.0.1       GigabitEthernet<span>0/1/0</span>
   172.16.3.255/32  Direct  0    0             D  127.0.0.1       GigabitEthernet<span>0/1/0</span>
     172.16.4.0/24  Direct  0    0             D  172.16.4.1      GigabitEthernet<span>0/2/3</span>
     172.16.4.1/32  Direct  0    0             D  127.0.0.1       GigabitEthernet<span>0/2/3</span>
   172.16.4.255/32  Direct  0    0             D  127.0.0.1       GigabitEthernet<span>0/2/3</span>
     172.16.7.0/24  O_ASE   150  20            D  <strong>172.16.4.2</strong>     GigabitEthernet<span>0/2/3</span>
255.255.255.255/32  Direct  0    0             D  127.0.0.1       InLoopBack0

</pre>
<p>The static route has been associated with the NQA test instance on <span class="keyword">Device</span>B. If NQA detects a link fault, it rapidly notifies <span class="keyword">Device</span>B that the associated static route is unavailable. <span class="keyword">Device</span>A cannot learn the route to 172.16.7.0/24 from <span class="keyword">Device</span>B. However, <span class="keyword">Device</span>A can learn the route to 172.16.7.0/24 from <span class="keyword">Device</span>C. The route's next hop address is 172.16.4.2, and the cost is 20. Traffic switches to the link <span class="keyword">Device</span>C -&gt; SwitchA.</p>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0172365461__title_01"><a name="EN-US_TASK_0172365461__title_01"></a><a name="title_01"></a><a name="EN-US_TASK_0172365461__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p><span class="keyword">Device</span>A configuration file</p>
<pre class="screen">#
sysname <span class="keyword">Device</span>A
#
router id 1.1.1.1
#
interface GigabitEthernet <span>0/1/0</span>
 undo shutdown
 ip address 172.16.3.1 255.255.255.0
#
interface GigabitEthernet <span>0/2/3</span>
 undo shutdown
 ip address 172.16.4.1 255.255.255.0
#
ospf 1
 area 0.0.0.0
  network 172.16.3.0 0.0.0.255
  network 172.16.4.0 0.0.0.255
#
return</pre>
</li><li><p><span class="keyword">Device</span>B configuration file</p>
<pre class="screen">#
sysname <span class="keyword">Device</span>B
#
router id 2.2.2.2
#
interface GigabitEthernet <span>0/1/0</span>
 undo shutdown
 ip address 172.16.3.2 255.255.255.0
#
interface GigabitEthernet <span>0/1/1</span>
 undo shutdown
 ip address 172.16.1.1 255.255.255.0
#
interface GigabitEthernet <span>0/1/3</span>
 undo shutdown
 ip address 172.16.5.1 255.255.255.0
#
ospf 1
 import-route static cost 10
 area 0.0.0.0
  network 172.16.3.0 0.0.0.255
#
ip route-static 172.16.7.0 255.255.255.0 GigabitEthernet<span>0/1/1</span> 172.16.1.2 track nqa user test
#
nqa test-instance user test
 test-type icmp
 destination-address ipv4 172.16.1.2
 interval seconds 5
 timeout 4
 probe-count 2
 frequency 10
 start now
#
return</pre>
</li><li><p><span class="keyword">Device</span>C configuration file</p>
<pre class="screen">#
sysname <span class="keyword">Device</span>C
#
router id 3.3.3.3
#
interface GigabitEthernet <span>0/1/0</span>
 undo shutdown
 ip address 172.16.6.1 255.255.255.0
#
interface GigabitEthernet <span>0/1/2</span>
 undo shutdown
 ip address 172.16.2.1 255.255.255.0
#
interface GigabitEthernet <span>0/2/3</span>
 undo shutdown
 ip address 172.16.4.2 255.255.255.0
#
ospf 1
 import-route static cost 20
 area 0.0.0.0
  network 172.16.4.0 0.0.0.255
#
ip route-static 172.16.7.0 255.255.255.0 GigabitEthernet<span>0/1/0</span> 172.16.6.2
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_static-route_disjoin_cfg_0016.html">Configuration Examples for IPv4 Static Routes
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_static-route_disjoin_cfg_0029.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_static-route_disjoin_cfg_0064.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>