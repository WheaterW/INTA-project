
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring an Extcommunity Filter">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_route-policy_cfg_0000.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_route-policy_cfg_0048.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_route-policy_cfg_0050.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="Route Policy">
<meta name="featuretype" content="IP Route">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="Route Policy">
<meta name="featuretype" content="IP Route">
<meta name="featurename" content="Route Policy">
<meta name="featuretype" content="IP Routing Basis">
<meta name="OWNER" content="l00425560">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="h00414125">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0257583283">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring an Extcommunity Filter</title>
</head>
<body><a name="EN-US_TASK_0257583283"></a><a name="EN-US_TASK_0257583283"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring an Extcommunity Filter</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0257583283__1.3.1"></a><a name="1.3.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><div class="p">An extended community (extcommunity) filter is used to filter BGP routes based on extcommunity attributes. BGP extcommunity attributes are classified as follows:<ul><li><p>VPN target: A VPN target controls route learning between VPN instances, isolating routes of VPN instances from each other. VPN targets include export and import ones. Before advertising Virtual Private Network version 4 (VPNv4) <span>or Virtual Private Network version 6 (VPNv6)</span> routes to a remote Multiprotocol Extensions for Border Gateway Protocol (MP-BGP) peer, a PE adds export VPN targets to the routes. After receiving the VPNv4 <span>or VPNv6 </span>routes, the remote MP-BGP peer determines which routes can be added to its local VPN instance routing table based on whether the export VPN targets carried in the routes match the import VPN target of the local VPN instance.</p>
</li><li><p>Source of Origin (SoO): Several CEs at a VPN site may be connected to different PEs. Routes advertised from the CEs to the PEs may be advertised back to the VPN site after the routes traverse the VPN backbone network. This may cause routing loops at the VPN site. To prevent routing loops, SoO attributes can be configured for routes from different VPN sites for differentiation.</p>
</li><li>Encapsulation: The encapsulation extcommunity attribute is classified as the VXLAN encapsulation extcommunity attribute or MPLS encapsulation extcommunity attribute. In EVPN VXLAN scenarios, EVPN routes carry the VXLAN encapsulation extcommunity attribute, and the value of this attribute can be set to 0:8 to filter EVPN routes. In EVPN MPLS scenarios, received EVPN routes do not carry the MPLS encapsulation extcommunity attribute in most cases. If a device receives EVPN routes carrying the MPLS encapsulation extcommunity attribute, the value of this attribute can be set to 0:10 to filter these routes.</li><li>Segmented-nh: The segmented-nh extcommunity attribute can be added to intra-AS I-PMSI A-D routes in an NG MVPN scenario where segmented tunnels are used.</li></ul>
</div>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Extended community filters are used to filter only BGP routes because extended community attributes are private attributes of BGP.</p>
</div></div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0257583283__1.3.2"></a><a name="1.3.2"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li><span>Configure the following extcommunity filters as needed.</span><p><p>Configure a VPN-Target extcommunity filter:</p>
<ul><li><p>To configure a basic VPN-Target extcommunity filter, run the <a href="cmdqueryname=ip+extcommunity-filter"><b><span class="cmdname">ip extcommunity-filter</span></b></a> { <i><span class="varname">basic-extcomm-filter-num</span></i> | <strong><span>basic</span></strong> <i><span class="varname">basic-extcomm-filter-name</span></i> } [ <strong><span>index</span></strong> <i><span class="varname">index-number</span></i> ] { <strong><span>deny</span></strong> | <strong><span>permit</span></strong> } { <strong><span>rt</span></strong> { <i><span class="varname">as-number:nn</span></i> | <i><span class="varname">4as-number:nn</span></i> | <i><span class="varname">ipv4-address</span></i>:<i><span class="varname">nn</span></i> } } &amp;&lt;1-16&gt; command.</p>
</li><li><p>To configure an advanced VPN-Target extcommunity filter, run the <a href="cmdqueryname=ip+extcommunity-filter"><b><span class="cmdname">ip extcommunity-filter</span></b></a> { <i><span class="varname">advanced-extcomm-filter-num</span></i> | <strong><span>advanced</span></strong> <i><span class="varname">advanced-extcomm-filter-name</span></i> }<span>[ <strong><span>index</span></strong> <i><span class="varname">index-number</span></i> ] </span>{ <strong><span>deny</span></strong> | <strong><span>permit</span></strong> } <i><span class="varname">regular-expression</span></i> command.</p>
</li></ul>
</p><p><p>Configure an SoO extcommunity filter:</p>
<ul><li><p>To configure a basic SoO extcommunity filter, run the <a href="cmdqueryname=ip+extcommunity-list+soo+basic"><b><span class="cmdname">ip extcommunity-list soo basic</span></b></a> <i><span class="varname">basic-extcomm-filter-name</span></i> [ <strong><span>index</span></strong> <i><span class="varname">index-number</span></i> ] { <strong><span>permit</span></strong> | <strong><span>deny</span></strong> } { <i><span class="varname">site-of-origin</span></i> } &amp;&lt;1-16&gt; command.</p>
</li><li><p>To configure an advanced SoO extcommunity filter, run the <a href="cmdqueryname=ip+extcommunity-list+soo+advanced"><b><span class="cmdname">ip extcommunity-list soo advanced</span></b></a> <i><span class="varname">advanced-extcomm-filter-name</span></i> [ <strong><span>index</span></strong> <i><span class="varname">index-number</span></i> ] { <strong><span>permit</span></strong> | <strong><span>deny</span></strong> } <i><span class="varname">regular-expression</span></i> command.</p>
</li></ul>
</p><p><p>Configure an encapsulation extcommunity filter:</p>
<ul><li><p>To configure a basic encapsulation extcommunity filter, run the <a href="cmdqueryname=ip+extcommunity-list+encapsulation+basic"><b><span class="cmdname">ip extcommunity-list encapsulation basic</span></b></a> <i><span class="varname">encapsulation-name</span></i> [ <strong><span>index</span></strong> <i><span class="varname">index-number</span></i> ] { <strong><span>permit</span></strong> | <strong><span>deny</span></strong> } { <i><span class="varname">encapsulation-value</span></i> } &amp;&lt;1-16&gt; command.</p>
</li><li><p>To configure an advanced encapsulation extcommunity filter, run the <a href="cmdqueryname=ip+extcommunity-list+encapsulation+advanced"><b><span class="cmdname">ip extcommunity-list encapsulation advanced</span></b></a> <i><span class="varname">encapsulation-name</span></i> [ <strong><span>index</span></strong> <i><span class="varname">index-number</span></i> ] { <strong><span>permit</span></strong> | <strong><span>deny</span></strong> } <i><span class="varname">regular</span></i> command.</p>
</li></ul>
</p><p><p>Configure a segmented-nh extcommunity filter:</p>
<ul><li><p>To configure a basic segmented-nh extcommunity filter, run the <a href="cmdqueryname=ip+extcommunity-list+segmented-nh+basic"><b><span class="cmdname">ip extcommunity-list segmented-nh basic</span></b></a> <i><span class="varname">segmented-nh-name</span></i> [ <strong><span>index</span></strong> <i><span class="varname">index-number</span></i> ] { <strong><span>permit</span></strong> | <strong><span>deny</span></strong> } { <i><span class="varname">segmented-nh-value</span></i> } &amp;&lt;1-16&gt; command.</p>
</li><li><p>To configure an advanced segmented-nh extcommunity filter, run the <a href="cmdqueryname=ip+extcommunity-list+segmented-nh+advanced"><b><span class="cmdname">ip extcommunity-list segmented-nh advanced</span></b></a> <i><span class="varname">segmented-nh-name</span></i> [ <strong><span>index</span></strong> <i><span class="varname">index-number</span></i> ] { <strong><span>permit</span></strong> | <strong><span>deny</span></strong> } <i><span class="varname">regular</span></i> command.</p>
</li></ul>
</p><p><p>Multiple entries (or rules) can be defined in an extended community filter, and the relationship between them is OR, which means that the route matches the extended community filter if it matches one of the rules.</p>
</p></li><li><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0257583283__1.3.3"></a><a name="1.3.3"></a><h4 class="sectiontitle">Verifying the Configuration</h4><ul><li>Run the <a href="cmdqueryname=display+ip+extcommunity-filter"><b><span class="cmdname">display ip extcommunity-filter</span></b></a> command to check information about the configured extended community filters.</li><li>Run the <a href="cmdqueryname=display+ip+extcommunity-list+soo"><b><span class="cmdname">display ip extcommunity-list soo</span></b></a> [ <i><span class="varname">eclSooName</span></i> ] command to check detailed information about a configured SoO extended community filter.</li><li>Run the <a href="cmdqueryname=display+ip+extcommunity-list+encapsulation"><b><span class="cmdname">display ip extcommunity-list encapsulation</span></b></a> [ <i><span class="varname">name</span></i> ] command to check detailed information about a configured encapsulation extended community filter.</li><li>Run the <a href="cmdqueryname=display+ip+extcommunity-list+segmented-nh"><b><span class="cmdname">display ip extcommunity-list segmented-nh</span></b></a> [ <i><span class="varname">eclSnhName</span></i> ] command to check detailed information about a configured segmented-nh extended community filter.</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_route-policy_cfg_0000.html">Routing Policy Configuration
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_route-policy_cfg_0048.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_route-policy_cfg_0050.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>