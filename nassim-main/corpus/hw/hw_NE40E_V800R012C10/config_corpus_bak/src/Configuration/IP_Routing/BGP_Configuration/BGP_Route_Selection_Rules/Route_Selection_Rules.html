
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Route Selection Rules">
<meta name="abstract" content="When multiple received routes are available to the same destination, BGP selects one optimal route based on BGP route selection rules and adds it to the IP routing table for traffic forwarding.">
<meta name="description" content="When multiple received routes are available to the same destination, BGP selects one optimal route based on BGP route selection rules and adds it to the IP routing table for traffic forwarding.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_path_selection_0001.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_path_selection_0019.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_path_selection_0017.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Route">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Route">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Route">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing Basis">
<meta name="OWNER" content="l00425560">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00615954">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_CONCEPT_0172366300">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>Route Selection Rules</title>
</head>
<body><a name="EN-US_CONCEPT_0172366300"></a><a name="EN-US_CONCEPT_0172366300"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Route Selection Rules</h1>
<div><p>When multiple received routes are available to the same destination, BGP selects one optimal route based on BGP route selection rules and adds it to the IP routing table for traffic forwarding.</p>
<p>On the <span class="keyword">NE40E</span>, when multiple routes to the same destination are available, BGP selects routes based on rules. For details about the rules, see <a href="feature_0005549734.html">BGP Route Processing</a>.</p>
<p><a href="#EN-US_CONCEPT_0172366300__fig118023455314">Figure 1</a> shows the BGP route selection process.</p>
<p></p>
<div class="fignone" id="EN-US_CONCEPT_0172366300__fig118023455314"><a name="EN-US_CONCEPT_0172366300__fig118023455314"></a><a name="fig118023455314"></a><span class="figcap"><b>Figure 1 </b>BGP route selection process</span><br><span><img class="vsd" src="figure/en-us_image_0000001264951885.png"></span></div>
<p></p>
<p>BGP selects routes by comparing route attributes in a fixed order. When a route attribute is a sufficient condition for determining the optimal route, BGP does not compare the other attributes. If BGP fails to select the optimal route after comparing all route attributes, the route that was first received is selected as the optimal route. <a href="#EN-US_CONCEPT_0172366300__table_fig_dc_vrp_bgp_path_selection_000201">Table 1</a> lists the abbreviated alias, route selection rules, and remarks of each matching item. <a href="#EN-US_CONCEPT_0172366300__table_fig_dc_vrp_bgp_path_selection_000201">Table 1</a> shows that the route priority is directly proportional to the PrefVal or Local_Pref value and inversely proportional to the rest of the attribute values or lengths. In addition, the first column can be summarized as a character string (OPPAAA OMTCC RA), which helps memorize the matching sequence.</p>
<div class="p">
<div class="tableBorder"><a name="EN-US_CONCEPT_0172366300__table_fig_dc_vrp_bgp_path_selection_000201"></a><a name="table_fig_dc_vrp_bgp_path_selection_000201"></a><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" id="EN-US_CONCEPT_0172366300__table_fig_dc_vrp_bgp_path_selection_000201" frame="border" border="1" rules="all"><caption><b>Table 1 </b>BGP route selection process</caption><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="10.098990100989901%" id="mcps1.4.7.1.2.5.1.1" liSelected="liSelected"><p>Abbreviated Alias</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="17.548245175482453%" id="mcps1.4.7.1.2.5.1.2" liSelected="liSelected"><p>Matching Item</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="28.14718528147185%" id="mcps1.4.7.1.2.5.1.3" liSelected="liSelected"><p>Route Selection Rules</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="44.20557944205579%" id="mcps1.4.7.1.2.5.1.4" liSelected="liSelected"><p>Remarks</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" valign="top" width="10.098990100989901%" headers="mcps1.4.7.1.2.5.1.1 "><p>O</p>
</td>
<td class="cellrowborder" valign="top" width="17.548245175482453%" headers="mcps1.4.7.1.2.5.1.2 "><p>Origin AS</p>
</td>
<td class="cellrowborder" valign="top" width="28.14718528147185%" headers="mcps1.4.7.1.2.5.1.3 "><p>Valid &gt; NotFound &gt; Invalid</p>
</td>
<td class="cellrowborder" valign="top" width="44.20557944205579%" headers="mcps1.4.7.1.2.5.1.4 "><p>BGP origin AS validation states are applied to route selection in a scenario where the device is connected to an RPKI server.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="10.098990100989901%" headers="mcps1.4.7.1.2.5.1.1 "><p>P</p>
</td>
<td class="cellrowborder" valign="top" width="17.548245175482453%" headers="mcps1.4.7.1.2.5.1.2 "><p>PrefVal</p>
</td>
<td class="cellrowborder" valign="top" width="28.14718528147185%" headers="mcps1.4.7.1.2.5.1.3 "><p>The route with the largest PrefVal value is preferred.</p>
<p>The default value is 0.</p>
</td>
<td class="cellrowborder" valign="top" width="44.20557944205579%" headers="mcps1.4.7.1.2.5.1.4 "><p>It is valid only locally.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="10.098990100989901%" headers="mcps1.4.7.1.2.5.1.1 "><p>P</p>
</td>
<td class="cellrowborder" valign="top" width="17.548245175482453%" headers="mcps1.4.7.1.2.5.1.2 "><p>Local_Pref</p>
</td>
<td class="cellrowborder" valign="top" width="28.14718528147185%" headers="mcps1.4.7.1.2.5.1.3 "><p>The route with the largest Local_Pref value is preferred.</p>
<p>The default value is 100.</p>
</td>
<td class="cellrowborder" valign="top" width="44.20557944205579%" headers="mcps1.4.7.1.2.5.1.4 "><p>To modify the default Local_Pref value of BGP routes, run the <a href="cmdqueryname=default+local-preference"><b><span class="cmdname">default local-preference</span></b></a> command.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="10.098990100989901%" headers="mcps1.4.7.1.2.5.1.1 "><p>A</p>
<div class="note"><span class="notetitle"> NOTE: </span><div class="notebody"><p>A is the initial of the character string (ASNIL).</p>
</div></div>
</td>
<td class="cellrowborder" valign="top" width="17.548245175482453%" headers="mcps1.4.7.1.2.5.1.2 "><p>Route generation mode</p>
</td>
<td class="cellrowborder" valign="top" width="28.14718528147185%" headers="mcps1.4.7.1.2.5.1.3 "><div class="p">A &gt; S &gt; N &gt; I &gt; L, where:<ul><li>A: indicates the summary routes manually generated using the <a href="cmdqueryname=aggregate"><b><span class="cmdname">aggregate</span></b></a> command.</li><li>S: indicates the summary routes automatically generated using the <a href="cmdqueryname=summary+automatic"><b><span class="cmdname">summary automatic</span></b></a> command.</li><li>N: indicates the routes imported using the <a href="cmdqueryname=network"><b><span class="cmdname">network</span></b></a> command.</li><li>I: indicates the routes imported using the <a href="cmdqueryname=import-route"><b><span class="cmdname">import-route</span></b></a> command.</li><li>L: indicates the routes learned from peers.</li></ul>
</div>
</td>
<td class="cellrowborder" valign="top" width="44.20557944205579%" headers="mcps1.4.7.1.2.5.1.4 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="10.098990100989901%" headers="mcps1.4.7.1.2.5.1.1 "><p>A</p>
</td>
<td class="cellrowborder" valign="top" width="17.548245175482453%" headers="mcps1.4.7.1.2.5.1.2 "><p>Accumulated Interior Gateway Protocol (AIGP)</p>
</td>
<td class="cellrowborder" valign="top" width="28.14718528147185%" headers="mcps1.4.7.1.2.5.1.3 "><p>The route with the smallest AIGP value is preferred.</p>
<p>The route with AIGP to the route without AIGP is preferred.</p>
</td>
<td class="cellrowborder" valign="top" width="44.20557944205579%" headers="mcps1.4.7.1.2.5.1.4 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="10.098990100989901%" headers="mcps1.4.7.1.2.5.1.1 "><p>A</p>
</td>
<td class="cellrowborder" valign="top" width="17.548245175482453%" headers="mcps1.4.7.1.2.5.1.2 "><p>AS_Path</p>
</td>
<td class="cellrowborder" valign="top" width="28.14718528147185%" headers="mcps1.4.7.1.2.5.1.3 "><p>The route with the shortest AS_Path length is preferred.</p>
</td>
<td class="cellrowborder" valign="top" width="44.20557944205579%" headers="mcps1.4.7.1.2.5.1.4 "><p>If the <b><span class="cmdname">bestroute as-path-ignore</span></b> command is run, BGP no longer compares the AS_Path lengths during route selection.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="10.098990100989901%" headers="mcps1.4.7.1.2.5.1.1 "><p>O</p>
</td>
<td class="cellrowborder" valign="top" width="17.548245175482453%" headers="mcps1.4.7.1.2.5.1.2 "><p>Origin</p>
</td>
<td class="cellrowborder" valign="top" width="28.14718528147185%" headers="mcps1.4.7.1.2.5.1.3 "><p>IGP &gt; EGP &gt; Incomplete</p>
</td>
<td class="cellrowborder" valign="top" width="44.20557944205579%" headers="mcps1.4.7.1.2.5.1.4 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="10.098990100989901%" headers="mcps1.4.7.1.2.5.1.1 "><p>M</p>
</td>
<td class="cellrowborder" valign="top" width="17.548245175482453%" headers="mcps1.4.7.1.2.5.1.2 "><p>Multi Exit Discriminator (MED)</p>
</td>
<td class="cellrowborder" valign="top" width="28.14718528147185%" headers="mcps1.4.7.1.2.5.1.3 "><p>The route with the smallest MED value is preferred.</p>
<p>The default value is 0.</p>
</td>
<td class="cellrowborder" valign="top" width="44.20557944205579%" headers="mcps1.4.7.1.2.5.1.4 "><p>If the <a href="cmdqueryname=bestroute+med-none-as-maximum"><b><span class="cmdname">bestroute med-none-as-maximum</span></b></a> command is configured, BGP considers the largest MED value (4294967295) as the MED of a route that does not carry MED.</p>
<p>For details about MED usage, see <a href="dc_vrp_bgp_path_selection_0011.html">MED</a>.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="10.098990100989901%" headers="mcps1.4.7.1.2.5.1.1 "><p>T</p>
</td>
<td class="cellrowborder" valign="top" width="17.548245175482453%" headers="mcps1.4.7.1.2.5.1.2 "><p>Peer type</p>
</td>
<td class="cellrowborder" valign="top" width="28.14718528147185%" headers="mcps1.4.7.1.2.5.1.3 "><p>EBGP &gt; IBGP</p>
</td>
<td class="cellrowborder" valign="top" width="44.20557944205579%" headers="mcps1.4.7.1.2.5.1.4 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="10.098990100989901%" headers="mcps1.4.7.1.2.5.1.1 "><p>C</p>
</td>
<td class="cellrowborder" valign="top" width="17.548245175482453%" headers="mcps1.4.7.1.2.5.1.2 "><p>IGP metric</p>
</td>
<td class="cellrowborder" valign="top" width="28.14718528147185%" headers="mcps1.4.7.1.2.5.1.3 "><p>The route with the smallest IGP metric is preferred.</p>
</td>
<td class="cellrowborder" valign="top" width="44.20557944205579%" headers="mcps1.4.7.1.2.5.1.4 "><p>If the <b><span class="cmdname">bestroute igp-metric-ignore</span></b> command is run, BGP does not compare the IGP metrics of candidate routes.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="10.098990100989901%" headers="mcps1.4.7.1.2.5.1.1 "><p>C</p>
</td>
<td class="cellrowborder" valign="top" width="17.548245175482453%" headers="mcps1.4.7.1.2.5.1.2 "><p>Cluster_List</p>
</td>
<td class="cellrowborder" valign="top" width="28.14718528147185%" headers="mcps1.4.7.1.2.5.1.3 "><p>The route with the shortest Cluster_List length is preferred.</p>
</td>
<td class="cellrowborder" valign="top" width="44.20557944205579%" headers="mcps1.4.7.1.2.5.1.4 "><p>By default, BGP compares Cluster_Lists prior to Originator_IDs during route selection. To enable BGP to compare Originator_IDs prior to Cluster_Lists during route selection, run the <a href="cmdqueryname=bestroute+routerid-prior-clusterlist"><b><span class="cmdname">bestroute routerid-prior-clusterlist</span></b></a> command.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="10.098990100989901%" headers="mcps1.4.7.1.2.5.1.1 "><p>R</p>
</td>
<td class="cellrowborder" valign="top" width="17.548245175482453%" headers="mcps1.4.7.1.2.5.1.2 "><p>Router ID</p>
</td>
<td class="cellrowborder" valign="top" width="28.14718528147185%" headers="mcps1.4.7.1.2.5.1.3 "><p>The route with the smallest router ID is preferred.</p>
</td>
<td class="cellrowborder" valign="top" width="44.20557944205579%" headers="mcps1.4.7.1.2.5.1.4 "><p>If routes carry the Originator_ID, the originator ID is substituted for the router ID during route selection. The route with the smallest Originator_ID is preferred.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="10.098990100989901%" headers="mcps1.4.7.1.2.5.1.1 "><p>A</p>
</td>
<td class="cellrowborder" valign="top" width="17.548245175482453%" headers="mcps1.4.7.1.2.5.1.2 "><p>Peer IP address</p>
</td>
<td class="cellrowborder" valign="top" width="28.14718528147185%" headers="mcps1.4.7.1.2.5.1.3 "><p>The route learned from the peer with the smallest IP address is preferred.</p>
</td>
<td class="cellrowborder" valign="top" width="44.20557944205579%" headers="mcps1.4.7.1.2.5.1.4 "><p>-</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section"><h4 class="sectiontitle">Selection of the Routes for Load Balancing</h4><p>After BGP load balancing is configured, the BGP routes that meet the following conditions are used as equal-cost routes for load balancing:</p>
<ul id="EN-US_CONCEPT_0172366300__ul297854693214038"><li id="EN-US_CONCEPT_0172366300__li1063310925517">Original next-hop addresses are different.<div class="note" id="EN-US_CONCEPT_0172366300__note452415755515"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_CONCEPT_0172366300__p952411714555">For labeled VPN unicast routes, the original next hops or labels are different.</p>
</div></div>
</li><li id="EN-US_CONCEPT_0172366300__li479496909214038"><p id="EN-US_CONCEPT_0172366300__p1545906019214038"><a name="EN-US_CONCEPT_0172366300__li479496909214038"></a><a name="li479496909214038"></a>The routes have the same PrefVal value.</p>
</li><li id="EN-US_CONCEPT_0172366300__li1223499082214038"><p id="EN-US_CONCEPT_0172366300__p1193151149214038"><a name="EN-US_CONCEPT_0172366300__li1223499082214038"></a><a name="li1223499082214038"></a>The routes have the same Local_Pref value.</p>
</li><li id="EN-US_CONCEPT_0172366300__li789241251214038"><p id="EN-US_CONCEPT_0172366300__p1918701685214038"><a name="EN-US_CONCEPT_0172366300__li789241251214038"></a><a name="li789241251214038"></a>All the routes are summarized or non-summarized routes.</p>
</li><li id="EN-US_CONCEPT_0172366300__li1912502017214038"><p id="EN-US_CONCEPT_0172366300__p2033655070214038"><a name="EN-US_CONCEPT_0172366300__li1912502017214038"></a><a name="li1912502017214038"></a>The routes have the same AIGP value.</p>
</li><li id="EN-US_CONCEPT_0172366300__li860953792214038"><p id="EN-US_CONCEPT_0172366300__p305568658214038"><a name="EN-US_CONCEPT_0172366300__li860953792214038"></a><a name="li860953792214038"></a>The routes have the same AS_Path length.</p>
</li><li id="EN-US_CONCEPT_0172366300__li603000346214038"><p id="EN-US_CONCEPT_0172366300__p651485029214038"><a name="EN-US_CONCEPT_0172366300__li603000346214038"></a><a name="li603000346214038"></a>The routes have the same origin type (IGP, EGP, or incomplete).</p>
</li><li id="EN-US_CONCEPT_0172366300__li1067304064214038"><p id="EN-US_CONCEPT_0172366300__p248500257214038"><a name="EN-US_CONCEPT_0172366300__li1067304064214038"></a><a name="li1067304064214038"></a>The routes have the same MED value. </p>
</li><li id="EN-US_CONCEPT_0172366300__li1623569709214038"><p id="EN-US_CONCEPT_0172366300__p1408880381214038"><a name="EN-US_CONCEPT_0172366300__li1623569709214038"></a><a name="li1623569709214038"></a>All the routes are EBGP or IBGP routes. If the <a href="cmdqueryname=maximum+load-balancing+eibgp"><b><span class="cmdname" id="EN-US_CONCEPT_0172366300__cmdname161150046214038">maximum load-balancing eibgp</span></b></a> command is run, load balancing can be implemented among EBGP and IBGP routes.</p>
</li><li id="EN-US_CONCEPT_0172366300__li1841187885214038"><p id="EN-US_CONCEPT_0172366300__p1752913572214038"><a name="EN-US_CONCEPT_0172366300__li1841187885214038"></a><a name="li1841187885214038"></a>The metric values of the IGP routes to which BGP routes within an AS recurse are the same. After the <a href="cmdqueryname=load-balancing+igp-metric-ignore"><b><span class="cmdname" id="EN-US_CONCEPT_0172366300__cmdname3801353379">load-balancing igp-metric-ignore</span></b></a> command is run, the device does not compare IGP metric values when selecting routes for load balancing.</p>
</li><li id="EN-US_CONCEPT_0172366300__li15421548162">All routes are blackhole routes, or none of them are blackhole routes.</li></ul>
<p id="EN-US_CONCEPT_0172366300__p920382321214038">Load balancing can be implemented between non-leaked routes or between leaked routes, but not between labeled BGP routes and non-labeled BGP routes even if the preceding conditions are met. If the <a href="cmdqueryname=load-balancing+local-learning+cross"><b><span class="cmdname" id="EN-US_CONCEPT_0172366300__cmdname161530105716">load-balancing local-learning cross</span></b></a> command is run in a VPN, load balancing can be implemented between unlabeled unicast VPN routes and labeled routes. Load balancing cannot be implemented between blackhole routes and non-blackhole routes.</p>
</div>
<div class="section"><h4 class="sectiontitle">VPN Route Selection Rules</h4><p>On the <span class="keyword">NE40E</span>, the rules for selecting VPN BGP routes are the same as those for selecting public network BGP routes. The only difference is that VPN BGP routes need to be leaked based on VPN targets. For details about route leaking, see "BGP VPN Route Leaking" in <span class="keyword">NE40E</span> <em>Feature Description &gt; IP Routing &gt; BGP</em>.</p>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_path_selection_0001.html">BGP Route Selection Rules
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_path_selection_0019.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_path_selection_0017.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>