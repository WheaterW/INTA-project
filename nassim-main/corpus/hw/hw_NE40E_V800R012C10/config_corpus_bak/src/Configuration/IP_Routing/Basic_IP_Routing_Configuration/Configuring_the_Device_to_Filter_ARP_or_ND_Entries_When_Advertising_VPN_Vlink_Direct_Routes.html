
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring the Device to Filter ARP or ND Entries When Advertising VPN Vlink Direct Routes">
<meta name="abstract" content="This section describes how to configure a device to filter ARP or ND entries when advertising VPN Vlink direct routes in a scenario where EVPN and L3VPN coexist. This configuration prevents the device from advertising the routes generated based on the ARP or ND entries that are filtered out.">
<meta name="description" content="This section describes how to configure a device to filter ARP or ND entries when advertising VPN Vlink direct routes in a scenario where EVPN and L3VPN coexist. This configuration prevents the device from advertising the routes generated based on the ARP or ND entries that are filtered out.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ip-route_cfg_0000.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ip-route_cfg_0056.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ip-route_cfg_0064.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="IP Routing Basis">
<meta name="featuretype" content="IP Route">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="IP Routing Basis">
<meta name="featuretype" content="IP Route">
<meta name="featurename" content="IP Routing Basis">
<meta name="featuretype" content="IP Routing Basis">
<meta name="OWNER" content="z00809835">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="z00809835">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001324938557">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring the Device to Filter ARP or ND Entries When Advertising VPN Vlink Direct Routes</title>
</head>
<body><a name="EN-US_TASK_0000001324938557"></a><a name="EN-US_TASK_0000001324938557"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring the Device to Filter ARP or ND Entries When Advertising VPN Vlink Direct Routes</h1>
<div class="taskbody"><p>This section describes how to configure a device to filter ARP or ND entries when advertising VPN Vlink direct routes in a scenario where EVPN and L3VPN coexist. This configuration prevents the device from advertising the routes generated based on the ARP or ND entries that are filtered out.</p>
<div class="context"><a name="EN-US_TASK_0000001324938557__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Usage Scenario</h4><p>During network evolution, some devices may be EVPN-ready, whereas other devices support only traditional functions, such as L3VPN, but not yet EVPN-ready. For example, on the network shown in <a href="#EN-US_TASK_0000001324938557__fig_dc_vrp_ip-route_cfg_005501">Figure 1</a>, CE1, CE2, and CE3 are access devices at different sites. CE1 is dual-homed to gateway devices PE1 and PE2. PE1, PE2, and PE3 are EVPN-ready gateways, whereas PE4 is still a traditional device. PE1, PE2, and PE3 run EVPN and implement Layer 2 and Layer 3 service interworking for the access devices. In addition, PE1, PE2, and PE4 run traditional L2VPN and L3VPN and implement Layer 2 and Layer 3 service interworking for the access devices. CE1 accesses PE1 and PE2 through Layer 2 sub-interfaces, and the same gateway address is configured for corresponding VBDIF interfaces on PE1 and PE2. CE1 accesses PE1 and PE2 in dual-homing single-active mode. PE1 is the master device, whereas PE2 is the backup device. PE1 learns the dynamic ARP entry of HOST1 and sends the ARP entry to PE2 through an EVPN IRB route for backup. PE2 then generates a remote dynamic ARP entry of HOST1. PE1 and PE2 generate Vlink routes based on the ARP entries and send VPNv4 host routes to PE4. After receiving these routes, PE4 selects one of them based on route priorities. If the route received from PE2 is selected, traffic travels along the path CE3 -&gt; PE4 -&gt; PE2 -&gt; PE1 -&gt; CE1 (with a detour to PE2) for a long time. Because EVPN does not generate IRB routes based on remote dynamic ARP entries, PE3 can receive the EVPN IRB route only from PE1, and the route is used to guide Layer 3 forwarding. Therefore, traffic from CE2 to CE1 passes through CE2 -&gt; PE3 -&gt; PE1 -&gt; CE1, without a detour to PE2. To prevent a detour, configure PE2 to filter out single-active and redirection ARP entries so that it does not advertise the routes generated based on these entries. In this way, PE4 will not receive the route advertised by PE2, preventing return traffic from detouring to PE2.</p>
<div class="fignone" id="EN-US_TASK_0000001324938557__fig_dc_vrp_ip-route_cfg_005501"><a name="EN-US_TASK_0000001324938557__fig_dc_vrp_ip-route_cfg_005501"></a><a name="fig_dc_vrp_ip-route_cfg_005501"></a><span class="figcap"><b>Figure 1 </b>Coexistence of EVPN dual-homing single-active and L3VPN</span><br><span><img class="vsd" src="figure/en-us_image_0000001324738481.png"></span></div>
</div></div>
<div class="steps-unordered"><a name="EN-US_TASK_0000001324938557__1.4.2"></a><a name="1.4.2"></a><h4 class="sectiontitle">Procedure</h4>
<ul><li><span>Enable the device to filter ARP entries when advertising Vlink routes.</span><ol><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ip+vpn-instance"><b><span class="cmdname">ip vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i></span><p><p>A VPN instance is created and its view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ipv4-family"><b><span class="cmdname">ipv4-family</span></b></a></span><p><p>The IPv4 address family is enabled for the VPN instance, and the VPN instance IPv4 address family view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=arp+vlink-direct-route+advertise-filter+single-active-redirect"><b><span class="cmdname">arp vlink-direct-route advertise-filter single-active-redirect</span></b></a></span><p><p>The device is enabled to filter ARP entries when advertising Vlink routes.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li><span>Enable the device to filter ND entries when advertising Vlink routes.</span><ol><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ip+vpn-instance"><b><span class="cmdname">ip vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i></span><p><p>A VPN instance is created and its view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ipv6-family"><b><span class="cmdname">ipv6-family</span></b></a></span><p><p>The IPv6 address family is enabled for the VPN instance, and the VPN instance IPv6 address family view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=nd+vlink-direct-route+advertise-filter+single-active-redirect"><b><span class="cmdname">nd vlink-direct-route advertise-filter single-active-redirect</span></b></a></span><p><p>The device is enabled to filter ND entries when advertising Vlink routes.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li></ul></div>
<div class="example"><a name="EN-US_TASK_0000001324938557__1.4.3"></a><a name="1.4.3"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p>After enabling the device to filter ARP entries when advertising Vlink routes, run the <a href="cmdqueryname=display+ip+routing-table+all-vpn-instance"><b><span class="cmdname">display ip routing-table all-vpn-instance</span></b></a> <strong><span>verbose</span></strong> command to check information about VPN Vlink direct routes.</p>
<p>After enabling the device to filter ND entries when advertising Vlink routes, run the <a href="cmdqueryname=display+ipv6+routing-table+all-vpn-instance"><b><span class="cmdname">display ipv6 routing-table all-vpn-instance</span></b></a> <strong><span>verbose</span></strong> command to check information about VPN Vlink direct routes.</p>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ip-route_cfg_0000.html">Basic IP Routing Configuration
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ip-route_cfg_0056.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ip-route_cfg_0064.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>