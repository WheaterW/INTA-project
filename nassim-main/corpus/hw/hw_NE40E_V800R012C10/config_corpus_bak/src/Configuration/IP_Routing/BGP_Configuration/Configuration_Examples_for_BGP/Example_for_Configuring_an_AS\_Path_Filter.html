
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring an AS_Path Filter">
<meta name="abstract" content="AS_Path filters can be used to improve network performance.">
<meta name="description" content="AS_Path filters can be used to improve network performance.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_3070.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_3074.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_4075.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,bgpvrp,w00556928,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Route">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Route">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Route">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing Basis">
<meta name="OWNER" content="w00604599">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00615954">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172366370">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring an AS_Path Filter</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172366370"></a><a name="EN-US_TASK_0172366370"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring an AS_Path Filter</h1>
<div class="taskbody"><p>AS_Path filters can be used to improve network performance.</p>
<div class="context"><a name="EN-US_TASK_0172366370__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>Enterprises A, B, and C belong to different ASs. The network of enterprise B communicates with the networks of the other two enterprises through EBGP. Due to the competition relationship, enterprises A and C require that the routes that they advertise to enterprise B be not learned by each other. In this situation, configure an AS_Path filter on enterprise B.</p>
<p>In <a href="#EN-US_TASK_0172366370__fig_dc_vrp_bgp_cfg_408801">Figure 1</a>, <span class="keyword">Device</span> B establish EBGP connections with <span class="keyword">Device</span>s A and C. To disable devices in AS 10 from communicating with devices in AS 30, you can configure an AS_Path filter on <span class="keyword">Device</span> B to prevent devices in AS 20 from advertising routes of AS 30 to AS 10 or routes of AS 10 to AS 30.</p>
<div class="fignone" id="EN-US_TASK_0172366370__fig_dc_vrp_bgp_cfg_408801"><a name="EN-US_TASK_0172366370__fig_dc_vrp_bgp_cfg_408801"></a><a name="fig_dc_vrp_bgp_cfg_408801"></a><span class="figcap"><b>Figure 1 </b>Configuring BGP route filtering</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 through 2 in this example are GE <span>0/1/0</span> and GE <span>0/2/0</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_bgp_cfg_408801.png" width="NaN" height="NaN"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172366370__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Precautions</h4><p>During the configuration process, note the following:</p>
<ul><li><p>The relationship between multiple filtering rules in the same filter is OR.</p>
</li><li>To improve security, you are advised to deploy BGP security measures. For details, see "Configuring BGP Security." Keychain authentication is used as an example. For details, see "Example for Configuring BGP Keychain."</li></ul>
</div></div>
<div class="context"><a name="EN-US_TASK_0172366370__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Establish EBGP connections between <span class="keyword">Device</span> A and <span class="keyword">Device</span> B, and between <span class="keyword">Device</span> B and <span class="keyword">Device</span> C, and then import direct routes.</p>
</li><li><p>Configure an AS_Path filter on <span class="keyword">Device</span> B and then apply its filtering rules.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172366370__1.4.4"></a><a name="1.4.4"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>Router IDs and AS numbers of <span class="keyword">Device</span> A, <span class="keyword">Device</span> B, and <span class="keyword">Device</span> C</p>
</li><li><p>Number of the AS_Path filter</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172366370__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure an IP address for each interface. For configuration details, see <a href="#EN-US_TASK_0172366370__section_dc_vrp_bgp_cfg_408805">Configuration Files</a> in this section.</span></li><li><span>Configure EBGP connections.</span><p><p># Configure <span class="keyword">Device</span> A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>bgp 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp] <strong>router-id 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp] <strong>peer 10.1.2.2 as-number 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp] <strong>import-route direct</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp] <strong>commit</strong></pre>
<p># Configure <span class="keyword">Device</span> B.</p>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>bgp 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp] <strong>router-id 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp] <strong>peer 10.1.2.1 as-number 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp]<strong> peer 10.1.3.2 as-number 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp] <strong>import-route direct</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-bgp] <strong>quit</strong></pre>
<p># Configure <span class="keyword">Device</span> C.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C]<strong> bgp 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp]<strong> router-id 3.3.3.3 </strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp]<strong> peer 10.1.3.1 as-number 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp] <strong>import-route direct</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C-bgp] <strong>quit</strong></pre>
<p># Display the routing table advertised by <span class="keyword">Device</span> B. Use the routes advertised by <span class="keyword">Device</span> B to <span class="keyword">Device</span> C as an example. You can view that <span class="keyword">Device</span> B advertises the routes destined for the network segment between <span class="keyword">Device</span> A and <span class="keyword">Device</span> C.</p>
<pre class="screen">&lt;<span class="keyword">Device</span>B&gt; <strong>display bgp routing-table peer 10.1.3.2 advertised-routes</strong>


 BGP Local router ID is 2.2.2.2
 Status codes: * - valid, &gt; - best, d - damped, x - best external, a - add path,
               h - history,  i - internal, s - suppressed, S - Stale
               Origin : i - IGP, e - EGP, ? - incomplete
 RPKI validation codes: V - valid, I - invalid, N - not-found


 Total Number of Routes: 3
        Network            NextHop                       MED        LocPrf    PrefVal Path/Ogn

 *&gt;     10.1.2.0/24        10.1.3.1                       0                     0      20?
 *&gt;     10.1.3.0/24        10.1.3.1                       0                     0      20?
 *&gt;     <strong>10.1.4.0/24</strong>       <strong>10.1.3.1</strong>                      0                     0      20 10?</pre>
<p>Check the routing table of <span class="keyword">Device</span> C. The command output shows that <span class="keyword">Device</span> C has learned the two routes advertised by <span class="keyword">Device</span> B.</p>
<pre class="screen">&lt;<span class="keyword">Device</span>C&gt; <strong>display bgp routing-table</strong>

 BGP Local router ID is 3.3.3.3
 Status codes: * - valid, &gt; - best, d - damped, x - best external, a - add path,
               h - history,  i - internal, s - suppressed, S - Stale
               Origin : i - IGP, e - EGP, ? - incomplete
 RPKI validation codes: V - valid, I - invalid, N - not-found


 Total Number of Routes: 7
        Network            NextHop                       MED        LocPrf    PrefVal Path/Ogn

 *&gt;     10.1.2.0/24        10.1.3.1                       0                     0      20?
 *&gt;     10.1.3.0/24        0.0.0.0                        0                     0       ?
                           10.1.3.1                       0                     0      20?
 *&gt;     10.1.3.2/32        0.0.0.0                        0                     0       ?
 *&gt;     10.1.4.0/24        0.0.0.0                        0                     0       ?
 *                         10.1.3.1                                             0      20 10?
 *&gt;     10.1.4.2/32        0.0.0.0                        0                     0       ?</pre>
</p></li><li><span>Configure the AS_Path filter on <span class="keyword">Device</span> B and then apply the filter on the outbound interface of <span class="keyword">Device</span> B.</span><p><p># Create AS_Path filter 1 to deny the routes carrying AS 30. The regular expression "_30_" indicates any AS list that contains AS 30 and "*" matches any character.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>ip as-path-filter 1 deny _30_</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>ip as-path-filter 1 permit .*</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>commit</strong></pre>
<p># Create AS_Path filter 2 to deny the routes carrying AS 10. The regular expression "_10_" indicates any AS list that contains AS 10 and "*" matches any character.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>ip as-path-filter 2 deny _10_</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>ip as-path-filter 2 permit .*</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>commit</strong></pre>
<p># Apply the AS_Path filter on two outbound interfaces of <span class="keyword">Device</span> B.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>bgp 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp] <strong>peer 10.1.2.1 as-path-filter 1 export</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp] <strong>peer 10.1.3.2 as-path-filter 2 export</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-bgp] <strong>quit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p># Display the routing table advertised by <span class="keyword">Device</span> B. The command output shows that the advertised routes to the network segment between <span class="keyword">Device</span> A and <span class="keyword">Device</span> C do not exist. Use the routes advertised by <span class="keyword">Device</span> B to <span class="keyword">Device</span> C as an example.</p>
<pre class="screen">&lt;<span class="keyword">Device</span>B&gt; <strong>display bgp routing-table peer 10.1.3.2 advertised-routes</strong>

 BGP Local router ID is 2.2.2.2
 Status codes: * - valid, &gt; - best, d - damped, x - best external, a - add path,
               h - history,  i - internal, s - suppressed, S - Stale
               Origin : i - IGP, e - EGP, ? - incomplete
 RPKI validation codes: V - valid, I - invalid, N - not-found


 Total Number of Routes: 2
        Network            NextHop                       MED        LocPrf    PrefVal Path/Ogn

 *&gt;     10.1.2.0/24        10.1.3.1                       0                     0      20?
 *&gt;     10.1.3.0/24        10.1.3.1                       0                     0      20?</pre>
<p>Similarly, the BGP routing table of <span class="keyword">Device</span> C does not have these routes.</p>
<pre class="screen">&lt;<span class="keyword">Device</span>C&gt; <strong>display bgp routing-table</strong>

 BGP Local router ID is 3.3.3.3
 Status codes: * - valid, &gt; - best, d - damped, x - best external, a - add path,
               h - history,  i - internal, s - suppressed, S - Stale
               Origin : i - IGP, e - EGP, ? - incomplete
 RPKI validation codes: V - valid, I - invalid, N - not-found


 Total Number of Routes: 6
        Network            NextHop                       MED        LocPrf    PrefVal Path/Ogn

 *&gt;     10.1.2.0/24        10.1.3.1                       0                     0      20?
 *&gt;     10.1.3.0/24        0.0.0.0                        0                     0       ?
                           10.1.3.1                       0                     0      20?
 *&gt;     10.1.3.2/32        0.0.0.0                        0                     0       ?
 *&gt;     10.1.4.0/24        0.0.0.0                        0                     0       ?
 *&gt;     10.1.4.2/32        0.0.0.0                        0                     0       ?</pre>
<p>Check the routing table advertised by <span class="keyword">Device</span> B, and you can view that the advertised routes to the network segment between <span class="keyword">Device</span> A and <span class="keyword">Device</span> C do not exist. Use the routes advertised by <span class="keyword">Device</span> B to <span class="keyword">Device</span> A as an example.</p>
<pre class="screen">&lt;<span class="keyword">Device</span>B&gt; <strong>display bgp routing-table peer 10.1.2.1 advertised-routes</strong>

 BGP Local router ID is 2.2.2.2
 Status codes: * - valid, &gt; - best, d - damped, x - best external, a - add path,
               h - history,  i - internal, s - suppressed, S - Stale
               Origin : i - IGP, e - EGP, ? - incomplete
 RPKI validation codes: V - valid, I - invalid, N - not-found


 Total Number of Routes: 2
        Network            NextHop                       MED        LocPrf    PrefVal Path/Ogn

 *&gt;     10.1.2.0/24        10.1.2.2                       0                     0      20?
 *&gt;     10.1.3.0/24        10.1.2.2                       0                     0      20?</pre>
<p>Similarly, the BGP routing table of <span class="keyword">Device</span> A does not have these routes.</p>
<pre class="screen">&lt;<span class="keyword">Device</span>A&gt; <strong>display bgp routing-table</strong>

 BGP Local router ID is 1.1.1.1
 Status codes: * - valid, &gt; - best, d - damped, x - best external, a - add path,
               h - history,  i - internal, s - suppressed, S - Stale
               Origin : i - IGP, e - EGP, ? - incomplete
 RPKI validation codes: V - valid, I - invalid, N - not-found


 Total Number of Routes: 6
        Network            NextHop                       MED        LocPrf    PrefVal Path/Ogn

 *&gt;     10.1.2.0/24        0.0.0.0                        0                     0       ?
                           10.1.2.2                       0                     0      20?
 *&gt;     10.1.2.1/32        0.0.0.0                        0                     0       ?
 *&gt;     10.1.3.0/24        10.1.2.2                       0                     0      20?
 *&gt;     10.1.4.0/24        0.0.0.0                        0                     0       ?
 *&gt;     10.1.4.1/32        0.0.0.0                        0                     0       ?</pre>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0172366370__section_dc_vrp_bgp_cfg_408805"><a name="EN-US_TASK_0172366370__section_dc_vrp_bgp_cfg_408805"></a><a name="section_dc_vrp_bgp_cfg_408805"></a><a name="EN-US_TASK_0172366370__1.4.6"></a><a name="1.4.6"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p><span class="keyword">Device</span> A configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname <span class="keyword">Device</span>A</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.1.4.1 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/2/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.1.2.1 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">bgp 10</pre>
<pre class="screen"> router-id 1.1.1.1</pre>
<pre class="screen"> peer 10.1.2.2 as-number 20</pre>
<pre class="screen">#</pre>
<pre class="screen"> ipv4-family unicast</pre>
<pre class="screen">  undo synchronization 
  import-route direct</pre>
<pre class="screen">  peer 10.1.2.2 enable</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p><span class="keyword">Device</span> B configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname <span class="keyword">Device</span>B</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.1.3.1 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/2/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.1.2.2 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">bgp 20</pre>
<pre class="screen"> router-id 2.2.2.2</pre>
<pre class="screen"> peer 10.1.2.1 as-number 10</pre>
<pre class="screen"> peer 10.1.3.2 as-number 30</pre>
<pre class="screen"> #</pre>
<pre class="screen"> ipv4-family unicast</pre>
<pre class="screen">  undo synchronization 
  import-route direct</pre>
<pre class="screen">  peer 10.1.2.1 enable</pre>
<pre class="screen">  peer 10.1.2.1 as-path-filter 1 export</pre>
<pre class="screen">  peer 10.1.3.2 enable</pre>
<pre class="screen">  peer 10.1.3.2 as-path-filter 2 export</pre>
<pre class="screen">#</pre>
<pre class="screen"> ip as-path-filter 1 deny _30_</pre>
<pre class="screen"> ip as-path-filter 1 permit .*</pre>
<pre class="screen"> ip as-path-filter 2 deny _10_</pre>
<pre class="screen"> ip as-path-filter 2 permit .*</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p><span class="keyword">Device</span> C configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname <span class="keyword">Device</span>C</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.1.4.2 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/2/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.1.3.2 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">bgp 30</pre>
<pre class="screen"> router-id 3.3.3.3</pre>
<pre class="screen"> peer 10.1.3.1 as-number 20</pre>
<pre class="screen">#</pre>
<pre class="screen"> ipv4-family unicast</pre>
<pre class="screen">  undo synchronization 
  import-route direct</pre>
<pre class="screen">  peer 10.1.3.1 enable</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_3070.html">Configuration Examples for BGP
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_3074.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_4075.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>