
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Applying a Policy to BGP Route Advertisement">
<meta name="abstract" content="After a route advertisement policy is configured on a device, the device advertises only the routes that match the policy to its BGP peers.">
<meta name="description" content="After a route advertisement policy is configured on a device, the device advertises only the routes that match the policy to its BGP peers.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_3112.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_3113.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_3115.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Route">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Route">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Route">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing Basis">
<meta name="OWNER" content="w00604599">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00615954">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001398217241">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Applying a Policy to BGP Route Advertisement</title>
</head>
<body><a name="EN-US_TASK_0000001398217241"></a><a name="EN-US_TASK_0000001398217241"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Applying a Policy to BGP Route Advertisement</h1>
<div class="taskbody"><p>After a route advertisement policy is configured on a device, the device advertises only the routes that match the policy to its BGP peers.</p>
<div class="steps-unordered"><a name="EN-US_TASK_0000001398217241__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Procedure</h4>
<ul><li><span>Configure BGP to filter the routes to be advertised globally.</span><p><p>You can configure the device to filter the routes to be advertised. Perform the following steps on a BGP <span class="keyword">Router</span>:</p>
</p><ol><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ipv4-family+unicast"><b><span class="cmdname">ipv4-family</span></b></a> <strong><span>unicast</span></strong></span><p><p>The IPv4 unicast address family view is displayed.</p>
</p></li><li class="substepexpand"><span>Configure BGP to filter the routes to be advertised globally.</span><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>BGP advertisement policies take effect in the following sequence:</p>
<ol type="a"><li>Globally advertised routes:<p>Basic ACL-based advertisement policy configured using the <a href="cmdqueryname=filter-policy+acl-name+export+direct+isis+ospf+rip+static"><b><span class="cmdname">filter-policy</span></b></a> { <i><span class="varname">acl-number</span></i> | <strong><span>acl-name</span></strong> <i><span class="varname">acl-name</span></i> } <strong><span>export</span></strong> [ <strong><span>direct</span></strong> | <strong><span>isis</span></strong> <i><span class="varname">process-id</span></i> | <strong><span>ospf</span></strong> <i><span class="varname">process-id</span></i><span> | <strong><span>rip</span></strong> <i><span class="varname">process-id</span></i></span> | <strong><span>static</span></strong> ] command</p>
<p>IP prefix list-based advertisement policy configured using the <a href="cmdqueryname=filter-policy+ip-prefix+export+direct+isis+ospf+rip+static"><b><span class="cmdname">filter-policy</span></b></a> <strong><span>ip-prefix</span></strong> <i><span class="varname">ip-prefix-name</span></i> <strong><span>export</span></strong> [ <strong><span>direct</span></strong> | <strong><span>isis</span></strong> <i><span class="varname">process-id</span></i> | <strong><span>ospf</span></strong> <i><span class="varname">process-id</span></i><span> | <strong><span>rip</span></strong> <i><span class="varname">process-id</span></i></span> | <strong><span>static</span></strong> ] command</p>
</li><li>Basic ACL-based policy for advertising routes to a specified peer or peer group, configured using the <a href="cmdqueryname=peer+filter-policy+acl-name+export"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>filter-policy</span></strong> { <i><span class="varname">acl-number</span></i> | <strong><span>acl-name</span></strong> <i><span class="varname">acl-name</span></i> } <strong><span>export</span></strong> command</li><li>AS_Path filter-based policy for advertising routes to a specified peer or peer group, configured using the <a href="cmdqueryname=peer+as-path-filter+export"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>as-path-filter</span></strong> { <i><span class="varname">number</span></i> | <i><span class="varname">name</span></i> } <strong><span>export</span></strong> command</li><li>IP prefix list-based policy for advertising routes to a specified peer or peer group, configured using the <a href="cmdqueryname=peer+ip-prefix+export"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>ip-prefix</span></strong> <i><span class="varname">ip-prefix-name</span></i> <strong><span>export</span></strong> command</li><li>IP address list-based policy for advertising routes to a specific peer or peer group, configured using the <a href="cmdqueryname=peer+advertise+dependent-filter+condition-filter"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>advertise dependent-filter</span></strong> <i><span class="varname">dependent-filter-list</span></i> <i><span class="varname">outDependType</span></i> [ <strong><span>condition-filter</span></strong> <i><span class="varname">condition-filter-list</span></i> | <strong><span>condition-ip-filter</span></strong> <i><span class="varname">ip-prefix-name</span></i> ] command</li><li>Route-policy-based policy for advertising routes to a specified peer or peer group, configured using the <a href="cmdqueryname=peer+route-policy+export"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>route-policy</span></strong> <i><span class="varname">route-policy-name</span></i> <strong><span>export</span></strong> command</li></ol>
</div></div>
</p><p><ul><li><div class="p">To filter routes based on a basic ACL, perform the following steps:<ol type="a"><li>Run the <a href="cmdqueryname=filter-policy+acl-name+export+direct+isis+ospf+rip+static"><b><span class="cmdname">filter-policy</span></b></a> { <i><span class="varname">acl-number</span></i> | <strong><span>acl-name</span></strong> <i><span class="varname">acl-name</span></i> } <strong><span>export</span></strong> [ <strong><span>direct</span></strong> | <strong><span>isis</span></strong> <i><span class="varname">process-id</span></i> | <strong><span>ospf</span></strong> <i><span class="varname">process-id</span></i><span> | <strong><span>rip</span></strong> <i><span class="varname">process-id</span></i></span> | <strong><span>static</span></strong> ] command to filter the routes to be advertised.</li><li>Run the <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a> command to return to the BGP view.</li><li>Run the <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a> command to return to the system view.</li><li>Run the <span><a href="cmdqueryname=acl+name+basic+basic+number+match-order+config+auto"><b><span class="cmdname">acl</span></b></a> { <strong><span>name</span></strong> <i><span class="varname">basic-acl-name</span></i> { <strong><span>basic</span></strong> | [ <strong><span>basic</span></strong> ] <strong><span>number</span></strong> <i><span class="varname">basic-acl-number</span></i> } } [ <strong><span>match-order</span></strong> { <strong><span>config</span></strong> | <strong><span>auto</span></strong> } ]</span> command to enter the ACL view.</li><li><p>Run the <span><a href="cmdqueryname=rule+name+deny+permit"><b><span class="cmdname">rule</span></b></a> [ <i><span class="varname">rule-id</span></i> ] [ <strong><span>name</span></strong> <i><span class="varname">rule-name</span></i> ] { <strong><span>deny</span></strong> | <strong><span>permit</span></strong> }</span> command to configure a rule for the ACL.</p>
<p>When the <a href="cmdqueryname=rule+source+time-range"><b><span class="cmdname">rule</span></b></a> command is used to configure a filtering rule for a named ACL, only the configurations specified by <strong><span>source</span></strong> and <strong><span>time-range</span></strong> take effect.</p>
<div class="p">When a filter-policy of a routing protocol is used to filter routes:<ul><li><p>If the action specified in an ACL rule is <strong>permit</strong>, a route matching the rule will be accepted or advertised by the system.</p>
</li><li><p>If the action specified in an ACL rule is <strong>deny</strong>, a route matching the rule will not be accepted or advertised by the system.</p>
</li><li><p>If the network segment of a route is not within the range specified in an ACL rule, the route will not be accepted or advertised by the system.</p>
</li><li><p>If an ACL does not contain any rules, none of the routes matched against the filter-policy that uses this ACL will be accepted or advertised by the system.</p>
</li><li><p>Routes can be filtered using a blacklist or whitelist:</p>
<p>If ACL rules are used for matching in configuration order, the system matches the rules in ascending order of their IDs.</p>
<p>Filtering using a blacklist: Configure a rule with a smaller ID and specify the action <strong>deny</strong> in this rule to filter out the unwanted routes. Then, configure another rule with a larger ID in the same ACL and specify the action <strong>permit</strong> in this rule to accept or advertise the other routes.</p>
<p>Filtering using a whitelist: Configure a rule with a small ID and specify the action <strong>permit</strong> in this rule to permit the routes to be accepted or advertised. Then, configure another rule with a larger ID in the same ACL and specify the action <strong>deny</strong> in this rule to filter out the routes that are not to be accepted or advertised.</p>
</li></ul>
</div>
</li></ol>
</div>
</li><li>To filter routes based on an IP prefix list, run the <a href="cmdqueryname=filter-policy+ip-prefix+export+direct+isis+ospf+rip+static"><b><span class="cmdname">filter-policy</span></b></a> <strong><span>ip-prefix</span></strong> <i><span class="varname">ip-prefix-name</span></i> <strong><span>export</span></strong> [ <strong><span>direct</span></strong> | <strong><span>isis</span></strong> <i><span class="varname">process-id</span></i> | <strong><span>ospf</span></strong> <i><span class="varname">process-id</span></i><span> | <strong><span>rip</span></strong> <i><span class="varname">process-id</span></i></span> | <strong><span>static</span></strong> ] command.</li></ul>
</p><p><p>If a protocol type is specified, only the routes discovered by the specified routing protocol match the filtering condition. If no protocol type is specified, all BGP routes to be advertised match the filtering condition, including those imported using the <a href="cmdqueryname=import-route"><b><span class="cmdname">import-route</span></b></a> <strong>(BGP)</strong> command and local routes imported using the <a href="cmdqueryname=network"><b><span class="cmdname">network</span></b></a> <strong>(BGP)</strong> command.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>If an ACL is specified in the <a href="cmdqueryname=filter-policy"><b><span class="cmdname">filter-policy</span></b></a> command and no VPN instance is specified in ACL rules, BGP filters both public network and VPN routes in all address families. If a VPN instance is specified in an ACL rule, only data traffic from the VPN instance matches the filtering condition, and no routes are filtered.</p>
</div></div>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li><span>Configure BGP to filter the routes to be advertised to a specified peer or peer group.</span><ol><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ipv4-family+unicast"><b><span class="cmdname">ipv4-family</span></b></a> <strong><span>unicast</span></strong></span><p><p>The IPv4 unicast address family view is displayed.</p>
</p></li><li class="substepexpand"><span>Perform any of the following operations to filter the routes to be advertised to a specified peer or peer group:</span><p><ul><li><div class="p">To filter routes based on a basic ACL, perform the following steps:<ol type="a"><li>Run the <a href="cmdqueryname=peer+filter-policy+acl-name+export"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>filter-policy</span></strong> { <i><span class="varname">acl-number</span></i> | <strong><span>acl-name</span></strong> <i><span class="varname">acl-name</span></i> } <strong><span>export</span></strong> command to configure the device to filter the routes to be advertised to a specified peer or peer group.</li><li>Run the <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a> command to return to the BGP view.</li><li>Run the <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a> command to return to the system view.</li><li>Run the <span><a href="cmdqueryname=acl+name+basic+basic+number+number+match-order+config+auto"><b><span class="cmdname">acl</span></b></a> { <strong><span>name</span></strong> <i><span class="varname">basic-acl-name</span></i> { <strong><span>basic</span></strong> | [ <strong><span>basic</span></strong> ] <strong><span>number</span></strong> <i><span class="varname">basic-acl-number</span></i> } | [ <strong><span>number</span></strong> ] <i><span class="varname">basic-acl-number</span></i> } [ <strong><span>match-order</span></strong> { <strong><span>config</span></strong> | <strong><span>auto</span></strong> } ]</span> command to enter the ACL view.</li><li><p>Run the <span><a href="cmdqueryname=rule+name+deny+permit"><b><span class="cmdname">rule</span></b></a> [ <i><span class="varname">rule-id</span></i> ] [ <strong><span>name</span></strong> <i><span class="varname">rule-name</span></i> ] { <strong><span>deny</span></strong> | <strong><span>permit</span></strong> }</span> command to configure a rule for the ACL.</p>
<p>When the <a href="cmdqueryname=rule+source+time-range"><b><span class="cmdname">rule</span></b></a> command is used to configure a filtering rule for a named ACL, only the configurations specified by <strong><span>source</span></strong> and <strong><span>time-range</span></strong> take effect.</p>
<div class="p">When a filter-policy of a routing protocol is used to filter routes:<ul><li><p>If the action specified in an ACL rule is <strong>permit</strong>, a route matching the rule will be accepted or advertised by the system.</p>
</li><li><p>If the action specified in an ACL rule is <strong>deny</strong>, a route matching the rule will not be accepted or advertised by the system.</p>
</li><li><p>If the network segment of a route is not within the range specified in an ACL rule, the route will not be accepted or advertised by the system.</p>
</li><li><p>If an ACL does not contain any rules, none of the routes matched against the filter-policy that uses this ACL will be accepted or advertised by the system.</p>
</li><li><p>Routes can be filtered using a blacklist or whitelist:</p>
<p>If ACL rules are used for matching in configuration order, the system matches the rules in ascending order of their IDs.</p>
<p>Filtering using a blacklist: Configure a rule with a smaller ID and specify the action <strong>deny</strong> in this rule to filter out the unwanted routes. Then, configure another rule with a larger ID in the same ACL and specify the action <strong>permit</strong> in this rule to accept or advertise the other routes.</p>
<p>Filtering using a whitelist: Configure a rule with a small ID and specify the action <strong>permit</strong> in this rule to permit the routes to be accepted or advertised. Then, configure another rule with a larger ID in the same ACL and specify the action <strong>deny</strong> in this rule to filter out the routes that are not to be accepted or advertised.</p>
</li></ul>
</div>
</li></ol>
</div>
</li><li>To filter routes based on an AS_Path filter, run the <a href="cmdqueryname=peer+as-path-filter+export"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>as-path-filter</span></strong> { <i><span class="varname">number</span></i> | <i><span class="varname">name</span></i> } <strong><span>export</span></strong> command.</li><li><p>To filter routes based on an IP prefix list, run the <a href="cmdqueryname=peer+ip-prefix+export"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>ip-prefix</span></strong> <i><span class="varname">ip-prefix-name</span></i> <strong><span>export</span></strong> command.</p>
</li><li>To filter routes based on an IP address list, run the <a href="cmdqueryname=peer+advertise+dependent-filter+condition-filter"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>advertise dependent-filter</span></strong> <i><span class="varname">dependent-filter-list</span></i> <i><span class="varname">outDependType</span></i> [ <strong><span>condition-filter</span></strong> <i><span class="varname">condition-filter-list</span></i> | <strong><span>condition-ip-filter</span></strong> <i><span class="varname">ip-prefix-name</span></i> ] command.<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>If BGP route status changes after a filtering policy that is based on an IP address list is enabled, the routes are re-advertised based on the conditional advertisement policy 10 seconds later by default. To set the delay in advertising the routes, run the <a href="cmdqueryname=timer+dependent-advertise-delay"><b><span class="cmdname">timer dependent-advertise-delay</span></b></a> <i><span class="varname">delay-time</span></i> command.</p>
</div></div>
</li><li><p>To filter routes based on a route-policy, run the <a href="cmdqueryname=peer+route-policy+export"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>route-policy</span></strong> <i><span class="varname">route-policy-name</span></i> <strong><span>export</span></strong> command.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>A route-policy specified in the <a href="cmdqueryname=peer+route-policy"><b><span class="cmdname">peer route-policy</span></b></a> <a href="cmdqueryname=export"><b><span class="cmdname">export</span></b></a> command does not support interface-based matching rules (configured using the <a href="cmdqueryname=if-match+interface"><b><span class="cmdname">if-match interface</span></b></a> command).</p>
</div></div>
</li></ul>
<p>The export routing policy applied to a peer in a peer group can be different from that applied to the peer group. Specifically, a unique policy can be used to filter the routes to be advertised to each peer in the peer group.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li></ul></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_3112.html">Configuring BGP Routing Policies
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_3113.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_3115.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>