
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Layer 2 Static Dual-Stack User Access in a Dual-Device Hot Backup Scenario with Distributed CGN Deployed">
<meta name="abstract" content="Distributed CGN is deployed on the network to translate a large number of user addresses. In a distributed CGN+dual-device hot backup scenario, Layer 2 static users are dual-homed to the active and standby BRASs, which implement user access through distributed CGN.">
<meta name="description" content="Distributed CGN is deployed on the network to translate a large number of user addresses. In a distributed CGN+dual-device hot backup scenario, Layer 2 static users are dual-homed to the active and standby BRASs, which implement user access through distributed CGN.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cfg_rui_0050.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cfg_rui_1003.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cfg_rui_00632.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="z00588052,w00606909,w00447999">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="UP Multi-Device Backup">
<meta name="featurename" content="User Access Multi-Device Backup">
<meta name="featuretype" content="User Access">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="UP Multi-Device Backup">
<meta name="featurename" content="User Access Multi-Device Backup">
<meta name="featuretype" content="User Access">
<meta name="featurename" content="UP Multi-Device Backup">
<meta name="featurename" content="User Access Multi-Device Backup">
<meta name="featuretype" content="User Access">
<meta name="featurename" content="User Access Multi-Device Backup">
<meta name="featuretype" content="User Access">
<meta name="OWNER" content="l00425560">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="z00588052">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001166370811">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>Example for Configuring Layer 2 Static Dual-Stack User Access in a Dual-Device Hot Backup Scenario with Distributed CGN Deployed</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001166370811"></a><a name="EN-US_TASK_0000001166370811"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Layer 2 Static Dual-Stack User Access in a Dual-Device Hot Backup Scenario with Distributed CGN Deployed</h1>
<div class="taskbody"><p>Distributed CGN is deployed on the network to translate a large number of user addresses. In a distributed CGN+dual-device hot backup scenario, Layer 2 static users are dual-homed to the active and standby BRASs, which implement user access through distributed CGN.</p>
<div class="context"><a name="EN-US_TASK_0000001166370811__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0000001166370811__fig_dc_ne_cfg_rui_003101">Figure 1</a>, user 1 and user 2 access BRAS1 and BRAS2 through SW1. RADIUS authentication and accounting are configured on the BRASs. The BRASs use a local address pool to assign IPv4 addresses to users, use DHCPv6 IA_PD to assign the IPv6 prefixes to be used on the network to users, and use DHCPv6 ND to assign IPv6 addresses to users.</p>
<p>To enable private network users to access the Internet, distributed CGN is deployed on the network to translate private addresses into public addresses. In addition, dual-device hot backup is deployed to improve network reliability. If a fault occurs, a master/backup switchover is triggered to ensure normal service running and prevent users from perceiving the fault.</p>
<div class="fignone" id="EN-US_TASK_0000001166370811__fig_dc_ne_cfg_rui_003101"><a name="EN-US_TASK_0000001166370811__fig_dc_ne_cfg_rui_003101"></a><a name="fig_dc_ne_cfg_rui_003101"></a><span class="figcap"><b>Figure 1 </b>Configuring Layer 2 static dual-stack user access in a dual-device hot backup scenario with distributed CGN deployed</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface1, interface2, and interface3 stand for GE<span>0/1/0</span>, GE<span>0/2/0</span>, and GE<span>0/3/0</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0000001166450885.png"></span></div>

<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" frame="border" border="1" rules="all"><caption><b>Table 1 </b>Interfaces and IP addresses</caption><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="22.587741225877412%" id="mcps1.4.1.5.2.5.1.1" liSelected="liSelected"><p><strong>Device</strong></p>
</th>
<th align="left" class="cellrowborder" valign="top" width="23.227677232276772%" id="mcps1.4.1.5.2.5.1.2" liSelected="liSelected"><p><strong>Interface Name</strong></p>
</th>
<th align="left" class="cellrowborder" valign="top" width="23.337666233376662%" id="mcps1.4.1.5.2.5.1.3" liSelected="liSelected"><p><strong>Interface Number</strong></p>
</th>
<th align="left" class="cellrowborder" valign="top" width="30.846915308469153%" id="mcps1.4.1.5.2.5.1.4" liSelected="liSelected"><p><strong>IP Address</strong></p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" rowspan="6" valign="top" width="22.587741225877412%" headers="mcps1.4.1.5.2.5.1.1 "><p>BRAS1</p>
</td>
<td class="cellrowborder" valign="top" width="23.227677232276772%" headers="mcps1.4.1.5.2.5.1.2 "><p>interface1</p>
</td>
<td class="cellrowborder" valign="top" width="23.337666233376662%" headers="mcps1.4.1.5.2.5.1.3 "><p>GE<span>0/1/0</span>.1</p>
</td>
<td class="cellrowborder" valign="top" width="30.846915308469153%" headers="mcps1.4.1.5.2.5.1.4 "><p>192.168.1.1</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.5.1.2 "><p>interface1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.5.1.3 "><p>GE<span>0/1/0</span>.2</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.5.1.4 "><p>BAS interface</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.5.1.2 "><p>interface2</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.5.1.3 "><p>GE<span>0/2/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.5.1.4 "><p>10.0.0.1, 2001:db8:1::1</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.5.1.2 "><p>interface3</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.5.1.3 "><p>GE<span>0/3/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.5.1.4 "><p>10.1.1.1</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.5.1.2 "><p>-</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.5.1.3 "><p>LoopBack0</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.5.1.4 "><p>10.2.2.2/32</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.5.1.2 "><p>-</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.5.1.3 "><p>LoopBack1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.5.1.4 "><p>10.3.3.3</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="6" valign="top" width="22.587741225877412%" headers="mcps1.4.1.5.2.5.1.1 "><p>BRAS2</p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
</td>
<td class="cellrowborder" valign="top" width="23.227677232276772%" headers="mcps1.4.1.5.2.5.1.2 "><p>interface1</p>
</td>
<td class="cellrowborder" valign="top" width="23.337666233376662%" headers="mcps1.4.1.5.2.5.1.3 "><p>GE<span>0/1/0</span>.1</p>
</td>
<td class="cellrowborder" valign="top" width="30.846915308469153%" headers="mcps1.4.1.5.2.5.1.4 "><p>192.168.1.2</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.5.1.2 "><p>interface1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.5.1.3 "><p>GE<span>0/1/0</span>.2</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.5.1.4 "><p>BAS interface</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.5.1.2 "><p>interface2</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.5.1.3 "><p>GE<span>0/2/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.5.1.4 "><p>10.0.0.2, 2001:db8:2::1</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.5.1.2 "><p>interface3</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.5.1.3 "><p>GE<span>0/3/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.5.1.4 "><p>10.1.1.2</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.5.1.2 "><p>-</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.5.1.3 "><p>LoopBack0</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.5.1.4 "><p>10.4.4.4</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.5.1.2 "><p>-</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.5.1.3 "><p>LoopBack1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.5.1.4 "><p>10.5.5.5</p>
</td>
</tr>
</tbody>
</table>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001166370811__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure IP addresses for interfaces.</p>
</li><li><p>Configure BFD sessions and VRRP on the access side of the master and backup BRASs.</p>
</li><li><p>Configure an RBS and an RBP.</p>
</li><li><p>Configure a routing protocol.</p>
</li><li><p>Configure an IP address pool for local authentication static users to go online.</p>
</li><li>Configure AAA schemes.</li><li><p>Configure a RADIUS server group.</p>
</li><li><p>Configure a domain.</p>
</li><li>Configure the DHCPv6 device to generate DUIDs in DUID-LLT mode.</li><li>Configure a BAS interface.</li><li>Configure a static user.</li><li>Configure the CGN service.</li></ol>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The configuration of BRAS2 is similar to the configuration of BRAS1. The following uses the configuration on BRAS1 as an example. For configuration details on BRAS2, see the BRAS2 configuration file.</p>
</div></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001166370811__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>VRRP parameters (such as the VRRP ID and preemption delay)</p>
</li><li><p>BFD parameters (such as the local and remote discriminators of a BFD session and the expected minimum intervals at which BFD Control packets are sent and received)</p>
</li><li><p>IP address of each interface on BRAS1 and BRAS2</p>
</li><li><p>User access parameters</p>
</li><li><p>CGN service parameters</p>
</li><li>User authentication mode (RADIUS authentication)</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001166370811__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure IP addresses for interfaces.</span><p><p># Configure IP addresses for network-side interfaces. Configure IP addresses for the loopback interface and network-side interface.</p>
</p><p><pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname BRAS1</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>interface GigabitEthernet<span>0/2/0</span></strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-GigabitEthernet<span>0/2/0</span>] <strong>ip address 10.0.0.1 24</strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/2/0</span>] <strong>ipv6 enable</strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/2/0</span>] <strong>ipv6 address 2001:db8:1::1 120</strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/2/0</span>]<strong> ipv6 address auto link-local</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1]<strong> interface LoopBack0</strong>
[<span class="keyword">*</span>BRAS1-LoopBack0] <strong>ip address 10.2.2.2 32</strong>
[<span class="keyword">*</span>BRAS1-LoopBack0] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-LoopBack0] <strong>quit</strong></pre>
</p><p><p># Configure an IP address for the protection tunnel interface.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>interface LoopBack1</strong>
[<span class="keyword">*</span>BRAS1-LoopBack1] <strong>ip address 10.3.3.3 32</strong>
[<span class="keyword">*</span>BRAS1-LoopBack1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-LoopBack1] <strong>quit</strong></pre>
</p></li><li><span>Configure BFD sessions and VRRP on the access side of the master and backup BRASs. BRAS1 is the master, and BRAS2 is the backup.</span><p><p># Configure a BFD session on the access side to allow the device to rapidly detect interface or link faults and trigger a master/backup VRRP switchover upon such a fault.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>bfd</strong>
[<span class="keyword">*</span>BRAS1-bfd] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1] <strong>bfd bfd1 bind peer-ip 192.168.1.2</strong>
[<span class="keyword">*</span>BRAS1-bfd-session-bfd1] <strong>discriminator local 8</strong>
[<span class="keyword">*</span>BRAS1-bfd-session-bfd1] <strong>discriminator remote 6</strong>
[<span class="keyword">*</span>BRAS1-bfd-session-bfd1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-bfd-session-bfd1] <strong>quit</strong></pre>
</p><p><p># Configure a VRRP group on an interface (GE<span>0/1/0</span>.1 is used as an example), and configure VRRP to track the BFD session and network-side interface status.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>interface GigabitEthernet<span>0/1/0</span></strong><strong>.1</strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/0</span>.1] <strong>vlan-type dot1q 400</strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/0</span>.1]<strong> ip address </strong><strong>192.168.1.1</strong><strong> 255.255.255.0</strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/0</span>.1] <strong>vrrp vrid 1 virtual-ip </strong><strong>192.168.1.1</strong><strong>00</strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/0</span>.1] <strong>vrrp vrid 1 priority 120</strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/0</span>.1]<strong> vrrp vrid 1 preempt-mode timer delay 60</strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/0</span>.1]<strong> vrrp vrid 1 track interface GigabitEthernet <span>0/2/0</span> reduced 50</strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/0</span>.1]<strong> </strong><strong>vrrp vrid 1 track bfd-session session-name bfd1 link</strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/0</span>.1]<strong> </strong><strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-GigabitEthernet<span>0/1/0</span>.1] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>vrrp recover-delay 60</strong>
[<span class="keyword">*</span>BRAS1]<strong> </strong><strong>commit</strong></pre>
</p></li><li><span>Configure an RBS and an RBP.</span><p><p># Configure an RBS.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>remote-backup-service s1</strong>
[<span class="keyword">*</span>BRAS1-rm-backup-srv-s1] <strong>peer 10.5.5.5 source 10.3.3.3 port 11000</strong>
[<span class="keyword">*</span>BRAS1-rm-backup-srv-s1] <strong>track interface GigabitEthernet</strong><strong><span>0/1/0</span></strong>
[<span class="keyword">*</span>BRAS1-rm-backup-srv-s1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-rm-backup-srv-s1] <strong>protect lsp-tunnel for-all-instance peer-ip 10.5.5.5</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-rm-backup-srv-s1] <strong>quit</strong></pre>
</p><p><p># Configure an RBP.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>remote-backup-profile p1</strong>
[<span class="keyword">*</span>BRAS1-rm-backup-prf-p1] <strong>service-type bras</strong>
[<span class="keyword">*</span>BRAS1-rm-backup-prf-p1] <strong>peer-backup hot</strong>
[<span class="keyword">*</span>BRAS1-rm-backup-prf-p1] <strong>backup-id 1 remote-backup-service s1</strong>
[<span class="keyword">*</span>BRAS1-rm-backup-prf-p1] <strong>vrrp-id 1 interface GigabitEthernet <span>0/1/0</span>.1</strong>
[<span class="keyword">*</span>BRAS1-rm-backup-prf-p1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-rm-backup-prf-p1] <strong>quit</strong></pre>
<p># Bind the RBP to the interface through which users go online.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>interface GigabitEthernet <span>0/1/0</span></strong><strong>.2</strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/0</span>.2] <strong>remote-backup-profile p1</strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/0</span>.2] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-GigabitEthernet<span>0/1/0</span>.2] <strong>quit</strong></pre>
</p></li><li><span>Configure a routing protocol.</span><p><p># Enable the function to automatically control a route's cost preference.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>peer-backup route-cost auto-advertising</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
</p><p><p># Configure MPLS.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>mpls</strong>
[<span class="keyword">*</span>BRAS1-mpls] <strong>mpls ldp</strong>
[<span class="keyword">*</span>BRAS1-mpls-ldp] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-mpls-ldp] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>mpls lsr-id 10.3.3.3</strong>
[<span class="keyword">*</span>BRAS1] <strong>interface GigabitEthernet<span>0/2/0</span></strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/2/0</span>] <strong>mpls</strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/2/0</span>]<strong> mpls ldp</strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/2/0</span>]<strong> </strong><strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-GigabitEthernet<span>0/2/0</span>]<strong> quit</strong></pre>
<p># Configure OSPF to import UNRs.</p>
</p><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>ospf 1</strong>
[<span class="keyword">*</span>BRAS1-ospf-1]<strong> </strong><strong>default cost inherit-metric</strong>
[<span class="keyword">*</span>BRAS1-ospf-1]<strong> </strong><strong>import-route unr</strong>
[<span class="keyword">*</span>BRAS1-ospf-1]<strong> </strong><strong>area 0</strong><strong>.0.0.0</strong>
[<span class="keyword">*</span>BRAS1-ospf-1-area-0.0.0.0]<strong> </strong><strong>network 10.8.8.8 0.0.0.255</strong>
[<span class="keyword">*</span>BRAS1-ospf-1-area-0.0.0.0]<strong> </strong><strong>network 10.3.3.3 0.0.0.0</strong>
[<span class="keyword">*</span>BRAS1-ospf-1-area-0.0.0.0]<strong> </strong><strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-ospf-1-area-0.0.0.0] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-ospf-1] <strong>quit</strong></pre>
</p></li><li><span>Configure an IP address pool for local authentication static users to go online.</span><p><p># Configure an address pool.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1]<strong> ip pool test bas local</strong>
[<span class="keyword">*</span>BRAS1-ip-pool-test] <strong>gateway </strong><strong>172.16.1.1 255.255.0.0</strong>
[<span class="keyword">*</span>BRAS1-ip-pool-test] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-ip-pool-pool] <strong>section 0 172.16.1.2 172.16.1.255</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-ip-pool-test] <strong>excluded-ip-address 172.16.1.2 172.16.1.255</strong>
[<span class="keyword">*</span>BRAS1-ip-pool-test] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-ip-pool-test] <strong>quit</strong></pre>
<p># Configure IPv6 address pools.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1]<strong> </strong><strong>ipv6 prefix pd local</strong>
[<span class="keyword">*</span>BRAS1-ipv6-prefix-pd] <strong>prefix 2001:db8:10::10/48</strong>
[<span class="keyword">*</span>BRAS1-ipv6-prefix-pd] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-ipv6-prefix-pd] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1]<strong> ipv6 pool pd bas local</strong>
[<span class="keyword">*</span>BRAS1-ipv6-pool-pd] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-ipv6-pool-pd] <strong>prefix </strong><strong>pd</strong>
[<span class="keyword">*</span>BRAS1-ipv6-pool-pd] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-ipv6-pool-pd] <strong>quit</strong></pre>
<p># Bind the RBS to the address pool.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1]<strong> </strong><strong>remote-backup-service s1</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-rm-backup-srv-s1]<strong> ip-pool test </strong>
[<span class="keyword">*</span>BRAS1-rm-backup-srv-s1]<strong> </strong><strong>ipv6-pool pd </strong>
[<span class="keyword">*</span>BRAS1-rm-backup-srv-s1]<strong> </strong><strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-rm-backup-srv-s1]<strong> </strong><strong>quit</strong></pre>
</p></li><li><span>Configure AAA schemes.</span><ol type="a"><li class="substepexpand"><span>Configure an authentication scheme.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1]<strong> aaa</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa]<strong> authentication-scheme auth1</strong>
[<span class="keyword">*</span>BRAS1-aaa-authen-auth1]<strong> authentication-mode radius</strong>
[<span class="keyword">*</span>BRAS1-aaa-authen-auth1]<strong> commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa-authen-auth1]<strong> quit</strong></pre>
</p></li><li class="substepexpand"><span>Configure an accounting scheme.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa]<strong> accounting-scheme acct1</strong>
[<span class="keyword">*</span>BRAS1-aaa-accounting-acct1]<strong> accounting-mode radius</strong>
[<span class="keyword">*</span>BRAS1-aaa-accounting-radius]<strong> commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa-accounting-radius]<strong> quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa]<strong> quit</strong></pre>
</p></li></ol>
</li><li><span>Configure a RADIUS server group.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1]<strong> radius-server group rd1</strong>
[<span class="keyword">*</span>BRAS1-radius-rd1]<strong> radius-server authentication 192.168.7.249 1645</strong>
[<span class="keyword">*</span>BRAS1-radius-rd1]<strong> radius-server accounting 192.168.7.249 1646</strong>
[<span class="keyword">*</span>BRAS1-radius-rd1]<strong> radius-server shared-key-cipher YsHsjx_202206 </strong>
[<span class="keyword">*</span>BRAS1-radius-rd1]<strong> radius-server source interface LoopBack0</strong>
[<span class="keyword">*</span>BRAS1-radius-rd1]<strong> </strong><strong>radius-server calling-station-id include mac </strong>
[<span class="keyword">*</span>BRAS1-radius-rd1]<strong> commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1]<strong> quit</strong></pre>
</p></li><li><span>Configure a domain.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>aaa</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa] <strong>domain test</strong>
[<span class="keyword">*</span>BRAS1-aaa-domain-test] <strong>authentication-scheme auth1</strong>
[<span class="keyword">*</span>BRAS1-aaa-domain-test] <strong>accounting-scheme acct1</strong>
[<span class="keyword">*</span>BRAS1-aaa-domain-test] <strong>radius-server group rd1</strong>
[<span class="keyword">*</span>BRAS1-aaa-domain-test] <strong>prefix-assign-mode unshared</strong>
[<span class="keyword">*</span>BRAS1-aaa-domain-test] <strong>ip-pool test</strong>
[<span class="keyword">*</span>BRAS1-aaa-domain-test] <strong>ipv6-pool pd</strong>
[<span class="keyword">*</span>BRAS1-aaa-domain-test] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa-domain-test] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa] <strong>quit</strong></pre>
</p></li><li><span>Configure the DHCPv6 device to generate DUIDs in DUID-LLT mode.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>dhcpv6 duid llt</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
</p></li><li><span>Configure a BAS interface.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>interface GigabitEthernet <span>0/1/0</span>.2</strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/0</span>.2] <strong>ipv6 enable</strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/0</span>.2] <strong>ipv6 address auto link-local</strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/0</span>.2] <strong>commit</strong>  
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-GigabitEthernet<span>0/1/0</span>.2] <strong>user-vlan 5   </strong>                                      
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/0</span>.2-user-vlan-5] <strong>commit</strong>  
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-GigabitEthernet<span>0/1/0</span>.2-user-vlan-5] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-GigabitEthernet<span>0/1/0</span>.2] <strong>bas</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-GigabitEthernet<span>0/1/0</span>.2-bas] <strong>access-type layer2-subscriber default-domain authentication test</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-GigabitEthernet<span>0/1/0</span>.2-bas] <strong>client-option82</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-GigabitEthernet<span>0/1/0</span>.2-bas]<strong> authentication-method bind</strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/0</span>.2-bas] <strong>authentication-method-ipv6 bind</strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/0</span>.2-bas] <strong>ip-trigger</strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/0</span>.2-bas] <strong>arp-trigger</strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/0</span>.2-bas] <strong>ipv6-trigger</strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/0</span>.2-bas] <strong>nd-trigger</strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/0</span>.2-bas] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-GigabitEthernet<span>0/1/0</span>.2-bas] <strong>quit</strong></pre>
</p></li><li><span>Configure a static user. The VLAN configured here must be within the VLAN range configured for the BAS interface.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>static-user 172.16.1.2 172.16.1.255 gateway 172.16.1.1 2001:db8:1::1 2001:db8:1::2 ipv6-gateway 2001:db8:1:: interface GigabitEthernet<span>0/1/0</span>.2 vlan 5 domain-name test detect</strong></pre>
</p></li><li id="EN-US_TASK_0000001166370811__step1084716425811"><span id="EN-US_TASK_0000001166370811__cmd1584711412581">Configure the CGN service.</span><p><p id="EN-US_TASK_0000001166370811__p157321023012"># Enable the HA hot backup function.</p>
</p><p><pre class="screen" id="EN-US_TASK_0000001166370811__screen2847041586">[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword118483420588"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong id="EN-US_TASK_0000001166370811__b951811314017">service-ha hot-backup enable</strong>
[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword1874297906214109">*</span>BRAS1] <strong id="EN-US_TASK_0000001166370811__b1882501594214109">commit</strong></pre>
<p id="EN-US_TASK_0000001166370811__p137441510114"># Set the number of session table resources to 6M for CPU 3 on the NAT service board.</p>
<pre class="screen" id="EN-US_TASK_0000001166370811__screen089630414">[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword88915304114"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong id="EN-US_TASK_0000001166370811__b1423513710114">license</strong>
[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword18249134712114"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-license] <strong id="EN-US_TASK_0000001166370811__b199673581617">active nat session-table size 6 slot 3 engine 0</strong>
[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword1882913140215">*</span>BRAS1-license] <strong id="EN-US_TASK_0000001166370811__b544210119317">active nat bandwidth-enhance slot 3 engine 0</strong>
[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword599112191220">*</span>BRAS1-license] <strong id="EN-US_TASK_0000001166370811__b7290541310">commit</strong>
[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword156141837129"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-license] <strong id="EN-US_TASK_0000001166370811__b7874178437">quit</strong></pre>
<p id="EN-US_TASK_0000001166370811__p192074118411"># Create service location group 1, configure CPU 0 in slot 3 as a member for dual-device inter-chassis backup, and set the VRRP outbound interface of the local device to GigabitEthernet <span>0/3/0</span> and the peer IP address to 10.1.1.2.</p>
<pre class="screen" id="EN-US_TASK_0000001166370811__screen0251201081114">[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword16517219151110"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong id="EN-US_TASK_0000001166370811__b155031227121116">service-location 1</strong> 
[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword464003912115">*</span>BRAS1-service-location-1] <strong id="EN-US_TASK_0000001166370811__b6957155111119">location slot 3 engine 0</strong>
[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword195932597112">*</span>BRAS1-service-location-1] <strong id="EN-US_TASK_0000001166370811__b41788456124">remote-backup interface GigabitEthernet <span>0/3/0</span> peer 10.1.1.2</strong>
[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword10820152411125">*</span>BRAS1-service-location-1] <strong id="EN-US_TASK_0000001166370811__b99951441111220">commit</strong>
[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword1641053251218"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-service-location-1] <strong id="EN-US_TASK_0000001166370811__b4498137131210">quit</strong></pre>
<p id="EN-US_TASK_0000001166370811__p21339612138"># Enter the GE<span>0/3/0</span> interface view, create VRRP group 2, set the virtual IP address of the VRRP group to 10.1.1.3, and configure the VRRP group as an mVRRP backup group.</p>
<pre class="screen" id="EN-US_TASK_0000001166370811__screen1229945121619">[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword125891141710"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong id="EN-US_TASK_0000001166370811__b131332765215">interface GigabitEthernet <span>0/3/0</span></strong>
[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword91981414161718"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-GigabitEthernet<span>0/3/0</span>] <strong id="EN-US_TASK_0000001166370811__b917118121918">ip address 10.1.1.1 24</strong>
[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword413915447187"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-GigabitEthernet<span>0/3/0</span>] <strong id="EN-US_TASK_0000001166370811__b1096513911911">vrrp vrid 2 virtual-ip 10.1.1.3</strong>
[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword738314109202">*</span>BRAS1-GigabitEthernet<span>0/3/0</span>] <strong id="EN-US_TASK_0000001166370811__b898445316197">admin-vrrp vrid 2 ignore-if-down</strong>
[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword15539145913213">*</span>BRAS1-GigabitEthernet<span>0/3/0</span>] <strong id="EN-US_TASK_0000001166370811__b7669198202218">vrrp vrid 2 priority 200</strong>
[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword3574140142212">*</span>BRAS1-GigabitEthernet<span>0/3/0</span>] <strong id="EN-US_TASK_0000001166370811__b1192231422218">vrrp vrid 2 preempt-mode timer delay 400</strong>
[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword127917115222">*</span>BRAS1-GigabitEthernet<span>0/3/0</span>] <strong id="EN-US_TASK_0000001166370811__b0207122062216">vrrp recover-delay 15</strong>
[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword116411027182219">*</span>BRAS1-GigabitEthernet<span>0/3/0</span>] <strong id="EN-US_TASK_0000001166370811__b5907143117229">commit</strong>
[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword1035416817261"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-GigabitEthernet<span>0/3/0</span>] <strong id="EN-US_TASK_0000001166370811__b155711188266">quit</strong></pre>
<p id="EN-US_TASK_0000001166370811__p1115192512316"># Associate HA with VRRP on the direct-connect interfaces on the active and standby devices.</p>
<pre class="screen" id="EN-US_TASK_0000001166370811__screen659416547234">[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword9210125285620"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong id="EN-US_TASK_0000001166370811__b9783170205715">interface GigabitEthernet <span>0/3/0</span></strong>
[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword187111055135618"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-GigabitEthernet<span>0/3/0</span>] <strong id="EN-US_TASK_0000001166370811__b1949936573">vrrp vrid 2 track service-location 1 reduced 60</strong>
[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword175601482569">*</span>BRAS1-GigabitEthernet<span>0/3/0</span>] <strong id="EN-US_TASK_0000001166370811__b95601445575">commit</strong>
[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword14309155385613"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-GigabitEthernet<span>0/3/0</span>] <strong id="EN-US_TASK_0000001166370811__b65038519573">quit</strong></pre>
<p id="EN-US_TASK_0000001166370811__p1194919914456"># Bind the service location group to the VRRP group on both the active and standby devices.</p>
<pre class="screen" id="EN-US_TASK_0000001166370811__screen1079973484515">[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword96331320152613"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong id="EN-US_TASK_0000001166370811__b1224661612286">service-location 1</strong>
[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword2659151813277">*</span>BRAS1-service-location-1] <strong id="EN-US_TASK_0000001166370811__b124441729162820">vrrp vrid 2 interface GigabitEthernet </strong><strong id="EN-US_TASK_0000001166370811__b1064082612286"><span>0/3/0</span></strong>
[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword05011219192719">*</span>BRAS1-service-location-1] <strong id="EN-US_TASK_0000001166370811__b932313322281">commit</strong>
[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword2463232262"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-service-location-1] <strong id="EN-US_TASK_0000001166370811__b782873362812">quit</strong></pre>
<p id="EN-US_TASK_0000001166370811__p1014912384454"># Create a service instance group and bind it to the service location group.</p>
<pre class="screen" id="EN-US_TASK_0000001166370811__screen1548922894919">[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword14428192517261"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong id="EN-US_TASK_0000001166370811__b77951508362">service-instance-group group1</strong>
[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword91531222192712">*</span>BRAS1-service-instance-group-group1] <strong id="EN-US_TASK_0000001166370811__b01231630366">service-location 1</strong>
[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword108622592716">*</span>BRAS1-service-instance-group-group1] <strong id="EN-US_TASK_0000001166370811__b310081223612">remote-backup-service s1</strong>
[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword4584202742716">*</span>BRAS1-service-instance-group-group1] <strong id="EN-US_TASK_0000001166370811__b066221523611">commit</strong>
[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword885715274264"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-service-instance-group-group1] <strong id="EN-US_TASK_0000001166370811__b13663916133615">quit</strong></pre>
<p id="EN-US_TASK_0000001166370811__p7198519534"># Create a NAT instance on both the active and standby devices and bind it to the service instance group and NAT address pool.</p>
<pre class="screen" id="EN-US_TASK_0000001166370811__screen17814153135412">[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword456103012614"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong id="EN-US_TASK_0000001166370811__b187081329103718">nat instance nat id 1</strong>
[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword1874952913278">*</span>BRAS1-nat-instance-nat] <strong id="EN-US_TASK_0000001166370811__b16418162753711">service-instance-group group1</strong>
[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword1175333015277">*</span>BRAS1-nat-instance-nat] <strong id="EN-US_TASK_0000001166370811__b5220254374">nat address-group group1 group-id 1 10.11.11.100 10.11.11.105</strong>
[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword20893183119274">*</span>BRAS1-nat-instance-nat] <strong id="EN-US_TASK_0000001166370811__b3118132213710">nat outbound any address-group group1</strong>
[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword365714376370">*</span>BRAS1-nat-instance-nat] <strong id="EN-US_TASK_0000001166370811__b19773191917375">nat alg all</strong>
[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword053943993714">*</span>BRAS1-nat-instance-nat] <strong id="EN-US_TASK_0000001166370811__b9892145710361">nat filter mode full-cone</strong>
[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword16423113615273">*</span>BRAS1-nat-instance-nat] <strong id="EN-US_TASK_0000001166370811__b21408537360">commit</strong>
[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword138723672612"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-nat-instance-nat] <strong id="EN-US_TASK_0000001166370811__b6947448103610">quit</strong></pre>
<p id="EN-US_TASK_0000001166370811__p731003625413"># Configure a user group named <strong id="EN-US_TASK_0000001166370811__b1329113293539">natbras</strong>.</p>
<pre class="screen" id="EN-US_TASK_0000001166370811__screen1717918421545">[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword1855413387265"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong id="EN-US_TASK_0000001166370811__b968674411373">user-group natbras</strong>
[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword5426138102716">*</span>BRAS1] <strong id="EN-US_TASK_0000001166370811__b7759114533711">commit</strong></pre>
<p id="EN-US_TASK_0000001166370811__p18514158205515"># Bind the NAT instance to the domain.</p>
<pre class="screen" id="EN-US_TASK_0000001166370811__screen4322181820559">[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword0439184092614"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong id="EN-US_TASK_0000001166370811__b15449173375517">aaa</strong>
[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword10524194192613"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa] <strong id="EN-US_TASK_0000001166370811__b344993365510">domain test</strong>
[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword20326940192712">*</span>BRAS1-aaa-domain-test] <strong id="EN-US_TASK_0000001166370811__b1449633175510">user-group natbras bind nat instance nat</strong>
[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword84419414272">*</span>BRAS1-aaa-domain-test] <strong id="EN-US_TASK_0000001166370811__b1644953315518">quit</strong>
[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword1461534272718">*</span>BRAS1-aaa] <strong id="EN-US_TASK_0000001166370811__b1444943385516">commit</strong>
[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword7147114320267"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa] <strong id="EN-US_TASK_0000001166370811__b13449103355517">quit</strong></pre>
<p id="EN-US_TASK_0000001166370811__p038771517216"># Configure a NAT translation policy, including the traffic classification rule, NAT action, and NAT traffic policy, and apply the NAT traffic policy.</p>
<ol type="a" id="EN-US_TASK_0000001166370811__ol181401219849"><li id="EN-US_TASK_0000001166370811__li171401919242">Configure an ACL numbered 6001 and an ACL rule numbered 1.<pre class="screen" id="EN-US_TASK_0000001166370811__screen1996012281568">[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword192765450266"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong id="EN-US_TASK_0000001166370811__b52030521372">acl 6001</strong>
[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword673204510278">*</span>BRAS1-ucl-6001] <strong id="EN-US_TASK_0000001166370811__b14808115343714">rule 1 permit ip source user-group natbras</strong>
[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword0179174614272">*</span>BRAS1-ucl-6001] <strong id="EN-US_TASK_0000001166370811__b3221655103714">commit</strong>
[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword1270913469267"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-ucl-6001] <strong id="EN-US_TASK_0000001166370811__b1157210569374">quit</strong></pre>
</li><li id="EN-US_TASK_0000001166370811__li15911471966">Configure a traffic classifier.<pre class="screen" id="EN-US_TASK_0000001166370811__screen72374363616">[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword1281915484266"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong id="EN-US_TASK_0000001166370811__b8773165815379">traffic classifier c1</strong>
[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword722919493277">*</span>BRAS1-classifier-c1] <strong id="EN-US_TASK_0000001166370811__b112621501380">if-match acl 6001</strong>
[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword1143310506270">*</span>BRAS1-classifier-c1] <strong id="EN-US_TASK_0000001166370811__b15448141193816">commit</strong>
[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword12351750142619"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-classifier-c1] <strong id="EN-US_TASK_0000001166370811__b0652756388">quit</strong></pre>
</li><li id="EN-US_TASK_0000001166370811__li041419131963">Configure a traffic behavior.<pre class="screen" id="EN-US_TASK_0000001166370811__screen2054120385818">[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword41491951172615"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong id="EN-US_TASK_0000001166370811__b92243853817">traffic behavior b1 </strong>
[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword17858852132713">*</span>BRAS1-behavior-b1] <strong id="EN-US_TASK_0000001166370811__b1510741017389">nat bind instance nat</strong>
[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword372013540279">*</span>BRAS1-behavior-b1] <strong id="EN-US_TASK_0000001166370811__b1157121153819">commit</strong>
[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword28512532267"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-behavior-b1] <strong id="EN-US_TASK_0000001166370811__b14366111210385">quit</strong></pre>
</li><li id="EN-US_TASK_0000001166370811__li1759285121015">Define a NAT traffic policy and associate the traffic classifier with the traffic behavior.<pre class="screen" id="EN-US_TASK_0000001166370811__screen119912313109">[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword1773154172612"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong id="EN-US_TASK_0000001166370811__b209041415143811">traffic policy p1</strong>
[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword63331856202711">*</span>BRAS1-trafficpolicy-p1] <strong id="EN-US_TASK_0000001166370811__b794418193816">classifier c1 behavior b1</strong>
[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword2030425842716">*</span>BRAS1-trafficpolicy-p1] <strong id="EN-US_TASK_0000001166370811__b1329162218386">commit</strong>
[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword111403564264"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-trafficpolicy-p1] <strong id="EN-US_TASK_0000001166370811__b121391023183817">quit</strong></pre>
</li><li id="EN-US_TASK_0000001166370811__li156653295128">Apply the NAT traffic diversion policy in the system view.<pre class="screen" id="EN-US_TASK_0000001166370811__screen710414416124">[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword144271658112613"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong id="EN-US_TASK_0000001166370811__b1569810494122">tra</strong><strong id="EN-US_TASK_0000001166370811__b453122653818">ffic-policy p1 inbound</strong>
[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword1763015022817">*</span>BRAS1] <strong id="EN-US_TASK_0000001166370811__b320172712384">comm</strong><strong id="EN-US_TASK_0000001166370811__b14698549121211">it</strong></pre>
</li><li id="EN-US_TASK_0000001166370811__li1447454613224">Configure the NAT address pool route as a static route, specify NULL0 as the outbound interface, and advertise the route to a routing protocol.<pre class="screen" id="EN-US_TASK_0000001166370811__screen19636210231">[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword7965059192619"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong id="EN-US_TASK_0000001166370811__b7435152983818">ip route-static 10.11.11.0 27 null 0</strong>
[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword173012232815">*</span>BRAS1] <strong id="EN-US_TASK_0000001166370811__b16701331133810">commit</strong>
[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword977011712718"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-ospf-1] <strong id="EN-US_TASK_0000001166370811__b1612073516388">ospf 1</strong>
[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword75763315274"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-ospf-1] <strong id="EN-US_TASK_0000001166370811__b19741536203814">import-route static</strong>
[<span class="keyword" id="EN-US_TASK_0000001166370811__keyword182169202716"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-ospf-1] <strong id="EN-US_TASK_0000001166370811__b63711038113811">quit</strong></pre>
</li></ol>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001166370811__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>BRAS1 configuration file</p>
<pre class="screen">#
sysname BRAS1
#
vrrp recover-delay 60
#
radius-server group rd1
 radius-server shared-key-cipher %^%#b-SAV,j)4#)Ez2TokT,%2z'sNM<font style="font-size:8pt" Face="Courier New" >~</font>0@4h<font style="font-size:8pt" Face="Courier New" >~</font>G.KsQhz)%^%#
 radius-server authentication 192.168.7.249 1645 weight 0
 radius-server accounting 192.168.7.249 1646 weight 0
 radius-server source interface LoopBack0
 radius-server calling-station-id include mac 
#
service-ha hot-backup enable
#
service-location 1
 location slot 3 engine 0
 remote-backup interface GigabitEthernet<span>0/3/0</span> peer 10.1.1.2
 vrrp vrid 2 interface GigabitEthernet<span>0/3/0</span>
#
service-instance-group group1
 service-location 1
 remote-backup-service s1
#
nat instance nat id 1
 service-instance-group group1
 nat address-group group1 group-id 1 10.11.11.100 10.11.11.105 
 nat outbound any address-group group1
 nat alg all
 nat filter mode full-cone
#
bfd
#
mpls lsr-id 10.3.3.3
#
mpls
#
mpls ldp
 #
 ipv4-family
#
ip pool test bas local
 gateway 172.16.1.1 255.255.0.0
 section 0 172.16.1.2 172.16.1.255
 excluded-ip-address 172.16.1.2 172.16.1.255
#
ipv6 prefix pd local
 prefix 2001:db8:10::10/128
#
ipv6 pool pd bas local
 prefix pd
#
user-group natbras
#
remote-backup-service s1
 peer 10.5.5.5 source 10.3.3.3 port 11000
 track interface GigabitEthernet<strong><span>0/1/0</span></strong>
 protect lsp-tunnel for-all-instance peer-ip 10.5.5.5
 ip-pool test metric 10
 ipv6-pool pd metric 10
#
remote-backup-profile p1
 service-type bras
 backup-id 1 remote-backup-service s1
 peer-backup hot
 vrrp-id 1 interface GigabitEthernet<span>0/1/0</span>.1
#
acl number 6001
 rule 1 permit ip source user-group natbras
#
dhcpv6 duid 00010001280ef7a400e0fc904b50
#
traffic classifier c1 operator or
 if-match acl 6001 precedence 1
#
traffic behavior b1
 nat bind instance nat
#
traffic policy p1
 share-mode
 classifier c1 behavior b1 precedence 1
#
aaa
 #
 authentication-scheme auth1
 #
 accounting-scheme acct1
 #
 domain test
  authentication-scheme auth1
  accounting-scheme acct1
  radius-server group rd1
  prefix-assign-mode unshared
  ip-pool test
  ipv6-pool pd
  user-group natbras bind nat instance nat
#
license
 active nat session-table size 6 slot 3 engine 0
 active nat bandwidth-enhance slot 3 engine 0
#
interface Virtual-Template1
 ppp authentication-mode chap
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ipv6 enable
 ip address 10.0.0.1 255.255.255.0
 ipv6 address 2001:db8:1::1/120
 ipv6 address auto link-local
 mpls
 mpls ldp
 dcn
#
interface GigabitEthernet<span>0/3/0</span>
 undo shutdown
 ip address 10.1.1.1 255.255.255.0
 vrrp vrid 2 virtual-ip 10.1.1.3
 admin-vrrp vrid 2 ignore-if-down
 vrrp vrid 2 priority 200
 vrrp vrid 2 preempt-mode timer delay 400
 vrrp vrid 2 track service-location 1 reduced 60
 vrrp recover-delay 15
 dcn
#
interface GigabitEthernet<span>0/1/0</span>.1
 vlan-type dot1q 400
 ip address 192.168.1.1 255.255.255.0
 vrrp vrid 1 virtual-ip 192.168.1.100
 vrrp vrid 1 priority 120
 vrrp vrid 1 preempt-mode timer delay 60
 vrrp vrid 1 track interface GigabitEthernet<span>0/2/0</span> reduced 50
 vrrp vrid 1 track bfd-session session-name bfd1 link
#
interface GigabitEthernet<span>0/1/0</span>.2
 ipv6 enable
 ipv6 address auto link-local
 statistic enable
 user-vlan 5
 remote-backup-profile p1
 bas
 #
 access-type layer2-subscriber default-domain authentication test
  client-option82
  authentication-method bind
  authentication-method-ipv6 bind
  ip-trigger
  arp-trigger
  ipv6-trigger
  nd-trigger
#
static-user 172.16.1.2 172.16.1.255 gateway 172.16.1.1 2001:db8:1::1 2001:db8:1::2 ipv6-gateway 2001:db8:1:: interface GigabitEthernet<span>0/1/0</span>.2 vlan 5 domain-name test detect
#
interface LoopBack0
 ip address 10.2.2.2 255.255.255.255
#
interface LoopBack1
 ip address 10.3.3.3 255.255.255.255
#
interface NULL0
#
bfd bfd1 bind peer-ip 192.168.1.2
 discriminator local 8
 discriminator remote 6
#
ospf 1
 default cost inherit-metric
 import-route static
 import-route unr
 area 0.0.0.0
  network 10.8.8.8 0.0.0.255
  network 10.3.3.3 0.0.0.0
#
ip route-static 10.11.11.0 255.255.255.224 NULL0
#
peer-backup route-cost auto-advertising 
#
traffic-policy p1 inbound
#
return</pre>
</li><li><p>BRAS2 configuration file</p>
<pre class="screen">#
sysname BRAS2
#
vrrp recover-delay 60
#
radius-server group rd1
 radius-server shared-key-cipher %^%#b-SAV,j)4#)Ez2TokT,%2z'sNM<font style="font-size:8pt" Face="Courier New" >~</font>0@4h<font style="font-size:8pt" Face="Courier New" >~</font>G.KsQhz)%^%#
 radius-server authentication 192.168.7.249 1645 weight 0
 radius-server accounting 192.168.7.249 1646 weight 0
 radius-server source interface LoopBack0
 radius-server calling-station-id include mac 
#
service-ha hot-backup enable
#
service-location 1
 location slot 3 engine 0
 remote-backup interface GigabitEthernet<span>0/3/0</span> peer 10.1.1.1
 vrrp vrid 2 interface GigabitEthernet<span>0/3/0</span>
#
service-instance-group group1
 service-location 1
 remote-backup-service s1
#
nat instance nat id 1
 service-instance-group group1
 nat address-group group1 group-id 1 10.11.11.100 10.11.11.105 
 nat outbound any address-group group1
 nat alg all
 nat filter mode full-cone
#
bfd
#
mpls lsr-id 10.3.3.3
#
mpls
#
mpls ldp
 #
 ipv4-family
#
ip pool test bas local rui-slave
 gateway 172.16.1.1 255.255.0.0
 section 0 172.16.1.2 172.16.1.255
 excluded-ip-address 172.16.1.2 172.16.1.255
#
ipv6 prefix pd local
 prefix 2001:db8:10::10/128
#
ipv6 pool pd bas local
 prefix pd
#
user-group natbras
#
remote-backup-service s1
 peer 10.3.3.3source 10.5.5.5 port 11000
 track interface GigabitEthernet<strong><span>0/1/0</span></strong>
 protect lsp-tunnel for-all-instance peer-ip 10.3.3.3
 ip-pool test metric 20
 ipv6-pool pd metric 20
#
remote-backup-profile p1
 service-type bras
 backup-id 1 remote-backup-service s1
 peer-backup hot
 vrrp-id 1 interface GigabitEthernet<span>0/1/0</span>.1
#
acl number 6001
 rule 1 permit ip source user-group natbras
#
dhcpv6 duid 00010001280ef7a400e0fc904b50
#
traffic classifier c1 operator or
 if-match acl 6001 precedence 1
#
traffic behavior b1
 nat bind instance nat
#
traffic policy p1
 share-mode
 classifier c1 behavior b1 precedence 1
#
aaa
 #
 authentication-scheme auth1
 #
 accounting-scheme acct1
 #
 domain test
  authentication-scheme auth1
  accounting-scheme acct1
  radius-server group rd1
  prefix-assign-mode unshared
  ip-pool test
  ipv6-pool pd
  user-group natbras bind nat instance nat
#
license
 active nat session-table size 6 slot 3 engine 0
 active nat bandwidth-enhance slot 3 engine 0
#
interface Virtual-Template1
 ppp authentication-mode chap
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ipv6 enable
 ip address 10.0.0.2 255.255.255.0
 ipv6 address 2001:db8:2::1/120
 ipv6 address auto link-local
 mpls
 mpls ldp
 dcn
#
interface GigabitEthernet<span>0/3/0</span>
 undo shutdown
 ip address 10.1.1.2 255.255.255.0
 vrrp vrid 2 virtual-ip 10.1.1.3
 admin-vrrp vrid 2 ignore-if-down
 vrrp vrid 2 priority 150
 vrrp vrid 2 track service-location 1 reduced 60
 vrrp recover-delay 15
 dcn
#
interface GigabitEthernet<span>0/1/0</span>.1
 vlan-type dot1q 400
 ip address 192.168.1.2 255.255.255.0
 vrrp vrid 1 virtual-ip 192.168.1.100
 vrrp vrid 1 priority 100
 vrrp vrid 1 preempt-mode timer delay 60
 vrrp vrid 1 track interface GigabitEthernet<span>0/2/0</span> reduced 50
 vrrp vrid 1 track bfd-session session-name bfd1 link
#
interface GigabitEthernet<span>0/1/0</span>.2
 ipv6 enable
 ipv6 address auto link-local
 statistic enable
 user-vlan 5
 remote-backup-profile p1
 bas
 #
 access-type layer2-subscriber default-domain authentication test
  client-option82
  authentication-method bind
  authentication-method-ipv6 bind
  ip-trigger
  arp-trigger
  ipv6-trigger
  nd-trigger
#
static-user 172.16.1.2 172.16.1.255 gateway 172.16.1.1 2001:db8:1::1 2001:db8:1::2 ipv6-gateway 2001:db8:1:: interface GigabitEthernet<span>0/1/0</span>.2 vlan 5 domain-name test detect
#
interface LoopBack0
 ip address 10.4.4.4 255.255.255.255
#
interface LoopBack1
 ip address 10.3.3.3 255.255.255.255
#
interface NULL0
#
bfd bfd1 bind peer-ip 192.168.1.1
 discriminator local 6
 discriminator remote 8
#
ospf 1
 default cost inherit-metric
 import-route static
 import-route unr
 area 0.0.0.0
  network 10.9.9.9 0.0.0.255
  network 10.5.5.5 0.0.0.0
#
ip route-static 10.11.11.0 255.255.255.224 NULL0
#
peer-backup route-cost auto-advertising 
#
traffic-policy p1 inbound
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cfg_rui_0050.html">Configuration Examples
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cfg_rui_1003.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cfg_rui_00632.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>