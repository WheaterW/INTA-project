
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring BRAS Access Through L3VPN Termination">
<meta name="abstract" content="This section provides an example for configuring BRAS access through L3VPN termination.">
<meta name="description" content="This section provides an example for configuring BRAS access through L3VPN termination.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_ipox_cfg_0083.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cfg_014578.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cfg_013594.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="z50024784,z00603461,w00800033,z00588052,ipoxne,c00549182,w00556928,l00593348,w00606909,w00447999,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="IPoE">
<meta name="featuretype" content="User Access">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="IPoE">
<meta name="featuretype" content="User Access">
<meta name="featurename" content="IPoE">
<meta name="featuretype" content="User Access">
<meta name="featurename" content="IPoE">
<meta name="featuretype" content="User Access">
<meta name="OWNER" content="c00549182">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="z00588052">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_CONCEPT_0172374044">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring BRAS Access Through L3VPN Termination</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_CONCEPT_0172374044"></a><a name="EN-US_CONCEPT_0172374044"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring BRAS Access Through L3VPN Termination</h1>
<div><p>This section provides an example for configuring BRAS access through L3VPN termination.</p>
<div class="section"><h4 class="sectiontitle">Networking Requirements</h4><div class="p">DeviceB uses OSPF to exchange traffic with DeviceA through interfaces on multiple boards in load balancing mode. Traffic from the same user may be sent from different boards. DeviceB uses policy-based routing (PBR) to send traffic from the same user but different boards through the backplane to the same board for Layer 3 user authentication, as shown in <a href="#EN-US_CONCEPT_0172374044__fig_dc_ne_cfg_01457801">Figure 1</a>.<ul><li>DeviceA sends upstream traffic to different interfaces on DeviceB in load balancing mode.</li><li><p>DeviceB adds all the inbound interfaces to an L3VPN and configures PBR. Then, DeviceB routes all traffic from the same user to the specified next hop based on the source IP address/VLAN ID/DSCP value. The outbound interface of the next hop directly connects to the BAS interface and resides on the same network segment as the BAS interface.</p>
</li><li><p>After user traffic arrives at the BAS interface on DeviceB and the users go online, user forwarding entries are delivered. Subsequent user traffic will then be verified and forwarded based on these forwarding entries.</p>
</li><li><p>Downstream user traffic is forwarded through the BAS interface on DeviceB to the L3VPN domain based on user forwarding entries.</p>
</li><li><p>DeviceB then sends downstream traffic in the L3VPN domain to DeviceA based on routes (the traffic can be balanced). Then, DeviceA forwards the traffic to the users.</p>
</li></ul>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Only Layer 3 static user access is supported in scenarios of BRAS access through L3VPN termination.</p>
<p>In this example, interfaces 1 and 2 represent VE<span>0/1/1</span> and VE<span>0/2/1</span>, respectively.</p>
</div></div>
</div>
<div class="fignone" id="EN-US_CONCEPT_0172374044__fig_dc_ne_cfg_01457801"><a name="EN-US_CONCEPT_0172374044__fig_dc_ne_cfg_01457801"></a><a name="fig_dc_ne_cfg_01457801"></a><span class="figcap"><b>Figure 1 </b>Configuring BRAS access through L3VPN termination</span><br><span><img class="vsd" src="figure/en-us_image_0000001401148414.png" width="NaN" height="NaN"></span></div>
<p></p>
</div>
<div class="section"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li>Configure a local L3VPN.</li><li><p>Configure PBR on DeviceB to redirect user traffic to the primary/backup next hop. If the primary next hop fails, traffic is automatically switched to the backup next hop to trigger user login.</p>
</li><li><p>Configure user access interfaces. (User traffic enters these interfaces, not BAS interfaces.)</p>
</li><li><p>Configure an outbound interface for redirection to a next hop.</p>
</li><li><p>Configure an authentication domain on BAS interfaces.</p>
</li><li><p>Configure BAS interfaces through which users go online.</p>
</li><li>Configure Layer 3 static users.</li></ol>
</div>
<div class="section"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>VE-group number</p>
</li><li><p>Local L3VPN name</p>
</li><li><p>OSPF parameters</p>
</li><li><p>RADIUS authentication mode, RADIUS accounting mode, and authentication domain name used by Layer 3 users</p>
</li><li><p>Interface IP addresses</p>
</li></ul>
</div>
<div class="section"><h4 class="sectiontitle">Configuration Procedure</h4><ol><li><p>Configure a local L3VPN.</p>
<p>Configure a local L3VPN on <span class="keyword">Device</span>B.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt;<strong> system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname <span class="keyword">Device</span>B</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B]<strong> ip vpn-instance access</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-vpn-instance-access]<strong> ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-vpn-instance-access-af-ipv4]<strong> route-distinguisher 200:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-vpn-instance-access-af-ipv4]<strong> vpn-target 111:1 both</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-vpn-instance-access-af-ipv4]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-vpn-instance-access-af-ipv4]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-vpn-instance-access]<strong> quit</strong></pre>
</li><li><p>Configure PBR on DeviceB.</p>
<p># Configure PBR to redirect user traffic to the primary/backup next hop based on the source IP address. If the primary next hop fails, traffic is automatically switched to the backup next hop to trigger user login through the BAS interface.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>acl 3000</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-acl4-advance-3000] <strong>rule permit ip source 192.168.1.1 255.255.255.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-acl4-advance-3000] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>traffic classifier class1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-classifier-class1] <strong>if-match acl 3000</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-classifier-class1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>traffic behavior behavior1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-behavior-behavior1] <strong>redirect ipv4-multinhp nhp 192.168.112.2 vpn access nhp 192.168.223.2 vpn access non-revertive</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-behavior-behavior1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>traffic policy loadbalance</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-trafficpolicy-loadbalance] <strong>share-mode</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-trafficpolicy-loadbalance] <strong>classifier class1 behavior behavior1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-trafficpolicy-loadbalance] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>commit</strong></pre>
</li><li><p>Configure user access interfaces. (User traffic enters these interfaces, not BAS interfaces.)</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>interface GigabitEthernet<span>0/1/3</span>.100</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/3</span>.100] <strong>vlan-type dot1q 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/3</span>.100] <strong>ip binding vpn-instance access</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/3</span>.100] <strong>ip address 192.168.111.1 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/3</span>.100] <strong>traffic-policy loadbalance inbound</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/3</span>.100] <strong>ospf enable 100 area 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/3</span>.100] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>interface GigabitEthernet2/2/7.100</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet2/2/7.100] <strong>vlan-type dot1q 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet2/2/7.100] <strong>ip binding vpn-instance access</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet2/2/7.100] <strong>ip address 192.168.222.1 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet2/2/7.100] <strong>traffic-policy loadbalance inbound</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet2/2/7.100] <strong>ospf enable 100 area 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet2/2/7.100] <strong>quit</strong></pre>
</li><li><p>Configure an outbound interface for redirection to a next hop.</p>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>interface Virtual-Ethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-Virtual-Ethernet<span>0/1/0</span>] <strong>ve-group 1 l3-terminate</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-Virtual-Ethernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>interface Virtual-Ethernet<span>0/1/0</span>.100</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-Virtual-Ethernet<span>0/1/0</span>.100] <strong>vlan-type dot1q 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-Virtual-Ethernet<span>0/1/0</span>.100] <strong>ip address 192.168.112.1 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-Virtual-Ethernet<span>0/1/0</span>.100] <strong>quit</strong></pre>
<p># Configure a backup interface.</p>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>interface Virtual-Ethernet<span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-Virtual-Ethernet<span>0/2/0</span>] <strong>ve-group 2 l3-terminate</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-Virtual-Ethernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>interface Virtual-Ethernet<span>0/2/0</span>.100</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-Virtual-Ethernet<span>0/2/0</span>.100] <strong>vlan-type dot1q 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-Virtual-Ethernet<span>0/2/0</span>.100] <strong>ip address 192.168.223.1 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-Virtual-Ethernet<span>0/2/0</span>.100] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>commit</strong></pre>
</li><li><p>Configure an authentication domain on BAS interfaces.</p>
<p># Configure an authentication scheme.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>aaa</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-aaa] <strong>authentication-scheme auth2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-aaa-authen-auth2] <strong>authentication-mode radius</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-aaa-authen-auth2] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-aaa-authen-auth2] <strong>quit</strong></pre>
<p># Configure an accounting scheme.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-aaa] <strong>accounting-scheme acct2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-aaa-accounting-acct2] <strong>accounting-mode radius</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-aaa-accounting-acct2] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-aaa-accounting-acct2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-aaa] <strong>quit</strong></pre>
<p># Configure a RADIUS server group.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B]<strong> radius-server group rd2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-radius-rd2]<strong> radius-server authentication 192.168.8.249 1812</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-radius-rd2]<strong> radius-server accounting 192.168.8.249 1813</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-radius-rd2]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-radius-rd2]<strong> radius-server type standard</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-radius-rd2]<strong> radius-server shared-key-cipher it-is-my-secret1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-radius-rd2]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-radius-rd2]<strong> quit</strong></pre>
<p># Configure an address pool.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B]<strong> ip pool pool2 bas local</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-ip-pool-pool2]<strong> gateway 10.82.1.1 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-ip-pool-pool2] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-ip-pool-pool2]<strong> section 0 10.82.1.2 10.82.1.200</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-ip-pool-pool2]<strong> dns-server 192.168.8.252</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-ip-pool-pool2] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-ip-pool-pool2] <strong>vpn-instance access</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-ip-pool-pool2]<strong> quit</strong></pre>
<p># Configure a domain.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B]<strong> aaa</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-aaa]<strong> domain fastweb</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-aaa-domain-fastweb]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-aaa-domain-fastweb]<strong> authentication-scheme auth2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-aaa-domain-fastweb]<strong> accounting-scheme acct2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-aaa-domain-fastweb]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-aaa-domain-fastweb]<strong> ip-pool pool2</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-aaa-domain-fastweb]<strong> quit</strong></pre>
</li><li><p>Configure BAS interfaces through which users go online.</p>
<p># Configure a username generation mode and a user password.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-aaa] <strong>default-user-name template fastweb include ip-address .</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-aaa] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-aaa] <strong>default-password </strong><strong>template </strong><strong>fastweb cipher YsHsjx_202206</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-aaa] <strong>quit</strong></pre>
<p># Configure a BAS interface through which users go online.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>interface Virtual-Ethernet<span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-Virtual-Ethernet<span>0/1/1</span>] <strong>ve-group 1 l3-access</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-Virtual-Ethernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>interface Virtual-Ethernet<span>0/1/1</span>.100</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-Virtual-Ethernet<span>0/1/1</span>.100] <strong>vlan-type dot1q 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-Virtual-Ethernet<span>0/1/1</span>.100] <strong>ip binding vpn-instance access</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-Virtual-Ethernet<span>0/1/1</span>.100] <strong>ip address 192.168.112.2 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-Virtual-Ethernet<span>0/1/1</span>.100] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-Virtual-Ethernet<span>0/1/1</span>.100] <strong>bas</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-Virtual-Ethernet<span>0/1/1</span>.100-bas] <strong>access-type layer3-subscriber default-domain authentication fastweb</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-Virtual-Ethernet<span>0/1/1</span>.100-bas] <strong>default-user-name-template fastweb</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-Virtual-Ethernet<span>0/1/1</span>.100-bas] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-Virtual-Ethernet<span>0/1/1</span>.100-bas] <strong>default-password-template fastweb</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-Virtual-Ethernet<span>0/1/1</span>.100-bas] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-Virtual-Ethernet<span>0/1/1</span>.100] <strong>quit</strong></pre>
<p># Configure a backup BAS interface through which users go online.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>interface Virtual-Ethernet<span>0/2/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-Virtual-Ethernet<span>0/2/1</span>] <strong>ve-group 2 l3-access</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-Virtual-Ethernet<span>0/2/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>interface Virtual-Ethernet<span>0/2/1</span>.100</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-Virtual-Ethernet<span>0/2/1</span>.100] <strong>vlan-type dot1q 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-Virtual-Ethernet<span>0/2/1</span>.100] <strong>ip binding vpn-instance access</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-Virtual-Ethernet<span>0/2/1</span>.100] <strong>ip address 192.168.223.2 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-Virtual-Ethernet<span>0/2/1</span>.100] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-Virtual-Ethernet<span>0/2/1</span>.100] <strong>bas</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-Virtual-Ethernet<span>0/2/1</span>.100-bas] <strong>access-type layer3-subscriber default-domain pre-authentication fastweb</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-Virtual-Ethernet<span>0/2/1</span>.100-bas] <strong>default-user-name-template fastweb</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-Virtual-Ethernet<span>0/2/1</span>.100-bas] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-Virtual-Ethernet<span>0/2/1</span>.100-bas] <strong>default-password-template fastweb</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-Virtual-Ethernet<span>0/2/1</span>.100-bas] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-Virtual-Ethernet<span>0/2/1</span>.100] <strong>quit</strong></pre>
</li><li><p>Configure Layer 3 static users.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>layer3-subscriber 192.168.1.1 vpn-instance access domain-name fastweb</strong></pre>
</li></ol>
</div>
<div class="section"><h4 class="sectiontitle">Configuration Files</h4><p>DeviceB configuration file</p>
<pre class="screen">#
sysname <span class="keyword">Device</span>B
#
ip vpn-instance access
 ipv4-family
 route-distinguisher 200:1
 apply-label per-instance
 vpn-target 111:1 export-extcommunity
 vpn-target 111:1 import-extcommunity
#
radius-server group rd2 
 radius-server shared-key-cipher %^%#clY:%[]x='-RMNJus[s/VJ:3YBq3&lt;..|.{'xgbp+%^%#
 radius-server authentication 192.168.8.249 1812 weight 0
 radius-server accounting 192.168.8.249 1813 weight 0
# 
ip pool pool2 bas local
 vpn-instance access
 gateway 10.82.1.1 255.255.255.0 
 section 0 10.82.1.2 10.82.1.200
 dns-server 192.168.8.252
#
acl number 3000
 rule permit source 192.168.1.1 255.255.255.255
#
traffic classifier class1 operator or
 if-match acl 3000 precedence 8
#
traffic behavior behavior1
 redirect ipv4-multinhp nhp 192.168.112.2 vpn access nhp 192.168.223.2 vpn access non-revertive
#
traffic policy loadbalance
 share-mode
 classifier class1 behavior behavior1 precedence 1
#
aaa
 default-password template fastweb cipher %^%#:d"1K5&gt;aICqP6}.%)!#0IngT9sGU-B%6]&gt;H7Ylj%%^%# 
 default-user-name template fastweb include ip-address . 
 #
 authentication-scheme auth2
 #
 accounting-scheme acct2
 #
 domain fastweb
  authentication-scheme auth2
  accounting-scheme acct2
  ip-pool pool2
#
interface GigabitEthernet<span>0/1/3</span>
 undo shutdown
#
interface GigabitEthernet<span>0/1/3</span>.100
 vlan-type dot1q 100
 ip binding vpn-instance access 
 ip address 192.168.111.1 255.255.255.0
 traffic-policy loadbalance inbound
 ospf enable 100 area 0.0.0.0
#
interface GigabitEthernet2/2/7
 undo shutdown
#
interface GigabitEthernet2/2/7.100 
 vlan-type dot1q 100
 ip binding vpn-instance access
 ip address 192.168.222.1 255.255.255.0
 traffic-policy loadbalance inbound
 ospf enable 100 area 0.0.0.0
#
interface Virtual-Ethernet<strong><span>0/1/0</span></strong>
 ve-group 1 l3-terminate
#
interface Virtual-Ethernet<strong><span>0/1/0</span></strong>.100
 vlan-type dot1q 100
 ip address 192.168.112.1 255.255.255.0
#
interface Virtual-Ethernet<span>0/1/1</span> 
 ve-group 1 l3-access
#
interface Virtual-Ethernet<span>0/1/1</span>.100
 vlan-type dot1q 100
 ip binding vpn-instance access
 ip address 192.168.112.2 255.255.255.0
 bas
  #
   access-type layer3-subscriber default-domain authentication fastweb
   default-user-name-template fastweb
   default-password-template fastweb
 #
#
interface Virtual-Ethernet<strong><span>0/2/0</span></strong>
 ve-group 2 l3-terminate
#
interface Virtual-Ethernet<strong><span>0/2/0</span></strong>.100
 vlan-type dot1q 100
 ip address 192.168.223.1 255.255.255.0
#
interface Virtual-Ethernet<span>0/2/1</span>
 ve-group 2 l3-access
#
interface Virtual-Ethernet<span>0/2/1</span>.100
 vlan-type dot1q 100
 ip binding vpn-instance access
 ip address 192.168.223.2 255.255.255.0
 bas
 #
  access-type layer3-subscriber default-domain pre-authentication fastweb
  default-user-name-template fastweb
  default-password-template fastweb
 #
#
ospf 100
 area 0.0.0.0
#
layer3-subscriber 192.168.1.1 192.168.1.1 vpn-instance access domain-name fastweb
#
return</pre>
<p></p>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_ipox_cfg_0083.html">Configuration Examples for IPoE Access Authentication
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cfg_014578.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cfg_013594.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>