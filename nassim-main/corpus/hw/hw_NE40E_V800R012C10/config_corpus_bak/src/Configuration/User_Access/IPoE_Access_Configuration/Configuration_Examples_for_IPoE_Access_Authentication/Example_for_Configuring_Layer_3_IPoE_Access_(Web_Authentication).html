
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Layer 3 IPoE Access (Web Authentication)">
<meta name="abstract" content="This section provides an example for configuring Layer 3 IPoE access (web authentication). The example provides the networking requirements, configuration roadmap, configuration procedure, and configuration files.">
<meta name="description" content="This section provides an example for configuring Layer 3 IPoE access (web authentication). The example provides the networking requirements, configuration roadmap, configuration procedure, and configuration files.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_ipox_cfg_0083.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cfg_bras_0009_web_mac.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_ipox_cfg_0150.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="z50024784,z00603461,w00800033,z00588052,ipoxne,c00549182,w00556928,l00593348,w00606909,w00447999,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="IPoE">
<meta name="featuretype" content="User Access">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="IPoE">
<meta name="featuretype" content="User Access">
<meta name="featurename" content="IPoE">
<meta name="featuretype" content="User Access">
<meta name="featurename" content="IPoE">
<meta name="featuretype" content="User Access">
<meta name="OWNER" content="c00549182">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="z00588052">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172374002">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring Layer 3 IPoE Access (Web Authentication)</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172374002"></a><a name="EN-US_TASK_0172374002"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Layer 3 IPoE Access (Web Authentication)</h1>
<div class="taskbody"><p>This section provides an example for configuring Layer 3 IPoE access (web authentication). The example provides the networking requirements, configuration roadmap, configuration procedure, and configuration files.</p>
<div class="context"><a name="EN-US_TASK_0172374002__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0172374002__fig_dc_ne_ipox_cfg_014801">Figure 1</a>, the networking requirements are as follows:</p>
<ul><li><p>A user belongs to the domain <strong>isp2</strong> and connects to GE<span>0/1/2</span>.1 on <span class="keyword">Device</span>B through <span class="keyword">Device</span>A, a DHCP relay agent. The user then accesses the Internet in Layer 3 IPoE mode.</p>
</li><li><p>Web authentication, RADIUS authentication, and RADIUS accounting are used.</p>
</li><li><p>The IP address of the RADIUS server is 192.168.8.249, and the authentication and accounting port numbers are 1812 and 1813, respectively. The standard RADIUS protocol is used, and the key is <strong>it-is-my-secret1</strong>.</p>
</li><li><p>The IP address of the DNS server is 192.168.8.252.</p>
</li><li><p>The IP address of the web server is 192.168.8.251, and the key is <strong>webvlan</strong>.</p>
</li></ul>
<div class="fignone" id="EN-US_TASK_0172374002__fig_dc_ne_ipox_cfg_014801"><a name="EN-US_TASK_0172374002__fig_dc_ne_ipox_cfg_014801"></a><a name="fig_dc_ne_ipox_cfg_014801"></a><span class="figcap"><b>Figure 1 </b>Configuring Layer 3 IPoE access (web authentication)</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interfaces 1 through 5 represent GE<span>0/1/1</span>, GE<span>0/1/2</span>, GE<span>0/1/1</span>.1, GE<span>0/1/2</span>.1, and GE<span>0/1/3</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_ne_ipox_cfg_014801.png" width="NaN" height="NaN"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172374002__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows (all functions, except DHCP relay, are configured on <span class="keyword">Device</span>B):</p>
<ol><li><p>Configure DHCP relay on <span class="keyword">Device</span>A.</p>
</li><li><p>Configure authentication and accounting schemes.</p>
</li><li><p>Configure a RADIUS server group.</p>
</li><li>Configure a user password.</li><li><p>Configure an IP address pool.</p>
</li><li><p>Configure web pre-authentication and authentication domains.</p>
</li><li><p>Configure a web authentication server.</p>
</li><li><p>Configure UCL rules and a traffic policy.</p>
</li><li><p>Configure a BAS interface and an uplink interface.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172374002__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>Authentication scheme name and authentication mode</p>
</li><li><p>Accounting scheme name and accounting mode</p>
</li><li><p>RADIUS server group name, and IP address and port numbers of the RADIUS authentication and accounting server</p>
</li><li><p>Address pool name, gateway address, and DNS server address</p>
</li><li><p>Domain names</p>
</li><li><p>IP address of the web server</p>
</li><li><p>UCL rules</p>
</li><li><p>Traffic policy name</p>
</li><li><p>BAS interface parameters</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172374002__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Assign IP addresses to interfaces on <span class="keyword">Device</span>A and <span class="keyword">Device</span>B.</span><p><p># Configure <span class="keyword">Device</span>A.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt;<strong> system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname <span class="keyword">Device</span>A</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>interface GigabitEthernet<span>0/1/2</span></strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/2</span>] <strong>ip address 10.11.11.1 255.255.255.0</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/2</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>interface GigabitEthernet<span>0/1/1</span>.1</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/1</span>.1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/1</span>.1] <strong>ip address 192.168.1.2 255.255.255.0</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/1</span>.1] <strong>vlan-type dot1q 1</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/1</span>.1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/1</span>.1] <strong>quit</strong></pre>
<p># Configure <span class="keyword">Device</span>B.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt;<strong> system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname <span class="keyword">Device</span>B</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>interface GigabitEthernet<span>0/1/2</span>.1</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/2</span>.1] <strong>ip address 192.168.1.1 255.255.255.0</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/2</span>.1] <strong>vlan-type dot1q 1</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/2</span>.1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/2</span>.1] <strong>quit</strong></pre>
</p></li><li><span>Configure DHCP relay on <span class="keyword">Device</span>A.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>interface GigabitEthernet<span>0/1/2</span></strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/2</span>] <strong>dhcp select relay</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/2</span>] <strong>ip relay address 192.168.1.1</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/2</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
</p></li><li><span>Configure a network-side address pool on <span class="keyword">Device</span>B. The gateway address of the address pool must be on the same network segment as the IP address of the inbound interface on <span class="keyword">Device</span>A, the DHCP relay agent.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>ip pool huawei bas local</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-ip-pool-huawei] <strong>gateway 10.11.11.1 24</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-ip-pool-huawei] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-ip-pool-huawei] <strong>section 0 10.11.11.2 10.11.11.255</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-ip-pool-huawei] <strong>dns-server 192.168.8.252</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-ip-pool-huawei] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-ip-pool-huawei] <strong>quit</strong></pre>
</p></li><li><span>Configure AAA schemes.</span><p><p># Configure an authentication scheme.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B]<strong> aaa</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-aaa]<strong> authentication-scheme auth2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-aaa-authen-auth2]<strong> authentication-mode radius</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-aaa-authen-auth2]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-aaa-authen-auth2]<strong> quit</strong></pre>
<p># Configure an accounting scheme.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-aaa]<strong> accounting-scheme acct2</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-aaa-accounting-acct2]<strong> accounting-mode radius</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-aaa-accounting-acct2]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-aaa-accounting-acct2]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-aaa]<strong> quit</strong></pre>
</p></li><li><span>Configure a RADIUS server group.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B]<strong> radius-server group rd2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-radius-rd2]<strong> radius-server authentication 192.168.8.249 1812</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-radius-rd2]<strong> radius-server accounting 192.168.8.249 1813</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-radius-rd2]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-radius-rd2]<strong> radius-server type standard</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-radius-rd2]<strong> radius-server shared-key-cipher </strong><strong>YsHsjx_202206</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-radius-rd2]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-radius-rd2]<strong> quit</strong></pre>
</p></li><li><span>Configure the IPoE user password.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B]<strong> aaa</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-aaa]<strong> </strong><strong>default-password cipher YsHsjx_202206</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-aaa]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-aaa]<strong> quit</strong></pre>
</p></li><li><span>Configure a domain.</span><p><p># Configure a domain named <strong>default0</strong> as the pre-authentication domain for web authentication.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B]<strong> user-group huawei</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B]<strong> aaa</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-aaa]<strong> domain default0</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-aaa-domain-default0]<strong> user-group huawei</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-aaa-domain-default0] <strong>web-server 192.168.8.251</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-aaa-domain-default0]<strong> web-server url http://192.168.8.251</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-aaa-domain-default0]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-aaa-domain-default0]<strong> ip-pool huawei</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-aaa-domain-default0]<strong> quit</strong></pre>
<p># Configure a domain named <strong>isp2</strong> as the post-authentication domain for web authentication.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-aaa]<strong> domain isp2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-aaa-domain-isp2]<strong> authentication-scheme auth2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-aaa-domain-isp2]<strong> accounting-scheme acct2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-aaa-domain-isp2]<strong> radius-server group rd2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-aaa-domain-isp2] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-aaa-domain-isp2]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-aaa]<strong> quit</strong></pre>
</p></li><li><span>Configure an IP address used by <span class="keyword">Device</span>B to receive portal packets from the web authentication server.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>interface LoopBack0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-LoopBack0] <strong>ip address 10.6.55.1 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-LoopBack0] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-LoopBack0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B]<strong> web-auth-server source-ip 10.6.55.1</strong></pre>
</p></li><li><span>Configure a web authentication server.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>web-auth-server enable</strong></pre>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font><span class="keyword">Device</span>B] <strong>web-auth-server source interface LoopBack 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>commit</strong> </pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B]<strong> web-auth-server 192.168.8.251 key cipher webvlan</strong></pre>
</p></li><li><span>Configure a traffic policy.</span><p><p># Configure UCL rules.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>acl 6000</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-acl-ucl-6000] <strong>rule 10 permit ip source user-group huawei destination ip-address 127.0.0.1 0</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-acl-ucl-6000] <strong>rule 15 permit ip source ip-address 127.0.0.1 0  destination user-group huawei</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The preceding UCL rules involving 127.0.0.1 serve as an example for permitting users in the pre-authentication domain to access specified websites. After the UCL rules are configured, user packets sent to the CPU of <span class="keyword">Device</span>B can pass through and users in the pre-authentication domain can access 127.0.0.1.</p>
</div></div>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-acl-ucl-6000] <strong>rule 20 permit ip source user-group huawei destination ip-address 192.168.8.252 0</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-acl-ucl-6000] <strong>rule 25 permit ip source ip-address 192.168.8.252 0  destination user-group huawei</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-acl-ucl-6000] <strong>rule 30 permit ip source user-group huawei destination ip-address 192.168.8.249 0</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-acl-ucl-6000] <strong>rule 35 permit ip source ip-address 192.168.8.249 0  destination user-group huawei</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-acl-ucl-6000] <strong>rule 40 permit ip source user-group huawei destination ip-address 192.168.8.251 0</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-acl-ucl-6000] <strong>rule 45 permit ip source ip-address 192.168.8.251 0  destination user-group huawei</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-acl-ucl-6000] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-acl-ucl-6000] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>acl 6001</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-acl-ucl-6001] <strong>rule 10 permit tcp source user-group huawei destination-port eq www</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-acl-ucl-6001] <strong>rule 15 permit tcp source user-group huawei destination-port eq 8080</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-acl-ucl-6001] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-acl-ucl-6001] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>acl 6002</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-acl-ucl-6001] <strong>rule 10 permit tcp source user-group huawei destination </strong><strong>ip-address any</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-acl-ucl-6001] <strong>rule 15 permit tcp source ip-address any destination user-group huawei</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-acl-ucl-6001] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-acl-ucl-6001] <strong>quit</strong></pre>
<p># Configure a traffic policy.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>traffic classifier web_permit</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-classifier-web_permit] <strong>if-match acl 6000</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-classifier-web_permit] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-classifier-web_permit] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>traffic behavior web_permit</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-behavior-web_permit] <strong>permit</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-behavior-web_permit] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-behavior-web_permit] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>traffic classifier web_redirect</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-classifier-web_deny] <strong>if-match acl 6001</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-classifier-web_deny] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-classifier-web_deny] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>traffic behavior web_redirect</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-behavior-web_deny] <strong>http-redirect</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-behavior-web_deny] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-behavior-web_deny] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>traffic classifier web_deny</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-classifier-web_deny] <strong>if-match acl 6002</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-classifier-web_deny] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-classifier-web_deny] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>traffic behavior web_deny</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-behavior-web_deny] <strong>deny</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-behavior-web_deny] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-behavior-web_deny] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>traffic policy web</strong> 
[<span class="keyword">*</span><span class="keyword">Device</span>B-policy-web] <strong>classifier web_permit behavior web_permit</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-policy-web] <strong>classifier web_redirect behavior web_redirect</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-policy-web] <strong>classifier web_deny behavior web_deny</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-policy-web] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-policy-web] <strong>quit</strong></pre>
<p># Apply the user-side traffic policy globally.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>traffic-policy web inbound</strong></pre>
</p></li><li><span>Configure interfaces.</span><p><p># Configure a BAS interface.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>interface GigabitEthernet <span>0/1/2</span>.1</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/2</span>.1]<strong> bas</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/2</span>.1-bas]<strong> access-type layer3-subscriber default-domain pre-authentication default0 authentication isp2</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>For Layer 3 users who do not obtain IP addresses through <span class="keyword">Device</span>B, you must run the <a href="cmdqueryname=layer3-subscriber"><b><span class="cmdname">layer3-subscriber</span></b></a> <i><span class="varname">start-ip-address</span></i> <span>[ </span><i><span class="varname">end-ip-address</span></i> <span>] </span>[ <strong><span>vpn-instance</span></strong> <i><span class="varname">instance-name</span></i> ] <strong><span>domain-name </span></strong><i><span class="varname">domain-name</span></i> command in the system view to specify the IP address range to which the static Layer 3 users belong and the name of the associated authentication domain.</p>
</div></div>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/1</span>.1-bas]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/2</span>.1-bas]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/2</span>.1]<strong> quit</strong></pre>
<p># Configure an uplink interface.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>interface GigabitEthernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/1</span>]<strong> ip address 192.168.2.1 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/1</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/1</span>]<strong> quit</strong></pre>
<p># Configure the interface connected to the server.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>interface GigabitEthernet <span>0/1/3</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/3</span>]<strong> ip address 192.168.8.1 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/3</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/3</span>]<strong> quit</strong></pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172374002__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><div class="p"><span class="keyword">Device</span>A configuration file<pre class="screen">#
sysname <span class="keyword">Device</span>A
#
interface GigabitEthernet<span>0/1/1</span>.1
 vlan-type dot1q 1
 ip address 192.168.1.2 255.255.255.0
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ip address 10.11.11.1 255.255.255.0
 dhcp select relay
 ip relay address 192.168.1.1
#
return</pre>
</div>
</li><li><div class="p"><span class="keyword">Device</span>B configuration file<pre class="screen">#
sysname <span class="keyword">Device</span>B
#
radius-server group rd2
 radius-server shared-key-cipher %^%#vS%796FO7%C<font style="font-size:8pt" Face="Courier New" >~</font>pB%CR=q;j}gSCqR-X6+P!.DYI@)%^%#
 radius-server authentication 192.168.8.249 1812 weight 0
 radius-server accounting 192.168.8.249 1813 weight 0       
#
ip pool huawei bas local
 gateway 10.11.11.1 255.255.255.0
 section 0 10.11.11.2 10.11.11.255 
 dns-server 192.168.8.252
#
user-group huawei
#
acl number 6000
 rule 10 permit ip source user-group huawei destination ip-address 127.0.0.1 0 
 rule 15 permit ip source ip-address 127.0.0.1 0  destination user-group huawei
 rule 20 permit ip source user-group huawei destination ip-address 192.168.8.252 0
 rule 25 permit ip source ip-address 192.168.8.252 0  destination user-group huawei
 rule 30 permit ip source user-group huawei destination ip-address 192.168.8.249 0
 rule 35 permit ip source ip-address 192.168.8.249 0  destination user-group huawei
 rule 40 permit ip source user-group huawei destination ip-address 192.168.8.251 0
 rule 45 permit ip source ip-address 192.168.8.251 0  destination user-group huawei
#
acl number 6001
 rule 10 permit tcp source user-group huawei destination-port eq www
 rule 15 permit tcp source user-group huawei destination-port eq 8080
#
acl number 6002
 rule 10 permit ip source user-group huawei destination ip-address any 
 rule 15 permit ip source ip-address any destination user-group huawei
#
traffic classifier web_permit operator or
 if-match acl 6000 precedence 1
#
traffic classifier web_redirect operator or
 if-match acl 6001 precedence 2
#
traffic classifier web_deny operator or
 if-match acl 6002 precedence 2
#
traffic behavior web_permit
#
traffic behavior web_redirect
 http-redirect
#
traffic behavior web_deny
 deny
#
traffic policy web
 share-mode
 classifier web_permit behavior web_permit precedence 1
 classifier web_redirect behavior web_redirect precedence 2
 classifier web_deny behavior web_deny precedence 3
#
aaa 
 default-password cipher $$e:TY%^%glhJ;yPG#$=tC&amp;(Is%q!S_";(k.Ef$%^%#:978 
 # 
 authentication-scheme auth2
 #
  accounting-scheme acct2 
 #  
 domain default0
  ip-pool huawei
  user-group huawei
  web-server 192.168.8.251
  web-server url http://192.168.8.251
 # 
 domain isp2
  authentication-scheme auth2
  accounting-scheme acct2
  radius-server group rd2
#
interface GigabitEthernet <span>0/1/1</span>
 undo shutdown
 ip address 192.168.2.1 255.255.255.0
#
interface <span>GigabitEthernet</span><span>0/1/2</span>
 undo shutdown
#
interface <span>GigabitEthernet</span><span>0/1/2</span>.1
 vlan-type dot1q 1
 ip address 192.168.1.1 255.255.255.0
 bas
 #
  access-type layer3-subscriber default-domain pre-authentication default0 authentication isp2
#
interface GigabitEthernet<span>0/1/3</span>
 undo shutdown
 ip address 192.168.8.1 255.255.255.0
#
interface LoopBack0
 ip address 10.6.55.1 255.255.255.255
#
web-auth-server enable
web-auth-server source interface LoopBack0
web-auth-server 192.168.8.251 key cipher %^%#aQL6,Ua&lt;|@sxPQK/1f'4/GBJ6,6)q&gt;$Z^7*,!2yR%^%#
<span>#</span>
<span> web-auth-server source-ip 10.6.55.1</span>
#
traffic-policy web inbound
#
return</pre>
</div>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_ipox_cfg_0083.html">Configuration Examples for IPoE Access Authentication
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cfg_bras_0009_web_mac.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_ipox_cfg_0150.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>