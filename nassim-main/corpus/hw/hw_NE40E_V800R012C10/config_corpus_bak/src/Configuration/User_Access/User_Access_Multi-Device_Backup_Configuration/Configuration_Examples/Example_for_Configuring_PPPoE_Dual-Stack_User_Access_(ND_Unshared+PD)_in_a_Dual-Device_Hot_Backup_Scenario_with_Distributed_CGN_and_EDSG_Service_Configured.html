
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring PPPoE Dual-Stack User Access (ND Unshared+PD) in a Dual-Device Hot Backup Scenario with Distributed CGN and EDSG Service Configured">
<meta name="abstract" content="In a dual-device hot backup scenario, dual-stack users connect to the master and backup BRASs using PPPoE. The BRASs assign IPv6 addresses to the users in ND unshared+PD mode to implement user access.">
<meta name="description" content="In a dual-device hot backup scenario, dual-stack users connect to the master and backup BRASs using PPPoE. The BRASs assign IPv6 addresses to the users in ND unshared+PD mode to implement user access.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cfg_rui_0050.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cfg_rui_0065.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cfg_rui_1005.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="z50024784,w00800033,z00588052,l00593348,w00606909,w00447999">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="UP Multi-Device Backup">
<meta name="featurename" content="User Access Multi-Device Backup">
<meta name="featuretype" content="User Access">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="UP Multi-Device Backup">
<meta name="featurename" content="User Access Multi-Device Backup">
<meta name="featuretype" content="User Access">
<meta name="featurename" content="UP Multi-Device Backup">
<meta name="featurename" content="User Access Multi-Device Backup">
<meta name="featuretype" content="User Access">
<meta name="featurename" content="User Access Multi-Device Backup">
<meta name="featuretype" content="User Access">
<meta name="OWNER" content="l00593348">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="z00588052">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001199312302">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>Example for Configuring PPPoE Dual-Stack User Access (ND Unshared+PD) in a Dual-Device Hot Backup Scenario with Distributed CGN and EDSG Service Configured</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001199312302"></a><a name="EN-US_TASK_0000001199312302"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring PPPoE Dual-Stack User Access (ND Unshared+PD) in a Dual-Device Hot Backup Scenario with Distributed CGN and EDSG Service Configured</h1>
<div class="taskbody"><p>In a dual-device hot backup scenario, dual-stack users connect to the master and backup BRASs using PPPoE. The BRASs assign IPv6 addresses to the users in ND unshared+PD mode to implement user access.</p>
<div class="context"><a name="EN-US_TASK_0000001199312302__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="dc_ne_cfg_rui_0064.html#EN-US_TASK_0210982515__fig_dc_ne_cfg_rui_003101">Figure 1</a>, User1 and User2 access BRAS1 and BRAS2 through SW1. The BRASs use RADIUS authentication and accounting. They assign to the users IPv4 addresses through the local address pool, IPv6 prefixes through DHCPv6 IA_PD, and IPv6 addresses through ND.</p>
<p>To enable private network users to access the Internet, distributed CGN needs to be deployed on the network to translate private addresses into public addresses. In addition, User1 and User2 have different requirements for network service traffic. As such, EDSG services need to be deployed. ACLs also need to be used to match the destination addresses and distinguish the network segments for user access so that independent rate limiting and accounting can be implemented for different network segments. Further to this, dual-device hot backup needs to be deployed to improve network reliability. If a fault occurs, a master/backup switchover can be triggered to ensure the normal running of services.</p>
<div class="fignone"><span class="figcap"><b>Figure 1 </b>Configuring PPPoE dual-stack user access (ND unshared+PD) in a dual-device hot backup scenario with distributed CGN and EDSG service configured</span><br><span><img class="vsd" src="figure/en-us_image_0000001360795709.png" width="NaN" height="NaN"></span></div>

<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" frame="border" border="1" rules="all"><caption><b>Table 1 </b>Interfaces and IP addresses</caption><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="22.587741225877412%" id="mcps1.4.1.5.2.5.1.1" liSelected="liSelected"><p><strong>Device</strong></p>
</th>
<th align="left" class="cellrowborder" valign="top" width="23.227677232276772%" id="mcps1.4.1.5.2.5.1.2" liSelected="liSelected"><p><strong>Interface Name</strong></p>
</th>
<th align="left" class="cellrowborder" valign="top" width="23.337666233376662%" id="mcps1.4.1.5.2.5.1.3" liSelected="liSelected"><p><strong>Interface Number</strong></p>
</th>
<th align="left" class="cellrowborder" valign="top" width="30.846915308469153%" id="mcps1.4.1.5.2.5.1.4" liSelected="liSelected"><p><strong>IP Address</strong></p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" rowspan="7" valign="top" width="22.587741225877412%" headers="mcps1.4.1.5.2.5.1.1 "><p>BRAS1</p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
</td>
<td class="cellrowborder" valign="top" width="23.227677232276772%" headers="mcps1.4.1.5.2.5.1.2 "><p>interface1</p>
</td>
<td class="cellrowborder" valign="top" width="23.337666233376662%" headers="mcps1.4.1.5.2.5.1.3 "><p>Eth-trunk2</p>
</td>
<td class="cellrowborder" valign="top" width="30.846915308469153%" headers="mcps1.4.1.5.2.5.1.4 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.5.1.2 "><p>interface1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.5.1.3 "><p>Eth-trunk2.1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.5.1.4 "><p>192.168.4.129/29</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.5.1.2 "><p>interface2</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.5.1.3 "><p>GE<span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.5.1.4 "><p>10.2.1.1/24, 2001:db8:8::7/128</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.5.1.2 "><p>interface3</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.5.1.3 "><p>Eth-trunk4</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.5.1.4 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.5.1.2 "><p>interface3</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.5.1.3 "><p>Eth-trunk4.1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.5.1.4 "><p>192.168.5.97/29</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.5.1.2 "><p>-</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.5.1.3 "><p>Loopback1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.5.1.4 "><p>10.2.2.2/24, 2001:db8::2:2/64</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.5.1.2 "><p>-</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.5.1.3 "><p>Loopback2</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.5.1.4 "><p>10.3.3.3/24</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="7" valign="top" width="22.587741225877412%" headers="mcps1.4.1.5.2.5.1.1 "><p>BRAS2</p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
</td>
<td class="cellrowborder" valign="top" width="23.227677232276772%" headers="mcps1.4.1.5.2.5.1.2 "><p>interface1</p>
</td>
<td class="cellrowborder" valign="top" width="23.337666233376662%" headers="mcps1.4.1.5.2.5.1.3 "><p>Eth-trunk2</p>
</td>
<td class="cellrowborder" valign="top" width="30.846915308469153%" headers="mcps1.4.1.5.2.5.1.4 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.5.1.2 "><p>interface1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.5.1.3 "><p>Eth-trunk2.1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.5.1.4 "><p>192.168.4.130/29</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.5.1.2 "><p>interface2</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.5.1.3 "><p>GE<span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.5.1.4 "><p>10.4.1.1/24, 2001:db8:9::7/128</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.5.1.2 "><p>interface3</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.5.1.3 "><p>Eth-trunk4</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.5.1.4 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.5.1.2 "><p>interface3</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.5.1.3 "><p>Eth-trunk4.1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.5.1.4 "><p>192.168.5.98/29</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.5.1.2 "><p>-</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.5.1.3 "><p>Loopback1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.5.1.4 "><p>10.4.4.4/24, 2001:db8::3:3/64</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.5.1.2 "><p>-</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.5.1.3 "><p>Loopback2</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.5.1.4 "><p>10.13.13.13/24</p>
</td>
</tr>
</tbody>
</table>
</div>
<h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li>Configure IP addresses for interfaces.</li><li>Configure a routing protocol.</li><li>Configure AAA schemes.</li><li>Configure RADIUS.</li><li>Configure address pools.</li><li>Configure a domain.</li><li>Configure a BAS interface.</li><li>Configure a BFD session and VRRP on the access side of the master and backup BRASs.</li><li>Configure an RBS and an RBP.</li><li>Configure the EDSG service.</li><li>Configure the distributed CGN service.</li><li>Enable the function to advertise public routes.</li></ol>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The configuration of BRAS2 is similar to the configuration of BRAS1. The following uses the configuration on BRAS1 as an example. For configuration details on BRAS2, see the BRAS2 configuration file.</p>
</div></div>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001199312302__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>VRRP parameters (such as the VRRP ID and preemption delay)</p>
</li><li><p>BFD parameters (such as the local and remote discriminators of a BFD session and the expected minimum intervals at which BFD Control packets are sent and received)</p>
</li></ul>
<ul><li><p>IP addresses of interfaces on BRAS1 and BRAS2.</p>
</li><li><p>User access parameters</p>
</li><li><p>CGN service parameters</p>
</li><li>EDSG service parameters</li><li>User authentication mode (RADIUS authentication)</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001199312302__1.4.3"></a><a name="1.4.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure IP addresses for interfaces.</span><p><p># Configure IP addresses for network-side interfaces.</p>
</p><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>interface gigabitEthernet <span>0/1/0</span></strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/0</span>] <strong>ipv6 enable</strong> 
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/0</span>] <strong>ipv6 address 2001:db8:8::7 128</strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/0</span>] <strong>ipv6 address auto link-local</strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/0</span>] <strong>ip address 10.2.1.1 24</strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/0</span>] <strong>commit</strong>
[<span class="keyword">*</span>BRAS1] <strong>interface</strong> <strong>Loopback1</strong>
[<span class="keyword">*</span>BRAS1-Loopback1] <strong>ipv6 enable</strong>
[<span class="keyword">*</span>BRAS1-Loopback1] <strong>ipv6 address 2001:db8::2:2 64</strong>
[<span class="keyword">*</span>BRAS1-Loopback1] <strong>ipv6 address auto link-local</strong>
[<span class="keyword">*</span>BRAS1-Loopback1] <strong>ip address 10.2.2.2 24</strong>
[<span class="keyword">*</span>BRAS1-Loopback1] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
<p># Configure an IP address for the protection tunnel.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>interface loopback2</strong>
[<span class="keyword">*</span>BRAS1-Loopback2] <strong>ip address 10.3.3.3 24</strong>
[<span class="keyword">*</span>BRAS1-Loopback2] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
</p></li><li><span>Configure a routing protocol.</span><p><p># Enable the function to automatically control a route's cost preference.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>peer-backup route-cost auto-advertising</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
<p># Configure MPLS.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>mpls</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-mpls] <strong>mpls ldp</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-mpls] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>mpls lsr-id 10.3.3.3</strong>
[<span class="keyword">*</span>BRAS1] <strong>interface GigabitEthernet</strong><strong><span>0/1/0</span></strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/0</span>] <strong>mpls ldp</strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
<p># Configure OSPF to import UNRs.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>ospf 1</strong>
[<span class="keyword">*</span>BRAS1-ospf-1] <strong>default cost inherit-metric</strong>
[<span class="keyword">*</span>BRAS1-ospf-1] <strong>import-route unr</strong>
[<span class="keyword">*</span>BRAS1-ospf-1] <strong>area 0</strong>
[<span class="keyword">*</span>BRAS1-ospf-1-area-0.0.0.0] <strong>network 10.2.1.0 0.0.0.255</strong>
[<span class="keyword">*</span>BRAS1-ospf-1-area-0.0.0.0] <strong>network 10.3.3.3 0.0.0.0</strong>
[<span class="keyword">*</span>BRAS1-ospf-1-area-0.0.0.0] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1-ospf-1] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
</p></li><li><span>Configure AAA schemes.</span><p><p># Configure authentication schemes and set the authentication mode to RADIUS and none, respectively.</p>
<pre class="screen">&lt;HUAWEI&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>HUAWEI] <strong>sysname</strong> <strong>BRAS1</strong>
[<span class="keyword">*</span>HUAWEI] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1]<strong> aaa</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa]<strong> authentication-scheme auth1</strong>
[<span class="keyword">*</span>BRAS1-aaa-authen-auth1]<strong> authentication-mode radius</strong>
[<span class="keyword">*</span>BRAS1-aaa-authen-auth1]<strong> quit</strong>
[<span class="keyword">*</span>BRAS1-aaa]<strong> authentication-scheme none</strong>
[<span class="keyword">*</span>BRAS1-aaa-authen-auth1]<strong> authentication-mode none</strong>
[<span class="keyword">*</span>BRAS1-aaa-authen-auth1]<strong> quit</strong>
[<span class="keyword">*</span>BRAS1-aaa] <strong>commit</strong></pre>
<p># Configure an accounting scheme that uses the RADIUS accounting mode.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa]<strong> accounting-scheme acct1</strong>
[<span class="keyword">*</span>BRAS1-aaa-accounting-acct1]<strong> accounting-mode radius</strong>
[<span class="keyword">*</span>BRAS1-aaa-accounting-acct1]<strong> quit</strong>
[<span class="keyword">*</span>BRAS1-aaa] <strong>commit</strong>
[<span class="keyword">*</span>BRAS1-aaa] <strong>quit</strong></pre>
</p></li><li><span>Configure RADIUS.</span><p><p># Create UDP sockets with the local port numbers 1645, 1646, and 3799 and with any local IP address.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1]<strong> </strong><strong>radius local-ip all</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
<p># Configure a RADIUS server group.</p>
</p><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1]<strong> radius-server group rd1</strong>
[<span class="keyword">*</span>BRAS1-radius-rd1]<strong> radius-server authentication 192.168.7.249 1812 weight 0</strong>
[<span class="keyword">*</span>BRAS1-radius-rd1]<strong> radius-server accounting 192.168.7.249 1813 weight </strong><strong>0</strong>
[<span class="keyword">*</span>BRAS1-radius-rd1]<strong> radius-server shared-key-cipher YsHsjx_202206 </strong>
[<span class="keyword">*</span>BRAS1-radius-rd1]<strong> radius-server source interface Loopback1</strong>
[<span class="keyword">*</span>BRAS1-radius-rd1]<strong> commit </strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-radius-rd1]<strong> radius-server calling-station-id include mac</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-radius-rd1]<strong> </strong><strong>radius-server user-name original</strong>
[<span class="keyword">*</span>BRAS1-radius-rd1]<strong> commit </strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-radius-rd1]<strong> </strong><strong>radius-server class-as-car</strong>
[<span class="keyword">*</span>BRAS1-radius-rd1] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
</p><p><p># Configure a RADIUS authorization server.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1]<strong> </strong><strong>radius-server authorization 192.168.8.249 shared-key-cipher </strong><strong>YsHsjx_202206 server-group rd1</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
</p></li><li><span>Configure address pools.</span><p><p># Configure a user-side local IPv4 address pool.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>ip pool </strong><strong>pool_v4</strong> <strong>bas local</strong>
[<span class="keyword">*</span>BRAS1-ip-pool-pool_v4] <strong>gateway 172.16.0.1 255.255.255.0</strong>
[<span class="keyword">*</span>BRAS1-ip-pool-pool_v4] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-ip-pool-pool_v4] <strong>section 0 172.16.0.2 172.16.0.200</strong> 
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-ip-pool-pool_v4] <strong>dns-server 10.179.155.161 10.179.155.177</strong>
[<span class="keyword">*</span>BRAS1-ip-pool-pool_v4] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
<p># Configure an IPv6 address pool.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>ipv6 prefix </strong><strong>pre_nd</strong><strong>_1</strong> <strong>delegation</strong>
[<span class="keyword">*</span>BRAS1-ipv6-prefix-pre_nd_1] <strong>prefix 2001:db8:1::/48</strong>
[<span class="keyword">*</span>BRAS1-ipv6-prefix-pre_nd_1] <strong>slaac-unshare-only</strong>
[<span class="keyword">*</span>BRAS1-ipv6-prefix-pre_nd_1] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1] <strong>commi</strong><strong>t</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>ipv6 pool pool_nd_1 bas delegation</strong>
[<span class="keyword">*</span>BRAS1-ipv6-pool-pool_nd_1] <strong>prefix pre_nd</strong><strong>_1</strong>
[<span class="keyword">*</span>BRAS1-ipv6-pool-pool_nd_1] <strong>dns-server 2001:db8::2:2 2001:db8::2:3</strong>
[<span class="keyword">*</span>BRAS1-ipv6-pool-pool_nd_1] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1] <strong>commi</strong><strong>t</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>ipv6 prefix </strong><strong>pre_pd_1</strong> <strong>delegation</strong>
[<span class="keyword">*</span>BRAS1-ipv6-prefix-pre_pd_1] <strong>prefix 2001:db8:2::/48</strong>
[<span class="keyword">*</span>BRAS1-ipv6-prefix-pre_pd_1] <strong>commi</strong><strong>t</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-ipv6-prefix-pre_pd_1] <strong>pd-unshare-only</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-ipv6-prefix-pre_pd_1] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>ipv6 pool pool_pd_1 bas delegation</strong>
[<span class="keyword">*</span>BRAS1-ipv6-pool-pool_pd_1] <strong>prefix pre_pd</strong><strong>_1</strong>
[<span class="keyword">*</span>BRAS1-ipv6-pool-pool_pd_1] <strong>dns-server 2001:db8::2:2 2001:db8::2:3</strong>
[<span class="keyword">*</span>BRAS1-ipv6-pool-pool_pd_1] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1] <strong>commi</strong><strong>t</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>ipv6 prefix </strong><strong>pre_nd</strong><strong>_2</strong> <strong>delegation</strong>
[<span class="keyword">*</span>BRAS1-ipv6-prefix-pre_nd_2] <strong>prefix 2001:db8:3::/48</strong>
[<span class="keyword">*</span>BRAS1-ipv6-prefix-pre_nd_2] <strong>slaac-unshare-only</strong>
[<span class="keyword">*</span>BRAS1-ipv6-prefix-pre_nd_2] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1] <strong>commi</strong><strong>t</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>ipv6 pool pool_nd_2 bas delegation</strong> <strong>rui-slave</strong>
[<span class="keyword">*</span>BRAS1-ipv6-pool-pool_nd_2] <strong>prefix pre_nd</strong><strong>_2</strong>
[<span class="keyword">*</span>BRAS1-ipv6-pool-pool_nd_2] <strong>dns-server 2001:db8::2:2 2001:db8::2:3</strong>
[<span class="keyword">*</span>BRAS1-ipv6-pool-pool_nd_2] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1] <strong>commi</strong><strong>t</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>ipv6 prefix </strong><strong>pre_pd</strong><strong>_2</strong> <strong>delegation</strong> 
[<span class="keyword">*</span>BRAS1-ipv6-prefix-pre_pd_2] <strong>prefix 2001:db8:4::/48</strong>
[<span class="keyword">*</span>BRAS1-ipv6-prefix-pre_pd_2] <strong>commi</strong><strong>t</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-ipv6-prefix-pre_pd_2] <strong>pd-unshare-only</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-ipv6-prefix-pre_pd_2] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>ipv6 pool pool_pd_2 bas delegation</strong> <strong>rui-slave</strong>
[<span class="keyword">*</span>BRAS1-ipv6-pool-pool_pd_2] <strong>prefix pre_pd</strong><strong>_2</strong> 
[<span class="keyword">*</span>BRAS1-ipv6-pool-pool_pd_2] <strong>dns-server 2001:db8::2:2 2001:db8::2:3</strong>
[<span class="keyword">*</span>BRAS1-ipv6-pool-pool_pd_2] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1] <strong>commi</strong><strong>t</strong></pre>
<p># Configure the DHCPv6 device to generate a DUID in DUID-LLT mode. (This step is not required if a DUID has been configured on BRAS1.)</p>
</p><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>dhcpv6 duid llt</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
</p></li><li><span>Configure a domain.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>aaa</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa]<strong> domain isp1</strong>
[<span class="keyword">*</span>BRAS1-aaa-domain-isp1]<strong> authentication-scheme auth1</strong>
[<span class="keyword">*</span>BRAS1-aaa-domain-isp1]<strong> accounting-scheme acct1</strong>
[<span class="keyword">*</span>BRAS1-aaa-domain-isp1]<strong> radius-server group rd1</strong>
[<span class="keyword">*</span>BRAS1-aaa-domain-isp1]<strong> commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa-domain-isp1] <strong>prefix-assign-mode unshared  </strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa-domain-isp1]<strong> ip-pool pool_v4</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa-domain-isp1] <strong>ipv6-pool </strong><strong>pool_nd_1</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa-domain-isp1] <strong>ipv6-pool pool_pd</strong><strong>_1</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa-domain-isp1] <strong>accounting-start-delay 10 online user-type ppp</strong>
[<span class="keyword">*</span>BRAS1-aaa-domain-isp1] <strong>accounting-start-delay traffic-forward before-start-accounting</strong>
[<span class="keyword">*</span>BRAS1-aaa-domain-isp1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa-domain-isp1] <strong>user-basic-service-ip-type ipv4</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa-domain-isp1]<strong> quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa]<strong> quit</strong></pre>
</p></li><li><span>Configure a BAS interface.</span><p><p># Configure a VT.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>interface virtual-template 5</strong>
[<span class="keyword">*</span>BRAS1-virtual-template5]<strong> </strong><strong>ppp authentication-mode chap</strong>
[<span class="keyword">*</span>BRAS1-virtual-template5]<strong> </strong><strong>quit</strong>
[<span class="keyword">*</span>BRAS1]<strong> </strong><strong>commit</strong></pre>
<p># Configure the Eth-Trunk interface to work in static LACP mode and set a timeout period for the interface to receive LACPDUs.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>interface Eth-Trunk2</strong>
[<span class="keyword">*</span>BRAS1-Eth-Trunk2]<strong> mode lacp-static</strong>
[<span class="keyword">*</span>BRAS1-Eth-Trunk2]<strong> lacp timeout fast</strong>
[<span class="keyword">*</span>BRAS1-Eth-Trunk2]<strong> </strong><strong>commit</strong></pre>
<p># Enable the IPv6 function on the interface and specify the VT.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-Eth-Trunk2]<strong> </strong><strong>interface Eth-Trunk2.10</strong>
[<span class="keyword">*</span>BRAS1-Eth-Trunk2.10] <strong>ipv6 enable</strong>
[<span class="keyword">*</span>BRAS1-Eth-Trunk2.10] <strong>ipv6 address auto link-local</strong>
[<span class="keyword">*</span>BRAS1-Eth-Trunk2.10]<strong> </strong><strong>pppoe-server bind virtual-template 5</strong>
[<span class="keyword">*</span>BRAS1-Eth-Trunk2.10] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-Eth-Trunk2.10]<strong> user-vlan 1000 4000 qinq 2000 2001</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-Eth-Trunk2.10-user-vlan-1000-4000-qinq-2000-2001]<strong> </strong><strong>quit</strong></pre>
<p># Configure BAS interfaces.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-Eth-Trunk2.1] <strong>bas</strong>
[<strong><span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span></strong>BRAS1-Eth-Trunk2.1-bas]<strong> access-type layer2-subscriber default-domain authentication isp1</strong>
[<span class="keyword">*</span>BRAS1-Eth-Trunk2.1-bas]<strong> </strong><strong>client-option82 basinfo-insert cn-telecom</strong>
[<span class="keyword">*</span>BRAS1-Eth-Trunk2.1-bas]<strong> commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-Eth-Trunk2.1-bas]<strong> </strong><strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-Eth-Trunk2.1]<strong> </strong><strong>quit</strong></pre>
<p># Configure the network-side interfaces.</p>
</p></li><li><span>Configure a BFD session and VRRP on the access side of the master and backup BRASs. BRAS1 is the master, and BRAS2 is the backup.</span><p><p># Configure a BFD session on the access side to allow the device to rapidly detect interface or link faults and trigger a master/backup VRRP switchover upon such a fault.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>bfd</strong>
[<span class="keyword">*</span>BRAS1-bfd] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1]<strong> bfd bfd bind peer-ip 192.168.4.130</strong>
[<span class="keyword">*</span>BRAS1-bfd-session-bfd1] <strong>discriminator local 1</strong>
[<span class="keyword">*</span>BRAS1-bfd-session-bfd1] <strong>discriminator remote 1</strong>
[<span class="keyword">*</span>BRAS1-bfd-session-bfd1] <strong>quit</strong> 
[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
<p># Configure a VRRP group on an interface/sub-interface (sub-interface Eth-Trunk2.1 is used in this example), and configure VRRP to track the BFD session and network-side interface. Set the VRRP status recovery delay to 300s.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>interface </strong><strong>Eth-Trunk2.1 </strong>             
[<span class="keyword">*</span>BRAS1-Eth-Trunk2.1] <strong>vlan-type dot1q 96</strong>                           
[<span class="keyword">*</span>BRAS1-Eth-Trunk2.1] <strong>ip address 192.168.4.129 255.255.255.248</strong>            
[<span class="keyword">*</span>BRAS1-Eth-Trunk2.1] <strong>vrrp vrid 5 virtual-ip 192.168.4.131</strong>
[<span class="keyword">*</span>BRAS1-Eth-Trunk2.1] <strong>admin-vrrp vrid 5</strong>              
[<span class="keyword">*</span>BRAS1-Eth-Trunk2.1] <strong>vrrp vrid 5 priority 120</strong> 
[<span class="keyword">*</span>BRAS1-Eth-Trunk2.1] <strong>vrrp vrid 5 preempt-mode timer delay 1800 </strong>
[<span class="keyword">*</span>BRAS1-Eth-Trunk2.1] <strong>vrrp vrid 5 track interface GigabitEthernet </strong><strong><span>0/1/0</span></strong><strong> reduced 50</strong> 
[<span class="keyword">*</span>BRAS1-Eth-Trunk2.1] <strong>vrrp vrid 5 track bfd-session session-name bfd1 link</strong>
[<span class="keyword">*</span>BRAS1-Eth-Trunk2.1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-Eth-Trunk2.1] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>vrrp recover-delay 300</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
</p></li><li><span>Configure an RBS and an RBP.</span><p><p># Configure an RBS.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>remote-backup-service s1</strong>
[<span class="keyword">*</span>BRAS1-rm-backup-srv-s1] <strong>peer 10.13.13.13 source 10.3.3.3 port 6001</strong>
[<span class="keyword">*</span>BRAS1-rm-backup-srv-s1] <strong>track interface GigabitEthernet </strong><strong><span>0/1/0</span></strong>
[<span class="keyword">*</span>BRAS1-rm-backup-srv-s1] <strong>protect lsp-tunnel for-all-instance peer-ip 10.13.13.13</strong>
[<span class="keyword">*</span>BRAS1-rm-backup-srv-s1] <strong>ip-pool pool_v4 metric 10</strong>
[<span class="keyword">*</span>BRAS1-rm-backup-srv-s1] <strong>ipv6-pool pool_nd_1 metric 10</strong>
[<span class="keyword">*</span>BRAS1-rm-backup-srv-s1] <strong>ipv6-pool pool_pd_1 metric 10</strong>
[<span class="keyword">*</span>BRAS1-rm-backup-srv-s1] <strong>ipv6-pool pool_nd_2 metric 20</strong>
[<span class="keyword">*</span>BRAS1-rm-backup-srv-s1] <strong>ipv6-pool pool_pd_2 metric 20</strong>
[<span class="keyword">*</span>BRAS1-rm-backup-srv-s1] <strong>radius-authorization source same-as nas-logic-ip</strong>
[<span class="keyword">*</span>BRAS1-rm-backup-srv-s1] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
<p># Configure an RBP.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>remote-backup-profile p1</strong>
[<span class="keyword">*</span>BRAS1-rm-backup-prf-p1] <strong>service-type bras</strong>
[<span class="keyword">*</span>BRAS1-rm-backup-prf-p1] <strong>peer-backup hot</strong>
[<span class="keyword">*</span>BRAS1-rm-backup-prf-p1] <strong>backup-id 5 remote-backup-service s1</strong>
[<span class="keyword">*</span>BRAS1-rm-backup-prf-p1] <strong>vrrp-id 5 interface Eth-Trunk2.1</strong>
[<span class="keyword">*</span>BRAS1-rm-backup-prf-p1]<strong> nas logic-port</strong> <strong>Eth-Trunk2</strong> 
[<span class="keyword">*</span>BRAS1-rm-backup-prf-p1] <strong>nas logic-ip 10.10.1.1</strong>
[<span class="keyword">*</span>BRAS1-rm-backup-prf-p1] <strong>nas logic-sysname huawei</strong>
[<span class="keyword">*</span>BRAS1-rm-backup-prf-p1] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
<p># Bind the RBP to the interface through which users go online.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>interface </strong><strong>Eth-Trunk2</strong>.<strong>10</strong>
[<span class="keyword">*</span>BRAS1-Eth-Trunk2.10] <strong>remote-backup-profile p1</strong>
[<span class="keyword">*</span>BRAS1-Eth-Trunk2.10] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
</p></li><li><span>Configure the EDSG service.</span><p><p># Enable the value-added service function.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>value-added-service enable</strong>
<strong>[</strong><span class="keyword">*</span>BRAS1]<strong> </strong><strong>commit</strong></pre>
<p># Configure the HW-Policy-Name attribute to support EDSG service delivery.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>radius-attribute hw-policy-name support-type edsg</strong>
[<span class="keyword">*</span>BRAS1]<strong> </strong><strong>commit</strong></pre>
<p># Configure an EDSG traffic policy.</p>
<ol type="a"><li>Create a service group.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>service-group edsg</strong>
[<span class="keyword">*</span>BRAS1]<strong> </strong><strong>commit</strong></pre>
</li><li>Configure ACL rules for the service group.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>acl number 6100</strong>
[<span class="keyword">*</span>BRAS1-acl4-basic-6100] <strong>description edsg</strong>
[<span class="keyword">*</span>BRAS1-acl4-basic-6100] <strong>rule 5 permit ip source service-group edsg destination ip-address 192.168.100.0 0.0.0.255</strong>
[<span class="keyword">*</span>BRAS1-acl4-basic-6100] <strong>rule 10 permit ip source ip-address 192.168.100.0 0.0.0.255 destination service-group edsg</strong>
[<span class="keyword">*</span>BRAS1-acl4-basic-6100] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>acl ipv6 number 6100</strong>
[<span class="keyword">*</span>BRAS1-acl6-basic-6100] <strong>rule 5 permit ipv6 source service-group edsg destination ipv6-address 2001:db8::3:2/32</strong>
[<span class="keyword">*</span>BRAS1-acl6-basic-6100] <strong>rule 10 permit ipv6 source ipv6-address 2001:db8::3:2/32 destination service-group edsg</strong>
[<span class="keyword">*</span>BRAS1-acl6-basic-6100] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
</li><li>Configure a traffic classifier.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>traffic cl</strong><strong>assifier edsg-c1</strong>
[<span class="keyword">*</span>BRAS1-classifier-edsg-c1] <strong>if-match acl 6100</strong>
[<span class="keyword">*</span>BRAS1-classifier-edsg-c1] <strong>if-match ipv6 acl 6100</strong>
[<span class="keyword">*</span>BRAS1-classifier-edsg-c1] <strong>q</strong><strong>uit</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
</li><li>Configure a traffic behavior.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>traffic behavior edsg-b1</strong>
[<span class="keyword">*</span>BRAS1-edsg-b1] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
</li><li>Configure a traffic policy.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>traffic</strong><strong> policy p1</strong>
[<span class="keyword">*</span>BRAS1-traffic-policy-p1] <strong>classifier edsg-c1 behavior edsg-b1</strong> <strong>precedence 1</strong>
[<span class="keyword">*</span>BRAS1-traffic-policy-p1] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
</li><li>Apply the EDSG traffic policy globally.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>traffic-policy </strong><strong>p1</strong><strong> inbound</strong>
[<span class="keyword">*</span>BRAS1] <strong>traffic-policy </strong><strong>p1</strong><strong> outbound</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
</li></ol>
<p># Configure an EDSG service policy.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>service-policy name service_edsg1 edsg</strong>
[<span class="keyword">*</span>BRAS1-service-policy-service_edsg1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-service-policy-service_edsg1] <strong>radius-server group rd1</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-service-policy-service_edsg1] <strong>authentication-scheme none</strong>
[<span class="keyword">*</span>BRAS1-service-policy-service_edsg1] <strong>accounting-scheme acct1</strong>
[<span class="keyword">*</span>BRAS1-service-policy-service_edsg1] <strong>service-group edsg</strong>
[<span class="keyword">*</span>BRAS1-service-policy-service_edsg1] <strong>rate-limit cir 100000 pir 100000 inbound</strong>
[<span class="keyword">*</span>BRAS1-service-policy-service_edsg1] <strong>rate-limit cir 100000 pir 100000 outbound</strong>
[<span class="keyword">*</span>BRAS1-service-policy-service_edsg1] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1-service-policy-service_edsg1] <strong>commit</strong></pre>
</p></li><li><span>Configure the distributed CGN service.</span><p><p># Set the session table sizes of the CPUs on the NAT service boards in slots <span>3</span> and <span>2</span> to 16M.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>license</strong>
[<span class="keyword">*</span>BRAS1-license] <strong>active nat session-table size 16 slot <span>3</span> engine </strong><strong>0</strong>
[<span class="keyword">*</span>BRAS1-license] <strong>active nat session-table size 16 slot <span>2</span> engine </strong><strong>0</strong>
[<span class="keyword">*</span>BRAS1-license] <strong>active nat bandwidth-enhance slot <span>3</span> engine 0</strong>
[<span class="keyword">*</span>BRAS1-license] <strong>active nat bandwidth-enhance slot <span>2</span> engine 0</strong>
[<span class="keyword">*</span>BRAS1-license] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
<p># Create service-location group 1 and bind it to service boards.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>service-location 1</strong>
[<span class="keyword">*</span>BRAS1-service-location-1] <strong>location slot <span>3</span> engine 0</strong>
[<span class="keyword">*</span>BRAS1-service-location-1] <strong>remote-backup interface Eth-Trunk4.1 peer 192.168.5.98</strong>
[<span class="keyword">*</span>BRAS1-service-location-1] <strong>vrrp vrid 101 interface Eth-Trunk4.1</strong>
[<span class="keyword">*</span>BRAS1-service-location-1] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
<p># Create service-location group 2 and bind it to service boards.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>service-location 2</strong>
[<span class="keyword">*</span>BRAS1-service-location-2] <strong>location slot <span>2</span> engine 0</strong> 
[<span class="keyword">*</span>BRAS1-service-location-2] <strong>remote-backup interface Eth-Trunk4.1 peer 192.168.5.98</strong>
[<span class="keyword">*</span>BRAS1-service-location-2] <strong>vrrp vrid 101 interface Eth-Trunk4.1</strong>
[<span class="keyword">*</span>BRAS1-service-location-2] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
<p># Configure VRRP group 5 to monitor the service-location groups.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>interface </strong><strong>Eth-Trunk2.1 </strong>  
[<span class="keyword">*</span>BRAS1-Eth-Trunk2.1] <strong>vrrp vrid 5 track service-location 1 reduced  50</strong>
[<span class="keyword">*</span>BRAS1-Eth-Trunk2.1] <strong>vrrp vrid 5 track service-location 2 reduced  50</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-Eth-Trunk2.1] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
<p># Create VRRP group 101 on Eth-Trunk 4.1, set the virtual IP address of the VRRP group to 192.168.5.99, configure the VRRP group as an mVRRP group, set BRAS1's priority in the VRRP group to 120, and set the VRRP preemption delay to 1800s.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>interface Eth-Trunk4.1</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-Eth-Trunk4.1] <strong>vlan-type dot1q 101</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-Eth-Trunk4.1] <strong>ip address 192.168.5.97 255.255.255.248</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-Eth-Trunk4.1] <strong>vrrp vrid 101 virtual-ip 192.168.5.99</strong>
[<span class="keyword">*</span>BRAS1-Eth-Trunk4.1] <strong>admin-vrrp vrid 101 ignore-if-down</strong>
[<span class="keyword">*</span>BRAS1-Eth-Trunk4.1] <strong>vrrp vrid 101 priority 120</strong>
[<span class="keyword">*</span>BRAS1-Eth-Trunk4.1] <strong>vrrp vrid 101 preempt-mode timer delay 1800 </strong>
[<span class="keyword">*</span>BRAS1-Eth-Trunk4.1] <strong>vrrp vrid 101 track interface GigabitEthernet </strong><strong><span>0/1/0</span></strong><strong> reduced 50</strong>
[<span class="keyword">*</span>BRAS1-Eth-Trunk4.1] <strong>vrrp vrid 101 track service-location 1 reduced  50</strong>
[<span class="keyword">*</span>BRAS1-Eth-Trunk4.1] <strong>vrrp vrid 101 track service-location 2 reduced  50</strong>
[<span class="keyword">*</span>BRAS1-Eth-Trunk4.1] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
<p># Create service-instance groups and bind each to a created service-location group.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>service-instance-group nat444-group1</strong>
[<span class="keyword">*</span>BRAS1-service-instance-group-nat444-1] <strong>service-location 1</strong>
[<span class="keyword">*</span>BRAS1-service-instance-group-nat444-1] <strong>remote-backup-service s1</strong>
[<span class="keyword">*</span>BRAS1-service-instance-group-nat444-1] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1-service-instance-group-nat444-1]<strong> commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>service-instance-group nat444-group2</strong>
[<span class="keyword">*</span>BRAS1-service-instance-group-nat444-2] <strong>service-location 2</strong>
[<span class="keyword">*</span>BRAS1-service-instance-group-nat444-2] <strong>remote-backup-service s1</strong>
[<span class="keyword">*</span>BRAS1-service-instance-group-nat444-2] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1-service-instance-group-nat444-2]<strong> commit</strong></pre>
<p># Create a NAT instance named <strong>nat444-1</strong>, bind service-instance group <strong>nat444-group1</strong> to it to specify the corresponding service board resources, and configure a port range.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>nat instance nat444-1 id 1</strong>
[<span class="keyword">*</span>BRAS1-nat-instance-nat444-1] <strong>service-instance-group nat444-group1</strong>
[<span class="keyword">*</span>BRAS1-nat-instance-nat444-1] <strong>port-range 4096</strong> </pre>
<p># Configure public addresses.</p>
<pre class="screen">[<span class="keyword">*</span>BRAS1-nat-instance-nat444-1] <strong>nat address-group pppoe-public-1 group-id 1</strong>
[<span class="keyword">*</span>BRAS1-nat-instance-nat444-1-nat-address-group-pppoe-public-1] <strong>section 0 10.1.1.0 mask 24</strong>
[<span class="keyword">*</span>BRAS1-nat-instance-nat444-1-nat-address-group-pppoe-public-1] <strong>section 1 10.3.1.0 mask 24</strong>
[<span class="keyword">*</span>BRAS1-nat-instance-nat444-1-nat-address-group-pppoe-public-1] <strong>quit</strong></pre>
<p># Enable ALG for all protocols and configure the 3-tuple mode.</p>
<pre class="screen">[<span class="keyword">*</span>BRAS1-nat-instance-nat444-1] <strong>nat alg all</strong>
[<span class="keyword">*</span>BRAS1-nat-instance-nat444-1] <strong>nat filter mode full-cone</strong>
[<span class="keyword">*</span>BRAS1-nat-instance-nat444-1] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Create a NAT instance named <strong>nat444-2</strong> and bind service-instance group named <strong>nat444-group2</strong> to it. The remaining configuration procedure is the same as that of NAT instance <strong>nat444-1</strong>, and is omitted here.</p>
</div></div>
<p># Configure user groups from which the users go online.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>user-group pppoe-nat-1</strong>
[<span class="keyword">*</span>BRAS1] <strong>user-group pppoe-nat-2</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
<p># Bind the NAT instances to the user groups in the AAA domain.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>aaa</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa]<strong> domain isp1</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa-domain-isp1]<strong> </strong><strong>user-group pppoe-nat-1 bind nat instance nat444-1</strong>
[<span class="keyword">*</span>BRAS1-aaa-domain-isp1]<strong> </strong><strong>user-group pppoe-nat-2 bind nat instance nat444-2</strong>
[<span class="keyword">*</span>BRAS1-aaa-domain-isp1]<strong> </strong><strong>quit</strong>
[<span class="keyword">*</span>BRAS1-aaa] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
<p># Configure a NAT traffic diversion policy.</p>
<ol type="a"><li>Define ACL rules for specified user groups.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>acl number 6000</strong>
[<span class="keyword">*</span>BRAS1-acl4-basic-6000] <strong>description for_pppoe-nat-1</strong>
[<span class="keyword">*</span>BRAS1-acl4-basic-6000] <strong>rule 5 permit ip source user-group pppoe-nat-1</strong>
[<span class="keyword">*</span>BRAS1-acl4-basic-6000] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>acl number 6001</strong>
[<span class="keyword">*</span>BRAS1-acl4-basic-6001] <strong>description for_pppoe-nat-2</strong>
[<span class="keyword">*</span>BRAS1-acl4-basic-6001] <strong>rule 5 permit ip source user-group pppoe-nat-2</strong>
[<span class="keyword">*</span>BRAS1-acl4-basic-6001] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>acl number 6002</strong>
[<span class="keyword">*</span>BRAS1-acl4-basic-6002] <strong>description for_pppoe-no-nat</strong>
[<span class="keyword">*</span>BRAS1-acl4-basic-6002] <strong>rule 5 permit ip source user-group pppoe-nat-2 destination ip-address 192.168.200.0 0.0.0.255</strong>
[<span class="keyword">*</span>BRAS1-acl4-basic-6002] <strong>rule 10 permit ip source user-group pppoe-nat-2 destination ip-address 10.168.200.0 0.0.0.255</strong>
[<span class="keyword">*</span>BRAS1-acl4-basic-6002] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
</li><li>Configure traffic classifiers.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>traffic cl</strong><strong>assifier nat-c1</strong>
[<span class="keyword">*</span>BRAS1-classifier-nat-c1] <strong>if-match acl 6000</strong>
[[<span class="keyword">*</span>BRAS1-classifier-nat-c1] <strong>q</strong><strong>uit</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>traffic cl</strong><strong>assifier nat-c2</strong>
[<span class="keyword">*</span>BRAS1-classifier-nat-c2] <strong>if-match acl 6001</strong>
[<span class="keyword">*</span>BRAS1-classifier-nat-c2] <strong>q</strong><strong>uit</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>traffic cl</strong><strong>assifier no-nat</strong>
[<span class="keyword">*</span>BRAS1-classifier-no-nat] <strong>if-match acl 6002</strong>
[<span class="keyword">*</span>BRAS1-classifier-no-nat] <strong>q</strong><strong>uit</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
</li><li>Configure traffic behaviors.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>traffic behavior nat-b1</strong>
[<span class="keyword">*</span>BRAS1-nat-b1] <strong>nat bind instance</strong> <strong>nat444-1</strong>
[<span class="keyword">*</span>BRAS1-nat-b1] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>traffic behavior nat-b2</strong>
[<span class="keyword">*</span>BRAS1-nat-b2] <strong>nat bind instance</strong> <strong>nat444-2</strong>
[<span class="keyword">*</span>BRAS1-nat-b2] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>traffic behavior no-nat</strong>
[<span class="keyword">*</span>BRAS1-no-nat] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
</li><li>Configure a traffic policy.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>traffic</strong><strong> policy p1</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-traffic-policy-p1] <strong>classifier no-nat behavior no-nat</strong> <strong>precedence 2</strong>
[<span class="keyword">*</span>BRAS1-traffic-policy-p1] <strong>classifier nat-c1 behavior nat-b1</strong> <strong>precedence 3</strong>
[<span class="keyword">*</span>BRAS1-traffic-policy-p1] <strong>classifier nat-c2 behavior nat-b2</strong> <strong>precedence 4</strong>
[<span class="keyword">*</span>BRAS1-traffic-policy-p1] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
</li><li>Apply the NAT traffic policy in the inbound direction.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>traffic-policy </strong><strong>p1</strong><strong> inbound</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
</li></ol>
</p><p><p># Configure a NAT conversion policy.</p>
<ol type="a"><li>Configures an ACL rule.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>acl number 3000</strong>
[<span class="keyword">*</span>BRAS1-acl4-basic-3000] <strong>description for_nat-source</strong>
[<span class="keyword">*</span>BRAS1-acl4-basic-3000] <strong>rule 5 permit ip source 172.16.0.0 255.255.255.0</strong>
[<span class="keyword">*</span>BRAS1-acl4-basic-3000] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
</li><li>Configure a NAT conversion policy to perform NAT for user traffic.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>nat instance nat444-1</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-nat-instance-nat444-1] <strong>nat outbound 3000 address-group pppoe-public-1</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-nat-instance-nat444-1] <strong>quit</strong> 
[<span class="keyword">*</span>BRAS1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>nat instance nat444-2</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-nat-instance-nat444-2] <strong>nat outbound 3000 address-group pppoe-public-2</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-nat-instance-nat444-2] <strong>quit</strong> 
[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
</li></ol>
</p></li><li><span>Enable the function to advertise public routes.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>bgp 65008</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-bgp] <strong>ipv4-family unicast</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-bg-af-ipv4] <strong>network </strong><strong>0 10.1.1.0 </strong><strong>255.255.255.0</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-bg-af-ipv4] <strong>network </strong><strong>0 10.3.1.0</strong><strong> 255.255.255.0</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-bg-af-ipv4] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-bg] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>commit</strong></pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001199312302__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li>BRAS1 configuration file</li></ul>
<pre class="screen">#
sysname BRAS1
#
vrrp recover-delay 300
# 
license  
 active nat session-table size 16 slot <span>3</span> engine 0  
 active nat session-table size 16 slot <span>2</span> engine 0  
 active nat bandwidth-enhance slot <span>3</span> engine 0
 active nat bandwidth-enhance slot <span>2</span> engine 0
#
radius local-ip all
#
radius-attribute hw-policy-name support-type edsg
#
radius-server group rd1                                                       
 radius-server shared-key-cipher %^%#e,yC%f9z4M2)b)2<font style="font-size:8pt" Face="Courier New" >~</font>r+lA{$g*Fzc+5/bu7VHAN&lt;%(%^% 
 radius-server authentication 192.168.7.249 1812 weight 0                       
 radius-server accounting 192.168.7.249 1813 weight 0                           
 radius-server class-as-car
 radius-server source interface LoopBack1                                                     
 radius-server calling-station-id include mac                                   
 radius-server user-name original                                               
# 
radius-server authorization 192.168.8.249 shared-key-cipher<strong> </strong>%^%#e,yC%f9z4M2)b)2<font style="font-size:8pt" Face="Courier New" >~</font>r+lA{$g*Fzc+5/bu7VHAN&lt;%(%^% server-group rd1
#
user-group pppoe-nat-1 
user-group pppoe-nat-2
#
ip pool pool_v4 bas local                                                       
 gateway 172.16.0.1 255.255.255.0                                               
 section 0 172.16.0.2 172.16.0.200                                              
 dns-server 10.179.155.161 10.179.155.177                                       
#                                                                               
ipv6 prefix pre_nd_1 delegation                                                   
 prefix 2001:DB8:1::/48                                                         
 slaac-unshare-only                                                             
#                                                                               
ipv6 pool pool_nd_1 bas delegation                                                
 dns-server 2001:DB8::2:2 2001:DB8::2:3                                         
 prefix pre_nd_1                                                                 
#                                                                               
ipv6 prefix pre_pd_1 delegation                                                   
 prefix 2001:DB8:2::/48                                                         
 pd-unshare-only                                                                
#                                                                               
ipv6 pool pool_pd_1 bas delegation                                                
 dns-server 2001:DB8::2:2 2001:DB8::2:3                                         
 prefix pre_pd_1
#                                                                               
ipv6 prefix pre_nd_2 delegation                                                   
 prefix 2001:DB8:3::/48                                                         
 slaac-unshare-only                                                             
#                                                                               
ipv6 pool pool_nd_2 bas delegation rui-slave                                                
 dns-server 2001:DB8::2:2 2001:DB8::2:3                                         
 prefix pre_nd_2                                                                  
#                                                                               
ipv6 prefix pre_pd_2 delegation                                                   
 prefix 2001:DB8:4::/48                                                         
 pd-unshare-only                                                                
#                                                                               
ipv6 pool pool_pd_2 bas delegation rui-slave                                              
 dns-server 2001:DB8::2:2 2001:DB8::2:3                                         
 prefix pre_pd_2 
#
remote-backup-service s1
 peer 10.13.13.13 source 10.3.3.3 port 6001
 track interface GigabitEthernet<span>0/1/0</span>
 protect lsp-tunnel for-all-instance peer-ip 10.13.13.13
 ip-pool pool_v4 metric 10
 ipv6-pool pool_nd_1 metric 10
 ipv6-pool pool_pd_1 metric 10
 ipv6-pool pool_nd_2 metric 20
 ipv6-pool pool_pd_2 metric 20
 radius-authorization source same-as nas-logic-ip
#
remote-backup-profile p1
 service-type bras
 backup-id 5 remote-backup-service s1
 peer-backup hot
 vrrp-id 5 interface Eth-Trunk2.1
 nas logic-port Eth-Trunk2 
 nas logic-ip 10.10.1.1
 nas logic-sysname huawei
#
bfd
#
bfd bfd bind peer-ip 192.168.4.130
 discriminator local 1 
 discriminator remote 1
#
mpls lsr-id 10.3.3.3
#
mpls
#
mpls ldp
#
acl number 3000                                                                 
 description for_nat-source                                                               
 rule 5 permit ip source 172.16.0.0 255.255.255.0 
#
service-location 1  
 location slot <span>3</span> engine 0
 remote-backup interface Eth-Trunk4.1 peer 192.168.5.98
 vrrp vrid 101 interface Eth-Trunk4.1 
# 
service-location 2  
 location slot <span>2</span> engine 0 backup slot <span>3</span> engine 0
 remote-backup interface Eth-Trunk4.1 peer 192.168.5.98
 vrrp vrid 101 interface Eth-Trunk4.1 
# 
service-instance-group nat444-group1  
 service-location 1
 remote-backup-service s1
#
service-instance-group nat444-group2  
 service-location 2
 remote-backup-service s1 
# 
nat instance nat444-1 id 1  
 service-instance-group nat444-group1  
 port-range 4096  
 nat address-group pppoe-public-1 group-id 1   
 section 0 10.1.1.0 mask 24
 section 1 10.3.1.0 mask 24  
 nat outbound 3000 address-group pppoe-public-1  
 nat alg all  
 nat filter mode full-cone 
#
nat instance nat444-2 id 1  
 service-instance-group nat444-group2  
 port-range 4096  
 nat address-group pppoe-public-2 group-id 1   
 section 0 10.1.1.0 mask 24
 section 1 10.3.1.0 mask 24  
 nat outbound 3000 address-group pppoe-public-2  
 nat alg all  
 nat filter mode full-cone 
# 
aaa
 #
 authentication-scheme auth1
 #
 authentication-scheme none
  authentication-scheme none
 #
 accounting-scheme acct1
<em> </em>#                                                                              
 domain isp1                                                                  
  authentication-scheme auth1                                                 
  accounting-scheme acct1                                                     
  radius-server group rd1                                                     
  prefix-assign-mode unshared                                                   
  ip-pool pool_v4                                                               
  ipv6-pool pool_nd_1                                                            
  ipv6-pool pool_pd_1
  user-group pppoe-nat-1 bind nat instance nat444-1
  user-group pppoe-nat-2 bind nat instance nat444-2
  accounting-start-delay 10 online user-type ppp  
  accounting-start-delay traffic-forward before-start-accounting                
  user-basic-service-ip-type ipv4                                               
#
value-added-service enable
#
service-group edsg
#                                                                               
acl number 6100                                                                 
 description edsg                                                               
 rule 5 permit ip source service-group edsg destination ip-address 192.168.100.0 0.0.0.255 
 rule 10 permit ip source ip-address 192.168.100.0 0.0.0.255 destination service-group edsg
#                                                                                
acl ipv6 number 6100                                                            
 rule 5 permit ipv6 source service-group edsg destination ipv6-address 2001:DB8::3:2/32  
 rule 10 permit ipv6 source ipv6-address 2001:DB8::3:2/32 destination service-group edsg 
#
acl number 6000                                                                 
 description for_pppoe-nat-1                                                               
 rule 5 permit ip source user-group pppoe-nat-1 
#
acl number 6001                                                                 
 description for_pppoe-nat-2                                                               
 rule 5 permit ip source user-group pppoe-nat-2
#
acl number 6002                                                                 
 description for_pppoe-no-nat                                                             
 rule 5 permit ip source user-group pppoe-nat-2 destination ip-address 192.168.200.0 0.0.0.255
 rule 10 permit ip source user-group pppoe-nat-2 destination ip-address 10.168.200.0 0.0.0.255
#
dhcpv6 duid 00010001280ef7a400e0fc904b50
#                                                                               
traffic classifier edsg-c1 operator or                                          
 if-match acl 6100 precedence 1                                                 
 if-match ipv6 acl 6100 precedence 2                                            
#
traffic classifier nat-c1 operator or                                          
 if-match acl 6000                                                                                  
# 
traffic classifier nat-c2 operator or                                          
 if-match acl 6001                                                                                  
# 
traffic classifier no-nat operator or                                          
 if-match acl 6002                                                                                  
# 
traffic behavior edsg-b1
#
traffic behavior nat-b1
 nat bind instance nat444-1
#
traffic behavior nat-b2
 nat bind instance nat444-2
# 
traffic behavior no-nat
# 
traffic policy p1                                                               
 share-mode                                                                     
 classifier edsg-c1 behavior edsg-b1 precedence 1
 classifier no-nat behavior no-nat precedence 2
 classifier nat-c1 behavior nat-b1 precedence 3
 classifier nat-c2 behavior nat-b2 precedence 4
#                                                                              
service-policy name service_edsg1 edsg                                          
 authentication-scheme none  
 accounting-scheme acct1                                                 
 radius-server group rd1   
<strong> </strong>service-group edsg                                                
 rate-limit cir 100000 pir 100000 inbound                                       
 rate-limit cir 100000 pir 100000 outbound                                      
#     
interface Virtual-Template5
 ppp authentication-mode chap
#
interface LoopBack1
 ipv6 enable
 ip address 10.2.2.2 255.255.255.0
 ipv6 address 2001:DB8::2:2/64
 ipv6 address auto link-local
#
interface LoopBack2
 ip address 10.3.3.3 255.255.255.0
#
interface Eth-Trunk2
 mode lacp-static                                                               
 lacp timeout fast                                                              
#
interface  Eth-Trunk2.1
 vlan-type dot1q 96
 ip address 192.168.4.129 255.255.255.248
 vrrp vrid 5 virtual-ip 192.168.4.131
<strong> </strong>admin-vrrp vrid 5
 vrrp vrid 5 priority 120
 vrrp vrid 5 preempt-mode timer delay 1800
 vrrp vrid 5 track interface GigabitEthernet<span>0/1/0</span> reduced 50
 vrrp vrid 5 track bfd-session session-name bfd1 link
 vrrp vrid 5 track service-location 1 reduced 50
 vrrp vrid 5 track service-location 2 reduced 50
#
interface Eth-Trunk2.10                                                         
 ipv6 enable                                                                    
 ipv6 address auto link-local                                                   
 statistic enable                                                               
 user-vlan 1000 4000 qinq 2000 2001
 remote-backup-profile p1
 pppoe-server bind Virtual-Template 5                                             
 bas                                                                            
 #                                                                              
  access-type layer2-subscriber default-domain authentication isp1            
  client-option82 basinfo-insert cn-telecom  
 #                                                                              
#                                                                               
interface GigabitEthernet<span>0/1/0</span>                                                  
 undo shutdown                                                                  
 ipv6 enable                                                                    
 ip address 10.2.1.1 255.255.255.0                                              
 ipv6 address 2001:DB8:8::7/128                                                 
 ipv6 address auto link-local
 mpls
 mpls ldp
#
interface Eth-Trunk4.1
 vlan-type dot1q 101
 ip address 192.168.5.97 255.255.255.248
 vrrp vrid 101 virtual-ip 192.168.5.99
 admin-vrrp vrid 101 ignore-if-down
 vrrp vrid 101 priority 120
 vrrp vrid 101 preempt-mode timer delay 1800
 vrrp vrid 101 track interface GigabitEthernet<span>0/1/0</span> reduced 50
 vrrp vrid 101 track service-location 1 reduced 50
 vrrp vrid 101 track service-location 2 reduced 50
#
traffic-policy p1 inbound
traffic-policy p1 outbound
#
peer-backup route-cost auto-advertising
#
ospf 1
 default cost inherit-metric
 import-route unr
 opaque-capability enable
 area 0.0.0.0
  network 10.2.1.0 0.0.0.255
  network 10.3.3.3 0.0.0.0
#
bgp 65008 
 #  
  ipv4-family unicast     
 <strong> </strong>network 0 10.1.1.0 255.255.255.0   
  network 0 10.3.1.0 255.255.255.0   
#
return</pre>
<ul><li>BRAS2 configuration file</li></ul>
<pre class="screen">#
sysname BRAS2
#
vrrp recover-delay 300
# 
license  
 active nat session-table size 16 slot <span>3</span> engine 0  
 active nat session-table size 16 slot <span>2</span> engine 0  
 active nat bandwidth-enhance slot <span>3</span> engine 0
 active nat bandwidth-enhance slot <span>2</span> engine 0
#
radius local-ip all
#
radius-attribute hw-policy-name support-type edsg
#
radius-server group rd1                                                       
 radius-server shared-key-cipher %^%#e,yC%f9z4M2)b)2<font style="font-size:8pt" Face="Courier New" >~</font>r+lA{$g*Fzc+5/bu7VHAN&lt;%(%^% 
 radius-server authentication 192.168.7.249 1812 weight 0                       
 radius-server accounting 192.168.7.249 1813 weight 0                           
 radius-server class-as-car
 radius-server source interface LoopBack1                                                     
 radius-server calling-station-id include mac                                   
 radius-server user-name original                                               
# 
radius-server authorization 192.168.8.249 shared-key-cipher<strong> </strong>%^%#e,yC%f9z4M2)b)2<font style="font-size:8pt" Face="Courier New" >~</font>r+lA{$g*Fzc+5/bu7VHAN&lt;%(%^% server-group rd1
#
user-group pppoe-nat-1 
user-group pppoe-nat-2
#
ip pool pool_v4 bas local rui-slave                                                      
 gateway 172.16.0.1 255.255.255.0                                               
 section 0 172.16.0.2 172.16.0.200                                              
 dns-server 10.179.155.161 10.179.155.177                                       
#                                                                               
ipv6 prefix pre_nd_1 delegation                                                   
 prefix 2001:DB8:1::/48                                                         
 slaac-unshare-only                                                             
#                                                                               
ipv6 pool pool_nd_1 bas delegation rui-slave                                                
 dns-server 2001:DB8::2:2 2001:DB8::2:3                                         
 prefix pre_nd_1                                                                  
#                                                                               
ipv6 prefix pre_pd_1 delegation                                                   
 prefix 2001:DB8:2::/48                                                         
 pd-unshare-only                                                                
#                                                                               
ipv6 pool pool_pd_1 bas delegation rui-slave                                                
 dns-server 2001:DB8::2:2 2001:DB8::2:3                                         
 prefix pre_pd_1
#                                                                               
ipv6 prefix pre_nd_2 delegation                                                   
 prefix 2001:DB8:3::/48                                                         
 slaac-unshare-only                                                             
#                                                                               
ipv6 pool pool_nd_2 bas delegation                                                
 dns-server 2001:DB8::2:2 2001:DB8::2:3                                         
 prefix pre_nd_2                                                                  
#                                                                               
ipv6 prefix pre_pd_2 delegation                                                   
 prefix 2001:DB8:4::/48                                                         
 pd-unshare-only                                                                
#                                                                               
ipv6 pool pool_pd_2 bas delegation                                               
 dns-server 2001:DB8::2:2 2001:DB8::2:3                                         
 prefix pre_pd_2 
#
remote-backup-service s1
 peer 10.3.3.3 source 10.13.13.13 port 6001
 track interface GigabitEthernet<span>0/1/0</span>
 protect lsp-tunnel for-all-instance peer-ip 10.3.3.3
 ip-pool pool_v4 metric 10
 ipv6-pool pool_nd_1 metric 20
 ipv6-pool pool_pd_1 metric 20
 ipv6-pool pool_nd_2 metric 10
 ipv6-pool pool_pd_2 metric 10
 radius-authorization source same-as nas-logic-ip
#
remote-backup-profile p1
 service-type bras
 backup-id 5 remote-backup-service s1
 peer-backup hot
 vrrp-id 5 interface Eth-Trunk2.1
 nas logic-port Eth-Trunk2 
 nas logic-ip 10.10.1.1
 nas logic-sysname huawei
#
bfd
#
bfd bfd bind peer-ip 192.168.4.129
 discriminator local 1 
 discriminator remote 1
#
#
mpls lsr-id 10.13.13.13
#
mpls
#
mpls ldp
#
acl number 3000                                                                 
 description for_nat-source                                                               
 rule 5 permit ip source 172.16.0.0 255.255.255.0 
#
service-location 1  
 location slot <span>3</span> engine 0
 remote-backup interface Eth-Trunk4.1 peer 192.168.5.97
 vrrp vrid 101 interface Eth-Trunk4.1 
# 
service-location 2  
 location slot <span>2</span> engine 0 backup slot <span>3</span> engine 0
 remote-backup interface Eth-Trunk4.1 peer 192.168.5.97
 vrrp vrid 101 interface Eth-Trunk4.1 
# 
service-instance-group nat444-group1  
 service-location 1
 remote-backup-service s1
#
service-instance-group nat444-group2  
 service-location 2
 remote-backup-service s1 
# 
nat instance nat444-1 id 1  
 service-instance-group nat444-group1  
 port-range 4096  
 nat address-group pppoe-public-1 group-id 1   
 section 0 10.1.1.0 mask 24
 section 1 10.3.1.0 mask 24  
 nat outbound 3000 address-group pppoe-public-1  
 nat alg all  
 nat filter mode full-cone 
#
nat instance nat444-2 id 1  
 service-instance-group nat444-group2  
 port-range 4096  
 nat address-group pppoe-public-2 group-id 1   
 section 0 10.1.1.0 mask 24
 section 1 10.3.1.0 mask 24  
 nat outbound 3000 address-group pppoe-public-2  
 nat alg all  
 nat filter mode full-cone 
# 
aaa
 #
 authentication-scheme auth1
 #
 authentication-scheme none
  authentication-scheme none
 #
 accounting-scheme acct1
<em> </em>#                                                                              
 domain isp1                                                                  
  authentication-scheme auth1                                                 
  accounting-scheme acct1                                                     
  radius-server group rd1                                                     
  prefix-assign-mode unshared                                                   
  ip-pool pool_v4                                                               
  ipv6-pool pool_nd_2                                                             
  ipv6-pool pool_pd_2
  user-group pppoe-nat-1 bind nat instance nat444-1
  user-group pppoe-nat-2 bind nat instance nat444-2
  accounting-start-delay 10 online user-type ppp  
  accounting-start-delay traffic-forward before-start-accounting                
  user-basic-service-ip-type ipv4                                               
#  
value-added-service enable
#
service-group edsg
#                                                                               
acl number 6100                                                                 
 description edsg                                                               
 rule 5 permit ip source service-group edsg destination ip-address 192.168.100.0 0.0.0.255 
 rule 10 permit ip source ip-address 192.168.100.0 0.0.0.255 destination service-group edsg
#                                                                                
acl ipv6 number 6100                                                            
 rule 5 permit ipv6 source service-group edsg destination ipv6-address 2001:DB8::/32  
 rule 10 permit ipv6 source ipv6-address 2001:DB8::/32 destination service-group edsg 
#
acl number 6000                                                                 
 description for_pppoe-nat-1                                                               
 rule 5 permit ip source user-group pppoe-nat-1
#
acl number 6001                                                                 
 description for_pppoe-nat-2                                                               
 rule 5 permit ip source user-group pppoe-nat-2 
#
acl number 6002                                                                 
 description for_pppoe-no-nat                                                             
 rule 5 permit ip source user-group pppoe-nat-2 destination ip-address 192.168.200.0 0.0.0.255
 rule 10 permit ip source user-group pppoe-nat-2 destination ip-address 10.168.200.0 0.0.0.255  
#
dhcpv6 duid 00010001280ef7a400e0fc904b50
#                                                                               
traffic classifier edsg-c1 operator or                                          
 if-match acl 6100 precedence 1                                                 
 if-match ipv6 acl 6100 precedence 2                                            
#
traffic classifier nat-c1 operator or                                          
 if-match acl 6000                                                                                  
# 
traffic classifier nat-c2 operator or                                          
 if-match acl 6001                                                                                  
# 
traffic classifier no-nat operator or                                          
 if-match acl 6002                                                                                  
# 
traffic behavior edsg-b1
#
traffic behavior nat-b1
 nat bind instance nat444-1
#
traffic behavior nat-b2
 nat bind instance nat444-2
# 
traffic behavior no-nat
# 
traffic policy p1                                                               
 share-mode                                                                     
 classifier edsg-c1 behavior edsg-b1 precedence 1
 classifier no-nat behavior no-nat precedence 2
 classifier nat-c1 behavior nat-b1 precedence 3
 classifier nat-c2 behavior nat-b2 precedence 4
#                                                                              
service-policy name service_edsg1 edsg                                          
 authentication-scheme none  
 accounting-scheme acct1                                                 
 radius-server group rd1   
<strong> </strong>service-group edsg                                                
 rate-limit cir 100000 pir 100000 inbound                                       
 rate-limit cir 100000 pir 100000 outbound                                      
#   
interface Virtual-Template5
 ppp authentication-mode chap
#
interface LoopBack1
 ipv6 enable
 ip address 10.4.4.4 255.255.255.0
 ipv6 address 2001:DB8::3:3/64
 ipv6 address auto link-local
#      
interface LoopBack2
 ip address 10.13.13.13 255.255.255.0
#  
interface Eth-Trunk2
 mode lacp-static                                                               
 lacp timeout fast                                                              
#
interface Eth-Trunk2.1
 vlan-type dot1q 96
 ip address 192.168.4.130 255.255.255.248
 vrrp vrid 5 virtual-ip 192.168.4.131
 admin-vrrp vrid 5
 vrrp vrid 5 priority 100
 vrrp vrid 5 track bfd-session session-name bfd1 peer
#
interface Eth-Trunk2.10                                                         
 ipv6 enable                                                                    
 ipv6 address auto link-local                                                   
 statistic enable                                                               
 user-vlan 1000 4000 qinq 2000 2001
 remote-backup-profile p1
 pppoe-server bind Virtual-Template 5                                                
 bas                                                                            
 #                                                                              
  access-type layer2-subscriber default-domain authentication isp1            
  client-option82 basinfo-insert cn-telecom  
 #                                                                              
#                                                                               
interface GigabitEthernet<span>0/1/0</span>                                                  
 undo shutdown                                                                  
 ipv6 enable                                                                    
 ip address 10.4.1.1 255.255.255.0                                              
 ipv6 address 2001:DB8:9::7/128                                                 
 ipv6 address auto link-local
 mpls
 mpls ldp
#
interface Eth-Trunk4.1
 vlan-type dot1q 101
 ip address 192.168.5.98 255.255.255.248
 vrrp vrid 101 virtual-ip 192.168.5.99
 admin-vrrp vrid 101 ignore-if-down
 vrrp vrid 101 priority 100
#
traffic-policy p1 inbound
traffic-policy p1 outbound
#
peer-backup route-cost auto-advertising
#
ospf 1
 default cost inherit-metric
 import-route unr
 opaque-capability enable
 area 0.0.0.0
  network 10.4.1.0 0.0.0.255
  network 10.13.13.13 0.0.0.0
#
bgp 65008 
 #  
  ipv4-family unicast     
 <strong> </strong>network 0 10.1.1.0 255.255.255.0   
  network 0 10.3.1.0 255.255.255.0   
#
return</pre>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cfg_rui_0050.html">Configuration Examples
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cfg_rui_0065.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cfg_rui_1005.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>