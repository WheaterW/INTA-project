
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring User Access (Web+MAC Authentication) in a Dual-Device Hot Backup Scenario">
<meta name="abstract" content="This section provides an example for configuring user access (web+MAC authentication) in a dual-device hot backup scenario, so that users can access the network again without re-entering usernames and passwords within a specified period after their first login. A networking diagram is provided to help you understand the configuration scenario and procedure.">
<meta name="description" content="This section provides an example for configuring user access (web+MAC authentication) in a dual-device hot backup scenario, so that users can access the network again without re-entering usernames and passwords within a specified period after their first login. A networking diagram is provided to help you understand the configuration scenario and procedure.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cfg_rui_0050.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cfg_rui_0062.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cfg_rui_1002.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="z00588052,w00606909,w00447999">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="UP Multi-Device Backup">
<meta name="featurename" content="User Access Multi-Device Backup">
<meta name="featuretype" content="User Access">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="UP Multi-Device Backup">
<meta name="featurename" content="User Access Multi-Device Backup">
<meta name="featuretype" content="User Access">
<meta name="featurename" content="UP Multi-Device Backup">
<meta name="featurename" content="User Access Multi-Device Backup">
<meta name="featuretype" content="User Access">
<meta name="featurename" content="User Access Multi-Device Backup">
<meta name="featuretype" content="User Access">
<meta name="OWNER" content="l00425560">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="z00588052">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172374423">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring User Access (Web+MAC Authentication) in a Dual-Device Hot Backup Scenario</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172374423"></a><a name="EN-US_TASK_0172374423"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring User Access (Web+MAC Authentication) in a Dual-Device Hot Backup Scenario</h1>
<div class="taskbody"><p>This section provides an example for configuring user access (web+MAC authentication) in a dual-device hot backup scenario, so that users can access the network again without re-entering usernames and passwords within a specified period after their first login. A networking diagram is provided to help you understand the configuration scenario and procedure.</p>
<div class="context"><a name="EN-US_TASK_0172374423__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0172374423__fig_dc_ne_cfg_rui_003101">Figure 1</a>, users access BRAS1 and BRAS2 through SW1. When a user accesses the Internet for the first time, the user is required to enter the username and password on the portal page. The RADIUS server automatically records the MAC address of the user terminal and associates the MAC address with the username. Later, the user can access the network again without re-entering the username and password within a specified period after the first login.</p>
<p>In dual-device hot backup scenarios, the networking planning for web+MAC authentication is as follows:</p>
<ul><li><p>RADIUS authentication and accounting are used.</p>
</li><li><p>The RADIUS server address is 192.168.7.249. The authentication and accounting port numbers are 1812 and 1813, respectively. The standard RADIUS protocol is adopted, and the key is <strong>YsHsjx_202206</strong>.</p>
</li><li><p>The IP address of the DNS server is 192.168.9.111.</p>
</li><li><p>The IP address of the web server is 192.168.8.251.</p>
</li></ul>
<div class="fignone" id="EN-US_TASK_0172374423__fig_dc_ne_cfg_rui_003101"><a name="EN-US_TASK_0172374423__fig_dc_ne_cfg_rui_003101"></a><a name="fig_dc_ne_cfg_rui_003101"></a><span class="figcap"><b>Figure 1 </b>User access (web+MAC authentication) in a dual-device hot backup scenario</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interfaces 1 through 3 represent GE<span>0/3/1</span>, GE<span>0/3/6</span>, and GE<span>0/3/2</span>, respectively.</p>
</div></div>
<p><span><img class="vsd" src="figure/en-us_image_0000001769883254.png"></span></p>
<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary=""><tr><td valign="top"><p><strong>Device</strong></p>
</td>
<td valign="top"><p><strong>Interface</strong></p>
</td>
<td valign="top"><p><strong>IP Address</strong></p>
</td>
<td valign="top"><p><strong>Function</strong></p>
</td>
</tr>
<tr><td valign="top"><p>BRAS1</p>
</td>
<td valign="top"><p>GE<span>0/3/1</span></p>
</td>
<td valign="top"><p>10.32.1.1/24</p>
</td>
<td valign="top"><p>BRAS1's interface for establishing an RBS channel</p>
</td>
</tr>
<tr><td valign="top"><p>BRAS1</p>
</td>
<td valign="top"><p>GE<span>0/3/6</span>.1</p>
</td>
<td valign="top"><p>10.24.0.1/24</p>
</td>
<td valign="top"><p>Interface running VRRP</p>
</td>
</tr>
<tr><td valign="top"><p>BRAS1</p>
</td>
<td valign="top"><p>Loopback1</p>
</td>
<td valign="top"><p>10.1.1.1/32</p>
</td>
<td valign="top"><p>Protection tunnel interface</p>
</td>
</tr>
<tr><td valign="top"><p>BRAS2</p>
</td>
<td valign="top"><p>GE<span>0/3/2</span></p>
</td>
<td valign="top"><p>10.32.1.2/24</p>
</td>
<td valign="top"><p>BRAS2's interface for establishing an RBS channel</p>
</td>
</tr>
<tr><td valign="top"><p>BRAS2</p>
</td>
<td valign="top"><p>GE<span>0/3/6</span>.1</p>
</td>
<td valign="top"><p>10.24.0.2/24</p>
</td>
<td valign="top"><p>Interface running VRRP</p>
</td>
</tr>
<tr><td valign="top"><p>BRAS2</p>
</td>
<td valign="top"><p>Loopback1</p>
</td>
<td valign="top"><p>10.1.1.2/32</p>
</td>
<td valign="top"><p>Protection tunnel interface</p>
</td>
</tr>
</table></div>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172374423__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure basic user access functions and ensure that the two devices for backup have the same configuration.</p>
</li><li><p>Configure VRRP on the access side of the master and backup BRASs. BRAS1 is the master, and BRAS2 is the backup.</p>
</li><li><p>Configure a remote backup service (RBS) and a remote backup profile (RBP) for backing up BRAS user information.</p>
</li><li><p>Configure Layer 2 IPoE access (web+MAC authentication).</p>
</li><li><p>Specify the source IP address of portal packets to be sent to the web authentication server.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172374423__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>VRRP parameters (such as the VRRP ID and preemption delay)</p>
</li><li><p>IP address of each interface on BRAS1 and BRAS2</p>
</li><li><p>Backup ID, which works together with an RBS to identify an RBP to which users belong</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172374423__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure VRRP on the access side of the master and backup BRASs. BRAS1 is the master, and BRAS2 is the backup.</span><p><p>The configurations on BRAS1 are as follows:</p>
<p># Configure a VRRP group on an interface (GE<span>0/3/6</span>.1 is used as an example).</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname BRAS1</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>interface GigabitEthernet <span>0/3/6</span>.1</strong>               
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/3/6</span>.1] <strong>vlan-type dot1q 400</strong>                           
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/3/6</span>.1] <strong>ip address 10.24.0.1 255.255.255.0</strong>            
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/3/6</span>.1] <strong>vrrp vrid 1 virtual-ip 10.24.0.100</strong>            
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/3/6</span>.1] <strong>admin-vrrp vrid 1</strong>                             
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/3/6</span>.1] <strong>vrrp vrid 1 priority 120</strong>                      
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/3/6</span>.1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-GigabitEthernet<span>0/3/6</span>.1] <strong>quit</strong></pre>
<p>The configurations on BRAS2 are as follows:</p>
<p># Configure a VRRP group on an interface (GE<span>0/3/6</span>.1 is used as an example).</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname BRAS2</strong>
[<span class="keyword">*</span>BRAS2] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2] <strong>interface GigabitEthernet <span>0/3/6</span>.1</strong>               
[<span class="keyword">*</span>BRAS2-GigabitEthernet<span>0/3/6</span>.1] <strong>vlan-type dot1q 400</strong>                           
[<span class="keyword">*</span>BRAS2-GigabitEthernet<span>0/3/6</span>.1] <strong>ip address 10.24.0.2 255.255.255.0</strong>            
[<span class="keyword">*</span>BRAS2-GigabitEthernet<span>0/3/6</span>.1] <strong>vrrp vrid 1 virtual-ip 10.24.0.100</strong>            
[<span class="keyword">*</span>BRAS2-GigabitEthernet<span>0/3/6</span>.1] <strong>admin-vrrp vrid 1</strong>                             
[<span class="keyword">*</span>BRAS2-GigabitEthernet<span>0/3/6</span>.1] <strong>vrrp vrid 1 priority 110</strong>                      
[<span class="keyword">*</span>BRAS2-GigabitEthernet<span>0/3/6</span>.1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-GigabitEthernet<span>0/3/6</span>.1] <strong>quit</strong></pre>
</p></li><li><span>Configure an RBS and an RBP.</span><p><p>The configurations on BRAS1 are as follows:</p>
<p># Configure an IP address for the protection tunnel.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>interface loopback1</strong>
[<span class="keyword">*</span>BRAS1-loopback1] <strong>ip address 10.1.1.1 32</strong>
[<span class="keyword">*</span>BRAS1-loopback1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-loopback1] <strong>quit</strong></pre>
<p># Configure an RBS interface.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>interface gigabitethernet <span>0/3/1</span></strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/3/1</span>] <strong>undo shutdown</strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/3/1</span>] <strong>ip address 10.32.1.1 24</strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/3/1</span>] <strong>mpls</strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/3/1</span>] <strong>mpls ldp</strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/3/1</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-GigabitEthernet<span>0/3/1</span>] <strong>quit</strong></pre>
<p># Configure an RBS.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>remote-backup-service s1</strong>
[<span class="keyword">*</span>BRAS1-rm-backup-srv-s1] <strong>peer 10.32.1.2 source 10.32.1.1 port 11000</strong>
[<span class="keyword">*</span>BRAS1-rm-backup-srv-s1] <strong>protect lsp-tunnel for-all-instance peer-ip 10.1.1.2</strong>
[<span class="keyword">*</span>BRAS1-rm-backup-srv-s1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-rm-backup-srv-s1] <strong>quit</strong></pre>
<p># Configure an RBP.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>remote-backup-profile p1</strong>
[<span class="keyword">*</span>BRAS1-rm-backup-prf-p1] <strong>service-type bras</strong>
[<span class="keyword">*</span>BRAS1-rm-backup-prf-p1] <strong>backup-id 1 remote-backup-service s1</strong>
[<span class="keyword">*</span>BRAS1-rm-backup-prf-p1] <strong>peer-backup hot</strong>
[<span class="keyword">*</span>BRAS1-rm-backup-prf-p1] <strong>vrrp-id 1 interface gigabitethernet <span>0/3/6</span>.1</strong>
[<span class="keyword">*</span>BRAS1-rm-backup-prf-p1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-rm-backup-prf-p1] <strong>quit</strong></pre>
<p># Bind the RBP to the interface through which users go online.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>interface gigabitethernet <span>0/3/6</span>.2</strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/3/6</span>.2] <strong>remote-backup-profile p1</strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/3/6</span>.2] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-GigabitEthernet<span>0/3/6</span>.2] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>quit</strong></pre>
<p>The configurations on BRAS2 are as follows:</p>
<p># Configure an IP address for the protection tunnel.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2] <strong>interface loopback1</strong>
[<span class="keyword">*</span>BRAS2-loopback1] <strong>ip address 10.1.1.2 32</strong>
[<span class="keyword">*</span>BRAS2-loopback1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-loopback1] <strong>quit</strong></pre>
<p># Configure an RBS interface.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2] <strong>interface gigabitethernet <span>0/3/2</span></strong>
[<span class="keyword">*</span>BRAS2-GigabitEthernet<span>0/3/2</span>] <strong>undo shutdown</strong>
[<span class="keyword">*</span>BRAS2-GigabitEthernet<span>0/3/2</span>] <strong>ip address 10.32.1.2 24</strong>
[<span class="keyword">*</span>BRAS2-GigabitEthernet<span>0/3/2</span>] <strong>mpls</strong>
[<span class="keyword">*</span>BRAS2-GigabitEthernet<span>0/3/2</span>] <strong>mpls ldp</strong>
[<span class="keyword">*</span>BRAS2-GigabitEthernet<span>0/3/2</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-GigabitEthernet<span>0/3/2</span>] <strong>quit</strong></pre>
<p># Configure an RBS.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2] <strong>remote-backup-service s1</strong>
[<span class="keyword">*</span>BRAS2-rm-backup-srv-s1] <strong>peer 10.32.1.1 source 10.32.1.2 port 11000</strong>
[<span class="keyword">*</span>BRAS2-rm-backup-srv-s1] <strong>protect lsp-tunnel for-all-instance peer-ip 10.1.1.1</strong>
[<span class="keyword">*</span>BRAS2-rm-backup-srv-s1] <strong>ip-pool pool2</strong>
[<span class="keyword">*</span>BRAS2-rm-backup-srv-s1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-rm-backup-srv-s1] <strong>quit</strong></pre>
<p># Configure an RBP.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2] <strong>remote-backup-profile p1</strong>
[<span class="keyword">*</span>BRAS2-rm-backup-prf-p1] <strong>service-type bras</strong>
[<span class="keyword">*</span>BRAS2-rm-backup-prf-p1] <strong>backup-id 1 remote-backup-service s1</strong>
[<span class="keyword">*</span>BRAS2-rm-backup-prf-p1] <strong>peer-backup hot</strong>
[<span class="keyword">*</span>BRAS2-rm-backup-prf-p1] <strong>vrrp-id 1 interface gigabitethernet <span>0/3/6</span>.1</strong>
[<span class="keyword">*</span>BRAS2-rm-backup-prf-p1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-rm-backup-prf-p1] <strong>quit</strong></pre>
<p># Bind the RBP to the interface through which users go online.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2] <strong>interface gigabitethernet <span>0/3/6</span>.2</strong>
[<span class="keyword">*</span>BRAS2-GigabitEthernet<span>0/3/6</span>.2] <strong>remote-backup-profile p1</strong>
[<span class="keyword">*</span>BRAS2-GigabitEthernet<span>0/3/6</span>.2] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-GigabitEthernet<span>0/3/6</span>.2] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2] <strong>quit</strong></pre>
</p></li><li><span>Configure MPLS.</span><p><p>The configurations on BRAS1 are as follows:</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>mpls lsr-id 10.1.1.1</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>mpls</strong>
[<span class="keyword">*</span>BRAS1-mpls] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-mpls] <strong>mpls ldp</strong>
[<span class="keyword">*</span>BRAS1-mpls-ldp] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-mpls] <strong>quit</strong></pre>
<p>The configurations on BRAS2 are as follows:</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2] <strong>mpls lsr-id 10.1.1.2</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2] <strong>mpls</strong>
[<span class="keyword">*</span>BRAS2-mpls] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-mpls] <strong>mpls ldp</strong>
[<span class="keyword">*</span>BRAS2-mpls-ldp] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-mpls] <strong>quit</strong></pre>
</p></li><li><span>Configure OSPF.</span><p><p>The configurations on BRAS1 are as follows:</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>ospf 1</strong>
[<span class="keyword">*</span>BRAS1-ospf-1] <strong>default cost inherit-metric</strong>
[<span class="keyword">*</span>BRAS1-ospf-1] <strong>import-route unr</strong>
[<span class="keyword">*</span>BRAS1-ospf-1] <strong>area 0</strong>
[<span class="keyword">*</span>BRAS1-ospf-1-area-0.0.0.0] <strong>network 10.1.1.1 0.0.0.0</strong>
[<span class="keyword">*</span>BRAS1-ospf-1-area-0.0.0.0] <strong>network 10.32.1.1 0.0.0.255</strong>
[<span class="keyword">*</span>BRAS1-ospf-1-area-0.0.0.0] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-ospf-1-area-0.0.0.0] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-ospf-1] <strong>quit</strong></pre>
<p>The configurations on BRAS2 are as follows:</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2] <strong>ospf 1</strong>
[<span class="keyword">*</span>BRAS2-ospf-1] <strong>default cost inherit-metric</strong>
[<span class="keyword">*</span>BRAS2-ospf-1] <strong>import-route unr</strong>
[<span class="keyword">*</span>BRAS2-ospf-1] <strong>area 0</strong>
[<span class="keyword">*</span>BRAS2-ospf-1-area-0.0.0.0] <strong>network 10.1.1.2 0.0.0.0</strong>
[<span class="keyword">*</span>BRAS2-ospf-1-area-0.0.0.0] <strong>network 10.32.1.2 0.0.0.255</strong>
[<span class="keyword">*</span>BRAS2-ospf-1-area-0.0.0.0] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-ospf-1-area-0.0.0.0] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-ospf-1] <strong>quit</strong></pre>
</p></li><li><span>Configure Layer 2 IPoE access (web+MAC authentication).</span><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The configuration on BRAS2 is similar to the configuration on BRAS1. The configuration on BRAS1 is used in this example. For details about the configuration on BRAS2, see the BRAS2 configuration file.</p>
</div></div>
<ol type="a"><li><p>Create a MAC authentication domain named <strong>mac-auth</strong>, a web authentication domain named <strong>web-auth</strong>, and a post-authentication domain named <strong>after-auth</strong>.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt;<strong> system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>aaa</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-aaa] <strong>domain mac-auth</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-aaa-domain-mac-auth] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa-domain-mac-auth] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa] <strong>domain web-auth</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-aaa-domain-web-auth] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa-domain-web-auth] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa] <strong>domain after-auth</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-aaa-domain-after-auth] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa-domain-after-auth] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa] <strong>quit</strong></pre>
</li><li><p>Configure AAA schemes and a RADIUS server group.</p>
<p># Create a RADIUS server group named <strong>rd1</strong>. In the RADIUS server group view, configure the BRAS to carry the Hw-Auth-Type attribute in authentication request packets. </p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>radius-server group rd1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-radius-rd1]<strong> radius-server authentication 192.168.7.249 1812 weight 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-radius-rd1]<strong> radius-server accounting 192.168.7.249 1813 weight 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-radius-rd1]<strong> radius-server type standard</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-radius-rd1]<strong> radius-server shared-key-cipher YsHsjx_202206</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-radius-rd1] <strong>radius-server attribute translate</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-radius-rd1] <strong>radius-attribute include HW-Auth-Type</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-radius-rd1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-radius-rd1] <strong>quit</strong></pre>
<p># Configure a RADIUS server group named <strong>rd2</strong>.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1]<strong> radius-server group rd2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-radius-rd2]<strong> radius-server authentication 192.168.8.249 1812 weight 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-radius-rd2]<strong> radius-server accounting 192.168.8.249 1813 weight 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-radius-rd2]<strong> radius-server type standard</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-radius-rd2]<strong> radius-server shared-key-cipher YsHsjx_202206</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-radius-rd2] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-radius-rd2]<strong> quit</strong></pre>
<p># Create an authentication scheme named <strong>mac-auth</strong>, and configure the device to redirect the user to the web authentication domain <strong>web-auth</strong> when authentication fails.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>aaa</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa] <strong>authentication-scheme mac-auth</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-aaa-authen-mac-auth] <strong>authening authen-fail online authen-domain web-auth</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-aaa-authen-mac-auth] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa-authen-mac-auth] <strong>quit</strong></pre>
<p># Set the authentication mode of the authentication scheme <strong>auth2</strong> to RADIUS authentication so that the authentication scheme can be bound to the authentication domain <strong>after-auth</strong> for user authentication.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1]<strong> aaa</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa]<strong> authentication-scheme auth2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-aaa-authen-auth2]<strong> authentication-mode radius</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-aaa-authen-auth2] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa-authen-auth2]<strong> quit</strong></pre>
<p># Set the accounting mode of the accounting scheme <strong>acct2</strong> to RADIUS accounting so that the accounting scheme can be bound to the authentication domain <strong>after-auth</strong> for user accounting.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa]<strong> accounting-scheme acct2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-aaa-accounting-acct2]<strong> accounting-mode radius</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-aaa-accounting-acct2] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa-accounting-acct2]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa]<strong> quit</strong></pre>
<p># Set the authentication mode of the authentication scheme <strong>auth3</strong> to none authentication so that the authentication scheme can be bound to the web pre-authentication domain <strong>web-auth</strong>. Users in this domain can access only the web authentication page. In insecure network environments, you are advised to use a secure password authentication mode, encryption authentication algorithm, and protocol. For examples of secure authentication, see RADIUS authentication of the authentication scheme <strong>auth2</strong> in this example.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1]<strong> aaa</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-aaa]<strong> authentication-scheme auth3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-aaa-authen-auth3]<strong> authentication-mode none</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-aaa-authen-auth3] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa-authen-auth3]<strong> quit</strong></pre>
<p># Set the accounting mode of the accounting scheme <strong>acct3</strong> to none accounting so that the accounting scheme can be bound to the web pre-authentication domain <strong>web-auth</strong>. No accounting is performed for users in this domain.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa]<strong> accounting-scheme acct3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-aaa-accounting-acct3]<strong> accounting-mode none</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-aaa-accounting-acct3] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa-accounting-acct3]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa]<strong> quit</strong></pre>
</li><li><p>Configure address pools.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1]<strong> ip pool pool2 bas local</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-ip-pool-pool2]<strong> gateway 172.16.1.1 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-ip-pool-pool2] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-ip-pool-pool2]<strong> section 0 172.16.1.2 172.16.1.200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-ip-pool-pool2]<strong> dns-server 192.168.9.111</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-ip-pool-pool2] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-ip-pool-pool2]<strong> quit</strong></pre>
</li><li><p>Enable MAC authentication in the MAC authentication domain <strong>mac-auth</strong>, and bind the RADIUS server group <strong>rd1</strong> and authentication scheme <strong>mac-auth</strong> to the domain.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa] <strong>domain mac-auth</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-aaa-domain-mac-auth] <strong>radius-server group rd1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-aaa-domain-mac-auth] <strong>authentication-scheme mac-auth</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-aaa-domain-mac-auth] <strong>accounting-scheme acct2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-aaa-domain-mac-auth] <strong>ip-pool pool2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-aaa-domain-mac-auth] <strong>mac-authentication enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-aaa-domain-mac-auth] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa-domain-mac-auth] <strong>quit</strong></pre>
</li><li><p>Configure a web pre-authentication domain named <strong>web-auth</strong> to allow users in this domain to access only the web authentication page. Then, bind the authentication scheme <strong>auth3</strong> (none authentication) and accounting scheme <strong>acct3</strong> (none accounting) to this domain.</p>
<p># Configure a web pre-authentication domain named <strong>web-auth</strong>.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1]<strong> user-group web-before</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1]<strong> aaa</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa]<strong> domain web-auth</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-aaa-domain-web-auth]<strong> authentication-scheme auth3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-aaa-domain-web-auth]<strong> accounting-scheme acct3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-aaa-domain-web-auth]<strong> ip-pool pool2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-aaa-domain-web-auth]<strong> user-group web-before</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-aaa-domain-web-auth]<strong> web-server 192.168.8.251</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-aaa-domain-web-auth]<strong> web-server url http://192.168.8.251</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-aaa-domain-web-auth]<strong> commit</strong></pre>
<p># Configure the keyword of the customized Portal attribute.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa-domain-web-auth]<strong> web-server redirect-key mscg-ip mscgip</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-aaa-domain-web-auth]<strong> web-server redirect-key mscg-name mscgname</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-aaa-domain-web-auth]<strong> web-server redirect-key user-ip-address userip</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-aaa-domain-web-auth]<strong> web-server redirect-key nas-logic-sysname nasname</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-aaa-domain-web-auth]<strong> web-server redirect-key user-mac-address usermac</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-aaa-domain-web-auth]<strong> web-server redirect-key ssid wlan</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-aaa-domain-web-auth]<strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa-domain-web-auth]<strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa] <strong>quit</strong></pre>
<p># Configure a web authentication server.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1]<strong> web-auth-server 192.168.8.251 key cipher</strong> <strong>YsHsjx_202206</strong></pre>
</li><li><p>Configure an authentication domain named <strong>after-auth</strong>.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa]<strong> domain after-auth</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-aaa-domain-after-auth]<strong> authentication-scheme auth2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-aaa-domain-after-auth]<strong> accounting-scheme acct2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-aaa-domain-after-auth]<strong> radius-server group rd2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-aaa-domain-after-auth] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa-domain-after-auth]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa]<strong> quit</strong></pre>
</li><li><p>Configure ACL rules.</p>
<p># Configure an ACL numbered 6004 and create ACL rules to deny the traffic originating from the user group <strong>web-before</strong>.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1]<strong> acl number 6004</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-acl-ucl-6004] <strong>rule 3 permit ip source user-group web-before destination user-group web-before</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-acl-ucl-6004] <strong>rule 5 permit ip source user-group web-before destination ip-address any</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-acl-ucl-6004] <strong>quit</strong></pre>
<p># Configure an ACL numbered 6005 and create ACL rules to permit the traffic between the user group <strong>web-before</strong> and the web authentication server and between the user group <strong>web-before</strong> and the DNS server.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1]<strong> acl number 6005</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-acl-ucl-6005] <strong>rule 5 permit ip source user-group web-before destination ip-address 192.168.8.251 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-acl-ucl-6005] <strong>rule 15 permit ip source user-group web-before destination ip-address 192.168.9.111 0</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-acl-ucl-6005] <strong>quit</strong></pre>
<p># Configure an ACL numbered 6008 and create ACL rules to allow HTTP redirection for the TCP packets originating from user group <strong>web-before</strong> and carrying destination port www or 8080.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1]<strong> acl number 6008</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-acl-ucl-6008]<strong> rule 5 permit tcp source user-group web-before destination-port eq www</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-acl-ucl-6008] <strong>rule 10 permit tcp source user-group web-before destination-port eq 8080</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-acl-ucl-6008] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-acl-ucl-6008] <strong>quit</strong></pre>
</li><li><p>Configure traffic classifiers.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1]<strong> traffic classifier web-be-permit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-classifier-web-be-permit]<strong> if-match acl 6005</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-classifier-web-be-permit]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1]<strong> traffic classifier web-be-deny</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-classifier-web-be-deny]<strong> if-match acl 6004</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-classifier-web-be-deny]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1]<strong> traffic classifier redirect</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-classifier-redirect]<strong> if-match acl 6008</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-classifier-redirect]<strong> </strong><strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-classifier-redirect]<strong> quit</strong></pre>
</li><li><pre class="screen">[<span class="keyword">*</span>BRAS1]<strong> traffic behavior perm1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-behavior-perm1]<strong> permit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-behavior-perm1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1]<strong> traffic behavior deny1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-behavior-deny1]<strong> deny</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-behavior-deny1]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-behavior-deny1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1]<strong> traffic behavior redirect</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-behavior-redirect]<strong> http-redirect plus</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-behavior-redirect]<strong> </strong><strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-behavior-redirect]<strong> quit</strong></pre>
</li><li><p>Configure and apply a traffic policy.</p>
<p># Configure a traffic policy.</p>
<pre class="screen">[<span class="keyword">*</span>BRAS1]<strong> traffic policy web</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-policy-web]<strong> share-mode</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-policy-web]<strong> classifier web-be-permit behavior perm1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-policy-web]<strong> classifier redirect behavior redirect</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-policy-web]<strong> classifier web-be-deny behavior deny1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-policy-web] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-policy-web]<strong> quit</strong></pre>
<p># Apply the traffic policy in the system view.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1]<strong> traffic-policy web inbound</strong></pre>
</li><li><p>In the AAA view, configure the MAC address carried in user access request packets as the pure username.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa] <strong>default-user-name include mac-address</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-aaa] <strong>default-password cipher YsHsjx_202206</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-aaa] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa] <strong>quit</strong></pre>
</li><li><p>Configure the access type of the BAS interface.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>license</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-license]<strong> active bas </strong><strong>slot <span>1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-license] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-license]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>interface GigabitEthernet<span>0/3/6</span>.2</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-GigabitEthernet<span>0/3/6</span>.2] <strong>bas</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/3/6</span>.2-bas] <strong>access-type layer2-subscriber default-domain pre-authentication mac-auth authentication after-auth</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/3/6</span>.2-bas] <strong>authentication-method web</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/3/6</span>.2-bas] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-GigabitEthernet<span>0/3/6</span>.2-bas] <strong>quit</strong></pre>
</li></ol>
</p></li><li><span>Specify the source IP address of portal packets to be sent to the web authentication server.</span><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The configuration on BRAS2 is similar to the configuration on BRAS1. The configuration on BRAS1 is used in this example. For details about the configuration on BRAS2, see the BRAS2 configuration file.</p>
</div></div>
<p># Configure the source IP address of portal packets sent by the device to the web authentication server to 192.168.8.252 in the remote backup service <strong>s1</strong>.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>remote-backup-service s1</strong>
[<span class="keyword">*</span>BRAS1-rm-backup-srv-s1] <strong>web-auth-server source 192.168.8.252</strong>
[<span class="keyword">*</span>BRAS1-rm-backup-srv-s1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-rm-backup-srv-s1] <strong>quit</strong></pre>
</p></li><li><span>Verify the configuration. </span><p><p># Check the RBS configuration on BRAS1. The command output shows that the TCP connection state (<strong>TCP-State</strong>) of the RBS is <strong>Connected</strong>.</p>
<pre class="screen">&lt;BRAS1&gt; <strong>display remote-backup-service s1</strong></pre>
<pre class="screen">----------------------------------------------------------
 Service-Index    : 1
 Service-Name     : s1
 TCP-State        : Connected
 Peer-ip          : 10.32.1.2
 Source-ip        : 10.32.1.1
 TCP-Port         : 11000
 Track-BFD        : -
 SSL-Policy-Name  : --
 SSL-State        : --
 Last up time     : 2019-03-06 09:03:59
 Last down time   : 2019-03-06 06:28:37
 Last down reason : TCP closed for echo time out
 Uplink state     : 2 (1:DOWN 2:UP)
 Domain-map-list  : --
----------------------------------------------------------
 ip pool:  
 ipv6 pool:  
 NULL0 Static route tag:
 Failure ratio    : 100%
 Failure duration : 0 min
----------------------------------------------------------
 Rbs-ID         : 0
 Peer-ip        : 10.1.1.2
 Vrfid          : 0
 Tunnel-state   : UP
 Tunnel-OperFlag: NORMAL
 Spec-interface : Null
 Total users    : 1
 Path 1:
     Tunnel-index   : 0x4c4b42
     Tunnel-index-v6: 0x4c4b42
     Out-interface  : GigabitEthernet<span>0/3/1</span>
     Vc-lable       : 48210
     Vc-lable-v6    : 48211
     User-number    : --
     Public-Lsp-Load: TRUE
----------------------------------------------------------
 Rbs-ID         : 0
 Protect-type   : public(LSP)
 Peer-ip        : 10.1.1.2
 Vrfid          : 4294967295
 Tunnel-state   : UP
 Tunnel-OperFlag: NORMAL
 Spec-interface : Null
 Total users    : 0
 Path 1:
     Tunnel-index   : 0x4c4b42
     Tunnel-index-v6: 0x0
     Out-interface  : GigabitEthernet<span>0/3/1</span>
     Vc-lable       : 4294967295
     Vc-lable-v6    : 4294967295
     User-number    : --
     Public-Lsp-Load: TRUE</pre>
<p># Check the RBP configuration on BRAS1. The command output shows that the state of the local end is <strong>Master</strong> and that of the peer end is <strong>Slave</strong>.</p>
<pre class="screen">&lt;BRAS1&gt; <strong>display remote-backup-profile p1</strong></pre>
<pre class="screen">----------------------------------------------------------
 Profile-Index        : 0x1000
 Profile-Name         : p1
 Service              : bras 
 Remote-backup-service: s1
 Backup-ID            : 1
 track protocol       : VRRP
 VRRP-ID              : 1
 VRRP-Interface       : GigabitEthernet<span>0/3/6</span>.1
 Access-Control       : --
 State                : Master
 Peer State           : Slave
 Interface            :
                        GigabitEthernet<span>0/3/6</span>.2
 Backup mode          : hot
 Slot-Number          : 3
 Card-Number          : 0
 Port-Number          : 6
 Traffic threshold       : 50(MB)
 Traffic interval       : 10(minutes)
 Forwarding Configured: Slave Forwarding </pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172374423__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>BRAS1 configuration file</p>
<pre class="screen">#
sysname BRAS1
#
license
 active bas slot <span>1</span>
#
vlan batch 5 400
#
user-group web-before
#
radius-server group rd2
 radius-server shared-key-cipher %^%#0Iy%9Gu1),kLlP/jw;X-AOiZD%{YoCH&lt;RC(P*&gt;^5%^%#    
 radius-server authentication 192.168.8.249 1812 weight 0
 radius-server accounting 192.168.8.249 1813 weight 0
#               
radius-server group rd1
 radius-server shared-key-cipher %^%#)';d7xr::-'Nq3)5BO|-:WVZ7$|Tt,7rbP&amp;tz\()%^%#    
 radius-server authentication 192.168.7.249 1812 weight 0
 radius-server accounting 192.168.7.249 1813 weight 0
 radius-server attribute translate
 radius-attribute include HW-Auth-Type
#
soc
#
ip dcn vpn-instance __dcn_vpn__
 ipv4-family
#
mpls lsr-id 10.1.1.1
#
mpls
#
mpls ldp
#
ipv4-family
#               
ip pool pool2 bas local
 gateway 172.16.1.1 255.255.255.0
 section 0 172.16.1.2 172.16.1.200
 dns-server 192.168.9.111
#
remote-backup-service s1
 peer 10.32.1.2 source 10.32.1.1 port 11000
 protect lsp-tunnel for-all-instance peer-ip 10.1.1.2
 web-auth-server source 192.168.8.252
#
remote-backup-profile p1
 service-type bras
 backup-id 1 remote-backup-service s1
 peer-backup hot
 vrrp-id 1 interface GigabitEthernet<span>0/3/6</span>.1
#
acl number 6004
 rule 3 permit ip source user-group web-before destination user-group web-before
 rule 5 permit ip source user-group web-before destination ip-address any
#
acl number 6005
 rule 5 permit ip source user-group web-before destination ip-address 192.168.8.251 0
 rule 15 permit ip source user-group web-before destination ip-address 192.168.9.111 0
#
acl number 6008
 rule 5 permit tcp source user-group web-before destination-port eq www
 rule 10 permit tcp source user-group web-before destination-port eq 8080
#
traffic classifier redirect operator or
 if-match acl 6008
#
traffic classifier web-be-deny operator or
 if-match acl 6004
#
traffic classifier web-be-permit operator or
 if-match acl 6005
#
traffic behavior deny1
 deny
#
traffic behavior perm1
#
traffic behavior redirect
 http-redirect plus
#               
traffic policy web
 share-mode
 classifier web-be-permit behavior perm1 precedence 1
 classifier redirect behavior redirect precedence 2
 classifier web-be-deny behavior deny1 precedence 4
#
aaa
 default-user-name include mac-address 
 default-password cipher @%@%UyQs4,KTtSwJo(4QmW#K,LC:@%@% 
 #
 authentication-scheme mac-auth
  authening authen-fail online authen-domain web-auth
 #
 authentication-scheme auth2
 #
 authentication-scheme auth3
  authentication-mode none
 #
 accounting-scheme acct2
 #
 accounting-scheme acct3
  accounting-mode none
 #
 domain mac-auth
  authentication-scheme mac-auth
  accounting-scheme acct2
  radius-server group rd1
  ip-pool pool2
  mac-authentication enable
 #
 domain web-auth
  authentication-scheme auth3
  accounting-scheme acct3
  ip-pool pool2 
  user-group web-before
  web-server 192.168.8.251
  web-server url http://192.168.8.251
  web-server redirect-key mscg-ip mscgip
  web-server redirect-key mscg-name mscgname
  web-server redirect-key user-ip-address userip
  web-server redirect-key nas-logic-sysname nasname
  web-server redirect-key user-mac-address usermac
  web-server redirect-key ssid wlan
 #
 domain after-auth
  authentication-scheme auth2
  accounting-scheme acct2
  radius-server group rd2
#
interface GigabitEthernet<span>0/3/6</span>.1
 vlan-type dot1q 400
 ip address 10.24.0.1 255.255.255.0
 vrrp vrid 1 virtual-ip 10.24.0.100
 admin-vrrp vrid 1
 vrrp vrid 1 priority 120
#               
interface GigabitEthernet<span>0/3/6</span>.2
 statistic enable
 user-vlan 5
 remote-backup-profile p1
 bas
 #
  access-type layer2-subscriber default-domain pre-authentication mac-auth authentication after-auth
  authentication-method web
 #
#
interface GigabitEthernet<span>0/3/1</span>
 undo shutdown
 ip address 10.32.1.1 255.255.255.0
 mpls
 mpls ldp
 dcn
#
interface LoopBack1
 ip address 10.1.1.1 255.255.255.255
#
ospf 1
 default cost inherit-metric
 import-route unr
 area 0.0.0.0
  network 10.1.1.1 0.0.0.0
  network 10.32.1.1 0.0.0.255
#
ospf 65534 vpn-instance __dcn_vpn__
 description DCN ospf create by default
 opaque-capability enable
 hostname
 vpn-instance-capability simple
 area 0.0.0.0
  network 0.0.0.0 255.255.255.255
#
ip ip-prefix 192 index 10 permit 192.168.1.0 24
#
route-policy rui permit node 1
 if-match ip-prefix 192
 apply cost 10
#
traffic-policy web inbound
#
return</pre>
</li><li><p>BRAS2 configuration file</p>
<pre class="screen">#
license
 active bas slot <span>1</span>
#
sysname BRAS2
#
vlan batch 5 400
#
user-group web-before
#
radius-server group rd2
 radius-server shared-key-cipher %^%#EQ0X4:387-4{QP9I,j.Dbx1rRedx2PO.j]HJZW1Y%^%#    
 radius-server authentication 192.168.8.249 1812 weight 0
 radius-server accounting 192.168.8.249 1813 weight 0
#               
radius-server group rd1
 radius-server shared-key-cipher %^%#3<font style="font-size:8pt" Face="Courier New" >~</font>8T2}\sbBuWA|)^$&gt;07yX78&amp;.Q(W3DG$p"|h`NH%^%#    
 radius-server authentication 192.168.7.249 1812 weight 0
 radius-server accounting 192.168.7.249 1813 weight 0
 radius-server attribute translate
 radius-attribute include HW-Auth-Type
#
soc
#
ip dcn vpn-instance __dcn_vpn__
 ipv4-family
#
mpls lsr-id 10.1.1.2
#
mpls
#
mpls ldp
#
ipv4-family
#
ip pool pool2 bas local rui-slave
 gateway 172.16.1.1 255.255.255.0
 # LOCAL        
  section 0 172.16.1.2 172.16.1.200 
  dns-server 192.168.9.111
 # REMOTE 
#
remote-backup-service s1
 peer 10.32.1.1 source 10.32.1.2 port 11000
 protect lsp-tunnel for-all-instance peer-ip 10.1.1.1
 web-auth-server source 192.168.8.252
#
remote-backup-profile p1
 service-type bras
 backup-id 1 remote-backup-service s1
 peer-backup hot
 vrrp-id 1 interface GigabitEthernet<span>0/3/6</span>.1
#
acl number 6004
 rule 3 permit ip source user-group web-before destination user-group web-before
 rule 5 permit ip source user-group web-before destination ip-address any
#
acl number 6005
 rule 5 permit ip source user-group web-before destination ip-address 192.168.8.251 0
 rule 15 permit ip source user-group web-before destination ip-address 192.168.9.111 0
#
acl number 6008
 rule 5 permit tcp source user-group web-before destination-port eq www
 rule 10 permit tcp source user-group web-before destination-port eq 8080
#
traffic classifier redirect operator or
 if-match acl 6008
#
traffic classifier web-be-deny operator or
 if-match acl 6004
#
traffic classifier web-be-permit operator or
 if-match acl 6005
#
traffic behavior deny1
 deny
#
traffic behavior perm1
#
traffic behavior redirect
 http-redirect plus
#
traffic policy web
 share-mode
 classifier web-be-permit behavior perm1 precedence 1
 classifier redirect behavior redirect precedence 2
 classifier web-be-deny behavior deny1 precedence 4
#
aaa
 default-user-name include mac-address 
 default-password cipher @%@%UyQs4,KTtSwJo(4QmW#K,LC:@%@% 
 #
 authentication-scheme auth2
 #
 authentication-scheme auth3
  authentication-mode none
 #
 authentication-scheme mac-auth
  authening authen-fail online authen-domain web-auth
 #
 accounting-scheme acct2
 #
 accounting-scheme acct3
  accounting-mode none
 #
 domain mac-auth
  authentication-scheme mac-auth
  accounting-scheme acct2
  radius-server group rd1
  ip-pool pool2
  mac-authentication enable
 #
 domain web-auth
  authentication-scheme auth3
  accounting-scheme acct3
  ip-pool pool2
  user-group web-before
  web-server 192.168.8.251
  web-server url http://192.168.8.251
  web-server redirect-key mscg-ip mscgip
  web-server redirect-key mscg-name mscgname
  web-server redirect-key user-ip-address userip
  web-server redirect-key nas-logic-sysname nasname
  web-server redirect-key user-mac-address usermac
  web-server redirect-key ssid wlan
 #
 domain after-auth
  authentication-scheme auth2
  accounting-scheme acct2
  radius-server group rd2
#
interface LoopBack1
 ip address 10.1.1.2 255.255.255.255
#
#
interface GigabitEthernet<span>0/3/2</span>
 undo shutdown  
 ip address 10.32.1.2 255.255.255.0
 mpls
 mpls ldp
 dcn
#
interface GigabitEthernet<span>0/3/6</span>.1
 vlan-type dot1q 400
 ip address 10.24.0.2 255.255.255.0
 vrrp vrid 1 virtual-ip 10.24.0.100
 admin-vrrp vrid 1
 vrrp vrid 1 priority 110
#
interface GigabitEthernet<span>0/3/6</span>.2
 statistic enable
 user-vlan 5
 remote-backup-profile p1
 bas
 #
  access-type layer2-subscriber default-domain pre-authentication mac-auth authentication after-auth
  authentication-method web
 #
#
ospf 1
 default cost inherit-metric
 import-route unr
 area 0.0.0.0
  network 10.1.1.2 0.0.0.0
  network 10.32.1.2 0.0.0.255
#
ospf 65534 vpn-instance __dcn_vpn__
 description DCN ospf create by default
 opaque-capability enable
 hostname
 vpn-instance-capability simple
 area 0.0.0.0
  network 0.0.0.0 255.255.255.255
#
ip ip-prefix 192 index 10 permit 192.168.1.0 24
#
web-auth-server 192.168.8.251 port 50100 key cipher %^%#aQL6,Ua&lt;|@sxPQK/1f'4/GBJ6,6)q&gt;$Z^7*,!2yR%^%# 
#
traffic-policy web inbound
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cfg_rui_0050.html">Configuration Examples
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cfg_rui_0062.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cfg_rui_1002.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>