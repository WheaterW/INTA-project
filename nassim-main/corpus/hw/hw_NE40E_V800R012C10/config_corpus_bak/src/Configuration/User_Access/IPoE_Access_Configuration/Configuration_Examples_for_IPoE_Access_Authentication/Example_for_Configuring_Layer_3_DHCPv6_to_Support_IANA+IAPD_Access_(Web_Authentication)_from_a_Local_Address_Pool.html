
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Layer 3 DHCPv6 to Support IANA+IAPD Access (Web Authentication) from a Local Address Pool">
<meta name="abstract" content="This section provides an example for configuring Layer 3 DHCPv6 to support IANA+IAPD access. The example provides the networking requirements, configuration roadmap, configuration procedure, and configuration files.">
<meta name="description" content="This section provides an example for configuring Layer 3 DHCPv6 to support IANA+IAPD access. The example provides the networking requirements, configuration roadmap, configuration procedure, and configuration files.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_ipox_cfg_0083.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cfg_013596.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cfg_013611.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="z50024784,z00603461,w00800033,z00588052,ipoxne,c00549182,w00556928,l00593348,w00606909,w00447999,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="IPoE">
<meta name="featuretype" content="User Access">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="IPoE">
<meta name="featuretype" content="User Access">
<meta name="featurename" content="IPoE">
<meta name="featuretype" content="User Access">
<meta name="featurename" content="IPoE">
<meta name="featuretype" content="User Access">
<meta name="OWNER" content="c00549182">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="z00588052">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172374054">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring Layer 3 DHCPv6 to Support IANA+IAPD Access (Web Authentication) from a Local Address Pool</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172374054"></a><a name="EN-US_TASK_0172374054"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Layer 3 DHCPv6 to Support IANA+IAPD Access (Web Authentication) from a Local Address Pool</h1>
<div class="taskbody"><p>This section provides an example for configuring Layer 3 DHCPv6 to support IANA+IAPD access. The example provides the networking requirements, configuration roadmap, configuration procedure, and configuration files.</p>
<div class="context"><a name="EN-US_TASK_0172374054__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0172374054__fig_dc_ne_ipox_cfg_014801">Figure 1</a>, the networking requirements are as follows:</p>
<ul><li><p>A user belongs to the domain <strong>isp2</strong> and connects to GE <span>0/1/2</span>.1 on <span class="keyword">Device</span>B through <span class="keyword">Device</span>A, a DHCPv6 relay agent, in DHCPv6 (IANA+IAPD) mode.</p>
</li><li><p>Web authentication, RADIUS authentication, and RADIUS accounting are used.</p>
</li><li><p>The IP address of the RADIUS server is 192.168.8.249, and the authentication and accounting port numbers are 1812 and 1813, respectively. The standard RADIUS protocol is used, and the key is <strong>it-is-my-secret1</strong>.</p>
</li><li><p>The address of the DNS server is 2001:db8:3::1/64.</p>
</li><li><p>The address of the web server is 2001:db8:3::2/64, and the shared key is <strong>webvlan</strong>.</p>
</li></ul>
<div class="fignone" id="EN-US_TASK_0172374054__fig_dc_ne_ipox_cfg_014801"><a name="EN-US_TASK_0172374054__fig_dc_ne_ipox_cfg_014801"></a><a name="fig_dc_ne_ipox_cfg_014801"></a><span class="figcap"><b>Figure 1 </b>Configuring Layer 3 DHCPv6 to support IANA+IAPD access (web authentication)</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 through 4 in this example represent GE <span>0/1/1</span>, GE <span>0/1/2</span>, GE <span>0/1/1</span>.1, and GE <span>0/1/2</span>.1, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0172374056.png" width="NaN" height="NaN"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172374054__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>All functions are configured on <span class="keyword">Device</span>B except the DHCPv6 relay function. The configuration roadmap is as follows:</p>
<ol><li>Configure IP addresses for interfaces on <span class="keyword">Device</span>A and <span class="keyword">Device</span>B.</li><li><p>Configure DHCPv6 relay on <span class="keyword">Device</span>A.</p>
</li><li>Configure network-side address pools on <span class="keyword">Device</span>B. The gateway address of the address pools must be on the same network segment as the IP address of the inbound interface on <span class="keyword">Device</span>A, the DHCP relay agent.</li><li><p>Configure AAA schemes.</p>
</li><li>Configure an interface IP address for DeviceB to receive portal packets from the web authentication server.</li><li>Configure a web authentication server.</li><li><p>Configure a RADIUS server group.</p>
</li><li>Configure an ACL to allow the user to access only the web server address before web authentication succeeds.</li><li>Configure a DUID for the device.</li><li><p>Configure a domain.</p>
</li><li><p>Configure a BAS interface and an uplink interface.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172374054__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>Authentication scheme name and authentication mode</p>
</li><li><p>Accounting scheme name and accounting mode</p>
</li><li>Configure a username.</li><li><p>RADIUS server group name, and IP address and port numbers of the RADIUS authentication and accounting server</p>
</li><li><p>Address pool names</p>
</li><li><p>Domain names</p>
</li><li><p>BAS interface parameters</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172374054__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure IP addresses for interfaces on <span class="keyword">Device</span>A and <span class="keyword">Device</span>B.</span><p><p># Configure <span class="keyword">Device</span>A.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname <span class="keyword">Device</span>A</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>interface GigabitEthernet<span>0/1/2</span></strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/2</span>] <strong>ipv6 enable</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/2</span>2] <strong>ipv6 address 2001:db8:2::1/64</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/2</span>] <strong>ipv6 address auto link-local</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/2</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/2</span>2] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>interface GigabitEthernet1/0/1.1</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet1/0/1.1] <strong>ipv6 enable</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet1/0/1.1] <strong>ipv6 address 2001:db8:1::2/64</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet1/0/1.1] <strong>vlan-type dot1q 1</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet1/0/1.1] <strong>ipv6 address auto link-local</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet1/0/1.1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-GigabitEthernet1/0/1.1] <strong>quit</strong></pre>
<p># Configure <span class="keyword">Device</span>B.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname <span class="keyword">Device</span>B</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>interface GigabitEthernet1/0/2.1</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet1/0/2.1] <strong>ipv6 enable</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet1/0/2.1] <strong>ipv6 address 2001:db8:1::1/64</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet1/0/2.1] <strong>vlan-type dot1q 1</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet1/0/2.1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-GigabitEthernet1/0/2.1] <strong>quit</strong></pre>
</p></li><li><span>Configure DHCPv6 relay on <span class="keyword">Device</span>A.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>interface GigabitEthernet1/0/2</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-GigabitEthernet1/0/2] <strong>dhcp select relay</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet1/0/2] <strong>dhcpv6 relay destination 2001:db8:1::1</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet1/0/2] <strong>ipv6 address auto link-local</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet1/0/2] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-GigabitEthernet1/0/2] <strong>quit</strong></pre>
</p></li><li><span>Configure network-side address pools on <span class="keyword">Device</span>B. The gateway address of the address pools must be on the same network segment as the IP address of the inbound interface on <span class="keyword">Device</span>A, the DHCP relay agent.</span><p><p># Configure an IAPD prefix pool.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>ipv6 prefix prefixpd delegation</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-ipv6-prefix-prefixpd] <strong>prefix 2001:db8:5::/48</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-ipv6-prefix-prefixpd] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-ipv6-prefix-prefixpd] <strong>quit</strong></pre>
<p># Configure an IAPD address pool.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>ipv6 pool poolpd bas delegation</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-ipv6-pool-poolpd] <strong>prefix prefixpd</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-ipv6-pool-poolpd] <strong>dns-server</strong> <strong>2001:db8:3::1</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-ipv6-pool-poolpd] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-ipv6-pool-poolpd] <strong>quit</strong></pre>
<p># Configure an IANA prefix pool.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>ipv6 prefix na local</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-ipv6-prefix-na] <strong>prefix 2001:db8:2::/64</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-ipv6-prefix-na] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-ipv6-prefix-na] <strong>quit</strong></pre>
<p># Configure an IANA relay address pool.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>ipv6 pool na bas relay</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-ipv6-prefix-na] <strong>prefix na</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-ipv6-prefix-na] <strong>dns-server</strong> <strong>2001:db8:3::1</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-ipv6-prefix-na] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-ipv6-prefix-na] <strong>quit</strong></pre>
</p></li><li><span>Configure AAA schemes.</span><p><p># Configure an authentication scheme.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B]<strong> aaa</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-aaa]<strong> authentication-scheme auth2</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-aaa-authen-auth2]<strong> authentication-mode radius</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-aaa-authen-auth2]<strong> commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-aaa-authen-auth2]<strong> quit</strong></pre>
<p># Configure an accounting scheme.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-aaa]<strong> accounting-scheme acct2</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-aaa-accounting-acct2]<strong> accounting-mode radius</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-aaa-accounting-acct2]<strong> commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-aaa-accounting-acct2]<strong> quit</strong></pre>
</p></li><li><span>Configure the IPoE user password.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-aaa]<strong> </strong><strong>default-password cipher YsHsjx_202206</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-aaa]<strong> commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-aaa]<strong> quit</strong></pre>
</p></li><li><span>Configure an interface IP address for DeviceB to receive portal packets from the web authentication server.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>interface</strong> <strong>LoopBack 0</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-LoopBack0] <strong>ipv6 enable</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-LoopBack0] <strong>ipv6 address </strong><strong>2001:db8:3::3</strong><strong> 128</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-LoopBack0] <strong>ipv6 address auto link-local</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-LoopBack0] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-LoopBack0] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>web-auth-server source-ipv6 2001:db8:3::3</strong></pre>
</p></li><li><span>Configure a web authentication server.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B]<strong> web-auth-server enable</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>web-auth-server source interface </strong><strong>LoopBack 0</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>web-auth-server 2001:db8:3::3 key cipher Root_123</strong> </pre>
</p></li><li><span>Configure a RADIUS server group.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B]<strong> radius-server group rd2</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-radius-rd2]<strong> radius-server authentication 192.168.8.249 1812</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-radius-rd2]<strong> radius-server accounting 192.168.8.249 1813</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-radius-rd2]<strong> commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-radius-rd2]<strong> radius-server type standard</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-radius-rd2]<strong> radius-server shared-key-cipher it-is-my-secret1</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-radius-rd2]<strong> commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-radius-rd2]<strong> quit</strong></pre>
</p></li><li><span>Configure an ACL to allow the user to access only the web server address before web authentication succeeds.</span><p><p># Configure a user group.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B]<strong> user-group huawei</strong></pre>
<p># Configure an ACL numbered 6000 to permit the traffic between the user group <strong>huawei</strong> and the web authentication server and between the user group <strong>huawei</strong> and the DNS server.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>acl ipv6 number 6000</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>-acl6-ucl-6000]<strong> </strong><strong>rule permit ipv6 source user-group huawei destination ipv6-address </strong><strong>2001:db8:3::2/128</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-acl6-ucl-6000]<strong> </strong><strong>rule permit ipv6 </strong><strong>source ipv6-address </strong><strong>2001:db8:3::2/128</strong> <strong>destination </strong><strong>user-group huawei</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-acl6-ucl-6000] <strong>rule permit ipv6 source user-group huawei destination ipv6-address </strong><strong>2001:db8:3::1</strong><strong>/128</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-acl6-ucl-6000]<strong> rule permit ipv6 </strong><strong>source ipv6-address </strong><strong>2001:db8:3::1</strong><strong>/128</strong> <strong>destination </strong><strong>user-group huawei</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-acl6-ucl-6000] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-acl6-ucl-6000] <strong>quit</strong></pre>
<p># Configure an ACL numbered 6001 to allow redirection for the TCP packets originating from user group <strong>huawei</strong> and carrying destination port <strong>www</strong> or 8080.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>acl ipv6 number 6001</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-acl6-ucl-6001] <strong>rule permit tcp source user-group huawei destination-port eq www</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-acl6-ucl-6001] <strong>rule permit tcp source user-group huawei destination-port eq 8080</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-acl6-ucl-6001] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-acl6-ucl-6001] <strong>quit</strong></pre>
<p># Configure an ACL numbered 6002 to deny all traffic originating from the user group <strong>huawei</strong>.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>acl ipv6 number 6002</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-acl6-ucl-6002]<strong> rule permit ipv6 source ipv6-address any destination </strong><strong>user-group huawei</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-acl6-ucl-6002] <strong>rule deny ipv6 source user-group huawei destination ipv6-address any</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-acl6-ucl-6002] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-acl6-ucl-6002] <strong>quit</strong></pre>
<p># Configure traffic classifiers.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B]<strong> traffic classifier c1</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-classifier-c1] <strong>if-match ipv6 acl 6000</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-classifier-c1]<strong> commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-classifier-c1]<strong> quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>traffic classifier c2</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-classifier-c2] <strong>if-match ipv6 acl 6001</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-classifier-c2] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-classifier-c2] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>traffic classifier c3</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-classifier-c3] <strong>if-match ipv6 acl 6002</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-classifier-c3] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-classifier-c3] <strong>quit</strong></pre>
<p># Configure traffic behaviors.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B]<strong> traffic behavior b1</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-behavior-b1]<strong> permit</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-behavior-b1]<strong> commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-behavior-b1]<strong> quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>traffic behavior b2</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-behavior-b2] <strong>http-redirect</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-behavior-b2] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-behavior-b2] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B]<strong> traffic behavior b3</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-behavior-b3]<strong> </strong><strong>deny</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-behavior-b3]<strong> commit</strong></pre>
<p># Configure a traffic policy.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B]<strong> traffic policy policy</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-trafficpolicy-policy]<strong> classifier c1 behavior b1</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-trafficpolicy-policy]<strong> classifier c2 behavior b2</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-trafficpolicy-policy]<strong> classifier c3 behavior b3</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-trafficpolicy-policy]<strong> commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-trafficpolicy-policy]<strong> quit</strong></pre>
<p># Apply the traffic policy globally.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B]<strong> traffic-policy policy inbound</strong></pre>
</p></li><li><span>Configure a DUID for the device.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>dhcpv6 duid 12345678</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>commit</strong></pre>
</p></li><li><span>Configure domains.</span><p><p># Configure a pre-authentication domain named <strong>domain1</strong> for web authentication.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>aaa</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-aaa] <strong>domain domain1</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-aaa-domain-domain1] <strong>authentication-scheme none</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-aaa-domain-domain1] <strong>accounting-scheme none</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-aaa-domain-domain1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-aaa-domain-domain1] <strong>prefix-assign-mode unshared</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-aaa-domain-domain1] <strong>user-group huawei</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-aaa-domain-domain1] <strong>ipv6-pool poolpd</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-aaa-domain-domain1] <strong>web-server 2001:db8:3::2</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-aaa-domain-domain1] <strong>web-server url http://www.isp1.com</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-aaa-domain-domain1] <strong>web-server identical-url</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-aaa-domain-domain1] <strong>quit</strong></pre>
</p><p><p># Configure a web authentication domain named <strong>isp2</strong>.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B]<strong> aaa</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-aaa]<strong> domain isp2</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-aaa-domain-isp2]<strong> authentication-scheme auth2</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-aaa-domain-isp2]<strong> accounting-scheme acct2</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-aaa-domain-isp2]<strong> radius-server group rd2</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-aaa-domain-isp2]<strong> commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-aaa-domain-isp2]<strong> quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-aaa] <strong>quit</strong></pre>
</p></li><li><span>Configure interfaces.</span><p><p># Configure a BAS interface.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>interface GigabitEthernet 1/0/2.1</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-GigabitEthernet1/0/2.1] <strong>ipv6 address auto link-local</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet1/0/2.1] <strong>ipv6 nd autoconfig managed-address-flag</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet1/0/2.1] <strong>commit</strong>   
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-GigabitEthernet1/0/2.1]<strong> bas</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-GigabitEthernet1/0/2.1-bas]<strong> access-type layer3-subscriber default-domain pre-authentication isp2 authentication isp2</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet1/0/2.1-bas]<strong> </strong><strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-GigabitEthernet1/0/2.1-bas]<strong> quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-GigabitEthernet1/0/2.1]<strong> quit</strong></pre>
<p># Configure an uplink interface.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>interface GigabitEthernet 1/0/1</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-GigabitEthernet1/0/1]<strong> ipv6 enable</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet1/0/1]<strong> ipv6 address 2001:db8:4::1/64</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet1/0/1]<strong> ipv6 address auto link-local</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet1/0/1]<strong> commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-GigabitEthernet1/0/1]<strong> quit</strong></pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172374054__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><div class="p"><span class="keyword">Device</span>A configuration file<pre class="screen"># 
sysname <span class="keyword">Device</span>A
#
interface GigabitEthernet1/0/1.1
 vlan-type dot1q 1
 ipv6 enable    
 ipv6 address 2001:DB8:1::2/64
 ipv6 address auto link-local
#
interface GigabitEthernet1/0/2
 undo shutdown
 ipv6 enable
 ipv6 address 2001:DB8:2::1/64
 dhcp select relay
 ipv6 address auto link-local
 dhcpv6 relay destination 2001:DB8:1::1
#
return</pre>
</div>
</li><li><div class="p"><span class="keyword">Device</span>B configuration file<pre class="screen">#
sysname <span class="keyword">Device</span>B
#
radius-server group rd2
 radius-server shared-key-cipher %^%#clY:%[]x='-RMNJus[s/VJ:3YBq3&lt;..|.{'xgbp+%^%#   
 radius-server authentication 192.168.8.249 1812 weight 0
 radius-server accounting 192.168.8.249 1813 weight 0
#
ipv6 prefix prefixpd delegation
 
 prefix 2001:DB8:5::/48
#
ipv6 prefix na local
 prefix 2001:DB8:2::/64
#
ipv6 pool na bas relay
 dns-server 2001:DB8:3::1
 prefix na
#
ipv6 pool poolpd bas delegation  
 dns-server 2001:DB8:3::1
prefix prefixpd
# 
user-group huawei
#
acl ipv6 number 6000
 rule 5 permit ipv6 source user-group huawei destination ipv6-address 2001:DB8:3::2/128
 rule 10 permit ipv6 source ipv6-address 2001:DB8:3::2/128 destination user-group huawei
 rule 15 permit ipv6 source user-group huawei destination ipv6-address 2001:DB8:3::1/128
 rule 20 permit ipv6 source ipv6-address 2001:DB8:3::1/128 destination user-group huawei
#
acl ipv6 number 6001 
 rule 5 permit tcp source user-group huawei destination-port eq www 
 rule 10 permit tcp source user-group huawei destination-port eq 8080
#
acl ipv6 number 6002 
 rule 5 permit ipv6 source ipv6-address any destination user-group huawei 
 rule 10 deny ipv6 source user-group huawei destination ipv6-address any
#
dhcpv6 duid 12345678
#
traffic classifier c1 operator or
 if-match ipv6 acl 6000 precedence 21
#
traffic classifier c2 operator or
 if-match ipv6 acl 6001 precedence 23
#
traffic classifier c3 operator or
 if-match ipv6 acl 6002 precedence 25
#
traffic behavior b1
#
traffic behavior b2
 http-redirect 
#
traffic behavior b3
 deny
#
traffic policy policy
 share-mode
 classifier c1 behavior b1 precedence 1
 classifier c2 behavior b2 precedence 2
 classifier c3 behavior b3 precedence 3
#
aaa
 default-password cipher $$e:TY%^%glhJ;yPG#$=tC&amp;(Is%q!S_";(k.Ef$%^%#:978 
 #
 authentication-scheme default0
 #
 authentication-scheme default1
 #
 authentication-scheme default
  authentication-mode local radius
 #
 authentication-scheme auth2
 #
 authorization-scheme default
 #
 accounting-scheme default0
 #
 accounting-scheme default1
 #
 accounting-scheme acct2
 #
 domain default0
 #
 domain default1
 #
 domain default_admin
 #
 domain domain1
  authentication-scheme none
  accounting-scheme none
  prefix-assign-mode unshared 
  user-group huawei
  ipv6-pool poolpd
  web-server 2001:db8:3::2
  web-server url http://www.isp1.com
  web-server identical-url
 #
 domain isp2
  authentication-scheme auth2
  accounting-scheme acct2
  radius-server group rd2
#
interface GigabitEthernet1/0/1
 undo shutdown
 ipv6 enable
 ipv6 address 2001:DB8:4::1/64
 ipv6 address auto link-local
 dcn
#
interface GigabitEthernet1/0/2
 undo shutdown
#
interface GigabitEthernet1/0/2.1
 vlan-type dot1q 1
 ipv6 enable
 ipv6 address 2001:DB8:1::1/64
 ipv6 nd autoconfig managed-address-flag
 bas
 #
  access-type layer3-subscriber default-domain pre-authentication isp2 authentication isp2
 #
#
interface LoopBack0
 ipv6 enable
 ipv6 address 2001:DB8:3::3/128
 ipv6 address auto link-local
#
traffic-policy policy inbound
#
web-auth-server enable
web-auth-server source interface LoopBack0
web-auth-server 2001:DB8:3::2 port 50100 key cipher %^%#\39J9tmKl#+;)]1yEd@V#i(1Jeq"vO=9ka=-\qN&lt;%^%# 
<span>#</span>
<span>undo web-auth-server source-ip all</span>
<span>#</span>
<span>undo web-auth-server source-ipv6 all</span>
<span>web-auth-server source-ipv6 2001:DB8:3::3</span>
#
return</pre>
</div>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_ipox_cfg_0083.html">Configuration Examples for IPoE Access Authentication
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cfg_013596.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cfg_013611.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>