
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring an L2TP Connection on the LNS">
<meta name="abstract" content="To allow a tunnel to be set up through negotiation after an LNS receives a tunnel setup request from a LAC, you need to configure a virtual template (VT) and user authentication domain in the L2TP group view on the LNS.">
<meta name="description" content="To allow a tunnel to be set up through negotiation after an LNS receives a tunnel setup request from a LAC, you need to configure a virtual template (VT) and user authentication domain in the L2TP group view on the LNS.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_l2tp_cfg_013697.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_l2tp_cfg_0136877.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_l2tp_cfg_013481.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="z00588052,w00606909,w00447999">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="L2TP">
<meta name="featuretype" content="User Access">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="L2TP">
<meta name="featuretype" content="User Access">
<meta name="featurename" content="L2TP">
<meta name="featuretype" content="User Access">
<meta name="featurename" content="L2TP">
<meta name="featuretype" content="User Access">
<meta name="OWNER" content="l00425560">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="z00588052">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172374248">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>Configuring an L2TP Connection on the LNS</title>
</head>
<body><a name="EN-US_TASK_0172374248"></a><a name="EN-US_TASK_0172374248"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring an L2TP Connection on the LNS</h1>
<div class="taskbody"><p>To allow a tunnel to be set up through negotiation after an LNS receives a tunnel setup request from a LAC, you need to configure a virtual template (VT) and user authentication domain in the L2TP group view on the LNS.</p>
<div class="context"><a name="EN-US_TASK_0172374248__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>The LNS can receive tunnel setup requests from different LACs by using different VTs. After receiving a tunnel setup request from a LAC, the LNS checks the LAC name. The LNS allows the remote end to set up the tunnel if the LAC name is consistent with the name of the remote end.</p>
<p>In this configuration, the L2TP group type is set to LNS (ACCEPT_DIALIN_L2TP).</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><ul><li><p>When the <span class="keyword">NE40E</span> functions as an LNS to interwork with a Huawei LAC, it is recommended that the MTU in the bound VT be set to a value less than or equal to 1462 bytes (assume that the interface MTU is 1500 bytes).</p>
</li><li><p>When the <span class="keyword">NE40E</span> functions as an LNS to interwork with a non-Huawei LAC that does not support L2TP packet fragmentation, you are advised to set the MTU in the VT to a value less than or equal to 1454 bytes (assume that the interface MTU of the non-Huawei device is 1500 bytes). This prevents L2TP packets longer than 1500 bytes from being fragmented into invalid packets on the LAC.</p>
</li><li><p>If the MTU is set manually in the VT, ensure that the MTUs negotiated by the L2TP user, LAC, and LNS are the same.</p>
</li></ul>
</div></div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172374248__1.4.2"></a><a name="1.4.2"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li><span>Run <a href="cmdqueryname=l2tp-group"><b><span class="cmdname">l2tp-group</span></b></a> <i><span class="varname">group-name</span></i></span><p><p>The L2TP group view is displayed.</p>
</p></li><li><span>Run <a href="cmdqueryname=allow+l2tp+virtual-template"><b><span class="cmdname">allow l2tp virtual-template</span></b></a> <i><span class="varname">virtual-template-number</span></i> <strong><span>remote</span></strong> <i><span class="varname">lac-name</span></i><span> [ <strong><span>ip address</span></strong> <i><span class="varname">address</span></i> ]</span> or <a href="cmdqueryname=allow+l2tp+virtual-template"><b><span class="cmdname">allow l2tp virtual-template</span></b></a> <i><span class="varname">virtual-template-number</span></i> <strong><span>by-source-ip</span></strong></span><p><p>An L2TP connection is configured on the LNS.</p>
</p><p><p>Except the default L2TP group <strong>default-lns</strong>, you must specify <i><span class="varname">lac-name</span></i> or <i><span class="varname">by-source-ip</span></i> for other L2TP groups when configuring an L2TP connection on the LNS.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>For the same L2TP group, the <a href="cmdqueryname=start+l2tp"><b><span class="cmdname">start l2tp</span></b></a> and <a href="cmdqueryname=allow+l2tp+virtual-template"><b><span class="cmdname">allow l2tp virtual-template</span></b></a> commands are mutually exclusive. The configuration of one command will invalidate the other.</p>
</div></div>
</p></li><li><span>Run <a href="cmdqueryname=tunnel+lac-source-ip"><b><span class="cmdname">tunnel lac-source-ip</span></b></a> <i><span class="varname">start-ip-address</span></i> <i><span class="varname">end-ip-address</span></i> <a href="cmdqueryname=password"><b><span class="cmdname">password</span></b></a> <strong><span>cipher</span></strong> <i><span class="varname">password</span></i></span><p><p>The LAC-side source IP address segment and password are specified for LNS authentication.</p>
</p></li><li><span>(Optional) Run <a href="cmdqueryname=default-domain+authentication"><b><span class="cmdname">default-domain authentication</span></b></a> { <i><span class="varname">domain-name</span></i> | <strong><span>force</span></strong> <i><span class="varname">domain-name</span></i> | <strong><span>replace</span></strong> <i><span class="varname">domain-name</span></i> }</span><p><p>An authentication domain is configured for L2TP users.</p>
</p><p><p>The <a href="cmdqueryname=default-domain+authentication"><b><span class="cmdname">default-domain authentication</span></b></a> command specifies the default authentication domain for L2TP users. When a user goes online from the LAC using a username without a domain name, the LNS logs the user in through the default domain. The authentication scheme, accounting scheme, address pool, and other user login information are configured in the default domain. If the default authentication domain is not specified, when a user goes online from the LAC using a username without a domain name, the LNS logs the user in through the domain <strong>default1</strong> by default.</p>
<p>The <a href="cmdqueryname=default-domain+authentication"><b><span class="cmdname">default-domain authentication</span></b></a> <strong><span>force</span></strong> command specifies a forcible authentication domain for L2TP users. When a user goes online from the LAC, the LNS logs the user in through the forcible authentication domain without changing the user domain name. The user domain adopts the configurations of the forcible authentication domain.</p>
<p>The <a href="cmdqueryname=default-domain+authentication"><b><span class="cmdname">default-domain authentication</span></b></a> <strong><span>replace</span></strong> command specifies a substitute authentication domain for L2TP users. When a user goes online from the LAC, the LNS replaces the user domain with the substitute authentication domain, replaces the user domain name with the substitute authentication domain name, and adopts the configurations of the substitute authentication domain for the user domain.</p>
</p></li><li><span>(Optional) Run <a href="cmdqueryname=roam-domain"><b><span class="cmdname">roam-domain</span></b></a> <i><span class="varname">domain-name</span></i></span><p><p>A roaming domain is configured on the LNS.</p>
</p></li><li><span>(Optional) Run <a href="cmdqueryname=tunnel+window+receive"><b><span class="cmdname">tunnel window receive</span></b></a> <i><span class="varname">window-size</span></i></span><p><p>The size of the L2TP receive window is set for out-of-order packets.</p>
</p></li><li><span>(Optional) Run <a href="cmdqueryname=lns+calling-station-id+format+agent-remote-id"><b><span class="cmdname">lns calling-station-id format agent-remote-id</span></b></a></span><p><p>The LNS is configured to parse the Agent-Remote-Id attribute in IRCQ packets sent by the LAC and encapsulate this attribute into the Calling-Station-Id attribute to be sent to the RADIUS server.</p>
</p></li><li><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li><span>(Optional) Run <a href="cmdqueryname=qos+link-adjustment+vendor+redback"><b><span class="cmdname">qos link-adjustment vendor redback</span></b></a> { <strong><span>lns</span></strong> | <strong><span>lac</span></strong> } <sup>*</sup> [ <strong><span>slot</span></strong> <i><span class="varname">slot-id</span></i> ]</span><p><p>User traffic compensation is configured so that the compensated user traffic statistics are collected in redback mode.</p>
</p><p><p><span>In VS mode, this command is supported only by the admin VS.</span></p>
<div class="p">The compensation in redback mode is implemented as follows:
<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" frame="border" border="1" rules="all"><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="20%" id="mcps1.4.2.10.3.2.1.1.6.1.1" liSelected="liSelected"><p>Layer 2</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="20%" id="mcps1.4.2.10.3.2.1.1.6.1.2" liSelected="liSelected"><p>LAC (UP) (Unit: Byte)</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="20%" id="mcps1.4.2.10.3.2.1.1.6.1.3" liSelected="liSelected"><p>LAC (DOWN) (Unit: Byte)</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="20%" id="mcps1.4.2.10.3.2.1.1.6.1.4" liSelected="liSelected"><p>LNS (UP)</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="20%" id="mcps1.4.2.10.3.2.1.1.6.1.5" liSelected="liSelected"><p>LNS (DOWN)</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" valign="top" width="20%" headers="mcps1.4.2.10.3.2.1.1.6.1.1 "><p>Compensation value (default statistics)</p>
</td>
<td class="cellrowborder" valign="top" width="20%" headers="mcps1.4.2.10.3.2.1.1.6.1.2 "><ul><li>Double-tagged: 12</li><li>Single-tagged: 16</li><li>Without a VLAN: 20</li></ul>
</td>
<td class="cellrowborder" valign="top" width="20%" headers="mcps1.4.2.10.3.2.1.1.6.1.3 "><p>4</p>
</td>
<td class="cellrowborder" valign="top" width="20%" headers="mcps1.4.2.10.3.2.1.1.6.1.4 "><p>6</p>
</td>
<td class="cellrowborder" valign="top" width="20%" headers="mcps1.4.2.10.3.2.1.1.6.1.5 "><p>4</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="20%" headers="mcps1.4.2.10.3.2.1.1.6.1.1 "><p>Compensation value (CAR)</p>
</td>
<td class="cellrowborder" valign="top" width="20%" headers="mcps1.4.2.10.3.2.1.1.6.1.2 "><ul><li>Double-tagged: 12</li><li>Single-tagged: -16</li><li>Without a VLAN: -20</li></ul>
</td>
<td class="cellrowborder" valign="top" width="20%" headers="mcps1.4.2.10.3.2.1.1.6.1.3 "><p>-4</p>
</td>
<td class="cellrowborder" valign="top" width="20%" headers="mcps1.4.2.10.3.2.1.1.6.1.4 "><p>6</p>
</td>
<td class="cellrowborder" valign="top" width="20%" headers="mcps1.4.2.10.3.2.1.1.6.1.5 "><p>-4</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="20%" headers="mcps1.4.2.10.3.2.1.1.6.1.1 "><p>Compensation value (SQ)</p>
</td>
<td class="cellrowborder" valign="top" width="20%" headers="mcps1.4.2.10.3.2.1.1.6.1.2 "><ul><li>Double-tagged: -8</li><li>Single-tagged: -12</li><li>Without a VLAN: -16</li></ul>
</td>
<td class="cellrowborder" valign="top" width="20%" headers="mcps1.4.2.10.3.2.1.1.6.1.3 "><ul><li>Double-tagged: 24</li><li>Single-tagged: 20</li><li>Without a VLAN: 16</li></ul>
</td>
<td class="cellrowborder" valign="top" width="20%" headers="mcps1.4.2.10.3.2.1.1.6.1.4 "><p>10</p>
</td>
<td class="cellrowborder" valign="top" width="20%" headers="mcps1.4.2.10.3.2.1.1.6.1.5 "><p>38</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</p></li><li><span>Run <a href="cmdqueryname=l2tp-group"><b><span class="cmdname">l2tp-group</span></b></a> <i><span class="varname">group-name</span></i></span><p><p>The L2TP group view is displayed.</p>
</p></li><li><span>(Optional) Run <a href="cmdqueryname=avp+nas-port+enable"><b><span class="cmdname">avp nas-port enable</span></b></a></span><p><p>The LNS is configured to parse NAS-PORT information carried in AVP 100 of ICRQ packets.</p>
</p></li><li><span>(Optional) Configure the LNS to encapsulate user IDs into RADIUS accounting packets.</span><ol type="a"><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=radius-server+group"><b><span class="cmdname">radius-server group</span></b></a> <i><span class="varname">group-name</span></i></span><p><p>The RADIUS server group view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=radius-attribute+include+nas-port+lns+with-user-id+accounting-request"><b><span class="cmdname">radius-attribute include nas-port lns with-user-id accounting-request</span></b></a></span><p><p>The LNS is configured to encapsulate the NAS-Port attribute sent from the LAC into accounting packets to be sent to the RADIUS server.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=l2tp-group"><b><span class="cmdname">l2tp-group</span></b></a> <i><span class="varname">group-name</span></i></span><p><p>The L2TP group view is displayed.</p>
</p></li></ol>
</li><li><span>(Optional) Run <a href="cmdqueryname=lns+avp+calling-number+translate+agent-remote-id"><b><span class="cmdname">lns avp calling-number translate agent-remote-id</span></b></a></span><p><p>The LNS is configured to copy the value of the Calling-Number attribute carried in an ICRQ message from an LAC to the Agent-Remote-Id field.</p>
</p></li><li><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_l2tp_cfg_013697.html">Configuring an LNS
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_l2tp_cfg_0136877.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_l2tp_cfg_013481.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>