
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring IPoE Access to a VPN (Web Authentication)">
<meta name="abstract" content="This section provides an example for configuring IPoE access to a VPN by using web authentication. The example provides the networking requirements, configuration roadmap, configuration procedure, and configuration files.">
<meta name="description" content="This section provides an example for configuring IPoE access to a VPN by using web authentication. The example provides the networking requirements, configuration roadmap, configuration procedure, and configuration files.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_ipox_cfg_0083.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_ipox_cfg_0150.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_ipox_cfg_0085.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="z00588052,w00606909,w00447999">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="IPoE">
<meta name="featuretype" content="User Access">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="IPoE">
<meta name="featuretype" content="User Access">
<meta name="featurename" content="IPoE">
<meta name="featuretype" content="User Access">
<meta name="featurename" content="IPoE">
<meta name="featuretype" content="User Access">
<meta name="OWNER" content="l00425560">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="z00588052">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172374010">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring IPoE Access to a VPN (Web Authentication)</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172374010"></a><a name="EN-US_TASK_0172374010"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring IPoE Access to a VPN (Web Authentication)</h1>
<div class="taskbody"><p>This section provides an example for configuring IPoE access to a VPN by using web authentication. The example provides the networking requirements, configuration roadmap, configuration procedure, and configuration files.</p>
<div class="context"><a name="EN-US_TASK_0172374010__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0172374010__fig_dc_ne_ipox_cfg_008401">Figure 1</a>, the networking requirements are as follows:</p>
<ul><li><p>A user belongs to the domain <strong>isp2</strong> and accesses the network through GE <span>0/1/2</span> on the <span class="keyword">Router</span> in IPoE mode.</p>
</li><li><p>The user adopts web authentication, with the authentication scheme and accounting scheme set to RADIUS authentication and RADIUS accounting, respectively.</p>
</li><li><p>The IP address of the RADIUS server is 192.168.8.249, and the authentication and accounting port numbers are 1812 and 1813, respectively. The standard RADIUS protocol is adopted, and the key is <strong>it-is-my-secret1</strong>.</p>
</li><li><p>The user is a VPN user and belongs to the VPN instance named <strong>vpn1</strong>.</p>
</li><li><p>The IP address of the DNS server is 192.168.8.252.</p>
</li><li><p>The IP address of the web server is 192.168.8.251, and the key is <strong>webvlan</strong>.</p>
</li><li><p>The network-side interface is GE <span>0/1/1</span>.</p>
</li></ul>
<div class="fignone" id="EN-US_TASK_0172374010__fig_dc_ne_ipox_cfg_008401"><a name="EN-US_TASK_0172374010__fig_dc_ne_ipox_cfg_008401"></a><a name="fig_dc_ne_ipox_cfg_008401"></a><span class="figcap"><b>Figure 1 </b>Configuring IPoE access to a VPN (web authentication)</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 through 3 in this example represent GE <span>0/1/1</span>, GE <span>0/1/2</span>, and GE <span>0/1/3</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_ne_ipox_cfg_008401.png" width="NaN" height="NaN"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172374010__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure a VPN instance.</p>
</li><li><p>Configure authentication and accounting schemes.</p>
</li><li><p>Configure a RADIUS server group.</p>
</li><li>Configure a user password.</li><li><p>Configure an address pool.</p>
</li><li><p>Configure web pre-authentication and authentication domains.</p>
</li><li><p>Configure a web authentication server.</p>
</li><li><p>Configure ACL rules and a traffic policy.</p>
</li><li><p>Configure a BAS interface and an upstream interface.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172374010__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>VPN instance name, RD, and VPN target</p>
</li><li><p>Authentication scheme name and authentication mode</p>
</li><li><p>Accounting scheme name and accounting mode</p>
</li><li><p>RADIUS server group name, and IP address and port numbers of the RADIUS authentication and accounting server</p>
</li><li><p>Address pool name, gateway address, and DNS server address</p>
</li><li><p>Domain names</p>
</li><li><p>Web authentication server address</p>
</li><li><p>ACL rules</p>
</li><li><p>Traffic policy name</p>
</li><li><p>BAS interface parameters</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172374010__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure a VPN instance.</span><p><pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>]<strong> ip vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-vpn-instance-vpn1] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-vpn-instance-vpn1-af-ipv4] <strong>route-distinguisher 100:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-vpn-instance-vpn1-af-ipv4] <strong>vpn-target 100:1 both</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-vpn-instance-vpn1-af-ipv4] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-vpn-instance-vpn1-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-vpn-instance-vpn1] <strong>quit</strong></pre>
</p></li><li><span>Configure AAA schemes.</span><p><p># Configure an authentication scheme.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>]<strong> aaa</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-aaa]<strong> authentication-scheme auth2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-aaa-authen-auth2]<strong> authentication-mode radius</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-aaa-authen-auth2]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-aaa-authen-auth2]<strong> quit</strong></pre>
<p># Configure an accounting scheme.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-aaa]<strong> accounting-scheme acct2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-aaa-accounting-acct2]<strong> accounting-mode radius</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-aaa-accounting-acct2]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-aaa-accounting-acct2]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-aaa]<strong> quit</strong></pre>
</p></li><li><span>Configure a RADIUS server group.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>]<strong> radius-server group rd2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-radius-rd2]<strong> radius-server authentication 192.168.8.249 1812</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-radius-rd2]<strong> radius-server accounting 192.168.8.249 1813</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-radius-rd2]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-radius-rd2]<strong> radius-server type standard</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-radius-rd2]<strong> radius-server shared-key-cipher it-is-my-secret1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-radius-rd2]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-radius-rd2]<strong> quit</strong></pre>
</p></li><li><span>Configure the IPoE user password.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>]<strong> aaa</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-aaa]<strong> </strong><strong>default-password cipher YsHsjx_202206</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-aaa]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-aaa]<strong> quit</strong></pre>
</p></li><li><span>Configure an address pool.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>]<strong> ip pool pool2 bas local</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-ip-pool-pool2]<strong> gateway 10.82.1.1 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-ip-pool-pool2] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-ip-pool-pool2]<strong> section 0 10.82.1.2 10.82.1.200</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-ip-pool-pool2]<strong> dns-server 192.168.8.252</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-ip-pool-pool2] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-ip-pool-pool2] <strong>vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-ip-pool-pool2]<strong> quit</strong></pre>
</p></li><li><span>Configure domains.</span><p><p># Configure a domain named <strong>default0</strong> as the pre-authentication domain for web authentication.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>]<strong> user-group web-before</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>]<strong> aaa</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-aaa]<strong> domain default0</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-aaa-domain-default0]<strong> ip-pool pool2</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-aaa-domain-default0]<strong> user-group web-before</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-aaa-domain-default0] <strong>web-server 192.168.8.251</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-aaa-domain-default0]<strong> web-server url http://192.168.8.251</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-aaa-domain-default0] <strong>vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-aaa-domain-default0] <strong>http-hostcar enable</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-aaa-domain-default0]<strong> quit</strong></pre>
<p># Configure the domain <strong>isp2</strong> as the authentication domain for web authentication.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-aaa]<strong> domain isp2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-aaa-domain-isp2]<strong> authentication-scheme auth2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-aaa-domain-isp2]<strong> accounting-scheme acct2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-aaa-domain-isp2]<strong> radius-server group rd2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-aaa-domain-isp2] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-aaa-domain-isp2] <strong>vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-aaa-domain-isp2]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-aaa]<strong> quit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>If the <a href="cmdqueryname=reallocate-ip-address"><b><span class="cmdname">reallocate-ip-address</span></b></a> command is run to enable IP address reallocation for the web authentication domain isp2, the domain must be bound to an address pool. The function is optional. In normal circumstances, a private network address is allocated in the pre-authentication domain before authentication, and a public network address is allocated in the authentication domain after authentication. This addresses public network address shortage and increases usage of public network addresses.</p>
<p>However, the IP address reallocation function requires the web server to comply with the Huawei proprietary protocol for address reallocation, and the client must download the plug-in through the web server.</p>
</div></div>
</p></li><li><span>Configure an IP address used by Device to receive portal packets from the web authentication server.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>interface</strong> <strong>LoopBack 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-LoopBack0] <strong>ip address 10.6.55.1 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-LoopBack0] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-LoopBack0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>]<strong> web-auth-server source-ip 10.6.55.1</strong></pre>
</p></li><li><span>Configure a web authentication server.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>]<strong> </strong><strong>web-auth-server enable</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>web-auth-server source interface LoopBack 0</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>]<strong> web-auth-server 192.168.8.251 vpn-instance vpn1 key cipher webvlan</strong></pre>
</p></li><li><span>Configure ACLs.</span><p><p># Configure ACL rules.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>]<strong> acl number 6000</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-acl-ucl-6000]<strong> rule 20 permit tcp source user-group web-before destination-port eq www</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-acl-ucl-6000] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-acl-ucl-6000] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>]<strong> acl number 6001</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-acl-ucl-6001]<strong> rule 5 permit ip source user-group web-before destination ip-address 192.168.8.251 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-acl-ucl-6001]<strong> rule 10 permit ip source user-group web-before destination ip-address 192.168.8.252 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-acl-ucl-6001]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-acl-ucl-6001]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>]<strong> acl number 6002</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-acl-ucl-6002]<strong> rule 30 permit ip source user-group web-before destination ip-address any </strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-acl-ucl-6002]<strong> rule 35 permit ip source ip-address any destination user-group web-before </strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-acl-ucl-6002] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-acl-ucl-6002]<strong> quit</strong></pre>
<p># Configure a traffic policy.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>]<strong> traffic classifier c1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-classifier-c1]<strong> if-match acl 6000</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-classifier-c1]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-classifier-c1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>]<strong> traffic classifier c2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-classifier-c2]<strong> if-match acl 6001</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-classifier-c2]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-classifier-c2]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>]<strong> traffic classifier c3</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-classifier-c3]<strong> if-match acl 6002</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-classifier-c3]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-classifier-c3]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>]<strong> traffic behavior deny1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-behavior-deny1]<strong> http-redirect plus</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-behavior-deny1]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-behavior-deny1]<strong> </strong><strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>]<strong> traffic behavior perm1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-behavior-perm1]<strong> permit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-behavior-perm1]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-behavior-perm1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>]<strong> traffic behavior deny2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-behavior-deny2]<strong> deny</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-behavior-deny2]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-behavior-deny2]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>]<strong> traffic policy action1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-trafficpolicy-action1]<strong> share-mode</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-trafficpolicy-action1]<strong> classifier c2 behavior perm1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-trafficpolicy-action1]<strong> classifier c1 behavior deny1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-trafficpolicy-action1]<strong> classifier c3 behavior deny2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-trafficpolicy-action1]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-trafficpolicy-action1]<strong> quit</strong></pre>
<p># Apply the traffic policy globally.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>]<strong> traffic-policy action1 inbound</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>]<strong> traffic-policy action1 outbound</strong></pre>
</p></li><li><span>Configure interfaces.</span><p><p># Configure a BAS interface.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>interface gigabitethernet<span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-GigabitEthernet<span>0/1/2</span>]<strong> bas</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-GigabitEthernet<span>0/1/2</span>-bas]<strong> access-type layer2-subscriber</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-GigabitEthernet<span>0/1/2</span>-bas]<strong> authentication-method web</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-GigabitEthernet<span>0/1/2</span>-bas]<strong> default-domain authentication isp2</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-GigabitEthernet<span>0/1/2</span>-bas]<strong> commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-GigabitEthernet<span>0/1/2</span>-bas]<strong> quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-GigabitEthernet<span>0/1/2</span>]<strong> quit</strong></pre>
<p># Configure an upstream interface.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The upstream interface is connected to an MPLS network, and the configuration is not provided here. For details, see the chapter BGP/MPLS IP VPN of the <em><span class="keyword">NE40E</span> Configuration Guide - VPN</em>.</p>
</div></div>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>interface GigabitEthernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-GigabitEthernet<span>0/1/1</span>]<strong> ip address 192.168.2.1 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-GigabitEthernet<span>0/1/1</span>] <strong>commit</strong></pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172374010__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><pre class="screen">#
sysname <span class="keyword">HUAWEI</span>
#
ip vpn-instance vpn1
 ipv4-family
 route-distinguisher 100:1
 apply-label per-instance
 vpn-target 100:1 export-extcommunity
 vpn-target 100:1 import-extcommunity
#
radius-server group rd2
 radius-server type standard
 radius-server shared-key-cipher %^%#vS%796FO7%C<font style="font-size:8pt" Face="Courier New" >~</font>pB%CR=q;j}gSCqR-X6+P!.DYI@)%^%#
 radius-server authentication 192.168.8.249 1812 weight 0
 radius-server accounting 192.168.8.249 1813 weight 0
#
ip pool pool2 bas local
 vpn-instance vpn1
 gateway 10.82.1.1 255.255.255.0
 section 0 10.82.1.2 10.82.1.200
 dns-server 192.168.8.252
#
user-group web-before
#
acl number 6000
 rule 20 permit tcp source user-group web-before destination-port eq www
#
acl number 6001
 rule 5 permit ip source user-group web-before destination ip-address 192.168.8.251 0
 rule 10 permit ip source user-group web-before destination ip-address 192.168.8.252 0
#
acl number 6002
 rule 30 permit ip source user-group web-before destination ip-address any 
 rule 35 permit ip source ip-address any destination user-group web-before
#
traffic classifier c1 operator or 
 if-match acl 6000 precedence 1
#
traffic classifier c2 operator or
 if-match acl 6001 precedence 2
#
traffic classifier c3 operator or
 if-match acl 6002 precedence 3
#
traffic behavior deny1
 http-redirect plus
#
traffic behavior deny2
 deny
#
traffic behavior perm1
#
traffic policy action1
 share mode
 classifier c2 behavior perm1 precedence 1
 classifier c1 behavior deny1 precedence 2
 classifier c3 behavior deny2 precedence 3
#
aaa
 default-password cipher $$e:TY%^%glhJ;yPG#$=tC&amp;(Is%q!S_";(k.Ef$%^%#:978 
 #
 authentication-scheme auth2
 #
 accounting-scheme acct2
 #
 domain default0
  ip-pool pool2
  vpn-instance vpn1
  user-group web-before
  web-server 192.168.8.251
  web-server url http://192.168.8.251
  http-hostcar enable 
 #
 domain isp2
  authentication-scheme auth2
  accounting-scheme acct2
  radius-server group rd2
  vpn-instance vpn1
# 
interface <span>GigabitEthernet</span><span>0/1/1</span>
 undo shutdown
 ip address 192.168.2.1 255.255.255.0
# 
interface <span>GigabitEthernet</span><span>0/1/2</span>
 undo shutdown
 bas
 #
 access-type layer2-subscriber default-domain authentication isp2 
 authentication-method web 
#
interface LoopBack0
 ip address 10.6.55.1 255.255.255.255
web-auth-server enable
web-auth-server source interface LoopBack 0
web-auth-server 192.168.8.251 vpn-instance vpn1 port 50100 key cipher %^%#aQL6,Ua&lt;|@sxPQK/1f'4/GBJ6,6)q&gt;$Z^7*,!2yR%^%#
#
 undo web-auth-server source-ip all 
 web-auth-server source-ip 10.6.55.1
#
 undo web-auth-server source-ipv6 all
#
 traffic-policy action1 inbound
 traffic-policy action1 outbound
#
return</pre>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_ipox_cfg_0083.html">Configuration Examples for IPoE Access Authentication
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_ipox_cfg_0150.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_ipox_cfg_0085.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>