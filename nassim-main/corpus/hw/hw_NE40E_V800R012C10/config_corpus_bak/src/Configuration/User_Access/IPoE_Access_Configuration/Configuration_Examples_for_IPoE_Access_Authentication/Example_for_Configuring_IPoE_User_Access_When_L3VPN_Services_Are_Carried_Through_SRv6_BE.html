
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring IPoE User Access When L3VPN Services Are Carried Through SRv6 BE">
<meta name="abstract" content="This section provides an example for configuring IPoE user access through binding authentication when L3VPN services are carried through SRv6 BE.">
<meta name="description" content="This section provides an example for configuring IPoE user access through binding authentication when L3VPN services are carried through SRv6 BE.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_ipox_cfg_0083.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cfg_014464.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="z50024784,z00603461,w00800033,z00588052,c00549182,l00593348,w00606909,w00447999">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="IPoE">
<meta name="featuretype" content="User Access">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="IPoE">
<meta name="featuretype" content="User Access">
<meta name="featurename" content="IPoE">
<meta name="featuretype" content="User Access">
<meta name="featurename" content="IPoE">
<meta name="featuretype" content="User Access">
<meta name="OWNER" content="c00549182">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="z00588052">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_CONCEPT_0000001087272086">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>Example for Configuring IPoE User Access When L3VPN Services Are Carried Through SRv6 BE</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_CONCEPT_0000001087272086"></a><a name="EN-US_CONCEPT_0000001087272086"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring IPoE User Access When L3VPN Services Are Carried Through SRv6 BE</h1>
<div><p>This section provides an example for configuring IPoE user access through binding authentication when L3VPN services are carried through SRv6 BE.</p>
<div class="section"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_CONCEPT_0000001087272086__fig15317114044819">Figure 1</a>, a user belongs to domain <strong>isp3</strong> and accesses the Internet through GE<span>0/1/1</span> on PE1 in common IPoE mode. PE1, the P, and PE2 belong to IS-IS process 1 and are all Level-1 devices. PE1 functions as a BRAS and uses the RADIUS authentication and accounting modes. PE1, the P, and PE2 belong to the same AS and are interconnected over an IPv6 network through IS-IS. A bidirectional SRv6 BE path is established between PE1 and PE2 to carry L3VPNv4 services.</p>
<div class="fignone" id="EN-US_CONCEPT_0000001087272086__fig15317114044819"><a name="EN-US_CONCEPT_0000001087272086__fig15317114044819"></a><a name="fig15317114044819"></a><span class="figcap"><b>Figure 1 </b>Configuring IPoE user access when L3VPN services are carried through SRv6 BE</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface1, interface2, interface3, and interface4 represent GE<span>0/1/1</span>, GE<span>0/1/2</span>, GE<span>0/1/3</span>, and GE<span>0/1/4</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0000001088872498.png" width="NaN" height="NaN"></span></div>

<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" frame="border" border="1" rules="all"><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="17.84178417841784%" id="mcps1.4.1.4.1.4.1.1" liSelected="liSelected"><p>Device</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="35.11351135113511%" id="mcps1.4.1.4.1.4.1.2" liSelected="liSelected"><p>Interface</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="47.044704470447044%" id="mcps1.4.1.4.1.4.1.3" liSelected="liSelected"><p>IP Address</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" rowspan="3" valign="top" width="17.84178417841784%" headers="mcps1.4.1.4.1.4.1.1 "><p></p>
<p>PE1</p>
<p></p>
</td>
<td class="cellrowborder" valign="top" width="35.11351135113511%" headers="mcps1.4.1.4.1.4.1.2 "><p>GE<span>0/1/1</span></p>
</td>
<td class="cellrowborder" valign="top" width="47.044704470447044%" headers="mcps1.4.1.4.1.4.1.3 "><p>2001:db8:100::1/96</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.2 "><p>GE<span>0/1/2</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.3 "><p>2001:db8:10::1/96</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.2 "><p>Loopback1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.3 "><p>2001:db8:1::1/64</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="3" valign="top" width="17.84178417841784%" headers="mcps1.4.1.4.1.4.1.1 "><p></p>
<p>P</p>
<p></p>
</td>
<td class="cellrowborder" valign="top" width="35.11351135113511%" headers="mcps1.4.1.4.1.4.1.2 "><p>GE<span>0/1/2</span></p>
</td>
<td class="cellrowborder" valign="top" width="47.044704470447044%" headers="mcps1.4.1.4.1.4.1.3 "><p>2001:db8:10::2/96</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.2 "><p>GE<span>0/1/3</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.3 "><p>2001:db8:20::2/96</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.2 "><p>Loopback1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.3 "><p>2001:db8:2::2/64</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="3" valign="top" width="17.84178417841784%" headers="mcps1.4.1.4.1.4.1.1 "><p></p>
<p>PE2</p>
<p></p>
</td>
<td class="cellrowborder" valign="top" width="35.11351135113511%" headers="mcps1.4.1.4.1.4.1.2 "><p>GE<span>0/1/3</span></p>
</td>
<td class="cellrowborder" valign="top" width="47.044704470447044%" headers="mcps1.4.1.4.1.4.1.3 "><p>2001:db8:20::1/96</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.2 "><p>GE<span>0/1/4</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.3 "><p>10.2.1.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.2 "><p>Loopback1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.3 "><p>2001:db8:3::3/64</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li>Enable the IPv6 forwarding capability on each interface of PE1, the P, and PE2. Configure IPv6 addresses for each interface and the loopback interface of the control channel.</li><li>Configure AAA schemes on PE1.</li><li>Configure a RADIUS server group.</li><li>Configure an address pool.</li><li>Configure a user group.</li><li>Configure an authentication domain.</li><li>Configure a BAS interface.</li><li>Enable IS-IS, configure an IS-IS level, and specify a network entity on PE1, the P, and PE2.</li><li>Configure VPN instances on PE1 and PE2.</li><li>Establish an MP-IBGP peer relationship between PE1 and PE2.</li><li>Establish an SRv6 BE path between PE1 and PE2.</li><li>Configure a traffic policy to identify SRv6 users.</li></ol>
</div>
<div class="section"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li>Authentication scheme name and authentication mode</li><li>Accounting scheme name and accounting mode</li><li>RADIUS server group name, and IP addresses and port numbers of the RADIUS authentication and accounting servers</li><li>IP address pool name, gateway address, and DNS server address</li><li>Domain name</li><li>PE1 interface parameters</li><li>IPv6 addresses of each interface on PE1, the P, and PE2</li><li>IS-IS process ID for PE1, the P, and PE2</li><li>IS-IS level for PE1, the P, and PE2</li><li>VPN instance names, RDs, and RTs on PE1 and PE2</li></ul>
</div>
<div class="section"><h4 class="sectiontitle">Procedure</h4><ol><li>Enable the IPv6 forwarding capability on each interface. Configure IPv6 addresses for each interface and the loopback interface of the control channel.<p># Configure PE1. The configurations of the P and PE2 are similar to the configuration of PE1. For configuration details, see "Configuration Files" in this section.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname PE1</strong> 
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>PE1] <strong>interface gigabitethernet <span>0/1/2</span></strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>PE1-GigabitEthernet<span>0/1/2</span>] <strong>ipv6 enable</strong>
[*PE1-GigabitEthernet<span>0/1/2</span>] <strong>ipv6 address 2001:DB8:10::1 96</strong>
[*PE1-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong>
[*PE1] <strong>interface LoopBack 1</strong>
[*PE1-LoopBack1] <strong>ipv6 enable</strong>
[*PE1-LoopBack1] <strong>ipv6 address 2001:DB8:1::1 64</strong>
[*PE1-LoopBack1] <strong>quit</strong>
[*PE1] <strong>commit</strong></pre>
</li><li>Configure AAA schemes on PE1.<p># Configure an authentication scheme.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE1]<strong> aaa</strong>
[*PE1-aaa] <strong>authentication-scheme auth3</strong>
[*PE1-aaa-authen-auth3] <strong>authentication-mode radius</strong>
[*PE1-aaa-authen-auth3] <strong>commit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>PE1-aaa-authen-auth3] <strong>quit</strong></pre>
<p># Configure an accounting scheme.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE1-aaa] <strong>accounting-scheme acct3</strong>
[*PE1-aaa-accounting-acct3] <strong>accounting-mode radius</strong>
[*PE1-aaa-accounting-acct3] <strong>commit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>PE1-aaa-accounting-acct3] <strong>quit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>PE1-aaa] <strong>quit</strong></pre>
<p># Configure the IPoE user password.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE1-aaa]<strong> </strong><strong>default-password cipher YsHsjx_202206</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>PE1-aaa]<strong> commit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>PE1-aaa]<strong> quit</strong></pre>
</li><li>Configure a RADIUS server group.<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE1] <strong>radius-server group rd3</strong>
[*PE1-radius-rd3] <strong>radius-server authentication 192.168.8.249 1812</strong>
[*PE1-radius-rd3]<strong> radius-server accounting 192.168.8.249 1813</strong>
[*PE1-radius-rd3] <strong>commit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>PE1-radius-rd3]<strong> radius-server type standard</strong>
[*PE1-radius-rd3]<strong> radius-server shared-key-cipher it-is-my-secret1</strong>
[*PE1-radius-rd3] <strong>commit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>PE1-radius-rd3] <strong>quit</strong></pre>
</li><li>Configure an address pool.<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE1] <strong>ip pool pool3 bas local</strong>
[<span class="keyword">*</span>PE1-ip-pool-pool3] <strong>gateway 10.82.2.1 255.255.255.0</strong>
[*PE1-ip-pool-pool3]<strong> commit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>PE1-ip-pool-pool3]<strong> section 0 10.82.2.2 10.82.2.200</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>PE1-ip-pool-pool3]<strong> dns-server 192.168.8.252</strong>
[*PE1-ip-pool-pool3]<strong> commit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>PE1-ip-pool-pool3] <strong>vpn-instance vpna</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>PE1-ip-pool-pool3] <strong>quit</strong></pre>
</li><li>Configure a user group.<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE1] <strong>user-group srv6</strong></pre>
</li><li>Configure an authentication domain.<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE1] <strong>aaa</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>PE1-aaa]<strong> domain isp3</strong>
[*PE1-aaa-domain-isp3] <strong>a</strong><strong>uthentication-scheme auth3</strong>
[*PE1-aaa-domain-isp3] <strong>accounting-scheme acct3</strong>
[*PE1-aaa-domain-isp3]<strong> radius-server group rd3</strong>
[*PE1-aaa-domain-isp3] <strong>user-group srv6</strong>
[*PE1-aaa-domain-isp3] <strong>commit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>PE1-aaa-domain-isp3]<strong> ip-pool pool3</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>PE1-aaa-domain-isp3] <strong>vpn-instance vpna</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>PE1-aaa-domain-isp3] <strong>quit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>PE1-aaa] <strong>quit</strong></pre>
</li><li>Configure a BAS interface.<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE1]<strong> interface GigabitEthernet </strong><strong><span>0/1/1</span></strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>PE1-GigabitEthernet<span>0/1/1</span>] <strong>bas</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>PE1-GigabitEthernet<span>0/1/1</span>-bas] <strong>access-type layer2-subscriber</strong>
[*PE1-GigabitEthernet<span>0/1/1</span>-bas] <strong>authentication-method bind</strong>
[*PE1-GigabitEthernet<span>0/1/1</span>-bas] <strong>default-domain authentication isp3</strong>
[*PE1-GigabitEthernet<span>0/1/1</span>-bas] <strong>commit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>PE1-GigabitEthernet<span>0/1/1</span>-bas]<strong> quit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>PE1-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
</li><li>Configure IS-IS.<div class="p"># Configure PE1.<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE1] <strong>interface gigabitethernet <span>0/1/2</span></strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>PE1-GigabitEthernet<span>0/1/2</span>] <strong>ipv6 enable</strong>
[*PE1-GigabitEthernet<span>0/1/2</span>]<strong> ipv6 address 2001:DB8:10::1 96</strong>
[*PE1-GigabitEthernet<span>0/1/2</span>]<strong> quit</strong>
[*PE1] <strong>interface LoopBack 1</strong>
[*PE1-LoopBack1] <strong>ipv6 enable</strong>
[*PE1-LoopBack1]<strong> ipv6 address 2001:DB8:1::1 64</strong>
[*PE1-LoopBack1] <strong>quit</strong>
[*PE1] <strong>commit</strong></pre>
</div>
<div class="p"># Configure the P.<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>P]<strong> isis 1</strong> 
[*P-isis-1] <strong>is-level level-1</strong>
[*P-isis-1] <strong>cost-style wide</strong>
[*P-isis-1] <strong>network-entity 10.0000.0000.0002.00</strong>
[*P-isis-1]<strong> ipv6 enable topology ipv6</strong>
[*P-isis-1] <strong>quit</strong>
[*P] <strong>interface gigabitethernet <span>0/1/2</span></strong>
[*P-GigabitEthernet<span>0/1/2</span>]<strong> isis ipv6 enable 1</strong>
[*P-GigabitEthernet<span>0/1/2</span>]<strong> quit</strong>
[*P] <strong>interface gigabitethernet <span>0/1/3</span></strong>
[*P-GigabitEthernet<span>0/1/3</span>] <strong>isis ipv6 enable 1</strong>
[*P-GigabitEthernet<span>0/1/3</span>] <strong>quit</strong>
[*P] <strong>interface loopback1</strong>
[*P-LoopBack1] <strong>isis ipv6 enable 1</strong>
[*P-LoopBack1] <strong>quit</strong>
[*P] <strong>commit</strong></pre>
</div>
<div class="p"># Configure PE2.<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE2] <strong>isis 1</strong>
[*PE2-isis-1] <strong>is-level level-1</strong>
[*PE2-isis-1] <strong>cost-style wide</strong>
[*PE2-isis-1] <strong>network-entity 10.0000.0000.0003.00</strong>
[*PE2-isis-1] <strong>ipv6 enable topology ipv6</strong>
[*PE2-isis-1]<strong> quit</strong>
[*PE2]<strong> interface gigabitethernet <span>0/1/3</span></strong>
[*PE2-GigabitEthernet<span>0/1/3</span>] <strong>isis ipv6 enable 1</strong>
[*PE2-GigabitEthernet<span>0/1/3</span>] <strong>quit</strong>
[*PE2]<strong> interface loopback1</strong>
[*PE2-LoopBack1]<strong> isis ipv6 enable 1</strong>
[*PE2-LoopBack1] <strong>quit</strong>
[*PE2] <strong>commit</strong></pre>
</div>
<p>After completing the configuration, perform the following operations to check whether IS-IS is successfully configured:</p>
<p># Display information about the IS-IS neighbor. The following example uses the command output on PE1.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE1] <strong>display isis peer</strong>
Peer information for ISIS(1) 
                                                                 
System Id        Interface        Circuit Id         State HoldTime Type      PRI
----------------------------------------------------------------------------------
0000.0000.0002*  GE<span>0/1/2</span>          0000.0000.0002.01  Up    8s       L1        64 
 
Total Peer(s): 1</pre>
<p># Display information about the IS-IS routing table. The following example uses the command output on PE1.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE1] <strong>display isis route</strong>
                         Route information for ISIS(1)
                         -----------------------------
 
                        ISIS(1) Level-1 Forwarding Table
                        --------------------------------
 
 IPV6 Dest.            ExitInterface      NextHop                    Cost     Flags
---------------------------------------------------------------------------------------------  
2001:DB8:1::1/64       Loop1              Direct                     0        D/-/L/-
2001:DB8:20::/96       GE<span>0/1/2</span>            FE80::3A92:6CFF:FE21:10    20       A/-/-/- 
2001:DB8:3::3/64       GE<span>0/1/2</span>            FE80::3A92:6CFF:FE21:10    20       A/-/-/-  
2001:DB8:10::/96       GE<span>0/1/2</span>            Direct                     10       D/-/L/- 
2001:DB8:20::/96       GE<span>0/1/2</span>            FE80::3A92:6CFF:FE21:10    20       A/-/-/-
      Flags: D-Direct, A-Added to URT, L-Advertised in LSPs, S-IGP Shortcut, 
         U-Up/Down Bit Set, LP-Local Prefix-Sid
    Protect Type: L-Link Protect, N-Node Protect</pre>
</li><li>Configure a VPN instance enabled with the IPv4 address family on PE1 and PE2.<p># Configure PE1.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE1] <strong>ip vpn-instance vpna</strong>
[*PE1-vpn-instance-vpna] <strong>ipv4-family</strong>
[*PE1-vpn-instance-vpna-af-ipv4] <strong>route-distinguisher 100:1</strong>
[*PE1-vpn-instance-vpna-af-ipv4]<strong> vpn-target 111:1 both</strong>
[*PE1-vpn-instance-vpna-af-ipv4] <strong>commit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>PE1-vpn-instance-vpna-af-ipv4]<strong> quit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>PE1-vpn-instance-vpna]<strong> quit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE2]<strong> ip vpn-instance vpna</strong>
[*PE2-vpn-instance-vpna] <strong>ipv4-family</strong>
[*PE2-vpn-instance-vpna-af-ipv4] <strong>route-distinguisher 200:1</strong>
[*PE2-vpn-instance-vpna-af-ipv4] <strong>vpn-target 111:1 both</strong>
[*PE2-vpn-instance-vpna-af-ipv4] <strong>commit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>PE2-vpn-instance-vpna-af-ipv4]<strong> quit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>PE2-vpn-instance-vpna]<strong> quit</strong></pre>
</li><li>Establish an MP-IBGP peer relationship between PE1 and PE2.<p># Configure PE1.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE1] <strong>bgp 100</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>PE1-bgp] <strong>peer 2001:DB8:3::3 as-number 100</strong>
[*PE1-bgp] <strong>peer 2001:DB8:3::3 connect-interface loopback 1</strong>
[*PE1-bgp]<strong> ipv4-family vpnv4</strong>
[*PE1-bgp-af-vpnv4]<strong> peer 2001:DB8:3::3 enable</strong>
[*PE1-bgp-af-vpnv4] <strong>commit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>PE1-bgp-af-vpnv4] <strong>quit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>PE1-bgp]<strong> quit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE2] <strong>bgp 100</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>PE2-bgp] <strong>peer 2001:DB8:1::1 as-number 100</strong>
[*PE2-bgp]<strong> peer 2001:DB8:1::1 connect-interface loopback 1</strong>
[*PE2-bgp] <strong>ipv4-family vpnv4</strong>
[*PE2-bgp-af-vpnv4] <strong>peer 2001:DB8:1::1 enable</strong>
[*PE2-bgp-af-vpnv4] <strong>commit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>PE2-bgp-af-vpnv4]<strong> quit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>PE2-bgp]<strong> quit</strong></pre>
<p>After completing the configuration, run the <strong>display bgp vpnv4 all peer</strong> command on PE1. The command output shows that BGP peer relationship has been established between the PEs and is in the <strong>Established</strong> state.</p>
<p>The following example uses the command output on PE1.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE1] <a href="cmdqueryname=display+bgp+vpnv4+all+peer"><b><span class="cmdname">display bgp vpnv4 all peer</span></b></a>
 
 BGP local router ID : 1.1.1.1
 Local AS number : 100
 Total number of peers : 1                 Peers in established state : 1
 
  Peer            V          AS  MsgRcvd  MsgSent  OutQ  Up/Down       State  PrefRcv
  2001:DB8:3::3   4         100      216      220     0 03:03:35 Established        2</pre>
</li><li>Establish an SRv6 BE path between PE1 and PE2.<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>An End.DT4 SID can be either dynamically allocated through BGP or manually configured. If a dynamically allocated SID and a manually configured SID both exist, the latter takes effect. If you have run the <a href="cmdqueryname=segment-routing+ipv6+locator"><b><span class="cmdname">segment-routing ipv6 locator</span></b></a> <i><span class="varname">locator-name</span></i> command to enable BGP to dynamically allocate End.DT4 SIDs, you do not need to run the <a href="cmdqueryname=opcode+func-opcode+end-dt4+vpn-instance"><b><span class="cmdname">opcode func-opcode end-dt4 vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i> command to configure the static SID opcode.</p>
<p>In this example, dynamic allocation through BGP is used.</p>
</div></div>
<p># Configure PE1.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE1] <strong>segment-routing ipv6</strong>
[*PE1-segment-routing-ipv6] <strong>encapsulation source-address 2001:DB8:1::1</strong>
[*PE1-segment-routing-ipv6] <strong>locator as1 ipv6-prefix 2001:DB8:100:: 64 static 32</strong>
[*PE1-segment-routing-ipv6-locator] <strong>quit</strong>
[*PE1-segment-routing-ipv6]<strong> quit</strong>
[*PE1] <strong>bgp 100</strong>
[*PE1-bgp] <strong>ipv4-family vpnv4</strong>
[*PE1-bgp-af-vpnv4]<strong> peer 2001:DB8:3::3 prefix-sid</strong>
[*PE1-bgp-af-vpnv4] <strong>quit</strong>
[*PE1-bgp] <strong>ipv4-family vpn-instance vpna</strong>
[*PE1-bgp-vpna] <strong>segment-routing ipv6 best-effort</strong>
[*PE1-bgp-vpna]<strong> segment-routing ipv6 locator as1</strong>
[*PE1-bgp-vpna]<strong> commit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>PE1-bgp-vpna] <strong>quit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>PE1-bgp] <strong>quit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>PE1] <strong>isis 1</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>PE1-isis-1] <strong>segment-routing ipv6 locator as1</strong>
[*PE1-isis-1] <strong>commit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>PE1-isis-1] <strong>quit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE2] <strong>segment-routing ipv6</strong>
[*PE2-segment-routing-ipv6] <strong>encapsulation source-address 2001:DB8:3::3</strong>
[*PE2-segment-routing-ipv6] <strong>locator as1 ipv6-prefix 2001:DB8:300:: 64 static 32</strong>
[*PE2-segment-routing-ipv6-locator] <strong>quit</strong>
[*PE2-segment-routing-ipv6] <strong>quit</strong>
[*PE2] <strong>bgp 100</strong>
[*PE2-bgp] <strong>ipv4-family vpnv4</strong>
[*PE2-bgp-af-vpnv4] <strong>peer 2001:DB8:1::1 prefix-sid</strong>
[*PE2-bgp-af-vpnv4]<strong> quit</strong>
[*PE2-bgp] <strong>ipv4-family vpn-instance vpna</strong>
[*PE2-bgp-vpna] <strong>segment-routing ipv6 best-effort</strong>
[*PE2-bgp-vpna] <strong>segment-routing ipv6 locator as1</strong>
[*PE2-bgp-vpna]<strong> commit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>PE2-bgp-vpna] <strong>quit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>PE2-bgp] <strong>quit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>PE2] <strong>isis 1</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>PE2-isis-1] <strong>segment-routing ipv6 locator as1</strong>
[*PE2-isis-1] <strong>commit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>PE2-isis-1]<strong> quit</strong></pre>
</li><li>Configure a traffic policy to identify SRv6 users.<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE1] <strong>acl number 6000</strong>
[*PE1-acl-ucl-6000] <strong>rule 1 permit ip source user-group srv6</strong>
[*PE1-acl-ucl-6000]<strong> commit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>PE1-acl-ucl-6000] <strong>quit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>PE1] <strong>traffic classifier srv6</strong>
[*PE1-classifier-srv6] <strong>if-match acl 6000</strong>
[*PE1-classifier-srv6] <strong>commit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>PE1-classifier-srv6] <strong>quit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>PE1] <strong>traffic behavior srv6</strong>
[*PE1-behavior-srv6]<strong> redirect ip-nexthop 10.2.1.2</strong>
[*PE1- behavior-srv6]<strong> commit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>PE1- behavior-srv6]<strong> quit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>PE1] <strong>traffic policy srv6</strong>
[*PE1-trafficpolicy-srv6] <strong>classifier srv6 behavior srv6</strong>
[*PE1-trafficpolicy-srv6] <strong>commit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>PE1-trafficpolicy-srv6] <strong>quit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>PE1] <strong>traffic-policy srv6 inbound</strong>
[*PE1] <strong>commit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>After an ACL policy is configured, user traffic from the user group named <strong>srv6</strong> will be imported to the SRv6 BE path. To prevent user traffic from entering the SRv6 BE path, run the <a href="cmdqueryname=reauthorize"><b><span class="cmdname">reauthorize</span></b></a> command to modify the user group or use the RADIUS attribute to modify the user group so that traffic is forwarded over a non-SRv6 BE path.</p>
</div></div>
</li><li>Verify the configuration.<div class="p">Run the <a href="cmdqueryname=display+segment-routing+ipv6+locator"><b><span class="cmdname">display segment-routing ipv6 locator</span></b></a> [ <i><span class="varname">locator-name</span></i> ]<a href="cmdqueryname=verbose"><b><span class="cmdname"> verbose</span></b></a> command to check SRv6 locator information. The following example uses the command output on PE1.<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE1] <strong>display segment-routing ipv6 locator verbose</strong>
                        Locator Configuration Table
                        ---------------------------

LocatorName  : as1                                       LocatorID   : 1
IPv6Prefix   : 2001:DB8:100::                            PrefixLength: 64
StaticLength : 32                                        Reference   : 2
ArgsLength   : 0
AutoSIDPoolID: 8193
AutoSIDBegin : 2001:DB8:100::1:0:0
AutoSIDEnd   : 2001:DB8:100::FFFF:FFFF:FFFF:FFFF
GIB:LIB      : --
 
Total Locator(s): 1</pre>
</div>
<div class="p">Run the <a href="cmdqueryname=display+segment-routing+ipv6+local-sid+end-dt4+forwarding"><b><span class="cmdname">display segment-routing ipv6 local-sid end-dt4 forwarding</span></b></a> command to check information about the SRv6 local SID table. The following example uses the command output on PE1.<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE1] <strong>display segment-routing ipv6 local-sid end-dt4 forwarding</strong>
                    My Local-SID End.DT4 Forwarding Table
                    -------------------------------------
 
SID        : 2001:DB8:100::1:0:0/128                      FuncType : End.DT4
VPN Name   : vpna                                         VPN ID   : 3
LocatorName: as1                                          LocatorID: 1
Flavor     : NO-FLAVOR                                    SidCompress : NO
UpdateTime : 2023-05-10 01:46:05.713

Total SID(s): 1</pre>
</div>
<div class="p">Run the <a href="cmdqueryname=display+bgp+vpnv4+all+routing-table"><b><span class="cmdname">display bgp vpnv4 all routing-table</span></b></a> command on PE1 and PE2 to check the BGP VPNv4 routing information. The following example uses the command output on PE1.<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE1]<strong> display bgp vpnv4 all routing-table </strong>                       
 
 BGP Local router ID is 1.1.1.1                         
 Status codes: * - valid, &gt; - best, d - damped, x - best external, a - add path,         
               h - history,  i - internal, s - suppressed, S - Stale
               Origin : i - IGP, e - EGP, ? - incomplete
 RPKI validation codes: V - valid, I - invalid, N - not-found                
 
 
 Total number of routes from all PE: 2                  
 Route Distinguisher: 100:1                             
 
 
        Network            NextHop                       MED        LocPrf    PrefVal Path/Ogn                                      
*&gt;     127.0.0.0/8        0.0.0.0                        0                     0       ?                                           
 Route Distinguisher: 200:1                             
        Network            NextHop                       MED        LocPrf    PrefVal Path/Ogn 
 
 *&gt;i    10.2.1.0/24        2001:DB8:3::3                  0          100        0       ?                                           
 VPN-Instance vpna, Router ID 1.1.1.1:                  
 
 Total Number of Routes: 2                              
        Network            NextHop                       MED        LocPrf    PrefVal Path/Ogn                                                                            
 *&gt;i    10.2.1.0/24        2001:DB8:3::3                  0          100        0       ?                                           
*&gt;     127.0.0.0/8        0.0.0.0                        0                     0       ?  </pre>
</div>
<div class="p">Run the <a href="cmdqueryname=display+ip+routing-table+vpn-instance+vpna"><b><span class="cmdname">display ip routing-table vpn-instance vpna</span></b></a> command on PE1 and PE2 to check the routing table information about the VPN instance. The following example uses the command output on PE1.<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE1] <strong>display ip routing-table vpn-instance vpna</strong>
Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route                                              
------------------------------------------------------------------------------                                                      
Routing Table : vpna                                    
         Destinations : 8        Routes : 8             

Destination/Mask    Proto   Pre  Cost        Flags NextHop                   Interface 
       10.2.1.0/24  IBGP    255  0             RD  2001:DB8:300::1:0:3C      GigabitEthernet<span>0/1/2</span> 
      127.0.0.0/8   Direct  0    0             D   127.0.0.1                 InLoopBack0                                                      
255.255.255.255/32  Direct  0    0             D   127.0.0.1                 InLoopBack0</pre>
</div>
</li></ol>
</div>
<div class="section"><h4 class="sectiontitle">Configuration Files</h4><ul><li>PE1 configuration file<pre class="screen">#
sysname PE1
#
ip vpn-instance vpna
 ipv4-family
  route-distinguisher 100:1
  tnl-policy p1
  vpn-target 111:1 export-extcommunity
  vpn-target 111:1 import-extcommunity
#
radius-server group rd3
 radius-server shared-key-cipher %^%#vS%796FO7%C<font style="font-size:8pt" Face="Courier New" >~</font>pB%CR=q;j}gSCqR-X6+P!.DYI@)%^%#
 radius-server authentication 192.168.8.249 1812 weight 0
 radius-server accounting 192.168.8.249 1813 weight 0
#
ip pool pool3 bas local
 vpn-instance vpna
 gateway 10.82.2.1 255.255.255.0
 section 0 10.82.2.2 10.82.2.200
 dns-server 192.168.8.252
#
acl number 6000
 rule 1 permit ip source user-group srv6
#
traffic classifier srv6 operator or
 if-match acl 6000 precedence 1
#
traffic behavior srv6
 redirect ip-nexthop 10.2.1.2
#
traffic policy srv6
 share-mode
 classifier srv6 behavior srv6 precedence 1
#
aaa
 default-password cipher $$e:TY%^%glhJ;yPG#$=tC&amp;(Is%q!S_";(k.Ef$%^%#:978 
 #
 authentication-scheme auth3
 #
 accounting-scheme acct3
 # 
 domain isp3
  authentication-scheme auth3
  accounting-scheme acct3
  radius-server group rd3
  ip-pool pool3
  vpn-instance vpna
#
segment-routing ipv6
 encapsulation source-address 2001:DB8:1::1
 locator as1 ipv6-prefix 2001:DB8:100:: 64 static 32
#               
isis 1 
 is-level level-1
 cost-style wide
 network-entity 10.0000.0000.0001.00
 #              
 ipv6 enable topology ipv6
 segment-routing ipv6 locator as1
 #              
#
interface GigabitEthernet<span>0/1/1</span>
 bas
 #
  access-type layer2-subscriber default-domain authentication isp3
  authentication-method bind
 #
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown  
 ipv6 enable    
 ipv6 address 2001:DB8:10::1/96
 isis ipv6 enable 1
#
interface GigabitEthernet1/0/5
 undo shutdown    
 ip address 192.168.8.1 24
#
interface LoopBack1
 ipv6 enable    
 ipv6 address 2001:DB8:1::1/64
 isis ipv6 enable 1
#               
bgp 100         
 router-id 1.1.1.1
 peer 2001:DB8:3::3 as-number 100
 peer 2001:DB8:3::3 connect-interface LoopBack1
 #              
 ipv4-family unicast
  undo synchronization
 #              
 ipv6-family unicast
  undo synchronization
 #              
 ipv4-family vpnv4
  policy vpn-target
  peer 2001:DB8:3::3 enable
  peer 2001:DB8:3::3 prefix-sid
 #              
 ipv4-family vpn-instance vpna
  import-route direct
  segment-routing ipv6 locator as1
  segment-routing ipv6 best-effort
#
route-policy p1 permit node 10
 apply extcommunity color 0:101
#
traffic-policy srv6 inbound
#
tunnel-policy p1
 tunnel select-seq ipv6 srv6-te-policy load-balance-number 1
#
return</pre>
</li><li>P configuration file<pre class="screen">#
sysname P        
#           
isis 1          
 is-level level-1
 cost-style wide
 network-entity 10.0000.0000.0002.00
 #              
 ipv6 enable topology ipv6
 #
#               
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown  
 ipv6 enable    
 ipv6 address 2001:DB8:10::2/96
 isis ipv6 enable 1 
# 
interface GigabitEthernet<span>0/1/3</span>
 undo shutdown  
 ipv6 enable    
 ipv6 address 2001:DB8:20::1/96
 isis ipv6 enable 1  
#               
interface LoopBack1
 ipv6 enable    
 ipv6 address 2001:DB8:2::2/64
 isis ipv6 enable 1
#               
return</pre>
</li><li>PE2 configuration file<pre class="screen">#
sysname PE2
#
ip vpn-instance vpna
 ipv4-family
  route-distinguisher 200:1
  vpn-target 111:1 export-extcommunity
  vpn-target 111:1 import-extcommunity
#
segment-routing ipv6
 encapsulation source-address 2001:DB8:3::3
 locator as1 ipv6-prefix 2001:DB8:300:: 64 static 32
#               
isis 1          
 is-level level-1
 cost-style wide
 network-entity 10.0000.0000.0003.00
 #              
 ipv6 enable topology ipv6
 segment-routing ipv6 locator as1
 #              
#               
interface GigabitEthernet<span>0/1/3</span>
 undo shutdown  
 ipv6 enable    
 ipv6 address 2001:DB8:20::2/96
 isis ipv6 enable 1
#               
interface GigabitEthernet<span>0/1/4</span>
 undo shutdown  
 ip binding vpn-instance vpna
 ip address 10.2.1.1 255.255.255.0
# 
interface LoopBack1
 ipv6 enable    
 ipv6 address 2001:DB8:3::3/64
 isis ipv6 enable 1
#               
bgp 100         
 router-id 2.2.2.2
 peer 2001:DB8:1::1 as-number 100
 peer 2001:DB8:1::1 connect-interface LoopBack1
 #              
 ipv4-family unicast
  undo synchronization
 #              
 ipv6-family unicast
  undo synchronization
 #              
 ipv4-family vpnv4
  policy vpn-target
  peer 2001:DB8:1::1 enable
  peer 2001:DB8:1::1 prefix-sid
 #              
 ipv4-family vpn-instance vpna
  import-route direct
  segment-routing ipv6 locator as1
  segment-routing ipv6 best-effort
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_ipox_cfg_0083.html">Configuration Examples for IPoE Access Authentication
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cfg_014464.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>
</body>
</html>