
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring L2TP Access in NAS-Initiated VPN Scenarios">
<meta name="abstract" content="This section provides an example for configuring L2TP access in NAS-Initiated VPN scenarios. A networking diagram is provided to help you understand the configuration procedure. The configuration example includes the networking requirements, configuration roadmap, configuration procedure, and configuration files.">
<meta name="description" content="This section provides an example for configuring L2TP access in NAS-Initiated VPN scenarios. A networking diagram is provided to help you understand the configuration procedure. The configuration example includes the networking requirements, configuration roadmap, configuration procedure, and configuration files.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_l2tp_cfg_013506.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_l2tp_cfg_013508.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="z00588052,w00606909,w00447999">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="L2TP">
<meta name="featuretype" content="User Access">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="L2TP">
<meta name="featuretype" content="User Access">
<meta name="featurename" content="L2TP">
<meta name="featuretype" content="User Access">
<meta name="featurename" content="L2TP">
<meta name="featuretype" content="User Access">
<meta name="OWNER" content="l00425560">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="z00588052">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172374273">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/thickbox.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/imageResize.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery-migrate-1.2.1.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery-ui.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery.mousewheel.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/thickbox.js"></script>
<title>Example for Configuring L2TP Access in NAS-Initiated VPN Scenarios</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172374273"></a><a name="EN-US_TASK_0172374273"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring L2TP Access in NAS-Initiated VPN Scenarios</h1>
<div class="taskbody"><p>This section provides an example for configuring L2TP access in NAS-Initiated VPN scenarios. A networking diagram is provided to help you understand the configuration procedure. The configuration example includes the networking requirements, configuration roadmap, configuration procedure, and configuration files.</p>
<div class="context"><a name="EN-US_TASK_0172374273__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0172374273__fig_dc_ne_l2tp_cfg_01350701">Figure 1</a>, PC1 is connected to a PSTN through a modem and then connected to the LAC (DeviceA). The LAC and LNS reside on a WAN and communicate with each other through a tunnel. A user accesses the network with a username carrying a domain name. Both the LAC and LNS authenticate the username and password through RADIUS authentication. On the LNS, an address pool needs to be configured in the domain for address assignment to the user. The user needs to communicate with the headquarters. However, the headquarters network uses private addresses, and the user cannot directly access the internal server over the Internet. Therefore, a VPN must be established to allow user access to the internal network.</p>
<div class="fignone" id="EN-US_TASK_0172374273__fig_dc_ne_l2tp_cfg_01350701"><a name="EN-US_TASK_0172374273__fig_dc_ne_l2tp_cfg_01350701"></a><a name="fig_dc_ne_l2tp_cfg_01350701"></a><span class="figcap"><b>Figure 1 </b>Configuring L2TP access in NAS-Initiated VPN scenarios</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interface1 in this example represents GE<span>0/1/0</span>.</p>
</div></div>
<br><span><img class="imgResize" src="images/fig_dc_ne_l2tp_cfg_01350701.png" width="438.90000000000003" height="NaN" title="Click to enlarge"></span><br></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172374273__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure a dial-up connection on the user side.</p>
</li><li><p>Configure the LAC.</p>
<ul><li>Configure an interface address for the LAC.</li><li>Configure the PPPoE access service on the LAC, including configuring a VT and AAA schemes, binding an interface to the VT, and configuring a BAS interface.</li><li>Enable L2TP.</li><li>Configure an L2TP tunnel connection on the LAC.</li><li>Configure a tunnel authentication mode.</li><li>Configure L2TP attributes.</li></ul>
</li><li><p>Configure the LNS.</p>
<ul><li>Configure an interface address for the LNS.</li><li>Configure a VT.</li><li>Configure an L2TP tunnel connection on the LNS.</li><li>Configure a tunnel authentication mode and user authentication mode.</li><li>Configure LNS-side tunnel parameters.</li><li>Configure an address pool for address assignment to L2TP users.</li><li>Configure an L2TP user domain and specify an address pool in the domain.</li></ul>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172374273__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>Identical usernames, domain names, and passwords on the LAC-side <span class="keyword">NE40E</span> and LNS-side <span class="keyword">NE40E</span></p>
</li><li><p>LNS-side tunnel authentication mode (CHAP is used in this example) and tunnel password; LNS-side local and remote tunnel names</p>
</li><li><p>VT number</p>
</li><li><p>L2TP group ID</p>
</li><li><p>ID, address range, and address mask of a remote address pool</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172374273__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure a dial-up connection on the user side.</span><p><p>Establish a dial-up connection so that the user can receive an IP address assigned by the LNS.</p>
<p>In the dial-up terminal window that is displayed, enter the username <strong>vpdnuser@huawei.com</strong> and password <strong>YsHsjx_202206</strong>. (The username and password have been registered on the LNS.)</p>
</p></li><li><span>Configure <span class="keyword">Device</span>A that functions as the LAC.</span><p><p>In this example, the IP address of the interface (GE<span>0/1/0</span>) connecting the LAC to the tunnel is 10.38.160.1, and the IP address of the interface (GE<span>0/1/0</span>) connecting the LNS to the tunnel is 10.38.160.2.</p>
<p># Assign an IP address to GE<span>0/1/0</span>.</p>
<pre class="screen">&lt;<span class="keyword">Device</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>]<strong> sysname <span class="keyword">Device</span>A</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/0</span>] <strong>ip address 10.38.160.1 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/0</span>]<strong> quit</strong></pre>
<p># Enable L2TP and configure an L2TP tunnel connection on the LAC.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>l2tp enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A]<strong> l2tp-group 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-l2tp-1]<strong> tunnel name LAC</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-l2tp-1]<strong> tunnel source gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-l2tp-1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-l2tp-1] <strong>start l2tp ip 10.38.160.2</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-l2tp-1] <strong>tunnel password cipher YsHsjx_202206</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-l2tp-1]<strong> quit</strong></pre>
<p>Configure the PPPoE access service.</p>
<p># Configure a RADIUS server.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>radius-server group radius1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-radius-radius1] <strong>radius-server authentication 10.20.20.1 1812</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-radius-radius1] <strong>radius-server accounting 10.20.20.1 1813</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-radius-radius1] <strong>radius-server shared-key YsHsjx_202206</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-radius-radius1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-radius-radius1] <strong>quit</strong></pre>
<p># Configure a user access domain.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>aaa</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-aaa]<strong> domain huawei.com</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-aaa-domain-huawei.com] <strong>authentication-scheme default1 </strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-aaa-domain-huawei.com] <strong>accounting-scheme default1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-aaa-domain-huawei.com] <strong>idle-cut 60 500</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-aaa-domain-huawei.com] <strong>radius-server group radius1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-aaa-domain-huawei.com] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-aaa-domain-huawei.com] <strong>l2tp-group 1</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-aaa-domain-huawei.com] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-aaa] <strong>quit</strong></pre>
<div class="p"># Configure a VT.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>interface virtual-template 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-Virtual-Template1] <strong>ppp authentication-mode chap</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-Virtual-Template1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-Virtual-Template1] <strong>quit</strong></pre>
</div>
<div class="p"># Bind VT1 to GE0/2/0.100.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>interface gigabitethernet 0/2/0.100</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet0/2/0.100] <strong>pppoe-server bind virtual-template 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet0/2/0.100] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-GigabitEthernet0/2/0.100] <strong>user-vlan 1 100</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-GigabitEthernet0/2/0.100-vlan-1-100] <strong>quit</strong></pre>
</div>
</p><p><div class="p"># Configure a BAS interface.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-GigabitEthernet0/2/0.100] <strong>bas</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-GigabitEthernet0/2/0.100-bas] <strong>access-type layer2-subscriber default-domain authentication huawei.com</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet0/2/0.100-bas] <strong>authentication-method ppp</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet0/2/0.100-bas] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-GigabitEthernet<span>0/2/0</span>.100-bas] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-GigabitEthernet0/2/0.100] <strong>quit</strong></pre>
</div>
</p></li><li><span>Configure DeviceB that functions as the LNS.</span><p><p># Assign an IP address to the interface connecting the LNS to the tunnel.</p>
<pre class="screen">&lt;<span class="keyword">Device</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>]<strong> sysname <span class="keyword">Device</span>B</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-gigabitethernet<span>0/1/0</span>]<strong> ip address 10.38.160.2 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-gigabitethernet<span>0/1/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-gigabitethernet<span>0/1/0</span>] <strong>quit</strong></pre>
<p># Configure a VT and specify the tunnel authentication mode.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B]<strong> interface virtual-template 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-Virtual-Template1] <strong>ppp authentication-mode chap</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-Virtual-Template1]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-Virtual-Template1]<strong> quit</strong></pre>
<p># Enable L2TP.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>l2tp enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B]<strong> l2tp-group 1</strong></pre>
<p># Configure the local tunnel name and peer tunnel name on the LNS side.</p>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-l2tp-1] <strong>tunnel name LNS</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-l2tp-1]<strong> allow l2tp virtual-template 1 remote LAC</strong></pre>
<p># Enable tunnel authentication and configure a tunnel authentication password.</p>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-l2tp-1] <strong>tunnel authentication</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-l2tp-1] <strong>tunnel password cipher YsHsjx_202206</strong></pre>
<p># Configure the local end to perform mandatory CHAP authentication.</p>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-l2tp-1]<strong> mandatory-chap</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-l2tp-1]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-l2tp-1]<strong> quit</strong></pre>
<div class="p"># Create an LNS group named <strong>group1</strong>.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B]<strong> lns-group group1</strong></pre>
</div>
<div class="p"># Bind the tunnel board in slot <span>1</span> to the LNS group.<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-lns-group-group1]<strong> bind slot <span>1</span> </strong></pre>
</div>
<div class="p"># Specify an interface for the LNS group.<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-lns-group-group1]<strong> bind source gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-lns-group-group1]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-lns-group-group1]<strong> quit</strong></pre>
</div>
<div class="p"># Configure an address pool for address assignment to dial-up users.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B]<strong> ip pool 1 bas local</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-ip-pool-1]<strong> gateway 192.168.0.2 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-ip-pool-1]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-ip-pool-1]<strong> section 0 192.168.0.10 192.168.0.100</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-ip-pool-1]<strong> quit</strong></pre>
</div>
<p># Configure a RADIUS server.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>radius-server group radius1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-radius-radius1] <strong>radius-server authentication 10.20.20.1 1812</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-radius-radius1] <strong>radius-server accounting 10.20.20.1 1813</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-radius-radius1] <strong>radius-server shared-key itellin</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-radius-radius1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-radius-radius1] <strong>quit</strong></pre>
<p># Configure a user access domain.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B]<strong> aaa</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-aaa]<strong> domain huawei.com</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-aaa-domain-huawei.com] <strong>authentication-scheme default1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-aaa-domain-huawei.com] <strong>accounting-scheme default1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-aaa-domain-huawei.com] <strong>radius-server group radius1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-aaa-domain-huawei.com] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-aaa-domain-huawei.com] <strong>ip-pool 1</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-aaa-domain-huawei.com] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-aaa] <strong>quit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p># After completing the configurations, have the VPN user go online. Then, run the <strong>display l2tp tunnel</strong> command on both the LAC and LNS to check whether an L2TP tunnel is set up successfully. The following example uses the command output on the LNS.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>display l2tp tunnel</strong></pre>
<pre class="screen"> ---------------------------------------------------------                     
  -----------tunnel information in LAC----------------------                    
 Total 0,0 printed                                                              

  ---------------------------------------------------------                     
  -----------tunnel information in LNS----------------------                    
 The tunnel information of k board <span>1</span>                                            
 LocalTID RemoteTID RemoteAddress    Port   Sessions RemoteName                 
  ---------------------------------------------------------                     
 13921   7958       10.38.160.1     57344   1          LAC                  
  ---------------------------------------------------------                     
  Total 1,1 printed from slot <span>1</span> </pre>
<p># Run the <strong>display l2tp session</strong> command to check information about session establishment. The following example uses the command output on the LNS.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>display l2tp session lns slot <span>1</span></strong></pre>
<pre class="screen">LocalSID  RemoteSID  LocalTID   RemoteTID  UserID  UserName                                                                       
 ------------------------------------------------------------------------------                                                     
  2036       1469      13921      7958       62172    vpdnuser@huawei.com                       
 ------------------------------------------------------------------------------                                         </pre>
<pre class="screen">Total 1, 1 printed from slot <span>1</span></pre>
<p># Check that the VPN user can access the headquarters.</p>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172374273__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p><span class="keyword">Device</span>A configuration file</p>
</li></ul>
<pre class="screen">#</pre>
<pre class="screen"> sysname <span class="keyword">Device</span>A</pre>
<pre class="screen">#</pre>
<pre class="screen"> l2tp enable</pre>
<pre class="screen">#</pre>
<pre class="screen">radius-server group radius1</pre>
<pre class="screen"> radius-server shared-key %^%#[aPaM9I8k"Y^ukH,LmbY+807,<font style="font-size:8pt" Face="Courier New" >~</font>L0_:&lt;bLVYGo@R;%^%</pre>
<pre class="screen">#</pre>
<pre class="screen"> radius-server authentication 10.20.20.1 1812 </pre>
<pre class="screen"> radius-server accounting 10.20.20.1 1813 </pre>
<pre class="screen">#</pre>
<pre class="screen">interface Virtual-Template1</pre>
<pre class="screen">ppp authentication-mode chap</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet0/2/0</pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen">#</pre>
<pre class="screen">interface <span>GigabitEthernet</span>0/2/0.100</pre>
<pre class="screen"> statistic enable</pre>
<pre class="screen"> user-vlan 1 100</pre>
<pre class="screen"> pppoe-server bind Virtual-Template 1</pre>
<pre class="screen"> bas</pre>
<pre class="screen"> #</pre>
<pre class="screen">  access-type layer2-subscriber default-domain authentication huawei.com</pre>
<pre class="screen">authentication-method ppp</pre>
<pre class="screen">#</pre>
<pre class="screen">aaa</pre>
<pre class="screen"> domain huawei.com</pre>
<pre class="screen">  authentication-scheme default1</pre>
<pre class="screen">  accounting-scheme default1</pre>
<pre class="screen">  idle-cut 60 500</pre>
<pre class="screen">  radius-server group radius1</pre>
<pre class="screen">  l2tp-group 1</pre>
<pre class="screen">#</pre>
<pre class="screen">interface gigabitethernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.38.160.1 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">l2tp-group 1</pre>
<pre class="screen"> tunnel password cipher %^%#%@%##!!!!!!!!!"!!!!"!!!!(!!!!1];16qfZ81fv"uMoKKZ.1k"`AO!X2K2N.b<font style="font-size:8pt" Face="Courier New" >~</font>'NB^V!!!!!!!!!!1!!!!o/4J(q"J1F.!K9%M!6x8%@%#%^%#</pre>
<pre class="screen"> tunnel name LAC</pre>
<pre class="screen"> start l2tp ip 10.38.160.2</pre>
<pre class="screen"> tunnel source gigabitethernet <span>0/1/0</span></pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
<ul><li><p><span class="keyword">Device</span>B configuration file</p>
</li></ul>
<pre class="screen">#</pre>
<pre class="screen">sysname <span class="keyword">Device</span>B</pre>
<pre class="screen">#</pre>
<pre class="screen">l2tp enable</pre>
<pre class="screen">#</pre>
<pre class="screen">radius-server group radius1</pre>
<pre class="screen">#</pre>
<pre class="screen"> radius-server shared-key %^%#vS%796FO7%C<font style="font-size:8pt" Face="Courier New" >~</font>pB%CR=q;j}gSCqR-X6+P!.DYI@)%^% </pre>
<pre class="screen">#</pre>
<pre class="screen"> radius-server authentication 10.20.20.1 1812 </pre>
<pre class="screen"> radius-server accounting 10.20.20.1 1813 </pre>
<pre class="screen">#</pre>
<pre class="screen">ip pool 1 bas local</pre>
<pre class="screen"> gateway 192.168.0.2 255.255.255.0</pre>
<pre class="screen"> section 0 192.168.0.10 192.168.0.100</pre>
<pre class="screen">#</pre>
<pre class="screen">interface Virtual-Template1</pre>
<pre class="screen"> ppp authentication-mode chap</pre>
<pre class="screen">#</pre>
<pre class="screen">interface gigabitethernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.38.160.2 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">interface LoopBack0</pre>
<pre class="screen"> ip address 192.168.10.1 255.255.255.255</pre>
<pre class="screen">#</pre>
<pre class="screen">l2tp-group 1</pre>
<pre class="screen"> mandatory-chap</pre>
<pre class="screen"> allow l2tp virtual-template 1 remote LAC</pre>
<pre class="screen"> tunnel password cipher %@%##!!!!!!!!!"!!!!"!!!!(!!!!1];16qfZ81fv"uMoKKZ.1k"`AO!X2K2N.b<font style="font-size:8pt" Face="Courier New" >~</font>'NB^V!!!!!!!!!!1!!!!o/4J(q"J1F.!K9%M!6x8%@%#  1qaz#EDC</pre>
<pre class="screen"> tunnel name LNS</pre>
<pre class="screen">#</pre>
<pre class="screen">lns-group group1</pre>
<pre class="screen"> bind slot <span>1</span> </pre>
<pre class="screen"> bind source gigabitethernet<span>0/1/0</span></pre>
<pre class="screen">#</pre>
<pre class="screen">aaa</pre>
<pre class="screen"> domain huawei.com</pre>
<pre class="screen">  authentication-scheme default1</pre>
<pre class="screen">  accounting-scheme default1</pre>
<pre class="screen">  radius-server group radius1</pre>
<pre class="screen">  ip-pool 1</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_l2tp_cfg_013506.html">Configuration Examples for L2TP Access
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_l2tp_cfg_013508.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>

<script language="JavaScript">
<!--
image_size('.imgResize');
var msg_imageMax = "view original image";
var msg_imageClose = "close";
//--></script></body>
</html>