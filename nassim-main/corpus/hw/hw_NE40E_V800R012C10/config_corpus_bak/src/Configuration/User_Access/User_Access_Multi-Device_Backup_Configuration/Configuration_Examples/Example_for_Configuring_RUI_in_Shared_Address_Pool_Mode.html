
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring RUI in Shared Address Pool Mode">
<meta name="abstract" content="This section provides an example for configuring RUI in shared address pool mode. A networking diagram is provided to help you understand the configuration procedure. This example covers networking requirements, configuration roadmap, configuration procedure, and configuration files.">
<meta name="description" content="This section provides an example for configuring RUI in shared address pool mode. A networking diagram is provided to help you understand the configuration procedure. This example covers networking requirements, configuration roadmap, configuration procedure, and configuration files.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cfg_rui_0050.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cfg_rui_0051.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cfg_rui_0052.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="z00588052,w00606909,w00447999">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="UP Multi-Device Backup">
<meta name="featurename" content="User Access Multi-Device Backup">
<meta name="featuretype" content="User Access">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="UP Multi-Device Backup">
<meta name="featurename" content="User Access Multi-Device Backup">
<meta name="featuretype" content="User Access">
<meta name="featurename" content="UP Multi-Device Backup">
<meta name="featurename" content="User Access Multi-Device Backup">
<meta name="featuretype" content="User Access">
<meta name="featurename" content="User Access Multi-Device Backup">
<meta name="featuretype" content="User Access">
<meta name="OWNER" content="l00425560">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="z00588052">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172374398">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring RUI in Shared Address Pool Mode</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172374398"></a><a name="EN-US_TASK_0172374398"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring RUI in Shared Address Pool Mode</h1>
<div class="taskbody"><p>This section provides an example for configuring RUI in shared address pool mode. A networking diagram is provided to help you understand the configuration procedure. This example covers networking requirements, configuration roadmap, configuration procedure, and configuration files.</p>
<div class="context"><a name="EN-US_TASK_0172374398__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><div class="p"><h4 class="sectiontitle">Usage Scenario</h4><p>As IP technologies develop rapidly, various value-added services are widely used on the Internet. Carrier-grade services, such as emerging IPTV, NGN, 4G, VIP customers' private line, and VPN interconnection, place higher requirements for IP network reliability. IP network reliability for carrier-grade services covers device, link, and network reliability. On a transport network, the availability of network devices must reach 99.999%. In other words, the downtime for maintenance during the continuous running of a device in a year is less than 5 minutes. High reliability is a basic requirement for carrier-grade devices.</p>
<p>The <span class="keyword">NE40E</span> is an edge router used to carry multiple services. It plays a vital role on a network. It is uplinked to the core layer to implement the Layer 3 routing function and downlinked to the aggregation layer to terminate Layer 2 user packets for user access. Additionally, it carries multiple services including Triple Play services (HSI, VoIP, and IPTV), requiring high reliability. The <span class="keyword">NE40E</span> provides service-level high-reliability technologies. Non-stop data flow forwarding does not mean that user services are not interrupted. Instead, when user traffic is switched to a backup device after a network node or link fails, user services are still interrupted if user information is not synchronized to the backup device. High reliability has been considered when the <span class="keyword">NE40E</span> is designed to function as a network edge service aggregation and control device. This ensures that users' HSI, IPTV, and VoIP services are not interrupted if a network node or link fault occurs. Dual-device hot backup is designed based on this reliability scenario.</p>
<h4 class="sectiontitle">Hardware and Software Requirements</h4><p>A board that supports user access is installed on the device.</p>
<h4 class="sectiontitle">Requirements on Interconnected Devices</h4><ul><li>Upstream device: There are no special requirements. The upstream device is generally a core-layer CR that can exchange routes normally and supports MPLS and MPLS L3VPN. It is recommended that the upstream device be able to provide MPLS L2VPN capabilities. In multi-device hot backup scenarios, MPLS tunnels are best suited to function as protection tunnels. This is because an MPLS protection tunnel can be established from the IP core network if a direct link cannot be deployed between <span class="keyword">NE40E</span>s.<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0172374398__en-us_task_0172374395_p1361260258214109">If the upstream device is a firewall, disable the IP spoofing attack defense function on the firewall.</p>
</div></div>
</li><li>Downstream device: An aggregation switch is used as the downstream device to learn MAC addresses from Layer 2 VLAN packets.</li></ul>
<h4 class="sectiontitle">Solution Limitations</h4><ul><li>In shared address pool mode, an address pool (an IP network segment) is planned based on services. Each service (for example, Internet access or VoIP service) corresponds to a domain's configuration. If terminals that go online through different access links have the same service (for example, Internet access service), the terminals share address pool resources in a domain. This mode is called multi-link address pool sharing.</li><li>In actual deployment, planning address pools based on links is difficult. The reason is that the number of public addresses is limited, and dividing address pools causes address resources to be wasted. Therefore, address pools are divided based on authentication domains. This allows an address pool on an MSCG to be shared among multiple links or backup groups. In this case, forwarding control cannot be performed by advertising or withdrawing address pool routes. To implement forwarding control, using a shared address pool and tunnel protection is recommended.</li></ul>
<h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0172374398__fig_dc_ne_cfg_01043201">Figure 1</a>, users access <span class="keyword">Device</span> A and <span class="keyword">Device</span> B through a LAN switch. The two devices run VRRP to determine the master/backup status. Basic user access functions are configured on <span class="keyword">Device</span> A and <span class="keyword">Device</span> B, allowing the users to go online through the master device. If the master device or the link on the network or user side of the master device fails, service traffic needs to be quickly switched to the backup device.</p>
<div class="fignone" id="EN-US_TASK_0172374398__fig_dc_ne_cfg_01043201"><a name="EN-US_TASK_0172374398__fig_dc_ne_cfg_01043201"></a><a name="fig_dc_ne_cfg_01043201"></a><span class="figcap"><b>Figure 1 </b>Configuring RUI in shared address pool mode</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interfaces 1 through 3 represent GE<span>0/1/0</span>, GE<span>0/2/2</span>, and GE<span>0/1/2</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_ne_cfg_rui_000002.png" width="NaN" height="NaN"></span><br><div class="tableBorder"><table cellpadding="4" cellspacing="0" summary=""><tr><td valign="top" width="30.999999999999996%"><p><strong>Device</strong></p>
</td>
<td valign="top" width="34.666666666666664%"><p><strong>Interface</strong></p>
</td>
<td valign="top" width="34.33333333333333%"><p><strong>IP Address</strong></p>
</td>
</tr>
<tr><td valign="top"><p><span class="keyword">Device</span> A</p>
</td>
<td valign="top"><p><span>Eth-Trunk3.4001</span></p>
</td>
<td valign="top"><p>192.168.254.2/29</p>
</td>
</tr>
<tr><td valign="top"><p><span class="keyword">Device</span> A</p>
</td>
<td valign="top"><p>Loopback0</p>
</td>
<td valign="top"><p>172.20.1.1/32</p>
</td>
</tr>
<tr><td valign="top"><p><span class="keyword">Device</span> A</p>
</td>
<td valign="top"><p>Loopback10</p>
</td>
<td valign="top"><p>172.20.1.3/32</p>
</td>
</tr>
<tr><td valign="top"><p><span class="keyword">Device</span> A</p>
</td>
<td valign="top"><p>Eth-Trunk2</p>
</td>
<td valign="top"><p>172.20.0.41/30</p>
</td>
</tr>
<tr><td valign="top"><p><span class="keyword">Device</span> A</p>
</td>
<td valign="top"><p>GE<span>0/1/0</span></p>
</td>
<td valign="top"><p>172.20.0.33/30</p>
</td>
</tr>
<tr><td valign="top"><p><span class="keyword">Device</span> A</p>
</td>
<td valign="top"><p>GE<span>0/2/2</span></p>
</td>
<td valign="top"><p>172.20.0.57/30</p>
</td>
</tr>
<tr><td valign="top"><p><span class="keyword">Device</span> B</p>
</td>
<td valign="top"><p><span>Eth-Trunk3.4001</span></p>
</td>
<td valign="top"><p>192.168.254.3/29</p>
</td>
</tr>
<tr><td valign="top"><p><span class="keyword">Device</span> B</p>
</td>
<td valign="top"><p>Loopback0</p>
</td>
<td valign="top"><p>172.20.1.4/32</p>
</td>
</tr>
<tr><td valign="top"><p><span class="keyword">Device</span> B</p>
</td>
<td valign="top"><p>Loopback10</p>
</td>
<td valign="top"><p>172.20.1.2/32</p>
</td>
</tr>
<tr><td valign="top"><p><span class="keyword">Device</span> B</p>
</td>
<td valign="top"><p>Eth-Trunk2</p>
</td>
<td valign="top"><p>172.20.0.42/30</p>
</td>
</tr>
<tr><td valign="top"><p><span class="keyword">Device</span> B</p>
</td>
<td valign="top"><p>GE<span>0/1/0</span></p>
</td>
<td valign="top"><p>172.20.0.37/30</p>
</td>
</tr>
<tr><td valign="top"><p><span class="keyword">Device</span> B</p>
</td>
<td valign="top"><p>GE<span>0/2/2</span></p>
</td>
<td valign="top"><p>172.20.0.61/30</p>
</td>
</tr>
</table></div>
</div>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172374398__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure interfaces and assign IP addresses to them.</p>
</li><li><p>Establish a multi-device backup platform.</p>
</li><li><p>Configure IP address pool binding.</p>
</li><li><p>Bind an RBP to an interface through which the user goes online.</p>
</li><li><p>Configure routes to ensure IP connectivity between devices. For details, see "IP Routing" in <em><span class="keyword">HUAWEI NE40E-M2 series</span> <span class="keyword">Universal Service Router</span> Configuration Guide</em>.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172374398__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>VRRP ID</p>
</li><li><p>Interface IP addresses of <span class="keyword">Router</span>s that back up each other</p>
</li><li><p>Backup ID, which works together with an RBS to identify an RBP to which users belong</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172374398__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure interfaces for connecting <span class="keyword">Device</span> A to the LAN switch, and assign IP addresses to them.</span><p><p>The configuration on <span class="keyword">Device</span> A is used as an example. The configuration of <span class="keyword">Device</span> B is similar to the configuration of <span class="keyword">Device</span> A.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt;<strong> system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname <span class="keyword">Device</span>A</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A]<strong> interface Eth-Trunk3</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-Eth-Trunk3]<strong> description ToSwitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-Eth-Trunk3]<strong> commit </strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-Eth-Trunk3]<strong> quit </strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A]<strong> interface GigabitEthernet<span>0/1/3</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/3</span>]<strong> description ToSwitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/3</span>] <strong>undo shutdown </strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/3</span>]<strong> eth-trunk 3</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/3</span>]<strong> commit </strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/3</span>]<strong> quit </strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A]<strong> interface Eth-Trunk3.4001</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-Eth-Trunk3.4001]<strong> control-vid 4001 dot1q-termination</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-Eth-Trunk3.4001] <strong>dot1q termination vid 4001</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-Eth-Trunk3.4001]<strong> ip address 192.168.254.2 255.255.255.248</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-Eth-Trunk3.4001]<strong> commit </strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-Eth-Trunk3.4001]<strong> quit </strong></pre>
</p></li><li><span>Configure IP addresses for loopback and interconnection interfaces on <span class="keyword">Device</span> A and <span class="keyword">Device</span> B.</span><p><p>Configure IP addresses for loopback interfaces. The configuration on <span class="keyword">Device</span> A is used as an example. The configuration of <span class="keyword">Device</span> B is similar to that of <span class="keyword">Device</span> A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A]<strong>interface loopback10</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-Loopback10]<strong> ip address 172.20.1.3 255.255.255.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-Loopback10]<strong> commit </strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-Loopback10]<strong> quit </strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A]<strong> interface loopback0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-Loopback0]<strong> ip address 172.20.1.1 255.255.255.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-Loopback0]<strong> commit </strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-Loopback0]<strong> quit </strong></pre>
<p>Configure IP addresses for interconnection interfaces. The configuration on <span class="keyword">Device</span> A is used as an example. The configuration of <span class="keyword">Device</span> B is similar to the configuration of <span class="keyword">Device</span> A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A]<strong>interface Eth-Trunk2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-Eth-Trunk2]<strong> description ToBackupDevice </strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-Eth-Trunk2]<strong>ip address 172.20.0.41 255.255.255.252</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-Eth-Trunk2]<strong> commit </strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-Eth-Trunk2]<strong> quit </strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A]<strong>interface GigabitEthernet<span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/2</span>]<strong> description ToBackupDevice</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/2</span>]<strong> undo shutdown </strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/2</span>]<strong> eth-trunk 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/2</span>]<strong> commit </strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/2</span>]<strong> quit </strong></pre>
</p></li><li><span>Establish a multi-device backup platform. The configuration on <span class="keyword">Device</span> A is used as an example. The configuration of <span class="keyword">Device</span> B is similar to that of <span class="keyword">Device</span> A.</span><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, only the RUI-related configuration is described. For other configurations, see the corresponding configuration guide.</p>
</div></div>
<p># Configure a BFD session on the access side to rapidly detect interface or link faults and trigger a master/backup VRRP switchover. 192.168.254.3 is the IP address of Eth-Trunk 3.4001 on <span class="keyword">Device</span> B.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A]<strong> bfd </strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-bfd]<strong> quit </strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A]<strong> bfd eth-trunk3-peer bind peer-ip 192.168.254.3 source-ip 192.168.254.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-bfd-session-eth-trunk3-peer]<strong> discriminator local 2 </strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-bfd-session-eth-trunk3-peer]<strong> discriminator remote 3 </strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-bfd-session-eth-trunk3-peer]<strong> commit </strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-bfd-session-eth-trunk3-peer]<strong> quit </strong></pre>
<p># Configure a VRRP group on Eth-Trunk 3.4001, and configure the VRRP group to track the BFD session and network-side interface.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A]<strong> vrrp recover-delay 15</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A]<strong> commit </strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A]<strong> interface Eth-Trunk3.4001</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-Eth-Trunk3.4001]<strong> vrrp vrid 3 virtual-ip 192.168.254.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-Eth-Trunk3.4001]<strong> admin-vrrp vrid 3</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-Eth-Trunk3.4001]<strong> vrrp vrid 3 priority 120</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-Eth-Trunk3.4001] <strong>vrrp vrid 3 preempt-mode timer delay 1200</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-Eth-Trunk3.4001]<strong> vrrp vrid 3 track interface GigabitEthernet<span>0/1/0</span> reduced 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-Eth-Trunk3.4001]<strong> vrrp vrid 3 track bfd-session 2 peer</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-Eth-Trunk3.4001]<strong> commit </strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-Eth-Trunk3.4001]<strong> quit </strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Different priorities must be configured for devices in a VRRP group. The device with a higher priority is the master device.</p>
</div></div>
<p># Configure an RBS.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A]<strong> remote-backup-service rbs_qhmd </strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-rm-backup-rbs_qhmd]<strong> peer 172.20.1.2 source 172.20.1.3 port 2046</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-rm-backup-rbs_qhmd] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-rm-backup-rbs_qhmd]<strong> track interface GigabitEthernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-rm-backup-rbs_qhmd]<strong> track interface GigabitEthernet<span>0/2/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-rm-backup-rbs_qhmd]<strong> protect redirect ip-nexthop 172.20.0.42 interface Eth-Trunk2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-rm-backup-rbs_qhmd] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-rm-backup-rbs_qhmd]<strong> quit </strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Ensure that the master and backup devices can ping each other.</p>
</div></div>
<p># Configure an RBP.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A]<strong> remote-backup-profile rbp3 </strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-rm-backup-prf-rbp3]<strong> service-type bras </strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-rm-backup-prf-rbp3]<strong> backup-id 3 remote-backup-service rbs_qhmd</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-rm-backup-prf-rbp3]<strong> peer-backup hot </strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-rm-backup-prf-rbp3]<strong> vrrp-id 3 interface Eth-Trunk3.4001</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-rm-backup-prf-rbp3]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-rm-backup-prf-rbp3]<strong> nas logic-port Gigabitethernet <span>0/1/3</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-rm-backup-prf-rbp3]<strong> </strong><strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-rm-backup-prf-rbp3]<strong> nas logic-sysname MasterDevice</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-rm-backup-prf-rbp3]<strong> nas logic-ip 172.20.1.1</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-rm-backup-prf-rbp3]<strong> quit </strong></pre>
</p></li><li><span>Configure IP address pool binding. The configuration on <span class="keyword">Device</span> A is used as an example. The configuration of <span class="keyword">Device</span> B is similar to that of <span class="keyword">Device</span> A.</span><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>To configure an address pool on the backup device, run the <strong><a href="cmdqueryname=ip+pool"><b><span class="cmdname">ip pool</span></b></a> </strong><em><i><span class="varname">ip-pool-name</span></i></em><strong> <strong><span>bas</span></strong></strong> { <strong><strong><span>local</span></strong></strong> | <strong><strong><span>remote</span></strong></strong> } <strong><strong><span>rui-slave</span></strong></strong> command. In load balancing scenarios, if this command is not run, the master and backup devices may be assigned the same IP address, causing an address assignment conflict.</p>
</div></div>
<p># Configure an address pool.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>ip pool dmtjs_xi bas local</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-ip-pool-dmtjs_xi] <strong>gateway 192.168.1.1 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-ip-pool-dmtjs_xi] <strong>section 0 192.168.1.2 192.168.1.254 </strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-ip-pool-dmtjs_xi] <strong>dns-server 192.168.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-ip-pool-dmtjs_xi] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-ip-pool-dmtjs_xi] <strong>quit</strong></pre>
<p># Bind the address pool to the RBS.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A]<strong> remote-backup-service rbs_qhmd</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-rm-backup-service rbs_qhmd]<strong> commit </strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-rm-backup-service rbs_qhmd]<strong> ip-pool dmtjs_xi metric 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-rm-backup-service rbs_qhmd]<strong> </strong><strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-backup-service rbs_qhmd] <strong>quit</strong></pre>
</p></li><li><span>Configure a RADIUS server group.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>radius-server group rd</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-radius-rd]<strong> radius-server authentication 10.7.66.66 1812</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-radius-rd] <strong>radius-server accounting 10.7.66.66 1813</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-radius-rd] <strong>radius-server shared-key-cipher YsHsjx_202206</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-radius-rd] <strong>radius-server retransmit 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-radius-rd] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-radius-rd] <strong>quit</strong></pre>
</p></li><li><span>Configure authentication and accounting policies for user access. The configuration on <span class="keyword">Device</span> A is used as an example. The configuration of <span class="keyword">Device</span> B is similar to that of <span class="keyword">Device</span> A.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>aaa</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-aaa] <strong>authentication-scheme wu</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-aaa-authen-wu] <strong>authentication-mode radius</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-aaa-authen-wu] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-aaa-authen-wu] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-aaa] <strong> accounting-scheme wu</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-aaa-accounting-wu] <strong>accounting-mode none</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-aaa-accounting-wu] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-aaa-accounting-wu] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-aaa] <strong> domain dmtjs_xi</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-aaa-domain-dmtjs_xi] <strong>authentication-scheme wu</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-aaa-domain-dmtjs_xi] <strong>accounting-scheme wu</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-aaa-domain-dmtjs_xi] <strong>radius-server group rd</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-aaa-domain-dmtjs_xi] <strong>ip-pool dmtjs_xi</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-aaa-domain-dmtjs_xi] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-aaa-domain-dmtjs_xi] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-aaa] <strong>quit</strong></pre>
</p></li><li><span>Bind the RBP to <span>Eth-Trunk3.5001</span> through which users go online. The configuration of <span class="keyword">Device</span> B is similar to that of <span class="keyword">Device</span> A.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A]<strong> interface <span>Eth-Trunk3.5001</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-<span>Eth-Trunk3.5001</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-<span>Eth-Trunk3.5001</span>]<strong> user-vlan 1</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-<span>Eth-Trunk3.5001</span>-vlan-1-1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-<span>Eth-Trunk3.5001</span>]<strong> remote-backup-profile rbp3 </strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-<span>Eth-Trunk3.5001</span>]<strong> bas</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-<span>Eth-Trunk3.5001</span>-bas]<strong>access-type layer2-subscriber default-domain authentication dmtjs_xi</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-<span>Eth-Trunk3.5001</span>-bas]<strong> authentication-method bind</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-<span>Eth-Trunk3.5001</span>-bas]<strong> commit </strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-<span>Eth-Trunk3.5001</span>-bas]<strong> quit </strong></pre>
</p></li><li><span>Configure advertisement of address pool routes. The configuration on <span class="keyword">Device</span> A is used as an example. The configuration of <span class="keyword">Device</span> B is similar to that of <span class="keyword">Device</span> A.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A]<strong> ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-ospf-1]<strong> import-route unr</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-ospf-1]<strong> area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-ospf-1-area-0.0.0.0]<strong> network 172.20.1.1 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-ospf-1-area-0.0.0.0]<strong> network 172.20.1.3 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-ospf-1-area-0.0.0.0]<strong> network 172.20.0.36 0.0.0.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-ospf-1-area-0.0.0.0]<strong> network 172.20.0.40 0.0.0.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-ospf-1-area-0.0.0.0]<strong> network 172.20.0.60 0.0.0.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-ospf-1-area-0.0.0.0]<strong> commit </strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-ospf-1-area-0.0.0.0]<strong> quit </strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p>After successfully configuring the RBP, run the <strong>display remote-backup-profile</strong> command. The command output shows that the RBS type is <strong>bras</strong>, the RBP named <strong>rbp3</strong> is bound to <strong>Eth-Trunk3.5001</strong> through which users go online, and <span class="keyword">Device</span> A is in the <strong>Master</strong> state.</p>
<pre class="screen">&lt;<span class="keyword">Device</span>A&gt; <strong>display remote-backup-profile rbp3</strong>
-----------------------------------------------
 Profile-Index        : 0x802
 Profile-Name         : rbp3
 <strong>Service            : bras</strong>
 Remote-backup-service: rbs_qhmd
 Backup-ID            : 10
 track protocol       : VRRP
 VRRP-ID              : 3
 VRRP-Interface       : Eth-Trunk3.4001
 <strong>Interface          : Eth-Trunk3.5001</strong>
 <strong>State              : Master</strong>
 <strong>Peer-state         : Slave</strong>
 Backup mode          : hot
 Slot-Number          : 1
 Card-Number          : 0
 Port-Number          : 0
 Nas logic-port       : Gigabitethernet <span>0/1/3</span>
 Nas logic-ip         : 172.20.1.1
 Nas logic-sysname    : MasterDevice
 Traffic interval     : 10(minutes)</pre>
<p>After the RBS is configured successfully, the TCP connection status becomes <strong>Connected</strong>.</p>
<pre class="screen">&lt;<span class="keyword">Device</span>A&gt; <strong>display remote-backup-service rbs_qhmd </strong>
----------------------------------------------------------
 Service-Index    : 0
 Service-Name     : rbs_qhmd
 <strong>TCP-State      : Connected</strong>
 Peer-ip          : 172.20.1.2 
 Source-ip        : 172.20.1.3 
 TCP-Port         : 2046
 Track-BFD        : --
 Track-interface0 : <span>0/1/0</span>
                  Weight : 10
 Track-interface1 : <span>0/2/2</span>
                  Weight : 10
 SSL-Policy-Name  : --
 SSL-State        : --
Uplink state     : 2 (1:DOWN 2:UP)
 Domain-map-list  : --
----------------------------------------------------------

 ip pool:  
         dmtjs_xi metric 10
 ipv6 pool:  
 Failure ratio    : 100%
 Failure duration : 0 min
--------------------------------------------------------</pre>
<p>After users go online, run the <strong>display backup-user</strong> command to check information about backup users.</p>
<pre class="screen">&lt;<span class="keyword">Device</span>A&gt; <strong>display backup-user</strong></pre>
<pre class="screen">  Remote-backup-service: rbs_qhmd
  Total Users Numer: 3
------------------------------------------------------------------------
 100     101     102    
------------------------------------------------------------------------
</pre>
<p>Run the <strong>display access-user interface</strong> command to view online user information on a specified interface.</p>
<pre class="screen">&lt;<span class="keyword">Device</span>A&gt; <strong>display access-user interface Eth-Trunk3.5001</strong></pre>
<pre class="screen">------------------------------------------------------------------------------
  UserID  Username                Interface      IP address       MAC                     IPv6 address
  ------------------------------------------------------------------------------
  --------------------------------------------------------------------------
  100     user1@dmtjs_xi          Eth-Trunk3.5001   192.168.1.10    00e0-fc12-0101          -
  101     user2@dmtjs_xi          Eth-Trunk3.5001   192.168.1.9     00e0-fc12-0102          -
  102     user3@dmtjs_xi          Eth-Trunk3.5001   192.168.1.8     00e0-fc12-0103          -
  --------------------------------------------------------------------------
  Total users                        :3</pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172374398__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p><span class="keyword">Device</span> A configuration file</p>
<pre class="screen">#</pre>
<pre class="screen"> sysname <span class="keyword">Device</span>A</pre>
<pre class="screen">#</pre>
<pre class="screen">router id 172.20.1.3</pre>
<pre class="screen">#</pre>
<pre class="screen">vrrp recover-delay 15</pre>
<pre class="screen">#</pre>
<pre class="screen">vlan batch 2 to 9 11 to 504 506 to 3999 4001 to 4094</pre>
<pre class="screen">#</pre>
<pre class="screen">bfd</pre>
<pre class="screen">#</pre>
<pre class="screen">ip pool dmtjs_xi bas local </pre>
<pre class="screen">gateway 192.168.1.1 255.255.255.0</pre>
<pre class="screen">section 0 192.168.1.2 192.168.1.254 </pre>
<pre class="screen">dns-server 192.168.1.1</pre>
<pre class="screen">#</pre>
<pre class="screen">radius-server group rd                                                                                         </pre>
<pre class="screen"> radius-server authentication 10.7.66.66 1812 weight 0                                             </pre>
<pre class="screen"> radius-server accounting 10.7.66.66 1813 weight 0                                                            </pre>
<pre class="screen"> radius-server shared-key-cipher %^%#h{FXVBLZX9#`VI]EWUUaOSHGd5E!.1DGeVYEie=%^%                                       </pre>
<pre class="screen"> radius-server retransmit 2   </pre>
<pre class="screen">#</pre>
<pre class="screen">aaa</pre>
<pre class="screen"> authentication-scheme wu</pre>
<pre class="screen">  authentication-mode radius</pre>
<pre class="screen"><strong> </strong>accounting-scheme wu </pre>
<pre class="screen">  accounting-mode none</pre>
<pre class="screen"> domain dmtjs_xi </pre>
<pre class="screen">  authentication-scheme wu </pre>
<pre class="screen">  accounting-scheme wu</pre>
<pre class="screen">  radius-server group rd</pre>
<pre class="screen">  ip-pool dmtjs_xi </pre>
<pre class="screen">#</pre>
<pre class="screen">bfd eth-trunk3-peer bind peer-ip 192.168.254.3 source-ip 192.168.254.2</pre>
<pre class="screen"> discriminator local 2 </pre>
<pre class="screen"> discriminator remote 3 </pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/3</span></pre>
<pre class="screen">description ToSwitch</pre>
<pre class="screen">undo shutdown
#</pre>
<pre class="screen">interface Eth-Trunk3
 description ToSwitch
#</pre>
<pre class="screen">interface Eth-Trunk3.4001</pre>
<pre class="screen"> control-vid 4001 dot1q-termination</pre>
<pre class="screen"> dot1q termination vid 4001</pre>
<pre class="screen"> ip address 192.168.254.2 255.255.255.248</pre>
<pre class="screen"> vrrp vrid 3 virtual-ip 192.168.254.1</pre>
<pre class="screen"> admin-vrrp vrid 3 </pre>
<pre class="screen"> vrrp vrid 3 priority 120 </pre>
<pre class="screen"> vrrp vrid 3 preempt-mode timer delay 1200</pre>
<pre class="screen"> vrrp vrid 3 track bfd-session 2 peer</pre>
<pre class="screen"> vrrp vrid 3 track interface GigabitEthernet<span>0/1/0</span> reduced 30</pre>
<pre class="screen">#</pre>
<pre class="screen">interface LoopBack0</pre>
<pre class="screen"> ip address 172.20.1.1 255.255.255.255</pre>
<pre class="screen">#</pre>
<pre class="screen">interface LoopBack10</pre>
<pre class="screen"> ip address 172.20.1.3 255.255.255.255</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 172.20.0.33 255.255.255.252</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/2/2</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 172.20.0.57 255.255.255.252</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/2</span></pre>
<pre class="screen"> description ToBackupDevice</pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> eth-trunk 2</pre>
<pre class="screen">#</pre>
<pre class="screen">interface Eth-Trunk2</pre>
<pre class="screen"> description ToBackupDevice</pre>
<pre class="screen"> ip address 172.20.0.41 255.255.255.252</pre>
<pre class="screen">#</pre>
<pre class="screen">remote-backup-service rbs_qhmd</pre>
<pre class="screen"> peer 172.20.1.2 source 172.20.1.3 port 2046</pre>
<pre class="screen"> track interface gigabitethernet <span>0/1/0</span> </pre>
<pre class="screen"> track interface gigabitethernet <span>0/2/2</span> </pre>
<pre class="screen"> protect redirect ip-nexthop 172.20.0.42 interface Eth-Trunk2</pre>
<pre class="screen"> ip-pool dmtjs_xi metric 10</pre>
<pre class="screen">#</pre>
<pre class="screen">remote-backup-profile rbp3 </pre>
<pre class="screen"> service-type bras</pre>
<pre class="screen"> backup-id 3 remote-backup-service rbs_qhmd</pre>
<pre class="screen"> peer-backup hot </pre>
<pre class="screen"> vrrp-id 3 interface Eth-Trunk3.4001</pre>
<pre class="screen"> nas logic-port gigabitethernet<span>0/1/3</span> </pre>
<pre class="screen"> nas logic-sysname MasterDevice </pre>
<pre class="screen"> nas logic-ip 172.20.1.1 </pre>
<pre class="screen">#</pre>
<pre class="screen">interface <span>Eth-Trunk3.5001</span></pre>
<pre class="screen"> user-vlan 1 </pre>
<pre class="screen"> remote-backup-profile rbp3 </pre>
<pre class="screen"> bas </pre>
<pre class="screen">  access-type layer2-subscriber default-domain authentication dmtjs_xi</pre>
<pre class="screen">  authentication-method bind </pre>
<pre class="screen"> #</pre>
<pre class="screen">#
ospf 1
 import-route unr
 area 0.0.0.0
  network 172.20.0.36 0.0.0.3
  network 172.20.0.60 0.0.0.3
  network 172.20.0.40 0.0.0.3
  network 172.20.1.1 0.0.0.0
  network 172.20.1.3 0.0.0.0</pre>
<pre class="screen">#</pre>
<pre class="screen"> return </pre>
</li><li><p><span class="keyword">Device</span> B configuration file</p>
<pre class="screen">#</pre>
<pre class="screen"> sysname <span class="keyword">Device</span>B</pre>
<pre class="screen">#</pre>
<pre class="screen">router id 172.20.1.2</pre>
<pre class="screen">#</pre>
<pre class="screen">vrrp recover-delay 15</pre>
<pre class="screen">#</pre>
<pre class="screen">vlan batch 2 to 9 11 to 504 506 to 3999 4001 to 4094</pre>
<pre class="screen">#</pre>
<pre class="screen">bfd</pre>
<pre class="screen">#</pre>
<pre class="screen">ip pool dmtjs_xi bas local rui-slave</pre>
<pre class="screen">gateway 192.168.1.1 255.255.255.0</pre>
<pre class="screen">section 0 192.168.1.2 192.168.1.254 </pre>
<pre class="screen">dns-server 192.168.1.1</pre>
<pre class="screen">#</pre>
<pre class="screen">radius-server group rd                                                                                         
 radius-server authentication 10.7.66.66 1812 weight 0                                             
 radius-server accounting 10.7.66.66 1813 weight 0                                                            
 radius-server shared-key-cipher %^%#h{FXVBLZX9#`VI]EWUUaOSHGd5E!.1DGeVYEie=%^%                                       
 radius-server retransmit 2   
#</pre>
<pre class="screen">#</pre>
<pre class="screen">aaa</pre>
<pre class="screen"> authentication-scheme wu</pre>
<pre class="screen">  authentication-mode radius</pre>
<pre class="screen"> accounting-scheme wu </pre>
<pre class="screen">  accounting-mode none</pre>
<pre class="screen"> domain dmtjs_xi </pre>
<pre class="screen">  authentication-scheme wu </pre>
<pre class="screen">  accounting-scheme wu</pre>
<pre class="screen">  ip-pool dmtjs_xi </pre>
<pre class="screen">  radius-server group rd</pre>
<pre class="screen">#</pre>
<pre class="screen">bfd eth-trunk3-peer bind peer-ip 192.168.254.2 source-ip 192.168.254.3</pre>
<pre class="screen"> discriminator local 3 </pre>
<pre class="screen"> discriminator remote 2 </pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/3</span></pre>
<pre class="screen"> description ToSwitch</pre>
<pre class="screen"> undo shutdown
#</pre>
<pre class="screen">interface Eth-Trunk3
 description ToSwitch
#</pre>
<pre class="screen"> interface Eth-Trunk3.4001</pre>
<pre class="screen"> control-vid 4001 dot1q-termination</pre>
<pre class="screen"> dot1q termination vid 4001</pre>
<pre class="screen"> ip address 192.168.254.3 255.255.255.248</pre>
<pre class="screen"> vrrp vrid 3 virtual-ip 192.168.254.1</pre>
<pre class="screen"> admin-vrrp vrid 3 </pre>
<pre class="screen"> vrrp vrid 3 track bfd-session 3 peer</pre>
<pre class="screen">#</pre>
<pre class="screen">interface LoopBack0</pre>
<pre class="screen"> ip address 172.20.1.4 255.255.255.255</pre>
<pre class="screen">#</pre>
<pre class="screen">interface LoopBack10</pre>
<pre class="screen"> ip address 172.20.1.2 255.255.255.255</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 172.20.0.37 255.255.255.252</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/2/2</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 172.20.0.61 255.255.255.252</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/2</span></pre>
<pre class="screen"> description ToMasterDevice</pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> eth-trunk 2</pre>
<pre class="screen">#</pre>
<pre class="screen">interface Eth-Trunk2</pre>
<pre class="screen"> description ToMasterDevice</pre>
<pre class="screen"> ip address 172.20.0.42 255.255.255.252</pre>
<pre class="screen">#</pre>
<pre class="screen">remote-backup-service rbs_qhmd</pre>
<pre class="screen"> peer 172.20.1.3 source 172.20.1.2 port 2046</pre>
<pre class="screen"> track interface gigabitethernet <span>0/1/0</span></pre>
<pre class="screen"> track interface gigabitethernet <span>0/2/2</span></pre>
<pre class="screen"> protect redirect ip-nexthop 172.20.0.41 interface Eth-Trunk2</pre>
<pre class="screen"> ip-pool dmtjs_xi metric 20</pre>
<pre class="screen">#</pre>
<pre class="screen">remote-backup-profile rbp3 </pre>
<pre class="screen"> service-type bras</pre>
<pre class="screen"> backup-id 3 remote-backup-service rbs_qhmd</pre>
<pre class="screen"> peer-backup hot </pre>
<pre class="screen"> vrrp-id 3 interface Eth-Trunk3.4001</pre>
<pre class="screen"> nas logic-port gigabitethernet<span>0/1/3</span> </pre>
<pre class="screen"> nas logic-sysname MasterDevice </pre>
<pre class="screen"> nas logic-ip 172.20.1.1 </pre>
<pre class="screen">#</pre>
<pre class="screen">interface <span>Eth-Trunk3.5001</span></pre>
<pre class="screen"> user-vlan 1 </pre>
<pre class="screen"> remote-backup-profile rbp3 </pre>
<pre class="screen"> bas </pre>
<pre class="screen">  access-type layer2-subscriber default-domain authentication dmtjs_xi</pre>
<pre class="screen">  authentication-method bind </pre>
<pre class="screen"> #</pre>
<pre class="screen">#
ospf 1
 import-route unr
 area 0.0.0.0
  network 172.20.0.36 0.0.0.3
  network 172.20.0.60 0.0.0.3
  network 172.20.0.40 0.0.0.3
  network 172.20.1.2 0.0.0.0
  network 172.20.1.3 0.0.0.0</pre>
<pre class="screen">#</pre>
<pre class="screen"> return </pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cfg_rui_0050.html">Configuration Examples
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cfg_rui_0051.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cfg_rui_0052.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>