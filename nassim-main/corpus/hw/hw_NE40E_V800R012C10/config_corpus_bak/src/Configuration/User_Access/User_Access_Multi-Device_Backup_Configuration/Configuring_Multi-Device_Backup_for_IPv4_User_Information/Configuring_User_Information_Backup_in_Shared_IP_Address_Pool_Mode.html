
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring User Information Backup in Shared IP Address Pool Mode">
<meta name="abstract" content="In shared address pool mode, links need to be added, and the networking mode is flexible.">
<meta name="description" content="In shared address pool mode, links need to be added, and the networking mode is flexible.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cfg_rui_0004.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cfg_rui_0012.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cfg_rui_0010.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="z00588052,w00606909,w00447999">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="UP Multi-Device Backup">
<meta name="featurename" content="User Access Multi-Device Backup">
<meta name="featuretype" content="User Access">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="UP Multi-Device Backup">
<meta name="featurename" content="User Access Multi-Device Backup">
<meta name="featuretype" content="User Access">
<meta name="featurename" content="UP Multi-Device Backup">
<meta name="featurename" content="User Access Multi-Device Backup">
<meta name="featuretype" content="User Access">
<meta name="featurename" content="User Access Multi-Device Backup">
<meta name="featuretype" content="User Access">
<meta name="OWNER" content="l00425560">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="z00588052">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172374354">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring User Information Backup in Shared IP Address Pool Mode</title>
</head>
<body><a name="EN-US_TASK_0172374354"></a><a name="EN-US_TASK_0172374354"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring User Information Backup in Shared IP Address Pool Mode</h1>
<div class="taskbody"><p>In shared address pool mode, links need to be added, and the networking mode is flexible.</p>
<div class="context"><a name="EN-US_TASK_0172374354__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>If the exclusive address pool mode is used, a great number of address pools are needed. This wastes addresses. To resolve the preceding issue, a shared address pool needs to be deployed. When a shared address pool is deployed, the following requirements must be met:</p>
<ul><li>The address pool cannot be bound to a remote backup profile (RBP).</li><li>Both the master and backup devices need to be configured with the route control function to advertise address pool subnet routes so that the address pool subnet routes advertised by the master device have a higher priority. This prevents load balancing between network-side devices.</li><li>A protection tunnel (for example, an LSP) must be established between the master and backup devices. If a user's uplink fails, the user's downlink traffic will be switched to the protection tunnel.</li><li>The primary and secondary address pools need to be bound to the RBS using the <a href="cmdqueryname=ip-pool"><b><span class="cmdname">ip-pool</span></b></a> <i><span class="varname">pool-name</span></i> command in the RBS view. This ensures that network-side traffic can be forwarded through the protection tunnel before host routes are generated.</li></ul>
<p>Perform the following steps on the devices that back up each other:</p>
</div></div>
<div class="steps-unordered"><a name="EN-US_TASK_0172374354__1.4.2"></a><a name="1.4.2"></a><h4 class="sectiontitle">Procedure</h4>
<ul><li><span>Configure address pools on the master and backup devices.</span><ol><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ip+pool"><b><span class="cmdname">ip pool</span></b></a> <i><span class="varname">ip-pool-name</span></i> [ <strong><span>bas</span></strong> { <strong><span>local</span></strong> | <strong><span>remote</span></strong> } <strong><span>rui-slave</span></strong> ]</span><p><p>An address pool is created, and its view is displayed.</p>
</p><p><p>A primary address pool (by specifying <strong><span>local</span></strong>) and a secondary address pool (by specifying <strong><span>rui-slave</span></strong><span>(<strong><span>local</span></strong> <strong><span>rui-slave</span></strong>)</span>) must be configured on both the master and backup devices.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The <span class="keyword">Router</span> allows a third device to function as a remote DHCP server to allocate addresses to users logging in to the master and backup devices. In this case, you need to configure a remote address pool on the master device and a remote RUI-slave address pool on the backup device. The address pools must be associated with the DHCP server group on the remote DHCP server.</p>
</div></div>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=gateway"><b><span class="cmdname">gateway</span></b></a> <i><span class="varname">ip-address</span></i> { <em><i><span class="varname">mask-length</span></i></em> | <em><i><span class="varname">mask</span></i></em> }</span><p><p>The gateway address of the address pool is configured.</p>
</p><p><p>The gateway address and subnet mask are used to verify if an address in the configured address segment resides on the same subnet as the gateway. Therefore, you must configure the gateway address and mask before configuring address segments.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=section"><b><span class="cmdname">section</span></b></a> <i><span class="varname">section-number</span></i> <i><span class="varname">start-ip-address</span></i> [ <i><span class="varname">end-ip-address</span></i> ]</span><p><p>The address segment is configured for the address pool.</p>
</p><p><p>If both the master and backup devices have two address pools configured, the address pools on each device must use different address segments. In addition, the primary address pool on the master device and the secondary address pool on the backup device share the same address segment, so do the secondary address pool on the master device and the primary address pool on the backup device. This prevents address conflicts if an master/backup device switchover occurs in a load balancing scenario.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><div class="p">After the address pool type is set to <strong><span>rui-slave</span></strong><span> (by specifying <strong><span>local</span></strong> <strong><span>rui-slave</span></strong>)</span>:<ul><li>You can perform the following steps to configure parameters related to the remote DHCP server.</li><li>If an RUI-slave address pool configured by specifying <strong><span>local</span></strong> <strong><span>rui-slave</span></strong> is bound to an RBS, the address pool automatically uses the peer IP address configured in the RBS as a DHCP server IP address.</li></ul>
</div>
<p>Before performing the following steps, run the <a href="cmdqueryname=dhcp-server+group"><b><span class="cmdname">dhcp-server group</span></b></a> <i><span class="varname">group-name</span></i> <strong><span>remote-backup-service</span></strong> <i><span class="varname">rbs-name</span></i> command in the system view to specify the name of a DHCP server group and the RBS to be associated with the DHCP server group.</p>
</div></div>
</p></li></ol>
</li><li><span>Configure a protection path in IP redirection mode for public network users.</span><p><p>Before configuring a protection path in IP redirection mode, ensure that a direct link has been deployed between the devices that back up each other.</p>
</p><ol><li class="substepexpand"><span>Run the <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a> command to enter the system view.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=remote-backup-service"><b><span class="cmdname">remote-backup-service</span></b></a> <i><span class="varname">service-name</span></i> command to enter the RBS view.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=protect"><b><span class="cmdname">protect</span></b></a> <strong><span>redirect</span></strong> <strong><span>ip-nexthop</span></strong> <i><span class="varname">ip-address</span></i> <strong><span>interface</span></strong> { <em><i><span class="varname">interface-name</span></i></em> | <em>interface-type</em><em> interface-num</em> } command to configure a protection path in IP redirection mode for public network users, with the peer IP address and the local outbound interface specified.</span></li><li class="substepexpand"><span>Run either of the following commands to bind the primary address pool or an address pool group to the RBS:</span><p><ul><li>To bind the primary address pool to the RBS, run the <a href="cmdqueryname=ip-pool"><b><span class="cmdname">ip-pool</span></b></a> <i><span class="varname">pool-name</span></i> command.</li><li>To bind an address pool group to the RBS, run the <a href="cmdqueryname=ip-pool-group"><b><span class="cmdname">ip-pool-group</span></b></a> <i><span class="varname">pool-group-name</span></i> [ <strong><span>metric</span></strong> <i><span class="varname">metric-name</span></i> ] command.</li></ul>
</p></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a> command to commit the configuration.</span></li></ol>
</li><li><span>Configure a protection path in tunnel mode for public network users.</span><ol><li class="substepexpand"><span>Run the <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a> command to enter the system view.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=remote-backup-service"><b><span class="cmdname">remote-backup-service</span></b></a> <i><span class="varname">service-name</span></i> command to enter the RBS view.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=protect"><b><span class="cmdname">protect</span></b></a> <strong><span>tnl-policy</span></strong> <i><span class="varname">policy-name</span></i> <strong><span>peer-ip</span></strong> <i><span class="varname">ip-address</span></i> [ <strong><span>interface</span></strong> <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i> ] command to configure a protection path for public network users as an LSP, MPLS TE tunnel, or GRE tunnel. The tunnel type is specified through the tunnel policy, and the outbound interface is optional.</span></li><li class="substepexpand"><span>Run either of the following commands to bind the primary address pool or an address pool group to the RBS:</span><p><ul><li>To bind the primary address pool to the RBS, run the <a href="cmdqueryname=ip-pool"><b><span class="cmdname">ip-pool</span></b></a> <i><span class="varname">pool-name</span></i> command.</li><li>To bind an address pool group to the RBS, run the <a href="cmdqueryname=ip-pool-group"><b><span class="cmdname">ip-pool-group</span></b></a> <i><span class="varname">pool-group-name</span></i> [ <strong><span>metric</span></strong> <i><span class="varname">metric-name</span></i> ] command.</li></ul>
</p></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a> command to commit the configuration.</span></li></ol>
</li><li><span>Configure a protection path for VPN users.</span><ol><li class="substepexpand"><span>Run the <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a> command to enter the system view.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=remote-backup-service"><b><span class="cmdname">remote-backup-service</span></b></a> <i><span class="varname">service-name</span></i> command to enter the RBS view.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=protect"><b><span class="cmdname">protect</span></b></a> <strong><span>ip-vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i> <strong><span>peer-ip</span></strong> <i><span class="varname">ip-address</span></i> [ <strong><span>interface</span></strong> <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i> ] command to configure a protection tunnel for VPN users, with the VPN instance name specified. <strong><span>peer-ip</span></strong> specifies the IP address of the loopback interface bound to the VPN instance on the peer end. The tunnel type cannot be specified. Instead, it is automatically selected by the device. The outbound interface is optional.</span></li><li class="substepexpand"><span>Run either of the following commands to bind the primary address pool or an address pool group to the RBS:</span><p><ul><li>To bind the primary address pool to the RBS, run the <a href="cmdqueryname=ip-pool"><b><span class="cmdname">ip-pool</span></b></a> <i><span class="varname">pool-name</span></i> command.</li><li>To bind an address pool group to the RBS, run the <a href="cmdqueryname=ip-pool-group"><b><span class="cmdname">ip-pool-group</span></b></a> <i><span class="varname">pool-group-name</span></i> [ <strong><span>metric</span></strong> <i><span class="varname">metric-name</span></i> ] command.</li></ul>
</p></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a> command to commit the configuration.</span></li></ol>
</li><li><span>Configure a protection tunnel template for the public and private networks.</span><ol><li class="substepexpand"><span>Run the <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a> command to enter the system view.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=remote-backup-service"><b><span class="cmdname">remote-backup-service</span></b></a> <i><span class="varname">service-name</span></i> command to enter the RBS view.</span></li><li class="substepexpand"><span>Either of the following methods can be used:</span><p><ul><li>To configure a protection tunnel template in MPLS LSP mode, run the <a href="cmdqueryname=protect+lsp-tunnel+for-all-instance+peer-ip"><b><span class="cmdname">protect lsp-tunnel for-all-instance peer-ip</span></b></a> <i><span class="varname">ip-address</span></i> command.</li><li>To configure a protection tunnel template in SRv6 TE Policy mode, run the <a href="cmdqueryname=protect+srv6+tunnel-policy"><b><span class="cmdname">protect srv6 tunnel-policy</span></b></a> <i><span class="varname">policy-name</span></i> <strong><span>endpoint</span></strong> <i><span class="varname">ipv6-address</span></i> <strong><span>color</span></strong> <i><span class="varname">color-number</span></i> command after a tunnel policy is created using the <a href="cmdqueryname=tunnel-policy"><b><span class="cmdname">tunnel-policy</span></b></a> command.</li></ul>
</p></li><li class="substepexpand"><span>Run either of the following commands to bind the primary address pool or an address pool group to the RBS:</span><p><ul><li>To bind the primary address pool to the RBS, run the <a href="cmdqueryname=ip-pool"><b><span class="cmdname">ip-pool</span></b></a> <i><span class="varname">pool-name</span></i> command.</li><li>To bind an address pool group to the RBS, run the <a href="cmdqueryname=ip-pool-group"><b><span class="cmdname">ip-pool-group</span></b></a> <i><span class="varname">pool-group-name</span></i> [ <strong><span>metric</span></strong> <i><span class="varname">metric-name</span></i> ] command.</li></ul>
</p></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a> command to commit the configuration.</span></li></ol>
<p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>A protection tunnel template can be configured concurrently for both a private network and a public network. After the <a href="cmdqueryname=protect+lsp-tunnel+for-all-instance+peer-ip"><b><span class="cmdname">protect lsp-tunnel for-all-instance peer-ip</span></b></a> command is run, a protection tunnel for a public network is directly created, and a protection tunnel for private networks is triggered by user login. This eliminates the need for configuring a protection tunnel for each private network, simplifying tunnel configuration.</p>
<p>To specifically create a protection tunnel for a public network, run the <a href="cmdqueryname=protect"><b><span class="cmdname">protect</span></b></a> <strong><span>tnl-policy</span></strong> <i><span class="varname">policy-name</span></i> <strong><span>peer-ip</span></strong> <i><span class="varname">ip-address</span></i> [ <strong><span>interface</span></strong> <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i> ] command. To specifically create a protection tunnel for a private network, run the <a href="cmdqueryname=protect"><b><span class="cmdname">protect</span></b></a> <strong><span>ip-vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i> <strong><span>peer-ip</span></strong> <i><span class="varname">ip-address</span></i> [ <strong><span>interface</span></strong> <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i> ] command. If one protection path is deployed using the <a href="cmdqueryname=protect+lsp-tunnel+for-all-instance+peer-ip"><b><span class="cmdname">protect lsp-tunnel for-all-instance peer-ip</span></b></a> command and the other protection path is deployed specifically for a private or public network, the former protection path has a higher priority, and the corresponding configuration takes effect.</p>
<p>If both the <a href="cmdqueryname=protect+lsp-tunnel+for-all-instance+peer-ip"><b><span class="cmdname">protect lsp-tunnel for-all-instance peer-ip</span></b></a> and <a href="cmdqueryname=protect+srv6+tunnel-policy"><b><span class="cmdname">protect srv6 tunnel-policy</span></b></a> commands are configured on the device, the latter command takes effect and has the highest priority.</p>
<p>Before running the <a href="cmdqueryname=protect+srv6+tunnel-policy"><b><span class="cmdname">protect srv6 tunnel-policy</span></b></a> command, you need to run the <a href="cmdqueryname=tunnel-policy"><b><span class="cmdname">tunnel-policy</span></b></a> command on the network side to create a tunnel policy. For details, see the <a href="../vrp/dc_vrp_srv6_cfg_all_0110.html">SRv6 TE Policy configuration (static configuration)</a> in the product documentation.</p>
</div></div>
</p></li></ul></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cfg_rui_0004.html">Configuring Multi-Device Backup for IPv4 User Information
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cfg_rui_0012.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cfg_rui_0010.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>