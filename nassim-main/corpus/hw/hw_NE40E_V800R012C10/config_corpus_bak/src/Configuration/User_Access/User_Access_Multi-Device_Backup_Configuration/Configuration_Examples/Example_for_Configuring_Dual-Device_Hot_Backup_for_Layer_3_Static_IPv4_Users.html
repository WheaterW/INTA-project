
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Dual-Device Hot Backup for Layer 3 Static IPv4 Users">
<meta name="abstract" content="This section provides an example for configuring dual-device hot backup for Layer 3 static IPv4 users.">
<meta name="description" content="This section provides an example for configuring dual-device hot backup for Layer 3 static IPv4 users.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cfg_rui_0050.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_rui_edsg_cfg_002.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cfg_rui_0062.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="z50024784,w00800033,z00588052,l00593348,w00606909,w00447999">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="UP Multi-Device Backup">
<meta name="featurename" content="User Access Multi-Device Backup">
<meta name="featuretype" content="User Access">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="UP Multi-Device Backup">
<meta name="featurename" content="User Access Multi-Device Backup">
<meta name="featuretype" content="User Access">
<meta name="featurename" content="UP Multi-Device Backup">
<meta name="featurename" content="User Access Multi-Device Backup">
<meta name="featuretype" content="User Access">
<meta name="featurename" content="User Access Multi-Device Backup">
<meta name="featuretype" content="User Access">
<meta name="OWNER" content="l00593348">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="z00588052">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172374419">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring Dual-Device Hot Backup for Layer 3 Static IPv4 Users</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172374419"></a><a name="EN-US_TASK_0172374419"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Dual-Device Hot Backup for Layer 3 Static IPv4 Users</h1>
<div class="taskbody"><p>This section provides an example for configuring dual-device hot backup for Layer 3 static IPv4 users.</p>
<div class="context"><a name="EN-US_TASK_0172374419__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><div class="p"><h4 class="sectiontitle">Usage Scenario</h4><p>High reliability is a basic requirement for carrier-class devices.</p>
<p>The <span class="keyword">NE40E</span> is an edge service aggregation router that carries multiple services. It plays a vital role on a network. It is uplinked to the core layer to implement the Layer 3 routing function and downlinked to the aggregation layer to terminate Layer 2 user packets for user access. Additionally, it carries Triple Play services â HSI, VoIP, and IPTV â which require high reliability. The <span class="keyword">NE40E</span> provides service-level high-reliability technologies. Non-stop data flow forwarding does not mean that user services are not interrupted. If a network node or link fails, user traffic is switched to a backup device. If user information is not synchronized to the backup device, user services are still interrupted. To prevent this problem, dual-device hot backup is introduced.</p>
<h4 class="sectiontitle">Networking Requirements</h4><p>As shown in <a href="#EN-US_TASK_0172374419__fig_dc_ne_cfg_rui_005701">Figure 1</a>, users access PE1 and PE2 through a CE. An Eth-Trunk interface is configured on each PE, and the two PEs are directly connected. A VRRP group is configured on PE1 and PE2 to track the status of Eth-Trunk member interfaces. Access links are bundled on the CE, and LACP is deployed to determine the primary and backup links between the PEs. Services can be immediately switched to the backup device if the master device fails after users go online. DeviceA functions as a DHCP relay agent and obtains an IP address from the DHCP server. A static route destined for the Internet is configured on DeviceA (layer 3 device), with the next hop being the IP address of the Layer 3 BAS interface. The primary/backup status of the static routes destined for PE1 and PE2 is controlled by priority.</p>
<div class="fignone" id="EN-US_TASK_0172374419__fig_dc_ne_cfg_rui_005701"><a name="EN-US_TASK_0172374419__fig_dc_ne_cfg_rui_005701"></a><a name="fig_dc_ne_cfg_rui_005701"></a><span class="figcap"><b>Figure 1 </b>Network diagram of configuring dual-device hot backup for Layer 3 static IPv4 users</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interfaces 1 through 7 represent GE<span>0/1/0</span>, GE<span>0/1/1</span>, GE<span>0/1/5</span>, GE<span>0/2/0</span>, GE<span>0/2/3</span>, GE<span>0/1/6</span>, and GE<span>0/1/7</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_ne_cfg_rui_005701.png" width="NaN" height="NaN"></span><div class="tableBorder"><table cellpadding="4" cellspacing="0" summary=""><tr><td valign="top"><p><strong>Device</strong></p>
</td>
<td valign="top"><p><strong>Interface</strong></p>
</td>
<td valign="top"><p><strong>IP Address</strong></p>
</td>
</tr>
<tr><td valign="top"><p>PE1</p>
</td>
<td valign="top"><p>GE <span>0/1/0</span></p>
</td>
<td valign="top"><p>Member interface of Eth-Trunk 10, which is the BAS main interface</p>
<p>(Note: It is recommended that Layer 2 and Layer 3 users not share the same main interface.)</p>
</td>
</tr>
<tr><td valign="top"><p>PE1</p>
</td>
<td valign="top"><p>GE<span>0/1/1</span></p>
</td>
<td valign="top"><p>10.1.1.1/24 (network-side interface)</p>
</td>
</tr>
<tr><td valign="top"><p>PE1</p>
</td>
<td valign="top"><p>GE<span>0/1/5</span></p>
</td>
<td valign="top"><p>10.193.2.2/24 (address of the interface running VRRP)</p>
</td>
</tr>
<tr><td valign="top"><p>PE1</p>
</td>
<td valign="top"><p>Loopback1</p>
</td>
<td valign="top"><p>172.16.18.1/32 (address of PE1's interface with an RBS deployed)</p>
</td>
</tr>
<tr><td valign="top"><p>PE2</p>
</td>
<td valign="top"><p>GE<span>0/1/0</span></p>
</td>
<td valign="top"><p>Member interface of Eth-Trunk 10, which is the BAS main interface</p>
<p>(Note: It is recommended that Layer 2 and Layer 3 users not share the same main interface.)</p>
</td>
</tr>
<tr><td valign="top"><p>PE2</p>
</td>
<td valign="top"><p>GE<span>0/1/1</span></p>
</td>
<td valign="top"><p>10.1.1.2/24 (network-side interface)</p>
</td>
</tr>
<tr><td valign="top"><p>PE2</p>
</td>
<td valign="top"><p>GE<span>0/1/5</span></p>
</td>
<td valign="top"><p>10.193.2.1/24 (address of the interface running VRRP)</p>
</td>
</tr>
<tr><td valign="top"><p>PE2</p>
</td>
<td valign="top"><p>Loopback2</p>
</td>
<td valign="top"><p>172.16.18.2/32 (address of PE2's interface with an RBS deployed)</p>
</td>
</tr>
<tr><td valign="top"><p>CE</p>
</td>
<td valign="top"><p>GE<span>0/2/0</span></p>
</td>
<td valign="top"><p>Associate PE1 with VRRP</p>
</td>
</tr>
<tr><td valign="top"><p>CE</p>
</td>
<td valign="top"><p>GE<span>0/2/3</span></p>
</td>
<td valign="top"><p>Associate PE2 with VRRP</p>
</td>
</tr>
<tr><td valign="top"><p>CE</p>
</td>
<td valign="top"><p>GE<span>0/1/6</span></p>
</td>
<td valign="top"><p>Layer 2 transparent transmission</p>
</td>
</tr>
<tr><td valign="top"><p>DeviceA</p>
</td>
<td valign="top"><p>GE<span>0/1/6</span></p>
</td>
<td valign="top"><p>10.10.3.1/24</p>
</td>
</tr>
<tr><td valign="top"><p>DeviceA</p>
</td>
<td valign="top"><p>GE<span>0/1/7</span></p>
</td>
<td valign="top"><p>10.10.8.1/24</p>
</td>
</tr>
</table></div>
</div>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172374419__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure basic user access functions and ensure that the two devices for backup have the same configuration. For details, see <em><span class="keyword">HUAWEI NE40E-M2 series</span><span class="keyword">Universal Service Router</span> Configuration Guide - User Access</em>.</p>
</li><li><p>Configure Eth-Trunk interfaces to work in static LACP mode. For details, see <em><span class="keyword">HUAWEI NE40E-M2 series</span><span class="keyword">Universal Service Router</span> Configuration Guide - LAN Access and MAN Access</em>.</p>
</li><li><p>Configure an mVRRP group.</p>
</li><li><p>Configure VRRP to track the interface status on the PEs.</p>
</li><li><p>Associate the Eth-Trunk interfaces working in static LACP mode on the PEs with the mVRRP group.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172374419__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>VRRP parameters (VRRP ID)</p>
</li><li><p>IP address of each interface on PE1 and PE2</p>
</li><li><p>Backup ID, which works together with an RBS to identify an RBP to which users belong</p>
</li><li>IP address (192.168.1.2) of the DHCP server connected to DeviceA</li><li>IP address (192.168.8.251) of the web server and IP address (192.168.8.55) of the RADIUS server to which PE1 and PE2 connect</li><li><p>User access parameters</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172374419__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>User access configuration</span><p><p>For details, see <em><span class="keyword">HUAWEI NE40E-M2 series</span><span class="keyword">Universal Service Router</span> Configuration Guide - User Access - AAA and User Management Configuration</em>. For configuration details, see the configuration files.</p>
</p></li><li><span>Configure Eth-Trunk interfaces to work in static LACP mode and add member interfaces GE <span>0/2/0</span> and GE <span>0/2/3</span> to the Eth-Trunk interfaces.</span><p><p># Configure CE1.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname CE1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>vlan batch 1 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>interface Eth-Trunk 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-Eth-Trunk20] <strong>mode lacp-static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-Eth-Trunk20] <strong>lacp timeout fast</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-Eth-Trunk20] <strong>trunkport gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-Eth-Trunk20] <strong>trunkport gigabitethernet <span>0/2/3</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-Eth-Trunk20]<strong> Port trunk allow-pass vlan 1 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-Eth-Trunk20] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1-Eth-Trunk20] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>interface gigabitethernet </strong><strong><span>0/1/6</span></strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1-Gigabitethernet<span>0/1/6</span>]<strong> Portswich</strong>
[<span class="keyword">*</span>CE1-Gigabitethernet<span>0/1/6</span>]<strong> Port trunk </strong><strong>allow-pass vlan 1 10</strong>
[<span class="keyword">*</span>CE1-Gigabitethernet<span>0/1/6</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1-Gigabitethernet<span>0/1/6</span>] <strong>quit</strong></pre>
<p># Configure PE1.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname PE1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface Eth-Trunk 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Eth-Trunk10] <strong>mac-address 00e0-fc12-3456</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Eth-Trunk10] <strong>mode lacp-static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Eth-Trunk10] <strong>lacp timeout fast</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Eth-Trunk10] <strong>trunkport gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Eth-Trunk10] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-Eth-Trunk10] <strong>quit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname PE2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>interface Eth-Trunk 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Eth-Trunk10] <strong>mac-address 00e0-fc12-3456</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Eth-Trunk10] <strong>mode lacp-static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Eth-Trunk10] <strong>lacp timeout fast</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Eth-Trunk10] <strong>trunkport gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Eth-Trunk10] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-Eth-Trunk10] <strong>quit</strong></pre>
</p></li><li><span>Configure an IP address for the interface on DeviceA.</span><p><p># Configure an address for the interface that connects DeviceA to users and configure the DHCP relay function.</p>
<pre class="screen">&lt;HUAWEI&gt; <strong>system-view</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>HUAWEI] <strong>sysname </strong><strong>Device</strong><strong>A</strong>
[*HUAWEI] <strong>commit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceA] <strong>interface gigabitethernet <span>0/1/7</span></strong>
[*DeviceA-GigabitEthernet<span>0/1/7</span>] <strong>ip address 10.10.</strong><strong>8</strong><strong>.1 255.255.255.0</strong>
[*DeviceA-GigabitEthernet<span>0/1/7</span>] <strong>ip relay address 192.168.1.2</strong>
[*DeviceA-GigabitEthernet<span>0/1/7</span>] <strong>dhcp select relay</strong>
[*DeviceA-GigabitEthernet<span>0/1/7</span>] <strong>commit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceA-GigabitEthernet<span>0/1/7</span>] <strong>quit</strong></pre>
<p># Configure an IP address for the interface that connects DeviceA to the CE. The IP address must be on the same network segment as the IP address of the BAS interface.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceA] <strong>interface gigabitethernet <span>0/1/6</span>.1</strong>
[*DeviceA-GigabitEthernet<span>0/1/6</span>.1] <strong>ip address 10.</strong><strong>10</strong><strong>.</strong><strong>10</strong><strong>.</strong><strong>3</strong><strong> 255.255.255.0</strong>
[*DeviceA-GigabitEthernet<span>0/1/6</span>.1] <strong>vlan-type dot1q 1</strong>
[*DeviceA-GigabitEthernet<span>0/1/6</span>.1] <strong>commit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceA-GigabitEthernet<span>0/1/6</span>.1] <strong>quit</strong></pre>
</p></li><li><span>On DeviceA, configure a static route with the next-hop address being the IP address of a Layer 3 BAS interface.</span><p><pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceA] <strong>ip route-static 10.1.1.1 </strong><strong>24</strong><strong> 10.</strong><strong>10</strong><strong>.</strong><strong>1</strong><strong>0.</strong><strong>1</strong><strong> </strong><strong>preference</strong><strong> 30</strong>
[*DeviceA] <strong>ip route-static 10.1.1.</strong><strong>2</strong><strong> </strong><strong>24</strong><strong> </strong><strong>10.10.10.2</strong><strong> </strong><strong>preference 40</strong>
[*DeviceA] <strong>commit</strong></pre>
</p></li><li><span>Configure an mVRRP group.</span><p><p># Configure an IP address for the specified GE interface, and set the priority of PE1 in the VRRP group to 120 (as the master device).</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface Gigabitethernet <span>0/1/5</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Gigabitethernet<span>0/1/5</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Gigabitethernet<span>0/1/5</span>] <strong>ip address 10.193.2.2 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Gigabitethernet<span>0/1/5</span>] <strong>vrrp vrid 120 virtual-ip 10.193.2.100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Gigabitethernet<span>0/1/5</span>] <strong>vrrp vrid 120 priority 120</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Gigabitethernet<span>0/1/5</span>] <strong>admin-vrrp vrid 120 ignore-if-down</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Gigabitethernet<span>0/1/5</span>] <strong>commit</strong></pre>
<p># Configure an IP address for the specified GE interface, and set the priority of PE2 in the VRRP group to the default value (as the backup device).</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>interface Gigabitethernet <span>0/1/5</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Gigabitethernet<span>0/1/5</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Gigabitethernet<span>0/1/5</span>] <strong>ip address 10.193.2.1 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Gigabitethernet<span>0/1/5</span>] <strong>vrrp vrid 120 virtual-ip 10.193.2.100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Gigabitethernet<span>0/1/5</span>] <strong>admin-vrrp vrid 120 ignore-if-down</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Gigabitethernet<span>0/1/5</span>] <strong>commit</strong></pre>
</p></li><li><span>Configure the VRRP group to track the interface status.</span><p><p># Configure VRRP on PE1 to track the interface status.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-Gigabitethernet<span>0/1/5</span>] <strong>vrrp vrid 120 track interface Gigabitethernet <span>0/1/0</span> reduced 40</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Gigabitethernet<span>0/1/5</span>] <strong>vrrp vrid 120 track interface Gigabitethernet <span>0/1/1</span> reduced 40</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Gigabitethernet<span>0/1/5</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-Gigabitethernet<span>0/1/5</span>] <strong>quit</strong></pre>
<p># Configure VRRP on PE2 to track the interface status.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-Gigabitethernet<span>0/1/5</span>] <strong>vrrp vrid 120 track interface Gigabitethernet <span>0/1/1</span> reduced 40</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Gigabitethernet<span>0/1/5</span>] <strong>vrrp vrid 120 track interface Gigabitethernet <span>0/1/0</span> reduced 40</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Gigabitethernet<span>0/1/5</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-Gigabitethernet<span>0/1/5</span>] <strong>quit</strong></pre>
</p></li><li><span>Associate the Eth-Trunk interfaces working in static LACP mode with the mVRRP group.</span><p><p># Associate PE1's Eth-Trunk interface working in static LACP mode with the mVRRP group.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface Eth-Trunk 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Eth-Trunk 10] <strong>lacp track vrrp vrid 120 interface Gigabitethernet <span>0/1/5</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Eth-Trunk 10] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-Eth-Trunk 10] <strong>quit</strong></pre>
<p># Associate PE2's Eth-Trunk interface working in static LACP mode with the mVRRP group.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>interface Eth-Trunk 12</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Eth-Trunk 12] <strong>lacp track vrrp vrid 120 interface Gigabitethernet <span>0/1/5</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Eth-Trunk 12] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-Eth-Trunk 12] <strong>quit</strong></pre>
</p></li><li><span>Configure an RBS, address pool, and RBP. (PE1 is used as an example.)</span><p><p># Configure an RBS named s1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>remote-backup-service s1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-rm-backup-srv-s1] <strong>peer 172.16.18.1 source 172.16.18.2 port 12012</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-rm-backup-srv-s1] <strong>track interface GigabitEthernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-rm-backup-srv-s1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-rm-backup-srv-s1] <strong>quit</strong></pre>
<p># Configure an RBP named p1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>remote-backup-profile p1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-rm-backup-prf-p1] <strong>service-type bras</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-rm-backup-prf-p1] <strong>backup-id 1 remote-backup-service s1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-rm-backup-prf-p1] <strong>peer-backup hot</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-rm-backup-prf-p1] <strong>vrrp-id 120 interface gigabitethernet <span>0/1/5</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-rm-backup-prf-p1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-rm-backup-prf-p1] <strong>quit</strong></pre>
</p></li><li><span>Configure user-side interfaces.</span><p><p># Configure PE1.</p>
<p># Configure Layer 3 static users to be triggered to go online through IP packets.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>layer3-subscriber 10.0.0.2 10.0.0.254 domain-name pre</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface <span>Eth-Trunk 10.1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-<span>Eth-Trunk 10.1</span>] <strong>vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-<span>Eth-Trunk 10.1</span>] <strong>ip address 10.10.10.1 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-<span>Eth-Trunk 10.1</span>] <strong>remote-backup-profile p1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-<span>Eth-Trunk 10.1</span>] <strong>bas</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-<span>Eth-Trunk 10.1</span>-bas] <strong>access-type layer3-subscriber default-domain pre-authentication pre authentication huawei</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-<span>Eth-Trunk 10.1</span>-bas] <strong>commit</strong></pre>
</p><p><p># Configure PE2.</p>
<p># Configure Layer 3 static users to be triggered to go online through IP packets.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>layer3-subscriber 10.0.0.2 10.0.0.254 domain-name pre</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface <span>Eth-Trunk 10.1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-<span>Eth-Trunk 10.1</span>] <strong>vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-<span>Eth-Trunk 10.1</span>] <strong>ip address 10.10.10.2 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-<span>Eth-Trunk 10.1</span>] <strong>remote-backup-profile p1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-<span>Eth-Trunk 10.1</span>] <strong>bas</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-<span>Eth-Trunk 10.1</span>-bas] <strong>access-type layer3-subscriber default-domain pre-authentication pre authentication huawei</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-<span>Eth-Trunk 12.1</span>-bas] <strong>commit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p>After completing the configurations, run the following command. The command output shows that the status of PE1 is <strong>Master</strong> and that of PE2 is <strong>Slave</strong>.</p>
<pre class="screen">&lt;PE1&gt; <strong>display remote-backup-profile p1</strong></pre>
<pre class="screen">-----------------------------------------------
 Profile-Index        : 0x1000
 Profile-Name         : p1
 Service              : bras 
 Remote-backup-service: s1
 Backup-ID            : 1
 track protocol       : VRRP
 VRRP-ID              : 120
 VRRP-Interface       : GigabitEthernet<span>0/1/5</span>
 Access-Control       : --
 State                : Slave
 Peer State           : Master
 Interface            :
                        Eth-Trunk10.1
 Backup mode          : hot
 Slot-Number          : --
 Card-Number          : --
 Port-Number          : --
 Traffic threshold    : 50(MB)
 Traffic interval     : 10(minutes)
 IP-Pool              :
                        ln
 Forwarding Configured: Slave Forwarding </pre>
<pre class="screen">&lt;PE1&gt; <strong>display remote-backup-service S1</strong></pre>
<pre class="screen">----------------------------------------------------------
 Service-Index    : 1
 Service-Name     : s1
 TCP-State        : Connected
 Peer-ip          : 172.16.18.2
 Source-ip        : 172.16.18.1
 TCP-Port         : 12012
 Track-BFD        : -
 SSL-Policy-Name  : --
 SSL-State        : --
 Last up time     : 2016-08-02 15:34:36
 Track-interface0 : GigabitEthernet<span>0/1/1</span>
                    Weight : 10
 Uplink state     : 2 (1:DOWN 2:UP)
 Domain-map-list  : --
 Send Q pkt count : 0
----------------------------------------------------------

 ip pool:  
 ipv6 pool:  
 Failure ratio    : 100%
 Failure duration : 0 min
 pool route status: 2
 switch mark      : 2</pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172374419__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li>CE configuration file<pre class="screen">#
sysname CE1
#
vlan batch 1 10
#
interface Eth-Trunk 20
 mode lacp-static
 lacp timeout fast
 trunkport gigabitethernet <span>0/2/0</span>
 trunkport gigabitethernet <span>0/2/3</span>
 Port trunk allow-pass vlan 1 10
#
interface gigabitethernet <span>0/1/6</span>
 portswich
 port trunk allow-pass vlan 1 10
#
return</pre>
</li><li>DeviceA configuration file<pre class="screen">#
sysname DeviceA
#
interface GigabitEthernet<span>0/1/6</span>
 undo shutdown
#
interface GigabitEthernet<span>0/1/6</span>.1
 vlan-type dot1q 1
 ip address 10.10.10.3 255.255.255.0
#
interface GigabitEthernet<span>0/1/7</span>
 undo shutdown
 ip address 10.10.8.1 255.255.255.0
 dhcp select relay
 ip relay address 192.168.1.2
#
ip route-static 10.1.1.1 24 10.10.10.1 preference 30
ip route-static 10.1.1.2 24 10.10.10.2 preference 40
#
return</pre>
</li><li><p>PE1 configuration file</p>
<pre class="screen">#
sysname PE1
#
radius-server group rd1
 radius-server shared-key-cipher %^%#vS%796FO7%C<font style="font-size:8pt" Face="Courier New" >~</font>pB%CR=q;j}gSCqR-X6+P!.DYI@)%^%#
 radius-server authentication 192.168.8.55 1645 weight 0
 radius-server accounting 192.168.8.55 1646 weight 0
 radius-server source interface LoopBack 0      
#
user-group web-before
#
acl number 6000
 rule 5 permit ip source user-group web-before destination ip-address 192.168.8.251 0 
 rule 10 permit ip source ip-address 192.168.8.251 0 destination user-group web-before
#
acl number 6001
 rule 5 permit tcp source user-group web-before destination-port eq www
 rule 10 permit tcp source user-group web-before destination-port eq 8080
#
acl number 6002
 rule 5 permit ip source ip-address any destination user-group web-before
 rule 10 permit ip source user-group web-before destination ip-address any
#
traffic classifier redirect operator or
 if-match acl 6001 precedence 18
#
traffic classifier web_deny operator or
 if-match acl 6002 precedence 20
#
traffic classifier web_permit operator or
 if-match acl 6000 precedence 1 
#
traffic behavior redirect
 http-redirect
#
traffic behavior web_deny
 deny
#
traffic behavior web_permit
#
traffic policy web
 share-mode
 classifier redirect behavior redirect precedence 2
 classifier web_permit behavior web_permit precedence 4
 classifier web_deny behavior web_deny precedence 5
#
aaa
 authentication-scheme none
  authentication-mode none
 #
 authentication-scheme auth2  
 #
 accounting-scheme none
  accounting-mode none
 #
 accounting-scheme acct2 
 #
 domain huawei 
  authentication-scheme auth2
  accounting-scheme acct2
  radius-server group rd1 
 # 
 domain pre
  authentication-scheme none
  accounting-scheme none
  user-group web-before
  web-server 192.168.8.251
  web-server url http://www.isp1.com
  web-server identical-url
#
remote-backup-service s1
 peer 172.16.18.1 source 172.16.18.2 port 12012
 track interface GigabitEthernet<span>0/1/1</span> 
#
remote-backup-profile p1
 service-type bras
 backup-id 1 remote-backup-service s1
 peer-backup hot
 vrrp-id 120 interface GigabitEthernet<span>0/1/5</span>
#
layer3-subscriber 10.0.0.2 10.0.0.254 domain-name pre
#
interface Loopback1
undo shutdown
ip address 172.16.18.1 255.255.255.0
#
interface Eth-Trunk10
 mac-address 00e0-fc12-3456
 mode lacp-static
 lacp timeout fast
 lacp track vrrp vrid 120 interface GigabitEthernet<span>0/1/5</span>
#
interface <span>Eth-Trunk 10.1</span>
 vlan-type dot1q 10
 ip address 10.10.10.1 255.255.255.0
 remote-backup-profile p1
 bas
 #
  access-type layer3-subscriber default-domain pre-authentication pre authentication huawei
 #
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 eth-trunk 10
 dcn
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 10.1.1.1 255.255.255.0
#
interface GigabitEthernet<span>0/1/5</span>
 undo shutdown
 ip address 10.193.2.2 255.255.255.0
 vrrp vrid 120 virtual-ip 10.193.2.100
 admin-vrrp vrid 120 ignore-if-down
 vrrp vrid 120 priority 120
 vrrp vrid 120 track interface GigabitEthernet<span>0/1/0</span> reduced 40
 vrrp vrid 120 track interface GigabitEthernet<span>0/1/1</span> reduced 40
 dcn
#
web-auth-server enable
web-auth-server source interface LoopBack 0
web-auth-server 192.168.8.251 port 50100 key cipher %^%#vS%796FO7%C<font style="font-size:8pt" Face="Courier New" >~</font>pB%CR=q;j}gSCqR-X6+P!.DYI@)%^%#
#
undo web-auth-server source-ip all
web-auth-server source-ip 192.168.8.251
#
traffic-policy web inbound
#
ospf 1 
 default cost inherit-metric
 import-route direct
 import-route unr
 area 0.0.0.0
  network 10.1.1.0 0.0.0.255
  network 10.1.3.0 0.0.0.255
#
return</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#
sysname PE2
#
radius-server group rd1
 radius-server shared-key-cipher %^%#0Iy%9Gu1),kLlP/jw;X-AOiZD%{YoCH&lt;RC(P*&gt;^5%^%#
 radius-server authentication 192.168.8.55 1645 weight 0
 radius-server accounting 192.168.8.55 1646 weight 0
 radius-server source interface LoopBack 0 
#
user-group web-before
#
acl number 6000
 rule 5 permit ip source user-group web-before destination ip-address 192.168.8.251 0 
 rule 10 permit ip source ip-address 192.168.8.251 0 destination user-group web-before
#
acl number 6001
 rule 5 permit tcp source user-group web-before destination-port eq www
 rule 10 permit tcp source user-group web-before destination-port eq 8080
#
acl number 6002
 rule 5 permit ip source ip-address any destination user-group web-before
 rule 10 permit ip source user-group web-before destination ip-address any
#
traffic classifier redirect operator or
 if-match acl 6001 precedence 18
#
traffic classifier web_deny operator or
 if-match acl 6002 precedence 20
#
traffic classifier web_permit operator or
 if-match acl 6000 precedence 1 
#
traffic behavior redirect
 http-redirect
#
traffic behavior web_deny
 deny
#
traffic behavior web_permit
#
traffic policy web
 share-mode
 classifier redirect behavior redirect precedence 2
 classifier web_permit behavior web_permit precedence 4
 classifier web_deny behavior web_deny precedence 5
#
aaa
 authentication-scheme none
  authentication-mode none
 #
 authentication-scheme auth2  
 #
 accounting-scheme none
  accounting-mode none
 #
 accounting-scheme acct2 
 #
 domain huawei 
  authentication-scheme auth2
  accounting-scheme acct2
  radius-server group rd1
 #  
 domain pre
  authentication-scheme none
  accounting-scheme none
  user-group web-before
  web-server 192.168.8.251
  web-server url http://www.isp1.com
  web-server identical-url  
#
remote-backup-service s2
 peer 172.16.18.2 source 172.16.18.1 port 12012
 track interface GigabitEthernet<span>0/1/1</span> 
#
remote-backup-profile p1
 service-type bras
 backup-id 1 remote-backup-service s2
 peer-backup hot
 vrrp-id 120 interface GigabitEthernet<span>0/1/5</span>
#
layer3-subscriber 10.0.0.2 10.0.0.254 domain-name pre
#
interface Loopback1
 undo shutdown
 ip address 172.16.18.2 255.255.255.0
#
interface Eth-Trunk10
 mac-address 00e0-fc12-3456
 mode lacp-static
 lacp timeout fast
 lacp track vrrp vrid 120 interface GigabitEthernet<span>0/1/5</span>
#
interface <span>Eth-Trunk 10.1</span>
 vlan-type dot1q 10
 ip address 10.10.10.2 255.255.255.0
 remote-backup-profile p1
 bas
 #
  access-type layer3-subscriber default-domain pre-authentication pre authentication huawei
 #
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 eth-trunk 10
 dcn
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 10.1.1.2 255.255.255.0
#
interface GigabitEthernet<span>0/1/5</span>
 undo shutdown
 ip address 10.193.2.1 255.255.255.0
 vrrp vrid 120 virtual-ip 10.193.2.100
 admin-vrrp vrid 120 ignore-if-down
 vrrp vrid 120 track interface GigabitEthernet<span>0/1/0</span> reduced 40
 vrrp vrid 120 track interface GigabitEthernet<span>0/1/1</span> reduced 40
 dcn
#
web-auth-server enable
web-auth-server source interface LoopBack 0
web-auth-server 192.168.8.251 port 50100 key cipher %^%#aQL6,Ua&lt;|@sxPQK/1f'4/GBJ6,6)q&gt;$Z^7*,!2yR%^%#
#
undo web-auth-server source-ip all
web-auth-server source-ip 192.168.8.251
#
traffic-policy web inbound
#
ospf 1
 default cost inherit-metric
 import-route direct
 import-route unr
 area 0.0.0.0
  network 10.1.1.0 0.0.0.255
  network 10.1.3.0 0.0.0.255
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cfg_rui_0050.html">Configuration Examples
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_rui_edsg_cfg_002.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cfg_rui_0062.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>