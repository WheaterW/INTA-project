
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring L2TP Access in Client-Initiated VPN Scenarios">
<meta name="abstract" content="This section provides an example for configuring L2TP in a Client-Initiated VPN scenario. A networking diagram is provided to help you understand the configuration procedure. The configuration example includes the networking requirements, configuration roadmap, configuration procedure, and configuration files.">
<meta name="description" content="This section provides an example for configuring L2TP in a Client-Initiated VPN scenario. A networking diagram is provided to help you understand the configuration procedure. The configuration example includes the networking requirements, configuration roadmap, configuration procedure, and configuration files.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_l2tp_cfg_013506.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_l2tp_cfg_013507.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_l2tp_cfg_013509.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="z50024784,z00603461,w00800033,z00588052,c00549182,l2tp_ne,w00556928,l00593348,w00606909,w00447999,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="L2TP">
<meta name="featuretype" content="User Access">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="L2TP">
<meta name="featuretype" content="User Access">
<meta name="featurename" content="L2TP">
<meta name="featuretype" content="User Access">
<meta name="featurename" content="L2TP">
<meta name="featuretype" content="User Access">
<meta name="OWNER" content="l00593348">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="z00588052">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172374276">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring L2TP Access in Client-Initiated VPN Scenarios</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172374276"></a><a name="EN-US_TASK_0172374276"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring L2TP Access in Client-Initiated VPN Scenarios</h1>
<div class="taskbody"><p>This section provides an example for configuring L2TP in a Client-Initiated VPN scenario. A networking diagram is provided to help you understand the configuration procedure. The configuration example includes the networking requirements, configuration roadmap, configuration procedure, and configuration files.</p>
<div class="context"><a name="EN-US_TASK_0172374276__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0172374276__fig_dc_ne_l2tp_cfg_01350801">Figure 1</a>, an employee on a business trip connects to the NAS through the PSTN, and the LNS at the headquarters connects to the NAS over the Internet. The networking requirements are as follows:</p>
<ul><li><p>The employee needs to initiate a connection request to the LNS, and the communication data with the LNS can be transmitted through the tunnel.</p>
</li><li><p>The LNS verifies the username and password after receiving this connection request, and assigns a private IP address to the LAC user.</p>
</li><li><p>The employee communicates with the company headquarters through the tunnel.</p>
</li><li><p>The user accesses the network from the domain <strong>domain1</strong> and obtains its IP address from the address pool <strong>pool1</strong>.</p>
</li></ul>
<div class="fignone" id="EN-US_TASK_0172374276__fig_dc_ne_l2tp_cfg_01350801"><a name="EN-US_TASK_0172374276__fig_dc_ne_l2tp_cfg_01350801"></a><a name="fig_dc_ne_l2tp_cfg_01350801"></a><span class="figcap"><b>Figure 1 </b>Configuring L2TP access in Client-Initiated VPN scenarios</span><br><span><img class="vsd" src="images/fig_dc_ne_l2tp_cfg_01350801.png"></span><br></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172374276__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Install the L2TP client software on the user side and configure the related parameters.</p>
</li><li><p>Configure the LNS.</p>
<ul><li>Create a VT.</li><li>Configure an L2TP group and its attributes.</li><li>Configure an address pool and a domain.</li><li>Configure an LNS group and its attributes.</li></ul>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172374276__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>Username and password on the client and LNS</p>
</li><li><p>Loopback address</p>
</li><li><p>Name, subnet, and gateway of an address pool</p>
</li><li><p>Name of the domain to which the user belongs</p>
</li></ul>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>This section provides only the L2TP-related configuration procedure.</p>
</div></div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172374276__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Perform configuration on the user side.</span><p><div class="p"># Install the L2TP client software on the user-side host and connect to the Internet through dial-up. Then, perform the following operations (the configuration process is related to the client software):<ul><li><p>Set the username and password of the VPN on the user side to <strong>vpdnuser</strong> and <strong>YsHsjx_202206</strong>, respectively.</p>
</li><li><p>Set the IP address of the LNS to the IP address of the interface connecting the device to the Internet (In this example, the IP address of the interface connecting the LNS to the channel is 10.11.11.1).</p>
</li><li><p>Modify connection attributes and set the protocol to L2TP.</p>
</li></ul>
</div>
</p></li><li><span>Configure Device that functions as the LNS.</span><p><p># Create a VT and configure it.</p>
<pre class="screen">&lt;<span class="keyword">Device</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>]<strong> interface virtual-template 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>-Virtual-Template1]<strong> ppp authentication-mode auto</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>-Virtual-Template1]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>-Virtual-Template1]<strong> quit</strong></pre>
<p># Configure a domain named <strong>domain1</strong>.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>]<strong> aaa</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>-aaa]<strong> domain domain1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>-aaa-domain-domain1]<strong> authentication-scheme default1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>-aaa-domain-domain1]<strong> accounting-scheme default1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>-aaa-domain-domain1]<strong> radius-server group radius1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>-aaa-domain-domain1]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>-aaa-domain-domain1]<strong> ip-pool pool1</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>-aaa-domain-domain1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>-aaa]<strong> quit</strong></pre>
<p># Enable L2TP and create an L2TP group.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>]<strong> l2tp enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>]<strong> l2tp-group lns1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>-l2tp-lns1]<strong> default-domain authentication domain1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>-l2tp-lns1]<strong> commit</strong></pre>
<p># Configure the local tunnel name and remote tunnel name on the LNS side.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>-l2tp-lns1]<strong> tunnel name LNS</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>-l2tp-lns1]<strong> allow l2tp virtual-template 1 remote vpdnuser</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Except for the default L2TP group <strong>default-lns</strong>, <i><span class="varname">remote lac-name</span></i> must be specified for other L2TP groups when L2TP connections are configured on the LNS. If the tunnel name sent by the LAC does not match the remote tunnel names configured for other L2TP groups, <strong>default-lns</strong> is used as the L2TP group.</p>
<p><i><span class="varname">remote lac-name</span></i> is the same as <a href="cmdqueryname=tunnel+name"><b><span class="cmdname">tunnel name</span></b></a> configured on the LAC. If this parameter is not configured, the hostname of the device is used.</p>
</div></div>
<p># Enable tunnel authentication and configure a password for tunnel authentication.</p>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>-l2tp-lns1]<strong> tunnel authentication</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>-l2tp-lns1]<strong> tunnel password cipher YsHsjx_202206</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>-l2tp-lns1]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>-l2tp-lns1]<strong> quit</strong></pre>
<div class="p"># Configure an address pool to assign addresses to dialup users.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>]<strong> ip pool pool1 bas local</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>-ip-pool-pool1]<strong> gateway 192.168.0.2 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>-ip-pool-pool1]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>-ip-pool-pool1]<strong> section 0 192.168.0.10 192.168.0.100</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>-ip-pool-pool1]<strong> quit</strong></pre>
</div>
<p># Configure a RADIUS server group.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>] <strong>radius-server group radius1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>-radius-radius1] <strong>radius-server authentication 10.20.20.1 1812</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>-radius-radius1] <strong>radius-server accounting 10.20.20.1 1813</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>-radius-radius1] <strong>radius-server shared-key itellin</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>-radius-radius1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>-radius-radius1] <strong>quit</strong></pre>
<p># Configure loopback0.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>]<strong> interface loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>-LoopBack0]<strong> ip address 192.168.10.1 255.255.255.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>-LoopBack0]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>-LoopBack0]<strong> quit</strong></pre>
<p># Create an LNS group named <strong>group1</strong>, and bind a tunnel board and loopback interface to the LNS group.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>]<strong> lns-group group1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>-lns-group-group1]<strong> bind slot <span>1</span> </strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>-lns-group-group1]<strong> bind source loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>-lns-group-group1]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>-lns-group-group1]<strong> quit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p># After completing the configuration, run the <strong>display l2tp tunnel</strong> command on the LNS after the VPN user goes online. The command output shows that the tunnel is established successfully.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>] <strong>display l2tp tunnel lns slot <span>1</span></strong></pre>
<pre class="screen">LocalTID RemoteTID RemoteAddress    Port   Sessions RemoteName </pre>
<pre class="screen"> ------------------------------------------------------------------------------       </pre>
<pre class="screen">1        1         10.1.1.1        2134   1        vpdnuser</pre>
<pre class="screen"> ------------------------------------------------------------------------------       </pre>
<pre class="screen">Total 1, 1 printed from slot <span>1</span> </pre>
<p># Run the <strong>display l2tp session</strong> command on the LNS to check the session setup status.</p>
<pre class="screen">&lt;<span class="keyword">Device</span>&gt; <strong>display l2tp session lns slot <span>1</span> </strong></pre>
<pre class="screen">LocalSID  RemoteSID  LocalTID   RemoteTID  UserID  UserName                                                                       
 ------------------------------------------------------------------------------                                                     
  278       24768      13921      7958       62172    vpdnuser@domain1                                                                   
 ------------------------------------------------------------------------------       </pre>
<pre class="screen">Total 1, 1 printed from slot <span>1</span> </pre>
<p># Check that the VPN user can access the headquarters.</p>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172374276__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><p><span class="keyword">Device</span> configuration file</p>
<pre class="screen">#</pre>
<pre class="screen"> sysname <span class="keyword">Device</span></pre>
<pre class="screen">#</pre>
<pre class="screen"> l2tp enable</pre>
<pre class="screen">#</pre>
<pre class="screen">radius-server group radius1</pre>
<pre class="screen">#</pre>
<pre class="screen"> radius-server shared-key %^%#vS%796FO7%C<font style="font-size:8pt" Face="Courier New" >~</font>pB%CR=q;j}gSCqR-X6+P!.DYI@)%^%</pre>
<pre class="screen">#</pre>
<pre class="screen"> radius-server authentication 10.20.20.1 1812 </pre>
<pre class="screen"> radius-server accounting 10.20.20.1 1813 </pre>
<pre class="screen">#</pre>
<pre class="screen">ip pool pool1 bas local</pre>
<pre class="screen"> gateway 192.168.0.2 255.255.255.0</pre>
<pre class="screen"> section 0 192.168.0.10 192.168.0.100</pre>
<pre class="screen">#</pre>
<pre class="screen">interface Virtual-Template1</pre>
<pre class="screen"> ppp authentication-mode auto </pre>
<pre class="screen">#</pre>
<pre class="screen">aaa</pre>
<pre class="screen">domain domain1 </pre>
<pre class="screen">  authentication-scheme default1</pre>
<pre class="screen">  accounting-scheme default1</pre>
<pre class="screen">  radius-server group radius1</pre>
<pre class="screen">  ip-pool pool1</pre>
<pre class="screen">#</pre>
<pre class="screen">interface LoopBack0</pre>
<pre class="screen"> ip address 192.168.10.1 255.255.255.255</pre>
<pre class="screen">#</pre>
<pre class="screen">l2tp-group lns1</pre>
<pre class="screen"> allow l2tp virtual-template 1 remote vpdnuser</pre>
<pre class="screen"> default-domain authentication domain1</pre>
<pre class="screen"> tunnel password cipher %@%##!!!!!!!!!"!!!!"!!!!(!!!!1];16qfZ81fv"uMoKKZ.1k"`AO!X2K2N.b<font style="font-size:8pt" Face="Courier New" >~</font>'NB^V!!!!!!!!!!1!!!!o/4J(q"J1F.!K9%M!6x8%@%#</pre>
<pre class="screen"> tunnel name LNS</pre>
<pre class="screen">#</pre>
<pre class="screen">lns-group group1</pre>
<pre class="screen"> bind slot <span>1</span></pre>
<pre class="screen"> bind source LoopBack0</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_l2tp_cfg_013506.html">Configuration Examples for L2TP Access
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_l2tp_cfg_013507.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_l2tp_cfg_013509.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>