
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Two-Way Frame Delay Measurement in a VLAN">
<meta name="abstract" content="This example describes how to configure two-way frame delay measurement in a virtual local area network (VLAN) on an E2E network.">
<meta name="description" content="This example describes how to configure two-way frame delay measurement in a virtual local area network (VLAN) on an E2E network.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_011531.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_011542.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_y1731_cfg_0075.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="z50024784,c00376497,z00603461,w00800033,jwx1168690,w00556928,w00437000,eoam-vrp,w00606909,m00390128,l00455378,wwx1270540">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="Ethernet OAM">
<meta name="featuretype" content="Network Reliability">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="Ethernet OAM">
<meta name="featuretype" content="Network Reliability">
<meta name="featurename" content="Ethernet OAM">
<meta name="featuretype" content="Network Reliability">
<meta name="featurename" content="Ethernet OAM">
<meta name="featuretype" content="Network Reliability">
<meta name="featurename" content="Ethernet OAM">
<meta name="featuretype" content="Network Reliability">
<meta name="OWNER" content="z00545680">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="p00915595">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172362175">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring Two-Way Frame Delay Measurement in a VLAN</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172362175"></a><a name="EN-US_TASK_0172362175"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Two-Way Frame Delay Measurement in a VLAN</h1>
<div class="taskbody"><p>This example describes how to configure two-way frame delay measurement in a virtual local area network (VLAN) on an E2E network.</p>
<div class="context"><a name="EN-US_TASK_0172362175__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>As networks continue to develop and diversify, various value-added services such as IPTV, video conferencing, and Voice over Internet Protocol (VoIP) are becoming increasingly popular. The performance monitoring function can be used to check the performance of links that transmit services.</p>
<p>On the network shown in <a href="#EN-US_TASK_0172362175__fig_dc_vrp_cfg_01154301">Figure 1</a>, CFM is configured to monitor the connectivity of links between CEs. To provide high-quality video services, a carrier expects to monitor the bidirectional delay on mobile transport links in real time while monitoring link connectivity so that they can promptly respond to video service quality deterioration.</p>
<div class="fignone" id="EN-US_TASK_0172362175__fig_dc_vrp_cfg_01154301"><a name="EN-US_TASK_0172362175__fig_dc_vrp_cfg_01154301"></a><a name="fig_dc_vrp_cfg_01154301"></a><span class="figcap"><b>Figure 1 </b>Networking diagram for configuring Y.1731 function on a VLAN networking</span><div class="note" id="EN-US_TASK_0172362175__en-us_task_0172362170_note327807523214024"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0172362175__en-us_task_0172362170_p1165484506214024">Interfaces 1 and 2 in this example are GE <span>0/1/1</span>, GE <span>0/1/2</span> respectively.</p>
</div></div>
<br><span><img class="vsd" id="EN-US_TASK_0172362175__en-us_task_0172362170_image619978427214024" src="images/fig_dc_vrp_cfg_01154001.png"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172362175__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><div class="p">The configuration roadmap is as follows:<ol><li><p>Configure on-demand two-way frame delay measurement between CEs.</p>
</li><li><p>Configure proactive two-way frame delay measurement between CEs.</p>
</li></ol>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172362175__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>ID of a VLAN to which CE interfaces belong</p>
</li><li><p>Names of the MD and MA on CE1 and CE2</p>
</li><li><p>Interval between DMMs and number of detection times in on-demand OAM mode</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172362175__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure on-demand two-way frame delay measurement for links between CEs.</span><p><ol type="a"><li><p>Configure basic Ethernet CFM functions, including outward-facing MEPs.</p>
<p>On each CE, configure IEEE Std 802.1ag-2007 CFM, create an MD named <strong>md3</strong> and an MA named <strong>ma3</strong>, and bind the MA to a VLAN.</p>
<p># Configure CE1.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname CE1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>vlan 2</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>interface gigabitethernet<span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1-GigabitEthernet<span>0/1/1</span>] <strong>portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/1</span>] <strong>port link-type trunk</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/1</span>] <strong>port trunk allow-pass vlan 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>cfm enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>cfm md md3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-md-md3] <strong>ma ma3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-md-md3-ma-ma3] <strong>map vlan 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-md-md3-ma-ma3] <strong>mep mep-id 3 interface gigabitethernet<span>0/1/1</span> outward</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-md-md3-ma-ma3] <strong>mep ccm-send mep-id 3 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-md-md3-ma-ma3] <strong>remote-mep mep-id 4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-md-md3-ma-ma3] <strong>remote-mep ccm-receive mep-id 4 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-md-md3-ma-ma3] <strong>test-id 1 mep 3 remote-mep 4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>commit</strong></pre>
<p># Configure CE2.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname CE2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>vlan 2</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>interface gigabitethernet<span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2-GigabitEthernet<span>0/1/1</span>]<strong>portswitch</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2-GigabitEthernet<span>0/1/1</span>]<strong>port link-type trunk</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>]<strong>port trunk allow-pass vlan 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>]<strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>cfm enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>cfm md md3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-md-md3] <strong>ma ma3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-md-md3-ma-ma3] <strong>map vlan 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-md-md3-ma-ma3] <strong>mep mep-id 4 interface gigabitethernet<span>0/1/1</span> outward</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-md-md3-ma-ma3] <strong>mep ccm-send mep-id 4 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-md-md3-ma-ma3] <strong>remote-mep mep-id 3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-md-md3-ma-ma3] <strong>remote-mep ccm-receive mep-id 3 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-md-md3-ma-ma3] <strong>test-id 1 mep 4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>commit</strong></pre>
</li><li><p>Enable CE2 to receive DMMs.</p>
<p># Configure CE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>cfm md md3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-md-md3] <strong>ma ma3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-md-md3-ma-ma3] <strong>delay-measure two-way receive test-id 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-md-md3-ma-ma3] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-md-md3] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>commit</strong></pre>
</li><li><p>Enable on-demand two-way frame delay measurement.</p>
<p># Configure CE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>cfm md md3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-md-md3] <strong>ma ma3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-md-md3-ma-ma3] <strong>delay-measure two-way send test-id 1 interval 1000 count 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-md-md3-ma-ma3] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-md-md3] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>commit</strong></pre>
</li><li><p>Verify the configuration.</p>
<p># After completing the configuration, run the <strong>display y1731 statistic-type twoway-delay</strong> command to view actual on-demand two-way frame delay measurements on CE1.</p>
<pre class="screen">&lt;CE1&gt;<strong> display y1731 statistic-type twoway-delay</strong>
Latest two-way delay statistics of test-id 1:
--------------------------------------------------------------------------------
Index    Delay(usec)    Delay variation(usec)
--------------------------------------------------------------------------------
    1            422                        -
    2            320                      102
    3            467                      147
    4            309                      158
    5            328                       19
    6            316                       12
    7            336                       20
    8            282                       54
    9            421                      139
   10            287                      134
   11            322                       35
   12            446                      124
   13            275                      171
   14            291                       16
   15            341                       50
--------------------------------------------------------------------------------
Average delay(usec) :        344    Average delay variation(usec) :         84
Maximum delay(usec) :        467    Maximum delay variation(usec) :        171
Minimum delay(usec) :        275    Minimum delay variation(usec) :         12
</pre>
</li></ol>
</p></li><li><span>Configure proactive two-way frame delay measurement for links between CEs.</span><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Proactive two-way frame delay measurement within a specified VLAN allows you to collect link measurement statistics continuously over a long term.</p>
</div></div>
<ol type="a"><li><p>Disable CE2 from receiving DMMs.</p>
<p># Configure CE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>cfm md md3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-md-md3] <strong>ma ma3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-md-md3-ma-ma3] <strong>test-id 2 mep 4 remote-mep 3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-md-md3-ma-ma3] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-md-md3] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>commit</strong></pre>
</li><li><p>Enable CE1 to receive DM messages.</p>
<p># Configure CE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>cfm md md3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-md-md3] <strong>ma ma3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-md-md3] <strong>test-id 2 mep 3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-md-md3-ma-ma3] <strong>delay-measure two-way receive test-id 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-md-md3-ma-ma3] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-md-md3] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>commit</strong></pre>
</li><li><p>Enable proactive two-way frame delay measurement.</p>
<p># Configure CE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>cfm md md3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-md-md3] <strong>ma ma3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-md-md3-ma-ma3] <strong>delay-measure two-way continual send test-id 2 interval 1000</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-md-md3-ma-ma3] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-md-md3] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>commit</strong></pre>
</li><li><p>Verify the configuration.</p>
<p># After completing the configuration, run the <strong>display y1731 statistic-type twoway-delay</strong> command to view statistics about two-way frame delay measurements on CE1.</p>
<pre class="screen">&lt;CE1&gt; <strong>display y1731 statistic-type twoway-delay</strong>
Latest two-way delay statistics of test-id 2:
--------------------------------------------------------------------------------
Index    Delay(usec)    Delay variation(usec)
--------------------------------------------------------------------------------
    1            181                        -
    2            356                      175
    3            166                      190
    4            180                       14
    5            162                       18
    6            160                        2
    7            177                       17
    8            149                       28
    9            190                       41
   10            185                        5
   11            230                       45
   12            221                        9
   13            184                       37
   14            415                      231
   15            187                      228
   16            235                       48
   17            184                       51
   18            184                        0
   19            168                       16
   20            185                       17
--------------------------------------------------------------------------------
Average delay(usec) :         204    Average delay variation(usec) :         61
Maximum delay(usec) :         415    Maximum delay variation(usec) :        231
Minimum delay(usec) :         149    Minimum delay variation(usec) :          0

</pre>
</li></ol>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172362175__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>CE1 configuration file</p>
<pre class="screen">#
 sysname CE1
#
 vlan batch 2
#
 cfm version standard
 cfm enable
#
interface GigabitEthernet<span>0/1/1</span>
 portswitch
 undo shutdown
 port link-type trunk
 port trunk allow-pass vlan 2
#
 cfm md md3
  ma ma3
   map vlan 2
   mep mep-id 3 interface GigabitEthernet<span>0/1/1</span> outward
   mep ccm-send mep-id 3 enable
   remote-mep mep-id 4
   remote-mep ccm-receive mep-id 4 enable
   test-id 1 mep 3 remote-mep 4
   test-id 2 mep 3
   delay-measure two-way receive test-id 2
#
return</pre>
</li><li><p>CE2 configuration file</p>
<pre class="screen">#
 sysname CE2
#
 vlan 2
#
 cfm version standard
 cfm enable
#
interface GigabitEthernet<span>0/1/1</span>
 portswitch
 undo shutdown
 port link-type trunk
 port trunk allow-pass vlan 2
#
 cfm md md3
  ma ma3
   map vlan 2
   mep mep-id 4 interface GigabitEthernet<span>0/1/1</span> outward
   mep ccm-send mep-id 4 enable
   remote-mep mep-id 3
   remote-mep ccm-receive mep-id 3 enable
   test-id 1 mep 4
   delay-measure two-way receive test-id 1
   test-id 2 mep 4 remote-mep 3
   delay-measure two-way continual send test-id 2 interval 1000
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_011531.html">Configuration Examples for Y.1731
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_011542.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_y1731_cfg_0075.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>