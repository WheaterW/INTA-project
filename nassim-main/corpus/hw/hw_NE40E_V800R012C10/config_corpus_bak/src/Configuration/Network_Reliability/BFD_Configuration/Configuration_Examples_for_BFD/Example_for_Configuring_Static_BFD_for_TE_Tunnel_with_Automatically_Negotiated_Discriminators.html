
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Static BFD for TE Tunnel with Automatically Negotiated Discriminators">
<meta name="abstract" content="Static BFD for TE is configured to rapidly detect tunnel faults and perform a traffic switchover.">
<meta name="description" content="Static BFD for TE is configured to rapidly detect tunnel faults and perform a traffic switchover.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bfd_cfg_0058.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bfd_cfg_2005.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00606909,m00390128">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="BFD">
<meta name="featuretype" content="Network Reliability">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BFD">
<meta name="featuretype" content="Network Reliability">
<meta name="featurename" content="BFD">
<meta name="featuretype" content="Network Reliability">
<meta name="featurename" content="BFD">
<meta name="featuretype" content="Network Reliability">
<meta name="OWNER" content="p00915595,l00425560">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="s00826690">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172361727">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring Static BFD for TE Tunnel with Automatically Negotiated Discriminators</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172361727"></a><a name="EN-US_TASK_0172361727"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Static BFD for TE Tunnel with Automatically Negotiated Discriminators</h1>
<div class="taskbody"><p>Static BFD for TE is configured to rapidly detect tunnel faults and perform a traffic switchover.</p>
<div class="context"><a name="EN-US_TASK_0172361727__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the MPLS network shown in <a href="#EN-US_TASK_0172361727__fig_dc_vrp_te-p2p_cfg_013101">Figure 1</a>, MPLS TE tunnels are established between PE1 and PE2. The tunnels are detected using static BFD sessions with automatically negotiated discriminators.</p>
<div class="fignone" id="EN-US_TASK_0172361727__fig_dc_vrp_te-p2p_cfg_013101"><a name="EN-US_TASK_0172361727__fig_dc_vrp_te-p2p_cfg_013101"></a><a name="fig_dc_vrp_te-p2p_cfg_013101"></a><span class="figcap"><b>Figure 1 </b>Static BFD for TE Tunnel with automatically negotiated discriminators</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface1 represents GE <span>0/1/1</span>.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_bfd_cfg_006306.png" width="NaN" height="NaN"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172361727__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Precautions</h4><p>None</p>
</div></div>
<div class="context"><a name="EN-US_TASK_0172361727__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure an MPLS network and establish bidirectional TE tunnels between PE1 and PE2.</p>
</li><li><p>Enable BFD globally on PE1 and PE2.</p>
</li><li><p>Configure static BFD with automatically negotiated discriminators on PE1 and PE2 to monitor TE tunnels.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172361727__1.4.4"></a><a name="1.4.4"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>MPLS LSR IDs</p>
</li><li><p>Interface number of and bandwidth consumed by each tunnel, and name of an explicit path over which each tunnel is established</p>
</li><li><p>Name of the BFD session</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172361727__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Assign an IP address to each interface.</span><p><p>Assign an IP address to each interface according to the networking diagram, create loopback interfaces on routers, and configure the IP addresses of the loopback interfaces as MPLS LSR IDs. For configuration details, see <a href="#EN-US_TASK_0172361727__section_dc_vrp_te-p2p_cfg_013105">Configuration Files</a> in this section.</p>
</p></li><li><span>Configure an IGP.</span><p><p>Configure OSPF or IS-IS on each router to ensure interworking between PE1 and PE2. OSPF is used in this example. For configuration details, see <a href="#EN-US_TASK_0172361727__section_dc_vrp_te-p2p_cfg_013105">Configuration Files</a> in this section.</p>
</p></li><li><span>Configure basic MPLS functions.</span><p><p>On each router, configure an LSR ID and enable MPLS in the system and interface views. For configuration details, see <a href="#EN-US_TASK_0172361727__section_dc_vrp_te-p2p_cfg_013105">Configuration Files</a> in this section.</p>
</p></li><li><span>Configure basic MPLS TE functions.</span><p><p>On each router, enable MPLS-TE in the MPLS and interface views. For configuration details, see <a href="#EN-US_TASK_0172361727__section_dc_vrp_te-p2p_cfg_013105">Configuration Files</a> in this section.</p>
</p></li><li><span>Enable OSPF TE and configure CSPF.</span><p><p>Enable OSPF TE on each router and configure CSPF on PE1. For configuration details, see <a href="#EN-US_TASK_0172361727__section_dc_vrp_te-p2p_cfg_013105">Configuration Files</a> in this section.</p>
</p></li><li><span>Configure a tunnel interface on each PE.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> interface tunnel 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel1]<strong> ip address unnumbered interface loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel1]<strong> tunnel-protocol mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel1]<strong> destination 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel1]<strong> mpls te tunnel-id 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel1]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-Tunnel1]<strong> quit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2]<strong> interface tunnel 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Tunnel2]<strong> ip address unnumbered interface loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Tunnel2]<strong> tunnel-protocol mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Tunnel2]<strong> destination 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Tunnel2]<strong> mpls te tunnel-id 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Tunnel2]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-Tunnel2]<strong> quit</strong></pre>
</p></li><li><span>Configure static BFD with automatically negotiated discriminators to detect TE tunnel faults.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> bfd aaa bind mpls-te interface Tunnel 1 reverse-te lsr-id 2.2.2.2 tunnel-id 2 auto </strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> bfd bbb bind mpls-te interface Tunnel 2 reverse-te lsr-id 1.1.1.1 tunnel-id 1 auto </strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p>After completing the preceding configuration, run the <a href="cmdqueryname=display+bfd+session+all"><b><span class="cmdname">display bfd session all</span></b></a> command on PE2 to view information about the configured BFD session.</p>
</p><p><pre class="screen">[<span class="keyword">*</span>PE2]display bfd session all 
(w): State in WTR
(*): State is invalid
--------------------------------------------------------------------------------
Local      Remote     PeerIpAddr      State     Type        InterfaceName 
--------------------------------------------------------------------------------
16385      16385       1.1.1.1         UP      AUTO_TE_TNL  Tunnel1
--------------------------------------------------------------------------------</pre>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0172361727__section_dc_vrp_te-p2p_cfg_013105"><a name="EN-US_TASK_0172361727__section_dc_vrp_te-p2p_cfg_013105"></a><a name="section_dc_vrp_te-p2p_cfg_013105"></a><a name="EN-US_TASK_0172361727__1.4.6"></a><a name="1.4.6"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>PE1 configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname PE1</pre>
<pre class="screen">#</pre>
<pre class="screen">bfd</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls lsr-id 1.1.1.1</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls</pre>
<pre class="screen"> mpls te</pre>
<pre class="screen"> mpls rsvp-te</pre>
<pre class="screen"> mpls te cspf</pre>
<pre class="screen">#</pre>
<pre class="screen">interface gigabitethernet<span>0/1/1</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.1.1.1 255.255.255.0</pre>
<pre class="screen"> mpls</pre>
<pre class="screen"> mpls te</pre>
<pre class="screen"> mpls rsvp-te</pre>
<pre class="screen">#</pre>
<pre class="screen">interface LoopBack0</pre>
<pre class="screen"> ip address 1.1.1.1 255.255.255.255</pre>
<pre class="screen">#</pre>
<pre class="screen">interface Tunnel 1</pre>
<pre class="screen"> ip address unnumbered interface LoopBack0</pre>
<pre class="screen"> tunnel-protocol mpls te</pre>
<pre class="screen"> destination 2.2.2.2</pre>
<pre class="screen"> mpls te tunnel-id 1</pre>
<pre class="screen">#</pre>
<pre class="screen">ospf 1
 opaque-capability enable
 area 0.0.0.0
  network 1.1.1.1 0.0.0.0
  network 10.1.1.0 0.0.0.255
  mpls-te enable
#
bfd aaa bind mpls-te interface Tunnel 1 reverse-te lsr-id 2.2.2.2 tunnel-id 2 auto
#
return</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname PE2</pre>
<pre class="screen">#</pre>
<pre class="screen">bfd</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls lsr-id 2.2.2.2</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls</pre>
<pre class="screen"> mpls te</pre>
<pre class="screen"> mpls rsvp-te</pre>
<pre class="screen"> mpls te cspf</pre>
<pre class="screen">#</pre>
<pre class="screen">interface gigabitethernet<span>0/1/1</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.1.1.2 255.255.255.0</pre>
<pre class="screen"> mpls</pre>
<pre class="screen"> mpls te</pre>
<pre class="screen"> mpls rsvp-te</pre>
<pre class="screen">#</pre>
<pre class="screen">interface LoopBack0</pre>
<pre class="screen"> ip address 2.2.2.2 255.255.255.255</pre>
<pre class="screen">#</pre>
<pre class="screen">interface Tunnel 2</pre>
<pre class="screen"> ip address unnumbered interface LoopBack0</pre>
<pre class="screen"> tunnel-protocol mpls te</pre>
<pre class="screen"> destination 1.1.1.1</pre>
<pre class="screen"> mpls te tunnel-id 2</pre>
<pre class="screen">#</pre>
<pre class="screen">ospf 1
 opaque-capability enable
 area 0.0.0.0
  network 2.2.2.2 0.0.0.0
  network 10.1.1.0 0.0.0.255
  mpls-te enable
#
bfd bbb bind mpls-te interface Tunnel 2 reverse-te lsr-id 1.1.1.1 tunnel-id 1 auto</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bfd_cfg_0058.html">Configuration Examples for BFD
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bfd_cfg_2005.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>
</body>
</html>