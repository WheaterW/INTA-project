
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring Basic Detection Functions">
<meta name="abstract" content="This section describes how to configure proper MPLS OAM parameters on both ends of an associated bidirectional LSP for network loads.">
<meta name="description" content="This section describes how to configure proper MPLS OAM parameters on both ends of an associated bidirectional LSP for network loads.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mplsoam_cfg_0004.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mplsoam_cfg_0007.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="z50024784,z00603461,w00800033,mpls-oam-vrp,jwx1168690,w00556928,w00437000,w00606909,m00390128,l00455378,wwx1270540">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="MPLS OAM">
<meta name="featuretype" content="Network Reliability">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="MPLS OAM">
<meta name="featuretype" content="Network Reliability">
<meta name="featurename" content="MPLS OAM">
<meta name="featuretype" content="Network Reliability">
<meta name="featurename" content="MPLS OAM">
<meta name="featuretype" content="Network Reliability">
<meta name="OWNER" content="z00545680">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="z00545680">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172362352">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring Basic Detection Functions</title>
</head>
<body><a name="EN-US_TASK_0172362352"></a><a name="EN-US_TASK_0172362352"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring Basic Detection Functions</h1>
<div class="taskbody"><p>This section describes how to configure proper MPLS OAM parameters on both ends of an associated bidirectional LSP for network loads.</p>
<div class="context"><a name="EN-US_TASK_0172362352__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><div class="p">Associated bidirectional LSPs are classified into the following types:<ul><li>Dynamic associated bidirectional LSP</li><li>Static associated bidirectional LSP</li></ul>
</div>
<p>A forward RSVP-TE LSP and a reverse RSVP-TE LSP between two nodes are established. Each LSP is bound to the ingress of its reverse LSP. The two LSPs then form a dynamic associated bidirectional LSP. If two static unidirectional CR-LSPs are deployed, the CR-LSPs can form a static associated bidirectional LSP. The associated bidirectional LSP is used to prevent traffic congestion. If a fault occurs on one end, the other end is notified of the fault so that both ends trigger traffic switchovers, preventing service interruptions.</p>
<p>For details about the differences between dynamic associated bidirectional LSPs and static associated bidirectional LSPs, see <a href="dc_vrp_te-p2p_cfg_0200.html">Configuring an Associated Bidirectional CR-LSP</a>.</p>
<p>A node functions as both the ingress and egress for an associated bidirectional LSP. Perform the following steps on both ends:</p>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172362352__1.4.2"></a><a name="1.4.2"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Run <span><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span></span><p><p>The system view is displayed.</p>
</p></li><li><span>Run <span><a href="cmdqueryname=mpls"><b><span class="cmdname">mpls</span></b></a></span></span><p><p>The MPLS view is displayed.</p>
</p></li><li><span>Run <span><a href="cmdqueryname=mpls+oam"><b><span class="cmdname">mpls oam</span></b></a></span></span><p><p>MPLS OAM is globally enabled.</p>
</p></li><li><span>Run <span><a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span></span><p><p>Return to the system view.</p>
</p></li><li><span>Run either of the following commands:</span><p><ul><li><p>If a reverse tunnel is not specified, run the <a href="cmdqueryname=mpls+oam+ingress"><b><span class="cmdname">mpls oam ingress</span></b></a> <strong><span>tunnel</span></strong> <i><span class="varname">tunnel-number</span></i> [ <strong><span>type</span></strong> { <strong><span>cv</span></strong> | <strong><span>ffd</span></strong> <strong><span>frequency</span></strong> <i><span class="varname">ffd-fre</span></i> } ] [ <strong><span>backward-lsp</span></strong> <strong><span>share</span></strong> ] [ <strong><span>compatibility-mode</span></strong> { <strong><span>ptn-mode</span></strong> | <strong><span>router-mode</span></strong> } ] [ <strong><span>bdi-frequency</span></strong> { <strong><span>detect-freq</span></strong> | <strong><span>per-second</span></strong> } ] <span>[ <strong><span>exp</span></strong> <i><span class="varname">exp-value</span></i> ]</span> command to configure MPLS OAM parameters for the ingress.</p>
</li><li><p>If a reverse tunnel is specified, run the <a href="cmdqueryname=mpls+oam+ingress"><b><span class="cmdname">mpls oam ingress</span></b></a> <strong><span>tunnel</span></strong> <i><span class="varname">tunnel-number</span></i> [ <strong><span>type</span></strong> { <strong><span>cv</span></strong> | <strong><span>ffd</span></strong> <strong><span>frequency</span></strong> <i><span class="varname">ffd-fre</span></i> } ] [ <strong><span>backward-lsp</span></strong> { <strong><span>lsp-name</span></strong> <i><span class="varname">lsp-name</span></i> | <strong><span>lsr-id</span></strong> <i><span class="varname">rev-ingress-lsr-id</span></i> <strong><span>tunnel-id</span></strong> <i><span class="varname">rev-tunnel-id</span></i> | <strong><span>share</span></strong> } ] [ <strong><span>compatibility-mode</span></strong> { <strong><span>ptn-mode</span></strong> | <strong><span>router-mode</span></strong> } ] [ <strong><span>bdi-frequency</span></strong> { <strong><span>detect-freq</span></strong> | <strong><span>per-second</span></strong> } ] <span>[ <strong><span>exp</span></strong> <i><span class="varname">exp-value</span></i> ]</span> command to configure MPLS OAM parameters for the ingress. </p>
</li></ul>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><ul><li>If the source end of a static LSP is configured to work in shared mode, a TTSI must be configured on the destination end. If a TTSI is not configured on the destination end, BDI packets cannot be received.</li><li>It is recommended that you configure a reverse LSP for ingress OAM to verify BDI packets.</li></ul>
</div></div>
</p></li><li><span>Run <span><a href="cmdqueryname=mpls+oam+ingress+enable"><b><span class="cmdname">mpls oam ingress enable</span></b></a> {<i><span class="varname"> tunnel-type</span></i>  <i><span class="varname">tunnel-number</span></i> | <i><span class="varname">tunnel-name </span></i>}</span></span><p><p>OAM is enabled on the ingress.</p>
</p></li><li><span>Run either of the following commands:</span><p><ul><li><p>To enable OAM auto protocol extension, run the <a href="cmdqueryname=mpls+oam+egress"><b><span class="cmdname">mpls oam egress</span></b></a> <span>{ <strong><span id="EN-US_TASK_0172362352__en-us_cliref_0172377208_cmdparmname686435399214437">lsp-name</span></strong> <i><span class="varname" id="EN-US_TASK_0172362352__en-us_cliref_0172377208_varname1776980847214437">lsp-name</span></i> | <strong><span id="EN-US_TASK_0172362352__en-us_cliref_0172377208_cmdparmname927365136214437">lsr-id</span></strong> <i><span class="varname" id="EN-US_TASK_0172362352__en-us_cliref_0172377208_varname815444224214437">ingress-lsr-id</span></i> <strong><span id="EN-US_TASK_0172362352__en-us_cliref_0172377208_cmdparmname1304808587214437">tunnel-id</span></strong> <i><span class="varname" id="EN-US_TASK_0172362352__en-us_cliref_0172377208_varname1681438987214437">tunnel-id</span></i> } <strong><span id="EN-US_TASK_0172362352__en-us_cliref_0172377208_cmdparmname1124047242214437">auto-protocol</span></strong> <span>[ <strong><span id="EN-US_TASK_0172362352__en-us_cliref_0172377208_cmdparmname1806265739214437">overtime</span></strong> <i><span class="varname" id="EN-US_TASK_0172362352__en-us_cliref_0172377208_varname1475202712214437">over-time</span></i> ] </span>[ <strong><span id="EN-US_TASK_0172362352__en-us_cliref_0172377208_cmdparmname1014965550214437">backward-lsp</span></strong> { <strong><span id="EN-US_TASK_0172362352__en-us_cliref_0172377208_cmdparmname911841113214437">tunnel</span></strong> <i><span class="varname" id="EN-US_TASK_0172362352__en-us_cliref_0172377208_varname2102478190214437">tunnel-id</span></i> | <i><span class="varname" id="EN-US_TASK_0172362352__en-us_cliref_0172377208_varname349997500214437">tunnel-name</span></i> }<span> [ <strong><span id="EN-US_TASK_0172362352__en-us_cliref_0172377208_cmdparmname378312953214437">private</span></strong> | <strong><span id="EN-US_TASK_0172362352__en-us_cliref_0172377208_cmdparmname1593689409214437">share</span></strong> ] ] [ <strong><span id="EN-US_TASK_0172362352__en-us_cliref_0172377208_cmdparmname1466417643214437">bdi-frequency</span></strong> { <strong><span id="EN-US_TASK_0172362352__en-us_cliref_0172377208_cmdparmname1313178114214437">detect-freq</span></strong> | <strong><span id="EN-US_TASK_0172362352__en-us_cliref_0172377208_cmdparmname1993801285214437">per-second</span></strong> }</span> ]</span> command.</p>
</li><li><p>To configure OAM parameters when OAM auto protocol extension is disabled on the egress, run the <a href="cmdqueryname=mpls+oam+egress"><b><span class="cmdname">mpls oam egress</span></b></a> { <strong><span>lsp-name</span></strong> <i><span class="varname">lsp-name</span></i> | <strong><span>lsr-id </span></strong><i><span class="varname">ingress-lsr-id</span></i> <strong><span>tunnel-id</span></strong> <i><span class="varname">tunnel-id</span></i> } [ <strong><span>type</span></strong> { <strong><span>cv</span></strong> | <strong><span>ffd frequency</span></strong> { <strong><span>3 </span></strong>| <strong><span>10 </span></strong>| <strong><span>20</span></strong> | <strong><span>50</span></strong> | <strong><span>100</span></strong> | <strong><span>200</span></strong> | <strong><span>500</span></strong> } } ] [ <strong><span>backward-lsp</span></strong> { <i><span class="varname">tunnel-type</span></i> <i><span class="varname">tunnel-number</span></i> | <i><span class="varname">tunnel-name</span></i> } [ <strong><span>share</span></strong> | <strong><span>private</span></strong> ] ] [ <strong><span>bdi-frequency</span></strong> <i><span class="varname">bdi-frep-value</span></i> ] command.</p>
</li></ul>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><ul><li>If OAM auto protocol extension is enabled in Step 7, skip Step 8. After receiving the first CV or FFD packet, the egress automatically records OAM parameters, such as the detection packet type and interval at which detection packets are sent. The egress then uses these parameters to monitor link connectivity.</li><li>It is recommended that you configure a reverse LSP for egress OAM to send BDI packets.</li></ul>
</div></div>
</p></li><li><span>(Optional) Run <span><a href="cmdqueryname=mpls+oam+egress+enable"><b><span class="cmdname">mpls oam egress enable</span></b></a> { <strong><span>lsp-name</span></strong> <i><span class="varname">lsp-name</span></i> | <strong><span>lsr-id</span></strong> <i><span class="varname">ingress-lsr-id</span></i> <strong><span>tunnel-id</span></strong> <i><span class="varname">tunnel-id</span></i> }</span></span><p><p>OAM is enabled on the egress.</p>
</p></li><li><span>(Optional) Run <span><a href="cmdqueryname=mpls+oam+ingress+loss-measure+oam-packet+loss-ratio"><b><span class="cmdname">mpls oam ingress loss-measure oam-packet loss-ratio</span></b></a><span>{ <strong><span id="EN-US_TASK_0172362352__en-us_cliref_0172377215_cmdparmname193367704214437">threshold1</span></strong> <i><span class="varname" id="EN-US_TASK_0172362352__en-us_cliref_0172377215_varname607810490214437">threshold1-value</span></i> | <strong><span id="EN-US_TASK_0172362352__en-us_cliref_0172377215_cmdparmname279110643214437">threshold2</span></strong> <i><span class="varname" id="EN-US_TASK_0172362352__en-us_cliref_0172377215_varname713131850214437">threshold2-value</span></i> } <sup id="EN-US_TASK_0172362352__en-us_cliref_0172377215_sup615877063214437">*</sup> <strong><span id="EN-US_TASK_0172362352__en-us_cliref_0172377215_cmdparmname1332826657214437">tunnel</span></strong> <i><span class="varname" id="EN-US_TASK_0172362352__en-us_cliref_0172377215_varname1272628956214437">tunnel-number</span></i></span></span></span><p><p>The packet loss alarm threshold on the ingress is set.</p>
</p></li><li><span>(Optional) Run <span><a href="cmdqueryname=mpls+oam+ingress+lost-measure+single-ended+proactive"><b><span class="cmdname">mpls oam ingress lost-measure single-ended proactive</span></b></a><span>[ <strong><span id="EN-US_TASK_0172362352__en-us_cliref_0172377218_cmdparmname364781346214437">exp</span></strong> <i><span class="varname" id="EN-US_TASK_0172362352__en-us_cliref_0172377218_varname1020200536214437">exp-value</span></i> ] <strong><span id="EN-US_TASK_0172362352__en-us_cliref_0172377218_cmdparmname1520043890214437">tunnel</span></strong> <i><span class="varname" id="EN-US_TASK_0172362352__en-us_cliref_0172377218_varname545550279214437">interface-number</span></i></span></span></span><p><p>The single-ended packet loss measurement is enabled on the ingress.</p>
</p></li><li><span>(Optional) Run <span><a href="cmdqueryname=mpls+oam+egress+loss-measure+oam-packet+loss-ratio"><b><span class="cmdname">mpls oam egress loss-measure oam-packet loss-ratio</span></b></a><span>{ <strong><span id="EN-US_TASK_0172362352__en-us_cliref_0172377209_cmdparmname635107353214437">threshold1</span></strong> <i><span class="varname" id="EN-US_TASK_0172362352__en-us_cliref_0172377209_varname197567857214437">threshold1-value</span></i> | <strong><span id="EN-US_TASK_0172362352__en-us_cliref_0172377209_cmdparmname523700933214437">threshold2</span></strong> <i><span class="varname" id="EN-US_TASK_0172362352__en-us_cliref_0172377209_varname458067945214437">threshold2-value</span></i> } <sup id="EN-US_TASK_0172362352__en-us_cliref_0172377209_sup362799666214437">*</sup> { <strong><span id="EN-US_TASK_0172362352__en-us_cliref_0172377209_cmdparmname1117078992214437">lsp-name</span></strong> <i><span class="varname" id="EN-US_TASK_0172362352__en-us_cliref_0172377209_varname1433365759214437">lsp-name</span></i> | <strong><span id="EN-US_TASK_0172362352__en-us_cliref_0172377209_cmdparmname327541395214437">lsr-id</span></strong> <i><span class="varname" id="EN-US_TASK_0172362352__en-us_cliref_0172377209_varname646791248214437">lsr-id</span></i> <strong><span id="EN-US_TASK_0172362352__en-us_cliref_0172377209_cmdparmname725779981214437">tunnel-id</span></strong> <i><span class="varname" id="EN-US_TASK_0172362352__en-us_cliref_0172377209_varname829379861214437">tunnel-id</span></i> }</span></span></span><p><p>The packet loss alarm threshold is set on the egress.</p>
</p></li><li><span>(Optional) Run <span><a href="cmdqueryname=mpls+oam+ingress+delay-measure+two-way+proactive"><b><span class="cmdname">mpls oam ingress delay-measure two-way proactive</span></b></a><span>[ <strong><span id="EN-US_TASK_0172362352__en-us_cliref_0172377220_cmdparmname1032428486214437">exp</span></strong> <i><span class="varname" id="EN-US_TASK_0172362352__en-us_cliref_0172377220_varname1733793152214437">exp-value</span></i> | <strong><span id="EN-US_TASK_0172362352__en-us_cliref_0172377220_cmdparmname507884645214437">packet-size</span></strong> <i><span class="varname" id="EN-US_TASK_0172362352__en-us_cliref_0172377220_varname1767669105214437">packet-size-value</span></i> | [ <strong><span id="EN-US_TASK_0172362352__en-us_cliref_0172377220_cmdparmname1326567264214437">padding-value</span></strong> { <strong><span id="EN-US_TASK_0172362352__en-us_cliref_0172377220_cmdparmname1993087524214437">0</span></strong> | <strong><span id="EN-US_TASK_0172362352__en-us_cliref_0172377220_cmdparmname1578230872214437">1</span></strong> } ] ] <sup id="EN-US_TASK_0172362352__en-us_cliref_0172377220_sup1392558117214437">*</sup> <span><span>{</span><i><span class="varname" id="EN-US_TASK_0172362352__en-us_cliref_0172377220_varname1759375759214025"> tunnel-type</span></i><span>  </span><i><span class="varname" id="EN-US_TASK_0172362352__en-us_cliref_0172377220_varname137945218318">tunnel-number</span></i><span> | </span><i><span class="varname" id="EN-US_TASK_0172362352__en-us_cliref_0172377220_varname165687949">tunnel-name </span></i><span>}</span></span></span></span></span><p><p>The two-way delay measurement is enabled on the ingress.</p>
</p></li><li><span>Run <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span></span><p><p>The configuration is committed.</p>
</p></li></ol></div>
<div class="postreq-steps"><a name="EN-US_TASK_0172362352__1.4.3"></a><a name="1.4.3"></a><h4 class="sectiontitle">Exception Handling</h4>
<div class="p">
<div class="p">If the transmit end has FFD configured and the receive end has <strong><span>auto-protocol</span></strong> configured, the receive end receives FFD packets at the interval that the transmit end sends packets. After the following operations are performed, an unknown alarm is automatically reported and cannot be cleared:<ol><li>Run the <a href="cmdqueryname=shutdown"><b><span class="cmdname">shutdown</span></b></a> command on the service interface of the receive end to disable services.</li><li>Run the <a href="cmdqueryname=mpls+oam+ingress"><b><span class="cmdname">mpls oam ingress</span></b></a> command on the transmit end to modify the FFD packet sending interval by specifying the <strong><span>frequency</span></strong> <i><span class="varname">ffd-fre</span></i> parameter. The interval on the receive end remains unchanged.</li><li>Run the <a href="cmdqueryname=undo+shutdown"><b><span class="cmdname">undo shutdown</span></b></a> command on the service interface of the receive end to enable services. Then, the receive end will receive FFD packets at an interval different from the locally recorded one.</li></ol>
</div>

<div class="p">In this situation, run the <a href="cmdqueryname=undo+mpls+oam+ingress+enable"><b><span class="cmdname">undo mpls oam ingress enable</span></b></a> command on the transmit end to disable FFD. Then, reconfigure FFD.</div>
</div></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mplsoam_cfg_0004.html">Configuring MPLS OAM for an Associated Bidirectional LSP
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mplsoam_cfg_0007.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>