
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Connecting VRRP Groups to L3VPNs">
<meta name="abstract" content="In this example, a VRRP group is specified as a gateway connected to CEs in each Layer 3 virtual private network (L3VPN). This configuration allows various VRRP groups to load-balance traffic and hosts at different sites in each VPN to communicate with each other.">
<meta name="description" content="In this example, a VRRP group is specified as a gateway connected to CEs in each Layer 3 virtual private network (L3VPN). This configuration allows various VRRP groups to load-balance traffic and hosts at different sites in each VPN to communicate with each other.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vrrp_cfg_0120.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vrrp_cfg_0132.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vrrp_cfg_0200.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00604599">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="VRRP">
<meta name="featuretype" content="Network Reliability">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="VRRP">
<meta name="featuretype" content="Network Reliability">
<meta name="featurename" content="VRRP">
<meta name="featuretype" content="Network Reliability">
<meta name="featurename" content="VRRP">
<meta name="featuretype" content="Network Reliability">
<meta name="OWNER" content="w00604599">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="q00824768">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172361799">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/thickbox.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/imageResize.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery-migrate-1.2.1.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery-ui.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery.mousewheel.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/thickbox.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>Example for Connecting VRRP Groups to L3VPNs</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172361799"></a><a name="EN-US_TASK_0172361799"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Connecting VRRP Groups to L3VPNs</h1>
<div class="taskbody"><p>In this example, a VRRP group is specified as a gateway connected to CEs in each Layer 3 virtual private network (L3VPN). This configuration allows various VRRP groups to load-balance traffic and hosts at different sites in each VPN to communicate with each other.</p>
<div class="context"><a name="EN-US_TASK_0172361799__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>IT technologies, such as enterprise resource planning, Voice over Internet Protocol (VoIP), video conferencing, and online training, provide a framework for office automation and information access in enterprises. As network economy develops, enterprises have growing networks and partners, and employees are often on business trips. A carrier network is required to help an enterprise connect its headquarters and branches and provide convenient access services for the staff on business trips. The VPN technology was developed and used over an IP network to meet this requirement.</p>
<p>To improve VPN reliability, add VPN interfaces to different VRRP groups.</p>
<p>As shown in <a href="#EN-US_TASK_0172361799__fig_dc_vrp_vrrp_cfg_012301">Figure 1</a>, VPN-RED and VPN-BLUE are deployed and MPLS and VRRP are configured.</p>

<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" frame="border" border="1" rules="all"><caption><b>Table 1 </b>Networking diagram for connecting VRRP groups to an L3VPN</caption><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="23.5%" id="mcps1.4.1.5.2.3.1.1" liSelected="liSelected"><p>Item</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="76.5%" id="mcps1.4.1.5.2.3.1.2" liSelected="liSelected"><p>Networking Requirements</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" valign="top" width="23.5%" headers="mcps1.4.1.5.2.3.1.1 "><p>Backup groups</p>
</td>
<td class="cellrowborder" valign="top" width="76.5%" headers="mcps1.4.1.5.2.3.1.2 "><div class="p"><ul><li><p>PE-A and PE-B form backup groups 1 and 2. In backup group 1, PE-A functions as the master device and PE-B functions as the backup device. In backup group 2, PE-A functions as the backup device and PE-B functions as the master device.</p>
</li><li><p>CE-A uses the virtual IP address of backup group 1 as the default gateway address.</p>
</li><li><p>CE-B uses the virtual IP address of backup group 2 as the default gateway address.</p>
</li></ul>
</div>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="23.5%" headers="mcps1.4.1.5.2.3.1.1 "><p>VPN instances to which CEs belong</p>
</td>
<td class="cellrowborder" valign="top" width="76.5%" headers="mcps1.4.1.5.2.3.1.2 "><div class="p"><ul><li><p>CE-A and CE-D belong to the VPN-BLUE instance.</p>
</li><li><p>CE-B and CE-C belong to the VPN-RED instance.</p>
</li></ul>
</div>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="23.5%" headers="mcps1.4.1.5.2.3.1.1 "><p>VPN instances to which interfaces on PEs belong</p>
</td>
<td class="cellrowborder" valign="top" width="76.5%" headers="mcps1.4.1.5.2.3.1.2 "><div class="p"><ul><li><p>On PE-A, GE <span>0/1/0</span> belongs to the VPN-BLUE instance, and GE <span>0/2/0</span> belongs to the VPN-RED instance.</p>
</li><li><p>On PE-B, GE <span>0/1/0</span> belongs to the VPN-BLUE instance, and GE <span>0/2/0</span> belongs to the VPN-RED instance.</p>
</li><li><p>On PE-C, GE <span>0/1/0</span> belongs to the VPN-RED instance, and GE <span>0/2/0</span> belongs to the VPN-BLUE instance.</p>
</li></ul>
</div>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="23.5%" headers="mcps1.4.1.5.2.3.1.1 "><p>Routing protocol and MPLS</p>
</td>
<td class="cellrowborder" valign="top" width="76.5%" headers="mcps1.4.1.5.2.3.1.2 "><div class="p"><ul><li><p>OSPF is configured and MPLS is enabled on a public network.</p>
</li><li><p>Default routes are configured on CE-A and CE-B. CE-A and CE-B exchange VPN routing information with PE-A and PE-B, respectively.</p>
</li><li><p>BGP peer relationships are set up between PE-A and PE-B, between PE-A and PE-C, and between PE-B and PE-C to transmit VPN routing information.</p>
</li></ul>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="fignone" id="EN-US_TASK_0172361799__fig_dc_vrp_vrrp_cfg_012301"><a name="EN-US_TASK_0172361799__fig_dc_vrp_vrrp_cfg_012301"></a><a name="fig_dc_vrp_vrrp_cfg_012301"></a><span class="figcap"><b>Figure 1 </b>Connecting VRRP groups to L3VPNs</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 through 3 in this example represent GE <span>0/1/0</span>, GE <span>0/2/0</span>, and GE <span>0/3/0</span>, respectively.</p>
</div></div>
<br><span><img class="imgResize" src="images/fig_dc_vrp_vrrp_cfg_012301.png" width="526.6800000000001" height="NaN" title="Click to enlarge"></span><br></div>

<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" frame="border" border="1" rules="all"><thead align="left"><tr><th align="left" class="cellrowborder" char="." valign="top" width="25%" id="mcps1.4.1.7.1.5.1.1" liSelected="liSelected"><p><strong>Device</strong> Name</p>
</th>
<th align="left" class="cellrowborder" char="." valign="top" width="25%" id="mcps1.4.1.7.1.5.1.2" liSelected="liSelected"><p><strong>Interface</strong> Name</p>
</th>
<th align="left" class="cellrowborder" char="." valign="top" width="25%" id="mcps1.4.1.7.1.5.1.3" liSelected="liSelected"><p>IP Address and Mask</p>
</th>
<th align="left" class="cellrowborder" char="." valign="top" width="25%" id="mcps1.4.1.7.1.5.1.4" liSelected="liSelected"><p>Instance to Which the Interface Belongs</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" rowspan="4" char="." valign="top" width="25%" headers="mcps1.4.1.7.1.5.1.1 "><p>P</p>
</td>
<td class="cellrowborder" char="." valign="top" width="25%" headers="mcps1.4.1.7.1.5.1.2 "><p>GE<span>0/1/0</span></p>
</td>
<td class="cellrowborder" char="." valign="top" width="25%" headers="mcps1.4.1.7.1.5.1.3 "><p>192.168.1.2/24</p>
</td>
<td class="cellrowborder" char="." valign="top" width="25%" headers="mcps1.4.1.7.1.5.1.4 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.7.1.5.1.2 "><p>GE<span>0/2/0</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.7.1.5.1.3 "><p>192.168.2.2/24</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.7.1.5.1.4 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.7.1.5.1.2 "><p>GE<span>0/3/0</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.7.1.5.1.3 "><p>192.168.3.2/24</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.7.1.5.1.4 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.7.1.5.1.2 "><p>Loopback1</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.7.1.5.1.3 "><p>4.4.4.4/32</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.7.1.5.1.4 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="4" char="." valign="top" width="25%" headers="mcps1.4.1.7.1.5.1.1 "><p>PE-A</p>
</td>
<td class="cellrowborder" char="." valign="top" width="25%" headers="mcps1.4.1.7.1.5.1.2 "><p>GE<span>0/1/0</span></p>
</td>
<td class="cellrowborder" char="." valign="top" width="25%" headers="mcps1.4.1.7.1.5.1.3 "><p>10.1.1.1/24</p>
</td>
<td class="cellrowborder" char="." valign="top" width="25%" headers="mcps1.4.1.7.1.5.1.4 "><p>VPN-BLUE</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.7.1.5.1.2 "><p>GE<span>0/2/0</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.7.1.5.1.3 "><p>10.3.1.1/24</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.7.1.5.1.4 "><p>VPN-RED</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.7.1.5.1.2 "><p>GE<span>0/3/0</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.7.1.5.1.3 "><p>192.168.1.1/24</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.7.1.5.1.4 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.7.1.5.1.2 "><p>Loopback1</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.7.1.5.1.3 "><p>1.1.1.1/32</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.7.1.5.1.4 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="4" char="." valign="top" width="25%" headers="mcps1.4.1.7.1.5.1.1 "><p>PE-B</p>
</td>
<td class="cellrowborder" char="." valign="top" width="25%" headers="mcps1.4.1.7.1.5.1.2 "><p>GE<span>0/1/0</span></p>
</td>
<td class="cellrowborder" char="." valign="top" width="25%" headers="mcps1.4.1.7.1.5.1.3 "><p>10.1.1.2/24</p>
</td>
<td class="cellrowborder" char="." valign="top" width="25%" headers="mcps1.4.1.7.1.5.1.4 "><p>VPN-BLUE</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.7.1.5.1.2 "><p>GE<span>0/2/0</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.7.1.5.1.3 "><p>10.3.1.2/24</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.7.1.5.1.4 "><p>VPN-RED</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.7.1.5.1.2 "><p>GE<span>0/3/0</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.7.1.5.1.3 "><p>192.168.2.1/24</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.7.1.5.1.4 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.7.1.5.1.2 "><p>Loopback1</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.7.1.5.1.3 "><p>2.2.2.2/32</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.7.1.5.1.4 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="4" char="." valign="top" width="25%" headers="mcps1.4.1.7.1.5.1.1 "><p>PE-C</p>
</td>
<td class="cellrowborder" char="." valign="top" width="25%" headers="mcps1.4.1.7.1.5.1.2 "><p>GE<span>0/1/0</span></p>
</td>
<td class="cellrowborder" char="." valign="top" width="25%" headers="mcps1.4.1.7.1.5.1.3 "><p>10.4.1.1/24</p>
</td>
<td class="cellrowborder" char="." valign="top" width="25%" headers="mcps1.4.1.7.1.5.1.4 "><p>VPN-RED</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.7.1.5.1.2 "><p>GE<span>0/2/0</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.7.1.5.1.3 "><p>10.2.1.1/24</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.7.1.5.1.4 "><p>VPN-BLUE</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.7.1.5.1.2 "><p>GE<span>0/3/0</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.7.1.5.1.3 "><p>192.168.3.1/24</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.7.1.5.1.4 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.7.1.5.1.2 "><p>Loopback1</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.7.1.5.1.3 "><p>3.3.3.3/32</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.7.1.5.1.4 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" width="25%" headers="mcps1.4.1.7.1.5.1.1 "><p>CE-A</p>
</td>
<td class="cellrowborder" char="." valign="top" width="25%" headers="mcps1.4.1.7.1.5.1.2 "><p>GE<span>0/1/0</span></p>
</td>
<td class="cellrowborder" char="." valign="top" width="25%" headers="mcps1.4.1.7.1.5.1.3 "><p>10.1.1.100/24</p>
</td>
<td class="cellrowborder" char="." valign="top" width="25%" headers="mcps1.4.1.7.1.5.1.4 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" width="25%" headers="mcps1.4.1.7.1.5.1.1 "><p>CE-B</p>
</td>
<td class="cellrowborder" char="." valign="top" width="25%" headers="mcps1.4.1.7.1.5.1.2 "><p>GE<span>0/1/0</span></p>
</td>
<td class="cellrowborder" char="." valign="top" width="25%" headers="mcps1.4.1.7.1.5.1.3 "><p>10.3.1.100/24</p>
</td>
<td class="cellrowborder" char="." valign="top" width="25%" headers="mcps1.4.1.7.1.5.1.4 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" width="25%" headers="mcps1.4.1.7.1.5.1.1 "><p>CE-C</p>
</td>
<td class="cellrowborder" char="." valign="top" width="25%" headers="mcps1.4.1.7.1.5.1.2 "><p>GE<span>0/1/0</span></p>
</td>
<td class="cellrowborder" char="." valign="top" width="25%" headers="mcps1.4.1.7.1.5.1.3 "><p>10.4.1.100/24</p>
</td>
<td class="cellrowborder" char="." valign="top" width="25%" headers="mcps1.4.1.7.1.5.1.4 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" width="25%" headers="mcps1.4.1.7.1.5.1.1 "><p>CE-D</p>
</td>
<td class="cellrowborder" char="." valign="top" width="25%" headers="mcps1.4.1.7.1.5.1.2 "><p>GE<span>0/1/0</span></p>
</td>
<td class="cellrowborder" char="." valign="top" width="25%" headers="mcps1.4.1.7.1.5.1.3 "><p>10.2.1.100/24</p>
</td>
<td class="cellrowborder" char="." valign="top" width="25%" headers="mcps1.4.1.7.1.5.1.4 "><p>-</p>
</td>
</tr>
</tbody>
</table>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172361799__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Precautions</h4><div class="p">To complete the configuration, you need to perform the following operations:<ol><li><p>Configure OSPF on each PE and P to ensure that the backbone network is reachable.</p>
</li><li>Enable MPLS and MPLS LDP, and set up LDP LSPs on the MPLS backbone network.</li><li>Configure VPN instances on each PE and connect each CE to a PE.</li><li>Set up an MP-IBGP peer relationship between PEs.</li><li>Configure a route on CE-A and CE-B.</li></ol>
</div>
<p>For configuration details about Steps 1 through 5, see the chapter "BGP/MPLS IP VPN Configuration" in <em><span class="keyword">HUAWEI NE40E-M2 series</span> <span class="keyword">Universal Service Router</span> Configuration Guide - VPN</em> or <a href="#EN-US_TASK_0172361799__example1223748637214023">Configuration Files</a> in this section.</p>
<p>To improve security, you are advised to configure a VRRP security policy. For details, see "Example for Configuring a VRRP Group."</p>
</div></div>
<div class="context"><a name="EN-US_TASK_0172361799__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure backup groups 1 and 2 on PE-A and PE-B.</p>
</li><li><p>Configure PE-A as the master device and PE-B as the backup device in backup group 1.</p>
</li><li><p>Configure PE-A as the backup device and PE-B as the master device in backup group 2.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172361799__1.4.4"></a><a name="1.4.4"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>ID and virtual IP address of each VRRP group</p>
</li><li><p>Priority of each <span class="keyword">Router</span> in each VRRP group</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172361799__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure multi-instance VRRP on PE-A and PE-B.</span><p><p># Create backup group 1 on PE-A and set the priority of PE-A to 120 in backup group 1.</p>
<pre class="screen">&lt;PE-A&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-A] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-A-GigabitEthernet<span>0/1/0</span>] <strong>vrrp vrid 1 virtual-ip 10.1.1.111</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-A-GigabitEthernet<span>0/1/0</span>] <strong>vrrp vrid 1 priority 120</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-A-GigabitEthernet<span>0/1/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-A-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<p># Create backup group 2 on PE-A and retain the default priority for PE-A in backup group 2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-A] <strong>interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-A-GigabitEthernet<span>0/2/0</span>] <strong>vrrp vrid 2 virtual-ip 10.3.1.111</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-A-GigabitEthernet<span>0/2/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-A-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<p># Create backup group 1 on PE-B and retain the default priority (100) for PE-B in backup group 1.</p>
<pre class="screen">&lt;PE-B&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-B] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-B-GigabitEthernet<span>0/1/0</span>] <strong>vrrp vrid 1 virtual-ip 10.1.1.111</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-B-GigabitEthernet<span>0/1/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-B-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<p># Create backup group 2 on PE-B and set the priority of PE-B to 120 in backup group 2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-B] <strong>interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-B-GigabitEthernet<span>0/2/0</span>] <strong>vrrp vrid 2 virtual-ip 10.3.1.111</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-B-GigabitEthernet<span>0/2/0</span>] <strong>vrrp vrid 2 priority 120</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-B-GigabitEthernet<span>0/2/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-B-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p>Run the <strong><span>display ip routing-table vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i> command on PE-A and PE-B. The command output shows that a route destined for the virtual IP address exists only in the routing table of PE-A.</p>
<p>The following example uses the command output on PE-A.</p>
<pre class="screen">&lt;PE-A&gt; <strong>display ip routing-table vpn-instance VPN-BLUE</strong></pre>
<pre class="screen"><span class="keyword">Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route</span>
------------------------------------------------------------------------------
Routing Table : VPN-BLUE
         Destinations : 8       Routes : 8        

Destination/Mask    Proto  Pre  Cost        Flags NextHop         Interface

       10.1.1.0/24  Direct 0    0             D  10.1.1.2        GigabitEthernet<span>0/1/0</span>
       10.1.1.1/32  Direct 0    0             D  10.1.1.1        GigabitEthernet<span>0/1/0</span>
<strong>     10.1.1.111/32  Direct 0    0             D  127.0.0.1       GigabitEthernet<span>0/1/0</span></strong>
     10.1.1.255/32  Direct 0    0             D  127.0.0.1       GigabitEthernet<span>0/1/0</span>
      127.0.0.0/8   Direct 0    0             D  127.0.0.1       InLoopBack0
      127.0.0.1/32  Direct 0    0             D  127.0.0.1       InLoopBack0
127.255.255.255/32  Direct 0    0             D  127.0.0.1       InLoopBack0
255.255.255.255/32  Direct 0    0             D  127.0.0.1       InLoopBack0</pre>
<p>Run the <strong><span>ping</span></strong> command supporting multi-VRRP on PE-A and PE-B.</p>
<pre class="screen">&lt;PE-A&gt; <strong>ping -vpn-instance VPN-BLUE 10.1.1.111</strong></pre>
<pre class="screen">  PING 10.1.1.111: 56  data bytes, press CTRL_C to break
    Reply from 10.1.1.111: bytes=56 Sequence=1 ttl=255 time=50 ms
    Reply from 10.1.1.111: bytes=56 Sequence=2 ttl=255 time=60 ms
    Reply from 10.1.1.111: bytes=56 Sequence=3 ttl=255 time=60 ms
    Reply from 10.1.1.111: bytes=56 Sequence=4 ttl=255 time=40 ms
    Reply from 10.1.1.111: bytes=56 Sequence=5 ttl=255 time=60 ms

  --- 10.1.1.111 ping statistics ---
    5 packet(s) transmitted
    5 packet(s) received
    0.00% packet loss
    round-trip min/avg/max = 40/54/60 ms  </pre>
<p>The command output shows that the virtual IP address 10.1.1.111 can be pinged.</p>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0172361799__example1223748637214023"><a name="EN-US_TASK_0172361799__example1223748637214023"></a><a name="example1223748637214023"></a><a name="EN-US_TASK_0172361799__1.4.6"></a><a name="1.4.6"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>PE-A configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname PE-A</pre>
<pre class="screen">#</pre>
<pre class="screen">ip vpn-instance VPN-BLUE</pre>
<pre class="screen"> ipv4-family
 route-distinguisher 100:1</pre>
<pre class="screen"> apply-label per-instance</pre>
<pre class="screen"> vpn-target 100:1 export-extcommunity</pre>
<pre class="screen"> vpn-target 100:1 import-extcommunity</pre>
<pre class="screen">#</pre>
<pre class="screen">ip vpn-instance VPN-RED</pre>
<pre class="screen"> ipv4-family
 route-distinguisher 200:1</pre>
<pre class="screen"> apply-label per-instance</pre>
<pre class="screen"> vpn-target 200:1 export-extcommunity</pre>
<pre class="screen"> vpn-target 200:1 import-extcommunity</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls lsr-id 1.1.1.1</pre>
<pre class="screen">mpls</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls ldp</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip binding vpn-instance VPN-BLUE</pre>
<pre class="screen"> ip address 10.1.1.1 255.255.255.0</pre>
<pre class="screen"> vrrp vrid 1 virtual-ip 10.1.1.111</pre>
<pre class="screen"> vrrp vrid 1 priority 120</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/2/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip binding vpn-instance VPN-RED</pre>
<pre class="screen"> ip address 10.3.1.1 255.255.255.0</pre>
<pre class="screen"> vrrp vrid 2 virtual-ip 10.3.1.111</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/3/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 192.168.1.1 255.255.255.0</pre>
<pre class="screen"> mpls</pre>
<pre class="screen"> mpls ldp</pre>
<pre class="screen">#</pre>
<pre class="screen">interface LoopBack1</pre>
<pre class="screen"> ip address 1.1.1.1 255.255.255.255</pre>
<pre class="screen">#</pre>
<pre class="screen">bgp 100</pre>
<pre class="screen"> peer 3.3.3.3 as-number 100</pre>
<pre class="screen"> peer 3.3.3.3 connect-interface LoopBack1</pre>
<pre class="screen">#</pre>
<pre class="screen"> ipv4-family unicast</pre>
<pre class="screen">  undo synchronization</pre>
<pre class="screen">  peer 3.3.3.3 enable</pre>
<pre class="screen">#</pre>
<pre class="screen">ipv4-family vpnv4</pre>
<pre class="screen">  policy vpn-target</pre>
<pre class="screen">  peer 3.3.3.3 enable</pre>
<pre class="screen"> #</pre>
<pre class="screen">ipv4-family vpn-instance VPN-BLUE</pre>
<pre class="screen">  import-route direct</pre>
<pre class="screen"> #</pre>
<pre class="screen"> ipv4-family vpn-instance VPN-RED</pre>
<pre class="screen">  import-route direct</pre>
<pre class="screen">#</pre>
<pre class="screen">ospf 1</pre>
<pre class="screen"> area 0.0.0.0</pre>
<pre class="screen">  network 192.168.1.0 0.0.0.255</pre>
<pre class="screen">  network 1.1.1.1 0.0.0.0</pre>
<pre class="screen">return</pre>
</li><li><p>PE-B configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname PE-B</pre>
<pre class="screen">#</pre>
<pre class="screen">ip vpn-instance VPN-BLUE</pre>
<pre class="screen"> ipv4-family
 route-distinguisher 100:1</pre>
<pre class="screen"> apply-label per-instance</pre>
<pre class="screen"> vpn-target 100:1 export-extcommunity</pre>
<pre class="screen"> vpn-target 100:1 import-extcommunity</pre>
<pre class="screen">#</pre>
<pre class="screen">ip vpn-instance VPN-RED</pre>
<pre class="screen"> ipv4-family
 route-distinguisher 200:1</pre>
<pre class="screen"> apply-label per-instance</pre>
<pre class="screen"> vpn-target 200:1 export-extcommunity</pre>
<pre class="screen"> vpn-target 200:1 import-extcommunity</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls lsr-id 2.2.2.2</pre>
<pre class="screen">mpls</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls ldp</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip binding vpn-instance VPN-BLUE</pre>
<pre class="screen"> ip address 10.1.1.2 255.255.255.0</pre>
<pre class="screen"> vrrp vrid 1 virtual-ip 10.1.1.111</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/2/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip binding vpn-instance VPN-RED</pre>
<pre class="screen"> ip address 10.3.1.2 255.255.255.0</pre>
<pre class="screen"> vrrp vrid 2 virtual-ip 10.3.1.111</pre>
<pre class="screen"> vrrp vrid 2 priority 120</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/3/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 192.168.2.1 255.255.255.0</pre>
<pre class="screen"> mpls</pre>
<pre class="screen"> mpls ldp</pre>
<pre class="screen">#</pre>
<pre class="screen">interface LoopBack1</pre>
<pre class="screen">  ip address 2.2.2.2 255.255.255.255</pre>
<pre class="screen">#</pre>
<pre class="screen">bgp 100</pre>
<pre class="screen"> peer 3.3.3.3 as-number 100</pre>
<pre class="screen"> peer 3.3.3.3 connect-interface LoopBack1</pre>
<pre class="screen">#</pre>
<pre class="screen">ipv4-family unicast</pre>
<pre class="screen">  undo synchronization</pre>
<pre class="screen">  peer 3.3.3.3 enable</pre>
<pre class="screen">#</pre>
<pre class="screen">ipv4-family vpnv4</pre>
<pre class="screen">  policy vpn-target</pre>
<pre class="screen">  peer 3.3.3.3 enable</pre>
<pre class="screen">#</pre>
<pre class="screen">ipv4-family vpn-instance VPN-BLUE</pre>
<pre class="screen">import-route direct</pre>
<pre class="screen">#</pre>
<pre class="screen"> ipv4-family vpn-instance VPN-RED</pre>
<pre class="screen"> import-route direct</pre>
<pre class="screen">#</pre>
<pre class="screen">ospf 1</pre>
<pre class="screen"> area 0.0.0.0</pre>
<pre class="screen">  network 192.168.2.0 0.0.0.255</pre>
<pre class="screen">  network 2.2.2.2 0.0.0.0</pre>
<pre class="screen">#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vrrp_cfg_0120.html">Configuration Examples for VRRP
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vrrp_cfg_0132.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vrrp_cfg_0200.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>

<script language="JavaScript">
<!--
image_size('.imgResize');
var msg_imageMax = "view original image";
var msg_imageClose = "close";
//--></script></body>
</html>