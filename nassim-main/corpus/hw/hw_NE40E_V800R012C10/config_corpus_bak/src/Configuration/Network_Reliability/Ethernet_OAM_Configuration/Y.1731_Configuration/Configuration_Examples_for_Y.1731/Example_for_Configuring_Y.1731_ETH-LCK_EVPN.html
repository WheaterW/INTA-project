
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Y.1731 ETH-LCK EVPN">
<meta name="abstract" content="This section uses typical E2E networking as an example to describe how to use the ETH-LCK function EVPN networking.">
<meta name="description" content="This section uses typical E2E networking as an example to describe how to use the ETH-LCK function EVPN networking.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_011531.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_011567.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_11569.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="z50024784,c00376497,z00603461,w00800033,jwx1168690,w00556928,w00437000,eoam-vrp,w00606909,m00390128,l00455378,wwx1270540">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="Ethernet OAM">
<meta name="featuretype" content="Network Reliability">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="Ethernet OAM">
<meta name="featuretype" content="Network Reliability">
<meta name="featurename" content="Ethernet OAM">
<meta name="featuretype" content="Network Reliability">
<meta name="featurename" content="Ethernet OAM">
<meta name="featuretype" content="Network Reliability">
<meta name="featurename" content="Ethernet OAM">
<meta name="featuretype" content="Network Reliability">
<meta name="OWNER" content="z00545680">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="p00915595">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172362200">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring Y.1731 ETH-LCK EVPN</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172362200"></a><a name="EN-US_TASK_0172362200"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Y.1731 ETH-LCK EVPN</h1>
<div class="taskbody"><p>This section uses typical E2E networking as an example to describe how to use the ETH-LCK function EVPN networking.</p>
<div class="context"><a name="EN-US_TASK_0172362200__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>AIS is used to prevent a MEP in an MD of a higher level from sending the same alarm as that sent by a MEP in an MD of a lower level to the NMS. As shown in <a href="#EN-US_TASK_0172362200__fig_dc_vrp_cfg_01154801">Figure 1</a>, PE1 and PE2 are connected through an EVPN, and CE1 and CE2 are connected to the EVPN through a BD. Configure the ETH-LCK function for the BD on the PE. A MEP in the inner MD with a lower level initiates ETH-Test by sending an ETH-LCK packet to a MEP in the outer MD. Upon receipt of the ETH-LCK packet, the MEP in the outer MD suppresses all CC alarms immediately and reports an ETH-LCK alarm indicating administrative locking. In this way, alarm suppression is implemented.</p>
<div class="fignone" id="EN-US_TASK_0172362200__fig_dc_vrp_cfg_01154801"><a name="EN-US_TASK_0172362200__fig_dc_vrp_cfg_01154801"></a><a name="fig_dc_vrp_cfg_01154801"></a><span class="figcap"><b>Figure 1 </b>Networking diagram for configuring the ETH-LCK function</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface1 and interface2 represent GE <span>0/1/1</span> and GE <span>0/1/2</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_cfg_01154801.png"></span><br></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172362200__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><div class="p">The configuration roadmap is as follows:<ol><li>Configure the EVPN network between PE1 and PE2.</li><li><p>Add the PEs to an MD, add each PE and its attached CE to an MD, and ensure that the level of the MD to which the PEs belong is lower than that to which each PE and its attached CE belong.</p>
</li><li><p>Configure ETH-LCK to suppress MEPs in MDs of different levels from sending the same trap to the NMS.</p>
</li></ol>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172362200__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>EVPN instance name <strong>evpna</strong>, RD value, and RT value</p>
</li><li><p>MD name, MA name, and MEP IDs for configuring basic CFM functions</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172362200__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure the AC-side link ETH-LCK.</span><p><ol type="a"><li><p id="EN-US_TASK_0172362200__en-us_task_0172362192_p998513344214024">Configure an EVPN connection.</p>
<p id="EN-US_TASK_0172362200__en-us_task_0172362192_p1505807964214024">Configure an EVPN connection between PE1 and PE2. The configuration details are not provided here. For details, see the <a href="dc_vrp_evpn_cfg_0000.html">EVPN Configuration</a> or configuration files in this configuration example.</p>
</li><li><p>Configure basic Ethernet CFM functions, set the MEP type to Inward, and enable the ETH-LCK function.</p>
<p>Configure basic Ethernet CFM functions on each PE. Specify the Ethernet CFM protocol as IEEE Standard 802.1ag-2007. Create an MD named <strong>md1</strong> and an MA named <strong>ma1</strong>, and bind the MA to the EVPN instance.</p>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>cfm enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>cfm md md1 level 3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-md-md1] <strong>ma ma1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-md-md1-ma-ma1] <strong>map evpn vpn-instance evpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-md-md1-ma-ma1] <strong>mep mep-id 1 interface gigabitethernet<span>0/1/1</span> inward</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-md-md1-ma-ma1] <strong>mep ccm-send mep-id 1 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-md-md1-ma-ma1] <strong>mep mep-id 1 lck enable level 6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-md-md1-ma-ma1] <strong>remote-mep mep-id 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-md-md1-ma-ma1] <strong>remote-mep ccm-receive mep-id 2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-md-md1-ma-ma1] <strong>eth-test enable mep 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-md-md1-ma-ma1] <strong>commit</strong></pre>
<p>The configuration of PE2 is similar to that of PE1. For details, see the configuration file.</p>
</li></ol>
</p></li><li><span>Configure basic Ethernet CFM functions on CE1.</span><p><p>Specify the Ethernet CFM protocol as IEEE Standard 802.1ag-2007. Create an MD named <strong>md1</strong> and an MA named <strong>ma1</strong>, and bind the MA to the EVPN instance.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>cfm enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>cfm md md1 level 6 </strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-md-md1] <strong>ma ma1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-md-md1-ma-ma1] <strong>map vlan 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-md-md1-ma-ma1] <strong>mep mep-id 1 interface gigabitethernet<span>0/1/1</span> outward</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-md-md1-ma-ma1] <strong>mep ccm-send mep-id 1 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-md-md1-ma-ma1] <strong>remote-mep mep-id 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-md-md1-ma-ma1] <strong>remote-mep ccm-receive mep-id 2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-md-md1-ma-ma1] <strong>commit</strong></pre>
<p>The configuration of CE2 is similar to that of CE1. For details, see the configuration file.</p>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172362200__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>PE1 configuration file</p>
<pre class="screen">#
sysname PE1
#
cfm enable
#
evpn vpn-instance evpna
  route-distinguisher 100:1
  vpn-target 1:1 export-extcommunity
  vpn-target 1:1 import-extcommunity
#
mpls lsr-id 1.1.1.1
#
mpls
#
mpls ldp
#
 ipv4-family
#
interface GigabitEthernet<span>0/1/1</span>
  undo shutdown
  evpn binding vpn-instance evpna
#
interface GigabitEthernet<span>0/1/2</span>
  ip address 10.1.1.1 255.255.255.0
  mpls
  mpls ldp
#
interface LoopBack0
  ip address 1.1.1.1 255.255.255.255
#
bgp 100
  peer 2.2.2.2 as-number 100
  peer 2.2.2.2 connect-interface LoopBack0
#
ipv4-family unicast
   undo synchronization
   peer 2.2.2.2 enable
#
  l2vpn-family evpn
   peer 2.2.2.2 enable
#
ospf 1
  area 0.0.0.0
   network 1.1.1.1 0.0.0.0
   network 10.1.1.0 0.0.0.255
#
evpn source-address 1.1.1.1 
#</pre>
<pre class="screen"> cfm md md1 level 3                     
 ma ma1
  map evpn vpn-instance evpna                                                    
  mep mep-id 1 interface GigabitEthernet<span>0/1/1</span> inward                                    
  mep ccm-send mep-id 1 enable  
  mep mep-id 1 lck enable level 6                                                  
  remote-mep mep-id 2
  remote-mep ccm-receive mep-id 2 enable                                     
  eth-test enable mep 1
#                                                                               
return  </pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#
sysname PE2
#
cfm enable
#
evpn vpn-instance evpna
  route-distinguisher 200:1
  vpn-target 1:1 export-extcommunity
  vpn-target 1:1 import-extcommunity
#
mpls lsr-id 2.2.2.2
#
mpls
#
mpls ldp
#
ipv4-family
#
interface GigabitEthernet<span>0/1/1</span>
 evpn binding vpn-instance evpna
#
interface GigabitEthernet<span>0/1/2</span>
  ip address 10.2.1.1 255.255.255.0
  mpls
  mpls ldp
#
 interface LoopBack0
  ip address 2.2.2.2 255.255.255.255
#
bgp 100
  peer 1.1.1.1 as-number 100
  peer 1.1.1.1 connect-interface LoopBack0
#
ipv4-family unicast
   undo synchronization
   peer 1.1.1.1 enable
#
l2vpn-family evpn
   peer 1.1.1.1 enable
#
ospf 1
  area 0.0.0.0
   network 2.2.2.2 0.0.0.0
   network 10.2.1.0 0.0.0.255
#
evpn source-address 2.2.2.2
#</pre>
<pre class="screen">#
cfm md md1 level 3                     
 ma ma1
  map evpn vpn-instance evpna                                                    
  mep mep-id 2 interface GigabitEthernet<span>0/1/1</span> inward                                    
  mep ccm-send mep-id 2 enable  
  mep mep-id 1 lck enable level 6                                                  
  remote-mep mep-id 1
  remote-mep ccm-receive mep-id 1 enable                                       
  eth-test enable mep 2
#                                                                               
return  </pre>
</li><li><p>CE1 configuration file</p>
<pre class="screen">#
sysname CE1
#
vlan batch 10
#
cfm enable
#
interface GigabitEthernet<span>0/1/1</span>
 portswitch
 port trunk allow-pass vlan 10
#
cfm md md1 level 6                     
 ma ma1
  map vlan 10
  mep mep-id 1 interface GigabitEthernet<span>0/1/1</span> outward                                    
  mep ccm-send mep-id 1 enable  
  remote-mep mep-id 2
  remote-mep ccm-receive mep-id 2 enable                                       
#                                                                               
return  </pre>
</li><li><p>CE2 configuration file</p>
<pre class="screen">#
sysname CE2
#
vlan batch 10
#
cfm enable
#
 interface GigabitEthernet<span>0/1/1</span>
  portswitch
  port trunk allow-pass vlan 10
#
cfm md md1 level 6                     
 ma ma1
  map vlan 10
  mep mep-id 2 interface GigabitEthernet<span>0/1/1</span> outward                                    
  mep ccm-send mep-id 2 enable  
  remote-mep mep-id 1
  remote-mep ccm-receive mep-id 1 enable                                       
#                                                                               
return  </pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_011531.html">Configuration Examples for Y.1731
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_011567.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_11569.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>