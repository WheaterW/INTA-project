
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Bit-Error-Triggered PW Switching">
<meta name="abstract" content="This section provides an example for configuring bit-error-triggered pseudo wire (PW) switching.">
<meta name="description" content="This section provides an example for configuring bit-error-triggered pseudo wire (PW) switching.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_error-code_000010.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_error-code_000017.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_error-code_000019.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00606909,m00390128,q00824768,z00545680">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="Bit-Error-Triggered Protection Switching">
<meta name="featuretype" content="Network Reliability">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="Bit-Error-Triggered Protection Switching">
<meta name="featuretype" content="Network Reliability">
<meta name="featurename" content="Bit-Error-Triggered Protection Switching">
<meta name="featuretype" content="Network Reliability">
<meta name="featurename" content="Bit-Error-Triggered Protection Switching">
<meta name="featuretype" content="Network Reliability">
<meta name="OWNER" content="z00545680">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="z00545680">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172362302">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring Bit-Error-Triggered PW Switching</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172362302"></a><a name="EN-US_TASK_0172362302"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Bit-Error-Triggered PW Switching</h1>
<div class="taskbody"><p>This section provides an example for configuring bit-error-triggered pseudo wire (PW) switching.</p>
<div class="context"><a name="EN-US_TASK_0172362302__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On an IP radio access network (RAN), if a tunnel carries Layer 2 virtual private network (L2VPN) services, you can configure traffic engineering (TE) hot standby and pseudo wire (PW) redundancy to protect services. Bidirectional Forwarding Detection (BFD) for PW and BFD for label switched path (LSP), two commonly used detection mechanisms, can quickly trigger a link switchover after detecting a link fault. However, these detection mechanisms cannot trigger protection switching based on random bit errors caused by optical fiber aging or optical signal jitter. As a result, bit errors may degrade on an IP RAN or even interrupt services in extreme cases.</p>
<p>To resolve this problem, configure bit-error-triggered RSVP-TE tunnel switching and PW switching. If a bit error event occurs, the system first attempts to perform bit-error-triggered RSVP-TE tunnel switching. If the primary and backup constraint-based routed label switched paths (CR-LSPs) of the RSVP-TE tunnel are both in the excessive bit error rate (BER) state, bit-error-triggered RSVP-TE tunnel switching cannot protect services against bit errors. In this situation, the system performs bit-error-triggered PW switching to protect services against bit errors.</p>
<p>On the network shown in <a href="#EN-US_TASK_0172362302__fig_dc_vrp_cfg_error-code_00001801">Figure 1</a>, an RSVP-TE tunnel with TE hot standby protection needs to be deployed between the user-end provider edge (UPE) and SPE1 to carry L2VPN services. PW redundancy needs to be configured for the PW carried over the RSVP-TE tunnel. BFD for PW needs to be configured to achieve quick fault detection. If GE<span>0/1/1</span> on the UPE and GE<span>0/1/1</span> on SPE2 both encounter a bit error event, the primary and backup CR-LSPs of the RSVP-TE tunnel that carries the primary PW both enter the excessive BER state. As a result, bit-error-triggered RSVP-TE tunnel switching cannot protect services against bit errors. To resolve this problem, configure bit-error-triggered PW switching to divert traffic from the link that has encountered the bit error event.</p>
<div class="fignone" id="EN-US_TASK_0172362302__fig_dc_vrp_cfg_error-code_00001801"><a name="EN-US_TASK_0172362302__fig_dc_vrp_cfg_error-code_00001801"></a><a name="fig_dc_vrp_cfg_error-code_00001801"></a><span class="figcap"><b>Figure 1 </b>Networking diagram for bit-error-triggered PW switching</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface0, interface1, and interface2 are GE<span>0/1/0</span>, GE<span>0/1/1</span>, GE<span>0/1/2</span> respectively.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_cfg_error-code_00001801.png"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172362302__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure an IP address and a routing protocol for each interface so that all nodes can communicate at the network layer. This example uses Open Shortest Path First (OSPF) as the routing protocol.</p>
</li><li><p>Configure Multiprotocol Label Switching (MPLS) functions and public network tunnels. This example uses the RSVP-TE tunnels with TE hot standby protection between the UPE and SPEs as public network tunnels.</p>
</li><li><p>Configure the independent PW redundancy mode, which includes:</p>
<ul><li>Configure a remote MPLS LDP session between the UPE and each SPE.</li><li>Configure a PW between the UPE and each SPE.</li><li>Configure static BFD for PW.</li><li>Configure SPE1 and SPE2 to belong to the same VRRP group.</li></ul>
</li><li><p>Configure bit-error-triggered protection switching, which includes:</p>
<ul><li>Enable bit-error-triggered RSVP-TE tunnel switching.</li><li>Enable bit-error-triggered PW switching.</li></ul>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172362302__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>Interface IP addresses (see <a href="#EN-US_TASK_0172362302__fig_dc_vrp_cfg_error-code_00001801">Figure 1</a>)</p>
</li><li><p>Interior Gateway Protocol (IGP) protocol type (OSPF), process ID (100), and area ID (0)</p>
</li><li><p>Label switching router (LSR) IDs of the UPE and SPEs (1.1.1.1, 2.2.2.2, and 3.3.3.3)</p>
</li><li><p>Tunnel interface names (Tunnel11), tunnel IDs (100), and tunnel interface addresses (loopback interface addresses) for the unidirectional tunnels between the UPE and SPE1</p>
</li><li><p>Tunnel interface names (Tunnel12), tunnel IDs (200), and tunnel interface addresses (loopback interface addresses) for the unidirectional tunnels between the UPE and SPE2.</p>
</li><li><p>Names of the tunnel policies (policy1) on the UPE and SPEs</p>
</li><li><p>Virtual circuit (VC) IDs (1 and 2) of the PWs between the UPE and SPEs</p>
</li><li><p>Names of the static BFD sessions (master, pw1, and pw2) on the UPE and SPEs and the local and remote discriminators (2) of these BFD sessions</p>
</li><li><p>ID (20) and virtual IP address (10.1.3.111) of the VRRP group and priority (150) of the master VRRP device</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172362302__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure interface IP addresses.</span><p><p>Assign an IP address to each interface according to <a href="#EN-US_TASK_0172362302__fig_dc_vrp_cfg_error-code_00001801">Figure 1</a> and create a loopback interface on each node. For configuration details, see <a href="#EN-US_TASK_0172362302__section_05">Configuration Files</a> in this section.</p>
</p></li><li><span>Configure OSPF.</span><p><p>Configure OSPF on each node to allow the nodes to communicate at the network layer. For configuration details, see <a href="#EN-US_TASK_0172362302__section_05">Configuration Files</a> in this section.</p>
</p></li><li><span>Configure MPLS functions and public network tunnels.</span><ol type="a"><li class="substepexpand"><span>Enable MPLS, MPLS LDP, MPLS TE, RSVP-TE, and Constraint Shortest Path First (CSPF).</span><p><p># Configure the UPE.</p>
<pre class="screen">&lt;UPE&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>mpls lsr-id 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-mpls] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-mpls] <strong>mpls rsvp-te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-mpls] <strong>mpls te cspf</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/1</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/1</span>] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/1</span>] <strong>mpls rsvp-te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/2</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/2</span>] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/2</span>] <strong>mpls rsvp-te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>ospf 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-ospf-100] <strong>opaque-capability enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-ospf-100] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-ospf-100-area-0.0.0.0] <strong>mpls-te enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-ospf-100-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-ospf-100] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>commit</strong></pre>
<p>Repeat this step for SPE1 and SPE2. For configuration details, see <a href="#EN-US_TASK_0172362302__section_05">Configuration Files</a> in this section.</p>
</p></li><li class="substepexpand"><span>Configure the egress of each unidirectional RSVP-TE tunnel to be created to assign a non-null label to the penultimate hop.</span><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>If you do not enable the egress to assign a non-null label to the penultimate hop before establishing a unidirectional RSVP-TE tunnel, bit-error-triggered RSVP-TE tunnel switching cannot take effect.</p>
</div></div>
<div class="p"># Configure the UPE.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE-mpls] <strong>label advertise non-null</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>commit</strong></pre>
</div>
<div class="p"># Configure SPE1.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE1] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE1-mpls] <strong>label advertise non-null</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>commit</strong></pre>
</div>
<div class="p"># Configure SPE2.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE2] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE2-mpls] <strong>label advertise non-null</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2] <strong>commit</strong></pre>
</div>
</p></li><li class="substepexpand"><span>Configure two unidirectional RSVP-TE tunnels between the UPE and each SPE and configure TE hot standby.</span><p><p># Configure the UPE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>interface Tunnel 11</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-Tunnel11] <strong>ip address unnumbered interface loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-Tunnel11] <strong>tunnel-protocol mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-Tunnel11] <strong>destination 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-Tunnel11] <strong>mpls te tunnel-id 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-Tunnel11] <strong>mpls te backup hot-standby</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-Tunnel11] <strong>mpls te reserved-for-binding</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-Tunnel11] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>interface Tunnel 12</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-Tunnel12] <strong>ip address unnumbered interface loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-Tunnel12] <strong>tunnel-protocol mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-Tunnel12] <strong>destination 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-Tunnel12] <strong>mpls te tunnel-id 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-Tunnel12] <strong>mpls te backup hot-standby</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-Tunnel12] <strong>mpls te reserved-for-binding</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-Tunnel12] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>commit</strong></pre>
<p># Configure SPE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE1] <strong>interface Tunnel 11</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-Tunnel11] <strong>ip address unnumbered interface loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-Tunnel11] <strong>tunnel-protocol mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-Tunnel11] <strong>destination 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-Tunnel11] <strong>mpls te tunnel-id 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-Tunnel11] <strong>mpls te backup hot-standby</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-Tunnel11] <strong>mpls te reserved-for-binding</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-Tunnel11] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>commit</strong></pre>
<p># Configure SPE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE2] <strong>interface Tunnel 12</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-Tunnel12] <strong>ip address unnumbered interface loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-Tunnel12] <strong>tunnel-protocol mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-Tunnel12] <strong>destination 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-Tunnel12] <strong>mpls te tunnel-id 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-Tunnel12] <strong>mpls te backup hot-standby</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-Tunnel12] <strong>mpls te reserved-for-binding</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-Tunnel12] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2] <strong>commit</strong></pre>
</p></li><li class="substepexpand"><span>Configure tunnel policies.</span><p><p># Configure the UPE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>tunnel-policy policy1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-tunnel-policy-policy1] <strong>tunnel binding destination 2.2.2.2 te Tunnel 11</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-tunnel-policy-policy1] <strong>tunnel binding destination 3.3.3.3 te Tunnel 12</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-tunnel-policy-policy1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>commit</strong></pre>
<p># Configure SPE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE1] <strong>tunnel-policy policy1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-tunnel-policy-policy1] <strong>tunnel binding destination 1.1.1.1 te Tunnel 11</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-tunnel-policy-policy1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>commit</strong></pre>
<p># Configure SPE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE2] <strong>tunnel-policy policy1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-tunnel-policy-policy1] <strong>tunnel binding destination 1.1.1.1 te Tunnel 12</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-tunnel-policy-policy1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2] <strong>commit</strong></pre>
</p></li></ol>
</li><li><span>Configure PWs.</span><ol type="a"><li class="substepexpand"><span>Configure a remote MPLS LDP session between the UPE and each SPE.</span><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Pseudo wire emulation edge-to-edge (PWE3) uses extended LDP signaling to distribute VC labels. Because the UPE and SPEs communicate over RSVP-TE tunnels without using MPLS LDP, you must globally enable MPLS LDP on the UPE and SPEs and establish remote MPLS LDP sessions between them.</p>
</div></div>
<p># Configure the UPE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>mpls ldp remote-peer 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-mpls-ldp-remote-2.2.2.2] <strong>remote-ip 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-mpls-ldp-remote-2.2.2.2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>mpls ldp remote-peer 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-mpls-ldp-remote-3.3.3.3] <strong>remote-ip 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-mpls-ldp-remote-3.3.3.3] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>commit</strong></pre>
<p># Configure SPE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE1] <strong>mpls ldp remote-peer 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-mpls-ldp-remote-1.1.1.1] <strong>remote-ip 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-mpls-ldp-remote-1.1.1.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>commit</strong></pre>
<p># Configure SPE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE2] <strong>mpls ldp remote-peer 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-mpls-ldp-remote-1.1.1.1] <strong>remote-ip 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-mpls-ldp-remote-1.1.1.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2] <strong>commit</strong></pre>
</p></li><li class="substepexpand"><span>Configure PWs.</span><p><p># Configure the UPE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/0</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>interface gigabitethernet <span>0/1/0</span>.10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/0</span>.10] <strong>vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/0</span>.10] <strong>mpls l2vc 2.2.2.2 1 tunnel-policy policy1 control-word</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/0</span>.10] <strong>mpls l2vc 3.3.3.3 2 tunnel-policy policy1 control-word</strong><strong> secondary</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/0</span>.10] <strong>mpls l2vpn redundancy independent</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/0</span>.10] <strong>mpls l2vpn stream-dual-receiving</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/0</span>.10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>commit</strong></pre>
<p># Configure SPE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE1] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>interface virtual-ethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-Virtual-Ethernet<span>0/1/2</span>] <strong>ve-group 1 l2-terminate</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-Virtual-Ethernet<span>0/1/2</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>interface virtual-ethernet <span>0/1/2</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-Virtual-Ethernet<span>0/1/2</span>.1] <strong>vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-Virtual-Ethernet<span>0/1/2</span>.1] <strong>mpls l2vc 1.1.1.1 1 tunnel-policy policy1 control-word</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-Virtual-Ethernet<span>0/1/2</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>commit</strong></pre>
<p># Configure SPE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE2] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2] <strong>interface virtual-ethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-Virtual-Ethernet<span>0/1/1</span>] <strong>ve-group 1 l2-terminate</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-Virtual-Ethernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2] <strong>interface virtual-ethernet <span>0/1/1</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-Virtual-Ethernet<span>0/1/1</span>.1] <strong>vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-Virtual-Ethernet<span>0/1/1</span>.1] <strong>mpls l2vc 1.1.1.1 2 tunnel-policy policy1 control-word</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-Virtual-Ethernet<span>0/1/1</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2] <strong>commit</strong></pre>
</p></li><li class="substepexpand"><span>Configure static BFD for PW.</span><p><p># Configure the UPE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>bfd</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-bfd] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>bfd master bind pw interface GigabitEthernet<span>0/1/0</span>.10 remote-peer 2.2.2.2 pw-ttl auto-calculate</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-bfd-lsp-session-master] <strong>discriminator local 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-bfd-lsp-session-master] <strong>discriminator remote 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-bfd-lsp-session-master] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>commit</strong></pre>
<p># Configure SPE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE1] <strong>bfd</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-bfd] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>bfd pw1 bind pw interface virtual-ethernet<span>0/1/2</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-bfd-lsp-session-pw1] <strong>discriminator local 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-bfd-lsp-session-pw1] <strong>discriminator remote 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-bfd-lsp-session-pw1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>commit</strong></pre>
<p># Configure SPE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE2] <strong>bfd</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-bfd] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2] <strong>bfd pw2 bind pw interface virtual-ethernet<span>0/1/1</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-bfd-lsp-session-pw2] <strong>discriminator local 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-bfd-lsp-session-pw2] <strong>discriminator remote 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-bfd-lsp-session-pw2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2] <strong>commit</strong></pre>
</p></li></ol>
</li><li><span>Configure VRRP-based active/standby status negotiation for PWs.</span><p><p># Configure SPE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE1] <strong>interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE1-GigabitEthernet<span>0/1/2</span>] <strong>vrrp vrid 20 virtual-ip 10.1.3.111</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-GigabitEthernet<span>0/1/2</span>] <strong>admin-vrrp vrid 20 ignore-if-down</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-GigabitEthernet<span>0/1/2</span>] <strong>vrrp vrid 20 priority 150</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>interface virtual-ethernet <span>0/1/2</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-Virtual-Ethernet<span>0/1/2</span>.1] <strong>mpls l2vc track admin-vrrp interface GigabitEthernet<span>0/1/2</span> vrid 20 pw-redundancy</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-Virtual-Ethernet<span>0/1/2</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>commit</strong></pre>
<p># Configure SPE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE2] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE2-GigabitEthernet<span>0/1/1</span>] <strong>vrrp vrid 20 virtual-ip 10.1.3.111</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-GigabitEthernet<span>0/1/1</span>] <strong>admin-vrrp vrid 20 ignore-if-down</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2] <strong>interface virtual-ethernet <span>0/1/1</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-Virtual-Ethernet<span>0/1/1</span>.1] <strong>mpls l2vc track admin-vrrp interface GigabitEthernet<span>0/1/1</span> vrid 20 pw-redundancy</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-Virtual-Ethernet<span>0/1/1</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2] <strong>commit</strong></pre>
<p># Run the <a href="cmdqueryname=display+mpls+l2vc"><b><span class="cmdname">display mpls l2vc</span></b></a> command on the UPE to check the status of the primary and secondary PWs. The command output shows that the primary PW is in the Active state.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>display mpls l2vc</strong></pre>
<pre class="screen"> total LDP VC : 2     2 up       0 down

 *client interface     : GigabitEthernet<span>0/1/0</span>.10 is up
  Administrator PW     : no 
  session state        : up
  AC status            : up
  VC state             : up
  Label state          : 0
  Token state          : 0
  VC ID                : 1
  VC type              : VLAN
  <strong>destination          : 2.2.2.2</strong>
  local VC label       : 4212         remote VC label      : 4181
  control word         : enable
<span>  remote control word    : disable</span>
  forwarding entry     : exist
  local group ID       : 0
<span>  remote group ID        : 0
  local AC OAM State     : up
  local PSN OAM State    : up
  local forwarding state : forwarding
  local status code      : 0x0
  remote AC OAM state    : up
  remote PSN OAM state   : up
  remote forwarding state: forwarding
  remote status code     : 0x0
  ignore standby state   : no
  BFD for PW             : unavailable
  VCCV State             : up</span>
  manual fault         : not set
  <strong>active state         : active</strong>
  OAM Protocol         : --
  OAM Status           : --
  OAM Fault Type       : --
  PW APS ID            : --
  PW APS Status        : --
  TTL Value            : 1
  link state           : up
  local VC MTU         : 1500         remote VC MTU        : 1500
<span>  local VCCV             : alert ttl lsp-ping bfd
  remote VCCV            : alert ttl lsp-ping bfd</span>
  tunnel policy name   : policy1 
  PW template name     : --  
  <strong>primary or secondary : primary</strong>
  load balance type    : flow
  Access-port          : false
<span>  Switchover Flag        : false
  VC tunnel info         : 1 tunnels
    NO.0  TNL type       : ldp   , TNL ID : 0x0000000001004c4e42</span>
  create time          : 1 days, 8 hours, 8 minutes, 23 seconds
  up time              : 0 days, 9 hours, 15 minutes, 50 seconds
  last change time     : 0 days, 9 hours, 15 minutes, 50 seconds
  VC last up time      : 2013/01/29 04:29:14
  VC total up time     : 0 days, 9 hours, 15 minutes, 50 seconds
  CKey                 : 1
  NKey                 : 2415919356
<span>  PW redundancy mode     : independent</span>
  AdminPw interface    : --
  AdminPw link state   : --
<span>  Forward state        : send inactive, receive inactive </span>
  Diffserv Mode        : uniform
  Service Class        : --
  Color                : --
  DomainId             : --
  Domain Name          : --

 *client interface     : GigabitEthernet<span>0/1/0</span>.10 is up
  Administrator PW     : no 
  session state        : up
  AC status            : up
  VC state             : up
  Label state          : 0
  Token state          : 0
  VC ID                : 2
  VC type              : VLAN
  destination          : 3.3.3.3
  local VC label       : 4213         remote VC label      : 4177
  control word         : enable
<span>  remote control word    : disable</span>
  forwarding entry     : exist
  local group ID       : 0
<span>  remote group ID        : 0
  local AC OAM State     : up
  local PSN OAM State    : up
  local forwarding state : forwarding
  local status code      : 0x0
  remote AC OAM state    : up
  remote PSN OAM state   : up
  remote forwarding state: forwarding
  remote status code     : 0x0
  ignore standby state   : no
  BFD for PW             : unavailable
  VCCV State             : up</span>
  manual fault         : not set
  <strong>active state         : inactive</strong>
  OAM Protocol         : --
  OAM Status           : --
  OAM Fault Type       : --
  PW APS ID            : --
  PW APS Status        : --
  TTL Value            : 1
  link state           : up
  local VC MTU         : 1500         remote VC MTU        : 1500
<span>  local VCCV             : alert ttl lsp-ping bfd
  remote VCCV            : alert ttl lsp-ping bfd</span>
  tunnel policy name   : policy1 
  PW template name     : --  
  <strong>primary or secondary : secondary</strong>
  load balance type    : flow
  Access-port          : false
<span>  Switchover Flag        : false
  VC tunnel info         : 1 tunnels
    NO.0  TNL type       : ldp   , TNL ID : 0x0000000001004c4e43</span>
  create time          : 1 days, 8 hours, 8 minutes, 23 seconds
  up time              : 0 days, 9 hours, 14 minutes, 52 seconds
  last change time     : 0 days, 9 hours, 14 minutes, 52 seconds
  VC last up time      : 2013/01/29 04:29:55
  VC total up time     : 1 days, 6 hours, 38 minutes, 42 seconds
  CKey                 : 2
  NKey                 : 2415919357
<span>  PW redundancy mode     : independent</span>
  AdminPw interface    : --
  AdminPw link state   : --
<span>  Forward state        : send inactive, receive inactive </span>
  Diffserv Mode        : uniform
  Service Class        : --
  Color                : --
  DomainId             : --
  Domain Name          : --</pre>
</p></li><li><span>Configure bit-error-triggered protection switching.</span><ol type="a"><li class="substepexpand"><span>Enable bit-error-triggered RSVP-TE tunnel switching for the current unidirectional RSVP-TE tunnel and specify its reverse tunnel.</span><p><p># Configure the UPE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE]<strong> interface Tunnel 11</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE-Tunnel11]<strong> mpls te bit-error-detection</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-Tunnel11]<strong> mpls te reverse-lsp protocol rsvp-te ingress-lsr-id 2.2.2.2 tunnel-id 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-Tunnel11]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE]<strong> interface Tunnel 12</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-Tunnel12]<strong> mpls te bit-error-detection</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-Tunnel12]<strong> mpls te reverse-lsp protocol rsvp-te ingress-lsr-id 3.3.3.3 tunnel-id 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-Tunnel12]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>commit</strong></pre>
<p># Configure SPE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE1]<strong> interface Tunnel 11</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE1-Tunnel11]<strong> mpls te bit-error-detection</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-Tunnel11]<strong> mpls te reverse-lsp protocol rsvp-te ingress-lsr-id 1.1.1.1 tunnel-id 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-Tunnel11]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>commit</strong></pre>
<p># Configure SPE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE2]<strong> interface Tunnel 12</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE2-Tunnel12]<strong> mpls te bit-error-detection</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-Tunnel12]<strong> mpls te reverse-lsp protocol rsvp-te ingress-lsr-id 1.1.1.1 tunnel-id 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-Tunnel12]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2] <strong>commit</strong></pre>
</p></li><li class="substepexpand"><span>Configure bit-error-triggered PW switching.</span><p><p># Enable bit error detection on the attachment circuit (AC) interface of the UPE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>interface gigabitethernet <span>0/1/0</span>.10</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE-GigabitEthernet<span>0/1/0</span>.10] <strong>mpls l2vpn pw bit-error-detection</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/0</span>.10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>commit</strong></pre>
<p># Enable bit error detection on the AC interface of SPE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE1] <strong>interface virtual-ethernet <span>0/1/2</span>.1</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE1-Virtual-Ethernet<span>0/1/2</span>.1] <strong>mpls l2vpn pw bit-error-detection</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-Virtual-Ethernet<span>0/1/2</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>commit</strong></pre>
<p># Enable bit error detection on the AC interface of SPE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE2] <strong>interface virtual-ethernet <span>0/1/1</span>.1</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE2-Virtual-Ethernet<span>0/1/1</span>.1] <strong>mpls l2vpn pw bit-error-detection</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-Virtual-Ethernet<span>0/1/1</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2] <strong>commit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>This example shows how to configure bit-error-triggered PW switching for single-segment PWs (SS-PWs). To configure bit-error-triggered PW switching for multi-segment PWs (MS-PWs), you must also run the <a href="cmdqueryname=mpls+switch-l2vc"><b><span class="cmdname">mpls switch-l2vc</span></b></a> <i><span class="varname">ip-address</span></i> <i><span class="varname">vc-id</span></i> <strong><span>between</span></strong> <i><span class="varname">ip-address</span></i> <i><span class="varname">vc-id</span></i> <strong><span>encapsulation</span></strong> <i><span class="varname">encapsulation-type</span></i> <strong><span>bit-error-detection</span></strong> command to enable bit error detection on SPEs.</p>
</div></div>
</p></li></ol>
</li><li><span>Verify the configuration.</span><p><p># Run the <a href="cmdqueryname=display+bfd+bit-error-detection+session+all"><b><span class="cmdname">display bfd bit-error-detection session all</span></b></a> command. The command output shows bit error detection session information.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>display bfd bit-error-detection session all</strong></pre>
<pre class="screen">--------------------------------------------------------------------------------
BFD Bit Error Information:
--------------------------------------------------------------------------------
Session Type            : PE
FSM Board Id            : 9 
Fault Type              : -
Min Tx Interval (ms)    : 1000
Max Tx Interval (ms)    : 30000
Actual Tx Interval (ms) : 30000
Detect Multi            : 3
Source IP Address       : 1.1.1.1
Destination IP Address  : 127.0.0.1
Destination Port        : 3784
TOS-EXP                 : 7
--------------------------------------------------------------------------------
LSP Information:
--------------------------------------------------------------------------------
Ingress LSR ID          : 1.1.1.1
Tunnel ID               : 100         
LSP ID                  : 33
Tunnel-Interface        : Tunnel11
In-Interface            : GigabitEthernet<span>0/1/1</span>
Out-Interface           : GigabitEthernet<span>0/1/1</span>
LSP token               : 0x202
LSP Type                : Primary
--------------------------------------------------------------------------------
                
--------------------------------------------------------------------------------
BFD Bit Error Information:
--------------------------------------------------------------------------------
Session Type            : PE
FSM Board Id            : 9 
Fault Type              : -
Min Tx Interval (ms)    : 1000
Max Tx Interval (ms)    : 30000
Actual Tx Interval (ms) : 30000
Detect Multi            : 3
Source IP Address       : 1.1.1.1
Destination IP Address  : 127.0.0.1
Destination Port        : 3784
TOS-EXP                 : 7
--------------------------------------------------------------------------------
LSP Information:
--------------------------------------------------------------------------------
Ingress LSR ID          : 1.1.1.1
Tunnel ID               : 200         
LSP ID                  : 35
Tunnel-Interface        : Tunnel12
In-Interface            : GigabitEthernet<span>0/1/2</span>
Out-Interface           : GigabitEthernet<span>0/1/2</span>
LSP token               : 0x204
LSP Type                : Primary
--------------------------------------------------------------------------------
                
--------------------------------------------------------------------------------
BFD Bit Error Information:
--------------------------------------------------------------------------------
Session Type            : PE
FSM Board Id            : 9 
Fault Type              : -
Min Tx Interval (ms)    : 1000
Max Tx Interval (ms)    : 30000
Actual Tx Interval (ms) : 30000
Detect Multi            : 3
Source IP Address       : 1.1.1.1
Destination IP Address  : 127.0.0.1
Destination Port        : 3784
TOS-EXP                 : 7
--------------------------------------------------------------------------------
LSP Information:
--------------------------------------------------------------------------------
Ingress LSR ID          : 1.1.1.1
Tunnel ID               : 100         
LSP ID                  : 37
Tunnel-Interface        : Tunnel11
In-Interface            : GigabitEthernet<span>0/1/2</span>
Out-Interface           : GigabitEthernet<span>0/1/2</span>
LSP token               : 0x282
LSP Type                : Backup
--------------------------------------------------------------------------------
                
--------------------------------------------------------------------------------
BFD Bit Error Information:
--------------------------------------------------------------------------------
Session Type            : PE
FSM Board Id            : 9 
Fault Type              : -
Min Tx Interval (ms)    : 1000
Max Tx Interval (ms)    : 30000
Actual Tx Interval (ms) : 30000
Detect Multi            : 3
Source IP Address       : 1.1.1.1
Destination IP Address  : 127.0.0.1
Destination Port        : 3784
TOS-EXP                 : 7
--------------------------------------------------------------------------------
LSP Information:
--------------------------------------------------------------------------------
Ingress LSR ID          : 1.1.1.1
Tunnel ID               : 200         
LSP ID                  : 38
Tunnel-Interface        : Tunnel12
In-Interface            : GigabitEthernet<span>0/1/1</span>
Out-Interface           : GigabitEthernet<span>0/1/1</span>
LSP token               : 0x283
LSP Type                : Backup
--------------------------------------------------------------------------------
                
     Total Session Number : 4</pre>
<p>In this example, the BERs detected by GE<span>0/1/1</span> on the UPE and GE<span>0/1/1</span> on SPE2 exceeding the threshold for triggering an alarm indicating that a bit error event has occurred. As a result, the two GE interfaces reported a bit error event alarm. Consequently, the primary and backup CR-LSPs of the RSVP-TE tunnel are both in the excessive BER state, and bit-error-triggered RSVP-TE tunnel switching cannot protect services against bit errors. In this situation, the system performs bit-error-triggered PW switching to switch traffic from the primary PW to the secondary PW.</p>
<p># Run the <a href="cmdqueryname=display+mpls+l2vc"><b><span class="cmdname">display mpls l2vc</span></b></a> command on the UPE to check the status of the primary and secondary PWs. The command output shows that the secondary PW enters the Active state.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>display mpls l2vc</strong></pre>
<pre class="screen"> total LDP VC : 2     2 up       0 down

 *client interface     : GigabitEthernet<span>0/1/0</span>.10 is up
  Administrator PW     : no 
  session state        : up
  AC status            : up
  VC state             : up
  Label state          : 0
  Token state          : 0
  VC ID                : 1
  VC type              : VLAN
  destination          : 2.2.2.2
  local VC label       : 4212         remote VC label      : 4181
  control word         : enable
<span>  remote control word    : disable</span>
  forwarding entry     : exist
  local group ID       : 0
<span>  remote group ID        : 0
  local AC OAM State     : up
  local PSN OAM State    : up
  local forwarding state : forwarding
  local status code      : 0x0
  remote AC OAM state    : up
  remote PSN OAM state   : up
  remote forwarding state: forwarding
  remote status code     : 0x0
  ignore standby state   : no
  BFD for PW             : unavailable
  VCCV State             : up</span>
  manual fault         : not set
  <strong>active state         : inactive</strong>
  OAM Protocol         : --
  OAM Status           : --
  OAM Fault Type       : --
  PW APS ID            : --
  PW APS Status        : --
  TTL Value            : 1
  link state           : up
  local VC MTU         : 1500         remote VC MTU        : 1500
<span>  local VCCV             : alert ttl lsp-ping bfd
  remote VCCV            : alert ttl lsp-ping bfd</span>
  tunnel policy name   : policy1 
  PW template name     : --  
  <strong>primary or secondary : primary</strong>
  load balance type    : flow
  Access-port          : false
<span>  Switchover Flag        : true
  VC tunnel info         : 1 tunnels
    NO.0  TNL type       : ldp   , TNL ID : 0x0000000001004c4e42</span>
  create time          : 1 days, 8 hours, 32 minutes, 54 seconds
  up time              : 0 days, 9 hours, 40 minutes, 21 seconds
  last change time     : 0 days, 9 hours, 40 minutes, 21 seconds
  VC last up time      : 2013/01/29 04:29:14
  VC total up time     : 0 days, 9 hours, 40 minutes, 21 seconds
  CKey                 : 1
  NKey                 : 2415919356
<span>  PW redundancy mode     : independent</span>
  AdminPw interface    : --
  AdminPw link state   : --
<span>  Forward state        : send inactive, receive inactive </span>
  Diffserv Mode        : uniform
  Service Class        : --
  Color                : --
  DomainId             : --
  Domain Name          : --

 *client interface     : GigabitEthernet<span>0/1/0</span>.10 is up
  Administrator PW     : no 
  session state        : up
  AC status            : up
  VC state             : up
  Label state          : 0
  Token state          : 0
  VC ID                : 2
  VC type              : VLAN
  destination          : 3.3.3.3
  local VC label       : 4213         remote VC label      : 4177
  control word         : enable
<span>  remote control word    : disable</span>
  forwarding entry     : exist
  local group ID       : 0
<span>  remote group ID        : 0
  local AC OAM State     : up
  local PSN OAM State    : up
  local forwarding state : forwarding
  local status code      : 0x0
  remote AC OAM state    : up
  remote PSN OAM state   : up
  remote forwarding state: forwarding
  remote status code     : 0x0
  ignore standby state   : no
  BFD for PW             : unavailable
  VCCV State             : up</span>
  manual fault         : not set
  <strong>active state         : active</strong>
  OAM Protocol         : --
  OAM Status           : --
  OAM Fault Type       : --
  PW APS ID            : --
  PW APS Status        : --
  TTL Value            : 1
  link state           : up
  local VC MTU         : 1500         remote VC MTU        : 1500
<span>  local VCCV             : alert ttl lsp-ping bfd
  remote VCCV            : alert ttl lsp-ping bfd</span>
  tunnel policy name   : policy1 
  PW template name     : --  
  <strong>primary or secondary : secondary</strong>
  load balance type    : flow
  Access-port          : false
<span>  Switchover Flag        : true
  VC tunnel info         : 1 tunnels
    NO.0  TNL type       : ldp   , TNL ID : 0x0000000001004c4e43</span>
  create time          : 1 days, 8 hours, 32 minutes, 54 seconds
  up time              : 0 days, 9 hours, 39 minutes, 23 seconds
  last change time     : 0 days, 9 hours, 39 minutes, 23 seconds
  VC last up time      : 2013/01/29 04:29:55
  VC total up time     : 1 days, 7 hours, 3 minutes, 13 seconds
  CKey                 : 2
  NKey                 : 2415919357
<span>  PW redundancy mode     : independent</span>
  AdminPw interface    : --
  AdminPw link state   : --
<span>  Forward state        : send inactive, receive inactive </span>
  Diffserv Mode        : uniform
  Service Class        : --
  Color                : --
  DomainId             : --
  Domain Name          : --</pre>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0172362302__section_05"><a name="EN-US_TASK_0172362302__section_05"></a><a name="section_05"></a><a name="EN-US_TASK_0172362302__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>UPE configuration file</p>
<pre class="screen">#                                                                               
sysname UPE                                                                     
#                                                                               
bfd                                                                             
#
mpls lsr-id 1.1.1.1
#                                                                               
mpls
 label advertise non-null
 mpls te
 mpls rsvp-te
 mpls te cspf
#                                                                               
mpls l2vpn                                                                      
#                                                                               
mpls ldp
 #
 ipv4-family
#                                                                               
mpls ldp remote-peer 2.2.2.2                                                    
 remote-ip 2.2.2.2                                                              
#                                                                               
mpls ldp remote-peer 3.3.3.3                                                    
 remote-ip 3.3.3.3                                                              
#                                                                               
interface GigabitEthernet<span>0/1/0</span>                                                  
 undo shutdown                                                                  
#                                                                               
interface GigabitEthernet<span>0/1/0</span>.10                                               
 vlan-type dot1q 10
 mpls l2vc 2.2.2.2 1 tunnel-policy policy1 control-word
 mpls l2vc 3.3.3.3 2 tunnel-policy policy1 control-word secondary
 mpls l2vpn pw bit-error-detection
 mpls l2vpn redundancy independent
 mpls l2vpn stream-dual-receiving                                              
#                                                                               
interface GigabitEthernet<span>0/1/1</span>                                                  
 undo shutdown                                                                  
 ip address 10.1.1.1 255.255.255.0                                             
 mpls                                                                           
 mpls te                                                                        
 mpls rsvp-te
                                                                    
#                                                                               
interface GigabitEthernet<span>0/1/2</span>                                                  
 undo shutdown                                                                  
 ip address 10.1.2.1 255.255.255.0                                             
 mpls                                                                           
 mpls te                                                                        
 mpls rsvp-te
                                                                    
#                                                                               
interface LoopBack0                                                             
 ip address 1.1.1.1 255.255.255.255                                             
#                                                                               
interface Tunnel11                                                           
 ip address unnumbered interface LoopBack0
 tunnel-protocol mpls te
 destination 2.2.2.2
 mpls te record-route
 mpls te backup hot-standby 
 mpls te reserved-for-binding
 mpls te bit-error-detection
 mpls te reverse-lsp protocol rsvp-te ingress-lsr-id 2.2.2.2 tunnel-id 100
 mpls te tunnel-id 100                                                                 
#                                                                               
interface Tunnel12                                                           
 ip address unnumbered interface LoopBack0
 tunnel-protocol mpls te
 destination 3.3.3.3
 mpls te record-route
 mpls te backup hot-standby 
 mpls te reserved-for-binding
 mpls te bit-error-detection
 mpls te reverse-lsp protocol rsvp-te ingress-lsr-id 3.3.3.3 tunnel-id 200
 mpls te tunnel-id 200                                                                
#                                                                               
ospf 100                                                                        
 opaque-capability enable                                                       
 area 0.0.0.0                                                                   
  network 1.1.1.1 0.0.0.0                                                       
  network 10.1.1.0 0.0.0.255                                                   
  network 10.1.2.0 0.0.0.255                                                   
  mpls-te enable                                                                
#                                                                               
tunnel-policy policy1                                                           
 tunnel binding destination 2.2.2.2 te Tunnel11                              
 tunnel binding destination 3.3.3.3 te Tunnel12                              
#                                                                               
bfd master bind pw interface GigabitEthernet<span>0/1/0</span>.10 remote-peer 2.2.2.2 pw-ttl auto-calculate
 discriminator local 2
 discriminator remote 2
#                                                                           
return</pre>
</li><li><p>SPE1 configuration file</p>
<pre class="screen">#                                                                               
sysname SPE1                                                                    
#                                                                               
bfd                                                                             
#                                                                               
mpls lsr-id 2.2.2.2
#
mpls
 label advertise non-null
 mpls te
 mpls rsvp-te
 mpls te cspf
#                                                                               
mpls l2vpn                                                                      
#                                                                               
mpls ldp
 #
 ipv4-family
#                                                                               
mpls ldp remote-peer 1.1.1.1                                                    
 remote-ip 1.1.1.1                                                              
#                                                                               
interface GigabitEthernet<span>0/1/1</span>                                                  
 undo shutdown  
 ip address 10.1.1.2 255.255.255.0
 mpls           
 mpls te        
 mpls rsvp-te
    
#                                                                               
interface GigabitEthernet<span>0/1/2</span>                                                  
 undo shutdown  
 ip address 10.1.3.1 255.255.255.0
 vrrp vrid 20 virtual-ip 10.1.3.111
 admin-vrrp vrid 20 ignore-if-down
 vrrp vrid 20 priority 150
 mpls           
 mpls te        
 mpls rsvp-te
    
#                                                                               
interface LoopBack0                                                             
 ip address 2.2.2.2 255.255.255.255                                             
#                                                                               
interface Virtual-Ethernet<span>0/1/2</span>
 ve-group 1 l2-terminate
#               
interface Virtual-Ethernet<span>0/1/2</span>.1
 vlan-type dot1q 10
 mpls l2vc 1.1.1.1 1 tunnel-policy policy1 control-word
 mpls l2vc track admin-vrrp interface GigabitEthernet<span>0/1/2</span> vrid 20 pw-redundancy
 mpls l2vpn pw bit-error-detection
#
interface Tunnel11                                                           
 ip address unnumbered interface LoopBack0
 tunnel-protocol mpls te
 destination 1.1.1.1
 mpls te record-route
 mpls te backup hot-standby 
 mpls te reserved-for-binding
 mpls te bit-error-detection
 mpls te reverse-lsp protocol rsvp-te ingress-lsr-id 1.1.1.1 tunnel-id 100
 mpls te tunnel-id 100
#                                                                               
bfd hello bind peer-ip 3.3.3.3 source-ip 2.2.2.2                                
 discriminator local 1005                                                       
 discriminator remote 1006                                                      
 commit                                                                         
#                                                                               
ospf 100                                                                        
 opaque-capability enable                                                       
 graceful-restart                                                               
 area 0.0.0.0                                                                   
  network 2.2.2.2 0.0.0.0                                                       
  network 10.1.1.0 0.0.0.255                                                   
  network 10.1.3.0 0.0.0.255                                                   
  mpls-te enable                                                                
#                                                                               
tunnel-policy policy1                                                           
 tunnel binding destination 1.1.1.1 te Tunnel11                              
#                                                                               
bfd pw1 bind pw interface Virtual-Ethernet<span>0/1/2</span>.1
 discriminator local 2
 discriminator remote 2                                                                        
#                                                                               
return</pre>
</li><li><p>SPE2 configuration file</p>
<pre class="screen">#                                                                               
sysname SPE2                                                                    
#                                                                               
bfd                                                                             
#                                                                               
mpls lsr-id 3.3.3.3
#
mpls
 label advertise non-null
 mpls te
 mpls rsvp-te
 mpls te cspf
#                                                                               
mpls l2vpn                                                                      
#                                                                               
mpls ldp
 #
 ipv4-family
#                                                                               
mpls ldp remote-peer 1.1.1.1                                                    
 remote-ip 1.1.1.1                                                              
#                                                                               
interface GigabitEthernet<span>0/1/1</span>                                                  
 undo shutdown  
 ip address 10.1.3.2 255.255.255.0
 vrrp vrid 20 virtual-ip 10.1.3.111
 admin-vrrp vrid 20 ignore-if-down
 mpls           
 mpls te        
 mpls rsvp-te
    
#                                                                               
interface GigabitEthernet<span>0/1/2</span>                                                  
 undo shutdown  
 ip address 10.1.2.2 255.255.255.0
 mpls           
 mpls te        
 mpls rsvp-te
    
#                                                                               
interface LoopBack0                                                             
 ip address 2.2.2.2 255.255.255.255                                             
#                                                                               
interface Virtual-Ethernet<span>0/1/1</span>
 ve-group 1 l2-terminate
#               
interface Virtual-Ethernet<span>0/1/1</span>.1
 vlan-type dot1q 10
 mpls l2vc 1.1.1.1 2 tunnel-policy policy1 control-word
 mpls l2vc track admin-vrrp interface GigabitEthernet<span>0/1/1</span> vrid 20 pw-redundancy
 mpls l2vpn pw bit-error-detection
#
interface Tunnel12                                                           
 ip address unnumbered interface LoopBack0
 tunnel-protocol mpls te
 destination 1.1.1.1
 mpls te record-route
 mpls te backup hot-standby 
 mpls te reserved-for-binding
 mpls te bit-error-detection
 mpls te reverse-lsp protocol rsvp-te ingress-lsr-id 1.1.1.1 tunnel-id 200
 mpls te tunnel-id 200
#                                                                               
ospf 100        
 opaque-capability enable
 area 0.0.0.0   
  network 3.3.3.3 0.0.0.0
  network 10.1.2.0 0.0.0.255
  network 10.1.3.0 0.0.0.255
  mpls-te enable
#                                                                               
tunnel-policy policy1                                                           
 tunnel binding destination 1.1.1.1 te Tunnel12                              
#                                                                               
bfd pw2 bind pw interface Virtual-Ethernet<span>0/1/1</span>.1
 discriminator local 2
 discriminator remote 2
#                                                                               
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_error-code_000010.html">Configuration Examples for Bit-Error-Triggered Protection Switching
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_error-code_000017.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_error-code_000019.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>