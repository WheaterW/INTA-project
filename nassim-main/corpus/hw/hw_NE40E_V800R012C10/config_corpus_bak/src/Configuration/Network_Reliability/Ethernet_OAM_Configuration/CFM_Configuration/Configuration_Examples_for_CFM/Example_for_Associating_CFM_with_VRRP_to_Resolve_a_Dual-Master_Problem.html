
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Associating CFM with VRRP to Resolve a Dual-Master Problem">
<meta name="abstract" content="This section provides an example for associating connectivity fault management (CFM) with Virtual Router Redundancy Protocol (VRRP) to resolve a dual-master problem.">
<meta name="description" content="This section provides an example for associating connectivity fault management (CFM) with Virtual Router Redundancy Protocol (VRRP) to resolve a dual-master problem.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfm_cfg_000021.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfm_cfg_000025.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfm_cfg_000032.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="z50024784,c00376497,z00603461,w00800033,jwx1168690,w00556928,w00437000,eoam-vrp,w00606909,m00390128,l00455378,wwx1270540">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="Ethernet OAM">
<meta name="featuretype" content="Network Reliability">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="Ethernet OAM">
<meta name="featuretype" content="Network Reliability">
<meta name="featurename" content="Ethernet OAM">
<meta name="featuretype" content="Network Reliability">
<meta name="featurename" content="Ethernet OAM">
<meta name="featuretype" content="Network Reliability">
<meta name="featurename" content="Ethernet OAM">
<meta name="featuretype" content="Network Reliability">
<meta name="OWNER" content="z00545680">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="z00545680">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172361980">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Associating CFM with VRRP to Resolve a Dual-Master Problem</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172361980"></a><a name="EN-US_TASK_0172361980"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Associating CFM with VRRP to Resolve a Dual-Master Problem</h1>
<div class="taskbody"><p>This section provides an example for associating connectivity fault management (CFM) with Virtual Router Redundancy Protocol (VRRP) to resolve a dual-master problem.</p>
<div class="context"><a name="EN-US_TASK_0172361980__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>Generally, network administrators deploy various detection protocols to improve service reliability. As shown in <a href="#EN-US_TASK_0172361980__fig_dc_vrp_cfm_cfg_00002601">Figure 1</a>, VRRP is deployed on each network provider edge (NPE) to provide gateway access services, and CFM is deployed on each user-end provider edge (UPE) to detect link faults.</p>
<div class="fignone" id="EN-US_TASK_0172361980__fig_dc_vrp_cfm_cfg_00002601"><a name="EN-US_TASK_0172361980__fig_dc_vrp_cfm_cfg_00002601"></a><a name="fig_dc_vrp_cfm_cfg_00002601"></a><span class="figcap"><b>Figure 1 </b>Associating CFM with VRRP</span><br><span><img class="vsd" src="images/fig_dc_vrp_cfm_cfg_00002601.png"></span><br></div>
<p>In this network, NPE1 is the master device. User2's traffic is transmitted along the path CE2 -&gt; UPE2 -&gt; UPE1 -&gt; NPE1. If the link between UPE1 and UPE2 fails, NPE1's VRRP status remains Master and NPE2 changes its VRRP status from Backup to Master after a period of three times the interval at which VRRP Advertisement packets are sent. As a result, both NPE1 and NPE2 serve as master devices. Because UPE2 is still transmitting traffic over the faulty link, user-side traffic is interrupted.</p>
<p>CFM can be deployed on UPE2 and each NPE to monitor the link connectivity between them. When CFM detects a fault on the link between UPE2 and NPE1, it notifies the VRRP group of the fault. NPE1 changes its VRRP status to Initialize, and NPE2 changes its VRRP status from Backup to Master after a period of three times the interval at which VRRP Advertisement packets are sent. This process prevents a VRRP group from having two master devices.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><div class="p"><ul><li><div class="p">Because CFM can detect only local link faults, NPE2 cannot detect remote link faults. To enable NPE2 to transmit traffic, NPE2 must exchange VRRP Advertisement packets with NPE1 to switch to the Master state. This exchange causes lengthy service interruptions. To reduce the service interruption time, associate VRRP with peer Bidirectional Forwarding Detection (BFD) to accelerate VRRP switchovers. When CFM detects a fault on the link between UPE2 and NPE1:<ul><li><p>Both peer BFD and local CFM on NPE1 go down, which triggers NPE1 to change its VRRP status to Initialize.</p>
</li><li><p>Peer BFD on NPE2 goes down but local CFM on NPE2 remains up, which triggers NPE2 to change its VRRP status to Master.</p>
</li></ul>
</div>
</li><li><p>In the preceding scenario, if CFM is associated with VRRP and VRRP is associated with peer BFD, a rapid VRRP switchover is performed when CFM detects a link fault. User-side traffic can be rapidly forwarded through the backup device, reducing the service interruption time. Because a provider edge (PE) on the network side cannot detect master/backup VRRP switchovers, network-side traffic is still transmitted to NPE1, which wastes bandwidth resources and interrupts services. To resolve this issue, associate VRRP with direct routes. When a master/backup VRRP switchover is performed, the priorities of the direct routes decrease to ensure that both user- and network-side traffic are transmitted along the same path.</p>
</li></ul>
</div>
</div></div>
<p>To implement quick master/backup VRRP switchovers, reduce user- and network-side traffic interruption times, and ensure that both user- and network-side traffic are transmitted along the same path, associate CFM with VRRP, peer BFD with VRRP, and VRRP with direct routes.</p>
<p><a href="#EN-US_TASK_0172361980__fig_dc_vrp_cfm_cfg_00002602">Figure 2</a> shows a combination of these associations.</p>
<div class="fignone" id="EN-US_TASK_0172361980__fig_dc_vrp_cfm_cfg_00002602"><a name="EN-US_TASK_0172361980__fig_dc_vrp_cfm_cfg_00002602"></a><a name="fig_dc_vrp_cfm_cfg_00002602"></a><span class="figcap"><b>Figure 2 </b>Association combination</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface1, interface2, and interface3 represent GE <span>0/1/0</span>, GE <span>0/1/1</span>, and GE <span>0/1/2</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_cfm_cfg_00002602.png"></span><br></div>
<div class="p">The implementation is as follows:<ul><li><p>When CFM detects a fault on the link between UPE1 and UPE2, it notifies NPE1 of the fault.</p>
</li><li><p>NPE1 changes its VRRP status to Initialize based on the statuses of peer BFD and local CFM. Then, NPE1 increases the cost of the route to PE1.</p>
</li><li><p>NPE2 changes its VRRP status to Master based on the statuses of peer BFD and local CFM. Then, NPE2 decreases the cost of the route to PE1.</p>
</li><li><p>The path for transmitting user-side traffic changes from UPE2 -&gt; UPE1 -&gt; NPE1 to UPE2 -&gt; UPE3 -&gt; NPE2. The path for transmitting network-side traffic changes from PE1 -&gt; NPE1 to PE1 -&gt; NPE2.</p>
</li></ul>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172361980__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><div class="p">The configuration roadmap is as follows:<ol><li><p>Add each UPE's interfaces to a virtual local area network (VLAN) so that the UPE can forward CFM packets.</p>
</li><li><p>Configure basic CFM functions on each NPE and UPE to implement end-to-end link fault detection between the NPE and UPE.</p>
</li><li><p>Configure VRRP on each NPE to improve device reliability.</p>
</li><li><p>Configure BFD on each NPE, associate BFD with VRRP, and associate CFM with VRRP to implement user-side traffic path switching during a master/backup VRRP switchover.</p>
</li><li><p>Associate VRRP with direct routes on each NPE to implement network-side traffic path switching during a master/backup VRRP switchover.</p>
</li></ol>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172361980__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><div class="p">To complete the configuration, you need the following data:<ul><li><p>Maintenance domain (MD) name, maintenance association (MA) name, and maintenance association end point (MEP) ID for configuring basic CFM functions</p>
</li><li><p>Interface number and virtual router ID (VRID) for configuring basic VRRP functions</p>
</li><li><p>Session name, local discriminator, and remote discriminator for configuring basic BFD functions</p>
</li></ul>
</div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172361980__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure basic CFM functions on each NPE and UPE.</span><p><p># Configure NPE1.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname NPE1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE1]<strong> cfm enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1]<strong> cfm version standard</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1]<strong> interface gigabitethernet <span>0/1/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-gigabitethernet<span>0/1/0</span>.1]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-gigabitethernet<span>0/1/0</span>.1]<strong> vlan-type dot1q 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-gigabitethernet<span>0/1/0</span>.1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1]<strong> cfm md mdforvrrp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-md-mdforvrrp]<strong> ma ma1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-md-mdforvrrp-ma-ma1]<strong> mep mep-id 1 interface GigabitEthernet <span>0/1/0</span>.1 vlan 2 outward </strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-md-mdforvrrp-ma-ma1]<strong> remote-mep mep-id 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-md-mdforvrrp-ma-ma1]<strong> remote-mep ccm-receive enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-md-mdforvrrp-ma-ma1]<strong> mep ccm-send mep-id 1 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-md-mdforvrrp-ma-ma1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-md-mdforvrrp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1]<strong> commit</strong></pre>
</p><p><p># Configure NPE2.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname NPE2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE2]<strong> cfm enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2]<strong> cfm version standard</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2]<strong> interface gigabitethernet <span>0/1/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2-gigabitethernet<span>0/1/0</span>.1]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2-gigabitethernet<span>0/1/0</span>.1]<strong> vlan-type dot1q 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2-gigabitethernet<span>0/1/0</span>.1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2]<strong> cfm md mdforvrrp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2-md-mdforvrrp]<strong> ma ma2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2-md-mdforvrrp-ma-ma2]<strong> mep mep-id 4 interface GigabitEthernet <span>0/1/0</span>.1 vlan 2 outward</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2-md-mdforvrrp-ma-ma2]<strong> remote-mep mep-id 3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2-md-mdforvrrp-ma-ma2]<strong> remote-mep ccm-receive enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2-md-mdforvrrp-ma-ma2]<strong> mep ccm-send mep-id 4 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2-md-mdforvrrp-ma-ma2]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2-md-mdforvrrp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2]<strong> commit</strong></pre>
</p><p><p># Configure UPE1.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname UPE1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE1]<strong> interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-GigabitEthernet<span>0/1/1</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-GigabitEthernet<span>0/1/1</span>] <strong>portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-GigabitEthernet<span>0/1/1</span>]<strong> port trunk allow-pass vlan 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-GigabitEthernet<span>0/1/1</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-GigabitEthernet<span>0/1/0</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-GigabitEthernet<span>0/1/0</span>] <strong>portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-GigabitEthernet<span>0/1/0</span>]<strong> port trunk allow-pass vlan 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-GigabitEthernet<span>0/1/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1]<strong> commit</strong></pre>
</p><p><p># Configure UPE2.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname UPE2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE2]<strong> cfm enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2]<strong> cfm version standard</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2]<strong> interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-GigabitEthernet<span>0/1/1</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-GigabitEthernet<span>0/1/1</span>] <strong>portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-GigabitEthernet<span>0/1/1</span>]<strong> port trunk allow-pass vlan 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-GigabitEthernet<span>0/1/1</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-GigabitEthernet<span>0/1/0</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-GigabitEthernet<span>0/1/0</span>] <strong>portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-GigabitEthernet<span>0/1/0</span>]<strong> port trunk allow-pass vlan 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-GigabitEthernet<span>0/1/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2]<strong> cfm md mdforvrrp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-md-mdforvrrp]<strong> ma ma1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-md-mdforvrrp-ma-ma1]<strong> mep mep-id 2 interface GigabitEthernet <span>0/1/1</span> outward</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-md-mdforvrrp-ma-ma1]<strong> remote-mep mep-id 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-md-mdforvrrp-ma-ma1]<strong> remote-mep ccm-receive enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-md-mdforvrrp-ma-ma1]<strong> mep ccm-send mep-id 2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-md-mdforvrrp-ma-ma1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-md-mdforvrrp]<strong> ma ma2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-md-mdforvrrp-ma-ma2]<strong> mep mep-id 3 interface GigabitEthernet <span>0/1/0</span> outward</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-md-mdforvrrp-ma-ma2]<strong> remote-mep mep-id 4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-md-mdforvrrp-ma-ma2]<strong> remote-mep ccm-receive enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-md-mdforvrrp-ma-ma2]<strong> mep ccm-send enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-md-mdforvrrp-ma-ma2]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-md-mdforvrrp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2]<strong> commit</strong></pre>
</p><p><p># Configure UPE3.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname UPE3</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE3]<strong> interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE3-GigabitEthernet<span>0/1/1</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE3-GigabitEthernet<span>0/1/1</span>] <strong>portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE3-GigabitEthernet<span>0/1/1</span>]<strong> port trunk allow-pass vlan 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE3-GigabitEthernet<span>0/1/1</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE3]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE3-GigabitEthernet<span>0/1/0</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE3-GigabitEthernet<span>0/1/0</span>] <strong>portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE3-GigabitEthernet<span>0/1/0</span>]<strong> port trunk allow-pass vlan 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE3-GigabitEthernet<span>0/1/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE3]<strong> commit</strong></pre>
</p></li><li><span>Verify the CFM configuration.</span><p><p>After the configuration is complete, run the <a href="cmdqueryname=display+cfm+remote-mep"><b><span class="cmdname">display cfm remote-mep</span></b></a> command. The command output shows that basic CFM functions have been configured. The following example uses the command output on UPE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE2]<strong> display cfm remote-mep</strong></pre>
<pre class="screen">The total number of RMEPs is : 1
The status of RMEPs : 1 up, 0 down, 0 disable
--------------------------------------------------
 MD Name            : mdforvrrp
 Level              : 0
 MA Name            : ma2
 RMEP ID            : 4
 VLAN ID            : 2 
 VSI Name           : --
 L2VC ID            : --
<span> L2VPN Name         : --  CE ID              : --  CE Offset          : --</span>
<span> L2TPV3 Tunnel Name            : --  L2TPV3 Local Connection Name  : --</span>
 MAC                : 00e0-fc12-7890
 CCM Receive        : enabled
 Trigger-If-Down    : enabled
 CFM Status         : up
 Alarm Status       : none
 Interface TLV      : --
 Port Status TLV    : --</pre>
</p></li><li><span>Configure basic VRRP functions on each NPE.</span><p><p># Configure NPE1.</p>
<pre class="screen">[<span class="keyword">*</span>NPE1]<strong> interface GigabitEthernet <span>0/1/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-GigabitEthernet<span>0/1/0</span>.1]<strong> ip address 192.168.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-GigabitEthernet<span>0/1/0</span>.1]<strong> vrrp vrid 1 virtual-ip 192.168.1.11</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-GigabitEthernet<span>0/1/0</span>.1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1]<strong> commit</strong></pre>
</p><p><p># Configure NPE2.</p>
<pre class="screen">[<span class="keyword">*</span>NPE2]<strong> interface GigabitEthernet <span>0/1/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2-GigabitEthernet<span>0/1/0</span>.1]<strong> ip address 192.168.1.3 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2-GigabitEthernet<span>0/1/0</span>.1]<strong> vrrp vrid 1 virtual-ip 192.168.1.11</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2-GigabitEthernet<span>0/1/0</span>.1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2]<strong> commit</strong></pre>
</p></li><li><span>Verify the VRRP configuration.</span><p><p>After the configuration is complete, run the <a href="cmdqueryname=display+vrrp"><b><span class="cmdname">display vrrp</span></b></a> command on each NPE to view its VRRP status.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE1]<strong> display vrrp</strong></pre>
<pre class="screen">GigabitEthernet<span>0/1/0</span>.1 | Virtual Router 1
<strong>State          : Master</strong>
Virtual IP     : 192.168.1.11
Master IP      : 192.168.1.2
Local IP       : 192.168.1.2
PriorityRun    : 200
PriorityConfig : 200
MasterPriority : 200
Preempt        : YES   Delay Time : 0 s
Hold Multiplier: 4
TimerRun       : 1 s
TimerConfig    : 1 s
Auth type      : NONE
Virtual MAC    : 00e0-fc12-7880
Check TTL      : YES
Config type    : normal-vrrp
Backup-forward : disabled
Config track link-bfd down-number : 0
Track BFD          : 1  
type               : peer
BFD-session state  : DOWN
Create time        : 2011-11-23 10:55:13    
Last change time   : 2011-11-23 14:45:05          </pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE2]<strong> display vrrp</strong></pre>
<pre class="screen">GigabitEthernet<span>0/1/0</span>.1 | Virtual Router 1
<strong>State          : Backup</strong>
Virtual IP     : 192.168.1.11
Master IP      : 192.168.1.2
Local IP       : 192.168.1.3
PriorityRun    : 100
PriorityConfig : 100
MasterPriority : 200
Preempt        : YES   Delay Time : 0 s
Hold Multiplier: 4
TimerRun       : 1 s
TimerConfig    : 1 s
Auth type      : NONE
Virtual MAC    : 00e0-fc12-7880
Check TTL      : YES
Config type    : normal-vrrp
Backup-forward : disabled
Config track link-bfd down-number : 0
Track BFD          : 2  
type               : peer
BFD-session state  : UP
Create time        : 2011-11-23 10:15:28    
Last change time   : 2011-11-23 14:04:29        </pre>
</p></li><li><span>Establish a BFD session between NPE1 and NPE2.</span><p><p># Configure NPE1.</p>
<pre class="screen">[<span class="keyword">*</span>NPE1]<strong> bfd</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-bfd]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1]<strong> bfd NPE1toNPE2 bind peer-ip 192.168.1.3 interface GigabitEthernet<span>0/1/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-bfd-session-NPE1toNPE2]<strong> discriminator local 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-bfd-session-NPE1toNPE2]<strong> discriminator remote 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-bfd-session-NPE1toNPE2]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-bfd-session-NPE1toNPE2]<strong> quit</strong></pre>
<p># Configure NPE2.</p>
<pre class="screen">[<span class="keyword">*</span>NPE2]<strong> bfd</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2-bfd]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2]<strong> bfd NPE2toNPE1 bind peer-ip 192.168.1.2 interface GigabitEthernet<span>0/1/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2-bfd-session-NPE2toNPE1]<strong> discriminator local 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2-bfd-session-NPE2toNPE1]<strong> discriminator remote 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2-bfd-session-NPE2toNPE1]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2-bfd-session-NPE2toNPE1]<strong> quit</strong></pre>
</p></li><li><span>Verify the BFD configuration.</span><p><p>After the configuration is complete, run the <a href="cmdqueryname=display+bfd+session"><b><span class="cmdname">display bfd session</span></b></a> command on each NPE to view its BFD session status. The following example uses the command output on NPE1.</p>
<pre class="screen">[<span class="keyword">*</span>NPE1]<strong> display bfd session all</strong></pre>
<pre class="screen"><span>(w): State in WTR 
(*): State is invalid</span>
--------------------------------------------------------------------------------
Local Remote PeerIpAddr      State     Type        InterfaceName
--------------------------------------------------------------------------------
1     2      192.168.1.3        Up        S_IP_IF     GigabitEthernet<span>0/1/0</span>.1
--------------------------------------------------------------------------------
     Total UP/DOWN Session Number : 1/0                                       </pre>
</p></li><li><span>Configure routes on each NPE and PE1.</span><p><p># Configure PE1.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname PE1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> interface GigabitEthernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/2</span>]<strong> ip address 192.168.3.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/2</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> interface GigabitEthernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>]<strong> ip address 192.168.2.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1]<strong> default cost inherit-metric</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1]<strong> import-route direct</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1]<strong> area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1-area-0.0.0.0]<strong> network 192.168.2.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1-area-0.0.0.0]<strong> network 192.168.3.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1-area-0.0.0.0]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> commit</strong></pre>
</p><p><p># Configure NPE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE1]<strong> interface GigabitEthernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-GigabitEthernet<span>0/1/2</span>]<strong> ip address 192.168.2.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-GigabitEthernet<span>0/1/2</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1]<strong> ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-ospf-1]<strong> default cost inherit-metric</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-ospf-1]<strong> import-route direct</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-ospf-1]<strong> area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-ospf-1-area-0.0.0.0]<strong> network 192.168.2.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-ospf-1-area-0.0.0.0]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-ospf-1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1]<strong> commit</strong></pre>
</p><p><p># Configure NPE2.</p>
<pre class="screen">[<span class="keyword">*</span>NPE2]<strong> interface GigabitEthernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2-GigabitEthernet<span>0/1/2</span>]<strong> ip address 192.168.3.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2-GigabitEthernet<span>0/1/2</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2]<strong> ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2-ospf-1]<strong> default cost inherit-metric</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2-ospf-1]<strong> import-route direct</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2-ospf-1]<strong> area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2-ospf-1-area-0.0.0.0]<strong> network 192.168.3.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2-ospf-1-area-0.0.0.0]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2-ospf-1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2]<strong> commit</strong></pre>
</p></li><li><span>Verify the route configuration.</span><p><p>After the configuration is complete, run the <a href="cmdqueryname=display+ip+routing-table"><b><span class="cmdname">display ip routing-table</span></b></a> command on PE1 to view information about the route to the network segment 192.168.1.0.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> display ip routing-table</strong></pre>
<pre class="screen"><span class="keyword">Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route</span>
------------------------------------------------------------------------------
Routing Table: Public
         Destinations : 19       Routes : 19

Destination/Mask    Proto   Pre  Cost      Flags NextHop         Interface

     10.137.0.0/16  Static  60   0          RD   10.137.130.1    GigabitEthernet<span>0/1/0</span>
   10.137.130.0/23  Static  60   0          RD   10.137.130.1    GigabitEthernet<span>0/1/0</span>
   10.137.130.0/24  Direct  0    0           D   10.137.130.47   GigabitEthernet<span>0/1/0</span>
  10.137.130.47/32  Direct  0    0           D   127.0.0.1       GigabitEthernet<span>0/1/0</span>0
 10.137.130.255/32  Direct  0    0           D   127.0.0.1       GigabitEthernet<span>0/1/0</span>
     10.138.0.0/15  Static  60   0          RD   10.137.130.1    GigabitEthernet<span>0/1/0</span>
      10.1.2.0/24   O_ASE   150  0           D   192.168.3.1     GigabitEthernet<span>0/1/2</span>
      127.0.0.0/8   Direct  0    0           D   127.0.0.1       InLoopBack0
      127.0.0.1/32  Direct  0    0           D   127.0.0.1       InLoopBack0
127.255.255.255/32  Direct  0    0           D   127.0.0.1       InLoopBack0
<strong>    192.168.1.0/24  O_ASE   150  0           D   192.168.2.1     GigabitEthernet<span>0/1/1</span></strong>
   192.168.1.11/32  O_ASE   150  0           D   192.168.2.1     GigabitEthernet<span>0/1/1</span>
    192.168.2.0/24  Direct  0    0           D   192.168.2.2     GigabitEthernet<span>0/1/1</span>
    192.168.2.2/32  Direct  0    0           D   127.0.0.1       GigabitEthernet<span>0/1/1</span>
  192.168.2.255/32  Direct  0    0           D   127.0.0.1       GigabitEthernet<span>0/1/1</span>
    192.168.3.0/24  Direct  0    0           D   192.168.3.2     GigabitEthernet<span>0/1/2</span>
    192.168.3.2/32  Direct  0    0           D   127.0.0.1       GigabitEthernet<span>0/1/2</span>
  192.168.3.255/32  Direct  0    0           D   127.0.0.1       GigabitEthernet<span>0/1/2</span>
255.255.255.255/32  Direct  0    0           D   127.0.0.1       InLoopBack0

</pre>
</p></li><li><span>Associate CFM with VRRP on each NPE.</span><p><p># Configure NPE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE1]<strong> oam-mgr</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-oam-mgr]<strong> oam-bind ingress cfm md mdforvrrp ma ma1 egress vrrp vrid 1 interface GigabitEthernet <span>0/1/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-oam-mgr]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1]<strong> commit</strong></pre>
<p># Configure NPE2.</p>
<pre class="screen">[<span class="keyword">*</span>NPE2]<strong> oam-mgr</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2-oam-mgr]<strong> oam-bind ingress cfm md mdforvrrp ma ma2 egress vrrp vrid 1 interface GigabitEthernet <span>0/1/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2-oam-mgr]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2]<strong> commit</strong></pre>
</p></li><li><span>Associate VRRP with peer BFD on each NPE.</span><p><p># Configure NPE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE1]<strong> interface GigabitEthernet <span>0/1/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-GigabitEthernet<span>0/1/0</span>.1]<strong> vrrp vrid 1 track bfd-session 1 peer</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-GigabitEthernet<span>0/1/0</span>.1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1]<strong> commit</strong></pre>
<p># Configure NPE2.</p>
<pre class="screen">[<span class="keyword">*</span>NPE2]<strong> interface GigabitEthernet <span>0/1/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2-GigabitEthernet<span>0/1/0</span>.1]<strong> vrrp vrid 1 track bfd-session 2 peer</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2-GigabitEthernet<span>0/1/0</span>.1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2]<strong> commit</strong></pre>
</p></li><li><span>Verify the association between VRRP and peer BFD.</span><p><p>After the configuration is complete, run the <a href="cmdqueryname=display+vrrp"><b><span class="cmdname">display vrrp</span></b></a> command on each NPE to view the association between VRRP and peer BFD. The following example uses the command output on NPE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE2]<strong> display vrrp</strong></pre>
<pre class="screen">  GigabitEthernet<span>0/1/0</span>.1 | Virtual Router 1
    State : Master
    Virtual IP : 192.168.1.11
    Master IP : 192.168.1.2
    Local IP : 192.168.1.3
    PriorityRun : 200
    PriorityConfig : 200
    MasterPriority : 200
    Preempt : YES   Delay Time : 0 s
    Hold Multiplier: 4
    TimerRun : 1 s
    TimerConfig : 1 s
    Auth type : NONE
    Virtual MAC : 00e0-fc12-7880
    Check TTL : YES
    Config type : normal-vrrp
<span>    Backup-forward    : disabled</span>
    Config track link-bfd down-number : 0
    <strong>Track BFD : 1  type: peer
    BFD-session state : UP</strong>
    Create time : 2011-11-23 10:55:13
    Last change time : 2011-11-23 14:45:05           </pre>
</p></li><li><span>Associate VRRP with direct routes on each NPE.</span><p><p># Configure NPE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE1]<strong> interface GigabitEthernet <span>0/1/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-GigabitEthernet<span>0/1/0</span>.1]<strong> direct-route track vrrp vrid 1 degrade-cost 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-GigabitEthernet<span>0/1/0</span>.1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1]<strong> commit</strong></pre>
<p># Configure NPE2.</p>
<pre class="screen">[<span class="keyword">*</span>NPE2]<strong> interface GigabitEthernet <span>0/1/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2-GigabitEthernet<span>0/1/0</span>.1]<strong> direct-route track vrrp vrid 1 degrade-cost 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2-GigabitEthernet<span>0/1/0</span>.1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2]<strong> commit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p>After the configuration is complete, run the <a href="cmdqueryname=shutdown"><b><span class="cmdname">shutdown</span></b></a> command on UPE1's GE <span>0/1/1</span> to simulate a link fault. The <strong>display vrrp</strong> command outputs show that NPE1's and NPE2's VRRP statuses have changed. The <strong>display ip routing-table</strong> command output shows that the outbound interface of the route to the user side has changed.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE1]<strong> display vrrp</strong></pre>
<pre class="screen">  GigabitEthernet<span>0/1/0</span>.1 | Virtual Router 1
    <strong>State : Initialize</strong>
    Virtual IP : 192.168.1.11
    Master IP : 0.0.0.0
    Local IP : 192.168.1.2
    PriorityRun : 200
    PriorityConfig : 200
    MasterPriority : 0
    Preempt : YES   Delay Time : 0 s
    Hold Multiplier: 4
    TimerRun : 1 s
    TimerConfig : 1 s
    Auth type : NONE
    Virtual MAC : 00e0-fc12-7880
    Check TTL : YES
    Config type : normal-vrrp
    Backup-forward    : disabled
    Config track link-bfd down-number : 0
    Track BFD : 1  type: peer
    <strong>BFD-session state : DOWN</strong>
    Create time : 2011-11-23 10:55:13
    Last change time : 2011-11-23 14:38:02       </pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE2]<strong> display vrrp</strong></pre>
<pre class="screen">  GigabitEthernet<span>0/1/0</span>.1 | Virtual Router 1
    <strong>State : Master</strong>
    Virtual IP : 192.168.1.11
    Master IP : 192.168.1.3
    Local IP : 192.168.1.3
    PriorityRun : 100
    PriorityConfig : 100
    MasterPriority : 100
    Preempt : YES   Delay Time : 0 s
    Hold Multiplier: 4
    TimerRun : 1 s
    TimerConfig : 1 s
    Auth type : NONE
    Virtual MAC : 00e0-fc12-7880
    Check TTL : YES
    Config type : normal-vrrp
    Backup-forward    : disabled
    Config track link-bfd down-number : 0
    Track BFD : 2  type: peer
    <strong>BFD-session state : DOWN</strong>
    Create time : 2011-11-23 10:15:28
    Last change time : 2011-11-23 13:57:24        </pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE]<strong> display ip routing-table</strong></pre>
<pre class="screen"><span class="keyword">Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route</span>
------------------------------------------------------------------------------
Routing Table: Public
         Destinations : 19       Routes : 19

Destination/Mask    Proto   Pre  Cost      Flags NextHop         Interface

     10.137.0.0/16  Static  60   0          RD   10.137.130.1    GigabitEthernet<span>0/1/0</span>
   10.137.130.0/23  Static  60   0          RD   10.137.130.1    GigabitEthernet<span>0/1/0</span>
   10.137.130.0/24  Direct  0    0           D   10.137.130.47   GigabitEthernet<span>0/1/0</span>
  10.137.130.47/32  Direct  0    0           D   127.0.0.1       GigabitEthernet<span>0/1/0</span>
 10.137.130.255/32  Direct  0    0           D   127.0.0.1       GigabitEthernet<span>0/1/0</span>
     10.138.0.0/15  Static  60   0          RD   10.137.130.1    GigabitEthernet<span>0/1/0</span>
      10.1.2.0/24   O_ASE   150  0           D   192.168.3.1     GigabitEthernet<span>0/1/2</span>
      127.0.0.0/8   Direct  0    0           D   127.0.0.1       InLoopBack0
      127.0.0.1/32  Direct  0    0           D   127.0.0.1       InLoopBack0
127.255.255.255/32  Direct  0    0           D   127.0.0.1       InLoopBack0
<strong>    192.168.1.0/24  O_ASE   150  0           D   192.168.3.1     GigabitEthernet<span>0/1/2</span></strong>
   192.168.1.11/32  O_ASE   150  0           D   192.168.3.1     GigabitEthernet<span>0/1/2</span>
    192.168.2.0/24  Direct  0    0           D   192.168.2.2     GigabitEthernet<span>0/1/1</span>
    192.168.2.2/32  Direct  0    0           D   127.0.0.1       GigabitEthernet<span>0/1/1</span>
  192.168.2.255/32  Direct  0    0           D   127.0.0.1       GigabitEthernet<span>0/1/1</span>
    192.168.3.0/24  Direct  0    0           D   192.168.3.2     GigabitEthernet<span>0/1/2</span>
    192.168.3.2/32  Direct  0    0           D   127.0.0.1       GigabitEthernet<span>0/1/2</span>
  192.168.3.255/32  Direct  0    0           D   127.0.0.1       GigabitEthernet<span>0/1/2</span>
255.255.255.255/32  Direct  0    0           D   127.0.0.1       InLoopBack0  </pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172361980__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>PE1 configuration file</p>
<pre class="screen">#                                                                               
sysname PE1                                                   
#                                              
<span>cfm version standard                                                            </span>
cfm enable
#                                                                           
interface GigabitEthernet<span>0/1/1</span>                                                  
 undo shutdown                                                                  
 ip address 192.168.2.2 255.255.255.0                                           
#                                                                           
interface GigabitEthernet<span>0/1/2</span>                                                  
 undo shutdown                                                                  
 ip address 192.168.3.2 255.255.255.0                                           
#                                                                               
interface LoopBack0                                                           
 ip address 1.1.1.1 255.255.255.255                                             
#                                                              
ospf 1                                                                          
 default cost inherit-metric                                                    
 import-route direct                                                            
 area 0.0.0.0 
  network 1.1.1.1 0.0.0.0                                                                  
  network 192.168.2.0 0.0.0.255                                                 
  network 192.168.3.0 0.0.0.255                                                 
#                                                                 
return        </pre>
</li><li><p>NPE1 configuration file</p>
<pre class="screen">#                                                                               
sysname NPE1                                                                      
#                                            
<span>cfm version standard                                                            </span>
cfm enable                                                                      
#                                                                               
bfd 
#                                                                               
interface GigabitEthernet<span>0/1/0</span>                                                  
 undo shutdown                                                                  
#                                                                               
interface GigabitEthernet<span>0/1/0</span>.1                                                
 vlan-type dot1q 2                                                              
 ip address 192.168.1.2 255.255.255.0                                              
 vrrp vrid 1 virtual-ip 192.168.1.11                                               
 vrrp vrid 1 track bfd-session 1 peer                                           
 direct-route track vrrp vrid 1 degrade-cost 200                                
#                                                                 
interface GigabitEthernet<span>0/1/2</span>                                                 
 undo shutdown                                                                  
 ip address 192.168.2.1 255.255.255.0                  
#                                                                               
bfd NPE1toNPE2 bind peer-ip 192.168.1.3 interface GigabitEthernet<span>0/1/0</span>.1           
 discriminator local 1                                                          
 discriminator remote 2                                                         
 commit                                                                         
#                                                                               
ospf 1                                                                          
 default cost inherit-metric                                                    
 import-route direct                                                            
 area 0.0.0.0                                                                   
  network 192.168.2.0 0.0.0.255                                                 
#                                                                               
cfm md mdforvrrp                                                                
 ma ma1                                                                         
  mep mep-id 1 interface GigabitEthernet<span>0/1/0</span>.1 vlan 2 outward                  
  mep ccm-send mep-id 1 enable                                                  
  remote-mep mep-id 2                                                           
  remote-mep ccm-receive mep-id 2 enable                                        
#                                                                            
oam-mgr                                                                         
 oam-bind ingress cfm md mdforvrrp ma ma1 egress vrrp vrid 1 interface GigabitEthernet<span>0/1/0</span>.1 
#                                                                                
return   </pre>
</li><li><p>UPE2 configuration file</p>
<pre class="screen">#                                                                               
sysname UPE2                                                                      
#                                              
<span>cfm version standard                                                            </span>
cfm enable                                                                      
#                                                                              
interface GigabitEthernet<span>0/1/0</span>                                                  
<span> portswitch</span>
 undo shutdown                                                                  
 port trunk allow-pass vlan 2                                                   
#                                          
interface GigabitEthernet<span>0/1/1</span>                                                  
<span> portswitch</span>
 undo shutdown                                                                  
 port trunk allow-pass vlan 2                                                   
#                                                                      
cfm md mdforvrrp                                                                
 ma ma1                                                                         
  map vlan 2                                                                    
  mep mep-id 2 interface GigabitEthernet<span>0/1/1</span> outward                           
  mep ccm-send mep-id 2 enable                                                  
  remote-mep mep-id 1                                                           
  remote-mep ccm-receive mep-id 1 enable                                        
 ma ma2                                                                         
  map vlan 2                                                                    
  mep mep-id 3 interface GigabitEthernet<span>0/1/0</span> outward                           
  mep ccm-send mep-id 3 enable                                                  
  remote-mep mep-id 4                                                           
  remote-mep ccm-receive mep-id 4 enable                                        
#                                                                           
return     </pre>
</li><li><p>NPE2 configuration file</p>
<pre class="screen">#                                                                               
sysname NPE2                                                                      
#                                                                               
FTP server enable                                                               
#                                    
<span>cfm version standard                                                            </span>
cfm enable                              
#                                                                               
bfd                                                                   
#                                                                               
interface GigabitEthernet<span>0/1/2</span>                                                  
 undo shutdown                                                                  
 ip address 192.168.3.1 255.255.255.0                                           
#                                                                         
interface GigabitEthernet<span>0/1/0</span>.1                                                
 vlan-type dot1q 2                                                              
 ip address 192.168.1.3 255.255.255.0                                              
 vrrp vrid 1 virtual-ip 192.168.1.11                                               
 vrrp vrid 1 track bfd-session 2 peer                                           
 direct-route track vrrp vrid 1 degrade-cost 10                                 
#                                                                              
interface LoopBack100                                                           
 ip address 3.3.3.3 255.255.255.255                                             
# 
bfd NPE2toNPE1 bind peer-ip 192.168.1.2 interface GigabitEthernet<span>0/1/0</span>.1           
 discriminator local 2                                                          
 discriminator remote 1                                                         
 commit                                                                         
#                                                                               
ospf 1                                                                          
 default cost inherit-metric                                                    
 import-route direct                                                            
 area 0.0.0.0                                                                   
  network 192.168.3.0 0.0.0.255                                                 
#                                                             
cfm md mdforvrrp                                                                
 ma ma2                                                                         
  mep mep-id 4 interface GigabitEthernet<span>0/1/0</span>.1 vlan 2 outward                  
  mep ccm-send mep-id 4 enable                                                  
  remote-mep mep-id 3                                                           
  remote-mep ccm-receive mep-id 3 enable                                        
#  
oam-mgr                                                                         
 oam-bind ingress cfm md mdforvrrp ma ma2 egress vrrp vrid 1 interface GigabitEthernet<span>0/1/0</span>.1 
#
return  </pre>
</li><li><p>UPE1 configuration file</p>
<pre class="screen">#                                                                               
sysname UPE1                                                                      
#                                                                               
FTP server enable                                                               
#                                      
<span>cfm version standard                                                            </span>
cfm enable                                                                      
#                                                                              
interface GigabitEthernet<span>0/1/0</span>                                                  
<span> portswitch</span>
 undo shutdown                                                                  
 port trunk allow-pass vlan 2                                                   
#                                          
interface GigabitEthernet<span>0/1/1</span>                                                  
<span> portswitch</span>
 undo shutdown                                                                  
 port trunk allow-pass vlan 2                                                   
#   
return </pre>
</li><li><p>UPE3 configuration file</p>
<pre class="screen">#                                                                               
sysname UPE3                                                                      
#                                                                               
FTP server enable                                                               
#                                      
<span>cfm version standard                                                            </span>
cfm enable                                                                      
#                                                                              
interface GigabitEthernet<span>0/1/0</span>                                                  
<span> portswitch</span>
 undo shutdown                                                                  
 port trunk allow-pass vlan 2                                                   
#                                          
interface GigabitEthernet<span>0/1/1</span>                                                  
<span> portswitch</span>
 undo shutdown                                                                  
 port trunk allow-pass vlan 2                                                   
#   
return </pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfm_cfg_000021.html">Configuration Examples for CFM
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfm_cfg_000025.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfm_cfg_000032.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>