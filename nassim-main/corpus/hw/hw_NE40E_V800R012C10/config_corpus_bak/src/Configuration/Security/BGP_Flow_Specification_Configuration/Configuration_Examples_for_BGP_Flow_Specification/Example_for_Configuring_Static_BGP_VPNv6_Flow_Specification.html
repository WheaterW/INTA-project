
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Static BGP VPNv6 Flow Specification">
<meta name="abstract" content="This section provides an example for configuring static BGP VPNv6 Flow Specification to allow BGP VPNv6 Flow Specification routes to be transmitted and traffic filtering policies to be generated. The policies improve security of devices in VPNs.">
<meta name="description" content="This section provides an example for configuring static BGP VPNv6 Flow Specification to allow BGP VPNv6 Flow Specification routes to be transmitted and traffic filtering policies to be generated. The policies improve security of devices in VPNs.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_flowspec_cfg_0010.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_flowspec_cfg_0029.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_flowspec_cfg_0032.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="z00603461,w00800033,flow-specificationvrp,w00556928,w00606909,l00455378,z00805567">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="BGP Flow Specfication">
<meta name="featuretype" content="Security">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP Flow Specfication">
<meta name="featuretype" content="Security">
<meta name="featurename" content="BGP Flow Specfication">
<meta name="featuretype" content="Security">
<meta name="OWNER" content="h00522387">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00615954">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172372384">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring Static BGP VPNv6 Flow Specification</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172372384"></a><a name="EN-US_TASK_0172372384"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Static BGP VPNv6 Flow Specification</h1>
<div class="taskbody"><p>This section provides an example for configuring static BGP VPNv6 Flow Specification to allow BGP VPNv6 Flow Specification routes to be transmitted and traffic filtering policies to be generated. The policies improve security of devices in VPNs.</p>
<div class="context"><a name="EN-US_TASK_0172372384__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>As shown in <a href="#EN-US_TASK_0172372384__fig_dc_vrp_flowspec_cfg_002001">Figure 1</a>, in the VPN, CE1 belongs to AS 100; PE1 and PE2 belong to AS 200, all devices are in the same VPN domain. PE1 is the ingress of the VPN domain in AS 200. AS 200 can communicate with AS 100 through PE1.</p>
<p>If an attack source appears in AS 100, attack traffic flows into AS 200 through PE1, which severely affects the VPN performance of AS 200.</p>
<p>In this case, it is required that static BGP VPNv6 Flow Specification be configured to address this problem. To meet the requirement, you need to create a BGP IPv6 VPN Flow Specification route on PE2, and enable the BGP-Flow VPNv6 address family so that a BGP VPNv6 Flow Specification route is generated automatically. Then establish a BGP VPNv6 Flow Specification peer relationship between PE1 and PE2 to transmit the BGP VPNv6 Flow Specification route. The BGP VPNv6 Flow Specification route is used to generate a traffic filtering policy for traffic filtering and control.</p>
<div class="fignone" id="EN-US_TASK_0172372384__fig_dc_vrp_flowspec_cfg_002001"><a name="EN-US_TASK_0172372384__fig_dc_vrp_flowspec_cfg_002001"></a><a name="fig_dc_vrp_flowspec_cfg_002001"></a><span class="figcap"><b>Figure 1 </b>Configuring static BGP VPNv6 Flow Specification</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 and 2 in this example represent GE<span>0/1/0</span> and GE<span>0/2/0</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_flowspec_cfg_000901.png" width="NaN" height="NaN"></span><br></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172372384__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure interface IP addresses.</p>
</li><li><p>Create a VPN instance on PE1 and PE2 and bind it to the interface connecting PE1 to CE1.</p>
</li><li><p>Configure a BGP VPN Flow Specification route named FlowSpec1 on PE2 to discard the attack traffic with the source port number being 159.</p>
</li><li><p>Establish a BGP VPNv6 Flow Specification peer relationship between PE1 and PE2 so that the generated BGP VPNv6 Flow Specification route can be sent to PE1 and be used by PE1 to generate a traffic filtering policy.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172372384__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><div class="p">To complete the configuration, you need the following data:<ul><li><p>AS number of CE1: 100; AS number of PE1 and PE2: 200</p>
</li><li><p>VPN instance name: vpna</p>
</li></ul>
</div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172372384__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure IP addresses for interfaces.</span><p><p>For configuration details, see the configuration files.</p>
</p></li><li><span>Create a VPN instance and bind the VPN instance to the PE1's interface that is connected to CE1.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> ip vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpna]<strong> ipv6-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpna-af-ipv6] <strong>route-distinguisher 100:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpna-af-ipv6]<strong> vpn-target 111:1 export-extcommunity</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpna-af-ipv6] <strong>vpn-target 111:1 import-extcommunity</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpna-af-ipv6] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-vpn-instance-vpna-af-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-vpn-instance-vpna] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-vpn-instance-vpna] <strong>route-distinguisher 100:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpna-af-ipv4] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-vpn-instance-vpna-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-vpn-instance-vpna] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface GigabitEthernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>ip binding vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>ip address 10.1.1.2 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface GigabitEthernet<span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>ip address 10.2.1.1 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2]<strong> ip vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-vpna]<strong> ipv6-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-vpna-af-ipv6] <strong>route-distinguisher 200:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-vpna-af-ipv6]<strong> vpn-target 111:1 export-extcommunity</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-vpna-af-ipv6] <strong>vpn-target 111:1 import-extcommunity</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-vpna-af-ipv6] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-vpn-instance-vpna-af-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-vpn-instance-vpna] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>interface GigabitEthernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>ip address 10.2.1.2 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
</p></li><li><span>Configure a BGP IPv6 VPN Flow Specification route.</span><p><p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>flow-route FlowSpec1 ipv6 vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-flow-route-vpna] <strong>if-match source-port equal 159</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-flow-route-vpna] <strong>apply deny</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-flow-route-vpna] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-flow-route-vpna] <strong>quit</strong></pre>
</p></li><li><span>Establish a BGP VPNv6 Flow Specification peer relationship.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong>bgp 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 10.2.1.2 as-number 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp]<strong> vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-instance-vpna] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>ipv6-flow vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-flow-vpna] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>ipv6-flow vpnv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-flow-vpnv6] <strong>peer 10.2.1.2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-flow-vpnv6] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp-af-flow-vpnv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp] <strong>quit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2]<strong>bgp 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>peer 10.2.1.1 as-number 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp]<strong> vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-instance-vpna] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>ipv6-flow vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-flow-6-vpna] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>ipv6-flow vpnv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-flow-vpnv6] <strong>peer 10.2.1.1 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-flow-vpnv6] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-bgp-af-flow-vpnv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-bgp] <strong>quit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p># Check the status of the BGP VPNv6 Flow Specification peer relationship on PE2. The command output shows that the BGP VPNv6 Flow Specification peer relationship has been successfully established.</p>
<pre class="screen">&lt;PE2&gt; <strong>display bgp flow vpnv6 all peer</strong></pre>
<pre class="screen"> 
 BGP local router ID : 10.2.1.2
 Local AS number : 200
 Total number of peers : 1                 Peers in established state : 1

  Peer            V          AS  MsgRcvd  MsgSent  OutQ  Up/Down       State  PrefRcv
  10.2.1.1        4         200     1042     1051     0 15:07:49 Established        0</pre>
<p># Check information about the BGP VPNv6 Flow Specification routes received by PE1.</p>
<pre class="screen">&lt;PE1&gt; <strong>display bgp flow vpnv6 route-distinguisher 200:1 routing-table</strong></pre>
<pre class="screen"> 
 BGP Local router ID is 10.1.1.2
 Status codes: * - valid, &gt; - best, d - damped, x - best external, a - add path,
               h - history,  i - internal, s - suppressed, S - Stale
               Origin : i - IGP, e - EGP, ? - incomplete
 RPKI validation codes: V - valid, I - invalid, N - not-found


 Route Distinguisher: 200:1
 
 Total Number of Routes: 1
 * &gt;  ReIndex : 536870913
      Dissemination Rules:
       Src. Port      : eq 159
       MED      : 0                   PrefVal  : 0                   
       LocalPref: 100                       
       Path/Ogn :  i</pre>
<p># Check the traffic filtering rule carried in each BGP VPNv6 Flow Specification route based on the value of <strong>ReIndex</strong> in the preceding command output.</p>
<pre class="screen">&lt;PE1&gt; <strong>display bgp flow vpnv6 all routing-table 536870913</strong></pre>
<pre class="screen"> 
 BGP local router ID : 10.1.1.2
 Local AS number : 200
 ReIndex : 536870913
 Order   : 0
 Dissemination Rules :
   Src. Port      : eq 159
 
 BGP flow-vpnv6 routing table entry information of 536870913:
 Route Distinguisher: 200:1
 Match action :
   apply deny
 From: 10.2.1.2 (10.2.1.2) 
 Route Duration: 0d13h59m46s
 Ext-Community: RT &lt;111 : 1&gt;
 AS-path Nil, origin igp, MED 0, localpref 100, pref-val 0, valid, internal, best, pre 255
 Not advertised to any peer yet</pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172372384__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>CE1 configuration file</p>
<pre class="screen">#
sysname CE1
#               
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown  
 ip address 10.1.1.1 255.255.255.0
#               
bgp 100         
 peer 10.1.1.2 as-number 200
 #              
 ipv6-family unicast
  undo synchronization 
  peer 10.1.1.2 enable
 #              
 ipv6-family flow
  peer 10.1.1.2 enable
#               
return</pre>
</li><li><p>PE1 configuration file</p>
<pre class="screen">#
sysname PE1
#
ip vpn-instance vpna
 ipv6-family
  route-distinguisher 100:1
  apply-label per-instance
  vpn-target 111:1 export-extcommunity
  vpn-target 111:1 import-extcommunity
 ipv4-family
  route-distinguisher 100:1
  apply-label per-instance
#               
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown  
 ip binding vpn-instance vpna
 ip address 10.1.1.2 255.255.255.0
#               
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown  
 ip address 10.2.1.1 255.255.255.0
#               
bgp 200         
 peer 10.2.1.2 as-number 200
 #              
 ipv6-family unicast
  undo synchronization 
  peer 10.2.1.2 enable
 #              
 vpn-instance vpna
 #              
 ipv6-flow vpn-instance vpna
 #              
 ipv6-flow vpnv6
  policy vpn-target
  peer 10.2.1.2 enable
#               
return</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#
sysname PE2
#
ip vpn-instance vpna
 ipv6-family
  route-distinguisher 200:1
  apply-label per-instance
  vpn-target 111:1 export-extcommunity
  vpn-target 111:1 import-extcommunity
#               
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown  
 ip address 10.2.1.2 255.255.255.0
#               
bgp 200         
 peer 10.2.1.1 as-number 200
 #              
 ipv6-family unicast
  undo synchronization 
  peer 10.2.1.1 enable
 #              
 vpn-instance vpna
 #              
 ipv6-flow vpn-instance vpna
 #              
 ipv6-flow vpnv6
  policy vpn-target
  peer 10.2.1.1 enable
#               
flow-route FlowSpec1 ipv6 vpn-instance vpna
 if-match source-port equal 159
 apply deny     
#               
return          </pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_flowspec_cfg_0010.html">Configuration Examples for BGP Flow Specification
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_flowspec_cfg_0029.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_flowspec_cfg_0032.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>