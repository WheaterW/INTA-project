
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Establishing IPsec Tunnels Between NE40E Devices in IPsec Policy Template Mode">
<meta name="abstract" content="Using the IPsec policy template mode, you can configure IPsec tunnels for multiple mobile devices and conveniently add or delete peer devices. An IPsec policy template needs to be configured on the NE40E to passively receive connection requests, and IPsec policies need to be configured on the peer devices to initiate such requests.">
<meta name="description" content="Using the IPsec policy template mode, you can configure IPsec tunnels for multiple mobile devices and conveniently add or delete peer devices. An IPsec policy template needs to be configured on the NE40E to passively receive connection requests, and IPsec policies need to be configured on the peer devices to initiate such requests.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ipsec_cfg_all_0039.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ipsec_cfg_0033.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,z00603461,ipsec,w00556928,w00606909,h00522387,l00455378,z00805567">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="IPSec">
<meta name="featuretype" content="Security">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="IPSec">
<meta name="featuretype" content="Security">
<meta name="featurename" content="IPSec">
<meta name="featuretype" content="Security">
<meta name="featurename" content="IPSec">
<meta name="featuretype" content="Security">
<meta name="featurename" content="IPSec">
<meta name="featuretype" content="Security">
<meta name="OWNER" content="z00485179">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="z00485179">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172372462">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/thickbox.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/imageResize.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery-migrate-1.2.1.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery-ui.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery.mousewheel.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/thickbox.js"></script>
<title>Example for Establishing IPsec Tunnels Between NE40E Devices in IPsec Policy Template Mode</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172372462"></a><a name="EN-US_TASK_0172372462"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Establishing IPsec Tunnels Between <span class="keyword">NE40E</span> Devices in IPsec Policy Template Mode</h1>
<div class="taskbody"><p>Using the IPsec policy template mode, you can configure IPsec tunnels for multiple mobile devices and conveniently add or delete peer devices. An IPsec policy template needs to be configured on the <span class="keyword">NE40E</span> to passively receive connection requests, and IPsec policies need to be configured on the peer devices to initiate such requests.</p>
<div class="context"><a name="EN-US_TASK_0172372462__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>As shown in <a href="#EN-US_TASK_0172372462__fig1">Figure 1</a>, networks A, B, and C are connected to the Internet through <span class="keyword">Device</span>A, <span class="keyword">Device</span>B, and <span class="keyword">Device</span>C, respectively. There are reachable routes between <span class="keyword">Device</span>A and <span class="keyword">Device</span>B and between <span class="keyword">Device</span>A and <span class="keyword">Device</span>C.</p>
<div class="fignone" id="EN-US_TASK_0172372462__fig1"><a name="EN-US_TASK_0172372462__fig1"></a><a name="fig1"></a><span class="figcap"><b>Figure 1 </b>Establishing IPsec tunnels in IPsec policy template mode</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface1 and interface2 represent GE<span>0/1/1</span> and GE<span>0/1/2</span>, respectively.</p>
</div></div>
<br><span><img class="imgResize" src="images/fig_dc_vrp_ipsec_cfg_all_002801.png" width="518.7" height="256.708886" title="Click to enlarge"></span></div>
<p>For security purposes, mutual access between networks A and B as well as between networks A and C is required, whereas networks B and C cannot communicate with each other.</p>
</div></div>
<div class="context"><a name="EN-US_TASK_0172372462__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure IP addresses for interfaces.</p>
</li><li>Enable IPsec.</li><li><p>Configure ACLs to define the data flows to be protected.</p>
</li><li><p>Configure IPsec proposals. Specify ESP as the security protocol, SHA2-256 as the authentication algorithm, and AES-256 as the encryption algorithm.</p>
</li><li><p>Configure IKE proposals. Specify SHA2-256 and pre-shared key authentication as the authentication algorithm and authentication method, respectively. In addition, set the DH group identifier used for key negotiation to group14.</p>
</li><li><p>Configure IKE peers.</p>
</li><li><p>Configure an IPsec policy template on <span class="keyword">Device</span>A. In addition, configure IPsec policies on <span class="keyword">Device</span>B and <span class="keyword">Device</span>C.</p>
</li><li><p>Configure IPsec service-instance groups.</p>
</li><li><p>Create and configure tunnel interfaces. Then, apply the IPsec policies to the tunnel interfaces.</p>
</li><li><p>Configure public network routes (typically static routes).</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172372462__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li>IP addresses of interfaces</li><li>IP addresses of tunnel interfaces</li><li>IP address segment of each subnet</li><li>Pre-shared key</li><li>Security protocol, encryption algorithm, and authentication algorithm to be used for the IPsec proposals</li><li>Authentication algorithm to be used for the IKE proposals</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172372462__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure device names and interface IP addresses.</span><p><p>For detailed configurations, see Configuration Files.</p>
</p></li><li><span>Enable IPsec.</span><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0172372462__en-us_task_0172372456_p117511759135415">Before configuring IPsec on the main control board, you do not need to enable IPsec. However, before configuring IPsec on the VSUP, run the <a href="cmdqueryname=undo+vsm+on-board-mode+disable"><b><span class="cmdname" id="EN-US_TASK_0172372462__en-us_task_0172372456_cmdname875120597541">vsm on-board-mode disable</span></b></a> command in the system view and then perform the following steps to enable this function. After the <a href="cmdqueryname=undo+vsm+on-board-mode+disable"><b><span class="cmdname" id="EN-US_TASK_0172372462__en-us_task_0172372456_cmdname170645338343411">vsm on-board-mode disable</span></b></a> command is run, IPsec cannot be configured on the main control board.</p>
<p id="EN-US_TASK_0172372462__en-us_task_0172372456_p139996451366">Only the following models support this configuration:</p>
<p id="EN-US_TASK_0172372462__en-us_task_0172372456_p18999144516617">NE40E-M2K</p>
<p id="EN-US_TASK_0172372462__en-us_task_0172372456_p8084616613">NE40E-M2K-B</p>
</div></div>
</p><p><p># Configure <span class="keyword">Device</span>A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>license</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA-license] <strong>active ipsec bandwidth-enhance 40 slot </strong><strong><span>1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceA-license] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
<p># Configure <span class="keyword">Device</span>B.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB] <strong>license</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB-license] <strong>active ipsec bandwidth-enhance 40 slot </strong><strong><span>1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceB-license] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>commit</strong></pre>
<p># Configure <span class="keyword">Device</span>C.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceC] <strong>license</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceC-license] <strong>active ipsec bandwidth-enhance 40 slot </strong><strong><span>1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceC-license] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C] <strong>commit</strong></pre>
</p></li><li><span>Define the data flows to be protected.</span><p><p># Configure <span class="keyword">Device</span>A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>acl 3000</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-acl-adv-3000] <strong>rule permit ip </strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-acl-adv-3000] <strong>quit</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, the ACL rule permits all IP packets to pass through, so that you can conveniently add or delete peer devices. In addition, the ACL rule takes effect according to the generated route, avoiding risks.</p>
</div></div>
<p># Configure <span class="keyword">Device</span>B.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>acl 3000</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-acl-adv-3000] <strong>rule 5 permit ip source 10.2.1.2 0.0.0.0 destination 10.1.1.2 0.0.0.0</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-acl-adv-3000] <strong>quit</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>commit</strong></pre>
<p># Configure <span class="keyword">Device</span>C.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C] <strong>acl 3000</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>C-acl-adv-3000] <strong>rule 10 permit ip source 10.3.1.2 0.0.0.0 destination 10.1.1.2 0.0.0.0</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>C-acl-adv-3000] <strong>quit</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>C] <strong>commit</strong></pre>
</p></li><li><span>Configure IPsec proposals.</span><p><p># Configure <span class="keyword">Device</span>A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>ipsec proposal tran1</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-ipsec-proposal-tran1] <strong>encapsulation-mode tunnel</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-ipsec-proposal-tran1] <strong>transform esp</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-ipsec-proposal-tran1] <strong>esp authentication-algorithm sha2-256</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-ipsec-proposal-tran1] <strong>esp encryption-algorithm aes 256</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-ipsec-proposal-tran1] <strong>quit</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
<p># Configure <span class="keyword">Device</span>B.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>ipsec proposal tran1</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-ipsec-proposal-tran1] <strong>encapsulation-mode tunnel</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-ipsec-proposal-tran1] <strong>transform esp</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-ipsec-proposal-tran1] <strong>esp authentication-algorithm sha2-256</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-ipsec-proposal-tran1] <strong>esp encryption-algorithm aes 256</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-ipsec-proposal-tran1] <strong>quit</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>commit</strong></pre>
<p># Configure <span class="keyword">Device</span>C.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C] <strong>ipsec proposal tran1</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>C-ipsec-proposal-tran1] <strong>encapsulation-mode tunnel</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>C-ipsec-proposal-tran1] <strong>transform esp</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>C-ipsec-proposal-tran1] <strong>esp authentication-algorithm sha2-256</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>C-ipsec-proposal-tran1] <strong>esp encryption-algorithm aes 256</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>C-ipsec-proposal-tran1] <strong>quit</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>C] <strong>commit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>ESP is the default security protocol, and the tunnel mode is the default encapsulation mode. They do not need to be configured.</p>
</div></div>
</p></li><li><span>Configure IKE proposals.</span><p><p># Configure <span class="keyword">Device</span>A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>ike proposal 10</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-ike-proposal-10] <strong>authentication-method pre-share</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-ike-proposal-10] <strong>authentication-algorithm sha2-256</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-ike-proposal-10] <strong>dh group14</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-ike-proposal-10] <strong>quit</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
<p># Configure <span class="keyword">Device</span>B.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>ike proposal 10</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-ike-proposal-10] <strong>authentication-method pre-share</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-ike-proposal-10] <strong>authentication-algorithm sha2-256</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-ike-proposal-10] <strong>dh group14</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-ike-proposal-10] <strong>quit</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>commit</strong></pre>
<p># Configure <span class="keyword">Device</span>C.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C] <strong>ike proposal 10</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>C-ike-proposal-10] <strong>authentication-method pre-share</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>C-ike-proposal-10] <strong>authentication-algorithm sha2-256</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>C-ike-proposal-10] <strong>dh group14</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>C-ike-proposal-10] <strong>quit</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>C] <strong>commit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Pre-shared-key-based authentication is the default IKE authentication method and does not need to be configured.</p>
</div></div>
</p></li><li><span>Configure IKE peers.</span><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The pre-shared key configured on the local device must be the same as that configured on the peer device.</p>
</div></div>
</p><p><p># Configure <span class="keyword">Device</span>A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>ike peer p1</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-ike-peer-p1] <strong>ike-proposal 10</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-ike-peer-p1] <strong>pre-shared-key abcde</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-ike-peer-p1] <strong>quit</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
<p># Configure <span class="keyword">Device</span>B.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>ike peer a</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-ike-peer-a] <strong>ike-proposal 10</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-ike-peer-a] <strong>remote-address 192.168.1.1</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-ike-peer-a] <strong>pre-shared-key abcde</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-ike-peer-a] <strong>quit</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>commit</strong></pre>
<p># Configure <span class="keyword">Device</span>C.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C] <strong>ike peer a</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>C-ike-peer-a] <strong>ike-proposal 10</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>C-ike-peer-a] <strong>remote-address 192.168.1.1</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>C-ike-peer-a] <strong>pre-shared-key abcde</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>C-ike-peer-a] <strong>quit</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>C] <strong>commit</strong></pre>
</p></li><li><span>Configure DPD.</span><p><p># Configure <span class="keyword">Device</span>A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>ike dpd interval 10 10</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
<p># Configure <span class="keyword">Device</span>B.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>ike dpd interval 10 10</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>commit</strong></pre>
<p># Configure <span class="keyword">Device</span>C.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C] <strong>ike dpd interval 10 10</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>C] <strong>commit</strong></pre>
</p></li><li><span>Configure an IPsec policy template and IPsec policies.</span><p><p># Configure an IPsec policy template on <span class="keyword">Device</span>A and enable IPsec policies to reference the template.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>ipsec policy-template map_temp 1</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-ipsec-policy-templet-map_temp-1] <strong>security acl 3000</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-ipsec-policy-templet-map_temp-1] <strong>proposal tran1</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-ipsec-policy-templet-map_temp-1] <strong>ike-peer p1</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-ipsec-policy-templet-map_temp-1] <strong>quit</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>ipsec policy map1 10 isakmp template map_temp</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The name of an IPsec policy template must be different from that of an IPsec policy.</p>
</div></div>
<p># Configure an IPsec policy on <span class="keyword">Device</span>B.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>ipsec policy map1 10 isakmp</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-ipsec-policy-isakmp-map1-10] <strong>security acl 3000</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-ipsec-policy-isakmp-map1-10] <strong>proposal tran1</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-ipsec-policy-isakmp-map1-10] <strong>ike-peer a</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-ipsec-policy-isakmp-map1-10] <strong>quit</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>commit</strong></pre>
<p># Configure an IPsec policy on <span class="keyword">Device</span>C.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C] <strong>ipsec policy map1 10 isakmp</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>C-ipsec-policy-isakmp-map1-10] <strong>security acl 3000</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>C-ipsec-policy-isakmp-map1-10] <strong>proposal tran1</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>C-ipsec-policy-isakmp-map1-10] <strong>ike-peer a</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>C-ipsec-policy-isakmp-map1-10] <strong>quit</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>C] <strong>commit</strong></pre>
</p></li><li><span>Configure IPsec service-instance groups.</span><p><p># Configure DeviceA.</p>
<pre class="screen">[<span class="keyword" id="EN-US_TASK_0172372462__en-us_task_0172372456_keyword18368112072915"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword" id="EN-US_TASK_0172372462__en-us_task_0172372456_keyword203689202297">Device</span>A] <strong id="EN-US_TASK_0172372462__en-us_task_0172372456_b174511145153516">service-location 1</strong>
[<span class="keyword" id="EN-US_TASK_0172372462__en-us_task_0172372456_keyword67402020182319">*</span><span class="keyword" id="EN-US_TASK_0172372462__en-us_task_0172372456_keyword1174012072316">Device</span>A-service-location-1] <strong id="EN-US_TASK_0172372462__en-us_task_0172372456_b17740420152317">location slot <span>1</span></strong>
[<span class="keyword" id="EN-US_TASK_0172372462__en-us_task_0172372456_keyword620412816254">*</span><span class="keyword" id="EN-US_TASK_0172372462__en-us_task_0172372456_keyword620418289256">Device</span>A-service-location-1] <strong id="EN-US_TASK_0172372462__en-us_task_0172372456_b12204128152517">commit</strong>
[<span class="keyword" id="EN-US_TASK_0172372462__en-us_task_0172372456_keyword10565183582515"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword" id="EN-US_TASK_0172372462__en-us_task_0172372456_keyword19565435132513">Device</span>A-service-location-1] <strong id="EN-US_TASK_0172372462__en-us_task_0172372456_b6565173514253">quit</strong>
[<span class="keyword" id="EN-US_TASK_0172372462__en-us_task_0172372456_keyword18171104111252"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword" id="EN-US_TASK_0172372462__en-us_task_0172372456_keyword4172184110257">Device</span>A] <strong id="EN-US_TASK_0172372462__en-us_task_0172372456_b141728413259">service-instance-group group1</strong>
[<span class="keyword" id="EN-US_TASK_0172372462__en-us_task_0172372456_keyword5278104714252">*</span><span class="keyword" id="EN-US_TASK_0172372462__en-us_task_0172372456_keyword1127834732511">Device</span>A-service-instance-group-group1] <strong id="EN-US_TASK_0172372462__en-us_task_0172372456_b17278447112512">service-location 1</strong>
[<span class="keyword" id="EN-US_TASK_0172372462__en-us_task_0172372456_keyword568811528251">*</span><span class="keyword" id="EN-US_TASK_0172372462__en-us_task_0172372456_keyword206881752172518">Device</span>A-service-instance-group-group1] <strong id="EN-US_TASK_0172372462__en-us_task_0172372456_b2688155215258">commit</strong>
[<span class="keyword" id="EN-US_TASK_0172372462__en-us_task_0172372456_keyword15762645264"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword" id="EN-US_TASK_0172372462__en-us_task_0172372456_keyword1176212402610">Device</span>A-service-instance-group-group1] <strong id="EN-US_TASK_0172372462__en-us_task_0172372456_b276210420264">quit</strong></pre>
<p># Configure DeviceB.</p>
<pre class="screen">[<span class="keyword" id="EN-US_TASK_0172372462__en-us_task_0172372456_keyword111029434572"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword" id="EN-US_TASK_0172372462__en-us_task_0172372456_keyword16102154320576">Device</span>B] <strong id="EN-US_TASK_0172372462__en-us_task_0172372456_b284612515345">service-location 1</strong>
[<span class="keyword" id="EN-US_TASK_0172372462__en-us_task_0172372456_keyword310410271218">*</span><span class="keyword" id="EN-US_TASK_0172372462__en-us_task_0172372456_keyword7104142718219">Device</span>B-service-location-1] <strong id="EN-US_TASK_0172372462__en-us_task_0172372456_b12104122715220">location slot <span>1</span></strong>
[<span class="keyword" id="EN-US_TASK_0172372462__en-us_task_0172372456_keyword101347471521">*</span><span class="keyword" id="EN-US_TASK_0172372462__en-us_task_0172372456_keyword121344476218">Device</span>B-service-location-1] <strong id="EN-US_TASK_0172372462__en-us_task_0172372456_b1613415474219">commit</strong>
[<span class="keyword" id="EN-US_TASK_0172372462__en-us_task_0172372456_keyword124521558329"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword" id="EN-US_TASK_0172372462__en-us_task_0172372456_keyword14452115813216">Device</span>B-service-location-1] <strong id="EN-US_TASK_0172372462__en-us_task_0172372456_b84527581526">quit</strong>
[<span class="keyword" id="EN-US_TASK_0172372462__en-us_task_0172372456_keyword146682129310"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword" id="EN-US_TASK_0172372462__en-us_task_0172372456_keyword1766810125312">Device</span>B] <strong id="EN-US_TASK_0172372462__en-us_task_0172372456_b2066811121738">service-instance-group group1</strong>
[<span class="keyword" id="EN-US_TASK_0172372462__en-us_task_0172372456_keyword283911714316">*</span><span class="keyword" id="EN-US_TASK_0172372462__en-us_task_0172372456_keyword118391817638">Device</span>B-service-instance-group-group1] <strong id="EN-US_TASK_0172372462__en-us_task_0172372456_b78392171033">service-location 1</strong>
[<span class="keyword" id="EN-US_TASK_0172372462__en-us_task_0172372456_keyword75710231534">*</span><span class="keyword" id="EN-US_TASK_0172372462__en-us_task_0172372456_keyword185710231139">Device</span>B-service-instance-group-group1] <strong id="EN-US_TASK_0172372462__en-us_task_0172372456_b18571123335">commit</strong>
[<span class="keyword" id="EN-US_TASK_0172372462__en-us_task_0172372456_keyword75801230431"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword" id="EN-US_TASK_0172372462__en-us_task_0172372456_keyword458013017310">Device</span>B-service-instance-group-group1] <strong id="EN-US_TASK_0172372462__en-us_task_0172372456_b35801301310">quit</strong></pre>
<p># Configure DeviceC.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceC] <strong>service-location 1</strong></pre>
<pre class="screen">[*DeviceC-service-location-1] <strong>location slot <span>1</span></strong></pre>
<pre class="screen">[*DeviceC-service-location-1] <strong>commit</strong></pre>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceC-service-location-1] <strong>quit</strong></pre>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceC] <strong>service-instance-group group1</strong></pre>
<pre class="screen">[*DeviceC-service-instance-group-group1] <strong>service-location 1</strong></pre>
<pre class="screen">[*DeviceC-service-instance-group-group1] <strong>commit</strong></pre>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceC-service-instance-group-group1] <strong>quit</strong></pre>
</p></li><li><span>Create and configure tunnel interfaces.</span><p><p># Configure <span class="keyword">Device</span>A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>interface Tunnel 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-Tunnel10] <strong>tunnel-protocol ipsec</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-Tunnel10] <strong>ip address 192.168.1.1 32</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-Tunnel10] <strong>ipsec policy map1 service-instance-group group1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-Tunnel10] <strong>quit</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
<p># Configure <span class="keyword">Device</span>B.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>interface Tunnel 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-Tunnel10] <strong>tunnel-protocol ipsec</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-Tunnel10] <strong>ip address 192.168.2.1 32</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-Tunnel10] <strong>ipsec policy map1 service-instance-group group1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-Tunnel10] <strong>quit</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>commit</strong></pre>
<p># Configure <span class="keyword">Device</span>C.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C] <strong>interface Tunnel 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-Tunnel10] <strong>tunnel-protocol ipsec</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-Tunnel10] <strong>ip address 192.168.3.1 32</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C-Tunnel10] <strong>ipsec policy map1 service-instance-group group1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-Tunnel10] <strong>quit</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>C] <strong>commit</strong></pre>
</p></li><li><span>Configure static routes.</span><p><p>Static routes are used to steer data traffic to IPsec tunnels.</p>
<p># Configure <span class="keyword">Device</span>A. Assume that the next hop IP address of <span class="keyword">Device</span>A is 172.16.163.2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>ip route-static 0.0.0.0 0.0.0.0 172.16.163.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
<p># Configure <span class="keyword">Device</span>B. Assume that the next hop IP address of <span class="keyword">Device</span>B is 172.16.169.2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>ip route-static 10.1.1.0 255.255.255.0 Tunnel 10 192.168.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>ip route-static 192.168.1.1 255.255.255.255 172.16.169.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>commit</strong></pre>
<p># Configure <span class="keyword">Device</span>C. Assume that the next hop IP address of <span class="keyword">Device</span>C is 172.16.170.2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C] <strong>ip route-static 10.1.1.0 255.255.255.0 Tunnel 10 192.168.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C] <strong>ip route-static 192.168.1.1 255.255.255.255 172.16.170.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C] <strong>commit</strong></pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172372462__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p><span class="keyword">Device</span>A configuration file</p>
<pre class="screen">#
 sysname <span class="keyword">Device</span>A</pre>
<pre class="screen">#
license
 active ipsec bandwidth-enhance 40 slot <span>1</span> //Perform this configuration for the VSUP.</pre>
<pre class="screen">#
service-location 1
 location slot <span>1</span>
#
service-instance-group group1
 service-location 1</pre>
<pre class="screen">#
ike dpd interval 10 10
#
acl number 3000
  rule 5 permit ip
#
ike proposal 10
 encryption-algorithm aes-cbc 256
 dh group14
 authentication-algorithm sha2-256
 integrity-algorithm hmac-sha2-256
#
ike peer p1
 pre-shared-key cipher %^%#.EJ<font style="font-size:8pt" Face="Courier New" >~</font>F"jURXr&amp;0--*9[2(uLl^I@0_]XBJe;=-0x,V%^%#
 ike-proposal 10
#
ipsec proposal tran1
 esp authentication-algorithm sha2-256
 esp encryption-algorithm aes 256
#
ipsec policy-template map_temp 1
 security acl 3000
 ike-peer p1
 proposal tran1
#
ipsec policy map1 10 isakmp template map_temp
#
interface GigabitEthernet<span>0/1/1</span> 
 undo shutdown
 ip address 10.1.1.1 255.255.255.0 
#
interface GigabitEthernet<span>0/1/2</span>  
 undo shutdown
 ip address 172.16.163.1 255.255.255.0
#
interface Tunnel 10
 ip address 192.168.1.1 255.255.255.0
 tunnel-protocol ipsec</pre>
<pre class="screen"> ipsec policy map1 service-instance-group group1</pre>
<pre class="screen">#
ip route-static 0.0.0.0 0.0.0.0 172.16.163.2
#
return</pre>
</li><li><p><span class="keyword">Device</span>B configuration file</p>
<pre class="screen">#
 sysname <span class="keyword">Device</span>B</pre>
<pre class="screen">#
license
 active ipsec bandwidth-enhance 40 slot <span>1</span> //Perform this configuration for the VSUP.</pre>
<pre class="screen">#
service-location 1
 location slot <span>1</span>
#
service-instance-group group1
 service-location 1</pre>
<pre class="screen">#
ike dpd interval 10 10
#
acl number 3000
  rule 5 permit ip source 10.1.2.2 0 destination 10.1.1.2 0
#
ike proposal 10
 encryption-algorithm aes-cbc 256
 dh group14
 authentication-algorithm sha2-256
 integrity-algorithm hmac-sha2-256
#
ike peer a
 pre-shared-key cipher %^%#.EJ<font style="font-size:8pt" Face="Courier New" >~</font>F"jURXr&amp;0--*9[2(uLl^I@0_]XBJe;=-0x,V%^%#
 ike-proposal 10
 remote-address 192.168.1.1
#
ipsec proposal tran1
 esp authentication-algorithm sha2-256  
 esp encryption-algorithm aes 256
#
ipsec policy map1 10 isakmp
 security acl 3000
 ike-peer a
 proposal tran1
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 10.1.2.1 255.255.255.0
#
interface GigabitEthernet<span>0/1/2</span> 
 undo shutdown
 ip address 172.16.169.1 255.255.255.0
#
interface Tunnel10 
 ip address 192.168.1.2 255.255.255.255
 tunnel-protocol ipsec
 ipsec policy map1 service-instance-group group1
#
 ip route-static 10.1.1.0 255.255.255.0 Tunnel 10 192.168.1.1
 ip route-static 192.168.1.1 255.255.255.255 172.16.169.2
#
return</pre>
</li><li><p><span class="keyword">Device</span>C configuration file</p>
<pre class="screen">#
 sysname <span class="keyword">Device</span>C</pre>
<pre class="screen">#
license
 active ipsec bandwidth-enhance 40 slot <span>1</span> //Perform this configuration for the VSUP.</pre>
<pre class="screen">#
service-location 1
 location slot <span>1</span>
#
service-instance-group group1
 service-location 1</pre>
<pre class="screen">#
ike dpd interval 10 10
#
acl number 3000
  rule 10 permit ip source 10.1.3.2 0 destination 10.1.1.2 0
#
ike proposal 10
 encryption-algorithm aes-cbc 256
 dh group14
 authentication-algorithm sha2-256
 integrity-algorithm hmac-sha2-256
#
ike peer a
 pre-shared-key cipher %^%#.EJ<font style="font-size:8pt" Face="Courier New" >~</font>F"jURXr&amp;0--*9[2(uLl^I@0_]XBJe;=-0x,V%^%#
 ike-proposal 10
 remote-address 192.168.1.1
#
ipsec proposal tran1
 esp authentication-algorithm sha2-256
 esp encryption-algorithm aes 256
#
ipsec policy map1 10 isakmp
 security acl 3000
 ike-peer a
 proposal tran1
#
interface GigabitEthernet<span>0/1/1</span> 
 undo shutdown
 ip address 10.1.3.1 255.255.255.0
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ip address 172.16.170.1 255.255.255.0
#
interface Tunnel10
 ip address 192.168.1.3 255.255.255.255
 tunnel-protocol ipsec
 ipsec policy map1 service-instance-group group1
#
 ip route-static 10.1.1.0 255.255.255.0 Tunnel 10 192.168.1.1
 ip route-static 192.168.1.1 255.255.255.255 172.16.170.2
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ipsec_cfg_all_0039.html">Configuring IPsec in IKE Auto-Negotiation Mode
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ipsec_cfg_0033.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>

<script language="JavaScript">
<!--
image_size('.imgResize');
var msg_imageMax = "view original image";
var msg_imageClose = "close";
//--></script></body>
</html>