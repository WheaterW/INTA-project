
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring Static BGP IPv6 VPN Flow Specification">
<meta name="abstract" content="In IPv6 VPNs, BGP IPv6 VPN Flow Specification routes are generated manually to control traffic in static BGP IPv6 VPN Flow Specification.">
<meta name="description" content="In IPv6 VPNs, BGP IPv6 VPN Flow Specification routes are generated manually to control traffic in static BGP IPv6 VPN Flow Specification.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_flowspec_cfg_0000.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_flowspec_cfg_0022.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_flowspec_cfg_0018.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="z00603461,w00800033,flow-specificationvrp,w00556928,w00606909,l00455378,z00805567">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="BGP Flow Specfication">
<meta name="featuretype" content="Security">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP Flow Specfication">
<meta name="featuretype" content="Security">
<meta name="OWNER" content="h00522387">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00615954">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172372351">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring Static BGP IPv6 VPN Flow Specification</title>
</head>
<body><a name="EN-US_TASK_0172372351"></a><a name="EN-US_TASK_0172372351"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring Static BGP IPv6 VPN Flow Specification</h1>
<div class="taskbody"><p>In IPv6 VPNs, BGP IPv6 VPN Flow Specification routes are generated manually to control traffic in static BGP IPv6 VPN Flow Specification.</p>
<div class="context"><a name="EN-US_TASK_0172372351__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Usage Scenario</h4><p>When deploying static BGP IPv6 VPN Flow Specification, a BGP IPv6 VPN Flow Specification route needs to be generated manually, and a BGP IPv6 VPN Flow Specification peer relationship needs to be established between the device that generates the BGP IPv6 VPN Flow Specification route and each ingress in the network to transmit BGP IPv6 VPN Flow Specification routes.</p>
<p>In an AS with multiple ingresses, a BGP IPv6 VPN Flow route reflector (Flow RR) can be deployed to reduce the number of BGP IPv6 VPN Flow Specification peer relationships and save network resources.</p>
<p>If you want to filter traffic based on the address prefix but the BGP IPv6 VPN Flow Specification route carrying the filtering rule cannot pass validation, disable the validation of BGP IPv6 VPN Flow Specification routes received from a specified peer.</p>
</div></div>
<div class="context"><a name="EN-US_TASK_0172372351__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Pre-configuration Tasks</h4><p>Before configuring static BGP IPv6 VPN Flow Specification, <a href="dc_vrp_mpls-l3vpn-v6_cfg_2058.html">configure a VPN instance</a> and <a href="dc_vrp_mpls-l3vpn-v6_cfg_2059.html">bind interfaces to a VPN instance</a>.</p>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172372351__1.4.3"></a><a name="1.4.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Generate a BGP IPv6 VPN Flow Specification route manually.</span><ol type="a"><li class="substepexpand"><span>Run <span><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=flow-route+ipv6+vpn-instance"><b><span class="cmdname">flow-route</span></b></a> <i><span class="varname">flowroute-name</span></i> <strong><span>ipv6</span></strong> <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i></span></span><p><p>A static BGP IPv6 VPN Flow Specification route is created, and the Flow-Route IPv6 VPN instance view is displayed.</p>
</p><p><div class="p">One BGP IPv6 VPN Flow Specification route can include multiple <strong>if-match</strong> and <strong>apply</strong> clauses. <strong>if-match</strong> clauses define traffic filtering rules, and <strong>apply</strong> clauses define traffic behaviors. The relationships among clauses are as follows:<ul><li><p>The relationship among <strong>if-match</strong> clauses of different types is "AND."</p>
</li><li><p>If <strong>if-match</strong> clauses of the same type are configured repeatedly, some rules override each other, and some other rules are in the OR relationship. For details, see the precautions for the <a href="cmdqueryname=if-match"><b><span class="cmdname">if-match</span></b></a> command.</p>
</li><li><p>The relationship among the traffic behaviors defined by <strong>apply</strong> clauses is "AND."</p>
</li></ul>
The traffic behaviors defined by <strong>apply</strong> clauses apply to all traffic matching the filtering rules of <strong>if-match</strong> clauses.</div>
</p></li><li class="substepexpand"><span>According to characteristics of the traffic to be controlled, you can configure one or more <strong>if-match</strong> clauses to define traffic filtering rules as needed:</span><p><ul><li><p>To set a destination address-based traffic filtering rule, run the <a href="cmdqueryname=if-match+destination"><b><span class="cmdname">if-match destination</span></b></a> <i><span class="varname">ipv6-address</span></i> { <i><span class="varname">mask</span></i> | <i><span class="varname">mask-length</span></i> } command.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Traffic control is performed based on a specified destination IP address specified in a rule configured using the <a href="cmdqueryname=if-match+destination"><b><span class="cmdname">if-match destination</span></b></a> command, but BGP IPv6 VPN Flow Specification routes matching the rule cannot pass validation. In this situation, run the <a href="cmdqueryname=peer+validation-disable"><b><span class="cmdname">peer validation-disable</span></b></a> command to disable the validation.</p>
<p>By default, 0.0.0.0/0 is used as the prefix of each BGP IPv6 VPN Flow Specification route that matches the export or import policy of a peer. To enable a device to change the prefix of each BGP IPv6 VPN Flow Specification route that matches the export or import policy of a peer to the destination IP address specified in the <a href="cmdqueryname=if-match+destination"><b><span class="cmdname">if-match destination</span></b></a> command, run the <a href="cmdqueryname=route+match-destination"><b><span class="cmdname">route match-destination</span></b></a> command.</p>
</div></div>
</li><li><p>To configure a filtering rule based on the source address, run the <a href="cmdqueryname=if-match+source"><b><span class="cmdname">if-match source</span></b></a> <i><span class="varname">ipv6-address</span></i> { <i><span class="varname">mask</span></i> | <i><span class="varname">mask-length</span></i> } command.</p>
</li><li><p>To set a port number-based traffic filtering rule, run the <a href="cmdqueryname=if-match+port+greater-than+less-than+equal"><b><span class="cmdname">if-match port</span></b></a> { <strong><span>greater-than</span></strong> | <strong><span>less-than</span></strong> | <strong><span>equal</span></strong> } <i><span class="varname">port</span></i> or <a href="cmdqueryname=if-match+port+greater-than+less-than"><b><span class="cmdname">if-match port</span></b></a> <strong><span>greater-than</span></strong> <i><span class="varname">port</span></i> <strong><span>less-than</span></strong> <i><span class="varname">upper-port-value</span></i> command.</p>
</li><li><p>To set a source port number-based traffic filtering rule, run the <a href="cmdqueryname=if-match+source-port+greater-than+less-than+equal"><b><span class="cmdname">if-match source-port</span></b></a> { <strong><span>greater-than</span></strong> | <strong><span>less-than</span></strong> | <strong><span>equal</span></strong> } <i><span class="varname">port</span></i> or <a href="cmdqueryname=if-match+source-port+greater-than+less-than"><b><span class="cmdname">if-match source-port</span></b></a> <strong><span>greater-than</span></strong> <i><span class="varname">source-port</span></i> <strong><span>less-than</span></strong> <i><span class="varname">upper-source-port-value</span></i> command.</p>
</li><li><p>To set a destination port number-based traffic filtering rule, run the <a href="cmdqueryname=if-match+destination-port+greater-than+less-than+equal"><b><span class="cmdname">if-match destination-port</span></b></a> { <strong><span>greater-than</span></strong> | <strong><span>less-than</span></strong> | <strong><span>equal</span></strong> } <i><span class="varname">port</span></i> or <a href="cmdqueryname=if-match+destination-port+greater-than+less-than"><b><span class="cmdname">if-match destination-port greater-than </span></b></a><i><span class="varname">port</span></i> <strong><span>less-than</span></strong> <i><span class="varname">upper-port-value</span></i> command.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p><a href="cmdqueryname=if-match+port"><b><span class="cmdname">if-match port</span></b></a> and <a href="cmdqueryname=if-match+destination-port"><b><span class="cmdname">if-match destination-port</span></b></a> or <a href="cmdqueryname=if-match+source-port"><b><span class="cmdname">if-match source-port</span></b></a> are mutually exclusive.</p>
</div></div>
</li><li><p>To set a traffic bearing protocol-based traffic filtering rule, run the <a href="cmdqueryname=if-match+protocol+greater-than+less-than+equal"><b><span class="cmdname">if-match protocol</span></b></a> { <strong><span>greater-than</span></strong> | <strong><span>less-than</span></strong> | <strong><span>equal</span></strong> } <i><span class="varname">protocol</span></i> or <a href="cmdqueryname=if-match+protocol+greater-than+less-than"><b><span class="cmdname">if-match protocol</span></b></a> <strong><span>greater-than</span></strong> <i><span class="varname">protocol</span></i> <strong><span>less-than</span></strong> <i><span class="varname">upper-protocol-value</span></i> command.</p>
</li><li><p>To set a DSCP-based traffic filtering rule, run the <a href="cmdqueryname=if-match+dscp+greater-than+less-than+equal"><b><span class="cmdname">if-match dscp</span></b></a> { <strong><span>greater-than</span></strong> | <strong><span>less-than</span></strong> | <strong><span>equal</span></strong> } <i><span class="varname">dscp</span></i> or <a href="cmdqueryname=if-match+dscp+greater-than+less-than"><b><span class="cmdname">if-match dscp</span></b></a> <strong><span>greater-than</span></strong> <i><span class="varname">dscp</span></i> <strong><span>less-than</span></strong> <i><span class="varname">upper-dscp-value</span></i> command.</p>
</li><li><p>To set a TCP-flag value-based traffic filtering rule, run the <a href="cmdqueryname=if-match+tcp-flags+match+not"><b><span class="cmdname">if-match tcp-flags</span></b></a> { <strong><span>match</span></strong> | <strong><span>not</span></strong> | <strong><span>any-match</span></strong> } <i><span class="varname">tcp-flags</span></i> command.</p>
<p>Network attackers may send a large number of invalid TCP packets to attack network devices. To control invalid TCP packets to ensure communication security, configure a filtering rule based on the TCP flag for the BGP IPv6 VPN Flow Specification route using the <a href="cmdqueryname=if-match+tcp-flags"><b><span class="cmdname">if-match tcp-flags</span></b></a> command. Traffic matching the TCP flag is filtered or controlled using the actions specified in the apply clauses.</p>
</li><li><p>To set a fragment type-based traffic filtering rule, run the <a href="cmdqueryname=if-match+fragment-type+match+not"><b><span class="cmdname">if-match fragment-type</span></b></a> { <strong><span>match</span></strong> | <strong><span>not</span></strong> } <i><span class="varname">fragment-type-name</span></i> command.</p>
</li><li>To set an ICMP message code-based traffic filtering rule, run the <a href="cmdqueryname=if-match+icmp-code+greater-than+less-than+equal"><b><span class="cmdname">if-match icmp-code</span></b></a> { <strong><span>greater-than</span></strong> | <strong><span>less-than</span></strong> | <strong><span>equal</span></strong> } <i><span class="varname">icmp-code</span></i> or <a href="cmdqueryname=if-match+icmp-code+greater-than+less-than"><b><span class="cmdname">if-match icmp-code</span></b></a> <strong><span>greater-than</span></strong> <i><span class="varname">icmp-code</span></i> <strong><span>less-than</span></strong> <i><span class="varname">upper-icmp-code-value</span></i> command.</li><li><p>To set an ICMP message type-based traffic filtering rule, run the <a href="cmdqueryname=if-match+icmp-type+greater-than+less-than+equal"><b><span class="cmdname">if-match icmp-type</span></b></a> { <strong><span>greater-than</span></strong> | <strong><span>less-than</span></strong> | <strong><span>equal</span></strong> } <i><span class="varname">icmp-type</span></i> or <a href="cmdqueryname=if-match+icmp-type+greater-than+less-than"><b><span class="cmdname">if-match icmp-type</span></b></a> <strong><span>greater-than</span></strong> <i><span class="varname">icmp-type</span></i> <strong><span>less-than</span></strong> <i><span class="varname">upper-icmp-type-value</span></i> command.</p>
</li><li><p>To set a filtering rule based on the packet length of a BGP IPv6 VPN Flow Specification route, run the <a href="cmdqueryname=if-match+packet-length+greater-than+less-than+equal"><b><span class="cmdname">if-match packet-length</span></b></a> { <strong><span>greater-than</span></strong> | <strong><span>less-than</span></strong> | <strong><span>equal</span></strong> } <i><span class="varname">packet-length-value</span></i> or <a href="cmdqueryname=if-match+packet-length+greater-than+less-than"><b><span class="cmdname">if-match packet-length</span></b></a> <strong><span>greater-than</span></strong> <i><span class="varname">packet-length-value</span></i> <strong><span>less-than</span></strong> <i><span class="varname">upper-packet-length-value</span></i> command.</p>
</li></ul>
</p></li><li class="substepexpand"><span>Run the following command as required to configure actions for apply clauses:</span><p><ul><li><p>To discard the matched traffic, run the <a href="cmdqueryname=apply+deny"><b><span class="cmdname">apply deny</span></b></a> command.</p>
</li><li><p>To redirect the matched traffic to the traffic cleaning device or blackhole, run the <a href="cmdqueryname=apply+redirect+vpn-target"><b><span class="cmdname">apply redirect</span></b></a> <strong><span>vpn-target</span></strong> <i><span class="varname">vpn-target-import</span></i> command.</p>
</li><li><p>To re-mark the service class of the matched traffic, run the <a href="cmdqueryname=apply+remark-dscp"><b><span class="cmdname">apply remark-dscp</span></b></a> command.</p>
</li><li><p>To limit the rate of the matched traffic, run the <a href="cmdqueryname=apply+traffic-rate"><b><span class="cmdname">apply traffic-rate</span></b></a> command.</p>
</li><li><p>To implement sampling for the matched traffic, run the <a href="cmdqueryname=apply+traffic-action+sample"><b><span class="cmdname">apply traffic-action sample</span></b></a> command.</p>
<p>You can run the <a href="cmdqueryname=apply+traffic-action+sample"><b><span class="cmdname">apply traffic-action sample</span></b></a> command for a BGP IPv6 VPN Flow Specification route to sample the traffic that matches the specified filtering rules. Through sampling, abnormal traffic can be identified and filtered out, which protects the attacked device and improves network security.</p>
</li><li>To redirect the matched traffic to the IPv6 address of a specified next hop, run the <a href="cmdqueryname=apply+redirect+ipv6+color+prefix-sid+color+prefix-sid"><b><span class="cmdname">apply redirect ipv6</span></b></a> <i><span class="varname">redirect-ipv6-rt</span></i> [ <strong><span>color</span></strong> <i><span class="varname">colorValue</span></i> [ <strong><span>prefix-sid</span></strong> <i><span class="varname">prefix-sid-value</span></i> ] ] command.<p>The <a href="cmdqueryname=apply+redirect+ipv6"><b><span class="cmdname">apply redirect ipv6</span></b></a> <i><span class="varname">redirect-ipv6-rt</span></i> command must be used together with the <a href="cmdqueryname=local-route+redirect+ipv6+recursive-lookup+ip"><b><span class="cmdname">local-route redirect ipv6 recursive-lookup ip</span></b></a> command so that the matched traffic can be redirected to the IPv6 address of the specified next hop.</p>
<p>The <a href="cmdqueryname=apply+redirect+ipv6+color+prefix-sid"><b><span class="cmdname">apply redirect ipv6</span></b></a> <i><span class="varname">redirect-ipv6-rt</span></i> <strong><span>color</span></strong> <i><span class="varname">colorValue</span></i> <strong><span>prefix-sid</span></strong> <i><span class="varname">prefix-sid-value</span></i> command must be used together with the <a href="cmdqueryname=local-route+redirect+ipv6+recursive-lookup+tunne+tunnel-selector"><b><span class="cmdname">local-route redirect ipv6 recursive-lookup tunne</span></b></a>l <strong><span>tunnel-selector</span></strong> <i><span class="varname">tunnel-selector-name</span></i> command to trigger tunnel recursion.</p>
</li></ul>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The <a href="cmdqueryname=apply+deny"><b><span class="cmdname">apply deny</span></b></a> and <a href="cmdqueryname=apply+traffic-rate"><b><span class="cmdname">apply traffic-rate</span></b></a> commands are mutually exclusive.</p>
<p>If the configured BGP IPv6 VPN Flow Specification route attribute does not need to take effect locally, run the <a href="cmdqueryname=routing-table+rib-only+route-policy"><b><span class="cmdname">routing-table rib-only</span></b></a> [ <strong><span>route-policy</span></strong> <i><span class="varname">route-policy-name</span></i><span> | <strong><span>route-filter</span></strong> <i><span class="varname">route-filter-name</span></i></span> ] command to disable the device from delivering the BGP IPv6 VPN Flow Specification route to the FES forwarding table.</p>
</div></div>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li><span>Establish a BGP IPv6 VPN Flow Specification peer relationship.</span><ol type="a"><li class="substepexpand"><span>Run <span><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span></span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=vpn-instance"><b><span class="cmdname">vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i></span></span><p><p>A BGP-VPN instance is created, and its view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=peer+as-number"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">ipv6-address</span></i> } <strong><span>as-number</span></strong> <i><span class="varname">as-number</span></i></span></span><p><p>An IP address and AS number are specified for the peer.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=ipv6-flow+vpn-instance"><b><span class="cmdname">ipv6-flow vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i></span></span><p><p>The BGP-Flow VPN instance IPv6 address family is enabled, and its view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">ipv6-address</span></i> } <a href="cmdqueryname=enable"><b><span class="cmdname">enable</span></b></a></span><p><p>A BGP IPv6 VPN Flow Specification peer relationship is established.</p>
</p><p><p>After the BGP IPv6 VPN Flow Specification peer relationship is established in the BGP-Flow VPN instance IPv6 address family view, the BGP IPv6 VPN Flow Specification route generated by the traffic analysis server is imported automatically to the BGP routing table and then sent to the peer.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li><span>(Optional) Configure a Flow RR.</span><p><p>Before configuring a Flow RR, establish a BGP IPv6 VPN Flow Specification peer relationship between the Flow RR with the device that generates the BGP IPv6 VPN Flow Specification route and every ingress.</p>
</p><ol type="a"><li class="substepexpand"><span>Run <span><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span></span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=ipv6-flow+vpn-instance"><b><span class="cmdname">ipv6-flow vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i></span></span><p><p>The BGP-Flow VPN instance IPv6 address family view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">ipv6-address</span></i> } <a href="cmdqueryname=reflect-client"><b><span class="cmdname">reflect-client</span></b></a></span><p><p>A Flow RR is configured, and clients are specified for it.</p>
</p><p><p>The <span class="keyword">Router</span> on which the <a href="cmdqueryname=peer+reflect-client"><b><span class="cmdname">peer reflect-client</span></b></a> command is run functions as a Flow RR, and the specified peers function as clients.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <span><a href="cmdqueryname=undo+reflect+between-clients"><b><span class="cmdname">undo reflect between-clients</span></b></a></span></span><p><p>Route reflection between clients through the RR is disabled.</p>
</p><p><p>If the clients of a Flow RR are fully meshed, you can run the <a href="cmdqueryname=undo+reflect+between-clients"><b><span class="cmdname">undo reflect between-clients</span></b></a> command on the Flow RR to disable route reflection between clients through the RR, which reduces costs.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=reflector+cluster-id"><b><span class="cmdname">reflector cluster-id</span></b></a> { <i><span class="varname">cluster-id-value</span></i> | <i><span class="varname">cluster-id-ipv4</span></i> }</span><p><p>A cluster ID is configured for the Flow RR.</p>
</p><p><p>If a cluster has multiple flow RRs, run this command to set the same <i><span class="varname">cluster-id</span></i> for these RRs.</p>
<p>The <a href="cmdqueryname=reflector+cluster-id"><b><span class="cmdname">reflector cluster-id</span></b></a> command is applicable only to Flow RRs.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li><span>(Optional) Configure the device to check the AS_Path attribute during BGP IPv6 VPN Flow Specification route validation.</span><ol type="a" id="EN-US_TASK_0172372351__en-us_task_0172372350_substeps2059911503214101"><li class="substepexpand" id="EN-US_TASK_0172372351__en-us_task_0172372350_substep1879660553214101"><span id="EN-US_TASK_0172372351__en-us_task_0172372350_cmd1970466901214101">Run <a href="cmdqueryname=system-view"><b><span class="cmdname" id="EN-US_TASK_0172372351__en-us_task_0172372350_cmdname1646817870214101">system-view</span></b></a></span><p><p id="EN-US_TASK_0172372351__en-us_task_0172372350_p1184812121111">The system view is displayed.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0172372351__en-us_task_0172372350_substep707367709214101"><span id="EN-US_TASK_0172372351__en-us_task_0172372350_cmd259615371214101">Run <a href="cmdqueryname=bgp"><b><span class="cmdname" id="EN-US_TASK_0172372351__en-us_task_0172372350_cmdname1437326922214101">bgp</span></b></a> <i><span class="varname" id="EN-US_TASK_0172372351__en-us_task_0172372350_varname1994514065919">as-number</span></i></span><p><p id="EN-US_TASK_0172372351__en-us_task_0172372350_p11993131610111">The BGP view is displayed.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0172372351__en-us_task_0172372350_substep902455597214101"><span id="EN-US_TASK_0172372351__en-us_task_0172372350_cmd2041703665214101">Run <a href="cmdqueryname=ipv6-flow+vpn-instance"><b><span class="cmdname" id="EN-US_TASK_0172372351__en-us_task_0172372350_cmdname296129537214101">ipv6-flow vpn-instance</span></b></a> <i><span class="varname" id="EN-US_TASK_0172372351__en-us_task_0172372350_varname633792001619">vpn-instance-name</span></i></span><p><p id="EN-US_TASK_0172372351__en-us_task_0172372350_p20961103212118">The BGP-Flow VPN instance IPv6 address family view is displayed.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0172372351__en-us_task_0172372350_substep897516028214101"><span id="EN-US_TASK_0172372351__en-us_task_0172372350_cmd626746068214101">Run <a href="cmdqueryname=route+validation-mode+include-as"><b><span class="cmdname" id="EN-US_TASK_0172372351__en-us_task_0172372350_cmdname1099826155214101">route validation-mode include-as</span></b></a></span><p><p id="EN-US_TASK_0172372351__en-us_task_0172372350_p1488124913116">The device is configured to check the AS_Path attribute during BGP IPv6 VPN Flow Specification route validation.</p>
</p><p><div class="p" id="EN-US_TASK_0172372351__en-us_task_0172372350_p500359876214101">BGP Flow Specification route validation is performed in either of the following modes: <ul id="EN-US_TASK_0172372351__en-us_task_0172372350_en-us_cliref_0172383989_ul1988263785214154"><li id="EN-US_TASK_0172372351__en-us_task_0172372350_en-us_cliref_0172383989_li1125409925214154">Validation mode 1: After receiving a BGP Flow Specification route with a destination address-based filtering rule, the device checks the validity of the route using the rules described in <a href="#EN-US_TASK_0172372351__en-us_task_0172372350_en-us_cliref_0172383989_fig_route_validation-mode_include-as01">Figure 1</a>. The route is considered valid only if the validation succeeds.</li><li id="EN-US_TASK_0172372351__en-us_task_0172372350_en-us_cliref_0172383989_li1499988458214154">Validation mode 2: After receiving a BGP Flow Specification route with a destination address-based filtering rule, the device checks the validity of the route by checking whether the AS_Path attribute of the route carries the AS_Set and AS_Sequence fields. The route is considered valid only if its AS_Path attribute does not carry the AS_Set or AS_Sequence field.</li></ul>
Validation mode 2 is configured using the <a href="cmdqueryname=route+validation-mode+include-as"><b><span class="cmdname" id="EN-US_TASK_0172372351__en-us_task_0172372350_en-us_cliref_0172383989_cmdname1973107158214154">route validation-mode include-as</span></b></a> command. If this command is configured, the device checks the validity of a BGP Flow Specification route using mode 2 first. <ul id="EN-US_TASK_0172372351__en-us_task_0172372350_en-us_cliref_0172383989_ul1816591491214154"><li id="EN-US_TASK_0172372351__en-us_task_0172372350_en-us_cliref_0172383989_li1472822637214154">If the validation succeeds, the BGP Flow Specification route is considered valid, and mode 1 is not used.</li><li id="EN-US_TASK_0172372351__en-us_task_0172372350_en-us_cliref_0172383989_li357606420214154">If the validation fails, the device checks the validity of the BGP Flow Specification route using mode 1.</li></ul>
If this command is not run, the device uses mode 1 to check the validity of BGP Flow Specification routes.<div class="fignone" id="EN-US_TASK_0172372351__en-us_task_0172372350_en-us_cliref_0172383989_fig_route_validation-mode_include-as01"><a name="EN-US_TASK_0172372351__en-us_task_0172372350_en-us_cliref_0172383989_fig_route_validation-mode_include-as01"></a><a name="en-us_task_0172372350_en-us_cliref_0172383989_fig_route_validation-mode_include-as01"></a><span class="figcap"><b>Figure 1 </b>BGP Flow Specification validation rules</span><br><span><img class="vsd" id="EN-US_TASK_0172372351__en-us_task_0172372350_en-us_cliref_0172383989_image1739672175214154" src="figure/en-us_image_0000001228664695.png"></span><br></div>
</div>
</p></li><li class="substepexpand" id="EN-US_TASK_0172372351__en-us_task_0172372350_substep683859453214101"><span id="EN-US_TASK_0172372351__en-us_task_0172372350_cmd293347827214101">Run <a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0172372351__en-us_task_0172372350_cmdname687590295214101">commit</span></b></a></span><p><p id="EN-US_TASK_0172372351__en-us_task_0172372350_p103699914127">The configuration is committed.</p>
</p></li></ol>
</li><li><span>(Optional) Disable BGP IPv6 VPN Flow Specification route validation.</span><ol type="a"><li class="substepexpand"><span>Run <span><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span></span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=ipv6-flow+vpn-instance"><b><span class="cmdname">ipv6-flow vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i></span></span><p><p>The BGP-Flow VPN instance IPv6 address family view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=peer+validation-disable"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">ipv6-address</span></i> } <strong><span>validation-disable</span></strong></span></span><p><p>The device is disabled from validating BGP IPv6 VPN Flow Specification routes received from a specified peer.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li><span>(Optional) Disable BGP Flow Specification protection.</span><ol type="a" id="EN-US_TASK_0172372351__en-us_task_0172372344_substeps178887814913"><li class="substepexpand" id="EN-US_TASK_0172372351__en-us_task_0172372344_substep118881485918"><span id="EN-US_TASK_0172372351__en-us_task_0172372344_cmd138883817910">Run <a href="cmdqueryname=system-view"><b><span class="cmdname" id="EN-US_TASK_0172372351__en-us_task_0172372344_cmdname039174221019">system-view</span></b></a></span><p><p id="EN-US_TASK_0172372351__en-us_task_0172372344_p13702181014128">The system view is displayed.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0172372351__en-us_task_0172372344_substep8971201512920"><span id="EN-US_TASK_0172372351__en-us_task_0172372344_cmd097114152918">Run <a href="cmdqueryname=flowspec+protocol-protect+ipv4+ipv6+disable"><b><span class="cmdname" id="EN-US_TASK_0172372351__en-us_task_0172372344_cmdname67791726161015">flowspec protocol-protect</span></b></a> { <strong><span id="EN-US_TASK_0172372351__en-us_task_0172372344_cmdparmname1422011399114">ipv4</span></strong> | <strong><span id="EN-US_TASK_0172372351__en-us_task_0172372344_cmdparmname115531043131114">ipv6</span></strong> } <strong><span id="EN-US_TASK_0172372351__en-us_task_0172372344_cmdparmname78091349181114">disable</span></strong></span><p><p id="EN-US_TASK_0172372351__en-us_task_0172372344_p12278122114127">BGP Flow Specification protection is disabled.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0172372351__en-us_task_0172372344_substep139391326123"><span id="EN-US_TASK_0172372351__en-us_task_0172372344_cmd1693913211215">Run <a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0172372351__en-us_task_0172372344_cmdname4151640101214">commit</span></b></a></span><p><p id="EN-US_TASK_0172372351__en-us_task_0172372344_p1855253571220">The configuration is committed.</p>
</p></li></ol>
</li><li><span>(Optional) Configure the device to redirect traffic to a specified IPv6 next hop based on a static BGP VPN IPv6 Flow Specification route.</span><ol type="a"><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ipv6-flow+vpn-instance"><b><span class="cmdname">ipv6-flow vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i></span><p><p>The BGP-Flow VPN instance IPv6 address family view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=local-route+redirect+ipv6+recursive-lookup+ip"><b><span class="cmdname">local-route redirect ipv6 recursive-lookup ip</span></b></a></span><p><p>The device is configured to redirect traffic to a specified IPv6 next hop based on a static BGP VPN IPv6 Flow Specification route.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li><span>(Optional) Allow the device to recurse static BGP VPN IPv6 Flow Specification routes to tunnels.</span><ol type="a"><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ipv6-flow+vpn-instance"><b><span class="cmdname">ipv6-flow vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i></span><p><p>The BGP-Flow VPN instance IPv6 address family view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=local-route+redirect+ipv6+recursive-lookup+tunne+tunnel-selector"><b><span class="cmdname">local-route redirect ipv6 recursive-lookup tunne</span></b></a>l <strong><span>tunnel-selector</span></strong> <i><span class="varname">tunnel-selector-name</span></i></span><p><p>The device is allowed to recurse static BGP VPN IPv6 Flow Specification routes to tunnels.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li><span>(Optional) Enable the DSCP-based BGP IPv6 Flow Specification traffic filtering rule.</span><ol type="a" id="EN-US_TASK_0172372351__en-us_task_0172372346_substeps195639422140"><li class="substepexpand" id="EN-US_TASK_0172372351__en-us_task_0172372346_substep165631942191417"><span id="EN-US_TASK_0172372351__en-us_task_0172372346_cmd756310429148">Run <a href="cmdqueryname=system-view"><b><span class="cmdname" id="EN-US_TASK_0172372351__en-us_task_0172372346_cmdname5413124714141">system-view</span></b></a></span><p><p id="EN-US_TASK_0172372351__en-us_task_0172372346_p126050533589">The system view is displayed.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0172372351__en-us_task_0172372346_substep92941850101419"><span id="EN-US_TASK_0172372351__en-us_task_0172372346_cmd12941050101412">Run <a href="cmdqueryname=flowspec+allow+ipv6+dscp"><b><span class="cmdname" id="EN-US_TASK_0172372351__en-us_task_0172372346_cmdname13169189101514">flowspec allow ipv6 dscp</span></b></a></span><p><p id="EN-US_TASK_0172372351__en-us_task_0172372346_p43601249164115">The DSCP-based BGP IPv6 Flow Specification traffic filtering rule is enabled.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0172372351__en-us_task_0172372346_substep12814439157"><span id="EN-US_TASK_0172372351__en-us_task_0172372346_cmd62811943191514">Run <a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0172372351__en-us_task_0172372346_cmdname9864512158">commit</span></b></a></span><p><p id="EN-US_TASK_0172372351__en-us_task_0172372346_p1712017418592">The configuration is committed.</p>
</p></li></ol>
</li><li><span>(Optional) Enable BGP Flow Specification to match inner packet information about the packets that leave an SRv6 TE Policy or SRv6 BE egress.</span><ol type="a" id="EN-US_TASK_0172372351__en-us_task_0172372344_substeps195639422140"><li class="substepexpand" id="EN-US_TASK_0172372351__en-us_task_0172372344_substep165631942191417"><span id="EN-US_TASK_0172372351__en-us_task_0172372344_cmd756310429148">Run <a href="cmdqueryname=system-view"><b><span class="cmdname" id="EN-US_TASK_0172372351__en-us_task_0172372344_cmdname5413124714141">system-view</span></b></a></span><p><p id="EN-US_TASK_0172372351__en-us_task_0172372344_p1188315171473">The system view is displayed.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0172372351__en-us_task_0172372344_substep92941850101419"><span id="EN-US_TASK_0172372351__en-us_task_0172372344_cmd12941050101412">Run <a href="cmdqueryname=flowspec+match+srv6-inner-ip+enable"><b><span class="cmdname" id="EN-US_TASK_0172372351__en-us_task_0172372344_cmdname655163675120">flowspec match srv6-inner-ip enable</span></b></a></span><p><p id="EN-US_TASK_0172372351__en-us_task_0172372344_p17382527114711">BGP Flow Specification is enabled to match inner packet information about the packets that leave an SRv6 TE Policy or SRv6 BE egress.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0172372351__en-us_task_0172372344_substep12814439157"><span id="EN-US_TASK_0172372351__en-us_task_0172372344_cmd62811943191514">Run <a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0172372351__en-us_task_0172372344_cmdname9864512158">commit</span></b></a></span><p><p id="EN-US_TASK_0172372351__en-us_task_0172372344_p4321538134715">The configuration is committed.</p>
</p></li></ol>
</li><li><span>(Optional) Enable BGP IPv6 Flow Specification to match the internal protocol number in the header of an IPv6 fragment.</span><ol type="a" id="EN-US_TASK_0172372351__en-us_task_0172372346_substeps89718513453"><li class="substepexpand" id="EN-US_TASK_0172372351__en-us_task_0172372346_substep9971165194514"><span id="EN-US_TASK_0172372351__en-us_task_0172372346_cmd497114519457">Run <a href="cmdqueryname=system-view"><b><span class="cmdname" id="EN-US_TASK_0172372351__en-us_task_0172372346_cmdname15807351194511">system-view</span></b></a></span><p><p id="EN-US_TASK_0172372351__en-us_task_0172372346_p011318546216">The system view is displayed.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0172372351__en-us_task_0172372346_substep175041028154511"><span id="EN-US_TASK_0172372351__en-us_task_0172372346_cmd75041728164514">Run <a href="cmdqueryname=flowspec+match+ipv6+fragment-inner-protocol+enable"><b><span class="cmdname" id="EN-US_TASK_0172372351__en-us_task_0172372346_cmdname326618479459">flowspec match ipv6 fragment-inner-protocol enable</span></b></a></span><p><p id="EN-US_TASK_0172372351__en-us_task_0172372346_p368402430">BGP IPv6 Flow Specification is enabled to match the internal protocol number in the header of an IPv6 fragment.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0172372351__en-us_task_0172372346_substep17371163619451"><span id="EN-US_TASK_0172372351__en-us_task_0172372346_cmd437103617455">Run <a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0172372351__en-us_task_0172372346_cmdname15471656194510">commit</span></b></a></span><p><p id="EN-US_TASK_0172372351__en-us_task_0172372346_p12727101316320">The configuration is committed.</p>
</p></li></ol>
</li></ol></div>
<div class="postreq"><a name="EN-US_TASK_0172372351__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p>After the configuration is complete, verify the configuration.</p>
<ul><li><p>Run the <a href="cmdqueryname=display+bgp+flow+vpnv6+vpn-instance+peer+verbose"><b><span class="cmdname">display bgp flow</span></b></a> <strong><span>vpnv6</span></strong> <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i> <strong><span>peer</span></strong> [ [ <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">ipv6-address</span></i> ] <strong><span>verbose</span></strong> ] command to check information about BGP IPv6 VPN Flow Specification peers.</p>
</li><li><p>Run the <a href="cmdqueryname=display+bgp+flow+vpnv6+vpn-instance+routing-table"><b><span class="cmdname">display bgp flow</span></b></a> <strong><span>vpnv6</span></strong> <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i> <strong><span>routing-table</span></strong> command to check information about BGP IPv6 VPN Flow Specification routes.</p>
</li><li><p>Run the <a href="cmdqueryname=display+bgp+flow+vpnv6+vpn-instance+routing-table+peer"><b><span class="cmdname">display bgp flow</span></b></a> <strong><span>vpnv6</span></strong> <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i> <strong><span>routing-table</span></strong> [ <strong><span>peer</span></strong> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">ipv6-address</span></i> } { <strong><span>advertised-routes</span></strong> | <strong><span>received-routes</span></strong> [ <strong><span>active</span></strong> ] } ] <strong><span>statistics</span></strong> command to check statistics about BGP IPv6 VPN Flow Specification routes.</p>
</li><li>Run the <a href="cmdqueryname=display+flowspec+ipv6+rule+slot"><b><span class="cmdname" id="EN-US_TASK_0172372351__en-us_task_0172372346_cmdname75021755191414">display flowspec</span></b></a> <strong><span id="EN-US_TASK_0172372351__en-us_task_0172372346_cmdparmname20589133315289">ipv6</span></strong> <strong><span id="EN-US_TASK_0172372351__en-us_task_0172372346_cmdparmname322314521514">rule</span></strong> <i><span class="varname" id="EN-US_TASK_0172372351__en-us_task_0172372346_varname12472151218155">reindex-value</span></i> <strong><span id="EN-US_TASK_0172372351__en-us_task_0172372346_cmdparmname143651917111514">slot</span></strong> <i><span class="varname" id="EN-US_TASK_0172372351__en-us_task_0172372346_varname033592413157">slot-id</span></i> command to check information about combined rules in the BGP IPv6 Flow Specification route rule table.</li><li>Run the <a href="cmdqueryname=display+flowspec+ipv6+rule+statistics+slot"><b><span class="cmdname" id="EN-US_TASK_0172372351__en-us_task_0172372346_cmdname5910711181816">display flowspec</span></b></a> <strong><span id="EN-US_TASK_0172372351__en-us_task_0172372346_cmdparmname777851114298">ipv6</span></strong> <strong><span id="EN-US_TASK_0172372351__en-us_task_0172372346_cmdparmname162965181181">rule statistics slot</span></strong> <i><span class="varname" id="EN-US_TASK_0172372351__en-us_task_0172372346_varname9665522191819">slot-id</span></i> command to check statistics about the rules for BGP IPv6 Flow Specification routes to take effect.</li><li>Run the <a href="cmdqueryname=display+flowspec+resource+rule+ipv4+ipv6+slot"><b><span class="cmdname" id="EN-US_TASK_0172372351__en-us_task_0172372344_cmdname1599317291274">display flowspec resource rule</span></b></a> { <strong><span id="EN-US_TASK_0172372351__en-us_task_0172372344_cmdparmname1563703542718">ipv4</span></strong> | <strong><span id="EN-US_TASK_0172372351__en-us_task_0172372344_cmdparmname5358140192714">ipv6</span></strong> } [ <strong><span id="EN-US_TASK_0172372351__en-us_task_0172372344_cmdparmname1515184619272">slot</span></strong> <i><span class="varname" id="EN-US_TASK_0172372351__en-us_task_0172372344_varname057105116271">slot-id</span></i> ] command to check the resource usage information about BGP Flow Specification route rules.</li></ul>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_flowspec_cfg_0000.html">BGP Flow Specification Configuration
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_flowspec_cfg_0022.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_flowspec_cfg_0018.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>