
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring NG MVPN over mLDP over GRE over IPsec (Inter-Board)">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ipsec_cfg_all_0040.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ipsec_cfg_all_0036.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,w00606909,h00522387,z00805567">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="IPSec">
<meta name="featuretype" content="Security">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="IPSec">
<meta name="featuretype" content="Security">
<meta name="featurename" content="IPSec">
<meta name="featuretype" content="Security">
<meta name="featurename" content="IPSec">
<meta name="featuretype" content="Security">
<meta name="featurename" content="IPSec">
<meta name="featuretype" content="Security">
<meta name="OWNER" content="z00485179">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="z00485179">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001352681245">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>Example for Configuring NG MVPN over mLDP over GRE over IPsec (Inter-Board)</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001352681245"></a><a name="EN-US_TASK_0000001352681245"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring NG MVPN over mLDP over GRE over IPsec<span> (Inter-Board)</span></h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001352681245__1.3.1"></a><a name="1.3.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0000001352681245__en-us_task_0172372481_p1194903817172">This configuration is supported by <span>a VSU or main control board</span>.</p>
</div></div>
<div class="p">On the intra-AS NG MVPN (over mLDP P2MP tunnels) shown in <a href="#EN-US_TASK_0000001352681245__fig4757182915104">Figure 1</a>, GRE over IPsec tunnels are established between PEs or between PEs and Ps to provide IPsec protection for data transmitted on the public network. <span><span><span><span></span>In an inter-board scenario, GRE encapsulation needs to be performed on a GRE tunnel and IPsec encryption needs to be performed on a VSU or main control board.</span></span></span><div class="fignone" id="EN-US_TASK_0000001352681245__fig4757182915104"><a name="EN-US_TASK_0000001352681245__fig4757182915104"></a><a name="fig4757182915104"></a><span class="figcap"><b>Figure 1 </b>Configuring NG MVPN over mLDP over GRE over IPsec</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface1, interface2, and interface3 represent GE<span>0/1/0</span>, GE<span>0/1/1</span>, and GE<span>0/1/2</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0000001301186512.png" width="NaN" height="NaN"></span><p>The networking is as follows:</p>
<ul><li>On PE1, public network-side interfaces GE<span>0/1/0</span> and GE<span>0/1/2</span> respectively connect to PE2 and PE3, and VPN-side interface GE<span>0/1/1</span> connects to CE1's GE<span>0/1/1</span>.</li><li>On PE2, public network-side interface GE<span>0/1/0</span> connects to PE1, and VPN-side interface GE<span>0/1/1</span> connects to CE2's GE<span>0/1/1</span>.</li><li>On PE3, public network-side interface GE<span>0/1/0</span> connects to PE1, and VPN-side interface GE<span>0/1/1</span> connects to CE3's GE<span>0/1/1</span>.</li></ul>
<p>To improve communication security between PE1 and PE2 and between PE1 and PE3, configure GRE over IPsec tunnels between them.</p>
</div>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001352681245__1.3.2"></a><a name="1.3.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>This section provides an example for configuring NG MVPN-triggered mLDP over GRE over IPsec in IKE mode. The tunnel encapsulation mode is used.</p>
<ol><li><p>Configure IP addresses for interfaces.</p>
</li><li><p>Create loopback interfaces and bind GRE to them.</p>
</li><li><p>Create tunnel interfaces and configure GRE for these interfaces.</p>
</li><li>Configure IPsec. Specifically:<ul><li>Enable IPsec.</li><li><p>Configure ACLs to define the data flows to be protected.</p>
</li><li><p>(Recommended) Configure DPD.</p>
</li><li><p>Configure IKE proposals. Specify SHA2-256 and pre-shared key authentication as the authentication algorithm and authentication method, respectively. In addition, set the DH group identifier used for key negotiation to group14.</p>
</li><li><p>Configure IKE peers.</p>
</li><li><p>Configure IPsec proposals. Specify ESP as the security protocol, SHA2-256 as the authentication algorithm, and AES-256 as the encryption algorithm.</p>
</li><li><p>Configure IPsec policies.</p>
</li><li><p>Configure an IPsec service-instance group.</p>
</li><li><p>Create and configure a tunnel interface.</p>
</li><li><p>Apply the IPsec policy to the tunnel interface.</p>
</li><li><p>Configure static routes to steer IPsec traffic.</p>
</li></ul>
</li><li><p>Create a loopback interface, configure IS-IS, and enable IS-IS on the loopback interface and GRE tunnel interface.</p>
</li><li><p>Establish an IBGP peer relationship between PE1 and PE2.</p>
</li><li><p>Enable MPLS, MPLS LDP, and mLDP.</p>
</li><li>Configure the NG MVPN over mLDP service. Specifically:<ul><li>Configure a BGP/MPLS IP VPN and ensure that the unicast VPN is running properly.</li><li>Enable all PEs to establish BGP MVPN peer relationships and configure BGP to transmit A-D and C-multicast routes.</li><li>Configure PE1 to use mLDP for I-PMSI tunnel establishment so that mLDP P2MP tunnels can be established.</li><li>Configure PIM on PE interfaces bound to VPN instances and on CE interfaces connected to PEs so that VPN multicast routing entries are generated for multicast traffic forwarding.</li><li>Configure IGMP on the multicast device's interface that connects to the user network segment to manage multicast group members on that network segment.</li></ul>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001352681245__1.3.3"></a><a name="1.3.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li>IP addresses of interfaces</li><li>IPsec-related data, mainly including:<ul><li><p>DPD data</p>
</li><li><p>ACL number</p>
</li><li><p>IP address segment of each subnet</p>
</li><li><p>Pre-shared key</p>
</li><li><p>Authentication algorithm to be used for the IKE proposal</p>
</li><li><p>Security protocol, encryption algorithm, and authentication algorithm to be used for the IPsec proposal</p>
</li><li><p>IP addresses of tunnel interfaces</p>
</li></ul>
</li><li>L3VPN data, including the IS-IS system ID, MPLS LSR ID, VPN instance name, RD, and VPN target</li></ul>
</div></div>
<div class="steps-unordered"><a name="EN-US_TASK_0000001352681245__1.3.4"></a><a name="1.3.4"></a><h4 class="sectiontitle">Procedure</h4>
<ul><li><span>Configure PE1, PE2, and PE3.</span><p>
<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" width="90%" frame="border" border="1" rules="all"><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="11.08%" id="mcps1.3.4.1.2.1.1.5.1.1" liSelected="liSelected"><p>Item</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="29.43%" id="mcps1.3.4.1.2.1.1.5.1.2" liSelected="liSelected"><p>PE1</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="29.65%" id="mcps1.3.4.1.2.1.1.5.1.3" liSelected="liSelected"><p>PE2</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="29.84%" id="mcps1.3.4.1.2.1.1.5.1.4" liSelected="liSelected"><p>PE3</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" valign="top" width="11.08%" headers="mcps1.3.4.1.2.1.1.5.1.1 "><p>1. Configure IP addresses for interfaces.</p>
</td>
<td class="cellrowborder" valign="top" width="29.43%" headers="mcps1.3.4.1.2.1.1.5.1.2 "><pre class="screen">interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 192.168.5.1 255.255.255.0
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ip address 192.168.6.1 255.255.255.0
#
interface LoopBack0
 ip address 1.1.1.1 255.255.255.255
#
interface LoopBack1
 ip address 10.1.1.1 255.255.255.255
#</pre>
</td>
<td class="cellrowborder" valign="top" width="29.65%" headers="mcps1.3.4.1.2.1.1.5.1.3 "><pre class="screen">interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 192.168.5.2 255.255.255.0
#
interface LoopBack0
 ip address 2.2.2.2 255.255.255.255
# 
interface LoopBack1
 ip address 10.2.1.1 255.255.255.255
#</pre>
</td>
<td class="cellrowborder" valign="top" width="29.84%" headers="mcps1.3.4.1.2.1.1.5.1.4 "><pre class="screen">interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ip address 192.168.6.2 255.255.255.0
#
interface LoopBack0
 ip address 3.3.3.3 255.255.255.255
#
interface LoopBack1
 ip address 10.3.1.1 255.255.255.255
#</pre>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="11.08%" headers="mcps1.3.4.1.2.1.1.5.1.1 "><p>2. Configure a GRE tunnel interface.</p>
</td>
<td class="cellrowborder" valign="top" width="29.43%" headers="mcps1.3.4.1.2.1.1.5.1.2 "><pre class="screen">interface LoopBack1
 binding tunnel gre
#
interface Tunnel12
 ip address 11.1.1.1 255.255.255.0
 tunnel-protocol gre
 source 10.1.1.1
 destination 10.2.1.1
#
interface Tunnel14
 ip address 22.1.1.2 255.255.255.0
 tunnel-protocol gre
 source 10.1.1.1
 destination 10.3.1.1
#</pre>
</td>
<td class="cellrowborder" valign="top" width="29.65%" headers="mcps1.3.4.1.2.1.1.5.1.3 "><pre class="screen">interface LoopBack1
 binding tunnel gre
#
interface Tunnel21
 ip address 11.1.1.2 255.255.255.0
 tunnel-protocol gre
 source 10.2.1.1
 destination 10.1.1.1
#</pre>
</td>
<td class="cellrowborder" valign="top" width="29.84%" headers="mcps1.3.4.1.2.1.1.5.1.4 "><pre class="screen">interface LoopBack1
 binding tunnel gre
#
interface Tunnel41
 ip address 22.1.1.1 255.255.255.0
 tunnel-protocol gre
 source 10.3.1.1
 destination 10.1.1.1
#</pre>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="11.08%" headers="mcps1.3.4.1.2.1.1.5.1.1 "><p>4. Enable DPD.</p>
</td>
<td class="cellrowborder" valign="top" width="29.43%" headers="mcps1.3.4.1.2.1.1.5.1.2 "><pre class="screen">ike dpd interval 10 10 //Deploying DPD is recommended.</pre>
</td>
<td class="cellrowborder" valign="top" width="29.65%" headers="mcps1.3.4.1.2.1.1.5.1.3 "><pre class="screen">ike dpd interval 10 10 //Deploying DPD is recommended.</pre>
</td>
<td class="cellrowborder" valign="top" width="29.84%" headers="mcps1.3.4.1.2.1.1.5.1.4 "><pre class="screen">ike dpd interval 10 10 //Deploying DPD is recommended.</pre>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="11.08%" headers="mcps1.3.4.1.2.1.1.5.1.1 "><p>5. Configure an ACL to define the data flows to be protected.</p>
</td>
<td class="cellrowborder" valign="top" width="29.43%" headers="mcps1.3.4.1.2.1.1.5.1.2 "><pre class="screen">acl number 3000
 rule 5 permit gre source 10.1.1.1 0 destination 10.3.1.1 0
#
acl number 3001
 rule 5 permit gre source 10.1.1.1 0 destination 10.2.1.1 0
#</pre>
</td>
<td class="cellrowborder" valign="top" width="29.65%" headers="mcps1.3.4.1.2.1.1.5.1.3 "><pre class="screen">acl number 3001
 rule 5 permit gre source 10.2.1.1 0 destination 10.1.1.1 0
#</pre>
</td>
<td class="cellrowborder" valign="top" width="29.84%" headers="mcps1.3.4.1.2.1.1.5.1.4 "><pre class="screen">acl number 3000
 rule 5 permit gre source 10.3.1.1 0 destination 10.1.1.1 0
#</pre>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="11.08%" headers="mcps1.3.4.1.2.1.1.5.1.1 "><p>6. Configure an IKE proposal and an IKE peer.</p>
</td>
<td class="cellrowborder" valign="top" width="29.43%" headers="mcps1.3.4.1.2.1.1.5.1.2 "><pre class="screen">ike proposal 1
 encryption-algorithm aes-cbc 256
 dh group14
 authentication-algorithm sha2-256
 integrity-algorithm hmac-sha2-256
#
ike peer pe1
 pre-shared-key %$%$0\WT%.iDi6%K-f)_^mQ6,.2n%$%$ //Set the pre-shared key to <strong>1234567890</strong> (displayed in ciphertext).
 ike-proposal 1
 remote-address 33.1.2.1
#
ike peer pe2 
 pre-shared-key %$%$0\WT%.iDi6%K-f)_^mQ6,.2n%$%$ //Set the pre-shared key to <strong>1234567890</strong> (displayed in ciphertext).
 ike-proposal 1
 remote-address 10.6.2.2
#</pre>
</td>
<td class="cellrowborder" valign="top" width="29.65%" headers="mcps1.3.4.1.2.1.1.5.1.3 "><pre class="screen">ike proposal 1
 encryption-algorithm aes-cbc 256
 dh group14
 authentication-algorithm sha2-256
 integrity-algorithm hmac-sha2-256
#
ike peer pe2
 pre-shared-key %$%$0\WT%.iDi6%K-f)_^mQ6,.2n%$%$ //Set the pre-shared key to <strong>1234567890</strong> (displayed in ciphertext).
 ike-proposal 1 
 remote-address 10.6.2.1
#</pre>
</td>
<td class="cellrowborder" valign="top" width="29.84%" headers="mcps1.3.4.1.2.1.1.5.1.4 "><pre class="screen">ike proposal 1
 encryption-algorithm aes-cbc 256
 dh group14
 authentication-algorithm sha2-256
 integrity-algorithm hmac-sha2-256
#
ike peer pe1
 pre-shared-key %$%$0\WT%.iDi6%K-f)_^mQ6,.2n%$%$ //Set the pre-shared key to <strong>1234567890</strong> (displayed in ciphertext).
 ike-proposal 1 
 remote-address 10.5.2.2
#</pre>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="11.08%" headers="mcps1.3.4.1.2.1.1.5.1.1 "><p>7. Configure a service-instance group.</p>
</td>
<td class="cellrowborder" valign="top" width="29.43%" headers="mcps1.3.4.1.2.1.1.5.1.2 "><pre class="screen">#
service-location 1
 location slot <span>1</span>
#
service-instance-group group1
 service-location 1</pre>
</td>
<td class="cellrowborder" valign="top" width="29.65%" headers="mcps1.3.4.1.2.1.1.5.1.3 "><pre class="screen">#
service-location 1
 location slot <span>1</span>
#
service-instance-group group1
 service-location 1</pre>
</td>
<td class="cellrowborder" valign="top" width="29.84%" headers="mcps1.3.4.1.2.1.1.5.1.4 "><pre class="screen">#
service-location 1
 location slot <span>1</span>
#
service-instance-group group1
 service-location 1</pre>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="11.08%" headers="mcps1.3.4.1.2.1.1.5.1.1 "><p>8. Configure an IPsec tunnel.</p>
</td>
<td class="cellrowborder" valign="top" width="29.43%" headers="mcps1.3.4.1.2.1.1.5.1.2 "><pre class="screen">ipsec proposal zh //Configure an IPsec proposal.
 esp authentication-algorithm sha2-256
 esp encryption-algorithm aes 256
#
ipsec policy axpo2 10 isakmp //Configure an IPsec policy.
 security acl 3001
 ike-peer pe2 
 proposal zh
#
ipsec policy axpo 10 isakmp
 security acl 3000
 ike-peer pe1
 proposal zh
#
interface Tunnel121 //Configure an IPsec tunnel.
 ip address 10.6.2.1 255.255.255.0
 tunnel-protocol ipsec
 ipsec policy axpo2<span> service-instance-group 1</span>
interface Tunnel141
 ip address 10.5.2.2 255.255.255.0
 tunnel-protocol ipsec
 ipsec policy axpo<span> service-instance-group 1</span>
#</pre>
</td>
<td class="cellrowborder" valign="top" width="29.65%" headers="mcps1.3.4.1.2.1.1.5.1.3 "><pre class="screen">ipsec proposal zh //Configure an IPsec proposal.
 esp authentication-algorithm sha2-256 
 esp encryption-algorithm aes 256 
# 
ipsec policy axpo2 10 isakmp //Configure an IPsec policy.
 security acl 3001
 ike-peer pe2
 proposal zh
#
interface Tunnel211 //Configure an IPsec tunnel.
 ip address 10.6.2.2 255.255.255.0
 tunnel-protocol ipsec
 ipsec policy axpo2<span> service-instance-group 1</span>
#</pre>
</td>
<td class="cellrowborder" valign="top" width="29.84%" headers="mcps1.3.4.1.2.1.1.5.1.4 "><pre class="screen">ipsec proposal zh //Configure an IPsec proposal.
 esp authentication-algorithm sha2-256 
 esp encryption-algorithm aes 256 
# 
ipsec policy axpo 10 isakmp
 security acl 3000
 ike-peer pe1
 proposal zh
#
interface Tunnel411
 ip address 10.5.2.1 255.255.255.0
 tunnel-protocol ipsec
 ipsec policy axpo<span> service-instance-group 1</span>
#</pre>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="11.08%" headers="mcps1.3.4.1.2.1.1.5.1.1 "><p>9. Configure traffic diversion routes.</p>
</td>
<td class="cellrowborder" valign="top" width="29.43%" headers="mcps1.3.4.1.2.1.1.5.1.2 "><pre class="screen">ip route-static 10.2.1.1 255.255.255.255 Tunnel121 10.6.2.2 //Divert traffic to the IPsec tunnel for encryption.
ip route-static 10.6.2.2 255.255.255.255 GigabitEthernet<span>0/1/0</span> 192.168.5.2 //Divert the IPsec-encrypted traffic to the actual physical outbound interface.
ip route-static 10.3.1.1 255.255.255.255 Tunnel141 10.5.2.1 //Divert traffic to the IPsec tunnel for encryption.
ip route-static 10.5.2.1 255.255.255.255 GigabitEthernet<span>0/1/2</span> 192.168.6.2 //Divert IPsec-encrypted traffic to the actual physical outbound interface.</pre>
</td>
<td class="cellrowborder" valign="top" width="29.65%" headers="mcps1.3.4.1.2.1.1.5.1.3 "><pre class="screen">ip route-static 10.1.1.1 255.255.255.255 Tunnel211 10.6.2.1 //Divert traffic to the IPsec tunnel for encryption.
ip route-static 10.6.2.1 255.255.255.255 GigabitEthernet<span>0/1/0</span> 192.168.5.1 //Divert IPsec-encrypted traffic to the actual physical outbound interface.
</pre>
</td>
<td class="cellrowborder" valign="top" width="29.84%" headers="mcps1.3.4.1.2.1.1.5.1.4 "><pre class="screen">ip route-static 10.1.1.1 255.255.255.255 Tunnel411 10.5.2.2 //Divert traffic to the IPsec tunnel for encryption.
ip route-static 10.5.2.2 255.255.255.255 GigabitEthernet<span>0/1/2</span> 192.168.6.1 //Divert IPsec-encrypted traffic to the actual physical outbound interface.</pre>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="11.08%" headers="mcps1.3.4.1.2.1.1.5.1.1 "><p>10. Configure IS-IS.</p>
</td>
<td class="cellrowborder" valign="top" width="29.43%" headers="mcps1.3.4.1.2.1.1.5.1.2 "><pre class="screen">isis 1
 is-level level-2
 cost-style wide
 network-entity 01.0000.0000.0003.00
#
interface LoopBack0
 isis enable 1
#
interface Tunnel12
 isis enable 1
#</pre>
</td>
<td class="cellrowborder" valign="top" width="29.65%" headers="mcps1.3.4.1.2.1.1.5.1.3 "><pre class="screen">isis 1
 is-level level-2
 cost-style wide
 network-entity 01.0000.0000.0005.00
# 
interface LoopBack0
 isis enable 1
#
interface Tunnel21
 isis enable 1
#</pre>
</td>
<td class="cellrowborder" valign="top" width="29.84%" headers="mcps1.3.4.1.2.1.1.5.1.4 "><pre class="screen">isis 1
 is-level level-2
 cost-style wide
 network-entity 01.0000.0000.0004.00
# 
interface LoopBack0
 isis enable 1
#
interface Tunnel41
 isis enable 1
#</pre>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="11.08%" headers="mcps1.3.4.1.2.1.1.5.1.1 "><p>11. Configure mLDP.</p>
</td>
<td class="cellrowborder" valign="top" width="29.43%" headers="mcps1.3.4.1.2.1.1.5.1.2 "><pre class="screen">mpls lsr-id 1.1.1.1
#
mpls
#
mpls ldp
 mldp p2mp
 #
 ipv4-family
#
interface Tunnel12
 mpls
 mpls ldp
#</pre>
</td>
<td class="cellrowborder" valign="top" width="29.65%" headers="mcps1.3.4.1.2.1.1.5.1.3 "><pre class="screen">mpls lsr-id 2.2.2.2
#
mpls
#
mpls ldp
 mldp p2mp
 #
 ipv4-family
#
interface Tunnel21
 mpls
 mpls ldp
#</pre>
</td>
<td class="cellrowborder" valign="top" width="29.84%" headers="mcps1.3.4.1.2.1.1.5.1.4 "><pre class="screen">mpls lsr-id 3.3.3.3
#
mpls
#
mpls ldp
 mldp p2mp
 #
 ipv4-family
#
interface Tunnel41
 mpls
 mpls ldp
#</pre>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="11.08%" headers="mcps1.3.4.1.2.1.1.5.1.1 "><p>12. Configure VPN.</p>
</td>
<td class="cellrowborder" valign="top" width="29.43%" headers="mcps1.3.4.1.2.1.1.5.1.2 "><pre class="screen">ip vpn-instance mldp
 ipv4-family
  route-distinguisher 100:100
  apply-label per-instance
  vpn-target 100:100 export-extcommunity
  vpn-target 100:100 import-extcommunity
#</pre>
</td>
<td class="cellrowborder" valign="top" width="29.65%" headers="mcps1.3.4.1.2.1.1.5.1.3 "><pre class="screen">ip vpn-instance ipsec_vpn
 ipv4-family
  route-distinguisher 100:100
  vpn-target 200:200 export-extcommunity
  vpn-target 200:200 import-extcommunity
#</pre>
</td>
<td class="cellrowborder" valign="top" width="29.84%" headers="mcps1.3.4.1.2.1.1.5.1.4 "><pre class="screen">ip vpn-instance mldp
 ipv4-family
  route-distinguisher 100:100
  apply-label per-instance
  vpn-target 100:100 export-extcommunity
  vpn-target 100:100 import-extcommunity
#</pre>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="11.08%" headers="mcps1.3.4.1.2.1.1.5.1.1 "><p>13. Configure BGP.</p>
</td>
<td class="cellrowborder" valign="top" width="29.43%" headers="mcps1.3.4.1.2.1.1.5.1.2 "><pre class="screen">bgp 100
 private-4-byte-as enable
 peer 2.2.2.2 as-number 100
 peer 2.2.2.2 connect-interface LoopBack0
 peer 3.3.3.3 as-number 100
 peer 3.3.3.3 connect-interface LoopBack0
 #
 ipv4-family unicast
  undo synchronization
  peer 2.2.2.2 enable
  peer 3.3.3.3 enable
 #
 ipv4-family mvpn
  policy vpn-target
  peer 2.2.2.2 enable
  peer 3.3.3.3 enable
 #
 ipv4-family vpnv4
  policy vpn-target
  peer 2.2.2.2 enable
  peer 3.3.3.3 enable
 #
 ipv4-family vpn-instance mldp
  import-route direct
#</pre>
</td>
<td class="cellrowborder" valign="top" width="29.65%" headers="mcps1.3.4.1.2.1.1.5.1.3 "><pre class="screen">bgp 100
 private-4-byte-as enable
 peer 1.1.1.1 as-number 100
 peer 1.1.1.1 connect-interface LoopBack0
 #
 ipv4-family unicast
  undo synchronization
  peer 1.1.1.1 enable
 #
 ipv4-family mvpn
  policy vpn-target
  peer 1.1.1.1 enable
 #
 ipv4-family vpnv4
  policy vpn-target
  peer 1.1.1.1 enable
 #
 ipv4-family vpn-instance mldp
  import-route direct
#</pre>
</td>
<td class="cellrowborder" valign="top" width="29.84%" headers="mcps1.3.4.1.2.1.1.5.1.4 "><pre class="screen">bgp 100
 private-4-byte-as enable
 peer 1.1.1.1 as-number 100
 peer 1.1.1.1 connect-interface LoopBack0
 #
 ipv4-family unicast
  undo synchronization
  peer 1.1.1.1 enable
 #
 ipv4-family mvpn
  policy vpn-target
  peer 1.1.1.1 enable
 #
 ipv4-family vpnv4
  policy vpn-target
  peer 1.1.1.1 enable
 #
 ipv4-family vpn-instance mldp
  import-route direct
#</pre>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="11.08%" headers="mcps1.3.4.1.2.1.1.5.1.1 "><p>14. Configure MVPN.</p>
</td>
<td class="cellrowborder" valign="top" width="29.43%" headers="mcps1.3.4.1.2.1.1.5.1.2 "><pre class="screen">ip vpn-instance mldp
 ipv4-family
  multicast routing-enable
  mvpn
   sender-enable
   rpt-spt mode
   ipmsi-tunnel
    mldp
#</pre>
</td>
<td class="cellrowborder" valign="top" width="29.65%" headers="mcps1.3.4.1.2.1.1.5.1.3 "><pre class="screen">ip vpn-instance mldp
 ipv4-family
  multicast routing-enable
  mvpn
   c-multicast signaling bgp
   rpt-spt mode
#</pre>
</td>
<td class="cellrowborder" valign="top" width="29.84%" headers="mcps1.3.4.1.2.1.1.5.1.4 "><pre class="screen">ip vpn-instance mldp
 ipv4-family
  multicast routing-enable
  mvpn
   c-multicast signaling bgp
   rpt-spt mode
#</pre>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="11.08%" headers="mcps1.3.4.1.2.1.1.5.1.1 "><p>15. Configure PIM.</p>
</td>
<td class="cellrowborder" valign="top" width="29.43%" headers="mcps1.3.4.1.2.1.1.5.1.2 "><pre class="screen">interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip binding vpn-instance mldp
 ip address 192.168.10.1 255.255.255.0
 pim sm
 dcn
#</pre>
</td>
<td class="cellrowborder" valign="top" width="29.65%" headers="mcps1.3.4.1.2.1.1.5.1.3 "><pre class="screen">interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip binding vpn-instance mldp
 ip address 192.168.12.1 255.255.255.0
 pim sm
 dcn
#</pre>
</td>
<td class="cellrowborder" valign="top" width="29.84%" headers="mcps1.3.4.1.2.1.1.5.1.4 "><pre class="screen">interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip binding vpn-instance mldp
 ip address 192.168.14.1 255.255.255.0
 pim sm
 dcn
#</pre>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="11.08%" headers="mcps1.3.4.1.2.1.1.5.1.1 "><p>16. Configure a static RP.</p>
</td>
<td class="cellrowborder" valign="top" width="29.43%" headers="mcps1.3.4.1.2.1.1.5.1.2 "><pre class="screen">pim vpn-instance mldp
 static-rp 192.168.10.1
#</pre>
</td>
<td class="cellrowborder" valign="top" width="29.65%" headers="mcps1.3.4.1.2.1.1.5.1.3 "><pre class="screen">pim vpn-instance mldp
 static-rp 192.168.10.1
#</pre>
</td>
<td class="cellrowborder" valign="top" width="29.84%" headers="mcps1.3.4.1.2.1.1.5.1.4 "><pre class="screen">pim vpn-instance mldp
 static-rp 192.168.10.1
#</pre>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="11.08%" headers="mcps1.3.4.1.2.1.1.5.1.1 "><p>17. Configure VPN OSPF.</p>
</td>
<td class="cellrowborder" valign="top" width="29.43%" headers="mcps1.3.4.1.2.1.1.5.1.2 "><pre class="screen">ospf 2 vpn-instance VPNA
import-route bgp
area 0.0.0.0
network 192.168.10.0 0.0.0.255
#</pre>
</td>
<td class="cellrowborder" valign="top" width="29.65%" headers="mcps1.3.4.1.2.1.1.5.1.3 "><pre class="screen">ospf 2 vpn-instance VPNA
import-route bgp
area 0.0.0.0
network 192.168.12.0 0.0.0.255
#</pre>
</td>
<td class="cellrowborder" valign="top" width="29.84%" headers="mcps1.3.4.1.2.1.1.5.1.4 "><pre class="screen">ospf 2 vpn-instance VPNA
import-route bgp
area 0.0.0.0
network 192.168.14.0 0.0.0.255
#</pre>
</td>
</tr>
</tbody>
</table>
</div>
</p></li><li><span>Configure CE1, CE2, and CE3.</span><p>
<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" width="90%" frame="border" border="1" rules="all"><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="11.08%" id="mcps1.3.4.2.2.1.1.5.1.1" liSelected="liSelected"><p>Item</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="29.43%" id="mcps1.3.4.2.2.1.1.5.1.2" liSelected="liSelected"><p>CE1</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="29.65%" id="mcps1.3.4.2.2.1.1.5.1.3" liSelected="liSelected"><p>CE2</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="29.84%" id="mcps1.3.4.2.2.1.1.5.1.4" liSelected="liSelected"><p>CE3</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" valign="top" width="11.08%" headers="mcps1.3.4.2.2.1.1.5.1.1 "><p>1. Configure IP addresses for interfaces.</p>
</td>
<td class="cellrowborder" valign="top" width="29.43%" headers="mcps1.3.4.2.2.1.1.5.1.2 "><pre class="screen">interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 192.168.10.2 255.255.255.0
 pim sm
 igmp enable
 dcn
#
interface LoopBack1
 ip address 4.4.4.4 255.255.255.255
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ip address 192.168.1.2 255.255.255.0
 pim sm
#</pre>
</td>
<td class="cellrowborder" valign="top" width="29.65%" headers="mcps1.3.4.2.2.1.1.5.1.3 "><pre class="screen">interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 192.168.12.2 255.255.255.0
 pim sm
 igmp enable
 dcn
#
interface LoopBack1
 ip address 5.5.5.5 255.255.255.255
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ip address 192.168.2.2 255.255.255.0
 pim sm
#</pre>
</td>
<td class="cellrowborder" valign="top" width="29.84%" headers="mcps1.3.4.2.2.1.1.5.1.4 "><pre class="screen">interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 192.168.14.2 255.255.255.0
 pim sm
 igmp enable
 dcn
#
interface LoopBack1
 ip address 6.6.6.6 255.255.255.255
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ip address 192.168.3.2 255.255.255.0
 pim sm
#</pre>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="11.08%" headers="mcps1.3.4.2.2.1.1.5.1.1 "><p>2. Configure a static RP.</p>
</td>
<td class="cellrowborder" valign="top" width="29.43%" headers="mcps1.3.4.2.2.1.1.5.1.2 "><pre class="screen">pim
 static-rp 4.4.4.4
#</pre>
</td>
<td class="cellrowborder" valign="top" width="29.65%" headers="mcps1.3.4.2.2.1.1.5.1.3 "><pre class="screen">pim
 static-rp 4.4.4.4
#</pre>
</td>
<td class="cellrowborder" valign="top" width="29.84%" headers="mcps1.3.4.2.2.1.1.5.1.4 "><pre class="screen">pim
 static-rp 4.4.4.4
#</pre>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="11.08%" headers="mcps1.3.4.2.2.1.1.5.1.1 "><p>3. Configure OSPF for communication with PEs.</p>
</td>
<td class="cellrowborder" valign="top" width="29.43%" headers="mcps1.3.4.2.2.1.1.5.1.2 "><pre class="screen">ospf 2
 area 0.0.0.0
 network 4.4.4.4 0.0.0.0
 network 192.168.10.0 0.0.0.255
 network 192.168.1.0 0.0.0.255
#</pre>
</td>
<td class="cellrowborder" valign="top" width="29.65%" headers="mcps1.3.4.2.2.1.1.5.1.3 "><pre class="screen">ospf 2
 area 0.0.0.0
 network 5.5.5.5 0.0.0.0
 network 192.168.12.0 0.0.0.255
 network 192.168.2.0 0.0.0.255
#</pre>
</td>
<td class="cellrowborder" valign="top" width="29.84%" headers="mcps1.3.4.2.2.1.1.5.1.4 "><pre class="screen">ospf 2
 area 0.0.0.0
 network 6.6.6.6 0.0.0.0
 network 192.168.14.0 0.0.0.255
 network 192.168.3.0 0.0.0.255
#</pre>
</td>
</tr>
</tbody>
</table>
</div>
</p></li></ul></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ipsec_cfg_all_0040.html">GRE over IPsec Scenario
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ipsec_cfg_all_0036.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>
</body>
</html>