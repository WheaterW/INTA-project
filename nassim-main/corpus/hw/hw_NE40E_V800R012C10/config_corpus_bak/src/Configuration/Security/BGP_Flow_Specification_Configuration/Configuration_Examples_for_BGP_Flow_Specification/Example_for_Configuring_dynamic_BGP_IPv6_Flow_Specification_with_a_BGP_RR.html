
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring dynamic BGP IPv6 Flow Specification with a BGP RR">
<meta name="abstract" content="Deploying BGP IPv6 flow specification with a BGP RR can reduce the number of BGP IPv6 flow specification peer connections.">
<meta name="description" content="Deploying BGP IPv6 flow specification with a BGP RR can reduce the number of BGP IPv6 flow specification peer connections.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_flowspec_cfg_0010.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_flowspec_cfg_0015.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_flowspec_cfg_0017.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="z00603461,w00800033,flow-specificationvrp,w00556928,w00606909,l00455378,z00805567">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="BGP Flow Specfication">
<meta name="featuretype" content="Security">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP Flow Specfication">
<meta name="featuretype" content="Security">
<meta name="featurename" content="BGP Flow Specfication">
<meta name="featuretype" content="Security">
<meta name="OWNER" content="h00522387">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00615954">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172372368">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring dynamic BGP IPv6 Flow Specification with a BGP RR</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172372368"></a><a name="EN-US_TASK_0172372368"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring dynamic BGP IPv6 Flow Specification with a BGP RR</h1>
<div class="taskbody"><p>Deploying BGP IPv6 flow specification with a BGP RR can reduce the number of BGP IPv6 flow specification peer connections.</p>
<div class="context"><a name="EN-US_TASK_0172372368__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>BGP IPv6 flow specification can be configured to defend against DoS/DDoS attacks. Generally, the characteristics of such attack traffic are unknown. Therefore, dynamic BGP IPv6 flow specification needs to be deployed on a traffic analysis server. In an AS with multiple ingresses, a flow route reflector (Flow RR) can be configured to avoid unnecessary mesh connections between the ingresses and the traffic analysis server. The ingresses and the traffic analysis server function as clients, and the Flow RR reflects the BGP IPv6 flow specification routes generated by the traffic analysis server to the ingresses.</p>
<p>On the network shown in <a href="#EN-US_TASK_0172372368__fig_dc_vrp_flowspec_cfg_001301">Figure 1</a>, AS 100 can communicate with other ASs through boundary devices <span class="keyword">Device</span>A and <span class="keyword">Device</span>B. If DoS/DDoS attack traffic enters AS 100 through <span class="keyword">Device</span>A and <span class="keyword">Device</span>B, it causes impacts such as congestion in AS 100. In this case, you can deploy BGP IPv6 flow specification (dynamic BGP IPv6 flow specification is used in this example) to eliminate the impact. In addition, to reduce resource consumption of the server and the number of BGP IPv6 flow specification peer relationships maintained by the server, configure a Flow RR in AS 100. The Flow RR is used to reflect the BGP IPv6 flow specification routes generated by the server to <span class="keyword">Device</span>A and <span class="keyword">Device</span>B for them to control attack traffic.</p>
<div class="fignone" id="EN-US_TASK_0172372368__fig_dc_vrp_flowspec_cfg_001301"><a name="EN-US_TASK_0172372368__fig_dc_vrp_flowspec_cfg_001301"></a><a name="fig_dc_vrp_flowspec_cfg_001301"></a><span class="figcap"><b>Figure 1 </b>Configuring BGP IPv6 flow specification with a Flow RR</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface1, interface2, and interface3 represent GE<span>0/1/0</span>, GE<span>0/2/0</span>, and GE<span>0/3/0</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_flowspec_cfg_001301.png" width="NaN" height="NaN"></span><br></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172372368__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Establish OSPF connections between the Flow RR and <span class="keyword">Device</span>A, between the Flow RR and <span class="keyword">Device</span>B, and between the Flow RR and the server for interworking.</p>
</li><li><p>Establish BGP IPv6 flow specification peer relationships between the Flow RR and <span class="keyword">Device</span>A, between the Flow RR and <span class="keyword">Device</span>B, and between the Flow RR and the server.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The traffic analysis server is a third-party device and must be able to establish BGP IPv6 flow specification peer relationships.</p>
</div></div>
</li><li><p>Configure the Flow RR function on the Flow RR and specify <span class="keyword">Device</span>A, <span class="keyword">Device</span>B, and the server as clients so that the Flow RR can reflect the BGP IPv6 flow specification routes generated by the server to <span class="keyword">Device</span>A and <span class="keyword">Device</span>B.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172372368__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><div class="p">To complete the configuration, you need the following data:<ul><li><p>Router IDs of <span class="keyword">Device</span>A, <span class="keyword">Device</span>B, and Flow RR: 1.1.1.1, 2.2.2.2, and 3.3.3.3</p>
</li><li><p>Number of the AS where <span class="keyword">Device</span>A, <span class="keyword">Device</span>B, Flow RR, and the server reside: 100</p>
</li><li><p>ID of the cluster to which the Flow RR belongs: 1</p>
</li></ul>
</div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172372368__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure an IP address for each interface.</span><p><p>For configuration details, see the configuration files.</p>
</p></li><li><span>Configure OSPF.</span><p><p>For configuration details, see the configuration files.</p>
</p></li><li><span>Establish BGP IPv6 flow specification peer relationships.</span><p><p># Configure <span class="keyword">Device</span>A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A]<strong> bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp]<strong> router-id 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp] <strong>peer 3.3.3.3 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp] <strong>peer 3.3.3.3 connect-interface LoopBack1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp] <strong>ipv6-family flow</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp-af-ipv6-flow] <strong>peer 3.3.3.3 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp-af-ipv6-flow] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-bgp-af-ipv6-flow] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-bgp]<strong> quit</strong></pre>
<p># Configure <span class="keyword">Device</span>B.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B]<strong> bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp]<strong> router-id 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp] <strong>peer 3.3.3.3 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp] <strong>peer 3.3.3.3 connect-interface LoopBack1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp] <strong>ipv6-family flow</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp-af-ipv6-flow] <strong>peer 3.3.3.3 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp-af-ipv6-flow] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-bgp-af-ipv6-flow] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-bgp]<strong> quit</strong></pre>
<p># Configure the Flow RR.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Flow RR]<strong> bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Flow RR-bgp]<strong> router-id 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Flow RR-bgp] <strong>peer 1.1.1.1 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Flow RR-bgp] <strong>peer 1.1.1.1 connect-interface LoopBack1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Flow RR-bgp] <strong>peer 2.2.2.2 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Flow RR-bgp] <strong>peer 2.2.2.2 connect-interface LoopBack1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Flow RR-bgp] <strong>peer 10.2.1.2 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Flow RR-bgp] <strong>ipv6-family flow</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Flow RR-bgp-af-ipv6-flow] <strong>peer 1.1.1.1 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Flow RR-bgp-af-ipv6-flow] <strong>peer 2.2.2.2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Flow RR-bgp-af-ipv6-flow] <strong>peer 10.2.1.2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Flow RR-bgp-af-ipv6-flow] <strong>peer 10.2.1.2 validation-disable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Flow RR-bgp-af-ipv6-flow] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Flow RR-bgp-af-ipv6-flow] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Flow RR-bgp]<strong> quit</strong></pre>
</p></li><li><span>Configure the Flow RR.</span><p><p># Configure the Flow RR.</p>
<pre class="screen">[Flow RR]<strong>bgp 100</strong></pre>
<pre class="screen">[Flow RR-bgp] <strong>ipv6-family flow</strong></pre>
<pre class="screen">[Flow RR-bgp-af-ipv6-flow] <strong>reflector cluster-id 1</strong></pre>
<pre class="screen">[Flow RR-bgp-af-ipv6-flow] <strong>peer 1.1.1.1 reflect-client</strong></pre>
<pre class="screen">[Flow RR-bgp-af-ipv6-flow] <strong>peer 2.2.2.2 reflect-client</strong></pre>
<pre class="screen">[Flow RR-bgp-af-ipv6-flow] <strong>peer 10.2.1.2 reflect-client</strong></pre>
<pre class="screen">[Flow RR-bgp-af-ipv6-flow] <strong>commit</strong></pre>
<pre class="screen">[Flow RR-bgp-af-ipv6-flow] <strong>quit</strong></pre>
<pre class="screen">[Flow RR-bgp] <strong>quit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p># Display information about the BGP IPv6 flow specification routes received by <span class="keyword">Device</span>A.</p>
<pre class="screen">&lt;<span class="keyword">Device</span>A&gt; <strong>display bgp flow ipv6 routing-table</strong></pre>
<pre class="screen"> BGP Local router ID is 1.1.1.1
 Status codes: * - valid, &gt; - best, d - damped, x - best external, a - add path,
               h - history,  i - internal, s - suppressed, S - Stale
               Origin : i - IGP, e - EGP, ? - incomplete
 RPKI validation codes: V - valid, I - invalid, N - not-found

 Total Number of Routes: 1
 * &gt;  ReIndex : 2
      Dissemination Rules:
       Port           : eq 100
       FragmentType   : match (Don't fragment)

       MED      : 0                   PrefVal  : 0
       LocalPref: 100
       Path/Ogn :  i</pre>
<p># Check the traffic filtering rule carried in each BGP IPv6 flow specification route based on the corresponding <strong>ReIndex</strong> shown in the preceding command output.</p>
<pre class="screen">&lt;<span class="keyword">Device</span>A&gt; <strong>display bgp flow ipv6 routing-table 2</strong></pre>
<pre class="screen"> BGP local router ID : 1.1.1.1
 Local AS number : 100
 Paths:   1 available, 1 best
 ReIndex : 2
 Order   : 2147483647
 Dissemination Rules :
   Port           : eq 100
   FragmentType   : match (Don't fragment)

 BGP flow-ipv6 routing table entry information of 2:
 Match action :
   apply traffic-rate 9600 KBps
 <strong>From: 3.3.3.3 (3.3.3.3)</strong>
 Route Duration: 0d00h16m31s
 AS-path Nil, origin igp, MED 0, localpref 100, pref-val 0, valid, internal, best, pre 255
 <strong>Originator: 10.2.1.2</strong>
 <strong>Cluster list: 0.0.0.1</strong>
 Not advertised to any peer yet</pre>
<p>The command output shows that <span class="keyword">Device</span>A has learned the route advertised by the server from the Flow RR. The Originator and Cluster_ID attributes of the route are also displayed.</p>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172372368__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p><span class="keyword">Device</span>A configuration file</p>
<pre class="screen">#
sysname <span class="keyword">Device</span>A
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.3.1.2 255.255.255.0
#
interface LoopBack1
 ip address 1.1.1.1 255.255.255.255
#
bgp 100
 router-id 1.1.1.1
 peer 3.3.3.3 as-number 100
 peer 3.3.3.3 connect-interface LoopBack1
 ipv4-family unicast
  undo synchronization
  peer 3.3.3.3 enable
 ipv6-family flow
  peer 3.3.3.3 enable
#
ospf 1
 area 0.0.0.0
  network 1.1.1.1 0.0.0.0
  network 10.3.1.0 0.0.0.255
#
return</pre>
</li><li><p><span class="keyword">Device</span>B configuration file</p>
<pre class="screen">#
sysname <span class="keyword">Device</span>B
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.1.2 255.255.255.0
#
interface LoopBack1
 ip address 2.2.2.2 255.255.255.255
#
bgp 100
 router-id 2.2.2.2
 peer 3.3.3.3 as-number 100
 peer 3.3.3.3 connect-interface LoopBack1
 ipv4-family unicast
  undo synchronization
  peer 3.3.3.3 enable
 ipv6-family flow
  peer 3.3.3.3 enable
#
ospf 1
 area 0.0.0.0
  network 2.2.2.2 0.0.0.0
  network 10.1.1.0 0.0.0.255
#
return</pre>
</li><li><p>Flow RR configuration file</p>
<pre class="screen">#
sysname Flow RR
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.3.1.1 255.255.255.0
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.2.1.1 255.255.255.0
#
interface GigabitEthernet<span>0/3/0</span>
 undo shutdown
 ip address 10.1.1.1 255.255.255.0
#
interface LoopBack1
 ip address 3.3.3.3 255.255.255.255
#
bgp 100
 router-id 3.3.3.3
 peer 1.1.1.1 as-number 100
 peer 1.1.1.1 connect-interface LoopBack1
 peer 2.2.2.2 as-number 100
 peer 2.2.2.2 connect-interface LoopBack1
 peer 10.2.1.2 as-number 100
 #
 ipv4-family unicast
  undo synchronization
  peer 1.1.1.1 enable
  peer 2.2.2.2 enable
  peer 10.2.1.2 enable
 #
 ipv6-family flow
  reflector cluster-id 1
  peer 1.1.1.1 enable
  peer 1.1.1.1 reflect-client
  peer 2.2.2.2 enable
  peer 2.2.2.2 reflect-client
  peer 10.2.1.2 enable
  peer 10.2.1.2 reflect-client
  peer 10.2.1.2 validation-disable
#
ospf 1
 area 0.0.0.0
  network 3.3.3.3 0.0.0.0
  network 10.1.1.0 0.0.0.255
  network 10.2.1.0 0.0.0.255
  network 10.3.1.0 0.0.0.255
#
return</pre>
</li><li><p>Server configuration file</p>
<pre class="screen">#
sysname Server
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.2.1.2 255.255.255.0
#
interface LoopBack1
 ip address 4.4.4.4 255.255.255.255
#
bgp 100
 router-id 4.4.4.4
 peer 3.3.3.3 as-number 100
 ipv4-family unicast
  undo synchronization 
  peer 3.3.3.3 enable
 ipv6-family flow
  peer 3.3.3.3 enable
#
ospf 1
 area 0.0.0.0
  network 4.4.4.4 0.0.0.0
  network 10.2.1.0 0.0.0.255
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_flowspec_cfg_0010.html">Configuration Examples for BGP Flow Specification
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_flowspec_cfg_0015.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_flowspec_cfg_0017.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>