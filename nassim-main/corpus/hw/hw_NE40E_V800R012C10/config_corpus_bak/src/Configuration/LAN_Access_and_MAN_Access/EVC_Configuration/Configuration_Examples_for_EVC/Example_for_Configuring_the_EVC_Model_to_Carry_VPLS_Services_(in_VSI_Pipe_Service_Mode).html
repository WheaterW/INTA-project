
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring the EVC Model to Carry VPLS Services (in VSI Pipe Service Mode)">
<meta name="abstract" content="This section provides an example for configuring the EVC model for a Virtual Switching Instance (VSI) to carry traffic from multiple BDs.">
<meta name="description" content="This section provides an example for configuring the EVC model for a Virtual Switching Instance (VSI) to carry traffic from multiple BDs.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evc_cfg_0018.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evc_cfg_0020.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evc_cfg_0028.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="h00847023,y00852169">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="EVC">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="EVC">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="featurename" content="EVC">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="featurename" content="EVC">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="OWNER" content="p00915595">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="p00915595">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172363408">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>Example for Configuring the EVC Model to Carry VPLS Services (in VSI Pipe Service Mode)</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172363408"></a><a name="EN-US_TASK_0172363408"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring the EVC Model to Carry VPLS Services (in VSI Pipe Service Mode)</h1>
<div class="taskbody"><p>This section provides an example for configuring the EVC model for a Virtual Switching Instance (VSI) to carry traffic from multiple BDs.</p>
<div class="context"><a name="EN-US_TASK_0172363408__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0172363408__fig_dc_vrp_evc_cfg_002701">Figure 1</a>, VLAN is used as the VSI encapsulation type, a VSI is configured as a network-side pipe, and BDs are configured as service instances at the access layer. A VSI can carry service traffic from multiple BDs. To ensure different sites in the same VPN to communicate, bind the BDs to the VSI and configure different pseudowire (PW) tags to identify the BDs.</p>
<div class="fignone" id="EN-US_TASK_0172363408__fig_dc_vrp_evc_cfg_002701"><a name="EN-US_TASK_0172363408__fig_dc_vrp_evc_cfg_002701"></a><a name="fig_dc_vrp_evc_cfg_002701"></a><span class="figcap"><b>Figure 1 </b>Configuring the EVC model to carry VPLS services</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interface 2 in this example represents GE<span>0/1/2</span>.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_evc_cfg_002701.png"></span></div>

<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" frame="border" border="1" rules="all"><caption><b>Table 1 </b>Device interfaces and corresponding configurations</caption><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="16.371637163716375%" id="mcps1.4.1.4.2.6.1.1" liSelected="liSelected"><p>Device</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="9.98099809980998%" id="mcps1.4.1.4.2.6.1.2" liSelected="liSelected"><p>No.</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="30.443044304430444%" id="mcps1.4.1.4.2.6.1.3" liSelected="liSelected"><p>Interface</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="21.602160216021602%" id="mcps1.4.1.4.2.6.1.4" liSelected="liSelected"><p>BD</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="21.602160216021602%" id="mcps1.4.1.4.2.6.1.5" liSelected="liSelected"><p>VLAN</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" rowspan="3" valign="top" width="16.371637163716375%" headers="mcps1.4.1.4.2.6.1.1 "><p>PE1</p>
</td>
<td class="cellrowborder" valign="top" width="9.98099809980998%" headers="mcps1.4.1.4.2.6.1.2 "><p>a</p>
</td>
<td class="cellrowborder" valign="top" width="30.443044304430444%" headers="mcps1.4.1.4.2.6.1.3 "><p>GE<span>0/1/1</span>.1</p>
</td>
<td class="cellrowborder" valign="top" width="21.602160216021602%" headers="mcps1.4.1.4.2.6.1.4 "><p>BD 10</p>
</td>
<td class="cellrowborder" valign="top" width="21.602160216021602%" headers="mcps1.4.1.4.2.6.1.5 "><p>VLAN10</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.6.1.2 "><p>b</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.6.1.3 "><p>GE<span>0/1/1</span>.2</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.6.1.4 "><p>BD 20</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.6.1.5 "><p>VLAN20</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.6.1.2 "><p>c</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.6.1.3 "><p>GE<span>0/1/1</span>.3</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.6.1.4 "><p>BD 20</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.6.1.5 "><p>VLAN30</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="6" valign="top" width="16.371637163716375%" headers="mcps1.4.1.4.2.6.1.1 "><p>CE1</p>
</td>
<td class="cellrowborder" valign="top" width="9.98099809980998%" headers="mcps1.4.1.4.2.6.1.2 "><p>a</p>
</td>
<td class="cellrowborder" valign="top" width="30.443044304430444%" headers="mcps1.4.1.4.2.6.1.3 "><p>GE<span>0/1/2</span>.1</p>
</td>
<td class="cellrowborder" valign="top" width="21.602160216021602%" headers="mcps1.4.1.4.2.6.1.4 "><p>â</p>
</td>
<td class="cellrowborder" valign="top" width="21.602160216021602%" headers="mcps1.4.1.4.2.6.1.5 "><p>VLAN10</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.6.1.2 "><p>b</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.6.1.3 "><p>GE<span>0/1/2</span>.2</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.6.1.4 "><p>â</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.6.1.5 "><p>VLAN20</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.6.1.2 "><p>c</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.6.1.3 "><p>GE<span>0/1/2</span>.3</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.6.1.4 "><p>â</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.6.1.5 "><p>VLAN30</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.6.1.2 "><p>d</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.6.1.3 "><p>GE<span>0/1/1</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.6.1.4 "><p>â</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.6.1.5 "><p>VLAN10</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.6.1.2 "><p>e</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.6.1.3 "><p>GE<span>0/1/3</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.6.1.4 "><p>â</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.6.1.5 "><p>VLAN20</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.6.1.2 "><p>f</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.6.1.3 "><p>GE<span>0/1/5</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.6.1.4 "><p>â</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.6.1.5 "><p>VLAN30</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="3" valign="top" width="16.371637163716375%" headers="mcps1.4.1.4.2.6.1.1 "><p>PE2</p>
</td>
<td class="cellrowborder" valign="top" width="9.98099809980998%" headers="mcps1.4.1.4.2.6.1.2 "><p>a</p>
</td>
<td class="cellrowborder" valign="top" width="30.443044304430444%" headers="mcps1.4.1.4.2.6.1.3 "><p>GE<span>0/1/1</span>.1</p>
</td>
<td class="cellrowborder" valign="top" width="21.602160216021602%" headers="mcps1.4.1.4.2.6.1.4 "><p>BD 10</p>
</td>
<td class="cellrowborder" valign="top" width="21.602160216021602%" headers="mcps1.4.1.4.2.6.1.5 "><p>VLAN10</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.6.1.2 "><p>b</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.6.1.3 "><p>GE<span>0/1/1</span>.2</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.6.1.4 "><p>BD 20</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.6.1.5 "><p>VLAN20</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.6.1.2 "><p>c</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.6.1.3 "><p>GE<span>0/1/1</span>.3</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.6.1.4 "><p>BD 20</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.6.1.5 "><p>VLAN30</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="6" valign="top" width="16.371637163716375%" headers="mcps1.4.1.4.2.6.1.1 "><p>CE2</p>
</td>
<td class="cellrowborder" valign="top" width="9.98099809980998%" headers="mcps1.4.1.4.2.6.1.2 "><p>a</p>
</td>
<td class="cellrowborder" valign="top" width="30.443044304430444%" headers="mcps1.4.1.4.2.6.1.3 "><p>GE<span>0/1/2</span>.1</p>
</td>
<td class="cellrowborder" valign="top" width="21.602160216021602%" headers="mcps1.4.1.4.2.6.1.4 "><p>â</p>
</td>
<td class="cellrowborder" valign="top" width="21.602160216021602%" headers="mcps1.4.1.4.2.6.1.5 "><p>VLAN10</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.6.1.2 "><p>b</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.6.1.3 "><p>GE<span>0/1/2</span>.2</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.6.1.4 "><p>â</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.6.1.5 "><p>VLAN20</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.6.1.2 "><p>c</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.6.1.3 "><p>GE<span>0/1/2</span>.3</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.6.1.4 "><p>â</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.6.1.5 "><p>VLAN30</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.6.1.2 "><p>d</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.6.1.3 "><p>GE<span>0/1/1</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.6.1.4 "><p>â</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.6.1.5 "><p>VLAN10</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.6.1.2 "><p>e</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.6.1.3 "><p>GE<span>0/1/3</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.6.1.4 "><p>â</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.6.1.5 "><p>VLAN20</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.6.1.2 "><p>f</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.6.1.3 "><p>GE<span>0/1/5</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.6.1.4 "><p>â</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.6.1.5 "><p>VLAN30</p>
</td>
</tr>
</tbody>
</table>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172363408__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Precautions</h4><p>PWs are used on VPLS networks to carry services and process service packets based on the VSI encapsulation type. If the VSI pipe service mode is used, the VSI encapsulation type must be VLAN.</p>
</div></div>
<div class="context"><a name="EN-US_TASK_0172363408__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure Layer 2 forwarding on each CE.</p>
<ol type="a"><li>Create VLANs on each CE, add the CE's downstream interfaces to the corresponding VLANs.</li><li>Configure Layer 2 forwarding on the interface connecting each CE to the network side so that a CE sends single-tagged packets to a PE.</li></ol>
</li><li><p>Configure VPLS on each PE.</p>
<ol type="a"><li>Configure a routing protocol on PEs to implement network connectivity.</li><li>Configure basic Multiprotocol Label Switching (MPLS) functions, enable MPLS Label Distribution Protocol (LDP), and establish LDP Label Switched Paths (LSPs) on the PEs.</li><li>Enable MPLS L2VPN on each PE and enable L2VPN globally.</li><li>Create a VSI and configure Label Distribution Protocol (LDP) signaling. (VSI IDs are used to identify VSIs and used for PW signaling negotiation.)</li></ol>
</li><li>Configure the EVC model on each PE:<ol type="a"><li>Configure BDs to forward services.</li><li>Create EVC Layer 2 sub-interfaces and add them to BDs. Configure the traffic encapsulation type and flow behavior for the downstream interfaces.</li><li>Bind the BDs to the VSI so that the EVC model can be used to carry VPLS services.</li></ol>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172363408__1.4.4"></a><a name="1.4.4"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><div class="p">To complete the configuration, you need the following data:<ul><li>User VLAN IDs</li><li>Number of interfaces that connect CEs to users and connect CEs to PEs</li><li>Number and IP addresses of interfaces connecting PEs</li><li>VSI ID on PEs (that must have the same VSI ID), MPLS LSR IDs, VSI name, and names of interfaces bound to a VSI</li><li>BD ID, traffic encapsulation type, and traffic behavior<div class="notice"><span class="noticetitle"><img src="../../../../public_sys-resources/notice_3.0-en-us.png"> </span><div class="noticebody"><p>The PW tag must match the peer PW tag.</p>
</div></div>
</li></ul>
</div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172363408__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure Layer 2 forwarding on the CEs.</span><p><p># Configure CE1.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname CE1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1]<strong> vlan 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-vlan10]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1]<strong> interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/1</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/1</span>]<strong> portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/1</span>]<strong> port link-type access</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/1</span>]<strong> port default vlan 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/1</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1]<strong> interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/2</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/2</span>]<strong> portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/2</span>]<strong> port link-type trunk</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/2</span>]<strong> port trunk allow-pass vlan 10</strong> <strong>20 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/2</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1-GigabitEthernet<span>0/1/2</span>]<strong> quit</strong></pre>
<p>This example uses the configurations of GE<span>0/1/1</span> and GE<span>0/1/2</span>. For configuration details of the other interfaces, see Configuration Files in this section.</p>
<p># Configure CE2.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname CE2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2]<strong> vlan 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-vlan10]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2]<strong> interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>]<strong> portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>]<strong> port link-type access</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>]<strong> port default vlan 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2]<strong> interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/2</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/2</span>]<strong> portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/2</span>]<strong> port link-type trunk</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/2</span>]<strong> port trunk allow-pass vlan 10</strong> <strong>20 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/2</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2-GigabitEthernet<span>0/1/2</span>]<strong> quit</strong></pre>
<p>This example uses the configurations of GE<span>0/1/1</span> and GE<span>0/1/2</span>. For configuration details of the other interfaces, see Configuration Files in this section.</p>
</p></li><li><span>Configure VPLS.</span><p><ol type="a"><li><p>Configure OSPF on the PEs.</p>
<p>Assign an IP address to each PE interface. After OSPF is enabled, the 32-bit loopback address of each PE must be advertised.</p>
<p># Configure PE1.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname PE1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack1]<strong> ip address 1.1.1.9 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/2</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/2</span>]<strong> ip address 10.1.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/2</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> ospf</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1]<strong> area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1-area-0.0.0.0]<strong> network 1.1.1.9 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1-area-0.0.0.0]<strong> network 10.1.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1-area-0.0.0.0]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname PE2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2]<strong> interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-LoopBack1]<strong> ip address 2.2.2.9 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-LoopBack1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/2</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/2</span>]<strong> ip address 10.1.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/2</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> ospf</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-1]<strong> area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-1-area-0.0.0.0]<strong> network 2.2.2.9 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-1-area-0.0.0.0]<strong> network 10.1.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-1-area-0.0.0.0]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> commit</strong></pre>
<p>After the configuration is complete, PE1 and PE2 have learned the routes destined for Loopback1 interface of each other, and PE1 and PE2 can successfully ping each other.</p>
<p>The following example uses the command output on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> display ip routing-table</strong></pre>
<pre class="screen"><span class="keyword">Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route</span>
------------------------------------------------------------------------------
Routing Table : _public_
         Destinations : 9        Routes : 9

Destination/Mask    Proto   Pre  Cost        Flags NextHop         Interface

        1.1.1.9/32  Direct  0    0             D  127.0.0.1       LoopBack1
        2.2.2.9/32  <strong>OSPF</strong>    10   1             D  10.1.1.2        GigabitEthernet<span>0/1/2</span>
       10.1.1.0/24  Direct  0    0             D  10.1.1.1        GigabitEthernet<span>0/1/2</span>
       10.1.1.1/32  Direct  0    0             D  127.0.0.1       GigabitEthernet<span>0/1/2</span>
     10.1.1.255/32  Direct  0    0             D  127.0.0.1       GigabitEthernet<span>0/1/2</span>
      127.0.0.0/8   Direct  0    0             D  127.0.0.1       InLoopBack0
      127.0.0.1/32  Direct  0    0             D  127.0.0.1       InLoopBack0
127.255.255.255/32  Direct  0    0             D  127.0.0.1       InLoopBack0
255.255.255.255/32  Direct  0    0             D  127.0.0.1       InLoopBack0</pre>
</li><li><p>Configure basic MPLS functions and LDP.</p>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> mpls lsr-id 1.1.1.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/2</span>]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/2</span>]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/2</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2]<strong> mpls lsr-id 2.2.2.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/2</span>]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/2</span>]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/2</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> commit</strong></pre>
<p>After completing the preceding configuration, run the <strong><span>display mpls ldp session</span></strong> command on each PE. The command output shows that the LDP session is in the <strong>Operational</strong> state, indicating that the LDP session between PE1 and PE2 has been established.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> display mpls ldp session</strong></pre>
<pre class="screen"> LDP Session(s) in Public Network
 Codes: LAM(Label Advertisement Mode), SsnAge Unit(DDDD:HH:MM)
<span> An asterisk (*) before a session means the session is being deleted.</span>
--------------------------------------------------------------------------
 PeerID             Status      LAM  SsnRole  SsnAge       KASent/Rcv
--------------------------------------------------------------------------
 2.2.2.9:0          Operational DU   Passive  0000:00:00   1/1
--------------------------------------------------------------------------
TOTAL: 1 Session(s) Found.</pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>If the PEs are indirectly connected, run the <strong><span>mpls ldp remote-peer</span></strong> and <strong><span>remote-ip</span></strong> commands to create a remote LDP session between the PEs.</p>
</div></div>
</li><li><p>Enable MPLS L2VPN.</p>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-l2vpn]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2]<strong> mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-l2vpn]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> commit</strong></pre>
</li><li><p>Create a VSI and configure LDP signaling.</p>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> vsi ldp1 bd-mode</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-ldp1]<strong> pwsignal ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-ldp1-ldp]<strong> vsi-id 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-ldp1-ldp]<strong> peer 2.2.2.9</strong>
[<span class="keyword">*</span>PE1-vsi-ldp1-ldp]<strong> encapsulation vlan</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-ldp1-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-ldp1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2]<strong> vsi ldp1 bd-mode</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-ldp1]<strong> pwsignal ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-ldp1-ldp]<strong> vsi-id 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-ldp1-ldp]<strong> peer 1.1.1.9</strong>
[<span class="keyword">*</span>PE2-vsi-ldp1-ldp]<strong>encapsulation vlan</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-ldp1-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-ldp1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> commit</strong></pre>
</li></ol>
</p></li><li><span>Establish the EVC model.</span><p><ol type="a"><li><p>Create BDs on the PEs.</p>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bd10]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> bridge-domain 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bd20]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2]<strong> bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bd10]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2]<strong> bridge-domain 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bd20]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> commit</strong></pre>
</li><li><p>Create EVC Layer 2 sub-interfaces and add them to BDs. Configure the traffic encapsulation type and behavior.</p>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> interface gigabitethernet <span>0/1/1</span>.1 mode l2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>.1]<strong> encapsulation dot1q vid 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>.1]<strong> rewrite pop single</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>.1]<strong> bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>.1]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/1</span>.1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> interface gigabitethernet <span>0/1/1</span>.2 mode l2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>.2]<strong> encapsulation dot1q vid 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>.2]<strong> rewrite pop single</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>.2]<strong> bridge-domain 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>.2]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/1</span>.2]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> interface gigabitethernet <span>0/1/1</span>.3 mode l2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>.3]<strong> encapsulation dot1q vid 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>.3]<strong> rewrite pop single</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>.3]<strong> bridge-domain 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>.3]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/1</span>.3]<strong> quit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2]<strong> interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> interface gigabitethernet <span>0/1/1</span>.1 mode l2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>.1]<strong> encapsulation dot1q vid 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>.1]<strong> rewrite pop single</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>.1]<strong> bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>.1]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-GigabitEthernet<span>0/1/1</span>.1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> interface gigabitethernet <span>0/1/1</span>.2 mode l2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>.2]<strong> encapsulation dot1q vid 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>.2]<strong> rewrite pop single</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>.2]<strong> bridge-domain 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>.2]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-GigabitEthernet<span>0/1/1</span>.2]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> interface gigabitethernet <span>0/1/1</span>.3 mode l2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>.3]<strong> encapsulation dot1q vid 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>.3]<strong> rewrite pop single</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>.3]<strong> bridge-domain 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>.3]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-GigabitEthernet<span>0/1/1</span>.3]<strong> quit</strong></pre>
</li><li><p>Bind BDs to the VSI.</p>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bd10]<strong> l2 binding vsi ldp1 pw-tag 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bd10]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bd10]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> bridge-domain 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bd20]<strong> l2 binding vsi ldp1 pw-tag 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bd20]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bd20]<strong> quit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2]<strong> bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bd10]<strong> l2 binding vsi ldp1 pw-tag 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bd10]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2]<strong> bridge-domain 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bd20]<strong> l2 binding vsi ldp1 pw-tag 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bd20]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2]<strong> quit</strong></pre>
</li></ol>
</p></li><li><span>Verify the configuration.</span><p><p>After completing the configuration, run the <a href="cmdqueryname=display+bridge-domain"><b><span class="cmdname">display bridge-domain</span></b></a> command. The command output shows the BD to which an EVC Layer 2 sub-interface belongs and the BD status. The following example uses the command output on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display bridge-domain</strong></pre>
<pre class="screen">The total number of bridge-domains is : 1
--------------------------------------------------------------------------------
MAC_LRN: MAC learning;         STAT: Statistics;         SPLIT: Split-horizon;
BC: Broadcast;                 MC: Unknown multicast;    UC: Unknown unicast;
*down: Administratively down;  FWD: Forward;             DSD: Discard;
--------------------------------------------------------------------------------

BDID  State MAC-LRN STAT    BC  MC  UC  SPLIT   Description
--------------------------------------------------------------------------------
10    up    enable  disable FWD FWD FWD disable                   
20    up    enable  disable FWD FWD FWD disable                   </pre>
<p>Run the <a href="cmdqueryname=display+ethernet+uni+information"><b><span class="cmdname">display ethernet uni information</span></b></a> command. The command output shows the traffic encapsulation type and behavior configured on an EVC Layer 2 sub-interface. The following example uses the command output on PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>display ethernet uni information</strong></pre>
<pre class="screen">  GigabitEthernet<span>0/1/1</span>.1
    Total encapsulation number: 1
      encapsulation dot1q vid 10
    Rewrite pop single
  GigabitEthernet<span>0/1/1</span>.2
    Total encapsulation number: 1
      encapsulation dot1q vid 20
    Rewrite pop single
  GigabitEthernet<span>0/1/1</span>.3
    Total encapsulation number: 1
      encapsulation dot1q vid 30
    Rewrite pop single</pre>
<p>Run the <strong><span>display vsi name ldp1 verbose</span></strong> command. The command output shows that a PW for a VSI named <strong>ldp1</strong> has been established between PE1 and PE2, and the VSI status is <strong>Up</strong>. The following example uses the command output on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] display vsi name ldp1 verbose</pre>
<pre class="screen">***VSI Name               : ldp1
    Administrator VSI      : no
    Isolate Spoken         : disable
    VSI Index              : 2
    PW Signaling           : ldp
    Member Discovery Style : --
    Bridge-domain Mode     : enable
    PW MAC Learn Style     : qualify
    Encapsulation Type     : ethernet
    MTU                    : 1500
    Ignore AcState         : disable
    P2P VSI                : disable
    Create Time            : 0 days, 0 hours, 1 minutes, 56 seconds
    VSI State              : <strong>up</strong>
    Resource Status        : --

    VSI ID                 : 2
   *Peer Router ID         : 2.2.2.9
    primary or secondary   : primary
    ignore-standby-state   : no
    VC Label               : 32830
    Peer Type              : dynamic
    Session                : up
    Tunnel ID              : 0x0000000001004c4b42
    Broadcast Tunnel ID    : --
    Broad BackupTunnel ID  : --
    CKey                   : 33
    NKey                   : 1409286261
    Stp Enable             : 0
    PwIndex                : 33
<span>    Control Word           : disable</span>

    Access Bridge-domain   : Bridge-domain 10 , PW tag 10 
    Access Bridge-domain   : Bridge-domain 20 , PW tag 20 

  **PW Information:

   *Peer Ip Address        : 2.2.2.9
    PW State               : <strong>up</strong>
    Local VC Label         : 32830
    Remote VC Label        : 32831
<span>    Remote Control Word    : disable</span>
    PW Type                : label
    Tunnel ID              : 0x0000000001004c4b42
    Broadcast Tunnel ID    : --
    Broad BackupTunnel ID  : --
    Ckey                   : 33
    Nkey                   : 1409286261
    Main PW Token          : 0x0
    Slave PW Token         : 0x0
    Tnl Type               : ldp
    OutInterface           :
    Backup OutInterface    : --
    Stp Enable             : 0
    Mac Flapping           : 0
    PW Last Up Time        : 1976/12/04 00:05:59
    PW Total Up Time       : 0 days, 0 hours, 0 minutes, 17 seconds</pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172363408__1.4.6"></a><a name="1.4.6"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>PE1 configuration file</p>
<pre class="screen">#
sysname PE1
#
mpls lsr-id 1.1.1.9
#
mpls
#
mpls l2vpn
#
vsi ldp1 bd-mode
 pwsignal ldp
  vsi-id 2
  peer 2.2.2.9
 encapsulation vlan
#
bridge-domain 10
 l2 binding vsi ldp1 pw-tag 10
#
bridge-domain 20
 l2 binding vsi ldp1 pw-tag 20
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
#
interface GigabitEthernet<span>0/1/1</span>.1 mode l2
 encapsulation dot1q vid 10
 rewrite pop single
 bridge-domain 10
#
interface GigabitEthernet<span>0/1/1</span>.2 mode l2
 encapsulation dot1q vid 20
 rewrite pop single
 bridge-domain 20
#
interface GigabitEthernet<span>0/1/1</span>.3 mode l2
 encapsulation dot1q vid 30
 rewrite pop single
 bridge-domain 20
#
interface loopback 1
 ip address 1.1.1.9 255.255.255.255
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ip address 10.1.1.1 255.255.255.0
 mpls
 mpls ldp
#
ospf 1
 area 0.0.0.0
  network 1.1.1.9 0.0.0.0
  network 10.1.1.0 0.0.0.255
#
return</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#
sysname PE2
#
mpls lsr-id 2.2.2.9
#
mpls
#
mpls l2vpn
#
vsi ldp1 bd-mode
 pwsignal ldp
  vsi-id 2
  peer 1.1.1.9
 encapsulation vlan
#
bridge-domain 10
 l2 binding vsi ldp1 pw-tag 10
#
bridge-domain 20
 l2 binding vsi ldp1 pw-tag 20
#
mpls ldp
 #
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
#
interface GigabitEthernet<span>0/1/1</span>.1 mode l2
 encapsulation dot1q vid 10
 rewrite pop single
 bridge-domain 10
#
interface GigabitEthernet<span>0/1/1</span>.2 mode l2
 encapsulation dot1q vid 20
 rewrite pop single
 bridge-domain 20
#
interface GigabitEthernet<span>0/1/1</span>.3 mode l2
 encapsulation dot1q vid 30
 rewrite pop single
 bridge-domain 20
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ip address 10.1.1.2 255.255.255.0
 mpls
 mpls ldp
#
interface loopback 1
 ip address 2.2.2.9 255.255.255.255
#
ospf 1
 area 0.0.0.0
  network 2.2.2.9 0.0.0.0
  network 10.1.1.0 0.0.0.255
#
return</pre>
</li><li><p>CE1 configuration file</p>
<pre class="screen">#
sysname CE1
#
vlan batch 10
vlan batch 20
vlan batch 30
#
interface GigabitEthernet<span>0/1/1</span>
 portswitch
 undo shutdown
 port link-type access
 port default vlan 10
#
interface GigabitEthernet<span>0/1/3</span>
 portswitch
 undo shutdown
 port link-type access
 port default vlan 20
#
interface GigabitEthernet<span>0/1/5</span>
 portswitch
 undo shutdown
 port link-type access
 port default vlan 30
#
interface GigabitEthernet<span>0/1/2</span>
 portswitch
 undo shutdown
 port link-type trunk
 port trunk allow-pass vlan 10 20 30
#
return</pre>
</li><li><p>CE2 configuration file</p>
<pre class="screen">#
sysname CE2
#
vlan batch 10
#
interface GigabitEthernet<span>0/1/1</span>
 portswitch
 undo shutdown
 port link-type access
 port default vlan 10
#
interface GigabitEthernet<span>0/1/3</span>
 portswitch
 undo shutdown
 port link-type access
 port default vlan 20
#
interface GigabitEthernet<span>0/1/5</span>
 portswitch
 undo shutdown
 port link-type access
 port default vlan 30
#
interface GigabitEthernet<span>0/1/2</span>
 portswitch
 undo shutdown
 port link-type trunk
 port trunk allow-pass vlan 10 20 30
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evc_cfg_0018.html">Configuration Examples for EVC
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evc_cfg_0020.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evc_cfg_0028.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>