
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring Three-Segment VXLAN to Implement Layer 3 Interworking">
<meta name="abstract" content="The three-segment VXLAN can be configured to enable communications between inter-subnet VMs in DCs that belong to different ASs.">
<meta name="description" content="The three-segment VXLAN can be configured to enable communications between inter-subnet VMs in DCs that belong to different ASs.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vxlan_cfg_1218.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vxlan_cfg_1220.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="h00847023">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="OWNER" content="p00915595">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00830487">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172363812">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring Three-Segment VXLAN to Implement Layer 3 Interworking</title>
</head>
<body><a name="EN-US_TASK_0172363812"></a><a name="EN-US_TASK_0172363812"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring Three-Segment VXLAN to Implement Layer 3 Interworking</h1>
<div class="taskbody"><p>The three-segment VXLAN can be configured to enable communications between inter-subnet VMs in DCs that belong to different ASs.</p>
<div class="context"><a name="EN-US_TASK_0172363812__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>As shown in <a href="#EN-US_TASK_0172363812__fig_dc_vrp_vxlan_cfg_108601">Figure 1</a>, BGP EVPN must be configured to create VXLAN tunnels between distributed gateways in each DC and to create VXLAN tunnels between leaf nodes so that the inter-subnet VMs in DC A and DC B can communicate with each other.</p>
<p>When DC A and DC B belong to the same BGP AS, Leaf2 or Leaf3 does not forward EVPN routes received from an IBGP EVPN peer to other IBGP EVPN peers. Therefore, it is necessary to configure Leaf2 and Leaf3 as route reflectors (RRs).</p>
<div class="fignone" id="EN-US_TASK_0172363812__fig_dc_vrp_vxlan_cfg_108601"><a name="EN-US_TASK_0172363812__fig_dc_vrp_vxlan_cfg_108601"></a><a name="fig_dc_vrp_vxlan_cfg_108601"></a><span class="figcap"><b>Figure 1 </b>Network diagram of configuring the three-segment VXLAN tunnels</span><br><span><img class="vsd" src="images/fig_dc_vrp_vxlan_cfg_108601.png"></span></div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172363812__1.4.2"></a><a name="1.4.2"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure EVPN within DC A and DC B to establish VXLAN tunnels. For detailed configurations, see <a href="dc_vrp_vxlan_cfg_1216.html">Configuring VXLAN in Distributed Gateway Mode Using BGP EVPN</a>.</span></li><li><span>Configure BGP EVPN on Leaf2 and Leaf3 to establish a VXLAN tunnel between them. For detailed configurations, see <a href="dc_vrp_vxlan_cfg_1216.html">Configuring VXLAN in Distributed Gateway Mode Using BGP EVPN</a>.</span></li><li><span>(Optional) Configure Leaf2 and Leaf3 as RRs. For detailed configurations, see <a href="dc_vrp_bgp_cfg_3034.html">Configuring a BGP Route Reflector</a>.</span></li><li><span>Configure Leaf2 and Leaf3 to advertise routes that are re-originated by the EVPN address family to BGP EVPN peers.</span><ol type="a"><li class="substepexpand"><span>Run the <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i> command to enter the BGP view.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=l2vpn-family"><b><span class="cmdname">l2vpn-family</span></b></a> <strong><span>evpn</span></strong> command to enter the BGP-EVPN address family view.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>import</span></strong> <strong><span>reoriginate</span></strong> command to enable the function to re-originate routes received from BGP EVPN peers.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>advertise</span></strong> <strong><span>route-reoriginated</span></strong> <strong><span>evpn</span></strong> { <strong><span>mac-ip</span></strong> | <strong><span>ip</span></strong><span> | <strong><span>mac-ipv6</span></strong> | <strong><span>ipv6</span></strong></span> } command to enable the function to advertise re-originated EVPN routes to BGP EVPN peers.</span><p><p>After route re-origination is enabled, Leaf2 or Leaf3 changes the next hop of a received EVPN route to itself, replaces the router MAC address in the gateway MAC address attribute with its own router MAC address, and replaces the Layer 3 VNI with the VPN instance Layer 3 VNI.</p>
</p></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a> command to return to the BGP view.</span></li></ol>
</li><li><span>(Optional) Configure local EVPN route leaking on Leaf2 and Leaf3. To use different VPN instances for different service access in a DC, and to shield the VPN instance allocation within the DC from outside by using an external VPN instance for communication with other DCs, perform the following steps on each edge leaf node:</span><ol type="a"><li class="substepexpand"><span>Run the <a href="cmdqueryname=ipv4-family+vpn-instance"><b><span class="cmdname">ipv4-family vpn-instance</span></b></a><strong> </strong><i><span class="varname">vpn-instance-name</span></i> or <a href="cmdqueryname=ipv6-family+vpn-instance"><b><span class="cmdname">ipv6-family vpn-instance</span></b></a><strong> </strong><i><span class="varname">vpn-instance-name</span></i> command to enter the BGP-VPN instance IPv4 or IPv6 address family view.</span><p><p>Here, <i><span class="varname">vpn-instance-name</span></i> specifies the name of the source VPN instance for local route leaking, which corresponds to the name of the VPN instance used to provide access for different services in the local DC.</p>
</p></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=local-cross+export+evpn-rt-match"><b><span class="cmdname">local-cross export evpn-rt-match</span></b></a> command to allow the locally imported routes and routes received from VPN peers to be leaked to other local VPN instances.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=local-cross+allow-remote-cross-route"><b><span class="cmdname">local-cross allow-remote-cross-route</span></b></a> command to allow the routes imported from the remote EVPN instance to be leaked to other local VPN instances.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a> command to return to the BGP view.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=ipv4-family+vpn-instance"><b><span class="cmdname">ipv4-family vpn-instance</span></b></a><strong> </strong><i><span class="varname">vpn-instance-name</span></i> or <a href="cmdqueryname=ipv6-family+vpn-instance"><b><span class="cmdname">ipv6-family vpn-instance</span></b></a><strong> </strong><i><span class="varname">vpn-instance-name</span></i> command to enter the BGP-VPN instance IPv4 or IPv6 address family view.</span><p><p>Here, <i><span class="varname">vpn-instance-name</span></i> specifies the name of the destination VPN instance for local route leaking, which corresponds to the name of the VPN instance used for communication with the external network.</p>
</p></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=advertise+l2vpn+evpn"><b><span class="cmdname">advertise l2vpn evpn</span></b></a> <strong><span>include-local-cross-route</span></strong> command to enable the VPN instance to advertise routes leaked from other local VPN instances as EVPN IP prefix routes.</span><p><p>By default, locally leaked routes in a VPN instance are not advertised to peers through BGP EVPN. After this step is performed, the external VPN instance can advertise routes leaked from other local service VPN instances to peers through EVPN IP prefix routes. In this way, the external VPN instance can communicate with other DCs.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The EVPN ERT of the source VPN instance must be in the EVPN IRT list of the destination VPN instance, so that local route leaking can be correctly implemented.</p>
</div></div>
</p></li></ol>
</li><li><span>Run the <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a> command to commit the configuration.</span></li></ol></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vxlan_cfg_1218.html">Configuring Three-Segment VXLAN to Implement DCI
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vxlan_cfg_1220.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>