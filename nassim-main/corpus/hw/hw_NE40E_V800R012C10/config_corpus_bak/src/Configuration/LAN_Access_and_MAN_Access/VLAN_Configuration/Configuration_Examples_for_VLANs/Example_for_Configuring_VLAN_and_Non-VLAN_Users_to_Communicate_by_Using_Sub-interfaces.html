
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring VLAN and Non-VLAN Users to Communicate by Using Sub-interfaces">
<meta name="abstract" content="This example describes how to configure communication between VLAN users and non-VLAN users.">
<meta name="description" content="This example describes how to configure communication between VLAN users and non-VLAN users.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vlan_cfg_0033.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vlan_cfg_0036.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vlan_cfg_0038.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="wwx1238417">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="VLAN">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="VLAN">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="featurename" content="VLAN">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="featurename" content="VLAN">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="OWNER" content="c00648116,w00437000">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="wwx1238417">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172363176">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring VLAN and Non-VLAN Users to Communicate by Using Sub-interfaces</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172363176"></a><a name="EN-US_TASK_0172363176"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring VLAN and Non-VLAN Users to Communicate by Using Sub-interfaces</h1>
<div class="taskbody"><p>This example describes how to configure communication between VLAN users and non-VLAN users.</p>
<div class="context"><a name="EN-US_TASK_0172363176__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>Residents in a residential compound belong to different network segments. To simplify management, the network administrator of the residential compound adds users to different VLANs. Residents in another residential compound are not added to any VLAN. VLAN users must be able to communicate with non-VLAN users.</p>
<p>On the network shown in <a href="#EN-US_TASK_0172363176__fig_dc_vrp_vlan_cfg_003701">Figure 1</a>, users in residential compound 1 belong to different VLANs and network segments, and users in residential compound 2 do not belong to any VLAN. It is required that the network permit the communication between users in VLAN 10 and users in residential compound 2.</p>
<div class="fignone" id="EN-US_TASK_0172363176__fig_dc_vrp_vlan_cfg_003701"><a name="EN-US_TASK_0172363176__fig_dc_vrp_vlan_cfg_003701"></a><a name="fig_dc_vrp_vlan_cfg_003701"></a><span class="figcap"><b>Figure 1 </b>Network diagram of configuring VLAN and non-VLAN users to communicate by using sub-interfaces</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interfaces 1 through 3 and subinterface1.1 represent GE<span>0/1/1</span>, GE<span>0/1/2</span>, GE<span>0/1/3</span>, and GE<span>0/1/1</span>.1, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0000002112090040.png" width="NaN" height="NaN"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172363176__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li>Create VLANs on the CEs and determine the VLANs to which users belong.</li><li>Configure Layer 2 interfaces on the CEs to allow frames from the VLANs to pass through.</li><li>Create a sub-interface on the interface connecting the PE to VLAN users and associate the sub-interface with the VLAN.</li><li><p>Assign IP addresses to interfaces for communication at the network layer.</p>
<ul><li>Assign an IP address to the sub-interface.</li><li>Assign an IP address to the interface connecting the PE to non-VLAN users.</li></ul>
</li></ol>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><ul><li>The IP address assigned to the sub-interface connected to VLAN users must be on the same network segment with IP addresses of VLAN users.</li><li>The IP address assigned to the interface connected to non-VLAN users must be on the same network segment with IP addresses of non-VLAN users.</li><li>The default gateway addresses of PCs in VLAN 10 must be the IP address of the sub-interface. Otherwise, VLAN and non-VLAN users cannot communicate with each other.</li></ul>
</div></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172363176__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><div class="p">To complete the configuration, you need the following data:<ul id="EN-US_TASK_0172363176__en-us_task_0172363174_ul537133836214028"><li id="EN-US_TASK_0172363176__en-us_task_0172363174_li_3">User VLAN ID</li><li id="EN-US_TASK_0172363176__en-us_task_0172363174_li_4">User IP address</li><li id="EN-US_TASK_0172363176__en-us_task_0172363174_li_5">Number of each port connecting a CE to a PC</li><li id="EN-US_TASK_0172363176__en-us_task_0172363174_li2139103013214028">Number of each port connecting a CE to the PE</li><li id="EN-US_TASK_0172363176__en-us_task_0172363174_li743526162214028">Number and IP address of each sub-interface on PE</li></ul>
</div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172363176__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Create a VLAN on CE 1.</span><p><pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname CE1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>vlan batch 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-vlan10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/1</span>]<strong> portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/1</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/1</span>]<strong> port link-type access</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/1</span>]<strong> port default vlan 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/1</span>]<strong> quit</strong></pre>
</p></li><li><span>Configure the trunk port on CE 1 to allow frames with certain VLAN IDs to pass through.</span><p><pre class="screen">[<span class="keyword">*</span>CE1] <strong>interface gigabitethernet <span>0/1/3</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/3</span>]<strong> portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/3</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/3</span>]<strong> port link-type trunk</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/3</span>]<strong> port trunk allow-pass vlan 10 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/3</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1]<strong> commit</strong></pre>
</p></li><li><span>Create a sub-interface on PE and associate the sub-interface with VLAN 10.</span><p><pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname PE</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE]<strong> interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-GigabitEthernet<span>0/1/1</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-GigabitEthernet<span>0/1/1</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE]<strong> interface gigabitethernet <span>0/1/1</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-GigabitEthernet<span>0/1/1</span>.1]<strong> vlan-type dot1q 10</strong></pre>
</p></li><li><span>Configure IP addresses.</span><p><pre class="screen">[<span class="keyword">*</span>PE-GigabitEthernet<span>0/1/1</span>.1]<strong> ip address 10.110.2.5 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-GigabitEthernet<span>0/1/1</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE]<strong> interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-GigabitEthernet<span>0/1/2</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-GigabitEthernet<span>0/1/2</span>]<strong> ip address 10.110.3.5 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-GigabitEthernet<span>0/1/2</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE]<strong> commit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p>On PCs in VLAN 10, configure the IP address 10.110.2.5/24 of GE <span>0/1/1</span>.1 as the default gateway address.</p>
<p>On CE 2, configure the IP address 10.110.3.5 of GE <span>0/1/2</span> as the default gateway address.</p>
<p>After the configurations, users in VLAN 10 and non-VLAN users can ping each other successfully.</p>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172363176__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>CE1 configuration file</p>
<pre class="screen">#</pre>
<pre class="screen"> sysname CE1</pre>
<pre class="screen">#</pre>
<pre class="screen"> vlan batch 10</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/1</span></pre>
<pre class="screen"> portswitch</pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> port link-type access</pre>
<pre class="screen"> port default vlan 10</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/3</span></pre>
<pre class="screen"> portswitch</pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> port link-type trunk</pre>
<pre class="screen"> port trunk allow-pass vlan 10 20</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p>PE configuration file</p>
<pre class="screen">#</pre>
<pre class="screen"> sysname PE</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/1</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/1</span>.1</pre>
<pre class="screen"> vlan-type dot1q 10</pre>
<pre class="screen"> ip address 10.110.2.5 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/2</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.110.3.5 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vlan_cfg_0033.html">Configuration Examples for VLANs
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vlan_cfg_0036.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vlan_cfg_0038.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>