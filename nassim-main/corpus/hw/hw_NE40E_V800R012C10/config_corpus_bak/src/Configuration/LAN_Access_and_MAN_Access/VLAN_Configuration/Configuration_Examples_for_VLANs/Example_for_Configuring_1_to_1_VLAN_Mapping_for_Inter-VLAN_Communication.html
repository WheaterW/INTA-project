
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring 1 to 1 VLAN Mapping for Inter-VLAN Communication">
<meta name="abstract" content="1 to 1 VLAN mapping allows user VLAN IDs and the ISP VLAN ID to be replaced with each other to help users in different VLANs to communicate with each other.">
<meta name="description" content="1 to 1 VLAN mapping allows user VLAN IDs and the ISP VLAN ID to be replaced with each other to help users in different VLANs to communicate with each other.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vlan_cfg_0033.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vlan_cfg_0038.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vlan_cfg_0039.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="wwx1238417">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="VLAN">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="VLAN">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="featurename" content="VLAN">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="featurename" content="VLAN">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="OWNER" content="c00648116,w00437000">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="wwx1238417">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172363180">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring 1 to 1 VLAN Mapping for Inter-VLAN Communication</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172363180"></a><a name="EN-US_TASK_0172363180"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring 1 to 1 VLAN Mapping for Inter-VLAN Communication</h1>
<div class="taskbody"><p>1 to 1 VLAN mapping allows user VLAN IDs and the ISP VLAN ID to be replaced with each other to help users in different VLANs to communicate with each other. </p>
<div class="context"><a name="EN-US_TASK_0172363180__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>Users in different residential compounds use Internet access, IPTV, and VoIP services. To simplify management, the network administrator of each residential compound configures a separate VLAN for each type of services. After the configuration, users using the same type of services in different residential compounds belong to different VLANs, but they need to communicate with each other.</p>
<p>On the network shown in <a href="#EN-US_TASK_0172363180__fig_dc_vrp_vlan_cfg_006001">Figure 1</a>, the same type of services in residential compounds 1 and 2 belong to different VLANs. It is required that these users communicate with each other at a low operating cost.</p>
<div class="fignone" id="EN-US_TASK_0172363180__fig_dc_vrp_vlan_cfg_006001"><a name="EN-US_TASK_0172363180__fig_dc_vrp_vlan_cfg_006001"></a><a name="fig_dc_vrp_vlan_cfg_006001"></a><span class="figcap"><b>Figure 1 </b>Network diagram of configuring 1 to 1 VLAN mapping for inter-VLAN communication</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interfaces 1 through 3 represent GE<span>0/1/1</span>, GE<span>0/1/2</span>, and GE<span>0/1/3</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0000001371705773.png" width="NaN" height="NaN"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172363180__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows: </p>
<ol><li>Add ports connecting CE1 to residential compound 1 to VLAN 6. Add ports connecting CE2 to residential compound 2 to VLAN 5.</li><li>Configure 1 to 1 VLAN mapping on devices at the edge of the ISP network to map user VLAN IDs to the ISP VLAN ID to allow users in different VLANs to communicate with each other.</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172363180__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data: </p>
<ul><li>Number of each port connecting a CE to a user device</li><li>Number of the ports interconnecting CEs</li><li>VLAN IDs configured on CEs</li><li>VLAN ID provided by the ISP</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172363180__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Add ports connecting CEs to user devices to specified VLANs.</span><p><p># Configure CE1.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname CE1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1]<strong> vlan 6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-vlan6]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1]<strong> interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/1</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/1</span>]<strong> portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/1</span>]<strong> port link-type access</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/1</span>]<strong> port default vlan 6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/1</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1]<strong> interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/2</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/2</span>]<strong> portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/2</span>]<strong> port link-type access</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/2</span>]<strong> port default vlan 6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/2</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1]<strong> interface gigabitethernet <span>0/1/3</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/3</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/3</span>]<strong> portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/3</span>]<strong> port link-type trunk</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/3</span>]<strong> port trunk allow-pass vlan 6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/3</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1-GigabitEthernet<span>0/1/3</span>]<strong> quit</strong></pre>
<p># Configure CE2.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname CE2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2]<strong> vlan 5</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-vlan5]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2]<strong> interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>]<strong> portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>]<strong> port link-type access</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>]<strong> port default vlan 5</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2]<strong> interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/2</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/2</span>]<strong> portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/2</span>]<strong> port link-type access</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/2</span>]<strong> port default vlan 5</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/2</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2]<strong> interface gigabitethernet <span>0/1/3</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/3</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/3</span>]<strong> portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/3</span>]<strong> port link-type trunk</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/3</span>]<strong> port trunk allow-pass vlan 5</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/3</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2-GigabitEthernet<span>0/1/3</span>]<strong> quit</strong></pre>
</p></li><li><span>Configure 1 to 1 VLAN mapping.</span><p><p># Configure PE1.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname PE1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> vlan 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vlan10]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>]<strong> portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>]<strong> port link-type trunk</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>]<strong> port trunk allow-pass vlan 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>]<strong> port vlan-mapping vlan 6 map-vlan 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/1</span>]<strong> quit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname PE2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2]<strong> vlan 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vlan10]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>]<strong> portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>]<strong> port link-type trunk</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>]<strong> port trunk allow-pass vlan 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>]<strong> port vlan-mapping vlan 5 map-vlan 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-GigabitEthernet<span>0/1/1</span>]<strong> quit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p>After completing the configurations, run the <strong><span>display vlan</span></strong> command to check VLAN mapping information. Use the display on PE1 as an example.</p>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>display vlan 10</strong></pre>
<pre class="screen">* : management-vlan
---------------------
VLAN ID Type         Status   MAC Learning Broadcast/Multicast/Unicast Property
--------------------------------------------------------------------------------
10      common       enable   enable       forward   forward   forward default
----------------
<strong>QinQ-map</strong>  Port: GigabitEthernet<span>0/1/1</span>
----------------
Interface                   Physical
GigabitEthernet<span>0/1/1</span>        UP
</pre>
<p>Users in residential compounds 1 and 2 can communicate with each other. </p>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172363180__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>CE1 configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname CE1</pre>
<pre class="screen">#</pre>
<pre class="screen">vlan batch 6</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/1</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> portswitch</pre>
<pre class="screen"> port link-type access</pre>
<pre class="screen"> port default vlan 6</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/2</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> portswitch</pre>
<pre class="screen"> port link-type access</pre>
<pre class="screen"> port default vlan 6</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/3</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> portswitch</pre>
<pre class="screen"> port link-type trunk</pre>
<pre class="screen"> port trunk allow-pass vlan 6</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p>CE2 configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname CE2</pre>
<pre class="screen">#</pre>
<pre class="screen">vlan batch 5</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/1</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> portswitch</pre>
<pre class="screen"> port link-type access</pre>
<pre class="screen"> port default vlan 5</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/2</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> portswitch</pre>
<pre class="screen"> port link-type access</pre>
<pre class="screen"> port default vlan 5</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/3</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> portswitch</pre>
<pre class="screen"> port link-type trunk</pre>
<pre class="screen"> port trunk allow-pass vlan 5</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p>PE1 configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname PE1</pre>
<pre class="screen">#</pre>
<pre class="screen">vlan batch 10</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/1</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> portswitch</pre>
<pre class="screen"> port link-type trunk</pre>
<pre class="screen"> port trunk allow-pass vlan 10</pre>
<pre class="screen"> port vlan-mapping vlan 6 map-vlan 10</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname PE2</pre>
<pre class="screen">#</pre>
<pre class="screen">vlan batch 10</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/1</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> portswitch</pre>
<pre class="screen"> port link-type trunk</pre>
<pre class="screen"> port trunk allow-pass vlan 10</pre>
<pre class="screen"> port vlan-mapping vlan 5 map-vlan 10</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vlan_cfg_0033.html">Configuration Examples for VLANs
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vlan_cfg_0038.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vlan_cfg_0039.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>