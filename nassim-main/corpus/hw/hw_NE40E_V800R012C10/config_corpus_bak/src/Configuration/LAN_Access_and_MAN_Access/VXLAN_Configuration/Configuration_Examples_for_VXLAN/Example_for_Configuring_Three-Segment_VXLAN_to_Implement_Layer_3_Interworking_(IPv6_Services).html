
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Three-Segment VXLAN to Implement Layer 3 Interworking (IPv6 Services)">
<meta name="abstract" content="This section provides an example for configuring three-segment VXLAN to implement Layer 3 interworking between VMs in different DCs.">
<meta name="description" content="This section provides an example for configuring three-segment VXLAN to implement Layer 3 interworking between VMs in different DCs.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vxlan_cfg_1015.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vxlan_evpn_cfg_0108.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="h00847023">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="OWNER" content="p00915595">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="p00915595">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172363855">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>Example for Configuring Three-Segment VXLAN to Implement Layer 3 Interworking (IPv6 Services) </title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172363855"></a><a name="EN-US_TASK_0172363855"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Three-Segment VXLAN to Implement Layer 3 Interworking (IPv6 Services) </h1>
<div class="taskbody"><p>This section provides an example for configuring three-segment VXLAN to implement Layer 3 interworking between VMs in different DCs.</p>
<div class="context"><a name="EN-US_TASK_0172363855__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0172363855__fig_dc_vrp_vxlan_cfg_108801">Figure 1</a>, DC A and DC B reside in different BGP ASs. To allow intra-DC VM communication (VMa1 and VMa2 in DC A, and VMb1 and VMb2 in DC B), configure BGP EVPN on the devices in each DC to create VXLAN tunnels between distributed gateways. To allow IPv6 service communication between DC A and DC B (for example, IPv6 service communication between VMa1 and VMb2), configure BGP EVPN on Leaf2 and Leaf3 to create a VXLAN tunnel between them.</p>
<div class="fignone" id="EN-US_TASK_0172363855__fig_dc_vrp_vxlan_cfg_108801"><a name="EN-US_TASK_0172363855__fig_dc_vrp_vxlan_cfg_108801"></a><a name="fig_dc_vrp_vxlan_cfg_108801"></a><span class="figcap"><b>Figure 1 </b>Network diagram of configuring three-segment VXLAN</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interfaces 1 through 3 represent GE<span>0/1/0</span>, GE<span>0/2/0</span>, and GE<span>0/3/0</span>, respectively.</p>
</div></div>
<p><br><span><img class="vsd" src="images/fig_dc_vrp_vxlan_cfg_108801.png"></span><br></p>
</div>

<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" frame="border" border="1" rules="all"><caption><b>Table 1 </b>Interface IP addresses</caption><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="11.4%" id="mcps1.4.1.4.2.7.1.1" liSelected="liSelected"><p>Device</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="23.31%" id="mcps1.4.1.4.2.7.1.2" liSelected="liSelected"><p>Interface</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="16.42%" id="mcps1.4.1.4.2.7.1.3" liSelected="liSelected"><p>IP Address</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="11.4%" id="mcps1.4.1.4.2.7.1.4" liSelected="liSelected"><p>Device</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="21.18%" id="mcps1.4.1.4.2.7.1.5" liSelected="liSelected"><p>Interface</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="16.29%" id="mcps1.4.1.4.2.7.1.6" liSelected="liSelected"><p>IP Address</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" rowspan="3" valign="middle" width="11.4%" headers="mcps1.4.1.4.2.7.1.1 "><p>Device1</p>
</td>
<td class="cellrowborder" valign="top" width="23.31%" headers="mcps1.4.1.4.2.7.1.2 "><p>GE<span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" width="16.42%" headers="mcps1.4.1.4.2.7.1.3 "><p>192.168.50.1/24</p>
</td>
<td class="cellrowborder" rowspan="3" valign="middle" width="11.4%" headers="mcps1.4.1.4.2.7.1.4 "><p>Device2</p>
</td>
<td class="cellrowborder" valign="top" width="21.18%" headers="mcps1.4.1.4.2.7.1.5 "><p>GE<span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" width="16.29%" headers="mcps1.4.1.4.2.7.1.6 "><p>192.168.60.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.7.1.2 "><p>GE<span>0/2/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.7.1.3 "><p>192.168.1.1/24</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.7.1.5 "><p>GE<span>0/2/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.7.1.6 "><p>192.168.1.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.7.1.2 "><p>LoopBack1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.7.1.3 "><p>1.1.1.1/32</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.7.1.5 "><p>LoopBack1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.7.1.6 "><p>2.2.2.2/32</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="3" valign="middle" width="11.4%" headers="mcps1.4.1.4.2.7.1.1 "><p>Spine1</p>
</td>
<td class="cellrowborder" valign="top" width="23.31%" headers="mcps1.4.1.4.2.7.1.2 "><p>GE<span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" width="16.42%" headers="mcps1.4.1.4.2.7.1.3 "><p>192.168.10.1/24</p>
</td>
<td class="cellrowborder" rowspan="3" valign="middle" width="11.4%" headers="mcps1.4.1.4.2.7.1.4 "><p>Spine2</p>
</td>
<td class="cellrowborder" valign="top" width="21.18%" headers="mcps1.4.1.4.2.7.1.5 "><p>GE<span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" width="16.29%" headers="mcps1.4.1.4.2.7.1.6 "><p>192.168.30.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.7.1.2 "><p>GE<span>0/2/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.7.1.3 "><p>192.168.20.1/24</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.7.1.5 "><p>GE<span>0/2/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.7.1.6 "><p>192.168.40.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.7.1.2 "><p>LoopBack1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.7.1.3 "><p>3.3.3.3/32</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.7.1.5 "><p>LoopBack1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.7.1.6 "><p>4.4.4.4/32</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="3" valign="middle" width="11.4%" headers="mcps1.4.1.4.2.7.1.1 "><p>Leaf1</p>
</td>
<td class="cellrowborder" valign="top" width="23.31%" headers="mcps1.4.1.4.2.7.1.2 "><p>GE<span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" width="16.42%" headers="mcps1.4.1.4.2.7.1.3 "><p>192.168.10.2/24</p>
</td>
<td class="cellrowborder" rowspan="3" valign="middle" width="11.4%" headers="mcps1.4.1.4.2.7.1.4 "><p>Leaf4</p>
</td>
<td class="cellrowborder" valign="top" width="21.18%" headers="mcps1.4.1.4.2.7.1.5 "><p>GE<span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" width="16.29%" headers="mcps1.4.1.4.2.7.1.6 "><p>192.168.40.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.7.1.2 "><p>GE<span>0/2/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.7.1.3 "><p>-</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.7.1.5 "><p>GE<span>0/2/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.7.1.6 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.7.1.2 "><p>LoopBack1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.7.1.3 "><p>5.5.5.5/32</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.7.1.5 "><p>LoopBack1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.7.1.6 "><p>8.8.8.8/32</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="4" valign="middle" width="11.4%" headers="mcps1.4.1.4.2.7.1.1 "><p>Leaf2</p>
</td>
<td class="cellrowborder" valign="top" width="23.31%" headers="mcps1.4.1.4.2.7.1.2 "><p>GE<span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" width="16.42%" headers="mcps1.4.1.4.2.7.1.3 "><p>192.168.20.2/24</p>
</td>
<td class="cellrowborder" rowspan="4" valign="middle" width="11.4%" headers="mcps1.4.1.4.2.7.1.4 "><p>Leaf3</p>
</td>
<td class="cellrowborder" valign="top" width="21.18%" headers="mcps1.4.1.4.2.7.1.5 "><p>GE<span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" width="16.29%" headers="mcps1.4.1.4.2.7.1.6 "><p>192.168.30.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.7.1.2 "><p>GE<span>0/2/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.7.1.3 "><p>-</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.7.1.5 "><p>GE<span>0/2/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.7.1.6 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.7.1.2 "><p>GE<span>0/3/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.7.1.3 "><p>192.168.50.2/24</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.7.1.5 "><p>GE<span>0/3/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.7.1.6 "><p>192.168.60.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.7.1.2 "><p>LoopBack1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.7.1.3 "><p>6.6.6.6/32</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.7.1.5 "><p>LoopBack1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.7.1.6 "><p>7.7.7.7/32</p>
</td>
</tr>
</tbody>
</table>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172363855__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure IP addresses for each node.</p>
</li><li><p>Configure an IGP for nodes to communicate with each other.</p>
</li><li><p>Configure static routes for DCs to communicate with each other.</p>
</li><li><p>Configure BGP EVPN on DC A and DC B to create VXLAN tunnels between distributed gateways.</p>
</li><li><p>Configure BGP EVPN on Leaf2 and Leaf3 to create a VXLAN tunnel.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172363855__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>VLAN IDs of VMs</p>
</li><li><p>BD IDs</p>
</li><li><p>VNI IDs of BDs and VPN instances</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172363855__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Assign an IP address to each node interface, including the loopback interface.</span><p><p>For detailed configurations, see <a href="#EN-US_TASK_0172363855__dc_vrp_vxlan_cfg_1088_section">Configuration Files</a>.</p>
</p></li><li><span>Configure an IGP. In this example, OSPF is used.</span><p><p>For detailed configurations, see <a href="#EN-US_TASK_0172363855__dc_vrp_vxlan_cfg_1088_section">Configuration Files</a>.</p>
</p></li><li><span>Configure static routes for DCs to communicate with each other.</span><p><p>For detailed configurations, see <a href="#EN-US_TASK_0172363855__dc_vrp_vxlan_cfg_1088_section">Configuration Files</a>.</p>
</p></li><li><span>Configure BGP EVPN on DC A and DC B to create VXLAN tunnels between distributed gateways.</span><ol type="a"><li class="substepexpand"><span>Configure service access points on leaf nodes.</span><p><p># Configure Leaf1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf1] <strong>bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-bd10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1] <strong>interface GigabitEthernet <span>0/2/0</span>.1 mode l2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-GigabitEthernet<span>0/2/0</span>.1] <strong>encapsulation dot1q vid 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-GigabitEthernet<span>0/2/0</span>.1] <strong>rewrite pop single</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-GigabitEthernet<span>0/2/0</span>.1] <strong>bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-GigabitEthernet<span>0/2/0</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1] <strong>commit</strong></pre>
<p>The configurations of Leaf2, Leaf3, and Leaf4 are similar to that of Leaf1. For detailed configurations, see <a href="#EN-US_TASK_0172363855__dc_vrp_vxlan_cfg_1088_section">Configuration Files</a>.</p>
</p></li><li class="substepexpand"><span>Configure IBGP EVPN peer relationships between Leaf1 and Leaf2 in DC A and between Leaf3 and Leaf4 in DC B.</span><p><p># Configure an IBGP EVPN peer relationship on Leaf1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-bgp] <strong>peer 6.6.6.6 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-bgp] <strong>peer 6.6.6.6 connect-interface LoopBack 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-bgp] <strong>l2vpn-family evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-bgp-af-evpn] <strong>peer 6.6.6.6 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-bgp-af-evpn] <strong>peer 6.6.6.6 advertise encap-type vxlan</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-bgp-af-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1] <strong>commit</strong></pre>
<p>The configurations of Leaf2, Leaf3, and Leaf4 are similar to that of Leaf1. For detailed configurations, see <a href="#EN-US_TASK_0172363855__dc_vrp_vxlan_cfg_1088_section">Configuration Files</a>.</p>
</p></li><li class="substepexpand"><span>Configure VPN and EVPN instances on leaf nodes.</span><p><p># Configure Leaf1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf1] <strong>ip vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-vpn-instance-vpn1] <strong>vxlan vni 5010</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-vpn-instance-vpn1] <strong>ipv6-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-vpn-instance-vpn1-af-ipv6] <strong>route-distinguisher 11:11</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-vpn-instance-vpn1-af-ipv6] <strong>vpn-target 11:1 evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-vpn-instance-vpn1-af-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-vpn-instance-vpn1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1] <strong>evpn vpn-instance evrf1 bd-mode</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-evpn-instance-evrf1] <strong>route-distinguisher 10:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-evpn-instance-evrf1] <strong>vpn-target 11:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-evpn-instance-evrf1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1] <strong>bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-bd10] <strong>vxlan vni 10 split-horizon-mode</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-bd10] <strong>evpn binding vpn-instance evrf1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-bd10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1] <strong>commit</strong></pre>
<p>The configurations of Leaf2, Leaf3, and Leaf4 are similar to that of Leaf1. For detailed configurations, see <a href="#EN-US_TASK_0172363855__dc_vrp_vxlan_cfg_1088_section">Configuration Files</a>.</p>
</p></li><li class="substepexpand"><span>Enable ingress replication on leaf nodes.</span><p><p># Configure Leaf1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf1] <strong>interface nve 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-Nve1] <strong>source 5.5.5.5</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-Nve1] <strong>vni 10 head-end peer-list protocol bgp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-Nve1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1] <strong>commit</strong></pre>
<p>The configurations of Leaf2, Leaf3, and Leaf4 are similar to that of Leaf1. For detailed configurations, see <a href="#EN-US_TASK_0172363855__dc_vrp_vxlan_cfg_1088_section">Configuration Files</a>.</p>
</p></li><li class="substepexpand"><span>Configure Layer 3 VXLAN gateway information on leaf nodes.</span><p><p># Configure Leaf1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf1] <strong>interface vbdif10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-Vbdif10] <strong>ip binding vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-Vbdif10] <strong>ipv6 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-Vbdif10] <strong>ipv6 address 2001:DB8:10::1 64</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-Vbdif10] <strong>vxlan anycast-gateway enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-Vbdif10] <strong>ipv6 nd collect host enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-Vbdif10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1] <strong>commit</strong></pre>
<p>The configurations of Leaf2, Leaf3, and Leaf4 are similar to that of Leaf1. For detailed configurations, see <a href="#EN-US_TASK_0172363855__dc_vrp_vxlan_cfg_1088_section">Configuration Files</a>.</p>
</p></li><li class="substepexpand"><span>Configure IRB route advertisement between Leaf1 and Leaf2 in DC A, between Leaf3 and Leaf4 in DC B, and between Leaf2 and Leaf3.</span><p><p># Configure Leaf1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-bgp] <strong>l2vpn-family evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-bgp-af-evpn] <strong>peer 6.6.6.6 advertise irbv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-bgp-af-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1] <strong>commit</strong></pre>
<p># Configure Leaf2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf2] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-bgp] <strong>l2vpn-family evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-bgp-af-evpn] <strong>peer 5.5.5.5 advertise irbv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-bgp-af-evpn] <strong>peer 7.7.7.7 advertise irbv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-bgp-af-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2] <strong>commit</strong></pre>
<p>The configurations of Leaf4 and Leaf3 are similar to those of Leaf1 and Leaf2, respectively. For detailed configurations, see <a href="#EN-US_TASK_0172363855__dc_vrp_vxlan_cfg_1088_section">Configuration Files</a>.</p>
<div class="p">Run the <a href="cmdqueryname=display+vxlan+tunnel"><b><span class="cmdname">display vxlan tunnel</span></b></a> command on a leaf node to check VXLAN tunnel information. The following example uses the command output on Leaf1.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf1] <strong>display vxlan tunnel</strong></pre>
<pre class="screen">Number of vxlan tunnel : 1
Tunnel ID   Source           Destination      State  Type    Uptime
---------------------------------------------------------------------
4026531841  5.5.5.5          6.6.6.6          up     dynamic 00:05:36</pre>
</div>
</p></li></ol>
</li><li><span>Configure BGP EVPN on Leaf2 and Leaf3 to create a VXLAN tunnel.</span><ol type="a"><li class="substepexpand"><span>Configure an EBGP EVPN peer relationship between Leaf2 and Leaf3.</span><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>As VPN and EVPN instances have been configured on Leaf2 and Leaf3, you only need to configure an EBGP EVPN peer relationship between Leaf2 and Leaf3 to ensure IP route reachability. </p>
</div></div>
<p># Configure Leaf2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf2] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-bgp] <strong>peer 7.7.7.7 as-number 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-bgp] <strong>peer 7.7.7.7 connect-interface LoopBack1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-bgp] <strong>peer 7.7.7.7 ebgp-max-hop 255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-bgp] <strong>l2vpn-family evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-bgp-af-evpn] <strong>peer 7.7.7.7 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-bgp-af-evpn] <strong>peer 7.7.7.7 advertise encap-type vxlan</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-bgp-af-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2] <strong>commit</strong></pre>
<p># Configure Leaf3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf3] <strong>bgp 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf3-bgp] <strong>peer 6.6.6.6 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf3-bgp] <strong>peer 6.6.6.6 connect-interface LoopBack1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf3-bgp] <strong>peer 6.6.6.6 ebgp-max-hop 255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf3-bgp] <strong>l2vpn-family evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf3-bgp-af-evpn] <strong>peer 6.6.6.6 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf3-bgp-af-evpn] <strong>peer 6.6.6.6 advertise encap-type vxlan</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf3-bgp-af-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf3-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf3] <strong>commit</strong></pre>
</p></li><li class="substepexpand"><span>Configure the regeneration of IRB routes and IP prefix routes in EVPN routing tables.</span><p><p># Configure Leaf2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf2] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-bgp] <strong>l2vpn-family evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-bgp-af-evpn] <strong>peer 5.5.5.5 import reoriginate</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-bgp-af-evpn] <strong>peer 5.5.5.5 advertise route-reoriginated evpn ipv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-bgp-af-evpn] <strong>peer 7.7.7.7 import reoriginate</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-bgp-af-evpn] <strong>peer 7.7.7.7 advertise route-reoriginated evpn ipv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-bgp-af-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2] <strong>commit</strong></pre>
<p># Configure Leaf3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf3] <strong>bgp 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf3-bgp] <strong>l2vpn-family evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf3-bgp-af-evpn] <strong>peer 8.8.8.8 import reoriginate</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf3-bgp-af-evpn] <strong>peer 8.8.8.8 advertise route-reoriginated evpn ipv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf3-bgp-af-evpn] <strong>peer 6.6.6.6 import reoriginate</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf3-bgp-af-evpn] <strong>peer 6.6.6.6 advertise route-reoriginated evpn ipv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf3-bgp-af-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf3-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf3] <strong>commit</strong></pre>
</p></li></ol>
</li><li><span>Verify the configuration.</span><p><p>After completing the configurations, run the <a href="cmdqueryname=display+vxlan+tunnel"><b><span class="cmdname">display vxlan tunnel</span></b></a> command on each leaf node to view VXLAN tunnel information. The following example uses the command output on Leaf2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf2] <strong>display vxlan tunnel</strong></pre>
<pre class="screen">Number of vxlan tunnel : 2
Tunnel ID   Source           Destination      State  Type    Uptime
---------------------------------------------------------------------
4026531841  6.6.6.6          5.5.5.5          up     dynamic 00:11:01
4026531842  6.6.6.6          7.7.7.7          up     dynamic 00:12:11</pre>
<p>Run the <a href="cmdqueryname=display+ipv6+routing-table+vpn-instance+vpn1"><b><span class="cmdname">display ipv6 routing-table vpn-instance vpn1</span></b></a> command on each leaf node to view IP route information. The following example uses the command output on Leaf1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf1] <strong>display ipv6 routing-table vpn-instance vpn1</strong></pre>
<pre class="screen">Routing Table : vpn1
         Destinations : 6        Routes : 6         

Destination  : 2001:DB8:10::                           PrefixLength : 64
NextHop      : 2001:DB8:10::1                          Preference   : 0
Cost         : 0                                       Protocol     : Direct
RelayNextHop : ::                                      TunnelID     : 0x0
Interface    : Vbdif10                                 Flags        : D

Destination  : 2001:DB8:10::1                          PrefixLength : 128
NextHop      : ::1                                     Preference   : 0
Cost         : 0                                       Protocol     : Direct
RelayNextHop : ::                                      TunnelID     : 0x0
Interface    : Vbdif10                                 Flags        : D

Destination  : 2001:DB8:20::                           PrefixLength : 64
NextHop      : ::FFFF:6.6.6.6                          Preference   : 255
Cost         : 0                                       Protocol     : IBGP
RelayNextHop : ::                                      TunnelID     : 0x0000000027f0000001
Interface    : VXLAN                                   Flags        : RD

Destination  : 2001:DB8:30::                           PrefixLength : 64
NextHop      : ::FFFF:6.6.6.6                          Preference   : 255
Cost         : 0                                       Protocol     : IBGP
RelayNextHop : ::                                      TunnelID     : 0x0000000027f0000001
Interface    : VXLAN                                   Flags        : RD

Destination  : 2001:DB8:40::                           PrefixLength : 64
NextHop      : ::FFFF:6.6.6.6                          Preference   : 255
Cost         : 0                                       Protocol     : IBGP
RelayNextHop : ::                                      TunnelID     : 0x0000000027f0000001
Interface    : VXLAN                                   Flags        : RD

Destination  : FE80::                                  PrefixLength : 10
NextHop      : ::                                      Preference   : 0
Cost         : 0                                       Protocol     : Direct
RelayNextHop : ::                                      TunnelID     : 0x0
Interface    : NULL0                                   Flags        : DB</pre>
<p>After configurations are complete, VMa1 and VMb2 can communicate with each other.</p>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0172363855__dc_vrp_vxlan_cfg_1088_section"><a name="EN-US_TASK_0172363855__dc_vrp_vxlan_cfg_1088_section"></a><a name="dc_vrp_vxlan_cfg_1088_section"></a><a name="EN-US_TASK_0172363855__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>Spine 1 configuration file</p>
<pre class="screen">#
sysname Spine1
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown  
 ip address 192.168.10.1 255.255.255.0
#               
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown  
 ip address 192.168.20.1 255.255.255.0
#               
interface LoopBack1
 ip address 3.3.3.3 255.255.255.255
#               
ospf 1          
 area 0.0.0.0   
  network 3.3.3.3 0.0.0.0
  network 192.168.10.0 0.0.0.255
  network 192.168.20.0 0.0.0.255
#               
return </pre>
</li><li><p>Leaf1 configuration file</p>
<pre class="screen">#
sysname Leaf1
#
evpn vpn-instance evrf1 bd-mode
 route-distinguisher 10:1
 vpn-target 11:1 export-extcommunity
 vpn-target 11:1 import-extcommunity
#
ip vpn-instance vpn1
 ipv6-family
  route-distinguisher 11:11
<span>  apply-label per-instance</span>
  vpn-target 11:1 export-extcommunity evpn
  vpn-target 11:1 import-extcommunity evpn
 vxlan vni 5010
#
bridge-domain 10
 vxlan vni 10 split-horizon-mode
 evpn binding vpn-instance evrf1
#
interface Vbdif10
 ip binding vpn-instance vpn1
 ipv6 enable
 ipv6 address 2001:DB8:10::1/64
 ipv6 nd collect host enable
 vxlan anycast-gateway enable
#               
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown  
 ip address 192.168.10.2 255.255.255.0
#               
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown       
#               
interface GigabitEthernet<span>0/2/0</span>.1 mode l2
 encapsulation dot1q vid 10
 rewrite pop single
 bridge-domain 10
#
interface LoopBack1
 ip address 5.5.5.5 255.255.255.255
#
interface Nve1
 source 5.5.5.5
 vni 10 head-end peer-list protocol bgp
#
bgp 100
 peer 6.6.6.6 as-number 100
 peer 6.6.6.6 connect-interface LoopBack1
 #              
 ipv4-family unicast
  undo synchronization
  peer 6.6.6.6 enable
 #
 ipv6-family vpn-instance vpn1
  import-route direct
  advertise l2vpn evpn
 #
 l2vpn-family evpn
  undo policy vpn-target
  peer 6.6.6.6 enable
  peer 6.6.6.6 advertise irbv6
  peer 6.6.6.6 advertise encap-type vxlan
#
ospf 1
 area 0.0.0.0
  network 5.5.5.5 0.0.0.0
  network 192.168.10.0 0.0.0.255
#
return</pre>
</li><li><p>Leaf2 configuration file</p>
<pre class="screen">#
sysname Leaf2
#
evpn vpn-instance evrf1 bd-mode
 route-distinguisher 10:1
 vpn-target 11:1 export-extcommunity
 vpn-target 11:1 import-extcommunity
#
ip vpn-instance vpn1
 ipv6-family
  route-distinguisher 11:11
<span>  apply-label per-instance</span>
  vpn-target 11:1 export-extcommunity evpn
  vpn-target 11:1 import-extcommunity evpn
 vxlan vni 5010
#
bridge-domain 20
 vxlan vni 20 split-horizon-mode
 evpn binding vpn-instance evrf1
#
interface Vbdif20
 ip binding vpn-instance vpn1
 ipv6 enable
 ipv6 address 2001:DB8:20::1/64
 ipv6 nd collect host enable
 vxlan anycast-gateway enable
#               
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown  
 ip address 192.168.20.2 255.255.255.0
#               
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown       
#               
interface GigabitEthernet<span>0/2/0</span>.1 mode l2
 encapsulation dot1q vid 20
 rewrite pop single
 bridge-domain 20
#               
interface GigabitEthernet<span>0/3/0</span>
 undo shutdown  
 ip address 192.168.50.2 255.255.255.0
#
interface LoopBack1
 ip address 6.6.6.6 255.255.255.255
#
interface Nve1
 source 6.6.6.6
 vni 20 head-end peer-list protocol bgp
#
bgp 100
 peer 5.5.5.5 as-number 100
 peer 5.5.5.5 connect-interface LoopBack1
 peer 7.7.7.7 as-number 200
 peer 7.7.7.7 ebgp-max-hop 255
 peer 7.7.7.7 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 5.5.5.5 enable
  peer 7.7.7.7 enable
 #
 ipv6-family vpn-instance vpn1
  import-route direct
  advertise l2vpn evpn
 #
 l2vpn-family evpn
  undo policy vpn-target
  peer 5.5.5.5 enable
  peer 5.5.5.5 advertise irbv6
  peer 5.5.5.5 advertise encap-type vxlan
  peer 5.5.5.5 import reoriginate
  peer 5.5.5.5 advertise route-reoriginated evpn ipv6
  peer 7.7.7.7 enable
  peer 7.7.7.7 advertise irbv6
  peer 7.7.7.7 advertise encap-type vxlan
  peer 7.7.7.7 import reoriginate
  peer 7.7.7.7 advertise route-reoriginated evpn ipv6
#
ospf 1
 area 0.0.0.0
  network 6.6.6.6 0.0.0.0
  network 192.168.20.0 0.0.0.255
#
ip route-static 7.7.7.7 255.255.255.255 192.168.50.1
ip route-static 192.168.1.0 255.255.255.0 192.168.50.1
ip route-static 192.168.60.0 255.255.255.0 192.168.50.1
#
return</pre>
</li><li><p>Spine 2 configuration file</p>
<pre class="screen">#
sysname Spine2
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown  
 ip address 192.168.30.1 255.255.255.0
#               
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown  
 ip address 192.168.40.1 255.255.255.0
#               
interface LoopBack1
 ip address 4.4.4.4 255.255.255.255
#               
ospf 1          
 area 0.0.0.0   
  network 4.4.4.4 0.0.0.0
  network 192.168.30.0 0.0.0.255
  network 192.168.40.0 0.0.0.255
#               
return</pre>
</li><li><p>Leaf3 configuration file</p>
<pre class="screen">#
sysname Leaf3
#
evpn vpn-instance evrf1 bd-mode
 route-distinguisher 10:1
 vpn-target 11:1 export-extcommunity
 vpn-target 11:1 import-extcommunity
#
ip vpn-instance vpn1
 ipv6-family
  route-distinguisher 11:11
<span>  apply-label per-instance</span>
  vpn-target 11:1 export-extcommunity evpn
  vpn-target 11:1 import-extcommunity evpn
 vxlan vni 5010
#
bridge-domain 10
 vxlan vni 10 split-horizon-mode
 evpn binding vpn-instance evrf1
#
interface Vbdif10
 ip binding vpn-instance vpn1
 ipv6 enable
 ipv6 address 2001:DB8:30::1/64
 ipv6 nd collect host enable
 vxlan anycast-gateway enable
#               
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown  
 ip address 192.168.30.2 255.255.255.0
#               
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown       
#               
interface GigabitEthernet<span>0/2/0</span>.1 mode l2
 encapsulation dot1q vid 10
 rewrite pop single
 bridge-domain 10
#               
interface GigabitEthernet<span>0/3/0</span>
 undo shutdown  
 ip address 192.168.60.2 255.255.255.0
#
interface LoopBack1
 ip address 7.7.7.7 255.255.255.255
#
interface Nve1
 source 7.7.7.7
 vni 10 head-end peer-list protocol bgp
#
bgp 200
 peer 6.6.6.6 as-number 100
 peer 6.6.6.6 ebgp-max-hop 255
 peer 6.6.6.6 connect-interface LoopBack1
 peer 8.8.8.8 as-number 200
 peer 8.8.8.8 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 6.6.6.6 enable
  peer 8.8.8.8 enable
 #
 ipv6-family vpn-instance vpn1
  import-route direct
  advertise l2vpn evpn
 #
 l2vpn-family evpn
  undo policy vpn-target
  peer 6.6.6.6 enable
  peer 6.6.6.6 advertise irbv6
  peer 6.6.6.6 advertise encap-type vxlan
  peer 6.6.6.6 import reoriginate
  peer 6.6.6.6 advertise route-reoriginated evpn ipv6
  peer 8.8.8.8 enable
  peer 8.8.8.8 advertise irbv6
  peer 8.8.8.8 advertise encap-type vxlan
  peer 8.8.8.8 import reoriginate
  peer 8.8.8.8 advertise route-reoriginated evpn ipv6
#
ospf 1
 area 0.0.0.0
  network 7.7.7.7 0.0.0.0
  network 192.168.30.0 0.0.0.255
#
ip route-static 6.6.6.6 255.255.255.255 192.168.60.1
ip route-static 192.168.1.0 255.255.255.0 192.168.60.1
ip route-static 192.168.50.0 255.255.255.0 192.168.60.1
#
return</pre>
</li><li><p>Leaf4 configuration file</p>
<pre class="screen">#
sysname Leaf4
#
evpn vpn-instance evrf1 bd-mode
 route-distinguisher 10:1
 vpn-target 11:1 export-extcommunity
 vpn-target 11:1 import-extcommunity
#
ip vpn-instance vpn1
 ipv6-family
  route-distinguisher 11:11
<span>  apply-label per-instance</span>
  vpn-target 11:1 export-extcommunity evpn
  vpn-target 11:1 import-extcommunity evpn
 vxlan vni 5010
#
bridge-domain 20
 vxlan vni 20 split-horizon-mode
 evpn binding vpn-instance evrf1
#
interface Vbdif20
 ip binding vpn-instance vpn1
 ipv6 enable
 ipv6 address 2001:DB8:40::1/64
 ipv6 nd collect host enable
 vxlan anycast-gateway enable
#               
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown  
 ip address 192.168.40.2 255.255.255.0
#               
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown       
#               
interface GigabitEthernet<span>0/2/0</span>.1 mode l2
 encapsulation dot1q vid 20
 rewrite pop single
 bridge-domain 20
#
interface LoopBack1
 ip address 8.8.8.8 255.255.255.255
#
interface Nve1
 source 8.8.8.8
 vni 20 head-end peer-list protocol bgp
#
bgp 200
 peer 7.7.7.7 as-number 200
 peer 7.7.7.7 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 7.7.7.7 enable
 #
 ipv6-family vpn-instance vpn1
  import-route direct
  advertise l2vpn evpn
 #
 l2vpn-family evpn
  undo policy vpn-target
  peer 7.7.7.7 enable
  peer 7.7.7.7 advertise irbv6
  peer 7.7.7.7 advertise encap-type vxlan
#
ospf 1
 area 0.0.0.0
  network 8.8.8.8 0.0.0.0
  network 192.168.40.0 0.0.0.255
#
return</pre>
</li><li><p>Device 1 configuration file</p>
<pre class="screen">#
sysname Device1
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown  
 ip address 192.168.50.1 255.255.255.0
#               
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown  
 ip address 192.168.1.1 255.255.255.0
#               
interface LoopBack1
 ip address 1.1.1.1 255.255.255.255
#
ip route-static 6.6.6.6 255.255.255.255 192.168.50.2
ip route-static 7.7.7.7 255.255.255.255 192.168.1.2
ip route-static 192.168.60.0 255.255.255.0 192.168.1.2
#               
return </pre>
</li><li><p>Device 2 configuration file</p>
<pre class="screen">#
sysname Device2
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown  
 ip address 192.168.60.1 255.255.255.0
#               
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown  
 ip address 192.168.1.2 255.255.255.0
#               
interface LoopBack1
 ip address 2.2.2.2 255.255.255.255
#
ip route-static 6.6.6.6 255.255.255.255 192.168.1.1
ip route-static 7.7.7.7 255.255.255.255 192.168.60.2
ip route-static 192.168.50.0 255.255.255.0 192.168.1.1
#               
return </pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vxlan_cfg_1015.html">Configuration Examples for VXLAN
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vxlan_evpn_cfg_0108.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>
</body>
</html>