
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring a QinQ Stacking Sub-interface">
<meta name="abstract" content="This section describes how to configure a QinQ stacking sub-interface on a provider edge (PE) to provide Layer 2 virtual private network (L2VPN) access so that the inner virtual local area network (VLAN) tags of user packets are transparently transmitted over an ISP network.">
<meta name="description" content="This section describes how to configure a QinQ stacking sub-interface on a provider edge (PE) to provide Layer 2 virtual private network (L2VPN) access so that the inner virtual local area network (VLAN) tags of user packets are transparently transmitted over an ISP network.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_qinq_cfg_0017.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_qinq_cfg_0057b.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="wwx1238417">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="QinQ">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="QinQ">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="featurename" content="QinQ">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="featurename" content="QinQ">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="OWNER" content="c00648116,w00437000">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="wWX1238417">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172363282">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring a QinQ Stacking Sub-interface</title>
</head>
<body><a name="EN-US_TASK_0172363282"></a><a name="EN-US_TASK_0172363282"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring a QinQ Stacking Sub-interface</h1>
<div class="taskbody"><p>This section describes how to configure a QinQ stacking sub-interface on a provider edge (PE) to provide Layer 2 virtual private network (L2VPN) access so that the inner virtual local area network (VLAN) tags of user packets are transparently transmitted over an ISP network.</p>
<div class="context"><a name="EN-US_TASK_0172363282__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><div class="p">After you enable QinQ stacking on an Ethernet sub-interface:<ul><li><p>When the QinQ stacking sub-interface receives a packet, the sub-interface checks whether the VLAN ID or VLAN range in the VLAN tag of the packet matches the VLAN ID or VLAN range specified using the <a href="cmdqueryname=qinq+stacking+vid"><b><span class="cmdname">qinq stacking vid</span></b></a> command. If they are consistent, the sub-interface adds an outer VLAN tag to the packet.</p>
<ul><li>If the packet carries one VLAN tag and the VLAN ID in the tag is in the VLAN range specified by <i><span class="varname">low-ce-vid</span></i> [ <strong><span>to</span></strong> <i><span class="varname">high-ce-vid</span></i> ] in the <a href="cmdqueryname=qinq+stacking+vid"><b><span class="cmdname">qinq stacking vid</span></b></a> command, the sub-interface adds an outer VLAN tag to the packet. If the VLAN ID in the VLAN tag is not in the specified VLAN range, the sub-interface discards the packet.</li><li>If the packet carries two VLAN tags and the VLAN ID in the outer tag is in the VLAN range specified by <i><span class="varname">low-ce-vid</span></i> [ <strong><span>to</span></strong> <i><span class="varname">high-ce-vid</span></i> ] in the <a href="cmdqueryname=qinq+stacking+vid"><b><span class="cmdname">qinq stacking vid</span></b></a> command, the sub-interface adds another outer VLAN tag to the packet and forwards the packet. In this case, the inner VLAN tag is transmitted transparently. If the VLAN ID in the outer tag is not in the specified VLAN range, the sub-interface discards the packet.</li><li>If the packet does not carry any VLAN tag, the sub-interface directly discards the packet.</li></ul>
</li><li>When the QinQ stacking sub-interface sends a packet, the sub-interface strips the outer VLAN tag of the packet.</li></ul>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><div class="p">After you run the <a href="cmdqueryname=qinq+stacking+vid"><b><span class="cmdname">qinq stacking vid</span></b></a> command on an Ethernet sub-interface:<ul><li><p>If you do not run the <a href="cmdqueryname=qinq+stacking"><b><span class="cmdname">qinq stacking</span></b></a> <strong><span>pe-vid</span></strong> <i><span class="varname">pe-vid</span></i> command to specify an outer VLAN tag to be added to packets, the Ethernet sub-interface will add a default outer VLAN tag to received packets.</p>
<p>The default outer VLAN tag is assigned by the device and cannot be modified.</p>
</li><li><p>If you run the <a href="cmdqueryname=qinq+stacking"><b><span class="cmdname">qinq stacking</span></b></a> <strong><span>pe-vid</span></strong> <i><span class="varname">pe-vid</span></i> command to specify an outer VLAN tag to be added to packets, the Ethernet sub-interface will add the specified outer VLAN tag to received packets.</p>
<p>Before you run the <a href="cmdqueryname=qinq+stacking"><b><span class="cmdname">qinq stacking</span></b></a> <strong><span>pe-vid</span></strong> <i><span class="varname">pe-vid</span></i> command on an Ethernet sub-interface, you must run the <a href="cmdqueryname=qinq+stacking+vid"><b><span class="cmdname">qinq stacking vid</span></b></a> command on the sub-interface. Otherwise, the QinQ stacking function does not take effect.</p>
</li></ul>
</div>
</div></div>
</div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172363282__1.4.2"></a><a name="1.4.2"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Run <span><a href="cmdqueryname=system-view"><b><span class="cmdname" id="EN-US_TASK_0172363282__en-us_task_0172388774_cmdname2013676678214612">system-view</span></b></a></span></span>
<p><p id="EN-US_TASK_0172363282__en-us_task_0172388774_p34087246214612">The system view is displayed. </p>
</p>
</li><li><span>Run <a href="cmdqueryname=interface"><b><span class="cmdname">interface</span></b></a> <i><span class="varname">interface-type interface-number.subinterface-number</span></i></span><p><p>The view of an Ethernet sub-interface on the user side of a PE is displayed.</p>
</p></li><li><span>(Optional) Create a user VLAN group.</span><p><ol type="a"><li id="EN-US_TASK_0172363282__en-us_task_0172363258_li1771904166214028"><p id="EN-US_TASK_0172363282__en-us_task_0172363258_p948954094214312"><a name="EN-US_TASK_0172363282__en-us_task_0172363258_li1771904166214028"></a><a name="en-us_task_0172363258_li1771904166214028"></a>Run <a href="cmdqueryname=vlan-group"><b><span class="cmdname" id="EN-US_TASK_0172363282__en-us_task_0172363258_cmdname1712192296214028">vlan-group</span></b></a> <i><span class="varname" id="EN-US_TASK_0172363282__en-us_task_0172363258_varname1028502291214028">group-id</span></i></p>
<p id="EN-US_TASK_0172363282__en-us_task_0172363258_p739469088214312">A user VLAN group is created.</p>
</li><li id="EN-US_TASK_0172363282__en-us_task_0172363258_li967913461214028"><p id="EN-US_TASK_0172363282__en-us_task_0172363258_p182182833511"><a name="EN-US_TASK_0172363282__en-us_task_0172363258_li967913461214028"></a><a name="en-us_task_0172363258_li967913461214028"></a>Run <a href="cmdqueryname=group+mode"><b><span class="cmdname" id="EN-US_TASK_0172363282__en-us_task_0172363258_cmdname38288312351">group mode</span></b></a> { <strong><span id="EN-US_TASK_0172363282__en-us_task_0172363258_cmdparmname2828123123514">single</span></strong> | <strong><span id="EN-US_TASK_0172363282__en-us_task_0172363258_cmdparmname148281931183513">multiple</span></strong> }</p>
<p id="EN-US_TASK_0172363282__en-us_task_0172363258_p274165163513">The working mode of the VLAN group is configured.</p>
<ul id="EN-US_TASK_0172363282__en-us_task_0172363258_ul332236645214028"><li id="EN-US_TASK_0172363282__en-us_task_0172363258_li909258174214028"><strong><span id="EN-US_TASK_0172363282__en-us_task_0172363258_cmdparmname408498366214028">single</span></strong>: A VLAN group is considered as a user. This means that you cannot collect statistics about QinQ packets or deploy quality of service (QoS) policies based on a VLAN or a VLAN range.</li><li id="EN-US_TASK_0172363282__en-us_task_0172363258_li980140465214028"><p id="EN-US_TASK_0172363282__en-us_task_0172363258_li980140465214028p0"><a name="EN-US_TASK_0172363282__en-us_task_0172363258_li980140465214028"></a><a name="en-us_task_0172363258_li980140465214028"></a><strong><span id="EN-US_TASK_0172363282__en-us_task_0172363258_cmdparmname2021222765214028">multiple</span></strong>: VLANs and VLAN ranges in a VLAN group are considered as different users. This means that you can collect statistics about QinQ packets or deploy QoS policies based on a VLAN or VLAN range to implement refined management.</p>
</li></ul>
</li><li id="EN-US_TASK_0172363282__en-us_task_0172363258_li1511047054214028"><p id="EN-US_TASK_0172363282__en-us_task_0172363258_p1818445943214312"><a name="EN-US_TASK_0172363282__en-us_task_0172363258_li1511047054214028"></a><a name="en-us_task_0172363258_li1511047054214028"></a>Run <a href="cmdqueryname=quit"><b><span class="cmdname" id="EN-US_TASK_0172363282__en-us_task_0172363258_cmdname565663257214028">quit</span></b></a></p>
<p id="EN-US_TASK_0172363282__en-us_task_0172363258_p935179603214312">Return to the view of the PE's Ethernet sub-interface connecting to the user side.</p>
</li></ol>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0172363282__en-us_task_0172363258_p1583683060214028">Configuring a VLAN group allows you to achieve the following purposes:</p>
<ul id="EN-US_TASK_0172363282__en-us_task_0172363258_ul1787138538214028"><li id="EN-US_TASK_0172363282__en-us_task_0172363258_li845962212214028">Deploy QoS policies based on services or users so that higher priority service traffic is preferentially forwarded, improving user experience.</li><li id="EN-US_TASK_0172363282__en-us_task_0172363258_li1638708273214028">View statistics about QinQ packets to check whether a device is functioning properly.</li></ul>
</div></div>
</p></li><li><span>Run<span> one or more of the following</span> commands to configure a QinQ stacking sub-interface as required.</span><p><ul><li><p>To configure a QinQ stacking sub-interface, run the <a href="cmdqueryname=qinq+stacking+vid"><b><span class="cmdname">qinq stacking vid</span></b></a> <i><span class="varname">low-ce-vid</span></i> [ <strong><span>to</span></strong> <i><span class="varname">high-ce-vid</span></i> ] [ <strong><span>vlan-group</span></strong> <i><span class="varname">group-id</span></i> ] command.</p>
</li><li>To configure a QinQ stacking sub-interface with a matching policy specified based on VLAN ID+802.1p value/DSCP value/EthType, run the <a href="cmdqueryname=qinq+stacking+vid"><b><span class="cmdname">qinq stacking vid</span></b></a> <i><span class="varname">low-ce-vid</span></i> [ <strong><span>to</span></strong> <i><span class="varname">high-ce-vid</span></i> ] { <strong><span>8021p</span></strong> { <i><span class="varname">val8021p1</span></i> [ <strong><span>to</span></strong> <i><span class="varname">val8021p2</span></i> ] } &amp;&lt;1-8&gt; | <strong><span>dscp</span></strong> { <em>valdscp1</em> [ <strong><span>to</span></strong> <i><span class="varname">valdscp2</span></i> ] } &amp;&lt;1-10&gt; | <strong><span>eth-type PPPoE</span></strong> <i><span class="varname">eth-type-value</span></i> | <strong><span>default</span></strong> } [ <strong><span>vlan-group</span></strong> <i><span class="varname">group-id</span></i> ] command.</li></ul>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><ul><li><p>If you have run the <a href="cmdqueryname=vlan-group"><b><span class="cmdname">vlan-group</span></b></a> command to configure a VLAN group on the sub-interface, specify <strong><span>vlan-group</span></strong> in the preceding commands.</p>
</li><li><p>If you have not run the <a href="cmdqueryname=vlan-group"><b><span class="cmdname">vlan-group</span></b></a> command to configure a VLAN group on the sub-interface, do not specify <strong><span>vlan-group</span></strong> in the preceding commands.</p>
</li><li><p>If you configure QinQ stacking on different Ethernet sub-interfaces of the same main interface, the <strong><span>ce-vid</span></strong> ranges cannot overlap between these sub-interfaces.</p>
</li><li><p>The preceding commands are both used to configure a QinQ stacking sub-interface. If you do not configure any matching policy, the QinQ stacking sub-interface adds an outer VLAN tag to packets based on the specified VLAN. If you configure a matching policy, the QinQ stacking sub-interface adds an outer VLAN tag to packets based on the specified VLAN ID+802.1p value/DSCP value/EthType.</p>
</li><li>When a QinQ stacking sub-interface is bound to a VLAN group, the VLAN group can work only in single mode, not multiple mode.</li></ul>
</div></div>
</p></li><li><span>(Optional) Run <a href="cmdqueryname=qinq+stacking"><b><span class="cmdname">qinq stacking</span></b></a> <strong><span>pe-vid</span></strong> <i><span class="varname">pe-vid</span></i></span><p><p>The QinQ stacking sub-interface is enabled to add a specified outer VLAN tag to received packets.</p>
</p><p><p>If you skip this step, the QinQ stacking sub-interface will add a system-assigned outer VLAN tag to received packets.</p>
</p></li><li><span>Run <span><a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0172363282__en-us_task_0172388774_cmdname1859847668214612">commit</span></b></a></span></span>
<p><p id="EN-US_TASK_0172363282__en-us_task_0172388774_p613577978214612">The configuration is committed.</p>
</p>
</li></ol></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_qinq_cfg_0017.html">Configuring an L2VPN Service on a QinQ Stacking Sub-interface
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_qinq_cfg_0057b.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>