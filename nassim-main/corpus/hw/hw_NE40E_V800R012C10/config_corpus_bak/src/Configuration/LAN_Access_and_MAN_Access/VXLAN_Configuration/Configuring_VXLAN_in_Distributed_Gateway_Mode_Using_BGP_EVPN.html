
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring VXLAN in Distributed Gateway Mode Using BGP EVPN">
<meta name="abstract" content="Distributed VXLAN gateways can be configured to address problems that occur in centralized gateway networking. Such problems include sub-optimal forwarding paths and bottlenecks on Layer 3 gateways in terms of ARP or ND entry specifications.">
<meta name="description" content="Distributed VXLAN gateways can be configured to address problems that occur in centralized gateway networking. Such problems include sub-optimal forwarding paths and bottlenecks on Layer 3 gateways in terms of ARP or ND entry specifications.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vxlan_cfg_1082.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vxlan6_cfg_0001.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vxlan6_cfg_0006.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vxlan6_cfg_0018c.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vxlan_cfg_1062.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vxlan_cfg_1217-1.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vxlan_cfg_1217.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vxlan_cfg_1217-2.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vxlan6_cfg_0023c.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vxlan6_cfg_0021c.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vxlan_cfg_1053.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="h00847023">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="OWNER" content="p00915595">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="p00915595">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172363804">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>Configuring VXLAN in Distributed Gateway Mode Using BGP EVPN</title>
</head>
<body><a name="EN-US_TASK_0172363804"></a><a name="EN-US_TASK_0172363804"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring VXLAN in Distributed Gateway Mode Using BGP EVPN</h1>
<div class="taskbody"><p>Distributed VXLAN gateways can be configured to address problems that occur in centralized gateway networking. Such problems include sub-optimal forwarding paths and bottlenecks on Layer 3 gateways in terms of ARP or ND entry specifications.</p>
<div class="context"><a name="EN-US_TASK_0172363804__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Usage Scenario</h4><div class="p">In legacy networking, a centralized Layer 3 gateway is deployed on a spine node. On the network shown in <a href="#EN-US_TASK_0172363804__fig_dc_vrp_vxlan_cfg_106601">Figure 1</a>, packets across different networks must be forwarded through a centralized Layer 3 gateway, resulting in the following problems:<ul><li>Forwarding paths are not optimal. All Layer 3 traffic must be transmitted to the centralized Layer 3 gateway for forwarding.</li><li>The ARP or ND entry specification is a bottleneck. ARP or ND entries for tenants must be generated on the Layer 3 gateway, but only a limited number of ARP or ND entries are allowed by the Layer 3 gateway, impeding DCN expansion.</li></ul>
</div>
<div class="fignone" id="EN-US_TASK_0172363804__fig_dc_vrp_vxlan_cfg_106601"><a name="EN-US_TASK_0172363804__fig_dc_vrp_vxlan_cfg_106601"></a><a name="fig_dc_vrp_vxlan_cfg_106601"></a><span class="figcap"><b>Figure 1 </b>Network diagram of centralized VXLAN gateways</span><br><span><img class="vsd" src="images/fig_dc_vrp_vxlan_cfg_106401.png" width="NaN" height="NaN"></span></div>
<p>To address these problems, distributed VXLAN gateways can be configured. On the network shown in <a href="#EN-US_TASK_0172363804__fig_dc_vrp_vxlan_cfg_106602">Figure 2</a>, Server1 and Server2 on different subnets both connect to Leaf1. When Server1 and Server2 communicate, traffic is forwarded only through Leaf1, not through any spine node.</p>
<div class="fignone" id="EN-US_TASK_0172363804__fig_dc_vrp_vxlan_cfg_106602"><a name="EN-US_TASK_0172363804__fig_dc_vrp_vxlan_cfg_106602"></a><a name="fig_dc_vrp_vxlan_cfg_106602"></a><span class="figcap"><b>Figure 2 </b>Network diagram of distributed VXLAN gateways</span><br><span><img class="vsd" src="images/fig_dc_vrp_vxlan_cfg_106402.png" width="NaN" height="NaN"></span></div>
<div class="p">Distributed VXLAN gateways have the following characteristics:<ul><li><p>Flexible deployment. A leaf node can function as both Layer 2 and Layer 3 VXLAN gateways.</p>
</li><li><p>Improved network expansion capabilities. Unlike a centralized Layer 3 gateway, which has to learn the ARP or ND entries of all servers on a network, a leaf node needs to learn the ARP or ND entries of only the servers attached to it. This addresses the problem of the ARP or ND entry specifications being a bottleneck for packet forwarding faced by centralized Layer 3 gateways.</p>
</li></ul>
</div>
<p>Either IPv4 or IPv6 addresses can be configured for the VMs and Layer 3 gateways. This means that a VXLAN overlay network can be an IPv4 or IPv6 network. <a href="#EN-US_TASK_0172363804__fig_dc_vrp_vxlan_cfg_106602">Figure 2</a> shows an IPv4 overlay network.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>If only VMs on the same subnet need to communicate with each other, Layer 3 VXLAN gateways do not need to be deployed. If VMs on different subnets need to communicate with each other or VMs on the same subnet need to communicate with external networks, Layer 3 VXLAN gateways must be deployed.</p>
</div></div>
<p>The following table lists the differences in distributed gateway configuration between IPv4 and IPv6 overlay networks.</p>

<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" frame="border" border="1" rules="all"><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="33.39%" id="mcps1.4.1.10.1.4.1.1" liSelected="liSelected"><p>Configuration Task</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="33.28%" id="mcps1.4.1.10.1.4.1.2" liSelected="liSelected"><p>IPv4 Overlay Network</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="33.33%" id="mcps1.4.1.10.1.4.1.3" liSelected="liSelected"><p>IPv6 Overlay Network</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" valign="top" width="33.39%" headers="mcps1.4.1.10.1.4.1.1 "><p>Configure a VPN instance for route leaking with an EVPN instance.</p>
</td>
<td class="cellrowborder" valign="top" width="33.28%" headers="mcps1.4.1.10.1.4.1.2 "><p>Enable the IPv4 address family of the involved VPN instance and then complete other configurations in the VPN instance IPv4 address family view.</p>
</td>
<td class="cellrowborder" valign="top" width="33.33%" headers="mcps1.4.1.10.1.4.1.3 "><p>Enable the IPv6 address family of the involved VPN instance and then complete other configurations in the VPN instance IPv6 address family view.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="33.39%" headers="mcps1.4.1.10.1.4.1.1 "><p>Configure an IPv6 Layer 3 VXLAN gateway.</p>
</td>
<td class="cellrowborder" valign="top" width="33.28%" headers="mcps1.4.1.10.1.4.1.2 "><p>Configure an IPv4 address for the VBDIF interface of the Layer 3 gateway.</p>
</td>
<td class="cellrowborder" valign="top" width="33.33%" headers="mcps1.4.1.10.1.4.1.3 "><p>Configure an IPv6 address for the VBDIF interface of the Layer 3 gateway.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="33.39%" headers="mcps1.4.1.10.1.4.1.1 "><p>Configure a gateway on an IPv6 VXLAN to advertise a specific type of route.</p>
</td>
<td class="cellrowborder" valign="top" width="33.28%" headers="mcps1.4.1.10.1.4.1.2 "><ul><li><p>For IP prefix routes, perform the configuration in the BGP-VPN instance IPv4 address family view.</p>
</li><li><p>For IRB routes, run the <a href="cmdqueryname=arp+collect+host+enable"><b><span class="cmdname">arp collect host enable</span></b></a> command.</p>
</li><li>For IP prefix routes, run the <a href="cmdqueryname=arp+vlink-direct-route+advertise"><b><span class="cmdname">arp vlink-direct-route advertise</span></b></a> command in the IPv4 address family view of the VPN instance to which the involved VBDIF interface is bound.</li></ul>
</td>
<td class="cellrowborder" valign="top" width="33.33%" headers="mcps1.4.1.10.1.4.1.3 "><ul><li><p>For IP prefix routes, perform the configuration in the BGP-VPN instance IPv6 address family view.</p>
</li><li><p>For IRBv6 routes, run the <a href="cmdqueryname=ipv6+nd+collect+host+enable"><b><span class="cmdname">ipv6 nd collect host enable</span></b></a> command.</p>
</li><li>For IP prefix routes, run the <a href="cmdqueryname=nd+vlink-direct-route+advertise"><b><span class="cmdname">nd vlink-direct-route advertise</span></b></a> command in the IPv6 address family view of the VPN instance to which the involved VBDIF interface is bound.</li></ul>
</td>
</tr>
</tbody>
</table>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172363804__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Pre-configuration Tasks</h4><p>Before configuring VXLAN in distributed gateway mode using BGP EVPN, complete the following task:</p>
<ul><li>Configure IP connectivity on the network.</li></ul>
</div></div>
</div>

<ul class="ullinks">
<dl>
<dt>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vxlan6_cfg_0018c.html">Configuring a VXLAN Service Access Point</a>
</dt>
<dd>
Layer 2 sub-interfaces are used for service access on VXLANs. These Layer 2 sub-interfaces can have different encapsulation types configured to transmit various types of data packets. A Layer 2 sub-interface can transmit data packets through a BD after being associated with it.</dd>
</dl>
<dl>
<dt>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vxlan_cfg_1062.html">Configuring a VXLAN Tunnel</a>
</dt>
<dd>
To allow VXLAN tunnel establishment using EVPN, configure an EVPN instance, establish a BGP EVPN peer relationship, and configure ingress replication.</dd>
</dl>
<dl>
<dt>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vxlan_cfg_1217-1.html">(Optional) Configuring a VPN Instance for Route Leaking with an EVPN Instance</a>
</dt>
<dd>
To enable communication between VMs on different subnets, configure a VPN instance for route leaking with an EVPN instance. This configuration enables Layer 3 connectivity. To isolate multiple tenants, you can use different VPN instances.</dd>
</dl>
<dl>
<dt>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vxlan_cfg_1217.html">Configuring a Layer 3 VXLAN Gateway</a>
</dt>
<dd>
To enable communication between VMs on different subnets, configure Layer 3 gateways on the VXLAN, enable the distributed gateway function, and configure host route advertisement.</dd>
</dl>
<dl>
<dt>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vxlan_cfg_1217-2.html">(Optional) Configuring VXLAN Gateways to Advertise Specific Types of Routes</a>
</dt>
<dd>
To enable communication between VMs on different subnets, configure VXLAN gateways to exchange IRB or IP prefix routes. This configuration enables the gateways to learn the IP routes of the related hosts or the subnets where the hosts reside.</dd>
</dl>
<dl>
<dt>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vxlan6_cfg_0023c.html">(Optional) Configuring a Static MAC Address Entry</a>
</dt>
<dd>
Using static MAC address entries to forward user packets helps reduce BUM traffic on the network and prevent bogus attacks.</dd>
</dl>
<dl>
<dt>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vxlan6_cfg_0021c.html">(Optional) Configuring a Limit on the Number of MAC Addresses Learned by an Interface</a>
</dt>
<dd>
MAC address learning limiting helps improve VXLAN network security.</dd>
</dl>
<dl>
<dt>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vxlan_cfg_1053.html">Verifying the Configuration of VXLAN in Distributed Gateway Mode Using BGP EVPN</a>
</dt>
<dd>
After configuring VXLAN in distributed gateway mode using BGP EVPN, verify the configuration, and you can find that VXLAN tunnels are dynamically established and are in the Up state.</dd>
</dl>
</ul>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vxlan_cfg_1082.html">VXLAN Configuration
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vxlan6_cfg_0001.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vxlan6_cfg_0006.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>