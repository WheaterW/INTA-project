
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Basic MSTP Functions">
<meta name="abstract" content="This example shows how to configure basic MSTP functions.">
<meta name="description" content="This example shows how to configure basic MSTP functions.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mstp_cfg_0045.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mstp_cfg_0049.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="MSTP">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="MSTP">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="featurename" content="MSTP">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="featurename" content="MSTP">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="OWNER" content="l00425560">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="wWX1238417">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172363667">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring Basic MSTP Functions</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172363667"></a><a name="EN-US_TASK_0172363667"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Basic MSTP Functions</h1>
<div class="taskbody"><p>This example shows how to configure basic MSTP functions.</p>
<div class="context"><a name="EN-US_TASK_0172363667__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On a complex network, loops are inevitable. With the requirement for network redundancy backup, network designers tend to deploy multiple physical links between two devices, one of which is the master and the others are the backup. Loops are likely or bound to occur in such a situation. Loops will cause broadcast storms, thereby exhausting network resources and paralyzing the network. Loops also cause flapping of MAC address entries and thus damage MAC address entries. MSTP can be deployed to eliminate loops. MSTP blocks redundant links on a Layer 2 network and trims the network into a loop-free tree.</p>
<p>As shown in <a href="#EN-US_TASK_0172363667__fig_dc_vrp_mstp_cfg_0046_01">Figure 1</a>, to load balance traffic of VLANs 1 to 10 and traffic of VLANs 11 to 20, multiple MSTIs are created. MSTP defines a VLAN mapping table in which VLANs are associated with spanning tree instances. In addition, MSTP divides a switching network into multiple regions, each of which has multiple independent spanning tree instances.</p>
<p>As shown in <a href="#EN-US_TASK_0172363667__fig_dc_vrp_mstp_cfg_0046_01">Figure 1</a>, <span class="keyword">Device</span>A, <span class="keyword">Device</span>B, <span class="keyword">Device</span>C, and <span class="keyword">Device</span>D all run MSTP.</p>
<div class="fignone" id="EN-US_TASK_0172363667__fig_dc_vrp_mstp_cfg_0046_01"><a name="EN-US_TASK_0172363667__fig_dc_vrp_mstp_cfg_0046_01"></a><a name="fig_dc_vrp_mstp_cfg_0046_01"></a><span class="figcap"><b>Figure 1 </b>Networking diagram of configuring basic MSTP functions</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interfaces 1 through 3 represent GE<span>0/1/1</span>, GE<span>0/1/2</span>, and GE<span>0/1/3</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_mstp_cfg_0046_01.png" width="NaN" height="NaN"></span><br></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172363667__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><div class="p">Configure basic MSTP functions on the <span class="keyword">device</span>s on the ring network, including:<ol type="a"><li><p>Configure an MST region and create multiple MSTIs to implement load balancing.</p>
</li><li><p>In the MST region, configure a primary root bridge and secondary root bridge for each MSTI.</p>
</li><li><p>Set path costs for ports to be blocked in each MSTI.</p>
</li><li><div class="p">Enable MSTP to eliminate loops, including:<ul><li><p>Enable MSTP globally.</p>
</li><li><p>Enable MSTP on all the interfaces except the interfaces connected to terminals.</p>
</li></ul>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>MSTP is not required on the interfaces connected to terminals because these interfaces do not need to participate in MSTP calculation.</p>
<p>By default, MSTP is enabled on a Layer 2 interface.</p>
</div></div>
</div>
</li></ol>
</div>
</li><li><p>Configure MSTP protection functions, for example, configure root protection on a designated port of a root bridge in each MSTI.</p>
</li><li><p>Configure the Layer 2 forwarding function on devices.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172363667__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>Region name RG1</p>
</li><li><p>MSTI 1 and MSTI 2</p>
</li><li><p>GE interface numbers (as shown in <a href="#EN-US_TASK_0172363667__fig_dc_vrp_mstp_cfg_0046_01">Figure 1</a>)</p>
</li><li><p>Primary and secondary root bridges of MSTI 1 (<span class="keyword">Device</span>A and <span class="keyword">Device</span>B respectively) and primary and secondary root bridges of MSTI 2 (<span class="keyword">Device</span>B and <span class="keyword">Device</span>A respectively)</p>
</li><li><p>Path costs (20000) of the ports to be blocked in MSTI 1 and MSTI 2 (as shown in <a href="#EN-US_TASK_0172363667__fig_dc_vrp_mstp_cfg_0046_01">Figure 1</a>)</p>
</li><li><p>VLAN IDs (1 to 20)</p>
</li><li><p>VLAN to which PC1 belongs (VLAN 10) and VLAN to which PC2 belongs (VLAN 20)</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172363667__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure basic MSTP functions.</span><p><ol type="a"><li><p>Add <span class="keyword">Device</span>A, <span class="keyword">Device</span>B, <span class="keyword">Device</span>C, and <span class="keyword">Device</span>D to MST region RG1, and create MSTI 1 and MSTI 2.</p>
<p># Add <span class="keyword">Device</span>A to RG1.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname <span class="keyword">Device</span>A</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>stp region-configuration</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-mst-region] <strong>region-name RG1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-mst-region] <strong>instance 1 vlan 1 to 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-mst-region] <strong>instance 2 vlan 11 to 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-mst-region] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-mst-region] <strong>quit</strong></pre>
<p># Add <span class="keyword">Device</span>B to RG1.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname <span class="keyword">Device</span>B</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>stp region-configuration</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-mst-region] <strong>region-name RG1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-mst-region] <strong>instance 1 vlan 1 to 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-mst-region] <strong>instance 2 vlan 11 to 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-mst-region] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-mst-region] <strong>quit</strong></pre>
<p># Add <span class="keyword">Device</span>C to RG1.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname <span class="keyword">Device</span>C</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C] <strong>stp region-configuration</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C-mst-region] <strong>region-name RG1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-mst-region] <strong>instance 1 vlan 1 to 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-mst-region] <strong>instance 2 vlan 11 to 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-mst-region] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C-mst-region] <strong>quit</strong></pre>
<p># Add <span class="keyword">Device</span>D to RG1.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname <span class="keyword">Device</span>D</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>D] <strong>stp region-configuration</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>D-mst-region] <strong>region-name RG1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-mst-region] <strong>instance 1 vlan 1 to 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-mst-region] <strong>instance 2 vlan 11 to 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-mst-region] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>D-mst-region] <strong>quit</strong></pre>
</li><li><p>In RG1, configure primary and secondary root bridges for MSTI 1 and MSTI 2.</p>
<ul><li><p>Configure primary and secondary root bridges for MSTI 1.</p>
<p># Configure <span class="keyword">Device</span>A as a primary root bridge of MSTI 1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>stp instance 1 root primary</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
<p># Configure <span class="keyword">Device</span>B as a secondary root bridge of MSTI 1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>stp instance 1 root secondary</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>commit</strong></pre>
</li><li><p>Configure primary and secondary root bridges for MSTI 2.</p>
<p># Configure <span class="keyword">Device</span>B as a primary root bridge of MSTI 2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>stp instance 2 root primary</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>commit</strong></pre>
<p># Configure <span class="keyword">Device</span>A as a secondary root bridge of MSTI 2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>stp instance 2 root secondary</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
</li></ul>
</li><li><p>Set the path costs of the ports to be blocked in MSTI 1 and MSTI 2 to be larger than the default value.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><ul><li><p>Different calculation methods define different path costs. The following uses the Huawei proprietary calculation method as an example to set the path costs of the ports to be blocked in MSTI 1 and MSTI 2 to 20000.</p>
</li><li><p>All devices on a network must use the same calculation for path costs.</p>
</li></ul>
</div></div>
<p># On <span class="keyword">Device</span>A, configure the Huawei proprietary method as the path cost calculation method.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>stp pathcost-standard legacy</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
<p># On <span class="keyword">Device</span>B, configure the Huawei proprietary method as the path cost calculation method.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>stp pathcost-standard legacy</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>commit</strong></pre>
<p># On <span class="keyword">Device</span>C, configure the path cost calculation method as the Huawei proprietary method and set the path cost of GE <span>0/1/2</span> in MSTI 2 to 20000.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C] <strong>stp pathcost-standard legacy</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C] <strong>interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-GigabitEthernet<span>0/1/2</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-GigabitEthernet<span>0/1/2</span>] <strong>portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-GigabitEthernet<span>0/1/2</span>] <strong>stp instance 2 cost 20000</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-GigabitEthernet<span>0/1/2</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<p># On <span class="keyword">Device</span>D, configure the path cost calculation method as the Huawei proprietary method and set the path cost of GE <span>0/1/2</span> in MSTI 1 to 20000.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>D] <strong>stp pathcost-standard legacy</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D] <strong>interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-GigabitEthernet<span>0/1/2</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-GigabitEthernet<span>0/1/2</span>] <strong>portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-GigabitEthernet<span>0/1/2</span>] <strong>stp instance 1 cost 20000</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-GigabitEthernet<span>0/1/2</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>D-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
</li><li><p>Enable MSTP to eliminate loops.</p>
<ul><li><p>Disable MSTP on interfaces connected to PCs.</p>
<p># Disable STP on GE <span>0/1/1</span> of <span class="keyword">Device</span>C.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-GigabitEthernet<span>0/1/1</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-GigabitEthernet<span>0/1/1</span>] <strong>portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-GigabitEthernet<span>0/1/1</span>] <strong>stp disable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-GigabitEthernet<span>0/1/1</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<p># Disable STP on GE <span>0/1/1</span> of <span class="keyword">Device</span>D.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>D] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-GigabitEthernet<span>0/1/1</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-GigabitEthernet<span>0/1/1</span>] <strong>portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-GigabitEthernet<span>0/1/1</span>] <strong>stp disable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-GigabitEthernet<span>0/1/1</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>D-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
</li><li><p>Enable MSTP globally.</p>
<p># Enable MSTP on <span class="keyword">Device</span>A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>stp enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
<p># Enable MSTP on <span class="keyword">Device</span>B.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>stp enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>commit</strong></pre>
<p># Enable MSTP on <span class="keyword">Device</span>C.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C] <strong>stp enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C] <strong>commit</strong></pre>
<p># Enable MSTP on <span class="keyword">Device</span>D.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>D] <strong>stp enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D] <strong>commit</strong></pre>
</li><li><p>Enable MSTP on all the interfaces except the interfaces connected to terminals.</p>
<p># Enable MSTP on GE <span>0/1/1</span> of <span class="keyword">Device</span>A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/1</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/1</span>] <strong>portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/1</span>] <strong>stp enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/1</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<p># Enable MSTP on GE <span>0/1/2</span> of <span class="keyword">Device</span>A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/2</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/2</span>] <strong>portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/2</span>] <strong>stp enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/2</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<p># Enable MSTP on GE <span>0/1/1</span> of <span class="keyword">Device</span>B.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/1</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/1</span>] <strong>portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/1</span>] <strong>stp enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/1</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<p># Enable MSTP on GE <span>0/1/2</span> of <span class="keyword">Device</span>B.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/2</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/2</span>] <strong>portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/2</span>] <strong>stp enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/2</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<p># Enable MSTP on GE <span>0/1/2</span> of <span class="keyword">Device</span>C.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C] <strong>interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-GigabitEthernet<span>0/1/2</span>] <strong>stp enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-GigabitEthernet<span>0/1/2</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<p># Enable MSTP on GE <span>0/1/3</span> of <span class="keyword">Device</span>C.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C] <strong>interface gigabitethernet <span>0/1/3</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C-GigabitEthernet<span>0/1/3</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-GigabitEthernet<span>0/1/3</span>] <strong>portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-GigabitEthernet<span>0/1/3</span>] <strong>stp enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-GigabitEthernet<span>0/1/3</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C-GigabitEthernet<span>0/1/3</span>] <strong>quit</strong></pre>
<p># Enable MSTP on GE <span>0/1/2</span> of <span class="keyword">Device</span>D.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>D] <strong>interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-GigabitEthernet<span>0/1/2</span>] <strong>stp enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-GigabitEthernet<span>0/1/2</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>D-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<p># Enable MSTP on GE <span>0/1/3</span> of <span class="keyword">Device</span>D.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>D] <strong>interface gigabitethernet <span>0/1/3</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>D-GigabitEthernet<span>0/1/3</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-GigabitEthernet<span>0/1/3</span>] <strong>portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-GigabitEthernet<span>0/1/3</span>] <strong>stp enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-GigabitEthernet<span>0/1/3</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>D-GigabitEthernet<span>0/1/3</span>] <strong>quit</strong></pre>
</li></ul>
</li></ol>
</p></li><li><span>Configure MSTP protection functions, for example, configure root protection on a designated port of a root bridge in each MSTI.</span><p><p># Enable root protection on GE <span>0/1/1</span> of <span class="keyword">Device</span>A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/1</span>] <strong>stp root-protection</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/1</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<p># Enable root protection on GE <span>0/1/1</span> of <span class="keyword">Device</span>B.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/1</span>] <strong>stp root-protection</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/1</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
</p></li><li><span>Configure the Layer 2 forwarding function on devices in the ring.</span><p><ul><li><p>Create VLANs 1 to 20 on <span class="keyword">Device</span>A, <span class="keyword">Device</span>B, <span class="keyword">Device</span>C, and <span class="keyword">Device</span>D.</p>
<p># Create VLANs 1 to 20 on <span class="keyword">Device</span>A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>vlan batch 1 to 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
<p># Create VLANs 1 to 20 on <span class="keyword">Device</span>B.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>vlan batch 1 to 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>commit</strong></pre>
<p># Create VLANs 1 to 20 on <span class="keyword">Device</span>C.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C] <strong>vlan batch 1 to 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C] <strong>commit</strong></pre>
<p># Create VLANs 1 to 20 on <span class="keyword">Device</span>D.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>D] <strong>vlan batch 1 to 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D] <strong>commit</strong></pre>
</li><li><p>Add interfaces on the devices in the ring to VLANs.</p>
<p># Add GE <span>0/1/1</span> on <span class="keyword">Device</span>A to VLANs.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/1</span>] <strong>port trunk allow-pass vlan 1 to 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/1</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<p># Add GE <span>0/1/2</span> on <span class="keyword">Device</span>A to VLANs.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/2</span>] <strong>port trunk allow-pass vlan 1 to 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/2</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<p># Add GE <span>0/1/1</span> on <span class="keyword">Device</span>B to VLANs.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/1</span>] <strong>port trunk allow-pass vlan 1 to 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/1</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<p># Add GE <span>0/1/2</span> on <span class="keyword">Device</span>B to VLANs.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/2</span>] <strong>port trunk allow-pass vlan 1 to 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/2</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<p># Add GE <span>0/1/2</span> on <span class="keyword">Device</span>C to VLANs.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C] <strong>interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C-GigabitEthernet<span>0/1/2</span>] <strong>port trunk allow-pass vlan 1 to 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-GigabitEthernet<span>0/1/2</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<p># Add GE <span>0/1/3</span> on <span class="keyword">Device</span>C to VLANs.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C] <strong>interface gigabitethernet <span>0/1/3</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C-GigabitEthernet<span>0/1/3</span>] <strong>port trunk allow-pass vlan 1 to 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-GigabitEthernet<span>0/1/3</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C-GigabitEthernet<span>0/1/3</span>] <strong>quit</strong></pre>
<p># Add GE <span>0/1/2</span> on <span class="keyword">Device</span>D to VLANs.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>D] <strong>interface gigabitEthernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>D-GigabitEthernet<span>0/1/2</span>] <strong>port trunk allow-pass vlan 1 to 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-GigabitEthernet<span>0/1/2</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>D-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<p># Add GE <span>0/1/3</span> on <span class="keyword">Device</span>D to VLANs.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>D] <strong>interface gigabitethernet <span>0/1/3</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>D-GigabitEthernet<span>0/1/3</span>] <strong>port trunk allow-pass vlan 1 to 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-GigabitEthernet<span>0/1/3</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>D-GigabitEthernet<span>0/1/3</span>] <strong>quit</strong></pre>
</li></ul>
</p></li><li><span>Verify the configuration.</span><p><p>After completing the previous configurations, run the following commands to verify the configurations.</p>
<p># Run the <a href="cmdqueryname=display+stp+brief"><b><span class="cmdname">display stp brief</span></b></a> command on <span class="keyword">Device</span>A to view the interface status and protection type. The displayed information is as follows:</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>display stp brief</strong></pre>
<pre class="screen"> MSTID      Port                  Role  STP State     Protection
   0        GigabitEthernet<span>0/1/1</span>  DESI  FORWARDING    NONE
   0        GigabitEthernet<span>0/1/2</span>  DESI  FORWARDING    NONE
   1        GigabitEthernet<span>0/1/1</span>  DESI  FORWARDING    NONE
   1        GigabitEthernet<span>0/1/2</span>  DESI  FORWARDING    NONE
   2        GigabitEthernet<span>0/1/1</span>  DESI  FORWARDING    NONE
   2        GigabitEthernet<span>0/1/2</span>  ROOT  FORWARDING    NONE</pre>
<p>In MSTI 1, <span class="keyword">Device</span>A is a root bridge and thus GE <span>0/1/2</span> and GE <span>0/1/1</span> on <span class="keyword">Device</span>A are designated ports. In MSTI 2, GE <span>0/1/1</span> on <span class="keyword">Device</span>A is a designated port and GE <span>0/1/2</span> is a root port.</p>
<p># Run the <a href="cmdqueryname=display+stp+brief"><b><span class="cmdname">display stp brief</span></b></a> command on <span class="keyword">Device</span>B. The displayed information is as follows:</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>display stp brief</strong></pre>
<pre class="screen"> MSTID      Port                  Role  STP State       Protection
   0        GigabitEthernet<span>0/1/1</span>  DESI  FORWARDING      NONE
   0        GigabitEthernet<span>0/1/2</span>  ROOT  FORWARDING      NONE
   1        GigabitEthernet<span>0/1/1</span>  DESI  FORWARDING      NONE
   1        GigabitEthernet<span>0/1/2</span>  ROOT  FORWARDING      NONE
   2        GigabitEthernet<span>0/1/1</span>  DESI  FORWARDING      NONE
   2        GigabitEthernet<span>0/1/2</span>  DESI  FORWARDING      NONE</pre>
<p>In MSTI 2, <span class="keyword">Device</span>B is a root bridge and thus GE <span>0/1/1</span> and GE <span>0/1/2</span> on <span class="keyword">Device</span>B are designated ports. In MSTI 1, GE <span>0/1/1</span> of <span class="keyword">Device</span>B is a designated port and GE <span>0/1/2</span> is a root port.</p>
<p># Run the <a href="cmdqueryname=display+stp+interface+brief"><b><span class="cmdname">display stp interface brief</span></b></a> command on <span class="keyword">Device</span>C. The displayed information is as follows:</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C] <strong>display stp interface gigabitethernet <span>0/1/3</span> brief</strong></pre>
<pre class="screen"> MSTID      Port                    Role  STP State       Protection
   0        GigabitEthernet<span>0/1/3</span>    ROOT  FORWARDING      NONE
   1        GigabitEthernet<span>0/1/3</span>    ROOT  FORWARDING      NONE
   2        GigabitEthernet<span>0/1/3</span>    ROOT  FORWARDING      NONE</pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C] <strong>display stp interface gigabitethernet <span>0/1/2</span> brief</strong></pre>
<pre class="screen"> MSTID      Port                    Role  STP State       Protection
   0        GigabitEthernet<span>0/1/2</span>    DESI  FORWARDING      NONE
   1        GigabitEthernet<span>0/1/2</span>    DESI  FORWARDING      NONE
   2        GigabitEthernet<span>0/1/2</span>    ALTE  DISCARDING      NONE</pre>
<p># Run the <a href="cmdqueryname=display+stp+interface+brief"><b><span class="cmdname">display stp interface brief</span></b></a> command on <span class="keyword">Device</span>D. The displayed information is as follows:</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>D] <strong>display stp interface gigabitethernet <span>0/1/3</span> brief</strong></pre>
<pre class="screen"> MSTID      Port                    Role  STP State       Protection
   0        GigabitEthernet<span>0/1/3</span>    ALTE  DISCARDING      NONE
   1        GigabitEthernet<span>0/1/3</span>    ROOT  FORWARDING      NONE
   2        GigabitEthernet<span>0/1/3</span>    ROOT  FORWARDING      NONE</pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>D] <strong>display stp interface gigabitethernet <span>0/1/2</span> brief</strong></pre>
<pre class="screen"> MSTID      Port                    Role  STP State       Protection
   0        GigabitEthernet<span>0/1/2</span>    ROOT  FORWARDING      NONE
   1        GigabitEthernet<span>0/1/2</span>    ALTE  DISCARDING      NONE
   2        GigabitEthernet<span>0/1/2</span>    DESI  FORWARDING      NONE   </pre>
<p>GE <span>0/1/3</span> on <span class="keyword">Device</span>D is a root port in both MSTI 1 and MSTI 2. GE <span>0/1/2</span> on <span class="keyword">Device</span>D is blocked in MSTI 1 but is calculated to be a designated port in MSTI 2.</p>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172363667__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p><span class="keyword">Device</span>A configuration file</p>
<pre class="screen">#                                                                               
 sysname <span class="keyword">Device</span>A                                                                
#                                                                               
 vlan batch 1 to 20                                                             
#                                                                               
 stp instance 1 root primary                                                    
 stp instance 2 root secondary                                                  
 stp pathcost-standard legacy                                                   
 stp enable                
#                                                                               
 stp region-configuration                                                       
  region-name RG1                                                               
  instance 1 vlan 1 to 10                                                       
  instance 2 vlan 11 to 20                                                      
#                                                                               
interface GigabitEthernet<span>0/1/1</span>                                                  
 undo shutdown
 portswitch
 port trunk allow-pass vlan 1 to 20                                               
 stp root-protection                                                            
#                                                                               
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 portswitch
 port trunk allow-pass vlan 1 to 20   
#                                                                               
return</pre>
</li><li><p><span class="keyword">Device</span>B configuration file</p>
<pre class="screen">#                                                                               
 sysname <span class="keyword">Device</span>B                                                                
#                                                                               
 vlan batch 1 to 20                                                             
#                                                                               
 stp instance 1 root secondary                                                  
 stp instance 2 root primary                                                    
 stp pathcost-standard legacy                                                   
 stp enable                                                        
#                                                                               
 stp region-configuration                                                       
  region-name RG1                                                               
  instance 1 vlan 1 to 10                                                       
  instance 2 vlan 11 to 20                                                      
#                                                                                
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 portswitch
 port trunk allow-pass vlan 1 to 20                                             
 stp root-protection                                                            
#                      
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 portswitch
 port trunk allow-pass vlan 1 to 20
#                                                                               
return</pre>
</li><li><p><span class="keyword">Device</span>C configuration file</p>
<pre class="screen">#                                                                               
 sysname <span class="keyword">Device</span>C                                                                
#                                                                               
 vlan batch 1 to 20                                                             
#                                                                               
 stp pathcost-standard legacy                                                   
 stp enable                                                                     
#                                                                               
 stp region-configuration                                                       
  region-name RG1                                                               
  instance 1 vlan 1 to 10                                                       
  instance 2 vlan 11 to 20                                                      
#                                                                               
interface GigabitEthernet<span>0/1/1</span>                                                  
 undo shutdown
 portswitch
 stp disable
#                                                                               
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 portswitch
 port trunk allow-pass vlan 1 to 20                                             
 stp instance 2 cost 20000
#                                                                               
interface GigabitEthernet<span>0/1/3</span>
 undo shutdown
 portswitch
 port trunk allow-pass vlan 1 to 20                                                         
#                                                                               
return</pre>
</li><li><p><span class="keyword">Device</span>D configuration file</p>
<pre class="screen">#                                                                               
 sysname <span class="keyword">Device</span>D                                                                
#                                                                               
 vlan batch 1 to 20                                                             
#                                                                               
 stp pathcost-standard legacy                                                   
 stp enable                                                                     
#                                                                               
 stp region-configuration                                                       
  region-name RG1                                                               
  instance 1 vlan 1 to 10                                                       
  instance 2 vlan 11 to 20                                                                          
#                                                                               
interface GigabitEthernet<span>0/1/1</span>                                                  
 undo shutdown
 portswitch
 stp disable
#                                                                               
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 portswitch
 port trunk allow-pass vlan 1 to 20                                             
 stp instance 1 cost 20000
#                                                                               
interface GigabitEthernet<span>0/1/3</span>
 undo shutdown
 portswitch
 port trunk allow-pass vlan 1 to 20                                             
#                                                                         
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mstp_cfg_0045.html">Configuration Examples for MSTP
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mstp_cfg_0049.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>