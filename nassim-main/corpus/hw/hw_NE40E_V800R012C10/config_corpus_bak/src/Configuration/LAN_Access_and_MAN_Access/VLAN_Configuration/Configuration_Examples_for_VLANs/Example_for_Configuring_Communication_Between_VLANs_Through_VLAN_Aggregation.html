
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Communication Between VLANs Through VLAN Aggregation">
<meta name="abstract" content="This part describes how to configure communication between VLANs with fewer IP addresses.">
<meta name="description" content="This part describes how to configure communication between VLANs with fewer IP addresses.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vlan_cfg_0033.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vlan_cfg_0060.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="wwx1238417">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="VLAN">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="VLAN">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="featurename" content="VLAN">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="featurename" content="VLAN">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="OWNER" content="c00648116,w00437000">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="wwx1238417">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172363188">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring Communication Between VLANs Through VLAN Aggregation</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172363188"></a><a name="EN-US_TASK_0172363188"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Communication Between VLANs Through VLAN Aggregation</h1>
<div class="taskbody"><p>This part describes how to configure communication between VLANs with fewer IP addresses.</p>
<div class="context"><a name="EN-US_TASK_0172363188__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>Assume that an enterprise has many departments and IP addresses of these departments are on the same network segment, to improve the service security, IP addresses of PCs used by employees in the same department are added to the same VLAN and IP addresses of PCs used by employees in different departments are added to different VLANs. IP addresses of PCs used by employees in different departments need to communicate with each other.</p>
<p>On the network shown in <a href="#EN-US_TASK_0172363188__fig_dc_vrp_vlan_cfg_003901">Figure 1</a>, the R&amp;D department and test department belong to different VLANs. It is required that employees in different VLANs communicate with each other.</p>
<div class="fignone" id="EN-US_TASK_0172363188__fig_dc_vrp_vlan_cfg_003901"><a name="EN-US_TASK_0172363188__fig_dc_vrp_vlan_cfg_003901"></a><a name="fig_dc_vrp_vlan_cfg_003901"></a><span class="figcap"><b>Figure 1 </b>Network diagram of configuring inter-VLAN communication through VLAN aggregation</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interfaces 1 through 3 represent GE<span>0/1/1</span>, GE<span>0/1/2</span>, and GE<span>0/1/3</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_vlan_cfg_003901.png" width="NaN" height="NaN"></span></div>
<p>IP addresses of the R&amp;D department and test department are on the same network segment. To save IP address resources, you can deploy VLAN aggregation on devices of the R&amp;D department and test department. This ensures that different VLANs can communicate with each other.</p>
</div></div>
<div class="context"><a name="EN-US_TASK_0172363188__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li>Create VLANs on the CEs and determine the VLANs to which users belong.</li><li><p>Configure VLAN aggregation on the PE.</p>
<ol type="a"><li><p>Configure the Layer 2 forwarding function.</p>
</li><li><p>Create a super-VLAN and add sub-VLANs to the super-VLAN.</p>
</li><li><p>Create a VLANIF interface for the super-VLAN and assign an IP address to the VLANIF interface as the network gateway address.</p>
</li></ol>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172363188__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li>User VLAN ID</li><li>User IP address</li><li>Number of each port connecting a CE to a PC</li><li>Sub-VLAN ID and super-VLAN ID</li><li>Number and IP address of the VLANIF interface of the super-VLAN</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172363188__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Create a VLAN on CE and add Layer 2 interfaces to the VLAN.</span><p><p># Configure CE1.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname CE1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>vlan batch 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/1</span>]<strong> portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/1</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/1</span>] <strong>port link-type access</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/1</span>] <strong>port default vlan 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/2</span>]<strong> portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/2</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/2</span>] <strong>port link-type access</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/2</span>] <strong>port default vlan 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>interface gigabitethernet <span>0/1/3</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/3</span>]<strong> portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/3</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/3</span>] <strong>port link-type trunk</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/3</span>] <strong>port trunk allow-pass vlan 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/3</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>commit</strong></pre>
<p># Configure CE2.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname CE2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>vlan batch 3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>]<strong> portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>] <strong>port link-type access</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>] <strong>port default vlan 3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/2</span>]<strong> portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/2</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/2</span>] <strong>port link-type access</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/2</span>] <strong>port default vlan 3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>interface gigabitethernet <span>0/1/3</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/3</span>]<strong> portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/3</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/3</span>] <strong>port link-type trunk</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/3</span>] <strong>port trunk allow-pass vlan 3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/3</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>commit</strong></pre>
</p></li><li><span>Configure VLAN aggregation on the PE.</span><p><ol type="a"><li><p>Configure the Layer 2 forwarding function.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname PE</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE] <strong>vlan batch 2 to 4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-GigabitEthernet<span>0/1/1</span>]<strong> portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-GigabitEthernet<span>0/1/1</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-GigabitEthernet<span>0/1/1</span>] <strong>port link-type trunk</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-GigabitEthernet<span>0/1/1</span>] <strong>port trunk allow-pass vlan 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE] <strong>interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-GigabitEthernet<span>0/1/2</span>]<strong> portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-GigabitEthernet<span>0/1/2</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-GigabitEthernet<span>0/1/2</span>] <strong>port link-type trunk</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-GigabitEthernet<span>0/1/2</span>] <strong>port trunk allow-pass vlan 3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
</li><li><p>Create a super-VLAN and add sub-VLANs to the super-VLAN.</p>
<pre class="screen">[<span class="keyword">*</span>PE] <strong>vlan 4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-vlan4] <strong>aggregate-vlan</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-vlan4] <strong>access-vlan 2 to 3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-vlan4] <strong>quit</strong></pre>
</li><li><p>Create a VLANIF interface for the super-VLAN and assign an IP address to the VLANIF interface.</p>
<pre class="screen">[<span class="keyword">*</span>PE] <strong>interface vlanif 4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-Vlanif4] <strong>ip address 10.1.1.12 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-Vlanif4] <strong>commit</strong></pre>
<p>After the preceding configurations, configure IP addresses as shown in <a href="#EN-US_TASK_0172363188__fig_dc_vrp_vlan_cfg_003901">Figure 1</a> to PCs. The IP addresses of the PCs and VLANIF interface are on the same network segment. If the configuration succeeds, the PCs used by employees in each VLAN and the corresponding switch can ping each other, whereas the PCs used by employees in VLAN2 and the PCs used by employees in VLAN3 cannot.</p>
</li></ol>
</p></li><li><span>Enable inter-VLAN proxy ARP.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-vlanif4] <strong>arp-proxy inter-sub-vlan-proxy enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-vlanif4] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-vlanif4] <strong>quit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p>After the configuration, IP addresses of PCs used by employees in VLAN2 and VLAN3 can ping each other.</p>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172363188__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>CE1 configuration file</p>
<pre class="screen">#</pre>
<pre class="screen"> sysname CE1</pre>
<pre class="screen">#</pre>
<pre class="screen"> vlan batch 2</pre>
<pre class="screen">#</pre>
<pre class="screen"> interface GigabitEthernet<span>0/1/1</span></pre>
<pre class="screen">  portswitch</pre>
<pre class="screen">  undo shutdown</pre>
<pre class="screen">  port link-type access</pre>
<pre class="screen">  port default vlan 2</pre>
<pre class="screen">#</pre>
<pre class="screen"> interface GigabitEthernet<span>0/1/2</span></pre>
<pre class="screen">  portswitch</pre>
<pre class="screen">  undo shutdown</pre>
<pre class="screen">  port link-type access</pre>
<pre class="screen">  port default vlan 2</pre>
<pre class="screen">#</pre>
<pre class="screen"> interface GigabitEthernet<span>0/1/3</span></pre>
<pre class="screen">  portswitch</pre>
<pre class="screen">  undo shutdown</pre>
<pre class="screen"> port link-type trunk</pre>
<pre class="screen"> port trunk allow-pass vlan 2</pre>
<pre class="screen">#</pre>
<pre class="screen"> return</pre>
</li><li><p>CE2 configuration file</p>
<pre class="screen">#</pre>
<pre class="screen"> sysname CE2</pre>
<pre class="screen">#</pre>
<pre class="screen"> vlan batch 3</pre>
<pre class="screen">#</pre>
<pre class="screen"> interface GigabitEthernet<span>0/1/1</span></pre>
<pre class="screen">  portswitch</pre>
<pre class="screen">  undo shutdown</pre>
<pre class="screen">  port link-type access</pre>
<pre class="screen">  port default vlan 3</pre>
<pre class="screen">#</pre>
<pre class="screen"> interface GigabitEthernet<span>0/1/2</span></pre>
<pre class="screen">  portswitch</pre>
<pre class="screen">  undo shutdown</pre>
<pre class="screen">  port link-type access</pre>
<pre class="screen">  port default vlan 3</pre>
<pre class="screen">#</pre>
<pre class="screen"> interface GigabitEthernet<span>0/1/3</span></pre>
<pre class="screen">  portswitch</pre>
<pre class="screen">  undo shutdown</pre>
<pre class="screen"> port link-type trunk</pre>
<pre class="screen"> port trunk allow-pass vlan 3</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p>PE configuration file</p>
<pre class="screen">#</pre>
<pre class="screen"> sysname PE</pre>
<pre class="screen">#</pre>
<pre class="screen"> vlan batch 2 to 4</pre>
<pre class="screen">#</pre>
<pre class="screen"> vlan 4</pre>
<pre class="screen">  aggregate-vlan</pre>
<pre class="screen">  access-vlan 2 to 3</pre>
<pre class="screen">#</pre>
<pre class="screen"> interface Vlanif4</pre>
<pre class="screen">  ip address 10.1.1.12 255.255.255.0</pre>
<pre class="screen">  arp-proxy inter-sub-vlan-proxy enable</pre>
<pre class="screen">#</pre>
<pre class="screen"> interface GigabitEthernet<span>0/1/1</span></pre>
<pre class="screen">  portswitch</pre>
<pre class="screen">  undo shutdown</pre>
<pre class="screen">  port link-type trunk</pre>
<pre class="screen">  port trunk allow-pass vlan 2</pre>
<pre class="screen">#</pre>
<pre class="screen"> interface GigabitEthernet<span>0/1/2</span></pre>
<pre class="screen">  portswitch</pre>
<pre class="screen">  undo shutdown</pre>
<pre class="screen">  port link-type trunk</pre>
<pre class="screen">  port trunk allow-pass vlan 3</pre>
<pre class="screen">#</pre>
<pre class="screen"> return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vlan_cfg_0033.html">Configuration Examples for VLANs
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vlan_cfg_0060.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>
</body>
</html>