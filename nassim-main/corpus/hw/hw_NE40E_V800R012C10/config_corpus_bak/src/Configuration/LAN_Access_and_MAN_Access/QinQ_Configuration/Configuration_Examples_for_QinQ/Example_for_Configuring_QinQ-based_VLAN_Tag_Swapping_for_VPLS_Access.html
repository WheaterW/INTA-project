
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring QinQ-based VLAN Tag Swapping for VPLS Access">
<meta name="abstract" content="After QinQ-based VLAN tag swapping is configured on an interface, the interface swaps the inner and outer virtual local area network (VLAN) tags carried in double-tagged packets when receiving them. This configuration does not take effect on single-tagged packets.">
<meta name="description" content="After QinQ-based VLAN tag swapping is configured on an interface, the interface swaps the inner and outer virtual local area network (VLAN) tags carried in double-tagged packets when receiving them. This configuration does not take effect on single-tagged packets.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_qinq_cfg_0023_1.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_qinq_cfg_0051_1.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_qinq_cfg_0026.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="wwx1238417">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="QinQ">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="QinQ">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="featurename" content="QinQ">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="featurename" content="QinQ">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="OWNER" content="c00648116,w00437000">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="wWX1238417">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172363295">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring QinQ-based VLAN Tag Swapping for VPLS Access</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172363295"></a><a name="EN-US_TASK_0172363295"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring QinQ-based VLAN Tag Swapping for VPLS Access</h1>
<div class="taskbody"><p>After QinQ-based VLAN tag swapping is configured on an interface, the interface swaps the inner and outer virtual local area network (VLAN) tags carried in double-tagged packets when receiving them. This configuration does not take effect on single-tagged packets.</p>
<div class="context"><a name="EN-US_TASK_0172363295__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0172363295__fig_dc_vrp_qinq_cfg_005201">Figure 1</a>, <span>customers 1 to 1000 have three types of services: unicast high-speed Internet (HSI) services, unicast Voice over Internet Protocol (VoIP) services, and multicast Internet Protocol television (IPTV) services.</span></p>
<p>When customers 1 to 1000 send both unicast and multicast services, CE1 adds to user packets inner VLAN tags indicating the services, and CE3 adds to user packets outer VLAN tags indicating the users. QinQ-based VLAN tag swapping needs to be configured on the user-end provider edge (UPE) to swap the inner and outer VLAN tags in double-tagged packets. As such, the outer tags in the packets indicate the services, and the inner tags indicate the users.</p>
<p>QinQ VLAN tag termination sub-interfaces are created on the UPE based on double VLAN tags in packets from the CE3, and the UPE provides virtual private LAN service (VPLS) access to services through these sub-interfaces.</p>
<div class="p"><ul><li><p>Provide VPLS access for unicast services.</p>
<p>Create subinterface 1 on the UPE to provide VPLS access for HSI and VoIP services (customer VLANs 1â1000, service VLAN 7) and configure subinterface 1 as a QinQ VLAN tag termination sub-interface in symmetrical mode to terminate the outer VLAN tags of packets. The inner VLAN tags of packets are transparently transmitted to the provider edge-access aggregation gateway (PE-AGG).</p>
<p>Configure subinterface 1 on the PE-AGG as a QinQ VLAN tag termination sub-interface in symmetrical mode. After receiving packets from the UPE, subinterface 1 adds a VLAN tag to each packet and forwards the packets to the Service point of presence (POP).</p>
</li><li><p>Provide VPLS access for multicast services.</p>
<p>Create subinterface 2 on the UPE to provide VPLS access for IPTV services (customer VLANs 1â1000, service VLAN 8) and configure subinterface 2 as a QinQ VLAN tag termination sub-interface in asymmetrical mode to terminate the inner and outer VLAN tags of packets.</p>
<p>Configure subinterface 2 on the PE-AGG as a QinQ VLAN tag termination sub-interface in asymmetrical mode. After receiving packets from the UPE, subinterface 2 adds the service VLAN 8 to the packets and forwards the packets to the Service POP.</p>
</li></ul>
</div>
<div class="fignone" id="EN-US_TASK_0172363295__fig_dc_vrp_qinq_cfg_005201"><a name="EN-US_TASK_0172363295__fig_dc_vrp_qinq_cfg_005201"></a><a name="fig_dc_vrp_qinq_cfg_005201"></a><span class="figcap"><b>Figure 1 </b>Networking for configuring QinQ-based VLAN tag swapping for VPLS access</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interfaces 1 through 4, sub-interface1.1, and sub-interface1.2 represent GE<span>0/1/1</span>, GE<span>0/1/2</span>, GE<span>0/1/3</span>, GE<span>0/1/4</span>, GE<span>0/1/1</span>.1, and GE<span>0/1/1</span>.2, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0000001671749181.png" width="NaN" height="NaN"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172363295__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li>Configure QinQ so that packets received by edge devices on the VPLS network carry double tags.</li><li>Configure an Interior Gateway Protocol (IGP) on the Multiprotocol Label Switching (MPLS) backbone network.</li><li>Enable basic MPLS functions and Label Distribution Protocol (LDP) on the MPLS backbone network.</li><li>Enable MPLS Layer 2 virtual private network (L2VPN).</li><li>Create virtual switching instances (VSIs) and specify LDP as the signaling protocol of the VSIs.</li><li>Configure VLAN tag swapping and QinQ VLAN tag termination sub-interfaces, and bind the AC interfaces to the VSIs.</li><li>Enable Internet Group Management Protocol (IGMP) snooping and configure the static router interface and querier.</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172363295__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>IDs of inner VLAN tags that CE1 and CE2 add to packets to distinguish services</p>
</li><li><p>IDs of outer VLAN tags that the CE3 adds to packets to distinguish users</p>
</li><li><p>IP address of each interface</p>
</li><li><p>VSI ID (which is the same on the UPE and PE-AGG)</p>
</li><li><p>MPLS LSR IDs on the UPE and PE-AGG</p>
</li><li><p>VSI names on the UPE and PE-AGG</p>
</li><li><p>Names of interfaces bound to the VSIs</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172363295__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure QinQ so that CE3 sends double-tagged packets to the UPE.</span><p><ol type="a"><li><p>Switch Layer 3 interfaces to Layer 2 interfaces.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>If the interface is a Layer 2 interface, skip this step.</p>
</div></div>
<p># Configure CE1.</p>
<pre class="screen">&lt;<span class="keyword">*</span><span class="keyword">HUAWEI</span>&gt;<strong> system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>]<strong> sysname CE1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1]<strong> interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/1</span>]<strong> portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/1</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/1</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1]<strong> interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/2</span>]<strong> portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/2</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/2</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1]<strong> interface gigabitethernet <span>0/1/3</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/3</span>]<strong> portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/3</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/3</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1]<strong> interface gigabitethernet <span>0/1/4</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/4</span>]<strong> portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/4</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/4</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1-GigabitEthernet<span>0/1/4</span>]<strong> quit</strong></pre>
<p>The configurations on CE2 are the same as those on CE1. For details, see "Configuration Files."</p>
<p># Configure CE3.</p>
<pre class="screen">&lt;<span class="keyword">*</span><span class="keyword">HUAWEI</span>&gt;<strong> system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>]<strong> sysname CE3</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE3]<strong> interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-GigabitEthernet<span>0/1/1</span>]<strong> portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-GigabitEthernet<span>0/1/1</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-GigabitEthernet<span>0/1/1</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3]<strong> interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-GigabitEthernet<span>0/1/2</span>]<strong> portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-GigabitEthernet<span>0/1/2</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-GigabitEthernet<span>0/1/2</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3]<strong> interface gigabitethernet <span>0/1/3</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-GigabitEthernet<span>0/1/3</span>]<strong> portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-GigabitEthernet<span>0/1/3</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-GigabitEthernet<span>0/1/3</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE3-GigabitEthernet<span>0/1/3</span>]<strong> quit</strong></pre>
</li><li><p>Configure QinQ.</p>
<p># Configure CE1.</p>
<pre class="screen">[<span class="keyword">*</span>CE1]<strong> vlan 7</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-vlan7]<strong> port gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-vlan7]<strong> port gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-vlan7]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1]<strong> vlan 8</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-vlan8]<strong> port gigabitethernet <span>0/1/3</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-vlan8]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1]<strong> interface gigabitethernet <span>0/1/4</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/4</span>]<strong> port trunk allow-pass vlan 7 8</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/4</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/4</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1-GigabitEthernet<span>0/1/4</span>]<strong> quit</strong></pre>
<p>The configurations on CE2 are the same as those on CE1. For details, see "Configuration Files."</p>
<p># Configure CE3.</p>
<pre class="screen">[<span class="keyword">*</span>CE3]<strong> vlan batch 1 to 1000</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3]<strong> interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-GigabitEthernet<span>0/1/1</span>]<strong> port vlan-stacking vlan 7 to 8 stack-vlan 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-GigabitEthernet<span>0/1/1</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3]<strong> interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-GigabitEthernet<span>0/1/2</span>]<strong> port vlan-stacking vlan 7 to 8 stack-vlan 1000</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-GigabitEthernet<span>0/1/2</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3]<strong> interface gigabitethernet <span>0/1/3</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-GigabitEthernet<span>0/1/3</span>]<strong> port trunk allow-pass vlan 1 to 1000</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-GigabitEthernet<span>0/1/3</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE3-GigabitEthernet<span>0/1/3</span>]<strong> quit</strong></pre>
</li></ol>
</p></li><li><span>Configure an IGP on the MPLS backbone network. In this example, Intermediate System to Intermediate System (IS-IS) is used.</span><p><p>Configure IP addresses for interfaces on the UPE and PE-AGG. Enable IS-IS on the loopback interfaces of these devices.</p>
<p># Configure the UPE.</p>
<pre class="screen">&lt;<span class="keyword">*</span><span class="keyword">HUAWEI</span>&gt;<strong> system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>]<strong> sysname UPE</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE]<strong> isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-isis-1]<strong> is-level level-2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-isis-1]<strong> network-entity 49.0010.0100.1009.00</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-isis-1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-LoopBack1]<strong> ip address 1.1.1.9 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-LoopBack1]<strong> isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-LoopBack1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE]<strong> interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/2</span>]<strong> ip address 10.1.1.1 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/2</span>]<strong> isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/2</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE-GigabitEthernet<span>0/1/2</span>]<strong> quit</strong></pre>
<p># Configure the PE-AGG.</p>
<pre class="screen">&lt;<span class="keyword">*</span><span class="keyword">HUAWEI</span>&gt;<strong> system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>]<strong> sysname PE-AGG</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-AGG]<strong> isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-AGG-isis-1]<strong> is-level level-2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-AGG-isis-1]<strong> network-entity 49.0020.0200.1009.00</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-AGG-isis-1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-AGG]<strong> interface LoopBack 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-AGG-LoopBack1]<strong> ip address 2.2.2.9 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-AGG-LoopBack1]<strong> isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-AGG-LoopBack1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-AGG]<strong> interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-AGG-GigabitEthernet<span>0/1/1</span>]<strong> ip address 10.1.1.2 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-AGG-GigabitEthernet<span>0/1/1</span>]<strong> isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-AGG-GigabitEthernet<span>0/1/1</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-AGG-GigabitEthernet<span>0/1/1</span>]<strong> quit</strong></pre>
<p>After the configurations are complete, IS-IS discovers IP routes to Loopback 1 of the UPE and PE-AGG, and the two devices can ping each other.</p>
<p>The command output on the UPE is provided as an example.</p>
<pre class="screen">&lt;UPE&gt; <strong>display ip routing-table</strong></pre>
<pre class="screen"><span class="keyword">Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route</span>
------------------------------------------------------------------------------
Routing Table: Public
         Destinations : 9       Routes : 9

Destination/Mask    Proto    Pre  Cost   Flags NextHop         Interface

        1.1.1.9/32  Direct   0    0      D   127.0.0.1       LoopBack1
        2.2.2.9/32  <strong>ISIS-L2  15</strong>   10     D   10.1.1.2        GigabitEthernet<span>0/1/1</span>
       10.1.1.0/24  Direct   0    0      D   10.1.1.1        GigabitEthernet<span>0/1/2</span>
       10.1.1.1/32  Direct   0    0      D   127.0.0.1       GigabitEthernet<span>0/1/2</span>
     10.1.1.255/32  Direct   0    0      D   127.0.0.1       GigabitEthernet<span>0/1/2</span>
       127.0.0.0/8  Direct   0    0      D   127.0.0.1       InLoopBack0
      127.0.0.1/32  Direct   0    0      D   127.0.0.1       InLoopBack0
127.255.255.255/32  Direct   0    0      D   127.0.0.1       InLoopBack0
255.255.255.255/32  Direct   0    0      D   127.0.0.1       InLoopBack0  </pre>
</p></li><li><span>Enable basic MPLS functions and LDP on the MPLS backbone network.</span><p><p># Configure the UPE.</p>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>mpls lsr-id 1.1.1.9 </strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/2</span>]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/2</span>]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/2</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE-GigabitEthernet<span>0/1/2</span>]<strong> quit</strong></pre>
<p># Configure the PE-AGG.</p>
<pre class="screen">[<span class="keyword">*</span>PE-AGG] <strong>mpls lsr-id 2.2.2.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-AGG] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-AGG] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-AGG-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-AGG] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-AGG-GigabitEthernet<span>0/1/1</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-AGG-GigabitEthernet<span>0/1/1</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-AGG-GigabitEthernet<span>0/1/1</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-AGG-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<p>After the configurations are complete, an LDP session is established between the UPE and PE-AGG. The <a href="cmdqueryname=display+mpls+ldp+session"><b><span class="cmdname">display mpls ldp session</span></b></a> command output shows that the Status field is <strong>Operational</strong>.</p>
<p>The command output on the UPE is provided as an example.</p>
<pre class="screen">&lt;UPE&gt; <strong>display mpls ldp session</strong></pre>
<pre class="screen">LDP Session(s) in Public Network
 Codes: LAM(Label Advertisement Mode), SsnAge Unit(DDDD:HH:MM)
 <span> An asterisk (*) before a session means the session is being deleted.</span>
 ------------------------------------------------------------------------------
 PeerID             Status      LAM  SsnRole  SsnAge      KASent/Rcv
 ------------------------------------------------------------------------------
 2.2.2.9:0          Operational DU   Passive  0000:20:19  4880/4880
 ------------------------------------------------------------------------------
 TOTAL: 1 session(s) Found.</pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>If the UPE and PE-AGG are not directly connected, run the <a href="cmdqueryname=mpls+ldp+remote-peer"><b><span class="cmdname">mpls ldp remote-peer</span></b></a> and <a href="cmdqueryname=remote-ip"><b><span class="cmdname">remote-ip</span></b></a> commands on these devices to establish a remote LDP session between them.</p>
</div></div>
</p></li><li><span>Enable MPLS L2VPN on the UPE and PE-AGG.</span><p><p># Configure the UPE.</p>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>mpls l2vpn</strong></pre>
<p># Configure the PE-AGG.</p>
<pre class="screen">[<span class="keyword">*</span>PE-AGG] <strong>mpls l2vpn</strong></pre>
</p></li><li><span>Create VSIs and specify LDP as the signaling protocol of VSIs.</span><p><p># Configure the UPE.</p>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>vsi ldp1 static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vsi-ldp1] <strong>pwsignal ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vsi-ldp1-ldp] <strong>vsi-id 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vsi-ldp1-ldp] <strong>peer 2.2.2.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vsi-ldp1-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vsi-ldp1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>vsi ldp2 static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vsi-ldp2] <strong>pwsignal ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vsi-ldp2-ldp] <strong>vsi-id 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vsi-ldp2-ldp] <strong>peer 2.2.2.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vsi-ldp2-ldp] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE-vsi-ldp2-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vsi-ldp2] <strong>quit</strong></pre>
<p># Configure the PE-AGG.</p>
<pre class="screen">[<span class="keyword">*</span>PE-AGG] <strong>vsi ldp1 static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-AGG-vsi-ldp1] <strong>pwsignal ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-AGG-vsi-ldp1-ldp] <strong>vsi-id 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-AGG-vsi-ldp1-ldp] <strong>peer 1.1.1.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-AGG-vsi-ldp1-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-AGG-vsi-ldp1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-AGG] <strong>vsi ldp2 static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-AGG-vsi-ldp2] <strong>pwsignal ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-AGG-vsi-ldp2-ldp] <strong>vsi-id 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-AGG-vsi-ldp2-ldp] <strong>peer 1.1.1.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-AGG-vsi-ldp2-ldp] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-AGG-vsi-ldp2-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-AGG-vsi-ldp12] <strong>quit</strong></pre>
</p></li><li><span>Configure VLAN tag swapping on AC interfaces on the UPE, configure QinQ VLAN tag termination sub-interfaces on the UPE and PE-AGG, and bind the VSIs to the AC sub-interfaces on the UPE and PE-AGG.</span><p><p># Configure the UPE.</p>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/1</span>] <strong>vlan-swap enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>interface gigabitethernet <span>0/1/1</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/1</span>.1] <strong>control-vid 1 qinq-termination</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/1</span>.1] <strong>qinq termination l2 symmetry</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/1</span>.1] <strong>qinq termination pe-vid 7 ce-vid 1 to 1000</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/1</span>.1] <strong>l2 binding vsi ldp1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/1</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>interface gigabitethernet <span>0/1/1</span>.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/1</span>.2] <strong>control-vid 2 qinq-termination</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/1</span>.2] <strong>qinq termination pe-vid 8 ce-vid 1 to 1000</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/1</span>.2] <strong>l2 binding vsi ldp2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/1</span>.2] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE-GigabitEthernet<span>0/1/1</span>.2] <strong>quit</strong></pre>
<p># Configure the PE-AGG.</p>
<pre class="screen">[<span class="keyword">*</span>PE-AGG] <strong>interface gigabitethernet <span>0/1/2</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-AGG-GigabitEthernet<span>0/1/2</span>.1] <strong>control-vid 1 qinq-termination</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-AGG-GigabitEthernet<span>0/1/2</span>.1] <strong>qinq termination l2 symmetry</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-AGG-GigabitEthernet<span>0/1/2</span>.1] <strong>qinq termination pe-vid 7 ce-vid 1 to 1000</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-AGG-GigabitEthernet<span>0/1/2</span>.1] <strong>l2 binding vsi ldp1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-AGG-GigabitEthernet<span>0/1/2</span>.1] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-AGG-GigabitEthernet<span>0/1/2</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-AGG] <strong>interface gigabitethernet <span>0/1/2</span>.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-AGG-GigabitEthernet<span>0/1/2</span>.2] <strong>control-vid 2 qinq-termination</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-AGG-GigabitEthernet<span>0/1/2</span>.2] <strong>qinq termination pe-vid 8 ce-vid 1 to 1000</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-AGG-GigabitEthernet<span>0/1/2</span>.2] <strong>l2 binding vsi ldp2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-AGG-GigabitEthernet<span>0/1/2</span>.2] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-AGG-GigabitEthernet<span>0/1/2</span>.2] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-AGG-GigabitEthernet<span>0/1/2</span>.2] <strong>quit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>When you run the <a href="cmdqueryname=qinq+termination"><b><span class="cmdname">qinq termination</span></b></a> command on sub-interfaces of the same interface and specify the same <strong>pe-vid</strong> value on the sub-interfaces, the <strong>ce-vid</strong> value ranges must be different.</p>
</div></div>
<p>After the configurations are complete, run the <a href="cmdqueryname=display+vsi+name+ldp1+verbose"><b><span class="cmdname">display vsi name ldp1 verbose</span></b></a> command on the UPE. The command output shows that a PW has been established between the VSI named <strong>ldp1</strong> and the PE-AGG and that VSI is Up.</p>
<pre class="screen">[UPE] <strong>display vsi name ldp1 verbose</strong></pre>
<pre class="screen">***VSI Name               : ldp1
    Administrator VSI      : no
    Isolate Spoken         : disable
    VSI Index              : 0
    PW Signaling           : ldp
    Member Discovery Style : static
<span>    Bridge-domain Mode     : disable</span>
    PW MAC Learn Style     : unqualify
    Encapsulation Type     : vlan
    MTU                    : 1500
    Diffserv Mode          : uniform
    Service Class          : --
    Color                  : --
    DomainId               : 255
    Domain Name            :
    Ignore AcState         : disable
    Flow Label             : disable
    Create Time            : 0 days, 20 hours, 41 minutes, 53 seconds
    VSI State              : <strong>up</strong>
    Resource Status        : <strong>Valid</strong>

    VSI ID                 : 1
   *Peer Router ID         : 2.2.2.9
    VC Label               : 211968
    Peer Type              : dynamic
    Session                : up
    Tunnel ID              : 0x90014010
    Broadcast Tunnel ID    : 0x90014010
    Broad BackupTunnel ID  : 0x0
    CKey                   : 11
    NKey                   : 10
    StpEnable              : 0
    PwIndex                : 0
<span>    Control Word           : disable</span>

    Interface Name         : GigabitEthernet<span>0/1/1</span>.1
    State                  : up
    Last Up Time           : 2010/01/07 13:54:52
    Total Up Time          : 0 days, 3 hours, 6 minutes, 23 seconds

   **PW Information:

   *Peer Ip Address        : 2.2.2.9
    PW State               : <strong>up</strong>
    Local VC Label         : 211968
    Remote VC Label        : 294912
<span>    Remote Control Word    : disable</span>
    PW Type                : label
    Tunnel ID              : 0x90014010
    Broadcast Tunnel ID    : 0x90014010
    Broad BackupTunnel ID  : 0x0
    Ckey                   : 0xb
    Nkey                   : 0xa
    Main PW Token          : 0x90014010
    Slave PW Token         : 0x0
    Tnl Type               : LSP
    OutInterface           : GigabitEthernet<span>0/1/2</span>
    Backup OutInterface    :
    Stp Enable             : 0
    Mac Flapping           : 0
    Flow Label             : disable
    PW Last Up Time        : 2010/01/07 14:09:29
    PW Total Up Time       : 0 days, 20 hours, 22 minutes, 2 seconds </pre>
</p></li><li><span>Enable IGMP snooping on the UPE and PE-AGG, configure the PW on the UPE as a static router interface, and configure a querier on the PE-AGG. Use default values for parameters of the querier.</span><p><p># Configure the UPE.</p>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>igmp-snooping enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>vsi ldp2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vsi-ldp2] <strong>igmp-snooping enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vsi-ldp2] <strong>igmp-snooping version 3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vsi-ldp2] <strong>igmp-snooping static-router-port remote-peer 2.2.2.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vsi-ldp2] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE-vsi-ldp2] <strong>quit</strong></pre>
<p># Configure the PE-AGG.</p>
<pre class="screen">[<span class="keyword">*</span>PE-AGG] <strong>igmp-snooping enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-AGG] <strong>vsi ldp2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-AGG-vsi-ldp2] <strong>igmp-snooping enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-AGG-vsi-ldp2] <strong>igmp-snooping version 3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-AGG-vsi-ldp2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-AGG] <strong>igmp-snooping send-query enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-AGG] <strong>vsi ldp2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-AGG-vsi-ldp2] <strong>igmp-snooping querier enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-AGG-vsi-ldp2] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-AGG-vsi-ldp2] <strong>quit</strong></pre>
<p>Run the <strong>display igmp-snooping querier vsi</strong> command on the PE-AGG to check whether the querier is configured. If the command output shows <strong>Enable</strong>, the querier is enabled for VSI <strong>ldp2</strong>.</p>
<pre class="screen">&lt;PE-AGG&gt; <strong>display igmp-snooping querier vsi ldp2</strong></pre>
<pre class="screen">VSI                             Querier-state Querier
---------------------------------------------------------------
ldp2                             <strong>Enable</strong>       192.168.0.1</pre>
<p>Run the <strong>display igmp-snooping router-port vsi</strong> command on the UPE to check whether the static router interface is configured. If the command output shows <strong>STATIC</strong>, the PW (2.2.2.9/2) interface is a static router interface.</p>
<pre class="screen">&lt;UPE&gt; <strong>display igmp-snooping router-port vsi ldp2</strong></pre>
<pre class="screen">Port Name                       UpTime        Expires       Flags
 ---------------------------------------------------------------------
 VSI ldp2, 1 router-port(s)
 PW(2.2.2.9/2)                   01:18:10      --            <strong>STATIC</strong> | DYNAMIC </pre>
</p></li><li><span>Verify the configuration.</span><p><p>Run the <a href="cmdqueryname=display+qinq+information+termination+interface"><b><span class="cmdname">display qinq information termination interface</span></b></a> command to view information about QinQ VLAN tag termination sub-interfaces.</p>
<p>The command output on the UPE is provided as an example.</p>
<pre class="screen">&lt;UPE&gt; <strong>display qinq information termination interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">GigabitEthernet<span>0/1/1</span>.1
    VSI bound
    qinq termination l2 symmetry
    Total QinQ Num: 1
      qinq termination pe-vid 7 ce-vid 1
    Total vlan-group Num: 0
    control-vid 1 qinq-termination
    vlan-swap enable
GigabitEthernet<span>0/1/1</span>.2
    VSI bound
    Total QinQ Num: 1
      qinq termination pe-vid 7 ce-vid 1
    Total vlan-group Num: 0
    control-vid 1 qinq-termination
    vlan-swap enable</pre>
<div class="p">After a member joins a multicast group, run the <a href="cmdqueryname=display+igmp-snooping+port-info"><b><span class="cmdname">display igmp-snooping port-info</span></b></a> command on the UPE to view information about the Layer 2 multicast interface.<pre class="screen">&lt;UPE&gt; <strong>display igmp-snooping port-info</strong></pre>
<pre class="screen"> -----------------------------------------------------------------------------------
  Flag: S:Static     D:Dynamic     M:Ssm-mapping
        A:Active     P:Protocol    F:Fast-channel                                
                    (Source, Group)  Port                                      Flag
 -----------------------------------------------------------------------
 VSI ldp2, 1 Entry(s)
                (1.1.1.1, 234.1.1.1)  GE<span>0/1/1</span>.2(PE:8/CE:1000)       -D-
                                                    1 port(s)
 -----------------------------------------------------------------------</pre>
</div>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172363295__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>CE1 configuration file</p>
<pre class="screen">#</pre>
<pre class="screen"> sysname CE1</pre>
<pre class="screen">#</pre>
<pre class="screen"> vlan batch 7 to 8</pre>
<pre class="screen">#</pre>
<pre class="screen"> interface gigabitethernet <span>0/1/1</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> portswitch</pre>
<pre class="screen"> port default vlan 7</pre>
<pre class="screen">#</pre>
<pre class="screen"> interface gigabitethernet <span>0/1/2</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> portswitch</pre>
<pre class="screen"> port default vlan 7</pre>
<pre class="screen">#</pre>
<pre class="screen"> interface gigabitethernet <span>0/1/3</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> portswitch</pre>
<pre class="screen"> port default vlan 8</pre>
<pre class="screen">#</pre>
<pre class="screen"> interface gigabitethernet <span>0/1/4</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> portswitch</pre>
<pre class="screen"> port trunk allow-pass vlan 7 to 8</pre>
<pre class="screen">#</pre>
<pre class="screen"> return</pre>
</li><li><p>CE2 configuration file</p>
<pre class="screen">#</pre>
<pre class="screen"> sysname CE2</pre>
<pre class="screen">#</pre>
<pre class="screen"> vlan batch 7 to 8</pre>
<pre class="screen">#</pre>
<pre class="screen"> interface gigabitethernet <span>0/1/1</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> portswitch</pre>
<pre class="screen"> port default vlan 7</pre>
<pre class="screen">#</pre>
<pre class="screen"> interface gigabitethernet <span>0/1/2</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> portswitch</pre>
<pre class="screen"> port default vlan 7</pre>
<pre class="screen">#</pre>
<pre class="screen"> interface gigabitethernet <span>0/1/3</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> portswitch</pre>
<pre class="screen"> port default vlan 8</pre>
<pre class="screen">#</pre>
<pre class="screen"> interface gigabitethernet <span>0/1/4</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> portswitch</pre>
<pre class="screen"> port trunk allow-pass vlan 7 to 8</pre>
<pre class="screen">#</pre>
<pre class="screen"> return</pre>
</li><li><p>CE3 configuration file</p>
<pre class="screen">#</pre>
<pre class="screen"> sysname CE3</pre>
<pre class="screen">#</pre>
<pre class="screen"> vlan batch 1 to 1000</pre>
<pre class="screen">#</pre>
<pre class="screen"> interface gigabitethernet <span>0/1/1</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> portswitch</pre>
<pre class="screen"> port vlan-stacking vlan 7 to 8 stack-vlan 1</pre>
<pre class="screen">#</pre>
<pre class="screen"> interface gigabitethernet <span>0/1/2</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> portswitch</pre>
<pre class="screen"> port vlan-stacking vlan 7 to 8 stack-vlan 1000</pre>
<pre class="screen">#</pre>
<pre class="screen"> interface gigabitethernet <span>0/1/3</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> portswitch</pre>
<pre class="screen"> port trunk allow-pass vlan 1 to 1000</pre>
<pre class="screen">#</pre>
<pre class="screen"> return</pre>
</li><li><p>UPE configuration file</p>
<pre class="screen">#</pre>
<pre class="screen"> sysname UPE</pre>
<pre class="screen">#</pre>
<pre class="screen"> igmp-snooping enable</pre>
<pre class="screen">#</pre>
<pre class="screen"> mpls lsr-id 1.1.1.9</pre>
<pre class="screen"> mpls</pre>
<pre class="screen">#</pre>
<pre class="screen"> mpls l2vpn</pre>
<pre class="screen">#</pre>
<pre class="screen"> vsi ldp1 static</pre>
<pre class="screen">  pwsignal ldp</pre>
<pre class="screen">   vsi-id 1</pre>
<pre class="screen">   peer 2.2.2.9</pre>
<pre class="screen">#</pre>
<pre class="screen"> vsi ldp2 static</pre>
<pre class="screen">  pwsignal ldp</pre>
<pre class="screen">   vsi-id 2</pre>
<pre class="screen">   peer 2.2.2.9</pre>
<pre class="screen">  admin-vsi</pre>
<pre class="screen">   igmp-snooping enable</pre>
<pre class="screen">   igmp-snooping version 3</pre>
<pre class="screen">   igmp-snooping static-router-port remote-peer 2.2.2.9</pre>
<pre class="screen">#</pre>
<pre class="screen"> mpls ldp</pre>
<pre class="screen">#</pre>
<pre class="screen"> isis 1</pre>
<pre class="screen">  is-level level-2</pre>
<pre class="screen">  network-entity 49.0010.0100.1009.00</pre>
<pre class="screen">#</pre>
<pre class="screen"> interface GigabitEthernet<span>0/1/1</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen">#</pre>
<pre class="screen"> interface GigabitEthernet<span>0/1/1</span>.1</pre>
<pre class="screen"> encapsulation qinq-termination</pre>
<pre class="screen"> vlan-swap enable</pre>
<pre class="screen"> qinq termination l2 symmetry</pre>
<pre class="screen"> qinq termination pe-vid 7 ce-vid 1 to 1000</pre>
<pre class="screen"> l2 binding vsi ldp1</pre>
<pre class="screen">#</pre>
<pre class="screen"> interface GigabitEthernet<span>0/1/1</span>.2</pre>
<pre class="screen"> encapsulation qinq-termination</pre>
<pre class="screen"> vlan-swap enable</pre>
<pre class="screen"> qinq termination pe-vid 8 ce-vid 1 to 1000</pre>
<pre class="screen"> l2 binding vsi ldp2</pre>
<pre class="screen">#</pre>
<pre class="screen"> interface GigabitEthernet<span>0/1/2</span></pre>
<pre class="screen">  undo shutdown</pre>
<pre class="screen">  ip address 10.1.1.1 255.255.255.252</pre>
<pre class="screen">  isis enable 1 </pre>
<pre class="screen">  mpls</pre>
<pre class="screen">  mpls ldp</pre>
<pre class="screen">#</pre>
<pre class="screen"> interface LoopBack1</pre>
<pre class="screen">  ip address 1.1.1.9 255.255.255.255</pre>
<pre class="screen">  isis enable 1</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p>PE-AGG configuration file</p>
<pre class="screen">#</pre>
<pre class="screen"> sysname PE-AGG</pre>
<pre class="screen">#</pre>
<pre class="screen"> igmp-snooping enable</pre>
<pre class="screen"> igmp-snooping send-query enable</pre>
<pre class="screen">#</pre>
<pre class="screen"> mpls lsr-id 2.2.2.9</pre>
<pre class="screen"> mpls</pre>
<pre class="screen">#</pre>
<pre class="screen"> mpls l2vpn</pre>
<pre class="screen">#</pre>
<pre class="screen"> vsi ldp1 static</pre>
<pre class="screen">  pwsignal ldp</pre>
<pre class="screen">   vsi-id 1</pre>
<pre class="screen">   peer 1.1.1.9</pre>
<pre class="screen">#</pre>
<pre class="screen"> vsi ldp2 static</pre>
<pre class="screen">  pwsignal ldp</pre>
<pre class="screen">   vsi-id 2</pre>
<pre class="screen">   peer 1.1.1.9</pre>
<pre class="screen">   igmp-snooping enable</pre>
<pre class="screen">   igmp-snooping version 3</pre>
<pre class="screen">   igmp-snooping querier enable</pre>
<pre class="screen">#</pre>
<pre class="screen"> mpls ldp</pre>
<pre class="screen">#</pre>
<pre class="screen"> isis 1</pre>
<pre class="screen">  is-level level-2</pre>
<pre class="screen">  network-entity 49.0020.0200.1009.00</pre>
<pre class="screen">#</pre>
<pre class="screen"> interface GigabitEthernet<span>0/1/1</span></pre>
<pre class="screen">  undo shutdown</pre>
<pre class="screen">  ip address 10.1.1.2 255.255.255.252</pre>
<pre class="screen">  isis enable 1</pre>
<pre class="screen">  mpls</pre>
<pre class="screen">  mpls ldp</pre>
<pre class="screen">#</pre>
<pre class="screen"> interface GigabitEthernet<span>0/1/2</span></pre>
<pre class="screen">  undo shutdown</pre>
<pre class="screen">#</pre>
<pre class="screen"> interface GigabitEthernet<span>0/1/2</span>.1</pre>
<pre class="screen">  encapsulation qinq-termination</pre>
<pre class="screen">  qinq termination l2 symmetry</pre>
<pre class="screen">  qinq termination pe-vid 7 ce-vid 1 to 1000</pre>
<pre class="screen">  l2 binding vsi ldp1</pre>
<pre class="screen">#</pre>
<pre class="screen"> interface GigabitEthernet<span>0/1/2</span>.2</pre>
<pre class="screen">  encapsulation qinq-termination</pre>
<pre class="screen">  qinq termination pe-vid 8 ce-vid 1 to 1000</pre>
<pre class="screen">  l2 binding vsi ldp2</pre>
<pre class="screen">#</pre>
<pre class="screen"> interface LoopBack1</pre>
<pre class="screen">  ip address 2.2.2.9 255.255.255.255</pre>
<pre class="screen">  isis enable 1</pre>
<pre class="screen">#</pre>
<pre class="screen"> return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_qinq_cfg_0023_1.html">Configuration Examples for QinQ
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_qinq_cfg_0051_1.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_qinq_cfg_0026.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>