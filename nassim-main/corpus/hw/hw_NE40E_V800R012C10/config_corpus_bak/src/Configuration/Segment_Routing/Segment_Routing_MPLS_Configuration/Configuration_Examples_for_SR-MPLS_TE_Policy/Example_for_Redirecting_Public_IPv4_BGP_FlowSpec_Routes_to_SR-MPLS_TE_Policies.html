
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Redirecting Public IPv4 BGP FlowSpec Routes to SR-MPLS TE Policies">
<meta name="abstract" content="This section provides an example for redirecting public IPv4 BGP FlowSpec routes to SR-MPLS TE Policies to meet the steering requirements of different services.">
<meta name="description" content="This section provides an example for redirecting public IPv4 BGP FlowSpec routes to SR-MPLS TE Policies to meet the steering requirements of different services.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_sr_all_cfg_0099.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_sr_all_cfg_0100.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_sr_all_cfg_0403.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00604599,l00587852,w00606909,w00800033">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="Segment Routing MPLS">
<meta name="featuretype" content="Segment Routing">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="Segment Routing MPLS">
<meta name="featuretype" content="Segment Routing">
<meta name="featurename" content="Segment Routing MPLS">
<meta name="featuretype" content="Segment Routing">
<meta name="featurename" content="Segment Routing MPLS">
<meta name="featuretype" content="Segment Routing">
<meta name="OWNER" content="l00468467">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00468467">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0193987055">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Redirecting Public IPv4 BGP FlowSpec Routes to SR-MPLS TE Policies</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0193987055"></a><a name="EN-US_TASK_0193987055"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Redirecting Public IPv4 BGP FlowSpec Routes to SR-MPLS TE Policies</h1>
<div class="taskbody"><p>This section provides an example for redirecting public IPv4 BGP FlowSpec routes to SR-MPLS TE Policies to meet the steering requirements of different services.</p>
<div class="context"><a name="EN-US_TASK_0193987055__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>In traditional BGP FlowSpec-based traffic optimization, traffic transmitted over paths with the same source and destination nodes can be redirected to only one path, which does not achieve accurate traffic steering. With the function to redirect a public IPv4 BGP FlowSpec route to an SR-MPLS TE Policy, a device can redirect traffic transmitted over paths with the same source and destination nodes to different SR-MPLS TE Policies.</p>
<p>On the network shown in <a href="#EN-US_TASK_0193987055__fig_dc_vrp_sr_all_cfg_007701">Figure 1</a>, there are two SR-MPLS TE Policies in the direction from PE1 to PE2. PE2 is connected to two local networks (10.8.8.8/32 and 10.9.9.9/32). It is required that traffic destined for different networks be redirected to different SR-MPLS TE Policies.</p>
<div class="fignone" id="EN-US_TASK_0193987055__fig_dc_vrp_sr_all_cfg_007701"><a name="EN-US_TASK_0193987055__fig_dc_vrp_sr_all_cfg_007701"></a><a name="fig_dc_vrp_sr_all_cfg_007701"></a><span class="figcap"><b>Figure 1 </b>Networking for redirecting public IPv4 BGP FlowSpec routes to SR-MPLS TE Policies</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 and 2 in this example represent GE <span>0/1/0</span> and GE <span>0/2/0</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0194002313.png" width="NaN" height="NaN"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0193987055__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Precautions</h4><p>None</p>
</div></div>
<div class="context"><a name="EN-US_TASK_0193987055__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure IS-IS on the backbone network for the PEs to communicate.</p>
</li><li><p>Enable MPLS on the backbone network and configure SR and static adjacency labels.</p>
</li><li><p>Configure two SR-MPLS TE Policies from PE1 to PE2.</p>
</li><li>Configure static FlowSpec routes on PE1 and redirect the routes to the SR-MPLS TE Policies.</li><li>Configure a tunnel policy.</li><li><p>Establish a BGP FlowSpec peer relationship between the PEs.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0193987055__1.4.4"></a><a name="1.4.4"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>MPLS LSR IDs on the PEs and Ps</p>
</li><li><p>Adjacency labels on the PEs and Ps</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0193987055__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure interface IP addresses.</span><p><p># Configure PE1.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname PE1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack1] <strong>ip address 1.1.1.9 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>ip address 10.1.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> interface gigabitethernet<span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>ip address 10.3.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure P1.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname P1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P1] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-LoopBack1] <strong>ip address 2.2.2.9 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1]<strong> interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/1/0</span>] <strong>ip address 10.1.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1]<strong> interface gigabitethernet<span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/2/0</span>] <strong>ip address 10.2.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname PE2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-LoopBack1] <strong>ip address 3.3.3.9 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>]<strong> ip address 10.2.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> interface gigabitethernet<span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>]<strong> ip address 10.4.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> commit</strong></pre>
<p># Configure P2.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname P2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P2] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-LoopBack1] <strong>ip address 4.4.4.9 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2]<strong> interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/1/0</span>] <strong>ip address 10.3.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2]<strong> interface gigabitethernet<span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/2/0</span>] <strong>ip address 10.4.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2] <strong>commit</strong></pre>
</p></li><li><span>Configure an IGP on the backbone network for the PEs and Ps to communicate. IS-IS is used as an example.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>is-level level-1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>network-entity 10.0000.0000.0001.00</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack1] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> interface gigabitethernet<span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure P1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P1] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-isis-1] <strong>is-level level-1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-isis-1] <strong>network-entity 10.0000.0000.0002.00</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-LoopBack1] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1]<strong> interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/1/0</span>] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1]<strong> interface gigabitethernet<span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/2/0</span>] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1] <strong>is-level level-1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1] <strong>network-entity 10.0000.0000.0003.00</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-LoopBack1] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>]<strong> isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> interface gigabitethernet<span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>]<strong> isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> commit</strong></pre>
<p># Configure P2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P2] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-isis-1] <strong>is-level level-1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-isis-1] <strong>network-entity 10.0000.0000.0004.00</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-LoopBack1] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2]<strong> interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/1/0</span>] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2]<strong> interface gigabitethernet<span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/2/0</span>] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2] <strong>commit</strong></pre>
</p></li><li><span>Configure basic MPLS functions on the backbone network.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>mpls lsr-id 1.1.1.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-mpls] <strong>quit</strong></pre>
<p># Configure P1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P1] <strong>mpls lsr-id 2.2.2.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-mpls] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P1-mpls] <strong>quit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>mpls lsr-id 3.3.3.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-mpls]<strong> quit</strong></pre>
<p># Configure P2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P2] <strong>mpls lsr-id 4.4.4.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-mpls] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P2-mpls] <strong>quit</strong></pre>
</p></li><li><span>Configure Segment Routing on the backbone network.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>segment-routing</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing] <strong>ipv4 adjacency local-ip-addr 10.1.1.1 remote-ip-addr 10.1.1.2 sid <span>330</span>000</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing] <strong>ipv4 adjacency local-ip-addr 10.3.1.1 remote-ip-addr 10.3.1.2 sid <span>330</span>001</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>cost-style wide</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>traffic-eng level-1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>segment-routing mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure P1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P1] <strong>segment-routing</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-segment-routing] <strong>ipv4 adjacency local-ip-addr 10.1.1.2 remote-ip-addr 10.1.1.1 sid <span>330</span>003</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-segment-routing] <strong>ipv4 adjacency local-ip-addr 10.2.1.1 remote-ip-addr 10.2.1.2 sid <span>330</span>002</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-segment-routing] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-isis-1] <strong>cost-style wide</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-isis-1] <strong>traffic-eng level-1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-isis-1] <strong>segment-routing mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>segment-routing</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-segment-routing] <strong>ipv4 adjacency local-ip-addr 10.2.1.2 remote-ip-addr 10.2.1.1 sid <span>330</span>000</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-segment-routing] <strong>ipv4 adjacency local-ip-addr 10.4.1.2 remote-ip-addr 10.4.1.1 sid <span>330</span>001</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-segment-routing] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1] <strong>cost-style wide</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1] <strong>traffic-eng level-1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1] <strong>segment-routing mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure P2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P2] <strong>segment-routing</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-segment-routing] <strong>ipv4 adjacency local-ip-addr 10.3.1.2 remote-ip-addr 10.3.1.1 sid <span>330</span>002</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-segment-routing] <strong>ipv4 adjacency local-ip-addr 10.4.1.1 remote-ip-addr 10.4.1.2 sid <span>330</span>003</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-segment-routing] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-isis-1] <strong>cost-style wide</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-isis-1] <strong>traffic-eng level-1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-isis-1] <strong>segment-routing mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2] <strong>commit</strong></pre>
</p></li><li><span>Configure SR-MPLS TE Policies.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>segment-routing</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-segment-routing] <strong>segment-list pe1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing-segment-list<span>-pe1</span>] <strong>index 10 sid label <span>330</span>000</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing-segment-list<span>-pe1</span>] <strong>index 20 sid label <span>330</span>002</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing-segment-list<span>-pe1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing] <strong>segment-list pe1backup</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing-segment-list<span>-pe1backup</span>] <strong>index 10 sid label <span>330</span>001</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing-segment-list<span>-pe1backup</span>] <strong>index 20 sid label <span>330</span>003</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing-segment-list<span>-pe1backup</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing] <strong>sr-te policy policy100</strong> <strong>endpoint 3.3.3.9 color 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing-te-policy<span>-policy100</span>] <strong>binding-sid 115</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing-te-policy<span>-policy100</span>] <strong>mtu 1000</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing-te-policy<span>-policy100</span>] <strong>candidate-path preference 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing-te-policy<span>-policy100</span>-path] <strong>segment-list pe1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing-te-policy<span>-policy100</span>-path] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing-te-policy<span>-policy100</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing] <strong>sr-te policy policy200</strong> <strong>endpoint 3.3.3.9 color 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing-te-policy<span>-policy200</span>] <strong>binding-sid 125</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing-te-policy<span>-policy200</span>] <strong>mtu 1000</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing-te-policy<span>-policy200</span>] <strong>candidate-path preference 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing-te-policy<span>-policy200</span>-path] <strong>segment-list pe1</strong><strong>backup</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing-te-policy<span>-policy200</span>-path] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing-te-policy<span>-policy200</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p>After the configuration is complete, you can run the <a href="cmdqueryname=display+sr-te+policy"><b><span class="cmdname">display sr-te policy</span></b></a> command to check SR-MPLS TE Policy information.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display sr-te policy</strong>
PolicyName : policy100
Endpoint             : 3.3.3.9              Color                : 100
TunnelId             : 8193                 TunnelType           : SR-TE Policy
Binding SID          : 115                  MTU                  : 1000
Policy State         : Up                   State Change Time    : 2020-05-16 10:18:16
Admin State          : UP                   Traffic Statistics   : Disable
BFD                  : Disable              Backup Hot-Standby   : Disable
DiffServ-Mode        : -
Active IGP Metric    : -
Candidate-path Count : 1                   

Candidate-path Preference: 200
Path State           : Active               Path Type            : Primary
Protocol-Origin      : Configuration(30)    Originator           : 0, 0.0.0.0
Discriminator        : 200                  Binding SID          : 115
GroupId              : 8193                 Policy Name          : policy100
Template ID          : -   
Active IGP Metric    : -                              ODN Color            : -
Metric               :
 IGP Metric          : -                              TE Metric            : -
 Delay Metric        : -                              Hop Counts           : -
Segment-List Count   : 1
 Segment-List        : pe1
  Segment-List ID    : 32771                XcIndex              : 2032771
  List State         : Up                   BFD State            : -
  EXP                : -                    TTL                  : -
  DeleteTimerRemain  : -<span>                    Weight               : 1</span>
  Label : <span>330</span>000, <span>330</span>002

PolicyName : policy200
Endpoint             : 3.3.3.9              Color                : 200
TunnelId             : 8194                 TunnelType           : SR-TE Policy
Binding SID          : 125                  MTU                  : 1000
Policy State         : Up                   State Change Time    : 2020-05-16 10:20:32
Admin State          : Up                   Traffic Statistics   : Disable
BFD                  : Disable              Backup Hot-Standby   : Disable
DiffServ-Mode        : -
Active IGP Metric    : -
Candidate-path Count : 1                   

Candidate-path Preference: 200
Path State           : Active               Path Type            : Primary
Protocol-Origin      : Configuration(30)    Originator           : 0, 0.0.0.0
Discriminator        : 200                  Binding SID          : 125
GroupId              : 8194                 Policy Name          : policy200
Template ID          : -    
Active IGP Metric    : -                              ODN Color            : -
Metric               :
 IGP Metric          : -                              TE Metric            : -
 Delay Metric        : -                              Hop Counts           : -
Segment-List Count   : 1
 Segment-List        : pe1backup
  Segment-List ID    : 32833                XcIndex              : 2032833
  List State         : Up                   BFD State            : -
  EXP                : -                    TTL                  : -
  DeleteTimerRemain  : -<span>                    Weight               : 1</span>
  Label : <span>330</span>001, <span>330</span>003</pre>
</p></li><li><span>Establish a BGP peer relationship between the PEs and import local network routes to PE2.</span><p><p>In this example, loopback addresses 10.8.8.8/32 and 10.9.9.9/32 are used to simulate two local networks on PE2.</p>
</p><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 3.3.3.9 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 3.3.3.9 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp] <strong>quit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>interface loopback 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-LoopBack2] <strong>ip address 10.8.8.8 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-LoopBack2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface loopback 3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-LoopBack3] <strong>ip address 10.9.9.9 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-LoopBack3] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>peer 1.1.1.9 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>peer 1.1.1.9 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>network 10.8.8.8 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>network 10.9.9.9 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-bgp] <strong>quit</strong></pre>
<p>After the configuration is complete, run the <strong>display bgp peer</strong> command on the PEs and check whether a BGP peer relationship has been established between the PEs. If the <strong>Established</strong> state is displayed in the command output, the BGP peer relationship has been established successfully. The following example uses the command output on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display bgp peer</strong>

 BGP local router ID : 1.1.1.9
 Local AS number : 100
 Total number of peers : 1                 Peers in established state : 1

  Peer            V          AS  MsgRcvd  MsgSent  OutQ  Up/Down       State  PrefRcv
  3.3.3.9         4         100      201      202     0 02:51:56 Established        2</pre>
</p></li><li><span>Establish a BGP FlowSpec peer relationship between the PEs.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> bgp 100</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp] <strong>ipv4-family flow</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-ipv4-flow] <strong>peer 3.3.3.9 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-ipv4-flow] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp-af-ipv4-flow] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp] <strong>quit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2]<strong> bgp 100</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-bgp] <strong>ipv4-family flow</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-ipv4-flow] <strong>peer 1.1.1.9 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-ipv4-flow] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-bgp-af-ipv4-flow] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-bgp] <strong>quit</strong></pre>
<p>After the configuration is complete, run the <strong>display bgp flow peer</strong> command on the PEs and check whether a BGP FlowSpec peer relationship has been established between the PEs. If the <strong>Established</strong> state is displayed in the command output, the BGP FlowSpec peer relationship has been established successfully. The following example uses the command output on PE1.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE1] <strong>display bgp flow peer</strong> 

 BGP local router ID : 1.1.1.9
 Local AS number : 100
 Total number of peers : 1                 Peers in established state : 1

  Peer            V          AS  MsgRcvd  MsgSent  OutQ  Up/Down       State  PrefRcv
  3.3.3.9         4         100      208      209     0 02:58:16 Established        0</pre>
</p></li><li><span>Configure static BGP FlowSpec route redirection on PE1.</span><p><p>BGP FlowSpec route redirection is based on &lt;Redirection IP address, Color&gt;. If the redirection IP address and color attributes of a BGP FlowSpec route match the endpoint and color attributes of an SR-MPLS TE Policy, the route can be successfully redirected to the SR-MPLS TE Policy.</p>
<p>In this example, the traffic destined for 10.8.8.8/32 needs to be redirected to the SR-MPLS TE Policy named <strong>policy100</strong>, and the traffic destined for 10.9.9.9/32 needs to be redirected to the SR-MPLS TE Policy named <strong>policy200</strong>.</p>
<p># Configure PE1.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE1] <strong>flow-route PE1toPE2</strong>
[*PE1-flow-route] <strong>if-match destination 10.8.8.8 255.255.255.255</strong>
[*PE1-flow-route] <strong>apply redirect ip 3.3.3.9:0 color 0:100</strong>
[*PE1-flow-route] <strong>quit</strong>               
[*PE1] <strong>flow-route PE1toPE2b</strong>
[*PE1-flow-route] <strong>if-match destination 10.9.9.9 255.255.255.255</strong>
[*PE1-flow-route] <strong>apply redirect ip 3.3.3.9:0 color 0:200</strong>
[*PE1-flow-route] <strong>commit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>PE1-flow-route] <strong>quit</strong></pre>
</p></li><li><span>Configure a tunnel policy on each PE to preferentially select an SR-MPLS TE Policy.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>tunnel-policy p1</strong>
[<span class="keyword">*</span>PE1-tunnel-policy-p1] <strong>tunnel select-seq sr-te-policy load-balance-number 1 unmix</strong>
[<span class="keyword">*</span>PE1-tunnel-policy-p1] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>tunnel-selector p1 permit node 1</strong>
[<span class="keyword">*</span>PE1-tunnel-selector] <strong>apply tunnel-policy p1</strong>
[<span class="keyword">*</span>PE1-tunnel-selector]<strong> quit</strong>
[<span class="keyword">*</span>PE1]<strong> bgp 100</strong>
[<span class="keyword">*</span>PE1-bgp] <strong>ipv4-family flow</strong>
[<span class="keyword">*</span>PE1-bgp-af-ipv4-flow] <strong>redirect ip recursive-lookup tunnel tunnel-selector p1</strong>
[<span class="keyword">*</span>PE1-bgp-af-ipv4-flow] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp-af-ipv4-flow] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp] <strong>quit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p># Display BGP FlowSpec route information on PE1.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE1] <strong>display bgp flow routing-table</strong>
 BGP Local router ID is 1.1.1.9
 Status codes: * - valid, &gt; - best, d - damped, x - best external, a - add path,
               h - history,  i - internal, s - suppressed, S - Stale
               Origin : i - IGP, e - EGP, ? - incomplete
 RPKI validation codes: V - valid, I - invalid, N - not-found


 Total Number of Routes: 2
 * &gt;  ReIndex : <strong>24577</strong>
      Dissemination Rules:
       Destination IP : 10.8.8.8/32
       MED      : 0                   PrefVal  : 0                   
       LocalPref:                           
       Path/Ogn :  i
 * &gt;  ReIndex : <strong>24578</strong>
      Dissemination Rules:
       Destination IP : 10.9.9.9/32
       MED      : 0                   PrefVal  : 0                   
       LocalPref:                           
       Path/Ogn :  i</pre>
<p># Display the traffic redirection information carried in a single BGP FlowSpec route based on the <strong>ReIndex</strong> value shown in the preceding command output.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE1] <strong>display bgp flow routing-table 24577</strong>
 BGP local router ID : 1.1.1.9
 Local AS number : 100
 ReIndex : 24577
 Dissemination Rules :
   <strong>Destination IP : 10.8.8.8/32</strong>

 BGP flow-ipv4 routing table entry information of 24577:
 Local : PE1toPE2 
 Match action :
   <strong>apply redirect ip 3.3.3.9:0 color 0:100</strong>
 Route Duration: 0d03h10m19s
 AS-path Nil, origin igp, MED 0, pref-val 0, valid, local, best, pre 255
 Advertised to such 1 peers:
    3.3.3.9</pre>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE1] <strong>display bgp flow routing-table 24578</strong>
 BGP local router ID : 1.1.1.9
 Local AS number : 100
 ReIndex : 24578
 Dissemination Rules :
   <strong>Destination IP : 10.9.9.9/32</strong>

 BGP flow-ipv4 routing table entry information of 24578:
 Local : PE1toPE2b 
 Match action :
   <strong>apply redirect ip 3.3.3.9:0 color 0:200</strong>
 Route Duration: 0d03h11m39s
 AS-path Nil, origin igp, MED 0, pref-val 0, valid, local, best, pre 255
 Advertised to such 1 peers:
    3.3.3.9</pre>
<p># Inject test traffic to PE1 and enable SR-MPLS TE Policy traffic statistics collection. Then, run the <a href="cmdqueryname=display+sr-te+policy+traffic-statistics"><b><span class="cmdname">display sr-te policy traffic-statistics</span></b></a> [ <a href="cmdqueryname=endpoint"><b><span class="cmdname">endpoint</span></b></a> <i><span class="varname">ipv4-address</span></i> <strong><span>color</span></strong> <i><span class="varname">color-value</span></i> | <strong><span>policy-name</span></strong> <i><span class="varname">name-value</span></i> | <strong><span>binding-sid</span></strong> <i><span class="varname">binding-sid</span></i> ] command to check SR-MPLS TE Policy traffic statistics.</p>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0193987055__1.4.6"></a><a name="1.4.6"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>PE1 configuration file</p>
<pre class="screen">#
sysname PE1
#
mpls lsr-id 1.1.1.9
#               
mpls            
#               
segment-routing 
 ipv4 adjacency local-ip-addr 10.1.1.1 remote-ip-addr 10.1.1.2 sid <span>330</span>000
 ipv4 adjacency local-ip-addr 10.3.1.1 remote-ip-addr 10.3.1.2 sid <span>330</span>001
 segment-list pe1
  index 10 sid label <span>330</span>000
  index 20 sid label <span>330</span>002
 segment-list pe1backup
  index 10 sid label <span>330</span>001
  index 20 sid label <span>330</span>003
 sr-te policy policy100 endpoint 3.3.3.9 color 100
  binding-sid 115
  mtu 1000      
  candidate-path preference 200
   segment-list pe1
 sr-te policy policy200 endpoint 3.3.3.9 color 200
  binding-sid 125
  mtu 1000      
  candidate-path preference 200
   segment-list pe1backup
#               
isis 1          
 is-level level-1
 cost-style wide
 network-entity 10.0000.0000.0001.00
 traffic-eng level-1
 segment-routing mpls
#               
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown  
 ip address 10.1.1.1 255.255.255.0
 isis enable 1  
#               
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown  
 ip address 10.3.1.1 255.255.255.0
 isis enable 1  
#               
interface LoopBack1
 ip address 1.1.1.9 255.255.255.255
 isis enable 1
#               
bgp 100         
 peer 3.3.3.9 as-number 100
 peer 3.3.3.9 connect-interface LoopBack1
 #              
 ipv4-family unicast
  undo synchronization
  peer 3.3.3.9 enable
 #
 ipv4-family flow
  peer 3.3.3.9 enable
  redirect ip recursive-lookup tunnel tunnel-selector p1
#
flow-route PE1toPE2
 if-match destination 10.8.8.8 255.255.255.255
 apply redirect ip 3.3.3.9:0 color 0:100
#               
flow-route PE1toPE2b
 if-match destination 10.9.9.9 255.255.255.255
 apply redirect ip 3.3.3.9:0 color 0:200
#
tunnel-policy p1
 tunnel select-seq sr-te-policy load-balance-number 1 unmix
#
tunnel-selector p1 permit node 1
 apply tunnel-policy p1
#
return</pre>
</li><li><p>P1 configuration file</p>
<pre class="screen">#
sysname P1
#
mpls lsr-id 2.2.2.9
#               
mpls            
#               
segment-routing 
 ipv4 adjacency local-ip-addr 10.2.1.1 remote-ip-addr 10.2.1.2 sid <span>330</span>002
 ipv4 adjacency local-ip-addr 10.1.1.2 remote-ip-addr 10.1.1.1 sid <span>330</span>003
#               
isis 1          
 is-level level-1
 cost-style wide
 network-entity 10.0000.0000.0002.00
 traffic-eng level-1
 segment-routing mpls
#               
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown  
 ip address 10.1.1.2 255.255.255.0
 isis enable 1  
#               
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown  
 ip address 10.2.1.1 255.255.255.0
 isis enable 1  
#               
interface LoopBack1
 ip address 2.2.2.9 255.255.255.255
 isis enable 1  
#
return</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#
sysname PE2
#
mpls lsr-id 3.3.3.9
#               
mpls            
#               
segment-routing 
 ipv4 adjacency local-ip-addr 10.2.1.2 remote-ip-addr 10.2.1.1 sid <span>330</span>000
 ipv4 adjacency local-ip-addr 10.4.1.2 remote-ip-addr 10.4.1.1 sid <span>330</span>001
#               
isis 1          
 is-level level-1
 cost-style wide
 network-entity 10.0000.0000.0003.00
 traffic-eng level-1
 segment-routing mpls
#               
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown  
 ip address 10.2.1.2 255.255.255.0
 isis enable 1  
#               
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown  
 ip address 10.4.1.2 255.255.255.0
 isis enable 1 
#               
interface LoopBack1
 ip address 3.3.3.9 255.255.255.255
 isis enable 1  
#               
interface LoopBack2
 ip address 10.8.8.8 255.255.255.255
#               
interface LoopBack3
 ip address 10.9.9.9 255.255.255.255
#               
bgp 100         
 peer 1.1.1.9 as-number 100
 peer 1.1.1.9 connect-interface LoopBack1
 #              
 ipv4-family unicast
  undo synchronization
  network 10.8.8.8 255.255.255.255
  network 10.9.9.9 255.255.255.255
  peer 1.1.1.9 enable
 #
 ipv4-family flow
  peer 1.1.1.9 enable
#
return</pre>
</li><li><p>P2 configuration file</p>
<pre class="screen">#
sysname P2
#
mpls lsr-id 4.4.4.9
#               
mpls            
#               
segment-routing 
 ipv4 adjacency local-ip-addr 10.3.1.2 remote-ip-addr 10.3.1.1 sid <span>330</span>002
 ipv4 adjacency local-ip-addr 10.4.1.1 remote-ip-addr 10.4.1.2 sid <span>330</span>003
#               
isis 1          
 is-level level-1
 cost-style wide
 network-entity 10.0000.0000.0004.00
 traffic-eng level-1
 segment-routing mpls
#               
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown  
 ip address 10.3.1.2 255.255.255.0
 isis enable 1  
#               
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown  
 ip address 10.4.1.1 255.255.255.0
 isis enable 1  
#               
interface LoopBack1
 ip address 4.4.4.9 255.255.255.255
 isis enable 1  
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_sr_all_cfg_0099.html">Configuration Examples for SR-MPLS TE Policy
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_sr_all_cfg_0100.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_sr_all_cfg_0403.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>