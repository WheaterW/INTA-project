
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Creating an SR-MPLS TE Policy in ODN Mode">
<meta name="abstract" content="This section provides an example for creating an SR-MPLS TE Policy in ODN mode to better meet service requirements.">
<meta name="description" content="This section provides an example for creating an SR-MPLS TE Policy in ODN mode to better meet service requirements.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_sr_all_cfg_0099.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_sr_all_cfg_0112.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_sr_all_cfg_0406.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00606909,l00587852">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="Segment Routing MPLS">
<meta name="featuretype" content="Segment Routing">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="Segment Routing MPLS">
<meta name="featuretype" content="Segment Routing">
<meta name="featurename" content="Segment Routing MPLS">
<meta name="featuretype" content="Segment Routing">
<meta name="featurename" content="Segment Routing MPLS">
<meta name="featuretype" content="Segment Routing">
<meta name="OWNER" content="l00468467">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00468467">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001530204385">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Creating an SR-MPLS TE Policy in ODN Mode</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001530204385"></a><a name="EN-US_TASK_0000001530204385"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Creating an SR-MPLS TE Policy in ODN Mode</h1>
<div class="taskbody"><p>This section provides an example for creating an SR-MPLS TE Policy in ODN mode to better meet service requirements.</p>
<div class="context"><a name="EN-US_TASK_0000001530204385__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><div class="p">On the network shown in <a href="#EN-US_TASK_0000001530204385__fig_dc_vrp_sr_all_cfg_008301">Figure 1</a>:<ul><li><p>CE1 and CE2 belong to a VPN instance named <strong>vpna</strong>.</p>
</li><li><p>The VPN target used by <strong>vpna</strong> is 111:1.</p>
</li></ul>
</div>
<p>Configure EVPN L3VPN services to recurse to SR-MPLS TE Policies to ensure secure communication between users in the same VPN. Because multiple links exist between PEs on the public network, other links must be able to provide protection for the primary link.</p>
<p>In traditional scenarios where traffic is steered into SR-MPLS TE Policies based on colors, the SR-MPLS TE Policies must be configured in advance. This may fail to meet diversified service requirements. The on-demand next hop (ODN) function does not require a large number of SR-MPLS TE Policies to be configured in advance. Instead, it enables SR-MPLS TE Policy creation to be dynamically triggered on demand based on service routes, simplifying network operations. During SR-MPLS TE Policy creation, you can select a pre-configured attribute template and constraint template to ensure that the to-be-created SR-MPLS TE Policy meets service requirements.</p>
<div class="fignone" id="EN-US_TASK_0000001530204385__fig_dc_vrp_sr_all_cfg_008301"><a name="EN-US_TASK_0000001530204385__fig_dc_vrp_sr_all_cfg_008301"></a><a name="fig_dc_vrp_sr_all_cfg_008301"></a><span class="figcap"><b>Figure 1 </b>Creating an SR-MPLS TE Policy in ODN mode</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 through 4 in this example represent GE<span>0/1/0</span>, GE<span>0/2/0</span>, GE<span>0/3/0</span>, and GE<span>0/1/8</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0000001479804478.png" width="NaN" height="NaN"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001530204385__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Precautions</h4><p>During the configuration, note the following:</p>
<p>After a PE interface connected to a CE is bound to a VPN instance, Layer 3 configurations on this interface are automatically deleted. Such configurations include IP address and routing protocol configurations, and must be added again if needed.</p>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001530204385__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure IP addresses for interfaces on the backbone network.</p>
</li><li><p>Configure IS-IS on the backbone network to ensure that PEs can interwork with each other.</p>
</li><li><p>Enable MPLS on the backbone network.</p>
</li><li><p>Configure SR on the backbone network. In addition, configure IS-IS SR and use IS-IS to dynamically generate adjacency SIDs and advertise the SIDs to neighbors.</p>
</li><li>Configure TE attributes. The TE metric is used in this example. You can also configure other attributes, such as affinity attributes, path constraints, bandwidth constraints, bandwidth usage, IGP metric, delay, and hop limit, as required.</li><li><p>Establish a BGP-LS address family peer relationship between PE1 and the controller and another one between PE2 and the controller. In this way, the PEs can report network topology and label information to the controller through BGP-LS.</p>
</li><li><p>Configure route-policies with the color extended community attribute specified for routes on PE1 and PE2. Export route-policies are used in this example.</p>
</li><li>Configure an ODN template.</li><li>Establish PCEP connections between the PEs and controller. With these connections, the PEs functioning as PCCs send path computation requests to the controller functioning as the PCE. After completing path computation, the controller delivers the computation result to PE1 through PCEP.</li><li>Configure a source address on each PE.</li><li><p>Establish a BGP EVPN peer relationship between the PEs for them to exchange routing information.</p>
</li><li><p>Configure an EVPN L3VPN instance on each PE and bind an access-side interface to the instance.</p>
</li><li><p>Configure a tunnel selection policy on each PE.</p>
</li><li><p>Establish EBGP peer relationships between the CEs and PEs for them to exchange routing information.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001530204385__1.4.4"></a><a name="1.4.4"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>MPLS LSR IDs on the PEs and Ps</p>
</li><li><p>VPN target and RD of <strong>vpna</strong></p>
</li><li><p>SRGB ranges on the PEs and Ps</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001530204385__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure IP addresses for interfaces.</span><p><p># Configure PE1.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname PE1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack1] <strong>ip address 1.1.1.9 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>ip address 10.13.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> interface gigabitethernet<span>0/3/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/3/0</span>] <strong>ip address 10.11.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/3/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> interface gigabitethernet<span>0/1/8</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/8</span>] <strong>ip address 10.3.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/8</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure P1.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname P1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P1] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-LoopBack1] <strong>ip address 2.2.2.9 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1]<strong> interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/1/0</span>] <strong>ip address 10.11.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1]<strong> interface gigabitethernet<span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/2/0</span>] <strong>ip address 10.12.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1]<strong> interface gigabitethernet<span>0/3/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/3/0</span>] <strong>ip address 10.23.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/3/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname PE2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-LoopBack1] <strong>ip address 3.3.3.9 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>]<strong> ip address 10.14.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> interface gigabitethernet<span>0/3/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/3/0</span>]<strong> ip address 10.12.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/3/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> interface gigabitethernet<span>0/1/8</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/8</span>] <strong>ip address 10.4.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/8</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> commit</strong></pre>
<p># Configure P2.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname P2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P2] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-LoopBack1] <strong>ip address 4.4.4.9 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2]<strong> interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/1/0</span>] <strong>ip address 10.13.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2]<strong> interface gigabitethernet<span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/2/0</span>] <strong>ip address 10.14.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2]<strong> interface gigabitethernet<span>0/3/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/3/0</span>] <strong>ip address 10.23.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/3/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2] <strong>commit</strong></pre>
<p># Configure the Controller.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname Controller</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Controller] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Controller-LoopBack1] <strong>ip address 10.10.10.10 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Controller-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Controller]<strong> interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Controller-GigabitEthernet<span>0/1/0</span>] <strong>ip address 10.3.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Controller-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Controller]<strong> interface gigabitethernet<span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>Controller-GigabitEthernet<span>0/2/0</span>] <strong>ip address 10.4.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Controller-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Controller] <strong>commit</strong></pre>
</p></li><li><span>Configure an IGP on the backbone network for the PEs and Ps to communicate. IS-IS is used as an example.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>is-level level-1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>network-entity 10.0000.0000.0001.00</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack1] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> interface gigabitethernet<span>0/3/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/3/0</span>] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/3/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure P1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P1] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-isis-1] <strong>is-level level-1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-isis-1] <strong>network-entity 10.0000.0000.0002.00</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-LoopBack1] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1]<strong> interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/1/0</span>] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1]<strong> interface gigabitethernet<span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/2/0</span>] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1]<strong> interface gigabitethernet<span>0/3/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/3/0</span>] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/3/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1] <strong>is-level level-1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1] <strong>network-entity 10.0000.0000.0003.00</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-LoopBack1] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> interface gigabitethernet<span>0/3/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/3/0</span>]<strong> isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/3/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>]<strong> isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> commit</strong></pre>
<p># Configure P2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P2] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-isis-1] <strong>is-level level-1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-isis-1] <strong>network-entity 10.0000.0000.0004.00</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-LoopBack1] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2]<strong> interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/1/0</span>] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2]<strong> interface gigabitethernet<span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/2/0</span>] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2]<strong> interface gigabitethernet<span>0/3/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/3/0</span>] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/3/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2] <strong>commit</strong></pre>
</p></li><li><span>Configure basic MPLS functions on the backbone network.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>mpls lsr-id 1.1.1.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-mpls] <strong>quit</strong></pre>
<p># Configure P1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P1] <strong>mpls lsr-id 2.2.2.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-mpls] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P1-mpls] <strong>quit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>mpls lsr-id 3.3.3.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-mpls]<strong> quit</strong></pre>
<p># Configure P2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P2] <strong>mpls lsr-id 4.4.4.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-mpls] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P2-mpls] <strong>quit</strong></pre>
</p></li><li><span>Configure Segment Routing on the backbone network.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>segment-routing</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>cost-style wide</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>traffic-eng level-1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>segment-routing mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>segment-routing global-block 16000 23999</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The SRGB range varies according to the device. The range specified in this example is for reference only.</p>
</div></div>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack1] <strong>isis prefix-sid index 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure P1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P1] <strong>segment-routing</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-segment-routing] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-isis-1] <strong>cost-style wide</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-isis-1] <strong>traffic-eng level-1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-isis-1] <strong>segment-routing mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-isis-1] <strong>segment-routing global-block 16000 23999</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The SRGB range varies according to the device. The range specified in this example is for reference only.</p>
</div></div>
<pre class="screen">[<span class="keyword">*</span>P1-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-LoopBack1] <strong>isis prefix-sid index 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>segment-routing</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-segment-routing] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1] <strong>cost-style wide</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1] <strong>segment-routing mpls</strong></pre>
<pre class="screen">[PE2-isis-1] <strong>traffic-eng level-1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1] <strong>segment-routing global-block 16000 23999</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The SRGB range varies according to the device. The range specified in this example is for reference only.</p>
</div></div>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-LoopBack1] <strong>isis prefix-sid index 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure P2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P2] <strong>segment-routing</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-segment-routing] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-isis-1] <strong>cost-style wide</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-isis-1] <strong>traffic-eng level-1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-isis-1] <strong>segment-routing mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-isis-1] <strong>segment-routing global-block 16000 23999</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The SRGB range varies according to the device. The range specified in this example is for reference only.</p>
</div></div>
<pre class="screen">[<span class="keyword">*</span>P2-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-LoopBack1] <strong>isis prefix-sid index 40</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2] <strong>commit</strong></pre>
</p></li><li><span>Configure the TE metric attribute.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>te attribute enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>te metric 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> interface gigabitethernet<span>0/3/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/3/0</span>] <strong>te metric 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/3/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure P1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P1] <strong>te attribute enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1]<strong> interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/1/0</span>] <strong>te metric 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1]<strong> interface gigabitethernet<span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/2/0</span>] <strong>te metric 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1]<strong> interface gigabitethernet<span>0/3/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/3/0</span>] <strong>te metric 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/3/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>te attribute enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> interface gigabitethernet<span>0/3/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/3/0</span>]<strong> te metric 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/3/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>]<strong> te metric 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> commit</strong></pre>
<p># Configure P2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P2] <strong>te attribute enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2]<strong> interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/1/0</span>] <strong>te metric 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2]<strong> interface gigabitethernet<span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/2/0</span>] <strong>te metric 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2]<strong> interface gigabitethernet<span>0/3/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/3/0</span>] <strong>te metric 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/3/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2] <strong>commit</strong></pre>
</p></li><li><span>Establish BGP-LS address family peer relationships.</span><p><p>To allow a PE to report topology information to a controller through BGP-LS, you must enable IS-IS-based topology advertisement on the PE. Typically, this configuration needs to be performed on only one device in an IGP domain. In this example, this configuration is performed on both PE1 and PE2 to improve reliability.</p>
<p># Enable IS-IS SR-MPLS TE on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> isis 1</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-isis-1]<strong> bgp-ls enable level-1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-isis-1]<strong> quit</strong></pre>
<p># Enable IS-IS SR-MPLS TE on PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2]<strong> isis 1</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-isis-1]<strong> bgp-ls enable level-1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-isis-1]<strong> quit</strong></pre>
<p># Configure the BGP-LS address family peer relationship on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp]<strong> peer 10.3.1.2 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp]<strong> link-state-family unicast</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-ls]<strong> peer 10.3.1.2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-ls]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> commit</strong></pre>
<p># Configure the BGP-LS address family peer relationship on PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2]<strong> bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp]<strong> peer 10.4.1.2 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp]<strong> link-state-family unicast</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-ls]<strong> peer 10.4.1.2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-ls]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> commit</strong></pre>
<p># Configure the BGP-LS address family peer relationship on the controller.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Controller]<strong> bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Controller-bgp]<strong> peer 10.3.1.1 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Controller-bgp]<strong> peer 10.4.1.1 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Controller-bgp]<strong> link-state-family unicast</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Controller-bgp-af-ls]<strong> peer 10.3.1.1 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Controller-bgp-af-ls]<strong> peer 10.4.1.1 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Controller-bgp-af-ls]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Controller-bgp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Controller]<strong> commit</strong></pre>
</p></li><li><span>Configure route-policies.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>route-policy color100 permit node 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-route-policy] <strong>apply extcommunity color 0:100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-route-policy] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>route-policy color200 permit node 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-route-policy] <strong>apply extcommunity color 0:200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-route-policy] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</p></li><li><span>Configure a source address on each PE.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>evpn source-address 1.1.1.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>evpn source-address 3.3.3.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</p></li><li><span>Establish a BGP EVPN peer relationship between the PEs, apply export route-policies to the BGP EVPN peers, and set the color extended community for routes.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp] <strong>peer 3.3.3.9 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 3.3.3.9 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>l2vpn-family evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-evpn] <strong>peer 3.3.3.9 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-evpn] <strong>peer 3.3.3.9 route-policy color100 export</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-evpn] <strong>peer 3.3.3.9 advertise irb</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-evpn] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp-af-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp] <strong>quit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-bgp] <strong>peer 1.1.1.9 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>peer 1.1.1.9 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>l2vpn-family evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-evpn] <strong>peer 1.1.1.9 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-evpn] <strong>peer 1.1.1.9 route-policy color200 export</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-evpn] <strong>peer 1.1.1.9 advertise irb</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-evpn] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-bgp-af-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-bgp] <strong>quit</strong></pre>
<p>After completing the configuration, run the <strong>display bgp evpn peer</strong> command on the PEs to check whether the BGP peer relationship has been established. If the <strong>Established</strong> state is displayed in the command output, the BGP peer relationship has been established successfully. The following example uses the command output on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display bgp evpn peer</strong></pre>
<pre class="screen"> BGP local router ID : 1.1.1.9
 Local AS number : 100
 Total number of peers : 1                 Peers in established state : 1
  Peer            V    AS  MsgRcvd  MsgSent    OutQ  Up/Down    State        PrefRcv
  3.3.3.9         4   100   12      18         0     00:09:38   <strong>Established</strong>   0</pre>
</p></li><li><span>Configure an ODN template.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>segment-routing policy constraint-template tp200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-sr-policy-constraint-template-tp200] <strong>metric-type te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-sr-policy-constraint-template-tp200] <strong>max-cumulation te 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-sr-policy-constraint-template-tp200] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> segment-routing</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing]<strong> on-demand color 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing-odn-200] <strong>dynamic-computation-seq </strong><strong>pcep</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing-odn-200] <strong>constraint-template </strong><strong>tp200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing-odn-200] <strong>candidate-path preference </strong><strong>100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing-odn-200] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</p><p><p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>segment-routing policy constraint-template tp100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-sr-policy-constraint-template-tp100] <strong>metric-type te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-sr-policy-constraint-template-tp100] <strong>max-cumulation te 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-sr-policy-constraint-template-tp100] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> segment-routing</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-segment-routing] <strong>on-demand color 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-segment-routing-odn-200] <strong>dynamic-computation-seq </strong><strong>pcep</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-segment-routing-odn-100] <strong>constraint-template </strong><strong>tp100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-segment-routing-odn-100] <strong>candidate-path preference </strong><strong>100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-segment-routing-odn-100] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</p></li><li><span>Configure PCEP delegation.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>pce-client</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-pce-client] <strong>capability segment-routing</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-pce-client] <strong>connect-server 10.10.10.10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-pce-client] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</p><p><p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>pce-client</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-pce-client] <strong>capability segment-routing</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-pce-client] <strong>connect-server 10.10.10.10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-pce-client] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p>After the configuration is complete, the PEs can receive the SR-MPLS TE Policy paths delivered by the controller and then generate SR-MPLS TE Policies. You can run the <a href="cmdqueryname=display+sr-te+policy"><b><span class="cmdname">display sr-te policy</span></b></a> command to check SR-MPLS TE Policy information. The following example uses the command output on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display sr-te policy</strong>
PolicyName : policy200
Endpoint             : 3.3.3.9              Color                : 200
TunnelId             : 1                    TunnelType           : SR-TE Policy
Binding SID          : -                    MTU                  : 1000
Policy State         : Up                   State Change Time    : 2023-02-18 15:37:15
Admin State          : Up                   Traffic Statistics   : Disable
BFD                  : Disable              Backup Hot-Standby   : Disable
DiffServ-Mode        : -
Active IGP Metric    : -
Candidate-path Count : 1                    

Candidate-path Preference: 200
Path State           : Active               Path Type            : Primary
Protocol-Origin      : PCEP(10)             Originator           : 0, 0.0.0.0
Discriminator        : 200                  Binding SID          : -
GroupId              : 2                    Policy Name          : policy200
Template ID          : -
Active IGP Metric    : -                              ODN Color            : -
Metric               :
 IGP Metric          : -                              TE Metric            : -
 Delay Metric        : -                              Hop Counts           : -
Segment-List Count   : 1
 Segment-List        : pe1
  Segment-List ID    : 129                  XcIndex              : 68
  List State         : Up                   BFD State            : -
  EXP                : -                    TTL                  : -
  DeleteTimerRemain  : -<span>                    Weight               : 1</span>
  Label : <span>330</span>000, <span>330</span>002</pre>
</p></li><li><span>Create a VPN instance and enable the IPv4 address family on each PE. Then, bind each PE's interface connected to a CE to the corresponding VPN instance.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>ip vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpna] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpna-af-ipv4] <strong>route-distinguisher 100:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpna-af-ipv4] <strong>vpn-target 111:1 both</strong><strong> evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpna-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpna] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet<span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>ip binding vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>ip address 10.1.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>ip vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-vpna] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-vpna-af-ipv4] <strong>route-distinguisher 200:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-vpna-af-ipv4] <strong>vpn-target 111:1 both</strong><strong> evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-vpna-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-vpna] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface gigabitethernet<span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>] <strong>ip binding vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>] <strong>ip address 10.2.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</p></li><li><span>Configure a tunnel selection policy on each PE to preferentially select an SR-MPLS TE Policy.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>tunnel-policy p1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-tunnel-policy-p1] <strong>tunnel select-seq sr-te-policy load-balance-number 1 unmix</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-tunnel-policy-p1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>ip vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpna] <strong>evpn mpls routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpna] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpna-af-ipv4] <strong>tnl-policy p1</strong><strong> evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpna-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpna] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>tunnel-policy p1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-tunnel-policy-p1] <strong>tunnel select-seq sr-te-policy load-balance-number 1 unmix</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-tunnel-policy-p1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>ip vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-vpna] <strong>evpn mpls routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-vpna] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-vpna-af-ipv4] <strong>tnl-policy p1 evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-vpna-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-vpna] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</p></li><li><span>Establish an EBGP peer relationship between each CE-PE pair.</span><p><p># Configure CE1.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname CE1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-LoopBack1] <strong>ip address 10.11.1.1 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1]<strong> interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>] <strong>ip address 10.1.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>bgp 65410</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp] <strong>peer 10.1.1.2 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp] <strong>network 10.11.1.1 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>commit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The configuration of CE2 is similar to the configuration of CE1. For detailed configurations, see Configuration Files.</p>
</div></div>
<p>After completing the configuration, run the <strong>display ip vpn-instance verbose</strong> command on the PEs to check VPN instance configurations. Check that each PE can ping its connected CE.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>If a PE has multiple interfaces bound to the same VPN instance, specify a source IP address using the <strong>-a</strong> <em>source-ip-address</em> parameter in the <strong>ping -vpn-instance</strong> <em>vpn-instance-name</em> <strong>-a</strong> <em>source-ip-address dest-ip-address</em> command to ping the CE that is connected to the remote PE. If the source IP address is not specified, the ping operation may fail.</p>
</div></div>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp] <strong>ipv4-family vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-vpna] <strong>peer 10.1.1.1 as-number 65410</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-vpna] <strong>import-route direct</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-vpna] <strong>advertise l2vpn evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-vpna] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp-vpna] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp] <strong>quit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The configuration of PE2 is similar to the configuration of PE1. For detailed configurations, see Configuration Files.</p>
</div></div>
<p>After completing the configuration, run the <strong>display bgp vpnv4 vpn-instance peer</strong> command on the PEs to check whether BGP peer relationships have been established between the PEs and CEs. If the <strong>Established</strong> state is displayed in the command output, the BGP peer relationships have been established successfully.</p>
<p>The following example uses the peer relationship between PE1 and CE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display bgp vpnv4 vpn-instance vpna peer</strong></pre>
<pre class="screen"> BGP local router ID : 1.1.1.9
 Local AS number : 100

 VPN-Instance vpna, Router ID 1.1.1.9:
 Total number of peers : 1                 Peers in established state : 1

  Peer            V          AS  MsgRcvd  MsgSent  OutQ  Up/Down       State  PrefRcv
  10.1.1.1        4       65410       91       90     0 01:15:39 <strong>Established</strong>        1</pre>
</p></li><li><span>Verify the configuration.</span><p><p>After completing the configuration, run the <strong>display ip routing-table vpn-instance</strong> command on each PE to check information about the loopback interface route toward a CE.</p>
<p>The following example uses the command output on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display ip routing-table vpn-instance vpna</strong></pre>
<pre class="screen"><span class="keyword">Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route</span>
------------------------------------------------------------------------------
Routing Table: vpna
         Destinations : 7        Routes : 7
Destination/Mask    Proto  Pre  Cost     Flags NextHop         Interface
     10.1.1.0/24    Direct 0    0        D     10.1.1.2        GigabitEthernet<span>0/2/0</span>
     10.1.1.2/32    Direct 0    0        D     127.0.0.1       GigabitEthernet<span>0/2/0</span>
   10.1.1.255/32    Direct 0    0        D     127.0.0.1       GigabitEthernet<span>0/2/0</span>
    <strong>10.11.1.1/32</strong>     EBGP   255  0        RD    10.1.1.1        GigabitEthernet<span>0/2/0</span>
    <strong>10.22.2.2/32</strong>     IBGP   255  0        RD    3.3.3.9         <span>policy200</span>
      127.0.0.0/8   Direct 0    0        D     127.0.0.1       InLoopBack0
255.255.255.255/32  Direct 0    0        D     127.0.0.1       InLoopBack0</pre>
<p>Run the <strong>display ip routing-table vpn-instance vpna verbose</strong> command on each PE to check details about the loopback interface route toward a CE.</p>
<p>The following example uses the command output on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display ip routing-table vpn-instance vpna 10.22.2.2 verbose</strong></pre>
<pre class="screen"><span class="keyword">Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route</span>
------------------------------------------------------------------------------
Routing Table : vpna
Summary Count : 1

Destination: 10.22.2.2/32         
     Protocol: IBGP               Process ID: 0              
   Preference: 255                      Cost: 0              
      NextHop: 3.3.3.9             Neighbour: 3.3.3.9
        State: Active Adv Relied         Age: 01h18m38s           
          Tag: 0                    Priority: low            
        Label: 48180                 QoSInfo: 0x0           
   IndirectID: 0x10000B9            Instance:                                 
 RelayNextHop: 0.0.0.0             <strong>Interface: <span>policy200</span></strong>
     <strong>TunnelID: 0x000000003200000041 Flags: RD</strong></pre>
<p>The command output shows that the VPN route has successfully recursed to the specified SR-MPLS TE Policy.</p>
<p>CEs in the same VPN can ping each other. For example, CE1 can ping CE2 at 10.22.2.2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>ping -a 10.11.1.1 10.22.2.2</strong></pre>
<pre class="screen">  PING 10.22.2.2: 56  data bytes, press CTRL_C to break
    Reply from 10.22.2.2: bytes=56 Sequence=1 ttl=251 time=72 ms
    Reply from 10.22.2.2: bytes=56 Sequence=2 ttl=251 time=34 ms
    Reply from 10.22.2.2: bytes=56 Sequence=3 ttl=251 time=50 ms
    Reply from 10.22.2.2: bytes=56 Sequence=4 ttl=251 time=50 ms
    Reply from 10.22.2.2: bytes=56 Sequence=5 ttl=251 time=34 ms
  --- 10.22.2.2 ping statistics ---
    5 packet(s) transmitted
    5 packet(s) received
    0.00% packet loss
    round-trip min/avg/max = 34/48/72 ms  </pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001530204385__1.4.6"></a><a name="1.4.6"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>PE1 configuration file</p>
<pre class="screen">#
sysname PE1
#
te attribute enable
#
ip vpn-instance vpna
 ipv4-family
  route-distinguisher 100:1
  apply-label per-instance
  vpn-target 111:1 export-extcommunity evpn
  vpn-target 111:1 import-extcommunity evpn
  tnl-policy p1 evpn
  evpn mpls routing-enable
#
mpls lsr-id 1.1.1.9
#               
mpls            
#               
segment-routing 
 on-demand color 200
  dynamic-computation-seq pcep
  constraint-template tp200
  candidate-path preference 100
#               
isis 1          
 is-level level-1
 cost-style wide
 bgp-ls enable level-1
 network-entity 10.0000.0000.0001.00
 traffic-eng level-1 
 segment-routing mpls
 segment-routing global-block 16000 23999
#               
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown  
 ip address 10.13.1.1 255.255.255.0
 isis enable 1  
<strong> </strong>te metric 20
#               
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown  
 ip binding vpn-instance vpna
 ip address 10.1.1.2 255.255.255.0
#               
interface GigabitEthernet<span>0/3/0</span>
 undo shutdown  
 ip address 10.11.1.1 255.255.255.0
 isis enable 1  
<strong> </strong>te metric 10
#               
interface GigabitEthernet<span>0/1/8</span>
 undo shutdown  
 ip address 10.3.1.1 255.255.255.0
 isis enable 1
#               
interface LoopBack1
 ip address 1.1.1.9 255.255.255.255
 isis enable 1  
 isis prefix-sid index 10
#               
bgp 100         
 peer 3.3.3.9 as-number 100
 peer 3.3.3.9 connect-interface LoopBack1
 peer 10.3.1.2 as-number 100
 #              
 ipv4-family unicast
  undo synchronization
  peer 3.3.3.9 enable
  peer 10.3.1.2 enable
 #
 link-state-family unicast
  peer 10.3.1.2 enable
 #              
 l2vpn-family evpn
  peer 3.3.3.9 enable
  peer 3.3.3.9 route-policy color100 export
  peer 3.3.3.9 advertise irb
 #              
 ipv4-family vpn-instance vpna
  import-route direct
  peer 10.1.1.1 as-number 65410
  advertise l2vpn evpn
#
segment-routing policy constraint-template tp200
 metric-type te
 max-cumulation te 20
# 
pce-client
 capability segment-routing
 connect-server 10.10.10.10
#
route-policy color100 permit node 1
 apply extcommunity color 0:100
#               
tunnel-policy p1
 tunnel select-seq sr-te-policy load-balance-number 1 unmix
#
evpn source-address 1.1.1.9
#
return</pre>
</li><li><p>P1 configuration file</p>
<pre class="screen">#
sysname P1
#
te attribute enable
#
mpls lsr-id 2.2.2.9
#               
mpls            
#               
segment-routing 
#               
isis 1          
 is-level level-1
 cost-style wide
 network-entity 10.0000.0000.0002.00
 traffic-eng level-1 
 segment-routing mpls
 segment-routing global-block 16000 23999
#               
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown  
 ip address 10.11.1.2 255.255.255.0
 isis enable 1  
<strong> </strong>te metric 10
#               
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown  
 ip address 10.12.1.1 255.255.255.0
 isis enable 1
<strong> </strong>te metric 10
#               
interface GigabitEthernet<span>0/3/0</span>
 undo shutdown  
 ip address 10.23.1.1 255.255.255.0
 isis enable 1 
<strong> </strong>te metric 100
#               
interface LoopBack1
 ip address 2.2.2.9 255.255.255.255
 isis enable 1  
 isis prefix-sid index 20
#
return</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#
sysname PE2
#
te attribute enable
#
ip vpn-instance vpna
 ipv4-family
  route-distinguisher 200:1
  apply-label per-instance
  vpn-target 111:1 export-extcommunity evpn
  vpn-target 111:1 import-extcommunity evpn
  tnl-policy p1 evpn
  evpn mpls routing-enable
#
mpls lsr-id 3.3.3.9
#               
mpls   
#               
segment-routing
 on-demand color 100
  dynamic-computation-seq pcep
  constraint-template tp100
  candidate-path preference 100
#               
isis 1          
 is-level level-1
 cost-style wide
 bgp-ls enable level-1
 network-entity 10.0000.0000.0003.00
 traffic-eng level-1 
 segment-routing mpls
 segment-routing global-block 16000 23999
#               
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown  
 ip address 10.14.1.2 255.255.255.0
 isis enable 1  
<strong> </strong>te metric 20
#               
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown  
 ip binding vpn-instance vpna
 ip address 10.2.1.2 255.255.255.0
#               
interface GigabitEthernet<span>0/3/0</span>
 undo shutdown  
 ip address 10.12.1.2 255.255.255.0
 isis enable 1  
<strong> </strong>te metric 10
#               
interface GigabitEthernet<span>0/1/8</span>
 undo shutdown  
 ip address 10.4.1.1 255.255.255.0
 isis enable 1 
#               
interface LoopBack1
 ip address 3.3.3.9 255.255.255.255
 isis enable 1  
 isis prefix-sid index 30
#               
bgp 100         
 peer 1.1.1.9 as-number 100
 peer 1.1.1.9 connect-interface LoopBack1
 peer 10.4.1.2 as-number 100 
 #              
 ipv4-family unicast
  undo synchronization
  peer 1.1.1.9 enable
  peer 10.4.1.2 enable
 #
 link-state-family unicast
  peer 10.4.1.2 enable
 #              
 l2vpn-family evpn
  peer 1.1.1.9 enable
  peer 1.1.1.9 route-policy color200 export
  peer 1.1.1.9 advertise irb
 #              
 ipv4-family vpn-instance vpna
  import-route direct
  peer 10.2.1.1 as-number 65420
  advertise l2vpn evpn
#
segment-routing policy constraint-template tp100
 metric-type te
 max-cumulation te 20
# 
pce-client
 capability segment-routing
 connect-server 10.10.10.10
#
route-policy color200 permit node 1
 apply extcommunity color 0:200
#               
tunnel-policy p1
 tunnel select-seq sr-te-policy load-balance-number 1 unmix
#
evpn source-address 3.3.3.9
#
return</pre>
</li><li><p>P2 configuration file</p>
<pre class="screen">#
sysname P2
#
te attribute enable
#
mpls lsr-id 4.4.4.9
#               
mpls            
#               
segment-routing 
#               
isis 1          
 is-level level-1
 cost-style wide
 network-entity 10.0000.0000.0004.00
 traffic-eng level-1 
 segment-routing mpls
 segment-routing global-block 16000 23999
#               
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown  
 ip address 10.13.1.2 255.255.255.0
 isis enable 1  
<strong> </strong>te metric 20
#               
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown  
 ip address 10.14.1.1 255.255.255.0
 isis enable 1 
<strong> </strong>te metric 20 
#               
interface GigabitEthernet<span>0/3/0</span>
 undo shutdown  
 ip address 10.23.1.2 255.255.255.0
 isis enable 1
<strong> </strong>te metric 100
#               
interface LoopBack1
 ip address 4.4.4.9 255.255.255.255
 isis enable 1  
 isis prefix-sid index 40
#
return</pre>
</li><li><p>Controller configuration file</p>
<pre class="screen">#
sysname Controller
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.3.1.2 255.255.255.0
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.4.1.2 255.255.255.0
#               
interface LoopBack1
 ip address 10.10.10.10 255.255.255.255
#
bgp 100
 peer 10.3.1.1 as-number 100
 peer 10.4.1.1 as-number 100
 #
 ipv4-family unicast
  undo synchronization
  peer 10.3.1.1 enable
  peer 10.4.1.1 enable
 #
 link-state-family unicast
  peer 10.3.1.1 enable
  peer 10.4.1.1 enable
#
return</pre>
</li><li><p>CE1 configuration file</p>
<pre class="screen">#
sysname CE1
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.1.1 255.255.255.0
#
interface LoopBack1
 ip address 10.11.1.1 255.255.255.255
#
bgp 65410
 peer 10.1.1.2 as-number 100
 #
 ipv4-family unicast
  network 10.11.1.1 255.255.255.255
  peer 10.1.1.2 enable
#
return</pre>
</li><li><p>CE2 configuration file</p>
<pre class="screen">#
sysname CE2
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.2.1.1 255.255.255.0
#
interface LoopBack1
 ip address 10.22.2.2 255.255.255.255
#
bgp 65420
 peer 10.2.1.2 as-number 100
 #
 ipv4-family unicast
  network 10.22.2.2 255.255.255.255
  peer 10.2.1.2 enable
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_sr_all_cfg_0099.html">Configuration Examples for SR-MPLS TE Policy
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_sr_all_cfg_0112.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_sr_all_cfg_0406.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>