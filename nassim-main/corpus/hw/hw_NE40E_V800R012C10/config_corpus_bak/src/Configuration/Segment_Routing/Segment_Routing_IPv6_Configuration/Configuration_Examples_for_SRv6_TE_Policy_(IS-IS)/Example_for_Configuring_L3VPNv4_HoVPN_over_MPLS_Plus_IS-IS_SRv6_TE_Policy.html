
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring L3VPNv4 HoVPN over MPLS Plus IS-IS SRv6 TE Policy">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_srv6_cfg_all_0101.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_srv6_cfg_all_0226.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_srv6_cfg_all_0283.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,w00556928,w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featurename" content="EVPN">
<meta name="featurename" content="Segment Routing IPv6">
<meta name="featurename" content="Segment Routing IPv6 Policy">
<meta name="featurename" content="Segment Routing Policy">
<meta name="featuretype" content="Segment Routing">
<meta name="featuretype" content="VPN">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featurename" content="EVPN">
<meta name="featurename" content="Segment Routing IPv6">
<meta name="featurename" content="Segment Routing IPv6 Policy">
<meta name="featurename" content="Segment Routing Policy">
<meta name="featuretype" content="Segment Routing">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featurename" content="EVPN">
<meta name="featurename" content="Segment Routing IPv6">
<meta name="featurename" content="Segment Routing IPv6 Policy">
<meta name="featurename" content="Segment Routing Policy">
<meta name="featuretype" content="Segment Routing">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="Segment Routing IPv6">
<meta name="featuretype" content="Segment Routing">
<meta name="OWNER" content="l00587852">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00587852">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0227026921">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/thickbox.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/imageResize.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery-migrate-1.2.1.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery-ui.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery.mousewheel.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/thickbox.js"></script>
<title>Example for Configuring L3VPNv4 HoVPN over MPLS Plus IS-IS SRv6 TE Policy</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0227026921"></a><a name="EN-US_TASK_0227026921"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring L3VPNv4 HoVPN over MPLS Plus IS-IS SRv6 TE Policy</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0227026921__1.3.1"></a><a name="1.3.1"></a>
<div class="p"><div class="p"><p>This section provides an example for configuring L3VPNv4 HoVPN over MPLS plus SRv6 TE Policy.</p>
<h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0227026921__fig_dc_vrp_srv6_cfg_all_001101">Figure 1</a>:</p>
<ul><li>The UPE, SPE, and NPE all belong to AS 100. They need to run IS-IS to implement IPv6 network connectivity.</li><li>The UPE, SPE, and NPE all belong to IS-IS process 1.</li></ul>
<p>It is required that a bidirectional MPLS LDP tunnel be established between the UPE and SPE and a bidirectional SRv6 TE Policy be established between the SPE and NPE to carry L3VPNv4 services.</p>
<div class="fignone" id="EN-US_TASK_0227026921__fig_dc_vrp_srv6_cfg_all_001101"><a name="EN-US_TASK_0227026921__fig_dc_vrp_srv6_cfg_all_001101"></a><a name="fig_dc_vrp_srv6_cfg_all_001101"></a><span class="figcap"><b>Figure 1 </b>L3VPNv4 HoVPN over MPLS plus SRv6 TE Policy networking</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 and 2 in this example represent GE <span>0/1/0</span> and GE <span>0/2/0</span>, respectively.</p>
</div></div>
<br><span><img class="imgResize" src="figure/en-us_image_0235808557.png" width="521.36" height="186.98204" title="Click to enlarge"></span></div>
<h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li>Enable IPv6 forwarding and configure an IPv6/IPv4 address for each interface on the UPE, NPE, and SPE.</li><li>Enable IS-IS, configure an IS-IS level, and specify a network entity title (NET) on each device.</li><li>Configure basic MPLS functions and MPLS LDP on the UPE and SPE, and establish MPLS LDP LSPs between the two devices.</li><li>Configure VPN instances on the UPE, NPE, and SPE, and enable the IPv4 address family for the instances.</li><li>Establish an EBGP peer relationship between the UPE and CE1 and another one between the NPE and CE2.</li><li>Establish an MP-IBGP peer relationship between the UPE and SPE and another one between the SPE and NPE.</li><li>Configure SRv6 SIDs on the NPE and SPE, and enable the devices to advertise VPN routes carrying SIDs.</li><li>Deploy an SRv6 TE Policy between the SPE and NPE.</li><li>Configure a tunnel policy on the SPE and NPE to import traffic.</li><li>Specify the UPE as the peer of the SPE and configure the SPE to advertise the default route to the UPE.</li><li>Configure the SPE to advertise regenerated routes to the NPE.</li></ol>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0227026921__1.3.2"></a><a name="1.3.2"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li>IPv6 address of each interface on the UPE, SPE, and NPE</li><li>IS-IS process ID of the UPE, SPE, and NPE</li><li>IS-IS level of the UPE, SPE, and NPE</li><li>VPN instance name, RD, and RT on the SPE and NPE</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0227026921__1.3.3"></a><a name="1.3.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure an IP address and enable IPv6 forwarding for each interface.</span><p><p># Configure the NPE. The configurations of the SPE and UPE are similar to the configuration of the NPE. For configuration details, see <a href="#EN-US_TASK_0227026921__example764102717246">Configuration Files</a> in this section.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname NPE</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE] <strong>interface gigabitethernet <span>0/1/0</span></strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE-GigabitEthernet<span>0/1/0</span>] <strong>ipv6 enable</strong>
[<span class="keyword">*</span>NPE-GigabitEthernet<span>0/1/0</span>] <strong>ipv6 address 2001:DB8:2001::2 96</strong>
[<span class="keyword">*</span>NPE-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong>
[<span class="keyword">*</span>NPE] <strong>interface LoopBack 1</strong>
[<span class="keyword">*</span>NPE-LoopBack1] <strong>ip address 3.3.3.3 32</strong>
[<span class="keyword">*</span>NPE-LoopBack1] <strong>ipv6 enable</strong>
[<span class="keyword">*</span>NPE-LoopBack1] <strong>ipv6 address 2001:DB8:2::2 128</strong>
[<span class="keyword">*</span>NPE-LoopBack1] <strong>quit</strong>
[<span class="keyword">*</span>NPE] <strong>commit</strong></pre>
</p></li><li><span>Configure IS-IS.</span><p><p># Configure the UPE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>isis 1</strong>
[<span class="keyword">*</span>UPE-isis-1] <strong>is-level level-1</strong>
[<span class="keyword">*</span>UPE-isis-1] <strong>cost-style wide</strong>
[<span class="keyword">*</span>UPE-isis-1] <strong>network-entity 10.0000.0000.0001.00</strong>
[<span class="keyword">*</span>UPE-isis-1] <strong>quit</strong>
[<span class="keyword">*</span>UPE] <strong>interface gigabitethernet <span>0/1/0</span></strong>
[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/0</span>] <strong>isis enable 1</strong>
[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong>
[<span class="keyword">*</span>UPE] <strong>interface loopback1</strong>
[<span class="keyword">*</span>UPE-LoopBack1] <strong>isis enable 1</strong>
[<span class="keyword">*</span>UPE-LoopBack1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE-LoopBack1] <strong>quit</strong></pre>
<p># Configure the SPE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE] <strong>isis 1</strong> 
[<span class="keyword">*</span>SPE-isis-1] <strong>is-level level-1</strong>
[<span class="keyword">*</span>SPE-isis-1] <strong>cost-style wide</strong>
[<span class="keyword">*</span>SPE-isis-1] <strong>network-entity 10.0000.0000.0002.00</strong>
[<span class="keyword">*</span>SPE-isis-1] <strong>ipv6 enable topology ipv6</strong>
[<span class="keyword">*</span>SPE-isis-1] <strong>quit</strong>
[<span class="keyword">*</span>SPE] <strong>interface gigabitethernet <span>0/1/0</span></strong>
[<span class="keyword">*</span>SPE-GigabitEthernet<span>0/1/0</span>] <strong>isis enable 1</strong>
[<span class="keyword">*</span>SPE-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong>
[<span class="keyword">*</span>SPE] <strong>interface gigabitethernet <span>0/2/0</span></strong>
[<span class="keyword">*</span>SPE-GigabitEthernet<span>0/2/0</span>] <strong>isis ipv6 enable 1</strong>
[<span class="keyword">*</span>SPE-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong>
[<span class="keyword">*</span>SPE] <strong>interface loopback1</strong>
[<span class="keyword">*</span>SPE-LoopBack1] <strong>isis ipv6 enable 1</strong>
[<span class="keyword">*</span>SPE-LoopBack1] <strong>isis enable 1</strong>
[<span class="keyword">*</span>SPE-LoopBack1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE-LoopBack1] <strong>quit</strong></pre>
<p># Configure the NPE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE] <strong>isis 1</strong>
[<span class="keyword">*</span>NPE-isis-1] <strong>is-level level-1</strong>
[<span class="keyword">*</span>NPE-isis-1] <strong>cost-style wide</strong>
[<span class="keyword">*</span>NPE-isis-1] <strong>network-entity 10.0000.0000.0003.00</strong>
[<span class="keyword">*</span>NPE-isis-1] <strong>ipv6 enable topology ipv6</strong>
[<span class="keyword">*</span>NPE-isis-1] <strong>quit</strong>
[<span class="keyword">*</span>NPE] <strong>interface gigabitethernet <span>0/1/0</span></strong>
[<span class="keyword">*</span>NPE-GigabitEthernet<span>0/1/0</span>] <strong>isis ipv6 enable 1</strong>
[<span class="keyword">*</span>NPE-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong>
[<span class="keyword">*</span>NPE] <strong>interface loopback1</strong>
[<span class="keyword">*</span>NPE-LoopBack1] <strong>isis ipv6 enable 1</strong>
[<span class="keyword">*</span>NPE-LoopBack1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE-LoopBack1] <strong>quit</strong></pre>
<p>After the configuration is complete, perform the following operations to check whether IS-IS is successfully configured:</p>
<div class="p"># Display IS-IS neighbor information. The following example uses the command output on the UPE.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>display isis peer</strong> 
 
                          Peer information for ISIS(1) 
                          
  System Id     Interface          Circuit Id        State HoldTime Type     PRI 
-------------------------------------------------------------------------------- 
0000.0000.0002* GE<span>0/1/0</span>            0000.0000.0002.01  Up   8s       L1       64  
 
Total Peer(s): 1</pre>
</div>
<div class="p"># Display IS-IS routing table information. The following example uses the command output on the NPE.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE] <strong>display isis route</strong> 
                         Route information for ISIS(1) 
                         ----------------------------- 
 
                        ISIS(1) Level-1 Forwarding Table 
                        -------------------------------- 
 
 IPV6 Dest.          ExitInterface   NextHop                    Cost     Flags     
-------------------------------------------------------------------------------- 
2001:DB8:1::1/128    GE<span>0/1/0</span>         FE80::3A92:6CFF:FE21:10    10       A/-/-/-   
2001:DB8:2::2/128    Loop1           Direct                     0        D/-/L/-   
2001:DB8:2001::/96   GE<span>0/1/0</span>         Direct                     10       D/-/L/-   
     Flags: D-Direct, A-Added to URT, L-Advertised in LSPs, S-IGP Shortcut,  
            U-Up/Down Bit Set, LP-Local Prefix-Sid
<span>     Protect Type: L-Link Protect, N-Node Protect</span></pre>
</div>
</p></li><li><span>Configure basic MPLS functions and MPLS LDP on the UPE and SPE, and establish MPLS LDP LSPs between the two devices.</span><p><div class="p"># Configure the UPE.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>mpls lsr-id 1.1.1.1</strong>
[<span class="keyword">*</span>UPE] <strong>mpls</strong>
[<span class="keyword">*</span>UPE-mpls] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE-mpls]<strong> </strong><strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>mpls ldp</strong>
[<span class="keyword">*</span>UPE-mpls-ldp]<strong> quit</strong>
[<span class="keyword">*</span>UPE] <strong>interface gigabitethernet</strong> <strong><span>0/1/0</span></strong>
[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong>
[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/0</span>] <strong>mpls ldp</strong>
[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/0</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
</div>
<div class="p"># Configure the SPE.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE] <strong>mpls lsr-id</strong> <strong>2.2.2.2</strong>
[<span class="keyword">*</span>SPE] <strong>mpls</strong>
[<span class="keyword">*</span>SPE-mpls] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE-mpls] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE]<strong> mpls ldp</strong>
[<span class="keyword">*</span>SPE-mpls-ldp]<strong> quit</strong>
[<span class="keyword">*</span>SPE] <strong>interface gigabitethernet</strong> <strong><span>0/1/0</span></strong>
[<span class="keyword">*</span>SPE-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong>
[<span class="keyword">*</span>SPE-GigabitEthernet<span>0/1/0</span>] <strong>mpls ldp</strong>
[<span class="keyword">*</span>SPE-GigabitEthernet<span>0/1/0</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
</div>
<p>After the configuration is complete, run the <strong>display mpls ldp session</strong> command. If <strong>Status</strong> is displayed as <strong>Operational</strong> in the command output, LDP sessions have been successfully established between the UPE and SPE. Then, run the <strong>display mpls ldp lsp</strong> command to check whether LDP LSPs have been successfully established.</p>
<div class="p">The following example uses the command output on the UPE.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>display mpls ldp session</strong>
               LDP Session(s) in Public Network
 Codes: LAM(Label Advertisement Mode), SsnAge Unit(DDDD:HH:MM)
 An asterisk (*) before a session means the session is being deleted.
 -------------------------------------------------------------------------
 Peer-ID            Status       LAM  SsnRole  SsnAge       KA-Sent/Rcv
 -------------------------------------------------------------------------
 2.2.2.2:0          <strong>Operational</strong> DU   Passive  0006:20:55   39551/39552
 -------------------------------------------------------------------------
 TOTAL: 1 session(s) Found.</pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>display mpls ldp lsp</strong>
 LDP LSP Information
 -------------------------------------------------------------------------------
 Flag after Out IF: (I) - RLFA Iterated LSP, (I*) - Normal and RLFA Iterated LSP
 -------------------------------------------------------------------------------
 DestAddress/Mask   In/OutLabel    UpstreamPeer    NextHop         OutInterface
 -------------------------------------------------------------------------------
 1.1.1.1/32         3/NULL         2.2.2.2         127.0.0.1       Loop1
*1.1.1.1/32         Liberal/1024                   DS/2.2.2.2
 2.2.2.2/32         NULL/3         -               10.1.2.2        GE<span>0/1/0</span>
 2.2.2.2/32         1024/3         2.2.2.2         10.1.2.2        GE<span>0/1/0</span>
-------------------------------------------------------------------------------
 TOTAL: 3 Normal LSP(s) Found.
 TOTAL: 1 Liberal LSP(s) Found.
 TOTAL: 0 FRR LSP(s) Found.
 An asterisk (*) before an LSP means the LSP is not established
 An asterisk (*) before a Label means the USCB or DSCB is stale
 An asterisk (*) before an UpstreamPeer means the session is stale
 An asterisk (*) before a DS means the session is stale
 An asterisk (*) before a NextHop means the LSP is FRR LSP</pre>
</div>
</p></li><li><span>On the UPE, NPE, and SPE, configure a VPN instance and enable the IPv4 address family for the instance.</span><p><div class="p"># Configure the UPE.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>ip vpn-instance vpna</strong>
[<span class="keyword">*</span>UPE-vpn-instance-vpna] <strong>ipv4-family</strong>
[<span class="keyword">*</span>UPE-vpn-instance-vpna-af-ipv4] <strong>route-distinguisher 100:1</strong>
[<span class="keyword">*</span>UPE-vpn-instance-vpna-af-ipv4] <strong>vpn-target 111:1 both</strong>
[<span class="keyword">*</span>UPE-vpn-instance-vpna-af-ipv4] <strong>quit</strong>
[<span class="keyword">*</span>UPE-vpn-instance-vpna] <strong>quit</strong>
[<span class="keyword">*</span>UPE] <strong>interface gigabitethernet <span>0/2/0</span></strong>
[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/2/0</span>] <strong>ip binding vpn-instance vpna</strong>
[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/2/0</span>] <strong>ip address 10.1.1.1 24</strong>
[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong>
[<span class="keyword">*</span>UPE] <strong>commit</strong></pre>
</div>
<div class="p"># Configure the SPE.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE] <strong>ip vpn-instance vpna</strong>
[<span class="keyword">*</span>SPE-vpn-instance-vpna] <strong>ipv4-family</strong>
[<span class="keyword">*</span>SPE-vpn-instance-vpna-af-ipv4] <strong>route-distinguisher 200:1</strong>
[<span class="keyword">*</span>SPE-vpn-instance-vpna-af-ipv4] <strong>vpn-target 111:1 both</strong>
[<span class="keyword">*</span>SPE-vpn-instance-vpna-af-ipv4] <strong>quit</strong>
[<span class="keyword">*</span>SPE-vpn-instance-vpna] <strong>quit</strong>
[<span class="keyword">*</span>SPE] <strong>commit</strong></pre>
</div>
<div class="p"># Configure the NPE.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE] <strong>ip vpn-instance vpna</strong>
[<span class="keyword">*</span>NPE-vpn-instance-vpna] <strong>ipv4-family</strong>
[<span class="keyword">*</span>NPE-vpn-instance-vpna-af-ipv4] <strong>route-distinguisher 300:1</strong>
[<span class="keyword">*</span>NPE-vpn-instance-vpna-af-ipv4] <strong>vpn-target 111:1 both</strong>
[<span class="keyword">*</span>NPE-vpn-instance-vpna-af-ipv4] <strong>quit</strong>
[<span class="keyword">*</span>NPE-vpn-instance-vpna] <strong>quit</strong>
[<span class="keyword">*</span>NPE] <strong>interface gigabitethernet <span>0/2/0</span></strong>
[<span class="keyword">*</span>NPE-GigabitEthernet<span>0/2/0</span>] <strong>ip binding vpn-instance vpna</strong>
[<span class="keyword">*</span>NPE-GigabitEthernet<span>0/2/0</span>] <strong>ip address 10.2.1.1 24</strong>
[<span class="keyword">*</span>NPE-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong>
[<span class="keyword">*</span>NPE] <strong>commit</strong></pre>
</div>
<p>After the configuration is complete, run the <strong>display ip vpn-instance verbose</strong> command on the UPE and NPE to check VPN instance configurations.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>If the UPE and NPE have multiple interfaces bound to the same VPN instance, use the <strong>-a</strong> <em>source-ip-address</em> parameter to specify a source IP address when running the <strong>ping -vpn-instance</strong> <em>vpn-instance-name</em> <em><strong>-a</strong> source-ip-address dest-ip-address</em> command to ping the peer CE. If the source IP address is not specified, the ping operation may fail.</p>
</div></div>
</p></li><li><span>Establish an EBGP peer relationship between the UPE and CE1 and another one between the NPE and CE2.</span><p><div class="p"># Configure CE1.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>interface loopback 1</strong>
[<span class="keyword">*</span>CE1-LoopBack1] <strong>ip address 11.11.11.11 32</strong>
[<span class="keyword">*</span>CE1-LoopBack1] <strong>quit</strong>
[<span class="keyword">*</span>CE1] <strong>bgp 65410</strong>
[<span class="keyword">*</span>CE1-bgp] <strong>peer 10.1.1.1 as-number 100</strong>
[<span class="keyword">*</span>CE1-bgp] <strong>network 11.11.11.11 32</strong>
[<span class="keyword">*</span>CE1-bgp] <strong>quit</strong>
[<span class="keyword">*</span>CE1] <strong>commit</strong></pre>
</div>
<div class="p"># Configure the UPE.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>bgp 100</strong>
[<span class="keyword">*</span>UPE-bgp] <strong>router-id 1.1.1.1</strong>
[<span class="keyword">*</span>UPE-bgp] <strong>ipv4-family vpn-instance vpna</strong>
[<span class="keyword">*</span>UPE-bgp-vpna] <strong>peer 10.1.1.2 as-number 65410</strong>
[<span class="keyword">*</span>UPE-bgp-vpna] <strong>import-route direct</strong>
[<span class="keyword">*</span>UPE-bgp-vpna] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE-bgp-vpna] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE-bgp] <strong>quit</strong></pre>
</div>
<div class="p"># Configure CE2.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>interface loopback 1</strong>
[<span class="keyword">*</span>CE2-LoopBack1] <strong>ip address 22.22.22.22 32</strong>
[<span class="keyword">*</span>CE2-LoopBack1] <strong>quit</strong>
[<span class="keyword">*</span>CE2] <strong>bgp 65420</strong>
[<span class="keyword">*</span>CE2-bgp] <strong>peer 10.2.1.1 as-number 100</strong>
[<span class="keyword">*</span>CE2-bgp] <strong>network 22.22.22.22 32</strong>
[<span class="keyword">*</span>CE2-bgp] <strong>quit</strong>
[<span class="keyword">*</span>CE2] <strong>commit</strong></pre>
</div>
<div class="p"># Configure the NPE.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE] <strong>bgp 100</strong>
[<span class="keyword">*</span>NPE-bgp] <strong>router-id 3.3.3.3</strong>
[<span class="keyword">*</span>NPE-bgp] <strong>ipv4-family vpn-instance vpna</strong>
[<span class="keyword">*</span>NPE-bgp-vpna] <strong>peer 10.2.1.2 as-number 65420</strong>
[<span class="keyword">*</span>NPE-bgp-vpna] <strong>import-route direct</strong>
[<span class="keyword">*</span>NPE-bgp-vpna] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE-bgp-vpna] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE-bgp] <strong>quit</strong></pre>
</div>
<p>After the configuration is complete, run the <strong>display bgp vpnv4 vpn-instance peer</strong> command on the UPE and NPE to check whether BGP peer relationships have been established. If the <strong>Established</strong> state is displayed in the command output, the BGP peer relationships have been established successfully.</p>
<div class="p">The following example uses the command output on the UPE to show that a BGP peer relationship has been established between the UPE and CE1.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>display bgp vpnv4 vpn-instance vpna peer</strong>
 BGP local router ID : 1.1.1.1
 Local AS number : 100

 VPN-Instance vpna, Router ID 1.1.1.1:
 Total number of peers : 1            Peers in established state : 1

  Peer            V    AS  MsgRcvd  MsgSent    OutQ  Up/Down    State        PrefRcv
  10.1.1.2        4   65410  11     9          0     00:06:37   <strong>Established</strong>  1</pre>
</div>
</p></li><li><span>Establish an MP-IBGP peer relationship between the UPE and SPE and another one between the SPE and NPE.</span><p><div class="p"># Configure the UPE.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>bgp 100</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE-bgp] <strong>peer 2.2.2.2 as-number 100</strong>
[<span class="keyword">*</span>UPE-bgp] <strong>peer 2.2.2.2 connect-interface loopback 1</strong>
[<span class="keyword">*</span>UPE-bgp] <strong>ipv4-family vpnv4</strong>
[<span class="keyword">*</span>UPE-bgp-af-vpnv4] <strong>peer 2.2.2.2 enable</strong>
[<span class="keyword">*</span>UPE-bgp-af-vpnv4] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE-bgp-af-vpnv4] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE-bgp] <strong>quit</strong></pre>
</div>
<div class="p"># Configure the SPE.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE] <strong>bgp 100</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE-bgp] <strong>peer 1.1.1.1 as-number 100</strong>
[<span class="keyword">*</span>SPE-bgp] <strong>peer 1.1.1.1 connect-interface loopback 1</strong>
[<span class="keyword">*</span>SPE-bgp] <strong>peer 2001:DB8:2::2 as-number 100</strong>
[<span class="keyword">*</span>SPE-bgp] <strong>peer 2001:DB8:2::2 connect-interface loopback 1</strong>
[<span class="keyword">*</span>SPE-bgp] <strong>ipv4-family vpnv4</strong>
[<span class="keyword">*</span>SPE-bgp-af-vpnv4] <strong>peer 1.1.1.1 enable</strong>
[<span class="keyword">*</span>SPE-bgp-af-vpnv4] <strong>peer 2001:DB8:2::2 enable</strong>
[<span class="keyword">*</span>SPE-bgp-af-vpnv4] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE-bgp-af-vpnv4] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE-bgp] <strong>quit</strong></pre>
</div>
<div class="p"># Configure the NPE.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE] <strong>bgp 100</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE-bgp] <strong>peer 2001:DB8:1::1 as-number 100</strong>
[<span class="keyword">*</span>NPE-bgp] <strong>peer 2001:DB8:1::1 connect-interface loopback 1</strong>
[<span class="keyword">*</span>NPE-bgp] <strong>ipv4-family vpnv4</strong>
[<span class="keyword">*</span>NPE-bgp-af-vpnv4] <strong>peer 2001:DB8:1::1 enable</strong>
[<span class="keyword">*</span>NPE-bgp-af-vpnv4] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE-bgp-af-vpnv4] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE-bgp] <strong>quit</strong></pre>
</div>
<p>After the configuration is complete, run the <strong>display bgp vpnv4 all peer</strong> command on the UPE and NPE to check whether BGP peer relationships have been established. If the <strong>Established</strong> state is displayed in the command output, the BGP peer relationships have been established successfully.</p>
<div class="p">The following example uses the command output on the UPE.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>display bgp vpnv4 all peer</strong> 
 
 BGP local router ID : 1.1.1.1 
 Local AS number : 100 
 Total number of peers : 2                 Peers in established state : 2 
 
  Peer            V          AS  MsgRcvd  MsgSent  OutQ  Up/Down       State  PrefRcv 
  2.2.2.2            4         100      216      220     0 03:03:35 <strong>Established </strong>       2 
 
  Peer of IPv4-family for vpn instance : 
 
  VPN-Instance vpna, Router ID 1.1.1.1: 
  Peer            V          AS  MsgRcvd  MsgSent  OutQ  Up/Down       State  PrefRcv 
  10.1.1.2        4       65410      216      217     0 03:06:22 Established        1</pre>
</div>
</p></li><li><span>Configure SRv6 SIDs on the NPE and SPE and enable the devices to carry SIDs in VPN routes.</span><p><div class="p"># Configure the SPE.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE] <strong>segment-routing ipv6</strong>
[<span class="keyword">*</span>SPE-segment-routing-ipv6] <strong>encapsulation source-address 2001:DB8:1::1</strong>
[<span class="keyword">*</span>SPE-segment-routing-ipv6] <strong>locator as1 ipv6-prefix 2001:DB8:10:: 64 static 32</strong>
[<span class="keyword">*</span>SPE-segment-routing-ipv6-locator] <strong>opcode ::200 end no-flavor</strong>
[<span class="keyword">*</span>SPE-segment-routing-ipv6-locator] <strong>quit</strong>
[<span class="keyword">*</span>SPE-segment-routing-ipv6] <strong>quit</strong>
[<span class="keyword">*</span>SPE] <strong>bgp 100</strong>
[<span class="keyword">*</span>SPE-bgp] <strong>ipv4-family vpnv4</strong>
[<span class="keyword">*</span>SPE-bgp-af-vpnv4] <strong>peer 2001:DB8:2::2 prefix-sid</strong>
[<span class="keyword">*</span>SPE-bgp-af-vpnv4] <strong>quit</strong>
[<span class="keyword">*</span>SPE-bgp] <strong>ipv4-family vpn-instance vpna</strong>
[<span class="keyword">*</span>SPE-bgp-vpna] <strong>segment-routing ipv6 traffic-engineer best-effort</strong>
[<span class="keyword">*</span>SPE-bgp-vpna] <strong>segment-routing ipv6 locator as1</strong>
[<span class="keyword">*</span>SPE-bgp-vpna] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE-bgp-vpna] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE-bgp] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE] <strong>isis 1</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE-isis-1] <strong>segment-routing ipv6 locator as1</strong>
[<span class="keyword">*</span>SPE-isis-1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE-isis-1] <strong>quit</strong></pre>
</div>
<div class="p"># Configure the NPE.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE] <strong>segment-routing ipv6</strong>
[<span class="keyword">*</span>NPE-segment-routing-ipv6] <strong>encapsulation source-address 2001:DB8:2::2</strong>
[<span class="keyword">*</span>NPE-segment-routing-ipv6] <strong>locator as1 ipv6-prefix 2001:DB8:20:: 64 static 32</strong>
[<span class="keyword">*</span>NPE-segment-routing-ipv6-locator] <strong>opcode ::300 end no-flavor</strong>
[<span class="keyword">*</span>NPE-segment-routing-ipv6-locator] <strong>quit</strong>
[<span class="keyword">*</span>NPE-segment-routing-ipv6] <strong>quit</strong>
[<span class="keyword">*</span>NPE] <strong>bgp 100</strong>
[<span class="keyword">*</span>NPE-bgp] <strong>ipv4-family vpnv4</strong>
[<span class="keyword">*</span>NPE-bgp-af-vpnv4] <strong>peer 2001:DB8:1::1 prefix-sid</strong>
[<span class="keyword">*</span>NPE-bgp-af-vpnv4] <strong>quit</strong>
[<span class="keyword">*</span>NPE-bgp] <strong>ipv4-family vpn-instance vpna</strong>
[<span class="keyword">*</span>NPE-bgp-vpna] <strong>segment-routing ipv6 traffic-engineer best-effort</strong>
[<span class="keyword">*</span>NPE-bgp-vpna] <strong>segment-routing ipv6 locator as1</strong>
[<span class="keyword">*</span>NPE-bgp-vpna] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE-bgp-vpna] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE-bgp] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE] <strong>isis 1</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE-isis-1] <strong>segment-routing ipv6 locator as1</strong>
[<span class="keyword">*</span>NPE-isis-1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE-isis-1] <strong>quit</strong></pre>
</div>
<div class="p">Run the <strong>display segment-routing ipv6 local-sid</strong> <strong>end</strong> <strong>forwarding</strong> command to check information about the SRv6 local SID table.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE] <strong>display segment-routing ipv6 local-sid end forwarding</strong> 
                    My Local-SID End Forwarding Table 
                    --------------------------------- 
 
SID         : 2001:DB8:10::200/128                       FuncType : End 
Flavor      : NO-FLAVOR                                  SidCompress : NO   
LocatorName : as1                                        LocatorID: 1 
ProtocolType: STATIC                                     ProcessID: 1
UpdateTime  : 2021-08-30 02:50:43.171
 
SID         : 2001:DB8:10::1:0:1/128                     FuncType : End 
Flavor      : PSP                                        SidCompress : NO
LocatorName : as1                                        LocatorID: 1 
ProtocolType: ISIS                                       ProcessID: 1
UpdateTime  : 2021-08-30 01:49:56.292
 
SID         : 2001:DB8:10::1:0:2/128                     FuncType : End 
Flavor      : PSP USP USD                                SidCompress : NO
LocatorName : as1                                        LocatorID: 1 
ProtocolType: ISIS                                       ProcessID: 1
UpdateTime  : 2021-08-30 01:49:56.292
 
Total SID(s): 3</pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE] <strong>display segment-routing ipv6 local-sid end forwarding</strong> 
                    My Local-SID End Forwarding Table 
                    --------------------------------- 
 
SID         : 2001:DB8:20::300/128                       FuncType : End 
Flavor      : NO-FLAVOR                                  SidCompress : NO
LocatorName : as1                                        LocatorID: 1 
ProtocolType: STATIC                                     ProcessID: 1
UpdateTime  : 2021-08-29 03:29:43.171
 
SID         : 2001:DB8:20::1:0:1/128                     FuncType : End 
Flavor      : PSP                                        SidCompress : NO
LocatorName : as1                                        LocatorID: 1
ProtocolType: ISIS                                       ProcessID: 1
UpdateTime  : 2021-08-30 01:17:59.324
 
SID         : 2001:DB8:20::1:0:2/128                     FuncType : End 
Flavor      : PSP USP USD                                SidCompress : NO
LocatorName : as1                                        LocatorID: 1
ProtocolType: ISIS                                       ProcessID: 1
UpdateTime  : 2021-08-30 01:17:59.324
 
Total SID(s): 3</pre>
</div>
</p></li><li><span>Configure an SRv6 TE Policy.</span><p><div class="p"># Configure the SPE.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE] <strong>segment-routing ipv6</strong>  
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE-segment-routing-ipv6] <strong>segment-list list1</strong>  
[<span class="keyword">*</span>SPE-segment-routing-ipv6-segment-list-list1] <strong>index 10 sid ipv6 2001:DB8:20::300</strong> 
[<span class="keyword">*</span>SPE-segment-routing-ipv6-segment-list-list1] <strong>commit</strong> 
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE-segment-routing-ipv6-segment-list-list1] <strong>quit</strong> 
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE-segment-routing-ipv6] <strong>srv6-te-policy locator as1</strong>  
[<span class="keyword">*</span>SPE-segment-routing-ipv6] <strong>srv6-te policy policy1 endpoint 2001:DB8:2::2 color 101</strong> 
[<span class="keyword">*</span>SPE-segment-routing-ipv6-policy-policy1] <strong>binding-sid 2001:DB8:10::100</strong> 
[<span class="keyword">*</span>SPE-segment-routing-ipv6-policy-policy1] <strong>candidate-path preference 100</strong> 
[<span class="keyword">*</span>SPE-segment-routing-ipv6-policy-policy1-path] <strong>segment-list list1</strong>  
[<span class="keyword">*</span>SPE-segment-routing-ipv6-policy-policy1-path] <strong>commit</strong> 
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE-segment-routing-ipv6-policy-policy1-path] <strong>quit</strong> 
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE-segment-routing-ipv6-policy-policy1] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE-segment-routing-ipv6] <strong>quit</strong></pre>
</div>
</p><p><div class="p"># Configure the NPE.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE] <strong>segment-routing ipv6</strong>  
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE-segment-routing-ipv6] <strong>segment-list list1</strong>  
[<span class="keyword">*</span>NPE-segment-routing-ipv6-segment-list-list1] <strong>index 10 sid ipv6 2001:DB8:10::200</strong> 
[<span class="keyword">*</span>NPE-segment-routing-ipv6-segment-list-list1] <strong>commit</strong> 
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE-segment-routing-ipv6-segment-list-list1] <strong>quit</strong> 
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE-segment-routing-ipv6] <strong>srv6-te-policy locator as1</strong>  
[<span class="keyword">*</span>NPE-segment-routing-ipv6] <strong>srv6-te policy policy1 endpoint 2001:DB8:1::1 color 101</strong> 
[<span class="keyword">*</span>NPE-segment-routing-ipv6-policy-policy1] <strong>binding-sid 2001:DB8:20::200</strong> 
[<span class="keyword">*</span>NPE-segment-routing-ipv6-policy-policy1] <strong>candidate-path preference 100</strong> 
[<span class="keyword">*</span>NPE-segment-routing-ipv6-policy-policy1-path] <strong>segment-list list1</strong>  
[<span class="keyword">*</span>NPE-segment-routing-ipv6-policy-policy1-path] <strong>commit</strong> 
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE-segment-routing-ipv6-policy-policy1-path] <strong>quit</strong> 
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE-segment-routing-ipv6-policy-policy1] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE-segment-routing-ipv6] <strong>quit</strong></pre>
</div>
<p>After the configuration is complete, run the <strong>display srv6-te policy</strong> command to check SRv6 TE Policy information.</p>
<div class="p">The following example uses the command output on the SPE.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE] <strong>display srv6-te policy </strong> 
PolicyName : policy1 
Color                   : 101                            Endpoint             : 2001:DB8:2::2 
TunnelId                : 1                              
TunnelType              : SRv6-TE Policy                 DelayTimerRemain     : - 
Policy State            : Up                             State Change Time    : 2020-04-02 01:18:25
Admin State             : Up                             Traffic Statistics   : Disable 
Backup Hot-Standby      : Disable                        BFD                  : Disable 
Interface Index         : -                              Interface Name       : - 
Interface State         : -                              Encapsulation Mode   : Insert
Binding SID             : 2001:DB8:10::100(Insert, Preferred)
Candidate-path Count    : 1

 Candidate-path Preference : 100
 Path State             : Active                         Path Type            : Primary 
 Protocol-Origin        : Configuration(30)              Originator           : 0, 0.0.0.0 
 Discriminator          : 100                            Binding SID          : 2001:DB8:10::100 
 GroupId                : 1                              Policy Name          : policy1
 Template ID            : 0                              Path Verification    : Disable
 DelayTimerRemain       : -                              Network Slice ID     : - 
 Segment-List Count     : 1 
  Segment-List          : list1 
   Segment-List ID      : 1                              XcIndex              : 1   
   List State           : Up                             DelayTimerRemain     : -  
   Verification State   : -                              SuppressTimeRemain   : -   
   PMTU                 : 9600                           Active PMTU          : 9600
   Weight               : 1                              BFD State            : -
   Loop Detection State : Up                             BFD Delay Remain     : - 
   Network Slice ID     : -
   Binding SID          : -
   Reverse Binding ID   : -
   SID :  
         2001:DB8:20::300</pre>
</div>
</p></li><li><span>Configure a tunnel policy to import traffic.</span><p><div class="p"># Configure the SPE.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE] <strong>route-policy p1 permit node 10</strong> 
[<span class="keyword">*</span>SPE-route-policy] <strong>apply extcommunity color 0:101</strong> 
[<span class="keyword">*</span>SPE-route-policy] <strong>quit</strong> 
[<span class="keyword">*</span>SPE] <strong>bgp 100</strong> 
[<span class="keyword">*</span>SPE-bgp] <strong>ipv4-family vpnv4</strong> 
[<span class="keyword">*</span>SPE-bgp-af-vpnv4] <strong>peer 2001:DB8:2::2 route-policy p1 import</strong>  
[<span class="keyword">*</span>SPE-bgp-af-vpnv4] <strong>quit</strong> 
[<span class="keyword">*</span>SPE-bgp] <strong>quit</strong> 
[<span class="keyword">*</span>SPE] <strong>tunnel-policy p1</strong> 
[<span class="keyword">*</span>SPE-tunnel-policy-p1] <strong>tunnel select-seq ipv6 srv6-te-policy load-balance-number 1</strong> 
[<span class="keyword">*</span>SPE-tunnel-policy-p1] <strong>quit</strong> 
[<span class="keyword">*</span>SPE] <strong>ip vpn-instance vpna</strong> 
[<span class="keyword">*</span>SPE-vpn-instance-vpna] <strong>ipv4-family</strong>
[<span class="keyword">*</span>SPE-vpn-instance-vpna-af-ipv4] <strong>tnl-policy p1</strong> 
[<span class="keyword">*</span>SPE-vpn-instance-vpna-af-ipv4] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE-vpn-instance-vpna-af-ipv4] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE-vpn-instance-vpna] <strong>quit</strong></pre>
</div>
<div class="p"># Configure the NPE.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE] <strong>route-policy p1 permit node 10</strong> 
[<span class="keyword">*</span>NPE-route-policy] <strong>apply extcommunity color 0:101</strong> 
[<span class="keyword">*</span>NPE-route-policy] <strong>quit</strong> 
[<span class="keyword">*</span>NPE] <strong>bgp 100</strong> 
[<span class="keyword">*</span>NPE-bgp] <strong>ipv4-family vpnv4</strong> 
[<span class="keyword">*</span>NPE-bgp-af-vpnv4] <strong>peer 2001:DB8:1::1 route-policy p1 import</strong>  
[<span class="keyword">*</span>NPE-bgp-af-vpnv4] <strong>quit</strong> 
[<span class="keyword">*</span>NPE-bgp] <strong>quit</strong> 
[<span class="keyword">*</span>NPE] <strong>tunnel-policy p1</strong> 
[<span class="keyword">*</span>NPE-tunnel-policy-p1] <strong>tunnel select-seq ipv6 srv6-te-policy load-balance-number 1</strong> 
[<span class="keyword">*</span>NPE-tunnel-policy-p1] <strong>quit</strong> 
[<span class="keyword">*</span>NPE] <strong>ip vpn-instance vpna</strong> 
[<span class="keyword">*</span>NPE-vpn-instance-vpna] <strong>ipv4-family</strong>
[<span class="keyword">*</span>NPE-vpn-instance-vpna-af-ipv4] <strong>tnl-policy p1</strong> 
[<span class="keyword">*</span>NPE-vpn-instance-vpna-af-ipv4] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE-vpn-instance-vpna-af-ipv4] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE-vpn-instance-vpna] <strong>quit</strong></pre>
</div>
<p>After the configuration is complete, run the <strong>display ip routing-table vpn-instance vpna</strong> command to check the routing table of the VPN instance. The command output shows that the corresponding route has successfully recursed to the SRv6 TE Policy.</p>
<div class="p">The following example uses the command output on the SPE.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE] <strong>display ip routing-table vpn-instance vpna</strong>  
Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route 
------------------------------------------------------------------------------ 
Routing Table : vpna 
         Destinations : 6        Routes : 6          
 
Destination/Mask    Proto   Pre  Cost        Flags NextHop         Interface 
 
       10.1.1.0/24  Direct  0    0             D   1.1.1.1         GigabitEthernet<span>0/1/0</span> 
       10.2.1.0/24  IBGP    255  0             RD  2001:DB8:2::2   <strong>policy1 </strong>
    11.11.11.11/32  EBGP    255  0             RD  1.1.1.1         GigabitEthernet<span>0/1/0</span> 
    22.22.22.22/32  IBGP    255  0             RD  2001:DB8:2::2   <strong>policy1 </strong>
      127.0.0.0/8   Direct  0    0             D   127.0.0.1       InLoopBack0 
255.255.255.255/32  Direct  0    0             D   127.0.0.1       InLoopBack0</pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE] <strong>display ip routing-table vpn-instance vpna 22.22.22.22 verbose</strong>  
Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route 
------------------------------------------------------------------------------ 
Routing Table : vpna 
Summary Count : 1 
 
Destination: 22.22.22.22/32       
     Protocol: IBGP               Process ID: 0               
   Preference: 255                      Cost: 0               
      NextHop: 2001:DB8:2::2       Neighbour: 2001:DB8:2::2 
        State: Active Adv Relied         Age: 00h03m15s            
          Tag: 0                    Priority: low             
        Label: 3                     QoSInfo: 0x0            
   IndirectID: 0x10000E0            Instance:                                  
 RelayNextHop: 2001:DB8:2::2        Interface: <strong>policy1 </strong>
     TunnelID: 0x000000003400000001    Flags: RD 
   RouteColor: 0  </pre>
</div>
</p></li><li><span>Specify the UPE as the peer of the SPE and configure the SPE to advertise the default route to the UPE.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE] <strong>bgp 100</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE-bgp] <strong>ipv4-family vpnv4</strong>
[<span class="keyword">*</span>SPE-bgp-af-vpnv4] <strong>peer 1.1.1.1 upe</strong>
[<span class="keyword">*</span>SPE-bgp-af-vpnv4] <strong>peer 1.1.1.1 default-originate vpn-instance vpna</strong>
[<span class="keyword">*</span>SPE-bgp-af-vpnv4] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE-bgp-af-vpnv4] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE-bgp] <strong>quit</strong></pre>
</p></li><li><span>Configure the SPE to advertise regenerated routes to the NPE.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE] <strong>bgp 100</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE-bgp] <strong>ipv4-family vpn-instance vpna</strong>
[<span class="keyword">*</span>SPE-bgp-vpna] <strong>advertise best-route route-reoriginate</strong>
[<span class="keyword">*</span>SPE-bgp-vpna]<strong> commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE-bgp-vpna]<strong> quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE-bgp] <strong>ipv4-family vpnv4</strong>
[<span class="keyword">*</span>SPE-bgp-af-vpnv4] <strong>peer 2001:DB8:2::2 advertise route-reoriginated vpnv4</strong>
[<span class="keyword">*</span>SPE-bgp-af-vpnv4] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE-bgp-af-vpnv4] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE-bgp] <strong>quit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><div class="p"># Check the routing tables of the SPE and NPE.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE]<strong> display bgp vpnv4 all routing-table 10.1.1.2 </strong>
 BGP local router ID : 2.2.2.2
 Local AS number : 100
 
 Total routes of Route Distinguisher(100:1): 1
 BGP routing table entry information of 10.1.1.0/24:
 Label information (Received/Applied): 48060/NULL
 From: 1.1.1.1 (10.1.1.2)  
 Route Duration: 0d01h06m07s
 Relay IP Nexthop: 11.11.11.1
 Relay IP Out-Interface: GigabitEthernet<span>0/1/0</span>
 Relay Tunnel Out-Interface: GigabitEthernet<span>0/1/0</span>
 Original nexthop: 1.1.1.1
 Qos information : 0x0
 Ext-Community: RT &lt;111 : 1&gt;
 AS-path Nil, origin incomplete, MED 0, localpref 100, pref-val 0, valid, internal, best, select, pre 255, IGP cost 10
 Not advertised to any peer yet
 
 Total routes of Route Distinguisher(200:1): 1
 BGP routing table entry information of 10.1.1.0/24:
 From: 1.1.1.1 (10.1.1.2)  
 Route Duration: 0d00h10m13s
 Relay Tunnel Out-Interface: GigabitEthernet<span>0/1/0</span>
 Original nexthop: 0.0.0.0
 Qos information : 0x0
 Ext-Community: RT &lt;111 : 1&gt;
 AS-path Nil, origin incomplete, MED 0, localpref 100, pref-val 0, valid, internal, best, select, pre 255, reoriginated, IGP cost 10
 Advertised to such 1 peers:
    2001:DB8:2::2
    
 VPN-Instance 1, Router ID 2.2.2.2:
 
 Total Number of Routes: 1
 BGP routing table entry information of 10.1.1.0/24:
 Route Distinguisher: 100:1
 Remote-Cross route
 Label information (Received/Applied): 48060/NULL
 From: 1.1.1.1 (10.1.1.2)  
 Route Duration: 0d00h10m40s
 Relay Tunnel Out-Interface: GigabitEthernet<span>0/1/0</span>
 Original nexthop: 1.1.1.1
 Qos information : 0x0
 Ext-Community: RT &lt;111 : 1&gt;
 AS-path Nil, origin incomplete, MED 0, localpref 100, pref-val 0, valid, internal, best, select, pre 255, IGP cost 10
 Not advertised to any peer yet</pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>display ip routing-table vpn-instance vpna</strong>  
Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route 
------------------------------------------------------------------------------ 
Routing Table : vpna 
         Destinations : 7        Routes : 7          
 
Destination/Mask    Proto   Pre  Cost        Flags NextHop         Interface 
 
       <strong>0.0.0.0/24</strong>   IBGP    255  0             RD  2.2.2.2         GigabitEthernet<span>0/2/0</span> 
      10.1.1.0/24   Direct  0    0             D   10.1.1.1        GigabitEthernet<span>0/1/0</span> 
      10.1.1.1/32   Direct  0    0             D   127.0.0.1       GigabitEthernet<span>0/1/0</span> 
    10.1.1.255/24   Direct  0    0             D   127.0.0.1       GigabitEthernet<span>0/1/0</span><strong>  </strong>
   11.11.11.11/32   EBGP    255  0             RD  10.1.1.2        GigabitEthernet<span>0/1/0</span> 
      127.0.0.0/8   Direct  0    0             D   127.0.0.1       InLoopBack0 
255.255.255.255/32  Direct  0    0             D   127.0.0.1       InLoopBack0</pre>
</div>
<p># Check that CE1 can ping CE2 successfully.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1]<strong> ping -a 11.11.11.11 22.22.22.22</strong>
  PING 22.22.22.22: 56  data bytes, press CTRL_C to break
    Reply from 22.22.22.22: bytes=56 Sequence=1 ttl=252 time=131 ms
    Reply from 22.22.22.22: bytes=56 Sequence=2 ttl=252 time=12 ms
    Reply from 22.22.22.22: bytes=56 Sequence=3 ttl=252 time=14 ms
    Reply from 22.22.22.22: bytes=56 Sequence=4 ttl=252 time=14 ms
    Reply from 22.22.22.22: bytes=56 Sequence=5 ttl=252 time=12 ms

  --- 22.22.22.22 ping statistics ---
    5 packet(s) transmitted
    5 packet(s) received
    0.00% packet loss
    round-trip min/avg/max = 12/36/131 ms</pre>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0227026921__example764102717246"><a name="EN-US_TASK_0227026921__example764102717246"></a><a name="example764102717246"></a><a name="EN-US_TASK_0227026921__1.3.4"></a><a name="1.3.4"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li>UPE configuration file<pre class="screen"># 
sysname UPE
#
ip vpn-instance vpna
 ipv4-family
  route-distinguisher 100:1
  apply-label per-instance
  vpn-target 111:1 export-extcommunity
  vpn-target 111:1 import-extcommunity
#
mpls lsr-id 1.1.1.1
#
mpls
#
mpls ldp
 #
 ipv4-family
#
isis 1
 is-level level-1
 cost-style wide
 mpls ldp auto-config
 network-entity 10.0000.0000.0001.00
 #
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.2.1 255.255.255.0
 isis enable 1
 mpls
 mpls ldp
 dcn
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip binding vpn-instance vpna
 ip address 10.1.1.1 255.255.255.0
#
interface LoopBack1
 ip address 1.1.1.1 255.255.255.255
 isis enable 1
#
bgp 100
 router-id 1.1.1.1
 peer 2.2.2.2 as-number 100
 peer 2.2.2.2 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 2.2.2.2 enable
 #
 ipv4-family vpnv4
  policy vpn-target
  peer 2.2.2.2 enable
 #
 ipv4-family vpn-instance vpna
  import-route direct
  peer 10.1.1.2 as-number 65410
#
return</pre>
</li><li>SPE configuration file<pre class="screen"># 
sysname SPE
#
ip vpn-instance vpna
 ipv4-family
  route-distinguisher 200:1
  apply-label per-instance
  tnl-policy p1
  vpn-target 111:1 export-extcommunity
  vpn-target 111:1 import-extcommunity
#
mpls lsr-id 2.2.2.2
#
mpls
#
mpls ldp
 #
 ipv4-family
#
segment-routing ipv6
 encapsulation source-address 2001:DB8:1::1
 locator as1 ipv6-prefix 2001:DB8:10:: 64 static 32
  opcode ::200 end no-flavor
 srv6-te-policy locator as1
 segment-list list1
  index 10 sid ipv6 2001:DB8:20::300
 srv6-te policy policy1 endpoint 2001:DB8:2::2 color 101
  binding-sid 2001:DB8:10::100
  candidate-path preference 100
   segment-list list1
#
isis 1
 is-level level-1
 cost-style wide
 mpls ldp auto-config
 network-entity 10.0000.0000.0002.00
 #
 ipv6 enable topology ipv6
 segment-routing ipv6 locator as1
 #
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.2.2 255.255.255.0
 isis enable 1
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ipv6 enable
 ipv6 address 2001:DB8:2001::1/96
 isis ipv6 enable 1
#
interface LoopBack1
 ipv6 enable
 ip address 2.2.2.2 255.255.255.255
 ipv6 address 2001:DB8:1::1/128
 isis enable 1
 isis ipv6 enable 1
#
bgp 100
 peer 1.1.1.1 as-number 100
 peer 1.1.1.1 connect-interface LoopBack1
 peer 2001:DB8:2::2 as-number 100
 peer 2001:DB8:2::2 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 1.1.1.1 enable
 #
 ipv4-family vpnv4
  policy vpn-target
  peer 1.1.1.1 enable
  peer 1.1.1.1 upe
  peer 1.1.1.1 default-originate vpn-instance vpna
  peer 2001:DB8:2::2 enable
  peer 2001:DB8:2::2 route-policy p1 import
  peer 2001:DB8:2::2 prefix-sid
  peer 2001:DB8:2::2 advertise route-reoriginated vpnv4
 #
 ipv4-family vpn-instance vpna
  advertise best-route route-reoriginate
  segment-routing ipv6 locator as1
  segment-routing ipv6 traffic-engineer best-effort
#
route-policy p1 permit node 10
 apply extcommunity color 0:101
#
tunnel-policy p1
 tunnel select-seq ipv6 srv6-te-policy load-balance-number 1
#
return</pre>
</li><li>NPE configuration file<pre class="screen"># 
sysname NPE
# 
ip vpn-instance vpna 
 ipv4-family 
  route-distinguisher 300:1
  apply-label per-instance 
  tnl-policy p1 
  vpn-target 111:1 export-extcommunity 
  vpn-target 111:1 import-extcommunity 
#                
segment-routing ipv6 
 encapsulation source-address 2001:DB8:2::2 
 locator as1 ipv6-prefix 2001:DB8:20:: 64 static 32
  opcode ::300 end no-flavor
 srv6-te-policy locator as1 
 segment-list list1 
  index 10 sid ipv6 2001:DB8:10::200
 srv6-te policy policy1 endpoint 2001:DB8:1::1 color 101 
  binding-sid 2001:DB8:20::200 
  candidate-path preference 100 
   segment-list list1  
#                
isis 1           
 is-level level-1 
 cost-style wide 
 network-entity 10.0000.0000.0003.00 
 #               
 ipv6 enable topology ipv6 
 segment-routing ipv6 locator as1 
 #               
#                
interface GigabitEthernet<span>0/1/0</span> 
 undo shutdown   
 ipv6 enable     
 ipv6 address 2001:DB8:2001::2/96 
 isis ipv6 enable 1 
#                
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown   
 ip binding vpn-instance vpna 
 ip address 10.2.1.1 255.255.255.0 
#                
interface LoopBack1 
 ipv6 enable     
 ip address 3.3.3.3 255.255.255.255 
 ipv6 address 2001:DB8:2::2/128 
 isis ipv6 enable 1 
#                
bgp 100          
 router-id 3.3.3.3 
 peer 2001:DB8:1::1 as-number 100 
 peer 2001:DB8:1::1 connect-interface LoopBack1 
 #               
 ipv4-family unicast 
  undo synchronization 
 #               
 ipv4-family vpnv4 
  policy vpn-target 
  peer 2001:DB8:1::1 enable 
  peer 2001:DB8:1::1 route-policy p1 import 
  peer 2001:DB8:1::1 prefix-sid 
 #               
 ipv4-family vpn-instance vpna 
  import-route direct 
  segment-routing ipv6 locator as1 
  segment-routing ipv6 traffic-engineer<strong> </strong>best-effort 
  peer 10.2.1.2 as-number 65420 
#                
route-policy p1 permit node 10 
 apply extcommunity color 0:101 
#                
tunnel-policy p1 
 tunnel select-seq ipv6 srv6-te-policy load-balance-number 1 
#                
return</pre>
</li><li>CE1 configuration file<pre class="screen">#
sysname CE1
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.1.2 255.255.255.0
#
interface LoopBack1
 ip address 11.11.11.11 255.255.255.255
#
bgp 65410
 peer 10.1.1.1 as-number 100
 #
 ipv4-family unicast
  undo synchronization
  network 11.11.11.11 255.255.255.255
  peer 10.1.1.1 enable
#
return</pre>
</li><li>CE2 configuration file<pre class="screen"># 
sysname CE2 
# 
interface GigabitEthernet<span>0/1/0</span> 
 undo shutdown 
 ip address 10.2.1.2 255.255.255.0 
# 
interface LoopBack1 
 ip address 22.22.22.22 255.255.255.255 
# 
bgp 65420 
 peer 10.2.1.1 as-number 100 
 #
 ipv4-family unicast 
  undo synchronization 
  network 22.22.22.22 255.255.255.255 
  peer 10.2.1.1 enable 
# 
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_srv6_cfg_all_0101.html">Configuration Examples for SRv6 TE Policy (IS-IS)
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_srv6_cfg_all_0226.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_srv6_cfg_all_0283.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>

<script language="JavaScript">
<!--
image_size('.imgResize');
var msg_imageMax = "view original image";
var msg_imageClose = "close";
//--></script></body>
</html>