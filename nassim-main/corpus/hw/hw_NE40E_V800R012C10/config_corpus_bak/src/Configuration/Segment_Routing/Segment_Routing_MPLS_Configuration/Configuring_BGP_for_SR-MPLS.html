
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring BGP for SR-MPLS">
<meta name="abstract" content="A controller orchestrates IGP SIDs and BGP SR-allocated BGP peer SIDs to implement inter-AS forwarding over the optimal path.">
<meta name="description" content="A controller orchestrates IGP SIDs and BGP SR-allocated BGP peer SIDs to implement inter-AS forwarding over the optimal path.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_sr_all_cfg_0000.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_sr_all_cfg_0023.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_sr_all_cfg_0034.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="segment_routing_vrp,w00604599,l00455378,l00587852,w00606909,w00800033">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="Segment Routing MPLS">
<meta name="featuretype" content="Segment Routing">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="Segment Routing MPLS">
<meta name="featuretype" content="Segment Routing">
<meta name="featurename" content="Segment Routing MPLS">
<meta name="featuretype" content="Segment Routing">
<meta name="OWNER" content="l00468467">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00468467">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172368811">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring BGP for SR-MPLS</title>
</head>
<body><a name="EN-US_TASK_0172368811"></a><a name="EN-US_TASK_0172368811"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring BGP for SR-MPLS</h1>
<div class="taskbody"><p>A controller orchestrates IGP SIDs and BGP SR-allocated BGP peer SIDs to implement inter-AS forwarding over the optimal path.</p>
<div class="context"><a name="EN-US_TASK_0172368811__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>BGP is a dynamic routing protocol used between ASs. BGP SR is a BGP extension for SR and is used for inter-AS source routing.</p>
<p>BGP SR uses BGP egress peer engineering (EPE) to allocate Peer-Node and Peer-Adj SIDs to peers<span> or Peer-Set SIDs to peer groups</span>. These SIDs can be reported to the controller through BGP-LS for orchestrating E2E SR-MPLS TE tunnels.</p>
</div></div>
<div class="steps-unordered"><a name="EN-US_TASK_0172368811__1.4.2"></a><a name="1.4.2"></a><h4 class="sectiontitle">Procedure</h4>
<ul><li><span>Configure MPLS on ASBRs.</span><ol><li><span>Run the <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a> command to enter the system view.</span></li><li><span>Run the <a href="cmdqueryname=mpls+lsr-id"><b><span class="cmdname">mpls lsr-id</span></b></a> <i><span class="varname">lsr-id</span></i> command to configure an LSR ID for the local node.</span></li><li><span>Run the <a href="cmdqueryname=mpls"><b><span class="cmdname">mpls</span></b></a> command to enter the MPLS view.</span></li><li><span>(Optional) Run the <a href="cmdqueryname=mpls+te"><b><span class="cmdname">mpls te</span></b></a> command to enable MPLS TE globally on the local node.</span></li><li><span>Run the <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a> command to return to the system view.</span></li><li><span>Run the <a href="cmdqueryname=interface"><b><span class="cmdname">interface</span></b></a> <i><span class="varname">interface-type interface-number</span></i> command to enter the view of the interface connecting the ASBRs.</span></li><li><span>Run the <a href="cmdqueryname=mpls"><b><span class="cmdname">mpls</span></b></a> command to enable MPLS on the interface.</span></li><li><span>(Optional) Run the <a href="cmdqueryname=mpls+te"><b><span class="cmdname">mpls te</span></b></a> command to enable MPLS TE on the interface.</span></li><li><span>Run the <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a> command to return to the system view.</span></li></ol>
</li><li><span>Configure BGP EPE.</span><ol><li class="substepexpand"><span>Run <a href="cmdqueryname=segment-routing"><b><span class="cmdname">segment-routing</span></b></a></span><p><p>SR is enabled.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Return to the system view.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> { <i><span class="varname">as-number-plain</span></i> | <i><span class="varname">as-number-dot</span></i> }</span><p><p>BGP is enabled, and the BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer+as-number"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <strong><span>as-number</span></strong> { <i><span class="varname">as-number-plain</span></i> | <i><span class="varname">as-number-dot</span></i> }</span><p><p>A BGP peer is created.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer+egress-engineering"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <strong><span>egress-engineering</span></strong><span> [ <strong><span>label</span></strong> <i><span class="varname">static-label</span></i> ]</span></span><p><p>BGP EPE is enabled.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer+egress-engineering"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <strong><span>egress-engineering</span></strong><span> <strong><span>link-down</span></strong> { <strong><span>relate-bfd-state</span></strong> | <strong><span>label-pop</span></strong> }</span></span><p><p>BGP EPE link fault association is enabled.</p>
</p><p><p>The <span><strong><span>relate-bfd-state</span></strong></span> and <span><strong><span>label-pop</span></strong></span> parameters are mutually exclusive. Therefore, you can configure only one of them.</p>
<ul><li>With the <span><strong><span>relate-bfd-state</span></strong></span> parameter configured, if the inter-AS link corresponding to a BGP EPE label fails, BGP EPE triggers SBFD for SR-MPLS TE tunnel in the local AS to go down. This enables the ingress of the involved SR-MPLS TE tunnel to rapidly detect the failure and switch traffic to another normal tunnel.</li><li>With the <span><strong><span>label-pop</span></strong></span> parameter configured, if the inter-AS link corresponding to a BGP EPE label fails, the ASBR in the local AS pops the BGP EPE label from the received data packet and searches the IP routing table based on the destination address of the packet for forwarding.</li></ul>
</p></li><li class="substepexpand"><span>(Optional) Configure a peer set.</span><p><ol type="a"><li><p>Run <a href="cmdqueryname=egress-engineering+peer-set"><b><span class="cmdname">egress-engineering peer-set</span></b></a> <i><span class="varname">peer-set-name</span></i> [ <strong><span>label</span></strong> <i><span class="varname">static-label</span></i> ]</p>
<p>A BGP peer set is created.</p>
</li><li><p>Run <a href="cmdqueryname=peer+peer-set"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <strong><span>peer-set</span></strong> <strong><span>name</span></strong> <i><span class="varname">peer-set-name</span></i></p>
<p>A specified peer is added to the BGP peer set.</p>
</li><li>Run <a href="cmdqueryname=egress-engineering+peer-set"><b><span class="cmdname">egress-engineering peer-set</span></b></a> <i><span class="varname">peer-set-name</span></i> <strong><span>link-down</span></strong> { <strong><span>relate-bfd-state</span></strong> | <strong><span>label-pop</span></strong> }<p>Link fault association is configured for the BGP peer set.</p>
</li></ol>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=egress-engineering+confederation-id+compatible"><b><span class="cmdname">egress-engineering confederation-id compatible</span></b></a></span><p><p>The device is configured to modify the BGP-LS packet format and fill the member AS number in the AS field of the BGP-LS route prefix in a BGP EPE confederation scenario.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=egress-engineering+traffic-statistics+enable"><b><span class="cmdname">egress-engineering traffic-statistics enable</span></b></a></span><p><p>BGP EPE traffic statistics collection is enabled.</p>
</p><p><p>To clear traffic statistics for re-collection, run the <a href="cmdqueryname=reset+bgp+egress-engineering+traffic-statistics"><b><span class="cmdname">reset bgp egress-engineering traffic-statistics</span></b></a> command.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Return to the system view</p>
</p></li></ol>
</li><li><span>Configure BGP-LS.</span><p><p>BGP-LS provides a simple and efficient method of collecting topology information. You must configure a BGP-LS peer relationship between the controller and forwarder, so that topology information can be properly reported from the forwarder to the controller. This example provides the procedure for configuring a BGP-LS peer relationship on the forwarder. The procedure on the controller is similar to that on the forwarder.</p>
</p><ol><li class="substepexpand"><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> { <i><span class="varname">as-number-plain</span></i> | <i><span class="varname">as-number-dot</span></i> }</span><p><p>BGP is enabled, and the BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer+as-number"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <strong><span>as-number</span></strong> <i><span class="varname">as-number-plain</span></i></span><p><p>A BGP peer is created.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=link-state-family+unicast"><b><span class="cmdname">link-state-family unicast</span></b></a></span><p><p>BGP-LS is enabled, and the BGP-LS address family view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer+enable"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">group-name</span></i> | <i><span class="varname">ipv4-address</span></i> } <strong><span>enable</span></strong></span><p><p>The device is enabled to exchange BGP-LS routing information with a specified peer or peer group.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li></ul></div>
<div class="example"><a name="EN-US_TASK_0172368811__1.4.3"></a><a name="1.4.3"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p>After configuring BGP SR, run the <a href="cmdqueryname=display+bgp+egress-engineering"><b><span class="cmdname">display bgp egress-engineering</span></b></a> command to check BGP EPE information and determine whether the configuration succeeds.</p>
<p>After BGP EPE traffic statistics collection is enabled, you can run the <a href="cmdqueryname=display+bgp+egress-engineering+traffic-statistics+outbound"><b><span class="cmdname">display bgp egress-engineering traffic-statistics outbound</span></b></a> command to check the outgoing traffic and the <a href="cmdqueryname=display+bgp+egress-engineering+traffic-statistics+inbound"><b><span class="cmdname">display bgp egress-engineering traffic-statistics inbound</span></b></a> command to check the incoming traffic.</p>
<p></p>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_sr_all_cfg_0000.html">Segment Routing MPLS Configuration
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_sr_all_cfg_0023.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_sr_all_cfg_0034.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>