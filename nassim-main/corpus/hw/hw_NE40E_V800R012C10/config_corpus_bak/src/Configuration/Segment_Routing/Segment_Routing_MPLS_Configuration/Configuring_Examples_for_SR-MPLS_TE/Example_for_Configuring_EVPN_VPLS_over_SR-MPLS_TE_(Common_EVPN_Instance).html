
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring EVPN VPLS over SR-MPLS TE (Common EVPN Instance)">
<meta name="abstract" content="This section provides an example for configuring an SR-MPLS TE tunnel to carry EVPN VPLS services.">
<meta name="description" content="This section provides an example for configuring an SR-MPLS TE tunnel to carry EVPN VPLS services.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_sr-te_cfg_0090.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_sr_all_cfg_0160.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_sr_all_cfg_0164.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00606909,l00587852">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="Segment Routing MPLS">
<meta name="featuretype" content="Segment Routing">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="Segment Routing MPLS">
<meta name="featuretype" content="Segment Routing">
<meta name="featurename" content="Segment Routing MPLS">
<meta name="featuretype" content="Segment Routing">
<meta name="featurename" content="Segment Routing MPLS">
<meta name="featuretype" content="Segment Routing">
<meta name="OWNER" content="l00425560">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00468467">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0316006786">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/thickbox.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/imageResize.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery-migrate-1.2.1.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery-ui.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery.mousewheel.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/thickbox.js"></script>
<title>Example for Configuring EVPN VPLS over SR-MPLS TE (Common EVPN Instance)</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0316006786"></a><a name="EN-US_TASK_0316006786"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring EVPN VPLS over SR-MPLS TE (Common EVPN Instance)</h1>
<div class="taskbody"><p>This section provides an example for configuring an SR-MPLS TE tunnel to carry EVPN VPLS services.</p>
<div class="context"><a name="EN-US_TASK_0316006786__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>To allow different sites to communicate over the backbone network shown in <a href="#EN-US_TASK_0316006786__en-us_task_0172370670_fig_dc_vrp_dci_cfg_003501">Figure 1</a>, configure EVPN to achieve Layer 2 service transmission. If the sites belong to the same subnet, create an EVPN instance on each PE to store EVPN routes and implement Layer 2 forwarding based on matching MAC addresses. In this example, an SR-MPLS TE tunnel needs to be used to transmit services between the PEs.</p>
<div class="fignone" id="EN-US_TASK_0316006786__en-us_task_0172370670_fig_dc_vrp_dci_cfg_003501"><a name="EN-US_TASK_0316006786__en-us_task_0172370670_fig_dc_vrp_dci_cfg_003501"></a><a name="en-us_task_0172370670_fig_dc_vrp_dci_cfg_003501"></a><span class="figcap"><b>Figure 1 </b>EVPN VPLS over SR-MPLS TE networking</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interface 1, interface 2, and sub-interface 1.1 in this example represent GE <span>0/1/0</span>, GE <span>0/2/0</span>, and GE <span>0/1/0</span>.1, respectively.</p>
</div></div>
<br><span><img class="imgResize" src="figure/en-us_image_0316006789.png" width="521.072335546875" height="348.983879276025" title="Click to enlarge"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0316006786__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Precautions</h4><p>During the configuration, note the following:</p>
<ul><li><p>Using the local loopback address of each PE as the source address of the PE is recommended.</p>
</li><li>This example uses an explicit path with specified adjacency SIDs to establish the SR-MPLS TE tunnel. Adjacency SIDs that are dynamically generated may change after a device restart, meaning that they need to be reconfigured if adjacency SIDs are specified for the involved explicit path and the involved device is restarted. To facilitate the use of explicit paths, you are advised to run the <strong>ipv4 adjacency</strong> command to manually configure adjacency SIDs for such paths.</li></ul>
</div></div>
<div class="context"><a name="EN-US_TASK_0316006786__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure IP addresses for interfaces.</p>
</li><li><p>Configure an IGP to enable PE1, PE2, and the P to communicate with each other.</p>
</li><li><p>Configure an SR-MPLS TE tunnel on the backbone network.</p>
</li><li><p>Configure an EVPN instance on each PE.</p>
</li><li><p>Configure an EVPN source address on each PE.</p>
</li><li><p>Configure Layer 2 Ethernet sub-interfaces connecting the PEs to the CEs.</p>
</li><li><p>Configure and apply a tunnel policy to enable EVPN service recursion to the SR-MPLS TE tunnel.</p>
</li><li><p>Establish a BGP EVPN peer relationship between the PEs.</p>
</li><li><p>Configure the CEs to communicate with the PEs.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0316006786__1.4.4"></a><a name="1.4.4"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>EVPN instance name: evrf1</p>
</li><li><p>RDs (100:1 and 200:1) and RT (1:1) of the EVPN instance evrf1 on PE1 and PE2</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0316006786__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure addresses for interfaces connecting the PEs and the P according to <a href="#EN-US_TASK_0316006786__en-us_task_0172370670_fig_dc_vrp_dci_cfg_003501">Figure 1</a>.</span><p><p># Configure PE1.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname PE1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack1] <strong>ip address 1.1.1.1 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> interface gigabitethernet<span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>ip address 10.1.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure the P.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname P</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-LoopBack1] <strong>ip address 2.2.2.2 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P]<strong> interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/0</span>] <strong>ip address 10.1.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P]<strong> interface gigabitethernet<span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/2/0</span>] <strong>ip address 10.2.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname PE2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-LoopBack1] <strong>ip address 3.3.3.3 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> interface gigabitethernet<span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>]<strong> ip address 10.2.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> commit</strong></pre>
</p></li><li><span>Configure an IGP to enable PE1, PE2, and the P to communicate with each other. IS-IS is used as an example.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>is-level level-2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>network-entity 00.1111.1111.1111.00</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack1] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface GigabitEthernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure the P.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-isis-1] <strong>is-level level-2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-isis-1] <strong>network-entity 00.1111.1111.2222.00</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-LoopBack1] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>interface GigabitEthernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/0</span>] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>interface GigabitEthernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/2/0</span>] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1] <strong>is-level level-2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1] <strong>network-entity 00.1111.1111.3333.00</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-LoopBack1] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface GigabitEthernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p>After completing the configurations, run the <strong>display isis peer</strong> command to check whether an IS-IS neighbor relationship has been established between PE1 and the P and between PE2 and the P. If the <strong>Up</strong> state is displayed in the command output, the neighbor relationship has been successfully established. You can run the <strong>display ip routing-table</strong> command to check that the PEs have learned the route to each other's loopback 1 interface.</p>
<p>The following example uses the command output on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display isis peer</strong></pre>
<pre class="screen">                          Peer information for ISIS(1)
                         
  System Id     Interface          Circuit Id        State HoldTime Type     PRI
--------------------------------------------------------------------------------
1111.1111.2222  GE<span>0/2/0</span>            1111.1111.2222.01  Up   8s       L2       64 

Total Peer(s): 1</pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display ip routing-table</strong></pre>
<pre class="screen"><span class="keyword">Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route</span>
------------------------------------------------------------------------------
Routing Table : _public_
         Destinations : 11       Routes : 11        

Destination/Mask    Proto   Pre  Cost        Flags NextHop         Interface

        1.1.1.1/32  Direct  0    0             D   127.0.0.1       LoopBack1
        2.2.2.2/32  ISIS-L2 15   10            D   10.1.1.2        GigabitEthernet<span>0/2/0</span>
        3.3.3.3/32  ISIS-L2 15   20            D   10.1.1.2        GigabitEthernet<span>0/2/0</span>
       10.1.1.0/24  Direct  0    0             D   10.1.1.1        GigabitEthernet<span>0/2/0</span>
       10.1.1.1/32  Direct  0    0             D   127.0.0.1       GigabitEthernet<span>0/2/0</span>
     10.1.1.255/32  Direct  0    0             D   127.0.0.1       GigabitEthernet<span>0/2/0</span>
       10.2.1.0/24  ISIS-L2 15   20            D   10.1.1.2        GigabitEthernet<span>0/2/0</span>
      127.0.0.0/8   Direct  0    0             D   127.0.0.1       InLoopBack0
      127.0.0.1/32  Direct  0    0             D   127.0.0.1       InLoopBack0
127.255.255.255/32  Direct  0    0             D   127.0.0.1       InLoopBack0
255.255.255.255/32  Direct  0    0             D   127.0.0.1       InLoopBack0</pre>
</p></li><li><span>Configure an SR-MPLS TE tunnel on the backbone network.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>mpls lsr-id 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>segment-routing</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>cost-style wide</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>traffic-eng level-2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>segment-routing mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>segment-routing global-block 153616 153800</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0316006786__en-us_task_0172368860_p969181111187">The SRGB range varies according to the device. The range specified in this example is for reference only.</p>
</div></div>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack1] <strong>isis prefix-sid absolute 153700</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>segment-routing</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing] <strong>ipv4 adjacency local-ip-addr 10.1.1.1 remote-ip-addr 10.1.1.2 sid 330121</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>explicit-path pe1tope2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-explicit-path-pe1tope2] <strong>next sid label 330121 type adjacency</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-explicit-path-pe1tope2] <strong>next sid label 330120 type adjacency</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-explicit-path-pe1tope2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface tunnel1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel1] <strong>ip address unnumbered interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel1] <strong>tunnel-protocol mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel1] <strong>destination 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel1] <strong>mpls te tunnel-id 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel1] <strong>mpls te signal-protocol segment-routing</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel1] <strong>mpls te path explicit-path pe1tope2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel1] <strong>mpls te reserved-for-binding</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure the P.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P] <strong>mpls lsr-id 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-mpls] <strong> mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>segment-routing</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-segment-routing] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-isis-1] <strong>cost-style wide</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-isis-1] <strong>traffic-eng level-2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-isis-1] <strong>segment-routing mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-isis-1] <strong>segment-routing global-block 153616 153800</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0316006786__en-us_task_0172368860_p969181111187_1">The SRGB range varies according to the device. The range specified in this example is for reference only.</p>
</div></div>
<pre class="screen">[<span class="keyword">*</span>P-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-LoopBack1] <strong>isis prefix-sid absolute 153710</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>segment-routing</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-segment-routing] <strong>ipv4 adjacency local-ip-addr 10.1.1.2 remote-ip-addr 10.1.1.1 sid 330221</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-segment-routing] <strong>ipv4 adjacency local-ip-addr 10.2.1.1 remote-ip-addr 10.2.1.2 sid 330120</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-segment-routing] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>mpls lsr-id 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>segment-routing</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-segment-routing] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1] <strong>cost-style wide</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1] <strong>traffic-eng level-2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1] <strong>segment-routing mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1] <strong>segment-routing global-block 153616 153800</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0316006786__en-us_task_0172368860_p969181111187_2">The SRGB range varies according to the device. The range specified in this example is for reference only.</p>
</div></div>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-LoopBack1] <strong>isis prefix-sid absolute 153720</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>segment-routing</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-segment-routing] <strong>ipv4 adjacency local-ip-addr 10.2.1.2 remote-ip-addr 10.2.1.1 sid 330220</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-segment-routing] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>explicit-path pe2tope1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-explicit-path-pe2tope1] <strong>next sid label 330220 type adjacency</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-explicit-path-pe2tope1] <strong>next sid label 330221 type adjacency</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-explicit-path-pe2tope1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface tunnel1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Tunnel1] <strong>ip address unnumbered interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Tunnel1] <strong>tunnel-protocol mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Tunnel1] <strong>destination 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Tunnel1] <strong>mpls te tunnel-id 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Tunnel1] <strong>mpls te signal-protocol segment-routing</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Tunnel1] <strong>mpls te path explicit-path pe2tope1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Tunnel1] <strong>mpls te reserved-for-binding</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Tunnel1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p>After completing the configurations, run the <strong>display mpls te tunnel-interface</strong> command. The command output shows that the tunnel state is up.</p>
<p>The following example uses the command output on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> display mpls te tunnel-interface</strong>

    Tunnel Name       : Tunnel1                                
    Signalled Tunnel Name: -                                   
    Tunnel State Desc : <strong>CR-LSP is Up</strong>                           
    Tunnel Attributes   :                                      
    Active LSP          : Primary LSP                          
    Traffic Switch      : -                                    
    Session ID          : 1                                    
    Ingress LSR ID      : 1.1.1.1               Egress LSR ID: 3.3.3.3
    Admin State         : UP                    Oper State   : UP                       
    Signaling Protocol  : <strong>Segment-Routing</strong>                      
    FTid                : 1                                    
    Tie-Breaking Policy : None                  Metric Type  : TE 
    Bfd Cap             : None                                 
    Reopt               : Disabled              Reopt Freq   : - 
    Auto BW             : Disabled              Threshold    : - 
    Current Collected BW: -                     Auto BW Freq : - 
    Min BW              : -                     Max BW       : -
    Offload             : Disabled              Offload Freq : - 
    Low Value           : -                     High Value   : - 
    Readjust Value      : -                                    
    Offload Explicit Path Name: -                              
    Tunnel Group        : Primary                              
    Interfaces Protected: - 
    Excluded IP Address : -                                    
    Referred LSP Count  : 0                                    
    Primary Tunnel      : -                     Pri Tunn Sum : - 
    Backup Tunnel       : -                                    
    Group Status        : Up                    Oam Status   : None 
    IPTN InLabel        : -                     Tunnel BFD Status : -                                                          
    BackUp LSP Type     : None                  BestEffort   : -                                
    Secondary HopLimit  : -                                    
    BestEffort HopLimit  : -                                   
    Secondary Explicit Path Name: -                            
    Secondary Affinity Prop/Mask: 0x0/0x0                      
    BestEffort Affinity Prop/Mask: -                           
    IsConfigLspConstraint: -                                   
    Hot-Standby Revertive Mode:  Revertive                     
    Hot-Standby Overlap-path:  Disabled                        
    Hot-Standby Switch State:  CLEAR                           
    Bit Error Detection:  Disabled                             
    Bit Error Detection Switch Threshold:  -                   
    Bit Error Detection Resume Threshold:  -                   
    Ip-Prefix Name    : -                                      
    P2p-Template Name : -                                      
    PCE Delegate      : No                     LSP Control Status : Local control
    Path Verification : No                                     
    Entropy Label     : -                                      
    Associated Tunnel Group ID: -              Associated Tunnel Group Type: -
    Auto BW Remain Time   : -                  Reopt Remain Time     : - 
    Segment-Routing Remote Label   : -                         
    Binding Sid       : -                     Reverse Binding Sid : - 
    FRR Attr Source   : -                     Is FRR degrade down : -
    Color             : - 

    Primary LSP ID      : 1.1.1.1:1                            
    LSP State           : UP                    LSP Type     : Primary 
    Setup Priority      : 7                     Hold Priority: 7 
    IncludeAll          : 0x0                                  
    IncludeAny          : 0x0                                  
    ExcludeAny          : 0x0                                  
    Affinity Prop/Mask  : 0x0/0x0               Resv Style   :  SE
    SidProtectType      : - 
    Configured Bandwidth Information:                          
    CT0 Bandwidth(Kbit/sec): 0               CT1 Bandwidth(Kbit/sec): 0
    CT2 Bandwidth(Kbit/sec): 0               CT3 Bandwidth(Kbit/sec): 0 
    CT4 Bandwidth(Kbit/sec): 0               CT5 Bandwidth(Kbit/sec): 0 
    CT6 Bandwidth(Kbit/sec): 0               CT7 Bandwidth(Kbit/sec): 0
    Actual Bandwidth Information:                              
    CT0 Bandwidth(Kbit/sec): 0               CT1 Bandwidth(Kbit/sec): 0
    CT2 Bandwidth(Kbit/sec): 0               CT3 Bandwidth(Kbit/sec): 0 
    CT4 Bandwidth(Kbit/sec): 0               CT5 Bandwidth(Kbit/sec): 0 
    CT6 Bandwidth(Kbit/sec): 0               CT7 Bandwidth(Kbit/sec): 0 
    Explicit Path Name  : pe1tope2                         Hop Limit: - 
    Record Route        : -                     Record Label : -
    Route Pinning       : -                                    
    FRR Flag            : -                                    
    IdleTime Remain     : -                                    
    BFD Status          : -                                    
    Soft Preemption     : -                                    
    Reroute Flag        : -                                    
    Pce Flag            : Normal                               
    Path Setup Type     : EXPLICIT                             
    Create Modify LSP Reason: -  </pre>
</p></li><li><span>Configure an EVPN instance on each PE.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>evpn vpn-instance evrf1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-evpn-instance-evrf1] <strong>route-distinguisher 100:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-evpn-instance-evrf1] <strong>vpn-target 1:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-evpn-instance-evrf1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>evpn vpn-instance evrf1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-evpn-instance-evrf1] <strong>route-distinguisher 200:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-evpn-instance-evrf1] <strong>vpn-target 1:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-evpn-instance-evrf1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</p></li><li><span>Configure an EVPN source address on each PE.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>evpn source-address 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>evpn source-address 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</p></li><li><span>Configure Layer 2 Ethernet sub-interfaces connecting the PEs to the CEs.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface GigabitEthernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Gigabitethernet<span>0/1/0</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Gigabitethernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface GigabitEthernet <span>0/1/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet <span>0/1/0</span>.1] <strong>vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet <span>0/1/0</span>.1] <strong>evpn binding vpn-instance evrf1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet <span>0/1/0</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>interface GigabitEthernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Gigabitethernet<span>0/1/0</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Gigabitethernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface GigabitEthernet <span>0/1/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet <span>0/1/0</span>.1] <strong>vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet <span>0/1/0</span>.1] <strong>evpn binding vpn-instance evrf1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet <span>0/1/0</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</p></li><li><span>Configure and apply a tunnel policy to enable EVPN service recursion to the SR-MPLS TE tunnel.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>tunnel-policy srte</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-tunnel-policy-srte] <strong>tunnel binding destination 3.3.3.3 te Tunnel1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-tunnel-policy-srte] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>evpn vpn-instance evrf1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-evpn-instance-evrf1] <strong>tnl-policy srte</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-evpn-instance-evrf1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>tunnel-policy srte</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-tunnel-policy-srte] <strong>tunnel binding destination 1.1.1.1 te Tunnel1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-tunnel-policy-srte] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>evpn vpn-instance evrf1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-evpn-instance-evrf1] <strong>tnl-policy srte</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-evpn-instance-evrf1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</p></li><li><span>Establish a BGP EVPN peer relationship between the PEs.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 3.3.3.3 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 3.3.3.3 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>l2vpn-family evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-evpn] <strong>peer 3.3.3.3 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>peer 1.1.1.1 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>peer 1.1.1.1 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>l2vpn-family evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-evpn] <strong>peer 1.1.1.1 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p>After completing the configurations, run the <strong>display bgp evpn peer</strong> command to check whether the BGP peer relationship has been established between the PEs. If the <strong>Established</strong> state is displayed in the command output, the BGP peer relationship has been successfully established. The following example uses the command output on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display bgp evpn peer</strong>

 BGP local router ID : 10.1.1.1                                
 Local AS number : 100                                         
 Total number of peers : 1                 Peers in established state : 1                                                           

  Peer                             V          AS  MsgRcvd  MsgSent  OutQ  Up/Down       State  PrefRcv 
  3.3.3.3                          4         100       43       44     0 00:34:03 Established        1 </pre>
</p></li><li><span>Configure the CEs to communicate with the PEs.</span><p><p># Configure CE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>interface GigabitEthernet <span>0/1/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>.1] <strong>vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>.1] <strong>ip address 172.16.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>commit</strong></pre>
<p># Configure CE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>interface GigabitEthernet <span>0/1/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>.1] <strong>vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>.1] <strong>ip address 172.16.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>commit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p>Run the <strong>display bgp evpn all routing-table</strong> command on each PE. The command output shows EVPN routes sent from the remote PE. The following example uses the command output on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display bgp evpn all routing-table</strong>

 Local AS number : 100     

 BGP Local router ID is 10.1.1.1                              
 Status codes: * - valid, &gt; - best, d - damped, x - best external, a - add path,                 
               h - history,  i - internal, s - suppressed, S - Stale                             
               Origin : i - IGP, e - EGP, ? - incomplete      


 EVPN address family:      
 Number of Mac Routes: 2   
 Route Distinguisher: 100:1                                   
       Network(EthTagId/MacAddrLen/MacAddr/IpAddrLen/IpAddr)  NextHop                            
 *&gt;    0:48:00e0-fc21-0302:0:0.0.0.0                          0.0.0.0                            
 Route Distinguisher: 200:1                                   
       Network(EthTagId/MacAddrLen/MacAddr/IpAddrLen/IpAddr)  NextHop                            
 *&gt;i   0:48:00e0-fc61-0300:0:0.0.0.0                          3.3.3.3                            


 EVPN-Instance evrf1:      
 Number of Mac Routes: 2   
       Network(EthTagId/MacAddrLen/MacAddr/IpAddrLen/IpAddr)  NextHop 
 *&gt;    0:48:00e0-fc21-0302:0:0.0.0.0                          0.0.0.0                            
 *&gt;i   0:48:00e0-fc61-0300:0:0.0.0.0                          3.3.3.3                            

 EVPN address family:      
 Number of Inclusive Multicast Routes: 2                      
 Route Distinguisher: 100:1                                   
       Network(EthTagId/IpAddrLen/OriginalIp)                 NextHop                            
 *&gt;    0:32:1.1.1.1                                           127.0.0.1                          
 Route Distinguisher: 200:1                                   
       Network(EthTagId/IpAddrLen/OriginalIp)                 NextHop                            
 *&gt;i   0:32:3.3.3.3                                           3.3.3.3


 EVPN-Instance evrf1:      
 Number of Inclusive Multicast Routes: 2                      
       Network(EthTagId/IpAddrLen/OriginalIp)                 NextHop                            
 *&gt;    0:32:1.1.1.1                                           127.0.0.1                          
 *&gt;i   0:32:3.3.3.3                                           3.3.3.3</pre>
<p>Run the <strong>display bgp evpn all routing-table mac-route 0:48:00e0-fc61-0300:0:0.0.0.0</strong> command on PE1 to check details about the specified MAC route. The command output shows the name of the tunnel interface to which the route recurses.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE1] <strong>display bgp evpn all routing-table mac-route 0:48:00e0-fc61-0300:0:0.0.0.0</strong> 
 BGP local router ID : 10.1.1.1                               
 Local AS number : 100     
 Total routes of Route Distinguisher(200:1): 1                
 BGP routing table entry information of 0:48:00e0-fc61-0300:0:0.0.0.0:                           
 Label information (Received/Applied): 48122/NULL             
 From: 3.3.3.3 (10.2.1.2)  
 Route Duration: 0d00h01m40s                                  
 Relay IP Nexthop: 10.1.1.2                                   
 Relay IP Out-Interface: GigabitEthernet<span>0/2/0</span>                        
 Relay Tunnel Out-Interface: GigabitEthernet<span>0/2/0</span>                    
 Original nexthop: 3.3.3.3 
 Qos information : 0x0     
 Ext-Community: RT &lt;1 : 1&gt;, SoO &lt;3.3.3.3 : 0&gt;  
 AS-path Nil, origin incomplete, localpref 100, pref-val 0, valid, internal, best, select, pre 255, IGP cost 20     
 Route Type: 2 (MAC Advertisement Route)                      
 Ethernet Tag ID: 0, MAC Address/Len: 00e0-fc61-0300/48, IP Address/Len: 0.0.0.0/0, ESI:0000.0000.0000.0000.0000    
 Not advertised to any peer yet                               



 EVPN-Instance evrf1: 
 Number of Mac Routes: 1   
 BGP routing table entry information of 0:48:00e0-fc61-0300:0:0.0.0.0:                           
 Route Distinguisher: 200:1                                   
 Remote-Cross route        
 Label information (Received/Applied): 48122/NULL             
 From: 3.3.3.3 (10.2.1.2)  
 Route Duration: 0d00h01m40s                                  
 Relay Tunnel Out-Interface: <strong>Tunnel1</strong>                          
 Original nexthop: 3.3.3.3 
 Qos information : 0x0     
 Ext-Community: RT &lt;1 : 1&gt;, SoO &lt;3.3.3.3 : 0&gt;  
 AS-path Nil, origin incomplete, localpref 100, pref-val 0, valid, internal, best, select, pre 255                 
 Route Type: 2 (MAC Advertisement Route)                      
 Ethernet Tag ID: 0, MAC Address/Len: 00e0-fc61-0300/48, IP Address/Len: 0.0.0.0/0, ESI:0000.0000.0000.0000.0000     
 Not advertised to any peer yet  </pre>
<p>Run the <strong>display bgp evpn all routing-table inclusive-route 0:32:3.3.3.3</strong> command on PE1 to check details about the specified inclusive multicast route. The command output shows the name of the tunnel interface to which the route recurses.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display bgp evpn all routing-table inclusive-route 0:32:3.3.3.3</strong>

 BGP local router ID : 10.1.1.1                               
 Local AS number : 100     
 Total routes of Route Distinguisher(200:1): 1                
 BGP routing table entry information of 0:32:3.3.3.3:         
 Label information (Received/Applied): 48123/NULL             
 From: 3.3.3.3 (10.2.1.2)  
 Route Duration: 0d00h04m49s                                  
 Relay IP Nexthop: 10.1.1.2                                   
 Relay IP Out-Interface: GigabitEthernet<span>0/2/0</span>                        
 Relay Tunnel Out-Interface: GigabitEthernet<span>0/2/0</span>                    
 Original nexthop: 3.3.3.3 
 Qos information : 0x0     
 Ext-Community: RT &lt;1 : 1&gt;, SoO &lt;3.3.3.3 : 0&gt;  
 AS-path Nil, origin incomplete, localpref 100, pref-val 0, valid, internal, best, select, pre 255, IGP cost 20      
 PMSI: Flags 0, Ingress Replication, Label 0:0:0(48123), Tunnel Identifier:3.3.3.3 
 Route Type: 3 (Inclusive Multicast Route)                    
 Ethernet Tag ID: 0, Originator IP:3.3.3.3/32                 
 Not advertised to any peer yet                               



 EVPN-Instance evrf1:      
 Number of Inclusive Multicast Routes: 1                      
 BGP routing table entry information of 0:32:3.3.3.3:         
 Route Distinguisher: 200:1                                   
 Remote-Cross route        
 Label information (Received/Applied): 48123/NULL             
 From: 3.3.3.3 (10.2.1.2)  
 Route Duration: 0d00h04m45s                                  
 Relay Tunnel Out-Interface: <strong>Tunnel1</strong>                          
 Original nexthop: 3.3.3.3 
 Qos information : 0x0     
 Ext-Community: RT &lt;1 : 1&gt;, SoO &lt;3.3.3.3 : 0&gt;  
 AS-path Nil, origin incomplete, localpref 100, pref-val 0, valid, internal, best, select, pre 255                
 PMSI: Flags 0, Ingress Replication, Label 0:0:0(48123), Tunnel Identifier:3.3.3.3               
 Route Type: 3 (Inclusive Multicast Route)                    
 Ethernet Tag ID: 0, Originator IP:3.3.3.3/32                 
 Not advertised to any peer yet </pre>
<p>Run the <strong>ping</strong> command on the CEs. The command output shows that the CEs belonging to the same VPN instance can ping each other. For example:</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>CE1] <strong>ping 172.16.1.2</strong>                                     
  PING 172.16.1.2: 56  data bytes, press CTRL_C to break       
    Reply from 172.16.1.2: bytes=56 Sequence=1 ttl=255 time=11 ms                           
    Reply from 172.16.1.2: bytes=56 Sequence=2 ttl=255 time=9 ms                          
    Reply from 172.16.1.2: bytes=56 Sequence=3 ttl=255 time=4 ms                             
    Reply from 172.16.1.2: bytes=56 Sequence=4 ttl=255 time=6 ms                                 
    Reply from 172.16.1.2: bytes=56 Sequence=5 ttl=255 time=7 ms                          

  --- 172.16.1.2 ping statistics ---
    5 packet(s) transmitted         
    5 packet(s) received            
    0.00% packet loss          
    round-trip min/avg/max = 4/7/11 ms  </pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0316006786__1.4.6"></a><a name="1.4.6"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>PE1 configuration file</p>
<pre class="screen">#
sysname PE1
#
evpn vpn-instance evrf1
 route-distinguisher 100:1
 tnl-policy srte
 vpn-target 1:1 export-extcommunity
 vpn-target 1:1 import-extcommunity
#
mpls lsr-id 1.1.1.1
#
mpls
 mpls te
#
explicit-path pe1tope2
 next sid label 330121 type adjacency index 1
 next sid label 330120 type adjacency index 2
#
segment-routing
 ipv4 adjacency local-ip-addr 10.1.1.1 remote-ip-addr 10.1.1.2 sid 330121
#
isis 1
 is-level level-2
 cost-style wide
 network-entity 00.1111.1111.1111.00
 traffic-eng level-2
 segment-routing mpls
 segment-routing global-block 153616 153800
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
#
interface GigabitEthernet<span>0/1/0</span>.1
 vlan-type dot1q 10
 evpn binding vpn-instance evrf1
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.1.1.1 255.255.255.0
 isis enable 1
#
interface LoopBack1
 ip address 1.1.1.1 255.255.255.255
 isis enable 1
 isis prefix-sid absolute 153700 
#
interface Tunnel1
 ip address unnumbered interface LoopBack1
 tunnel-protocol mpls te
 destination 3.3.3.3
 mpls te signal-protocol segment-routing
 mpls te reserved-for-binding
 mpls te tunnel-id 1
 mpls te path explicit-path pe1tope2  
#
bgp 100
 peer 3.3.3.3 as-number 100
 peer 3.3.3.3 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 3.3.3.3 enable
 #
 l2vpn-family evpn
  policy vpn-target
  peer 3.3.3.3 enable
#
tunnel-policy srte
 tunnel binding destination 3.3.3.3 te Tunnel1
#
evpn source-address 1.1.1.1
#
return</pre>
</li><li><p>P configuration file</p>
<pre class="screen">#
sysname P
#
mpls lsr-id 2.2.2.2
#
mpls
 mpls te
#
segment-routing
 ipv4 adjacency local-ip-addr 10.1.1.2 remote-ip-addr 10.1.1.1 sid 330221
 ipv4 adjacency local-ip-addr 10.2.1.1 remote-ip-addr 10.2.1.2 sid 330120
#
isis 1
 is-level level-2
 cost-style wide
 network-entity 00.1111.1111.2222.00
 traffic-eng level-2
 segment-routing mpls
 segment-routing global-block 153616 153800
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.1.2 255.255.255.0
 isis enable 1
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.2.1.1 255.255.255.0
 isis enable 1
#
interface LoopBack1
 ip address 2.2.2.2 255.255.255.255
 isis enable 1
 isis prefix-sid absolute 153710 
#
return</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#
sysname PE2
#
evpn vpn-instance evrf1
 route-distinguisher 200:1
 tnl-policy srte
 vpn-target 1:1 export-extcommunity
 vpn-target 1:1 import-extcommunity
#
mpls lsr-id 3.3.3.3
#
mpls
 mpls te
#
explicit-path pe2tope1
 next sid label 330220 type adjacency index 1
 next sid label 330221 type adjacency index 2
#
segment-routing
 ipv4 adjacency local-ip-addr 10.2.1.2 remote-ip-addr 10.2.1.1 sid 330220
#
isis 1
 is-level level-2
 cost-style wide
 network-entity 00.1111.1111.3333.00
 traffic-eng level-2
 segment-routing mpls
 segment-routing global-block 153616 153800
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
#
interface GigabitEthernet<span>0/1/0</span>.1
 vlan-type dot1q 10
 evpn binding vpn-instance evrf1
#               
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.2.1.2 255.255.255.0
 isis enable 1
#
interface LoopBack1
 ip address 3.3.3.3 255.255.255.255
 isis enable 1
 isis prefix-sid absolute 153720 
#
interface Tunnel1
 ip address unnumbered interface LoopBack1
 tunnel-protocol mpls te
 destination 1.1.1.1
 mpls te signal-protocol segment-routing
 mpls te reserved-for-binding
 mpls te tunnel-id 1
 mpls te path explicit-path pe2tope1  
#
bgp 100
 peer 1.1.1.1 as-number 100
 peer 1.1.1.1 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 1.1.1.1 enable
 #
 l2vpn-family evpn
  policy vpn-target
  peer 1.1.1.1 enable
#
tunnel-policy srte
 tunnel binding destination 1.1.1.1 te Tunnel1
#
evpn source-address 3.3.3.3
#
return</pre>
</li><li><p>CE1 configuration file</p>
<pre class="screen">#
sysname CE1
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
#
interface GigabitEthernet<span>0/1/0</span>.1
 vlan-type dot1q 10
 ip address 172.16.1.1 255.255.255.0
#
return</pre>
</li><li><p>CE2 configuration file</p>
<pre class="screen">#
sysname CE2
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
#
interface GigabitEthernet<span>0/1/0</span>.1
 vlan-type dot1q 10
 ip address 172.16.1.2 255.255.255.0
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_sr-te_cfg_0090.html">Configuring Examples for SR-MPLS TE
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_sr_all_cfg_0160.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_sr_all_cfg_0164.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>

<script language="JavaScript">
<!--
image_size('.imgResize');
var msg_imageMax = "view original image";
var msg_imageClose = "close";
//--></script></body>
</html>