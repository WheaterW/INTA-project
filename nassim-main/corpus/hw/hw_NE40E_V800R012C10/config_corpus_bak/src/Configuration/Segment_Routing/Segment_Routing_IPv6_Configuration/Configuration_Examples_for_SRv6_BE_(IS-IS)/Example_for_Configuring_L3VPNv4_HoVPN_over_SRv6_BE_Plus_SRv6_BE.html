
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring L3VPNv4 HoVPN over SRv6 BE Plus SRv6 BE">
<meta name="abstract" content="This section provides an example for configuring L3VPNv4 HoVPN over SRv6 BE plus SRv6 BE.">
<meta name="description" content="This section provides an example for configuring L3VPNv4 HoVPN over SRv6 BE plus SRv6 BE.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_srv6_cfg_all_0010.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_srv6_cfg_all_0279.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_srv6_cfg_all_0147.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featurename" content="EVPN">
<meta name="featurename" content="Segment Routing IPv6">
<meta name="featurename" content="Segment Routing IPv6 Policy">
<meta name="featurename" content="Segment Routing Policy">
<meta name="featuretype" content="Segment Routing">
<meta name="featuretype" content="VPN">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featurename" content="EVPN">
<meta name="featurename" content="Segment Routing IPv6">
<meta name="featurename" content="Segment Routing IPv6 Policy">
<meta name="featurename" content="Segment Routing Policy">
<meta name="featuretype" content="Segment Routing">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featurename" content="EVPN">
<meta name="featurename" content="Segment Routing IPv6">
<meta name="featurename" content="Segment Routing IPv6 Policy">
<meta name="featurename" content="Segment Routing Policy">
<meta name="featuretype" content="Segment Routing">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="Segment Routing IPv6">
<meta name="featuretype" content="Segment Routing">
<meta name="OWNER" content="l00425560">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00587852">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0226968187">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/thickbox.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/imageResize.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery-migrate-1.2.1.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery-ui.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery.mousewheel.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/thickbox.js"></script>
<title>Example for Configuring L3VPNv4 HoVPN over SRv6 BE Plus SRv6 BE</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0226968187"></a><a name="EN-US_TASK_0226968187"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring L3VPNv4 HoVPN over SRv6 BE Plus SRv6 BE</h1>
<div class="taskbody"><p>This section provides an example for configuring L3VPNv4 HoVPN over SRv6 BE plus SRv6 BE.</p>
<div class="context"><a name="EN-US_TASK_0226968187__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0226968187__fig_dc_vrp_srv6_cfg_all_001101">Figure 1</a>:</p>
<ul><li>The UPE, SPE, and NPE all belong to AS 100. They need to run IS-IS to implement IPv6 network connectivity.</li><li>The UPE, SPE, and NPE all belong to IS-IS process 1.</li></ul>
<p>It is required that bidirectional SRv6 BE paths be established between the UPE and NPE to carry L3VPNv4 services.</p>
<div class="fignone" id="EN-US_TASK_0226968187__fig_dc_vrp_srv6_cfg_all_001101"><a name="EN-US_TASK_0226968187__fig_dc_vrp_srv6_cfg_all_001101"></a><a name="fig_dc_vrp_srv6_cfg_all_001101"></a><span class="figcap"><b>Figure 1 </b>L3VPNv4 HoVPN over SRv6 BE networking</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 and 2 in this example represent GE <span>0/1/0</span> and GE <span>0/2/0</span>, respectively.</p>
</div></div>
<br><span><img class="imgResize" src="figure/en-us_image_0226997663.png" width="523.6875" height="174.5625" title="Click to enlarge"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0226968187__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li>Enable IPv6 forwarding and configure an IPv6 address for each interface on the UPE, SPE, and NPE.</li><li>Enable IS-IS, configure an IS-IS level, and specify a network entity on the UPE, SPE, and NPE.</li><li>Establish an EBGP peer relationship between the UPE and CE1 and another one between the NPE and CE2.</li><li>Establish an MP-IBGP peer relationship between the UPE and SPE and another one between the NPE and SPE.</li><li>Configure SRv6 on the UPE, SPE, and NPE.</li><li>Specify the UPE as the peer of the SPE and configure the SPE to advertise the default route to the UPE.</li><li>Configure the SPE to advertise regenerated routes to the NPE.</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0226968187__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li>IPv6 address of each interface on the UPE, SPE, and NPE</li><li>IS-IS process ID of the UPE, SPE, and NPE</li><li>IS-IS level of the UPE, SPE, and NPE</li><li>VPN instance name, RD, and RT on the SPE and NPE</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0226968187__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Enable IPv6 forwarding and configure an IPv6 address for each interface. The following example uses the configuration of the UPE. The configurations of other devices are similar to the configuration of the UPE. For configuration details, see <a href="#EN-US_TASK_0226968187__example764102717246">Configuration Files</a> in this section.</span><p><pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname UPE</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>interface GigabitEthernet <span>0/1/0</span></strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE-GigabitEthernet<span>0/1/0</span>] <strong>ipv6 enable</strong>
[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/0</span>] <strong>ipv6 address 2001:DB8:2001::1 96</strong>
[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong>
[<span class="keyword">*</span>UPE] <strong>interface </strong><strong>loopback1</strong>
[<span class="keyword">*</span>UPE-LoopBack1] <strong>ipv6 enable</strong>
[<span class="keyword">*</span>UPE-LoopBack1] <strong>ipv6 address 2001:DB8:1::1/128</strong>
[<span class="keyword">*</span>UPE-LoopBack1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE-LoopBack1] <strong>quit</strong></pre>
</p></li><li><span>Configure IS-IS.</span><p><p># Configure the UPE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>isis 1</strong>
[<span class="keyword">*</span>UPE-isis-1] <strong>is-level level-1</strong>
[<span class="keyword">*</span>UPE-isis-1] <strong>cost-style wide</strong>
[<span class="keyword">*</span>UPE-isis-1] <strong>network-entity 10.0000.0000.0001.00</strong>
[<span class="keyword">*</span>UPE-isis-1] <strong>ipv6 enable topology ipv6</strong>
[<span class="keyword">*</span>UPE-isis-1] <strong>quit</strong>
[<span class="keyword">*</span>UPE] <strong>interface GigabitEthernet <span>0/1/0</span></strong>
[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/0</span>] <strong>isis ipv6 enable 1</strong>
[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong>
[<span class="keyword">*</span>UPE] <strong>interface loopback1</strong>
[<span class="keyword">*</span>UPE-LoopBack1] <strong>isis ipv6 enable 1</strong>
[<span class="keyword">*</span>UPE-LoopBack1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE-LoopBack1] <strong>quit</strong></pre>
<p># Configure the SPE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE] <strong>isis 1</strong> 
[<span class="keyword">*</span>SPE-isis-1] <strong>is-level level-1</strong>
[<span class="keyword">*</span>SPE-isis-1] <strong>cost-style wide</strong>
[<span class="keyword">*</span>SPE-isis-1] <strong>network-entity 10.0000.0000.0002.00</strong>
[<span class="keyword">*</span>SPE-isis-1] <strong>ipv6 enable topology ipv6</strong>
[<span class="keyword">*</span>SPE-isis-1] <strong>quit</strong>
[<span class="keyword">*</span>SPE] <strong>interface GigabitEthernet <span>0/1/0</span></strong>
[<span class="keyword">*</span>SPE-GigabitEthernet<span>0/1/0</span>] <strong>isis ipv6 enable 1</strong>
[<span class="keyword">*</span>SPE-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong>
[<span class="keyword">*</span>SPE] <strong>interface GigabitEthernet <span>0/2/0</span></strong>
[<span class="keyword">*</span>SPE-GigabitEthernet<span>0/2/0</span>] <strong>isis ipv6 enable 1</strong>
[<span class="keyword">*</span>SPE-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong>
[<span class="keyword">*</span>SPE] <strong>interface loopback1</strong>
[<span class="keyword">*</span>SPE-LoopBack1] <strong>isis ipv6 enable 1</strong>
[<span class="keyword">*</span>SPE-LoopBack1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE-LoopBack1] <strong>quit</strong></pre>
<div class="p"># Configure the NPE.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE] <strong>isis 1</strong>
[<span class="keyword">*</span>NPE-isis-1] <strong>is-level level-1</strong>
[<span class="keyword">*</span>NPE-isis-1] <strong>cost-style wide</strong>
[<span class="keyword">*</span>NPE-isis-1] <strong>network-entity 10.0000.0000.0003.00</strong>
[<span class="keyword">*</span>NPE-isis-1] <strong>ipv6 enable topology ipv6</strong>
[<span class="keyword">*</span>NPE-isis-1] <strong>quit</strong>
[<span class="keyword">*</span>NPE] <strong>interface GigabitEthernet <span>0/1/0</span></strong>
[<span class="keyword">*</span>NPE-GigabitEthernet<span>0/1/0</span>] <strong>isis ipv6 enable 1</strong>
[<span class="keyword">*</span>NPE-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong>
[<span class="keyword">*</span>NPE] <strong>interface loopback1</strong>
[<span class="keyword">*</span>NPE-LoopBack1] <strong>isis ipv6 enable 1</strong>
[<span class="keyword">*</span>NPE-LoopBack1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE-LoopBack1] <strong>quit</strong></pre>
</div>
</p></li><li><span>On the UPE, SPE, and NPE, configure a VPN instance, enable the IPv4 address family for the instance, and bind the interface that connects the UPE to CE1 to the VPN instance on the UPE as well as the interface that connects the NPE to CE2 to the VPN instance on the NPE.</span><p><div class="p"># Configure the UPE.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>ip vpn-instance vpna</strong>
[<span class="keyword">*</span>UPE-vpn-instance-vpna] <strong>ipv4-family</strong>
[<span class="keyword">*</span>UPE-vpn-instance-vpna-af-ipv4] <strong>route-distinguisher 100:1</strong>
[<span class="keyword">*</span>UPE-vpn-instance-vpna-af-ipv4] <strong>vpn-target 111:1 both</strong>
[<span class="keyword">*</span>UPE-vpn-instance-vpna-af-ipv4] <strong>quit</strong>
[<span class="keyword">*</span>UPE-vpn-instance-vpna] <strong>quit</strong>
[<span class="keyword">*</span>UPE] <strong>interface GigabitEthernet </strong><strong><span>0/2/0</span></strong>
[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/2/0</span>] <strong>ip binding vpn-instance vpna</strong>
[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/2/0</span>] <strong>ip address 10.1.1.1 24</strong>
[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong>
[<span class="keyword">*</span>UPE] <strong>commit</strong></pre>
</div>
<div class="p"># Configure the SPE.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE] <strong>ip vpn-instance vpna</strong>
[<span class="keyword">*</span>SPE-vpn-instance-vpna] <strong>ipv4-family</strong>
[<span class="keyword">*</span>SPE-vpn-instance-vpna-af-ipv4] <strong>route-distinguisher 200:1</strong>
[<span class="keyword">*</span>SPE-vpn-instance-vpna-af-ipv4] <strong>vpn-target 111:1 both</strong>
[<span class="keyword">*</span>SPE-vpn-instance-vpna-af-ipv4] <strong>quit</strong>
[<span class="keyword">*</span>SPE-vpn-instance-vpna] <strong>quit</strong>
[<span class="keyword">*</span>SPE] <strong>commit</strong></pre>
</div>
<div class="p"># Configure the NPE.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE] <strong>ip vpn-instance vpna</strong>
[<span class="keyword">*</span>NPE-vpn-instance-vpna] <strong>ipv4-family</strong>
[<span class="keyword">*</span>NPE-vpn-instance-vpna-af-ipv4] <strong>route-distinguisher 300:1</strong>
[<span class="keyword">*</span>NPE-vpn-instance-vpna-af-ipv4] <strong>vpn-target 111:1 both</strong>
[<span class="keyword">*</span>NPE-vpn-instance-vpna-af-ipv4] <strong>quit</strong>
[<span class="keyword">*</span>NPE-vpn-instance-vpna] <strong>quit</strong>
[<span class="keyword">*</span>NPE] <strong>interface GigabitEthernet <span>0/2/0</span></strong>
[<span class="keyword">*</span>NPE-GigabitEthernet<span>0/2/0</span>] <strong>ip binding vpn-instance vpna</strong>
[<span class="keyword">*</span>NPE-GigabitEthernet<span>0/2/0</span>] <strong>ip address 10.2.1.1 24</strong>
[<span class="keyword">*</span>NPE-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong>
[<span class="keyword">*</span>NPE] <strong>commit</strong></pre>
</div>
</p></li><li><span>Establish an EBGP peer relationship between the UPE and CE1 and another one between the NPE and CE2.</span><p><div class="p"># Configure CE1.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>interface loopback 1</strong>
[<span class="keyword">*</span>CE1-LoopBack1] <strong>ip address 11.11.11.11 32</strong>
[<span class="keyword">*</span>CE1-LoopBack1] <strong>quit</strong>
[<span class="keyword">*</span>CE1] <strong>bgp 65410</strong>
[<span class="keyword">*</span>CE1-bgp] <strong>peer 10.1.1.1 as-number 100</strong>
[<span class="keyword">*</span>CE1-bgp] <strong>network 11.11.11.11 32</strong>
[<span class="keyword">*</span>CE1-bgp] <strong>quit</strong>
[<span class="keyword">*</span>CE1] <strong>commit</strong></pre>
</div>
<div class="p"># Configure the UPE.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>bgp 100</strong>
[<span class="keyword">*</span>UPE-bgp] <strong>router-id 1.1.1.1</strong>
[<span class="keyword">*</span>UPE-bgp] <strong>ipv4-family vpn-instance vpna</strong>
[<span class="keyword">*</span>UPE-bgp-vpna] <strong>peer 10.1.1.2 as-number 65410</strong>
[<span class="keyword">*</span>UPE-bgp-vpna] <strong>import-route direct</strong>
[<span class="keyword">*</span>UPE-bgp-vpna] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE-bgp-vpna] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE-bgp] <strong>quit</strong></pre>
</div>
<div class="p"># Configure CE2.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>interface loopback 1</strong>
[<span class="keyword">*</span>CE2-LoopBack1] <strong>ip address 22.22.22.22 32</strong>
[<span class="keyword">*</span>CE2-LoopBack1] <strong>quit</strong>
[<span class="keyword">*</span>CE2] <strong>bgp 65420</strong>
[<span class="keyword">*</span>CE2-bgp] <strong>peer 10.2.1.1 as-number 100</strong>
[<span class="keyword">*</span>CE2-bgp] <strong>network 22.22.22.22 32</strong>
[<span class="keyword">*</span>CE2-bgp] <strong>quit</strong>
[<span class="keyword">*</span>CE2] <strong>commit</strong></pre>
</div>
<div class="p"># Configure the NPE.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE] <strong>bgp 100</strong>
[<span class="keyword">*</span>NPE-bgp] <strong>router-id 3.3.3.3</strong>
[<span class="keyword">*</span>NPE-bgp] <strong>ipv4-family vpn-instance vpna</strong>
[<span class="keyword">*</span>NPE-bgp-vpna] <strong>peer 10.2.1.2 as-number 65420</strong>
[<span class="keyword">*</span>NPE-bgp-vpna] <strong>import-route direct</strong>
[<span class="keyword">*</span>NPE-bgp-vpna] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE-bgp-vpna] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE-bgp] <strong>quit</strong></pre>
</div>
</p></li><li><span>Establish an MP-IBGP peer relationship between the UPE and SPE and another one between the SPE and NPE.</span><p><div class="p"># Configure the UPE.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>bgp 100</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE-bgp] <strong>peer 2001:DB8:2::2 as-number 100</strong>
[<span class="keyword">*</span>UPE-bgp] <strong>peer 2001:DB8:2::2 connect-interface loopback 1</strong>
[<span class="keyword">*</span>UPE-bgp] <strong>ipv4-family vpnv4</strong>
[<span class="keyword">*</span>UPE-bgp-af-vpnv4] <strong>peer 2001:DB8:2::2 enable</strong>
[<span class="keyword">*</span>UPE-bgp-af-vpnv4] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE-bgp-af-vpnv4] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE-bgp] <strong>quit</strong></pre>
</div>
<div class="p"># Configure the SPE.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE] <strong>bgp 100</strong>
[<span class="keyword">*</span>SPE-bgp] <strong>router-id 2.2.2.2</strong>
[<span class="keyword">*</span>SPE-bgp] <strong>peer 2001:DB8:1::1 as-number 100</strong>
[<span class="keyword">*</span>SPE-bgp] <strong>peer 2001:DB8:1::1 connect-interface loopback 1</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE-bgp] <strong>peer 2001:DB8:3::3 as-number 100</strong>
[<span class="keyword">*</span>SPE-bgp] <strong>peer 2001:DB8:3::3 connect-interface loopback 1</strong>
[<span class="keyword">*</span>SPE-bgp] <strong>ipv4-family vpnv4</strong>
[<span class="keyword">*</span>SPE-bgp-af-vpnv4] <strong>peer 2001:DB8:1::1 enable</strong>
[<span class="keyword">*</span>SPE-bgp-af-vpnv4] <strong>peer 2001:DB8:3::3 enable</strong>
[<span class="keyword">*</span>SPE-bgp-af-vpnv4] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE-bgp-af-vpnv4] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE-bgp] <strong>quit</strong></pre>
</div>
<div class="p"># Configure the NPE.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE] <strong>bgp 100</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE-bgp] <strong>peer 2001:DB8:2::2 as-number 100</strong>
[<span class="keyword">*</span>NPE-bgp] <strong>peer 2001:DB8:2::2 connect-interface loopback 1</strong>
[<span class="keyword">*</span>NPE-bgp] <strong>ipv4-family vpnv4</strong>
[<span class="keyword">*</span>NPE-bgp-af-vpnv4] <strong>peer 2001:DB8:2::2 enable</strong>
[<span class="keyword">*</span>NPE-bgp-af-vpnv4] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE-bgp-af-vpnv4] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE-bgp] <strong>quit</strong></pre>
</div>
</p></li><li><span>Establish an SRv6 BE path between the UPE and SPE and another one between the SPE and NPE.</span><p><div class="p"># Configure the UPE.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>segment-routing ipv6</strong>
[<span class="keyword">*</span>UPE-segment-routing-ipv6] <strong>encapsulation source-address 2001:DB8:1::1</strong>
[<span class="keyword">*</span>UPE-segment-routing-ipv6] <strong>locator as1 ipv6-prefix 2001:DB8:100:: 64 static 32</strong>
[<span class="keyword">*</span>UPE-segment-routing-ipv6-locator] <strong>quit</strong>
[<span class="keyword">*</span>UPE-segment-routing-ipv6] <strong>quit</strong>
[<span class="keyword">*</span>UPE] <strong>bgp 100</strong>
[<span class="keyword">*</span>UPE-bgp] <strong>ipv4-family vpnv4</strong>
[<span class="keyword">*</span>UPE-bgp-af-vpnv4] <strong>peer 2001:DB8:2::2 prefix-sid</strong>
[<span class="keyword">*</span>UPE-bgp-af-vpnv4] <strong>quit</strong>
[<span class="keyword">*</span>UPE-bgp] <strong>ipv4-family vpn-instance vpna</strong>
[<span class="keyword">*</span>UPE-bgp-vpna] <strong>segment-routing ipv6 best-effort</strong>
[<span class="keyword">*</span>UPE-bgp-vpna] <strong>segment-routing ipv6 locator as1</strong>
[<span class="keyword">*</span>UPE-bgp-vpna] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE-bgp-vpna] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE-bgp] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>isis 1</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE-isis-1] <strong>segment-routing ipv6 locator as1</strong>
[<span class="keyword">*</span>UPE-isis-1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE-isis-1] <strong>quit</strong></pre>
</div>
<div class="p"># Configure the SPE.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE] <strong>segment-routing ipv6</strong>
[<span class="keyword">*</span>SPE-segment-routing-ipv6] <strong>encapsulation source-address 2001:DB8:2::2</strong>
[<span class="keyword">*</span>SPE-segment-routing-ipv6] <strong>locator as1 ipv6-prefix 2001:DB8:200:: 64 static 32</strong>
[<span class="keyword">*</span>SPE-segment-routing-ipv6-locator] <strong>quit</strong>
[<span class="keyword">*</span>SPE-segment-routing-ipv6] <strong>quit</strong>
[<span class="keyword">*</span>SPE] <strong>bgp 100</strong>
[<span class="keyword">*</span>SPE-bgp] <strong>ipv4-family vpnv4</strong>
[<span class="keyword">*</span>SPE-bgp-af-vpnv4] <strong>peer 2001:DB8:1::1 prefix-sid</strong>
[<span class="keyword">*</span>SPE-bgp-af-vpnv4] <strong>peer 2001:DB8:3::3 prefix-sid</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE-bgp-af-vpnv4] <strong>quit</strong>
[<span class="keyword">*</span>SPE-bgp] <strong>ipv4-family vpn-instance vpna</strong>
[<span class="keyword">*</span>SPE-bgp-vpna] <strong>segment-routing ipv6 best-effort</strong>
[<span class="keyword">*</span>SPE-bgp-vpna] <strong>segment-routing ipv6 locator as1</strong>
[<span class="keyword">*</span>SPE-bgp-vpna] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE-bgp-vpna] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE-bgp] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE] <strong>isis 1</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE-isis-1] <strong>segment-routing ipv6 locator as1</strong>
[<span class="keyword">*</span>SPE-isis-1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE-isis-1] <strong>quit</strong></pre>
</div>
<div class="p"># Configure the NPE.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE] <strong>segment-routing ipv6</strong>
[<span class="keyword">*</span>NPE-segment-routing-ipv6] <strong>encapsulation source-address 2001:DB8:3::3</strong>
[<span class="keyword">*</span>NPE-segment-routing-ipv6] <strong>locator as1 ipv6-prefix 2001:DB8:300:: 64 static 32</strong>
[<span class="keyword">*</span>NPE-segment-routing-ipv6-locator] <strong>quit</strong>
[<span class="keyword">*</span>NPE-segment-routing-ipv6] <strong>quit</strong>
[<span class="keyword">*</span>NPE] <strong>bgp 100</strong>
[<span class="keyword">*</span>NPE-bgp] <strong>ipv4-family vpnv4</strong>
[<span class="keyword">*</span>NPE-bgp-af-vpnv4] <strong>peer 2001:DB8:2::2 prefix-sid</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE-bgp-af-vpnv4] <strong>quit</strong>
[<span class="keyword">*</span>NPE-bgp] <strong>ipv4-family vpn-instance vpna</strong>
[<span class="keyword">*</span>NPE-bgp-vpna] <strong>segment-routing ipv6 best-effort</strong>
[<span class="keyword">*</span>NPE-bgp-vpna] <strong>segment-routing ipv6 locator as1</strong>
[<span class="keyword">*</span>NPE-bgp-vpna] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE-bgp-vpna] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE-bgp] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE] <strong>isis 1</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE-isis-1] <strong>segment-routing ipv6 locator as1</strong>
[<span class="keyword">*</span>NPE-isis-1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE-isis-1] <strong>quit</strong></pre>
</div>
</p></li><li><span>Specify the UPE as the peer of the SPE, and configure the SPE to advertise the default route to the UPE and regenerated routes to the NPE.</span><p><div class="p"># Configure the SPE.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE] <strong>bgp 100</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE-bgp] <strong>ipv4-family vpnv4</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE-bgp-af-vpnv4] <strong>peer 2001:DB8:1::1 upe</strong>
[<span class="keyword">*</span>SPE-bgp-af-vpnv4] <strong>peer 2001:DB8:1::1 default-originate vpn-instance vpna</strong>
[<span class="keyword">*</span>SPE-bgp-af-vpnv4] <strong>peer 2001:DB8:3::3 advertise route-reoriginated vpnv4</strong>
[<span class="keyword">*</span>SPE-bgp-af-vpnv4] <strong>quit</strong>
[<span class="keyword">*</span>SPE-bgp] <strong>ipv4-family vpn-instance vpna</strong>
[<span class="keyword">*</span>SPE-bgp-vpna] <strong>advertise best-route route-reoriginate</strong>
[<span class="keyword">*</span>SPE-bgp-vpna] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE-bgp-vpna] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE-bgp] <strong>quit</strong></pre>
</div>
</p></li><li><span>Verify the configuration.</span><p><div class="p">Run the <strong>display segment-routing ipv6 locator</strong> [ <em>locator-name</em> ] <strong>verbose</strong> command to check SRv6 locator information. The following example uses the command output on the UPE.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>display segment-routing ipv6 locator verbose</strong>
                        Locator Configuration Table                          
                        ---------------------------                          

LocatorName   : as1                                       LocatorID     : 5  
IPv6Prefix    : 2001:DB8:100::                            PrefixLength  : 64 
Block         : --                                        BlockLength   : 0  
NodeID        : --                                        NodeIdLength  : 0  
ComprStaticLen: 0                                         StaticLength  : 32 
ArgsLength    : 0                                         Reference     : 0  
Algorithm     : 0                                         ComprDynLength: 0  
AutoCSIDPoolID: 0
AutoCSIDBegin : --    
AutoCSIDEnd   : --    
StaticCSIDBegin: --   
StaticCSIDEnd : --    
AutoSIDPoolID : 8196                                      DynLength     : 32 
AutoSIDBegin  : 2001:DB8:100::1:0:0                                          
AutoSIDEnd    : 2001:DB8:100:0:FFFF:FFFF:FFFF:FFFF                           
StaticSIDBegin: 2001:DB8:100::1                                              
StaticSIDEnd  : 2001:DB8:100::FFFF:FFFF  
GIB:LIB       : --                                    

Total Locator(s): 1 </pre>
</div>
<div class="p">Check that CEs belonging to the same VPN instance can ping each other. The following example uses the command output on CE1.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>ping -a 11.11.11.11 22.22.22.22</strong> 
  PING 22.22.22.22: 56  data bytes, press CTRL_C to break 
    Reply from 22.22.22.22: bytes=56 Sequence=1 ttl=253 time=7 ms 
    Reply from 22.22.22.22: bytes=56 Sequence=2 ttl=253 time=5 ms 
    Reply from 22.22.22.22: bytes=56 Sequence=3 ttl=253 time=4 ms 
    Reply from 22.22.22.22: bytes=56 Sequence=4 ttl=253 time=5 ms 
    Reply from 22.22.22.22: bytes=56 Sequence=5 ttl=253 time=5 ms 
 
  --- 22.22.22.22 ping statistics --- 
    5 packet(s) transmitted 
    5 packet(s) received 
    0.00% packet loss 
    round-trip min/avg/max = 4/5/7 ms</pre>
</div>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0226968187__example764102717246"><a name="EN-US_TASK_0226968187__example764102717246"></a><a name="example764102717246"></a><a name="EN-US_TASK_0226968187__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li>CE1 configuration file<pre class="screen">#
sysname CE1
#
interface GigabitEthernet<strong> </strong><span>0/1/0</span>
 undo shutdown
 ip address 10.1.1.2 255.255.255.0
#
interface loopback1
 ip address 11.11.11.11 255.255.255.255
#
bgp 65410
 peer 10.1.1.1 as-number 100
 #
 ipv4-family unicast
  undo synchronization
  network 11.11.11.11 255.255.255.255
  peer 10.1.1.1 enable
#
return</pre>
</li><li>CE2 configuration file<pre class="screen">#
sysname CE2
#
interface GigabitEthernet<strong> </strong><span>0/1/0</span>
 undo shutdown
 ip address 10.2.1.2 255.255.255.0
#
interface loopback1
 ip address 22.22.22.22 255.255.255.255
#
bgp 65420
 peer 10.2.1.1 as-number 100
 #
 ipv4-family unicast
  undo synchronization
  network 22.22.22.22 255.255.255.255
  peer 10.2.1.1 enable
#
return</pre>
</li><li>UPE configuration file<pre class="screen">#
sysname UPE
#
ip vpn-instance vpna
 ipv4-family
  route-distinguisher 100:1
  apply-label per-instance
  vpn-target 111:1 export-extcommunity
  vpn-target 111:1 import-extcommunity
#
segment-routing ipv6
 encapsulation source-address 2001:DB8:1::1
 locator as1 ipv6-prefix 2001:DB8:100:: 64 static 32
#
isis 1
 is-level level-1
 cost-style wide
 network-entity 10.0000.0000.0001.00
 #
 ipv6 enable topology ipv6
 segment-routing ipv6 locator as1
 #
#
interface GigabitEthernet<strong> </strong><span>0/1/0</span>
 undo shutdown
 ipv6 enable
 ipv6 address 2001:DB8:2001::1/96
 isis ipv6 enable 1
#
interface GigabitEthernet<strong> </strong><span>0/2/0</span>
 undo shutdown
 ip binding vpn-instance vpna
 ip address 10.1.1.1 255.255.255.0
#
interface loopback1
 ipv6 enable
 ipv6 address 2001:DB8:1::1/128
 isis ipv6 enable 1
#
bgp 100
 router-id 1.1.1.1
 peer 2001:DB8:2::2 as-number 100
 peer 2001:DB8:2::2 connect-interface loopback1
 #
 ipv4-family unicast
  undo synchronization
 #
 ipv4-family vpnv4
  policy vpn-target
  peer 2001:DB8:2::2 enable
  peer 2001:DB8:2::2 prefix-sid
 #
 ipv4-family vpn-instance vpna
  import-route direct
  segment-routing ipv6 locator as1
  segment-routing ipv6 best-effort
  peer 10.1.1.2 as-number 65410
#
return</pre>
</li><li>SPE configuration file<pre class="screen">#
sysname SPE
#
ip vpn-instance vpna
 ipv4-family
  route-distinguisher 200:1
  apply-label per-instance
  vpn-target 111:1 export-extcommunity
  vpn-target 111:1 import-extcommunity
#
segment-routing ipv6
 encapsulation source-address 2001:DB8:2::2
 locator as1 ipv6-prefix 2001:DB8:200:: 64 static 32
#
isis 1
 is-level level-1
 cost-style wide
 network-entity 10.0000.0000.0002.00
 #
 ipv6 enable topology ipv6
 segment-routing ipv6 locator as1
 #
#
interface GigabitEthernet<strong> </strong><span>0/1/0</span>
 undo shutdown
 ipv6 enable
 ipv6 address 2001:DB8:2001::2/96
 isis ipv6 enable 1
#
interface GigabitEthernet<strong> </strong><span>0/2/0</span>
 undo shutdown
 ipv6 enable
 ipv6 address 2001:DB8:2002::1/96
 isis ipv6 enable 1
#
interface loopback1
 ipv6 enable
 ipv6 address 2001:DB8:2::2/128
 isis ipv6 enable 1
#
bgp 100
 router-id 2.2.2.2
 peer 2001:DB8:1::1 as-number 100
 peer 2001:DB8:1::1 connect-interface loopback1
 peer 2001:DB8:3::3 as-number 100
 peer 2001:DB8:3::3 connect-interface loopback1
 #
 ipv4-family unicast
  undo synchronization
 #
 ipv4-family vpnv4
  policy vpn-target
  peer 2001:DB8:1::1 enable
  peer 2001:DB8:1::1 upe
  peer 2001:DB8:1::1 default-originate vpn-instance vpna
  peer 2001:DB8:1::1 prefix-sid
  peer 2001:DB8:3::3 enable
  peer 2001:DB8:3::3 prefix-sid
  peer 2001:DB8:3::3 advertise route-reoriginated vpnv4
 #
 ipv4-family vpn-instance vpna
  advertise best-route route-reoriginate
  segment-routing ipv6 locator as1
  segment-routing ipv6 best-effort
#
return</pre>
</li><li>NPE configuration file<pre class="screen">#
sysname NPE
#
ip vpn-instance vpna
 ipv4-family
  route-distinguisher 300:1
  apply-label per-instance
  vpn-target 111:1 export-extcommunity
  vpn-target 111:1 import-extcommunity
#
segment-routing ipv6
 encapsulation source-address 2001:DB8:3::3
 locator as1 ipv6-prefix 2001:DB8:300:: 64 static 32
#
isis 1
 is-level level-1
 cost-style wide
 network-entity 10.0000.0000.0003.00
 #
 ipv6 enable topology ipv6
 segment-routing ipv6 locator as1
 #
#
interface GigabitEthernet<strong> </strong><span>0/1/0</span>
 undo shutdown
 ipv6 enable
 ipv6 address 2001:DB8:2002::2/96
 isis ipv6 enable 1
#
interface GigabitEthernet<strong> </strong><span>0/2/0</span>
 undo shutdown
 ip binding vpn-instance vpna
 ip address 10.2.1.1 255.255.255.0
#
interface loopback1
 ipv6 enable
 ipv6 address 2001:DB8:3::3/128
 isis ipv6 enable 1
#
bgp 100
 router-id 3.3.3.3
 peer 2001:DB8:2::2 as-number 100
 peer 2001:DB8:2::2 connect-interface loopback1
 #
 ipv4-family unicast
  undo synchronization
 #
 ipv4-family vpnv4
  policy vpn-target
  peer 2001:DB8:2::2 enable
  peer 2001:DB8:2::2 prefix-sid
 #
 ipv4-family vpn-instance vpna
  import-route direct
  segment-routing ipv6 locator as1
  segment-routing ipv6 best-effort
  peer 10.2.1.2 as-number 65420
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_srv6_cfg_all_0010.html">Configuration Examples for SRv6 BE (IS-IS)
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_srv6_cfg_all_0279.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_srv6_cfg_all_0147.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>

<script language="JavaScript">
<!--
image_size('.imgResize');
var msg_imageMax = "view original image";
var msg_imageClose = "close";
//--></script></body>
</html>