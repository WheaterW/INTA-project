
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Non-labeled Public BGP Routes to Be Recursed to Manually Configured SR-MPLS TE Policies">
<meta name="abstract" content="This section provides an example for configuring non-labeled public BGP routes to be recursed to manually configured SR-MPLS TE Policies to forward public BGP traffic through the SR-MPLS TE Policies.">
<meta name="description" content="This section provides an example for configuring non-labeled public BGP routes to be recursed to manually configured SR-MPLS TE Policies to forward public BGP traffic through the SR-MPLS TE Policies.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_sr_all_cfg_0099.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_sr_all_cfg_0078.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_sr_all_cfg_0081.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="segment_routing_vrp,w00604599,l00455378,l00587852,w00606909,w00800033">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="Segment Routing MPLS">
<meta name="featuretype" content="Segment Routing">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="Segment Routing MPLS">
<meta name="featuretype" content="Segment Routing">
<meta name="featurename" content="Segment Routing MPLS">
<meta name="featuretype" content="Segment Routing">
<meta name="featurename" content="Segment Routing MPLS">
<meta name="featuretype" content="Segment Routing">
<meta name="OWNER" content="l00468467">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00468467">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172368909">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring Non-labeled Public BGP Routes to Be Recursed to Manually Configured SR-MPLS TE Policies</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172368909"></a><a name="EN-US_TASK_0172368909"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Non-labeled Public BGP Routes to Be Recursed to Manually Configured SR-MPLS TE Policies</h1>
<div class="taskbody"><p>This section provides an example for configuring non-labeled public BGP routes to be recursed to manually configured SR-MPLS TE Policies to forward public BGP traffic through the SR-MPLS TE Policies.</p>
<div class="context"><a name="EN-US_TASK_0172368909__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>If an Internet user uses a carrier network that performs IP forwarding to access the Internet, core carrier devices on the forwarding path need to learn many Internet routes. This imposes heavy loads on core carrier devices and affects the performance of these devices. To solve this problem, configure the corresponding access device to recurse non-labeled public BGP routes to SR-MPLS TE Policies, so that packets can be forwarded over the SR-MPLS TE Policies.</p>
<p><a href="#EN-US_TASK_0172368909__fig_dc_vrp_sr_all_cfg_008001">Figure 1</a> shows an example for configuring non-labeled public BGP routes to be recursed to manually configured SR-MPLS TE Policies.</p>
<div class="fignone" id="EN-US_TASK_0172368909__fig_dc_vrp_sr_all_cfg_008001"><a name="EN-US_TASK_0172368909__fig_dc_vrp_sr_all_cfg_008001"></a><a name="fig_dc_vrp_sr_all_cfg_008001"></a><span class="figcap"><b>Figure 1 </b>Recursion of non-labeled public BGP routes to manually configured SR-MPLS TE Policies</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 through 3 in this example represent GE <span>0/1/0</span>, GE <span>0/2/0</span>, and GE <span>0/3/0</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_sr_all_cfg_008001.png"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172368909__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Precautions</h4><p>When creating a peer, if the IP address of the peer is a loopback interface address or a sub-interface address, you need to run the <strong>peer connect-interface</strong> command on both ends of the peer relationship to ensure that the two ends are correctly connected.</p>
</div></div>
<div class="context"><a name="EN-US_TASK_0172368909__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure IS-IS on the backbone network for the PEs to communicate.</p>
</li><li><p>Enable MPLS and SR for each device on the backbone network, and configure static adjacency SIDs.</p>
</li><li><p>Configure an SR-MPLS TE Policy with primary and backup paths on each PE.</p>
</li><li><p>Configure SBFD and HSB on each PE to enhance SR-MPLS TE Policy reliability.</p>
</li><li><p>Apply an import or export route-policy to a specified VPNv4 peer on each PE, and set the Color Extended Community. In this example, an import route-policy with the Color Extended Community is applied.</p>
</li><li><p>Establish an IBGP peer relationship between the PEs for them to exchange routing information.</p>
</li><li><p>Configure a tunnel selection policy on each PE.</p>
</li><li><p>Enable the function to recurse non-labeled public BGP routes to SR-MPLS TE Policies on each PE.</p>
</li><li><p>Establish an EBGP peer relationship between each CE-PE pair for the CE and PE to exchange routing information.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172368909__1.4.4"></a><a name="1.4.4"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>MPLS LSR IDs of PEs and Ps</p>
</li><li><p>VPN target and RD of <strong>vpna</strong></p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172368909__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure interface IP addresses for each device on the backbone network.</span><p><p># Configure PE1.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname PE1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack1] <strong>ip address 1.1.1.9 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>ip address 10.13.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> interface gigabitethernet<span>0/3/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/3/0</span>] <strong>ip address 10.11.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/3/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure P1.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname P1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P1] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-LoopBack1] <strong>ip address 2.2.2.9 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1]<strong> interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/1/0</span>] <strong>ip address 10.11.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1]<strong> interface gigabitethernet<span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/2/0</span>] <strong>ip address 10.12.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname PE2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-LoopBack1] <strong>ip address 3.3.3.9 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>]<strong> ip address 10.14.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> interface gigabitethernet<span>0/3/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/3/0</span>]<strong> ip address 10.12.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/3/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> commit</strong></pre>
<p># Configure P2.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname P2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P2] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-LoopBack1] <strong>ip address 4.4.4.9 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2]<strong> interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/1/0</span>] <strong>ip address 10.13.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2]<strong> interface gigabitethernet<span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/2/0</span>] <strong>ip address 10.14.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2] <strong>commit</strong></pre>
</p></li><li><span>Configure an IGP for each device on the backbone network to implement interworking between PEs and Ps. IS-IS is used as an example.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>is-level level-1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>network-entity 10.0000.0000.0001.00</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack1] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> interface gigabitethernet<span>0/3/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/3/0</span>] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/3/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure P1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P1] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-isis-1] <strong>is-level level-1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-isis-1] <strong>network-entity 10.0000.0000.0002.00</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-LoopBack1] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1]<strong> interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/1/0</span>] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1]<strong> interface gigabitethernet<span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/2/0</span>] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1] <strong>is-level level-1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1] <strong>network-entity 10.0000.0000.0003.00</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-LoopBack1] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> interface gigabitethernet<span>0/3/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/3/0</span>]<strong> isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/3/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>]<strong> isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> commit</strong></pre>
<p># Configure P2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P2] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-isis-1] <strong>is-level level-1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-isis-1] <strong>network-entity 10.0000.0000.0004.00</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-LoopBack1] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2]<strong> interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/1/0</span>] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2]<strong> interface gigabitethernet<span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/2/0</span>] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2] <strong>commit</strong></pre>
</p></li><li><span>Configure basic MPLS functions for each device on the backbone network.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>mpls lsr-id 1.1.1.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-mpls] <strong>quit</strong></pre>
<p># Configure P1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P1] <strong>mpls lsr-id 2.2.2.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-mpls] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P1-mpls] <strong>quit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>mpls lsr-id 3.3.3.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-mpls]<strong> quit</strong></pre>
<p># Configure P2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P2] <strong>mpls lsr-id 4.4.4.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-mpls] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P2-mpls] <strong>quit</strong></pre>
</p></li><li><span>Enable SR for each device on the backbone network.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>segment-routing</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing] <strong>ipv4 adjacency local-ip-addr 10.11.1.1 remote-ip-addr 10.11.1.2 sid <span>330</span>000</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing] <strong>ipv4 adjacency local-ip-addr 10.13.1.1 remote-ip-addr 10.13.1.2 sid <span>330</span>001</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>cost-style wide</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>traffic-eng level-1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>segment-routing mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure P1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P1] <strong>segment-routing</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-segment-routing] <strong>ipv4 adjacency local-ip-addr 10.11.1.2 remote-ip-addr 10.11.1.1 sid <span>330</span>003</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-segment-routing] <strong>ipv4 adjacency local-ip-addr 10.12.1.1 remote-ip-addr 10.12.1.2 sid <span>330</span>002</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-segment-routing] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-isis-1] <strong>cost-style wide</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-isis-1] <strong>traffic-eng level-1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-isis-1] <strong>segment-routing mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>segment-routing</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-segment-routing] <strong>ipv4 adjacency local-ip-addr 10.12.1.2 remote-ip-addr 10.12.1.1 sid <span>330</span>000</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-segment-routing] <strong>ipv4 adjacency local-ip-addr 10.14.1.2 remote-ip-addr 10.14.1.1 sid <span>330</span>001</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-segment-routing] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1] <strong>cost-style wide</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1] <strong>traffic-eng level-1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1] <strong>segment-routing mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure P2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P2] <strong>segment-routing</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-segment-routing] <strong>ipv4 adjacency local-ip-addr 10.13.1.2 remote-ip-addr 10.13.1.1 sid <span>330</span>002</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-segment-routing] <strong>ipv4 adjacency local-ip-addr 10.14.1.1 remote-ip-addr 10.14.1.2 sid <span>330</span>003</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-segment-routing] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-isis-1] <strong>cost-style wide</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-isis-1] <strong>traffic-eng level-1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-isis-1] <strong>segment-routing mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2] <strong>commit</strong></pre>
</p></li><li><span>Configure an SR-MPLS TE Policy on each PE.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>segment-routing</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-segment-routing] <strong>segment-list pe1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing-segment-list<span>-pe1</span>] <strong>index 10 sid label <span>330</span>000</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing-segment-list<span>-pe1</span>] <strong>index 20 sid label <span>330</span>002</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing-segment-list<span>-pe1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing] <strong>segment-list pe1backup</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing-segment-list<span>-pe1backup</span>] <strong>index 10 sid label <span>330</span>001</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing-segment-list<span>-pe1backup</span>] <strong>index 20 sid label <span>330</span>003</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing-segment-list<span>-pe1backup</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing] <strong>sr-te policy policy100</strong> <strong>endpoint 3.3.3.9 color 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing-te-policy<span>-policy100</span>] <strong>binding-sid 115</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing-te-policy<span>-policy100</span>] <strong>mtu 1000</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing-te-policy<span>-policy100</span>] <strong>candidate-path preference 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing-te-policy<span>-policy100</span>-path] <strong>segment-list pe1backup</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing-te-policy<span>-policy100</span>-path] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing-te-policy<span>-policy100</span>] <strong>candidate-path preference 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing-te-policy<span>-policy100</span>-path] <strong>segment-list pe1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing-te-policy<span>-policy100</span>-path] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing-te-policy<span>-policy100</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>segment-routing</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-segment-routing] <strong>segment-list pe2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-segment-routing-segment-list<span>-pe2</span>] <strong>index 10 sid label <span>330</span>000</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-segment-routing-segment-list<span>-pe2</span>] <strong>index 20 sid label <span>330</span>003</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-segment-routing-segment-list<span>-pe2</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-segment-routing] <strong>segment-list pe2backup</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-segment-routing-segment-list<span>-pe2backup</span>] <strong>index 10 sid label <span>330</span>001</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-segment-routing-segment-list<span>-pe2backup</span>] <strong>index 20 sid label <span>330</span>002</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-segment-routing-segment-list<span>-pe2backup</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-segment-routing] <strong>sr-te policy policy200 endpoint 1.1.1.9 color 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-segment-routing-te-policy<span>-policy200</span>] <strong>binding-sid 115</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-segment-routing-te-policy<span>-policy200</span>] <strong>mtu 1000</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-segment-routing-te-policy<span>-policy200</span>] <strong>candidate-path preference 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-segment-routing-te-policy<span>-policy200</span>-path] <strong>segment-list pe2backup</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-segment-routing-te-policy<span>-policy200</span>-path] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-segment-routing-te-policy<span>-policy200</span>] <strong>candidate-path preference 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-segment-routing-te-policy<span>-policy200</span>-path] <strong>segment-list pe2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-segment-routing-te-policy<span>-policy200</span>-path] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-segment-routing-te-policy<span>-policy200</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-segment-routing] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p>After the configuration is complete, run the <a href="cmdqueryname=display+sr-te+policy"><b><span class="cmdname">display sr-te policy</span></b></a> command to check SR-MPLS TE Policy information. The following example uses the command output on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display sr-te policy</strong>
PolicyName : policy100
Endpoint             : 3.3.3.9              Color                : 100
TunnelId             : 1                    TunnelType           : SR-TE Policy
Binding SID          : 115                  MTU                  : 1000
Policy State         : Up                   State Change Time    : 2019-10-19 15:27:36
Admin State          : Up                   Traffic Statistics   : Disable
BFD                  : Disable              Backup Hot-Standby   : Disable
DiffServ-Mode        : -
Active IGP Metric    : -
Candidate-path Count : 2                    

Candidate-path Preference: 200
Path State           : Active               Path Type            : Primary
Protocol-Origin      : Configuration(30)    Originator           : 0, 0.0.0.0
Discriminator        : 200                  Binding SID          : -
GroupId              : 2                    Policy Name          : policy100
Template ID          : -
Active IGP Metric    : -                              ODN Color            : -
Metric               :
 IGP Metric          : -                              TE Metric            : -
 Delay Metric        : -                              Hop Counts           : -
Segment-List Count   : 1
 Segment-List        : pe1
  Segment-List ID    : 129                  XcIndex              : 68
  List State         : Up                   BFD State            : -
  EXP                : -                    TTL                  : -
  DeleteTimerRemain  : -<span>                    Weight               : 1</span>
  Label : <span>330</span>000, <span>330</span>002

Candidate-path Preference: 100
Path State           : Inactive (Valid)     Path Type            : -
Protocol-Origin      : Configuration(30)    Originator           : 0, 0.0.0.0
Discriminator        : 100                  Binding SID          : -
GroupId              : 1                    Policy Name          : policy100
Template ID          : -
Active IGP Metric    : -                              ODN Color            : -
Metric               :
 IGP Metric          : -                              TE Metric            : -
 Delay Metric        : -                              Hop Counts           : -
Segment-List Count   : 1
 Segment-List        : pe1backup
  Segment-List ID    : 194                  XcIndex              : -
  List State         : Up                   BFD State            : -
  EXP                : -                    TTL                  : -
  DeleteTimerRemain  : -<span>                    Weight               : 1</span>
  Label : <span>330</span>001, <span>330</span>003</pre>
</p></li><li><span>Configure SBFD and HSB.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bfd</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bfd] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>sbfd</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-sbfd] <strong>reflector discriminator 1.1.1.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-sbfd] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>segment-routing</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing] <strong>sr-te-policy seamless-bfd enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing] <strong>sr-te-policy backup hot-standby enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-segment-routing] <strong>quit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>bfd</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bfd] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>sbfd</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-sbfd] <strong>reflector discriminator 3.3.3.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-sbfd] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>segment-routing</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-segment-routing] <strong>sr-te-policy seamless-bfd enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-segment-routing] <strong>sr-te-policy backup hot-standby enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-segment-routing] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-segment-routing] <strong>quit</strong></pre>
</p></li><li><span>Configure a route-policy.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>route-policy color100 permit node 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-route-policy] <strong>apply extcommunity color 0:100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-route-policy] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>route-policy color200 permit node 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-route-policy] <strong>apply extcommunity color 0:200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-route-policy] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</p></li><li><span>Establish a BGP peer relationship between the PEs, apply an import route-policy to a specified BGP peer, and set the color extended community for routes.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 3.3.3.9 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 3.3.3.9 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 3.3.3.9 route-policy color100 import</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp] <strong>quit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>peer 1.1.1.9 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>peer 1.1.1.9 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>peer 1.1.1.9 route-policy color200 import</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-bgp] <strong>quit</strong></pre>
<p>After the configuration is complete, run the <strong>display bgp peer</strong> command on the PEs to check whether the BGP peer relationship has been established. If the <strong>Established</strong> state is displayed in the command output, the BGP peer relationship has been established successfully. The following example uses the command output on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display bgp peer</strong></pre>
<pre class="screen"> BGP local router ID : 1.1.1.9
 Local AS number : 100
 Total number of peers : 1          Peers in established state : 1
  Peer            V    AS  MsgRcvd  MsgSent     OutQ  Up/Down    State        PrefRcv
  3.3.3.9         4   100        2        6     0     00:00:12   <strong>Established</strong>   0</pre>
</p></li><li><span>Configure a tunnel selection policy on each PE for the specified SR-MPLS TE Policy to be preferentially selected.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>tunnel-policy p1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-tunnel-policy-p1] <strong>tunnel select-seq sr-te-policy load-balance-number 1 unmix</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-tunnel-policy-p1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>route recursive-lookup tunnel tunnel-policy p1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>tunnel-policy p1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-tunnel-policy-p1] <strong>tunnel select-seq sr-te-policy load-balance-number 1 unmix</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-tunnel-policy-p1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>route recursive-lookup tunnel tunnel-policy p1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</p></li><li><span>Configure each PE to import a local route.</span><p><p>In this example, loopback addresses 8.8.8.8/32 and 9.9.9.9/32 are used to simulate the local network on PE1 and PE2, respectively.</p>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface loopback 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack1] <strong>ip address 8.8.8.8 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>network 8.8.8.8 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>interface loopback 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-LoopBack1] <strong>ip address 9.9.9.9 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>network 9.9.9.9 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p>After completing the configuration, run the <strong>display ip routing-table verbose</strong> command on each PE to check detailed routing information. The following example uses the command output on PE1. The command output shows that the route advertised by the peer PE has been successfully recursed to the specified SR-MPLS TE Policy.</p>
<p>The following example uses the command output on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display ip routing-table 9.9.9.9 32 verbose</strong>
Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route
------------------------------------------------------------------------------
Routing Table : _public_
Summary Count : 1

Destination: 9.9.9.9/32          
     Protocol: IBGP               Process ID: 0              
   Preference: 255                      Cost: 0              
      NextHop: 3.3.3.9             Neighbour: 3.3.3.9
        State: Active Adv Relied         Age: 00h19m06s           
          Tag: 0                    Priority: low            
        Label: NULL                  QoSInfo: 0x0           
   IndirectID: 0x10000C7            Instance:                                 
 RelayNextHop: 0.0.0.0             <strong>Interface: <span>policy100</span></strong>
<strong>    TunnelID: 0x000000003200000001 Flags: RD</strong></pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172368909__1.4.6"></a><a name="1.4.6"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>PE1 configuration file</p>
<pre class="screen">#
sysname PE1
#
bfd
#
sbfd
 reflector discriminator 1.1.1.9
#
mpls lsr-id 1.1.1.9
#               
mpls            
#               
segment-routing 
 ipv4 adjacency local-ip-addr 10.11.1.1 remote-ip-addr 10.11.1.2 sid <span>330</span>000
 ipv4 adjacency local-ip-addr 10.13.1.1 remote-ip-addr 10.13.1.2 sid <span>330</span>001
 sr-te-policy backup hot-standby enable
 sr-te-policy seamless-bfd enable
 segment-list pe1
  index 10 sid label <span>330</span>000
  index 20 sid label <span>330</span>002
 segment-list pe1backup
  index 10 sid label <span>330</span>001
  index 20 sid label <span>330</span>003
 sr-te policy policy100 endpoint 3.3.3.9 color 100
  binding-sid 115
  mtu 1000   
  candidate-path preference 200
   segment-list pe1
  candidate-path preference 100
   segment-list pe1backup
#               
isis 1          
 is-level level-1
 cost-style wide
 network-entity 10.0000.0000.0001.00
 traffic-eng level-1
 segment-routing mpls
#               
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown  
 ip address 10.13.1.1 255.255.255.0
 isis enable 1  
#               
interface GigabitEthernet<span>0/3/0</span>
 undo shutdown  
 ip address 10.11.1.1 255.255.255.0
 isis enable 1  
#               
interface LoopBack1
 ip address 1.1.1.9 255.255.255.255
 isis enable 1  
#               
interface LoopBack2
 ip address 8.8.8.8 255.255.255.255
#               
bgp 100         
 peer 3.3.3.9 as-number 100
 peer 3.3.3.9 connect-interface LoopBack1
 #              
 ipv4-family unicast
  undo synchronization
  network 8.8.8.8 255.255.255.255
  peer 3.3.3.9 enable
  peer 3.3.3.9 route-policy color100 import
#
route-policy color100 permit node 1
 apply extcommunity color 0:100
#               
route recursive-lookup tunnel tunnel-policy p1
#               
tunnel-policy p1
 tunnel select-seq sr-te-policy load-balance-number 1 unmix
#
return</pre>
</li><li><p>P1 configuration file</p>
<pre class="screen">#
sysname P1
#
mpls lsr-id 2.2.2.9
#               
mpls            
#               
segment-routing 
 ipv4 adjacency local-ip-addr 10.12.1.1 remote-ip-addr 10.12.1.2 sid <span>330</span>002
 ipv4 adjacency local-ip-addr 10.11.1.2 remote-ip-addr 10.11.1.1 sid <span>330</span>003
#               
isis 1          
 is-level level-1
 cost-style wide
 network-entity 10.0000.0000.0002.00
 traffic-eng level-1
 segment-routing mpls
#               
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown  
 ip address 10.11.1.2 255.255.255.0
 isis enable 1  
#               
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown  
 ip address 10.12.1.1 255.255.255.0
 isis enable 1  
#               
interface LoopBack1
 ip address 2.2.2.9 255.255.255.255
 isis enable 1  
#
return</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#
sysname PE2
#
bfd
#
sbfd
 reflector discriminator 3.3.3.9
#
mpls lsr-id 3.3.3.9
#               
mpls            
#               
segment-routing 
 ipv4 adjacency local-ip-addr 10.12.1.2 remote-ip-addr 10.12.1.1 sid <span>330</span>000
 ipv4 adjacency local-ip-addr 10.14.1.2 remote-ip-addr 10.14.1.1 sid <span>330</span>001
 sr-te-policy backup hot-standby enable
 sr-te-policy seamless-bfd enable
 segment-list pe2
  index 10 sid label <span>330</span>000
  index 20 sid label <span>330</span>003
 segment-list pe2backup
  index 10 sid label <span>330</span>001
  index 20 sid label <span>330</span>002
 sr-te policy policy200 endpoint 1.1.1.9 color 200
  binding-sid 115
  mtu 1000  
  candidate-path preference 200
   segment-list pe2
  candidate-path preference 100
   segment-list pe2backup
#               
isis 1          
 is-level level-1
 cost-style wide
 network-entity 10.0000.0000.0003.00
 traffic-eng level-1
 segment-routing mpls
#               
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown  
 ip address 10.14.1.2 255.255.255.0
 isis enable 1  
#               
interface GigabitEthernet<span>0/3/0</span>
 undo shutdown  
 ip address 10.12.1.2 255.255.255.0
 isis enable 1  
#               
interface LoopBack1
 ip address 3.3.3.9 255.255.255.255
 isis enable 1  
#               
interface LoopBack2
 ip address 9.9.9.9 255.255.255.255
#               
bgp 100         
 peer 1.1.1.9 as-number 100
 peer 1.1.1.9 connect-interface LoopBack1
 #              
 ipv4-family unicast
  undo synchronization
  network 9.9.9.9 255.255.255.255
  peer 1.1.1.9 enable
  peer 1.1.1.9 route-policy color200 import
#
route-policy color200 permit node 1
 apply extcommunity color 0:200
#               
route recursive-lookup tunnel tunnel-policy p1
#               
tunnel-policy p1
 tunnel select-seq sr-te-policy load-balance-number 1 unmix
#
return</pre>
</li><li><p>P2 configuration file</p>
<pre class="screen">#
sysname P2
#
mpls lsr-id 4.4.4.9
#               
mpls            
#               
segment-routing 
 ipv4 adjacency local-ip-addr 10.13.1.2 remote-ip-addr 10.13.1.1 sid <span>330</span>002
 ipv4 adjacency local-ip-addr 10.14.1.1 remote-ip-addr 10.14.1.2 sid <span>330</span>003
#               
isis 1          
 is-level level-1
 cost-style wide
 network-entity 10.0000.0000.0004.00
 traffic-eng level-1
 segment-routing mpls
#               
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown  
 ip address 10.13.1.2 255.255.255.0
 isis enable 1  
#               
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown  
 ip address 10.14.1.1 255.255.255.0
 isis enable 1  
#               
interface LoopBack1
 ip address 4.4.4.9 255.255.255.255
 isis enable 1  
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_sr_all_cfg_0099.html">Configuration Examples for SR-MPLS TE Policy
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_sr_all_cfg_0078.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_sr_all_cfg_0081.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>