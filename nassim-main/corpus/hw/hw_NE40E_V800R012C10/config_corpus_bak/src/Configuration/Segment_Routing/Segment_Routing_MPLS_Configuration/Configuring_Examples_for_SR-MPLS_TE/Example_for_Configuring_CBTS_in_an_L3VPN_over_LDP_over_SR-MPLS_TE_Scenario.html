
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring CBTS in an L3VPN over LDP over SR-MPLS TE Scenario">
<meta name="abstract" content="This section provides an example for configuring class-of-service-based tunnel selection (CBTS) in an L3VPN over LDP over SR-MPLS TE scenario.">
<meta name="description" content="This section provides an example for configuring class-of-service-based tunnel selection (CBTS) in an L3VPN over LDP over SR-MPLS TE scenario.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_sr-te_cfg_0090.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_sr-te_cfg_0327.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_sr-te_cfg_0328.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00606909,l00587852">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="Segment Routing MPLS">
<meta name="featuretype" content="Segment Routing">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="Segment Routing MPLS">
<meta name="featuretype" content="Segment Routing">
<meta name="featurename" content="Segment Routing MPLS">
<meta name="featuretype" content="Segment Routing">
<meta name="featurename" content="Segment Routing MPLS">
<meta name="featuretype" content="Segment Routing">
<meta name="OWNER" content="l00425560">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00468467">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0192770966">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring CBTS in an L3VPN over LDP over SR-MPLS TE Scenario</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0192770966"></a><a name="EN-US_TASK_0192770966"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring CBTS in an L3VPN over LDP over SR-MPLS TE Scenario</h1>
<div class="taskbody"><p>This section provides an example for configuring class-of-service-based tunnel selection (CBTS) in an L3VPN over LDP over SR-MPLS TE scenario.</p>
<div class="context"><a name="EN-US_TASK_0192770966__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0192770966__fig_dc_ne_te-p2p_cfg_600301">Figure 1</a>, CE1 and CE2 belong to the same L3VPN. They access the public network through PE1 and PE2, respectively. Various types of services are transmitted between CE1 and CE2. Transmitting a large number of common services deteriorates the efficiency of transmitting important services. To prevent this problem, configure the CBTS function. This function allows traffic of a specific service class to be transmitted along a specified tunnel.</p>
<p>This example requires Tunnel1 to transmit important services and Tunnel2 to transmit other services.</p>
<div class="notice"><span class="noticetitle"><img src="../../../../public_sys-resources/notice_3.0-en-us.png"> </span><div class="noticebody"><p id="EN-US_TASK_0192770966__en-us_task_0192910605_p472181012428">If the CBTS function is configured, you are advised not to configure any of the following functions:</p>
<ul id="EN-US_TASK_0192770966__en-us_task_0192910605_ul637284753214046"><li id="EN-US_TASK_0192770966__en-us_task_0192910605_li1775934675214046">Mixed load balancing</li><li id="EN-US_TASK_0192770966__en-us_task_0192910605_li880128083214046">Dynamic load balancing</li></ul>
</div></div>
<div class="fignone" id="EN-US_TASK_0192770966__fig_dc_ne_te-p2p_cfg_600301"><a name="EN-US_TASK_0192770966__fig_dc_ne_te-p2p_cfg_600301"></a><a name="fig_dc_ne_te-p2p_cfg_600301"></a><span class="figcap"><b>Figure 1 </b>CBTS networking in an L3VPN over LDP over SR-MPLS TE scenario</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 and 2 in this example represent GE <span>0/1/0</span> and GE <span>0/2/0</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0192811479.png"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0192770966__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Precautions</h4><p>The destination IP address of a tunnel must be equal to the LSR ID of the egress of the tunnel.</p>
</div></div>
<div class="context"><a name="EN-US_TASK_0192770966__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Assign an IP address and its mask to each interface and configure a loopback interface address as an LSR ID on each node. In addition, configure an IGP to advertise routes.</p>
</li><li><p>Create an SR-MPLS TE tunnel in each TE-capable area, and specify a service class for packets that can be transmitted by the tunnel.</p>
</li><li><p>Enable MPLS LDP in the TE-incapable area, and configure a remote LDP peer for each edge node in the TE-capable area.</p>
</li><li><p>Configure the TE forwarding adjacency function.</p>
</li><li><p>Configure multi-field classification on nodes connected to the L3VPN as well as behavior aggregate classification on LDP over SR-MPLS TE links.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0192770966__1.4.4"></a><a name="1.4.4"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>IS-IS process ID, level, network entity ID, and cost type</p>
</li><li><p>Policy that is used for triggering LSP establishment</p>
</li><li><p>Name and IP address of each remote LDP peer of P1 and P2</p>
</li><li><p>Link bandwidth attributes of each tunnel</p>
</li><li><p>Tunnel interface number, IP address, destination IP address, tunnel ID, tunnel signaling protocol, tunnel bandwidth, TE metric value, and link cost on P1 and P2</p>
</li><li><p>Multi-field classifier name and traffic policy name</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0192770966__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Assign an IP address and its mask to each interface.</span><p><p># Configure PE1.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname PE1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack1] <strong>ip address 1.1.1.1 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>ip address 10.1.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure P1.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname P1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P1] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-LoopBack1] <strong>ip address 2.2.2.2 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1]<strong> interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/1/0</span>] <strong>ip address 10.1.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1]<strong> interface gigabitethernet<span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/2/0</span>] <strong>ip address 10.2.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1] <strong>commit</strong></pre>
<p># Configure P2.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname P2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P2] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-LoopBack1] <strong>ip address 4.4.4.4 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2]<strong> interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/1/0</span>] <strong>ip address 10.3.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2]<strong> interface gigabitethernet<span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/2/0</span>] <strong>ip address 10.4.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2] <strong>commit</strong></pre>
<p># Configure P3.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname P3</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P3] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P3-LoopBack1] <strong>ip address 3.3.3.3 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P3-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P3]<strong> interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P3-GigabitEthernet<span>0/1/0</span>] <strong>ip address 10.2.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P3-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P3]<strong> interface gigabitethernet<span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P3-GigabitEthernet<span>0/2/0</span>] <strong>ip address 10.3.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P3-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P3] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname PE2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-LoopBack1] <strong>ip address 5.5.5.5 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> interface gigabitethernet</strong><strong><span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>]<strong> ip address 10.4.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> commit</strong></pre>
</p></li><li><span>Enable IS-IS to advertise the route of the network segment connected to each interface and the host route destined for each LSR ID. </span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>cost-style wide</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1]<strong> network-entity </strong><strong>10.0000.0000.0001.00</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1]<strong> is-level level-2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack1] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-LoopBack1] <strong>quit</strong></pre>
<p># Configure P1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P1] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-isis-1] <strong>cost-style wide</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-isis-1] <strong>network-entity </strong><strong>10.0000.0000.0002.00</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-isis-1] <strong>is-level level-2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/1/0</span>] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1] <strong>interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/2/0</span>] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-LoopBack1] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-LoopBack1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P1-LoopBack1] <strong>quit</strong></pre>
<p># Configure P2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P2] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-isis-1] <strong>cost-style wide</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-isis-1]<strong> network-entity 10.0000.0000.0003.00</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-isis-1]<strong> is-level level-2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/1/0</span>] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2]<strong> interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/2/0</span>] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2]<strong> interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-LoopBack1] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-LoopBack1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P2-LoopBack1] <strong>quit</strong></pre>
<p># Configure P3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P3] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P3-isis-1] <strong>cost-style wide</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P3-isis-1]<strong> network-entity 10.0000.0000.0004.00</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P3-isis-1]<strong> is-level level-2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P3-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P3]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P3-GigabitEthernet<span>0/1/0</span>] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P3-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P3]<strong> interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P3-GigabitEthernet<span>0/2/0</span>] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P3-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P3]<strong> interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P3-LoopBack1] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P3-LoopBack1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P3-LoopBack1] <strong>quit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1] <strong>cost-style wide</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1]<strong> network-entity 10.0000.0000.0005.00</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1]<strong> is-level level-2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-LoopBack1] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-LoopBack1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-LoopBack1] <strong>quit</strong></pre>
<p>After completing the preceding configurations, run the <strong>display ip routing-table</strong> command on each node to check that both PEs have learned routes from each other. </p>
</p></li><li><span>Establish an MP-IBGP peer relationship between PEs.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp] <strong>peer 5.5.5.5 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 5.5.5.5 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>ipv4-family vpnv4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-vpnv4] <strong>peer 5.5.5.5 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-vpnv4] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp-af-vpnv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp] <strong>quit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-bgp] <strong>peer 1.1.1.1 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>peer 1.1.1.1 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>ipv4-family vpnv4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-vpnv4] <strong>peer 1.1.1.1 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-vpnv4] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-bgp-af-vpnv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-bgp] <strong>quit</strong></pre>
<p>After the configuration is complete, run the <strong>display bgp peer</strong> or <strong>display bgp vpnv4 all peer</strong> command on the PEs to check whether a BGP peer relationship has been established between the PEs. If the <strong>Established</strong> state is displayed in the command output, the BGP peer relationship has been established successfully. The following example uses the command output on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display bgp peer</strong></pre>
<pre class="screen"> BGP local router ID : 1.1.1.1
 Local AS number : 100
 Total number of peers : 1          Peers in established state : 1
  Peer            V    AS  MsgRcvd  MsgSent     OutQ  Up/Down    State        PrefRcv
  5.5.5.5         4   100        2        6     0     00:00:12   <strong>Established</strong>   0</pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display bgp vpnv4 all peer</strong></pre>
<pre class="screen"> BGP local router ID : 1.1.1.1
 Local AS number : 100
 Total number of peers : 1                 Peers in established state : 1
  Peer            V    AS  MsgRcvd  MsgSent    OutQ  Up/Down    State        PrefRcv
  5.5.5.5         4   100   12      18         0     00:09:38   <strong>Established</strong>   0</pre>
</p></li><li><span>Configure basic MPLS functions, and enable LDP between PE1 and P1 and between PE2 and P2.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> mpls lsr-id 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls]<strong> lsp-trigger all</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/0</span>]<strong> quit</strong></pre>
<p># Configure P1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P1] <strong>mpls lsr-id 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-mpls] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-mpls] <strong>lsp-trigger all</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-mpls-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/1/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1] <strong>interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/2/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/2/0</span>] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/2/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<p># Configure P3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P3] <strong>mpls lsr-id 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P3] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P3-mpls] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P3-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P3]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P3-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P3-GigabitEthernet<span>0/1/0</span>] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P3-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P3]<strong> interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P3-GigabitEthernet<span>0/2/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P3-GigabitEthernet<span>0/2/0</span>] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P3-GigabitEthernet<span>0/2/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P3-GigabitEthernet<span>0/2/0</span>]<strong> quit</strong></pre>
<p># Configure P2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P2]<strong> mpls lsr-id 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-mpls] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-mpls] <strong>lsp-trigger all</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-mpls-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/1/0</span>] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2] <strong>interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/2/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/2/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/2/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P2-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>mpls lsr-id 5.5.5.5</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls] <strong>lsp-trigger all</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<p>After you complete the preceding configurations, local LDP sessions are successfully established between PE1 and P1 and between PE2 and P2.</p>
<p># Run the <strong>display mpls ldp session</strong> command on PE1, P1, P2, or PE2 to view LDP session information.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display mpls ldp session</strong></pre>
<pre class="screen"> LDP Session(s) in Public Network
 Codes: LAM(Label Advertisement Mode), SsnAge Unit(DDDD:HH:MM)
 An asterisk (*) before a session means the session is being deleted.
--------------------------------------------------------------------------
 PeerID             Status      LAM  SsnRole  SsnAge       KASent/Rcv
--------------------------------------------------------------------------
 2.2.2.2:0          Operational DU   Passive  0000:00:05   23/23
--------------------------------------------------------------------------
TOTAL: 1 Session(s) Found.</pre>
<p># Run the <strong>display mpls ldp peer</strong> command to view LDP peer information. The following example uses the command output on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display mpls ldp peer</strong></pre>
<pre class="screen"> LDP Peer Information in Public network
 An asterisk (*) before a peer means the peer is being deleted.
 -------------------------------------------------------------------------
 PeerID                 TransportAddress   DiscoverySource
 -------------------------------------------------------------------------
 2.2.2.2:0              2.2.2.2            GigabitEthernet<span>0/1/0</span>       
 -------------------------------------------------------------------------
TOTAL: 1 Peer(s) Found.</pre>
<p># Run the <strong>display mpls lsp</strong> command to view LDP LSP information. The following example uses the command output on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display mpls lsp</strong>
Flag after Out IF: (I) - RLFA Iterated LSP, (I*) - Normal and RLFA Iterated LSP 
Flag after LDP FRR: (L) - Logic FRR LSP
----------------------------------------------------------------------
                 LSP Information: LDP LSP
----------------------------------------------------------------------
FEC                In/Out Label  In/Out IF                      Vrf Name
1.1.1.1/32         3/NULL        GE<span>0/1/0</span>/-
2.2.2.2/32         NULL/3        -/GE<span>0/1/0</span>
2.2.2.2/32         1024/3        -/GE<span>0/1/0</span>
10.1.1.0/24        3/NUL         GE<span>0/1/0</span>/-
10.2.1.0/24        NULL/3        -/GE<span>0/1/0</span>
10.2.1.0/24        1025/3        -/GE<span>0/1/0</span></pre>
</p></li><li><span>Set up a remote LDP session between P1 and P2.</span><p><p># Configure P1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P1] <strong>mpls ldp remote-peer lsrd</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-mpls-ldp-remote-lsrd] <strong>remote-ip 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-mpls-ldp-remote-lsrd] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P1-mpls-ldp-remote-lsrd] <strong>quit</strong></pre>
<p># Configure P2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P2] <strong>mpls ldp remote-peer lsrb</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-mpls-ldp-remote-lsrb] <strong>remote-ip 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-mpls-ldp-remote-lsrb] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P2-mpls-ldp-remote-lsrb] <strong>quit</strong></pre>
<p>After you complete the preceding configurations, a remote LDP session is set up between P1 and P2. Run the <strong>display mpls ldp remote-peer</strong> command on P1 or P2 to view information about the remote session entity. The following example uses the command output on P1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P1] <strong>display mpls ldp remote-peer lsrd</strong></pre>
<pre class="screen">                         LDP Remote Entity Information
 ------------------------------------------------------------------------------
 Remote Peer Name  : lsrd
 Description       : ----
 Remote Peer IP    : 4.4.4.4              LDP ID        : 2.2.2.2:0
 Transport Address : 2.2.2.2              Entity Status : Active

 Configured Keepalive Hold Timer : 45 Sec
 Configured Keepalive Send Timer : ----
 Configured Hello Hold Timer     : 45 Sec
 Negotiated Hello Hold Timer     : 45 Sec
 Configured Hello Send Timer     : ----
 Configured Delay Timer          : ----
 Hello Packet sent/received      : 425/382
 Label Advertisement Mode        : Downstream Unsolicited
 Auto-config                     : ---- 
 Manual-config                   : effective
 Session-Protect effect          : NO 
 Session-Protect Duration        : ---- 
 Session-Protect Remain          : ----
 ------------------------------------------------------------------------------
 TOTAL: 1 Remote-Peer(s) Found.</pre>
</p></li><li><span>Configure bandwidth attributes for the outbound interface of each TE tunnel.</span><p><p># Configure P1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P1]<strong> interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P1-GigabitEthernet<span>0/2/0</span>] <strong>mpls te bandwidth max-reservable-bandwidth 20000</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/2/0</span>] <strong>mpls te bandwidth bc0 20000</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/2/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<p># Configure P3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P3]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P3-GigabitEthernet<span>0/1/0</span>]<strong> mpls te bandwidth max-reservable-bandwidth 20000</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P3-GigabitEthernet<span>0/1/0</span>]<strong> mpls te bandwidth bc0 20000</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P3-GigabitEthernet<span>0/1/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P3]<strong> interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P3-GigabitEthernet<span>0/2/0</span>]<strong> mpls te bandwidth max-reservable-bandwidth 20000</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P3-GigabitEthernet<span>0/2/0</span>]<strong> mpls te bandwidth bc0 20000</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P3-GigabitEthernet<span>0/2/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P3-GigabitEthernet<span>0/2/0</span>]<strong> quit</strong></pre>
<p># Configure P2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P2]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P2-GigabitEthernet<span>0/1/0</span>]<strong> mpls te bandwidth max-reservable-bandwidth 20000</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/1/0</span>]<strong> mpls te bandwidth bc0 20000</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/1/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P2-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
</p></li><li><span>Configure L3VPN access on PE1 and PE2 and multi-field classification on the inbound interface of PE1.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> ip vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA]<strong> ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4] <strong>route-distinguisher 100:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4] <strong>vpn-target 111:1 both</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>]<strong> ip binding vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>ip address 10.10.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>acl 2001</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-acl4-basic-2001] <strong>rule 10 permit source 10.40.0.0 0.0.255.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-acl4-basic-2001] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>acl 2002</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-acl4-basic-2002] <strong>rule 20 permit source 10.50.0.0 0.0.255.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-acl4-basic-2002] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>traffic classifier service1</strong><strong> operator or</strong> </pre>
<pre class="screen">[<span class="keyword">*</span>PE1-classifier-service1] <strong>if-match acl 2001</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-classifier-service1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-classifier-service1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>traffic behavior behavior1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-behavior-behavior1] <strong>service-class af1 color green</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-behavior-behavior1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-behavior-behavior1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>traffic classifier service2</strong><strong> operator or</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-classifier-service2] <strong>if-match acl 2002</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-classifier-service2] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-classifier-service2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>traffic behavior behavior2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-behavior-behavior2] <strong>service-class af2 color green</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-behavior-behavior2] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-behavior-behavior2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>traffic policy test</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-trafficpolicy-test] <strong>classifier service1 behavior behavior1 </strong><strong>precedence 1</strong> </pre>
<pre class="screen">[<span class="keyword">*</span>PE1-trafficpolicy-test] <strong>classifier service2 behavior behavior2</strong><strong> </strong><strong>precedence 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-trafficpolicy-test] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-trafficpolicy-test] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>traffic-policy test inbound</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2]<strong> ip vpn-instance VPNB</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNB]<strong> ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNB-af-ipv4] <strong>route-distinguisher 200:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNB-af-ipv4] <strong>vpn-target 111:1 both</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNB-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNB]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>]<strong> ip binding vpn-instance VPNB</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>] <strong>ip address 10.11.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
</p></li><li><span>Configure behavior aggregate classification on interfaces connecting PE1 and P1.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/0</span>]<strong> trust upstream default</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/0</span>]<strong> quit</strong></pre>
<p># Configure P1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P1]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P1-GigabitEthernet<span>0/1/0</span>]<strong> trust upstream default</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/1/0</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P1-GigabitEthernet<span>0/1/0</span>]<strong> quit</strong></pre>
</p></li><li><span>Enable SR and configure an explicit path.</span><p><p>In this example, the explicit path is used to establish an SR-MPLS TE tunnel.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0192770966__en-us_task_0172368860_p969181111187">The SRGB range varies according to the device. The range specified in this example is for reference only.</p>
</div></div>
<p># Configure P1.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>P1] <strong>segment-routing</strong>
[*P1-segment-routing] <strong>quit</strong>
[*P1] <strong>isis 1</strong>
[*P1-isis-1] <strong>traffic-eng level-2</strong>
[*P1-isis-1] <strong>segment-routing mpls</strong>
[*P1-isis-1] <strong>segment-routing global-block 16000 19000</strong>
[*P1-isis-1] <strong>commit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>P1-isis-1] <strong>quit</strong></pre>
<p># Configure P2.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>P2] <strong>segment-routing</strong>
[*P2-segment-routing] <strong>quit</strong>
[*P2] <strong>isis 1</strong>
[*P2-isis-1] <strong>traffic-eng level-2</strong>
[*P2-isis-1] <strong>segment-routing mpls</strong>
[*P2-isis-1] <strong>segment-routing global-block 16000 19000</strong>
[*P2-isis-1] <strong>commit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>P2-isis-1] <strong>quit</strong></pre>
<p># Configure P3.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>P3] <strong>segment-routing</strong>
[*P3-segment-routing] <strong>quit</strong>
[*P3] <strong>isis 1</strong>
[*P3-isis-1] <strong>traffic-eng level-2</strong>
[*P3-isis-1] <strong>segment-routing mpls</strong>
[*P3-isis-1] <strong>segment-routing global-block 16000 19000</strong>
[*P3-isis-1] <strong>commit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>P3-isis-1] <strong>quit</strong></pre>
<p># Display the adjacency SID of each node.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>P1] <strong>display segment-routing adjacency mpls forwarding</strong> 

            Segment Routing Adjacency MPLS Forwarding Information

Label     Interface         NextHop          Type        MPLSMtu   Mtu       VPN-Name       
-------------------------------------------------------------------------------------
48091     GE<span>0/1/0</span>           10.1.1.1         ISIS-V4     ---       1500      _public_  
48092     GE<span>0/2/0</span>           10.2.1.2         ISIS-V4     ---       1500      _public_          

Total information(s): 2</pre>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>P3] <strong>display segment-routing adjacency mpls forwarding</strong>

            Segment Routing Adjacency MPLS Forwarding Information

Label     Interface         NextHop          Type        MPLSMtu   Mtu       VPN-Name       
-------------------------------------------------------------------------------------
48090     GE<span>0/1/0</span>           10.2.1.1         ISIS-V4     ---       1500      _public_      
48091     GE<span>0/2/0</span>           10.3.1.2         ISIS-V4     ---       1500      _public_      

Total information(s): 2</pre>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>P2] <strong>display segment-routing adjacency mpls forwarding</strong>

            Segment Routing Adjacency MPLS Forwarding Information

Label     Interface         NextHop          Type        MPLSMtu   Mtu       VPN-Name       
-------------------------------------------------------------------------------------
48090     GE<span>0/2/0</span>           10.4.1.1         ISIS-V4     ---       1500      _public_      
48091     GE<span>0/1/0</span>           10.3.1.1         ISIS-V4     ---       1500      _public_      

Total information(s): 2</pre>
<p># Configure an explicit path from P1 to P2.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>P1] <strong>explicit-path p1_p2</strong>
[*P1-explicit-path-p1_p2] <strong>next sid label 48092 type adjacency</strong>
[*P1-explicit-path-p1_p2] <strong>next sid label 48091 type adjacency</strong>
[*P1-explicit-path-p1_p2] <strong>commit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>P1-explicit-path-p1_p2] <strong>quit</strong></pre>
<p># Configure an explicit path from P2 to P1.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>P2] <strong>explicit-path p2_p1</strong>
[*P2-explicit-path-p2_p1] <strong>next sid label 48091 type adjacency</strong>
[*P2-explicit-path-p2_p1] <strong>next sid label 48090 type adjacency</strong>
[*P2-explicit-path-p2_p1] <strong>commit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>P2-explicit-path-p2_p1] <strong>quit</strong></pre>
</p></li><li><span>Configure TE tunnels from P1 to P2 and set a service class for each type of packet that can be transmitted by the tunnels.</span><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Run the <a href="cmdqueryname=mpls+te+service-class"><b><span class="cmdname">mpls te service-class</span></b></a> { <i><span class="varname">service-class</span></i> &amp; &lt;1-8&gt; | <strong><span>default</span></strong> } command to set a service class for packets that are allowed to pass through tunnels.</p>
</div></div>
<p># On P1, enable the IGP shortcut function on each tunnel interface and adjust the metric value of the forwarding adjacency function to ensure that traffic destined for P2 or PE2 passes through the corresponding tunnel.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P1]<strong> interface Tunnel1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-Tunnel1] <strong>ip address unnumbered interface LoopBack1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-Tunnel1] <strong>tunnel-protocol mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-Tunnel1] <strong>destination 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-Tunnel1] <strong>mpls te tunnel-id 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-Tunnel1] <strong>mpls te bandwidth ct0 10000</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-Tunnel1] <strong>mpls te igp shortcut</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-Tunnel1] <strong>mpls te igp metric absolute 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-Tunnel1] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-Tunnel1] <strong>mpls te signal-protocol segment-routing</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-Tunnel1] <strong>mpls te path explicit-path p1_p2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-Tunnel1] <strong>mpls te service-class af1 af2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-Tunnel1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1]<strong> interface Tunnel2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-Tunnel2] <strong>ip address unnumbered interface LoopBack1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-Tunnel2] <strong>tunnel-protocol mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-Tunnel2] <strong>destination 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-Tunnel2] <strong>mpls te tunnel-id 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-Tunnel2] <strong>mpls te bandwidth ct0 10000</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-Tunnel2] <strong>mpls te igp shortcut</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-Tunnel2] <strong>mpls te igp metric absolute 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-Tunnel2] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-Tunnel2] <strong>mpls te signal-protocol segment-routing</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-Tunnel2] <strong>mpls te path explicit-path p1_p2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-Tunnel2] <strong>mpls te service-class default</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-Tunnel2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1] <strong>commit</strong></pre>
</p></li><li><span>Configure a tunnel from P2 to P1.</span><p><p># On P2, enable the forwarding adjacency function on each tunnel interface and adjust the metric value of the forwarding adjacency function to ensure that traffic destined for PE1 or P1 passes through the tunnel.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P2] <strong>interface Tunnel1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-Tunnel1] <strong>ip address unnumbered interface LoopBack1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-Tunnel1] <strong>tunnel-protocol mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-Tunnel1] <strong>destination 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-Tunnel1] <strong>mpls te tunnel-id 101</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-Tunnel1] <strong>mpls te bandwidth ct0 10000</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-Tunnel1] <strong>mpls te igp shortcut</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-Tunnel1] <strong>mpls te igp metric absolute 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-Tunnel1] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-Tunnel1] <strong>mpls te signal-protocol segment-routing</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-Tunnel1] <strong>mpls te path explicit-path p2_p1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-Tunnel1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2] <strong>commit</strong></pre>
</p></li><li><span>Establish an EBGP peer relationship between each PE and its connected CE.</span><p><p># Configure CE1.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname CE1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1]<strong> interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1-GigabitEthernet<span>0/1/0</span>] <strong>ip address 10.10.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>bgp 65410</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp] <strong>peer 10.10.1.1 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp] <strong>import-route direct</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>commit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The configuration of CE2 is similar to the configuration of CE1. For configuration details, see <a href="#EN-US_TASK_0192770966__example806207475214046">Configuration Files</a> in this section.</p>
</div></div>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>ipv4-family vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-VPNA] <strong>peer 10.10.1.2 as-number 65410</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-VPNA] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp] <strong>quit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The configuration of PE2 is similar to the configuration of PE1. For configuration details, see <a href="#EN-US_TASK_0192770966__example806207475214046">Configuration Files</a> in this section.</p>
</div></div>
<p>After the configuration is complete, run the <strong>display bgp vpnv4 vpn-instance peer</strong> command on the PEs to check whether BGP peer relationships have been established between the PEs and CEs. If the <strong>Established</strong> state is displayed in the command output, the BGP peer relationships have been established successfully.</p>
</p></li><li><span>Verify the configuration.</span><p><p># Run the <strong>ping</strong> command on P1 to check the connectivity of each SR-MPLS TE tunnel. For example:</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P1] <strong>ping lsp segment-routing te Tunnel 1</strong>
  LSP PING FEC: SEGMENT ROUTING TE TUNNEL IPV4 SESSION QUERY Tunnel1 : 100  data bytes, press CTRL_C to break
    Reply from 4.4.4.4: bytes=100 Sequence=1 time=20 ms
    Reply from 4.4.4.4: bytes=100 Sequence=2 time=16 ms
    Reply from 4.4.4.4: bytes=100 Sequence=3 time=16 ms
    Reply from 4.4.4.4: bytes=100 Sequence=4 time=12 ms
    Reply from 4.4.4.4: bytes=100 Sequence=5 time=12 ms

  --- FEC: SEGMENT ROUTING TE TUNNEL IPV4 SESSION QUERY Tunnel1 ping statistics ---
    5 packet(s) transmitted
    5 packet(s) received
    0.00% packet loss
    round-trip min/avg/max = 12/15/20 ms</pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P1] <strong>ping lsp segment-routing te Tunnel 2</strong>
  LSP PING FEC: SEGMENT ROUTING TE TUNNEL IPV4 SESSION QUERY Tunnel2 : 100  data bytes, press CTRL_C to break
    Reply from 4.4.4.4: bytes=100 Sequence=1 time=17 ms
    Reply from 4.4.4.4: bytes=100 Sequence=2 time=17 ms
    Reply from 4.4.4.4: bytes=100 Sequence=3 time=12 ms
    Reply from 4.4.4.4: bytes=100 Sequence=4 time=12 ms
    Reply from 4.4.4.4: bytes=100 Sequence=5 time=14 ms

  --- FEC: SEGMENT ROUTING TE TUNNEL IPV4 SESSION QUERY Tunnel2 ping statistics ---
    5 packet(s) transmitted
    5 packet(s) received
    0.00% packet loss
    round-trip min/avg/max = 12/14/17 ms</pre>
<p># Check information about LDP LSP establishment on each PE. The following example uses the command output on PE1.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE1] <strong>display mpls lsp</strong>
Flag after Out IF: (I) - RLFA Iterated LSP, (I*) - Normal and RLFA Iterated LSP
Flag after LDP FRR: (L) - Logic FRR LSP 
-------------------------------------------------------------------------------
                 LSP Information: LDP LSP
-------------------------------------------------------------------------------
FEC                In/Out Label    In/Out IF                      Vrf Name
1.1.1.1/32         3/NULL          -/-                            
2.2.2.2/32         NULL/3          -/GE<span>0/2/0</span>                     
2.2.2.2/32         48151/3         -/GE<span>0/2/0</span>                     
3.3.3.3/32         NULL/48150      -/GE<span>0/2/0</span>                     
3.3.3.3/32         48152/48150     -/GE<span>0/2/0</span>                     
4.4.4.4/32         NULL/48153      -/GE<span>0/2/0</span>                     
4.4.4.4/32         48155/48153     -/GE<span>0/2/0</span>                     
5.5.5.5/32         NULL/48155      -/GE<span>0/2/0</span>                     
5.5.5.5/32         48157/48155     -/GE<span>0/2/0</span>                     
10.1.1.0/24        3/NULL          -/-                            
10.2.1.0/24        NULL/3          -/GE<span>0/2/0</span>                     
10.2.1.0/24        48153/3         -/GE<span>0/2/0</span>                     
10.3.1.0/24        NULL/48151      -/GE<span>0/2/0</span>                     
10.3.1.0/24        48154/48151     -/GE<span>0/2/0</span>                     
10.4.1.0/24        NULL/48154      -/GE<span>0/2/0</span>                     
10.4.1.0/24        48156/48154     -/GE<span>0/2/0</span>                     
-------------------------------------------------------------------------------
                 LSP Information: BGP LSP
-------------------------------------------------------------------------------
FEC                In/Out Label    In/Out IF                      Vrf Name
-/32               48090/NULL      -/-                             VPNA</pre>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0192770966__example806207475214046"><a name="EN-US_TASK_0192770966__example806207475214046"></a><a name="example806207475214046"></a><a name="EN-US_TASK_0192770966__1.4.6"></a><a name="1.4.6"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>PE1 configuration file</p>
<pre class="screen">#
sysname PE1
#
ip vpn-instance VPNA
 ipv4-family 
  route-distinguisher 100:1
  apply-label per-instance
  vpn-target 111:1 export-extcommunity
  vpn-target 111:1 import-extcommunity
#
mpls lsr-id 1.1.1.1
#
mpls
 lsp-trigger all
#
mpls ldp
 #              
 ipv4-family
#
acl number 2001
 rule 10 permit source 10.40.0.0 0.0.255.255
#
acl number 2002
 rule 20 permit source 10.50.0.0 0.0.255.255
#
traffic classifier service1 operator or
 if-match acl 2001
#
traffic classifier service2 operator or 
 if-match acl 2002
#
traffic behavior behavior1
 service-class af1 color green
#
traffic behavior behavior2
 service-class af2 color green
#
traffic policy test
 share-mode
 classifier service1 behavior behavior1 precedence 1 
 classifier service2 behavior behavior2 precedence 2
#
segment-routing
#
isis 1
 is-level level-2
 cost-style wide
 network-entity 10.0000.0000.0001.00
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown 
 ip address 10.1.1.1 255.255.255.0
 isis enable 1
 mpls
 mpls ldp
 trust upstream default
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown 
 ip binding vpn-instance VPNA
 ip address 10.10.1.1 255.255.255.0
 traffic-policy test inbound
#
interface LoopBack1
 ip address 1.1.1.1 255.255.255.255
 isis enable 1
#
bgp 100
 peer 5.5.5.5 as-number 100
 peer 5.5.5.5 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization 
  peer 5.5.5.5 enable
 #
 ipv4-family vpnv4 
  policy vpn-target 
  peer 5.5.5.5 enable
 #
 ipv4-family vpn-instance VPNA
  peer 10.10.1.2 as-number 65410
#
return</pre>
</li><li><p>P1 configuration file</p>
<pre class="screen">#
sysname P1
#
mpls lsr-id 2.2.2.2
#
mpls
 mpls te
 lsp-trigger all
#
explicit-path p1_p2
 next sid label 48092 type adjacency index 1
 next sid label 48091 type adjacency index 2
#
mpls ldp
 #
 ipv4-family
#
mpls ldp remote-peer lsrd
 remote-ip 4.4.4.4
#
segment-routing
#
isis 1
 is-level level-2
 cost-style wide
 network-entity 10.0000.0000.0002.00
 traffic-eng level-2
 segment-routing mpls
 segment-routing global-block 16000 19000
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown 
 ip address 10.1.1.2 255.255.255.0
 isis enable 1
 mpls
 mpls ldp
 trust upstream default
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown 
 ip address 10.2.1.1 255.255.255.0
 isis enable 1
 mpls
 mpls te
 mpls te bandwidth max-reservable-bandwidth 20000
 mpls te bandwidth bc0 20000
#
interface LoopBack1
 ip address 2.2.2.2 255.255.255.255
 isis enable 1
#
interface Tunnel1
 ip address unnumbered interface LoopBack1
 tunnel-protocol mpls te
 isis enable 1  
 destination 4.4.4.4
 mpls te signal-protocol segment-routing
 mpls te igp shortcut
 mpls te igp metric absolute 1
 mpls te bandwidth ct0 10000
 mpls te tunnel-id 100
 mpls te path explicit-path p1_p2
 mpls te service-class af1 af2
#               
interface Tunnel2
 ip address unnumbered interface LoopBack1
 tunnel-protocol mpls te
 isis enable 1            
 destination 4.4.4.4
 mpls te signal-protocol segment-routing
 mpls te igp shortcut
 mpls te igp metric absolute 1
 mpls te bandwidth ct0 10000
 mpls te tunnel-id 200
 mpls te path explicit-path p1_p2
 mpls te service-class default
#
return</pre>
</li><li><p>P3 configuration file</p>
<pre class="screen">#
sysname P3
#
mpls lsr-id 3.3.3.3
#
mpls
 mpls te
#
segment-routing
#
isis 1
 is-level level-2
 cost-style wide
 network-entity 10.0000.0000.0004.00
 traffic-eng level-2
 segment-routing mpls
 segment-routing global-block 16000 19000
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown 
 ip address 10.2.1.2 255.255.255.0
 isis enable 1
 mpls
 mpls te
 mpls te bandwidth max-reservable-bandwidth 20000
 mpls te bandwidth bc0 20000
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown 
 ip address 10.3.1.1 255.255.255.0
 isis enable 1
 mpls
 mpls te
 mpls te bandwidth max-reservable-bandwidth 20000
 mpls te bandwidth bc0 20000
#
interface LoopBack1
 ip address 3.3.3.3 255.255.255.255
 isis enable 1
#
return</pre>
</li><li><p>P2 configuration file</p>
<pre class="screen">#
sysname P2
#
mpls lsr-id 4.4.4.4
#
mpls
 mpls te
 lsp-trigger all
#
explicit-path p2_p1
 next sid label 48091 type adjacency index 1
 next sid label 48090 type adjacency index 2
#
mpls ldp
 #
 ipv4-family
#
mpls ldp remote-peer lsrb
 remote-ip 2.2.2.2
#
segment-routing
#
isis 1
 is-level level-2
 cost-style wide
 network-entity 10.0000.0000.0003.00
 traffic-eng level-2
 segment-routing mpls
 segment-routing global-block 16000 19000
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown 
 ip address 10.3.1.2 255.255.255.0
 isis enable 1
 mpls
 mpls te
 mpls te bandwidth max-reservable-bandwidth 20000
 mpls te bandwidth bc0 20000
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown 
 ip address 10.4.1.2 255.255.255.0
 isis enable 1
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 4.4.4.4 255.255.255.255
 isis enable 1
#
interface Tunnel1
 ip address unnumbered interface LoopBack1
 tunnel-protocol mpls te
 isis enable 1
 destination 2.2.2.2
 mpls te signal-protocol segment-routing
 mpls te igp shortcut
 mpls te igp metric absolute 1
 mpls te bandwidth ct0 10000
 mpls te tunnel-id 101
 mpls te path explicit-path p2_p1
#
return</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#
sysname PE2
#
ip vpn-instance VPNB
 ipv4-family 
  route-distinguisher 200:1
  apply-label per-instance
  vpn-target 111:1 export-extcommunity
  vpn-target 111:1 import-extcommunity
#
mpls lsr-id 5.5.5.5
#
mpls
 lsp-trigger all
#
mpls ldp
#
segment-routing
#
isis 1
 is-level level-2
 cost-style wide
 network-entity 10.0000.0000.0005.00
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown 
 ip address 10.4.1.1 255.255.255.0
 isis enable 1
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown 
 ip binding vpn-instance VPNB
 ip address 10.11.1.1 255.255.255.0
#
interface LoopBack1
 ip address 5.5.5.5 255.255.255.255
 isis enable 1
#
bgp 100
 peer 1.1.1.1 as-number 100
 peer 1.1.1.1 connect-interface LoopBack1
 #
 ipv4-family unicast 
  undo synchronization
  peer 1.1.1.1 enable
 #
 ipv4-family vpnv4
  policy vpn-target
  peer 1.1.1.1 enable
 #
 ipv4-family vpn-instance VPNB
  peer 10.11.1.2 as-number 65420
#
return</pre>
</li><li><p>CE1 configuration file</p>
<pre class="screen">#
sysname CE1
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.10.1.2 255.255.255.0
#
bgp 65410
 peer 10.10.1.1 as-number 100
 #
 ipv4-family unicast
  undo synchronization
  import-route direct
  peer 10.10.1.1 enable
#
return</pre>
</li><li><p>CE2 configuration file </p>
<pre class="screen">#
sysname CE2
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.11.1.2 255.255.255.0
#
bgp 65420
 peer 10.11.1.1 as-number 100
 #
 ipv4-family unicast
  undo synchronization
  import-route direct
  peer 10.11.1.1 enable
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_sr-te_cfg_0090.html">Configuring Examples for SR-MPLS TE
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_sr-te_cfg_0327.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_sr-te_cfg_0328.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>