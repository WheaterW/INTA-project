
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Public Network IPv4 over IS-IS SRv6 TE Policy (SRH 16-bit Compression Scenario)">
<meta name="abstract" content="This section provides an example for configuring an SRv6 TE Policy to carry public network IPv4 services in a 16-bit compression scenario.">
<meta name="description" content="This section provides an example for configuring an SRv6 TE Policy to carry public network IPv4 services in a 16-bit compression scenario.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_srv6_cfg_all_0101.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_srv6_cfg_all_0245.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_srv6_cfg_all_1025.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featurename" content="EVPN">
<meta name="featurename" content="Segment Routing IPv6">
<meta name="featurename" content="Segment Routing IPv6 Policy">
<meta name="featurename" content="Segment Routing Policy">
<meta name="featuretype" content="Segment Routing">
<meta name="featuretype" content="VPN">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featurename" content="EVPN">
<meta name="featurename" content="Segment Routing IPv6">
<meta name="featurename" content="Segment Routing IPv6 Policy">
<meta name="featurename" content="Segment Routing Policy">
<meta name="featuretype" content="Segment Routing">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featurename" content="EVPN">
<meta name="featurename" content="Segment Routing IPv6">
<meta name="featurename" content="Segment Routing IPv6 Policy">
<meta name="featurename" content="Segment Routing Policy">
<meta name="featuretype" content="Segment Routing">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="Segment Routing IPv6">
<meta name="featuretype" content="Segment Routing">
<meta name="OWNER" content="l00587852">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00587852">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001468189421">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/thickbox.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/imageResize.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery-migrate-1.2.1.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery-ui.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery.mousewheel.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/thickbox.js"></script>
<title>Example for Configuring Public Network IPv4 over IS-IS SRv6 TE Policy (SRH 16-bit Compression Scenario)</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001468189421"></a><a name="EN-US_TASK_0000001468189421"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Public Network IPv4 over IS-IS SRv6 TE Policy (SRH 16-bit Compression Scenario)</h1>
<div class="taskbody"><p>This section provides an example for configuring an SRv6 TE Policy to carry public network IPv4 services in a 16-bit compression scenario.</p>
<div class="context"><a name="EN-US_TASK_0000001468189421__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0000001468189421__fig1558715115394">Figure 1</a>, PE1, the P, and PE2 belong to the same AS and need to run IS-IS to implement IPv6 network connectivity. PE1, the P, and PE2 are Level-1 devices that belong to IS-IS process 1. An IBGP peer relationship needs to be established between PE1 and PE2, and EBGP peer relationships need to be established between the PEs and Devices.</p>
<p>In addition, a bidirectional SRv6 TE Policy needs to be deployed between PE1 and PE2 to carry public network IPv4 services.</p>
<div class="fignone" id="EN-US_TASK_0000001468189421__fig1558715115394"><a name="EN-US_TASK_0000001468189421__fig1558715115394"></a><a name="fig1558715115394"></a><span class="figcap"><b>Figure 1 </b>Public network IPv4 over SRv6 TE Policy networking</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interface1 and interface2 in this example represent GE <span>0/1/0</span> and GE <span>0/2/0</span>, respectively.</p>
</div></div>
<br><span><img class="imgResize" src="figure/en-us_image_0000001417952478.png" width="523.6875" height="165.321793" title="Click to enlarge"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001468189421__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Enable IPv6 forwarding and configure an IPv6 address for each interface on PE1, the P, and PE2.</p>
</li><li><p>Enable IS-IS, configure an IS-IS level, and specify a network entity title on PE1, the P, and PE2.</p>
</li><li><p>Establish an EBGP peer relationship between each PE and its connected Device.</p>
</li><li><p>Establish an MP-IBGP peer relationship between the PEs.</p>
</li><li><p>Deploy an SRv6 TE Policy between PE1 and PE2 and enable IS-IS SRv6.</p>
</li><li>Configure a tunnel policy on PE1 and PE2 to import public network traffic.</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001468189421__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>IPv6 address of each interface on PE1, the P, and PE2</p>
</li><li><p>IS-IS process ID of PE1, the P, and PE2</p>
</li><li><p>IS-IS level of PE1, the P, and PE2</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001468189421__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Enable IPv6 forwarding and configure an IPv6 address for each interface. The following example uses the configuration of PE1. The configurations of other devices are similar to the configuration of PE1. For configuration details, see the configuration files.</span><p><pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname PE1</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface gigabitethernet <span>0/1/0</span></strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>ipv6 enable</strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>ipv6 address 2001:DB8:10::1 96</strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>interface loopback1</strong>
[<span class="keyword">*</span>PE1-LoopBack1] <strong>ipv6 enable</strong>
[<span class="keyword">*</span>PE1-LoopBack1] <strong>ipv6 address 2001:DB8:1::1 128</strong>
[<span class="keyword">*</span>PE1-LoopBack1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-LoopBack1] <strong>quit</strong></pre>
</p></li><li><span>Configure IS-IS.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>is-level level-1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>cost-style wide</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>network-entity 10.0000.0000.0001.00</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>ipv6 enable topology ipv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>isis ipv6 enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface loopback1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack1] <strong>isis ipv6 enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-LoopBack1] <strong>quit</strong></pre>
<p># Configure the P.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P] <strong>isis 1</strong> </pre>
<pre class="screen">[<span class="keyword">*</span>P-isis-1] <strong>is-level level-1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-isis-1] <strong>cost-style wide</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-isis-1] <strong>network-entity 10.0000.0000.0002.00</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-isis-1] <strong>ipv6 enable topology ipv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/0</span>] <strong>isis ipv6 enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/2/0</span>] <strong>isis ipv6 enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>interface loopback1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-LoopBack1] <strong>isis ipv6 enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-LoopBack1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P-LoopBack1] <strong>quit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1] <strong>is-level level-1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1] <strong>cost-style wide</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1] <strong>network-entity 10.0000.0000.0003.00</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1] <strong>ipv6 enable topology ipv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>isis ipv6 enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface loopback1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-LoopBack1] <strong>isis ipv6 enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-LoopBack1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-LoopBack1] <strong>quit</strong></pre>
</p><p><p>After the configuration is complete, perform the following operations to check whether IS-IS is successfully configured.</p>
<p># Display IS-IS neighbor information. PE1 is used as an example.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display isis peer</strong>

                          Peer information for ISIS(1)
                         
  System Id     Interface          Circuit Id        State HoldTime Type     PRI
--------------------------------------------------------------------------------
0000.0000.0002  GE<span>0/1/0</span>            0000.0000.0002.01  Up   8s       L1       64 

Total Peer(s): 1</pre>
<p># Display IS-IS routing table information. PE1 is used as an example.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display isis route</strong>
                         Route information for ISIS(1)
                         -----------------------------

                        ISIS(1) Level-1 Forwarding Table
                        --------------------------------

 IPV6 Dest.            ExitInterface      NextHop                    Cost     Flags    
--------------------------------------------------------------------------------
2001:DB8:1::1/128      Loop1              Direct                     0        D/-/L/-  
2001:DB8:2::2/128      GE<span>0/1/0</span>            FE80::3A92:6CFF:FE21:10    10       A/-/-/-  
2001:DB8:3::3/128      GE<span>0/1/0</span>            FE80::3A92:6CFF:FE21:10    20       A/-/-/- 
2001:DB8:10::/96       GE<span>0/1/0</span>            Direct                     10       D/-/L/-  
2001:DB8:20::/96       GE<span>0/1/0</span>            FE80::3A92:6CFF:FE21:10    20       A/-/-/-                       
     Flags: D-Direct, A-Added to URT, L-Advertised in LSPs, S-IGP Shortcut, 
            U-Up/Down Bit Set, LP-Local Prefix-Sid
<span>     Protect Type: L-Link Protect, N-Node Protect</span></pre>
</p></li><li><span>Establish an EBGP peer relationship between each PE and its connected Device.</span><p><p># Configure DeviceA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>interface </strong><strong>gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA-GigabitEthernet<span>0/1/0</span>] <strong>ip address</strong> <strong>192.168.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceA-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceA] <strong>bgp 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceA-bgp] <strong>router-id 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceA-bgp] <strong>peer 192.168.1.2 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceA-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceA] <strong>commit</strong></pre>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface </strong><strong>gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>ip address</strong> <strong>192.168.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>router-id 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 192.168.1.1 as-number 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>ipv4-family unicast</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-ipv4] <strong>peer 192.168.1.1</strong> <strong>enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-ipv4] <strong>network 192.168.1.0 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-ipv4] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp] <strong>quit</strong></pre>
<p># Configure DeviceB.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB] <strong>interface </strong><strong>gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB-GigabitEthernet<span>0/1/0</span>] <strong>ip address</strong> <strong>192.168.2.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceB-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceB] <strong>bgp 300</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceB-bgp] <strong>router-id 5.5.5.5</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceB-bgp] <strong>peer 192.168.2.2 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceB-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceB] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>interface </strong><strong>gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-GigabitEthernet<span>0/2/0</span>] <strong>ip address</strong> <strong>192.168.2.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>router-id 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>peer 192.168.2.1 as-number 300</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>ipv4-family unicast</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-ipv4] <strong>peer 192.168.2.1</strong> <strong>enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-ipv4] <strong>network 192.168.2.0 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-ipv4] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-bgp-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-bgp] <strong>quit</strong></pre>
<p>After the configuration is complete, run the <strong>display bgp peer</strong> command on the PEs to check whether the BGP peer relationships have been established between the PEs and Devices. If the <strong>Established</strong> state is displayed in the command output, the BGP peer relationships have been established successfully.</p>
<p>The following example uses the peer relationship between PE1 and DeviceA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display bgp peer</strong>

 BGP local router ID : 1.1.1.1
 Local AS number : 100
 Total number of peers : 1            Peers in established state : 1
  Peer            V    AS  MsgRcvd  MsgSent    OutQ  Up/Down           State  PrefRcv
  192.168.1.1     4    200    1624     1622       0 00:06:37<strong>   Established</strong>        1</pre>
</p></li><li><span>Establish an MP-IBGP peer relationship between the PEs.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp] <strong>peer 2001:DB8:3::3 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 2001:DB8:3::3 connect-interface loopback1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>ipv4-family unicast</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-ipv4] <strong>peer 2001:DB8:3::3 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-ipv4] <strong>peer 2001:DB8:3::3 next-hop-local</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-ipv4] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp] <strong>quit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-bgp] <strong>peer 2001:DB8:1::1 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>peer </strong><strong>2001:DB8:1::1</strong><strong> connect-interface loopback1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>ipv4-family unicast</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-ipv4] <strong>peer</strong> <strong>2001:DB8:1::1</strong> <strong>enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-ipv4] <strong>peer</strong> <strong>2001:DB8:1::1</strong> <strong>next-hop-local</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-ipv4] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-bgp-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-bgp] <strong>quit</strong></pre>
<p>After the configuration is complete, run the <strong>display bgp peer</strong> command on the PEs to check whether the BGP peer relationship has been established. If the <strong>Established</strong> state is displayed in the command output, the BGP peer relationship has been established successfully. The following example uses the command output on PE1.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE1] <strong>display bgp peer</strong>                

 BGP local router ID : 1.1.1.1                  
 Local AS number : 100                          
 Total number of peers : 2                 Peers in established state : 2       

  Peer            V          AS  MsgRcvd  MsgSent  OutQ  Up/Down       State  PrefRcv                                               
  192.168.1.1     4         200       10       11     0 00:05:15 <strong>Established</strong>        2   
  2001:DB8:3::3   4         100       10       11     0 00:05:15 <strong>Established</strong>        2 </pre>
</p></li><li><span>Configure each PE to carry color and SID attributes in public network routes to be advertised.</span><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>A compressed End.DT4 SID can be either dynamically allocated through BGP or manually configured. If a dynamically allocated SID and a manually configured SID both exist, the latter takes effect. If you want to run the <span><a href="cmdqueryname=segment-routing+ipv6+locator"><b><span class="cmdname">segment-routing ipv6 locator</span></b></a> <i><span class="varname">locator-name</span></i></span> <strong><span>compress</span></strong> command to enable dynamic allocation of compressed End.DT4 SIDs through BGP or the <span><a href="cmdqueryname=segment-routing+ipv6+locator"><b><span class="cmdname">segment-routing ipv6 locator</span></b></a> <i><span class="varname">locator-name</span></i></span> <strong><span>compress</span></strong><a href="cmdqueryname=end-dt46"><b><span class="cmdname"> end-dt46</span></b></a> command to enable dynamic allocation of compressed End.DT46 SIDs through BGP in the future, you do not need to run the <strong>opcode</strong> <strong><span>compress</span></strong> <em>func-opcode</em> <strong>end-dt4</strong> [ <strong>vpn-instance</strong> <em>vpn-instance-name </em>] { next | coc-next } command or the <strong>opcode</strong> <strong><span>compress</span></strong> <em>func-opcode</em> <strong>end-dt46</strong> [ <strong>vpn-instance</strong> <em>vpn-instance-name</em> ] { next | coc-next } command to configure an opcode for static SIDs.</p>
<p>In this example, dynamic allocation through BGP is adopted.</p>
</div></div>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>segment-routing ipv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing-ipv6] <strong>compress-16 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing-ipv6] <strong>encapsulation source-address 2001:DB8:1::1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing-ipv6] <strong>locator aa compress-16 ipv6-prefix <span>2001:DB8:100::</span> 48 compress-static 8 static 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing-ipv6-locator] <strong>opcode compress ::E010 end</strong> <strong>psp-usd-next</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing-ipv6-locator] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>segment-routing ipv6 locator aa</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]  <strong>route-policy color permit node 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-route-policy] <strong>apply extcommunity color 0:101</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-route-policy] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>ipv4-family unicast</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-ipv4] <strong>peer 2001:DB8:3::3 route-policy color export</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-ipv4] <strong>peer 2001:DB8:3::3 advertise-ext-community</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-ipv4] <strong>peer 2001:DB8:3::3 prefix-sid</strong> <strong>advertise-srv6-locator</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-ipv4] <strong>segment-routing ipv6 locator aa</strong> <strong>compress</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-ipv4] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp] <strong>quit</strong></pre>
<p># Configure the P.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P] <strong>segment-routing ipv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-segment-routing-ipv6] <strong>compress-16 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-segment-routing-ipv6] <strong>encapsulation source-address 2001:DB8:2::2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-segment-routing-ipv6] <strong>locator aa compress-16 ipv6-prefix 2001:DB8:200:: 48 compress-static 8 static 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-segment-routing-ipv6-locator] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-segment-routing-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-isis-1] <strong>segment-routing ipv6 locator aa</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-isis-1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P-isis-1] <strong>quit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>segment-routing ipv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-segment-routing-ipv6] <strong>compress-16 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-segment-routing-ipv6] <strong>encapsulation source-address 2001:DB8:3::3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-segment-routing-ipv6] <strong>locator aa compress-16 ipv6-prefix 2001:DB8:300:: 48 compress-static 8 static 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-segment-routing-ipv6-locator] <strong>opcode compress ::E010 end</strong> <strong>psp-usd-next</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-segment-routing-ipv6-locator] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-segment-routing-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1] <strong>segment-routing ipv6 locator aa</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>route-policy color permit node 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-route-policy] <strong>apply extcommunity color 0:101</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-route-policy] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>ipv4-family unicast</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-ipv4] <strong>peer 2001:DB8:1::1 route-policy color export</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-ipv4] <strong>peer 2001:DB8:1::1 advertise-ext-community</strong> </pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-ipv4] <strong>peer 2001:DB8:1::1 prefix-sid</strong> <strong>advertise-srv6-locator</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-ipv4] <strong>segment-routing ipv6 locator aa</strong> <strong>compress</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-ipv4] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-bgp-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-bgp] <strong>quit</strong></pre>
</p><p><p>Run the <a href="cmdqueryname=display+segment-routing+ipv6+local-sid"><b><span class="cmdname">display segment-routing ipv6 local-sid</span></b></a> <strong><span>end</span></strong> <strong><span>forwarding</span></strong> command to check information about the SRv6 local SID table.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display segment-routing ipv6 local-sid end forwarding</strong>
                    My Local-SID End Forwarding Table                        
                    ---------------------------------                        

SID         : 2001:DB8:100::/48                            FuncType    : End
Flavor      : PSP USP USD COC NEXT                         SidCompress : YES
LocatorName : aa                                           LocatorID   : 2
ProtocolType: STATIC                                       ProcessID   : --
UpdateTime  : 2022-12-05 13:39:48.628

SID         : 2001:DB8:100:E010::/64                       FuncType    : End
Flavor      : PSP USD NEXT                                 SidCompress : YES
LocatorName : aa                                           LocatorID   : 2
ProtocolType: STATIC                                       ProcessID   : --
UpdateTime  : 2022-12-05 13:40:01.713

SID         : 2001:DB8:100:E103::/64                       FuncType    : End
Flavor      : PSP USP USD COC                              SidCompress : YES
LocatorName : aa                                           LocatorID   : 2
ProtocolType: ISIS                                         ProcessID   : 1
UpdateTime  : 2022-12-06 02:36:27.429

SID         : 2001:DB8:100:E104::/64                       FuncType    : End
Flavor      : NO-FLAVOR                                    SidCompress : YES
LocatorName : aa                                           LocatorID   : 2
ProtocolType: ISIS                                         ProcessID   : 1
UpdateTime  : 2022-12-06 02:36:27.429

SID         : 2001:DB8:100:E105::/64                       FuncType    : End
Flavor      : PSP                                          SidCompress : YES
LocatorName : aa                                           LocatorID   : 2
ProtocolType: ISIS                                         ProcessID   : 1
UpdateTime  : 2022-12-06 02:36:27.429

SID         : 2001:DB8:100:E106::/64                       FuncType    : End
Flavor      : PSP USP USD                                  SidCompress : YES
LocatorName : aa                                           LocatorID   : 2
ProtocolType: ISIS                                         ProcessID   : 1
UpdateTime  : 2022-12-06 02:36:27.429

SID         : 2001:DB8:E010::/48                           FuncType    : End
Flavor      : PSP USD NEXT                                 SidCompress : YES
LocatorName : aa                                           LocatorID   : 2
ProtocolType: STATIC                                       ProcessID   : --
UpdateTime  : 2022-12-05 13:40:01.713

SID         : 2001:DB8:E103::/48                           FuncType    : End
Flavor      : PSP USP USD COC                              SidCompress : YES
LocatorName : aa                                           LocatorID   : 2
ProtocolType: ISIS                                         ProcessID   : 1
UpdateTime  : 2022-12-06 02:36:27.429

SID         : 2001:DB8:E104::/48                           FuncType    : End
Flavor      : NO-FLAVOR                                    SidCompress : YES
LocatorName : aa                                           LocatorID   : 2
ProtocolType: ISIS                                         ProcessID   : 1
UpdateTime  : 2022-12-06 02:36:27.429

SID         : 2001:DB8:E105::/48                           FuncType    : End
Flavor      : PSP                                          SidCompress : YES
LocatorName : aa                                           LocatorID   : 2
ProtocolType: ISIS                                         ProcessID   : 1
UpdateTime  : 2022-12-06 02:36:27.429

SID         : 2001:DB8:E106::/48                           FuncType    : End
Flavor      : PSP USP USD                                  SidCompress : YES
LocatorName : aa                                           LocatorID   : 2
ProtocolType: ISIS                                         ProcessID   : 1
UpdateTime  : 2022-12-06 02:36:27.429

Total SID(s): 11 </pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P] <strong>display segment-routing ipv6 local-sid end forwarding</strong>
                    My Local-SID End Forwarding Table                        
                    ---------------------------------                        
                                       
SID         : 2001:DB8:200::/48                            FuncType    : End
Flavor      : PSP USP USD COC NEXT                         SidCompress : YES
LocatorName : aa                                           LocatorID   : 2
ProtocolType: STATIC                                       ProcessID   : --
UpdateTime  : 2022-12-05 13:40:56.120

SID         : 2001:DB8:200:E103::/64                       FuncType    : End
Flavor      : PSP USP USD COC                              SidCompress : YES
LocatorName : aa                                           LocatorID   : 2
ProtocolType: ISIS                                         ProcessID   : 1
UpdateTime  : 2022-12-06 02:36:52.146

SID         : 2001:DB8:200:E104::/64                       FuncType    : End
Flavor      : PSP USD NEXT                                 SidCompress : YES
LocatorName : aa                                           LocatorID   : 2
ProtocolType: ISIS                                         ProcessID   : 1
UpdateTime  : 2022-12-06 02:36:52.146

SID         : 2001:DB8:200:E105::/64                       FuncType    : End
Flavor      : NO-FLAVOR                                    SidCompress : YES
LocatorName : aa                                           LocatorID   : 2
ProtocolType: ISIS                                         ProcessID   : 1
UpdateTime  : 2022-12-06 02:36:52.146

SID         : 2001:DB8:200:E106::/64                       FuncType    : End
Flavor      : PSP                                          SidCompress : YES
LocatorName : aa                                           LocatorID   : 2
ProtocolType: ISIS                                         ProcessID   : 1
UpdateTime  : 2022-12-06 02:36:52.146

SID         : 2001:DB8:200:E107::/64                       FuncType    : End
Flavor      : PSP USP USD                                  SidCompress : YES
LocatorName : aa                                           LocatorID   : 2
ProtocolType: ISIS                                         ProcessID   : 1
UpdateTime  : 2022-12-06 02:36:52.146

SID         : 2001:DB8:E103::/48                           FuncType    : End
Flavor      : PSP USP USD COC                              SidCompress : YES
LocatorName : aa                                           LocatorID   : 2
ProtocolType: ISIS                                         ProcessID   : 1
UpdateTime  : 2022-12-06 02:36:52.146

SID         : 2001:DB8:E104::/48                           FuncType    : End
Flavor      : PSP USD NEXT                                 SidCompress : YES
LocatorName : aa                                           LocatorID   : 2
ProtocolType: ISIS                                         ProcessID   : 1
UpdateTime  : 2022-12-06 02:36:52.146

SID         : 2001:DB8:E105::/48                           FuncType    : End
Flavor      : NO-FLAVOR                                    SidCompress : YES
LocatorName : aa                                           LocatorID   : 2
ProtocolType: ISIS                                         ProcessID   : 1
UpdateTime  : 2022-12-06 02:36:52.146

SID         : 2001:DB8:E106::/48                           FuncType    : End
Flavor      : PSP                                          SidCompress : YES
LocatorName : aa                                           LocatorID   : 2
ProtocolType: ISIS                                         ProcessID   : 1
UpdateTime  : 2022-12-06 02:36:52.146

SID         : 2001:DB8:E107::/48                           FuncType    : End
Flavor      : PSP USP USD                                  SidCompress : YES
LocatorName : aa                                           LocatorID   : 2
ProtocolType: ISIS                                         ProcessID   : 1
UpdateTime  : 2022-12-06 02:36:52.146

Total SID(s): 11</pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>display segment-routing ipv6 local-sid end forwarding</strong>
                    My Local-SID End Forwarding Table                        
                    ---------------------------------                        
                                       
SID         : 2001:DB8:300::/48                            FuncType    : End
Flavor      : PSP USP USD COC NEXT                         SidCompress : YES
LocatorName : aa                                           LocatorID   : 2
ProtocolType: STATIC                                       ProcessID   : --
UpdateTime  : 2022-12-05 13:41:45.862

SID         : 2001:DB8:300:E010::/64                       FuncType    : End
Flavor      : PSP USD NEXT                                 SidCompress : YES
LocatorName : aa                                           LocatorID   : 2
ProtocolType: STATIC                                       ProcessID   : --
UpdateTime  : 2022-12-05 13:41:52.600

SID         : 2001:DB8:300:E103::/64                       FuncType    : End
Flavor      : PSP USP USD COC                              SidCompress : YES
LocatorName : aa                                           LocatorID   : 2
ProtocolType: ISIS                                         ProcessID   : 1
UpdateTime  : 2022-12-06 02:34:24.670

SID         : 2001:DB8:300:E104::/64                       FuncType    : End
Flavor      : NO-FLAVOR                                    SidCompress : YES
LocatorName : aa                                           LocatorID   : 2
ProtocolType: ISIS                                         ProcessID   : 1
UpdateTime  : 2022-12-06 02:34:24.670

SID         : 2001:DB8:300:E105::/64                       FuncType    : End
Flavor      : PSP                                          SidCompress : YES
LocatorName : aa                                           LocatorID   : 2
ProtocolType: ISIS                                         ProcessID   : 1
UpdateTime  : 2022-12-06 02:34:24.670

SID         : 2001:DB8:300:E106::/64                       FuncType    : End
Flavor      : PSP USP USD                                  SidCompress : YES
LocatorName : aa                                           LocatorID   : 2
ProtocolType: ISIS                                         ProcessID   : 1
UpdateTime  : 2022-12-06 02:34:24.670

SID         : 2001:DB8:E010::/48                           FuncType    : End
Flavor      : PSP USD NEXT                                 SidCompress : YES
LocatorName : aa                                           LocatorID   : 2
ProtocolType: STATIC                                       ProcessID   : --
UpdateTime  : 2022-12-05 13:41:52.600

SID         : 2001:DB8:E103::/48                           FuncType    : End
Flavor      : PSP USP USD COC                              SidCompress : YES
LocatorName : aa                                           LocatorID   : 2
ProtocolType: ISIS                                         ProcessID   : 1
UpdateTime  : 2022-12-06 02:34:24.670

SID         : 2001:DB8:E104::/48                           FuncType    : End
Flavor      : NO-FLAVOR                                    SidCompress : YES
LocatorName : aa                                           LocatorID   : 2
ProtocolType: ISIS                                         ProcessID   : 1
UpdateTime  : 2022-12-06 02:34:24.670

SID         : 2001:DB8:E105::/48                           FuncType    : End
Flavor      : PSP                                          SidCompress : YES
LocatorName : aa                                           LocatorID   : 2
ProtocolType: ISIS                                         ProcessID   : 1
UpdateTime  : 2022-12-06 02:34:24.670

SID         : 2001:DB8:E106::/48                           FuncType    : End
Flavor      : PSP USP USD                                  SidCompress : YES
LocatorName : aa                                           LocatorID   : 2
ProtocolType: ISIS                                         ProcessID   : 1
UpdateTime  : 2022-12-06 02:34:24.670

Total SID(s): 11</pre>
<p>Run the <a href="cmdqueryname=display+segment-routing+ipv6+local-sid"><b><span class="cmdname">display segment-routing ipv6 local-sid</span></b></a> <strong><span>end-dt4 forwarding</span></strong> command to check information about the SRv6 local SID table. PE1 is used as an example.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display segment-routing ipv6 local-sid end-dt4 forwarding</strong>
                    My Local-SID End.DT4 Forwarding Table
                    -------------------------------------

SID        : 2001:DB8:100:E13F::/64                       FuncType    : End.DT4
VPN Name   : _public_                                     VPN ID      : 0
LocatorName: aa                                           LocatorID   : 2
Flavor     : COC NEXT                                     SidCompress : YES
UpdateTime : 2023-05-10 01:46:05.713

SID        : 2001:DB8:E13F::/48                           FuncType    : End.DT4
VPN Name   : _public_                                     VPN ID      : 0
LocatorName: aa                                           LocatorID   : 2
Flavor     : COC NEXT                                     SidCompress : YES
UpdateTime : 2023-05-10 01:46:05.713

Total SID(s): 2</pre>
<p>Run the <strong>display bgp routing-table</strong> command to check BGP routing table information. The following example uses the command output on PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>display bgp routing-table</strong> <strong>192.168.1.0</strong>  

 BGP local router ID : 2.2.2.2
 Local AS number : 100
 Paths:   1 available, 1 best, 1 select, 0 best-external, 0 add-path
 BGP routing table entry information of 192.168.1.0/24:
 From: 2001:DB8:1::1 (1.1.1.1)
 Route Duration: 2d02h11m33s
 Relay IP Nexthop: FE80::3ABD:6CFF:FE31:300
 Relay IP Out-Interface: GigabitEthernet<span>0/1/0</span>
 Relay Tunnel Out-Interface: policy1(srv6tepolicy)
 Original nexthop: 2001:DB8:1::1
 Qos information : 0x0
 Ext-Community: Color &lt;0 : 101&gt;
 Prefix-sid: 2001:DB8:100:E13F::, Endpoint Behavior: 219, SRv6-sid-structure: 32-16-16-0-0-0
 AS-path Nil, origin igp, MED 0, localpref 100, pref-val 0, valid, internal, best, select, pre 255
 Advertised to such 1 peers:
    192.168.2.1</pre>
</p></li><li><span>Configure an SRv6 TE Policy.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>segment-routing ipv6</strong> 
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-segment-routing-ipv6] <strong>segment-list list1</strong> 
[<span class="keyword">*</span>PE1-segment-routing-ipv6-segment-list-list1] <strong>index 5 sid ipv6 </strong><strong>2001:DB8:200:: compress-16 block 32 node-length 16 function-length 0 compress-flavor coc-next</strong>
[<span class="keyword">*</span>PE1-segment-routing-ipv6-segment-list-list1] <strong>index 10 sid ipv6 </strong><strong>2001:DB8:300:: compress-16 block 32 node-length 16 function-length 0 compress-flavor coc-next</strong>
[<span class="keyword">*</span>PE1-segment-routing-ipv6-segment-list-list1] <strong>index 15 sid ipv6 </strong><strong>2001:DB8:E010:: compress-16 block 32 node-length 0 function-length 16 compress-flavor next</strong>
[<span class="keyword">*</span>PE1-segment-routing-ipv6-segment-list-list1] <strong>quit</strong>
[<span class="keyword">*</span>PE1-segment-routing-ipv6] <strong>srv6-te policy policy1 endpoint 2001:DB8:3::3 color 101</strong>
[<span class="keyword">*</span>PE1-segment-routing-ipv6-policy-policy1] <strong>candidate-path preference 100</strong>
[<span class="keyword">*</span>PE1-segment-routing-ipv6-policy-policy1-path] <strong>segment-list list1</strong> 
[<span class="keyword">*</span>PE1-segment-routing-ipv6-policy-policy1-path] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-segment-routing-ipv6-policy-policy1-path] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-segment-routing-ipv6-policy-policy1] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-segment-routing-ipv6] <strong>quit</strong></pre>
</p><p><p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>segment-routing ipv6</strong> 
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-segment-routing-ipv6] <strong>segment-list list1</strong> 
[<span class="keyword">*</span>PE2-segment-routing-ipv6-segment-list-list1] <strong>index 5 sid ipv6 </strong><strong>2001:DB8:200::</strong> <strong>compress-16 block 32 node-length 16 function-length 0 compress-flavor coc-next</strong>
[<span class="keyword">*</span>PE2-segment-routing-ipv6-segment-list-list1] <strong>index 10 sid ipv6 </strong><strong>2001:DB8:100:: compress-16 block 32 node-length 16 function-length 0 compress-flavor coc-next</strong>
[<span class="keyword">*</span>PE2-segment-routing-ipv6-segment-list-list1] <strong>index 15 sid ipv6 </strong><strong>2001:DB8:E010:: compress-16 block 32 node-length 0 function-length 16 compress-flavor next</strong>
[<span class="keyword">*</span>PE2-segment-routing-ipv6-segment-list-list1] <strong>quit</strong>
[<span class="keyword">*</span>PE2-segment-routing-ipv6] <strong>srv6-te policy policy1 endpoint 2001:DB8:1::1 color 101</strong>
[<span class="keyword">*</span>PE2-segment-routing-ipv6-policy-policy1] <strong>candidate-path preference 100</strong>
[<span class="keyword">*</span>PE2-segment-routing-ipv6-policy-policy1-path] <strong>segment-list list1</strong> 
[<span class="keyword">*</span>PE2-segment-routing-ipv6-policy-policy1-path] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-segment-routing-ipv6-policy-policy1-path] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-segment-routing-ipv6-policy-policy1] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-segment-routing-ipv6] <strong>quit</strong></pre>
<p>Run the <a href="cmdqueryname=display+srv6-te+policy"><b><span class="cmdname">display srv6-te policy</span></b></a> command to check SRv6 TE Policy information. The following example uses the command output on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display srv6-te policy</strong>
PolicyName : policy1
Color                   : 101                            Endpoint             : 2001:DB8:3::3
TunnelId                : 1                              
TunnelType              : SRv6-TE Policy                 DelayTimerRemain     : -
Policy State            : Up                             State Change Time    : 2022-12-05 13:13:36
Admin State             : Up                             Traffic Statistics   : Disable
Backup Hot-Standby      : Disable                        BFD                  : Disable
Interface Index         : -                              Interface Name       : - 
Interface State         : -                              Encapsulation Mode   : Insert
Binding SID             : -
Candidate-path Count    : 1

 Candidate-path Preference : 100
 Path State             : Active                         Path Type            : Primary
 Protocol-Origin        : Configuration(30)              Originator           : 0, 0.0.0.0
 Discriminator          : 100                            Binding SID          : -
 GroupId                : 1                              Policy Name          : policy1
 Template ID            : 0                              Path Verification    : Disable
 DelayTimerRemain       : -                              Network Slice ID     : -
 Segment-List Count     : 1
  Segment-List          : list1
   Segment-List ID      : 2                              XcIndex              : 1
   List State           : Up                             DelayTimerRemain     : -
   Verification State   : -                              SuppressTimeRemain   : -
   PMTU                 : 9600                           Active PMTU          : 9600
   Weight               : 1                              BFD State            : -
   Loop Detection State : Up                             BFD Delay Remain     : - 
   Network Slice ID     : -
   Binding SID          : -
   Reverse Binding ID   : -
   SID :
         2001:DB8:200::                               BL: 32   NL: 16   FL: 0    Compress Flavor: coc-next    Compress Length: 16
         2001:DB8:300::                               BL: 32   NL: 16   FL: 0    Compress Flavor: coc-next    Compress Length: 16
         2001:DB8:E010::                              BL: 32   NL: 0    FL: 16   Compress Flavor: next        Compress Length: 16</pre>
</p></li><li><span>Configure a tunnel policy to import public network traffic.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>tunnel-policy p1</strong>
[<span class="keyword">*</span>PE1-tunnel-policy-p1] <strong>tunnel select-seq ipv6 srv6-te-policy load-balance-number 1</strong>
[<span class="keyword">*</span>PE1-tunnel-policy-p1] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>tunnel-selector p1 permit node 1</strong>
[<span class="keyword">*</span>PE1-tunnel-selector] <strong>apply tunnel-policy p1</strong>
[<span class="keyword">*</span>PE1-tunnel-selector]<strong> quit</strong>
[<span class="keyword">*</span>PE1] <strong>bgp 100</strong>
[<span class="keyword">*</span>PE1-bgp] <strong>ipv4-family unicast</strong>
[<span class="keyword">*</span>PE1-bgp-af-ipv4] <strong>unicast-route recursive-lookup tunnel-v6 tunnel-selector p1</strong>
[<span class="keyword">*</span>PE1-bgp-af-ipv4] <strong>segment-routing ipv6 </strong><strong>traffic-engineer</strong>
[<span class="keyword">*</span>PE1-bgp-af-ipv4] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp-af-ipv4] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp] <strong>quit</strong></pre>
</p><p><p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>tunnel-policy p1</strong>
[<span class="keyword">*</span>PE2-tunnel-policy-p1] <strong>tunnel select-seq ipv6 srv6-te-policy load-balance-number 1</strong>
[<span class="keyword">*</span>PE2-tunnel-policy-p1] <strong>quit</strong>
[<span class="keyword">*</span>PE2] <strong>tunnel-selector p1 permit node 1</strong>
[<span class="keyword">*</span>PE2-tunnel-selector]<strong> apply tunnel-policy p1</strong>
[<span class="keyword">*</span>PE2-tunnel-selector]<strong> quit</strong>
[<span class="keyword">*</span>PE2] <strong>bgp 100</strong>
[<span class="keyword">*</span>PE2-bgp] <strong>ipv4-family unicast</strong>
[<span class="keyword">*</span>PE2-bgp-af-ipv4] <strong>unicast-route recursive-lookup tunnel-v6 tunnel-selector p1</strong>
[<span class="keyword">*</span>PE2-bgp-af-ipv4] <strong>segment-routing ipv6 </strong><strong>traffic-engineer</strong>
[<span class="keyword">*</span>PE2-bgp-af-ipv4] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-bgp-af-ipv4] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-bgp] <strong>quit</strong></pre>
<p>After the configuration is complete, run the <strong>display bgp routing-table</strong> command to check BGP routing table information. The following example uses the command output on PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>display bgp routing-table</strong> <strong>192.168.1.0</strong>  

 BGP local router ID : 2.2.2.2
 Local AS number : 100
 Paths:   1 available, 1 best, 1 select, 0 best-external, 0 add-path
 BGP routing table entry information of 192.168.1.0/24:
 From: 2001:DB8:1::1 (1.1.1.1)
 Route Duration: 0d00h39m53s
 Relay IP Nexthop: FE80::3A08:24FF:FE31:300
 Relay IP Out-Interface: GigabitEthernet<span>0/1/0</span>
 <strong>Relay Tunnel Out-Interface: policy1(srv6tepolicy)</strong>
 Original nexthop: 2001:DB8:1::1
 Qos information : 0x0
<strong> Ext-Community: Color &lt;0 : 101&gt;</strong>
<strong> Prefix-sid: 2001:DB8:100:E13F::, Endpoint Behavior: 219, SRv6-sid-structure: 32-16-16-0-0-0</strong>
 AS-path Nil, origin igp, MED 0, localpref 100, pref-val 0, valid, internal, best, select, pre 255
 Advertised to such 1 peers:
    192.168.2.1</pre>
<p>Run the <strong>display ip routing-table</strong> command to check IP routing table information. The command output shows that the public network IPv4 route has successfully recursed to the SRv6 TE Policy.</p>
<p>The following example uses the command output on PE1.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE1] <strong>display ip routing-table</strong>
Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route
------------------------------------------------------------------------------
Routing Table : _public_
         Destinations : 4        Routes : 4

Destination/Mask    Proto   Pre  Cost        Flags NextHop         Interface
    
      127.0.0.0/8   Direct  0    0             D   127.0.0.1       InLoopBack0
      127.0.0.1/8   Direct  0    0             D   127.0.0.1       InLoopBack0
127.255.255.255/8   Direct  0    0             D   127.0.0.1       InLoopBack0
    192.168.1.0/24  Direct  0    0             D   192.168.1.2     GigabitEthernet<span>0/2/0</span>
    192.168.1.2/32  Direct  0    0             D   127.0.0.1       GigabitEthernet<span>0/2/0</span>
  192.168.1.255/32  Direct  0    0             D   127.0.0.1       GigabitEthernet<span>0/2/0</span>
    192.168.2.0/24  IBGP    255  0             RD  2001:DB8:3::3   <strong>policy1</strong>
255.255.255.255/32  Direct  0    0             D   127.0.0.1       InLoopBack0</pre>
<p>Check that DeviceA and DeviceB can ping each other. The following example uses the command output on DeviceA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>ping -a </strong><strong>192.168.1.1</strong> <strong>192.168.2.1</strong>
  PING 192.168.2.1: 56  data bytes, press CTRL_C to break
    Reply from 192.168.2.1: bytes=56 Sequence=1 ttl=253 time=19 ms
    Reply from 192.168.2.1: bytes=56 Sequence=2 ttl=253 time=18 ms
    Reply from 192.168.2.1: bytes=56 Sequence=3 ttl=253 time=19 ms
    Reply from 192.168.2.1: bytes=56 Sequence=4 ttl=253 time=20 ms
    Reply from 192.168.2.1: bytes=56 Sequence=5 ttl=253 time=22 ms

  --- 192.168.2.1 ping statistics ---
    5 packet(s) transmitted
    5 packet(s) received
    0.00% packet loss
    round-trip min/avg/max = 18/19/22 ms</pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001468189421__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>PE1 configuration file</p>
<pre class="screen">#
sysname PE1        
#
tunnel-selector p1 permit node 1
 apply tunnel-policy p1
#
segment-routing ipv6
 encapsulation source-address 2001:DB8:1::1
 compress-16 enable
 locator aa compress-16 ipv6-prefix 2001:DB8:100:: 48 compress-static 8 static 32
  opcode compress ::E010 end psp-usd-next
 segment-list list1
  index 5 sid ipv6 2001:DB8:200:: compress-16 block 32 node-length 16 function-length 0 compress-flavor coc-next
  index 10 sid ipv6 2001:DB8:300:: compress-16 block 32 node-length 16 function-length 0 compress-flavor coc-next
  index 15 sid ipv6 2001:DB8:E010:: compress-16 block 32 node-length 0 function-length 16 compress-flavor next
 srv6-te policy policy1 endpoint 2001:DB8:3::3 color 101
  candidate-path preference 100
   segment-list list1
#
isis 1
 is-level level-1
 cost-style wide
 network-entity 10.0000.0000.0001.00
 #
 ipv6 enable topology ipv6
 segment-routing ipv6 locator aa
 #
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ipv6 enable
 ipv6 address 2001:DB8:10::1/96
 isis ipv6 enable 1
#
interface<strong> </strong>GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 192.168.1.2 255.255.255.0
#
interface LoopBack1
 ipv6 enable
 ipv6 address 2001:DB8:1::1/128
 isis ipv6 enable 1
#
bgp 100
 router-id 1.1.1.1
 peer 192.168.1.1 as-number 200
 peer 2001:DB8:3::3 as-number 100
 peer 2001:DB8:3::3 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  network 192.168.1.0 255.255.255.0
  unicast-route recursive-lookup tunnel-v6 tunnel-selector p1
  segment-routing ipv6 locator aa compress
  segment-routing ipv6 traffic-engineer
  peer 192.168.1.1 enable
  peer 2001:DB8:3::3 enable
  peer 2001:DB8:3::3 route-policy color export
  peer 2001:DB8:3::3 next-hop-local
  peer 2001:DB8:3::3 advertise-ext-community
  peer 2001:DB8:3::3 prefix-sid advertise-srv6-locator
#
route-policy color permit node 10
 apply extcommunity color 0:101
#
tunnel-policy p1
 tunnel select-seq ipv6 srv6-te-policy load-balance-number 1
#
return</pre>
</li><li><p>P configuration file</p>
<pre class="screen">#
sysname P 
#               
segment-routing ipv6
 encapsulation source-address 2001:DB8:2::2
 compress-16 enable
 locator aa compress-16 ipv6-prefix 2001:DB8:200:: 48 compress-static 8 static 32
#
isis 1          
 is-level level-1
 cost-style wide
 network-entity 10.0000.0000.0002.00
 #              
 ipv6 enable topology ipv6
 segment-routing ipv6 locator aa
 #
#  
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ipv6 enable
 ipv6 address 2001:DB8:10::2/96
 isis ipv6 enable 1
#               
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ipv6 enable
 ipv6 address 2001:DB8:20::1/96
 isis ipv6 enable 1          
#               
interface LoopBack1
 ipv6 enable    
 ipv6 address 2001:DB8:2::2/128
 isis ipv6 enable 1
# 
return </pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#
sysname PE2
#
tunnel-selector p1 permit node 1
 apply tunnel-policy p1
#
segment-routing ipv6
 encapsulation source-address 2001:DB8:3::3
 compress-16 enable
 locator aa compress-16 ipv6-prefix 2001:DB8:300:: 48 compress-static 8 static 32
  opcode compress ::E010 end psp-usd-next
 segment-list list1
  index 5 sid ipv6 2001:DB8:200:: compress-16 block 32 node-length 16 function-length 0 compress-flavor coc-next
  index 10 sid ipv6 2001:DB8:100:: compress-16 block 32 node-length 16 function-length 0 compress-flavor coc-next
  index 15 sid ipv6 2001:DB8:E010:: compress-16 block 32 node-length 0 function-length 16 compress-flavor next
 srv6-te policy policy1 endpoint 2001:DB8:1::1 color 101
  candidate-path preference 100
   segment-list list1
#
isis 1
 is-level level-1
 cost-style wide
 network-entity 10.0000.0000.0003.00
 #
 ipv6 enable topology ipv6
 segment-routing ipv6 locator aa
 #
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ipv6 enable
 ipv6 address 2001:DB8:20::2/96
 isis ipv6 enable 1
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 192.168.2.2 255.255.255.0
#
interface LoopBack1
 ipv6 enable
 ipv6 address 2001:DB8:3::3/128
 isis ipv6 enable 1
#
bgp 100
 router-id 2.2.2.2
 peer 192.168.2.1 as-number 300
 peer 2001:DB8:1::1 as-number 100
 peer 2001:DB8:1::1 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  network 192.168.2.0 255.255.255.0
  unicast-route recursive-lookup tunnel-v6 tunnel-selector p1
  segment-routing ipv6 locator aa compress
  segment-routing ipv6 traffic-engineer
  peer 192.168.2.1 enable
  peer 2001:DB8:1::1 enable
  peer 2001:DB8:1::1 route-policy color export
  peer 2001:DB8:1::1 next-hop-local
  peer 2001:DB8:1::1 advertise-ext-community
  peer 2001:DB8:1::1 prefix-sid advertise-srv6-locator
#
route-policy color permit node 10
 apply extcommunity color 0:101
#
tunnel-policy p1
 tunnel select-seq ipv6 srv6-te-policy load-balance-number 1
#
return</pre>
</li><li><p>DeviceA configuration file</p>
<pre class="screen">#
sysname DeviceA
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 192.168.1.1 255.255.255.0
#
bgp 200
 router-id 4.4.4.4
 peer 192.168.1.2 as-number 100
 #
 ipv4-family unicast
  undo synchronization
  peer 192.168.1.2 enable
#               
return </pre>
</li><li><p>DeviceB configuration file</p>
<pre class="screen">#
sysname DeviceB
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 192.168.2.1 255.255.255.0
#
bgp 300
 router-id 5.5.5.5
 peer 192.168.2.2 as-number 100
 #
 ipv4-family unicast
  undo synchronization
  peer 192.168.2.2 enable
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_srv6_cfg_all_0101.html">Configuration Examples for SRv6 TE Policy (IS-IS)
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_srv6_cfg_all_0245.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_srv6_cfg_all_1025.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>

<script language="JavaScript">
<!--
image_size('.imgResize');
var msg_imageMax = "view original image";
var msg_imageClose = "close";
//--></script></body>
</html>