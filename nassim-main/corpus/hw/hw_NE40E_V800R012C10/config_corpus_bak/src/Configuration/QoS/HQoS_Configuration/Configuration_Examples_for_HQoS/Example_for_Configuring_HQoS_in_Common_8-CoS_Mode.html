
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring HQoS in Common 8-CoS Mode">
<meta name="abstract" content="This section provides an example for configuring HQoS in common 8-CoS mode so that different service traffic is transmitted through different sub-interfaces.">
<meta name="description" content="This section provides an example for configuring HQoS in common 8-CoS mode so that different service traffic is transmitted through different sub-interfaces.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_qos_cfg_5039.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_qos_cfg_5105.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00606909,m00390128">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="HQoS">
<meta name="featuretype" content="QOS">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="HQoS">
<meta name="featuretype" content="QOS">
<meta name="featurename" content="HQoS">
<meta name="featuretype" content="QOS">
<meta name="featurename" content="HQoS">
<meta name="featuretype" content="QOS">
<meta name="OWNER" content="m00390128">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="m00915594">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172371575">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring HQoS in Common 8-CoS Mode</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172371575"></a><a name="EN-US_TASK_0172371575"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring HQoS in Common 8-CoS Mode</h1>
<div class="taskbody"><p>This section provides an example for configuring HQoS in common 8-CoS mode so that different service traffic is transmitted through different sub-interfaces.</p>
<div class="context"><a name="EN-US_TASK_0172371575__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>As shown in <a href="#EN-US_TASK_0172371575__fig_dc_ne_qos_cfg_504301">Figure 1</a>, users need to access the <span class="keyword">device</span> through the DSLAM. The <span class="keyword">device</span> functions as the access device of the backbone network.</p>
<p>Three types of services of the users are to be mapped to three PVCs of the DSLAM. The traffic flows of the same user access the <span class="keyword">device</span> through sub-interfaces GE <span>0/1/0</span>.1, GE <span>0/1/0</span>.2, and GE <span>0/1/0</span>.3, respectively, with different types of traffic flowing through different sub-interfaces. When reaching the <span class="keyword">device</span>, traffic flows carry double tags. The inner tag indicates the user, and the outer tag indicates the service type. Uniform scheduling of user traffic needs to be implemented with 100 Mbit/s assured bandwidth. The bandwidth for EF flows should be 30 Mbit/s, and the bandwidth for AF1 flows should be 10 Mbit/s. The bandwidth for the user group to which the users belong should be 500 Mbit/s. On the downstream interface of the <span class="keyword">device</span>, the traffic rate of EF flows should not be higher than 120 Mbit/s.</p>
<p>The VLAN tags marked for services are as follows:</p>
<ul><li>PC: The outer VLAN tag is 1; the inner VLAN tag is 1 to 100.</li><li>VoIP: The outer VLAN tag is 2; the inner VLAN tag is 1 to 100.</li><li>IPTV: The outer VLAN tag is 3; the inner VLAN tag is 1 to 100.</li></ul>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Sub-interfaces 1.1, sub-interface 2.1, subinterface 3.1, and interface 2 in this example represent GE <span>0/1/0</span>.1, GE <span>0/1/0</span>.2, GE <span>0/1/0</span>.3, and GE <span>0/2/0</span>, respectively.</p>
</div></div>
<div class="fignone" id="EN-US_TASK_0172371575__fig_dc_ne_qos_cfg_504301"><a name="EN-US_TASK_0172371575__fig_dc_ne_qos_cfg_504301"></a><a name="fig_dc_ne_qos_cfg_504301"></a><span class="figcap"><b>Figure 1 </b>Network diagram of configuring HQoS in common 8-CoS mode</span><br><span><img class="vsd" src="images/fig_dc_ne_qos_cfg_504301.png" width="NaN" height="NaN"></span><br></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172371575__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure packet drop parameters for a flow WRED object.</p>
</li><li><p>Configure scheduling algorithms and parameters for FQs.</p>
</li><li><p>Configure a shaping value for a GQ.</p>
</li><li><p>Configure a network header length for a service profile.</p>
</li><li><p>Configure user-queue scheduling parameters for a QoS profile.</p>
</li><li><p>Configure packet drop parameters for a port WRED object.</p>
</li><li><p>Configure PQs on the downstream interface of the <span class="keyword">device</span>.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172371575__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>Packet drop parameters for flow WRED</p>
</li><li><p>Scheduling algorithms and parameters for FQs</p>
</li><li><p>Shaping value for a GQ</p>
</li><li><p>CIR, PIR, and network header length for user-queue in the QoS profile</p>
</li><li><p>Interface to which the QoS profile is applied</p>
</li><li><p>Port WRED parameters that are referenced by port-queue</p>
</li><li><p>Scheduling algorithms, related parameters, and shaping values for port-queue</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172371575__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure a flow WRED object.</span><p><p># Configure packet drop parameters for flow WRED.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>flow-wred test</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-flow-wred-test]<strong> color green low-limit 70 high-limit 100 discard-percentage 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-flow-wred-test] <strong>color yellow low-limit 60 high-limit 90 discard-percentage 100</strong> </pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-flow-wred-test] <strong>color red low-limit 50 high-limit 80 discard-percentage 100</strong> </pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-flow-wred-test]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-flow-wred-test]<strong> return</strong></pre>
<p>After the preceding configuration, you can run the <strong>display flow-wred configuration verbose</strong> command to view the configured parameters of the flow WRED object.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>display flow-wred configuration verbose test</strong></pre>
<pre class="screen">Flow wred name : test
---------------------------------------------------
Color    Low-limit    High-limit    Discard-percent
---------------------------------------------------
green    70           100           100
yellow   60           90            100
red      50           80            100
</pre>
<pre class="screen">Queue Depth<span>(kbytes)</span> : 1000   </pre>
<pre class="screen">Reference relationships : NULL        </pre>
</p></li><li><span>Configure scheduling algorithms and parameters for FQs.</span><p><p># Configure scheduling algorithms, WRED parameters, and shaping values for FQs.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>flow-queue test</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-flow-queue-template-test]<strong> queue af1 lpq flow-wred test shaping 10000</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-flow-queue-template-test] <strong>queue ef pq flow-wred test shaping 30000</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-flow-queue-template-test] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-flow-queue-template-test] <strong>return</strong></pre>
<p>After the preceding configuration, you can run the <strong>display flow-queue configuration verbose</strong> command to view the configuration of the FQ profile.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>display flow-queue configuration verbose test</strong> </pre>
<pre class="screen">Codes: Arith(Schedule algorithm)
       U-Weight(Schedule weight configured by users)
       I-Weight(Inverse schedule weight used by TM)
       A-Weight(Actual schedule weight obtained by users)
       Shp(Shaping value)
       Pct(The percentage of subscriber queue's PIR)
       Drop-Arith(The name of the WRED object used by the flow queue)

Flow Queue Template : test
------------------------------------------------------------------
Cos  Arith  U-Weight  I-Weight  A-Weight  Shp      Pct  Drop-Arith
------------------------------------------------------------------
be   wfq    10        3         10.00     -        -    Tail Drop
af1  lpq    -         -         -         10000    -    test
af2  wfq    10        3         10.00     -        -    Tail Drop
af3  wfq    15        2         15.00     -        -    Tail Drop
af4  wfq    15        2         15.00     -        -    Tail Drop
ef   pq     -         -         -         30000    -    test
cs6  pq     -         -         -         -        -    Tail Drop
cs7  pq     -         -         -         -        -    Tail Drop
<span></span>Reference relationships : NULL    </pre>
</p></li><li><span>Configure a shaping value for a GQ.</span><p><p># Configure a GQ.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>user-group-queue test</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-user-group-queue-test-slot-all] <strong>shaping 500000 inbound</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-user-group-queue-test-slot-all]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-user-group-queue-test-slot-all]<strong> return</strong></pre>
<p>After the preceding configuration, you can run the <strong>display user-group-queue configuration verbose</strong> command to view the configuration and the reference relationship of the GQ.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>display user-group-queue configuration verbose test</strong></pre>
<pre class="screen">user-group-queue-name : test</pre>
<pre class="screen"> slot : all</pre>
<pre class="screen"> [current configuration]</pre>
<pre class="screen">  inbound</pre>
<pre class="screen">   shaping-value &lt;kbps&gt; : 500000</pre>
<pre class="screen">   pbs-value &lt;byte&gt; : 524288</pre>
<pre class="screen">  outbound</pre>
<pre class="screen">   shaping-value &lt;kbps&gt; : NA</pre>
<pre class="screen">   pbs-value &lt;byte&gt; : NA</pre>
<pre class="screen">   weight-value : NA</pre>
<pre class="screen"> [reference relationship]</pre>
</p></li><li><span>Configure a network header length for a service profile.</span><p><p># Create a service profile and configure a network header length for it.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>service-template test</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-service-template-test-slot-all] <strong>network-header-length 12<span> inbound</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-service-template-test-slot-all] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-service-template-test-slot-all] <strong>return</strong></pre>
<div class="p">After the preceding configuration, you can run the <strong>display service-template configuration verbose</strong> command to view the configuration, network header length, and reference relationship of the service profile.<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>display service-template configuration verbose</strong></pre>
<pre class="screen">[service-template detail information]
total number : 1
slot all     : 1

service-template-name : test
 slot : all
 [current configuration]
  inbound network-header-length: 12

  outbound network-header-length: NA

 [reference relationship]
  NULL</pre>
</div>
</p></li><li><span>Configure scheduling parameters for a QoS profile and apply it to interfaces.</span><p><p># Configure user-queue scheduling parameters for a QoS profile.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>qos-profile test</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-qos-profile-test] <strong>user-queue cir 100000 flow-queue test user-group-queue test service-template test</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-qos-profile-test] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-qos-profile-test] <strong>return</strong></pre>
<p># Create QinQ VLAN tag termination sub-interfaces GE <span>0/1/0</span>.1, GE <span>0/1/0</span>.2, and GE <span>0/1/0</span>.3, and apply the QoS profile to them.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt;<strong> system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>interface gigabitethernet <span>0/1/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-GigabitEthernet<span>0/1/0</span>.1] <strong>control-vid 1 qinq-termination</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-GigabitEthernet<span>0/1/0</span>.1] <strong>qinq termination pe-vid 1 ce-vid 1 to 100</strong> </pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-GigabitEthernet<span>0/1/0</span>.1] <strong>ip address 10.10.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-GigabitEthernet<span>0/1/0</span>.1] <strong>qos-profile test inbound pe-vid 1 ce-vid 1 to 100 identifier ce-vid group group1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-GigabitEthernet<span>0/1/0</span>.1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-GigabitEthernet<span>0/1/0</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>interface gigabitethernet <span>0/1/0</span>.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-GigabitEthernet<span>0/1/0</span>.2] <strong>control-vid 2 qinq-termination</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-GigabitEthernet<span>0/1/0</span>.2] <strong>qinq termination pe-vid 2 ce-vid 1 to 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-GigabitEthernet<span>0/1/0</span>.2] <strong>ip address 10.10.2.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-GigabitEthernet<span>0/1/0</span>.2] <strong>qos-profile test inbound pe-vid 2 ce-vid 1 to 100 identifier ce-vid group group1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-GigabitEthernet<span>0/1/0</span>.2] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-GigabitEthernet<span>0/1/0</span>.2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>interface gigabitethernet <span>0/1/0</span>.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-GigabitEthernet<span>0/1/0</span>.3] <strong>control-vid 3 qinq-termination</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-GigabitEthernet<span>0/1/0</span>.3] <strong>qinq termination pe-vid 3 ce-vid 1 to 100</strong> </pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-GigabitEthernet<span>0/1/0</span>.3] <strong>ip address 10.10.3.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-GigabitEthernet<span>0/1/0</span>.3] <strong>qos-profile test inbound pe-vid 3 ce-vid 1 to 100 identifier ce-vid group group1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-GigabitEthernet<span>0/1/0</span>.3] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-GigabitEthernet<span>0/1/0</span>.3] <strong>return</strong></pre>
<p>After the preceding configuration, you can run the <a href="cmdqueryname=display+qos-profile+configuration"><b><span class="cmdname">display qos-profile configuration</span></b></a> <i><span class="varname">qos-profile-name</span></i> and <a href="cmdqueryname=display+qos-profile+application"><b><span class="cmdname">display qos-profile application</span></b></a> <i><span class="varname">profile-name</span></i> commands to view the configuration and application of the QoS profile.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>display qos-profile configuration test</strong></pre>
<pre class="screen">qos-profile: test 
inbound: 
outbound: 
both: 
user-queue cir 100000 pir 100000 flow-queue test user-group-queue test service-template test </pre>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt;  <strong>display qos-profile application test</strong></pre>
<pre class="screen">qos-profile test: 
GigabitEthernet<span>0/1/0</span>.1 
GigabitEthernet<span>0/1/0</span>.2 
GigabitEthernet<span>0/1/0</span>.3 
<span>Reference number by access user: [inbound] 0, [outbound] 0</span>
<span>Reference number by VNI: [inbound] 0, [outbound] 0</span></pre>
</p></li><li><span>Configure a port WRED object.</span><p><p># Configure packet drop parameters for port WRED.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>port-wred test</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-port-wred-test]<strong> color green low-limit 70 high-limit 100 discard-percentage 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-port-wred-test]<strong> color yellow low-limit 60 high-limit 90 discard-percentage 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-port-wred-test]<strong> color red low-limit 50 high-limit 80 discard-percentage 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-port-wred-test]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-port-wred-test]<strong> return</strong></pre>
<p>After the preceding configuration, you can run the <strong>display port-wred configuration verbose</strong> command to view the configuration of the port WRED object.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>display port-wred configuration verbose test</strong></pre>
<pre class="screen">Port wred name : test
---------------------------------------------------
Color    Low-limit    High-limit    Discard-percent
---------------------------------------------------
green    70           100           100
yellow   60           90            100
red      50           80            100
<span>Queue Depth(kbytes) : 8000 </span>
Reference relationships : NULL  </pre>
</p></li><li><span>Configure a PQ.</span><p><p># Configure a scheduling algorithm, WRED parameter, and shaping value for a PQ.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>]<strong> interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-GigabitEthernet<span>0/2/0</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-GigabitEthernet<span>0/2/0</span>]<strong> port-queue ef pq shaping 120 port-wred test outbound</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-GigabitEthernet<span>0/2/0</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-GigabitEthernet<span>0/2/0</span>]<strong> return</strong></pre>
<p>After the preceding configuration, you can run the <strong>display port-queue configuration interface</strong> command to view the configuration of the PQ.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>display port-queue configuration interface gigabitethernet <span>0/2/0</span> outbound</strong></pre>
<pre class="screen">GigabitEthernet<span>0/2/0</span> outbound current port-queue configuration:  
 be : arithmetic: wfq                weight: 10         tm weight: 3                       
       fact weight: 10.00             shaping(kbps): NA                                   
       port-wred: NA                                                                                                                
         green (low-high limit) (kbytes)                  12800 - 12800                                                            
         yellow(low-high limit) (kbytes)                  12800 - 12800                                                             
         red   (low-high limit) (kbytes)                  12800 - 12800                                                             
       current queue-length     (kbytes)                  12800                                                                     
       cir:123                        cir-percentage:NA
       cir-arithmetic:pq              cir-weight:NA
       pir:123                        pir-percentage:NA
       pir-arithmetic:lpq             pir-weight:NA      
 af1: arithmetic: wfq                weight: 10         tm weight: 3                                                               
       fact weight: 10.00             shaping(kbps): NA                                                                             
       port-wred: NA                                                                                                                
         green (low-high limit) (kbytes)                  12800 - 12800                                                             
         yellow(low-high limit) (kbytes)                  12800 - 12800                                                             
         red   (low-high limit) (kbytes)                  12800 - 12800                                                             
       current queue-length     (kbytes)                  12800                                                                     
       cir:NA                         cir-percentage:10
       cir-arithmetic:pq              cir-weight:NA
       pir:NA                         pir-percentage:20
       pir-arithmetic:wfq             pir-weight:15    
 af2: arithmetic: wfq                weight: 10         tm weight: 3                                                               
       fact weight: 10.00             shaping(kbps): NA                                                                             
       port-wred: NA                                                                                                                
         green (low-high limit) (kbytes)                  12800 - 12800                                                             
         yellow(low-high limit) (kbytes)                  12800 - 12800                                                             
         red   (low-high limit) (kbytes)                  12800 - 12800                                                             
       current queue-length     (kbytes)                  12800                                                                     
       cir:NA                         cir-percentage:NA
       cir-arithmetic:NA              cir-weight:NA
       pir:NA                         pir-percentage:NA
       pir-arithmetic:NA              pir-weight:NA 
 af3: arithmetic: wfq                weight: 15         tm weight: 2                                                               
       fact weight: 15.00             shaping(kbps): NA                                                                             
       port-wred: NA                                                                                                                
         green (low-high limit) (kbytes)                  12800 - 12800                                                             
         yellow(low-high limit) (kbytes)                  12800 - 12800                                                             
         red   (low-high limit) (kbytes)                  12800 - 12800                                                            
       current queue-length     (kbytes)                  12800                                                                     
       cir:NA                         cir-percentage:NA
       cir-arithmetic:NA              cir-weight:NA
       pir:NA                         pir-percentage:NA
       pir-arithmetic:NA              pir-weight:NA 
 af4: arithmetic: wfq                weight: 15         tm weight: 2                                                               
       fact weight: 15.00             shaping(kbps): NA                                                                             
       port-wred: NA                                                                                                                
         green (low-high limit) (kbytes)                  12800 - 12800                                                             
         yellow(low-high limit) (kbytes)                  12800 - 12800                                                             
         red   (low-high limit) (kbytes)                  12800 - 12800                                                             
       current queue-length     (kbytes)                  12800                                                                     
       cir:NA                         cir-percentage:NA
       cir-arithmetic:NA              cir-weight:NA
       pir:NA                         pir-percentage:NA
       pir-arithmetic:NA              pir-weight:NA 
 ef : arithmetic: pq                 weight: NA         tm weight: 0                                                               
       fact weight: 0.00              shaping(kbps): NA                                                                             
       port-wred: NA                                                                                                                
         green (low-high limit) (kbytes)                  1280 - 1280                                                               
         yellow(low-high limit) (kbytes)                  1280 - 1280                                                               
         red   (low-high limit) (kbytes)                  1280 - 1280                                                               
       current queue-length     (kbytes)                  1280                                                                      
       cir:NA                         cir-percentage:NA
       cir-arithmetic:NA              cir-weight:NA
       pir:NA                         pir-percentage:NA
       pir-arithmetic:NA              pir-weight:NA 
 cs6: arithmetic: pq                 weight: NA         tm weight: 0                                                               
       fact weight: 0.00              shaping(kbps): NA                                                                             
       port-wred: NA                                                                                                                
         green (low-high limit) (kbytes)                  1280 - 1280                                                               
         yellow(low-high limit) (kbytes)                  1280 - 1280                                                               
         red   (low-high limit) (kbytes)                  1280 - 1280                                                               
       current queue-length     (kbytes)                  1280                                                                      
       cir:NA                         cir-percentage:NA
       cir-arithmetic:NA              cir-weight:NA
       pir:NA                         pir-percentage:NA
       pir-arithmetic:NA              pir-weight:NA 
 cs7: arithmetic: pq                 weight: NA         tm weight: 0                                                               
       fact weight: 0.00              shaping(kbps): NA                                                                             
       port-wred: NA                                                                                                                
         green (low-high limit) (kbytes)                  1280 - 1280                                                               
         yellow(low-high limit) (kbytes)                  1280 - 1280                                                               
         red   (low-high limit) (kbytes)                  1280 - 1280                                                               
       current queue-length     (kbytes)                  1280                                                                      
       cir:NA                         cir-percentage:NA
       cir-arithmetic:NA              cir-weight:NA
       pir:NA                         pir-percentage:NA
       pir-arithmetic:NA              pir-weight:NA</pre>
</p></li><li><span>Verify the configuration.</span><p><p>When there are flows on the network, you can observe that packets of user 1's AF1 and EF flows and user 2's EF flows are forwarded at the assured bandwidth.</p>
<p>Running the <strong>display port-queue statistics</strong> command on the downstream interface GE <span>0/2/0</span> of the <span class="keyword">device</span>, you can see that EF packets increase rapidly.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>display port-queue statistics interface gigabitethernet <span>0/2/0</span> ef outbound</strong></pre>
<pre class="screen">GigabitEthernet<span>0/2/0</span> outbound traffic statistics:                            
[ef]
  Current usage percentage of queue: 10  
  Total pass:
                           5,097,976 packets,                458,817,750 bytes
  Total discard:
                                   0 packets,                          0 bytes
    Drop tail discard:
                                   0 packets,                          0 bytes
    Wred discard:
                                   0 packets,                          0 bytes
  Last 30 seconds pass rate:
                              12,030 pps,                      8,661,600 bps
  Last 30 seconds discard rate:
                                   0 pps,                              0 bps
    Drop tail discard rate:
                                   0 pps,                              0 bps
    Wred discard rate:
                                   0 pps,                              0 bps    
<span>  buffer size:                    10 kbytes   </span>
<span>  used buffer size:                0 kbytes </span>  
  Peak rate:                                                                    
                          2013-11-17 13:15:18                          8,661,600 bps </pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172371575__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p><span class="keyword">HUAWEI</span> configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">flow-wred test</pre>
<pre class="screen"> color green low-limit 70 high-limit 100 discard-percentage 100</pre>
<pre class="screen"> color yellow low-limit 60 high-limit 90 discard-percentage 100</pre>
<pre class="screen"> color red low-limit 50 high-limit 80 discard-percentage 100</pre>
<pre class="screen">#</pre>
<pre class="screen">flow-queue test</pre>
<pre class="screen"> queue af1 lpq shaping 10000 flow-wred test</pre>
<pre class="screen"> queue ef pq shaping 30000 flow-wred test</pre>
<pre class="screen">#</pre>
<pre class="screen">user-group-queue test</pre>
<pre class="screen"> shaping 500000 inbound</pre>
<pre class="screen">#</pre>
<pre class="screen">service-template test</pre>
<pre class="screen"> network-header-length 12 inbound</pre>
<pre class="screen">#</pre>
<pre class="screen">qos-profile test</pre>
<pre class="screen"> user-queue cir 100000 pir 100000 flow-queue test user-group-queue test service-template test  </pre>
<pre class="screen">#</pre>
<pre class="screen">port-wred test</pre>
<pre class="screen"> color green low-limit 70 high-limit 100 discard-percentage 100</pre>
<pre class="screen"> color yellow low-limit 60 high-limit 90 discard-percentage 100</pre>
<pre class="screen"> color red low-limit 50 high-limit 80 discard-percentage 100</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span>.1  </pre>
<pre class="screen"> encapsulation qinq-termination</pre>
<pre class="screen"> qinq termination pe-vid 1 ce-vid 1 to 100 </pre>
<pre class="screen"> ip address 10.10.1.1 255.255.255.0</pre>
<pre class="screen"> qos-profile test inbound pe-vid 1 ce-vid 1 to 100 identifier ce-vid group group1</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span>.2 </pre>
<pre class="screen"> encapsulation qinq-termination</pre>
<pre class="screen"> qinq termination pe-vid 2 ce-vid 1 to 100 </pre>
<pre class="screen"> ip address 10.10.2.1 255.255.255.0</pre>
<pre class="screen"> qos-profile test inbound pe-vid 2 ce-vid 1 to 100 identifier ce-vid group group1</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span>.3 </pre>
<pre class="screen"> encapsulation qinq-termination</pre>
<pre class="screen"> qinq termination pe-vid 3 ce-vid 1 to 100 </pre>
<pre class="screen"> ip address 10.10.3.1 255.255.255.0</pre>
<pre class="screen"> qos-profile test inbound pe-vid 3 ce-vid 1 to 100 identifier ce-vid group group1</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/2/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.20.1.1 255.255.255.0</pre>
<pre class="screen"> port-queue ef pq shaping 120 port-wred test outbound</pre>
<pre class="screen">#</pre>
<pre class="screen">ospf 10</pre>
<pre class="screen"> area 0.0.0.0</pre>
<pre class="screen"> network 10.20.1.0 0.0.0.255</pre>
<pre class="screen"> network 10.10.1.0 0.0.0.255</pre>
<pre class="screen"> network 10.10.2.0 0.0.0.255</pre>
<pre class="screen"> network 10.10.3.0 0.0.0.255</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_qos_cfg_5039.html">Configuration Examples for HQoS
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_qos_cfg_5105.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>