
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Redirection on Dual Outbound Interfaces">
<meta name="abstract" content="This section provides an example for configuring redirection on dual outbound interfaces.">
<meta name="description" content="This section provides an example for configuring redirection on dual outbound interfaces.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_qos_cfg_0068.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_qos_cfg_013803.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_qos_cfg_2053.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00606909,m00390128">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="Class-based QoS">
<meta name="featuretype" content="QOS">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="Class-based QoS">
<meta name="featuretype" content="QOS">
<meta name="featurename" content="Class-based QoS">
<meta name="featuretype" content="QOS">
<meta name="featurename" content="Class-based QoS">
<meta name="featuretype" content="QOS">
<meta name="OWNER" content="m00390128">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="m00390128">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172371300">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring Redirection on Dual Outbound Interfaces</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172371300"></a><a name="EN-US_TASK_0172371300"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Redirection on Dual Outbound Interfaces</h1>
<div class="taskbody"><p>This section provides an example for configuring redirection on dual outbound interfaces.</p>
<div class="context"><a name="EN-US_TASK_0172371300__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>As shown in <a href="#EN-US_TASK_0172371300__fig_dc_ne_qos_cfg_007501">Figure 1</a>, <span class="keyword">Device</span>A connects to the intranet through interface1 and connects to the public network through interface2 and interface3. By default, traffic from the intranet is transmitted to the public network through interface3. To enable traffic from the server to be transmitted to the public network through interface2 and other traffic to the public network through interface3, configure a traffic policy on <span class="keyword">Device</span>A.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>interface1, interface2, and interface3 in this example represent GE <span>0/1/0</span>, GE <span>0/2/0</span>, and GE <span>0/3/0</span>, respectively.</p>
</div></div>
<div class="fignone" id="EN-US_TASK_0172371300__fig_dc_ne_qos_cfg_007501"><a name="EN-US_TASK_0172371300__fig_dc_ne_qos_cfg_007501"></a><a name="fig_dc_ne_qos_cfg_007501"></a><span class="figcap"><b>Figure 1 </b>Configuring redirection on dual outbound interfaces</span><br><span><img class="vsd" src="images/fig_dc_ne_qos_cfg_007501.png" width="NaN" height="NaN"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172371300__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure a default route.</p>
</li><li><p>Configure ACL rules.</p>
</li><li><p>Configure traffic classifiers.</p>
</li><li><p>Configure traffic behaviors.</p>
</li><li><p>Configure a traffic policy.</p>
</li><li><p>Apply the traffic policy.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172371300__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>ACL numbers</p>
</li><li><p>Names of the traffic classifier, traffic behavior, and traffic policy, and number of the interface to which the traffic policy is applied</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172371300__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure a default route so that intranet traffic is transmitted to the public network through interface3 by default and interface2 is used as the backup outbound interface.</span><p><pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>ip route-static 0.0.0.0 0.0.0.0 10.1.99.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>ip route-static 0.0.0.0 0.0.0.0 10.1.99.5 preference 70</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
</p></li><li><span>Configure ACL rules.</span><p><p># Configure ACL 3001 to match the traffic from the server to other devices on the intranet.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>]<strong> acl number 3001</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-acl-advance-3001] <strong>rule 5 permit ip source 10.1.40.0 0.0.0.255 destination 10.1.40.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-acl-advance-3001] <strong>rule 10 permit ip source 10.1.40.0 0.0.0.255 destination 10.1.41.0 0.0.0.255 </strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-acl-advance-3001]<strong> rule 15 permit ip source 10.1.40.0 0.0.0.255 destination 10.1.42.0 0.0.0.255 </strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-acl-advance-3001] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-acl-advance-3001]<strong> quit</strong></pre>
<p># Configure ACL 3002 to match the traffic with the source address being the IP address of the server.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>acl number 3002</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-acl-advance-3002] <strong>rule 5 permit ip source 10.1.40.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-acl-advance-3002] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-acl-advance-3002] <strong>quit</strong></pre>
</p></li><li><span>Configure traffic classifiers.</span><p><p># Configure a traffic classifier named <strong>c1</strong>.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>traffic classifier c1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-classifier-c1]<strong> if-match acl 3001</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-classifier-c1]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-classifier-c1]<strong> quit</strong></pre>
<p># Configure a traffic classifier named <strong>c2</strong>.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>]<strong>traffic classifier c2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-classifier-c2]<strong> if-match acl 3002</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-classifier-c2]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-classifier-c2]<strong> quit</strong></pre>
</p></li><li><span>Configure traffic behaviors.</span><p><p># Configure a traffic behavior named <strong>b1</strong>.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>]<strong>traffic behavior b1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-behavior-b1] <strong>permit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-behavior-b1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-behavior-b1] <strong>quit</strong></pre>
<p># Configure a traffic behavior named <strong>b2</strong>.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>traffic behavior b2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-behavior-b2] <strong>redirect ip-nexthop 10.1.99.5</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-behavior-b2] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-behavior-b2] <strong>quit</strong></pre>
</p></li><li><span>Configure a traffic policy.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>traffic policy p1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-trafficpolicy-p1] <strong>classifier c1 behavior b1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-trafficpolicy-p1] <strong>classifier c2 behavior b2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-trafficpolicy-p1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-trafficpolicy-p1] <strong>quit</strong></pre>
</p></li><li><span>Apply the traffic policy.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-GigabitEthernet<span>0/1/0</span>] <strong>traffic-policy p1 inbound</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-GigabitEthernet<span>0/1/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p>After completing the configuration, run the <strong>display traffic policy</strong> command on DeviceA to check the configurations of the traffic policy, traffic classifier, and traffic behavior.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>display traffic policy user-defined p1</strong>
  User Defined Traffic Policy Information:                                      
    Policy: p1                                                                  
      Total: 5120  Used: 3  Free: 5117                                          
      Description:                                                              
      Step: 1                                                                   
      Share-mode                                                                
      Classifier: c1 Precedence: 1                                              
        Behavior: b1                                                            
        -none-                                                                  
                                                                                
      Classifier: c2 Precedence: 2                                              
        Behavior: b2                                                            
        Redirecting:                                                            
          redirect ip-nexthop 10.1.99.5                                         
                                                                                
      Classifier: default-class Precedence: 65535                               
        Behavior: be                                                            
        -none-                              </pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172371300__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><p><span class="keyword">HUAWEI</span> configuration file</p>
<pre class="screen">#
sysname <span class="keyword">HUAWEI</span>
#
ip route-static 0.0.0.0 0.0.0.0 10.1.99.1     
ip route-static 0.0.0.0 0.0.0.0 10.1.99.5 preference 70  
#
acl number 3001
 rule 5 permit ip source 10.1.40.0 0.0.0.255 destination 10.1.40.0 0.0.0.255    
 rule 10 permit ip source 10.1.40.0 0.0.0.255 destination 10.1.41.0 0.0.0.255    
 rule 15 permit ip source 10.1.40.0 0.0.0.255 destination 10.1.42.0 0.0.0.255
acl number 3002
 rule 5 permit ip source 10.1.40.0 0.0.0.255                   
#
traffic classifier c1 operator or
 if-match acl 3001
traffic classifier c2 operator or
 if-match acl 3002
#
traffic behavior b1                    
traffic behavior b2
 redirect ip-nexthop 10.1.99.5   
#
traffic policy p1
 classifier c1 behavior b1 precedence 1      
 classifier c2 behavior b2 precedence 1            
#
interface gigabitethernet<span>0/1/0</span>
 undo shutdown
 traffic-policy p1 inbound
#
return</pre>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_qos_cfg_0068.html">Configuration Examples for Class-based QoS
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_qos_cfg_013803.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_qos_cfg_2053.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>