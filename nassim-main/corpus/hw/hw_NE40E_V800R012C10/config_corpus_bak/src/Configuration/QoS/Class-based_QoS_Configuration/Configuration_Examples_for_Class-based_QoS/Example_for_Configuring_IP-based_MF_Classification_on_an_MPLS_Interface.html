
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring IP-based MF Classification on an MPLS Interface">
<meta name="abstract" content="This section provides an example for configuring IP-based MF classification on an MPLS interface.">
<meta name="description" content="This section provides an example for configuring IP-based MF classification on an MPLS interface.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_qos_cfg_0068.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_qos_cfg_0073.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_qos_cfg_013803.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00606909,m00390128">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="Class-based QoS">
<meta name="featuretype" content="QOS">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="Class-based QoS">
<meta name="featuretype" content="QOS">
<meta name="featurename" content="Class-based QoS">
<meta name="featuretype" content="QOS">
<meta name="featurename" content="Class-based QoS">
<meta name="featuretype" content="QOS">
<meta name="OWNER" content="m00390128">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="m00915594">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172371297">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring IP-based MF Classification on an MPLS Interface</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172371297"></a><a name="EN-US_TASK_0172371297"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring IP-based MF Classification on an MPLS Interface</h1>
<div class="taskbody"><p>This section provides an example for configuring IP-based MF classification on an MPLS interface.</p>
<div class="context"><a name="EN-US_TASK_0172371297__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>As shown in <a href="#EN-US_TASK_0172371297__fig_dc_ne_qos_cfg_006901">Figure 1</a>, PE1, the P, and PE2 are routers on the MPLS backbone network, and CE1, CE2, CE3, and CE4 are access routers on the edge of the backbone network. Use PE1 as an example. You can configure IP-based MF classification on the public network interface (Interface3) of PE1 to implement traffic control on the public network side and verify the packet sending and receiving through traffic statistics.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interface1, Interface2, and Interface3 in this example represent GE <span>0/1/0</span>, GE <span>0/2/0</span>, and GE <span>0/1/3</span>, respectively.</p>
</div></div>
<div class="fignone" id="EN-US_TASK_0172371297__fig_dc_ne_qos_cfg_006901"><a name="EN-US_TASK_0172371297__fig_dc_ne_qos_cfg_006901"></a><a name="fig_dc_ne_qos_cfg_006901"></a><span class="figcap"><b>Figure 1 </b>Configuring IP-based MF classification on an MPLS interface</span><br><span><img class="vsd" src="images/fig_dc_ne_qos_cfg_007401.png"></span><br></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172371297__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure basic MPLS functions.</p>
</li><li><p>Configure MF classification based on IP layer information for incoming/outgoing packets on the public network.</p>
</li><li><p>Configure ACL rules.</p>
</li><li><p>Configure a traffic classifier.</p>
</li><li><p>Configure a traffic behavior.</p>
</li><li><p>Configure a traffic policy.</p>
</li><li><p>Apply the traffic policy.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172371297__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>ACL number</p>
</li><li><p>Names of the traffic classifier, traffic behavior, and traffic policy, and number of the interface to which the traffic policy is applied</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172371297__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure basic MPLS functions. The configuration details are not mentioned here.</span><p><p>For details about how to configure basic MPLS functions, see <a href="../vrp/dc_vrp_mpls-l3vpn-v4_cfg_0102.html">Example for Configuring BGP/MPLS IP VPN</a> in <em><span class="keyword">HUAWEI NE40E-M2 series</span></em> <em>Configuration Guide - VPN - BGP/MPLS IP VPN Configuration</em>.</p>
</p></li><li><span>Configure MF classification based on IP layer information for incoming/outgoing packets on the public network.</span><p><pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname PE1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>slot <span>1</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-slot-<span>1</span>] <strong>traffic-policy match-ip-layer mpls-pop</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-slot-<span>1</span>] <strong>traffic-policy match-ip-layer mpls-push</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-slot-<span>1</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-slot-<span>1</span>] <strong>quit</strong></pre>
</p></li><li><span>Configure ACL rules.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>acl number 3333</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-acl-advance-3333] <strong>rule 5 permit ip source 11.11.11.11 0 destination 33.33.33.33 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-acl-advance-3333] <strong>rule 10 permit ip source 33.33.33.33 0 destination 11.11.11.11 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-acl-advance-3333] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-acl-advance-3333] <strong>quit</strong></pre>
</p></li><li><span>Configure a traffic classifier.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>traffic classifier c1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-classifier-c1]<strong> if-match acl 3333</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-classifier-c1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-classifier-c1] <strong>quit</strong></pre>
</p></li><li><span>Configure a traffic behavior.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>traffic behavior b1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-behavior-b1] <strong>permit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-behavior-b1]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-behavior-b1]<strong> quit</strong></pre>
</p></li><li><span>Configure a traffic policy.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>traffic policy p1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-trafficpolicy-p1] <strong>classifier c1 behavior b1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-trafficpolicy-p1] <strong>share-mode</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-trafficpolicy-p1] <strong>statistic enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-trafficpolicy-p1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-trafficpolicy-p1] <strong>quit</strong></pre>
</p></li><li><span>Apply the traffic policy.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> interface gigabitethernet <span>0/1/3</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/3</span>] <strong>traffic-policy p1 inbound</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/3</span>] <strong>traffic-policy p1 outbound</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/3</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/3</span>] <strong>quit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p>After completing the configuration, run the <a href="cmdqueryname=ping+33.33.33.33"><b><span class="cmdname">ping 33.33.33.33</span></b></a> command on CE1 to ping CE3, and run the <a href="cmdqueryname=display+traffic+policy+statistics"><b><span class="cmdname">display traffic policy statistics</span></b></a> command on PE1 to view statistics about traffic exchanged between CE3 and CE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display traffic policy statistics interface gigabitethernet <span>0/1/3</span> inbound</strong></pre>
<pre class="screen">Info: The statistics is shared because the policy is shared.
Interface: GigabitEthernet<span>0/1/3</span>
Traffic policy inbound: p1
Traffic policy applied at 2017-08-30 18:30:20 
Statistics enabled at 2017-08-30 18:30:20
Statistics last cleared: Never
Rule number: 1 IPv4, 0 IPv6 
Current status: OK!
Item                             Packets                      Bytes
-------------------------------------------------------------------
Matched                                5                       500
  +--Passed                            4                       400
  +--Dropped                           1                       100
Missed                                 0                         0 
Last 30 seconds rate
Item                                 pps                        bps
-------------------------------------------------------------------
Matched                                5                       500
  +--Passed                            4                       400
  +--Dropped                           1                       100
Missed                                 0                         0</pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172371297__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><p>PE1 configuration file</p>
<pre class="screen">#
sysname PE1
#
slot <span>1</span> 
 traffic-policy match-ip-layer mpls-pop mpls-push

#
acl number 3333
 rule 5 permit ip source 11.11.11.11 0 destination 33.33.33.33 0
 rule 10 permit ip source 33.33.33.33 0 destination 11.11.11.11 0
#
traffic classifier c1 operator or
 if-match acl 3333
#
traffic behavior b1
#        
traffic policy p1
 share-mode
 statistic enable
 classifier c1 behavior b1 precedence 1
#
interface GigabitEthernet<span>0/1/3</span>
 undo shutdown
 traffic-policy p1 inbound
 traffic-policy p1 outbound
# 
return</pre>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_qos_cfg_0068.html">Configuration Examples for Class-based QoS
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_qos_cfg_0073.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_qos_cfg_013803.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>