
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring a DiffServ Mode for VPN">
<meta name="abstract" content="This section describes how to configure the DiffServ mode for VPNs so that VPN packets can be scheduled to different queues based on their service classes.">
<meta name="description" content="This section describes how to configure the DiffServ mode for VPNs so that VPN packets can be scheduled to different queues based on their service classes.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_qos_cfg_20000.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_qos_cfg_2003.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_qos_cfg_2005.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,w00556928,w00606909,mplsmvrp,z00809835,m00390128,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="MPLS QoS">
<meta name="featuretype" content="QOS">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="MPLS QoS">
<meta name="featuretype" content="QOS">
<meta name="featurename" content="MPLS Qos">
<meta name="featuretype" content="QOS">
<meta name="OWNER" content="m00390128,s00826690">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="b00896120">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172371591">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring a DiffServ Mode for VPN</title>
</head>
<body><a name="EN-US_TASK_0172371591"></a><a name="EN-US_TASK_0172371591"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring a DiffServ Mode for VPN</h1>
<div class="taskbody"><p>This section describes how to configure the DiffServ mode for VPNs so that VPN packets can be scheduled to different queues based on their service classes.</p>
<div class="context"><a name="EN-US_TASK_0172371591__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><div class="p"><h4 class="sectiontitle">Usage Scenario</h4><ol><li>This feature can be used on the ingress PE, egress PE, or both of them.<ul><li><p>If behavior aggregate (BA) classification and the Pipe mode are both configured on the user-side interface of the ingress PE, the Pipe/Short Pipe mode preferentially takes effect.</p>
</li><li><p>If the DiffServ mode is set to Pipe on the PE, BA classification is not required.</p>
</li><li><p>If the DiffServ mode is set to Uniform on the PE, the BA classification also needs to be configured.</p>
</li></ul>
</li><li>The DiffServ mode takes effect only on the L3VPN that meets the following conditions:<ul><li>When the DiffServ mode is set to Pipe/Short Pipe on the egress PE and BA classification is configured on the outbound interface in the downstream direction, you must run the <a href="cmdqueryname=qos+phb+disable"><b><span class="cmdname">qos phb disable</span></b></a> command on the outbound interface of the egress PE.</li><li>When the DiffServ mode is set to Uniform on the egress PE and BA classification is configured on the outbound interface in the downstream direction, you do not need to run the <a href="cmdqueryname=qos+phb+disable"><b><span class="cmdname">qos phb disable</span></b></a> command on the outbound interface of the egress PE.</li></ul>
</li><li>To allow the P node to schedule packets according to their service classes, you are also advised to configure BA classification on the P node in the following situations:<ul><li>The performance of the P node is limited, and congestion may occur.</li><li>LDP over TE is implemented on the P node. The TE tunnel interface resides on the P node, and the tunnel is configured with a priority.</li></ul>
</li></ol>
<p></p>
<h4 class="sectiontitle">Pre-configuration Tasks</h4><p>Before configuring the Pipe/Short Pipe mode for VPNs, complete the following tasks:</p>
<ul><li><p>Configure an MPLS TE tunnel between PEs. For details, see "MPLS TE Configuration" in <em><span class="keyword">HUAWEI NE40E-M2 series</span> <span class="keyword">Universal Service Router</span> Configuration Guide - MPLS</em>.</p>
</li><li><p>Configure L2VPN or L3VPN services as required. For details, see <span class="keyword">HUAWEI NE40E-M2 series</span> <span class="keyword">Universal Service Router</span> Configuration Guide - VPN.</p>
</li><li><p>Configure BA or MF classification on the user-side interface of the ingress PE. For details, see "Class-based QoS Configuration" in <span class="keyword">HUAWEI NE40E-M2 series</span> <span class="keyword">Universal Service Router</span> Configuration Guide - QoS.</p>
</li></ul>
</div>
</div></div>
<div class="steps-unordered"><a name="EN-US_TASK_0172371591__1.4.2"></a><a name="1.4.2"></a><h4 class="sectiontitle">Procedure</h4>
<ul><li><span>Configure an L3VPN DiffServ mode.</span><p><ol><li>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a><p>The system view is displayed.</p>
</li><li><p>(Optional) Run <a href="cmdqueryname=l3vpn+diffserv-mode+short-pipe+enhance+enable"><b><span class="cmdname">l3vpn diffserv-mode short-pipe enhance enable</span></b></a></p>
<p>The enhanced Short Pipe mode in L3VPN scenarios is configured.</p>
<p>The <a href="cmdqueryname=l3vpn+diffserv-mode+short-pipe+enhance+enable"><b><span class="cmdname">l3vpn diffserv-mode short-pipe enhance enable</span></b></a> command takes effect only when the DiffServ mode is set to Short Pipe.</p>
</li><li>Run <a href="cmdqueryname=ip+vpn-instance"><b><span class="cmdname">ip vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i><p>The VPN instance view is displayed.</p>
</li><li><p>Run <a href="cmdqueryname=diffserv-mode"><b><span class="cmdname">diffserv-mode</span></b></a> { <strong><span>pipe</span></strong> <i><span class="varname">service-class</span></i> <span>[ </span><i><span class="varname">color</span></i> <span>] </span>| <strong><span>short-pipe</span></strong> <i><span class="varname">service-class</span></i> <span>[ </span><i><span class="varname">color</span></i> <span>] </span>[ <strong><span>domain</span></strong> <i><span class="varname">ds-name</span></i> ] | <strong><span>uniform</span></strong> } or <a href="cmdqueryname=diffserv-mode"><b><span class="cmdname">diffserv-mode</span></b></a> <strong><span>ingress</span></strong> { <strong><span>uniform</span></strong> | <strong><span>pipe</span></strong> <i><span class="varname">service-class</span></i><span> <i><span class="varname">color</span></i></span> | <strong><span>short-pipe</span></strong> <i><span class="varname">service-class</span></i><span> <i><span class="varname">color</span></i></span> } <strong><span>egress</span></strong> { <strong><span>uniform</span></strong> | <strong><span>pipe</span></strong> | <strong><span>short-pipe</span></strong> [ <strong><span>domain</span></strong> <i><span class="varname">ds-name</span></i> ] }</p>
<p>A DiffServ mode is configured for the VPN instance.</p>
<p>The <a href="cmdqueryname=diffserv-mode"><b><span class="cmdname">diffserv-mode</span></b></a> command applies to both unicast and NG MVPN scenarios.</p>
</li><li>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a><p>The configuration is committed.</p>
</li></ol>
</p></li><li><span>Configure a VLL DiffServ mode.</span><p><ol><li>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a><p>The system view is displayed.</p>
</li><li>Run <a href="cmdqueryname=interface"><b><span class="cmdname">interface</span></b></a> <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i><div class="p">The user-side interface view is displayed.<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>This interface is the user-side interface to which an L2VPN is bound.</p>
</div></div>
</div>
</li><li>Run <a href="cmdqueryname=diffserv-mode"><b><span class="cmdname">diffserv-mode</span></b></a> { <strong><span>pipe</span></strong> <i><span class="varname">service-class</span></i> <span><i><span class="varname">color</span></i></span> | <strong><span>short-pipe</span></strong> <i><span class="varname">service-class</span></i> <span><i><span class="varname">color</span></i></span> [ <strong><span>domain</span></strong> <i><span class="varname">ds-name</span></i> ] | <strong><span>uniform</span></strong> }<span> or <a href="cmdqueryname=diffserv-mode"><b><span class="cmdname">diffserv-mode</span></b></a> <strong><span>ingress</span></strong> { <strong><span>uniform</span></strong> | <strong><span>pipe</span></strong> <i><span class="varname">service-class</span></i> <span><i><span class="varname">color</span></i></span> | <strong><span>short-pipe</span></strong> <i><span class="varname">service-class</span></i> <span><i><span class="varname">color</span></i></span> } <strong><span>egress</span></strong> { <strong><span>uniform</span></strong> | <strong><span>pipe</span></strong> | <strong><span>short-pipe</span></strong> [ <strong><span>trust</span></strong> { <strong><span>inner-vlan-8021p</span></strong> | <strong><span>ip-dscp</span></strong> } ] [ <strong><span>domain</span></strong> <i><span class="varname">ds-name</span></i> ] }</span><p>A VLL DiffServ mode is configured.</p>
</li><li>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a><p>The configuration is committed.</p>
</li></ol>
</p></li><li><span>Configure a VPLS DiffServ mode.</span><p><ol><li>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a><p>The system view is displayed.</p>
</li><li>Run <a href="cmdqueryname=vsi"><b><span class="cmdname">vsi</span></b></a> <i><span class="varname">vsi-name</span></i><p>The VSI view is displayed.</p>
</li><li>Run <a href="cmdqueryname=diffserv-mode"><b><span class="cmdname">diffserv-mode</span></b></a> { <strong><span>pipe</span></strong> <i><span class="varname">service-class</span></i> <span><i><span class="varname">color</span></i> </span>| <strong><span>short-pipe</span></strong> <i><span class="varname">service-class</span></i> <span><i><span class="varname">color</span></i> </span>[ <strong><span>domain</span></strong> <i><span class="varname">ds-name</span></i> ] | <strong><span>uniform</span></strong> } or <span><a href="cmdqueryname=diffserv-mode"><b><span class="cmdname">diffserv-mode</span></b></a> <strong><span>ingress</span></strong> { <strong><span>uniform</span></strong> | <strong><span>pipe</span></strong> <i><span class="varname">service-class</span></i> <span><i><span class="varname">color</span></i></span> | <strong><span>short-pipe</span></strong> <i><span class="varname">service-class</span></i> <span><i><span class="varname">color</span></i></span> } <strong><span>egress</span></strong> { <strong><span>uniform</span></strong> | <strong><span>pipe</span></strong> | <strong><span>short-pipe</span></strong> [ <strong><span>trust</span></strong> { <strong><span>inner-vlan-8021p</span></strong> | <strong><span>ip-dscp</span></strong> } ] [ <strong><span>domain</span></strong> <i><span class="varname">ds-name</span></i> ] }</span><p>A VPLS DiffServ mode is configured.</p>
</li><li>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a><p>The configuration is committed.</p>
</li></ol>
</p></li><li><span>Configure an EVPN DiffServ mode.</span><p></p><p></p><p><ul><li>Configure a DiffServ mode in the EVPN instance view and BD-EVPN instance view.<ol><li>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a><p>The system view is displayed.</p>
</li><li>Configure an EVPN instance. For details, see <a href="../vrp/dc_vrp_evpn_cfg_0004.html">Configuring an EVPN Instance</a>.</li><li>Run <a href="cmdqueryname=diffserv-mode"><b><span class="cmdname">diffserv-mode</span></b></a> { <strong><span>pipe</span></strong> <i><span class="varname">service-class</span></i> <span><i><span class="varname">color</span></i> </span>| <strong><span>short-pipe</span></strong> <i><span class="varname">service-class</span></i> <span><i><span class="varname">color</span></i> </span>[ <strong><span>domain</span></strong> <i><span class="varname">ds-name</span></i> ] | <strong><span>uniform</span></strong> } or <a href="cmdqueryname=diffserv-mode"><b><span class="cmdname">diffserv-mode</span></b></a> <strong><span>ingress</span></strong> { <strong><span>uniform</span></strong> | <strong><span>pipe</span></strong> <i><span class="varname">service-class</span></i> <span><i><span class="varname">color</span></i> </span>| <strong><span>short-pipe</span></strong> <i><span class="varname">service-class</span></i> <span><i><span class="varname">color</span></i> </span>} <strong><span>egress</span></strong> { <strong><span>uniform</span></strong> | <strong><span>pipe</span></strong> | <strong><span>short-pipe</span></strong> [ <strong><span>trust</span></strong> { <strong><span>inner-vlan-8021p</span></strong> | <strong><span>ip-dscp</span></strong> } ] [ <strong><span>domain</span></strong> <i><span class="varname">ds-name</span></i> ] }<p>An EVPN DiffServ mode is configured.</p>
</li><li>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a><p>The configuration is committed.</p>
</li></ol>
</li><li>Configure a DiffServ mode in the EVPL instance view.<ol><li>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a><p>The system view is displayed.</p>
</li><li>Configure an EVPL instance. For details, see <a href="../vrp/dc_vrp_evpn_cfg_0021.html">Configuring an EVPL Instance</a>.</li><li>Run <a href="cmdqueryname=diffserv-mode"><b><span class="cmdname">diffserv-mode</span></b></a> { <strong><span>pipe</span></strong> <i><span class="varname">service-class</span></i> <span><i><span class="varname">color</span></i> </span>| <strong><span>short-pipe</span></strong> <i><span class="varname">service-class</span></i> <span><i><span class="varname">color</span></i> </span>[ <strong><span>domain</span></strong> <i><span class="varname">ds-name</span></i> ] | <strong><span>uniform</span></strong> } or <a href="cmdqueryname=diffserv-mode"><b><span class="cmdname">diffserv-mode</span></b></a> <strong><span>ingress</span></strong> { <strong><span>uniform</span></strong> | <strong><span>pipe</span></strong> <i><span class="varname">service-class</span></i> <span><i><span class="varname">color</span></i> </span>| <strong><span>short-pipe</span></strong> <i><span class="varname">service-class</span></i> <span><i><span class="varname">color</span></i> </span>} <strong><span>egress</span></strong> { <strong><span>uniform</span></strong> | <strong><span>pipe</span></strong> | <strong><span>short-pipe</span></strong> [ <strong><span>trust</span></strong> { <strong><span>inner-vlan-8021p</span></strong> | <strong><span>ip-dscp</span></strong> } ] [ <strong><span>domain</span></strong> <i><span class="varname">ds-name</span></i> ] }<p>An EVPN DiffServ mode is configured.</p>
</li><li>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a><p>The configuration is committed.</p>
</li></ol>
</li></ul>
</p></li></ul></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_qos_cfg_20000.html">MPLS DiffServ Mode Configuration
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_qos_cfg_2003.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_qos_cfg_2005.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>