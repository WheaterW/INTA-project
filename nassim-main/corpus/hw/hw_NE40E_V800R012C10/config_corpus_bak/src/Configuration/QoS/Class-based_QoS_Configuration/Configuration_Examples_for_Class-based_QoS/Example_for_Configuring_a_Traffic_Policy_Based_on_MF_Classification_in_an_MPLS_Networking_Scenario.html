
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring a Traffic Policy Based on MF Classification in an MPLS Networking Scenario">
<meta name="abstract" content="This section provides an example for configuring and applying traffic classifiers and behaviors in an MPLS networking scenario.">
<meta name="description" content="This section provides an example for configuring and applying traffic classifiers and behaviors in an MPLS networking scenario.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_qos_cfg_0068.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_qos_cfg_2053.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_qos_cfg_0099.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00606909,m00390128">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="Class-based QoS">
<meta name="featuretype" content="QOS">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="Class-based QoS">
<meta name="featuretype" content="QOS">
<meta name="featurename" content="Class-based QoS">
<meta name="featuretype" content="QOS">
<meta name="featurename" content="Class-based QoS">
<meta name="featuretype" content="QOS">
<meta name="OWNER" content="m00390128">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="m00390128">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172371306">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring a Traffic Policy Based on MF Classification in an MPLS Networking Scenario</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172371306"></a><a name="EN-US_TASK_0172371306"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring a Traffic Policy Based on MF Classification in an MPLS Networking Scenario</h1>
<div class="taskbody"><p>This section provides an example for configuring and applying traffic classifiers and behaviors in an MPLS networking scenario.</p>
<div class="context"><a name="EN-US_TASK_0172371306__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>In <a href="#EN-US_TASK_0172371306__fig_dc_ne_qos_cfg_006901">Figure 1</a>, PE1, the P, and PE2 are routers on the MPLS backbone network, and CE1 and CE2 are access routers on the edge of the backbone network. Three users from the local network access the Internet through CE1.</p>
<ul><li><p>On CE1, the CIR of the traffic of the user from the network segment 1.1.1.0 is limited to 10 Mbit/s, and the CBS is limited to 150000 bytes.</p>
</li><li><p>On CE1, the CIR of the traffic of the user from the network segment 2.1.1.0 is limited to 5 Mbit/s, and the CBS is limited to 100000 bytes.</p>
</li><li><p>On CE1, the CIR of the traffic of the user from the network segment 3.1.1.0 is limited to 2 Mbit/s, and the CBS is limited to 100000 bytes.</p>
</li><li><p>On CE1, the DSCP values of the service packets from the three network segments are re-marked to 40, 26, and 0.</p>
</li><li><p>On PE1, the CIR, CBS, PIR, and PBS for accessing the MPLS backbone network are limited to 15 Mbit/s, 300000 bytes, 20 Mbit/s, and 500000 bytes, respectively.</p>
</li><li><p>On CE1, the CIR, CBS, PIR, and PBS of the UDP packets (except DNS, SNMP, SNMP trap, and syslog packets) are limited to 5 Mbit/s, 100000 bytes, 15 Mbit/s, and 200000 bytes, respectively.</p>
</li></ul>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>interface1, interface2, interface3, and interface4 in this example represent GE <span>0/1/0</span>, GE <span>0/2/0</span>, GE <span>0/3/0</span>, and GE <span>0/1/8</span>, respectively.</p>
</div></div>
<div class="fignone" id="EN-US_TASK_0172371306__fig_dc_ne_qos_cfg_006901"><a name="EN-US_TASK_0172371306__fig_dc_ne_qos_cfg_006901"></a><a name="fig_dc_ne_qos_cfg_006901"></a><span class="figcap"><b>Figure 1 </b>Configuring a traffic policy based on MF classification</span><br><span><img class="vsd" src="images/fig_dc_ne_qos_cfg_006901.png"></span><br></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172371306__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Notes</h4><p>When configuring a traffic policy based on MF classification, pay attention to the following:</p>
<ul><li>If both the <strong>if-match any</strong> and <strong>deny</strong> commands are configured, the MF classification function prevents all packets (including protocol packets) from passing through an interface. Therefore, exercise caution when using a combination of the preceding commands.</li><li>If the permit or deny action is configured in both the <strong>rule</strong> command and the traffic behavior view, only the packets permitted by the <strong>rule</strong> command are processed based on the traffic behavior. If the deny action is configured in either the <strong>rule</strong> command or the traffic behavior view, all matched packets are discarded.</li></ul>
</div></div>
<div class="context"><a name="EN-US_TASK_0172371306__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure ACL rules.</p>
</li><li><p>Configure traffic classifiers.</p>
</li><li><p>Configure traffic behaviors.</p>
</li><li><p>Configure traffic policies.</p>
</li><li><p>Apply the traffic policies to interfaces.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172371306__1.4.4"></a><a name="1.4.4"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>ACL numbers: 2001, 2002, 2003, 3001, and 3002</p>
</li><li><p>Re-marked DSCP values for the packets from the three network segments: 40, 26, and 0</p>
</li><li><p>CIRs of the traffic of users from the three network segments: 10 Mbit/s, 5 Mbit/s, and 2 Mbit/s; corresponding CBSs: 150000 bytes, 100000 bytes, and 100000 bytes</p>
</li><li><p>CIR, CBS, PIR, and PBS of the UDP packets on CE1: 5 Mbit/s, 100000 bytes, 15 Mbit/s, and 200000 bytes</p>
</li><li><p>CIR, CBS, PIR, and PBS on PE1: 15 Mbit/s, 300000 bytes, 20 Mbit/s, and 500000 bytes</p>
</li><li><p>Names of traffic classifiers, traffic behaviors, and traffic policies, and numbers of the interfaces to which the traffic policies are applied</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172371306__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure interface IP addresses, routes, and basic MPLS functions (for details, see the configuration files).</span></li><li><span>Configure MF classification on CE1 to limit the user traffic that accesses CE1 from the three local networks.</span><p><p># Configure ACL rules.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>acl number 2001</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-acl4-basic-2001]<strong> rule permit source 1.1.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-acl4-basic-2001] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1-acl4-basic-2001] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1]<strong> acl number 2002</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-acl4-basic-2002]<strong> rule permit source 2.1.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-acl4-basic-2002] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1-acl4-basic-2002] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1]<strong> acl number 2003</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-acl4-basic-2003]<strong> rule permit source 3.1.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-acl4-basic-2003] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1-acl4-basic-2003] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1]<strong> acl number 3001</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-acl4-advance-3001] <strong>rule 0 permit udp destination-port eq dns</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-acl4-advance-3001] <strong>rule 1 permit udp destination-port eq snmp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-acl4-advance-3001] <strong>rule 2 permit udp destination-port eq snmptrap</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-acl4-advance-3001] <strong>rule 3 permit udp destination-port eq syslog </strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-acl4-advance-3001] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1-acl4-advance-3001] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>acl number 3002</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-acl4-advance-3002] <strong>rule 4 permit udp </strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-acl4-advance-3002]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1-acl4-advance-3002]<strong> quit</strong></pre>
<p># Configure traffic classifiers and define ACL-based matching rules.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>traffic classifier a</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-classifier-a]<strong> if-match acl 2001</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-classifier-a] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1-classifier-a] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>traffic classifier b</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-classifier-b] <strong>if-match acl 2002</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-classifier-b] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1-classifier-b] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1]<strong> traffic classifier c</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-classifier-c]<strong> if-match acl 2003</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-classifier-c]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1-classifier-c]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1]<strong> traffic classifier udplimit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-classifier-udplimit] <strong>if-match acl 3001</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-classifier-udplimit] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1-classifier-udplimit] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>traffic classifier udplimit1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-classifier-udplimit1]<strong> if-match acl 3002</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-classifier-udplimit1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1-classifier-udplimit1] <strong>quit</strong></pre>
<p>After the preceding configuration is complete, run the <strong>display traffic classifier</strong> command to check the traffic classifier configuration.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1]<strong> display traffic classifier user-defined</strong></pre>
<pre class="screen">User Defined Classifier Information:</pre>
<pre class="screen">   Total: 65535  Used: 6  Free: 65529</pre>
<pre class="screen">   Classifier: a</pre>
<pre class="screen">    Description:</pre>
<pre class="screen">    Operator: or</pre>
<pre class="screen">    Rule(s):</pre>
<pre class="screen">      if-match acl 2001 <span>precedence 1</span></pre>
<pre class="screen">   Classifier: b</pre>
<pre class="screen">    Description:</pre>
<pre class="screen">    Operator: or</pre>
<pre class="screen">    Rule(s):</pre>
<pre class="screen">      if-match acl 2002 <span>precedence 2</span></pre>
<pre class="screen">   Classifier: c</pre>
<pre class="screen">    Description:</pre>
<pre class="screen">    Operator: or</pre>
<pre class="screen">    Rule(s):</pre>
<pre class="screen">      if-match acl 2003 <span>precedence 3</span></pre>
<pre class="screen">   Classifier: udplimit</pre>
<pre class="screen">    Description:</pre>
<pre class="screen">    Operator: or</pre>
<pre class="screen">    Rule(s) :</pre>
<pre class="screen">      if-match acl 3001 <span>precedence 4</span></pre>
<pre class="screen">   Classifier: udplimit1</pre>
<pre class="screen">    Description:</pre>
<pre class="screen">    Operator: or</pre>
<pre class="screen">    Rule(s) :</pre>
<pre class="screen">      if-match acl 3002</pre>
<p># Define traffic behaviors, and configure traffic policing and DSCP values to be re-marked.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>traffic behavior e</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-behavior-e] <strong>car cir 10000 cbs 150000 pbs 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-behavior-e] <strong>remark dscp 40</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-behavior-e]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1-behavior-e]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1]<strong> traffic behavior f</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-behavior-f]<strong> car cir 5000 cbs 100000 pbs 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-behavior-f] <strong>remark dscp 26</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-behavior-f] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1-behavior-f] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1]<strong> traffic behavior g</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-behavior-g] <strong>car cir 2000 cbs 100000 pbs 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-behavior-g]<strong> remark dscp 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-behavior-g]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1-behavior-g]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>traffic behavior udplimit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-behavior-udplimit] <strong>permit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-behavior-udplimit] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1-behavior-udplimit] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>traffic behavior udplimit1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-behavior-udplimit1] <strong>car cir 5000 pir 15000 cbs 100000 pbs 200000 green pass yellow discard red discard</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-behavior-udplimit1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1-behavior-udplimit1] <strong>quit</strong></pre>
<p># Define traffic policies to associate the traffic classifiers with the traffic behaviors.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>traffic policy 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-trafficpolicy-1] <strong>classifier a behavior e</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-trafficpolicy-1]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1-trafficpolicy-1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1]<strong> traffic policy 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-trafficpolicy-2]<strong> classifier b behavior f</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-trafficpolicy-2]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1-trafficpolicy-2]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1]<strong> traffic policy 3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-trafficpolicy-3]<strong> classifier c behavior g</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-trafficpolicy-3] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1-trafficpolicy-3] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>traffic policy udplimit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-trafficpolicy-udplimit] <strong>classifier udplimit behavior udplimit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-trafficpolicy-udplimit] <strong>classifier udplimit1 behavior udplimit1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-trafficpolicy-udplimit] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1-trafficpolicy-udplimit] <strong>quit</strong></pre>
<p>After completing the preceding configuration, run the <strong>display traffic policy</strong> command to check information about the configured traffic policies, traffic classifiers, and traffic behaviors.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>display traffic policy user-defined</strong></pre>
<pre class="screen">User Defined Traffic Policy Information:
  Total: 10239  Used: 4  Free: 10235
  Policy: 1
  Total: 5120 Used: 2 Free: 5118
   Description:
   Step: 1 
   Share-mode
     Classifier: a Precedence: 1 
     Behavior: e
      Committed Access Rate:
        CIR 10000 (Kbps), PIR 0 (Kbps), CBS 150000 (byte), PBS 0 (byte), ADJUST 0 
        Conform Action: pass  Yellow  Action: pass  Exceed  Action: discard  Color-aware: no 
      Marking:
        remark dscp cs5
     Classifier: default-class Precedence: 65535
     Behavior:   be
       -none-  
  Policy: 2
  Total: 5120 Used: 2 Free: 5118
   Description:
   Step: 1 
   Share-mode
     Classifier: b Precedence: 1 
     Behavior: f
      Committed Access Rate:
        CIR 5000 (Kbps), PIR 0 (Kbps), CBS 100000 (byte), PBS 0 (byte), ADJUST 0 
        Conform Action: pass  Yellow  Action: pass  Exceed  Action: discard  Color-aware: no
      Marking:
        remark dscp af31     
     Classifier: default-class Precedence: 65535
     Behavior:   be
       -none-  
  Policy: 3
  Total: 5120 Used: 2 Free: 5118
   Description:
   Step: 1 
   Share-mode
     Classifier: c Precedence: 1 
     Behavior: g
      Committed Access Rate:
        CIR 2000 (Kbps), PIR 0 (Kbps), CBS 100000 (byte), PBS 0 (byte), ADJUST 0
        Conform Action: pass  Yellow  Action: pass  Exceed  Action: discard  Color-aware: no
      Marking:
        remark dscp default
     Classifier: default-class Precedence: 65535
     Behavior:   be
       -none-  
  Policy: udplimit
  Total: 5120 Used: 2 Free: 5118
   Description:
   Step: 1 
   Share-mode
     Classifier: udplimit Precedence: 1 
     Behavior: udplimit
      -none-
     Classifier: udplimit1 Precedence: 10 
     Behavior: udplimit1
      Committed Access Rate:
       CIR 5000 (Kbps), PIR 15000 (Kbps), CBS 100000 (byte), PBS 200000 (byte), ADJUST 0
       Conform Action: pass  Yellow  Action: pass  Exceed  Action: discard  Color-aware: no
     Classifier: default-class Precedence: 65535
     Behavior:   be
       -none-  </pre>
<p># Apply the traffic policies to the inbound interfaces.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1-GigabitEthernet<span>0/1/0</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1-GigabitEthernet<span>0/1/0</span>] <strong>traffic-policy 1 inbound</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1]<strong> interface gigabitethernet <span>0/3/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1-GigabitEthernet<span>0/3/0</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/3/0</span>] <strong>traffic-policy 2 inbound</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/3/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1-GigabitEthernet<span>0/3/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1]<strong> interface gigabitethernet <span>0/1/8</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1-GigabitEthernet<span>0/1/8</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/8</span>]<strong> traffic-policy 3 inbound</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/8</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1-GigabitEthernet<span>0/1/8</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1-GigabitEthernet<span>0/2/0</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/2/0</span>]<strong> traffic-policy udplimit outbound</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/2/0</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1-GigabitEthernet<span>0/2/0</span>]<strong> quit</strong></pre>
</p></li><li><span>Configure MF classification on PE1 to limit the traffic that goes to the MPLS backbone network.</span><p><p># Configure a traffic classifier and define a matching rule.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>traffic classifier pe</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-classifier-pe]<strong> if-match any</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-classifier-pe]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-classifier-pe]<strong> quit</strong></pre>
<p>After the preceding configuration is complete, run the <strong>display traffic classifier</strong> command to check the traffic classifier configuration.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> display traffic classifier user-defined</strong></pre>
<pre class="screen">User Defined Classifier Information:</pre>
<pre class="screen">   Total: 65535  Used: 6  Free: 65529</pre>
<pre class="screen">   Classifier: pe</pre>
<pre class="screen">    Description:</pre>
<pre class="screen">    Operator: or</pre>
<pre class="screen">Rule(s):</pre>
<pre class="screen">  if-match any</pre>
<p># Define a traffic behavior and configure traffic policing.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>traffic behavior pe</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-behavior-pe] <strong>car cir 15000 pir 20000 cbs 300000 pbs 500000</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-behavior-pe]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-behavior-pe]<strong> quit</strong></pre>
<p># Define a traffic policy to associate the traffic classifier with the traffic behavior.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>traffic policy pe</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-trafficpolicy-pe] <strong>classifier pe behavior pe</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-trafficpolicy-pe]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-trafficpolicy-pe]<strong> quit</strong></pre>
<p>After completing the preceding configuration, run the <strong>display traffic policy</strong> command to check information about the configured traffic policy, traffic classifier, and traffic behavior.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display traffic policy user-defined</strong></pre>
<pre class="screen">User Defined Traffic Policy Information:
  Total: 10239  Used: 1     Free: 10238
  Policy: pe
   Total: 5120  Used: 2  Free: 5118
   Description:
   Step: 1 
   Share-mode
     Classifier: pe Precedence: 1 
     Behavior: pe
      Committed Access Rate:
        CIR 15000 (Kbps), PIR 2000 (Kbps), CBS 300000 (byte), PBS 500000 (byte), ADJUST 0                                                                             
       Conform Action: pass  Yellow  Action: pass  Exceed  Action: discard  Color-aware: no 
     Classifier: default-class Precedence: 65535
     Behavior:   be
       -none-  </pre>
<p># Apply the traffic policy to the inbound interface.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>traffic-policy pe inbound</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p>After completing the preceding configuration, run the <strong>display interface</strong> command on CE1 and PE1 to check the traffic statistics on the interfaces. The command output shows that the traffic policies have been applied to the interfaces.</p>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172371306__1.4.6"></a><a name="1.4.6"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>CE1 configuration file</p>
<pre class="screen">#
sysname CE1
#
acl number 2001
 rule 5 permit source 1.1.1.0 0.0.0.255
acl number 2002
 rule 5 permit source 2.1.1.0 0.0.0.255
acl number 2003
 rule 5 permit source 3.1.1.0 0.0.0.255
acl number 3001 
 rule 0 permit udp destination-port eq dns   
 rule 1 permit udp destination-port eq snmp  
 rule 2 permit udp destination-port eq snmptrap 
 rule 3 permit udp destination-port eq syslog
acl number 3002
 rule 4 permit udp 
#
traffic classifier a operator or
 if-match acl 2001
#
traffic classifier b operator or
 if-match acl 2002
#
traffic classifier c operator or
 if-match acl 2003
#
traffic classifier udplimit operator or 
 if-match acl 3001
#
traffic classifier udplimit1 operator or 
 if-match acl 3002
#
traffic behavior e
 car cir 10000 cbs 150000 green pass red discard
 remark dscp cs5
#
traffic behavior f
 car cir 5000 cbs 100000 green pass red discard
 remark dscp af31
#
traffic behavior g
 car cir 2000 cbs 100000 green pass red discard
 remark dscp default
#
traffic behavior udplimit
#
traffic behavior udplimit1
 car cir 5000 pir 15000 cbs 100000 pbs 200000 green pass yellow discard red discard
#
traffic policy 1
 classifier a behavior e precedence 1
#
traffic policy 2
 classifier b behavior f precedence 1
#
traffic policy 3
 classifier c behavior g precedence 1
#
traffic policy udplimit  
 classifier udplimit behavior udplimit precedence 1
 classifier udplimit1 behavior udplimit1 precedence 2
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 1.1.1.1 255.255.255.0
 traffic-policy 1 inbound
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.1.1.1 255.255.255.0
 traffic-policy udplimit outbound
#
interface GigabitEthernet<span>0/3/0</span>
 undo shutdown
 ip address 2.1.1.1 255.255.255.0
 traffic-policy 2 inbound
#
interface GigabitEthernet<span>0/1/8</span>
 undo shutdown
 ip address 3.1.1.1 255.255.255.0
 traffic-policy 3 inbound
#
ospf 1
 area 0.0.0.0
  network 1.1.1.0 0.0.0.255
  network 2.1.1.0 0.0.0.255
  network 3.1.1.0 0.0.0.255
  network 10.1.1.0 0.0.0.255
#
return </pre>
</li><li><p>PE1 configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname PE1</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls lsr-id 11.11.11.11</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls ldp</pre>
<pre class="screen">#</pre>
<pre class="screen">traffic classifier pe operator or</pre>
<pre class="screen"> if-match any</pre>
<pre class="screen">#</pre>
<pre class="screen">traffic behavior pe</pre>
<pre class="screen"> car cir 15000 pir 20000 cbs 300000 pbs 500000 green pass yellow pass red discard</pre>
<pre class="screen">#</pre>
<pre class="screen">traffic policy pe</pre>
<pre class="screen"> classifier pe behavior pe precedence 1</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.1.1.2 255.255.255.0</pre>
<pre class="screen"> traffic-policy pe inbound</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/2/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.10.1.1 255.255.255.0</pre>
<pre class="screen"> mpls</pre>
<pre class="screen"> mpls ldp</pre>
<pre class="screen">#</pre>
<pre class="screen">interface LoopBack0</pre>
<pre class="screen"> ip address 11.11.11.11 255.255.255.255</pre>
<pre class="screen">#</pre>
<pre class="screen">ospf 1</pre>
<pre class="screen"> area 0.0.0.0</pre>
<pre class="screen">  network 10.1.1.0 0.0.0.255</pre>
<pre class="screen">  network 10.10.1.0 0.0.0.255</pre>
<pre class="screen">  network 11.11.11.11 0.0.0.0</pre>
<pre class="screen">#</pre>
<pre class="screen">return </pre>
</li><li><p>P configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname P</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls lsr-id 33.33.33.33</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls ldp</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet <span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.10.1.2 255.255.255.0</pre>
<pre class="screen"> mpls</pre>
<pre class="screen"> mpls ldp</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet <span>0/2/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.11.1.1 255.255.255.0</pre>
<pre class="screen"> mpls</pre>
<pre class="screen"> mpls ldp</pre>
<pre class="screen">#</pre>
<pre class="screen">interface LoopBack0</pre>
<pre class="screen"> ip address 33.33.33.33 255.255.255.255</pre>
<pre class="screen">#</pre>
<pre class="screen">ospf 1</pre>
<pre class="screen"> area 0.0.0.0</pre>
<pre class="screen">  network 10.10.1.0 0.0.0.255</pre>
<pre class="screen">  network 10.11.1.0 0.0.0.255</pre>
<pre class="screen">  network 33.33.33.33 0.0.0.0</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname PE2</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls lsr-id 22.22.22.22</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls ldp</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.12.1.2 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/2/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.11.1.2 255.255.255.0</pre>
<pre class="screen"> mpls</pre>
<pre class="screen"> mpls ldp</pre>
<pre class="screen">#</pre>
<pre class="screen">interface LoopBack0</pre>
<pre class="screen"> ip address 22.22.22.22 255.255.255.255</pre>
<pre class="screen">#</pre>
<pre class="screen">ospf 1</pre>
<pre class="screen"> area 0.0.0.0</pre>
<pre class="screen">  network 10.11.1.0 0.0.0.255</pre>
<pre class="screen">  network 10.12.1.0 0.0.0.255</pre>
<pre class="screen">  network 22.22.22.22 0.0.0.0</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p>CE2 configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname CE2</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/2/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.12.1.1 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">ospf 1</pre>
<pre class="screen"> area 0.0.0.0</pre>
<pre class="screen">  network 10.12.1.0 0.0.0.255</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_qos_cfg_0068.html">Configuration Examples for Class-based QoS
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_qos_cfg_2053.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_qos_cfg_0099.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>