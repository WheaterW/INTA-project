
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring the Centralized NAT Static Source Tracing Algorithm and Load Balancing">
<meta name="abstract" content="This section provides an example for configuring the centralized NAT source tracing algorithm and load balancing, which implements many-to-many translation between a company's private IP addresses and public IP addresses and allows PCs only on a specified network segment to access the Internet.">
<meta name="description" content="This section provides an example for configuring the centralized NAT source tracing algorithm and load balancing, which implements many-to-many translation between a company's private IP addresses and public IP addresses and allows PCs only on a specified network segment to access the Internet.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_nat_cfg_0056.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/../../toctopics/en-us_task_0000001590438665.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_nat_cfg_0058_1.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="c00549182">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="NAT">
<meta name="featuretype" content="NAT and IPv6 Transition">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="NAT">
<meta name="featuretype" content="NAT and IPv6 Transition">
<meta name="featurename" content="NAT">
<meta name="featuretype" content="NAT and IPv6 Transition">
<meta name="featurename" content="NAT">
<meta name="featuretype" content="NAT and IPv6 Transition">
<meta name="OWNER" content="c00549182">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="c00549182">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001139936997">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring the Centralized NAT Static Source Tracing Algorithm and Load Balancing</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001139936997"></a><a name="EN-US_TASK_0000001139936997"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring the Centralized NAT Static Source Tracing Algorithm and Load Balancing</h1>
<div class="taskbody"><p>This section provides an example for configuring the centralized NAT source tracing algorithm and load balancing, which implements many-to-many translation between a company's private IP addresses and public IP addresses and allows PCs only on a specified network segment to access the Internet.</p>
<div class="context"><a name="EN-US_TASK_0000001139936997__1.4.1"></a><a name="1.4.1"></a>
<div class="p" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_context1758667200214110"><h4 class="sectiontitle">Networking Requirements</h4><div class="note" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_note98102031145210"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0000001139936997__en-us_task_0172374612_p18810531185214">Only the <span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword1152414571330">NE40E</span><span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword3501321048">-M2K</span> and <span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword84407551658">NE40E</span><span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword18823101016414">-M2K-B</span> support this configuration.</p>
</div></div>
<p id="EN-US_TASK_0000001139936997__en-us_task_0172374612_p622420088214110">In <a href="#EN-US_TASK_0000001139936997__en-us_task_0172374612_fig_dc_ne_cfg_nat_005701">Figure 1</a>, the <span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword1015770319214110">Router</span> performs the NAT function to help PCs within the enterprise network access the Internet. The <span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword1643731279214415">Router</span> uses GE <span>0/2/0</span> to connect to the enterprise network. The <span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword1169229194214110">Router</span> is connected to the Internet through GE <span>0/2/1</span>. The enterprise is assigned 100 public IP addresses of 11.11.11.101/32 through 11.11.11.200/32. When NAT load balancing is not used, a NAT service can be bound to only one CPU of a service board. As a result, the forwarding performance of a service board in a NAT instance will easily reach the upper limit. In NAT load balancing mode, multiple service board CPUs can be bound to a NAT instance to increase the NAT bandwidth of the same type of users. This saves instance configurations and reduces manual allocation of address pools and manual intervention on traffic. In addition, by using the static source tracing algorithm to find the private IP address based on the public IP address and port number, the device does not need to send source tracing logs to record information about intranet users' access to the external network, which enhances network security.</p>
<div class="p" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_p165030424214110"><a href="#EN-US_TASK_0000001139936997__en-us_task_0172374612_fig_dc_ne_cfg_nat_005701">Figure 1</a> shows IP addresses of interfaces. The configuration requirements are as follows:<ul id="EN-US_TASK_0000001139936997__en-us_task_0172374612_ul1586953417214110"><li id="EN-US_TASK_0000001139936997__en-us_task_0172374612_li769700559214110">Only PCs on the network segment of 192.168.10.0/24 can access the Internet.</li><li id="EN-US_TASK_0000001139936997__en-us_task_0172374612_li1883111621214110">Many-to-many NAT needs to be performed for IP addresses between the private and public networks.</li></ul>
</div>
<div class="fignone" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_fig_dc_ne_cfg_nat_005701"><a name="EN-US_TASK_0000001139936997__en-us_task_0172374612_fig_dc_ne_cfg_nat_005701"></a><a name="en-us_task_0172374612_fig_dc_ne_cfg_nat_005701"></a><span class="figcap"><b>Figure 1 </b>Network diagram of centralized NAT load balancing</span><div class="note" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_note905392299214110"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0000001139936997__en-us_task_0172374612_p2006730298214110">Interfaces 1 and 2 in this example represent GE<span>0/2/0</span> and GE<span>0/2/1</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_image1536291280214110" src="images/fig_dc_ne_cfg_nat_0120.png" width="NaN" height="NaN"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001139936997__1.4.2"></a><a name="1.4.2"></a>
<div class="p" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_context1309578491214110"><h4 class="sectiontitle">Configuration Roadmap</h4><p id="EN-US_TASK_0000001139936997__en-us_task_0172374612_p1356652224214110">The configuration roadmap is as follows:</p>
<ol id="EN-US_TASK_0000001139936997__en-us_task_0172374612_ol1770530072214110"><li id="EN-US_TASK_0000001139936997__en-us_task_0172374612_li1099169905214110">Create a NAT load balancing instance.</li><li id="EN-US_TASK_0000001139936997__en-us_task_0172374612_li1868891560214110">Configure a NAT traffic diversion policy.</li><li id="EN-US_TASK_0000001139936997__en-us_task_0172374612_li733104257214110">Configure a NAT conversion policy.</li><li id="EN-US_TASK_0000001139936997__en-us_task_0172374612_li159421549385">Configure the NAT static source tracing algorithm mapping.</li><li id="EN-US_TASK_0000001139936997__en-us_task_0172374612_li1194255413814">Bind the NAT static source tracing algorithm to the NAT instance.</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001139936997__1.4.3"></a><a name="1.4.3"></a>
<div class="p" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_context892861432214110"><h4 class="sectiontitle">Data Preparation</h4><div class="p" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_p4034586214110">To complete the configuration, you need the following data: <ul id="EN-US_TASK_0000001139936997__en-us_task_0172374612_ul1113499014214110"><li id="EN-US_TASK_0000001139936997__en-us_task_0172374612_li861477027214110">NAT load balancing instance</li><li id="EN-US_TASK_0000001139936997__en-us_task_0172374612_li1873169068214110">Information about the NAT traffic diversion policy</li><li id="EN-US_TASK_0000001139936997__en-us_task_0172374612_li326224465214110">IDs of the private and public address pools for the static source tracing algorithm</li><li id="EN-US_TASK_0000001139936997__en-us_task_0172374612_li2113612118214110">Private and public address segments of the static source tracing algorithm</li><li id="EN-US_TASK_0000001139936997__en-us_task_0172374612_li894892059214110">Port number range and port range size of the public address pool in the static source tracing algorithm</li></ul>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001139936997__1.4.4"></a><a name="1.4.4"></a>
<div class="p" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_context1970524902214110"><h4 class="sectiontitle">Procedure</h4><ol id="EN-US_TASK_0000001139936997__en-us_task_0172374612_ol1007269205214110"><li id="EN-US_TASK_0000001139936997__en-us_task_0172374612_li623683984214110"><p id="EN-US_TASK_0000001139936997__en-us_task_0172374612_p389038081214110"><a name="EN-US_TASK_0000001139936997__en-us_task_0172374612_li623683984214110"></a><a name="en-us_task_0172374612_li623683984214110"></a>Create a NAT load balancing instance.</p>
<ol type="a" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_ol1456427593214110"><li id="EN-US_TASK_0000001139936997__en-us_task_0172374612_li373437849214110"><p id="EN-US_TASK_0000001139936997__en-us_task_0172374612_p1422711609214110"><a name="EN-US_TASK_0000001139936997__en-us_task_0172374612_li373437849214110"></a><a name="en-us_task_0172374612_li373437849214110"></a>Set the maximum number of sessions that can be created on the CPU of the NAT service board to 6M. </p>
<pre class="screen" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_screen458412955214110">&lt;<span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword336881773214110">HUAWEI</span>&gt; <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b1351409409214110">system-view</strong></pre>
<pre class="screen" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_screen1150457453214110">[<span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword1547134481214110"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword957224291214110">HUAWEI</span>] <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b2136854704214110">sysname CGNA</strong></pre>
<pre class="screen" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_screen746208069214110">[<span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword1913071155214110">*</span><span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword861739201214110">HUAWEI</span>] <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b978821653214110">commit</strong></pre>
<pre class="screen" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_screen1388101425020">[<span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword433992015509"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGNA]<strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b091404825012"> vsm on-board-mode disable</strong></pre>
<pre class="screen" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_screen7641171135013">[<span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword568015251504">*</span>CGNA] <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b863414175015">commit</strong></pre>
<pre class="screen" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_screen477294952214110">[<span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword596954714214110"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGNA] <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b1505807792214110">license</strong></pre>
<pre class="screen" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_screen705287186214110">[<span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword971001662214110"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGNA-license] <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b1938787568214110">active nat session-table size 6 slot <span>1</span></strong></pre>
<pre class="screen" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_screen1792597813214110">[<span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword267738151217">*</span>CGNA-license] <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b897941673214110">active nat session-table size 6 slot <span>2</span> </strong></pre>
<pre class="screen" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_screen1454418120168">[<span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword10352171411129">*</span>CGNA-license] <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b195672020563">active nat bandwidth-enhance 40 slot <span>1</span></strong></pre>
<pre class="screen" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_screen1112128121614">[<span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword16413220151211">*</span>CGNA-license] <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b152131218169">active nat bandwidth-enhance 40 slot <span>2</span></strong></pre>
<pre class="screen" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_screen16826614151317">[<span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword162831618132">*</span>CGNA-license] <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b16501645161319">commit</strong></pre>
<pre class="screen" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_screen1551173963214110">[<span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword254024963214110"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGNA-license] <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b1645336780214110">quit</strong></pre>
</li><li id="EN-US_TASK_0000001139936997__en-us_task_0172374612_li1656222071214110"><p id="EN-US_TASK_0000001139936997__en-us_task_0172374612_p441314883214110"><a name="EN-US_TASK_0000001139936997__en-us_task_0172374612_li1656222071214110"></a><a name="en-us_task_0172374612_li1656222071214110"></a>Create a service-instance group named <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b240673761214415">groupa</strong> and bind it to service-location groups <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b1555412575214415">1</strong> and <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b1887812682214415">2</strong>.</p>
<pre class="screen" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_screen1255161666214110">[<span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword660848551214110"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGNA] <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b1494984467214110">service-location 1</strong></pre>
<pre class="screen" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_screen209530633214110">[<span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword28040805214110">*</span>CGNA-service-location-1] <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b1003849470214110">location slot <span>1</span></strong></pre>
<pre class="screen" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_screen1818456183214110">[<span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword315862079214110">*</span>CGNA-service-location-1] <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b493839718214110">commit</strong></pre>
<pre class="screen" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_screen435863934214110">[<span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword1738901247214110"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGNA-service-location-1] <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b1781925222214110">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_screen726709484214110">[<span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword317874090214110"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGNA] <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b1517458672214110">service-location 2</strong></pre>
<pre class="screen" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_screen673335749214110">[<span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword217287036214110">*</span>CGNA-service-location-2] <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b231121932214110">location slot <span>2</span></strong></pre>
<pre class="screen" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_screen1293219968214110">[<span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword372150814214110">*</span>CGNA-service-location-2] <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b1995525268214110">commit</strong></pre>
<pre class="screen" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_screen2011159319214110">[<span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword912200575214110"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGNA-service-location-2] <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b2101150460214110">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_screen138289992214110">[<span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword1438848735214110"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGNA] <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b159971955214110">service-instance-group groupa</strong></pre>
<pre class="screen" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_screen269805816214110">[<span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword568658164214110">*</span>CGNA-service-instance-group-groupa] <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b219287897214110">service-location 1</strong></pre>
<pre class="screen" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_screen2014224685214110">[<span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword1907536192214110">*</span>CGNA-service-instance-group-groupa] <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b1070988931214110">service-location 2</strong></pre>
<pre class="screen" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_screen235265614214110">[<span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword1055926140214110">*</span>CGNA-service-instance-group-groupa] <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b1928765224214110">commit</strong></pre>
<pre class="screen" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_screen885662159214110">[<span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword938367064214110"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGNA-service-instance-group-groupa] <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b139493920214110">quit</strong></pre>
</li><li id="EN-US_TASK_0000001139936997__en-us_task_0172374612_li785653004214110"><p id="EN-US_TASK_0000001139936997__en-us_task_0172374612_p1740576472214110"><a name="EN-US_TASK_0000001139936997__en-us_task_0172374612_li785653004214110"></a><a name="en-us_task_0172374612_li785653004214110"></a>Bind a NAT instance named <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b183330009214415">cpe1 </strong>to the service-instance-group named <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b1113391547214415">groupa</strong>.</p>
<pre class="screen" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_screen474412915214110">[<span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword1085879260214110"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGNA] <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b109388808214110">nat instance cpe1 id 11</strong></pre>
<pre class="screen" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_screen1829521825214110">[<span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword472766087214110">*</span>CGNA-nat-instance-cpe1] <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b844132228214110">service-instance-group groupa</strong></pre>
<pre class="screen" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_screen368256730214110">[<span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword1574181045214110">*</span>CGNA-nat-instance-cpe1] <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b1709822281214110">commit</strong></pre>
<pre class="screen" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_screen2062965689214110">[<span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword1602673440214110"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGNA-nat-instance-cpe1] <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b887768567214110">quit</strong></pre>
</li></ol>
</li><li id="EN-US_TASK_0000001139936997__en-us_task_0172374612_li798953096214110"><p id="EN-US_TASK_0000001139936997__en-us_task_0172374612_p1936923428214110"><a name="EN-US_TASK_0000001139936997__en-us_task_0172374612_li798953096214110"></a><a name="en-us_task_0172374612_li798953096214110"></a>Configure a NAT traffic diversion policy.</p>
<ol type="a" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_ol1120555491214110"><li id="EN-US_TASK_0000001139936997__en-us_task_0172374612_li1670354929214110"><p id="EN-US_TASK_0000001139936997__en-us_task_0172374612_p1749058119214110"><a name="EN-US_TASK_0000001139936997__en-us_task_0172374612_li1670354929214110"></a><a name="en-us_task_0172374612_li1670354929214110"></a>Configure an ACL numbered <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b9598064515058">3001</strong> and an ACL rule numbered <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b3488386865058">1</strong> to allow hosts only within the network segment 192.168.10.0/24 to access the Internet.</p>
<pre class="screen" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_screen659506939214110">[<span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword45376463214110"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGNA] <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b1238626094214110">acl 3001</strong></pre>
<pre class="screen" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_screen1591649414214110">[<span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword895343265214110">*</span>CGNA-acl4-advance-3001] <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b1518229601214110">rule 1 permit ip source 192.168.10.0 0.0.0.255</strong></pre>
<pre class="screen" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_screen1307864388214110">[<span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword1693797176214110">*</span>CGNA-acl4-advance-3001] <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b202252726214110">commit</strong></pre>
<pre class="screen" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_screen480963002214110">[<span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword991659075214110"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGNA-acl4-advance-3001] <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b682036948214110">quit</strong></pre>
</li><li id="EN-US_TASK_0000001139936997__en-us_task_0172374612_li1809162895214110"><p id="EN-US_TASK_0000001139936997__en-us_task_0172374612_p379818392214110"><a name="EN-US_TASK_0000001139936997__en-us_task_0172374612_li1809162895214110"></a><a name="en-us_task_0172374612_li1809162895214110"></a>Configure a traffic classifier.</p>
<pre class="screen" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_screen386061871214110">[<span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword1283663451214110"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGNA] <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b139078902214110">traffic classifier c1</strong></pre>
<pre class="screen" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_screen314520841214110">[<span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword1610759784214110">*</span>CGNA-classifier-c1] <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b466700203214110">if-match acl 3001</strong></pre>
<pre class="screen" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_screen920382883214110">[<span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword1448801051214110">*</span>CGNA-classifier-c1] <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b1520492704214110">commit</strong></pre>
<pre class="screen" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_screen369328487214110">[<span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword597520419214110"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGNA-classifier-c1] <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b613402773214110">quit</strong></pre>
</li><li id="EN-US_TASK_0000001139936997__en-us_task_0172374612_li1992847276214110"><p id="EN-US_TASK_0000001139936997__en-us_task_0172374612_p1629209120214110"><a name="EN-US_TASK_0000001139936997__en-us_task_0172374612_li1992847276214110"></a><a name="en-us_task_0172374612_li1992847276214110"></a>Configure a traffic behavior named <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b19689412004528">b1</strong>, which binds traffic to the NAT instance named <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b10073957634528">cpe1</strong>.</p>
<pre class="screen" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_screen144899972214110">[<span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword1758545841214110"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGNA] <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b587345599214110">traffic behavior b1</strong></pre>
<pre class="screen" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_screen2078942571214110">[<span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword1000743150214110">*</span>CGNA-behavior-b1] <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b967279970214110">nat bind instance cpe1</strong></pre>
<pre class="screen" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_screen1651389581214110">[<span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword1819799265214110">*</span>CGNA-behavior-b1] <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b392258595214110">commit</strong></pre>
<pre class="screen" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_screen2075427086214110">[<span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword740574478214110"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGNA-behavior-b1] <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b1699518406214110">quit</strong></pre>
</li><li id="EN-US_TASK_0000001139936997__en-us_task_0172374612_li1593474294214110"><p id="EN-US_TASK_0000001139936997__en-us_task_0172374612_p253897521214110"><a name="EN-US_TASK_0000001139936997__en-us_task_0172374612_li1593474294214110"></a><a name="en-us_task_0172374612_li1593474294214110"></a>Define a NAT policy to associate the ACL rule with the traffic behavior.</p>
<pre class="screen" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_screen703028383214110">[<span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword1077364061214110"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGNA] <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b1307558194214110">traffic policy p1</strong></pre>
<pre class="screen" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_screen1518771442214110">[<span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword377285166214110">*</span>CGNA-trafficpolicy-p1] <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b504373702214110">classifier c1 behavior b1</strong></pre>
<pre class="screen" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_screen340720751214110">[<span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword2063771508214110">*</span>CGNA-trafficpolicy-p1] <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b848699959214110">commit</strong></pre>
<pre class="screen" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_screen867703386214110">[<span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword340968866214110"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGNA-trafficpolicy-p1] <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b986390004214110">quit</strong></pre>
</li><li id="EN-US_TASK_0000001139936997__en-us_task_0172374612_li1680148500214110"><p id="EN-US_TASK_0000001139936997__en-us_task_0172374612_p993365097214110"><a name="EN-US_TASK_0000001139936997__en-us_task_0172374612_li1680148500214110"></a><a name="en-us_task_0172374612_li1680148500214110"></a>Apply the NAT traffic diversion policy in the interface view.</p>
<pre class="screen" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_screen1455997744214110">[<span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword1690499122214110"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGNA] <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b785645173214110">interface gigabitEthernet <span>0/2/0</span></strong></pre>
<pre class="screen" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_screen162430551214110">[<span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword870623714214110"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGNA-GigabitEthernet<span>0/2/0</span>] <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b605125205214110">traffic-policy p1 inbound</strong></pre>
<pre class="screen" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_screen33028388214110">[<span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword222166405214110">*</span>CGNA-GigabitEthernet<span>0/2/0</span>] <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b2066326940214110">commit</strong></pre>
<pre class="screen" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_screen576034535214110">[<span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword1348570939214110"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGNA-GigabitEthernet<span>0/2/0</span>] <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b172829229214110">quit</strong></pre>
</li></ol>
</li><li id="EN-US_TASK_0000001139936997__en-us_task_0172374612_li1462603926214110"><p id="EN-US_TASK_0000001139936997__en-us_task_0172374612_p1886360720214110"><a name="EN-US_TASK_0000001139936997__en-us_task_0172374612_li1462603926214110"></a><a name="en-us_task_0172374612_li1462603926214110"></a>Configure a group of static source tracing algorithm parameters. The private address pool contains IP addresses 192.168.10.128 through 192.168.10.255, the public address pool contains IP addresses 11.11.11.101 through 11.11.11.200, the port numbers are in the range of 256 to 1279, and the port range size is 256.</p>
<pre class="screen" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_screen1608359028214110">[<span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword178698089214110"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword1196643317214110">HUAWEI</span>] <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b245847628214110">nat static-mapping</strong></pre>
<pre class="screen" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_screen445310681214110">[<span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword32785815214110">*</span><span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword1275379073214110">HUAWEI</span>-nat-static-mapping] <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b658207503214110">inside-pool 1</strong></pre>
<pre class="screen" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_screen180080374214110">[<span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword180290148214110">*</span><span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword37091519214110">HUAWEI</span>-nat-static-mapping-inside-pool-1] <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b790553639214110">section 1 192.168.10.128 192.168.10.255</strong></pre>
<pre class="screen" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_screen177363092214110">[<span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword1760749552214110">*</span><span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword593064804214110">HUAWEI</span>-nat-static-mapping-inside-pool-1] <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b1167630692214110">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_screen1275078282214110">[<span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword1983562746214110">*</span><span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword202935994214110">HUAWEI</span>-nat-static-mapping] <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b1686622609214110">global-pool 1</strong></pre>
<pre class="screen" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_screen902192912214110">[<span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword263973468214110">*</span><span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword2048345621214110">HUAWEI</span>-nat-static-mapping-global-pool-1] <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b728169385214110">section 1 11.11.11.101 11.11.11.200</strong></pre>
<pre class="screen" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_screen636663735214110">[<span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword1058423682214110">*</span><span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword1319775273214110">HUAWEI</span>-nat-static-mapping-global-pool-1] <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b550750937214110">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_screen151947993214110">[<span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword1958533663214110">*</span><span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword445932825214110">HUAWEI</span>-nat-static-mapping] <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b989847426214110">static-mapping 10 inside-pool 1 global-pool 1 port-range 256 1279 port-size 256</strong></pre>
<pre class="screen" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_screen32741447214110">[<span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword1114515464214110">*</span><span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword1309034314214110">HUAWEI</span>-nat-static-mapping] <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b573521920214110">commit</strong></pre>
<pre class="screen" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_screen1736072892214110">[<span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword577651472214110"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword1962205464214110">HUAWEI</span>-nat-static-mapping] <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b1324987134214110">quit</strong></pre>
</li><li id="EN-US_TASK_0000001139936997__en-us_task_0172374612_li623508272214110"><p id="EN-US_TASK_0000001139936997__en-us_task_0172374612_p1730813791214110"><a name="EN-US_TASK_0000001139936997__en-us_task_0172374612_li623508272214110"></a><a name="en-us_task_0172374612_li623508272214110"></a>Enable the static source tracing algorithm in the NAT instance named <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b384217336214415">cpe1</strong> and set the algorithm parameter ID to <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b2064155567214415">10</strong>.</p>
<pre class="screen" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_screen1623129160214110">[<span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword1239259947214110"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword1945520623214110">HUAWEI</span>] <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b1151770214214110">nat instance cpe1</strong></pre>
<pre class="screen" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_screen856290304214110">[<span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword1281187492214110"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword99649575214110">HUAWEI</span>-nat-instance-cpe1] <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b1470825627214110">nat bind static-mapping 10</strong></pre>
<pre class="screen" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_screen1545899720214110">[<span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword1846707117214110">*</span><span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword25365328214110">HUAWEI</span>-nat-instance-cpe1] <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b302034819214110">commit</strong></pre>
<pre class="screen" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_screen71901107214110">[<span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword1245164979214110"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_keyword259662038214110">HUAWEI</span>-nat-instance-cpe1] <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b307663072214110">quit</strong></pre>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001139936997__1.4.5"></a><a name="1.4.5"></a>
<div class="p" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_context1204252300214110"><h4 class="sectiontitle">Configuration Files</h4><p id="EN-US_TASK_0000001139936997__en-us_task_0172374612_p312694691214110">CGNA configuration file</p>
<pre class="screen" id="EN-US_TASK_0000001139936997__en-us_task_0172374612_screen39193363214110">#
sysname CGNA
#
vsm on-board-mode disable
#
license
 active nat session-table size 6 slot <span>1</span>
 active nat session-table size 6 slot <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b7752133516156"><span>2</span></strong>
 active nat bandwidth-enhance 40 slot <span>1</span>
 active nat bandwidth-enhance 40 slot <span>2</span>
#
nat static-mapping
 inside-pool 1
  section 1 192.168.10.128 192.168.10.255
 global-pool 1
  section 1 11.11.11.101 11.11.11.200
 static-mapping 10 inside-pool 1 global-pool 1 port-range 256 1279 port-size 256
#
service-location 1      
 location slot <span>1</span>
#
service-location 2      
 location slot <strong id="EN-US_TASK_0000001139936997__en-us_task_0172374612_b173934141516"><span>2</span></strong>
#
service-instance-group groupa      
 service-location 1      
 service-location 2
#
nat instance cpe1 id 11     
 service-instance-group groupa      
 nat bind static-mapping 10
#
acl number 3001
 rule 1 permit ip source 192.168.10.0 0.0.0.255
#
traffic classifier c1 operator or
 if-match acl 3001 precedence 1 
#
traffic behavior b1
 nat bind instance cpe1
#
traffic policy p1
 share-mode
 classifier c1 behavior b1 precedence 1 
#
interface GigabitEthernet <span>0/2/0</span>
 ip address 192.168.10.1 255.255.255.0
 undo shutdown
 traffic-policy p1 inbound
#
return
</pre>
</div></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_nat_cfg_0056.html">Configuration Examples for NAT
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/../../toctopics/en-us_task_0000001590438665.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_nat_cfg_0058_1.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>