
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Centralized NAT64 Inter-Chassis Hot Backup">
<meta name="abstract" content="This section provides an example for configuring HA dual-device inter-chassis hot backup for centralized NAT64.">
<meta name="description" content="This section provides an example for configuring HA dual-device inter-chassis hot backup for centralized NAT64.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cgn-reliability_cfg_0043.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cgn-reliability_cfg_0046.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="c00549182">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="CGN Reliability">
<meta name="featuretype" content="NAT and IPv6 Transition">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="CGN Reliability">
<meta name="featuretype" content="NAT and IPv6 Transition">
<meta name="featurename" content="CGN Reliability">
<meta name="featuretype" content="NAT and IPv6 Transition">
<meta name="featurename" content="CGN Reliability">
<meta name="featuretype" content="NAT and IPv6 Transition">
<meta name="featurename" content="CGN Reliability">
<meta name="featuretype" content="NAT and IPv6 Transition">
<meta name="OWNER" content="c00549182">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="c00549182">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172362478">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>Example for Configuring Centralized NAT64 Inter-Chassis Hot Backup</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172362478"></a><a name="EN-US_TASK_0172362478"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Centralized NAT64 Inter-Chassis Hot Backup</h1>
<div class="taskbody"><p>This section provides an example for configuring HA dual-device inter-chassis hot backup for centralized NAT64.</p>
<div class="context"><a name="EN-US_TASK_0172362478__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>In the centralized networking scenario shown in <a href="#EN-US_TASK_0172362478__fig_01">Figure 1</a>, a NAT service board is deployed in slot <span>1</span> on CGN1 and another NAT service board is deployed in slot <span>1</span> on CGN2. CGN1 and CGN2, between which a VRRP channel is established over GE interfaces, are deployed close to the CR on the MAN core as standalone devices. CPU0 of the NAT service board in slot <span>1</span> on CGN1 and CPU0 of the NAT service board in slot <span>1</span> on CGN2 implement NAT64 inter-chassis hot backup. VRRP enabled for the channel determines the master/backup status of the CGN devices, and the service board status is associated with VRRP.</p>
<div class="fignone" id="EN-US_TASK_0172362478__fig_01"><a name="EN-US_TASK_0172362478__fig_01"></a><a name="fig_01"></a><span class="figcap"><b>Figure 1 </b>Networking of inter-chassis hot backup in a centralized NAT64 scenario</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 and 2 in this example represent GE <span>0/1/1</span> and GE <span>0/1/2</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_ne_cgn-reliability_cfg_0039.png" width="NaN" height="NaN"></span></div>

<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" frame="border" border="1" rules="all"><caption><b>Table 1 </b>IP address plan</caption><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="25.91%" id="mcps1.4.1.4.2.4.1.1" liSelected="liSelected"><p>Device Name</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="35.55%" id="mcps1.4.1.4.2.4.1.2" liSelected="liSelected"><p>Interface Name</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="38.54%" id="mcps1.4.1.4.2.4.1.3" liSelected="liSelected"><p>IP Address and Mask</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" rowspan="2" valign="top" width="25.91%" headers="mcps1.4.1.4.2.4.1.1 "><p>CGN1</p>
</td>
<td class="cellrowborder" valign="top" width="35.55%" headers="mcps1.4.1.4.2.4.1.2 "><p>GE<span>0/1/1</span></p>
</td>
<td class="cellrowborder" valign="top" width="38.54%" headers="mcps1.4.1.4.2.4.1.3 "><p>10.1.1.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.2 "><p>GE<span>0/1/2</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>2001:db8::1:110e/126</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="2" valign="top" width="25.91%" headers="mcps1.4.1.4.2.4.1.1 "><p>CGN2</p>
</td>
<td class="cellrowborder" valign="top" width="35.55%" headers="mcps1.4.1.4.2.4.1.2 "><p>GE<span>0/1/1</span></p>
</td>
<td class="cellrowborder" valign="top" width="38.54%" headers="mcps1.4.1.4.2.4.1.3 "><p>10.1.1.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.2 "><p>GE<span>0/1/2</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>2001:db8::1:110f/126</p>
</td>
</tr>
</tbody>
</table>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172362478__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Enable NAT64 and configure NAT64 session resources.</p>
</li><li><p>Enable HA hot backup.</p>
</li><li><p>Create a service-location group, configure members for HA dual-device inter-chassis backup, and configure an inter-chassis backup channel.</p>
</li><li><p>Create and configure a VRRP group.</p>
</li><li><p>Associate HA with VRRP.</p>
</li><li><p>Bind the service-location group to the VRRP group.</p>
</li><li><p>Create a service-instance group and bind it to the service-location group.</p>
</li><li><p>Create a NAT64 instance and bind it to the service-instance group.</p>
</li><li><p>Configure a NAT64 traffic diversion policy and a NAT64 conversion policy.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172362478__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><div class="p">To complete the configuration, you need the following data:<ul><li><p>Index of the service-location group</p>
</li><li><p>Slot ID and CPU ID of the active CPU on a service board of the master and backup devices (CPU 0 in slot <span>1</span> in this example)</p>
</li><li><p>Interfaces of the inter-chassis backup channel and IP addresses of the peer devices</p>
</li><li><p>Index, virtual IP address, member priorities, and preemption delay of a VRRP group</p>
</li><li><p>Name of a service-instance group</p>
</li><li><p>Name and index of a NAT64 instance</p>
</li><li><p>Name, index, and IP address range of a NAT64 address pool</p>
</li><li><p>NAT64 IPv6 prefix of 64:FF9B::/96</p>
</li><li><p>ACL number and ACL rule</p>
</li><li><p>Traffic classifier name, traffic behavior name, and traffic diversion policy name</p>
</li></ul>
</div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172362478__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Enable NAT64 and configure NAT64 session resources.</span><p><div class="p"># Configure the master device CGN1.<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname CGN1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1]<strong> vsm on-board-mode disable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1] <strong>license</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-license] <strong>active nat64 vsuf slot <span>1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-license] <strong>active nat session-table size 16 slot <span>1</span> </strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-license] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1-license] <strong>quit</strong></pre>
</div>
<div class="p"># Configure the backup device CGN2.<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname CGN2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The configuration of the NAT64 GTL license on CGN2 is the same as that on CGN1. For detailed configurations, see <a href="#EN-US_TASK_0172362478__config_02">CGN2 configuration file</a>.</p>
</div></div>
</div>
</p></li><li><span>Enable HA hot backup in the system view of master and backup devices.</span><p><p># Enable HA hot backup on CGN1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1] <strong>service-ha hot-backup enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1] <strong>commit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The configuration of CGN2 is similar to that of CGN1. For detailed configurations, see <a href="#EN-US_TASK_0172362478__config_02">CGN2 configuration file</a>.</p>
</div></div>
</p></li><li><span>Create a service-location group, configure members for HA dual-device inter-chassis backup, and configure an inter-chassis backup channel between the master and backup devices.</span><p><p># On CGN1, create service-location group 1, configure CPU 0 in slot <span>1</span> as an HA dual-device inter-chassis backup member, and set the local VRRP outbound interface to GE <span>0/1/1</span> and the peer IP address to 10.1.1.2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1] <strong>service-location 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-service-location-1] <strong>location slot <span>1</span> </strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-service-location-1] <strong>remote-backup interface GigabitEthernet <span>0/1/1</span> peer 10.1.1.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-service-location-1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1-service-location-1] <strong>quit</strong></pre>
<p># On CGN2, create service-location group 1, configure CPU 0 in slot <span>1</span> as an HA dual-device inter-chassis backup member, and set the local VRRP outbound interface to GE <span>0/1/1</span> and the peer IP address to 10.1.1.1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN2] <strong>service-location 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN2-service-location-1] <strong>location slot <span>1</span> </strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN2-service-location-1] <strong>remote-backup interface GigabitEthernet <span>0/1/1</span> peer 10.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN2-service-location-1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN2-service-location-1] <strong>quit</strong></pre>
</p></li><li><span>Configure a VRRP group on each CGN device.</span><p><p># On CGN1, enter the view of GE <span>0/1/1</span>, create VRRP group 1, and set the VRRP virtual IP address to 10.1.1.3. Configure the VRRP group as an mVRRP group, and set CGN1's priority in the VRRP group to 200, the VRRP preemption delay to 1500s, and the VRRP recovery delay to 15s.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1] <strong>interface GigabitEthernet<span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1-GigabitEthernet<span>0/1/1</span>] <strong>vrrp vrid 1 virtual-ip 10.1.1.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-GigabitEthernet<span>0/1/1</span>] <strong>admin-vrrp vrid 1 ignore-if-down</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-GigabitEthernet<span>0/1/1</span>] <strong>vrrp vrid 1 priority 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-GigabitEthernet<span>0/1/1</span>] <strong>vrrp vrid 1 preempt-mode timer delay 1500</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-GigabitEthernet<span>0/1/1</span>] <strong>vrrp recover-delay 15</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-GigabitEthernet<span>0/1/1</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<p># On CGN2, enter the view of GE <span>0/1/1</span>, create VRRP group 1, and set the VRRP virtual IP address to 10.1.1.3. Configure the VRRP group as an mVRRP group, set CGN2's priority in the VRRP group to 150, and set the VRRP recovery delay to 15s.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN2] <strong>interface GigabitEthernet<span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN2-GigabitEthernet<span>0/1/1</span>] <strong>vrrp vrid 1 virtual-ip 10.1.1.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN2-GigabitEthernet<span>0/1/1</span>] <strong>admin-vrrp vrid 1 ignore-if-down</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN2-GigabitEthernet<span>0/1/1</span>] <strong>vrrp vrid 1 priority 150</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN2-GigabitEthernet<span>0/1/1</span>] <strong>vrrp recover-delay 15</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN2-GigabitEthernet<span>0/1/1</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN2-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
</p></li><li><span>Associate HA with VRRP on the master and backup devices.</span><p><p># On CGN1, enter the view of GE <span>0/1/1</span>, and associate service-location group 1 with VRRP group 1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1] <strong>interface GigabitEthernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1-GigabitEthernet<span>0/1/1</span>] <strong>vrrp vrid 1 track service-location 1 reduced 60</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-GigabitEthernet<span>0/1/1</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>This configuration is optional on the backup device. You can determine whether to perform this step based on network requirements.</p>
<p>The configuration of CGN2 is the same as that of CGN1. For detailed configurations, see <a href="#EN-US_TASK_0172362478__config_02">CGN2 configuration file</a>.</p>
</div></div>
</p></li><li><span>Bind the service-location group to the VRRP group on each CGN device.</span><p><p># Bind service-location group 1 to VRRP group 1 on CGN1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1] <strong>service-location 1</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1-service-location-1] <strong>vrrp vrid 1 interface GigabitEthernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-service-location-1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1-service-location-1] <strong>quit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The configuration of CGN2 is the same as that of CGN1. For detailed configurations, see <a href="#EN-US_TASK_0172362478__config_02">CGN2 configuration file</a>.</p>
</div></div>
</p></li><li><span>Create a service-instance group and bind it to the service-location group on each CGN device.</span><p><p># On CGN1, create service-instance group named <strong>group1</strong> and bind it to service-location group 1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1] <strong>service-instance-group group1</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1-service-instance-group-group1] <strong>service-location 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-service-instance-group-group1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1-service-instance-group-group1] <strong>quit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The configuration of CGN2 is the same as that of CGN1. For detailed configurations, see <a href="#EN-US_TASK_0172362478__config_02">CGN2 configuration file</a>.</p>
</div></div>
</p></li><li><span>Create a NAT64 instance on each CGN device and bind it to the service-instance group.</span><p><p># On CGN1, create a NAT64 instance named<strong> nat64</strong> and bind it to the service-instance group named <strong>group1</strong>. Configure a NAT64 IPv6 prefix of 64:FF9B::/96. This prefix must be the same as the prefix allocated by the DNS64 server.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1] <strong>nat64 instance nat64 id 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-nat64-instance-nat64] <strong>service-instance-group group1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-nat64-instance-nat64] <strong>nat64 address-group nat64-group1 group-id 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-nat64-instance-nat64-nat64-address-group-nat64-group1] <strong>section 0 11.1.1.1 mask 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-nat64-instance-nat64-nat64-address-group-nat64-group1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-nat64-instance-nat64] <strong>nat64  prefix  64:FF9B:: prefix-length 96 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-nat64-instance-nat64] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1-nat64-instance-nat64] <strong>quit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The configuration of CGN2 is the same as that of CGN1. For detailed configurations, see <a href="#EN-US_TASK_0172362478__config_02">CGN2 configuration file</a>.</p>
</div></div>
</p></li><li><span>Configure a NAT64 traffic diversion policy and a NAT64 conversion policy. For configuration details, see "Example for Configuring Centralized NAT64" in <em>NAT and IPv6 Transition&gt; NAT64 Configuration</em>.</span><p><p># Configure a NAT64 traffic diversion policy and a NAT64 conversion policy on CGN1.</p>
<ol type="a"><li><p>Configure a NAT64 traffic diversion policy.</p>
<ol class="substepthirdol"><li><div class="p">Configure an ACL-based traffic classification rule so that only hosts on internal network segment 2001:db8::1:1112/126 can access the IPv4 Internet.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1] <strong>acl ipv6 number 3001</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-acl6-adv-3001] <strong>rule 5 permit ipv6 source 2001:db8::1:1112/126 destination 64:FF9B::/96 </strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-acl6-adv-3001] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1-acl6-adv-3001] <strong>quit</strong></pre>
</div>
</li><li><div class="p">Configure a traffic classifier.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1] <strong>traffic classifier c1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-classifier-c1] <strong>if-match ipv6 acl 3001</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-classifier-c1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1-classifier-c1] <strong>quit</strong></pre>
</div>
</li><li><div class="p">Configure a traffic behavior and bind it to the NAT64 instance.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1]<strong> traffic behavior b1</strong> </pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-behavior-b1] <strong>nat64 bind instance nat64</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-behavior-b1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1-behavior-b1] <strong>quit</strong></pre>
</div>
</li><li><div class="p">Configure a traffic policy and associate the ACL-based traffic classification rule with the traffic behavior.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1] <strong>traffic policy p1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-trafficpolicy-p1] <strong>classifier c1 behavior b1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-trafficpolicy-p1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1-trafficpolicy-p1] <strong>quit</strong></pre>
</div>
</li><li><div class="p">Configure an IPv6 address in the user-side interface view.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1] <strong>interface GigabitEthernet<span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-GigabitEthernet<span>0/1/2</span>] <strong>ipv6 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-GigabitEthernet<span>0/1/2</span>] <strong>ipv6 address 2001:db8::1:110e 126</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-GigabitEthernet<span>0/1/2</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
</div>
</li><li><div class="p">Apply the NAT64 traffic diversion policy in the user-side interface view.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1] <strong>interface GigabitEthernet<span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-GigabitEthernet<span>0/1/2</span>] <strong>traffic-policy p1 inbound</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-GigabitEthernet<span>0/1/2</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
</div>
</li></ol>
</li><li><p>Configure a NAT64 conversion policy so that NAT64 is performed using addresses in the NAT64 address pool for the packets that are diverted by an interface board to a service board.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1] <strong>nat64 instance nat64 id 1</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1-nat64-instance-nat64] <strong>nat64 outbound any address-group nat64-group1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-nat64-instance-nat64] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1-nat64-instance-nat64] <strong>quit</strong></pre>
</li></ol>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The configuration of CGN2 is the same as that of CGN1. For detailed configurations, see <a href="#EN-US_TASK_0172362478__config_02">CGN2 configuration file</a>.</p>
</div></div>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172362478__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>CGN1 configuration file</p>
<pre class="screen">#
sysname CGN1
#
vsm on-board-mode disable
#
license
 active nat64 vsuf slot <span>1</span>
 active nat session-table size 16 slot <span>1</span>
#
acl ipv6 number 3001
 rule 5 permit ipv6 source 2001:db8::1:1112/126 destination 64:FF9B::/96
#
traffic classifier c1 operator or
 if-match ipv6 acl 3001 precedence 1
#
traffic behavior b1
 nat64 bind instance nat64
#
traffic policy p1
 classifier c1 behavior b1 precedence 1
#
service-ha hot-backup enable
#
service-location 1
 location slot <span>1</span> 
 vrrp vrid 1 interface GigabitEthernet <span>0/1/1</span>
 remote-backup interface GigabitEthernet <span>0/1/1</span> peer 10.1.1.2
#
service-instance-group group1
 service-location 1
#
nat64 instance nat64 id 1
 service-instance-group group1
 nat64 address-group nat64-group1 group-id 1 
  section 0 11.1.1.1 mask 24  
 #
 nat64 outbound any address-group nat64-group1
 nat64 prefix 64:FF9B:: prefix-length 96 1
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 10.1.1.1 255.255.255.0
 vrrp vrid 1 virtual-ip 10.1.1.3
 admin-vrrp vrid 1 ignore-if-down
 vrrp vrid 1 priority 200
 vrrp vrid 1 preempt-mode timer delay 1500
 vrrp vrid 1 track service-location 1 reduced 60
 vrrp recover-delay 15
#
interface GigabitEthernet <span>0/1/2</span>
 undo shutdown
 ipv6 enable
 ipv6 address 2001:db8::1:110e 126
 traffic-policy p1 inbound
#
return</pre>
</li><li><p id="EN-US_TASK_0172362478__config_02"><a name="EN-US_TASK_0172362478__config_02"></a><a name="config_02"></a>CGN2 configuration file</p>
<pre class="screen">#
sysname CGN2
#
license
 active nat64 vsuf slot <span>1</span>
 active nat session-table size 16 slot <span>1</span>
#
acl ipv6 number 3001
 rule 5 permit ipv6 source 2001:db8::1:1112/126 destination 64:FF9B::/96
#
traffic classifier c1 operator or
 if-match ipv6 acl 3001 precedence 1
#
traffic behavior b1
 nat64 bind instance nat64
#
traffic policy p1
 classifier c1 behavior b1 precedence 1
#
service-ha hot-backup enable
#
service-location 1
 location slot <span>1</span> 
 vrrp vrid 1 interface GigabitEthernet <span>0/1/1</span>
 remote-backup interface GigabitEthernet <span>0/1/1</span> peer 10.1.1.1
#
service-instance-group group1
 service-location 1
#
nat64 instance nat64 id 1
 service-instance-group group1
 nat64 address-group nat64-group1 group-id 1 
  section 0 11.1.1.1 mask 24  
 #
 nat64 outbound any address-group nat64-group1
 nat64 prefix 64:FF9B:: prefix-length 96 1
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 10.1.1.2 255.255.255.0
 vrrp vrid 1 virtual-ip 10.1.1.3
 admin-vrrp vrid 1 ignore-if-down
 vrrp vrid 1 priority 150
 vrrp vrid 1 track service-location 1 reduced 60
 vrrp recover-delay 15
#
interface GigabitEthernet <span>0/1/2</span>
 undo shutdown
 ipv6 enable
 ipv6 address 2001:db8::1:110f 126
 traffic-policy p1 inbound
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cgn-reliability_cfg_0043.html">Inter-Chassis Hot Backup
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cgn-reliability_cfg_0046.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>
</body>
</html>