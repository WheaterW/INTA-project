
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Outbound-Interface NAT Load Balancing on an Enterprise Network">
<meta name="abstract" content="This section provides an example for configuring dual outbound interfaces on NAT-Device so that external network users access an internal server through different interfaces and internal user traffic destined for the Internet is load-balanced.">
<meta name="description" content="This section provides an example for configuring dual outbound interfaces on NAT-Device so that external network users access an internal server through different interfaces and internal user traffic destined for the Internet is load-balanced.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_nat_cfg_0056.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_nat_cfg_0159.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_atn_nat_cfg_0072_a.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="c00549182">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="NAT">
<meta name="featuretype" content="NAT and IPv6 Transition">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="NAT">
<meta name="featuretype" content="NAT and IPv6 Transition">
<meta name="featurename" content="NAT">
<meta name="featuretype" content="NAT and IPv6 Transition">
<meta name="featurename" content="NAT">
<meta name="featuretype" content="NAT and IPv6 Transition">
<meta name="OWNER" content="c00549182">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="c00549182">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172374651">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring Outbound-Interface NAT Load Balancing on an Enterprise Network</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172374651"></a><a name="EN-US_TASK_0172374651"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Outbound-Interface NAT Load Balancing on an Enterprise Network</h1>
<div class="taskbody"><p>This section provides an example for configuring dual outbound interfaces on NAT-Device so that external network users access an internal server through different interfaces and internal user traffic destined for the Internet is load-balanced.</p>
<div class="context"><a name="EN-US_TASK_0172374651__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>In <a href="#EN-US_TASK_0172374651__w1">Figure 1</a>, NAT-Device functions as an enterprise network gateway and is dual-homed to the Internet through interfaces 2 and 3. NAT is configured to convert private IP addresses to public IP addresses. The enterprise network wants to provide web and FTP server access services for Internet users. The web server is assigned 192.168.4.1/16 and 192.168.5.1/16, and the FTP server is assigned 192.168.2.1/16 and 192.168.3.1/16.</p>
<div class="p"><a href="#EN-US_TASK_0172374651__w1">Figure 1</a> shows IP addresses of interfaces. The configuration requirements are as follows:<ul><li>External network users can access the web and FTP servers within the enterprise network.</li><li>Internal users and servers can access one another, without NAT conversion.</li><li>The traffic sent from the enterprise network to the Internet is load-balanced based on source IP addresses.</li></ul>
</div>
<div class="fignone" id="EN-US_TASK_0172374651__w1"><a name="EN-US_TASK_0172374651__w1"></a><a name="w1"></a><span class="figcap"><b>Figure 1 </b>Networking for configuring outbound-interface NAT load balancing on an enterprise network</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 through 3 in this example represent GE <span>0/2/0</span>, GE <span>0/2/1</span>, and GE <span>0/2/2</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_ne_nat_cfg_00730001a.png" width="NaN" height="NaN"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172374651__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li>Configure load balancing.</li><li>Configure basic NAT functions.</li><li>Configure internal servers.</li><li>Enable the NAT ALG function for the web and FTP protocols.</li><li>Configure a NAT traffic diversion policy.</li><li>Apply the NAT traffic diversion policy.</li><li>Configure default routes.</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172374651__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li>NAT instance names (nat1 and nat2) and indexes (1 and 2)</li><li>Address pool name (address-group1) and ID (1)</li><li>Private IP addresses of the FTP server and web server in NAT instance <strong>nat1</strong> (192.168.2.1 and 192.168.4.1, respectively) and in NAT instance <strong>nat2</strong> (192.168.3.1 and 192.168.5.1, respectively)</li><li>IP addresses (192.168.0.1/16, 10.11.1.1/24, and 10.11.2.1/24) of GE <span>0/2/0</span>, GE <span>0/2/1</span>, and GE <span>0/2/2</span></li><li>ACL numbers (3000 through 3005)</li><li>NAT traffic diversion policy applied to GE <span>0/2/0</span>; ACL 3000 and NAT instance <strong>nat1</strong> bound to GE <span>0/2/1</span>; ACL 3000 and NAT instance <strong>nat1</strong> bound to GE <span>0/2/2</span></li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172374651__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure basic NAT functions.</span><ol type="a"><li class="substepexpand"><span>Enable the NAT device to load-balance received packets based on source IP addresses in all slots.</span><p><pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname NAT-Device</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device] <strong>load-balance hash-key ip source-ip slot all</strong>
[<span class="keyword">*</span>NAT-Device] <strong>commit</strong></pre>
</p></li><li class="substepexpand"><span>Create NAT instances named <strong>nat1</strong> and <strong>nat2</strong>.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device] <strong>service-location 1</strong>
[<span class="keyword">*</span>NAT-Device-service-location-1] <strong>location<span> slot <span><span>3</span></span></span></strong>
[<span class="keyword">*</span>NAT-Device-service-location-1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device-service-location-1] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device] <strong>service-instance-group group1</strong>
[<span class="keyword">*</span>NAT-Device-service-instance-group-group1] <strong>service-location 1</strong>
[<span class="keyword">*</span>NAT-Device-service-instance-group-group1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device-service-instance-group-group1] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device] <strong>nat instance nat1 id 1</strong>
[<span class="keyword">*</span>NAT-Device-nat-instance-nat1] <strong>service-instance-group group1</strong>
[<span class="keyword">*</span>NAT-Device-nat-instance-nat1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device-nat-instance-nat1] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device] <strong>nat instance nat2 id 2</strong>
[<span class="keyword">*</span>NAT-Device-nat-instance-nat2] <strong>service-instance-group group1</strong>
[<span class="keyword">*</span>NAT-Device-nat-instance-nat2] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device-nat-instance-nat2] <strong>quit</strong></pre>
</p></li><li class="substepexpand"><span>Assign IP addresses to interfaces.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device] <strong>interface gigabitEthernet <span>0/2/0</span></strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device-GigabitEthernet<span>0/2/1</span>] <strong>ip address 192.168.0.1 16</strong>
[<span class="keyword">*</span>NAT-Device-GigabitEthernet<span>0/2/1</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device-GigabitEthernet<span>0/2/1</span>] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device] <strong>interface gigabitEthernet <span>0/2/1</span></strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device-GigabitEthernet<span>0/2/1</span>] <strong>ip address 10.11.1.1 24</strong>
[<span class="keyword">*</span>NAT-Device-GigabitEthernet<span>0/2/1</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device-GigabitEthernet<span>0/2/1</span>] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device] <strong>interface gigabitEthernet <span>0/2/2</span></strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device-GigabitEthernet<span>0/2/2</span>] <strong>ip address 10.11.2.1 24</strong>
[<span class="keyword">*</span>NAT-Device-GigabitEthernet<span>0/2/2</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device-GigabitEthernet<span>0/2/2</span>] <strong>quit</strong></pre>
</p></li><li class="substepexpand"><span>Configure NAT address pools.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device] <strong>nat instance nat1 id 1</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device-nat-instance-nat1] <strong>nat address-group address-group1 group-id 1 unnumbered interface GigabitEthernet <span>0/2/1</span></strong>
[<span class="keyword">*</span>NAT-Device-nat-instance-nat1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device-nat-instance-nat1] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device] <strong>nat instance nat2 id 2</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device-nat-instance-nat2] <strong>nat address-group address-group1 group-id 1 unnumbered interface GigabitEthernet <span>0/2/2</span></strong>
[<span class="keyword">*</span>NAT-Device-nat-instance-nat2] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device-nat-instance-nat2] <strong>quit</strong></pre>
</p></li></ol>
</li><li><span>Configure the mapping between the public and private IP addresses of the internal NAT server.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device] <strong>nat instance nat1 id 1</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device-nat-instance-nat1] <strong>nat server protocol tcp global unnumbered interface GigabitEthernet <span>0/2/1</span> ftp inside 192.168.2.1 ftp</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device-nat-instance-nat1] <strong>nat server protocol tcp global unnumbered interface GigabitEthernet <span>0/2/1</span> www inside 192.168.4.1 www</strong>
[<span class="keyword">*</span>NAT-Device-nat-instance-nat1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device-nat-instance-nat1] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device] <strong>nat instance nat2 id 2</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device-nat-instance-nat2] <strong>nat server protocol tcp global unnumbered interface GigabitEthernet <span>0/2/2</span> ftp inside 192.168.3.1 ftp</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device-nat-instance-nat2] <strong>nat server protocol tcp global unnumbered interface GigabitEthernet <span>0/2/2</span> www inside 192.168.5.1 www</strong>
[<span class="keyword">*</span>NAT-Device-nat-instance-nat2] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device-nat-instance-nat2] <strong>quit</strong></pre>
</p></li><li><span>Configure the NAT ALG function. Enable the NAT ALG function for FTP and DNS in each NAT instance. Configure a DNS mapping entry that contains a domain name, a public IP address, and a private IP address in each NAT instance for NAT processing that is performed after the DNS server resolves the IP address of the internal server.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device] <strong>nat instance nat1</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device-nat-instance-nat1] <strong>nat alg ftp</strong>
[<span class="keyword">*</span>NAT-Device-nat-instance-nat1] <strong>nat alg dns</strong>
[<span class="keyword">*</span>NAT-Device-nat-instance-nat1] <strong>nat dns-mapping domain www.huawei.com global-address 10.11.1.1 inside-address 192.168.4.1</strong>
[<span class="keyword">*</span>NAT-Device-nat-instance-nat1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device-nat-instance-nat1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device] <strong>nat instance nat2</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device-nat-instance-nat2] <strong>nat alg ftp</strong>
[<span class="keyword">*</span>NAT-Device-nat-instance-nat2] <strong>nat alg dns</strong>
[<span class="keyword">*</span>NAT-Device-nat-instance-nat2] <strong>nat dns-mapping domain www.huawei.com global-address 10.11.2.1 inside-address 192.168.5.1</strong>
[<span class="keyword">*</span>NAT-Device-nat-instance-nat2] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device-nat-instance-nat2] <strong>quit</strong></pre>
</p></li><li><span>Configure the redirection function by specifying a redirection next-hop IP address for private-to-public traffic in each NAT instance.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device] <strong>nat instance nat1</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device-nat-instance-nat1] <strong>redirect ip-nexthop 10.11.1.2 outbound</strong>
[<span class="keyword">*</span>NAT-Device-nat-instance-nat1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device-nat-instance-nat1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device] <strong>nat instance nat2</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device-nat-instance-nat2] <strong>redirect ip-nexthop 10.11.2.2 outbound</strong>
[<span class="keyword">*</span>NAT-Device-nat-instance-nat2] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device-nat-instance-nat2] <strong>quit</strong></pre>
</p></li><li><span>Configure a NAT traffic diversion policy.</span><ol type="a"><li class="substepexpand"><span>Configure an ACL numbered <strong>3000</strong> to allow hosts on the enterprise network to access the Internet.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device] <strong>acl 3000</strong>
[<span class="keyword">*</span>NAT-Device-acl4-advance-3000] <strong>rule 1 permit ip</strong>
[<span class="keyword">*</span>NAT-Device-acl4-advance-3000] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device-acl4-advance-3000] <strong>quit</strong></pre>
</p></li><li class="substepexpand"><span>Configure an ACL numbered <strong>3001</strong> to allow hosts on the enterprise network to access one another.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device] <strong>acl 3001</strong>
[<span class="keyword">*</span>NAT-Device-acl4-advance-3001] <strong>rule 1 permit ip source 192.168.0.0 0.0.255.255</strong>
[<span class="keyword">*</span>NAT-Device-acl4-advance-3001] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device-acl4-advance-3001] <strong>rule 1 permit ip </strong><strong>destination</strong> <strong>2.1.1.0 0.0.0.255</strong>
[<span class="keyword">*</span>NAT-Device-acl4-advance-3001] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device-acl4-advance-3001] <strong>quit</strong></pre>
</p></li><li class="substepexpand"><span>Configure an ACL numbered<strong> 3002</strong> to allow the host at 192.168.2.1/32 on the enterprise network to access the Internet.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device] <strong>acl 3002</strong>
[<span class="keyword">*</span>NAT-Device-acl4-advance-3002] <strong>rule 1 permit ip source 192.168.2.1 0.0.0.0</strong>
[<span class="keyword">*</span>NAT-Device-acl4-advance-3002] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device-acl4-advance-3002] <strong>rule 1 permit ip </strong><strong>destination</strong> <strong>2.1.1.0 0.0.0.255</strong>
[<span class="keyword">*</span>NAT-Device-acl4-advance-3002] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device-acl4-advance-3002] <strong>quit</strong></pre>
</p></li><li class="substepexpand"><span>Configure an ACL numbered <strong>3003</strong> to allow the host at 192.168.3.1/32 on the enterprise network to access the Internet.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device] <strong>acl 3003</strong>
[<span class="keyword">*</span>NAT-Device-acl4-advance-3003] <strong>rule 1 permit ip source 192.168.3.1 0.0.0.0</strong>
[<span class="keyword">*</span>NAT-Device-acl4-advance-3003] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device-acl4-advance-3003] <strong>rule 1 permit ip </strong><strong>destination</strong> <strong>2.1.1.0 0.0.0.255</strong>
[<span class="keyword">*</span>NAT-Device-acl4-advance-3003] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device-acl4-advance-3003] <strong>quit</strong></pre>
</p></li><li class="substepexpand"><span>Configure an ACL numbered <strong>3004</strong> to allow the host at 192.168.4.1/32 on the enterprise network to access the Internet.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device] <strong>acl 3004</strong>
[<span class="keyword">*</span>NAT-Device-acl4-advance-3004] <strong>rule 1 permit ip source 192.168.4.1 0.0.0.0</strong>
[<span class="keyword">*</span>NAT-Device-acl4-advance-3004] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device-acl4-advance-3004] <strong>rule 1 permit ip </strong><strong>destination</strong> <strong>2.1.1.0 0.0.0.255</strong>
[<span class="keyword">*</span>NAT-Device-acl4-advance-3004] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device-acl4-advance-3004] <strong>quit</strong></pre>
</p></li><li class="substepexpand"><span>Configure an ACL numbered <strong>3005</strong> to allow the host at 192.168.5.1/32 on the enterprise network to access the Internet.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device] <strong>acl 3005</strong>
[<span class="keyword">*</span>NAT-Device-acl4-advance-3005] <strong>rule 1 permit ip source 192.168.5.1 0.0.0.0</strong>
[<span class="keyword">*</span>NAT-Device-acl4-advance-3005] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device-acl4-advance-3005] <strong>rule 1 permit ip </strong><strong>destination</strong> <strong>2.1.1.0 0.0.0.255</strong>
[<span class="keyword">*</span>NAT-Device-acl4-advance-3005] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device-acl4-advance-3005] <strong>quit</strong></pre>
</p></li><li class="substepexpand"><span>Configure traffic classifiers for data that needs to be redirected.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device] <strong>traffic classifier redirectover1 operator or</strong>
[<span class="keyword">*</span>NAT-Device-classifier-redirectover1] <strong>if-match acl 3001</strong>
[<span class="keyword">*</span>NAT-Device-classifier-redirectover1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device-classifier-redirectover1] <strong>quit</strong></pre>
</p><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device] <strong>traffic classifier redirectover2 operator or</strong>
[<span class="keyword">*</span>NAT-Device-classifier-redirectover2] <strong>if-match acl 3002</strong>
[<span class="keyword">*</span>NAT-Device-classifier-redirectover2] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device-classifier-redirectover2] <strong>quit</strong></pre>
</p><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device] <strong>traffic classifier redirectover3 operator or</strong>
[<span class="keyword">*</span>NAT-Device-classifier-redirectover3] <strong>if-match acl 3003</strong>
[<span class="keyword">*</span>NAT-Device-classifier-redirectover3] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device-classifier-redirectover3] <strong>quit</strong></pre>
</p><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device] <strong>traffic classifier redirectover4 operator or</strong>
[<span class="keyword">*</span>NAT-Device-classifier-redirectover4] <strong>if-match acl 3004</strong>
[<span class="keyword">*</span>NAT-Device-classifier-redirectover4] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device-classifier-redirectover4] <strong>quit</strong></pre>
</p><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device] <strong>traffic classifier redirectover5 operator or</strong>
[<span class="keyword">*</span>NAT-Device-classifier-redirectover5] <strong>if-match acl 3005</strong>
[<span class="keyword">*</span>NAT-Device-classifier-redirectover5] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device-classifier-redirectover5] <strong>quit</strong></pre>
</p></li><li class="substepexpand"><span>Configure traffic behaviors for data that needs to be redirected. Set the redirection next-hop IP address to 10.11.1.2 in a traffic behavior named <strong>redirectover2</strong> and 10.11.2.2 in a traffic behavior named <strong>redirectover3</strong>.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device] <strong>traffic behavior redirectover1</strong>
[<span class="keyword">*</span>NAT-Device-behavior-redirectover1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device-behavior-redirectover1] <strong>quit</strong></pre>
</p><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device] <strong>traffic behavior redirectover2</strong>
[<span class="keyword">*</span>NAT-Device-behavior-redirectover2] <strong>redirect ip-nexthop 10.11.1.2</strong>
[<span class="keyword">*</span>NAT-Device-behavior-redirectover2] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device-behavior-redirectover2] <strong>quit</strong></pre>
</p><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device] <strong>traffic behavior redirectover3</strong>
[<span class="keyword">*</span>NAT-Device-behavior-redirectover3] <strong>redirect ip-nexthop 10.11.2.2</strong>
[<span class="keyword">*</span>NAT-Device-behavior-redirectover3] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device-behavior-redirectover3] <strong>quit</strong></pre>
</p></li><li class="substepexpand"><span>Bind the traffic classifiers with the traffic behaviors in a traffic policy.</span><p><ul><li>Data flows exchanged by users on the network segment of 192.168.0.0/16 within the enterprise network are assigned a priority value of 1 (higher) and are not processed by NAT.</li><li>Data flows with the source IP address 192.168.2.1/32 pass through outbound interface 2 and are assigned a priority value of 2.</li><li>Data flows with the source IP address 192.168.3.1/32 pass through outbound interface 3 and are assigned a priority value of 3.</li><li>Data flows with the source IP address 192.168.4.1/32 pass through outbound interface 2 and are assigned a priority value of 4.</li><li>Data flows with the source IP address 192.168.5.1/32 pass through outbound interface 3 and are assigned a priority value of 5.</li></ul>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device] <strong>traffic policy redirect</strong>
[<span class="keyword">*</span>NAT-Device-trafficpolicy-redirect] <strong>classifier redirectover1 behavior redirectover1 precedence 1</strong>
[<span class="keyword">*</span>NAT-Device-trafficpolicy-redirect] <strong>classifier redirectover2 behavior redirectover2 precedence 2</strong>
[<span class="keyword">*</span>NAT-Device-trafficpolicy-redirect] <strong>classifier redirectover3 behavior redirectover3 precedence 3</strong>
[<span class="keyword">*</span>NAT-Device-trafficpolicy-redirect] <strong>classifier redirectover4 behavior redirectover2 precedence 4</strong>
[<span class="keyword">*</span>NAT-Device-trafficpolicy-redirect] <strong>classifier redirectover5 behavior redirectover3 precedence 5</strong>
[<span class="keyword">*</span>NAT-Device-trafficpolicy-redirect] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device-trafficpolicy-redirect] <strong>quit</strong></pre>
</p></li></ol>
</li><li><span>Apply the traffic classification policy to interfaces.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device] <strong>interface gigabitEthernet <span>0/2/0</span></strong>
[<span class="keyword">*</span>NAT-Device-GigabitEthernet<span>0/2/0</span>] <strong>traffic-policy redirect inbound</strong>
[<span class="keyword">*</span>NAT-Device-GigabitEthernet<span>0/2/0</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device] <strong>interface gigabitEthernet <span>0/2/1</span></strong>
[<span class="keyword">*</span>NAT-Device-GigabitEthernet<span>0/2/1</span>] <strong>nat bind acl 3000 instance nat1</strong>
[<span class="keyword">*</span>NAT-Device-GigabitEthernet<span>0/2/1</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device-GigabitEthernet<span>0/2/1</span>] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device] <strong>interface gigabitEthernet <span>0/2/2</span></strong>
[<span class="keyword">*</span>NAT-Device-GigabitEthernet<span>0/2/2</span>] <strong>nat bind acl 3000 instance nat2</strong>
[<span class="keyword">*</span>NAT-Device-GigabitEthernet<span>0/2/2</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device-GigabitEthernet<span>0/2/2</span>] <strong>quit</strong></pre>
</p></li><li><span>Configure default routes.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device] <strong>ip route-static 0.0.0.0 0.0.0.0 10.11.1.2</strong>
[<span class="keyword">*</span>NAT-Device] <strong>ip route-static 0.0.0.0 0.0.0.0 10.11.2.2</strong>
[<span class="keyword">*</span>NAT-Device] <strong>commit</strong></pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172374651__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><pre class="screen"># 
sysname NAT-Device 
# 
load-balance hash-key ip source-ip slot all
#
<span>service-location 1</span>
<span> <span>location<span> slot <span><span>3</span></span></span> </span> </span>
<span># </span>
<span>service-instance-group group1 </span>
<span> service-location 1 </span>
<span>#</span>
nat instance nat1 id 1
 service-instance-group group1
 nat address-group address-group1 group-id 1 unnumbered interface GigabitEthernet <span>0/2/1</span>
 nat server protocol tcp global unnumbered interface GigabitEthernet <span>0/2/1</span> ftp inside 192.168.2.1 ftp
 nat server protocol tcp global unnumbered interface GigabitEthernet <span>0/2/1</span> www inside 192.168.4.1 www
 nat alg ftp
 nat alg dns
 redirect ip-nexthop 10.11.1.2 outbound
 nat dns-mapping domain www.huawei.com global-address 10.11.1.1 inside-address 192.168.4.1
# 
nat instance nat2 id 2
 service-instance-group group1
 nat address-group address-group1 group-id 1 unnumbered interface GigabitEthernet <span>0/2/2</span>
 nat server protocol tcp global unnumbered interface GigabitEthernet <span>0/2/2</span> ftp inside 192.168.3.1 ftp
 nat server protocol tcp global unnumbered interface GigabitEthernet <span>0/2/2</span> www inside 192.168.5.1 www
 nat alg ftp
 nat alg dns
 redirect ip-nexthop 10.11.2.2 outbound
 nat dns-mapping domain www.huawei.com global-address 10.11.2.1 inside-address 192.168.5.1
#
acl number 3000                            
 rule 1 permit ip                                                              
#
acl number 3001
 rule 1 permit ip source 192.168.0.0 0.0.255.255 
<strong> </strong>rule 1 permit ip destination 2.1.1.0 0.0.0.255
#
acl number 3002 
 rule 1 permit ip source 192.168.2.1 0.0.0.0
 rule 1 permit ip destination 2.1.1.0 0.0.0.255
# 
acl number 3003 
 rule 1 permit ip source 192.168.3.1 0.0.0.0  
 rule 1 permit ip destination 2.1.1.0 0.0.0.255
#
acl number 3004   
 rule 1 permit ip source 192.168.4.1 0.0.0.0
 rule 1 permit ip destination 2.1.1.0 0.0.0.255
#
acl number 3005
 rule 1 permit ip source 192.168.5.1 0.0.0.0
 rule 1 permit ip destination 2.1.1.0 0.0.0.255
#
traffic classifier redirectover1 operator or 
 if-match acl 3001 precedence 1    
# 
traffic classifier redirectover2 operator or 
 if-match acl 3002 precedence 1 
# 
traffic classifier redirectover3 operator or 
 if-match acl 3003 precedence 1  
#  
traffic classifier redirectover4 operator or  
 if-match acl 3004 precedence 1   
#
traffic classifier redirectover5 operator or  
 if-match acl 3005 precedence 1   
#             
traffic behavior redirectover1  
#                     
traffic behavior redirectover2  
 redirect ip-nexthop 10.11.1.2  
#
traffic behavior redirectover3  
 redirect ip-nexthop 10.11.2.2  
#        
traffic policy redirect  
 classifier redirectover1 behavior redirectover1 precedence 1 
 classifier redirectover2 behavior redirectover2 precedence 2
 classifier redirectover3 behavior redirectover3 precedence 3  
 classifier redirectover4 behavior redirectover2 precedence 4 
 classifier redirectover5 behavior redirectover3 precedence 5 
#
interface GigabitEthernet <span>0/2/0</span> 
 undo shutdown 
 ip address 192.168.0.1 255.255.0.0
 traffic-policy redirect inbound 
#
interface GigabitEthernet <span>0/2/1</span> 
 undo shutdown 
 ip address 10.11.1.1 255.255.255.0
 nat bind acl 3000 instance nat1 
#
interface GigabitEthernet <span>0/2/2</span> 
 undo shutdown 
 ip address 10.11.2.1 255.255.255.0 
 nat bind acl 3000 instance nat2 
# 
ip route-static 0.0.0.0 0.0.0.0 10.11.1.2 
ip route-static 0.0.0.0 0.0.0.0 10.11.2.2 
#  
return</pre>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_nat_cfg_0056.html">Configuration Examples for NAT
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_nat_cfg_0159.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_atn_nat_cfg_0072_a.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>