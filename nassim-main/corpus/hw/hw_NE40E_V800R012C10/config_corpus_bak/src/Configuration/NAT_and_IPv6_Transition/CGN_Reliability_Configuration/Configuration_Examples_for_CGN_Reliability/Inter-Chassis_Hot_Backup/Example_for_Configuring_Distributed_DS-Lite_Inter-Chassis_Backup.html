
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Distributed DS-Lite Inter-Chassis Backup">
<meta name="abstract" content="This section provides an example for configuring inter-chassis backup for DS-Lite services in distributed deployment scenarios.">
<meta name="description" content="This section provides an example for configuring inter-chassis backup for DS-Lite services in distributed deployment scenarios.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cgn-reliability_cfg_0043.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cgn-reliability_cfg_0038.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cgn-reliability_cfg_0039.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="c00549182">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="CGN Reliability">
<meta name="featuretype" content="NAT and IPv6 Transition">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="CGN Reliability">
<meta name="featuretype" content="NAT and IPv6 Transition">
<meta name="featurename" content="CGN Reliability">
<meta name="featuretype" content="NAT and IPv6 Transition">
<meta name="featurename" content="CGN Reliability">
<meta name="featuretype" content="NAT and IPv6 Transition">
<meta name="featurename" content="CGN Reliability">
<meta name="featuretype" content="NAT and IPv6 Transition">
<meta name="OWNER" content="c00549182">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="c00549182">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001177668526">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>Example for Configuring Distributed DS-Lite Inter-Chassis Backup</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001177668526"></a><a name="EN-US_TASK_0000001177668526"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Distributed DS-Lite Inter-Chassis Backup</h1>
<div class="taskbody"><p>This section provides an example for configuring inter-chassis backup for DS-Lite services in distributed deployment scenarios.</p>
<div class="context"><a name="EN-US_TASK_0000001177668526__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>In distributed deployment, a CGN board is installed on BRAS1 and BRAS2. The two BRASs use GE interfaces to establish a VRRP channel. To implement inter-chassis HA backup for DS-Lite services, configure VRRP to determine the master/backup CGN status, and associate HA with VRRP. As shown in <a href="#EN-US_TASK_0000001177668526__fig_dc_ne_cgn-reliability_cfg_003801">Figure 1</a>, home users using private IPv4 addresses access an IPv6 MAN through the CPE that supports dual stack and DS-Lite. A DS-Lite tunnel is established between the CPE and DS-Lite device. The CPE transmits traffic with the private IPv4 address along the DS-Lite tunnel to the DS-Lite device. The DS-Lite device decapsulates traffic, uses NAT to translate the private IPv4 address to a public IPv4 address, and forwards the traffic to the IPv4 Internet.</p>
<div class="fignone" id="EN-US_TASK_0000001177668526__fig_dc_ne_cgn-reliability_cfg_003801"><a name="EN-US_TASK_0000001177668526__fig_dc_ne_cgn-reliability_cfg_003801"></a><a name="fig_dc_ne_cgn-reliability_cfg_003801"></a><span class="figcap"><b>Figure 1 </b>Inter-chassis backup networking</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interface1, interface2, and interface3 in this example represent GE<span>0/1/1</span>, GE<span>0/1/2</span>, and GE<span>0/1/3</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0000001177509978.png"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001177668526__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure a license.</p>
</li><li><p>Enable HA inter-chassis hot backup.</p>
</li><li><p>Create an HA backup group, add members to the group, and configure a VRRP channel.</p>
</li><li>Create and configure a VRRP group.</li><li><p>Associate HA with VRRP.</p>
</li><li><p>Bind the HA backup group to the VRRP group.</p>
</li><li><p>Create a service-instance group and bind it to the HA backup group.</p>
</li><li><p>Create a DS-Lite instance, bind the DS-Lite instance to the service-instance group, and configure an address pool.</p>
</li><li>Configure DS-Lite user information and RADIUS authentication on the BRAS.</li><li>Configure a traffic diversion policy for the DS-Lite tunnel.</li><li>Configure a DS-Lite conversion policy.</li><li>Configure user-side VRRP.</li><li>Configure a remote backup service (RBS) and a remote backup profile (RBP), and bind the service-instance group to the RBS.</li><li>Configure a user-side interface.</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001177668526__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>

<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" frame="border" border="1" rules="all"><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="11.87%" id="mcps1.4.3.3.1.3.1.1" liSelected="liSelected"><p>No.</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="88.13%" id="mcps1.4.3.3.1.3.1.2" liSelected="liSelected"><p>Data</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" valign="top" width="11.87%" headers="mcps1.4.3.3.1.3.1.1 "><p>1</p>
</td>
<td class="cellrowborder" valign="top" width="88.13%" headers="mcps1.4.3.3.1.3.1.2 "><p>ID of the HA backup group</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="11.87%" headers="mcps1.4.3.3.1.3.1.1 "><p>2</p>
</td>
<td class="cellrowborder" valign="top" width="88.13%" headers="mcps1.4.3.3.1.3.1.2 "><p>Slot ID and CPU ID of BRAS1's active service board (CPU 0 in slot <span>1</span>)</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="11.87%" headers="mcps1.4.3.3.1.3.1.1 "><p>3</p>
</td>
<td class="cellrowborder" valign="top" width="88.13%" headers="mcps1.4.3.3.1.3.1.2 "><p>Slot ID and CPU ID of BRAS2's standby service board (CPU 0 in slot <span>2</span>)</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="11.87%" headers="mcps1.4.3.3.1.3.1.1 "><p>4</p>
</td>
<td class="cellrowborder" valign="top" width="88.13%" headers="mcps1.4.3.3.1.3.1.2 "><p>VRRP channel's interface and its IP address on the master and backup devices</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="11.87%" headers="mcps1.4.3.3.1.3.1.1 "><p>5</p>
</td>
<td class="cellrowborder" valign="top" width="88.13%" headers="mcps1.4.3.3.1.3.1.2 "><p>Index, virtual IP address, member priority, and preemption delay of the VRRP group on the master and backup devices</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="11.87%" headers="mcps1.4.3.3.1.3.1.1 "><p>6</p>
</td>
<td class="cellrowborder" valign="top" width="88.13%" headers="mcps1.4.3.3.1.3.1.2 "><p>Name of the service-instance group</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="11.87%" headers="mcps1.4.3.3.1.3.1.1 "><p>7</p>
</td>
<td class="cellrowborder" valign="top" width="88.13%" headers="mcps1.4.3.3.1.3.1.2 "><p>Name and index of the DS-Lite instance</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="11.87%" headers="mcps1.4.3.3.1.3.1.1 "><p>8</p>
</td>
<td class="cellrowborder" valign="top" width="88.13%" headers="mcps1.4.3.3.1.3.1.2 "><p>DS-Lite user group name</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="11.87%" headers="mcps1.4.3.3.1.3.1.1 "><p>9</p>
</td>
<td class="cellrowborder" valign="top" width="88.13%" headers="mcps1.4.3.3.1.3.1.2 "><p>Index, virtual IP address, member priority, and preemption delay of the VRRP group on the user side</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="11.87%" headers="mcps1.4.3.3.1.3.1.1 "><p>10</p>
</td>
<td class="cellrowborder" valign="top" width="88.13%" headers="mcps1.4.3.3.1.3.1.2 "><p>RBS name</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="11.87%" headers="mcps1.4.3.3.1.3.1.1 "><p>11</p>
</td>
<td class="cellrowborder" valign="top" width="88.13%" headers="mcps1.4.3.3.1.3.1.2 "><p>RBP name</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="11.87%" headers="mcps1.4.3.3.1.3.1.1 "><p>12</p>
</td>
<td class="cellrowborder" valign="top" width="88.13%" headers="mcps1.4.3.3.1.3.1.2 "><p>User-side interface</p>
</td>
</tr>
</tbody>
</table>
</div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001177668526__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure a license.</span><p><p># Configure BRAS1.</p>
<pre class="screen">&lt;HUAWEI&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>HUAWEI] <strong>sysname BRAS1</strong>
[<span class="keyword">*</span>HUAWEI] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>vsm on-board-mode disable</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>vsm on-board-mode disable</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>license</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-license]<strong> active ds-lite vsuf slot <span>2</span></strong>
[<span class="keyword">*</span>BRAS1-license]<strong> </strong><strong>active nat session-table size 16 slot <span>2</span> </strong>
[<span class="keyword">*</span>BRAS1-license]<strong> </strong><strong>active nat bandwidth-enhance 40 slot <span>2</span></strong>
[<span class="keyword">*</span>BRAS1-license]<strong> </strong><strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-license]<strong> </strong><strong>quit</strong></pre>
<p># Configure BRAS2.</p>
<pre class="screen">&lt;HUAWEI&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>HUAWEI] <strong>sysname BRAS2</strong>
[<span class="keyword">*</span>HUAWEI] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>vsm on-board-mode disable</strong>
[<span class="keyword">*</span>BRAS2] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2] <strong>license</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-license]<strong> active ds-lite vsuf slot <span>2</span></strong>
[<span class="keyword">*</span>BRAS2-license]<strong> </strong><strong>active nat session-table size 16 slot <span>2</span> </strong>
[<span class="keyword">*</span>BRAS2-license]<strong> </strong><strong>active nat bandwidth-enhance 40 slot <span>2</span></strong>
[<span class="keyword">*</span>BRAS2-license]<strong> </strong><strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-license]<strong> </strong><strong>quit</strong></pre>
</p></li><li><span>Enable HA hot backup on the master and backup devices.</span><p><p># Configure BRAS1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1]<strong> </strong><strong>service-ha hot-backup enable</strong>
[<span class="keyword">*</span>BRAS1]<strong> </strong><strong>commit</strong></pre>
<p># Configure BRAS2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2]<strong> </strong><strong>service-ha hot-backup enable</strong>
[<span class="keyword">*</span>BRAS2]<strong> </strong><strong>commit</strong></pre>
</p></li><li><span>Create an HA backup group on the two devices, add members to the group, and configure a VRRP channel.</span><p><div class="note" id="EN-US_TASK_0000001177668526__en-us_task_0172362454_note111357234319"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0000001177668526__en-us_task_0172362454_p2135823431">Service-location IDs and the number of service-location groups configured on the master and backup devices must be the same. Otherwise, backup may fail, affecting services.</p>
</div></div>
</p><p><p># Create HA backup group 21 on BRAS1, add CPU 0 in slot <span>1</span> to the group, and set the local VRRP outbound interface to GE <span>0/1/3</span> and the peer IP address to 10.0.0.2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>service-location 21</strong>
[<span class="keyword">*</span>BRAS1-service-location-21] <strong>location slot <span>1</span> </strong>
[<span class="keyword">*</span>BRAS1-service-location-21] <strong>remote-backup interface GigabitEthernet <span>0/1/3</span> peer 10.0.0.2</strong>
[<span class="keyword">*</span>BRAS1-service-location-21] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
<p># Create HA backup group 21 on BRAS2, add CPU 0 in slot <span>2</span> to the group, and set the local VRRP outbound interface to GE <span>0/1/3</span> and the peer IP address to 10.0.0.1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2] <strong>service-location 21</strong>
[<span class="keyword">*</span>BRAS2-service-location-21] <strong>location slot <span>2</span> </strong>
[<span class="keyword">*</span>BRAS2-service-location-21] <strong>remote-backup interface GigabitEthernet <span>0/1/3</span> peer 10.0.0.1</strong>
[<span class="keyword">*</span>BRAS2-service-location-21] <strong>quit</strong>
[<span class="keyword">*</span>BRAS2] <strong>commit</strong></pre>
</p></li><li><span>Create and configure a VRRP group on the two devices.</span><p><p># On BRAS1, enter the GE<span>0/1/3</span> interface view, create VRRP group 10, and set the virtual IP address of the VRRP group to 10.0.0.3. Configure the VRRP group as an mVRRP group and enable the VRRP group to ignore an interface Down event. Set BRAS1's priority in the VRRP group to 150 and the VRRP preemption delay to 1500s. Configure VRRP to track GE<span>0/1/2</span>. If GE<span>0/1/2</span> goes down, the priority of the device in VRRP group 10 decreases by 50.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>interface GigabitEthernet <span>0/1/3</span></strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-GigabitEthernet<span>0/1/3</span>] <strong>ip address 10.0.0.1 255.255.255.0</strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/3</span>] <strong>vrrp vrid 10 virtual-ip 10.0.0.3</strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/3</span>] <strong>admin-vrrp vrid 10 ignore-if-down</strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/3</span>] <strong>vrrp vrid 10 priority 150</strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/3</span>] <strong>vrrp vrid 10 preempt-mode timer delay 1500</strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/3</span>] <strong>vrrp recover-delay 20</strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/3</span>] <strong>vrrp vrid 10 track interface GigabitEthernet <span>0/1/2</span> reduced 50</strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/3</span>] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
<p># On BRAS2, enter the GE<span>0/1/3</span> interface view, create VRRP group 10, and set the virtual IP address of the VRRP group to 10.0.0.3. Configure the VRRP group as an mVRRP group and enable the VRRP group to ignore an interface Down event. Set BRAS2's priority in the VRRP group to 120.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2] <strong>interface GigabitEthernet <span>0/1/3</span></strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-GigabitEthernet<span>0/1/3</span>] <strong>ip address 10.0.0.2 255.255.255.0</strong>
[<span class="keyword">*</span>BRAS2-GigabitEthernet<span>0/1/3</span>] <strong>vrrp vrid 10 virtual-ip 10.0.0.3</strong>
[<span class="keyword">*</span>BRAS2-GigabitEthernet<span>0/1/3</span>] <strong>admin-vrrp vrid 10 ignore-if-down</strong>
[<span class="keyword">*</span>BRAS2-GigabitEthernet<span>0/1/3</span>] <strong>vrrp vrid 10 priority 120</strong>
[<span class="keyword">*</span>BRAS2-GigabitEthernet<span>0/1/3</span>] <strong>quit</strong>
[<span class="keyword">*</span>BRAS2] <strong>commit</strong></pre>
</p></li><li><span>Associate HA with VRRP on the two devices.</span><p><p># On BRAS1, enter the GE<span>0/1/3</span> interface view and associate HA backup group 21 with VRRP group 10.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>interface GigabitEthernet <span>0/1/3</span></strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-GigabitEthernet<span>0/1/3</span>] <strong>vrrp vrid 10 track service-location 21 reduced 50</strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/3</span>] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
<p># On BRAS2, enter the GE<span>0/1/3</span> interface view and associate HA backup group 21 with VRRP group 10.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2] <strong>interface GigabitEthernet <span>0/1/3</span></strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-GigabitEthernet<span>0/1/3</span>] <strong>vrrp vrid 10 track service-location 21 reduced 50</strong>
[<span class="keyword">*</span>BRAS2-GigabitEthernet<span>0/1/3</span>] <strong>quit</strong>
[<span class="keyword">*</span>BRAS2] <strong>commit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Run the <a href="cmdqueryname=display+vrrp+10"><b><span class="cmdname">display vrrp 10</span></b></a> command on the two BRAS devices to check the master/backup VRRP status, which reflects the master/backup status of the HA backup group. <strong>Master</strong> in the command output indicates that the BRAS is the master device.</p>
</div></div>
</p></li><li><span>Bind the HA backup group to the VRRP group on the two devices.</span><p><p># On BRAS1, bind HA backup group 21 to VRRP group 10 and specify the interface for establishing a VRRP channel with the peer device as GE<span>0/1/3</span>.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>service-location 21</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-service-location-21] <strong>vrrp vrid 10 interface GigabitEthernet <span>0/1/3</span></strong>
[<span class="keyword">*</span>BRAS1-service-location-21] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
<p># On BRAS2, bind HA backup group 21 to VRRP group 10, and specify the interface for establishing a VRRP channel with the peer device as GE<span>0/1/3</span>.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2] <strong>service-location 21</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-service-location-21] <strong>vrrp vrid 10 interface GigabitEthernet <span>0/1/3</span></strong>
[<span class="keyword">*</span>BRAS2-service-location-21] <strong>quit</strong>
[<span class="keyword">*</span>BRAS2] <strong>commit</strong></pre>
</p></li><li><span>Create a service-instance group on the two devices and bind it to the HA backup group.</span><p><p># On BRAS1, create service-instance group 21 and bind it to HA backup group 21.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>service-instance-group 21</strong>
[<span class="keyword">*</span>BRAS1-service-instance-group-21] <strong>service-location 21</strong>
[<span class="keyword">*</span>BRAS1-service-instance-group-21] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
<p># On BRAS2, create service-instance group 21 and bind it to HA backup group 21.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2] <strong>service-instance-group 21</strong>
[<span class="keyword">*</span>BRAS2-service-instance-group-21] <strong>service-location 21</strong>
[<span class="keyword">*</span>BRAS2-service-instance-group-21] <strong>quit</strong>
[<span class="keyword">*</span>BRAS2] <strong>commit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Run the <a href="cmdqueryname=display+service-location+21"><b><span class="cmdname">display service-location 21</span></b></a> command on the two BRAS devices to check HA information. <strong>Vrrp state</strong> in the command output reflects the status of HA backup group 21, which must be consistent with the VRRP status. <strong>Batch-backup state</strong> in the command output indicates whether batch backup has completed.</p>
</div></div>
</p></li><li><span>Create a DS-Lite instance on the two devices, bind the instance to the service-instance group, and configure an address pool.</span><p><p># Create a DS-Lite instance named <strong>dslite1</strong> on BRAS1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1]<strong> ds-lite instance dslite1 id 21</strong>
[<span class="keyword">*</span>BRAS1-ds-lite-instance-dslite1] <strong>port-range 4096</strong>
[<span class="keyword">*</span>BRAS1-ds-lite-instance-dslite1] <strong>service-instance-group 21</strong>
[<span class="keyword">*</span>BRAS1-ds-lite-instance-dslite1] <strong>ds-lite address-group group1 group-id 1 11.11.11.100 11.11.11.110</strong>
[<span class="keyword">*</span>BRAS1-ds-lite-instance-dslite1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-ds-lite-instance-dslite1] <strong>local-ipv6 2001:db8:2::12 prefix-length 128</strong>
[<span class="keyword">*</span>BRAS1-ds-lite-instance-dslite1] <strong>remote-ipv6 2001:db8:1:: prefix-length 41</strong>
[<span class="keyword">*</span>BRAS1-ds-lite-instance-dslite1] <strong>ds-lite alg all</strong>
[<span class="keyword">*</span>BRAS1-ds-lite-instance-dslite1] <strong>ds-lite filter mode full-cone</strong>
[<span class="keyword">*</span>BRAS1-ds-lite-instance-dslite1] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
<p># Create a DS-Lite instance named <strong>dslite1</strong> on BRAS2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2] <strong>ds-lite instance dslite1 id 21</strong>
[<span class="keyword">*</span>BRAS2-ds-lite-instance-dslite1] <strong>port-range 4096</strong>
[<span class="keyword">*</span>BRAS2-ds-lite-instance-dslite1] <strong>service-instance-group 21</strong>
[<span class="keyword">*</span>BRAS2-ds-lite-instance-dslite1] <strong>ds-lite address-group group1 group-id 1 11.11.11.100 11.11.11.110</strong>
[<span class="keyword">*</span>BRAS2-ds-lite-instance-dslite1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-ds-lite-instance-dslite1] <strong>local-ipv6 2001:db8:2::12 prefix-length 128</strong>
[<span class="keyword">*</span>BRAS2-ds-lite-instance-dslite1] <strong>remote-ipv6 2001:db8:1:: prefix-length 41</strong>
[<span class="keyword">*</span>BRAS2-ds-lite-instance-dslite1] <strong>ds-lite alg all</strong>
[<span class="keyword">*</span>BRAS2-ds-lite-instance-dslite1] <strong>ds-lite filter mode full-cone</strong>
[<span class="keyword">*</span>BRAS2-ds-lite-instance-dslite1] <strong>quit</strong>
[<span class="keyword">*</span>BRAS2] <strong>commit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>For details about how to configure basic DS-Lite services, see "DS-Lite Configuration".</p>
</div></div>
</p></li><li><span>Configure DS-Lite user information.</span><ol type="a"><li class="substepexpand"><span>Configure the BRAS service on the devices so that users can go online. For detailed configurations, see "User Access" in <em><span class="keyword">HUAWEI NE40E-M2 series</span> <span class="keyword">Universal Service Router</span> Configuration Guide</em>.</span></li><li class="substepexpand"><span>Configure a user group.</span><p><p># Configure BRAS1.</p>
</p><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1]<strong> user-group group1</strong>
[<span class="keyword">*</span>BRAS1]<strong> </strong><strong>commit</strong></pre>
</p><p><p># Configure BRAS2.</p>
</p><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2] <strong>user-group group2</strong>
[<span class="keyword">*</span>BRAS2]<strong> </strong><strong>commit</strong></pre>
</p></li><li class="substepexpand"><span>Specify the RADIUS server and the domain to which the user belongs.</span><p><p># Configure BRAS1.</p>
</p><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1]<strong> radius-server group rd1</strong>
[<span class="keyword">*</span>BRAS1-radius-rd1] <strong>radius-server authentication 192.168.7.249 1645 weight 0</strong>
[<span class="keyword">*</span>BRAS1-radius-rd1] <strong>radius-server accounting 192.168.7.249 1646 weight 0</strong>
[<span class="keyword">*</span>BRAS1-radius-rd1] <strong>radius-server shared-key YsHsjx_202206</strong>
[<span class="keyword">*</span>BRAS1-radius-rd1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-radius-rd1]<strong> radius-server type plus11</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-radius-rd1]<strong> radius-server traffic-unit kbyte</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-radius-rd1] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1]<strong> aaa</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa] <strong>authentication-scheme auth1</strong>
[<span class="keyword">*</span>BRAS1-aaa-authen-auth1] <strong>authentication-mode radius</strong>
[<span class="keyword">*</span>BRAS1-aaa-authen-auth1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa-authen-auth1] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa] <strong>accounting-scheme acct1</strong>
[<span class="keyword">*</span>BRAS1-aaa-accounting-acct1] <strong>accounting-mode radius</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa-accounting-acct1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa-accounting-acct1] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa]<strong> </strong><strong>domain dslite1</strong>
[<span class="keyword">*</span>BRAS1-aaa-domain-dslite1] <strong>authentication-scheme auth1</strong>
[<span class="keyword">*</span>BRAS1-aaa-domain-dslite1] <strong>accounting-scheme acct1</strong>
[<span class="keyword">*</span>BRAS1-aaa-domain-dslite1] <strong>radius-server group rd1</strong>
[<span class="keyword">*</span>BRAS1-aaa-domain-dslite1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa-domain-dslite1]<strong> </strong><strong>user-group group1 bind ds-lite instance dslite1</strong>
[<span class="keyword">*</span>BRAS1-aaa-domain-dslite1]<strong> commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa-domain-dslite1]<strong> quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa]<strong> quit</strong></pre>
<p># Configure BRAS2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2]<strong> radius-server group rd1</strong>
[<span class="keyword">*</span>BRAS2-radius-rd1] <strong>radius-server authentication 192.168.7.249 1645 weight 0</strong>
[<span class="keyword">*</span>BRAS2-radius-rd1] <strong>radius-server accounting 192.168.7.249 1646 weight 0</strong>
[<span class="keyword">*</span>BRAS2-radius-rd1] <strong>radius-server shared-key YsHsjx_202206</strong>
[<span class="keyword">*</span>BRAS2-radius-rd1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-radius-rd1]<strong> radius-server type plus11</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-radius-rd1]<strong> radius-server traffic-unit kbyte</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-radius-rd1] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2]<strong> aaa</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-aaa] <strong>authentication-scheme auth1</strong>
[<span class="keyword">*</span>BRAS2-aaa-authen-auth1] <strong>authentication-mode radius</strong>
[<span class="keyword">*</span>BRAS2-aaa-authen-auth1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-aaa-authen-auth1] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-aaa] <strong>accounting-scheme acct1</strong>
[<span class="keyword">*</span>BRAS2-aaa-accounting-acct1] <strong>accounting-mode radius</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-aaa-accounting-acct1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-aaa-accounting-acct1] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-aaa]<strong> </strong><strong>domain dslite1</strong>
[<span class="keyword">*</span>BRAS2-aaa-domain-dslite1] <strong>authentication-scheme auth1</strong>
[<span class="keyword">*</span>BRAS2-aaa-domain-dslite1] <strong>accounting-scheme acct1</strong>
[<span class="keyword">*</span>BRAS2-aaa-domain-dslite1] <strong>radius-server group rd1</strong>
[<span class="keyword">*</span>BRAS2-aaa-domain-dslite1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-aaa-domain-dslite1]<strong> </strong><strong>user-group group1 bind ds-lite instance dslite1</strong>
[<span class="keyword">*</span>BRAS2-aaa-domain-dslite1]<strong> commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-aaa-domain-dslite1]<strong> quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-aaa]<strong> quit</strong></pre>
</p></li></ol>
</li><li><span>Configure a traffic diversion policy for the DS-Lite tunnel.</span><p><p># Configure BRAS1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1]<strong> </strong><strong>acl ipv6 6001</strong>
[<span class="keyword">*</span>BRAS1-acl6-ucl-6001]<strong> </strong><strong>rule 1 permit ipv6 source user-group group1</strong>
[<span class="keyword">*</span>BRAS1-acl6-ucl-6001]<strong> </strong><strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-acl6-ucl-6001]<strong> quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1]<strong> traffic classifier c1</strong>
[<span class="keyword">*</span>BRAS1-classifier-c1]<strong> </strong><strong>if-match ipv6 acl 6001</strong>
[<span class="keyword">*</span>BRAS1-classifier-c1]<strong> commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-classifier-c1] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1]<strong> traffic behavior b1</strong>
[<span class="keyword">*</span>BRAS1-behavior-b1] <strong>ds-lite bind instance dslite1</strong>
[<span class="keyword">*</span>BRAS1-behavior-b1]<strong> commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-behavior-b1]<strong> quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1]<strong> traffic policy p1</strong>
[<span class="keyword">*</span>BRAS1-trafficpolicy-p1] <strong>classifier c1 behavior b1</strong>
[<span class="keyword">*</span>BRAS1-trafficpolicy-p1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-trafficpolicy-p1]<strong> quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>traffic-policy p1 inbound</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
<p># Configure BRAS2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2]<strong> </strong><strong>acl ipv6 6001</strong>
[<span class="keyword">*</span>BRAS2-acl6-ucl-6001]<strong> </strong><strong>rule 1 permit ipv6 source user-group group1</strong>
[<span class="keyword">*</span>BRAS2-acl6-ucl-6001]<strong> </strong><strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-acl6-ucl-6001]<strong> quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2]<strong> traffic classifier c1</strong>
[<span class="keyword">*</span>BRAS2-classifier-c1]<strong> </strong><strong>if-match ipv6 acl 6001</strong>
[<span class="keyword">*</span>BRAS2-classifier-c1]<strong> commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-classifier-c1] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2]<strong> traffic behavior b1</strong>
[<span class="keyword">*</span>BRAS2-behavior-b1] <strong>ds-lite bind instance dslite1</strong>
[<span class="keyword">*</span>BRAS2-behavior-b1]<strong> commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-behavior-b1]<strong> quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2]<strong> traffic policy p1</strong>
[<span class="keyword">*</span>BRAS2-trafficpolicy-p1] <strong>classifier c1 behavior b1</strong>
[<span class="keyword">*</span>BRAS2-trafficpolicy-p1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-trafficpolicy-p1]<strong> quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2] <strong>traffic-policy p1 inbound</strong>
[<span class="keyword">*</span>BRAS2] <strong>commit</strong></pre>
</p></li><li><span>Configure a DS-Lite conversion policy.</span><p><p># Configure BRAS1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1]<strong> </strong><strong>acl ipv6 3000</strong>
[<span class="keyword">*</span>BRAS1-acl6-adv-3000]<strong> </strong><strong>rule 1 permit ipv6 source 2001:db8:1:: 41</strong>
[<span class="keyword">*</span>BRAS1-acl6-adv-3000]<strong> </strong><strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-acl6-ucl-6001]<strong> quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1]<strong> </strong><strong>ds-lite instance dslite1</strong>
[<span class="keyword">*</span>BRAS1-ds-lite-instance-dslite1]<strong> </strong><strong>ds-lite outbound 3000 address-group group1</strong>
[<span class="keyword">*</span>BRAS1-ds-lite-instance-dslite1]<strong> commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-ds-lite-instance-dslite1] <strong>quit</strong></pre>
<p># Configure BRAS2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2]<strong> </strong><strong>acl ipv6 3000</strong>
[<span class="keyword">*</span>BRAS2-acl6-adv-3000]<strong> </strong><strong>rule 1 permit ipv6 source 2001:db8:1:: 41</strong>
[<span class="keyword">*</span>BRAS2-acl6-adv-3000]<strong> </strong><strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-acl6-ucl-6001]<strong> quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2]<strong> </strong><strong>ds-lite instance dslite1</strong>
[<span class="keyword">*</span>BRAS2-ds-lite-instance-dslite1]<strong> </strong><strong>ds-lite outbound 3000 address-group group1</strong>
[<span class="keyword">*</span>BRAS2-ds-lite-instance-dslite1]<strong> commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-ds-lite-instance-dslite1] <strong>quit</strong></pre>
</p></li><li><span>Configure a user-side VRRP group on the master and backup devices and configure the VRRP group to track service-location.</span><p><p># Configure BRAS1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>bfd</strong>
[<span class="keyword">*</span>BRAS1-bfd] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1]<strong> bfd ma bind peer-ip 192.168.1.1</strong>
[<span class="keyword">*</span>BRAS1-bfd-session-ma] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>interface GigabitEthernet<span>0/1/1</span>.2</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-GigabitEthernet<span>0/1/1</span>.2] <strong>vlan-type dot1q 101</strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/1</span>.2] <strong>ip address 192.168.1.2 255.255.0.0</strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/1</span>.2]<strong> vrrp vrid 2 virtual-ip 192.168.1.10</strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/1</span>.2] <strong>admin-vrrp vrid 2</strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/1</span>.2] <strong>vrrp vrid 2 priority 150</strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/1</span>.2] <strong>vrrp vrid 2 preempt-mode timer delay 1500</strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/1</span>.2]<strong> vrrp vrid 2 track interface </strong><strong>GigabitEthernet <span>0/1/2</span></strong><strong> reduced 50</strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/1</span>.2] <strong>vrrp vrid 2 track service-location 21 reduced 50</strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/1</span>.2] <strong>vrrp vrid 2 track bfd-session session-name ma</strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/1</span>.2] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-GigabitEthernet<span>0/1/1</span>.2] <strong>quit</strong></pre>
<p># Configure BRAS2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2] <strong>bfd</strong>
[<span class="keyword">*</span>BRAS2-bfd] <strong>quit</strong>
[<span class="keyword">*</span>BRAS2]<strong> bfd ma bind peer-ip 192.168.1.2</strong>
[<span class="keyword">*</span>BRAS2-bfd-session-ma] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2] <strong>interface GigabitEthernet<span>0/1/1</span>.2</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-GigabitEthernet<span>0/1/1</span>.2] <strong>vlan-type dot1q 101</strong>
[<span class="keyword">*</span>BRAS2-GigabitEthernet<span>0/1/1</span>.2] <strong>ip address 192.168.1.1 255.255.0.0</strong>
[<span class="keyword">*</span>BRAS2-GigabitEthernet<span>0/1/1</span>.2]<strong> vrrp vrid 2 virtual-ip 192.168.1.10</strong>
[<span class="keyword">*</span>BRAS2-GigabitEthernet<span>0/1/1</span>.2] <strong>admin-vrrp vrid 2</strong>
[<span class="keyword">*</span>BRAS2-GigabitEthernet<span>0/1/1</span>.2] <strong>vrrp vrid 2 priority 150</strong>
[<span class="keyword">*</span>BRAS2-GigabitEthernet<span>0/1/1</span>.2] <strong>vrrp vrid 2 preempt-mode timer delay 1500</strong>
[<span class="keyword">*</span>BRAS2-GigabitEthernet<span>0/1/1</span>.2]<strong> vrrp vrid 2 track interface </strong><strong>GigabitEthernet <span>0/1/2</span></strong><strong> reduced 50</strong>
[<span class="keyword">*</span>BRAS2-GigabitEthernet<span>0/1/1</span>.2] <strong>vrrp vrid 2 track service-location 21 reduced 50</strong>
[<span class="keyword">*</span>BRAS2-GigabitEthernet<span>0/1/1</span>.2] <strong>vrrp vrid 2 track bfd-session session-name ma</strong>
[<span class="keyword">*</span>BRAS2-GigabitEthernet<span>0/1/1</span>.2] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-GigabitEthernet<span>0/1/1</span>.2] <strong>quit</strong></pre>
</p></li><li><span>Configure RUI, including an RBS and an RBP, on the master and backup devices.</span><p><p># Configure BRAS1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>remote-backup-service cgn</strong>
[<span class="keyword">*</span>BRAS1-rm-backup-srv-cgn] <strong>peer 10.0.0.2 source 10.0.0.1 port 7000</strong>
[<span class="keyword">*</span>BRAS1-rm-backup-srv-cgn]<strong> protect redirect ip-nexthop 10.0.0.2 interface GigabitEthernet<span>0/1/3</span></strong>
[<span class="keyword">*</span>BRAS1-rm-backup-srv-cgn]<strong> ipv6-pool group1</strong>
[<span class="keyword">*</span>BRAS1-rm-backup-srv-cgn]<strong> commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-rm-backup-srv-cgn]<strong> quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1]<strong> remote-backup-profile cgn</strong>
[<span class="keyword">*</span>BRAS1-rm-backup-prf-cgn] <strong>service-type bras</strong>
[<span class="keyword">*</span>BRAS1-rm-backup-prf-cgn]<strong> backup-id 10 remote-backup-service cgn</strong>
[<span class="keyword">*</span>BRAS1-rm-backup-prf-cgn]<strong> peer-backup hot</strong>
[<span class="keyword">*</span>BRAS1-rm-backup-prf-cgn]<strong> vrrp-id 2 interface GigabitEthernet<span>0/1/1</span>.2</strong>
[<span class="keyword">*</span>BRAS1-rm-backup-prf-cgn]<strong> commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-rm-backup-prf-cgn] <strong>quit</strong></pre>
<p># Configure BRAS2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2]<strong> remote-backup-service cgn</strong>
[<span class="keyword">*</span>BRAS2-rm-backup-srv-cgn]<strong> peer 10.0.0.1 source 10.0.0.2 port 7000</strong>
[<span class="keyword">*</span>BRAS2-rm-backup-srv-cgn] <strong>protect redirect ip-nexthop 10.0.0.1 interface GigabitEthernet<span>0/1/3</span></strong>
[<span class="keyword">*</span>BRAS2-rm-backup-srv-cgn] <strong>ipv6-pool group1</strong>
[<span class="keyword">*</span>BRAS2-rm-backup-srv-cgn]<strong> commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-rm-backup-srv-cgn]<strong> quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2]<strong> remote-backup-profile cgn</strong>
[<span class="keyword">*</span>BRAS2-rm-backup-prf-cgn]<strong> service-type bras</strong>
[<span class="keyword">*</span>BRAS2-rm-backup-prf-cgn] <strong>backup-id 10 remote-backup-service cgn</strong>
[<span class="keyword">*</span>BRAS2-rm-backup-prf-cgn] <strong>peer-backup hot</strong>
[<span class="keyword">*</span>BRAS2-rm-backup-prf-cgn]<strong> vrrp-id 2 interface GigabitEthernet<span>0/1/1</span>.2</strong>
[<span class="keyword">*</span>BRAS2-rm-backup-prf-cgn]<strong> commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-rm-backup-prf-cgn]<strong> quit</strong></pre>
</p></li><li><span>Bind the service-instance group to the RBS.</span><p><p># Configure BRAS1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1]<strong> service-instance-group 21</strong>
[<span class="keyword">*</span>BRAS1-service-instance-group-group1]<strong> remote-backup-service cgn</strong>
[<span class="keyword">*</span>BRAS1-service-instance-group-group1]<strong> commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-service-instance-group-group1] <strong>quit</strong></pre>
<p># Configure BRAS2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2]<strong> service-instance-group 21</strong>
[<span class="keyword">*</span>BRAS2-service-instance-group-group1]<strong> remote-backup-service cgn</strong>
[<span class="keyword">*</span>BRAS2-service-instance-group-group1]<strong> commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-service-instance-group-group1] <strong>quit</strong></pre>
</p></li><li><span>Configure a user-side interface.</span><p><p># Configure BRAS1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>interface GigabitEthernet</strong><strong><span>0/1/1</span></strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-GigabitEthernet<span>0/1/1</span>] <strong>ipv6 enable</strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/1</span>] <strong>ipv6 address auto link-local</strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/1</span>] <strong>remote-backup-profile cgn</strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/1</span>]<strong> commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-GigabitEthernet<span>0/1/1</span>]<strong> bas</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-GigabitEthernet<span>0/1/1</span>-bas]<strong> access-type layer2-subscriber default-domain authentication dslite1</strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/1</span>-bas] <strong>authentication-method-ipv6 bind</strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/1</span>-bas]<strong> commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-GigabitEthernet<span>0/1/1</span>-bas] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<p># Configure BRAS2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2] <strong>interface GigabitEthernet</strong><strong><span>0/1/1</span></strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-GigabitEthernet<span>0/1/1</span>] <strong>ipv6 enable</strong>
[<span class="keyword">*</span>BRAS2-GigabitEthernet<span>0/1/1</span>] <strong>ipv6 address auto link-local</strong>
[<span class="keyword">*</span>BRAS2-GigabitEthernet<span>0/1/1</span>] <strong>remote-backup-profile cgn</strong>
[<span class="keyword">*</span>BRAS2-GigabitEthernet<span>0/1/1</span>]<strong> commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-GigabitEthernet<span>0/1/1</span>]<strong> bas</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-GigabitEthernet<span>0/1/1</span>-bas]<strong> access-type layer2-subscriber default-domain authentication dslite1</strong>
[<span class="keyword">*</span>BRAS2-GigabitEthernet<span>0/1/1</span>-bas] <strong>authentication-method-ipv6 bind</strong>
[<span class="keyword">*</span>BRAS2-GigabitEthernet<span>0/1/1</span>-bas]<strong> commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-GigabitEthernet<span>0/1/1</span>-bas] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001177668526__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><p>BRAS1 configuration file</p>
<pre class="screen">#
sysname BRAS1
#
vsm on-board-mode disable
#
license
 active nat session-table size 16 slot <span>2</span> 
 active ds-lite vsuf slot <span>2</span>
 active nat bandwidth-enhance 40 slot <span>2</span>
 active bas slot <span>2</span>
#
radius-server group rd1
 radius-server authentication 192.168.7.249 1645 weight 0
 radius-server accounting 192.168.7.249 1646 weight 0
 radius-server shared-key %^%#x*CgITP4C<font style="font-size:8pt" Face="Courier New" >~</font>;q,*+DEW'JBWe#)"Q&amp;|7bX]b:Y&lt;{w'%^%#
 radius-server type plus11
 radius-server traffic-unit kbyte
#
service-ha hot-backup enable
#
service-location 21
 location slot <span>1</span> 
 remote-backup interface GigabitEthernet<span>0/1/3</span> peer 10.0.0.2
 vrrp vrid 10 interface GigabitEthernet<span>0/1/3</span>
#
service-instance-group 21
 service-location 21
 remote-backup-service cgn
#
ds-lite instance dslite1 id 21
 port-range 4096
 service-instance-group 21
 ds-lite address-group group1 group-id 1 11.11.11.100 11.11.11.110 
 ds-lite outbound 3000 address-group group1
 local-ipv6 2001:db8:2::12 prefix-length 128
 remote-ipv6 2001:db8:1:: prefix-length 41
 ds-lite alg all
 ds-lite filter mode full-cone
#
bfd
#
ipv6 prefix group1 delegation
 prefix 2001:db8:1::/32
#
ipv6 pool group1 bas delegation
 prefix group1
#
user-group group1
#
remote-backup-service cgn
 peer 10.0.0.2 source 10.0.0.1 port 7000
 protect redirect ip-nexthop 10.0.0.2 interface GigabitEthernet<span>0/1/3</span>
 ipv6-pool group1 
#
remote-backup-profile cgn
 service-type bras
 backup-id 10 remote-backup-service cgn
 peer-backup hot
 vrrp-id 2 interface GigabitEthernet<span>0/1/1</span>.2
#
acl ipv6 number 3000
 rule 1 permit ipv6 source 2001:db8:1:: 41
#
acl ipv6 number 6001
 rule 1 permit ipv6 source user-group group1
#
dhcpv6 duid llt
#
traffic classifier c1 operator or
 if-match ipv6 acl 6001 precedence 1
#
traffic behavior b1
 ds-lite bind instance dslite1
#
traffic policy p1
 share-mode
 classifier c1 behavior b1 precedence 1
#
aaa
 authentication-scheme auth1
  authentication-mode radius
 accounting-scheme acct1
  accounting-mode radius
 domain dslite1
  authentication-scheme auth1
  accounting-scheme acct1
  radius-server group rd1
  prefix-assign-mode unshared
  ipv6-pool group1
  ppp address-release separate
  user-group group1 bind ds-lite instance dslite1
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ipv6 enable
 ipv6 address auto link-local
 undo dcn
 ipv6 nd autoconfig managed-address-flag
 remote-backup-profile cgn
 bas
 #
  access-type layer2-subscriber default-domain authentication dslite1
  authentication-method-ipv6 bind
 #
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ip address 10.4.1.1 255.255.0.0
#
interface GigabitEthernet<span>0/1/3</span>
 undo shutdown
 ip address 10.0.0.1 255.255.255.0
 vrrp vrid 10 virtual-ip 10.0.0.3
 admin-vrrp vrid 10 ignore-if-down
 vrrp vrid 10 priority 150
 vrrp vrid 10 preempt-mode timer delay 1500
 vrrp recover-delay 20
 vrrp vrid 10 track interface GigabitEthernet<span>0/1/2</span> reduced 50
 vrrp vrid 10 track service-location 21 reduced 50
#
interface GigabitEthernet<span>0/1/1</span>.2
 vlan-type dot1q 101
 ip address 192.168.1.2 255.255.0.0
 vrrp vrid 2 virtual-ip 192.168.1.10
 admin-vrrp vrid 2
 vrrp vrid 2 priority 150
 vrrp vrid 2 preempt-mode timer delay 1500
 vrrp vrid 2 track interface GigabitEthernet<span>0/1/2</span> reduced 50
 vrrp vrid 2 track bfd-session session-name ma
 vrrp vrid 2 track service-location 21 reduced 50
#
bfd ma bind peer-ip 192.168.1.1
#
ospf 10
 import-route unr
 opaque-capability enable
 area 0.0.0.0
  network 10.0.0.0 0.0.255.255
  network 10.4.1.0 0.0.255.255
#
traffic-policy p1 inbound
#
return</pre>
<p>BRAS2 configuration file</p>
<pre class="screen">#
sysname BRAS2
#
vsm on-board-mode disable
#
license
 active nat session-table size 16 slot <span>2</span> 
 active ds-lite vsuf slot <span>2</span>
 active nat bandwidth-enhance 40 slot <span>2</span>
 active bas slot <span>2</span>
#
radius-server group rd1
 radius-server authentication 192.168.7.249 1645 weight 0
 radius-server accounting 192.168.7.249 1646 weight 0
 radius-server shared-key %^%#x*CgITP4C<font style="font-size:8pt" Face="Courier New" >~</font>;q,*+DEW'JBWe#)"Q&amp;|7bX]b:Y&lt;{w'%^%#
 radius-server type plus11
 radius-server traffic-unit kbyte
#
service-ha hot-backup enable
#
service-location 21
 location slot <span>2</span> 
 remote-backup interface GigabitEthernet<span>0/1/3</span> peer 10.0.0.1
 vrrp vrid 10 interface GigabitEthernet<span>0/1/3</span>
#
service-instance-group 21
 service-location 21
<strong> </strong>remote-backup-service cgn
#
ds-lite instance dslite1 id 21
 port-range 4096
 service-instance-group 21
 ds-lite address-group group1 group-id 1 11.11.11.100 11.11.11.110 
 ds-lite outbound 3000 address-group group1
 local-ipv6 2001:db8:2::12 prefix-length 128
 remote-ipv6 2001:db8:1:: prefix-length 41
 ds-lite alg all
 ds-lite filter mode full-cone
#
bfd
#
ipv6 prefix group1 delegation
 prefix 2001:db8:1::/32
#
ipv6 pool group1 bas delegation
 prefix group1
#
user-group group2
#
remote-backup-service cgn
 peer 10.0.0.1 source 10.0.0.2 port 7000
 protect redirect ip-nexthop 10.0.0.1 interface GigabitEthernet<span>0/1/3</span>
 ipv6-pool group1 
#
remote-backup-profile cgn
 service-type bras
 backup-id 10 remote-backup-service cgn
 peer-backup hot
 vrrp-id 2 interface GigabitEthernet<span>0/1/1</span>.2
#
acl ipv6 number 3000
 rule 1 permit ipv6 source 2001:db8:1:: 41
#
acl ipv6 number 6001
 rule 1 permit ipv6 source user-group group2
#
dhcpv6 duid llt
#
traffic classifier c1 operator or
 if-match ipv6 acl 6001 precedence 1
#
traffic behavior b1
 ds-lite bind instance dslite1
#
traffic policy p1
 share-mode
 classifier c1 behavior b1 precedence 1
#
aaa
 authentication-scheme auth1
  authentication-mode radius
 accounting-scheme acct1
  accounting-mode radius
 domain dslite1
  authentication-scheme auth1
  accounting-scheme acct1
  radius-server group rd1
  prefix-assign-mode unshared
  ipv6-pool group1
  ppp address-release separate
  user-group group2 bind ds-lite instance dslite1
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ipv6 enable
 ipv6 address auto link-local
 undo dcn
 ipv6 nd autoconfig managed-address-flag
 remote-backup-profile cgn
 bas
 #
  access-type layer2-subscriber default-domain authentication dslite1
  authentication-method-ipv6 bind
 #
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ip address 10.5.1.1 255.255.0.0
#
interface GigabitEthernet<span>0/1/3</span>
 undo shutdown
 ip address 10.0.0.2 255.255.255.0
 vrrp vrid 10 virtual-ip 10.0.0.3
 admin-vrrp vrid 10
 vrrp vrid 10 priority 120
 vrrp vrid 10 track interface GigabitEthernet<span>0/1/2</span> reduced 50
 vrrp vrid 10 track service-location 21 reduced 50
#
interface GigabitEthernet<span>0/1/1</span>.2
 vlan-type dot1q 101
 ip address 192.168.1.1 255.255.0.0
 vrrp vrid 2 virtual-ip 192.168.1.10
 admin-vrrp vrid 2
 admin-vrrp vrid 10 ignore-if-down
 vrrp vrid 2 priority 150
 vrrp vrid 2 track interface GigabitEthernet<span>0/1/2</span> reduced 50
 vrrp vrid 2 track bfd-session session-name ma
 vrrp vrid 2 track service-location 21 reduced 50
#
bfd ma bind peer-ip 192.168.1.2
#
ospf 10
 import-route unr
 opaque-capability enable
 area 0.0.0.0
  network 10.0.0.0 0.0.255.255
  network 10.5.1.0 0.0.255.255
#
traffic-policy p1 inbound
#
return</pre>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cgn-reliability_cfg_0043.html">Inter-Chassis Hot Backup
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cgn-reliability_cfg_0038.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cgn-reliability_cfg_0039.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>