
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring a NAT Blacklist and Limiting the Rate at Which Packets Are Sent to Create Sessions">
<meta name="abstract" content="The NAT blacklist and session creation rate limit are used to prevent users from occupying a large number of CPU resources through traffic attacks, which affects the forwarding of common traffic.">
<meta name="description" content="The NAT blacklist and session creation rate limit are used to prevent users from occupying a large number of CPU resources through traffic attacks, which affects the forwarding of common traffic.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_nat_cfg_0038.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_nat_cfg_0043.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_nat_cfg_0045.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="c00549182">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="NAT">
<meta name="featuretype" content="NAT and IPv6 Transition">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="NAT">
<meta name="featuretype" content="NAT and IPv6 Transition">
<meta name="featurename" content="NAT">
<meta name="featuretype" content="NAT and IPv6 Transition">
<meta name="featurename" content="NAT">
<meta name="featuretype" content="NAT and IPv6 Transition">
<meta name="OWNER" content="c00549182">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="c00549182">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172374565">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring a NAT Blacklist and Limiting the Rate at Which Packets Are Sent to Create Sessions</title>
</head>
<body><a name="EN-US_TASK_0172374565"></a><a name="EN-US_TASK_0172374565"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring a NAT Blacklist and Limiting the Rate at Which Packets Are Sent to Create Sessions</h1>
<div class="taskbody"><p>The NAT blacklist and session creation rate limit are used to prevent users from occupying a large number of CPU resources through traffic attacks, which affects the forwarding of common traffic.</p>
<div class="context"><a name="EN-US_TASK_0172374565__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>The NAT blacklist function defends a device against attacks initiated by sending network-side first packets with a specified set of a public IP address, a port number, and a protocol ID or to all IP addresses. If no internal server is configured or if public network traffic does not match sessions on a NAT device, the NAT device considers traffic transmitting at a rate reaching a specified threshold as attack traffic. The NAT device then adds the IP address and UDP or TCP destination port number of the attack traffic to a NAT blacklist. Once network-side attack traffic matches the blacklist, the NAT device drops the traffic and collects statistics about the traffic.</p>
<div class="p">The NAT blacklist-based detection is performed in either of the following modes:<ul><li>Address-level detection: An address-level rate threshold is set for a NAT device to detect attacks only on IP addresses.</li><li>Port-level detection: A port-level rate threshold is set for a NAT device to detect attacks using packets with a specified IP address, a specified port number, and a specified protocol ID.</li></ul>
</div>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In VS mode, this configuration process is supported only by the admin-VS.</p>
</div></div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172374565__1.4.2"></a><a name="1.4.2"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Run <span><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span></span><p><p>The system view is displayed.</p>
</p></li><li><span>Run <span><a href="cmdqueryname=undo+nat+flow-defend+reverse-blacklist+disable"><b><span class="cmdname">undo nat flow-defend reverse-blacklist disable</span></b></a></span></span><p><p>The NAT blacklist function is enabled.</p>
</p></li><li><span>Run <a href="cmdqueryname=nat+flow-defend"><b><span class="cmdname">nat flow-defend</span></b></a> { <strong><span>forward</span></strong> | <strong><span>fragment</span></strong> | <strong><span>reverse</span></strong> } <strong><span>rate</span></strong> <i><span class="varname">rate-number</span></i> <strong><span>slot</span></strong> <i><span class="varname">slot-id</span></i>  </span><p><p>The limit on the rate at which packets are sent to create sessions on a service board is set.</p>
</p></li><li><span>(Optional) Run <span><a href="cmdqueryname=nat+flow-defend+reverse-blacklist+detect-threshold+ip-port-level+high-threshold"><b><span class="cmdname">nat flow-defend reverse-blacklist detect-threshold ip-port-level high-threshold</span></b></a></span> <i><span class="varname">ip-port-level-high-threshold-value</span></i></span><p><p>A port-level rate threshold for the NAT blacklist is configured for a device. Threshold-crossing traffic is blacklisted.</p>
</p><p><p>If the NAT blacklist function is enabled, after this command is run, the device detects the attack traffic for the IP address, port number, and protocol number. You can set the port-level rate threshold for the NAT blacklist to adjust the attack traffic detection rate.</p>
</p></li><li><span>(Optional) Run <span><a href="cmdqueryname=nat+flow-defend+reverse-blacklist+detect-threshold+ip-level+high-threshold"><b><span class="cmdname">nat flow-defend reverse-blacklist detect-threshold ip-level high-threshold</span></b></a></span> <i><span class="varname">ip-level-high-threshold-value</span></i></span><p><p>An address-level rate threshold for the NAT blacklist is configured for a device. Threshold-crossing traffic is blacklisted.</p>
</p><p><p>If the NAT blacklist function is enabled, after this command is run, the device detects the attack traffic for the IP address. You can set the address-level rate threshold for the NAT blacklist to adjust the attack traffic detection rate.</p>
<p>The port- and address-level rate thresholds can be configured together for the NAT blacklist. The two commands are independent of each other.</p>
</p></li><li><span>Run <a href="cmdqueryname=nat+flow-defend+reverse-blacklist+auto-lock+enable"><b><span class="cmdname">nat flow-defend reverse-blacklist auto-lock enable</span></b></a></span><p><p>Automatic locking of the NAT blacklist is enabled.</p>
</p><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Only the <span class="keyword">NE40E</span><span class="keyword">-M2K</span> and <span class="keyword">NE40E</span><span class="keyword">-M2K-B</span> support this configuration.</p>
</div></div>
<p>If NAT attack traffic reaches a specified detection threshold, entries are generated in a NAT blacklist. The NAT device automatically isolates IP addresses listed in the blacklist. Users with such IP addresses are logged out, and the IP addresses are not assigned to new users who want to get online.</p>
</p></li><li><span>Run <a href="cmdqueryname=nat+flow-defend+reverse-blacklist+manual-lock+lock-ip-address"><b><span class="cmdname">nat flow-defend reverse-blacklist manual-lock lock-ip-address</span></b></a> <i><span class="varname">lockip-address</span></i> [ <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i> ]</span><p><p>An IP address to be locked and a VPN instance are configured for NAT attack defense.</p>
</p><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Only the <span class="keyword">NE40E</span><span class="keyword">-M2K</span> and <span class="keyword">NE40E</span><span class="keyword">-M2K-B</span> support this configuration.</p>
</div></div>
<div class="p">After this command is run, the specified IP address is isolated, and a blackhole route is generated for the IP address. All traffic sent to the IP address is discarded on the involved interface board. In addition, all users using this IP address go offline, and new users cannot use this IP address to go online. To delete the manually locked IP address and VPN instance information in the NAT blacklist, run the <a href="cmdqueryname=reset+nat+flow-defend+reverse-blacklist+manual-lock+lock-ip-address"><b><span class="cmdname">reset nat flow-defend reverse-blacklist manual-lock lock-ip-address</span></b></a> command.<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><ul><li>The automatic lock function of NAT blacklists can be configured only on <a href="dc_ne_nat_feature_0008.html#EN-US_CONCEPT_0172359138__li1033371595">dedicated boards</a>.</li><li>IP address locking and VPN instance information for NAT attack defense can be configured only on <a href="dc_ne_nat_feature_0008.html#EN-US_CONCEPT_0172359138__li1033371595">dedicated boards</a>.</li><li>The automatic lock function of NAT blacklists and the manual IP address lock function of NAT attack defense cannot take effect at the same time.</li><li>For on-board NAT, only alarms are generated after the NAT blacklist function is enabled.</li></ul>
<p></p>
</div></div>
</div>
</p></li><li><span>Run <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span></span><p><p>The configuration is committed.</p>
</p></li></ol></div>
<div class="postreq"><a name="EN-US_TASK_0172374565__1.4.3"></a><a name="1.4.3"></a><h4 class="sectiontitle">Verifying the Configuration</h4><div class="p">After completing the configurations, you can run the following commands to check the configurations.<ul><li><p>Run the <a href="cmdqueryname=display+nat+flow-defend+reverse-blacklist"><b><span class="cmdname">display nat flow-defend reverse-blacklist</span></b></a> command to check information about blacklist entries of the reverse first packets on the CPU.</p>
</li><li><p>Run the <a href="cmdqueryname=display+nat+flow-defend+reverse-blacklist+lock-ip-address"><b><span class="cmdname">display nat flow-defend reverse-blacklist lock-ip-address</span></b></a> command to check information about manually or automatically locked IP addresses in NAT attack defense.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Only the <span class="keyword">NE40E</span><span class="keyword">-M2K</span> and <span class="keyword">NE40E</span><span class="keyword">-M2K-B</span> support this configuration.</p>
</div></div>
</li></ul>
</div>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_nat_cfg_0038.html">Configuring NAT Security
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_nat_cfg_0043.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_nat_cfg_0045.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>