
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring an Internal NAT Server in Easy IP Mode">
<meta name="abstract" content="This section provides an example for configuring bidirectional NAT and using easy IP to create an internal server so that traffic of public network users and the public network server can be forwarded through NAT-Device.">
<meta name="description" content="This section provides an example for configuring bidirectional NAT and using easy IP to create an internal server so that traffic of public network users and the public network server can be forwarded through NAT-Device.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_nat_cfg_0056.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_atn_nat_cfg_0071_1.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_nat_cfg_0111.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="c00549182">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="NAT">
<meta name="featuretype" content="NAT and IPv6 Transition">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="NAT">
<meta name="featuretype" content="NAT and IPv6 Transition">
<meta name="featurename" content="NAT">
<meta name="featuretype" content="NAT and IPv6 Transition">
<meta name="featurename" content="NAT">
<meta name="featuretype" content="NAT and IPv6 Transition">
<meta name="OWNER" content="c00549182">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="c00549182">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172374648">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring an Internal NAT Server in Easy IP Mode</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172374648"></a><a name="EN-US_TASK_0172374648"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring an Internal NAT Server in Easy IP Mode</h1>
<div class="taskbody"><p>This section provides an example for configuring bidirectional NAT and using easy IP to create an internal server so that traffic of public network users and the public network server can be forwarded through NAT-Device.</p>
<div class="context"><a name="EN-US_TASK_0172374648__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>In <a href="#EN-US_TASK_0172374648__w1">Figure 1</a>, an enterprise deploys an FTP server on the Internet, and NAT-Device functions as the gateway of the enterprise network. To secure traffic transmission, the enterprise wants that traffic exchanged between public network users and the FTP server is forwarded by NAT-Device and that public network users and the FTP server are not aware of IP addresses of one another.</p>
<div class="fignone" id="EN-US_TASK_0172374648__w1"><a name="EN-US_TASK_0172374648__w1"></a><a name="w1"></a><span class="figcap"><b>Figure 1 </b>Networking for configuring bidirectional NAT and using easy IP to create an internal server</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 and 2 in this example represent GE <span>0/2/1</span> and GE <span>0/2/2</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_ne_nat_cfg_00750001.png"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172374648__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><ol><li>Configure basic NAT functions.</li><li>Configure an internal server.</li><li>Enable the FTP ALG function.</li><li>Configure a NAT diversion policy.</li><li>Apply the NAT diversion policy.</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172374648__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><ul><li>NAT instance names (<strong>nat1</strong> and <strong>nat2</strong>) and indexes (1 and 2)</li><li>NAT-Device's address pool names (address-group1 and address-group2) and address pool numbers (1 and 2), and Easy IP address range</li><li>ACL number (3001)</li><li>Names (GE <span>0/2/1</span> and GE <span>0/2/2</span>) and IP addresses (1.1.1.1/24 and 2.1.1.1/24) of interfaces that apply a NAT diversion policy</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172374648__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure basic NAT functions.</span><ol type="a"><li class="substepexpand"><span>Create NAT instances named <strong>nat1</strong> and <strong>nat2</strong>.</span></li><li class="substepexpand"><span>Assign IP addresses to interfaces.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device] <strong>interface gigabitEthernet <span>0/2/1</span></strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device-GigabitEthernet<span>0/2/1</span>] <strong>ip address 1.1.1.1 24</strong>
[<span class="keyword">*</span>NAT-Device-GigabitEthernet<span>0/2/1</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device-GigabitEthernet<span>0/2/1</span>] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device] <strong>interface gigabitEthernet <span>0/2/2</span></strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device-GigabitEthernet<span>0/2/2</span>] <strong>ip address 2.1.1.1 24</strong>
[<span class="keyword">*</span>NAT-Device-GigabitEthernet<span>0/2/2</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device-GigabitEthernet<span>0/2/2</span>] <strong>quit</strong></pre>
</p></li><li class="substepexpand"><span>Configure a NAT address pool in Easy IP mode.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device] <strong>nat instance nat1 id 1</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device-nat-instance-nat1] <strong>nat address-group address-group1 group-id 1 unnumbered interface GigabitEthernet<span>0/2/1</span></strong>
[<span class="keyword">*</span>NAT-Device-nat-instance-nat1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device-nat-instance-nat1] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device] <strong>nat instance nat2 id 2</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device-nat-instance-nat2] <strong>nat address-group address-group2 group-id 2 unnumbered interface GigabitEthernet<span>0/2/2</span></strong>
[<span class="keyword">*</span>NAT-Device-nat-instance-nat2] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device-nat-instance-nat2] <strong>quit</strong></pre>
</p></li></ol>
</li><li><span>Configure an internal server.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device] <strong>nat instance nat1 id 1</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device-nat-instance-nat1] <strong>nat server protocol tcp global unnumbered interface GigabitEthernet<span>0/2/1</span> ftp inside 2.1.1.2 ftp</strong>
[<span class="keyword">*</span>NAT-Device-nat-instance-nat1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device-nat-instance-nat1] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device] <strong>nat instance nat2 id 2</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device-nat-instance-nat2] <strong>nat server protocol tcp global unnumbered interface GigabitEthernet<span>0/2/2</span> ftp inside 1.1.1.2 ftp</strong>
[<span class="keyword">*</span>NAT-Device-nat-instance-nat2] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device-nat-instance-nat2] <strong>quit</strong></pre>
</p></li><li><span>Enable the FTP ALG function.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device] <strong>nat instance nat1</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device-nat-instance-nat1] <strong>nat alg ftp</strong>  
[<span class="keyword">*</span>NAT-Device-nat-instance-nat1] <strong>commit</strong> 
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device-nat-instance-nat1] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device] <strong>nat instance nat2</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device-nat-instance-nat2] <strong>nat alg ftp</strong>  
[<span class="keyword">*</span>NAT-Device-nat-instance-nat2] <strong>commit</strong> 
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device-nat-instance-nat2] <strong>quit</strong></pre>
</p></li><li><span>Configure a NAT diversion policy. Configure an ACL numbered 3001, an ACL rule numbered 1, and an ACL-based traffic classification rule to allow hosts to access the Internet.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device] <strong>acl 3001</strong>
[<span class="keyword">*</span>NAT-Device-acl4-advance-3001] <strong>rule 1 permit ip source any</strong>
[<span class="keyword">*</span>NAT-Device-acl4-advance-3001] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device-acl4-advance-3001] <strong>quit</strong></pre>
</p></li><li><span>Apply the NAT diversion policy. Apply the ACL-based traffic classification rule to the view of the outbound interface named GE <span>0/2/1</span> and GE <span>0/2/2</span>.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device] <strong>interface gigabitEthernet <span>0/2/1</span></strong>
[<span class="keyword">*</span>NAT-Device-GigabitEthernet<span>0/2/1</span>] <strong>nat bind acl 3001 instance nat1</strong>
[<span class="keyword">*</span>NAT-Device-GigabitEthernet<span>0/2/1</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device-GigabitEthernet<span>0/2/1</span>] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device] <strong>interface gigabitEthernet <span>0/2/2</span></strong>
[<span class="keyword">*</span>NAT-Device-GigabitEthernet<span>0/2/2</span>] <strong>nat bind acl 3001 instance nat2</strong>
[<span class="keyword">*</span>NAT-Device-GigabitEthernet<span>0/2/2</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device-GigabitEthernet<span>0/2/2</span>] <strong>quit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p># Run the <a href="cmdqueryname=display+nat+server-map"><b><span class="cmdname">display nat server-map</span></b></a> command to check server mapping entries of all users accessing the internal server.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT-Device] <strong>display nat server-map</strong>
This operation will take a few minutes. Press 'Ctrl+C' to break ...     
Slot: <span>3</span> 
Total number:  4.     
  NAT Instance: nat1       
  Protocol:TCP, VPN:---&gt;-     
  <strong>Server reverse:ANY-&gt;1.1.1.1:21[2.1.1.2:21]</strong>                        
  Tag:0x0, TTL:-, Left-Time:-         
  CPE IP:2.1.1.2                 
  <span>extendable:false</span>                                               
  NAT Instance: nat1  
  Protocol:TCP, VPN:---&gt;-    
  <strong>Server:2.1.1.2:21[1.1.1.1:21]-&gt;ANY</strong>                                            
  Tag:0x0, TTL:-, Left-Time:-      
  CPE IP:2.1.1.2           
  <span>extendable:false</span>                                              
  NAT Instance: nat2   
  Protocol:TCP, VPN:---&gt;-      
  <strong>Server reverse:ANY-&gt;2.1.1.1:21[1.1.1.2:21]</strong>                         
  Tag:0x0, TTL:-, Left-Time:-       
  CPE IP:1.1.1.2         
  <span>extendable:false</span>
  NAT Instance: nat2         
  Protocol:TCP, VPN:---&gt;-     
  <strong>Server:1.1.1.2:21[2.1.1.1:21]-&gt;ANY</strong>    
  Tag:0x0, TTL:-, Left-Time:-    
  CPE IP:1.1.1.2<span>
  extendable:false</span>                 
  ---------------------------------------------------------------------------</pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172374648__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration File</h4><pre class="screen"># 
sysname NAT-Device
#
<span>service-location 1 </span>
<span> <span>location<span> slot <span><span>3</span></span></span></span></span>
<span># </span>
<span>service-instance-group group1  </span>
<span> service-location 1 </span>
<span>#</span>
nat instance nat1 id 1
<span> service-instance-group group1</span>
 nat address-group address-group1 group-id 1 unnumbered interface GigabitEthernet<span>0/2/1</span>
 nat server protocol tcp global unnumbered interface GigabitEthernet<span>0/2/1</span> ftp inside 2.1.1.2 ftp
 nat alg ftp
# 
nat instance nat2 id 2
<span> service-instance-group group1</span>
 nat address-group address-group2 group-id 2 unnumbered interface GigabitEthernet<span>0/2/2</span>
 nat server protocol tcp global unnumbered interface GigabitEthernet<span>0/2/2</span> ftp inside 1.1.1.2 ftp
 nat alg ftp
#
acl number 3001
 rule 1 permit ip source any  
# 
interface GigabitEthernet <span>0/2/1</span> 
 undo shutdown 
 ip address 1.1.1.1 24
 nat bind acl 3001 instance nat1 
# 
interface GigabitEthernet <span>0/2/2</span> 
 undo shutdown 
 ip address 2.1.1.1 24
 nat bind acl 3001 instance nat2
#
return</pre>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_nat_cfg_0056.html">Configuration Examples for NAT
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_atn_nat_cfg_0071_1.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_nat_cfg_0111.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>