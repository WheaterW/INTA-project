
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Easy IP and Hairpin">
<meta name="abstract" content="This section provides an example for configuring NAT Easy IP on an outbound interface and the hairpin function. The function combination allows internal hosts to access the Internet through the outbound NAT function and to access an internal server that is created using the easy IP function.">
<meta name="description" content="This section provides an example for configuring NAT Easy IP on an outbound interface and the hairpin function. The function combination allows internal hosts to access the Internet through the outbound NAT function and to access an internal server that is created using the easy IP function.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_nat_cfg_0056.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_atn_nat_cfg_0075.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_nat_cfg_0159.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="c00549182">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="NAT">
<meta name="featuretype" content="NAT and IPv6 Transition">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="NAT">
<meta name="featuretype" content="NAT and IPv6 Transition">
<meta name="featurename" content="NAT">
<meta name="featuretype" content="NAT and IPv6 Transition">
<meta name="featurename" content="NAT">
<meta name="featuretype" content="NAT and IPv6 Transition">
<meta name="OWNER" content="c00549182">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="c00549182">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172374657">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring Easy IP and Hairpin</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172374657"></a><a name="EN-US_TASK_0172374657"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Easy IP and Hairpin</h1>
<div class="taskbody"><p>This section provides an example for configuring NAT Easy IP on an outbound interface and the hairpin function. The function combination allows internal hosts to access the Internet through the outbound NAT function and to access an internal server that is created using the easy IP function.</p>
<div class="context"><a name="EN-US_TASK_0172374657__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>In <a href="#EN-US_TASK_0172374657__fig_dc_ne_cfg_nat_005701">Figure 1</a>, a host on a private network is connected to the Internet through the <span class="keyword">Router</span> on which NAT traffic distribution on an outbound interface is configured. The host uses a public IP address to access an internal server that is created in Easy IP mode on the same NAT device. The <span class="keyword">Router</span> is connected to the private network through <span>0/2/1</span>. The <span class="keyword">Router</span>'s GE <span>0/2/2</span> is connected to the Internet. The public IP addresses 11.1.1.2/32 and 11.1.1.3/32 are available.</p>
<div class="p"><a href="#EN-US_TASK_0172374657__fig_dc_ne_cfg_nat_005701">Figure 1</a> shows IP addresses of interfaces. The configuration requirements are as follows:<ul><li>PCs on the private network segment of 10.1.1.4/32 can access the Internet.</li><li>PCs on the private network segment of 10.1.1.4/32 can access the internal server using a public IP address.</li><li>External Internet computers can access the internal server using a public IP address.</li></ul>
</div>
<div class="fignone" id="EN-US_TASK_0172374657__fig_dc_ne_cfg_nat_005701"><a name="EN-US_TASK_0172374657__fig_dc_ne_cfg_nat_005701"></a><a name="fig_dc_ne_cfg_nat_005701"></a><span class="figcap"><b>Figure 1 </b>Scenario in which NAT traffic distribution on an outbound interface, easy IP, and the hairpin function are configured</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 and 2 in this example represent GE <span>0/2/1</span> and GE <span>0/2/2</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_ne_cfg_nat_0111.png" width="NaN" height="NaN"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172374657__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li>Configure basic NAT functions.</li><li>Configure an internal server in Easy IP mode.</li><li>Configure a NAT traffic diversion policy.</li><li>Configure a NAT traffic conversion policy.</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172374657__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><div class="p">To complete the configuration, you need the following data:<ul><li><p>NAT instance name (nat1) and index (1)</p>
</li><li><p>NAT Device's NAT address pool name (address-group1), address pool number (1), a range of public IP addresses (11.1.1.2 and 11.1.1.3)</p>
</li><li><p>ACL number (3001) to match traffic that a private network host sends to the Internet</p>
</li><li><p>ACL number (3001) to match traffic that a private network host sends to the private network server</p>
</li><li><p>Name and IP address of each interface to which a NAT traffic diversion policy is applied</p>
</li></ul>
</div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172374657__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure basic NAT functions.</span><ol type="a"><li class="substepexpand"><span>Configure a NAT instance named <strong>nat1</strong>.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT Device] <strong>service-location 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NAT Device-service-location-1] <strong>location<span> slot <span><span>3</span></span></span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>NAT Device-service-location-1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT Device-service-location-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT Device] <strong>service-instance-group group1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NAT Device-service-instance-group-group1] <strong>service-location 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NAT Device-service-instance-group-group1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT Device-service-instance-group-group1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT Device] <strong>nat instance nat1 id 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NAT Device-nat-instance-nat1] <strong>service-instance-group group1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NAT Device-nat-instance-nat1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT Device-nat-instance-nat1] <strong>quit</strong></pre>
</p></li><li class="substepexpand"><span>Configure a NAT address pool and specify a range of IP addresses 11.1.1.2 to 11.1.1.3 in the pool.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT Device] <strong>nat instance nat1</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT Device-nat-instance-nat1] <strong>nat address-group address-group1 group-id 1 11.1.1.2 11.1.1.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NAT Device-nat-instance-nat1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT Device-nat-instance-nat1] <strong>quit</strong></pre>
</p></li></ol>
</li><li><span>Configure a NAT server in Easy IP mode.</span><ol type="a"><li class="substepexpand"><span>Configure the public network interface.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT Device] <strong>interface gigabitEthernet <span>0/2/2</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT Device-GigabitEthernet<span>0/2/2</span>] <strong>ip address 11.1.1.1 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NAT Device-GigabitEthernet<span>0/2/2</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT Device-GigabitEthernet<span>0/2/2</span>] <strong>quit</strong></pre>
</p></li><li class="substepexpand"><span>Configure an internal server and the public IP address of the server to reuse the IP address of interface <span>0/2/2</span>. In this example, TCP port 80 is used on an internal server.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT Device] <strong>nat instance nat1</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT Device-nat-instance-nat1] <strong>nat server protocol tcp global unnumbered interface GigabitEthernet<span>0/2/2</span> 80 inside 10.1.1.254 80</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NAT Device-nat-instance-nat1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT Device-nat-instance-nat1] <strong>quit</strong></pre>
</p></li></ol>
</li><li><span>Configure a NAT traffic diversion policy on an outbound interface.</span><ol type="a"><li class="substepexpand"><span>Configure an ACL to allow the PC at 10.1.1.4/32 to access the Internet and communicate with the private network server.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT Device] <strong>acl 3001</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NAT Device-acl4-advance-3001] <strong>rule 1 permit ip source 10.1.1.4 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NAT Device-acl4-advance-3001] <strong>rule 2 permit tcp source 10.1.1.254 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NAT Device-acl4-advance-3001] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT Device-acl4-advance-3001] <strong>quit</strong></pre>
</p></li><li class="substepexpand"><span>Configure a NAT diversion policy on the public network outbound interface.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT Device] <strong>interface gigabitEthernet <span>0/2/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>NAT Device-GigabitEthernet<span>0/2/2</span>] <strong>nat bind acl 3001 instance nat1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NAT Device-GigabitEthernet<span>0/2/2</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT Device-GigabitEthernet<span>0/2/2</span>] <strong>quit</strong></pre>
</p></li><li class="substepexpand"><span>Configure a NAT diversion policy on the private network outbound interface.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT Device] <strong>interface gigabitEthernet <span>0/2/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>NAT Device-GigabitEthernet<span>0/2/1</span>] <strong>ip address 10.1.1.2 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NAT Device-GigabitEthernet<span>0/2/1</span>] <strong>nat bind acl 3001 instance nat1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NAT Device-GigabitEthernet<span>0/2/1</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NAT Device-GigabitEthernet<span>0/2/1</span>] <strong>quit</strong></pre>
</p></li></ol>
</li></ol></div>
<div class="example"><a name="EN-US_TASK_0172374657__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><pre class="screen"># 
sysname NAT Device 
# 
service-location 1  
 location<span> slot <span><span>3</span></span></span>
# 
service-instance-group group1       
 service-location 1       
# 
acl number 3001 
 rule 1 permit ip source 10.1.1.4 0.0.0.0
 rule 2 permit tcp source 10.1.1.254 0.0.0.0
#
nat instance nat1 id 1       
 service-instance-group group1       
 nat address-group address-group1 group-id 1 11.1.1.2 11.1.1.3
 nat server protocol tcp global unnumbered interface GigabitEthernet<span>0/2/2</span> 80 inside 10.1.1.254 80
#
interface gigabitEthernet <span>0/2/1</span>
 undo shutdown 
 ip address 10.1.1.2 255.255.255.0
 nat bind acl 3001 instance nat1
# 
interface gigabitEthernet <span>0/2/2</span>
 undo shutdown 
 ip address 11.1.1.1 255.255.255.0
 nat bind acl 3001 instance nat1
# 
return </pre>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_nat_cfg_0056.html">Configuration Examples for NAT
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_atn_nat_cfg_0075.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_nat_cfg_0159.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>