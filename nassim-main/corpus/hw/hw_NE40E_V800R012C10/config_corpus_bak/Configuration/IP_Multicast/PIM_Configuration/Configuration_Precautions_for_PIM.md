Configuration Precautions for PIM
=================================

Configuration_Precautions_for_PIM

#### Feature Requirements

**Table 1** Feature requirements
| Feature Requirements | Series | Models |
| --- | --- | --- |
| The interval at which the device sends Hello messages must be shorter than the neighbor holdtime. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| The holdtime of Bootstrap messages sent from a BSR must be greater than the interval at which a C-BSR sends Bootstrap messages. Otherwise, BSR election is unstable. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| The period during which the BSR keeps the Advertisement message from the C-RP must be longer than the interval for the C-RP to send Advertisement messages. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| To enable a device to communicate with a device that supports auto-RP, enable auto-RP listening on the device. After this function is enabled, the device can receive Auto-RP Advertisement and Discovery messages, resolve the source addresses of the messages, and perform RPF checks based on the source addresses.  Currently, only IPv4 is supported. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| These two modes cannot be both configured on the same device in a PIM-SM domain. If Anycast-RP is implemented through PIM, you can also configure the device to advertise the source information obtained from MSDP peers in another domain to peers in the local domain. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| MSDP is not required if Protocol Independent Multicast-Source-Specific Multicast (PIM-SSM) is used. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| Ensure that the SSM group address ranges of all devices on the network are the same. Otherwise, faults may occur on the network. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| 1. The register-suppression-timeout and probe-interval parameters must be configured on the source DR.  The source DR can send Register messages randomly and discretely within the range of (0.5\*register-suppression-timeout, 1.5\*register-suppression-timeout) - probe-interval, preventing a large number of Register messages from being sent to the CPU in a short period.  2. The source-lifetime command must be configured on the RP.  It is recommended that the source-lifetime of an RP be greater than or equal to (3\*probe-interval + 1.5 \*register-suppression-timeout 200).  For example, the CIR value of a board is 320, and the route specification is 40K.  The source DR can be configured with register-suppression-timeout 200 and probe-interval 90.  The source-lifetime 420 command is configured on the RP.  Adjust the preceding parameters to ensure that Register messages are sent discretely and no message is lost. You can run the disp fe slot X statistics discard command to check whether Register messages are lost.  The cause ID of IPv4 Register messages is 19, and the cause ID of IPv6 Register messages is 408.  This configuration is also required in MVPN scenarios. Otherwise, SA messages cannot be kept alive. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| PIM FRR applies only to IPv4 networks. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| In Equal-Cost Multiple Path (ECMP) scenarios, node protection does not take effect because IGP cannot calculate a backup path. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| In a non-ECMP scenario, PIM FRR is deployed on an IGP-enabled network. Because IGP does not back up a backup path, the backup multicast path may be deleted during an active/standby switchover due to smoothing. As a result, the primary path fails during the switchover, and fast switchover cannot be performed. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| In a non-ECMP scenario, only LFA FRR-based non-ECMP PIM FRR takes effect, and remote FRR-based non-ECMP PIM FRR does not take effect. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| When LFA FRR is deployed on a network, the restrictions on IGP LFA FRR are inherited. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| On an LFA FRR-based network, if the backup path is an ECMP path, fast switching between the primary and backup paths cannot be performed. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| PIM FRR generates backup paths and PIM-SSM entries only when there is multicast traffic corresponding to SPT (S, G) entries. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| PIM FRR and load balancing cannot be added to the current configuration. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| The priority of the sticky DR is 4294967294. When the sticky DR is deployed, if the priority of the sticky DR is higher than 4294967294 in the shared network segment, the DR role is preempted. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| The DR priority configured in a PIM instance does not take effect on the interface enabled with sticky DR. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| If PIM FRR is deployed in an IPv4 multicast VPN (Rosen mode) scenario, PIM FRR must be deployed on both the multicast source and receiver to provide effective protection. If PIM FRR is configured only on the receiver side, no protection is configured for the forwarding path of VPN protocol packets on the public network. As a result, the forwarding of VPN protocol packets is interrupted after the public network path fails, and VPN traffic is interrupted. After the public network convergence is complete, VPN protocol packets can be sent to the source side. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| PIM FRR does not support low-rate multicast traffic or multicast traffic with changing rates (no packet is received within the configured detection period, which is 20 ms by default). Low-rate multicast traffic or multicast traffic with changing rates causes frequent PIM FRR switchovers and packet loss.  PIM FRR can be deployed based on source/group IP addresses. PIM FRR does not need to be deployed for low-rate multicast services. The default detection period is adjusted to adapt to low-rate multicast services, but the protection switching time is shortened. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| In a Rosen MVPN scenario where PIM FRR is deployed based on the public network, low-speed traffic cannot be filtered out based on VPN (S, G) entries. To filter out low-speed traffic, you can configure a switching threshold to limit low-speed services to the ShareGroup and use an ACL policy to filter out the ShareGroup. PIM FRR deployed on the public network cannot eliminate low-speed VPN traffic. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| PIM FRR can be deployed only on Layer 3 Ethernet interfaces, Ethernet sub-interfaces, Layer 3 Eth-Trunk interfaces, Eth-Trunk sub-interfaces, VLANIF interfaces, and BDIF interfaces, the PIM FRR function does not take effect. Packets are forwarded in common multicast mode, protection cannot be implemented, fast switching cannot be performed, and protocol hard convergence cannot be implemented. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| When PIM FRR is deployed on a ring network, PIM FRR must be configured on the intermediate devices of PIM FRR devices. In addition, the intermediate devices cannot be connected to non-Huawei devices. Otherwise, protection cannot be implemented. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| In a multicast scenario with equal-cost links or primary and secondary links, PIM is enabled only for the active link in use, but not enabled on the other links. After a link switchover occurs due to a configuration, route, or link change, multicast services will be interrupted, because PIM is not enabled on the newly selected link.  If multicast services are required, PIM must also be enabled on the optimal route of unequal-cost links.  Enable PIM in the view of the interface that is not configured. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| FRR is deployed on the public network in a Rosen MVPN scenario. The inbound interface of the backup link on a leaf node on the public network is a trunk interface. If the primary link on the public network fails, some traffic on the trunk interface of the leaf node may fail to be forwarded.  You are advised to perform the following configurations:  1. Configure the inbound interface of the public network backup link as a non-trunk interface.  2. Previous device connected to the leaf node:  The board works in NGSF mode, and RROSEN is configured and MOFRR is deployed on the public network. The outbound interface of the P node is a trunk interface. Software-based interface selection is configured on the trunk interface so that traffic on the trunk interface of the leaf node is not load balanced based on the VPN.  If load balancing is required, you can configure the switch group to perform load balancing based on the public network. In this way, load balancing is implemented on the private network. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| In a multicast scenario with equal-cost links or primary and secondary links, PIM is enabled only for the active link in use, but not enabled on the other links. After a link switchover occurs due to a configuration, route, or link change, multicast services will be interrupted, because PIM is not enabled on the newly selected link.  If multicast services are required, PIM must also be enabled on the optimal route of unequal-cost links.  It is recommended that you enable PIM in the view of the interface that lacks the configuration. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| Untagged sub-interfaces do not support multicast configurations. Before switching a sub-interface to an untagged sub-interface, delete the multicast configuration on the sub-interface. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| Virtual devices are created on the switch, and multicast configurations that reference ACL policies exist in service VSs. A service VS cannot be directly deleted from the Admin-VS. If the multicast configuration that references an ACL policy in a service VS is not deleted, an error message is displayed when the service VS is deleted from the Admin-VS, and the ACL configuration in the service VS cannot be deleted.  You are advised to delete the multicast configurations that reference ACL policies in service VSs one by one before deleting the service VSs in the Admin-VS. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| After the device is restarted, if the BFD session or the BFD neighbor session is in the AdminDown state, the PIM status is not affected. If the BFD session is renegotiated, the PIM status is not affected. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| When an mVRRP group is deployed on a GE physical interface or a slot VE interface and the multicast outbound interface and the outbound interface of the mVRRP group reside on different boards, two copies of multicast traffic occur. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| If the outbound interface of an IPv4 Layer 3 multicast leaf node is deployed on a non-enhanced TM board or subcard and downstream TM replication or DUNE replication is configured on the board, channelized multicast rate limiting cannot be ensured. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |