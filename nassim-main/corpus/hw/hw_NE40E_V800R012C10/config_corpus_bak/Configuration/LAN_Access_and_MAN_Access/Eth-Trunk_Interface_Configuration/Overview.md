Overview
========

Multiple physical interfaces can be bundled into an Eth-Trunk interface using the link aggregation technique. The Eth-Trunk interface is a logical interface, having all functions of an Ethernet interface and is more reliable.

#### Brief Introduction

As the volume of services deployed on networks increases, the bandwidth provided by a single P2P physical link working in full-duplex mode cannot meet the requirements of service traffic.

To increase bandwidth, existing interface boards can be replaced with interface boards of higher bandwidth capacity. However, this would waste existing device resources and increase upgrade expenditure. If more links are used to interconnect devices, each Layer 3 interface must be configured with an IP address, wasting IP addresses.

To increase bandwidth without replacing the existing interface boards or wasting IP address resources, bundle physical interfaces into a logical interface using Eth-Trunk to provide higher bandwidth.


#### Concepts

This part describes concepts relating to Eth-Trunk, including the link aggregation modes of Eth-Trunk interfaces, public parameters of Eth-Trunk interfaces, parameters of Eth-Trunk interfaces in static Link Aggregation Control Protocol (LACP) mode, parameters of Eth-Trunk member interfaces, and status of member interfaces of an Eth-Trunk interface in static LACP mode.

* [Table 1](#EN-US_CONCEPT_0172362824__tab_dc_vrp_ethtrunk_cfg_004501) describes the link aggregation modes of Eth-Trunk interfaces.
  
  **Table 1** Link aggregation modes of Eth-Trunk interfaces
  | Eth-Trunk Link Aggregation Mode | Description |
  | --- | --- |
  | Manual load balancing mode | Manual load balancing is a basic link aggregation mode, in which, you need to manually create a trunk, add member interfaces to it, and configure active interfaces. The LACP protocol is not required.  All member interfaces forward data and perform load balancing.  In manual load balancing mode, traffic can be evenly distributed among all member interfaces. Alternatively, you can set different weights for member interfaces to implement uneven load balancing. The interfaces set with greater weights transmit more traffic.  If an active link fails, the remaining active links in the LAG share the traffic evenly or based on the weight. |
  | Static LACP mode | Link aggregation in static LACP uses LACPDUs to negotiation on active link selection. This mode is also called M:N mode where M indicates the number of active links and N indicates the number of backup links. This mode improves link reliability and implements load balancing among the M active links.  In static LACP mode, you also manually create a trunk interface and add member interfaces to it. Compared with link aggregation in manual load balancing mode, active interfaces in LACP mode are selected through the transmission of Link Aggregation Control Protocol Data Units (LACPDUs). This means that when a group of interfaces are added to a trunk interface, the status of each member interface (active or inactive) depends on the LACP negotiation.  When data is transmitted over the aggregation link, traffic is distributed among the active (M) links. No data is transmitted over the backup (N) links. Therefore, the actual bandwidth of the aggregation link is the sum of the bandwidth of the M links, and the maximum bandwidth that can be provided is the sum of the bandwidth of M + N links.  If one of the M links fails, LACP selects one available backup link from the N links to replace the faulty link. In this situation, the actual bandwidth of the aggregation link remains the sum of the bandwidth of M links, but the maximum bandwidth that can be provided is the sum of the bandwidth of M + N - 1 links.  NOTE:  LACP, specified in IEEE 802.3 ad, implements dynamic link aggregation and deaggregation. The local device and the peer exchange information through LACPDUs. |
  | Manual 1:1 master/backup mode | The manual 1:1 master/backup mode is used when only one end or neither end supports LACP.  In manual mode, you must manually set up an Eth-Trunk and add an interface to the Eth-Trunk. You must also manually configure member interfaces to be in the active state.  In 1:1 master/backup mode, an Eth-Trunk interface contains only two member interfaces. One interface is the master interface and the other is the backup interface. In normal situations, only the master interface forwards traffic. |
* Public parameters of an Eth-Trunk interface
  
  [Table 2](#EN-US_CONCEPT_0172362824__tab_dc_vrp_ethtrunk_cfg_004502) shows public parameters of an Eth-Trunk interface. These public parameters only apply to Eth-Trunk interfaces in manual load balancing mode and in static LACP mode.
  
  **Table 2** Public parameters of an Eth-Trunk interface
  | Parameter | Description | Applicable Scenario |
  | --- | --- | --- |
  | Minimum number of active Eth-Trunk member links | The number of member links in the up state affects the status and bandwidth of an Eth-Trunk interface. The bandwidth of an Eth-Trunk interface equals the total bandwidth of all member interfaces in the up state.  When the number of member links in the Up state is smaller than the lower threshold, the Eth-Trunk interface goes Down. This ensures the minimum available bandwidth of an up trunk link.  For example, if an Eth-Trunk interface needs to provide a minimum bandwidth of 2 Gbit/s and each member link can provide 1 Gbit/s bandwidth, the lower threshold must be set to 2 or a larger value. If one or no member links are in the Up state, the Eth-Trunk interface goes Down. | If the minimum bandwidth must be guaranteed, you can configure the minimum number of active member links. |
  | Load balancing mode | Load can be balanced among member links of a trunk link according to the configured weights.  The following types of load balancing are available:  + Per-flow load balancing  Per-flow load balancing differentiates data flows based on the MAC or IP address in each packet and ensures that packets of the same data flow are transmitted over the same member link.  This load balancing mode ensures the data sequence, but not the bandwidth usage. + Per-packet load balancing  Per-packet load balancing takes each packet (rather than a data flow) as the transmission unit, and transmits packets over different member links.  This load balancing mode ensures bandwidth utilization, but not the packet sequence. Therefore, this mode applies to the scenarios where the packet sequence is not strictly required. + Symmetric load balancing  Symmetric load balancing differentiates data flows based on IP addresses of packets to ensure that packets of the same data flow are transmitted over member links with the same serial number on two connected devices.  This load balancing mode ensures the data sequence, but not the bandwidth usage. | Load balancing can be carried out in the following ways: + If data transmission sequence takes precedence over bandwidth usage in forwarding requirements, you can deploy per-flow load balancing. + If bandwidth usage takes precedence over data transmission sequence in forwarding requirements, you can deploy per-packet load balancing. |
  | MAC address | Each station or server connected to an Ethernet interface of a device has its own MAC address. The MAC address table on the device records information about the MAC addresses of connected devices.  When a Layer 3 router is connected to a Layer 2 switch through two Eth-Trunk links for different services, if both Eth-Trunk interfaces on the router adopt the default system MAC address, the system MAC address is learned by the switch and alternates between the two Eth-Trunk interfaces. In this case, a loop probably occurs between the two devices. To prevent loops, you can change the MAC address of an Eth-Trunk interface by using the **mac-address** command. By configuring the source and destination MAC addresses for two Eth-Trunk links, you can guarantee the normal transmission of service data flows and improve the network reliability.  After the MAC address of an Eth-Trunk interface is changed, the device sends gratuitous ARP packets to update the mapping relationship between MAC addresses and ports. | If a Layer 3 routing device and a Layer 2 switching device transmit different services through two Eth-Trunk links, you can configure different MAC addresses for the two Eth-Trunk interfaces on the Layer 3 routing device to specify forwarding paths. |
  | MTU | Generally, the IP layer controls the maximum length of frames that are sent each time. Each time the IP layer receives an IP packet to be sent, it checks which local interface the packet needs to be sent to and queries the MTU of the interface. Then, the IP layer compares the MTU with the packet length to be sent. If the packet length is greater than the MTU, the IP layer fragments the packet to ensure that the length of each fragment is smaller or equal to the MTU.  If forcible unfragmentation is configured, certain packets are lost during data transmission at the IP layer. To ensure jumbo packets are not dropped during transmission, you need to configure forcible fragmentation.  Generally, it is recommended that you adopt the default MTU value of 1500 bytes. If you need to change the MTU of an Eth-Trunk interface, you need to change the MTU of the peer Eth-Trunk interface to ensure that the MTUs of both interfaces are the same. Otherwise, services may be interrupted. | If the length of packets transmitted on a network is longer than the MTU, you need to decrease the MTU value and configure packets to be forcibly fragmented. This ensures that fewer large packets transmitted on the network are dropped.  Generally, it is recommended that you adopt the default MTU value of 1500 bytes. If you need to change the MTU of an Eth-Trunk interface, you need to change the MTU of the peer Eth-Trunk interface to ensure that the MTUs of both interfaces are the same. Otherwise, services may be interrupted. |
* Parameters of an Eth-Trunk interface in static LACP mode
  
  **Table 3** Parameters of an Eth-Trunk interface in static LACP mode
  | Parameter | Description | Applicable Scenario |
  | --- | --- | --- |
  | Maximum number of active member links | The number of member links in the up state affects the status and bandwidth of an Eth-Trunk interface. The bandwidth of an Eth-Trunk interface equals the total bandwidth of all member interfaces in the up state.  After the number of member links in the Up state reaches the upper threshold, the bandwidth of the Eth-Trunk interface does not increase even if more member links go Up. This improves network reliability and ensures sufficient bandwidth.  For example, 10 member links are added to an Eth-Trunk link, each providing 1 Gbit/s bandwidth. If the Eth-Trunk interface only needs to provide a maximum bandwidth of 5 Gbit/s, the upper threshold can be set to 5, indicating a maximum of five member links need to be active. The remaining links automatically enter the backup state. If one or more of the active member links go Down, the backup links automatically become active, which ensures the 5 Gbit/s bandwidth of the Eth-Trunk interface and improves network reliability. | If it is required that the maximum bandwidth be unchanged when more member interfaces go up, you can configure the maximum number of active member links. |
  | LACP system priority | An LACP system priority is set to prioritize the devices at both ends. A lower system LACP priority value indicates a higher LACP system priority. The device with a higher system priority is selected as the Actor, and then active member interfaces are selected according to the configuration of the Eth-Trunk interface on the Actor.  If neither of the devices at the two ends of an Eth-Trunk link is configured with the system priority, the devices adopt the default value. In this case, the Actor is selected according to the system ID. That is, the device with the smaller system ID becomes the Actor. | If the Actor of an Eth-Trunk link needs to be manually configured, you can configure the LACP system priority. |
  | Mode for selecting active interfaces | As defined in LACP, active interfaces are selected according to the interface priority by default. If member interfaces of an Eth-Trunk interface in static LACP mode work at different rates, such as 100 Mbit/s and 1 Gbit/s, low-speed member interfaces may be selected as active interfaces because of their high priorities. If you intend to select high-speed interfaces to be active interfaces, you can run the [**lacp selected**](cmdqueryname=lacp+selected) command to set the mode for selecting active interfaces to speed. | When an Eth-Trunk interface has multiple up member interfaces working at different rates, you can configure a mode for selecting active interfaces to ensure the maximum rate of the Eth-Trunk interface. |
  | Timeout period for receiving LACP packets | If two devices are connected through three interfaces on each end, the three interfaces are bundled into an Eth-Trunk interface and the **mode lacp-static** command is used to configure the Eth-Trunk interface to work in static LACP mode. In addition, the **least active-linknumber link-number** command is used to set the minimum number of active member links to 2.  When an Eth-Trunk member interface on the peer end goes down, the Eth-Trunk interface on the local end cannot detect the fault immediately. As a result, the local Eth-Trunk interface still has three member interfaces in the up state. Data is balanced among the three member interfaces, and thus certain data is lost. To ensure data transmission, you can run the [**lacp timeout**](cmdqueryname=lacp+timeout) command to configure the timeout period for the interface to receive packets. If a local member interface does not receive any LACP packet within the configured timeout period, it turns down immediately and no longer forwards data.  As the number of up member interfaces does not fall below the configured minimum number of up member interfaces, the Eth-Trunk interface is still up. In this case, data is balanced between the two member interfaces in the up state, thereby ensuring the reliability of data transmission. | If an Eth-Trunk interface has multiple up member interfaces, and the minimum number of active member links is set, you can configure the timeout period for receiving LACP packets to ensure that no packet loss occurs after a member interface goes down. |
  | Preemption delay | A member interface of an Eth-Trunk interface in static LACP mode fails and thus is in the standby state. When the member interface recovers, it switches to the forwarding state. To avoid unstable data transmission on the entire Eth-Trunk link due to the member interface's alternating between up and down, you can run the lacp preempt delay command to configure the preemption delay. In this manner, the member interface can switch to the forwarding state only after the preemption delay expires. + If it is required that the member interface switch to the forwarding state as soon as possible after it recovers, you can use the [**lacp preempt delay**](cmdqueryname=lacp+preempt+delay) command to set the preemption delay to the minimum value. + If it is required that the member interface switch the forwarding state some time after it recovers, you can use the [**lacp preempt delay**](cmdqueryname=lacp+preempt+delay) command to set a proper preemption delay. The value can be set as required as long as it ranges from 0 to 180 seconds. | To prevent unstable data transmission on an Eth-Trunk interface caused by frequent status changes of its member interfaces, you can configure a preemption delay. |
* Parameters of an Eth-Trunk member interface
  
  **Table 4** Parameters of an Eth-Trunk member interface
  | Parameter | Description | Applicable Scenario |
  | --- | --- | --- |
  | Load balancing weight | On an Eth-Trunk interface, you can load balance traffic among member interfaces according to the weights configured for the member interfaces.  The higher the weight of a member interface, the heavier the load over the member link. Therefore, you can run the [**distribute-weight**](cmdqueryname=distribute-weight) command to configure a higher weight for a member interface so that the member link can carry a heavier load. | You can configure load balancing weights for member interfaces if an Eth-Trunk interface has multiple up member interfaces working at different rates, and it is required that member interfaces working at higher rates bear heavier loads.  This parameter only applies to Eth-Trunk interfaces in manual load balancing mode and in static LACP mode. |
  | LACP interface priority | An LACP interface priority is set to specify the priority of an interface to be selected as an active interface. Interfaces with higher priorities are selected as active interfaces. Two devices are connected through three interfaces on each side. After the three interfaces are bundled into an Eth-Trunk interface, the [**mode lacp-static**](cmdqueryname=mode+lacp-static) command is used to configure the Eth-Trunk interface to work in static LACP mode. Two Eth-Trunk member interfaces are active. If you want to use an inactive interface to replace one of the active interfaces, you can take either of the following actions: + Run the [**lacp priority**](cmdqueryname=lacp+priority) command in the interface view to set the LACP interface priority of an inactive interface to 10 or another value as long as the LACP priority of the inactive interface is lower than that of an active interface. + Run the [**lacp priority**](cmdqueryname=lacp+priority) command in the interface view to set the LACP interface priority of an active interface to 180 or another value as long as the LACP priority of the active interface is higher than that of any inactive interface. | You can configure interface LACP priorities for member interfaces to determine active member interfaces of an Eth-Trunk interface. |
* Status of member interfaces of an Eth-Trunk interface in static LACP mode
  
  **Table 5** Status of member interfaces of an Eth-Trunk interface in static LACP mode
  | Status | Description |
  | --- | --- |
  | Selected | Member interfaces in the Selected state can forward traffic. |
  | Unselected | Member interfaces in the Unselected state cannot forward traffic. |
  
  
  ![](../../../../public_sys-resources/note_3.0-en-us.png) The rate and duplex mode of an Eth-Trunk interface is determined by its member interfaces in the Selected state:
  + The rate of an Eth-Trunk interface is the sum of the rates of all its member interfaces in the Selected state.
  + The duplex mode of an Eth-Trunk interface is the same as that of its member interfaces in the Selected state.