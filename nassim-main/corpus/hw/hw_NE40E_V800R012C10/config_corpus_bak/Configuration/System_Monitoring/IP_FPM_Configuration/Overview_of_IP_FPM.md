Overview of IP FPM
==================

IP Flow Performance Measurement (FPM) is a Huawei-proprietary feature that measures packet loss rate and delay of end-to-end service packets transmitted on an IP network. This feature is easy to deploy and provides an accurate assessment of network performance.

#### Background

As IP services are more widely used, fault diagnosis and end-to-end service quality analysis are becoming an increasingly pressing concern for carriers. However, absence of effective measures prolongs fault diagnosis and increases the workload. IP FPM is developed to help carriers collect statistics and monitor end-to-end network performance.


#### Basic Concepts

The IP Flow Performance Measurement (FPM) model describes how service flows are measured to obtain the packet loss rate and delay.[Figure 1](#EN-US_CONCEPT_0172372845__fig_dc_vrp_ipfpm_cfg_000201) shows the IP FPM statistical model. The IP FPM model is composed of three objects: target flows, a transit network, and the statistical system. The statistical system is further classified into the Target Logical Port (TLP), Data Collecting Point (DCP), and Measurement Control Point (MCP).**Figure 1** IP FPM model  
![](images/fig_dc_vrp_ipfpm_cfg_000201.png)  

* Target flow
  
  Target flows must be pre-defined. One or more fields in IP headers can be specified to identify target flows. The field can be the source IP address or prefix, destination IP address or prefix, protocol type, source port number, destination port number, or type of service (ToS). The more fields specified, the more accurately flows can be identified. Specifying as many fields as possible is recommended to maximize measurement accuracy.
* Transit network
  
  The transit network only bears target flows. The target flows are not generated or terminated on the transit network. The transit network can be a Layer 2 (L2), Layer 3 (L3), or L2+L3 hybrid network. Each node on the transit network must be reachable at the network layer.
* TLP
  
  TLPs are interfaces on the edge nodes of the transit network. TLPs perform the following actions:
  + Compile statistics on the packet loss rate and delay.
  + Generate statistics, such as the number of packets sent and received, traffic bandwidth, and timestamp.
  
  An In-Point-TLP collects statistics about service flows it receives. An Out-Point-TLP collects statistics about service flows it sends.
* DCP
  
  DCPs are edge nodes on the transit network. DCPs perform the following actions:
  + Manage and control TLPs.
  + Collect statistics generated by TLPs.
  + Report the statistics to an MCP.
* MCP
  
  MCPs can be any nodes on the transit network. MCPs perform the following actions:
  + Collect statistics reported by DCPs.
  + Summarize and calculate the statistics.
  + Report measurement results to user terminals or the network management system (NMS).

IP FPM also defines measurement flags. Measurement flags, also called identification flags, identifies whether a specific packet is used to measure packet loss or delay. A specific bit in the IPv4 packet header can be specified as a measurement flag for packet loss or delay measurement.

![](../../../../public_sys-resources/note_3.0-en-us.png) 

Currently, the IP FPM measurement flags cannot use the same bit with QoS flags.



#### Implementation

IP Flow Performance Measurement (FPM) measures multipoint-to-multipoint (MP2MP) service flows to obtain the packet loss rate and delay.In statistical terms, the statistical objects are the service flows, and statistical calculations determine the packet loss rate and delay of the service flows traveling across the transit network. Service flow statistical analysis is performed on the ingress and egress of the transit network. On the network shown in [Figure 2](#EN-US_CONCEPT_0172372845__fig_dc_vrp_ipfpm_cfg_000202), the number of packets entering the network in the ingress direction on HUAWEI(n) is PI(n), and the number of packets leaving the network in the egress direction on HUAWEI(n) is PE(n).

**Figure 2** IP FPM measurement  
![](images/fig_dc_vrp_ipfpm_cfg_000202.png)  

The difference between the number of packets entering the network and the number of packets leaving the network within a specified period is the packet loss.

* The number of packets entering the network is the sum of all packets moving in the ingress direction: PI = PI(1) + PI(2) + PI(3)
* The number of packets leaving the network is the sum of all packets moving in the egress direction: PE = PE(1) + PE(2) + PE(3)

The difference between the time a service flow enters the network and the time the service flow leaves the network within a specified period is the delay.


#### Benefits

IP FPM brings the following benefits to carriers:

* Allows carriers to use the network management system (NMS) to monitor the network running status to determine whether the network quality complies with the service level agreement (SLA).
* Allows carriers to promptly adjust services based on measurement results to ensure proper transmission of voice and data services, improving user experience.


![](../../../../public_sys-resources/note_3.0-en-us.png) 

The following examples describe how to configure packet loss measurement and two-way delay measurement in end-to-end proactive performance statistics and how to configure packet loss measurement and one-way delay measurement in hop-by-hop on-demand performance statistics.

In P2MP (MP being two points) and MP2P (MP being two points) delay measurement scenarios, all devices in the delay measurement area must support P2MP delay measurement. Otherwise, delay measurement fails.