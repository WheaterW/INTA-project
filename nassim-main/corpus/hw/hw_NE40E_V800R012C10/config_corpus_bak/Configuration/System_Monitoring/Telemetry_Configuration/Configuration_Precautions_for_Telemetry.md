Configuration Precautions for Telemetry
=======================================

Configuration_Precautions_for_Telemetry

#### Feature Requirements

**Table 1** Feature requirements
| Feature Requirements | Series | Models |
| --- | --- | --- |
| The telemetry sampling period is implemented by a software timer and is affected by the system running environment. In extreme scenarios (for example, the CPU usage is high), the sampling period has a 10 ms-level delay. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| 1. In dial-in mode, the subscription is automatically canceled after the server is disconnected.  2. The gRPC server supports subscription based on IPv4 and IPv6 addresses, and IPv4 and IPv6 gRPC servers can co-exist.  3. The gRPC client supports subscription based on IPv4 and IPv6 addresses, and IPv4 and IPv6 gRPC clients can co-exist.  4. After the collector is disconnected from the device, the collector reconnects to the device every 30 seconds. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| â¢ Number of sampling instances: You can run the display telemetry sensor-path command to check the minimum sampling interval of each sampling path and the number of instances that can be sampled at the minimum sampling interval. The sampling interval that takes effect can be calculated as follows: (Minimum sampling interval x Actual number of instances on the device)/Number of instances that can be sampled at the minimum sampling interval.  â¢ Sampling intervals of data sources: Some data sources have their own sampling intervals. If the sampling interval of a data source is different from the sampling interval configured in telemetry, the effective sampling interval of the data source is affected by half of the telemetry sampling interval. For example, if the telemetry sampling interval is 5 minutes and the data source sampling interval is 1 minute, then the effective sampling interval is 3 minutes. The reason is explained as follows: To avoid sending too much or little data, telemetry suppresses the sampling interval for each instance based on half of the configured telemetry sampling interval. In this way, the same sampled data of an instance is not sent repeatedly within half of the telemetry sampling interval, and can only be sent again in the next half of the telemetry sampling interval. In this example, repeated data is not sent within half of the telemetry sampling interval, that is, 2 minutes and 30 seconds. As the sampling interval of the data source is 1 minute, repeated data is not sent for additional 30 seconds. Therefore, the effective sampling interval is 3 minutes. In this case, you can change the telemetry sampling interval or the data source sampling interval ensure that the two sampling intervals are the same.  â¢ CPU usage: When the system CPU is busy, the telemetry sampling interval is prolonged. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| 1. When data is sampled in service sampling mode, the generated UDP packets are split by 1500 bytes. When the YANG model is used to sample data, the same batch of data is sent in one packet. If a large number of UDP packets are transmitted on the network, you can set the threshold for UDP packets using commands, for example, protocol udp packet-max-size 1472.  2. A single packet can be encapsulated to ensure the integrity of data instances. When data is sampled in service sampling mode and the size of the data instance is large, the length of the generated UDP packet exceeds 1500 bytes. When the YANG model is used to sample multiple layers of data, Telemetry splits the data based on the top-level instance. If the encapsulated data exceeds 64 KB, the packet cannot be sent due to the limitation that the maximum size of UDP packets that can be sent is 64 KB. Typically, when huawei-network-instance:network-instance/instances/instance is sampled, the size of a single instance exceeds 64 KB because various protocol data on the device is mounted to the network instance (for example, a public network instance). In this case, if the draft-ietf-netconf-udp-notif-08 draft is used to encapsulate packets, the packets are split based on 60 KB. When the draft-ietf-netconf-udp-pub-channel-01 draft is used to encapsulate packets, the data cannot be sent.  3. When the draft-ietf-netconf-udp-notif-08 draft is used, the value of the Observation-Domain-ID field in the message header is the generated according to the structure code of the chassis ID, board number, and process number. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| If the telemetry function is used, 20% extra CPU resources may be consumed. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| 1. Low-speed sampling tasks are executed one by one on the MPU. Therefore, when multiple sampling tasks are executed concurrently, the actual sampling period is the sum of the time required for completing all sampling tasks.  2. High-speed sampling tasks are concurrently executed on LPUs. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| Telemetry supports the configuration of IPv6 collectors. After IPv6 collectors are supported, both IPv4 and IPv6 addresses can be configured for a subscription. However, only one source IP address, IPv4 source address, or IPv6 source address can be configured.  1. If an IPv4 source address is configured, the IPv4 session uses the specified address as the source IP address. The source IP address of the IPv6 session is automatically selected by the system (the address of the outbound interface is used by default).  2. If an IPv6 source address is configured, the IPv6 session uses the specified address as the source IP address. The source IP address of the IPv4 session is automatically selected by the system (the address of the outbound interface is used by default).  If both IPv4 and IPv6 collectors are required and each collector uses a specified source address, you can create multiple subscriptions. Some subscriptions are configured with IPv4 destination and source addresses, and the other subscriptions are configured with IPv6 destination and source addresses. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| 1. If the number of collected instances exceeds the device capability, the sampling interval is automatically prolonged. For example, if all interfaces are sampled every 100 ms and there are only 20 interfaces, all the interfaces can be sampled every 100 ms. If there are 200 interfaces, all the interfaces can be sampled every 1s.  2. Telemetry can be used to send data to the collector at a rate of 500 pps.  3. If the CPU usage of the MPU is higher than 90%, telemetry suspends all sampling tasks except CPU and memory sampling tasks.  You can reduce the number of sampling tasks or extend the sampling task period to prevent this problem. Otherwise, the data collection efficiency decreases. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| 1. When telemetry interface collection is configured on an Eth-Trunk interface, the minimum interval for sending data to the collector can only be 1s. The configured millisecond-level sampling interval does not take effect.  2. The interval for sending data collected by the telemetry interface of an Eth-Trunk interface is determined by the interval for sending data collected by member interfaces. If the sending interval of a member interface is different from that of an Eth-Trunk interface due to configuration or resource limitations, the sending interval and reported data of the Eth-Trunk interface may be inaccurate.  3. After telemetry interface collection is configured on an Eth-Trunk interface, adding or removing a member interface causes the interval at which packets are sent to the CPU of the Eth-Trunk interface to change temporarily. In addition, the reported statistics also change.  4. After the ptp uhpc enable command is run, the time of each board may not be synchronized. In this case, the interval for sending collected data and statistics on the telemetry interface of the Eth-Trunk interface may be inaccurate, or even the statistics may not be sent. You are advised not to configure the two functions together.  5. The collected data sent by telemetry interfaces can be suppressed. When the CPU usage of the telemetry function exceeds the threshold configured using the cpu-usage max-percent command, telemetry stops sending collected data and enters the suppression state. After the CPU usage falls below the threshold, the suppression is canceled. After the interface is restored to send packets to the CPU, the interval for sending packets to the CPU may be prolonged. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| The telemetry interface collection task has a priority. For each interface, a maximum of three collection tasks can be performed on the interface.  (1) Interface itself  (2) Collecting data from the trunk as a trunk member  (3) Global collection  The priority sequence is (1) > (2) > (3). The sending period is subject to the high priority. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| 1. Due to differences in statistics collection principles, telemetry statistics on an interface may be different from the statistics queried using commands, MIBs, or PM.  2. The difference between the statistics points of some packets inside the device causes a slight difference between the interface statistics reported by telemetry and the subcard statistics.  3. Telemetry interface collection is configured on a channelized sub-interface. For an eTM board or subcard, when the outbound bandwidth exceeds the threshold, telemetry statistics are inconsistent with sub-interface statistics.  4. The telemetry feature does not allow NSR. After an active/standby switchover is performed, the telemetry data sent by the main interface is cleared and statistics collection starts again.  5. After a telemetry interface collection task is configured on a sub-interface, you need to enable the statistics function on the sub-interface so that telemetry data can be properly sent to the collector. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| After a telemetry collection task is configured on an interface and the dual-stack statistics collection function is enabled on a sub-interface, the data collected and reported by the telemetry interface contains only IP unicast statistics, and IP multicast and broadcast statistics are 0. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| When the number of telemetry collection instances on an interface exceeds the board specification, the excess instances cannot be monitored. When the device is restarted, the telemetry collection instance takes effect randomly. You are advised to check whether an alarm indicating insufficient resources is generated before the restart. If yes, clear the alarm before the restart. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| 1. The sampled data can be reported through gRPC.  2. The source IP address for reporting the sampled data through gRPC can be configured.  3. Only one source IPv4 or IPv6 address can be configured for each subscription. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| 1. HQoS allows telemetry-based collection of default SQ and PQ queue statistics on interfaces to be performed.  2. Only telemetry-based sampling on Ethernet physical interfaces and trunk interfaces can be implemented.  3. Slow second-level telemetry-based statistic collection can be performed. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| 1. Telemetry statistics collection takes effect only after it is enabled. Port statistics collection starts when there is traffic on the port. Telemetry statistics collection starts after it is enabled. Telemetry statistics collection is independently performed. As a result, the two statistics results are inconsistent.  2. When telemetry interface statistics collection is used and detection services (such as BFD, TWAMP, 1ag, Y.1731, NQA 2544, Y.1564 and TP OAM) exist, detection packets are included in inbound telemetry statistics, which are different from interface statistics.  3. When telemetry interface statistics collection is used and eTM packet loss occurs, outbound telemetry statistics are inconsistent with interface statistics. You are advised to use port-queue statistics collection of HQoS to collect outbound statistics. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| 1. When the traffic policy is in shared mode, telemetry condition-based collection cannot be performed.  2. For the following two types of policies, the fastest sampling interval can only reach 1s. Even if the sampling interval is set to 100 ms, the sending interval will not be faster than 1s:  a. A policy containing the if-match any rule.  b. The shared policy on the multi-NP board | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H |
| 1. If an eTM subcard or a board is installed and HQoS is configured for the bandwidth, the HQoS function of common TE traffic statistics collection is implemented by the eTM subcard while the telemetry function is implemented by the NP. Therefore, the telemetry statistics and common traffic statistics may be different.  2. In inter-board scenarios such as the TE HSB switchover and outbound interface change, telemetry statistics are reset and statistics collection starts from 0 after the outbound interface is changed, which is different from common TE traffic statistics collection.  3. When common TE traffic statistics collection is switched between the CAR and statistics ID modes, telemetry statistics and common TE traffic statistics may be different.  4. In TE FRR protection, after the primary tunnel fails and traffic is transmitted through the bypass tunnel, the telemetry information reported by the primary tunnel does not contain the traffic after FRR switching, which is inconsistent with the statistics query result of the primary tunnel. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| Telemetry has four collection periods: 10 ms, 100 ms, 1s, and 30s. For objects whose minimum collection period is 10 ms or 100 ms, if the number of instances to be collected exceeds the specification of this level, the next level automatically starts. If the instance specification of the 30s-level is exceeded, the instances will not be monitored due to insufficient resources. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |