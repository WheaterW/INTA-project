Example for Configuring DHCPv6 Relay Dual-Device Hot Standby
============================================================

This section describes how to configure DHCPv6 relay dual-device hot standby for a VRRP6 group. After this function is configured and a master/backup VRRP6 switchover is performed, the new master device can properly process services without re-synchronizing user entries.

#### Networking Requirements

On the network shown in [Figure 1](#EN-US_TASK_0214168402__fig10868120113414), a VRRP6 group is configured on DeviceA and DeviceB to establish a master/backup relationship. DeviceA and DeviceB are the master and backup, respectively. Both DeviceA and DeviceB are DHCPv6 relay agents that forward DHCPv6 client and server messages.

In normal situations, DeviceA forwards user packets, and DeviceB receives user entries synchronized from DeviceA and generates PD routes based on the user entries. If DeviceA or the link between DeviceA and the switch fails, a master/backup VRRP6 switchover is performed, and DeviceB becomes the master. In this case, user packets are switched to DeviceB for forwarding. Users are unaware of the fault.

**Figure 1** Networking for configuring DHCPv6 relay dual-device hot standby![](../../../../public_sys-resources/note_3.0-en-us.png) 

Interfaces 1 through 3 in this example represent GE0/1/3, GE0/1/1, and GE0/1/2, respectively.


  
![](figure/en-us_image_0214957429.png)

**Table 1** Interface IP addresses
| Device | Interface | Address |
| --- | --- | --- |
| DeviceA | GE0/1/3 | 2001:db8:1::3/64 |
| GE0/1/1 | 2001:db8:3::2/64 |
| GE0/1/2 | 2001:db8:2::3/64 |
| DeviceB | GE0/1/3 | 2001:db8:1::2/64 |
| GE0/1/1 | 2001:db8:3::1/64 |
| GE0/1/2 | 2001:db8:2::2/64 |



#### Configuration Roadmap

The configuration roadmap is as follows:

1. Configure DHCPv6 relay.
2. Establish a dual-device backup platform.
3. Enable DHCPv6 relay remote backup.
4. Bind an RBP to an interface.
5. Set a cost value for PD routes generated by the backup device in the DHCPv6 relay dual-device hot standby scenario.
6. Configure daily periodic backup for DHCPv6 relay dual-device hot standby in the RBS view.

#### Data Preparation

To complete the configuration, you need the following data:

* ID of a VRRP6 group configured on DeviceA and DeviceB: 1; virtual IPv6 address of the VRRP6 group: 2001:db8:1::1
* Priority value of DeviceA in the VRRP6 group: 200; preemption delay: 1800s
* RBS name: service1; RBP name: profile1; backup ID: 10
* Cost value for PD routes generated by the backup device in the DHCPv6 relay dual-device hot standby scenario: 100

#### Procedure

1. Configure DHCPv6 relay.
   
   
   
   # Configure DeviceA.
   
   ```
   <HUAWEI> system-view
   ```
   ```
   [~HUAWEI] sysname DeviceA
   ```
   ```
   [*HUAWEI] commit
   ```
   ```
   [~DeviceA] dhcpv6 export pd-route
   ```
   ```
   [*DeviceA] interface GigabitEthernet 0/1/2
   ```
   ```
   [*DeviceA-GigabitEthernet0/1/2] ipv6 enable
   ```
   ```
   [*DeviceA-GigabitEthernet0/1/2] ipv6 nd dad attempts 0
   ```
   ```
   [*DeviceA-GigabitEthernet0/1/2] ipv6 address 2001:db8:2::3/64
   ```
   ```
   [*DeviceA-GigabitEthernet0/1/2] quit
   ```
   ```
   [*DeviceA] commit
   ```
   ```
   [~DeviceA] interface GigabitEthernet 0/1/3
   ```
   ```
   [~DeviceA-GigabitEthernet0/1/3] dhcpv6 relay destination 2001:db8:2::1
   ```
   ```
   [*DeviceA-GigabitEthernet0/1/3] dhcpv6 relay source-ip-address 2001:db8:2::3
   ```
   ```
   [*DeviceA-GigabitEthernet0/1/3] quit
   ```
   ```
   [*DeviceA] commit
   ```
   
   # Configure DeviceB.
   
   ```
   <HUAWEI> system-view
   ```
   ```
   [~HUAWEI] sysname DeviceB
   ```
   ```
   [*HUAWEI] commit
   ```
   ```
   [~DeviceB] dhcpv6 export pd-route
   ```
   ```
   [*DeviceB] interface GigabitEthernet 0/1/2
   ```
   ```
   [*DeviceB-GigabitEthernet0/1/2] ipv6 enable
   ```
   ```
   [*DeviceB-GigabitEthernet0/1/2] ipv6 nd dad attempts 0
   ```
   ```
   [*DeviceB-GigabitEthernet0/1/2] ipv6 address 2001:db8:2::2/64
   ```
   ```
   [*DeviceB-GigabitEthernet0/1/2] quit
   ```
   ```
   [*DeviceB] commit
   ```
   ```
   [~DeviceB] interface GigabitEthernet 0/1/3
   ```
   ```
   [~DeviceB-GigabitEthernet0/1/3] dhcpv6 relay destination 2001:db8:2::1
   ```
   ```
   [*DeviceB-GigabitEthernet0/1/3] dhcpv6 relay source-ip-address 2001:db8:2::2
   ```
   ```
   [*DeviceB-GigabitEthernet0/1/3] quit
   ```
   ```
   [*DeviceB] commit
   ```
2. Establish a dual-device backup platform.
   
   
   1. Configure basic VRRP6 group functions.
      
      # Configure DeviceA.
      
      ```
      [~DeviceA] interface GigabitEthernet 0/1/3
      ```
      ```
      [~DeviceA-GigabitEthernet0/1/3] ipv6 enable
      ```
      ```
      [*DeviceA-GigabitEthernet0/1/3] ipv6 nd dad attempts 0
      ```
      ```
      [*DeviceA-GigabitEthernet0/1/3] ipv6 address 2001:db8:1::3/64
      ```
      ```
      [*DeviceA-GigabitEthernet0/1/3] vrrp6 vrid 1 virtual-ip FE80::7 link-local
      ```
      ```
      [*DeviceA-GigabitEthernet0/1/3] vrrp6 vrid 1 virtual-ip 2001:db8:1::1
      ```
      ```
      [*DeviceA-GigabitEthernet0/1/3] vrrp6 vrid 1 priority 200
      ```
      ```
      [*DeviceA-GigabitEthernet0/1/3] vrrp6 vrid 1 preempt-mode timer delay 1800
      ```
      ```
      [*DeviceA-GigabitEthernet0/1/3] vrrp6 recover-delay 20
      ```
      ```
      [*DeviceA-GigabitEthernet0/1/3] quit
      ```
      ```
      [*DeviceA] commit
      ```
      
      # Configure DeviceB.
      
      ```
      [~DeviceB] interface GigabitEthernet 0/1/3
      ```
      ```
      [~DeviceB-GigabitEthernet0/1/3] ipv6 enable
      ```
      ```
      [*DeviceB-GigabitEthernet0/1/3] ipv6 nd dad attempts 0
      ```
      ```
      [*DeviceB-GigabitEthernet0/1/3] ipv6 address 2001:db8:1::2/64
      ```
      ```
      [*DeviceB-GigabitEthernet0/1/3] vrrp6 vrid 1 virtual-ip FE80::7 link-local
      ```
      ```
      [*DeviceB-GigabitEthernet0/1/3] vrrp6 vrid 1 virtual-ip 2001:db8:1::1
      ```
      ```
      [*DeviceB-GigabitEthernet0/1/3] quit
      ```
      ```
      [*DeviceB] commit
      ```
   2. Configure an RBS.
      
      # Configure DeviceA.
      
      ```
      [~DeviceA] interface GigabitEthernet 0/1/1
      ```
      ```
      [~DeviceA-GigabitEthernet0/1/1] ipv6 enable
      ```
      ```
      [*DeviceA-GigabitEthernet0/1/1] ipv6 nd dad attempts 0
      ```
      ```
      [*DeviceA-GigabitEthernet0/1/1] ipv6 address 2001:db8:3::2/64
      ```
      ```
      [*DeviceA-GigabitEthernet0/1/1] commit
      ```
      ```
      [~DeviceA-GigabitEthernet0/1/1] quit
      ```
      ```
      [~DeviceA] remote-backup-service service1
      ```
      ```
      [*DeviceA-rm-backup-srv-service1] peer-ipv6 2001:db8:3::1 source-ipv6 2001:db8:3::2 port 2046
      ```
      ```
      [*DeviceA-rm-backup-srv-service1] quit
      ```
      ```
      [*DeviceA] commit
      ```
      # Configure DeviceB.
      ```
      [~DeviceB] interface GigabitEthernet 0/1/1
      ```
      ```
      [~DeviceB-GigabitEthernet0/1/1] ipv6 enable
      ```
      ```
      [*DeviceB-GigabitEthernet0/1/1] ipv6 nd dad attempts 0
      ```
      ```
      [*DeviceB-GigabitEthernet0/1/1] ipv6 address 2001:db8:3::1/64
      ```
      ```
      [*DeviceB-GigabitEthernet0/1/1] commit
      ```
      ```
      [~DeviceB-GigabitEthernet0/1/1] quit
      ```
      ```
      [~DeviceB] remote-backup-service service1
      ```
      ```
      [*DeviceB-rm-backup-srv-service1] peer-ipv6 2001:db8:3::2 source-ipv6 2001:db8:3::1 port 2046
      ```
      ```
      [*DeviceB-rm-backup-srv-service1] quit
      ```
      ```
      [*DeviceB] commit
      ```
   3. Configure an RBP.
      
      # Configure DeviceA.
      
      ```
      [~DeviceA] remote-backup-profile profile1
      ```
      ```
      [*DeviceA-rm-backup-prf-profile1] peer-backup hot
      ```
      ```
      [*DeviceA-rm-backup-prf-profile1] vrrp6-id 1 interface GigabitEthernet 0/1/3
      ```
      ```
      [*DeviceA-rm-backup-prf-profile1] backup-id 10 remote-backup-service service1
      ```
      ```
      [*DeviceA-rm-backup-prf-profile1] quit
      ```
      ```
      [*DeviceA] commit
      ```
      # Configure DeviceB.
      ```
      [~DeviceB] remote-backup-profile profile1
      ```
      ```
      [*DeviceB-rm-backup-prf-profile1] peer-backup hot
      ```
      ```
      [*DeviceB-rm-backup-prf-profile1] vrrp6-id 1 interface GigabitEthernet 0/1/3
      ```
      ```
      [*DeviceB-rm-backup-prf-profile1] backup-id 10 remote-backup-service service1
      ```
      ```
      [*DeviceB-rm-backup-prf-profile1] quit
      ```
      ```
      [*DeviceB] commit
      ```
3. Enable DHCPv6 relay remote backup.
   
   # Enable DHCPv6 relay remote backup in the RBP view of DeviceA.
   ```
   [~DeviceA] remote-backup-profile profile1
   ```
   ```
   [~DeviceA-rm-backup-prf-profile1] service-type dhcpv6-relay
   ```
   ```
   [*DeviceA-rm-backup-prf-profile1] quit
   ```
   ```
   [*DeviceA] commit
   ```
   
   # Enable DHCPv6 relay remote backup in the RBP view of DeviceB.
   ```
   [~DeviceB] remote-backup-profile profile1
   ```
   ```
   [~DeviceB-rm-backup-prf-profile1] service-type dhcpv6-relay
   ```
   ```
   [*DeviceB-rm-backup-prf-profile1] quit
   ```
   ```
   [*DeviceB] commit
   ```
4. Bind the RBP to an interface.
   
   
   
   # Bind the RBP to the DHCPv6 relay interface on DeviceA.
   
   ```
   [~DeviceA] interface GigabitEthernet 0/1/3
   ```
   ```
   [~DeviceA-GigabitEthernet0/1/3] remote-backup-profile profile1
   ```
   ```
   [*DeviceA-rm-backup-prf-profile1] quit
   ```
   ```
   [*DeviceA] commit
   ```
   
   # Bind the RBP to the DHCPv6 relay interface on DeviceB.
   
   ```
   [~DeviceB] interface GigabitEthernet 0/1/3
   ```
   ```
   [~DeviceB-GigabitEthernet0/1/3] remote-backup-profile profile1
   ```
   ```
   [*DeviceB-rm-backup-prf-profile1] quit
   ```
   ```
   [*DeviceB] commit
   ```
5. Set a cost value for PD routes generated by the backup device in the DHCPv6 relay dual-device hot standby scenario.
   
   
   
   # Configure DeviceA.
   
   ```
   [~DeviceA] interface GigabitEthernet 0/1/3
   ```
   ```
   [~DeviceA-GigabitEthernet0/1/3] dhcpv6 relay pd-route degrade-cost 100
   ```
   ```
   [*DeviceA-GigabitEthernet0/1/3] quit
   ```
   ```
   [*DeviceA] commit
   ```
   
   # Configure DeviceB.
   
   ```
   [~DeviceB] interface GigabitEthernet 0/1/3
   ```
   ```
   [~DeviceB-GigabitEthernet0/1/3] dhcpv6 relay pd-route degrade-cost 100
   ```
   ```
   [*DeviceB-GigabitEthernet0/1/3] quit
   ```
   ```
   [*DeviceB] commit
   ```
6. Configure daily periodic backup for DHCPv6 relay dual-device hot standby in the RBS view.
   
   
   
   # Configure DeviceA.
   
   ```
   [~DeviceA] remote-backup-service service1
   ```
   ```
   [~DeviceA-rm-backup-srv-service1] batch-backup service-type dhcpv6-relay daily 03:00:00
   ```
   ```
   [*DeviceA-rm-backup-srv-service1] quit
   ```
   ```
   [*DeviceA] commit
   ```
   
   # Configure DeviceB.
   
   
   
   ```
   [~DeviceB] remote-backup-service service1
   ```
   ```
   [~DeviceB-rm-backup-srv-service1] batch-backup service-type dhcpv6-relay daily 03:00:00
   ```
   ```
   [*DeviceB-rm-backup-srv-service1] quit
   ```
   ```
   [*DeviceB] commit
   ```
7. Verify the configuration.
   
   After completing the configuration, run the [**display remote-backup-profile**](cmdqueryname=display+remote-backup-profile) command on DeviceA. The command output shows that the RBP **profile1** has been created.
   ```
   <DeviceA> display remote-backup-profile profile1
   ```
   ```
   -----------------------------------------------  
    Profile-Index        : 0x1003  
    Profile-Name         : profile1 
    Service              : dhcpv6-relay   
    Remote-backup-service: service1  
    Backup-ID            : 10  
    track protocol       : VRRP6  
    VRRP-ID              : 1  
    VRRP-Interface       : GigabitEthernet0/1/3  
    Access-Control       : --  
    State                : Master  
    Peer State           : --  
    Interface            :  
                            GigabitEthernet0/1/3  
    Backup mode          : hot  
    Slot-Number          : 1  
    Card-Number          : 0  
    Port-Number          : 0 
   ```
   
   Run the [**display remote-backup-profile**](cmdqueryname=display+remote-backup-profile) command on DeviceB. The command output shows that the RBP **profile1** has been created.
   ```
   <DeviceB> display remote-backup-profile profile1
   ```
   ```
   -----------------------------------------------  
    Profile-Index        : 0x1002  
    Profile-Name         : profile1 
    Service              : dhcpv6-relay   
    Remote-backup-service: service1  
    Backup-ID            : 10  
    track protocol       : VRRP6  
    VRRP-ID              : 1  
    VRRP-Interface       : GigabitEthernet0/1/3 
    Access-Control       : --  
    State                : Slave  
    Peer State           : --  
    Interface            :  
                           GigabitEthernet0/1/3 
    Backup mode          : hot  
    Slot-Number          : 1  
    Card-Number          : 0  
    Port-Number          : 0 
   ```
   
   Run the [**display remote-backup-service**](cmdqueryname=display+remote-backup-service) command on DeviceA. The command output shows that the RBS **service1** has been created.
   ```
   <DeviceA> display remote-backup-service service1
   ```
   ```
   ----------------------------------------------------------
    Service-Index    : 3
    Service-Name     : service1
    TCP-State        : Connected
    Peer-ip          : 2001:DB8:3::1
    Source-ip        : 2001:DB8:3::2
    TCP-Port         : 2046
    Track-BFD        : --
    SSL-Policy-Name  : --
    SSL-State        : --
    Last up time     : 2019-01-01 00:00:00
    Batch-backup     : 03:00:00(Daily) for service dhcpv6-relay
   ----------------------------------------------------------
   ```
   
   Run the [**display remote-backup-service**](cmdqueryname=display+remote-backup-service) command on DeviceB. The command output shows that the RBS **service1** has been created.
   ```
   <DeviceB> display remote-backup-service service1
   ```
   ```
   ----------------------------------------------------------  
    Service-Index    : 2  
    Service-Name     : service1  
    TCP-State        : Connected  
    Peer-ip          : 2001:DB8:3::2  
    Source-ip        : 2001:DB8:3::1  
    TCP-Port         : 2046
    Track-BFD        : --
    SSL-Policy-Name  : --
    SSL-State        : --
    Last up time     : 2019-01-01 00:00:00
    Batch-backup     : 03:00:00(Daily) for service dhcpv6-relay
   ----------------------------------------------------------
   ```

#### Configuration Files

* DeviceA configuration file
  
  ```
  # 
  sysname DeviceA 
  #
  dhcpv6 export pd-route
  #
  remote-backup-service service1
   peer-ipv6 2001:DB8:3::1 source-ipv6 2001:DB8:3::2 port 2046
   batch-backup service-type dhcpv6-relay daily 03:00:00
  #
  remote-backup-profile profile1
   service-type dhcpv6-relay 
   backup-id 10 remote-backup-service service1
   peer-backup hot
   vrrp6-id 1 interface GigabitEthernet 0/1/3
  #
  interface GigabitEthernet 0/1/3
   ipv6 enable
   ipv6 address 2001:DB8:1::3/64
   vrrp6 vrid 1 virtual-ip FE80::7 link-local
   vrrp6 vrid 1 virtual-ip 2001:DB8:1::1
   vrrp6 vrid 1 priority 200
   vrrp6 vrid 1 preempt-mode timer delay 1800
   vrrp6 recover-delay 20
   ipv6 nd dad attempts 0
   remote-backup-profile profile1
   dhcpv6 relay destination 2001:DB8:2::1
   dhcpv6 relay source-ip-address 2001:DB8:2::3
   dhcpv6 relay pd-route degrade-cost 100
  # 
  interface GigabitEthernet 0/1/1
   ipv6 enable
   ipv6 address 2001:DB8:3::2/64
   ipv6 nd dad attempts 0
  #
  interface GigabitEthernet 0/1/2
   ipv6 enable    
   ipv6 address 2001:DB8:2::3/64
   ipv6 nd dad attempts 0
  #
  return 
  ```
* DeviceB configuration file
  
  ```
  # 
  sysname DeviceB
  #
  dhcpv6 export pd-route
  #
  remote-backup-service service1
   peer-ipv6 2001:DB8:3::2 source-ipv6 2001:DB8:3::1 port 2046
   batch-backup service-type dhcpv6-relay daily 03:00:00
  #
  remote-backup-profile profile1
   service-type dhcpv6-relay 
   backup-id 10 remote-backup-service service1
   peer-backup hot
   vrrp6-id 1 interface GigabitEthernet 0/1/3 
  #
  interface GigabitEthernet 0/1/3
   ipv6 enable
   ipv6 address 2001:DB8:1::2/64
   vrrp6 vrid 1 virtual-ip FE80::7 link-local 
   vrrp6 vrid 1 virtual-ip 2001:DB8:1::1
   ipv6 nd dad attempts 0
   remote-backup-profile profile1
   dhcpv6 relay destination 2001:DB8:2::1
   dhcpv6 relay source-ip-address 2001:DB8:2::2
   dhcpv6 relay pd-route degrade-cost 100
  #
  interface GigabitEthernet 0/1/1
   ipv6 enable
   ipv6 address 2001:DB8:3::1/64
   ipv6 nd dad attempts 0
  #
  interface GigabitEthernet 0/1/2
   ipv6 enable
   ipv6 address 2001:DB8:2::2/64
   ipv6 nd dad attempts 0
  #
  return 
  ```