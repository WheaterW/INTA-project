Configuring an ESI
==================

An ESI must be configured on a PE interface connecting to a CE. The PE interfaces connecting to the same CE must have the same ESI configured.

#### Context

After PEs exchange routes that carry ESIs, a PE learns about other PEs connecting to the same CE as itself, helping implement load balancing or FRR.

Before configuring an ESI on an interface, ensure that:

* The interface has been bound to an I-EVPN instance using the [**evpn binding vpn-instance**](cmdqueryname=evpn+binding+vpn-instance) command.
* The interface with an ESI configured is in the up state. Otherwise, Ethernet segment routes cannot be generated. In scenarios where a CE is dual-homed to two PEs through an Eth-Trunk interface, an E-Trunk must be configured on the PEs to ensure that the two CE interfaces connecting to the PEs are both up.

An ESI can be obtained for an interface in the following ways:

* An ESI is statically configured on the interface.
* An ESI is dynamically generated on the interface.

![](../../../../public_sys-resources/note_3.0-en-us.png) 

The features required in an EVPN dual-homing scenario, such as fast convergence, split horizon, and DF election, all become invalid in a single-homing scenario. In such a scenario, configuring an ESI is optional on a single-homing PE.



#### Procedure

* (Optional) Configure an E-Trunk.
  1. Run [**system-view**](cmdqueryname=system-view)
     
     
     
     The system view is displayed.
  2. Run [**e-trunk**](cmdqueryname=e-trunk) *e-trunk-id*
     
     
     
     An E-Trunk is configured, and its view is displayed.
  3. Run [**priority**](cmdqueryname=priority) *priority*
     
     
     
     An E-Trunk priority value is configured.
  4. Run [**peer-address**](cmdqueryname=peer-address) *peer-ip-address* **source-address** *source-ip-address*
     
     
     
     IP addresses are configured for the local and peer ends of the E-Trunk.
  5. Run [**quit**](cmdqueryname=quit)
     
     
     
     Return to the system view.
  6. Run [**interface**](cmdqueryname=interface) **eth-trunk** *trunk-id*
     
     
     
     The Eth-Trunk interface view is displayed.
  7. Run [**e-trunk**](cmdqueryname=e-trunk) *e-trunk-id*
     
     
     
     The Eth-Trunk interface is added to the E-Trunk.
     
     
     
     An Eth-Trunk interface can be added to only one E-Trunk.
  8. Run [**quit**](cmdqueryname=quit)
     
     
     
     Return to the system view.
  9. Run [**lacp e-trunk system-id**](cmdqueryname=lacp+e-trunk+system-id) *mac-address*
     
     
     
     The E-Trunk Link Aggregation Control Protocol (LACP) system ID is configured.
     
     
     
     The LACP system IDs for the same E-Trunk must be the same.
  10. Run [**lacp e-trunk priority**](cmdqueryname=lacp+e-trunk+priority) *priority*
      
      
      
      An E-Trunk LACP system priority value is configured.
      
      
      
      The LACP system priority values for the same E-Trunk must be the same.
  11. Run [**commit**](cmdqueryname=commit)
      
      
      
      The configuration is committed.
* Statically configure an ESI.
  1. Run [**system-view**](cmdqueryname=system-view)
     
     
     
     The system view is displayed.
  2. Run [**interface**](cmdqueryname=interface) *interface-type* *interface-number*
     
     
     
     The interface view is displayed.
  3. Run [**esi**](cmdqueryname=esi) *esi*
     
     
     
     An ESI is configured.
  4. Run [**commit**](cmdqueryname=commit)
     
     
     
     The configuration is committed.
* Configure an interface to dynamically generate an ESI.
  1. Run [**system-view**](cmdqueryname=system-view)
     
     
     
     The system view is displayed.
  2. Run [**interface**](cmdqueryname=interface) **eth-trunk** *trunk-id*
     
     
     
     The Eth-Trunk interface view is displayed.
  3. Run [**mode**](cmdqueryname=mode) **lacp-static**
     
     
     
     The working mode of the Eth-Trunk interface is set to static LACP.
     
     
     
     After this command is run in the Eth-Trunk interface view, a dynamic ESI is automatically generated.
  4. (Optional) Run [**ignore dynamic-esi**](cmdqueryname=ignore+dynamic-esi)
     
     
     
     The device is configured to ignore dynamically generated ESIs.
     
     
     
     After the [**mode**](cmdqueryname=mode) **lacp-static** command is run on an interface, an ESI is dynamically generated by default. In a single-homing scenario, ESIs are not required. To enable an interface to ignore dynamically generated ESIs, run this command. In a PBB-EVPN scenario, no ESIs are generated for Ethernet A-D and Ethernet segment routes, and MAC routes carry all-0 ESIs.
  5. Run [**commit**](cmdqueryname=commit)
     
     
     
     The configuration is committed.