Configuration Precautions for VPLS
==================================

Configuration_Precautions_for_VPLS

#### Feature Requirements

**Table 1** Feature requirements
| Feature Requirements | Series | Models |
| --- | --- | --- |
| In the control word scenario, the control word value of TP OAM is 0X10007FFA, the control word value of BFD and ping packets is 0X10000021, and other control word values are forwarded in data packets. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| The restrictions on dot1q termination interfaces in qualify mode are as follows:  1. CE ping is not supported after qualify is configured for dot1q termination interfaces. The CE cannot be pinged.  2. After qualify is configured for a PW in dot1q termination or VLAN mode, the PW learns the outer VLAN tag. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| On a dot1q VLAN tag termination sub-interface, the single leaf mode (configured using the dot1q termination client-mode single command) and VLAN-based QoS profile (configured using the qos-profile xx outbound vlan xx command) are mutually exclusive if front TM chips are used.  Do not configure both dot1q termination client-mode single and QoS-profile <profile-name> { inbound | outbound } vlan <vlan-id1> [ to <vlan-id2> ] [ identifier { vlan-id | none } ] [ group <group-name> ] on a dot1q VLAN tag termination sub-interface. | NE40E-M2 | NE40E-M2E |
| LDP FRR, LDP RLFA, TE FRR, TE best-effort path, TE protection group, BGP FRR, and backup tunnel paths do not support VPLS QoS. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| Only one outbound interface of an SR-MPLS TE node tunnel supports VPN QoS. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| When a VLANIF interface is bound to a VSI, VLAN stacking cannot be configured on VLAN member interfaces. Otherwise, traffic is interrupted. The configuration is not limited. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| When a VPLS switches from the decoupling mode to the non-decoupling mode, a short-time traffic interruption occurs, and unicast transmission changes to broadcast transmission. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| After VPLS is decoupled, the ACL command cannot be used to control the matching of inner IP addresses. As a result, the public network outbound interface information cannot be detected. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| When VPLS forwarding is not decoupled, VPLS does not support ECMP or TI-LFA for SR-MPLS TE. As a result, protection does not take effect and the switching performance is poor.  It is recommended that VPLS decoupling (mpls vpls convergence separate enable) be configured. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| In a VPN QoS scenario where the network-side outbound interfaces are located on different interfaces, bandwidth limiting and guarantee are performed based on each interface. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| PW traffic suppression can be configured for a B-VSI in either of the following scenarios:  1. If no spoke PW configuration exists, unknown unicast, multicast, and broadcast suppression does not take effect. In P2P mode, when a packet is sent from a PE in the upstream direct, it is matched against entries in the decapsulation table. If a matching entry is found, the packet is unicast. If the packet does not match any entry in the decapsulation table, the packet is discarded.  2. When a spoke PW is configured and the spoke PW is up, traffic suppression is performed based on the B-DMAC address for packets that do not match the decapsulation table and are forwarded to the spoke PW. Because the B-DMAC address cannot be a multicast or broadcast MAC address, only unknown unicast traffic suppression takes effect, multicast and broadcast suppression does not take effect. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| For public network tunnels:  In VPLS over GRE scenarios, flow labels can be configured, and flow labels can be encapsulated. However, P nodes cannot perform load balancing based on flow labels. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| By default, loopback is not allowed on UNIs of VLL\VPLS\EVPN\L2TPV3\PORTSWTICH\MODE L2, but is allowed on Ethernet interfaces, Ethernet sub-interfaces, Eth-Trunk interfaces, and Eth-Trunk sub-interfaces. Other types of interfaces are not supported. Loopback will cause broadcast storms on the Layer 2 network.  It is recommended that you not configure loopback for services that are not supported. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| Currently, multicast supports only per-interface VPLS QoS and does not support per-VSI VPLS QoS. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| In a Layer 2 loop detection scenario, if the loop-detect block command is run before the flapping function is configured and a loop has occurred, the interface is blocked first. Due to a time sequence error, the intermittent disconnection function is not performed.  You are advised to configure the intermittent disconnection function before the blocking recovery function is enabled. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| Layer 3 ping on Layer 2 interfaces has the following restrictions:  AC-side interfaces support VLANIF and sub-interface access. AC-side interfaces cannot be VE interfaces, QinQ interfaces, or main interfaces.  PW-side interfaces can be Ethernet interfaces, Ethernet sub-interfaces, TE interfaces, Eth-Trunk interfaces, or Eth-Trunk sub-interfaces. Currently, other PW-side interfaces are not supported.  If the preceding conditions are not met, the ping operation fails. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| After a VSI in P2P mode is configured, broadcast or multicast features such as Layer 2 suppression, MAC address learning limit, and IGMP snooping are not supported.  It is recommended that you not configure the multicast and broadcast functions after configuring the VSI in P2P mode. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| When loop detection is configured on a PE, the number of PE interfaces on which a loop occurs cannot exceed two. Otherwise, loop detection does not take effect.  It is recommended that you configure loop detection on a maximum of two interfaces to detect a loop. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| In VPLS non-decoupling scenarios, the following are not supported:  1. TE over GRE  2. LDP over TE over GRE  3. BGP over TE over GRE  4. BGP over LDP over TE over GRE  5. SR-MPLS Policy  6. BGP over SR-MPLS Policy  7. SR-MPLS BE over GRE  8. SR-MPLS TE over GRE  9. SR-MPLS Policy over GRE  10. SR-MPLS TE over RSVP-TE  11. SR-MPLS Policy over RSVP-TE  If any of them is used, traffic cannot be forwarded. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| VLL VPN QoS does not support the following scenarios:  1. TE over GRE  2. LDP over TE over GRE  3. BGP over TE over GRE  4. BGP over LDP over TE over GRE  5. BGP over SR-MPLS Policy  6. SR-MPLS BE over GRE  7. SR-MPLS TE over GRE  8. SR-MPLS TE over RSVP-TE  9. SR-MPLS Policy over RSVP-TE  In the preceding scenarios, traffic may fail to be forwarded when VPN QoS is used. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| Currently, only LDP VLL/VSI detection is supported. BGP VSI and VLL detection and PW switching are not supported. The configuration of an unsupported function does not take effect.  Deploy it properly. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| On a Layer 2 network, if a tag is removed or encapsulated or the VLAN ID or VLAN priority is modified in packets, a false alarm for the loop detection function may be reported or loop detection does not take effect.  Deploy it properly. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| When a physical main interface is blocked, its physical sub-interfaces are not blocked. When a trunk interface is blocked, its member interfaces are also blocked, but the trunk sub-interfaces are not blocked.  Deploy it properly. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| Loop detection can be performed on an interface only when the following conditions are met:  1. Entire-port transparent transmission is configured on the main interface.  2. Loop detection is enabled on the main interface.  3. The detection VLAN on the local main interface is the same as the detection VLAN (if the detection VLAN is not configured, the service VLAN is used) on the peer sub-interface.  If the VLAN configuration on the local main interface is different from that on the peer sub-interface, a false blocking may occur.  Deploy it properly. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| After the device is restarted, as long as the BFD session status is not Up, the primary and secondary PWs are associated for service switching. The PW whose BFD detection status is Up is preferentially served. However, if the primary and secondary PWs are not Up, PW switching is not affected. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| A VE ID is used as an identifier for a site to access a BGP VPWS or BGP VPLS network.  1. If a CE is dual-homed to PEs, the same VE ID can be assigned to different PEs.  2. In a non-dual-homing scenario, different PEs cannot be assigned the same VE ID. When BGP VPWS or BGP VPLS assigns the same VE ID to sites on different PEs, the VE IDs affect each other. As a result, services cannot be established.  Plan VE IDs (site-id for BGP VPLS and ce-id for BGP VPWS) properly to ensure that different sites accessing BGP VPLS or BGP VPWS services use different VE IDs. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| In an active-active scenario where primary and secondary PWs of a VPLS interwork with a VXLAN, the VXLAN cannot interwork with an EVPN. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| In a scenario where primary and secondary PWs of a VPLS interwork with a VXLAN, the ignore-standby-state parameter cannot be configured for the PW on a DC GW. The BUM traffic from the TOR switch to the PE-AGG may be duplicated. The PE-AGG -&gt; TOR switch traffic may flow back to the PE-AGG. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |