Configuration Precautions for Multi-device backup for user access
=================================================================

Configuration_Precautions_for_Multi-device_backup_for_user_access

#### Feature Requirements

**Table 1** Feature requirements
| Feature Requirements | Series | Models |
| --- | --- | --- |
| Limitations on multi-device backup cross-vrsion hitless upgrade | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K |
| Restrictions on IPv6 hot backup:  1. In ND mode, only the unshared prefix mode is provided.  2. Protection tunnels for IPv6 services allow only MPLS LSPs and SRV6 tunnels (6PE and 6VPE models).  3. Hot backup cannot be configured in IPv6 multicast scenarios.  Do not deploy IPv6 hot backup together with IPv6 hot backup in scenarios where co-deployment is not allowed. Otherwise, the preceding functions do not take effect on the standby device. | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| Restrictions on L2TP hot backup:  1. Hot backup is supported only on the LAC.  2. The interval for sending Hello packets for the L2TP tunnel (configured using the tunnel timer hello interval command) must use the default value 60s, and the Hello function cannot be disabled.  3. The LAC's IP address applies only to L2TP services.  4. Only the loopback interface IP address can be used as an LAC's source IP address for communication with an LNS.  5. The IP core network cannot use a static route to specify the LAC IP route.  6. The set l2tp tunnel base-id <base-id> command must be run on the backup device to change the base address of the tunnel ID to be different from that on the master device.  7. The RADIUS-delivered No. 66 attribute Tunnel-Client-Endpoint is not supported.  8. The switchback delay for VRRP on the master device must be configured using the vrrp vrid <virtual-router-id> preempt-mode timer delay <delay-value> command. Configuring a switchback delay of 30 minutes is recommended..  Do not deploy LAC hot backup in scenarios that are not supported. Otherwise, the backup device does not take effect. | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| In RUI scenarios where load balancing is implemented based on odd and even MAC addresses, only static users with odd MAC addresses can go online if no MAC address is specified. Plan sub-interfaces properly. For example, configure RUI load balancing based on odd and even MAC addresses on one sub-interface, and configure static users for whom the device sends packets to trigger user login from another sub-interface. | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| In a hot backup scenario where a BRAS is restarted, users are not logged out and accounting is not re-performed for the users. The BRAS sends Accounting-On/Accounting-Off packets to the accounting server. If the policy for processing the Accounting-On/Accounting-Off packets configured on the server will interrupt accounting services for the users, the accounting server must support special processing for hot backup users, such as restoring user records, processing and merging accounting information. If special processing is not supported for hot backup users, accounting is interrupted for all users. | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| In multi-device hot backup scenarios, the function to redirect users to a specified domain upon quota exhaustion is supported only on the master device or the device switched to the master device. The redirection function does not take effect on the backup device. | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| When an RUI master/backup switchover occurs during user access, the user fails to go online in the following scenarios: The user completes RADIUS proxy authentication on the original master devcie, but a master/backup switchover occurs when the user doe not complete subsequent access. The user's subsequent access packets are sent to the new master device. The new master device determines that the user is not authenticated and denies the user's access.  The affected period is related to the interval between completing RADIUS proxy authentication and subsequent access processing. The typical period is hundreds of milliseconds (the maximum value is not more than 2 minutes). After the user fails to dial up, the user cannot go online in automatic re-dialup mode. Manual re-dialup is required. | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| When traffic is transmitted through the protection tunnel, enabling URPF on a network-side interface may cause a URPF check failure and a traffic forwarding error. Disable URPF on the network-side interface as required. Detour traffic includes IPoE/PPP/L2TP user traffic passing through the protection tunnel.  In RUI scenarios, deploying URPF on the network side is not recommended. | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| On a BNG, the master/backup status of the RADIUS proxy interface must be the same as that of the interface through which RADIUS proxy users go online. Otherwise, the RADIUS proxy cannot support dual-device hot backup. | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| The backup device fails to ping users (users on the backup device are in the slave state and cannot be pinged but the users can be pinged on the master device). Do not ping the terminal on the backup device. | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| In multi-device backup scenarios, a device can establish backup relationships with up to four devices. | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| When L3VPN access users exist in multi-device backup scenarios, the names of the same VPN on the master and backup MSCGs must be the same. Otherwise, users fail to go online from the backup device. | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| In multi-device backup scenarios, the master and backup devices do not support fast ARP reply. By default, ARP packets are processed on the slave core. The slave core processes ARP probe packets. When ARP attacks occur, the CPU usage of the interface board is affected. | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| In multi-device backup scenarios, a DHCPv6 user goes online from a remote address pool using an LDRA packet carrying multi-level relay information. If a master/backup device switchover is performed and a user is triggered to go online after going offline unexpectedly, the packet sent to the remote address pool carries only one level of relay information. | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| 1. If you want an RUI protection tunnel to be carried over an SRv6 tunnel, the SRv6 tunnel must be a TE policy tunnel that works in encap mode (the egress of the tunnel supports the USD capability). If the SRv6 tunnel works in non-encap mode, the SRv6 RUI protection tunnel cannot go Up.  2. RUI protection tunnels do not support penultimate hop popping (PHP) in SRv6 scenarios, and traffic can be popped only on the last hop of a tunnel. If PHP is configured, the protection tunnel does not take effect. When a network-side fault occurs, packet loss occurs on the network-side traffic that is switched to the backup device and transmitted through the protection tunnel.  3. Each RBS can be configured to carry only one RUI SRv6 protection tunnel, and color-based route selection is not supported. Network-side detour traffic can be transmitted only through one RUI SRv6 protection tunnel specified in the RBS. If the configured color path fails, the protection tunnel cannot go Up.  4. Dual-device tunnels generated after SRv6 BE protection tunnels are configured do not take effect. As a result, traffic fails to be forwarded through the tunnels.  Properly plan the SRv6 tunnel type and networking. | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| If the user name (containing the pure user name and domain name) in the authentication domain is the same as that in the pre-authentication domain, the user on the backup device is not switched to the authentication domain. If pre-authentication and authentication domain switching is required in RUI scenarios, ensure that the pre-authentication and authentication domains are different. Otherwise, users on the backup device will be in the pre-authentication domain state. | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| In dual-device hot backup scenarios, the same Framed-Route network segment cannot be delivered to users in different master/backup states on the same device. Otherwise, there is a possibility that network-to-user traffic fails to be forwarded. | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| In a multi-device backup U-shaped networking scenario, if the intermediate link between two switches fails and two VRRP master devices (DeviceA is the original master device, and DeviceB is the original backup device) exist, a small number of users may be logged out due to lease expiration. Cause: During the dual-master period, DeviceA and DeviceB cannot detect each other's status. During this period, if some users successfully renew the lease on DeviceB, automatic lease renewal is not performed on DeviceA. After DeviceB becomes the backup device, the terminals do not immediately send lease renewal packets to DeviceA because the leases of these users have been renewed on DeviceB. As a result, these users are logged out on DeviceA when their leases expire. | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| RUI supports the following user types:  Layer 2 DHCPv4 users  Layer 2 DHCPv6 users  Layer 2 IPoEv4 static users  Layer 2 IPoEv6 static users  Layer 3 IPv4 static users  Layer 3 IPv6 static users  PPPv4OX users  PPPv6OX users  L2TP users on the LAC side  RUI does not support the following user types:  Layer 3 DHCPv4/DHCPv6 users  Layer 2/Layer 3 leased line users  Local authentication users  L2TP users on the LNS side | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |