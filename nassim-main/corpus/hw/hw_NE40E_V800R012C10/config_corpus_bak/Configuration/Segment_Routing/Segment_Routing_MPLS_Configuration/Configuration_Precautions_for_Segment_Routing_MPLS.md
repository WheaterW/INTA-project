Configuration Precautions for Segment Routing MPLS
==================================================

Configuration_Precautions_for_Segment_Routing_MPLS

#### Feature Requirements

**Table 1** Feature requirements
| Feature Requirements | Series | Models |
| --- | --- | --- |
| BFD is used to detect the reliability of segment lists in an SR-MPLS TE Policy. If all segment lists of the primary candidate path fail, traffic is switched to the backup candidate path. If all segment lists of the backup candidate path fail, BFD goes Down, triggering the SR-MPLS TE Policy to go Down. As a result, VPN FRR switching occurs. In this case, no new candidate path will be selected for traffic forwarding even if there are other candidate paths in the SR-MPLS TE Policy. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| In SR-MPLS TE ingress over GRE scenarios, GRE header compensation is not performed during TE tunnel statistics collection. The number of bytes and rate of the TE tunnel are different from the actual traffic. You can view GRE tunnel statistics or traffic statistics on the actual outbound interface. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| If the configured static BFD for SR-MPLS TE LSP is incomplete, the SR-MPLS TE LSP goes Down. If a dynamic BFD for SR-MPLS TE LSP is configured before an incomplete static BFD for SR-MPLS TE LSP, the SR-MPLS TE LSP may remain Up. However, after an active/standby switchover is performed or the device is restarted, the SR-MPLS TE LSP goes Down.  If the configured static BFD for SR-MPLS TE tunnel is incomplete, the SR-MPLS TE tunnel goes Down. If dynamic BFD for SR-MPLS TE tunnel is configured first, the SR-MPLS TE tunnel may remain Up. However, after an active/standby switchover is performed or the device is restarted, the SR-MPLS TE tunnel goes Down. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| If the candidate path of an SR-MPLS TE Policy dynamically created by ODN conflicts with that of a statically configured SR-MPLS TE Policy, the static candidate path takes effect. When the static candidate path is deleted, ODN candidate path creation is restored, and the ODN candidate path is delegated for path computation. If the static candidate path is deleted before the new path is computed, service traffic may be interrupted. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| A maximum of five levels of load balancing may be performed in SR-MPLS TE Policy multi-level load balancing scenarios:  Level 1: VPN ECMP  Level 2: Load balancing among multiple SR-MPLS TE Policies in an SR-MPLS TE Policy group  Level 3: Load balancing among multiple segment lists in an SR-MPLS TE Policy  Level 4: Load balancing based on node/adjacency SIDs in a segment list  Level 5: Load balancing among the member interfaces of an Eth-Trunk, which functions as the outbound interface corresponding to a specified adjacency SID  In scenarios with more than three levels of load balancing, if the number of channels involved in level-1 load balancing and that involved in level-4 load balancing are integer multiples of each other and the hash factors used for the two levels of load balancing are the same, level-4 load balancing fails.  This limitation also applies to level-2 and level-5 load balancing.  In this case, you can run the load-balance hash-arithmetic command to change the hash algorithm to the XOR algorithm in order to add one level of load balancing. For details, see the description of the load-balance hash-arithmetic command in the product documentation. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| When SR-MPLS TE Policy service packets are encapsulated with more than 13 SIDs (for example, in an SR-MPLS TE Policy TI-LFA scenario), the downstream device cannot parse the IP 5-tuple of the packets, causing uneven load balancing. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| When binding SIDs are used for inter-AS E2E SR-MPLS TE tunnels, the following restrictions exist:  1. When the number of layers in a label stack exceeds 3, the tunnel does not go Up.  2. If a one-layer label stack is configured and the label type is Binding SID, the packet priority mapping, statistics collection, MTU, and TTL functions of the tunnel are not supported. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| If an SR-MPLS TE tunnel uses a BGP-EPE label as the first label and the BGP-EPE label corresponds to multiple outbound interfaces, TE bandwidth limit is not supported. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| Segment Routing MPLS ingress and egress nodes cannot be configured as anycast protection nodes. Anycast protection means that multiple devices are configured with the same prefix SID. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| Segment Routing tunnels support only upstream NetStream sampling on the ingress and NetStream sampling on the egress, but do not support downstream NetStream sampling on the ingress or NetStream sampling on a transit node. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| SR-MPLS TE Policies do not support recursion between tunnels.  1. SR-MPLS TE Policies cannot recurse to other types of tunnels (including SR-MPLS TE Policy tunnels).  2. Other types of tunnels cannot recurse to SR-MPLS TE Policies.  Incorrect configuration will cause traffic interruption. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| Segment Routing tunnels established using node SIDs do not support rate limiting.  When the controller delivers SR tunnels established based on node SIDs, bandwidth must be guaranteed. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| SR-MPLS TE tunnels established using adjacency SIDs do not support SR-MPLS TE anycast protection.  Anycast protection can be configured for SR-MPLS TE tunnels consisting of node SIDs. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| The function of detecting BGP EPE outbound interface faults and triggering service switching through SBFD for SR-MPLS TE tunnel can be used only when the following conditions are met:  1. The destination of the SR-MPLS TE tunnel is the local ASBR node of BGP EPE.  2. The innermost label in an SR-MPLS TE label stack is a BGP EPE label.  3. SBFD for SR-MPLS TE tunnel has been deployed. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| The function of detecting BGP EPE outbound interface faults and triggering service switching through SBFD for SR-MPLS TE tunnel can be used only when the BGP EPE outbound interface is an Ethernet main interface, Ethernet sub-interface, Eth-Trunk main interface, Eth-Trunk sub-interface, or POS interface.  If the type of the BGP EPE outbound interface is not supported, traffic cannot rapidly recover in the case of a BGP EPE outbound interface fault. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| The function of detecting BGP EPE outbound interface faults and triggering service switching through SBFD for SR-MPLS TE tunnel poses the following risks if seven or more BGP EPE links fail at the same time in BGP EPE load balancing scenarios:  1. Although traffic can continue to be forwarded, SR-MPLS TE SBFD goes down, triggering traffic convergence or switching on the ingress of an SR-MPLS TE tunnel.  2. Data packets are discarded, but SBFD is still up. As a result, traffic recovers until BGP EPE convergence is complete.  Do not deploy seven or more BGP EPE links for load balancing. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| The function of detecting BGP EPE outbound interface faults and triggering service switching through SBFD for SR-MPLS TE tunnel applies only to scenarios where inter-AS public IP unicast packets are transmitted over SR-MPLS TE tunnels.  Suggestions:  1. Disable the MPLS TE IGP shortcut function on SR-MPLS TE tunnel interfaces to prevent unexpected public IP traffic from recursing to inter-AS SR-MPLS TE tunnels.  2. Configure redirection to steer inter-AS traffic to inter-AS SR-MPLS TE tunnels.  3. Run the mpls te reserved-for-binding command on SR-MPLS TE tunnel interfaces to prevent VPN traffic from recursing to inter-AS SR-MPLS TE tunnels. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| A maximum of 64 BGP EPE links can be configured for load balancing. If more than 64 BGP EPE links exist, the first 64 links are selected based on the OutIfIndex values of outbound interfaces in descending order. If the sixty-fourth and sixty-fifth links have the same OutIfIndex value, the one with the largest NextHop value is selected. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| The function of enabling BGP EPE outbound interface faults to trigger routing table lookups due to the rollback of public IP unicast traffic can be used when the outbound interface of a BGP EPE link is an Ethernet, ETH-Trunk, or POS interface. Other types of interfaces do not support fast switching. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| SR-MPLS TE Policy load balancing based on segment list weights has the following restrictions:  1. The load balancing precision is 1/128.  2. The segment list whose weight percentage is less than 1/128 does not forward traffic. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| In a scenario where SR-MPLS TE Policy load balancing is implemented based on segment list weights, segment list weight adjustment has the following restrictions:  1. If SBFD for Segment List is not configured and the segment list weight is changed from a non-zero value to 0, packet loss may occur.  2. If SBFD for Segment List is not configured and the segment list weight is changed from 0 to a non-zero value, packet loss may occur.  3. If SBFD for Segment List is configured and the segment list weight is changed from a non-zero value to 0, the protocol side has a deletion delay (the default deletion delay is 20s and can be configured). A proper deletion delay can prevent packet loss.  4. If SBFD for Segment List is configured and the segment list weight is changed from 0 to a non-zero value, packet loss may occur.  You are advised to configure SBFD for Segment List and run the sr-te-policy delete-delay command to adjust the delay after which the segment list is deleted in a scenario where SBFD goes Down. This reduces or prevents packet loss when the segment list weight is changed from a non-zero value to 0. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| Path verification cannot be enabled on the ingress of an inter-AS SR-MPLS TE tunnel. If path verification is enabled, LSPs cannot be created due to path verification failures. Ensure that the mpls te path verification enable command is not run. By default, the function is disabled. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| If SBFD is enabled after SR-MPLS TE Policy configuration, the candidate paths under the SR-MPLS TE Policy and the segment lists of the candidate paths are initially up. However, if SBFD is not configured on the reflector end, the segment list state is set to down after the BFD negotiation timeout period (5 minutes) expires.  You are advised to enable SBFD before SR-MPLS TE Policy configuration. In addition, configure SBFD on the reflector end. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| If the first hop of an explicit path is assigned a BSID (indicating that the tunnel that references the explicit path needs to use the tunnel assigned the BSID for forwarding), the first hop of the explicit path used by the tunnel assigned the BSID cannot be configured with a BSID. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| If BFD is configured on the ingress to forward return packets over the tunnel corresponding to the specified BSID but the egress does not have the tunnel corresponding to the BSID, the BFD session goes Down.  You are advised to configure the tunnel corresponding to the BSID on the egress to ensure that the BFD return tunnel is Up. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| If the outer label of the explicit path label stack of an SR-MPLS TE tunnel is a BSID or the label stack contains a BSID, the depth of the label stack cannot exceed 3 layers. Otherwise, the tunnel cannot go Up. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| CSPF local path computation for SR-MPLS TE tunnels supports node labels. The prefix SID of a node must be unique in an IGP domain. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| When a BSID is configured for an explicit path, the system does not check whether the tunnel corresponding to the BSID exists or is Up. If the tunnel does not exist or is not Up, the tunnel established over the explicit path can go Up but fails to forward traffic. Therefore, ensure that the configuration is correct.  You are advised to configure BFD. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| After a BSID is configured for a tunnel and is referenced by an explicit path, the BSID of the tunnel cannot be modified or deleted. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| After the device is restarted, BFD does not process the Up state. If BFD is not Up, the Flex-Algo LSP is set to Down. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| When CSPF is used to compute SR-MPLS TE LSPs, if the involved node supports SR and has IGP multi-process configured, ensure that node labels are configured or not configured for all processes on the node. Otherwise, CSPF-based path computation may fail. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| If a BSID is configured for a tunnel and is referenced by an explicit path, the tunnel cannot be deleted. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| After device restart, tunnels are not processed if the BFD state is Up. If the BFD state is not Up, the tunnels are set to Down. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| In a scenario where a device is restarted, if a BFD session or peer is in the Admin Down state, the SR-MPLS TE Policy status is not affected. However, if the BFD session is renegotiated and goes Down, the SR-MPLS TE Policy also goes Down. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| You are advised to configure the same SRGB range on the entire network. Ensure that the SR-MPLS BE prefix/node SID of a device does not exceed the SRGB range of other nodes on the network. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| The SID forwarding entry corresponding to an IP route prefix is generated only when the IP route of the involved process is active. When multiple processes or protocols are deployed, the following restrictions exist. Otherwise, SR-MPLS BE and SR-MPLS TE traffic may fail to be forwarded.  1. Do not advertise the IP route prefix used for SID advertisement in multiple processes or protocols at the same time.  2. If the route must be advertised through multiple processes or protocols at the same time, ensure that the IP route advertised by the protocol or process used for SID advertisement has the highest priority on the device within the SID advertisement range. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| When the outer label in the label stack of an SR-MPLS TE explicit path is a binding SID, the label stack depth cannot exceed three layers. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| When the automatic bandwidth sampling interval of the PCE-initiated path delivered by the controller is less than 60s, 60s takes effect. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| When the automatic bandwidth adjustment interval configured for a controller-delivered PCE-initiated SR-MPLS TE Policy is less than 300s, the interval of 300s takes effect. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |