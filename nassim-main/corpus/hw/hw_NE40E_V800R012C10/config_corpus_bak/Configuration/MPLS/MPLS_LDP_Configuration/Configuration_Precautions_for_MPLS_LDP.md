Configuration Precautions for MPLS LDP
======================================

Configuration_Precautions_for_MPLS_LDP

#### Feature Requirements

**Table 1** Feature requirements
| Feature Requirements | Series | Models |
| --- | --- | --- |
| In non-decoupling mode, the longest-match command is configured to generate an LDP tunnel based on network segment routes. When the LDP tunnel does not carry services, if BFD for LDP is configured, the LDP tunnel status is not affected even if BFD does not go Up. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| mLDP P2MP LSPs cannot be established on TE tunnel interfaces. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| Ensure that MPLS LDP is deployed on all interfaces along the path to which routes are converged. (If the outbound interface is a TE tunnel interface, deploy a remote LDP peer relationship. If the outbound interface is a non-TE tunnel interface, deploy MPLS LDP on the interface.) This prevents LDP LSPs from being deleted and traffic from being interrupted when routes are converged to an interface that is not deployed with MPLS LDP. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| Ensure that MPLS LDP is configured on all outbound interfaces of the paths to which the routes to a root may pass and that the mpls mldp p2mp disable command is not run. This prevents mLDP P2MP LSPs from being deleted when routes are converged to mLDP P2MP-incapable interfaces, thereby avoiding multicast traffic interruptions. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| During mLDP P2MP LSP establishment, the device preferentially searches for IGP routes based on the longest match rule to establish intra-AS mLDP P2MP LSPs. If no IGP route is found, the device searches for BGP routes based on the longest match rule to establish inter-AS mLDP P2MP LSPs. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| If the memory of the main control board is less than or equal to 4 GB or the number of CPU cores on the main control board is less than or equal to 2, it is recommended that the number of LDP sessions be less than or equal to 1500 and the number of VPWS sessions be less than or equal to three times the number of sessions, service flapping may occur in the stable state or during an active/standby switchover.  In LDP VPWS, LDP sessions are configured between PEs to transmit VC signaling. The local PE needs to establish an LDP session with each remote PE. If there are too many remote PEs, a large number of LDP sessions are established.  By default, the device advertises LDP label messages to all sessions. If there are a large number of sessions, a large number of system resources are occupied. As a result, the memory or CPU of the device is overloaded, and even service flapping occurs.  You are advised to take the following preventive measures:  1. If LDP over TE is not deployed on the network, you can run the remote-ip pwe3 command to reduce the burden on the device.  2. To reduce the number of LDP sessions and VPWSs on a device, split services to multiple devices. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| mLDP does not support the following types of outbound interfaces: VLANIF interfaces, Eth-Trunk dot1q VLAN tag termination sub-interfaces, Eth-Trunk QinQ VLAN tag termination sub-interfaces, and low-speed interfaces.  Run the mpls mldp p2mp disable command on the unsupported outbound interface to prevent the protocol from selecting this interface. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| mLDP over TE is not supported.  Ensure that MPLS TE is not enabled on interfaces on the mLDP path to prevent mLDP from using a TE tunnel interface as the outbound interface. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| When the outbound interface of an LDP LSP is a sub-interface, BFD can be associated with LDP FRR/TI-LFA fast switching on the sub-interface only in the following conditions:  1. The interface type is Ethernet sub-interface or Eth-Trunk sub-interface.  2. The conditions for binding BFD to the IP address of the sub-interface are met. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| When penultimate hop popping (PHP) is enabled, the egress node does not support the PIPE mode. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| MBB traffic detection is enabled. If only some MBB LSP traffic is received within a short period of time (seconds) during MBB convergence, MBB switching is triggered in advance, causing packet loss.  You are advised to take the following preventive measures:  1. By default, the NG MVPN ingress works in non-aggregation mode. You can run the "ng-mvpn forwarding-mode aggregation" command to configure the NG MVPN ingress to work in aggregation mode.  2. No workaround is available in other scenarios. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| If SR-MPLS BE TI-LFA is used as the backup path of LDP FRR, LDP ECMP and LDP FRR cannot coexist.  If both LDP ECMP and LDP FRR are enabled, LDP ECMP takes effect preferentially. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| LDP and SR-MPLS BE decoupling must be enabled before SR-MPLS BE TI-LFA is used as the LDP FRR backup path. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| In an NG MVPN scenario, mLDP needs to obtain the next hop address of a BGP route on an inter-AS node. This address must be an IPv4 address that is reachable using an IGP. If the next hop of the BGP route is an IPv6 address, an mLDP tunnel cannot be established.  Examples of unsupported scenarios:  1. Public-network BGP routes recurse to an SRv6 TE Policy.  2. Public-network BGP routes recurse to SRv6 BE. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| In an NG MVPN scenario, mLDP needs to obtain the next hop address of a BGP route on an inter-AS node. This address must be reachable by an IGP and must be an IPv4 address. If the next hop of a BGP route is an IPv6 address, an mLDP tunnel cannot be established.  Examples of unsupported scenarios:  1. Public BGP route recursion to SRv6 TE Policy  2. Public network BGP route recursion to SRv6 BE | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| mLDP FRR:  1. Currently, only link protection can be used.  2. The FRR paths selected before and after an active/standby switchover may be different.  3. If both the primary P2P tunnel and primary P2MP tunnel fail, traffic cannot be protected, and traffic is interrupted. FRR cannot be implemented on the backup P2P tunnel.  4. If the backup path is over a TE tunnel or GRE tunnel, link protection may not take effect. The best-effort mode is used. If the backup path and the primary path are co-routed, link protection does not take effect. If the backup path and the primary path are not co-routed, link protection takes effect.  Plan the network and configuration properly. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| After the device is restarted, if the BFD session status is Admin Down or the neighbor status is Admin Down, the LDP LSP and LDP tunnel status is not affected. If the BFD session is renegotiated and BFD reports a detection Down event, BFD on the forwarding plane triggers a fast switchover of LDP service traffic. LDP on the control plane determines the active/standby status based on the route convergence result. If BFD has not been Up, BFD does not trigger LDP service switching on the forwarding plane. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| FRR does not take effect after a multi-link mLDP FRR path is established and the primary LSP fails.  Plan a new backup LSP that at least passes through another device that does not reside on the primary LSP. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |