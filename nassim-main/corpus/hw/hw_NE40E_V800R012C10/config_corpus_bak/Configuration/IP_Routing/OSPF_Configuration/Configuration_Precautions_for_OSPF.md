Configuration Precautions for OSPF
==================================

Configuration_Precautions_for_OSPF

#### Feature Requirements

**Table 1** Feature requirements
| Feature Requirements | Series | Models |
| --- | --- | --- |
| 1. When the primary next hop is a TE tunnel, microloop avoidance is not calculated.  2. For routes with a single route source, load balancing is not supported during microloop avoidance. During microloop avoidance, only one next hop with a strict label stack or a single outbound interface is delivered to the product. After the microloop avoidance period expires, normal convergence entries are delivered.  If multiple nodes advertise the same route, load balancing may be performed between the next hop with microloop avoidance and the common next hop.  3. The length of the label stack is limited based on the interface capability of the board. The maximum length is 10. If the number of hops exceeds 10, the system does not enter the microloop avoidance state and directly delivers the converged path.  4. No microloop avoidance entry is generated on the interface whose label stack capability is 0 or 255.  5. Private networks are not supported.  6. IP route microloop avoidance is not supported.  7. In a broadcast network switchback scenario, if there is more than one neighbor on the switchback link, the device cannot wait for the neighbor labels of multiple neighbors. The microloop avoidance may fail.  8. SRs on the entire network must be able to advertise neighbor labels,  9. If the link for traffic switchback lacks a neighbor label, path calculation is delayed after traffic switchback. If no neighbor label is received within a certain period of time, microloop avoidance fails. During the delay calculation, a microloop avoidance label stack is delivered for the current path.  10. Multiple nodes advertise the same route prefix. When the optimal source node changes due to a switchover or switchback, the next hop of the prefix changes. If the SR next hop of the new optimal source node remains unchanged, the microloop avoidance path is not calculated.  11. Parallel tags are not supported. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| 1. Rules for selecting a node label advertised by an OSPF TI-LFA P node are as follows:  a) The prefix label with the N flag advertised by the P node is preferred. For inter-area or imported routes, the prefix label with the A flag must be set.  b) Prefix label of the smallest SID of the prefix with a single route source on the P node  c) The P node preferentially selects the route prefix with a single route source. If the route prefix has multiple route sources, ensure that the P node is the only optimal source. If routes with a single route source and prefix labels for load balancing cannot be selected, the prefix labels for load balancing advertised by multiple nodes can be preferentially selected as P SIDs. However, the node SIDs of Ps that advertise the same route and work in load balancing mode can only be used to protect anycast prefixes, and the PQs of anycast prefixes must be the same.  d) A node that does not support SR cannot function as a P node. A node that does not advertise prefix labels cannot function as a P node.  2. In the case of IP load balancing, OSPF does not calculate the TI-FRR backup path even if there is only one primary prefix label tunnel.  3. OSPF anycast prefix label, which is used to calculate the TI-FRR backup path.  a) Anycast prefix labels and IP routes share virtual nodes when multiple nodes advertise the same routes.  b) A maximum of 256 virtual nodes are supported.  c) The number of anycast prefix label sources cannot exceed 16.  4. In TI-LFA scenarios, TI-LFA calculates routes in RLFA scenarios (that is, PQs overlap and PQ nodes are not neighboring nodes). If no node label is configured for PQ nodes, TI-LFA calculation fails. This is a configuration error and remote LFA calculation is not performed.  5. If the cost of the backup path is greater than or equal to 65535, OSPF considers the path unreachable and does not select the path whose cost is greater than or equal to 65535 as the backup path. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| After SR LSP strict check is configured, the SR capability of a node is strictly checked when LSPs are calculated from the current node to all nodes. If SR-LDP interworking has been deployed on the network, OSPF SR-LDP interworking may fail, causing traffic interruptions. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| OSPF checks whether a neighbor in the full state exists in the backbone area before advertising a default route to the stub area. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| When a device in an NSSA generates an NSSA LSA based on an imported external route, the device preferentially uses the IP address of a loopback interface in the NSSA as the forwarding address (FA). If no loopback interfaces exist in the NSSA, the device selects the IP address of a non-loopback interface. As a result, the downstream device may fail to implement load balancing using routes even when links with the same cost exist. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| OSPF advertises default routes to an NSSA only when neighbor relationships in the Full state exist in the backbone area or default routes of another protocol or of another OSPF process exist in the same VPN instance on the device, and the nssa default-route-advertise command is run. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| 1. The mapping SID priority is not supported. All mapping SIDs are processed based on the default priority.  2. On the TI-LFA protection path, all devices from the source node to the Q node must support segment routing, and an LDP path must be available from the Q node to the destination node.  3. Anycast FRR cannot be implemented for SR routes mapped to mapping SIDs. Anycast protection cannot be implemented between SR routes mapped to mapping SIDs or between SR routes mapped to mapping SIDs and common SR routes.  4. SR routes mapped to mapping SIDs do not support remote anti-microloop.  5. In cross-process and cross-protocol scenarios, the ASBR functions as an interworking stitching node, and the MappingSid mapping needs to be configured on the process to which the route is imported.  Properly plan configurations. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| Penultimate hop popping (PHP) causes SR interworking to fail.  Plan the configuration properly. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| SR interworking takes effect only when a mapping SID with an IP prefix with a 32-bit mask is used. SR interworking does not take effect for mapping SIDs with IP prefixes of non-32-bit masks. SR interworking does not take effect for mapping SIDs with IP prefixes of non-32-bit masks.  Plan the configuration properly. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| In SR-LDP interworking scenarios, FRR does not take effect in some scenarios. For example:  In the SR-to-LDP direction, the Q node and all NEs on the path before the Q node must have the SR capability,  In the LDP-to-SR interworking FRR scenario, PQ node and all NEs on the path before the PQ path must have the LDP capability.  Plan the configuration properly. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| In an OSPF loop detection scenario, when the maximum cost is advertised due to a loop, the apply cost command does not take effect. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| The network types of the interfaces on both ends of an OSPF neighbor relationship must be the same so that the interfaces can learn routes after the neighbor relationship is established. Otherwise, the neighbor relationship cannot be established and routes cannot be calculated.  You are advised to use the same network type at both ends. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| In OSPF session CAR scenarios, OSPF neighbors in multiple areas on the same interface cannot be distinguished on the forwarding plane. Therefore, they share the same session CAR entry. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| Constraints on the association between BFD and cost values of OSPF broadcast links  1) When there is only one neighbor, the neighbor is not deleted when BFD goes Down, and the OSPF LSDB component is notified that the neighbor enters the BFD-associated cost state.  2) This function is not supported when there are multiple neighbors.  When the number of neighbors changes from one to multiple, the neighbor in the BFD Down state is deleted and the OSPF LSDB component is notified that the neighbor is deleted.  It is recommended that only one neighbor relationship be established on an OSPF broadcast network. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| SBFD does not take effect in SR-LDP interworking scenarios because SBFD does not take effect in LDP scenarios.  Plan the configuration properly. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| In an OSPF loop detection scenario, after a loop is removed, the loop cannot be automatically removed and the alarm cannot be automatically cleared. Manual intervention is required. After the routing policy or route tag is correctly configured, run the clear route loop-detect ospf alarm-state command to exit the loop state and clear the alarm. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| In OSPF loop detection scenarios, only loops caused by inter-process route import between two devices can be detected. If more than two devices import routes between processes, loops cannot be detected. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| In OSPF loop detection scenarios, loop detection cannot be performed on aggregated routes or NSSA routes. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| In OSPF loop detection scenarios, incorrect detection may be triggered when a router ID conflict occurs, including intra-AS router ID conflict and inter-AS router ID conflict. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| In OSPF loop detection scenarios, a single process can perform loop detection for a maximum of 100,000 routes. If the number of routes exceeds 100,000, loop detection cannot be performed. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| OSPF loop detection depends on the Opaque capability of OSPF in a process. If the Opaque capability is not enabled, OSPF loop detection does not take effect. In this case, you need to manually enable the Opaque capability of OSPF. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| In OSPF loop detection scenarios, loops can be detected for the default route advertised by the default-route-advertise command but self-healing cannot be achieved. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| After the device is restarted, if the BFD session of the local device or its neighbor is in Admin Down state, the OSPF status is not affected. When the BFD session is renegotiated, if the BFD detection status reported by BFD is Down (used to be Up), the OSPF neighbor is set to Down. In other cases, the OSPF status is not affected. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |