
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring NS Multicast Suppression on an EVPN MPLS Network">
<meta name="abstract" content="This section provides an example for configuring NS multicast suppression on an EVPN MPLS network to reduce or suppress excess NS messages on the network.">
<meta name="description" content="This section provides an example for configuring NS multicast suppression on an EVPN MPLS network to reduce or suppress excess NS messages on the network.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_nd_cfg_0009.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_nd_cfg_0015.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="y00852169,x00504385">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="ND">
<meta name="featuretype" content="IP Services">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="ND">
<meta name="featuretype" content="IP Services">
<meta name="featurename" content="ND">
<meta name="featuretype" content="IP Services">
<meta name="featurename" content="ND">
<meta name="featuretype" content="IP Services">
<meta name="OWNER" content="y00852169">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="x00504385">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172365188">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring NS Multicast Suppression on an EVPN MPLS Network</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172365188"></a><a name="EN-US_TASK_0172365188"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring NS Multicast Suppression on an EVPN MPLS Network</h1>
<div class="taskbody"><p>This section provides an example for configuring NS multicast suppression on an EVPN MPLS network to reduce or suppress excess NS messages on the network.</p>
<div class="context"><a name="EN-US_TASK_0172365188__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>When a user is connected to an EVPN MPLS network through a BD, IPv6 host neighbors are discovered in NS multicast mode. When a device receives an NS message for IPv6 address resolution, the device forwards the NS message in multicast mode in its BD. If a large number of NS messages are received within a specified period, forwarding all these NS messages on the EVPN occupies excessive network resources, which affects service running.</p>
<p>On the network shown in <a href="#EN-US_TASK_0172365188__fig_dc_vrp_evpn_cfg_001101">Figure 1</a>, NS multicast suppression can be configured on a PE. When receiving an NS message, the PE checks whether it can obtain the destination user information in the NS message. If so, it performs proxy ND or multicast-to-unicast processing to reduce or suppress NS message flooding. NS multicast suppression can also prevent ND spoofing attacks. During ND spoofing attacks, an attacker associates its MAC address with the IPv6 address of a host so that all traffic destined for the IPv6 address is sent to the attacker. After NS multicast suppression is enabled, an IPv6 address conflict alarm will be generated through proxy ND entry conflict detection to notify users of a possible ND spoofing attack.</p>
<div class="fignone" id="EN-US_TASK_0172365188__fig_dc_vrp_evpn_cfg_001101"><a name="EN-US_TASK_0172365188__fig_dc_vrp_evpn_cfg_001101"></a><a name="fig_dc_vrp_evpn_cfg_001101"></a><span class="figcap"><b>Figure 1 </b>NS multicast suppression</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 and 2 in this example represent GE<span>0/1/0</span> and GE<span>0/2/0</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_evpn_cfg_000306.png"></span><br></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172365188__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure basic EVPN functions.</p>
</li><li><p>Enable NS multicast suppression.</p>
</li><li><p>Enable the function to flood proxy ND entries through EVPN routes.</p>
</li><li><p>Configure the CEs and PEs to communicate.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172365188__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>EVPN instance name: evpna</p>
</li><li><p>RD of the EVPN instance on a PE: 3:3</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172365188__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure basic EVPN functions.</span><p><ol type="a"><li><p>Configure interface IP addresses.</p>
<p># Configure PE1.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>]<strong> sysname PE1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/0</span>]<strong> ip address 10.0.0.1 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> interface loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack0]<strong> ip address 1.1.1.1 255.255.255.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack0]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-LoopBack0]<strong> quit</strong></pre>
<p>The configuration of PE2 is similar to the configuration of PE1. For configuration details, see <a href="#EN-US_TASK_0172365188__file1">Configuration Files</a> in this section.</p>
</li><li><p>Configure an IGP to implement interworking between the PEs. OSPF is used in this example.</p>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1]<strong> area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1-area-0.0.0.0]<strong> network 1.1.1.1 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1-area-0.0.0.0]<strong> network 10.0.0.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1-area-0.0.0.0]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-ospf-1-area-0.0.0.0]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-ospf-1]<strong> quit</strong></pre>
<p>The configuration of PE2 is similar to the configuration of PE1. For configuration details, see <a href="#EN-US_TASK_0172365188__file1">Configuration Files</a> in this section.</p>
<p>After the configuration is complete, run the <strong>display ospf peer</strong> command. The command output shows that an OSPF neighbor relationship has been set up between PE1 and PE2 and its state is <strong>Full</strong>. Run the <strong>display ip routing-table</strong> command. The command output shows that PE1 and PE2 have learned the routes to each other's Loopback1.</p>
<p>The following example uses the command output on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display ospf peer</strong></pre>
<pre class="screen">(M) Indicates MADJ neighbor


          OSPF Process 1 with Router ID 1.1.1.1
                Neighbors

 Area 0.0.0.0 interface 10.0.0.1 (GE<span>0/1/0</span>)'s neighbors
 Router ID: 2.2.2.2              Address: 10.0.0.2         
   State: Full           Mode:Nbr is Master     Priority: 1
   DR: 10.0.0.1          BDR: 10.0.0.2          MTU: 0
   Dead timer due in  38  sec
   Retrans timer interval: 5
   Neighbor is up for 01h54m10s
   Authentication Sequence: [ 0 ]</pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display ip routing-table</strong></pre>
<pre class="screen"><span class="keyword">Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route</span>
------------------------------------------------------------------------------
Routing Table : _public_
         Destinations : 9        Routes : 9         

Destination/Mask    Proto   Pre  Cost        Flags NextHop         Interface

        1.1.1.1/32  Direct  0    0             D   127.0.0.1       LoopBack0
        2.2.2.2/32  OSPF    10   1             D   10.0.0.2        GigabitEthernet<span>0/1/0</span>
       10.0.0.0/24  Direct  0    0             D   10.0.0.1        GigabitEthernet<span>0/1/0</span>
       10.0.0.1/32  Direct  0    0             D   127.0.0.1       GigabitEthernet<span>0/1/0</span>
     10.0.0.255/32  Direct  0    0             D   127.0.0.1       GigabitEthernet<span>0/1/0</span>
      127.0.0.0/8   Direct  0    0             D   127.0.0.1       InLoopBack0
      127.0.0.1/32  Direct  0    0             D   127.0.0.1       InLoopBack0
127.255.255.255/32  Direct  0    0             D   127.0.0.1       InLoopBack0
255.255.255.255/32  Direct  0    0             D   127.0.0.1       InLoopBack0</pre>
</li><li><p>Configure basic MPLS functions and MPLS LDP, and set up LDP LSPs.</p>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> mpls lsr-id 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-mpls]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/0</span>]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/0</span>]<strong> quit</strong></pre>
<p>The configuration of PE2 is similar to the configuration of PE1. For configuration details, see <a href="#EN-US_TASK_0172365188__file1">Configuration Files</a> in this section.</p>
<p>After the configuration is complete, run the <strong>display mpls ldp session</strong> command. The command output shows that an LDP session has been set up between PE1 and PE2 and its state is <strong>Operational</strong>. Run the <strong>display mpls ldp lsp</strong> command. The command output shows information about LDP LSP setup.</p>
<p>The following example uses the command output on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> display mpls ldp session</strong></pre>
<pre class="screen">LDP Session(s) in Public Network
 Codes: LAM(Label Advertisement Mode), SsnAge Unit(DDDD:HH:MM)
 An asterisk (*) before a session means the session is being deleted.
 --------------------------------------------------------------------------
 PeerID             Status      LAM  SsnRole  SsnAge       KASent/Rcv
 --------------------------------------------------------------------------
 2.2.2.2:0          Operational DU   Passive  0000:02:03   494/494
 --------------------------------------------------------------------------
 TOTAL: 1 Session(s) Found.</pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display mpls ldp lsp</strong></pre>
<pre class="screen"> LDP LSP Information
 -------------------------------------------------------------------------------
 Flag after Out IF: (I) - RLFA Iterated LSP, (I*) - Normal and RLFA Iterated LSP
 -------------------------------------------------------------------------------
 DestAddress/Mask   In/OutLabel    UpstreamPeer    NextHop          OutInterface
 -------------------------------------------------------------------------------
 1.1.1.1/32         3/NULL         2.2.2.2         127.0.0.1        Loop0
*1.1.1.1/32         Liberal/32967                  DS/2.2.2.2       
 2.2.2.2/32         NULL/3         -               10.0.0.2         GE<span>0/1/0</span>
 2.2.2.2/32         32967/3        2.2.2.2         10.0.0.2         GE<span>0/1/0</span>
 -------------------------------------------------------------------------------
 TOTAL: 3 Normal LSP(s) Found.
 TOTAL: 1 Liberal LSP(s) Found.
 TOTAL: 0 FRR LSP(s) Found.
 An asterisk (*) before an LSP means the LSP is not established
 An asterisk (*) before a Label means the USCB or DSCB is stale
 An asterisk (*) before an UpstreamPeer means the session is stale
 An asterisk (*) before a DS means the session is stale
 An asterisk (*) before a NextHop means the LSP is FRR LSP</pre>
</li><li><p>Configure EVPN instances.</p>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> evpn vpn-instance evpna bd-mode</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-evpn-instance-evpna]<strong> route-distinguisher 3:3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-evpn-instance-evpna]<strong> vpn-target 1:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-evpn-instance-evpna]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-evpn-instance-evpna]<strong> quit</strong></pre>
<p>The configuration of PE2 is similar to the configuration of PE1. For configuration details, see <a href="#EN-US_TASK_0172365188__file1">Configuration Files</a> in this section.</p>
</li><li><p>Configure EVPN source addresses.</p>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> evpn source-address 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> commit</strong></pre>
<p>The configuration of PE2 is similar to the configuration of PE1. For configuration details, see <a href="#EN-US_TASK_0172365188__file1">Configuration Files</a> in this section.</p>
</li><li><p>Bind an EVPN instance to a BD.</p>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bd10]<strong> evpn binding vpn-instance evpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bd10]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bd10]<strong> quit</strong></pre>
<p>The configuration of PE2 is similar to the configuration of PE1. For configuration details, see <a href="#EN-US_TASK_0172365188__file1">Configuration Files</a> in this section.</p>
</li><li><p>Configure a BGP EVPN peer relationship.</p>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp]<strong> peer 2.2.2.2 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp]<strong> peer 2.2.2.2 connect-interface LoopBack 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp]<strong> l2vpn-family evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-evpn]<strong> peer 2.2.2.2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-evpn]<strong> peer 2.2.2.2 advertise nd</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-evpn]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp-af-evpn]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp]<strong> quit</strong></pre>
<p>The configuration of PE2 is similar to the configuration of PE1. For configuration details, see <a href="#EN-US_TASK_0172365188__file1">Configuration Files</a> in this section.</p>
</li></ol>
</p></li><li><span>Enable NS multicast suppression.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bd10]<strong> ipv6 nd multicast-suppress proxy-reply enable</strong></pre>
<p>The configuration of PE2 is similar to the configuration of PE1. For configuration details, see <a href="#EN-US_TASK_0172365188__file1">Configuration Files</a> in this section.</p>
</p></li><li><span>Enable the function to flood proxy ND entries through EVPN routes.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword">*</span>PE1-bd10]<strong> ipv6 nd collect host enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bd10]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bd10]<strong> quit</strong></pre>
<p>The configuration of PE2 is similar to the configuration of PE1. For configuration details, see <a href="#EN-US_TASK_0172365188__file1">Configuration Files</a> in this section.</p>
</p></li><li><span>Configure the CEs and PEs to communicate.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface gigabitethernet <span>0/2/0</span>.1 mode l2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>.1]<strong> encapsulation dot1q vid 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>.1] <strong>rewrite pop single</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>.1]<strong> bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>.1]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/2/0</span>.1]<strong> quit</strong></pre>
<p>The configuration of PE2 is similar to the configuration of PE1. For configuration details, see <a href="#EN-US_TASK_0172365188__file1">Configuration Files</a> in this section.</p>
<p># Configure CE1.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>]<strong> sysname CE1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>interface gigabitethernet <span>0/2/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/2/0</span>.1]<strong> ipv6 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/2/0</span>.1]<strong> ipv6 address 2001:db8::1 64</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/2/0</span>.1]<strong> vlan-type dot1q 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/2/0</span>.1]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1-GigabitEthernet<span>0/2/0</span>.1]<strong> quit</strong></pre>
<p>The configuration of CE2 is similar to the configuration of CE1. For configuration details, see <a href="#EN-US_TASK_0172365188__file1">Configuration Files</a> in this section.</p>
</p></li><li><span>Verify the configuration.</span><p><p>Run the <strong>display bgp evpn all routing-table mac-route</strong> command on PE1. The command output shows MAC/IP advertisement routes to PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display bgp evpn all routing-table mac-route</strong></pre>
<pre class="screen"> Local AS number : 100

 BGP Local router ID is 1.1.1.1
 Status codes: * - valid, &gt; - best, d - damped, x - best external, a - add path,
               h - history,  i - internal, s - suppressed, S - Stale
               Origin : i - IGP, e - EGP, ? - incomplete


 EVPN address family:
 Number of Mac Routes: 6
 Route Distinguisher: 3:3
       Network(EthTagId/MacAddrLen/MacAddr/IpAddrLen/IpAddr)  NextHop
 *&gt;    0:48:00e0-fc12-3456:0:0.0.0.0                          0.0.0.0
 *&gt;i   0:48:00e0-fc12-7890:0:0.0.0.0                          2.2.2.2
 *&gt;    0:48:00e0-fc12-3456:128:[FE80::3A00:10FF:FE03:0]       0.0.0.0
 *&gt;    0:48:00e0-fc12-3456:128:[2001:DB8::1]                  0.0.0.0
 *&gt;i   0:48:00e0-fc12-7890:128:[FE80::3ABD:6CFF:FE31:300]     2.2.2.2
 *&gt;i   0:48:00e0-fc12-7890:128:[2001:DB8::2]                  2.2.2.2
    

 EVPN-Instance evpna:
 Number of Mac Routes: 6
       Network(EthTagId/MacAddrLen/MacAddr/IpAddrLen/IpAddr)  NextHop
 *&gt;    0:48:00e0-fc12-3456:0:0.0.0.0                          0.0.0.0
 *&gt;i   0:48:00e0-fc12-7890:0:0.0.0.0                          2.2.2.2
 *&gt;    0:48:00e0-fc12-3456:128:[FE80::3A00:10FF:FE03:0]       0.0.0.0
 *&gt;    0:48:00e0-fc12-3456:128:[2001:DB8::1]                  0.0.0.0
 *&gt;i   0:48:00e0-fc12-7890:128:[FE80::3ABD:6CFF:FE31:300]     2.2.2.2
 *&gt;i   0:48:00e0-fc12-7890:128:[2001:DB8::2]                  2.2.2.2</pre>
<p>Run the <strong>display ipv6 nd multicast-suppress bridge-domain</strong> command on PE1. The command output shows that the proxy ND table contains entries of CE1 and CE2. The 2001:db8::1 entry is a dynamic proxy ND entry generated by the local device, and the 2001:db8::2 entry is a proxy ND entry pushed by the remote device.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display ipv6 nd multicast-suppress bridge-domain</strong></pre>
<pre class="screen">----------------------------------------------------------------------------------
IPv6 Address
MAC Address            BD         LifeTime (S)      Type 
----------------------------------------------------------------------------------
<strong>2001:DB8::1</strong>                                                                     
00e0-fc12-3456         10         76                <strong>Dynamic</strong>   

<strong>2001:DB8::2</strong>                                                                     
00e0-fc12-7890         10         -                 <strong>Evpn</strong>      

FE80::3A00:10FF:FE03:0                                                          
00e0-fc12-3456         10         75                Dynamic   

FE80::3ABD:6CFF:FE31:300                                                        
00e0-fc12-7890         10         -                 Evpn      

----------------------------------------------------------------------------------
Total: 4        Dynamic: 2      Evpn: 2        </pre>
<p>Run the <strong>display ipv6 nd multicast-suppress bridge-domain</strong> command on PE2. The command output shows that the proxy ND table contains entries of CE1 and CE2. The 2001:db8::2 entry is a dynamic proxy ND entry generated by the local device, and the 2001:db8::1 entry is a proxy ND entry pushed by the remote device.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>display ipv6 nd multicast-suppress bridge-domain</strong></pre>
<pre class="screen">----------------------------------------------------------------------------------
IPv6 Address
MAC Address            BD         LifeTime (S)      Type 
----------------------------------------------------------------------------------
<strong>2001:DB8::1</strong>                                                                     
00e0-fc12-3456         10         -                 <strong>Evpn</strong>      

<strong>2001:DB8::2</strong>                                                                     
00e0-fc12-7890         10         21                <strong>Dynamic</strong>   

FE80::3A00:10FF:FE03:0                                                          
00e0-fc12-3456         10         -                 Evpn      

FE80::3ABD:6CFF:FE31:300                                                        
00e0-fc12-7890         10         21                Dynamic   

----------------------------------------------------------------------------------
Total: 4        Dynamic: 2      Evpn: 2  </pre>
<p>Run the <strong>ping ipv6</strong> command on CE1. The command output shows that the IPv6 address of GE<span>0/2/0</span>.1 on CE2 is reachable.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>ping ipv6 2001:db8::2</strong></pre>
<pre class="screen">  PING 2001:DB8::2 : 56  data bytes, press CTRL_C to break
    Reply from 2001:DB8::2 
    bytes=56 Sequence=1 hop limit=64 time=5 ms
    Reply from 2001:DB8::2 
    bytes=56 Sequence=2 hop limit=64 time=2 ms
    Reply from 2001:DB8::2 
    bytes=56 Sequence=3 hop limit=64 time=3 ms
    Reply from 2001:DB8::2 
    bytes=56 Sequence=4 hop limit=64 time=3 ms
    Reply from 2001:DB8::2 
    bytes=56 Sequence=5 hop limit=64 time=2 ms
            
  --- 2001:DB8::2 ping statistics---
    5 packet(s) transmitted
    5 packet(s) received
    0.00% packet loss
    round-trip min/avg/max=2/3/5 ms</pre>
<p>Run the <strong>ping ipv6</strong> command on CE2. The command output shows that the IPv6 address of GE<span>0/2/0</span>.1 on CE1 is reachable.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>ping ipv6 2001:db8::1</strong></pre>
<pre class="screen">  PING 2001:DB8::1 : 56  data bytes, press CTRL_C to break
    Reply from 2001:DB8::1 
    bytes=56 Sequence=1 hop limit=64 time=10 ms
    Reply from 2001:DB8::1 
    bytes=56 Sequence=2 hop limit=64 time=3 ms
    Reply from 2001:DB8::1 
    bytes=56 Sequence=3 hop limit=64 time=3 ms
    Reply from 2001:DB8::1 
    bytes=56 Sequence=4 hop limit=64 time=4 ms
    Reply from 2001:DB8::1 
    bytes=56 Sequence=5 hop limit=64 time=3 ms
            
  --- 2001:DB8::1 ping statistics---
    5 packet(s) transmitted
    5 packet(s) received
    0.00% packet loss
    round-trip min/avg/max=3/4/10 ms</pre>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0172365188__file1"><a name="EN-US_TASK_0172365188__file1"></a><a name="file1"></a><a name="EN-US_TASK_0172365188__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>PE1 configuration file</p>
<pre class="screen">#
sysname PE1
#
evpn vpn-instance evpna bd-mode
 route-distinguisher 3:3
 vpn-target 1:1 export-extcommunity
 vpn-target 1:1 import-extcommunity
#
mpls lsr-id 1.1.1.1
#
mpls
#
bridge-domain 10
 evpn binding vpn-instance evpna
 ipv6 nd multicast-suppress proxy-reply enable
 ipv6 nd collect host enable
#
mpls ldp
 #
 ipv4-family
#
interface GigabitEthernet<span>0/2/0</span>.1 mode l2
 encapsulation dot1q vid 1
 rewrite pop single
 bridge-domain 10
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.0.0.1 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack0
 ip address 1.1.1.1 255.255.255.255
#
bgp 100
 peer 2.2.2.2 as-number 100
 peer 2.2.2.2 connect-interface LoopBack0
 #
 ipv4-family unicast
  undo synchronization
  peer 2.2.2.2 enable
 #
 l2vpn-family evpn
  undo policy vpn-target
  peer 2.2.2.2 enable
  peer 2.2.2.2 advertise nd
#
ospf 1
 area 0.0.0.0
  network 1.1.1.1 0.0.0.0
  network 10.0.0.0 0.0.0.255
#
evpn source-address 1.1.1.1
#
return</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#
sysname PE2
#
evpn vpn-instance evpna bd-mode
 route-distinguisher 3:3
 vpn-target 1:1 export-extcommunity
 vpn-target 1:1 import-extcommunity
#
mpls lsr-id 2.2.2.2
#
mpls
#
bridge-domain 10
 evpn binding vpn-instance evpna
 ipv6 nd multicast-suppress proxy-reply enable
 ipv6 nd collect host enable
#
mpls ldp
 #
 ipv4-family
#
interface GigabitEthernet<span>0/2/0</span>.1 mode l2
 encapsulation dot1q vid 1
 rewrite pop single
 bridge-domain 10
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.0.0.2 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack0
 ip address 2.2.2.2 255.255.255.255
#
bgp 100
 peer 1.1.1.1 as-number 100
 peer 1.1.1.1 connect-interface LoopBack0
 #
 ipv4-family unicast
  undo synchronization
  peer 1.1.1.1 enable
 #
 l2vpn-family evpn
  undo policy vpn-target
  peer 1.1.1.1 enable
  peer 1.1.1.1 advertise nd
#
ospf 1
 area 0.0.0.0
  network 2.2.2.2 0.0.0.0
  network 10.0.0.0 0.0.0.255
#
evpn source-address 2.2.2.2
#
return</pre>
</li><li><p>CE1 configuration file</p>
<pre class="screen">#
sysname CE1
#
interface GigabitEthernet<span>0/2/0</span>.1
 vlan-type dot1q 1
 ipv6 enable
 ipv6 address 2001:DB8::1/64
#
return</pre>
</li><li><p>CE2 configuration file</p>
<pre class="screen">#
sysname CE2
#
interface GigabitEthernet<span>0/2/0</span>.1
 vlan-type dot1q 1
 ipv6 enable
 ipv6 address 2001:DB8::2/64
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_nd_cfg_0009.html">Configuration Examples for ND
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_nd_cfg_0015.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>
</body>
</html>