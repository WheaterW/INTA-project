
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Local Proxy ARP">
<meta name="abstract" content="This section provides an example for configuring local proxy ARP to allow two isolated member interfaces in a BD to intercommunicate in an EVC scenario.">
<meta name="description" content="This section provides an example for configuring local proxy ARP to allow two isolated member interfaces in a BD to intercommunicate in an EVC scenario.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_arp_cfg_2060.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_arp_cfg_2064.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_arp_cfg_2095.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="y00852169,x00504385">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="ARP">
<meta name="featuretype" content="IP Services">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="ARP">
<meta name="featuretype" content="IP Services">
<meta name="featurename" content="ARP">
<meta name="featuretype" content="IP Services">
<meta name="featurename" content="ARP">
<meta name="featuretype" content="IP Services">
<meta name="OWNER" content="y00852169">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="x00504385">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172364526">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring Local Proxy ARP</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172364526"></a><a name="EN-US_TASK_0172364526"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Local Proxy ARP</h1>
<div class="taskbody"><p>This section provides an example for configuring local proxy ARP to allow two isolated member interfaces in a BD to intercommunicate in an EVC scenario.</p>
<div class="context"><a name="EN-US_TASK_0172364526__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>In the EVC model, after receiving packets, the member interfaces of a BD broadcast these packets in the BD. To reduce broadcast operations, network administrators usually configure split horizon on the member interfaces that do not need to intercommunicate to isolate these member interfaces.</p>
<p>As shown in <a href="#EN-US_TASK_0172364526__fig_dc_vrp_arp_cfg_207201">Figure 1</a>, network administrators have configured split horizon on PEs to isolate Host A and Host B. As user services develop, however, Host A and Host B need to intercommunicate some day. To resolve this problem, network administrators need to enable local proxy ARP on VBDIF interfaces to allow Host A and Host B to intercommunicate.</p>
<div class="fignone" id="EN-US_TASK_0172364526__fig_dc_vrp_arp_cfg_207201"><a name="EN-US_TASK_0172364526__fig_dc_vrp_arp_cfg_207201"></a><a name="fig_dc_vrp_arp_cfg_207201"></a><span class="figcap"><b>Figure 1 </b>Configuring local proxy ARP</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 and 2 in this example represent GE <span>0/1/1</span> and GE <span>0/1/2</span> respectively.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_arp_cfg_207201.png"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172364526__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Precautions</h4><p>After local proxy ARP is enabled, all the users in the BD can communicate. To allow only specific users in a BD to intercommunicate, running the <a href="cmdqueryname=undo+split-horizon+enable"><b><span class="cmdname">undo
split-horizon enable</span></b></a> command on these member interfaces that need intercommunicate to disable split horizon is recommended.</p>
</div></div>
<div class="context"><a name="EN-US_TASK_0172364526__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure Layer 2 forwarding on the CE.</p>
<ol type="a"><li>Create a VLAN on the CE and add the downstream interface of the CE to the VLAN.</li><li>Configure Layer 2 forwarding on the interface connecting the CE to the network side so that the CE sends single-tagged packets to the PE.</li></ol>
</li><li>Create an EVC model on the PE.<ol type="a"><li>Configure a BD to forward services.</li><li>Create a Layer 2 sub-interface, add it to the BD, and configure traffic encapsulation on the downstream interface to ensure that services access the service access point.</li><li>Configure split horizon in the BD to isolate Host A and Host B.</li></ol>
</li><li>Configure local proxy ARP on the PE.<ol type="a"><li>Create a VBDIF interface and assign an IP address to it.</li><li>Enable local proxy ARP to allow Host A and Host B to intercommunicate.</li></ol>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172364526__1.4.4"></a><a name="1.4.4"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><div class="p">To complete the configuration, you need the following data:<ul><li>User VLAN ID</li><li>Number of interfaces that connect the CEs and connect the CE to PE</li><li>BD ID, traffic encapsulation type, and traffic behavior</li><li>VBDIF interface number and IP address</li></ul>
</div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172364526__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure Layer 2 forwarding on the CE.</span><p><p># Configure CE1.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname CE1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1]<strong> vlan 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-vlan10]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1]<strong> interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/1</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/1</span>]<strong> portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/1</span>]<strong> port link-type access</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/1</span>]<strong> port default vlan 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/1</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1]<strong> interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/2</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/2</span>]<strong> portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/2</span>]<strong> port link-type trunk</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/2</span>]<strong> port trunk allow-pass vlan 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/2</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1-GigabitEthernet<span>0/1/2</span>]<strong> quit</strong></pre>
<p># Configure CE2.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname CE2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2]<strong> vlan 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-vlan10]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2]<strong> interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>]<strong> portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>]<strong> port link-type access</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>]<strong> port default vlan 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2]<strong> interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/2</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/2</span>]<strong> portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/2</span>]<strong> port link-type trunk</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/2</span>]<strong> port trunk allow-pass vlan 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/2</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2-GigabitEthernet<span>0/1/2</span>]<strong> quit</strong></pre>
</p></li><li><span>Create an EVC model on the PE.</span><p><p># Create a BD.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname PE</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE]<strong> bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-bd10]<strong> quit</strong></pre>
<p># Create a Layer 2 sub-interface, add it to the BD, and configure traffic encapsulation on the downstream interface.</p>
<pre class="screen">[<span class="keyword">*</span>PE]<strong> interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-GigabitEthernet<span>0/1/1</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-GigabitEthernet<span>0/1/1</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE]<strong> interface gigabitethernet <span>0/1/1</span>.1 mode l2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-GigabitEthernet<span>0/1/1</span>.1]<strong> encapsulation dot1q vid 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-GigabitEthernet<span>0/1/1</span>.1]<strong> rewrite pop single</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-GigabitEthernet<span>0/1/1</span>.1]<strong> bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-GigabitEthernet<span>0/1/1</span>.1]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-GigabitEthernet<span>0/1/1</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE]<strong> interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-GigabitEthernet<span>0/1/2</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-GigabitEthernet<span>0/1/2</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE]<strong> interface gigabitethernet <span>0/1/2</span>.1 mode l2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-GigabitEthernet<span>0/1/2</span>.1]<strong> encapsulation dot1q vid 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-GigabitEthernet<span>0/1/2</span>.1]<strong> rewrite pop single</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-GigabitEthernet<span>0/1/2</span>.1]<strong> bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-GigabitEthernet<span>0/1/2</span>.1]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-GigabitEthernet<span>0/1/2</span>]<strong> quit</strong></pre>
<div class="p"># Ping the IP address of Host B on Host A. The ping operation succeeds.<pre class="screen">c:\&gt;ping 10.110.10.2

Pinging 10.110.10.2 with 32 bytes of data:
Reply from 10.110.10.2: bytes=32 time&lt;1ms TTL=128
Reply from 10.110.10.2: bytes=32 time&lt;1ms TTL=128
Reply from 10.110.10.2: bytes=32 time&lt;1ms TTL=128
Reply from 10.110.10.2: bytes=32 time&lt;1ms TTL=128

Ping statistics for 10.110.10.2:
    Packets: Sent = 4, Received = 4, Lost = 0 &lt;0% loss&gt;,
Approximate round trip times in mill-seconds:
    Minimum = 0ms, Maximum = 0ms, Average = 0ms</pre>
</div>
<p># Configure split horizon in the BD.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE]<strong> bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-bd-10]<strong> split-horizon enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-bd-10]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE]<strong> commit</strong></pre>
<div class="p"># Ping the IP address of Host B on Host A. The ping operation fails.<pre class="screen">c:\&gt;ping 10.110.10.2

Pinging 10.110.10.2 with 32 bytes of data:
Request timed out.
Request timed out.
Request timed out.
Request timed out.

Ping statistics for 10.110.10.2:
    Packets: Sent = 4, Received = 0, Lost = 4 &lt;100% loss&gt;,</pre>
</div>
</p></li><li><span>Configure local proxy ARP on the PE.</span><p><p># Create a VBDIF interface and assign an IP address to it.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE]<strong> interface vbdif 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-Vbdif10]<strong> ip address 10.110.10.3 255.255.255.0</strong></pre>
<p># Enable local proxy ARP.</p>
<pre class="screen">[<span class="keyword">*</span>PE-Vbdif10]<strong> arp-proxy local enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-Vbdif10]<strong> commit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><div class="p">After the preceding configuration is complete, ping the IP address of Host B on Host A. The ping operation succeeds.<pre class="screen">c:\&gt;ping 10.110.10.2

Pinging 10.110.10.2 with 32 bytes of data:
Reply from 10.110.10.2: bytes=32 time&lt;1ms TTL=128
Reply from 10.110.10.2: bytes=32 time&lt;1ms TTL=128
Reply from 10.110.10.2: bytes=32 time&lt;1ms TTL=128
Reply from 10.110.10.2: bytes=32 time&lt;1ms TTL=128

Ping statistics for 10.110.10.2:
    Packets: Sent = 4, Received = 4, Lost = 0 &lt;0% loss&gt;,
Approximate round trip times in mill-seconds:
    Minimum = 0ms, Maximum = 0ms, Average = 0ms</pre>
</div>
<p>The <a href="cmdqueryname=display+bridge-domain"><b><span class="cmdname">display bridge-domain</span></b></a> command output shows information about the BD to which the Layer 2 sub-interface is added.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE] <strong>display bridge-domain</strong></pre>
<pre class="screen">The total number of bridge-domains is : 1
--------------------------------------------------------------------------------
MAC_LRN: MAC learning;         STAT: Statistics;         SPLIT: Split-horizon;
BC: Broadcast;                 MC: Unknown multicast;    UC: Unknown unicast;
*down: Administratively down;  FWD: Forward;             DSD: Discard;
--------------------------------------------------------------------------------

BDID  State MAC-LRN STAT    BC  MC  UC  SPLIT   Description
--------------------------------------------------------------------------------
10    up    enable  disable FWD FWD FWD enable</pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172364526__1.4.6"></a><a name="1.4.6"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>PE configuration file</p>
<pre class="screen">#
sysname PE
#
vlan batch 10
#
bridge-domain 10
 split-horizon enable
#
interface Vbdif10
 undo shutdown
 ip address 10.110.10.3 255.255.255.0
 arp-proxy local enable
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
#
interface GigabitEthernet<span>0/1/1</span>.1 mode l2
 encapsulation dot1q vid 10
 rewrite pop single
 bridge-domain 10
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
#
interface GigabitEthernet<span>0/1/2</span>.1 mode l2
 encapsulation dot1q vid 10
 rewrite pop single
 bridge-domain 10
#
return</pre>
</li><li><p>CE1 configuration file</p>
<pre class="screen">#
sysname CE1
#
vlan batch 10
#
interface GigabitEthernet<span>0/1/1</span>
 portswitch
 undo shutdown
 port link-type access
 port default vlan 10
#
interface GigabitEthernet<span>0/1/2</span>
 portswitch
 undo shutdown
 port link-type trunk
 port trunk allow-pass vlan 10
#
return</pre>
</li><li><p>CE2 configuration file</p>
<pre class="screen">#
sysname CE2
#
vlan batch 10
#
interface GigabitEthernet<span>0/1/1</span>
 portswitch
 undo shutdown
 port link-type access
 port default vlan 10
#
interface GigabitEthernet<span>0/1/2</span>
 portswitch
 undo shutdown
 port link-type trunk
 port trunk allow-pass vlan 10
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_arp_cfg_2060.html">Configuration Examples for ARP
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_arp_cfg_2064.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_arp_cfg_2095.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>