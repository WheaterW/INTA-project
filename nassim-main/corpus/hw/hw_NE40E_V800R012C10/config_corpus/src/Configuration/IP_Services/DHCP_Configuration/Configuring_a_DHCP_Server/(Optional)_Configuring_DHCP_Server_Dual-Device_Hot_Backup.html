
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="(Optional) Configuring DHCP Server Dual-Device Hot Backup">
<meta name="abstract" content="DHCP server dual-device hot backup can be enabled to achieve backup of user session information between devices. When a network node or link experiences an abnormality, fast user service switching is triggered, which enhances service reliability.">
<meta name="description" content="DHCP server dual-device hot backup can be enabled to achieve backup of user session information between devices. When a network node or link experiences an abnormality, fast user service switching is triggered, which enhances service reliability.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_dhcp_server_cfg_0011.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_dhcp_server_cfg_0014.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_dhcp_server_cfg_0024.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,z00485179,w00556928,w00606909,dhcpvrp">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="DHCP">
<meta name="featuretype" content="IP Services">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="DHCP">
<meta name="featuretype" content="IP Services">
<meta name="featurename" content="DHCP">
<meta name="featuretype" content="IP Services">
<meta name="featurename" content="DHCP">
<meta name="featuretype" content="IP Services">
<meta name="OWNER" content="z00485179,x00504385">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="x00504385">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172364704">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>(Optional) Configuring DHCP Server Dual-Device Hot Backup</title>
</head>
<body><a name="EN-US_TASK_0172364704"></a><a name="EN-US_TASK_0172364704"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">(Optional) Configuring DHCP Server Dual-Device Hot Backup</h1>
<div class="taskbody"><p>DHCP server dual-device hot backup can be enabled to achieve backup of user session information between devices. When a network node or link experiences an abnormality, fast user service switching is triggered, which enhances service reliability.</p>
<div class="prereq" style="margin-left:0"><a name="EN-US_TASK_0172364704__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Prerequisites</h4>
<div class="p"><p>Before configuring DHCP server dual-device hot backup, ensure that the same DHCP server configuration has been performed on the master and backup devices. Otherwise, a master/backup switchover may lead to an abnormality in new user access and user renewal.</p>
<p>DHCP server packet receiving has been enabled using the <a href="cmdqueryname=dhcp+server+enable"><b><span class="cmdname" id="EN-US_TASK_0172364704__en-us_task_0172364701_cmdname1191514464617">dhcp server enable</span></b></a> command on an interface if the interface needs to be used as a DHCP server.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><ul id="EN-US_TASK_0172364704__en-us_task_0172364701_ul148851851145912"><li id="EN-US_TASK_0172364704__en-us_task_0172364701_li13885125117590">If multiple interfaces need to be used as DHCP servers, for security purposes, you are advised to preferentially run the <a href="cmdqueryname=dhcp+server+enable"><b><span class="cmdname" id="EN-US_TASK_0172364704__en-us_task_0172364701_cmdname198051032104718">dhcp server enable</span></b></a> command on the interfaces to enable DHCP server packet receiving. If high security is not required, you run the <a href="cmdqueryname=dhcp+server+request-packet+all-interface+enable"><b><span class="cmdname" id="EN-US_TASK_0172364704__en-us_task_0172364701_cmdname1111113865112">dhcp server request-packet all-interface enable</span></b></a> command in the system view to enable DHCP server packet receiving for all interfaces.</li><li id="EN-US_TASK_0172364704__en-us_task_0172364701_li4657653185916">If DHCP server packet receiving is not enabled, a DHCP server does not process DHCP request messages.</li></ul>
</div></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172364704__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Background</h4><p>On the network shown in <a href="#EN-US_TASK_0172364704__fig_dc_vrp_dhcp_server_cfg_002003">Figure 1</a>, the DHCP client is connected to DeviceA and DeviceB over the switch. A VRRP group is configured between DeviceA and DeviceB to establish the master/backup relationship, with DeviceA as the master device and DeviceB as the backup device. Both DeviceA and DeviceB serve as a DHCP server to assign IP addresses to DHCP clients.</p>
<p>In normal cases, DeviceA implements new user access and online user renewal. When DeviceA or the link between DeviceA and the switch becomes faulty, a master/backup VRRP switchover is implemented and DeviceB takes over to become the master device. DeviceB can properly perform address assignment for new users and renewal requests for online users only when user session information has been synchronized from DeviceA to DeviceB.</p>
<p>To prevent abnormalities of new user access and online user renewal after a master/backup switchover due to a failure to synchronize user session information from DeviceA to DeviceB, deploy DHCP server dual-device hot backup on DeviceA and DeviceB.</p>
<div class="fignone" id="EN-US_TASK_0172364704__fig_dc_vrp_dhcp_server_cfg_002003"><a name="EN-US_TASK_0172364704__fig_dc_vrp_dhcp_server_cfg_002003"></a><a name="fig_dc_vrp_dhcp_server_cfg_002003"></a><span class="figcap"><b>Figure 1 </b>DHCP server dual-device hot backup</span><br><span><img class="vsd" src="images/fig_dc_vrp_dhcp_server_cfg_002003.png"></span><br></div>
<p>Perform the following operations on the DHCP servers that back up each other:</p>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172364704__1.4.3"></a><a name="1.4.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure basic functions of a VRRP group.</span><ol type="a"><li class="substepexpand"><span>Run <span><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=interface"><b><span class="cmdname">interface</span></b></a> <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i> [.<i><span class="varname">subinterface-number</span></i> ]</span></span><p><p>The interface view for a VRRP group is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=vrrp+vrid"><b><span class="cmdname">vrrp vrid</span></b></a> <i><span class="varname">virtual-router-id</span></i> <strong><span>virtual-ip</span></strong> <i><span class="varname">virtual-address</span></i></span></span><p><p>A VRRP group is created and a virtual IP address is configured.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=vrrp+vrid"><b><span class="cmdname">vrrp vrid</span></b></a> <i><span class="varname">virtual-router-id</span></i> <strong><span>preempt-mode</span></strong> <strong><span>timer</span></strong> <strong><span>delay</span></strong> <i><span class="varname">delay-time</span></i></span><p><p>A preemption delay is set for the device in the VRRP group.</p>
</p><p><p>You are advised to set the preemption delay to 0 on a backup device to allow it to preempt the master role immediately after the master device fails or set the preemption delay to a non-0 value on the master device so that it can preempt the master role after a specified delay if a master/backup VRRP switchover is performed.</p>
<div class="notice"><span class="noticetitle"><img src="../../../../public_sys-resources/notice_3.0-en-us.png"> </span><div class="noticebody"><p>In DHCP server dual-device hot backup scenarios, to ensure that the master device can completely back up user session information to the backup device, set a preemption delay to over 600s for the master device. Set the preemption delay to an even larger value when the address pool contains a large number of IP addresses.</p>
</div></div>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=vrrp+vrid"><b><span class="cmdname">vrrp vrid</span></b></a> <i><span class="varname">virtual-router-id</span></i> <strong><span>priority</span></strong> <i><span class="varname">priority-value</span></i></span></span><p><p>A priority is configured for the VRRP group.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <span><a href="cmdqueryname=vrrp+vrid"><b><span class="cmdname">vrrp vrid</span></b></a> <i><span class="varname">virtual-router-id</span></i> <strong><span>timer</span></strong> <strong><span>advertise</span></strong> <i><span class="varname">advertise-interval</span></i></span></span><p><p>The interval for sending VRRP Advertisement packets is configured.</p>
</p><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The interval for sending VRRP Advertisement packets cannot be less than the time required for a master/backup switchover. Otherwise, VRRP intermittently goes Down. You are advised to set the interval for sending VRRP Advertisement packets to more than 1 second.</p>
</div></div>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span></span><p><p>The configuration is committed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span></span><p><p>Exit from the interface view.</p>
</p></li></ol>
</li><li><span>Configure an RBS.</span><ol type="a"><li class="substepexpand"><span>Run <a href="cmdqueryname=remote-backup-service"><b><span class="cmdname">remote-backup-service</span></b></a> <i><span class="varname">remote-backup-service-name</span></i></span><p><p>An RBS is created, and the RBS view is displayed.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <span><a href="cmdqueryname=bind+ssl-policy"><b><span class="cmdname">bind ssl-policy</span></b></a> <i><span class="varname">ssl-policy-name</span></i></span></span><p><p>An SSL policy is bound to the TCP connection.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">peer-ip-address</span></i> <a href="cmdqueryname=source"><b><span class="cmdname">source</span></b></a> <i><span class="varname">source-ip-address</span></i> <a href="cmdqueryname=port"><b><span class="cmdname">port</span></b></a> <i><span class="varname">port-id</span></i></span><p><p>TCP connection parameters are configured for the RBS.</p>
</p><p><p>The <i><span class="varname">peer-ip-address</span></i> parameter specifies the IP address of the peer device that backs up the local device, and the <i><span class="varname">source-ip-address</span></i> parameter specifies the IP address of the local device that backs up the peer device. The IP address of the peer device must be configured on a main interface, a sub-interface, or a logical interface (loopback interface) on the peer device. The IP address of the local device must be configured on a main interface, a sub-interface, or a logical interface (loopback interface) on the local device. The two IP addresses must be able to ping each other.</p>
<p>The <i><span class="varname">port-id</span></i> parameter specifies a listening port number. The TCP port numbers configured on the master and backup devices must be the same.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <span><a href="cmdqueryname=batch-backup"><b><span class="cmdname">batch-backup</span></b></a> <strong><span>service-type</span></strong> <strong><span>dhcp-server</span></strong> <strong><span>now</span></strong></span></span><p><p>The user service configured for the RBS is backed up instantly.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span></span><p><p>The configuration is committed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span></span><p><p>Exit from the RBS view.</p>
</p></li></ol>
</li><li><span>Configure an RBP.</span><ol type="a"><li class="substepexpand"><span>Run <span><a href="cmdqueryname=remote-backup-profile"><b><span class="cmdname">remote-backup-profile</span></b></a> <i><span class="varname">profile-name</span></i></span></span><p><p>An RBP is created, and the RBP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=peer-backup"><b><span class="cmdname">peer-backup</span></b></a> <strong><span>hot</span></strong></span></span><p><p>A backup mode is configured for user information backup between devices.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=vrrp-id"><b><span class="cmdname">vrrp-id</span></b></a> <i><span class="varname">vrid</span></i> <strong><span>interface</span></strong> <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i></span><p><p>The RBP is bound to the VRRP group.</p>
</p><p><p>The <i><span class="varname">vrid</span></i> parameter specifies the ID of a VRRP group. The ID must be the same as the VRRP group's ID that was configured using the <a href="cmdqueryname=vrrp+vrid"><b><span class="cmdname">vrrp vrid</span></b></a> <i><span class="varname">virtual-router-id</span></i> [ <strong><span>virtual-ip</span></strong> <i><span class="varname">virtual-address</span></i> ] command in the interface view.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=backup-id"><b><span class="cmdname">backup-id</span></b></a> <i><span class="varname">backup-id</span></i> <a href="cmdqueryname=remote-backup-service"><b><span class="cmdname">remote-backup-service</span></b></a> <i><span class="varname">service-name</span></i></span></span><p><p>The RBP is associated with the RBS, and the user backup ID for the RBP is set.</p>
</p><p><p>The <i><span class="varname">backup-id</span></i> parameter specifies a backup ID for the RBP. You can use a backup ID and an RBS to determine an RBP. The backup IDs configured for the same RBP must be the same on the master and backup devices and can no longer be configured for other RBPs.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span></span><p><p>The configuration is committed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span></span><p><p>Exit from the RBP view.</p>
</p></li></ol>
</li><li><span>Enable remote backup for the DHCP server.</span><ol type="a"><li class="substepexpand"><span>Run <a href="cmdqueryname=remote-backup-profile"><b><span class="cmdname">remote-backup-profile</span></b></a> <i><span class="varname">profile-name</span></i></span><p><p>An RBP is created, and the RBP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=service-type+dhcp-server"><b><span class="cmdname">service-type dhcp-server</span></b></a></span><p><p>Remote backup is enabled for the DHCP server.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span></span><p><p>The configuration is committed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span></span><p><p>Exit from the RBP view.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ip+pool"><b><span class="cmdname">ip pool</span></b></a> <i><span class="varname">ip-pool-name</span></i> [ <strong><span>server</span></strong> ]</span><p><p>The view of the address pool bound to the RBP is displayed.</p>
</p><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The <strong><span>server</span></strong> parameter is mandatory when an address pool is created for the first time. After the address pool is created, the address pool view is displayed. The <strong><span>server</span></strong> parameter is optional.</p>
</div></div>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=remote-backup-profile"><b><span class="cmdname">remote-backup-profile</span></b></a> <i><span class="varname">profile-name</span></i></span></span><p><p>The RBP is bound to the current address pool.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=server+identifier+ip"><b><span class="cmdname">server identifier ip</span></b></a> <i><span class="varname">ip-address</span></i></span><p><p>An identifier is configured for the DHCP server.</p>
</p><p><p>If an IP address has been
specified as the DHCP server identifier, ensure that routes from the
DHCP client to the IP address are reachable so that packets can be
properly sent to the DHCP server.</p>
<div class="p">In case of DHCP server dual-device hot backup:<ul><li>Configure the virtual IP address of the VRRP group on the inbound interfaces of the master and backup DHCP servers as the DHCP server identifier.</li><li>If an IP address has been specified to be included in the current address pool using the <a href="cmdqueryname=server+identifier+ip"><b><span class="cmdname">server identifier ip</span></b></a> command, the IP address cannot be assigned to users.</li></ul>
</div>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li></ol></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_dhcp_server_cfg_0011.html">Configuring a DHCP Server
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_dhcp_server_cfg_0014.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_dhcp_server_cfg_0024.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>