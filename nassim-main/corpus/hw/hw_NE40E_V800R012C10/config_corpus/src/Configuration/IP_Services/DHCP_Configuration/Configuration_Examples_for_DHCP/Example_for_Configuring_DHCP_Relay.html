
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring DHCP Relay">
<meta name="abstract" content="This section provides an example for configuring a DHCP relay agent to forward DHCP messages between the DHCP clients and the DHCP server on different network segments. This configuration is available only on carrier IP devices.">
<meta name="description" content="This section provides an example for configuring a DHCP relay agent to forward DHCP messages between the DHCP clients and the DHCP server on different network segments. This configuration is available only on carrier IP devices.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_dhcp_relay_cfg_0010.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_dhcp_server_cfg_0019.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,z00485179,w00556928,w00606909,dhcpvrp">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="DHCP">
<meta name="featuretype" content="IP Services">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="DHCP">
<meta name="featuretype" content="IP Services">
<meta name="featurename" content="DHCP">
<meta name="featuretype" content="IP Services">
<meta name="featurename" content="DHCP">
<meta name="featuretype" content="IP Services">
<meta name="OWNER" content="z00485179,x00504385">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="x00504385">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172364738">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring DHCP Relay</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172364738"></a><a name="EN-US_TASK_0172364738"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring DHCP Relay</h1>
<div class="taskbody"><p>This section provides an example for configuring a DHCP relay agent to forward DHCP messages between the DHCP clients and the DHCP server on different network segments. This configuration is available only on carrier IP devices.</p>
<div class="context"><a name="EN-US_TASK_0172364738__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>As shown in <a href="#EN-US_TASK_0172364738__fig_dc_vrp_dhcp_relay_cfg_001101">Figure 1</a>, the DHCP clients reside on the network segment 10.100.0.0/16, and the DHCP server resides on the network segment 172.16.0.0/16. To allow the DHCP clients to obtain configuration information (including IP addresses) from the DHCP server, configure a DHCP relay agent to forward DHCP messages between the clients.</p>
<p>The network segment of the DHCP client is 10.100.0.0/16. The IP address of the DNS server is 10.100.1.2/16, the IP address of the NetBIOS server is 10.100.1.3/16, and the IP address of the gateway is 10.100.1.1. User packets carrying different Option 60 values use different gateways to apply for IP addresses and match the corresponding address pools. On the DHCP server, configure two address pools with different gateway addresses. The routing table on the server contains at least one reachable route to network segment 10.100.0.0.</p>
<div class="fignone" id="EN-US_TASK_0172364738__fig_dc_vrp_dhcp_relay_cfg_001101"><a name="EN-US_TASK_0172364738__fig_dc_vrp_dhcp_relay_cfg_001101"></a><a name="fig_dc_vrp_dhcp_relay_cfg_001101"></a><span class="figcap"><b>Figure 1 </b>Configuring DHCP relay</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interface 1 and interface 2 in this example represent GE<span>0/1/0</span>.1 and GE<span>0/2/0</span>.1, respectively.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_dhcp_relay_cfg_001101.png"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172364738__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><div class="p">Configure a DHCP relay agent.<ol type="a"><li>Configure an IP address for GE<span>0/2/0</span>.1.</li><li>Configure the DHCP server address and enable DHCP relay on GE<span>0/1/0</span>.1.</li><li>Configure GE<span>0/1/0</span>.1 to use different Giaddr values to apply for IP addresses for user packets with different Option 60 values (<strong>abc</strong> and <strong>def</strong>).</li></ol>
</div>
</li><li>Configure the DHCP server.<ol type="a"><li>Configure a route from the DHCP server to GE<span>0/1/0</span>.1 on the DHCP relay agent.</li><li>Configure an IP address for GE<span>0/1/0</span>.1.</li><li>Configure IP addresses for the DNS server, NetBIOS server, and egress gateway.</li><li>Configure two address pools with different gateway addresses on the DHCP server.</li></ol>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172364738__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>IP address of the interface to have DHCP relay enabled</p>
</li><li><p>IP address of the DHCP server</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172364738__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure a DHCP relay agent.</span><p><p># Configure an IP address for GE<span>0/2/0</span>.1.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>]<strong> sysname <span class="keyword">Device</span>A</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A]<strong> interface GigabitEthernet <span>0/2/0</span></strong><strong>.1</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-GigabitEthernet<span>0/2/0</span>.1]<strong> ip address 172.16.1.1 255.255.0.0</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-GigabitEthernet<span>0/2/0</span>.1]<strong> </strong><strong>vlan-type dot1q</strong><strong> 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/2/0</span>.1]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/2/0</span>.1]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-GigabitEthernet<span>0/2/0</span>.1]<strong> quit</strong></pre>
<p># Configure the DHCP server address and enable DHCP relay on GE<span>0/1/0</span>. Configure the device to use gateway 10.100.20.1 for user packets with Option 60 being <strong>abc</strong> and gateway 10.100.30.1 for user packets with Option 60 being <strong>def</strong>.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A]<strong> dhcp enable</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A]<strong> interface gigabitethernet <span>0/1/0</span></strong><strong>.1</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/0</span>.1]<strong> ip address 10.100.1.1 255.255.0.0</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/0</span>.1]<strong> </strong><strong>ip address 10.100.20.1 255.255.255.0 sub</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/0</span>.1]<strong> </strong><strong>ip address 10.100.30.1 255.255.255.0 sub</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/0</span>.1]<strong> ip relay address 172.16.1.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/0</span>.1]<strong> ip relay giaddr 10.100.20.1</strong> <strong>dhcp-option 60 abc</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/0</span>.1]<strong> ip relay giaddr 10.100.30.1</strong> <strong>dhcp-option 60 def</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/0</span>.1]<strong> </strong><strong>vlan-type dot1q</strong><strong> 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/0</span>.1]<strong> dhcp select relay</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/0</span>.1]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/0</span>.1]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/0</span>.1]<strong> quit</strong></pre>
</p></li><li><span>Configure the DHCP server.</span><p><p># Configure a route from the DHCP server to GE<span>0/1/0</span>.1 on the DHCP relay agent.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>]<strong> ip route-static 10.100.1.1 16 172.16.1.1</strong></pre>
<p># Configure an IP address and enable the DHCP server function for GE <span>0/1/0</span>.1.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>]<strong> sysname <span class="keyword">Device</span>B</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B]<strong> interface GigabitEthernet <span>0/1/0</span></strong><strong>.1</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/0</span>.1]<strong> ip address 172.16.1.2 255.255.0.0</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/0</span>.1]<strong> </strong><strong>vlan-type dot1q</strong><strong> 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/0</span>.1]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/0</span>.1]<strong> dhcp server enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/0</span>.1]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/0</span>.1]<strong> quit</strong></pre>
<p># Configure two address pools with different gateway addresses on the DHCP server.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B]<strong> </strong><strong>ip pool pool1 server</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-ip-pool-pool1]<strong> gateway 10.100.20.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-ip-pool-pool1]<strong> section 0 10.100.20.2 10.100.20.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-ip-pool-pool1]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-ip-pool-pool1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B]<strong> </strong><strong>ip pool pool2 server</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-ip-pool-pool2]<strong> gateway 10.100.30.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-ip-pool-pool2]<strong> section 0 10.100.30.2 10.100.30.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-ip-pool-pool2]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-ip-pool-pool2]<strong> quit</strong></pre>
<p># Configure the DNS and NetBIOS servers.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font><span class="keyword">Device</span>B]<strong> ip pool pool1</strong></pre>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font><span class="keyword">Device</span>B-ip-pool-pool1]<strong> dns-server 10.100.1.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-ip-pool-pool1]<strong> netbios-name-server 10.100.1.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-ip-pool-pool1]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-ip-pool-pool1] <strong>quit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p>Run the <strong>display dhcp relay address</strong> command on the DHCP relay device to view configurations of the relay IP address.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A]<strong> display dhcp relay address all</strong></pre>
<pre class="screen">   ** GigabitEthernet<span>0/1/0</span>.1 DHCP Relay Address  **</pre>
<pre class="screen">          Dhcp Option          Relay Agent IP         Server IP</pre>
<pre class="screen">          *                    -                      <strong>172.16.1.2</strong></pre>
<pre class="screen">          60(abc)              10.100.20.1            -  </pre>
<pre class="screen">          60(def)              10.100.30.1            -      </pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172364738__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><div class="p"><span class="keyword">Device</span>A configuration file<pre class="screen">#</pre>
<pre class="screen">sysname <span class="keyword">Device</span>A</pre>
<pre class="screen">#</pre>
<pre class="screen">dhcp enable</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span>.1</pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> vlan-type dot1q 1</pre>
<pre class="screen"> ip address 10.100.1.1 255.255.0.0</pre>
<pre class="screen"> ip address 10.100.20.1 255.255.255.0 sub</pre>
<pre class="screen"> ip address 10.100.30.1 255.255.255.0 sub</pre>
<pre class="screen"> dhcp select relay</pre>
<pre class="screen"> ip relay address 172.16.1.2 </pre>
<pre class="screen"> ip relay giaddr 10.100.20.1 dhcp-option 60 abc</pre>
<pre class="screen"> ip relay giaddr 10.100.30.1 dhcp-option 60 def</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet <span>0/2/0</span>.1</pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> vlan-type dot1q 1</pre>
<pre class="screen"> ip address 172.16.1.1 255.255.0.0</pre>
<pre class="screen">#</pre>
<pre class="screen">return </pre>
</div>
</li><li><span class="keyword">Device</span>B configuration file<pre class="screen">#
ip route-static 10.100.1.1 16 172.16.1.1
#
sysname DeviceB
#
dhcp enable
#
interface GigabitEthernet <span>0/1/0</span>.1
 undo shutdown
 vlan-type dot1q 1
 ip address 172.16.1.2 255.255.0.0
 dhcp server enable
#
ip pool pool1 server
 gateway 10.100.20.1 255.255.255.0
 section 0 10.100.20.2 10.100.20.255
 dns-server 10.100.1.2 
 netbios-name-server 10.100.1.3 
#
ip pool pool2 server
 gateway 10.100.30.1 255.255.255.0
 section 0 10.100.30.2 10.100.30.255
#
return </pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_dhcp_relay_cfg_0010.html">Configuration Examples for DHCP
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_dhcp_server_cfg_0019.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>