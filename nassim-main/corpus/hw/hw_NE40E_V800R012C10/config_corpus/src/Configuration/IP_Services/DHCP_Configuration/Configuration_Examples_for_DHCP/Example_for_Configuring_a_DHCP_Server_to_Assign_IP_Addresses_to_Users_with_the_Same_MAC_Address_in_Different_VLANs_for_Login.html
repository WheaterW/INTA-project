
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring a DHCP Server to Assign IP Addresses to Users with the Same MAC Address in Different VLANs for Login">
<meta name="abstract" content="This section provides an example for configuring a DHCP server (with no relay agent configured) to assign IP addresses to Ethernet users with the same MAC addresses in different VLANs.">
<meta name="description" content="This section provides an example for configuring a DHCP server (with no relay agent configured) to assign IP addresses to Ethernet users with the same MAC addresses in different VLANs.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_dhcp_relay_cfg_0010.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_dhcp_server_cfg_0019.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_dhcp_server_cfg_0022.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,z00485179,w00556928,w00606909,dhcpvrp">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="DHCP">
<meta name="featuretype" content="IP Services">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="DHCP">
<meta name="featuretype" content="IP Services">
<meta name="featurename" content="DHCP">
<meta name="featuretype" content="IP Services">
<meta name="featurename" content="DHCP">
<meta name="featuretype" content="IP Services">
<meta name="OWNER" content="z00485179,x00504385">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="x00504385">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0139427840">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring a DHCP Server to Assign IP Addresses to Users with the Same MAC Address in Different VLANs for Login</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0139427840"></a><a name="EN-US_TASK_0139427840"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring a DHCP Server to Assign IP Addresses to Users with the Same MAC Address in Different VLANs for Login</h1>
<div class="taskbody"><p>This section provides an example for configuring a DHCP server (with no relay agent configured) to assign IP addresses to Ethernet users with the same MAC addresses in different VLANs.</p>
<div class="context"><a name="EN-US_TASK_0139427840__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>IP addresses of different network segments need to be applied for VoIP and IPTV services deployed on different user planes. DHCP clients that support these services use one MAC address to apply for IP addresses of different network segments and differentiate services based on VLAN IDs. This requires the DHCP server to assign IP addresses to users with the same MAC address in different VLANs.</p>
<p>On the network shown in <a href="#EN-US_TASK_0139427840__fig_dc_vrp_dhcp_server_cfg_002001">Figure 1</a>, the DHCP server is configured to dynamically assign IP addresses to DHCP clients. When receiving a user packet in which the VLAN ID is 100, the DHCP server selects the address pool <strong>pool1</strong> to assign an IP address to the user based on the gateway address 10.10.10.1/24. When receiving a user packet in which the VLAN ID is 200, the DHCP server selects the address pool <strong>pool2</strong> to assign an IP address to the user based on the gateway address 10.10.20.1/24.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The DHCP server can only assign IP addresses from different address pools to users with the same MAC address in different VLANs.</p>
</div></div>
<div class="fignone" id="EN-US_TASK_0139427840__fig_dc_vrp_dhcp_server_cfg_002001"><a name="EN-US_TASK_0139427840__fig_dc_vrp_dhcp_server_cfg_002001"></a><a name="fig_dc_vrp_dhcp_server_cfg_002001"></a><span class="figcap"><b>Figure 1 </b>Networking for configuring a DHCP server to assign IP addresses to users with the same MAC address in different VLANs for login</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interface 1 in this example represents <span>GE</span> <span>0/1/1</span>.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_dhcp_server_cfg_002001.png"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0139427840__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure an IP address for the interface through which users go online.</p>
</li><li><p>Configure gateway addresses and address segments for address pools.</p>
</li><li><p>Configure Layer 3 sub-interfaces.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0139427840__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>IP address of the interface through which users go online</p>
</li><li><p>Gateway addresses</p>
</li><li><p>Numbers and ranges of address segments</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0139427840__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure an IP address for the user access interface and enable the DHCP server function on the interface.</span><p><pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname DHCP Server</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DHCP Server] <strong>interface <span>gigabitethernet</span> <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DHCP Server-<span>GigabitEthernet</span><span>0/1/1</span>] <strong>ip address 10.1.1.1 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DHCP Server-<span>GigabitEthernet</span><span>0/1/1</span>] <strong>dhcp server enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DHCP Server-<span>GigabitEthernet</span><span>0/1/1</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DHCP Server-<span>GigabitEthernet</span><span>0/1/1</span>] <strong>quit</strong></pre>
</p></li><li><span>Configure gateway addresses and address segments for address pools.</span><p><p># Configure an address pool named <strong>pool1</strong>.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DHCP Server] <strong>dhcp enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DHCP Server] <strong>ip pool pool1<span> server</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>DHCP Server-ip-pool-pool1] <strong>gateway 10.10.10.1 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DHCP Server-ip-pool-pool1] <strong>section 0 10.10.10.20 10.10.10.30</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DHCP Server-ip-pool-pool1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DHCP Server-ip-pool-pool1] <strong>quit</strong></pre>
<p># Configure an address pool named <strong>pool2</strong>.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DHCP Server] <strong>ip pool pool2<span> server</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>DHCP Server-ip-pool-pool2] <strong>gateway 10.10.20.1 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DHCP Server-ip-pool-pool2] <strong>section 0 10.10.20.20 10.10.20.30</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DHCP Server-ip-pool-pool2] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DHCP Server-ip-pool-pool2] <strong>quit</strong></pre>
</p></li><li><span>Configure Layer 3 sub-interfaces (for example, dot1q VLAN tag termination sub-interfaces) and enable the DHCP server function on them.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DHCP Server] <strong>interface <span>gigabitethernet</span> <span>0/1/1</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DHCP Server-<span>GigabitEthernet</span><span>0/1/1</span>.1] <strong>ip address 10.10.10.1 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DHCP Server-<span>GigabitEthernet</span><span>0/1/1</span>.1] <strong>encapsulation dot1q-termination</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DHCP Server-<span>GigabitEthernet</span><span>0/1/1</span>.1] <strong>dot1q termination vid 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DHCP Server-<span>GigabitEthernet</span><span>0/1/1</span>.1] <strong>dhcp server enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DHCP Server-<span>GigabitEthernet</span><span>0/1/1</span>.1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DHCP Server-<span>GigabitEthernet</span><span>0/1/1</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DHCP Server] <strong>interface <span>gigabitethernet</span> <span>0/1/1</span>.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DHCP Server-<span>GigabitEthernet</span><span>0/1/1</span>.2] <strong>ip address 10.10.20.1 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DHCP Server-<span>GigabitEthernet</span><span>0/1/1</span>.2] <strong>encapsulation dot1q-termination</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DHCP Server-<span>GigabitEthernet</span><span>0/1/1</span>.2] <strong>dhcp server enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DHCP Server-<span>GigabitEthernet</span><span>0/1/1</span>.2] <strong>dot1q termination vid 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DHCP Server-<span>GigabitEthernet</span><span>0/1/1</span>.2] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DHCP Server-<span>GigabitEthernet</span><span>0/1/1</span>.2] <strong>quit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p># Run the <a href="cmdqueryname=display+ip+pool"><b><span class="cmdname">display ip pool</span></b></a> command on the DHCP server to check the IP address pool configuration.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DHCP Server]<strong> display ip pool name pool1</strong></pre>
<pre class="screen">  Pool-Name      : pool1
  Pool-No        : 2
  Pool-constant-index: -
  Lease          : 3 Days 0 Hours 0 Minutes
  NetBios Type   : N-Node
  Auto recycle   : 30
  Option 3       : Enable
  DNS-Suffix     : -
  Dom-Search-List0: -
  Dom-Search-List1: -
  Dom-Search-List2: -
  Dom-Search-List3: -
  Option-Code 125 : enterprise-code : 2011, string: -
  Position       : Server          Status           : Unlocked        
  RUI-Flag       : -
  Attribute      : Private         
  Gateway        : 10.10.10.1      Mask             : 255.255.255.0   
  Vpn instance   : --              Unnumbered gateway: -               
  Profile-Name   : -               Server-Name     : -               
  Total Idle     : 11              Have Dhcp IP     : 1
  Timeouts       : 0
  Timeout Count  : 0               Sub Option Count : 0               
  Option Count   : 0               Force-reply Count: 0               
  Codes: CFLCT(conflicted)
  ---------------------------------------------------------------------------------------
  ID           start             end total  used  idle CFLCT disable reserved static-bind
  ---------------------------------------------------------------------------------------
   0     10.10.10.20     10.10.10.30    11     0    11     0       0        0           0
  ---------------------------------------------------------------------------------------</pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DHCP Server]<strong> display ip pool name pool2</strong></pre>
<pre class="screen">  Pool-Name      : pool2
  Pool-No        : 3
  Pool-constant-index: -
  Lease          : 3 Days 0 Hours 0 Minutes
  NetBios Type   : N-Node
  Auto recycle   : 30
  Option 3       : Enable
  DNS-Suffix     : -
  Dom-Search-List0: -
  Dom-Search-List1: -
  Dom-Search-List2: -
  Dom-Search-List3: -
  Option-Code 125 : enterprise-code : 2011, string: -
  Position       : Server          Status           : Unlocked        
  RUI-Flag       : -
  Attribute      : Private         
  Gateway        : 10.10.20.1      Mask             : 255.255.255.0   
  Vpn instance   : --              Unnumbered gateway: -               
  Profile-Name   : -               Server-Name     : -               
  Total Idle     : 11              Have Dhcp IP     : 1
  Timeouts       : 0
  Timeout Count  : 0               Sub Option Count : 0               
  Option Count   : 0               Force-reply Count: 0               
  Codes: CFLCT(conflicted)
  ---------------------------------------------------------------------------------------
  ID           start             end total  used  idle CFLCT disable reserved static-bind
  ---------------------------------------------------------------------------------------
   0     10.10.20.20     10.10.20.30    11     0    11     0       0        0           0
  ---------------------------------------------------------------------------------------</pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0139427840__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><p>DHCP server configuration file</p>
<pre class="screen">#
sysname DHCP Server
#
dhcp enable
#
ip pool pool1<span> server</span>
<span> gateway 10.10.10.1 255.255.255.0  </span>
<span> section 0 10.10.10.20 10.10.10.30</span>
#
ip pool pool2<span> server</span>
<span> gateway 10.10.20.1 255.255.255.0  </span>
<span> section 0 10.10.20.20 10.10.20.30</span>
#
interface <span>GigabitEthernet</span><span>0/1/1</span>
 ip address 10.1.1.1 255.255.255.0
<strong> </strong>dhcp server enable
#
interface <span>GigabitEthernet</span><span>0/1/1</span>.1
 ip address 10.10.10.1 255.255.255.0
<span> encapsulation dot1q-termination</span>
 dot1q termination vid 100
 dhcp server enable
#
interface <span>GigabitEthernet</span><span>0/1/1</span>.2
 ip address 10.10.20.1 255.255.255.0
<span> encapsulation dot1q-termination</span>
 dot1q termination vid 200
 dhcp server enable
#
return</pre>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_dhcp_relay_cfg_0010.html">Configuration Examples for DHCP
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_dhcp_server_cfg_0019.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_dhcp_server_cfg_0022.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>