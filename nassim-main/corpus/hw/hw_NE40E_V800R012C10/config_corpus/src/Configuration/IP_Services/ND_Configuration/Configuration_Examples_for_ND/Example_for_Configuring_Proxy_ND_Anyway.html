
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Proxy ND Anyway">
<meta name="abstract" content="This section provides an example for configuring proxy ND anyway in a scenario where VMs are on the same network segment but different physical networks and the gateways connected to the VMs have the same address.">
<meta name="description" content="This section provides an example for configuring proxy ND anyway in a scenario where VMs are on the same network segment but different physical networks and the gateways connected to the VMs have the same address.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_nd_cfg_0009.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_nd_cfg_0010.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_nd_cfg_0012.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="y00852169,x00504385">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="ND">
<meta name="featuretype" content="IP Services">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="ND">
<meta name="featuretype" content="IP Services">
<meta name="featurename" content="ND">
<meta name="featuretype" content="IP Services">
<meta name="featurename" content="ND">
<meta name="featuretype" content="IP Services">
<meta name="OWNER" content="y00852169">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="x00504385">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172365194">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring Proxy ND Anyway</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172365194"></a><a name="EN-US_TASK_0172365194"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Proxy ND Anyway</h1>
<div class="taskbody"><p>This section provides an example for configuring proxy ND anyway in a scenario where VMs are on the same network segment but different physical networks and the gateways connected to the VMs have the same address.</p>
<div class="context"><a name="EN-US_TASK_0172365194__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>In scenarios where servers are partitioned into VMs, to allow flexible deployment and migration of VMs on multiple servers or gateways, the common solution is to configure Layer 2 interworking between multiple gateways. However, this approach may lead to larger Layer 2 domains on the network and risks of broadcast storms. To resolve this problem, a common way is to enable any proxy ND on a VM gateway so that the gateway sends its own MAC address to the source VM and the traffic sent from the source VM to other VMs is transmitted over routes.</p>
<div class="p">On the network shown in <a href="#EN-US_TASK_0172365194__fig_dc_vrp_nd_feature_002904">Figure 1</a>, the routes between DeviceA and DeviceB are reachable. If DeviceA or DeviceB does not need to determine whether routes destined for the peer device exist and the other VMs on the same subnet do not reply with packets carrying their MAC address to the request VM, configure proxy ND anyway to allow the VMs in different subnets to communicate with each other.<div class="fignone" id="EN-US_TASK_0172365194__fig_dc_vrp_nd_feature_002904"><a name="EN-US_TASK_0172365194__fig_dc_vrp_nd_feature_002904"></a><a name="fig_dc_vrp_nd_feature_002904"></a><span class="figcap"><b>Figure 1 </b>Proxy ND anyway</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interface1 in this example represents GE <span>0/1/1</span>.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_nd_feature_003706.png"></span><br></div>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172365194__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure a VLAN so that the VMs which need to communicate with each other reside in the same VLAN.</p>
</li><li><p>Configure interface attributes and bind the interfaces to the VLAN.</p>
</li><li><p>Assign IPv6 addresses to interfaces.</p>
</li><li><p>Configure proxy ND anyway on a device's VLANIF interface. After receiving an NS message (for the destination VM's MAC address) sent by the VM, the device that has proxy ND anyway enabled responds to the message with its own MAC address. The VM then forwards data to the device.</p>
</li><li><p>Configure advertisement of IPv6 NDP Vlink direct routes.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172365194__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>ID of the VLAN to which devices and VMs belong</p>
</li><li><p>IPv6 addresses of VM-side interfaces</p>
</li><li><p>IPv6 addresses of VMs</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172365194__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Create a VLAN.</span><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Configure the same VLAN ID on DeviceA and DeviceB.</p>
</div></div>
<div class="p"># Configure DeviceA.<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname DeviceA</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>vlan 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceA-vlan10] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA-vlan10] <strong>quit</strong></pre>
</div>
<div class="p"># Configure DeviceB.<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname DeviceB</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB] <strong>vlan 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceB-vlan10] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB-vlan10] <strong>quit</strong></pre>
</div>
</p></li><li><span>Configure interface attributes and bind the interfaces to the VLAN.</span><p><div class="p"># Configure DeviceA.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA-GigabitEthernet<span>0/1/1</span>] <strong>portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceA-GigabitEthernet<span>0/1/1</span>] <strong>port link-type access</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceA-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceA] <strong>vlan 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceA-vlan10] <strong>port gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceA-vlan10] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA-vlan10] <strong>quit</strong></pre>
</div>
<div class="p"># Configure DeviceB.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB-GigabitEthernet<span>0/1/1</span>] <strong>portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceB-GigabitEthernet<span>0/1/1</span>] <strong>port link-type access</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceB-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceB] <strong>vlan 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceB-vlan10] <strong>port gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceB-vlan10] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB-vlan10] <strong>quit</strong></pre>
</div>
</p></li><li><span>Assign IPv6 addresses to interfaces.</span><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Configure the same VLANIF interface address on DeviceA and DeviceB.</p>
</div></div>
<div class="p"># Configure DeviceA.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>interface vlanif 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceA-Vlanif10] <strong>ipv6 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceA-Vlanif10] <strong>ipv6 address 2001:db8:300:400::3 64</strong></pre>
</div>
<div class="p"># Configure DeviceB.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceB] <strong>interface vlanif 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceB-Vlanif10] <strong>ipv6 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceB-Vlanif10] <strong>ipv6 address 2001:db8:300:400::3 64</strong></pre>
</div>
</p></li><li><span>Enable proxy ND anyway and configure the advertisement of IPv6 NDP Vlink direct routes.</span><p><div class="p"># Configure DeviceA.<pre class="screen">[<span class="keyword">*</span>DeviceA-Vlanif10] <strong>ipv6 nd proxy anyway enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceA-Vlanif10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceA] <strong>ipv6 nd vlink-direct-route advertise</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceA] <strong>commit</strong></pre>
</div>
<div class="p"># Configure DeviceB.<pre class="screen">[<span class="keyword">*</span>DeviceB-Vlanif10] <strong>ipv6 nd proxy anyway enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceB-Vlanif10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceB] <strong>ipv6 nd vlink-direct-route advertise</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceB] <strong>commit</strong></pre>
</div>
</p></li><li><span>Configure VMs.</span><p><p># Configure the IPv6 address of VM1 as 2001:db8:300:400::1/64.</p>
<p># Configure the IPv6 address of VM2 as 2001:db8:300:400::2/64.</p>
</p></li><li><span>Verify the configuration.</span><p><p>After the configurations are complete, VM1 and VM2 can communicate with each other.</p>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172365194__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>DeviceA configuration file</p>
<pre class="screen">#
sysname DeviceA
#
vlan batch 10
#
interface GigabitEthernet<span>0/1/1</span>
<span> portswitch</span>
<span> port link-type access</span>
 port default vlan 10
#
interface Vlanif10
 ipv6 enable
 ipv6 address 2001:DB8:300:400::3/64
 ipv6 nd proxy anyway enable
#
<span> ipv6 nd vlink-direct-route advertise</span>
#
return</pre>
</li><li><p>DeviceB configuration file</p>
<pre class="screen">#
sysname DeviceB
#
vlan batch 10
#
interface GigabitEthernet<span>0/1/1</span>
<span> portswitch</span>
<span> port link-type access</span>
 port default vlan 10
#
interface Vlanif10
 ipv6 enable
 ipv6 address 2001:DB8:300:400::3/64
 ipv6 nd proxy anyway enable
#
<span> ipv6 nd vlink-direct-route advertise</span>
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_nd_cfg_0009.html">Configuration Examples for ND
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_nd_cfg_0010.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_nd_cfg_0012.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>