
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Global UCMP for IP Packet Forwarding">
<meta name="abstract" content="This section provides an example for configuring global UCMP for IP packet forwarding.">
<meta name="description" content="This section provides an example for configuring global UCMP for IP packet forwarding.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_loadba_cfg_2008.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_loadba_cfg_2009.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/load-balance_feature_055.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,56630517l00801610,z00485179,w00556928,w00606909,">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="Load Balance">
<meta name="featuretype" content="IP Services">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="Load Balance">
<meta name="featuretype" content="IP Services">
<meta name="featurename" content="Load Balance">
<meta name="featuretype" content="IP Services">
<meta name="featurename" content="Load Balance">
<meta name="featuretype" content="IP Services">
<meta name="OWNER" content="z00485179,z00648985">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="z00485179">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172365029">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/thickbox.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/imageResize.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery-migrate-1.2.1.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery-ui.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery.mousewheel.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/thickbox.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>Example for Configuring Global UCMP for IP Packet Forwarding</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172365029"></a><a name="EN-US_TASK_0172365029"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Global UCMP for IP Packet Forwarding</h1>
<div class="taskbody"><p>This section provides an example for configuring global UCMP for IP packet forwarding.</p>
<div class="context"><a name="EN-US_TASK_0172365029__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0172365029__fig_dc_ne_loadba_cfg_201001">Figure 1</a>, two paths connect <span class="keyword">Device</span>A and <span class="keyword">Device</span>C.</p>
<ul><li><p>A physical link connects <span class="keyword">Device</span>A's GE <span>0/2/0</span> and <span class="keyword">Device</span>B's GE <span>0/2/0</span>.</p>
</li><li><p><span class="keyword">Device</span>A's GE <span>0/3/0</span> and GE <span>0/3/1</span> and <span class="keyword">Device</span>B's GE <span>0/3/0</span> and GE <span>0/3/1</span> are added to Eth-Trunk1.</p>
</li></ul>
<p>Eth-Trunk1 contains two GE interfaces, and therefore the bandwidth of Eth-Trunk1 is the sum of the bandwidth of the two member GE links. To load balance IP traffic, configure global UCMP between the two links from <span class="keyword">Device</span>A to <span class="keyword">Device</span>C.</p>
<div class="fignone" id="EN-US_TASK_0172365029__fig_dc_ne_loadba_cfg_201001"><a name="EN-US_TASK_0172365029__fig_dc_ne_loadba_cfg_201001"></a><a name="fig_dc_ne_loadba_cfg_201001"></a><span class="figcap"><b>Figure 1 </b>Configuring global UCMP</span><br><span><img class="imgResize" src="images/fig_dc_ne_loadba_cfg_201001.png" width="523.621" height="84.78191400000001" title="Click to enlarge"></span></div>

<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" frame="border" border="1" rules="all"><caption><b>Table 1 </b>Device names, interface names, and IP addresses</caption><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="33.33333333333333%" id="mcps1.4.1.6.2.4.1.1" liSelected="liSelected"><p>Device Name</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="33.31333133313331%" id="mcps1.4.1.6.2.4.1.2" liSelected="liSelected"><p>Interface Name</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="33.35333533353336%" id="mcps1.4.1.6.2.4.1.3" liSelected="liSelected"><p>IP Address</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" rowspan="3" valign="top" width="33.33333333333333%" headers="mcps1.4.1.6.2.4.1.1 "><p></p>
<p><span class="keyword">Device</span>A</p>
<p></p>
</td>
<td class="cellrowborder" valign="top" width="33.31333133313331%" headers="mcps1.4.1.6.2.4.1.2 "><p>GE<span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" width="33.35333533353336%" headers="mcps1.4.1.6.2.4.1.3 "><p>10.1.1.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.6.2.4.1.2 "><p>GE <span>0/2/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.6.2.4.1.3 "><p>10.30.1.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.6.2.4.1.2 "><p>Eth-Trunk1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.6.2.4.1.3 "><p>10.40.1.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="3" valign="top" width="33.33333333333333%" headers="mcps1.4.1.6.2.4.1.1 "><p><span class="keyword">Device</span>B</p>
<p></p>
</td>
<td class="cellrowborder" valign="top" width="33.31333133313331%" headers="mcps1.4.1.6.2.4.1.2 "><p>GE <span>0/2/0</span></p>
</td>
<td class="cellrowborder" valign="top" width="33.35333533353336%" headers="mcps1.4.1.6.2.4.1.3 "><p>10.30.1.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.6.2.4.1.2 "><p>Eth-Trunk1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.6.2.4.1.3 "><p>10.40.1.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.6.2.4.1.2 "><p>GE<span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.6.2.4.1.3 "><p>10.50.1.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="2" valign="top" width="33.33333333333333%" headers="mcps1.4.1.6.2.4.1.1 "><p><span class="keyword">Device</span>C</p>
</td>
<td class="cellrowborder" valign="top" width="33.31333133313331%" headers="mcps1.4.1.6.2.4.1.2 "><p>GE <span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" width="33.35333533353336%" headers="mcps1.4.1.6.2.4.1.3 "><p>10.50.1.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.6.2.4.1.2 "><p>GE <span>0/2/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.6.2.4.1.3 "><p>10.20.1.1/24</p>
</td>
</tr>
</tbody>
</table>
</div>
<p></p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, the bandwidths of GE <span>0/2/0</span>, GE <span>0/3/0</span>, and GE <span>0/1/0</span> on <span class="keyword">Device</span>A and <span class="keyword">Device</span>B are all 1 Gbit/s.</p>
</div></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172365029__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure static routes on every <span class="keyword">Router</span>.</p>
</li><li><p>Enable global UCMP on <span class="keyword">Device</span>A, allowing the two paths between <span class="keyword">Device</span>A and <span class="keyword">Device</span>C to perform UCMP based on bandwidth ratios.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172365029__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>Type and number of each interface</p>
</li><li><p>IP address of each interface</p>
</li><li><p>Eth-Trunk interface number</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172365029__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Assign an IP address to each physical interface and Eth-Trunk interface. For configuration details, see <a href="#EN-US_TASK_0172365029__example1280346556214034">Configuration Files</a> in this section.</span></li><li><span>Configure static routes.</span><p><p># Configure <span class="keyword">Device</span>A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Router</span>A] <strong>ip route-static 10.20.1.0 255.255.255.0 gigabitethernet<span>0/2/0</span> 10.30.1.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Router</span>A] <strong>ip route-static 10.20.1.0 255.255.255.0 eth-trunk1 10.40.1.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Router</span>A] <strong>ip route-static 10.50.1.0 255.255.255.0 gigabitethernet<span>0/2/0</span> 10.30.1.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Router</span>A] <strong>ip route-static 10.50.1.0 255.255.255.0 eth-trunk1 10.40.1.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Router</span>A] <strong>commit</strong></pre>
<p># Configure <span class="keyword">Device</span>B.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Router</span>B] <strong>ip route-static 10.1.1.0 255.255.255.0 gigabitethernet<span>0/2/0</span> 10.30.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Router</span>B] <strong>ip route-static 10.1.1.0 255.255.255.0 eth-trunk1 10.40.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>ip route-static 10.20.1.0 255.255.255.0 gigabitethernet<span>0/1/0</span> 10.50.1.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Router</span>B] <strong>commit</strong></pre>
<p># Configure <span class="keyword">Device</span>C.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C] <strong>ip route-static 10.1.1.0 255.255.255.0 gigabitethernet<span>0/1/0</span> 10.50.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C] <strong>ip route-static 10.30.1.0 255.255.255.0 gigabitethernet<span>0/1/0</span> 10.50.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C] <strong>ip route-static 10.40.1.0 255.255.255.0 GigabitEthernet<span>0/1/0</span> 10.50.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Router</span>C] <strong>commit</strong></pre>
</p></li><li><span>Enable global UCMP on <span class="keyword">Device</span>A.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Router</span>A] <strong>load-balance unequal-cost enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Router</span>A] <strong>commit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p># Ping <span class="keyword">Device</span>A at 10.1.1.1 from <span class="keyword">Device</span>C. The ping operation is successful. Run the <strong>display interface brief</strong> command to view the bandwidth usage of outbound interfaces. The command output shows that Eth-Trunk1's bandwidth usage is similar to GE <span>0/2/0</span>'s bandwidth usage, meaning that UCMP has been enabled and traffic is load-balanced among outbound interfaces based on the bandwidth ratio.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Router</span>C] <strong>ping -c 100 -t 10 -m 10 10.1.1.1</strong></pre>
<pre class="screen">PING 10.1.1.1: 56  data bytes, press CTRL_C to break
    Reply from 10.1.1.1: bytes=56 Sequence=1 ttl=254 time=3 ms
    Reply from 10.1.1.1: bytes=56 Sequence=2 ttl=254 time=1 ms
    Reply from 10.1.1.1: bytes=56 Sequence=3 ttl=254 time=1 ms
...
 --- 10.1.1.1 ping statistics ---
    100 packet(s) transmitted
    99 packet(s) received
    1.00% packet loss
    round-trip min/avg/max = 1/1/6 ms</pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Router</span>B] <strong>display interface brief</strong></pre>
<pre class="screen">PHY: Physical
*down: administratively down
^down: standby
(l): loopback
(s): spoofing
(E): E-Trunk down
(b): BFD down
(B): Bit-error-detection down
(e): ETHOAM down
(d): Dampening Suppressed
(p): port alarm down
(ld): loop-detect trigger down
(td): transceiver unmatch down
(mf): mac-flapping blocked
(c): CFM down
(sd): STP instance discarding
(D): DF backup down
InUti/OutUti: input utility/output utility
Interface                   PHY   Protocol  InUti OutUti   inErrors  outErrors
Eth-Trunk1                  up    up        0.01%  6.66%          0          0
  <strong>GigabitEthernet<span>0/3/0</span>     up    up        0.01%  6.66%          0          0</strong>
<strong>  GigabitEthernet<span>0/3/1</span>     up    up        0.01%  6.66%          0          0</strong>
GigabitEthernet<span>0/1/0</span>        up    up           0%     0%          0          0
<strong>GigabitEthernet<span>0/2/0</span>       up    up        0.01%  6.67%          0          0</strong>
GigabitEthernet<span>0/2/1</span>        down  down         0%     0%          0          0
GigabitEthernet<span>0/2/3</span>        down  down         0%     0%          0          0
GigabitEthernet<span>0/2/4</span>        down  down         0%     0%          0          0
GigabitEthernet<span>0/2/5</span>        down  down         0%     0%          0          0
GigabitEthernet<span>0/2/6</span>        down  down         0%     0%          0          0
GigabitEthernet<span>0/2/7</span>        down  down         0%     0%          0          0
Ip-Trunk1                   down  down         0%     0%          0          0
LoopBack0                   down  up(s)        0%     0%          0          0
NULL0                       up    up           0%     0%          0          0</pre>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0172365029__example1280346556214034"><a name="EN-US_TASK_0172365029__example1280346556214034"></a><a name="example1280346556214034"></a><a name="EN-US_TASK_0172365029__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p><span class="keyword">Device</span>A configuration file</p>
<pre class="screen">#
 sysname <span class="keyword">Router</span>A
#
load-balance unequal-cost enable
#
interface Eth-Trunk1
 ip address 10.40.1.1 255.255.255.0
 load-balance packet-all
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.1.1 255.255.255.0
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.30.1.1 255.255.255.0
#
interface GigabitEthernet<span>0/3/0</span>
 undo shutdown
 eth-trunk 1
#
interface GigabitEthernet<span>0/3/1</span>
 undo shutdown
 eth-trunk 1
#
 ip route-static 10.20.1.0 255.255.255.0 GigabitEthernet<span>0/2/0</span> 10.30.1.2
 ip route-static 10.20.1.0 255.255.255.0 Eth-Trunk1 10.40.1.2
 ip route-static 10.50.1.0 255.255.255.0 GigabitEthernet<span>0/2/0</span> 10.30.1.2
 ip route-static 10.50.1.0 255.255.255.0 Eth-Trunk1 10.40.1.2
#
return</pre>
</li><li><p><span class="keyword">Device</span>B configuration file</p>
<pre class="screen">#
 sysname <span class="keyword">Router</span>B
#
interface Eth-Trunk1
 ip address 10.40.1.2 255.255.255.0
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.30.1.2 255.255.255.0
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.50.1.1 255.255.255.0
#
interface GigabitEthernet<span>0/3/0</span>
 undo shutdown
 eth-trunk 1
#
interface GigabitEthernet<span>0/3/1</span>
 undo shutdown
 eth-trunk 1
#
 ip route-static 10.1.1.0 255.255.255.0 GigabitEthernet<span>0/2/0</span> 10.30.1.1
 ip route-static 10.1.1.0 255.255.255.0 Eth-Trunk1 10.40.1.1
 ip route-static 10.20.1.0 255.255.255.0 GigabitEthernet<span>0/1/0</span><strong> </strong> 10.50.1.2
#
return
</pre>
</li><li><p><span class="keyword">Device</span>C configuration file</p>
<pre class="screen">#
 sysname <span class="keyword">Router</span>C
#
 ip route-static 10.1.1.0 255.255.255.0 GigabitEthernet<span>0/1/0</span> 10.50.1.1
 ip route-static 10.30.1.0 255.255.255.0 GigabitEthernet<span>0/1/0</span> 10.50.1.1
 ip route-static 10.40.1.0 255.255.255.0 GigabitEthernet<span>0/1/0</span> 10.50.1.1
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.20.1.1 255.255.255.0
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.50.1.2 255.255.255.0
#
return
</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_loadba_cfg_2008.html">Load Balancing Configuration Examples
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_loadba_cfg_2009.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/load-balance_feature_055.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>

<script language="JavaScript">
<!--
image_size('.imgResize');
var msg_imageMax = "view original image";
var msg_imageClose = "close";
//--></script></body>
</html>