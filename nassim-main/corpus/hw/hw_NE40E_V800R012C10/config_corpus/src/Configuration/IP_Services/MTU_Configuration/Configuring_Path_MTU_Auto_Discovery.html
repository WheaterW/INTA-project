
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring Path MTU Auto Discovery">
<meta name="abstract" content="Path MTU auto discovery allows BGP to discover the smallest MTU value on a path so that BGP messages are transmitted based on the path MTU. This function improves transmission efficiency and BGP performance.">
<meta name="description" content="Path MTU auto discovery allows BGP to discover the smallest MTU value on a path so that BGP messages are transmitted based on the path MTU. This function improves transmission efficiency and BGP performance.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/mtu_feature_007.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mplsm_cfg_0009_c.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_ethernet_cfg_2002_c.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,bgpvrp,w00556928,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="MTU">
<meta name="featuretype" content="IP Services">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="MTU">
<meta name="featuretype" content="IP Services">
<meta name="featurename" content="MTU">
<meta name="featuretype" content="IP Services">
<meta name="OWNER" content="w00604599">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00615954">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172364857">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring Path MTU Auto Discovery</title>
</head>
<body><a name="EN-US_TASK_0172364857"></a><a name="EN-US_TASK_0172364857"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring Path MTU Auto Discovery</h1>
<div class="taskbody"><p>Path MTU auto discovery allows BGP to discover the smallest MTU value on a path so that BGP messages are transmitted based on the path MTU. This function improves transmission efficiency and BGP performance.</p>
<div class="context"><a name="EN-US_TASK_0172364857__1.4.1"></a><a name="1.4.1"></a>
<div class="p" id="EN-US_TASK_0172364857__en-us_task_0172366235_context872398289214038"><h4 class="sectiontitle">Usage Scenario</h4><p id="EN-US_TASK_0172364857__en-us_task_0172366235_p520207967214038">The link-layer MTUs of different networks that a communication path traverses may vary. The smallest MTU on the path is the most important factor that influences the communication between the two ends of the path. The smallest MTU on the communication path is called the path MTU.</p>
<p id="EN-US_TASK_0172364857__en-us_task_0172366235_p759421548214038">The path MTU varies with the selected path and therefore may change. In addition, the path MTU in one direction may be inconsistent with that in the reverse direction. Enabling path MTU auto discovery allows a device to discover the path MTU from the transmit end to the receive end. TCP encapsulates IP packets based on the path MTU when transmitting BGP messages.</p>
<p id="EN-US_TASK_0172364857__en-us_task_0172366235_p1486443842214038">In <a href="#EN-US_TASK_0172364857__en-us_task_0172366235_fig_dc_vrp_bgp_cfg_305401">Figure 1</a>, path MTU auto discovery is not enabled, and a BGP peer relationship is established between <span class="keyword" id="EN-US_TASK_0172364857__en-us_task_0172366235_keyword924777326214323">Device</span> A and <span class="keyword" id="EN-US_TASK_0172364857__en-us_task_0172366235_keyword2119548713214323">Device</span> C. After <span class="keyword" id="EN-US_TASK_0172364857__en-us_task_0172366235_keyword1223452934214323">Device</span> A sends 9000-byte BGP messages to <span class="keyword" id="EN-US_TASK_0172364857__en-us_task_0172366235_keyword1794495642214323">Device</span> C, <span class="keyword" id="EN-US_TASK_0172364857__en-us_task_0172366235_keyword1248184269214323">Device</span> B fragments the messages upon reception by adding one IP header, one Layer 2 frame header, and one Layer 2 frame trailer in each fragment, which reduces transmission efficiency. If a fragment of a message is lost, the message becomes invalid.</p>
<div class="fignone" id="EN-US_TASK_0172364857__en-us_task_0172366235_fig_dc_vrp_bgp_cfg_305401"><a name="EN-US_TASK_0172364857__en-us_task_0172366235_fig_dc_vrp_bgp_cfg_305401"></a><a name="en-us_task_0172366235_fig_dc_vrp_bgp_cfg_305401"></a><span class="figcap"><b>Figure 1 </b>Network without path MTU auto discovery</span><br><span><img class="vsd" id="EN-US_TASK_0172364857__en-us_task_0172366235_image2128233976214038" src="images/fig_dc_vrp_bgp_cfg_305401.png" width="NaN" height="NaN"></span><br></div>
<p id="EN-US_TASK_0172364857__en-us_task_0172366235_p1834329741214038">In <a href="#EN-US_TASK_0172364857__en-us_task_0172366235_fig_dc_vrp_bgp_cfg_305402">Figure 2</a>, path MTU auto discovery is enabled, and a BGP peer relationship is established between <span class="keyword" id="EN-US_TASK_0172364857__en-us_task_0172366235_keyword1841672266214323">Device</span> A and <span class="keyword" id="EN-US_TASK_0172364857__en-us_task_0172366235_keyword760752322214323">Device</span> C. <span class="keyword" id="EN-US_TASK_0172364857__en-us_task_0172366235_keyword1633500159214323">Device</span> A sends 9000-byte BGP messages to <span class="keyword" id="EN-US_TASK_0172364857__en-us_task_0172366235_keyword1817566532214323">Device</span> C, and the path MTU is 6000 bytes. In this case, <span class="keyword" id="EN-US_TASK_0172364857__en-us_task_0172366235_keyword1463394593214323">Device</span> B does not fragment the messages upon reception, which improves transmission efficiency. </p>
<div class="fignone" id="EN-US_TASK_0172364857__en-us_task_0172366235_fig_dc_vrp_bgp_cfg_305402"><a name="EN-US_TASK_0172364857__en-us_task_0172366235_fig_dc_vrp_bgp_cfg_305402"></a><a name="en-us_task_0172366235_fig_dc_vrp_bgp_cfg_305402"></a><span class="figcap"><b>Figure 2 </b>Network with path MTU auto discovery</span><br><span><img class="vsd" id="EN-US_TASK_0172364857__en-us_task_0172366235_image739964483214038" src="images/fig_dc_vrp_bgp_cfg_305402.png" width="NaN" height="NaN"></span><br></div>
<div class="note" id="EN-US_TASK_0172364857__en-us_task_0172366235_note855388990214038"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><div class="p" id="EN-US_TASK_0172364857__en-us_task_0172366235_p1267221912214038">Enabling path MTU auto discovery affects TCP MSS calculation.<ul id="EN-US_TASK_0172364857__en-us_task_0172366235_en-us_cliref_0172379933_ul1745467225214134"><li id="EN-US_TASK_0172364857__en-us_task_0172366235_en-us_cliref_0172379933_li113581019214134"><p id="EN-US_TASK_0172364857__en-us_task_0172366235_en-us_cliref_0172379933_p1990707797214134"><a name="EN-US_TASK_0172364857__en-us_task_0172366235_en-us_cliref_0172379933_li113581019214134"></a><a name="en-us_task_0172366235_en-us_cliref_0172379933_li113581019214134"></a>When path MTU auto discovery is not enabled:</p>
<ul id="EN-US_TASK_0172364857__en-us_task_0172366235_en-us_cliref_0172379933_ul980831353214134"><li id="EN-US_TASK_0172364857__en-us_task_0172366235_en-us_cliref_0172379933_li1535642155214134"><p id="EN-US_TASK_0172364857__en-us_task_0172366235_en-us_cliref_0172379933_p1079229439214134"><a name="EN-US_TASK_0172364857__en-us_task_0172366235_en-us_cliref_0172379933_li1535642155214134"></a><a name="en-us_task_0172366235_en-us_cliref_0172379933_li1535642155214134"></a>For the sender, the TCP MSS is calculated using the following formula: <span class="menucascade" id="EN-US_TASK_0172364857__en-us_task_0172366235_en-us_cliref_0172379933_menucascade655090220214134"><b><span class="uicontrol" id="EN-US_TASK_0172364857__en-us_task_0172366235_en-us_cliref_0172379933_uicontrol2100153018214134">MSS = MIN { CFGMSS, MTU-40 }</span></b></span></p>
</li><li id="EN-US_TASK_0172364857__en-us_task_0172366235_en-us_cliref_0172379933_li1771161655214134"><p id="EN-US_TASK_0172364857__en-us_task_0172366235_en-us_cliref_0172379933_p1643104518214134"><a name="EN-US_TASK_0172364857__en-us_task_0172366235_en-us_cliref_0172379933_li1771161655214134"></a><a name="en-us_task_0172366235_en-us_cliref_0172379933_li1771161655214134"></a>For the receiver:</p>
<p id="EN-US_TASK_0172364857__en-us_task_0172366235_en-us_cliref_0172379933_p2116910531214134">When the device supports SYN Cookie, the MSS is calculated using the following formula: <span class="menucascade" id="EN-US_TASK_0172364857__en-us_task_0172366235_en-us_cliref_0172379933_menucascade2028761203214134"><b><span class="uicontrol" id="EN-US_TASK_0172364857__en-us_task_0172366235_en-us_cliref_0172379933_uicontrol1791675402214134">MSS = MIN { MIN { CFGMSS, MTU-40 } , internally-defined MSS value }</span></b></span></p>
<p id="EN-US_TASK_0172364857__en-us_task_0172366235_en-us_cliref_0172379933_p1055056643214134">If the device does not support SYN Cookie, the MSS is calculated using the following formula: <span class="menucascade" id="EN-US_TASK_0172364857__en-us_task_0172366235_en-us_cliref_0172379933_menucascade399376508214134"><b><span class="uicontrol" id="EN-US_TASK_0172364857__en-us_task_0172366235_en-us_cliref_0172379933_uicontrol1434573081214134">MSS = MIN { CFGMSS, MTU-40 }</span></b></span></p>
</li></ul>
</li><li id="EN-US_TASK_0172364857__en-us_task_0172366235_en-us_cliref_0172379933_li494423891214134"><p id="EN-US_TASK_0172364857__en-us_task_0172366235_en-us_cliref_0172379933_p1168105794214134"><a name="EN-US_TASK_0172364857__en-us_task_0172366235_en-us_cliref_0172379933_li494423891214134"></a><a name="en-us_task_0172366235_en-us_cliref_0172379933_li494423891214134"></a>When path MTU auto discovery is enabled:</p>
<ul id="EN-US_TASK_0172364857__en-us_task_0172366235_en-us_cliref_0172379933_ul987793062214134"><li id="EN-US_TASK_0172364857__en-us_task_0172366235_en-us_cliref_0172379933_li1113782680214134"><p id="EN-US_TASK_0172364857__en-us_task_0172366235_en-us_cliref_0172379933_p1878035508214134"><a name="EN-US_TASK_0172364857__en-us_task_0172366235_en-us_cliref_0172379933_li1113782680214134"></a><a name="en-us_task_0172366235_en-us_cliref_0172379933_li1113782680214134"></a>The sender updates the local MSS only when it sends a packet with the MSS greater than the path MTU. The TCP MSS is calculated using the following formula: <span class="menucascade" id="EN-US_TASK_0172364857__en-us_task_0172366235_en-us_cliref_0172379933_menucascade1667838000214134"><b><span class="uicontrol" id="EN-US_TASK_0172364857__en-us_task_0172366235_en-us_cliref_0172379933_uicontrol1076151513214134">MSS = MIN { MIN { CFGMSS, MTU-40 } , PMTU-40 }</span></b></span></p>
</li><li id="EN-US_TASK_0172364857__en-us_task_0172366235_en-us_cliref_0172379933_li1327007694214134"><p id="EN-US_TASK_0172364857__en-us_task_0172366235_en-us_cliref_0172379933_p1400638963214134"><a name="EN-US_TASK_0172364857__en-us_task_0172366235_en-us_cliref_0172379933_li1327007694214134"></a><a name="en-us_task_0172366235_en-us_cliref_0172379933_li1327007694214134"></a>For the receiver:</p>
<p id="EN-US_TASK_0172364857__en-us_task_0172366235_en-us_cliref_0172379933_p386886490214134">If the device supports SYN Cookie, the TCP MSS is calculated using the following formula: <span class="menucascade" id="EN-US_TASK_0172364857__en-us_task_0172366235_en-us_cliref_0172379933_menucascade337312139214134"><b><span class="uicontrol" id="EN-US_TASK_0172364857__en-us_task_0172366235_en-us_cliref_0172379933_uicontrol1455779687214134">MSS = MIN { MIN { MIN { CFGMSS, MTU-40 } , internally-defined MSS value } , PMTU-40 }</span></b></span></p>
<p id="EN-US_TASK_0172364857__en-us_task_0172366235_en-us_cliref_0172379933_p946223438214134">If the device does not support SYN Cookie, the TCP MSS is calculated using the following formula: <span class="menucascade" id="EN-US_TASK_0172364857__en-us_task_0172366235_en-us_cliref_0172379933_menucascade265734776214134"><b><span class="uicontrol" id="EN-US_TASK_0172364857__en-us_task_0172366235_en-us_cliref_0172379933_uicontrol1585878119214134">MSS = MIN { MIN { CFGMSS, MTU-40 } , PMTU-40 }</span></b></span></p>
</li></ul>
</li></ul>
</div>
<div class="p" id="EN-US_TASK_0172364857__en-us_task_0172366235_p1603347685214038">Parameters in the formula are described as follows:<ul id="EN-US_TASK_0172364857__en-us_task_0172366235_en-us_cliref_0172379933_ul520973582214134"><li id="EN-US_TASK_0172364857__en-us_task_0172366235_en-us_cliref_0172379933_li1411546254214134">CFGMSS: <span class="uicontrol" id="EN-US_TASK_0172364857__en-us_task_0172366235_en-us_cliref_0172379933_uicontrol242519462214134"><b>MIN { APPMSS, CLICFGMSS }</b></span><ul id="EN-US_TASK_0172364857__en-us_task_0172366235_en-us_cliref_0172379933_ul1316731007214134"><li id="EN-US_TASK_0172364857__en-us_task_0172366235_en-us_cliref_0172379933_li516048795214134">APPMSS: MSS value configured using the <a href="cmdqueryname=peer+tcp-mss"><b><span class="cmdname" id="EN-US_TASK_0172364857__en-us_task_0172366235_en-us_cliref_0172379933_cmdname146557656214134">peer tcp-mss</span></b></a> command</li><li id="EN-US_TASK_0172364857__en-us_task_0172366235_en-us_cliref_0172379933_li555750512214134">CLICFGMSS: maximum MSS value configured using the <a href="cmdqueryname=tcp+max-mss"><b><span class="cmdname" id="EN-US_TASK_0172364857__en-us_task_0172366235_en-us_cliref_0172379933_cmdname231739617214134">tcp max-mss</span></b></a> <i><span class="varname" id="EN-US_TASK_0172364857__en-us_task_0172366235_en-us_cliref_0172379933_varname2080135552214134">mss-value</span></i> command</li></ul>
</li><li id="EN-US_TASK_0172364857__en-us_task_0172366235_en-us_cliref_0172379933_li1034824423214134">MTU-40: interface MTU minus 40</li><li id="EN-US_TASK_0172364857__en-us_task_0172366235_en-us_cliref_0172379933_li1194439752214134">PMTU-40: path MTU minus 40</li><li id="EN-US_TASK_0172364857__en-us_task_0172366235_en-us_cliref_0172379933_li1401266545214134">internally-defined MSS value: MSS value, including 216, 460, 952, 1400, 2900, 4900, 7900, and 9500. Upon receipt of a packet, the receive-end device uses the internally-defined MSS value which is smaller than but closest to the MSS of the received packet.</li></ul>
</div>
</div></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172364857__1.4.2"></a><a name="1.4.2"></a>
<div class="p" id="EN-US_TASK_0172364857__en-us_task_0172366235_context247144537214038"><h4 class="sectiontitle">Pre-configuration Tasks</h4><p id="EN-US_TASK_0172364857__en-us_task_0172366235_p1619023698214323">Before configuring path MTU auto discovery, <a href="dc_vrp_bgp_cfg_3004.html">configure basic BGP functions</a>.</p>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172364857__1.4.3"></a><a name="1.4.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol id="EN-US_TASK_0172364857__en-us_task_0172366235_steps1563336589214038"><li id="EN-US_TASK_0172364857__en-us_task_0172366235_step86634122214038"><span id="EN-US_TASK_0172364857__en-us_task_0172366235_cmd33716841214323">Run <span><a href="cmdqueryname=system-view"><b><span class="cmdname" id="EN-US_TASK_0172364857__en-us_task_0172366235_cmdname1432143565214038">system-view</span></b></a></span></span><p><p id="EN-US_TASK_0172364857__en-us_task_0172366235_p1814215339214323">The system view is displayed.</p>
</p></li><li id="EN-US_TASK_0172364857__en-us_task_0172366235_step44171525214038"><span id="EN-US_TASK_0172364857__en-us_task_0172366235_cmd493517652214323">Run <span><a href="cmdqueryname=bgp"><b><span class="cmdname" id="EN-US_TASK_0172364857__en-us_task_0172366235_cmdname814907692214038">bgp</span></b></a> <i><span class="varname" id="EN-US_TASK_0172364857__en-us_task_0172366235_varname371237433214038">as-number</span></i></span></span><p><p id="EN-US_TASK_0172364857__en-us_task_0172366235_p742594647214323">The BGP view is displayed.</p>
</p></li><li id="EN-US_TASK_0172364857__en-us_task_0172366235_step1332240155214038"><span id="EN-US_TASK_0172364857__en-us_task_0172366235_cmd12862158538">Run <span><a href="cmdqueryname=peer+path-mtu+auto-discovery"><b><span class="cmdname" id="EN-US_TASK_0172364857__en-us_task_0172366235_cmdname1202453418214038">peer</span></b></a> { <i><span class="varname" id="EN-US_TASK_0172364857__en-us_task_0172366235_varname713842820214038">group-name</span></i> | <i><span class="varname" id="EN-US_TASK_0172364857__en-us_task_0172366235_varname5822062214038">ipv4-address</span></i> } <strong><span id="EN-US_TASK_0172364857__en-us_task_0172366235_cmdparmname71617419214038">path-mtu auto-discovery</span></strong></span></span><p><p id="EN-US_TASK_0172364857__en-us_task_0172366235_p1545619301737">Path MTU auto discovery is enabled.</p>
</p><p><p id="EN-US_TASK_0172364857__en-us_task_0172366235_p773741379214323">After the command is run, a BGP peer learns the path MTU, preventing BGP messages from being fragmented during transmission.</p>
<div class="note" id="EN-US_TASK_0172364857__en-us_task_0172366235_note691478352214038"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0172364857__en-us_task_0172366235_p1642648147214038">The forward and return transmission paths between two BGP peers may be different. Therefore, running this command on both ends is recommended so that the two BGP peers can send messages based on the path MTU.</p>
</div></div>
</p></li><li id="EN-US_TASK_0172364857__en-us_task_0172366235_step698704243214038"><span id="EN-US_TASK_0172364857__en-us_task_0172366235_cmd529911921214323">Run <span><a href="cmdqueryname=quit"><b><span class="cmdname" id="EN-US_TASK_0172364857__en-us_task_0172366235_cmdname1398123071214038">quit</span></b></a></span></span><p><p id="EN-US_TASK_0172364857__en-us_task_0172366235_p2042098230214323">Return to the system view.</p>
</p></li><li id="EN-US_TASK_0172364857__en-us_task_0172366235_step2060227208214038"><span id="EN-US_TASK_0172364857__en-us_task_0172366235_cmd212360628214038">Run <span><a href="cmdqueryname=tcp+timer+pathmtu-age"><b><span class="cmdname" id="EN-US_TASK_0172364857__en-us_task_0172366235_cmdname635255163214038">tcp timer pathmtu-age</span></b></a> <i><span class="varname" id="EN-US_TASK_0172364857__en-us_task_0172366235_varname246259145214038">age-time</span></i></span></span><p><p id="EN-US_TASK_0172364857__en-us_task_0172366235_p638513240214323">The aging time is set for an IPv4 path MTU.</p>
<p id="EN-US_TASK_0172364857__en-us_task_0172366235_p1633953813214323">The path MTUs vary with the path. If there are multiple routes between two communication hosts and the routes selected for packet transmission change frequently, configure the path MTU aging time so that the system updates path MTUs based on the path MTU aging time, increasing the transmission efficiency.</p>
</p></li><li id="EN-US_TASK_0172364857__en-us_task_0172366235_step1521227029214038"><span id="EN-US_TASK_0172364857__en-us_task_0172366235_cmd96166962214323">Run <span><a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0172364857__en-us_task_0172366235_cmdname814622484214038">commit</span></b></a></span></span><p><p id="EN-US_TASK_0172364857__en-us_task_0172366235_p1760513689214323">The configuration is committed.</p>
</p></li></ol></div>
<div class="postreq"><a name="EN-US_TASK_0172364857__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p id="EN-US_TASK_0172364857__en-us_task_0172366235_p2051333685214038">After performing all configurations related to path MTU auto discovery, you can run the <a href="cmdqueryname=display+bgp+peer+verbose"><b><span class="cmdname" id="EN-US_TASK_0172364857__en-us_task_0172366235_cmdname3483163712303">display bgp peer</span></b></a> [ <i><span class="varname" id="EN-US_TASK_0172364857__en-us_task_0172366235_varname348314377303">ipv4-address</span></i> ] <strong><span id="EN-US_TASK_0172364857__en-us_task_0172366235_cmdparmname04837372303">verbose</span></strong> command to check whether path MTU auto discovery is successfully configured in the detailed BGP peer information.</p>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/mtu_feature_007.html">MTU Configuration
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mplsm_cfg_0009_c.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_ethernet_cfg_2002_c.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>