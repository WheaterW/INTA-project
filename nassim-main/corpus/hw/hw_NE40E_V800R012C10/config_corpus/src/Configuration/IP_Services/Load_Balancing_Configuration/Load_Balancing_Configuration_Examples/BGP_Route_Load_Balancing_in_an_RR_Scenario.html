
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="concept">
<meta name="DC.Title" content="BGP Route Load Balancing in an RR Scenario">
<meta name="abstract" content="">
<meta name="description" content="">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_loadba_cfg_2008.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_loadba_cfg_2010.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/load-balance_feature_056.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,56630517l00801610,z00485179,w00556928,w00606909,">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="Load Balance">
<meta name="featuretype" content="IP Services">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="Load Balance">
<meta name="featuretype" content="IP Services">
<meta name="featurename" content="Load Balance">
<meta name="featuretype" content="IP Services">
<meta name="featurename" content="Load Balance">
<meta name="featuretype" content="IP Services">
<meta name="OWNER" content="z00485179,z00648985">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="z00485179">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_CONCEPT_0172365035">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>BGP Route Load Balancing in an RR Scenario</title>
</head>
<body><a name="EN-US_CONCEPT_0172365035"></a><a name="EN-US_CONCEPT_0172365035"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">BGP Route Load Balancing in an RR Scenario</h1>
<div><p></p>
<div class="section"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_CONCEPT_0172365035__fig_load-balance_feature_05501">Figure 1</a>, an RR is deployed in AS 100. The RR learns external routes from two egress routers and reflects the routing information to its clients (R1, R2, ..., Rn). All the clients have equal-cost upstream links to the egress routers. However, the RR selects an optimal route from those received from the two egress routers and reflects only the optimal route to its clients. Therefore, the external routing information received by each client has only one next hop (either egress 1 or 2). As a result, traffic cannot be load-balanced.</p>
<div class="fignone" id="EN-US_CONCEPT_0172365035__fig_load-balance_feature_05501"><a name="EN-US_CONCEPT_0172365035__fig_load-balance_feature_05501"></a><a name="fig_load-balance_feature_05501"></a><span class="figcap"><b>Figure 1 </b>Load balancing among BGP routes</span><br><span><img class="vsd" src="images/fig_load-balance_feature_05501.png" width="NaN" height="NaN"></span></div>
</div>
<div class="section"><h4 class="sectiontitle">Solution 1</h4><p>Establish an IBGP peer relationship with the RR on egress 1 and egress 2, create Loopback1 interfaces, and set the same IP address for the interfaces. Configure a route-policy to change the next hop of routes advertised to the RR to the address of Loopback1.</p>
<p>After BGP routes recurse to IGP routes, traffic can be load-balanced between routes from each client to each egress router because of the same next hop addresses on the two egress routers.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>To maintain the stability of the entire network and prevent unpredictable problems, it is recommended that the loopback interfaces with the same IP address on egress 1 and egress 2 be configured only as the next hops of the routes for load balancing.</p>
</div></div>
</div>
<div class="section"><h4 class="sectiontitle">Solution 2</h4><p>Configure a route-policy on the RR in AS 100 so that traffic destined for AS 300 passes through egress 1 and that traffic destined for AS 400 passes through egress 2, as shown in <a href="#EN-US_CONCEPT_0172365035__fig_load-balance_feature_05502">Figure 2</a>.</p>
<div class="fignone" id="EN-US_CONCEPT_0172365035__fig_load-balance_feature_05502"><a name="EN-US_CONCEPT_0172365035__fig_load-balance_feature_05502"></a><a name="fig_load-balance_feature_05502"></a><span class="figcap"><b>Figure 2 </b>Load balancing among BGP routes</span><br><span><img class="vsd" src="images/fig_load-balance_feature_05502.png" width="NaN" height="NaN"></span></div>
<p>Perform the following operations on the RR in AS 100:</p>
<ol><li>Run the <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a> command to enter the system view.</li><li>Configure AS_Path filters in regular expression to differentiate routes destined for AS 300 and AS 400.<ol type="a"><li>Run the <a href="cmdqueryname=ip+as-path-filter"><b><span class="cmdname">ip as-path-filter</span></b></a> <i><span class="varname">ToAS300</span></i><strong> permit [ 300 ]</strong> command to configure an AS_Path filter for routes destined for AS 300.</li><li>Run the <a href="cmdqueryname=ip+as-path-filter"><b><span class="cmdname">ip as-path-filter</span></b></a> <i><span class="varname">ToAS400</span></i><strong> permit [ 400 ]</strong> command to configure an AS_Path filter for routes destined for AS 400.</li></ol>
</li><li>Configure node 10 for the route-policy to set the next hop of routes destined for AS 300 to egress 1.<ol type="a"><li>Run the <a href="cmdqueryname=route-policy"><b><span class="cmdname">route-policy</span></b></a> <strong>policy1 permit node 10</strong> command to create node 10 for the route-policy.</li><li>Run the <a href="cmdqueryname=if-match+as-path-filter"><b><span class="cmdname">if-match as-path-filter</span></b></a> <strong>ToAS300</strong> command to configure an <strong>if-match</strong> clause to match routes destined for AS 300.</li><li>Run the <a href="cmdqueryname=apply+ip-address+next-hop"><b><span class="cmdname">apply ip-address next-hop</span></b></a> <em>ipv4-address</em> command to set the next hop of routes destined for AS 300 to egress 1.</li></ol>
</li><li>Configure node 20 for the route-policy to set the next hop of routes destined for AS 400 to egress 2.<ol type="a"><li>Run the <a href="cmdqueryname=route-policy"><b><span class="cmdname">route-policy</span></b></a> <strong>policy1 permit node 20</strong> command to create node 20 for the route-policy.</li><li>Run the <a href="cmdqueryname=if-match+as-path-filter"><b><span class="cmdname">if-match as-path-filter</span></b></a><strong> ToAS400</strong> command to configure an <strong>if-match</strong> clause to match routes destined for AS 400.</li><li>Run the <a href="cmdqueryname=apply+ip-address+next-hop"><b><span class="cmdname">apply ip-address next-hop</span></b></a> <em>ipv4-address</em> command to set the next hop of routes destined for AS 400 to egress 2.</li></ol>
</li><li>Reflect the BGP routes after the next hop modification to clients.<ol type="a"><li>Run the <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a> command to enter the system view.</li><li>Run the <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <strong>100</strong> command to enter the BGP view.</li><li>Run the <a href="cmdqueryname=ipv4-family"><b><span class="cmdname">ipv4-family</span></b></a> <strong>unicast</strong> command to enter the BGP IPv4 unicast address family view.</li><li>Run the <a href="cmdqueryname=peer+route-policy"><b><span class="cmdname">peer route-policy</span></b></a> <em>group-name</em> <strong>policy1</strong> <strong>export</strong> command to configure an AS_Path-based route-policy.</li></ol>
</li><li>Run the <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a> command to commit the configuration.</li></ol>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this instance, an AS_Path-based filter is configured on the RR to filter routes. To implement more refined route filtering, you can configure a community filter or an ACL, IP prefix list, extcommunity filter, or RD filter, among which, the extcommunity filter and RD filter take effect only on VPNv4<span> and VPNv6</span> routes, and the rest filters take effect on both VPN routes and public routes.</p>
</div></div>
</div>
<div class="section"><h4 class="sectiontitle">Follow-up Procedure</h4><p>Run the <a href="cmdqueryname=save"><b><span class="cmdname">save</span></b></a> command to save the current configuration to the configuration file when a set of configuration is finished and the expected functions have been achieved.</p>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_loadba_cfg_2008.html">Load Balancing Configuration Examples
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_loadba_cfg_2010.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/load-balance_feature_056.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>