
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="BGP/BGP4+">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_sec_hardening_control_level2.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_sec_maintenance_0026.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_sec_maintenance_0037.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="z00588052,w00604599">
<meta name="DC.Publisher" content="20240229">
<meta name="OWNER" content="z00588052,w00604599">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="x60031980">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001134463726">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>BGP/BGP4+</title>
</head>
<body><a name="EN-US_TASK_0000001134463726"></a><a name="EN-US_TASK_0000001134463726"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">BGP/BGP4+</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001134463726__1.3.1"></a><a name="1.3.1"></a>
<div class="p"><div class="p"><h4 class="sectiontitle">Security Policy Overview</h4><ul><li><p>BGP MD5 authentication</p>
<p>BGP uses TCP as its transport layer protocol and considers a TCP packet valid if the source IP address, destination IP address, source port number, destination port number, and TCP sequence number in the packet are correct. Most of the preceding parameters in a TCP packet can be obtained by attackers without much difficulty. To protect BGP from attacks, you can configure MD5 authentication over TCP between BGP peers.</p>
<p>The cleartext passwords configured on both ends must be the same. If the interval between the configuration completions of the two devices is greater than <strong>hold-time</strong>, the peer relationship is interrupted. Otherwise, the peer relationship is not interrupted.</p>
<p>To prevent an MD5 password configured for a BGP peer from being cracked, change the password periodically.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The MD5 algorithm is not recommended if high security is required.</p>
</div></div>
</li><li><p>Keychain authentication</p>
<p>A keychain consists of multiple authentication keys, each of which contains an ID and a password. Each key in a keychain has a lifecycle, and keys are dynamically selected based on the lifecycle of each key. After a keychain with the same rules is configured on the two ends of a BGP session, authentication keys are dynamically selected to enhance BGP attack defense.</p>
</li><li>TCP-AO authentication<p>The TCP authentication option (TCP-AO) is used to authenticate received and to-be sent packets during TCP session establishment and data exchange. It supports packet integrity check to prevent TCP replay attacks. TCP-AO authentication improves the security of the TCP connection between BGP peers and is applicable to the network that requires high security.</p>
</li><li><p>BGP GTSM</p>
<p>GTSM checks TTL values to defend against attacks. Attackers may simulate BGP messages and continuously send them to the <span class="keyword">Router</span>. After receiving these packets, the interface board on the <span class="keyword">Router</span> sends these messages directly to the control plane for BGP processing, without validating them, if they are destined for the device. The <span class="keyword">Router</span> becomes extremely busy, and CPU usage is high because the control plane of the <span class="keyword">Router</span> needs to process these unchecked messages.</p>
<p>GTSM protects the <span class="keyword">Router</span> by checking whether the TTL value in the IP packet header is within a pre-defined range to improve system security.</p>
</li><li><p>BGP whitelist</p>
<p>The application layer association module checks protocol packets sent to the CPU and sends protocol packets that match the whitelist at a high rate.</p>
</li><li><p>CP-CAR</p>
<p>For enabled services or protocols, a device can limit the rate at which packets are sent to the CPU, protecting the CPU from attacks and ensuring proper network operating.</p>
</li><li>Session-CAR<p>The function of whitelist session-CAR for BGP sets an independent CAR channel for each BGP session to ensure that the bandwidth of each BGP session is not preempted by other traffic (including traffic from other sessions of the same protocol and traffic from other protocols). When BGP messages suffer a traffic burst, you can adjust the default parameters of whitelist session-CAR for BGP if they do not meet service requirements. This ensures that BGP messages can be sent properly.</p>
</li><li><p>Route over-threshold control</p>
<p>In most cases, a BGP routing table contains a large number of routes. If a lot of routes are received from a peer, excessive system resources may be consumed. To prevent this issue, you can set the maximum number of routes that the local BGP device can accept from the peer.</p>
</li><li><p>Limit on the quantity of AS numbers in the AS_Path attribute</p>
<p>When a BGP device receives a route, it checks whether the quantity of AS numbers in the AS_Path attribute exceeds a specified threshold. If the quantity exceeds the threshold, the device discards the route. During route advertisement, the device also checks whether the quantity of AS numbers in the AS_Path attribute exceeds the threshold. If the quantity exceeds the threshold, the device does not advertise the route, which prevents maliciously constructed error messages with an extra-long AS_Path from attacking the <span class="keyword">Router</span>.</p>
</li><li><p>RPKI</p>
<p>Resource Public Key Infrastructure (RPKI) ensures BGP security by verifying the validity of the BGP route source AS, AS_Path, or route advertiser.</p>
<p>Attackers can steal user data by advertising routes that are more specific than those advertised by carriers. RPKI can resolve this problem. For example, if a carrier advertises a valid route with the destination address of 10.10.0.0/16 to a user and an attacker advertises a route with the destination address of 10.10.153.0/24, the traffic from the user to 10.10.153.0/24 will be stolen by the attacker because the route advertised by the attacker is more specific.</p>
<p>To solve the preceding problem, you can configure Route Origin Authorization (ROA), Autonomous System Provider Authorization (ASPA), or regional validation. This helps ensure BGP security.</p>
</li><li><p>BMP</p>
<p>The BGP Monitoring Protocol (BMP) monitors devices' BGP<span>/BGP4+</span> running status in real time, such as the establishment and termination status of BGP<span>/BGP4+</span> peer relationships and route update status.</p>
<p>BMP is mainly applied to the networking where a monitoring server exists and the BGP/BGP4+ running status of devices on the network needs to be monitored. BMP changes the traditional method of obtaining the BGP<span>/BGP4+</span> running status of devices through manual query and greatly improves the efficiency of network monitoring.</p>
</li><li>BGP TLS authentication<p>The Transport Layer Security (TLS) protocol, as the SSL successor, ensures data integrity and privacy. SSL/TLS authentication can be configured on an SSL server so that BGP messages are encrypted to ensure data transmission security on the network.</p>
</li></ul>
<h4 class="sectiontitle">Attack Methods</h4><ul><li><p>DoS attacks</p>
<p>Attackers can send various types of packets to attack devices. If the packets are multicast protocol packets or the destination IP address is the IP address of an interface (including the loopback interface) on the device, the device sends these packets to the CPU. These packets consume the CPU and system resources, causing DoS attacks. After a BGP session is created, the system sends a whitelist. The <span>application layer association</span> module checks the received protocol packets and sends protocol packets that match the whitelist at a high rate. The module sends protocol packets that do not match the whitelist at the default bandwidth and rate to prevent DoS attacks. In addition, CP-CAR applies to interfaces to limit the transmission rate of BGP packets, to protect the CPU from attacks, and to ensure proper network operations.</p>
</li><li><p>Injection of a large number of BGP routes</p>
<p>BGP runs on various models of devices, such as the IASs on an access network and <span class="keyword">NE40E</span>s. The number of BGP routes is determined by the CPU and memory of a device. If the number of BGP routes received by a device exceeds the capacity of the device, memory resources of the device will be exhausted, causing the device and services on it to fail to run properly. The maximum number of routes for a single peer can be set. If attackers inject a large number of routes and the quantity exceeds the maximum number of routes for a single peer, the excess routes are discarded to prevent exhaustion of system resources.</p>
</li><li><p>Construction of error BGP messages</p>
<p>Attackers may construct various types of error packets, such as packets with extra-long AS_Paths, packets with incorrect packet headers, packets with incorrect lengths, and packets with invalid next hops. The attackers use these error packets to attack devices. BGP implements a policy "tolerant on input and strict on output". The device discards error packets without interrupting connections to peers to ensure uninterrupted services. For packets with extra-long AS_Paths, an AS_Path limit is set. During route reception or advertisement, if the device finds that the AS_Path exceeds the limit, it refuses to accept or advertise routes.</p>
<p>A BGP Update message contains various path attributes. If a local device receives Update messages containing malformed path attributes, the involved BGP sessions may flap. To resolve this issue and enhance reliability, run the <strong>peer path-attribute-treat</strong> command to configure a special mode in which the device processes specified path attributes in received BGP Update messages. Special modes indicate those that are not defined in a standard protocol.</p>
</li><li><p>Network packet attacks</p>
<p>It is easy for attackers to obtain the majority of parameters in the 5-tuple of a packet. To protect BGP from attacks, take the following measures:</p>
<ul><li><p>Use TCP MD5 authentication between BGP peers to reduce the possibility of being attacked.</p>
</li><li><p>Configure keychain authentication for BGP sessions to enhance BGP anti-attack performance.</p>
</li><li><p>Configure the GTSM function to check TTLs in messages to prevent attacks.</p>
</li></ul>
</li></ul>
</div>
</div></div>
<div class="steps-unordered"><a name="EN-US_TASK_0000001134463726__1.3.2"></a><a name="1.3.2"></a><h4 class="sectiontitle">Procedure</h4>
<ul><li><span>Configure MD5 authentication.</span><p><p>An MD5 authentication password is configured for TCP connections, and TCP implements MD5 authentication of BGP. If authentication fails, no TCP connections can be established.</p>
</p><ol><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <a href="cmdqueryname=password"><b><span class="cmdname">password</span></b></a> { <strong><span>cipher</span></strong> <i><span class="varname">cipher-password</span></i><span> | <strong><span>simple</span></strong> <i><span class="varname">simple-password</span></i></span> }</span><p><p>An MD5 authentication password is configured.</p>
</p><p><p>The password can be set in either of the following modes:</p>
<ul><li><strong><span>cipher</span></strong> <i><span class="varname">cipher-password</span></i>: indicates that a password is set using a ciphertext string.</li><li><strong><span>simple</span></strong> <i><span class="varname">simple-password</span></i>: indicates that a password is set using a cleartext string.</li></ul>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>If MD5 authentication is configured in the BGP view, the configuration also takes effect in extended BGP address family views because they use the same TCP connection. BGP MD5 authentication and BGP keychain authentication are mutually exclusive.</p>
</div></div>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><ul id="EN-US_TASK_0000001134463726__en-us_task_0000001143239100_ul389508518213918"><li id="EN-US_TASK_0000001134463726__en-us_task_0000001143239100_li1977065046213918"><p id="EN-US_TASK_0000001134463726__en-us_task_0000001143239100_password_tips_1"><a name="EN-US_TASK_0000001134463726__en-us_task_0000001143239100_li1977065046213918"></a><a name="en-us_task_0000001143239100_li1977065046213918"></a>The new password is at least eight characters long and contains at least two of the following types: upper-case letters, lower-case letters, digits, and special characters, except the question mark (?) and space.</p>
</li><li id="EN-US_TASK_0000001134463726__en-us_task_0000001143239100_li363226100213918"><p id="EN-US_TASK_0000001134463726__en-us_task_0000001143239100_password_tips_2"><a name="EN-US_TASK_0000001134463726__en-us_task_0000001143239100_li363226100213918"></a><a name="en-us_task_0000001143239100_li363226100213918"></a>For security purposes, you are advised to configure a password in ciphertext mode. To further improve device security, periodically change the password.</p>
</li></ul>
</div></div>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li><span>Configure keychain authentication.</span><p><p>Configure keychain authentication on both ends of a BGP peer relationship. In addition, the configured keychains must use the same encryption algorithm and password so that TCP connections can be set up, and BGP messages can be exchanged properly.</p>
</p><ol><li class="substepexpand" id="EN-US_TASK_0000001134463726__en-us_task_0172366286_substep1927941572214038"><span id="EN-US_TASK_0000001134463726__en-us_task_0172366286_cmd390522537214323">Run <span><a href="cmdqueryname=system-view"><b><span class="cmdname" id="EN-US_TASK_0000001134463726__en-us_task_0172366286_cmdname1469434692214038">system-view</span></b></a></span></span><p><p id="EN-US_TASK_0000001134463726__en-us_task_0172366286_p1881780774214323">The system view is displayed.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0000001134463726__en-us_task_0172366286_substep727337831214038"><span id="EN-US_TASK_0000001134463726__en-us_task_0172366286_cmd814569652214323">Run <span><a href="cmdqueryname=bgp"><b><span class="cmdname" id="EN-US_TASK_0000001134463726__en-us_task_0172366286_cmdname295046271214038">bgp</span></b></a> <i><span class="varname" id="EN-US_TASK_0000001134463726__en-us_task_0172366286_varname1420341579214038">as-number</span></i></span></span><p><p id="EN-US_TASK_0000001134463726__en-us_task_0172366286_p2090343766214323">The BGP view is displayed.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0000001134463726__en-us_task_0172366286_substep1255655738214038"><span id="EN-US_TASK_0000001134463726__en-us_task_0172366286_cmd484189497214038">Run <span><a href="cmdqueryname=peer"><b><span class="cmdname" id="EN-US_TASK_0000001134463726__en-us_task_0172366286_cmdname1025492648214038">peer</span></b></a> { <i><span class="varname" id="EN-US_TASK_0000001134463726__en-us_task_0172366286_varname1504694110214038">ipv4-address</span></i> | <i><span class="varname" id="EN-US_TASK_0000001134463726__en-us_task_0172366286_varname1699773611214038">group-name</span></i> } <a href="cmdqueryname=keychain"><b><span class="cmdname" id="EN-US_TASK_0000001134463726__en-us_task_0172366286_cmdname2143768661214038">keychain</span></b></a> <i><span class="varname" id="EN-US_TASK_0000001134463726__en-us_task_0172366286_varname1731988430214038">keychain-name</span></i></span></span><p><p id="EN-US_TASK_0000001134463726__en-us_task_0172366286_p887329740214323">Keychain authentication is configured.</p>
<p id="EN-US_TASK_0000001134463726__en-us_task_0172366286_p758600283214323">To ensure the setup of a TCP connection and BGP exchange between on both ends of a BGP connection, configure keychain authentication specified for TCP-based applications and the same password and encryption algorithms on both ends.</p>
<p id="EN-US_TASK_0000001134463726__en-us_task_0172366286_p1879297221214323"><i><span class="varname" id="EN-US_TASK_0000001134463726__en-us_task_0172366286_varname158913271214323">keychain-name</span></i> specified in this command must exist; otherwise, the TCP connection cannot be established. For keychain configuration details, see the "Keychain Configuration" chapter in <em id="EN-US_TASK_0000001134463726__en-us_task_0172366286_i1521571294214323"><span class="keyword" id="EN-US_TASK_0000001134463726__en-us_task_0172366286_keyword813469782214323">HUAWEI NE40E-M2 series</span> Configuration Guide - Security</em>.</p>
<div class="note" id="EN-US_TASK_0000001134463726__en-us_task_0172366286_note932532795214038"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><ul id="EN-US_TASK_0000001134463726__en-us_task_0172366286_ul743029759214038"><li id="EN-US_TASK_0000001134463726__en-us_task_0172366286_li50272314214038"><p id="EN-US_TASK_0000001134463726__en-us_task_0172366286_p965708127214038"><a name="EN-US_TASK_0000001134463726__en-us_task_0172366286_li50272314214038"></a><a name="en-us_task_0172366286_li50272314214038"></a>When this command is used in the BGP view, it is also applicable to the extended address family view because they use the same TCP connection.</p>
</li><li id="EN-US_TASK_0000001134463726__en-us_task_0172366286_li962495871214038"><p id="EN-US_TASK_0000001134463726__en-us_task_0172366286_p1821274693214038"><a name="EN-US_TASK_0000001134463726__en-us_task_0172366286_li962495871214038"></a><a name="en-us_task_0172366286_li962495871214038"></a>BGP MD5 authentication and BGP keychain authentication are mutually exclusive.</p>
</li></ul>
</div></div>
</p></li><li class="substepexpand" id="EN-US_TASK_0000001134463726__en-us_task_0172366286_substep1628451048214038"><span id="EN-US_TASK_0000001134463726__en-us_task_0172366286_cmd1844640151214323">Run <span><a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001134463726__en-us_task_0172366286_cmdname1724170638214038">commit</span></b></a></span></span><p><p id="EN-US_TASK_0000001134463726__en-us_task_0172366286_p2056487755214323">The configuration is committed.</p>
</p></li></ol>
</li><li><span>Configure TCP-AO authentication.</span><p><p>TCP-AO authentication must be configured on both BGP peers. A TCP-AO authentication password needs to be set for a TCP connection, and the authentication is performed by TCP. If authentication fails, no TCP connections can be established.</p>
</p><ol><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=tcp+ao"><b><span class="cmdname">tcp ao</span></b></a><strong> </strong><i><span class="varname">tcpaoname</span></i></span><p><p>A TCP-AO is created, and the TCP-AO policy view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=binding+keychain"><b><span class="cmdname">binding keychain</span></b></a><strong> </strong><i><span class="varname">kcName</span></i></span><p><p>The TCP-AO is bound to a keychain.</p>
</p><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>A keychain must have been created using the <strong>keychain</strong> command before you perform this step.</p>
</div></div>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=key-id"><b><span class="cmdname">key-id</span></b></a> <i><span class="varname">keyId</span></i></span><p><p>A key ID is created for the TCP-AO, and the TCP-AO key ID view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=send-id"><b><span class="cmdname">send-id</span></b></a> <i><span class="varname">sndId</span></i> <strong><span>receive-id</span></strong><em> </em><i><span class="varname">rcvId</span></i></span><p><p>The send-id and receive-id are configured for the Key ID.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>The TCP-AO policy view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Return to the system view.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <a href="cmdqueryname=as-number"><b><span class="cmdname">as-number</span></b></a> <i><span class="varname">as-number</span></i></span><p><p>The IP address of a peer and the number of the AS where the peer resides are specified.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <strong><span>tcp-ao policy</span></strong> <i><span class="varname">tcp-ao-name</span></i></span><p><p>TCP-AO authentication is configured for the TCP connection to be set up between BGP peers.</p>
</p><p><p>The value of the <i><span class="varname">tcp-ao-name</span></i> parameter must be set to the TCP-AO created in step 2.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>For the same peer, the authentication modes TCP-AO, MD5, and keychain are mutually exclusive.</p>
</div></div>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li><span>Configure the BGP GTSM function.</span><p><p>GTSM protects <span class="keyword">Router</span>s from attacks by checking whether the TTL in the header of an IP packet is within the pre-defined range. </p>
</p><ol><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">group-name</span></i> | <i><span class="varname">ipv4-address</span></i> } <strong><span>valid-ttl-hops</span></strong> [ <i><span class="varname">hops</span></i> ]</span><p><p>The BGP GTSM is configured.</p>
</p><p><p>The valid TTL range of detected packets is [255 â <i><span class="varname">hops</span></i> + 1, 255]. For example, for an EBGP direct route, the value of <i><span class="varname">hops</span></i> is 1. That is, the valid TTL value is 255.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><ul><li>After GTSM is configured in the BGP view, the configuration also takes effect in the MP-BGP VPNv4 address family view because BGP and MP-BGP VPNv4 share a TCP connection.</li><li>GTSM and EBGP-max-hop are mutually exclusive because they both affect the TTL values in sent BGP messages. Therefore, only one of them can be used for a peer or peer group.</li></ul>
</div></div>
<p>A BGP device that is enabled with GTSM checks the TTL values in all BGP packets on interface boards. As required by the actual networking, packets whose TTL values are not within the specified range are discarded. In scenarios where GTSM is not configured on a BGP device, the received BGP messages are forwarded if the BGP peer configuration exists. Otherwise, the received BGP messages are discarded. This prevents bogus BGP messages from consuming CPU resources.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li><span>Set the default GTSM action.</span><p><p>Perform the following steps on a GTSM-enabled <span class="keyword">Router</span>:</p>
</p><ol><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=gtsm+default-action"><b><span class="cmdname">gtsm default-action</span></b></a> { <strong><span>drop</span></strong> | <strong><span>pass</span></strong> }</span><p><p>The default action to be taken for packets that do not match the GTSM policy is set.</p>
</p><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>If the default action is configured but no GTSM policy is configured, GTSM does not take effect.</p>
<p>This command is supported only on the Admin-VS and cannot be configured in other VSs. This command takes effect on all VSs.</p>
</div></div>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li><span>Configure ROA.</span><ol><li class="substepexpand"><span>Select one of the following configurations based on the usage scenario:</span><p><ul><li>If the local device needs to obtain data from the ROA database through a connection to be established with an RPKI server, perform the following operations:<ol type="a"><li>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a><p>The system view is displayed.</p>
</li><li>Run <a href="cmdqueryname=rpki"><b><span class="cmdname">rpki</span></b></a><p>RPKI is started, and the RPKI view is displayed.</p>
</li><li>Run <a href="cmdqueryname=session"><b><span class="cmdname">session</span></b></a> <i><span class="varname">ipv4-address</span></i><p>An address of the RPKI server is specified for a TCP connection to be set up between the client and RPKI server.</p>
</li><li><p>Run <a href="cmdqueryname=tcp"><b><span class="cmdname">tcp</span></b></a> <strong><span>port</span></strong> <i><span class="varname">port-number</span></i> [ <strong><span>password md5</span></strong> <i><span class="varname">cipher-password</span></i> | <strong><span>keychain</span></strong><em> </em><i><span class="varname">keychain-name</span></i> ] Parameters are configured for the TCP connection between the local device and the RPKI server.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The MD5 algorithm is not recommended if high security is required.</p>
<p>For security purposes, you are advised to configure a ciphertext password, and change it periodically.</p>
</div></div>
</li><li>(Optional) Run <a href="cmdqueryname=timer"><b><span class="cmdname">timer</span></b></a> { <strong><span>aging</span></strong> <i><span class="varname">aging-time</span></i> | <strong><span>refresh</span></strong> <i><span class="varname">refresh-time</span></i> }<p>Timers are configured for the RPKI session between the client and the RPKI server.</p>
<p>The <i><span class="varname">aging-time</span></i> parameter specifies a value of the validation data age timer, and the <i><span class="varname">refresh-time</span></i> parameter specifies a value of the session update timer. You can configure the timers based on actual requirements on BGP security. Small values are recommended if high BGP security is required. However, frequent data updates consume much network bandwidth.</p>
</li><li>(Optional) Run <a href="cmdqueryname=rpki-limit"><b><span class="cmdname">rpki-limit</span></b></a> <i><span class="varname">limit</span></i> [ <strong><span>alert-only</span></strong> | <strong><span>idle-forever</span></strong> | <strong><span>idle-timeout</span></strong> <i><span class="varname">times</span></i> ]<p>The maximum number of Route Origin Authorization (ROA) entries that the device is allowed to accept in a session is configured.</p>
<p>In most cases, a large number of ROA entries exist on an RPKI server. If the device receives a large number of ROA entries from the RPKI server, excessive system resources will be consumed. To prevent this problem, run the <a href="cmdqueryname=rpki-limit"><b><span class="cmdname">rpki-limit</span></b></a> command to configure the maximum number of ROA entries that the BGP device is allowed to accept in a session.</p>
<p></p>
</li><li>(Optional) Run <a href="cmdqueryname=connect-interface"><b><span class="cmdname">connect-interface</span></b></a> { <i><span class="varname">interface-name</span></i> | <i><span class="varname">ipv4-source-address</span></i> | <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i> | <i><span class="varname">interface-type</span></i> <i><span class="varname">ipv4-source-address</span></i> | <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i> <i><span class="varname">ipv4-source-address</span></i> }<p>The source interface for sending RPKI packets is specified.</p>
</li><li>(Optional) Run <a href="cmdqueryname=ssl-policy"><b><span class="cmdname">ssl-policy</span></b></a> <i><span class="varname">policy-name</span></i><p>An SSL policy to be bound to the TCP connection between the device and RPKI server is configured.</p>
</li><li>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a><p>The RPKI view is displayed.</p>
</li><li>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a><p>The system view is displayed.</p>
</li><li>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a><p>The configuration is committed.</p>
</li></ol>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>If configurations of an RPKI session are changed and you want its new configurations to take effect immediately, run the <a href="cmdqueryname=reset+rpki+session"><b><span class="cmdname">reset rpki session</span></b></a> command to reset the RPKI session.</p>
</div></div>
</li><li>If a static ROA database needs to be configured on the local device, perform the following operations:<ol type="a"><li>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a><p>The system view is displayed.</p>
</li><li>Run <a href="cmdqueryname=rpki"><b><span class="cmdname">rpki</span></b></a><p>RPKI is started, and the RPKI view is displayed.</p>
</li><li>Run <a href="cmdqueryname=origin-validation"><b><span class="cmdname">origin-validation</span></b></a><p>A static ROA database is created, and the RPKI origin-validation view is displayed.</p>
</li><li>Run <a href="cmdqueryname=static+record"><b><span class="cmdname">static record</span></b></a> <i><span class="varname">ipv4-address</span></i> <i><span class="varname">mask-length</span></i> <strong><span>max-length</span></strong> <i><span class="varname">max-mask-length</span></i> <strong><span>origin-as</span></strong> <i><span class="varname">as-number</span></i><p>A record is configured for the static ROA database.</p>
</li><li>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a><p>The RPKI view is displayed.</p>
</li><li>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a><p>The system view is displayed.</p>
</li><li>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a><p>The configuration is committed.</p>
</li></ol>
</li></ul>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Configure inbound or outbound ROA validation as required.</span><p><ul><li>To configure inbound ROA validation (validation results not affecting route acceptance) for the routes received from an EBGP peer, perform the following operations:<ol type="a"><li>Run <a href="cmdqueryname=prefix+origin-validation+enable"><b><span class="cmdname">prefix origin-validation enable</span></b></a><p>Origin AS validation of RPKI is enabled.</p>
<p>This function applies only to the routes received from EBGP peers, not to those received from IBGP peers. After origin AS validation is enabled, the device matches the origin AS of each route received from an EBGP peer against that of the matched route in the database and outputs the validation result, which can be Valid, Not Found, or Invalid.</p>
</li><li>(Optional) Run <a href="cmdqueryname=bestroute+origin-as-validation"><b><span class="cmdname">bestroute origin-as-validation</span></b></a> [ <strong><span>allow-invalid</span></strong> ]<p>The device is configured to apply origin AS validation results of RPKI to BGP route selection.</p>
<p>BGP selects routes in descending order of Valid, Not Found, and Invalid after origin AS validation results are applied to route selection. If <strong>allow-invalid</strong> is not specified in the command, the BGP routes with the validation result being Invalid do not participate in route selection.</p>
</li><li>(Optional) Run <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>advertise-ext-community</span></strong><p>The device is configured to advertise extended community attributes to the specified peer.</p>
</li><li>(Optional) Run <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>advertise origin-as-validation</span></strong><p>The device is enabled to advertise origin AS validation results of RPKI to the specified BGP peer or peer group.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Origin AS validation results of RPKI can be advertised only to IBGP peers.</p>
</div></div>
</li></ol>
</li></ul>
<ul><li>To configure outbound ROA validation for the routes to be advertised to an EBGP peer to control route advertisement, perform the following operations:<p>Run <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">peerIpv4Addr</span></i> | <i><span class="varname">peerGroupName</span></i> } <strong><span>origin-validation export</span></strong> [ <strong><span>include-not-found</span></strong> [ <strong><span>external</span></strong> ] ]</p>
<p>The local device is configured to perform outbound ROA validation on the routes to be advertised to the specified EBGP peer.</p>
<p>After the local device is configured to perform outbound ROA validation on the routes to be advertised to a specified EBGP peer, the device matches the origin ASs of the routes against those of the matched routes recorded in the database. The validation result can be Valid, Not Found, or Invalid. By default, only the routes whose validation result is Valid are advertised. To configure the device to advertise the routes with the validation result being Valid or Not Found, specify the <strong>include-not-found</strong> keyword in the preceding command. To configure the device to advertise the routes with the validation result being Valid or Not Found (if the routes with the result being Not Found were received from another AS), specify the <strong>include-not-found external</strong> keyword in the preceding command.</p>
</li></ul>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li><span>Configure ASPA.</span><ol><li class="substepexpand"><span>Select one of the following configurations based on the usage scenario:</span><p><ul><li>If the local device needs to obtain data from the ASPA database through a connection to be established with an RPKI server, perform the following operations:<ol type="a"><li>Run the <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a> command to enter the system view.</li><li>Run the <a href="cmdqueryname=rpki"><b><span class="cmdname">rpki</span></b></a> command to start RPKI and enter the RPKI view.</li><li>Run the <a href="cmdqueryname=session"><b><span class="cmdname">session</span></b></a> <i><span class="varname">ipv4-address</span></i> command to configure session information for the TCP connection between the local device and the RPKI server.</li><li>Run the <a href="cmdqueryname=tcp"><b><span class="cmdname">tcp</span></b></a> <strong><span>port</span></strong> <i><span class="varname">port-number</span></i> [ <strong><span>password md5</span></strong> <i><span class="varname">cipher-password</span></i> | | <strong><span>keychain</span></strong><em> </em><i><span class="varname">keychain-name</span></i> ] command to configure parameters for the TCP connection between the local device and the RPKI server.<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>For security purposes, you are advised not to use weak security algorithms in this feature. If you need to use such an algorithm, run the <a href="cmdqueryname=undo+crypto+weak-algorithm+disable"><b><span class="cmdname">undo crypto weak-algorithm disable</span></b></a> command to enable the weak security algorithm function first.</p>
<p>The MD5 algorithm is not recommended if high security is required.</p>
<p>For security purposes, you are advised to configure a ciphertext password, and change it periodically.</p>
</div></div>
</li><li>Run the <strong><a href="cmdqueryname=version"><b><span class="cmdname">version</span></b></a> </strong><em>version-num</em> command to configure an RPKI version. RPKIv2 allows a device to receive ASPA data on the condition that both the device and the RPKI server support RPKIv2.</li><li>(Optional) Run the <a href="cmdqueryname=timer"><b><span class="cmdname">timer</span></b></a> { <strong><span>aging</span></strong> <i><span class="varname">aging-time</span></i> | <strong><span>refresh</span></strong> <i><span class="varname">refresh-time</span></i> } command to configure timers for the RPKI session.<p>The <i><span class="varname">aging-time</span></i> parameter specifies a value of the validation data aging timer, and the <i><span class="varname">refresh-time</span></i> parameter specifies a value of the session update timer. You can configure the timers based on actual requirements on BGP security. Small values are recommended if high BGP security is required. However, frequent data updates consume much network bandwidth.</p>
</li><li>(Optional) Run the <strong class="aspa-limit"><a href="cmdqueryname=aspa-limit"><b><span class="cmdname">aspa-limit</span></b></a> </strong><em>limit</em> [ <em>percentage</em> ] [ <strong>alert-only</strong> | <strong>idle-forever</strong> | <strong>idle-timeout</strong><em> <i><span class="varname">times</span></i></em> ] command to configure the maximum number of ASPA records that the device is allowed to accept in the session.<p>In most cases, a large number of ASPA records exist on a server. If a BGP device receives a large number of ASPA records from the server, excessive system resources will be consumed. To prevent this problem, run the <strong class="aspa-limit">aspa-limit</strong> command to configure the maximum number of ASPA records that the device is allowed to accept in the session.</p>
</li><li>(Optional) Run the <a href="cmdqueryname=connect-interface"><b><span class="cmdname">connect-interface</span></b></a> { <i><span class="varname">interface-name</span></i> | <i><span class="varname">ipv4-source-address</span></i> | <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i> | <i><span class="varname">interface-type</span></i> <i><span class="varname">ipv4-source-address</span></i> | <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i> <i><span class="varname">ipv4-source-address</span></i> } command to specify the source interface for sending RPKI messages.</li><li>(Optional) Run the <a href="cmdqueryname=ssl-policy"><b><span class="cmdname">ssl-policy</span></b></a> <i><span class="varname">policy-name</span></i> command to configure an SSL policy to be bound to the TCP connection between the device and the RPKI server.</li><li>Run the <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a> command to enter the RPKI view.</li><li>Run the <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a> command to enter the system view.</li><li>Run the <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a> command to commit the configuration.</li></ol>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>If configurations of an RPKI session are changed and you want its new configurations to take effect immediately, run the <a href="cmdqueryname=reset+rpki+session"><b><span class="cmdname">reset rpki session</span></b></a> command to reset the RPKI session.</p>
</div></div>
</li></ul>
<ul><li>If a static ASPA database needs to be configured on the local device, perform the following operations:<ol type="a"><li>Run the <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a> command to enter the system view.</li><li>Run the <a href="cmdqueryname=rpki"><b><span class="cmdname">rpki</span></b></a> command to start RPKI and enter the RPKI view.</li><li>Run the <a href="cmdqueryname=aspa-validation"><b><span class="cmdname">aspa-validation</span></b></a> command to create a static ASPA database and enter the RPKI ASPA-validation view.</li><li>Run the <strong class="static record"><a href="cmdqueryname=static+record"><b><span class="cmdname">static record</span></b></a> </strong><em><i><span class="varname">customer-as</span></i> </em><strong>provider</strong><em> <i><span class="varname">as-number</span></i></em><i><span class="varname"> </span></i>{ <strong>ipv4</strong> | <strong>ipv6</strong> } command to configure the static ASPA database.</li><li>Run the <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a> command to enter the RPKI view.</li><li>Run the <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a> command to enter the system view.</li><li>Run the <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a> command to commit the configuration.</li></ol>
</li></ul>
</p></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i> command to enter the BGP view.</span></li><li class="substepexpand"><span>Configure inbound ASPA validation as required. To configure inbound ASPA validation (validation results not affecting route acceptance) for the routes received from an EBGP peer, perform the following operations:</span><p><ol type="a"><li>Run the <strong><a href="cmdqueryname=peer+role"><b><span class="cmdname">peer</span></b></a> </strong>{ <em>peerIpv4Addr</em> | <em>peerIpv6Addr</em> } <strong>role</strong> { <strong>provider</strong> | <strong>rs</strong> | <strong>rs-client</strong> | <strong>customer</strong> | <strong>lateral-peer</strong> | <strong>sibling</strong> } command to configure a role for a BGP peer.</li><li>Run the <strong class="aspa-validation enable">aspa-validation enable</strong> command to enable RPKI-based ASPA validation. After ASPA validation is enabled, the device compares the AS_Path of a route with the matching ASPA pair recorded in the database and provides the validation results: Valid, NotFound, or Invalid.</li><li>(Optional) Run the <a href="cmdqueryname=bestroute+aspa-validation"><b><span class="cmdname">bestroute aspa-validation</span></b></a> [ <strong><span>allow-invalid</span></strong> ] command to configure the device to apply ASPA validation results of RPKI to BGP route selection. BGP selects routes in descending order of Valid, Not Found, and Invalid after ASPA validation results are applied to route selection. If <strong>allow-invalid</strong> is not specified in the command, the BGP routes with the validation result being Invalid do not participate in route selection.</li></ol>
</p></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a> command to commit the configuration.</span></li></ol>
</li><li><span>Configure regional validation.</span><ol><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=rpki"><b><span class="cmdname">rpki</span></b></a></span><p><p>RPKI is started, and the RPKI view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=region-validation"><b><span class="cmdname">region-validation</span></b></a></span><p><p>Regional validation is enabled, and the region-validation view is displayed.</p>
</p></li><li class="substepexpand"><span>You can configure regions or regional confederation as required.</span><p><ul><li>Create a region.<ol type="a"><li>Run <a href="cmdqueryname=region"><b><span class="cmdname">region</span></b></a> <i><span class="varname">region-id</span></i><p>A region is created.</p>
</li><li>Run <a href="cmdqueryname=description"><b><span class="cmdname">description</span></b></a> <i><span class="varname">description-text</span></i><p>A description is configured for the region.</p>
</li><li>Run <a href="cmdqueryname=as-number"><b><span class="cmdname">as-number</span></b></a> { <i><span class="varname">asn</span></i> } &amp;&lt;1-100&gt;<p>An AS number list is configured so that the AS numbers in it can be added to the region.</p>
</li><li><p>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></p>
<p>The regional validation view is displayed.</p>
</li><li><p>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></p>
<p>The RPKI view is displayed.</p>
</li><li><p>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></p>
<p>The system view is displayed.</p>
</li></ol>
</li><li>Create a regional confederation.<ol type="a"><li>Run <a href="cmdqueryname=region"><b><span class="cmdname">region</span></b></a> <i><span class="varname">region-id</span></i><p>A region is created.</p>
</li><li><p>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></p>
<p>The regional validation view is displayed.</p>
</li><li>Run <a href="cmdqueryname=region-confederation"><b><span class="cmdname">region-confederation</span></b></a> <i><span class="varname">region-confederation-id</span></i><p>A regional confederation is created.</p>
</li><li>Run <a href="cmdqueryname=description"><b><span class="cmdname">description</span></b></a> <i><span class="varname">description-text</span></i><p>A description is configured for the regional confederation.</p>
</li><li>Run <a href="cmdqueryname=region"><b><span class="cmdname">region</span></b></a> { <i><span class="varname">region-id</span></i> } &amp;&lt;1-100&gt;<p>A region ID list is configured in the regional confederation so that regions in the list are added to the regional confederation.</p>
</li><li><p>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></p>
<p>Exit the RPKI regional confederation validation view and enter the regional validation view.</p>
</li><li><p>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></p>
<p>The RPKI view is displayed.</p>
</li><li><p>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></p>
<p>The system view is displayed.</p>
</li></ol>
</li></ul>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Enable the region or regional confederation function as required.</span><p><ul><li>Run <a href="cmdqueryname=region-validation"><b><span class="cmdname">region-validation</span></b></a><p>BGP regional validation is enabled.</p>
</li><li>Run <a href="cmdqueryname=region-validation+confed-check+strict"><b><span class="cmdname">region-validation confed-check strict</span></b></a><p>Strict BGP regional validation is enabled.</p>
</li></ul>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bestroute+region-validation"><b><span class="cmdname">bestroute region-validation</span></b></a> [ <strong><span>allow-invalid</span></strong> ]</span><p><p>The device is configured to apply the BGP regional validation results of RPKI to BGP route selection.</p>
</p><p><p>If regional validation succeeds, the route is valid and can participate in route selection. If regional validation fails, the route is invalid and cannot participate in route selection. To allow the routes that fail regional validation to be valid and participate in route selection, configure the <strong><span>allow-invalid</span></strong> parameter in the command. The priority of such routes is reduced during route selection.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li><span>Configure BMP.</span><ol><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bmp"><b><span class="cmdname">bmp</span></b></a></span><p><p>BMP is enabled, and the BMP view is displayed.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=statistics-timer"><b><span class="cmdname">statistics-timer</span></b></a> <i><span class="varname">time</span></i></span><p><p>An interval at which the BMP device sends BGP/BGP4+ running statistics to a monitoring server is set.</p>
</p><p><p>You can set the interval based on the actual requirements on BGP/BGP4+ stability. Usually, a shorter interval is set for a network with higher stability, but this consumes more bandwidth resources because the device sends BGP/BGP4+ running statistics more frequently.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bmp-session"><b><span class="cmdname">bmp-session</span></b></a> [ <strong><span>vpn-instance</span></strong> <i><span class="varname">vrf-name</span></i> ] { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">ipv6-address</span></i> } [ <strong><span>alias</span></strong> <i><span class="varname">alias-name</span></i> ]</span><p><p>An IPv4 or IPv6 session address is configured for the TCP connection between the BMP device and the monitoring server.</p>
</p><p><p><strong><span>alias</span></strong> <i><span class="varname">alias-name</span></i> specifies an alias for a BMP session. If the device needs to establish TCP connections with monitoring servers that have the same destination IP address but different destination port numbers, specify different values for the <strong><span>alias</span></strong> <i><span class="varname">alias-name</span></i> parameter to differentiate the connections.</p>
</p></li><li class="substepexpand"><span>Configure the BMP device to send statistics about routes of specific types to the monitoring server.</span><p><ul><li>Configure the BMP device to send the monitoring server the statistics about RIB-in routes (all received routes or only accepted routes) from BGP/BGP4+ peers in a specified address family.<ol type="a"><li>Run one of the following commands to enter the BMP-Monitor view:<ul><li><a href="cmdqueryname=monitor+public"><b><span class="cmdname">monitor public</span></b></a>: displays the BMP-Monitor view and allows the BGP/BGP4+ running status of all BGP/BGP4+ peers in the public network address family to be monitored.</li><li><a href="cmdqueryname=monitor+all-vpn-instance"><b><span class="cmdname">monitor all-vpn-instance</span></b></a>: displays the BMP-Monitor view and allows the BGP/BGP4+ running status of BGP/BGP4+ peers in all VPN instance address families to be monitored.</li><li><a href="cmdqueryname=monitor+peer"><b><span class="cmdname">monitor peer</span></b></a>: displays the BMP-Monitor view and allows the BGP/BGP4+ running status of a specified BGP/BGP4+ peer in the public address family to be monitored.</li><li><a href="cmdqueryname=monitor+vpn-instance"><b><span class="cmdname">monitor vpn-instance</span></b></a>: displays the BMP-Monitor view and allows the BGP/BGP4+ running status of all BGP/BGP4+ peers in a specified VPN instance to be monitored.</li><li><a href="cmdqueryname=monitor+vpn-instance+peer"><b><span class="cmdname">monitor vpn-instance peer</span></b></a>: displays the BMP-Monitor view and allows the BGP/BGP4+ running status of a specified BGP/BGP4+ peer in a specified VPN instance to be monitored.</li></ul>
</li><li><p>Run <a href="cmdqueryname=route-mode"><b><span class="cmdname">route-mode</span></b></a> { <strong><span>ipv4-family</span></strong> <strong><span>unicast</span></strong><span> | <strong><span>ipv4-family</span></strong> <strong><span>labeled-unicast</span></strong></span> | <strong><span>ipv4-family</span></strong> <strong><span>vpnv4</span></strong> | <strong><span>ipv6-family</span></strong> <strong><span>unicast</span></strong> | <strong><span>ipv6-family</span></strong> <strong><span>vpnv6</span></strong> } <strong><span>adj-rib-in</span></strong> { <strong><span>pre-policy</span></strong> | <strong><span>post-policy</span></strong> }</p>
<p>The BMP device is configured to send statistics about RIB-in routes of BGP/BGP4+ peers in a specified address family to the monitoring server.</p>
<p>To configure the device to send statistics about all received routes to the monitoring server, specify <strong><span>pre-policy</span></strong> in the command. To configure the device to send statistics about only the routes that match the import policy (those delivered to the routing table) to the monitoring server, specify <strong><span>post-policy</span></strong> in the command.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>If the <strong><span>pre-policy</span></strong> parameter is specified in the command, run the <a href="cmdqueryname=keep-all-routes"><b><span class="cmdname">keep-all-routes</span></b></a> command in the BGP view to save information about routes carried in BGP/BGP4+ Update messages that are received from all BGP/BGP4+ peers or peer groups after BGP/BGP4+ connections are established. Alternatively, run the <a href="cmdqueryname=peer+keep-all-routes"><b><span class="cmdname">peer keep-all-routes</span></b></a> command to save information about routes carried in the BGP/BGP4+ Update messages that are received from a specified BGP/BGP4+ peer or peer group after the BGP/BGP4+ connection is established.</p>
</div></div>
</li></ol>
</li><li>Configure the BMP device to send statistics about RIB-out routes advertised to BGP/BGP4+ peers in a specified address family.<div class="p">Run one of the following commands to enter the BMP-Monitor view:<ul><li><a href="cmdqueryname=monitor+public"><b><span class="cmdname">monitor public</span></b></a>: displays the BMP-Monitor view and allows the BGP/BGP4+ running status of all BGP/BGP4+ peers in the public network address family to be monitored.</li><li><a href="cmdqueryname=monitor+all-vpn-instance"><b><span class="cmdname">monitor all-vpn-instance</span></b></a>: displays the BMP-Monitor view and allows the BGP/BGP4+ running status of BGP/BGP4+ peers in all VPN instance address families to be monitored.</li><li><a href="cmdqueryname=monitor+peer"><b><span class="cmdname">monitor peer</span></b></a>: displays the BMP-Monitor view and allows the BGP/BGP4+ running status of a specified BGP/BGP4+ peer in the public address family to be monitored.</li><li><a href="cmdqueryname=monitor+vpn-instance"><b><span class="cmdname">monitor vpn-instance</span></b></a>: displays the BMP-Monitor view and allows the BGP/BGP4+ running status of all BGP/BGP4+ peers in a specified VPN instance to be monitored.</li><li><a href="cmdqueryname=monitor+vpn-instance+peer"><b><span class="cmdname">monitor vpn-instance peer</span></b></a>: displays the BMP-Monitor view and allows the BGP/BGP4+ running status of a specified BGP/BGP4+ peer in a specified VPN instance to be monitored.</li></ul>
</div>
<p>Run <a href="cmdqueryname=route-mode"><b><span class="cmdname">route-mode</span></b></a> { <strong><span>ipv4-family</span></strong> <strong><span>unicast</span></strong><span> | <strong><span>ipv4-family</span></strong> <strong><span>labeled-unicast</span></strong></span> | <strong><span>ipv4-family</span></strong> <strong><span>vpnv4</span></strong> | <strong><span>ipv6-family</span></strong> <strong><span>unicast</span></strong> | <strong><span>ipv6-family</span></strong> <strong><span>vpnv6</span></strong> } <strong><span>adj-rib-out</span></strong> { <strong><span>pre-policy</span></strong> | <strong><span>post-policy</span></strong> }</p>
<p>The BMP device is configured to send statistics about RIB-out routes of BGP/BGP4+ peers in a specified address family to the monitoring server.</p>
<p>To configure the device to send statistics about all routes, specify the <strong><span>pre-policy</span></strong> parameter in the command. To configure the device to send statistics about only the routes that match the export policy, specify the <strong><span>post-policy</span></strong> parameter in the command.</p>
</li><li>Configure the BMP device to send statistics about Local-RIB routes of BGP/BGP4+ peers in a specified address family.<ol type="a"><li>Run one of the following commands to enter the BMP-Monitor view:<ul><li><a href="cmdqueryname=monitor+public"><b><span class="cmdname">monitor public</span></b></a>: displays the BMP-Monitor view and allows the BGP/BGP4+ running status of all BGP/BGP4+ peers in the public network address family to be monitored.</li><li><a href="cmdqueryname=monitor+vpn-instance"><b><span class="cmdname">monitor vpn-instance</span></b></a>: displays the BMP-Monitor view and allows the BGP/BGP4+ running status of all BGP/BGP4+ peers in a specified VPN instance to be monitored.</li></ul>
</li><li>Perform the following operations as required:<ul><li>To configure the BMP device to send the monitoring server the statistics about Local-RIB routes of BGP/BGP4+ peers in a specified address family, run the <a href="cmdqueryname=route-mode"><b><span class="cmdname">route-mode</span></b></a> { <strong><span>ipv4-family</span></strong> <strong><span>unicast</span></strong><span> | <strong><span>ipv4-family</span></strong> <strong><span>labeled-unicast</span></strong></span> | <strong><span>ipv4-family</span></strong> <strong><span>vpnv4</span></strong> | <strong><span>ipv6-family</span></strong> <strong><span>unicast</span></strong> | <strong><span>ipv6-family</span></strong> <strong><span>vpnv6</span></strong> } <strong><span>local-rib</span></strong> [ <strong><span>add-path</span></strong> | <strong><span>all</span></strong> ] [ <strong><span>path-marking</span></strong> ] command.</li><li>To configure the BMP device to send statistics about Local-RIB routes of BGP/BGP4+ peers in the BGP-Flow address family to the monitoring server, run the <a href="cmdqueryname=route-mode"><b><span class="cmdname">route-mode</span></b></a> { <strong><span>ipv4-family</span></strong> | <strong><span>ipv6-family</span></strong> } <strong><span>flow</span></strong> <strong><span>local-rib</span></strong> [ <strong><span>report route-identifier</span></strong> ] command.</li></ul>
</li></ol>
</li></ul>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Return to the BMP session view.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=tcp"><b><span class="cmdname">tcp</span></b></a> <strong><span>connect</span></strong> <strong><span>port</span></strong> <i><span class="varname">port-number</span></i> [ <strong><span>password md5</span></strong> <i><span class="varname">cipher-password</span></i> | <strong><span>keychain</span></strong> <i><span class="varname">keychain-name</span></i> ]</span><p><p>Parameters for the TCP connection to be established between the device and the monitoring server are configured.</p>
</p><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Configuring MD5 is not recommended when high security is required.</p>
</div></div>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=ssl-policy+name"><b><span class="cmdname">ssl-policy name</span></b></a> <i><span class="varname">policy-name</span></i></span><p><p>An SSL policy is configured for BMP.</p>
</p><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Ensure that the specified SSL policy has been created using the <a href="cmdqueryname=ssl+policy"><b><span class="cmdname">ssl policy</span></b></a> <i><span class="varname">policy-name</span></i> command in the system view.</p>
</div></div>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=connect-interface"><b><span class="cmdname">connect-interface</span></b></a> { <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i> | <i><span class="varname">ip-source-address</span></i> | <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i> <i><span class="varname">ip-source-address</span></i> }</span><p><p>The source interface for sending BMP messages is specified.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>After configuring BMP session parameters, run the <a href="cmdqueryname=reset+bmp+session"><b><span class="cmdname">reset bmp session</span></b></a> command to reset the BMP session for the new BMP session parameters to take effect.</p>
</div></div>
</p></li></ol>
</li><li><span>Configure TLS authentication.</span><p><p>The Secure Sockets Layer (SSL) protocol protects data privacy based on the Internet. It allows a client and a server to communicate in a way designed to prevent eavesdropping. Specifically, to ensure data transmission security on a network, a BGP peer or peer group needs to be configured as an SSL client or as a server, and the SSL data encryption, identity authentication, and message integrity verification mechanisms need to be used.</p>
</p><ol><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">group-name</span></i> | <i><span class="varname">ipv4-address</span></i> } <strong><span>ssl-server</span></strong><strong><span> certificate</span></strong></span><p><p>SSL/TLS authentication is enabled on an SSL server.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">group-name</span></i> | <i><span class="varname">ipv4-address</span></i> } <strong><span>ssl-policy</span></strong><strong><span> name</span></strong><i><span class="varname"> ssl-policy-name</span></i></span><p><p>The SSL policy is applied to the SSL client or server.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">group-name</span></i> | <i><span class="varname">ipv4-address</span></i> } <strong><span>ssl-policy</span></strong><strong><span> role</span></strong> { <strong><span>client</span></strong> | <strong><span>server</span></strong> }</span><p><p>A peer or peer group is configured as an SSL client or server.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
<p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The <a href="cmdqueryname=peer+as-number"><b><span class="cmdname">peer as-number</span></b></a> command has been run to create a peer.</p>
<p>SSL/TLS authentication can be configured only on the server. BGP MD5 authentication and BGP keychain authentication are mutually exclusive.</p>
<p>The configuration of a peer takes precedence over that of the peer group to which the peer belongs.</p>
<p>SSL/TLS authentication takes effect only after SSL/TLS authentication is enabled on the server (SSL/TLS authentication is not required on the client), the SSL client and server are configured, and SSL policies are applied to the client and server.</p>
<p>TLS authentication can be used in BGP single-instance scenarios rather than in BGP multi-instance scenarios.</p>
</div></div>
</p></li></ul></div>
<div class="result"><a name="EN-US_TASK_0000001134463726__1.3.3"></a><a name="1.3.3"></a><h4 class="sectiontitle">Result</h4>
<div class="p"><ul><li>Run the <a href="cmdqueryname=display+bgp+peer"><b><span class="cmdname">display bgp peer</span></b></a> [ <i><span class="varname">ipv4-address</span></i> ] <strong><span>verbose</span></strong> command to view the authentication information about BGP peers.</li><li><p>Run the <a href="cmdqueryname=display+gtsm+statistics"><b><span class="cmdname">display gtsm statistics</span></b></a> { <i><span class="varname">slot-id</span></i> | <strong><span>all</span></strong> } command to check GTSM statistics.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p><span>In VS mode, this command is supported only by the admin VS.</span></p>
</div></div>
</li><li>Run the <a href="cmdqueryname=display+rpki+session"><b><span class="cmdname">display rpki session</span></b></a> <i><span class="varname">ipv4-address</span></i> <strong><span>verbose</span></strong> command to check RPKI session configurations.</li><li>Run the <a href="cmdqueryname=display+rpki+table"><b><span class="cmdname">display rpki table</span></b></a> command to check ROA information.</li><li>Run the <a href="cmdqueryname=display+bmp+session"><b><span class="cmdname">display bmp session</span></b></a> [ <strong><span>vpn-instance</span></strong> <i><span class="varname">vrf-name</span></i> ] [ <i><span class="varname">ipv4-address</span></i> [ <strong><span>alias</span></strong> <i><span class="varname">alias-name</span></i> ] <strong><span>verbose</span></strong> ] command to check BMP session configurations.</li><li>Run the <a href="cmdqueryname=display+bgp+bmp-monitor"><b><span class="cmdname">display bgp bmp-monitor</span></b></a> { <strong><span>all</span></strong> | { <strong><span>ipv4</span></strong> | <strong><span>vpnv4</span></strong> <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i> | <strong><span>vpnv4</span></strong> } <i><span class="varname">ipv4-address</span></i> } command to check information about BGP peers monitored through BMP in all address families or in a specified address family.</li><li>Run the <a href="cmdqueryname=display+cpu-defend+whitelist+session-car"><b><span class="cmdname">display cpu-defend whitelist session-car</span></b></a> <strong><span>bgp</span></strong> <strong><span>statistics</span></strong> <strong><span>slot</span></strong> <i><span class="varname">slot-id</span></i> command to check statistics about BGP whitelist session CAR on a specified interface board.</li></ul>
</div></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_sec_hardening_control_level2.html">Control Plane
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_sec_maintenance_0026.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_sec_maintenance_0037.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>