
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="DSVPN">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_sec_hardening_control_level2.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_sec_maintenance_0074.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_sec_maintenance_0055.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="z00588052,w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="OWNER" content="z00588052,z00545680">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="wWX1238417">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001227286645">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>DSVPN</title>
</head>
<body><a name="EN-US_TASK_0000001227286645"></a><a name="EN-US_TASK_0000001227286645"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">DSVPN</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001227286645__1.3.1"></a><a name="1.3.1"></a>
<div class="p"><h4 class="sectiontitle">Security Policy Overview</h4><p><strong>NHRP</strong><strong> Negotiation Authentication</strong></p>
<p>In DSVPN, NHRP enables a source spoke on a public network to dynamically obtain the public address of a destination spoke. When a spoke uses a physical interface to connect to a public network, the spoke sends NHRP registration request packets to the hub by using the public address of the interface as the source address. The hub creates or updates NHRP peer entries based on the packets received. Two spokes can also exchange NHRP resolution request and reply packets to create or update NHRP peer entries.</p>
<p>To prevent a spoke from registering with the hub without authorization, enable NHRP negotiation authentication between the spoke and hub. After a spoke sends a registration request packet to the hub for registration, the hub determines whether to process the packet based on the authentication string in the packet. If the authentication string configured on the hub is different from that in the registration request packet, the hub does not process the packet. If the authentication string configured on the hub is the same as that in the registration request packet, the hub processes the packet.</p>
<p><strong>DSVPN IPsec Protection</strong></p>
<p>Data transmitted between the hub and spokes and between spokes can be encrypted to increase data security. During DSVPN deployment, bind an IPsec profile to DSVPN so that mGRE and IPsec tunnels can be dynamically established between spokes.</p>
<ul><li>The establishment of an mGRE tunnel immediately triggers the establishment of an IPsec tunnel.</li><li>Typical IPsec technology uses ACLs to identify unicast traffic to be encrypted. An IPsec policy requires complex ACL definition, which is difficult to implement. DSVPN uses both NHRP and mGRE technologies. Deploying DSVPN together with IPsec helps simplify device configurations, ensuring data transmission security and facilitating network deployment.</li><li>Because IPsec tunnels are dynamically established between spokes, IPsec data exchanged between spokes does not need to be decrypted or encrypted by the hub, minimizing data transmission delay.</li></ul>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001227286645__1.3.2"></a><a name="1.3.2"></a>
<div class="p"><h4 class="sectiontitle">Attack Methods</h4><ul><li>Listen to data transmitted between spokes and the hub and between spokes.</li><li>Masquerade as authorized spokes to register with the hub. The hub receives registration request packets from all spokes. When receiving registration request packets from unauthorized spokes, it also creates NHRP entries. After the number of created NHRP entries exceeds the upper limit, excess NHRP entries are discarded.</li></ul>
</div></div>
<div class="steps-unordered"><a name="EN-US_TASK_0000001227286645__1.3.3"></a><a name="1.3.3"></a><h4 class="sectiontitle">Procedure</h4>
<ul><li><span>Configure NHRP negotiation authentication.</span><p><div class="p">Perform the following configurations on the hub and spokes.<ol><li>Configure the hub.<ol type="a"><li>Run <b><span class="cmdname">system-view</span></b><p>The system view is displayed.</p>
</li><li>Run <a href="cmdqueryname=nhrp+enable"><b><span class="cmdname">nhrp enable</span></b></a><p>NHRP is enabled globally.</p>
</li><li>Run <a href="cmdqueryname=interface+tunnel"><b><span class="cmdname">interface tunnel</span></b></a> <i><span class="varname">interface-number</span></i><p>The tunnel interface view is displayed.</p>
</li><li>Run <a href="cmdqueryname=nhrp+enable"><b><span class="cmdname">nhrp enable</span></b></a><p>NHRP is enabled on the interface.</p>
</li><li>(Optional) Run <a href="cmdqueryname=nhrp+network-id"><b><span class="cmdname">nhrp network-id</span></b></a> <i><span class="varname">netId</span></i><p>The NHRP domain to which the interface belongs is configured.</p>
</li><li>Run <a href="cmdqueryname=nhrp+entry+multicast+dynamic"><b><span class="cmdname">nhrp entry multicast dynamic</span></b></a><p>The NHRP multicast member table is configured.</p>
</li><li>Run <a href="cmdqueryname=nhrp+authentication"><b><span class="cmdname">nhrp authentication</span></b></a> [ <strong><span>hash</span></strong> { <strong><span>sha2-256</span></strong> | <strong><span>sha2-384</span></strong> | <strong><span>sha2-512</span></strong> } ] <strong><span>cipher</span></strong> <i><span class="varname">authenString</span></i><p>An authentication string is configured for NHRP negotiation.</p>
</li><li>(Optional) Run <a href="cmdqueryname=nhrp+entry+holdtime"><b><span class="cmdname">nhrp entry holdtime</span></b></a> <i><span class="varname">holdtime</span></i><p>The hold time of NHRP entries is set.</p>
</li><li>(Optional) Run <a href="cmdqueryname=nhrp+redirect"><b><span class="cmdname">nhrp redirect</span></b></a><p>NHRP redirect is enabled.</p>
<p>This function is required only when DSVPN uses the shortcut mode. After this function is deployed, the hub sends an NHRP Redirect packet to the source spoke when forwarding traffic to another spoke in the same DSVPN as the source spoke, triggering the source spoke to send an NHRP resolution request packet to establish a tunnel for direct communication with the destination spoke.</p>
</li><li>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a><p>The configuration is committed.</p>
</li></ol>
</li><li>Configure spokes.<ol type="a"><li>Run <b><span class="cmdname">system-view</span></b><p>The system view is displayed.</p>
</li><li>Run <a href="cmdqueryname=nhrp+enable"><b><span class="cmdname">nhrp enable</span></b></a><p>NHRP is enabled globally.</p>
</li><li>Run <a href="cmdqueryname=interface+tunnel"><b><span class="cmdname">interface tunnel</span></b></a> <i><span class="varname">interface-number</span></i><p>The tunnel interface view is displayed.</p>
</li><li>Run <a href="cmdqueryname=nhrp+enable"><b><span class="cmdname">nhrp enable</span></b></a><p>NHRP is enabled on the interface.</p>
</li><li>(Optional) Run <a href="cmdqueryname=nhrp+network-id"><b><span class="cmdname">nhrp network-id</span></b></a> <i><span class="varname">netId</span></i><p>The NHRP domain to which the interface belongs is configured.</p>
</li><li>(Optional) Run <a href="cmdqueryname=nhrp+shortcut"><b><span class="cmdname">nhrp shortcut</span></b></a><p>NHRP shortcut is enabled. This function needs to be enabled on spokes in DSVPN shortcut scenarios.</p>
</li><li>Run <a href="cmdqueryname=nhrp+entry+multicast+dynamic"><b><span class="cmdname">nhrp entry multicast dynamic</span></b></a><p>The NHRP multicast member table is configured.</p>
</li><li>Run <strong><b><span class="cmdname">nhrp entry</span></b> </strong><i><span class="varname">protocol-address</span></i><em> </em><i><span class="varname">nbma-address</span></i> [ <strong><span>register</span></strong> ]<p>The NHRP mapping table is configured.</p>
</li><li>(Optional) Run <a href="cmdqueryname=nhrp+registration+no-unique"><b><span class="cmdname">nhrp registration no-unique</span></b></a><p>The device is configured to send NHRP packets carrying the no-unique flag to instruct the peer end to override conflicting NHRP peer entries.</p>
</li><li>Run <a href="cmdqueryname=nhrp+authentication"><b><span class="cmdname">nhrp authentication</span></b></a> [ <strong><span>hash</span></strong> { <strong><span>sha2-256</span></strong> | <strong><span>sha2-384</span></strong> | <strong><span>sha2-512</span></strong> } ] <strong><span>cipher</span></strong> <i><span class="varname">authenString</span></i><div class="p">An authentication string is configured for NHRP negotiation.<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>If this configuration is performed on the hub, it must be performed on spokes.</p>
</div></div>
</div>
</li><li>(Optional) Run <a href="cmdqueryname=nhrp+registration+interval"><b><span class="cmdname">nhrp registration interval</span></b></a> <i><span class="varname">regInterval</span></i><p>The NHRP registration interval is configured.</p>
</li><li>(Optional) Run <a href="cmdqueryname=nhrp+entry+holdtime"><b><span class="cmdname">nhrp entry holdtime</span></b></a> <i><span class="varname">holdtime</span></i><p>The hold time of NHRP entries is set.</p>
</li><li>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a><p>The configuration is committed.</p>
</li></ol>
</li></ol>
</div>
</p></li><li><span>Configure DSVPN IPsec protection.</span><p><ol><li>For details, see <a href="dc_vrp_ipsec_cfg_all_0011.html">Configuring an IKE Proposal</a>.</li><li>For details, see <a href="dc_vrp_ipsec_cfg_all_0012.html">Configuring an IKE Peer</a>. </li><li>(Optional) Configure an IKE filter set.<ol type="a"><li>Run <b><span class="cmdname">system-view</span></b><p>The system view is displayed.</p>
</li><li>Run <a href="cmdqueryname=ike+identity"><b><span class="cmdname">ike identity</span></b></a> <i><span class="varname">name</span></i><p>A filter set for IKE negotiation is configured, and its view is displayed.</p>
</li><li>Run <a href="cmdqueryname=ip+address"><b><span class="cmdname">ip address</span></b></a> <i><span class="varname">ip-address</span></i> { <i><span class="varname">mask</span></i> | <i><span class="varname">mask-length</span></i> }<p>The IP address of the allowed IKE peer is configured.</p>
</li><li>Run <a href="cmdqueryname=fqdn"><b><span class="cmdname">fqdn</span></b></a> <i><span class="varname">fqdn</span></i><p>The domain name of the allowed IKE peer is configured.</p>
</li><li>Run <a href="cmdqueryname=user-fqdn"><b><span class="cmdname">user-fqdn</span></b></a> <i><span class="varname">user-fqdn</span></i><p>The host domain name of the allowed IKE peer is configured.</p>
</li><li>Run <a href="cmdqueryname=dn"><b><span class="cmdname">dn</span></b></a> <i><span class="varname">dn</span></i><p>A distinguished name (DN) is configured for the digital certificate of the allowed IKE peer.</p>
</li><li>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a><p>Exit the IKE filter set view.</p>
</li><li>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a><p>The configuration is committed.</p>
</li></ol>
</li><li>Configure an IPsec profile.<ol type="a"><li>Run <b><span class="cmdname">system-view</span></b><p>The system view is displayed.</p>
</li><li>Run <a href="cmdqueryname=ipsec+policy"><b><span class="cmdname">ipsec policy</span></b></a> <i><span class="varname">policy-name</span></i> <strong><span>profile</span></strong><p>The IPsec profile view is displayed.</p>
</li><li>Run <a href="cmdqueryname=proposal"><b><span class="cmdname">proposal</span></b></a> <i><span class="varname">proposal-name</span></i><p>The security proposal for reference is specified.</p>
</li><li>Run <a href="cmdqueryname=ike-peer"><b><span class="cmdname">ike-peer</span></b></a> <i><span class="varname">peer-name</span></i><p>The IKE peer for reference is specified.</p>
</li><li>(Optional) Run <a href="cmdqueryname=pfs"><b><span class="cmdname">pfs</span></b></a> { <strong><span>dh-group1</span></strong> | <strong><span>dh-group2</span></strong> | <strong><span>dh-group5</span></strong> | <strong><span>dh-group14</span></strong><span></span><span><span><span> | <strong><span>group15</span></strong> | <strong><span>group16</span></strong></span></span> | <strong><span>dh-group19</span></strong> | <strong><span>dh-group20</span></strong> | <strong><span>dh-group21</span></strong></span> }<p>The PFS feature used for negotiation is configured.</p>
<p>If PFS is configured on the local end, the peer end must use PFS during initiating negotiation. The DH groups specified on the local and peer ends must be the same. Otherwise, the negotiation fails.</p>
</li><li>(Optional) Run <a href="cmdqueryname=remote+ike-identity"><b><span class="cmdname">remote ike-identity</span></b></a> <i><span class="varname">name</span></i><div class="p">A filter set is configured for the allowed IKE peer.<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>If an IPsec profile references a previously defined IKE filter set (IKE identity), packets are filtered based on the IKE filter set. Otherwise, packets are not filtered.</p>
</div></div>
</div>
</li><li>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a><p>Exit the IPsec profile view.</p>
</li><li>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a><p>The configuration is committed.</p>
</li></ol>
</li><li>Apply the IPsec profile.<p>For details, see <a href="dc_vrp_ipsec_cfg_all_0015.html">Applying an IPsec Policy</a>. </p>
</li></ol>
</p></li></ul></div>
<div class="example"><a name="EN-US_TASK_0000001227286645__1.3.4"></a><a name="1.3.4"></a><h4 class="sectiontitle">Verifying the Security Hardening Result</h4><ul><li>Run the <a href="cmdqueryname=display+nhrp+peer"><b><span class="cmdname">display nhrp peer</span></b></a> command to check information about the NHRP peer table.</li><li>Run <a href="cmdqueryname=display+ipsec+sa"><b><span class="cmdname">display ipsec sa</span></b></a> to check the configuration of the current SA.</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_sec_hardening_control_level2.html">Control Plane
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_sec_maintenance_0074.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_sec_maintenance_0055.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>