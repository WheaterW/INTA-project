
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Applying an IPsec Policy">
<meta name="abstract" content="This section describes how to apply an IPsec policy to a tunnel interface to implement security protection on different data flows.">
<meta name="description" content="This section describes how to apply an IPsec policy to a tunnel interface to implement security protection on different data flows.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ipsec_cfg_all_0007.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ipsec_cfg_all_0014.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ipsec_cfg_all_0016.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,z00603461,ipsec,w00556928,w00606909,h00522387,l00455378,z00805567">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="IPSec">
<meta name="featuretype" content="Security">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="IPSec">
<meta name="featuretype" content="Security">
<meta name="featurename" content="IPSec">
<meta name="featuretype" content="Security">
<meta name="featurename" content="IPSec">
<meta name="featuretype" content="Security">
<meta name="OWNER" content="z00485179">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="z00485179">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172372433">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Applying an IPsec Policy</title>
</head>
<body><a name="EN-US_TASK_0172372433"></a><a name="EN-US_TASK_0172372433"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Applying an IPsec Policy</h1>
<div class="taskbody"><p>This section describes how to apply an IPsec policy to a tunnel interface to implement security protection on different data flows.</p>
<div class="context"><a name="EN-US_TASK_0172372433__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>If an IPsec policy is applied to an interface through IKE negotiation, an SA is not established immediately. IKE starts to negotiate an IPsec SA only when the data flow that matches a certain IPsec policy is sent from the interface.</p>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172372433__1.4.2"></a><a name="1.4.2"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Run the <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a> command to enter the system view.</span></li><li><span>Run the <a href="cmdqueryname=service-location"><b><span class="cmdname">service-location</span></b></a> <i><span class="varname">service-location-id</span></i> command to create a VSM HA backup group and access its view.</span></li><li><span>Run the <a href="cmdqueryname=location"><b><span class="cmdname">location</span></b></a> command to bind the VSM HA backup group to the CPU of the service board.</span></li><li><span>Run the <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a> command to commit the configuration.</span></li><li><span>Run the <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a> command to return to the system view.</span></li><li><span>Run the <a href="cmdqueryname=service-instance-group"><b><span class="cmdname">service-instance-group</span></b></a> <i><span class="varname">service-instance-group-name</span></i> command to create a VSM HA service instance group and access its view.</span></li><li><span>Run the <a href="cmdqueryname=service-location"><b><span class="cmdname">service-location</span></b></a> <i><span class="varname">service-location-id</span></i> command to bind the VSM HA backup group to the VSM HA service instance group.</span></li><li><span>Run the <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a> command to commit the configuration.</span></li><li><span>Run the <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a> command to return to the system view.</span></li><li><span>Run the <a href="cmdqueryname=interface+tunnel"><b><span class="cmdname">interface tunnel</span></b></a> <i><span class="varname">tunnel-number</span></i> command to create a tunnel interface and enter the tunnel interface view.</span><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>You need to create a tunnel interface first. An IPsec policy can be applied only to a tunnel interface, but not to a physical interface.</p>
</div></div>
</p></li><li><span>Run the <a href="cmdqueryname=tunnel-protocol+ipsec"><b><span class="cmdname">tunnel-protocol</span></b></a> <strong><span>ipsec</span></strong> command to configure IPsec on the tunnel interface.</span></li><li><span>Run either of the following commands to configure an IP address for the tunnel interface:</span><ul><li><p>Run the <a href="cmdqueryname=ip+address"><b><span class="cmdname">ip address</span></b></a> <i><span class="varname">ip-address</span></i> <i><span class="varname">mask</span></i> command to configure an IP address for the tunnel interface.</p>
</li><li><p>Run the <a href="cmdqueryname=ip+address+unnumbered+interface"><b><span class="cmdname">ip address unnumbered</span></b></a> <strong><span>interface</span></strong> <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i> command to configure the tunnel interface to borrow an IP address from another interface.</p>
</li></ul>
<p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>If an available IP address exists on a device, run the first command to configure an IP address for the tunnel interface. The second command is run only when no available IP address exists on a device.</p>
<div class="p">The second command may bring the following risks:<ul><li>If a tunnel interface that has been configured with the <a href="cmdqueryname=tunnel-protocol+ipsec"><b><span class="cmdname">tunnel-protocol</span></b></a> <strong><span>ipsec</span></strong> command borrows an IP address from a physical or logical interface, the interface cannot be bound to other services. Otherwise, other services are also diverted to the IPsec tunnel.</li><li>If the IP address of another physical or logical interface is borrowed and the IP address of the interface changes, IPsec negotiation fails.</li><li>If the IP address of a physical interface is borrowed and the physical interface alternates between up and down, IPsec negotiation may fail.</li></ul>
</div>
</div></div>
</p></li><li><span>Run the <a href="cmdqueryname=ipsec+policy"><b><span class="cmdname">ipsec policy</span></b></a> <i><span class="varname">policy-name</span></i> <strong><span>service-instance-group</span></strong> <i><span class="varname">service-group-name</span></i> command to apply an IPsec policy to the interface.</span><p><div class="p">To use IPsec on a DSVPN-enabled interface, run the <a href="cmdqueryname=ipsec+policy+service-instance-group+share"><b><span class="cmdname">ipsec policy</span></b></a> <i><span class="varname">profile-name</span></i> <strong><span>service-instance-group</span></strong> <i><span class="varname">service-group-name</span></i> [ <strong><span>share</span></strong> ] command to bind an IPsec profile to the interface.<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Generally, an IPsec profile can be applied to only one interface. In a scenario where multiple mGRE tunnels of a DSVPN share the same source, if you need to apply the same IPsec profile to multiple tunnel interfaces for IPsec tunnel sharing, specify the <strong><span>share</span></strong> parameter when running this command.</p>
<p>The <strong><span>share</span></strong> parameter can be used only in this scenario. In addition, mGRE tunnels with the same source address must be configured with different keys. In addition, you need to run the <a href="cmdqueryname=tunnel-protocol+gre+p2mp"><b><span class="cmdname">tunnel-protocol</span></b></a> <strong><span>gre</span></strong> <strong><span>p2mp</span></strong> command and the <a href="cmdqueryname=source"><b><span class="cmdname">source</span></b></a> [ <i><span class="varname">source-ip-address</span></i> | { <i><span class="varname">interface-name</span></i> | <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i> } ] command on the tunnel interface.</p>
</div></div>
</div>
</p></li><li><span>(Optional) Run the <a href="cmdqueryname=ipsec+generate-service-route"><b><span class="cmdname">ipsec generate-service-route</span></b></a> command to enable automatic IPsec service route generation.</span><p><div class="p">Automatic IPsec service route generation is mainly applied to the following two scenarios:<ul><li><p>When a security policy is used to establish IPsec tunnels, you may not know the IPsec service route information of the remote end (such as the IP address and interface of the remote end). Therefore, static routes cannot be configured manually. In this case, run the <a href="cmdqueryname=ipsec+generate-service-route"><b><span class="cmdname">ipsec generate-service-route</span></b></a> command to enable the function of automatic IPsec service route generation.</p>
</li><li><p>When IPsec tunnels are established using an IPsec policy template, IPsec service routes will be generated during the IPsec negotiation. If you want to generate IPsec service routes by configuring static routes, you can run the <a href="cmdqueryname=undo+ipsec+generate-service-route"><b><span class="cmdname">undo ipsec generate-service-route</span></b></a> command to disable the function of automatic IPsec service route generation first.</p>
</li></ul>
</div>
</p></li><li><span>Run the <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a> command to commit the configuration.</span></li></ol></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ipsec_cfg_all_0007.html">Configuring Automatic IPsec SA Negotiation (IKE)
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ipsec_cfg_all_0014.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ipsec_cfg_all_0016.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>