
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring Static BGP VPNv4 Flow Specification">
<meta name="abstract" content="Static BGP VPNv4 Flow Specification allows BGP VPNv4 Flow Specification routes to be transmitted and traffic filtering policies to be generated. The policies improve security of devices in VPNs.">
<meta name="description" content="Static BGP VPNv4 Flow Specification allows BGP VPNv4 Flow Specification routes to be transmitted and traffic filtering policies to be generated. The policies improve security of devices in VPNs.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_flowspec_cfg_0000.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_flowspec_cfg_0018.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_flowspec_cfg_0026.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="z00603461,w00800033,flow-specificationvrp,w00556928,w00606909,l00455378,z00805567">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="BGP Flow Specfication">
<meta name="featuretype" content="Security">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP Flow Specfication">
<meta name="featuretype" content="Security">
<meta name="OWNER" content="h00522387">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00615954">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172372353">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring Static BGP VPNv4 Flow Specification</title>
</head>
<body><a name="EN-US_TASK_0172372353"></a><a name="EN-US_TASK_0172372353"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring Static BGP VPNv4 Flow Specification</h1>
<div class="taskbody"><p>Static BGP VPNv4 Flow Specification allows BGP VPNv4 Flow Specification routes to be transmitted and traffic filtering policies to be generated. The policies improve security of devices in VPNs.</p>
<div class="context"><a name="EN-US_TASK_0172372353__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Usage Scenario</h4><p>To deploy static BGP VPNv4 Flow Specification, a BGP VPN Flow Specification route needs to be created manually first. After the BGP-Flow VPNv4 address family is enabled, a BGP VPNv4 Flow Specification route is generated automatically. Then a BGP VPNv4 Flow Specification peer relationship needs be established between the device on which the BGP VPN Flow Specification route is created and the network ingress device to transmit the BGP VPNv4 Flow Specification route.</p>
<p>In an AS with multiple ingresses, a BGP VPNv4 Flow route reflector (Flow RR) can be deployed to reduce the number of BGP VPN Flow Specification peer relationships and save network resources.</p>
</div></div>
<div class="context"><a name="EN-US_TASK_0172372353__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Pre-configuration Tasks</h4><p>Before configuring static BGP VPNv4 Flow Specification, complete the following tasks:</p>
<ul><li><a href="dc_vrp_bgp_cfg_3006.html">Configure BGP peer relationships.</a></li><li><p>Enable the BGP-Flow VPN instance IPv4 address family.</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172372353__1.4.3"></a><a name="1.4.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Generate a BGP VPN Flow Specification route manually.</span><ol type="a"><li class="substepexpand"><span>Run <span><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=flow-route+vpn-instance"><b><span class="cmdname">flow-route</span></b></a> <i><span class="varname">flowroute-name</span></i> <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i></span></span><p><p>A static BGP VPN Flow Specification route is created, and the Flow-Route VPN instance view is displayed.</p>
</p><p><div class="p">One BGP VPN Flow Specification route can include multiple <strong>if-match</strong> and <strong>apply</strong> clauses. <strong>if-match</strong> clauses define traffic filtering rules, and <strong>apply</strong> clauses define traffic behaviors. The relationships among clauses are as follows:<ul><li><p>The relationship among <strong>if-match</strong> clauses of different types is "AND."</p>
</li><li><p>If <strong>if-match</strong> clauses of the same type are configured repeatedly, some rules override each other, and some other rules are in the OR relationship. For details, see the precautions for the <a href="cmdqueryname=if-match"><b><span class="cmdname">if-match</span></b></a> command.</p>
</li><li><p>The relationship among the traffic behaviors defined by <strong>apply</strong> clauses is "AND."</p>
</li></ul>
The traffic behaviors defined by<strong> apply</strong> clauses apply to all traffic matching the filtering rules of <strong>if-match</strong> clauses.</div>
</p></li><li class="substepexpand"><span>According to characteristics of the traffic to be controlled, you can configure one or more <strong>if-match</strong> clauses to define traffic filtering rules as needed:</span><p><ul><li><p>To set a destination address-based traffic filtering rule, run the <a href="cmdqueryname=if-match+destination"><b><span class="cmdname">if-match destination</span></b></a> <i><span class="varname">ipv4-address</span></i> { <i><span class="varname">mask</span></i> | <i><span class="varname">mask-length</span></i> } command.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Traffic control is performed based on a specified destination IP address specified in a rule configured using the <a href="cmdqueryname=if-match+destination"><b><span class="cmdname">if-match destination</span></b></a> command, but BGP VPN Flow Specification routes matching the rule cannot pass validation. In this situation, run the <a href="cmdqueryname=peer+validation-disable"><b><span class="cmdname">peer validation-disable</span></b></a> command to disable the validation.</p>
<p>By default, 0.0.0.0/0 is used as the prefix of each BGP VPN Flow Specification route that matches the export or import policy of a peer. To enable a device to change the prefix of each BGP VPN Flow Specification route that matches the export or import policy of a peer to the destination IP address specified in the <a href="cmdqueryname=if-match+destination"><b><span class="cmdname">if-match destination</span></b></a> command, run the <a href="cmdqueryname=route+match-destination"><b><span class="cmdname">route match-destination</span></b></a> command.</p>
</div></div>
</li><li><p>To configure a filtering rule based on the source address, run the <a href="cmdqueryname=if-match+source"><b><span class="cmdname">if-match source</span></b></a> <i><span class="varname">ipv4-address</span></i> { <i><span class="varname">mask</span></i> | <i><span class="varname">mask-length</span></i> } command.</p>
</li><li><p>To set a filtering rule based on the port number, run the <a href="cmdqueryname=if-match+port"><b><span class="cmdname">if-match port</span></b></a> <i><span class="varname">operator</span></i> <i><span class="varname">port</span></i> command.</p>
</li><li><p>To configure a filtering rule based on the source port number, run the <a href="cmdqueryname=if-match+source-port"><b><span class="cmdname">if-match source-port</span></b></a> <i><span class="varname">operator</span></i> <i><span class="varname">port</span></i> command.</p>
</li><li><p>To configure a filtering rule based on the destination port number, run the <a href="cmdqueryname=if-match+destination-port"><b><span class="cmdname">if-match destination-port</span></b></a> <i><span class="varname">operator</span></i> <i><span class="varname">port</span></i> command.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p><a href="cmdqueryname=if-match+port"><b><span class="cmdname">if-match port</span></b></a> and <a href="cmdqueryname=if-match+destination-port"><b><span class="cmdname">if-match destination-port</span></b></a> or <a href="cmdqueryname=if-match+source-port"><b><span class="cmdname">if-match source-port</span></b></a> are mutually exclusive.</p>
</div></div>
</li><li><p>To set a traffic filtering rule that is based on the protocol used to carry traffic, run the <a href="cmdqueryname=if-match+protocol"><b><span class="cmdname">if-match protocol</span></b></a> <i><span class="varname">operator</span></i> <i><span class="varname">protocol</span></i> command.</p>
</li><li><p>To configure a filtering rule based on the service type, run the <a href="cmdqueryname=if-match+dscp"><b><span class="cmdname">if-match dscp</span></b></a> <i><span class="varname">operator</span></i> <i><span class="varname">dscp</span></i> command.</p>
</li><li><p>To configure a filtering rule based on the TCP flag, run the <a href="cmdqueryname=if-match+tcp-flags+match+not"><b><span class="cmdname">if-match tcp-flags</span></b></a> { <strong><span>match</span></strong> | <strong><span>not</span></strong> } <i><span class="varname">tcp-flags</span></i> command.</p>
<p>Network attackers may send a large number of invalid TCP packets to attack network devices. To control invalid TCP packets to ensure communication security, configure a filtering rule based on the TCP flag for the BGP VPN Flow Specification route using the <a href="cmdqueryname=if-match+tcp-flags"><b><span class="cmdname">if-match tcp-flags</span></b></a> command. Traffic matching the TCP flag is filtered or controlled using the actions specified in the apply clauses.</p>
</li><li><p>To configure a filtering rule based on the fragment type, run the <a href="cmdqueryname=if-match+fragment-type+match+not"><b><span class="cmdname">if-match fragment-type</span></b></a> { <strong><span>match</span></strong> | <strong><span>not</span></strong> } <i><span class="varname">fragment-type-name</span></i> command.</p>
</li><li><p>To set a traffic filtering rule that is based on an ICMP packet code, run the <a href="cmdqueryname=if-match+icmp-code"><b><span class="cmdname">if-match icmp-code</span></b></a> <i><span class="varname">operator</span></i> <i><span class="varname">icmp-code</span></i> command.</p>
</li><li><p>To set a traffic filtering rule that is based on an ICMP packet type, run the <a href="cmdqueryname=if-match+icmp-type+greater-than+less-than+equal"><b><span class="cmdname">if-match icmp-type</span></b></a> { <strong><span>greater-than</span></strong> | <strong><span>less-than</span></strong> | <strong><span>equal</span></strong> } <i><span class="varname">icmp-type</span></i> command.</p>
</li><li><p>To configure a filtering rule based on the packet length of BGP VPN Flow Specification routes, run the <a href="cmdqueryname=if-match+packet-length+greater-than+less-than+equal"><b><span class="cmdname">if-match packet-length</span></b></a> { <strong><span>greater-than</span></strong> | <strong><span>less-than</span></strong> | <strong><span>equal</span></strong> } <i><span class="varname">packet-length-value</span></i> command.</p>
</li></ul>
</p></li><li class="substepexpand"><span>Run the following command as required to configure actions for apply clauses:</span><p><ul><li><p>To discard the matched traffic, run the <a href="cmdqueryname=apply+deny"><b><span class="cmdname">apply deny</span></b></a> command.</p>
</li><li><p>To redirect the matching traffic to the traffic cleaning device or blackhole, run the <a href="cmdqueryname=apply+redirect+vpn-target+ip"><b><span class="cmdname">apply redirect</span></b></a> { <strong><span>vpn-target</span></strong> <i><span class="varname">vpn-target-import</span></i> | <strong><span>ip</span></strong> <i><span class="varname">redirect-ip-rt</span></i> } command.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The device can process the redirection next hop attribute configured using the <a href="cmdqueryname=apply+redirect+ip"><b><span class="cmdname">apply redirect</span></b></a> <strong><span>ip</span></strong> <i><span class="varname">redirect-ip-rt</span></i> command received from a peer only after the <a href="cmdqueryname=peer+redirect+ip"><b><span class="cmdname">peer redirect ip</span></b></a> command is run.</p>
</div></div>
</li><li><p>To re-mark the service class of the matching traffic, run the <a href="cmdqueryname=apply+remark-dscp"><b><span class="cmdname">apply remark-dscp</span></b></a> command.</p>
</li><li><p>To limit the rate of the matched traffic, run the <a href="cmdqueryname=apply+traffic-rate"><b><span class="cmdname">apply traffic-rate</span></b></a> command.</p>
</li></ul>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The <a href="cmdqueryname=apply+deny"><b><span class="cmdname">apply deny</span></b></a> and <a href="cmdqueryname=apply+traffic-rate"><b><span class="cmdname">apply traffic-rate</span></b></a> commands are mutually exclusive.</p>
<p>If the configured BGP VPN Flow Specification route attribute does not need to take effect locally, run the <a href="cmdqueryname=routing-table+rib-only+route-policy"><b><span class="cmdname">routing-table rib-only</span></b></a> [ <strong><span>route-policy</span></strong> <i><span class="varname">route-policy-name</span></i><span> | <strong><span>route-filter</span></strong> <i><span class="varname">route-filter-name</span></i></span> ] command to disable the device from delivering the BGP VPN Flow Specification route to the FES forwarding table.</p>
</div></div>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li><span>Establish a BGP VPNv4 Flow Specification peer relationship.</span><ol type="a"><li class="substepexpand"><span>Run <span><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span></span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=peer+as-number"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <strong><span>as-number</span></strong> <i><span class="varname">as-number</span></i></span></span><p><p>An IP address and AS number are specified for the peer.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=ipv4-flow+vpnv4"><b><span class="cmdname">ipv4-flow vpnv4</span></b></a></span></span><p><p>The BGP-Flow VPNv4 address family is enabled, and its view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <a href="cmdqueryname=enable"><b><span class="cmdname">enable</span></b></a></span></span><p><p>A BGP VPNv4 Flow Specification peer relationship is established.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li><span>(Optional) Configure a Flow RR.</span><p><p>Before configuring a Flow RR, establish a BGP VPNv4 Flow Specification peer relationship between the Flow RR with the device that generates the BGP VPN Flow Specification route and every ingress.</p>
</p><ol type="a"><li class="substepexpand"><span>Run <span><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span></span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=ipv4-flow+vpnv4"><b><span class="cmdname">ipv4-flow vpnv4</span></b></a></span></span><p><p>The BGP-Flow VPNv4 address family is enabled, and its view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <a href="cmdqueryname=reflect-client"><b><span class="cmdname">reflect-client</span></b></a></span><p><p>A Flow RR is configured, and clients are specified for it.</p>
</p><p><p>The <span class="keyword">Router</span> on which the <a href="cmdqueryname=peer+reflect-client"><b><span class="cmdname">peer reflect-client</span></b></a> command is run functions as a Flow RR, and the specified peers function as clients.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=undo+reflect+between-clients"><b><span class="cmdname">undo reflect between-clients</span></b></a></span><p><p>Route reflection between clients through the RR is disabled.</p>
</p><p><p>If the clients of a Flow RR are fully meshed, you can run the <a href="cmdqueryname=undo+reflect+between-clients"><b><span class="cmdname">undo reflect between-clients</span></b></a> command on the Flow RR to disable route reflection between clients through the RR, which reduces costs.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <span><a href="cmdqueryname=reflector+cluster-id"><b><span class="cmdname">reflector cluster-id</span></b></a> { <i><span class="varname">cluster-id-value</span></i> | <i><span class="varname">cluster-id-ipv4</span></i> }</span></span><p><p>A cluster ID is configured for the Flow RR.</p>
</p><p><p>If a cluster has multiple flow RRs, run this command to set the same <i><span class="varname">cluster-id</span></i> for these RRs.</p>
<p>The <a href="cmdqueryname=reflector+cluster-id"><b><span class="cmdname">reflector cluster-id</span></b></a> command is applicable only to Flow RRs.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li><span>(Optional) Configure the redirection next-hop attribute ID for BGP VPNv4 Flow Specification routes.</span><p><p id="EN-US_TASK_0172372353__en-us_task_0172372352_p406754792214101">The redirection next-hop attribute ID can be 0x010C (defined in a related RFC) or 0x0800 (defined in a related draft). If a Huawei device needs to communicate with a non-Huawei device that does not support the redirection next-hop attribute ID of 0x010C or 0x0800, set the redirection next-hop attribute ID of BGP VPNv4 Flow Specification routes as required. Perform one of the following configurations based on the ID supported by non-Huawei devices:</p>
<ul id="EN-US_TASK_0172372353__en-us_task_0172372352_ul1409422833214101"><li id="EN-US_TASK_0172372353__en-us_task_0172372352_li24256203214101"><p id="EN-US_TASK_0172372353__en-us_task_0172372352_p1799594538214101"><a name="EN-US_TASK_0172372353__en-us_task_0172372352_li24256203214101"></a><a name="en-us_task_0172372352_li24256203214101"></a>Set the redirection next-hop attribute ID to 0x010C (defined in a related RFC) for BGP VPNv4 Flow Specification routes.</p>
<ol type="a" id="EN-US_TASK_0172372353__en-us_task_0172372352_ol178333767214101"><li id="EN-US_TASK_0172372353__en-us_task_0172372352_li563540020214101">Run <a href="cmdqueryname=system-view"><b><span class="cmdname" id="EN-US_TASK_0172372353__en-us_task_0172372352_cmdname1634139851214101">system-view</span></b></a><p id="EN-US_TASK_0172372353__en-us_task_0172372352_p2068731541714">The system view is displayed.</p>
</li><li id="EN-US_TASK_0172372353__en-us_task_0172372352_li520798632214101">Run <a href="cmdqueryname=bgp"><b><span class="cmdname" id="EN-US_TASK_0172372353__en-us_task_0172372352_cmdname260418468214101">bgp</span></b></a> <i><span class="varname" id="EN-US_TASK_0172372353__en-us_task_0172372352_varname9921134813344">as-number</span></i><p id="EN-US_TASK_0172372353__en-us_task_0172372352_p135351230121719">The BGP view is displayed.</p>
</li><li id="EN-US_TASK_0172372353__en-us_task_0172372352_li1894562550214101">Run <a href="cmdqueryname=ipv4-flow+vpnv4"><b><span class="cmdname" id="EN-US_TASK_0172372353__en-us_task_0172372352_cmdname699815101214101">ipv4-flow vpnv4</span></b></a><p id="EN-US_TASK_0172372353__en-us_task_0172372352_p131621845141716">The BGP-Flow VPNv4 address family is enabled, and the BGP-Flow VPNv4 address family view is displayed.</p>
</li><li id="EN-US_TASK_0172372353__en-us_task_0172372352_li849699122214101">Run <a href="cmdqueryname=peer+redirect+ip+rfc-compatible"><b><span class="cmdname" id="EN-US_TASK_0172372353__en-us_task_0172372352_cmdname204162057214101">peer</span></b></a> <i><span class="varname" id="EN-US_TASK_0172372353__en-us_task_0172372352_varname1845731569214101">ipv4-address</span></i> <strong><span id="EN-US_TASK_0172372353__en-us_task_0172372352_cmdparmname1889332925214101">redirect ip rfc-compatible</span></strong><p id="EN-US_TASK_0172372353__en-us_task_0172372352_p310412071811">The redirection next hop attribute ID of BGP VPNv4 Flow Specification routes is set to 0x010C (defined in a related RFC).</p>
</li><li id="EN-US_TASK_0172372353__en-us_task_0172372352_li641166285214101">Run <a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0172372353__en-us_task_0172372352_cmdname2063454647214101">commit</span></b></a><p id="EN-US_TASK_0172372353__en-us_task_0172372352_p738641914181">The configuration is committed.</p>
</li></ol>
</li><li id="EN-US_TASK_0172372353__en-us_task_0172372352_li1734077653214101"><p id="EN-US_TASK_0172372353__en-us_task_0172372352_p1142540534214101"><a name="EN-US_TASK_0172372353__en-us_task_0172372352_li1734077653214101"></a><a name="en-us_task_0172372352_li1734077653214101"></a>Set the redirection next-hop attribute ID to 0x0800 (defined in a related draft) for BGP VPNv4 Flow Specification routes.</p>
<ol type="a" id="EN-US_TASK_0172372353__en-us_task_0172372352_ol1516707628214101"><li id="EN-US_TASK_0172372353__en-us_task_0172372352_li1389396570214101">Run <a href="cmdqueryname=system-view"><b><span class="cmdname" id="EN-US_TASK_0172372353__en-us_task_0172372352_cmdname1442039233214101">system-view</span></b></a><p id="EN-US_TASK_0172372353__en-us_task_0172372352_p1855116346185">The system view is displayed.</p>
</li><li id="EN-US_TASK_0172372353__en-us_task_0172372352_li975472166214101">Run <a href="cmdqueryname=bgp"><b><span class="cmdname" id="EN-US_TASK_0172372353__en-us_task_0172372352_cmdname238077537214101">bgp</span></b></a> <i><span class="varname" id="EN-US_TASK_0172372353__en-us_task_0172372352_varname1492319488341">as-number</span></i><p id="EN-US_TASK_0172372353__en-us_task_0172372352_p1615125020184">The BGP view is displayed.</p>
</li><li id="EN-US_TASK_0172372353__en-us_task_0172372352_li767629026214101">Run <a href="cmdqueryname=ipv4-flow+vpnv4"><b><span class="cmdname" id="EN-US_TASK_0172372353__en-us_task_0172372352_cmdname417756546214101">ipv4-flow vpnv4</span></b></a><p id="EN-US_TASK_0172372353__en-us_task_0172372352_p59434315197">The BGP-Flow VPNv4 address family is enabled, and the BGP-Flow VPNv4 address family view is displayed.</p>
</li><li id="EN-US_TASK_0172372353__en-us_task_0172372352_li2007434450214101">Run <a href="cmdqueryname=peer+redirect+ip+draft-compatible"><b><span class="cmdname" id="EN-US_TASK_0172372353__en-us_task_0172372352_cmdname849100961214101">peer</span></b></a> <i><span class="varname" id="EN-US_TASK_0172372353__en-us_task_0172372352_varname456377518214101">ipv4-address</span></i> <strong><span id="EN-US_TASK_0172372353__en-us_task_0172372352_cmdparmname1140227007214101">redirect ip draft-compatible</span></strong><p id="EN-US_TASK_0172372353__en-us_task_0172372352_p15104121961910">The redirection next-hop attribute ID of BGP VPNv4 Flow Specification routes is set to 0x0800 (defined in a related draft).</p>
</li><li id="EN-US_TASK_0172372353__en-us_task_0172372352_li393482857214101">Run <a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0172372353__en-us_task_0172372352_cmdname1464656385214101">commit</span></b></a><p id="EN-US_TASK_0172372353__en-us_task_0172372352_p1615174601917">The configuration is committed.</p>
</li></ol>
</li></ul>
</p></li><li><span>(Optional) Disable BGP Flow Specification protection.</span><ol type="a" id="EN-US_TASK_0172372353__en-us_task_0172372344_substeps178887814913"><li class="substepexpand" id="EN-US_TASK_0172372353__en-us_task_0172372344_substep118881485918"><span id="EN-US_TASK_0172372353__en-us_task_0172372344_cmd138883817910">Run <a href="cmdqueryname=system-view"><b><span class="cmdname" id="EN-US_TASK_0172372353__en-us_task_0172372344_cmdname039174221019">system-view</span></b></a></span><p><p id="EN-US_TASK_0172372353__en-us_task_0172372344_p13702181014128">The system view is displayed.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0172372353__en-us_task_0172372344_substep8971201512920"><span id="EN-US_TASK_0172372353__en-us_task_0172372344_cmd097114152918">Run <a href="cmdqueryname=flowspec+protocol-protect+ipv4+ipv6+disable"><b><span class="cmdname" id="EN-US_TASK_0172372353__en-us_task_0172372344_cmdname67791726161015">flowspec protocol-protect</span></b></a> { <strong><span id="EN-US_TASK_0172372353__en-us_task_0172372344_cmdparmname1422011399114">ipv4</span></strong> | <strong><span id="EN-US_TASK_0172372353__en-us_task_0172372344_cmdparmname115531043131114">ipv6</span></strong> } <strong><span id="EN-US_TASK_0172372353__en-us_task_0172372344_cmdparmname78091349181114">disable</span></strong></span><p><p id="EN-US_TASK_0172372353__en-us_task_0172372344_p12278122114127">BGP Flow Specification protection is disabled.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0172372353__en-us_task_0172372344_substep139391326123"><span id="EN-US_TASK_0172372353__en-us_task_0172372344_cmd1693913211215">Run <a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0172372353__en-us_task_0172372344_cmdname4151640101214">commit</span></b></a></span><p><p id="EN-US_TASK_0172372353__en-us_task_0172372344_p1855253571220">The configuration is committed.</p>
</p></li></ol>
</li><li><span>(Optional) Enable the device to follow RFC 5575 when dealing with BGP Flow Specification IPv4 fragmentation rules.</span><ol type="a"><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=flowspec+ipv4-fragment-rule+switch"><b><span class="cmdname">flowspec ipv4-fragment-rule switch</span></b></a></span><p><p>BGP Flow Specification IPv4 fragmentation rules are enabled to comply with RFC 5575.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li><span>(Optional) Enable BGP Flow Specification to match inner packet information about the packets that leave an SRv6 TE Policy or SRv6 BE egress.</span><ol type="a" id="EN-US_TASK_0172372353__en-us_task_0172372344_substeps195639422140"><li class="substepexpand" id="EN-US_TASK_0172372353__en-us_task_0172372344_substep165631942191417"><span id="EN-US_TASK_0172372353__en-us_task_0172372344_cmd756310429148">Run <a href="cmdqueryname=system-view"><b><span class="cmdname" id="EN-US_TASK_0172372353__en-us_task_0172372344_cmdname5413124714141">system-view</span></b></a></span><p><p id="EN-US_TASK_0172372353__en-us_task_0172372344_p1188315171473">The system view is displayed.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0172372353__en-us_task_0172372344_substep92941850101419"><span id="EN-US_TASK_0172372353__en-us_task_0172372344_cmd12941050101412">Run <a href="cmdqueryname=flowspec+match+srv6-inner-ip+enable"><b><span class="cmdname" id="EN-US_TASK_0172372353__en-us_task_0172372344_cmdname655163675120">flowspec match srv6-inner-ip enable</span></b></a></span><p><p id="EN-US_TASK_0172372353__en-us_task_0172372344_p17382527114711">BGP Flow Specification is enabled to match inner packet information about the packets that leave an SRv6 TE Policy or SRv6 BE egress.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0172372353__en-us_task_0172372344_substep12814439157"><span id="EN-US_TASK_0172372353__en-us_task_0172372344_cmd62811943191514">Run <a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0172372353__en-us_task_0172372344_cmdname9864512158">commit</span></b></a></span><p><p id="EN-US_TASK_0172372353__en-us_task_0172372344_p4321538134715">The configuration is committed.</p>
</p></li></ol>
</li></ol></div>
<div class="postreq"><a name="EN-US_TASK_0172372353__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p>After completing the configuration, verify it.</p>
<ul><li><p>Run the <a href="cmdqueryname=display+bgp+flow+vpnv4+all+peer+verbose"><b><span class="cmdname">display bgp flow</span></b></a> <strong><span>vpnv4 all</span></strong> <strong><span>peer</span></strong> [ [ <i><span class="varname">ipv4-address</span></i> ] <strong><span>verbose</span></strong> ] command to check information about all BGP VPN Flow Specification peers and BGP VPNv4 Flow Specification peers.</p>
</li><li><p>Run the <a href="cmdqueryname=display+bgp+flow+vpnv4+all+route-distinguisher+routing-table"><b><span class="cmdname">display bgp flow</span></b></a> <strong><span>vpnv4</span></strong> { <strong><span>all</span></strong> | <strong><span>route-distinguisher</span></strong> <i><span class="varname">route-distinguisher</span></i> } <strong><span>routing-table</span></strong> [ <i><span class="varname">reindex</span></i> ] command to check information about all BGP VPN Flow Specification routes and BGP VPNv4 Flow Specification routes or the BGP VPN Flow Specification routes and BGP VPNv4 Flow Specification routes with a specified RD.</p>
</li><li><p>Run the <a href="cmdqueryname=display+bgp+flow+vpnv4+all+route-distinguisher+routing-table"><b><span class="cmdname">display bgp flow</span></b></a> <strong><span>vpnv4</span></strong> { <strong><span>all</span></strong> | <strong><span>route-distinguisher</span></strong> <i><span class="varname">route-distinguisher</span></i> } <strong><span>routing-table</span></strong> <strong><span>statistics</span></strong> command to check statistics about all BGP VPN Flow Specification routes and BGP VPNv4 Flow Specification routes or the BGP VPN Flow Specification routes and BGP VPNv4 Flow Specification routes with a specified RD.</p>
</li><li>Run the <a href="cmdqueryname=display+flowspec+rule+slot"><b><span class="cmdname" id="EN-US_TASK_0172372353__en-us_task_0172372344_cmdname75021755191414">display flowspec</span></b></a> <strong><span id="EN-US_TASK_0172372353__en-us_task_0172372344_cmdparmname322314521514">rule</span></strong> <i><span class="varname" id="EN-US_TASK_0172372353__en-us_task_0172372344_varname12472151218155">reindex-value</span></i> <strong><span id="EN-US_TASK_0172372353__en-us_task_0172372344_cmdparmname143651917111514">slot</span></strong> <i><span class="varname" id="EN-US_TASK_0172372353__en-us_task_0172372344_varname033592413157">slot-id</span></i> command to check information about combined rules in the local BGP Flow Specification rule table.</li><li>Run the <a href="cmdqueryname=display+flowspec+rule+statistics+slot"><b><span class="cmdname" id="EN-US_TASK_0172372353__en-us_task_0172372344_cmdname5910711181816">display flowspec</span></b></a> <strong><span id="EN-US_TASK_0172372353__en-us_task_0172372344_cmdparmname162965181181">rule statistics slot</span></strong> <i><span class="varname" id="EN-US_TASK_0172372353__en-us_task_0172372344_varname9665522191819">slot-id</span></i> command to check statistics about the rules for BGP Flow Specification routes to take effect.</li><li>Run the <a href="cmdqueryname=display+flowspec+resource+rule+ipv4+ipv6+slot"><b><span class="cmdname" id="EN-US_TASK_0172372353__en-us_task_0172372344_cmdname1599317291274">display flowspec resource rule</span></b></a> { <strong><span id="EN-US_TASK_0172372353__en-us_task_0172372344_cmdparmname1563703542718">ipv4</span></strong> | <strong><span id="EN-US_TASK_0172372353__en-us_task_0172372344_cmdparmname5358140192714">ipv6</span></strong> } [ <strong><span id="EN-US_TASK_0172372353__en-us_task_0172372344_cmdparmname1515184619272">slot</span></strong> <i><span class="varname" id="EN-US_TASK_0172372353__en-us_task_0172372344_varname057105116271">slot-id</span></i> ] command to check the resource usage information about BGP Flow Specification route rules.</li></ul>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_flowspec_cfg_0000.html">BGP Flow Specification Configuration
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_flowspec_cfg_0018.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_flowspec_cfg_0026.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>