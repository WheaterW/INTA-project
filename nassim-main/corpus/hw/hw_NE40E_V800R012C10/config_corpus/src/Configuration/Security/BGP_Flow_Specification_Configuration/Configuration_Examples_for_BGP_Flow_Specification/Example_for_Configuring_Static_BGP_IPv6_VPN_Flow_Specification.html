
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Static BGP IPv6 VPN Flow Specification">
<meta name="abstract" content="In an IPv6 VPN domain, you can manually configure BGP IPv6 VPN Flow Specification routes to implement static BGP IPv6 VPN Flow Specification for DoS/DDoS attacks whose characteristics can be predicted, ensuring device security in the VPN.">
<meta name="description" content="In an IPv6 VPN domain, you can manually configure BGP IPv6 VPN Flow Specification routes to implement static BGP IPv6 VPN Flow Specification for DoS/DDoS attacks whose characteristics can be predicted, ensuring device security in the VPN.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_flowspec_cfg_0010.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_flowspec_cfg_0024.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_flowspec_cfg_0021.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="z00603461,w00800033,flow-specificationvrp,w00556928,w00606909,l00455378,z00805567">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="BGP Flow Specfication">
<meta name="featuretype" content="Security">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP Flow Specfication">
<meta name="featuretype" content="Security">
<meta name="featurename" content="BGP Flow Specfication">
<meta name="featuretype" content="Security">
<meta name="OWNER" content="h00522387">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00615954">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172372378">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring Static BGP IPv6 VPN Flow Specification</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172372378"></a><a name="EN-US_TASK_0172372378"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Static BGP IPv6 VPN Flow Specification</h1>
<div class="taskbody"><p>In an IPv6 VPN domain, you can manually configure BGP IPv6 VPN Flow Specification routes to implement static BGP IPv6 VPN Flow Specification for DoS/DDoS attacks whose characteristics can be predicted, ensuring device security in the VPN.</p>
<div class="context"><a name="EN-US_TASK_0172372378__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>As shown in <a href="#EN-US_TASK_0172372378__fig_dc_vrp_flowspec_cfg_002501">Figure 1</a>, in the IPv6 VPN, CE1 belongs to AS 100; PE1 belongs to AS 200. CE1 and PE1 are in the same VPN domain. PE1 is the ingress of the VPN domain in AS 200. AS 200 can communicate with AS 100 through PE1.</p>
<p>If an attack source appears in AS 100, attack traffic flows into AS 200 through PE1, which severely affects the VPN performance of AS 200.</p>
<p>Static BGP IPv6 VPN Flow Specification can be configured to resolve this problem. Specifically, you can manually configure a BGP IPv6 Flow Specification route, and establish a BGP IPv6 VPN Flow Specification peer relationship to allow the BGP IPv6 VPN Flow Specification route to be sent to PE1. In this way, the attack traffic is discarded, or its rate is limited.</p>
<div class="fignone" id="EN-US_TASK_0172372378__fig_dc_vrp_flowspec_cfg_002501"><a name="EN-US_TASK_0172372378__fig_dc_vrp_flowspec_cfg_002501"></a><a name="fig_dc_vrp_flowspec_cfg_002501"></a><span class="figcap"><b>Figure 1 </b>Configuring static BGP IPv6 VPN Flow Specification</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interface 1 in this example represents GE<span>0/1/0</span>.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_flowspec_cfg_002501.png" width="NaN" height="NaN"></span><br></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172372378__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure interface IP addresses.</p>
</li><li><p>Create a VPN instance on PE1 and bind the VPN instance to each interface.</p>
</li><li><p>Configure a BGP IPv6 VPN Flow Specification route named FlowSpec1 on PE1 to discard the attack traffic with the source port number being 159.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172372378__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><div class="p">To complete the configuration, you need the following data:<ul><li><p>AS number (100) of CE1 and the AS number (200) of PE1</p>
</li><li><p>VPN instance name: vpna</p>
</li></ul>
</div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172372378__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure IP addresses for interfaces.</span><p><p>For configuration details, see the configuration files.</p>
</p></li><li><span>Create a VPN instance and bind it to each interface.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> ip vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpna]<strong> ipv6-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpna-af-ipv6] <strong>route-distinguisher 2:2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpna-af-ipv6]<strong> vpn-target 2:2 export-extcommunity</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpna-af-ipv6] <strong>vpn-target 2:2 import-extcommunity</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpna-af-ipv6] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-vpn-instance-vpna-af-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-vpn-instance-vpna] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface GigabitEthernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>ip binding vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>ipv6 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>ipv6 address 2001:db8:1::2 64</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
</p></li><li><span>Configure a BGP IPv6 VPN Flow Specification route.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>flow-route FlowSpec1 ipv6 vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-flow-route-ipv6-vpna] <strong>if-match source-port equal 159</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-flow-route-ipv6-vpna] <strong>apply deny</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-flow-route-ipv6-vpna] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-flow-route-ipv6-vpna] <strong>quit</strong></pre>
</p></li><li><span>Establish a BGP IPv6 VPN Flow Specification peer relationship.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong>bgp 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp]<strong> vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-instance-vpna] <strong>peer 2001:db8:1::2 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-instance-vpna] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>ipv6-flow vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-flow-6-vpna] <strong>peer 2001:db8:1::2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-flow-6-vpna] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp-flow-6-vpna] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp] <strong>quit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p># Check the status of the BGP IPv6 VPN Flow Specification peer relationship on PE1. The command output shows that the BGP IPv6 VPN Flow Specification peer relationship has been successfully established.</p>
<pre class="screen">&lt;PE1&gt; <strong>display bgp flow vpnv6 vpn-instance vpna peer</strong></pre>
<pre class="screen"> 
 BGP local router ID : 0.0.0.0
 Local AS number : 200
 Total number of peers : 1                 Peers in established state : 0

  VPN-Instance vpna, Router ID 0.0.0.0:
  Peer            V          AS  MsgRcvd  MsgSent  OutQ  Up/Down       State  PrefRcv
  2001:DB8:1::1   4         200        0        0     0 00:06:15        Idle        0</pre>
<p># Check the information about the BGP IPv6 VPN Flow Specification routes received by PE1.</p>
<pre class="screen">&lt;PE1&gt; <strong>display bgp flow vpnv6 vpn-instance vpna routing-table</strong></pre>
<pre class="screen"> 
 BGP Local router ID is 0.0.0.0
 Status codes: * - valid, &gt; - best, d - damped, x - best external, a - add path,
               h - history,  i - internal, s - suppressed, S - Stale
               Origin : i - IGP, e - EGP, ? - incomplete
 RPKI validation codes: V - valid, I - invalid, N - not-found

    
 VPN-Instance vpna, Router ID 0.0.0.0:

 Total Number of Routes: 1
 * &gt;  ReIndex : 1
      Dissemination Rules:
       Src. Port      : eq 159
       MED      : 0                   PrefVal  : 0                   
       LocalPref:                           
       Path/Ogn :  i</pre>
<p># Check the traffic filtering rule carried in each BGP IPv6 VPN Flow Specification route based on the value of <strong>ReIndex</strong> in the preceding command output.</p>
<pre class="screen">&lt;PE1&gt; <strong>display bgp flow vpnv6 vpn-instance vpna routing-table 1</strong></pre>
<pre class="screen"> 
 BGP local router ID : 0.0.0.0
 Local AS number : 200
 ReIndex : 1
 Order   : 0
 Dissemination Rules :
   Src. Port      : eq 159
 
 BGP flow-ipv6 routing table entry information of 1:
 Local : FlowSpec1
 Match action :
   apply deny
 Route Duration: 0d00h07m04s
 AS-path Nil, origin igp, MED 0, pref-val 0, valid, local, best, pre 0
 Not advertised to any peer yet</pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172372378__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>CE1 configuration file</p>
<pre class="screen">#
sysname CE1  
#               
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown  
 ipv6 enable
 ipv6 address 2001:db8:1::1/64
#               
bgp 100         
 peer 2001:db8:1::2 as-number 200
 #
 ipv4-family unicast
  undo synchronization
 #              
 ipv6-family flow
  peer 2001:db8:1::2 enable
#               
return</pre>
</li><li><p>PE1 configuration file</p>
<pre class="screen">#
sysname PE1
#
ip vpn-instance vpna
 ipv6-family
  route-distinguisher 2:2
  apply-label per-instance
  vpn-target 2:2 export-extcommunity
  vpn-target 2:2 import-extcommunity
#               
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown  
 ip binding vpn-instance vpna
 ipv6 enable    
 ipv6 address 2001:db8:1::2/64
#               
bgp 200         
 #
 ipv4-family unicast
  undo synchronization
 #              
 vpn-instance vpna
  peer 2001:db8:1::1 as-number 200
 #              
 ipv6-flow vpn-instance vpna
  peer 2001:db8:1::1 enable
#
flow-route FlowSpec1 ipv6 vpn-instance vpna
 if-match source-port equal 159
 apply deny
#               
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_flowspec_cfg_0010.html">Configuration Examples for BGP Flow Specification
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_flowspec_cfg_0024.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_flowspec_cfg_0021.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>