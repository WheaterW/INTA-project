
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Defining a Traffic Policy for Mirrored Traffic and Applying It Globally">
<meta name="abstract" content="This section describes how to define a traffic policy for mirrored traffic and apply the policy globally. It covers configuring a traffic classifier to define the traffic to be mirrored, specifying a traffic behavior, enabling flow mirroring, defining a traffic policy to associate the traffic classifier with the traffic behavior, and applying the traffic policy globally.">
<meta name="description" content="This section describes how to define a traffic policy for mirrored traffic and apply the policy globally. It covers configuring a traffic classifier to define the traffic to be mirrored, specifying a traffic behavior, enabling flow mirroring, defining a traffic policy to associate the traffic classifier with the traffic behavior, and applying the traffic policy globally.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_portmirror_cfg_0029.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_portmirror_cfg_0030a.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_portmirror_cfg_0032.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="z00603461,w00800033,w00556928,portmirror_ne,w00606909,l00455378,z00805567">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="IPoE">
<meta name="featurename" content="Mirroring">
<meta name="featuretype" content="Security">
<meta name="featuretype" content="User Access">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="IPoE">
<meta name="featurename" content="Mirroring">
<meta name="featuretype" content="Security">
<meta name="featuretype" content="User Access">
<meta name="featurename" content="IPoE">
<meta name="featurename" content="Mirroring">
<meta name="featuretype" content="Security">
<meta name="featuretype" content="User Access">
<meta name="featurename" content="Mirroring">
<meta name="featuretype" content="Security">
<meta name="OWNER" content="l00311327,z00603461,w00800033,qwx715047,w00556928,w00606909">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="w00606909">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172343800">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Defining a Traffic Policy for Mirrored Traffic and Applying It Globally</title>
</head>
<body><a name="EN-US_TASK_0172343800"></a><a name="EN-US_TASK_0172343800"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Defining a Traffic Policy for Mirrored Traffic and Applying It Globally</h1>
<div class="taskbody"><p>This section describes how to define a traffic policy for mirrored traffic and apply the policy globally. It covers configuring a traffic classifier to define the traffic to be mirrored, specifying a traffic behavior, enabling flow mirroring, defining a traffic policy to associate the traffic classifier with the traffic behavior, and applying the traffic policy globally.</p>
<div class="context"><a name="EN-US_TASK_0172343800__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>To analyze user traffic more accurately, configure a traffic policy for mirrored traffic and apply the policy globally. In this way, only the traffic that meets the specified conditions is copied to the observing port for analysis, and irrelevant user traffic is filtered out.</p>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172343800__1.4.2"></a><a name="1.4.2"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure a user control list (UCL).</span><ol type="a"><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=acl"><b><span class="cmdname">acl</span></b></a> <strong><span>name</span></strong> <i><span class="varname">ucl-acl-name</span></i> <strong><span>ucl</span></strong> [ <strong><span>match-order</span></strong> { <strong><span>auto</span></strong> | <strong><span>config</span></strong> } ]</span><p><p>A user ACL is created and its view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=rule"><b><span class="cmdname" id="EN-US_TASK_0172343800__en-us_task_0172336153_cmdname1241862164214207">rule</span></b></a> [ <i><span class="varname" id="EN-US_TASK_0172343800__en-us_task_0172336153_varname1183351952214207">rule-id</span></i> ] [ <strong><span id="EN-US_TASK_0172343800__en-us_task_0172336153_cmdparmname2063906792214207">name</span></strong> <i><span class="varname" id="EN-US_TASK_0172343800__en-us_task_0172336153_varname1180423284214207">rule-name</span></i> ] { <strong><span id="EN-US_TASK_0172343800__en-us_task_0172336153_cmdparmname1789582327214207">deny</span></strong> | <strong><span id="EN-US_TASK_0172343800__en-us_task_0172336153_cmdparmname1690869161214207">permit</span></strong> } <strong><span id="EN-US_TASK_0172343800__en-us_task_0172336153_cmdparmname401687914214207">ip</span></strong> [ <strong><span id="EN-US_TASK_0172343800__en-us_task_0172336153_cmdparmname1459904047214207">destination</span></strong> { <i><span class="varname" id="EN-US_TASK_0172343800__en-us_task_0172336153_varname1733594682214207">destination-ip-address</span></i> { <i><span class="varname" id="EN-US_TASK_0172343800__en-us_task_0172336153_varname533018690214207">destination-wildcard</span></i> | <strong><span id="EN-US_TASK_0172343800__en-us_task_0172336153_cmdparmname2133362944214207">0</span></strong> } | <strong><span id="EN-US_TASK_0172343800__en-us_task_0172336153_cmdparmname1417477994214207">any</span></strong> } | <strong><span id="EN-US_TASK_0172343800__en-us_task_0172336153_cmdparmname774681910214207">source</span></strong> { <i><span class="varname" id="EN-US_TASK_0172343800__en-us_task_0172336153_varname438545652214207">source-ip-address</span></i> { <i><span class="varname" id="EN-US_TASK_0172343800__en-us_task_0172336153_varname1453182680214207">source-wildcard</span></i> | <strong><span id="EN-US_TASK_0172343800__en-us_task_0172336153_cmdparmname278403791214207">0</span></strong> } | <strong><span id="EN-US_TASK_0172343800__en-us_task_0172336153_cmdparmname427078001214207">any</span></strong> } ] <sup id="EN-US_TASK_0172343800__en-us_task_0172336153_sup1176854803214207">*</sup></span></span><p><p>An advanced ACL rule is created in the advanced ACL view.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=return"><b><span class="cmdname">return</span></b></a></span><p><p>Return to the user view.</p>
</p></li></ol>
</li><li><span>Define a traffic classifier.</span><ol type="a"><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=traffic+classifier"><b><span class="cmdname">traffic classifier</span></b></a> <i><span class="varname">classifier-name</span></i> [ <strong><span>operator</span></strong> { <strong><span>and</span></strong> | <strong><span>or</span></strong> } ]</span><p><p>A traffic classifier is defined and its view is displayed.</p>
</p><p><p>The classifier name specified by the <i><span class="varname">classifier-name</span></i> parameter cannot be any predefined classifier name in the system. For details about traffic classifiers, see <em><span class="keyword">HUAWEI NE40E-M2 series</span> <span class="keyword">Universal Service Router</span> Configuration Guide - QoS</em>.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=if-match"><b><span class="cmdname">if-match</span></b></a> [ <strong><span>ipv6</span></strong> ] <strong><span>acl</span></strong> { <i><span class="varname">acl-number</span></i> | <strong><span>name</span></strong> <i><span class="varname">acl-name</span></i> }</span><p><p>An ACL rule is defined.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=return"><b><span class="cmdname">return</span></b></a></span><p><p>Return to the user view.</p>
</p></li></ol>
</li><li><span>Define a traffic behavior and enable flow mirroring.</span><ol type="a"><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=traffic+behavior"><b><span class="cmdname">traffic behavior</span></b></a> <i><span class="varname">behavior-name</span></i></span><p><p>A traffic behavior is defined and its view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=port-mirroring+enable"><b><span class="cmdname">port-mirroring enable</span></b></a></span><p><p>Flow mirroring is enabled.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=port-mirroring+car"><b><span class="cmdname">port-mirroring car</span></b></a> <strong><span>cir</span></strong> <i><span class="varname">cir-value</span></i> [ <strong><span>pir</span></strong> <i><span class="varname">pir-value</span></i> ] [ <strong><span>cbs</span></strong> <i><span class="varname">cbs-value</span></i> [ <strong><span>pbs</span></strong> <i><span class="varname">pbs-value</span></i> ] ]</span><p><p>The CAR function is implemented for mirrored traffic.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=return"><b><span class="cmdname">return</span></b></a></span><p><p>Return to the user view.</p>
</p></li></ol>
</li><li><span>Define a traffic policy to associate the traffic classifier with the traffic behavior.</span><ol type="a"><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=traffic+policy"><b><span class="cmdname">traffic policy</span></b></a> <i><span class="varname">policy-name</span></i></span><p><p>A traffic policy is defined and its view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=classifier"><b><span class="cmdname">classifier</span></b></a> <i><span class="varname">classifier-name</span></i> <strong><span>behavior</span></strong> <i><span class="varname">behavior-name</span></i></span><p><p>A traffic behavior is specified for the specified traffic classifier in the traffic policy.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=return"><b><span class="cmdname">return</span></b></a></span><p><p>Return to the user view.</p>
</p></li></ol>
</li><li><span>Create a service policy of the mirroring type and specify a service group for the service policy.</span><ol type="a"><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=service-policy"><b><span class="cmdname">service-policy</span></b></a> <strong><span>name</span></strong> <i><span class="varname">policy-name</span></i> <strong><span>mirror</span></strong></span><p><p>A service policy of the mirroring type is created and its view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=service-group"><b><span class="cmdname">service-group</span></b></a> <i><span class="varname">service-group-name</span></i> [ <strong><span>inbound</span></strong> | <strong><span>outbound</span></strong> ] [ <strong><span>priority</span></strong> <i><span class="varname">priority</span></i> ]</span><p><p>A service group is specified for the service policy.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=return"><b><span class="cmdname">return</span></b></a></span><p><p>Return to the user view.</p>
</p></li></ol>
</li><li><span>Configure the mapping between the Option 82 attribute and the service policy.</span><ol type="a"><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=mirror"><b><span class="cmdname">mirror</span></b></a> <strong><span>rule</span></strong> [ <i><span class="varname">rule-number-name</span></i> ] <strong><span>service-policy</span></strong> <i><span class="varname">service-policy-name</span></i> [ <strong><span>partial-match</span></strong> ] { <strong><span>circuit-id</span></strong> | <strong><span>remote-id</span></strong> } <i><span class="varname">description-text</span></i></span><p><p>The mapping between the Option 82 attribute and the service policy is configured.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li><span>Apply the traffic policy globally.</span><ol type="a"><li class="substepexpand"><span>Run <a href="cmdqueryname=traffic-policy"><b><span class="cmdname">traffic-policy</span></b></a> <i><span class="varname">policy-name</span></i> { <strong><span>inbound</span></strong> | <strong><span>outbound</span></strong> }</span><p><p>The traffic policy is applied globally, so that user access packets are matched against rules in the traffic policy.</p>
</p><p><p><span>In VS mode, this command is supported only by the admin VS.</span></p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li></ol></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_portmirror_cfg_0029.html">Configuring Flow Mirroring Based on the Option 82 Information of User Packets
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_portmirror_cfg_0030a.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_portmirror_cfg_0032.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>