
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring CMPv2-based Certificate Application">
<meta name="abstract" content="This section provides an example for applying for certificates in CMPv2 mode and configuring automatic certificate update.">
<meta name="description" content="This section provides an example for applying for certificates in CMPv2 mode and configuring automatic certificate update.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_pki_cfg_0013.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_pki_cfg_0017.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_pki_cfg_0014.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="PKI">
<meta name="featuretype" content="Security">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="PKI">
<meta name="featuretype" content="Security">
<meta name="featurename" content="PKI">
<meta name="featuretype" content="Security">
<meta name="featurename" content="PKI">
<meta name="featuretype" content="Security">
<meta name="OWNER" content="z00485179">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="z00485179">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001836667822">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring CMPv2-based Certificate Application</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001836667822"></a><a name="EN-US_TASK_0000001836667822"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring CMPv2-based Certificate Application</h1>
<div class="taskbody"><p>This section provides an example for applying for certificates in CMPv2 mode and configuring automatic certificate update.</p>
<div class="context"><a name="EN-US_TASK_0000001836667822__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0000001836667822__fig1">Figure 1</a>, configure CMPv2-based certificate application from the CA server for authenticating the identity of <span class="keyword">Device</span>A.</p>
<div class="fignone" id="EN-US_TASK_0000001836667822__fig1"><a name="EN-US_TASK_0000001836667822__fig1"></a><a name="fig1"></a><span class="figcap"><b>Figure 1 </b>Network diagram of CMPv2-based certificate application</span><br><span><img class="vsd" src="images/fig_dc_vrp_pki_cfg_001401.png"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001836667822__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Apply for CA and local certificates in offline mode and import them to the local device.</p>
</li><li>Create a public-private key pair.</li><li>Configure entity information.</li><li>Configure a CMP session.</li><li>Configure CMPv2-based certificate application, import generated certificates, and configure automatic update.</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001836667822__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li>Local and CA certificates obtained in offline mode</li><li><p>Entity information, PKI domain, and certificate download mode</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001836667822__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure offline certificate application. For details, see <a href="dc_vrp_pki_cfg_0017.html">Example for Configuring Offline Certificate Application</a>. Obtain the local certificate (for example, <strong>huaweitest.pem</strong>) and CA certificates (for example, <strong>HUAWEITESTCA.pem</strong> and <strong>HUAWEITESTCA2.pem</strong>). Then, import the certificates.</span><p><pre class="screen">&lt;<span class="keyword">Device</span>A&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>pki import-certificate local filename huaweitest.pem</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>pki import-certificate ca filename HUAWEITESTCA.pem</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>pki import-certificate ca filename HUAWEITESTCA2.pem</strong></pre>
</p></li><li><span>Create an RSA key pair used for CMPv2-based certificate application.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>rsa pki local-key-pair cmpsession create</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
</p></li><li><span>Configure entity information used for CMPv2-based certificate application.</span><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>During entity information configuration, you must configure a common entity name. Determine whether to configure other attributes based on the certificate issuing policy on the CA server. If the attributes used to filter certificates do not match the certificate issuing policy, certificate application may fail.</p>
</div></div>
</p><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>pki entity huaweitest</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A--pkientity-huaweitest] <strong>common-name huaweitest</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A--pkientity-huaweitest] <strong>quit</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
</p></li><li><span>Configure a CMP session.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>pki domain huaweitest</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-pki-domain-huaweitest] <strong>pki cmp session huaweitest</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-pki-domain-huaweitest-pki-cmp-session-huaweitest] <strong>cmp request ca-name "/CN=HUAWEITEST-CA2"</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-pki-domain-huaweitest-pki-cmp-session-huaweitest] <strong>cmp request </strong><strong>authentication-cert huaweitest.pem</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-pki-domain-huaweitest-pki-cmp-session-huaweitest] <strong>cmp request</strong>  <strong>entity huaweitest</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-pki-domain-huaweitest-pki-cmp-session-huaweitest] <strong>cmp</strong><strong> request server url http://192.0.2.1:8080//ejbca/publicweb/cmp/HUAWEITEST-CA</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-pki-domain-huaweitest-pki-cmp-session-huaweitest] <strong>cmp</strong><strong> request</strong> <strong>rsa local-key-pair cmpsession regenerate 4096</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-pki-domain-huaweitest-pki-cmp-session-huaweitest] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-pki-domain-huaweitest-pki-cmp-session-huaweitest] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-pki-domain-huaweitest] <strong>quit</strong></pre>
</p></li><li><span>Configure the local device to send an initialization request to apply for certificates.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>pki domain huaweitest</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-pki-domain-huaweitest] <strong>pki cmp </strong><strong>initial-request</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-pki-domain-huaweitest] <strong>quit</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
</p></li><li><span>Delete the original certificate files (local certificate <strong>huaweitest.pem</strong> and CA certificates <strong>HUAWEITESTCA.pem</strong> and <strong>HUAWEITESTCA2.pem</strong>), and import the newly downloaded local certificate <strong>huaweitest_ir.cer</strong> and CA certificates <strong>huaweitest_ca0.cer</strong> and <strong>huaweitest_ca1.cer</strong>.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>pki </strong><strong>delete-certificate local filename huaweitest.pem</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>pki </strong><strong>delete-certificate</strong> <strong>ca filename HUAWEITESTCA.pem</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>pki </strong><strong>delete-certificate</strong> <strong>ca filename HUAWEITESTCA2.pem</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>pki import-certificate local filename huaweitest_ir.cer</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>pki import-certificate ca filename huaweitest_ca0.cer </strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>pki import-certificate ca filename huaweitest_ca1.cer</strong></pre>
</p></li><li><span>Configure the certificates used for identity authentication in the CMP request and enable automatic certificate update.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>pki domain huaweitest</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-pki-domain-huaweitest] <strong>pki cmp session huaweitest</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-pki-domain-huaweitest-pki-cmp-session-huaweitest] <strong>undo cmp request authentication-cert</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-pki-domain-huaweitest-pki-cmp-session-huaweitest] <strong>cmp request authentication-cert huaweitest_ir.cer</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-pki-domain-huaweitest-pki-cmp-session-huaweitest] <strong>certificate auto-update enable</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-pki-domain-huaweitest-pki-cmp-session-huaweitest] <strong>c</strong><strong>ommit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-pki-domain-huaweitest-pki-cmp-session-huaweitest] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-pki-domain-huaweitest] <strong>quit</strong></pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001836667822__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><p><span class="keyword">Device</span>A configuration file</p>
<pre class="screen">#
 sysname <span class="keyword">Device</span>A  
#
pki entity huaweitest
 common-name huaweitest
#
pki domain huaweitest
 pki cmp session huaweitest
  cmp request ca-name "/CN=HUAWEITEST-CA2"
<strong>  </strong>cmp request authentication-cert huaweitest.pem
  cmp request entity huaweitest
  cmp request server url http://192.0.2.1:8080//ejbca/publicweb/cmp/HUAWEITEST-CA
  cmp request rsa local-key-pair cmpsession regenerate 4096
  cmp request authentication-cert huaweitest_ir.cer
  certificate auto-update enable
#
return</pre>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_pki_cfg_0013.html">Configuration Examples for PKI
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_pki_cfg_0017.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_pki_cfg_0014.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>