
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring Dynamic BGP VPN Flow Specification">
<meta name="abstract" content="Dynamic BGP VPN Flow Specification refers to the traffic control mode in which a traffic analysis server generates BGP VPN Flow Specification routes to control traffic in a VPN domain.">
<meta name="description" content="Dynamic BGP VPN Flow Specification refers to the traffic control mode in which a traffic analysis server generates BGP VPN Flow Specification routes to control traffic in a VPN domain.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_flowspec_cfg_0000.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_flowspec_cfg_0006.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_flowspec_cfg_0008.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="z00603461,w00800033,flow-specificationvrp,w00556928,w00606909,l00455378,z00805567">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="BGP Flow Specfication">
<meta name="featuretype" content="Security">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP Flow Specfication">
<meta name="featuretype" content="Security">
<meta name="OWNER" content="h00522387">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00799643">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172372348">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring Dynamic BGP VPN Flow Specification</title>
</head>
<body><a name="EN-US_TASK_0172372348"></a><a name="EN-US_TASK_0172372348"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring Dynamic BGP VPN Flow Specification</h1>
<div class="taskbody"><p>Dynamic BGP VPN Flow Specification refers to the traffic control mode in which a traffic analysis server generates BGP VPN Flow Specification routes to control traffic in a VPN domain.</p>
<div class="context"><a name="EN-US_TASK_0172372348__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Usage Scenario</h4><p>When deploying dynamic BGP VPN Flow Specification, a BGP VPN Flow Specification peer relationship needs to be established between the traffic analysis server and each ingress of the network to transmit BGP VPN Flow Specification routes.</p>
<p>In an AS with multiple ingresses, a Flow RR can be deployed to reduce the number of BGP VPN Flow Specification peer relationships and save network resources.</p>
<p>If you want to filter traffic based on the address prefix but the BGP VPN Flow Specification route carrying the filtering rule cannot pass validation, disable validation of BGP VPN Flow Specification routes received from a specified peer.</p>
</div></div>
<div class="context"><a name="EN-US_TASK_0172372348__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Pre-configuration Tasks</h4><p>Before configuring dynamic BGP VPN Flow Specification, complete the following tasks:</p>
<ul><li><a href="dc_vrp_mpls-l3vpn-v4_cfg_0155.html">Configure a VPN instance</a> and <a href="dc_vrp_mpls-l3vpn-v4_cfg_0156.html">bind interfaces to the VPN instance</a>.</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172372348__1.4.3"></a><a name="1.4.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Establish a BGP VPN Flow Specification peer relationship.</span><ol type="a"><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=vpn-instance"><b><span class="cmdname">vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i></span><p><p>A BGP-VPN instance is created, and the BGP-VPN instance view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer+as-number"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <strong><span>as-number</span></strong> <i><span class="varname">as-number</span></i></span><p><p>The IP address of a peer and the number of the AS where the peer resides are specified.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ipv4-flow+vpn-instance"><b><span class="cmdname">ipv4-flow vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i></span><p><p>The BGP-Flow VPN instance IPv4 address family is enabled, and the BGP-Flow VPN instance IPv4 address family view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <a href="cmdqueryname=enable"><b><span class="cmdname">enable</span></b></a></span><p><p>A BGP VPN Flow Specification peer is specified.</p>
</p><p><p>After the BGP VPN Flow Specification peer relationship is established in the BGP-Flow VPN instance IPv4 address family view, the BGP VPN Flow Specification route generated by the traffic analysis server is imported automatically to the BGP routing table and then sent to the peer.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li><span>(Optional) Configure a Flow RR.</span><p><p>Before configuring a Flow RR, establish a BGP VPN Flow Specification peer relationship between the Flow RR and traffic analysis server, and between the Flow RR and each network ingress.</p>
</p><ol type="a"><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ipv4-flow+vpn-instance"><b><span class="cmdname">ipv4-flow vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i></span><p><p>The BGP-Flow VPN instance IPv4 address family view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <a href="cmdqueryname=reflect-client"><b><span class="cmdname">reflect-client</span></b></a></span><p><p>A Flow RR is configured, and clients are specified for it.</p>
</p><p><p>The <span class="keyword">Router</span> on which the <a href="cmdqueryname=peer+reflect-client"><b><span class="cmdname">peer reflect-client</span></b></a> command is run functions as a Flow RR, and the network ingress and traffic analysis server function as clients.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=undo+reflect+between-clients"><b><span class="cmdname">undo reflect between-clients</span></b></a></span><p><p>Route reflection between clients through the RR is disabled.</p>
</p><p><p>If the clients of a Flow RR are fully meshed, you can run the <a href="cmdqueryname=undo+reflect+between-clients"><b><span class="cmdname">undo reflect between-clients</span></b></a> command on the Flow RR to disable route reflection between clients through the RR, which reduces costs.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=reflector+cluster-id"><b><span class="cmdname">reflector cluster-id</span></b></a> { <i><span class="varname">cluster-id-value</span></i> | <i><span class="varname">cluster-id-ipv4</span></i> }</span><p><p>A cluster ID is configured for the Flow RR.</p>
</p><p><p>If a cluster has multiple flow RRs, run this command to set the same <i><span class="varname">cluster-id</span></i> for these RRs.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The <a href="cmdqueryname=reflector+cluster-id"><b><span class="cmdname">reflector cluster-id</span></b></a> command is applicable only to Flow RRs.</p>
</div></div>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li id="EN-US_TASK_0172372348__step_1"><span id="EN-US_TASK_0172372348__cmd677093214101">(Optional) Configure the device to check the AS_Path attribute during BGP VPN Flow Specification route validation.</span><ol type="a" id="EN-US_TASK_0172372348__substeps159817884214101"><li class="substepexpand" id="EN-US_TASK_0172372348__substep2076790886214101"><span id="EN-US_TASK_0172372348__cmd1572706311214101">Run <a href="cmdqueryname=system-view"><b><span class="cmdname" id="EN-US_TASK_0172372348__cmdname1176259516214101">system-view</span></b></a></span><p><p id="EN-US_TASK_0172372348__p108661928145410">The system view is displayed.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0172372348__substep407189974214101"><span id="EN-US_TASK_0172372348__cmd1758993676214101">Run <a href="cmdqueryname=bgp"><b><span class="cmdname" id="EN-US_TASK_0172372348__cmdname1071287685214101">bgp</span></b></a> <i><span class="varname" id="EN-US_TASK_0172372348__varname1259333012409">as-number</span></i></span><p><p id="EN-US_TASK_0172372348__p4401345125411">The BGP view is displayed.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0172372348__substep2139173541214101"><span id="EN-US_TASK_0172372348__cmd2065969160214101">Run <a href="cmdqueryname=ipv4-flow+vpn-instance"><b><span class="cmdname" id="EN-US_TASK_0172372348__cmdname1456842429214101">ipv4-flow vpn-instance</span></b></a> <i><span class="varname" id="EN-US_TASK_0172372348__varname1964125717456">vpn-instance-name</span></i></span><p><p id="EN-US_TASK_0172372348__p19186115755413">The BGP-Flow VPN instance IPv4 address family view is displayed.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0172372348__substep2055753352214101"><span id="EN-US_TASK_0172372348__cmd182190481214101">Run <a href="cmdqueryname=route+validation-mode+include-as"><b><span class="cmdname" id="EN-US_TASK_0172372348__cmdname1914437765214101">route validation-mode include-as</span></b></a></span><p><p id="EN-US_TASK_0172372348__p165841345511">The device is configured to check the AS_Path attribute during BGP VPN Flow Specification route validation.</p>
</p><p><div class="p" id="EN-US_TASK_0172372348__p550996257214101">BGP Flow Specification route validation is performed in either of the following modes: <ul id="EN-US_TASK_0172372348__en-us_cliref_0172383989_ul1988263785214154"><li id="EN-US_TASK_0172372348__en-us_cliref_0172383989_li1125409925214154">Validation mode 1: After receiving a BGP Flow Specification route with a destination address-based filtering rule, the device checks the validity of the route using the rules described in <a href="#EN-US_TASK_0172372348__en-us_cliref_0172383989_fig_route_validation-mode_include-as01">Figure 1</a>. The route is considered valid only if the validation succeeds.</li><li id="EN-US_TASK_0172372348__en-us_cliref_0172383989_li1499988458214154">Validation mode 2: After receiving a BGP Flow Specification route with a destination address-based filtering rule, the device checks the validity of the route by checking whether the AS_Path attribute of the route carries the AS_Set and AS_Sequence fields. The route is considered valid only if its AS_Path attribute does not carry the AS_Set or AS_Sequence field.</li></ul>
Validation mode 2 is configured using the <a href="cmdqueryname=route+validation-mode+include-as"><b><span class="cmdname" id="EN-US_TASK_0172372348__en-us_cliref_0172383989_cmdname1973107158214154">route validation-mode include-as</span></b></a> command. If this command is configured, the device checks the validity of a BGP Flow Specification route using mode 2 first. <ul id="EN-US_TASK_0172372348__en-us_cliref_0172383989_ul1816591491214154"><li id="EN-US_TASK_0172372348__en-us_cliref_0172383989_li1472822637214154">If the validation succeeds, the BGP Flow Specification route is considered valid, and mode 1 is not used.</li><li id="EN-US_TASK_0172372348__en-us_cliref_0172383989_li357606420214154">If the validation fails, the device checks the validity of the BGP Flow Specification route using mode 1.</li></ul>
If this command is not run, the device uses mode 1 to check the validity of BGP Flow Specification routes.<div class="fignone" id="EN-US_TASK_0172372348__en-us_cliref_0172383989_fig_route_validation-mode_include-as01"><a name="EN-US_TASK_0172372348__en-us_cliref_0172383989_fig_route_validation-mode_include-as01"></a><a name="en-us_cliref_0172383989_fig_route_validation-mode_include-as01"></a><span class="figcap"><b>Figure 1 </b>BGP Flow Specification validation rules</span><br><span><img class="vsd" id="EN-US_TASK_0172372348__en-us_cliref_0172383989_image1739672175214154" src="figure/en-us_image_0000001228544747.png" width="NaN" height="NaN"></span><br></div>
</div>
</p></li><li class="substepexpand" id="EN-US_TASK_0172372348__substep641544273214101"><span id="EN-US_TASK_0172372348__cmd2066688371214101">Run <a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0172372348__cmdname220210180214101">commit</span></b></a></span><p><p id="EN-US_TASK_0172372348__p59141036145514">The configuration is committed.</p>
</p></li></ol>
</li><li><span>(Optional) Disable BGP VPN Flow Specification route validation.</span><ol type="a"><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ipv4-flow+vpn-instance"><b><span class="cmdname">ipv4-flow vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i></span><p><p>The BGP-Flow VPN instance IPv4 address family view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer+validation-disable"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <strong><span>validation-disable</span></strong></span><p><p>The device is disabled from validating BGP VPN Flow Specification routes received from a specified peer.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li><span>(Optional) Allow the device to recurse the BGP VPN IPv6 Flow Specification routes received from a peer to a tunnel.</span><ol type="a"><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <strong><a href="cmdqueryname=tunnel-selector"><b><span class="cmdname">tunnel-selector</span></b></a> </strong><em><i><span class="varname">name</span></i></em><em><i><span class="varname"> matchMode</span></i></em><strong> <strong><span>node</span></strong></strong><em> <i><span class="varname">node</span></i></em></span><p><p>A tunnel selector is created and its view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ipv4-flow+vpn-instance"><b><span class="cmdname">ipv4-flow vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i></span><p><p>The BGP-Flow VPN instance IPv4 address family view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer+redirect+ipv6+recursive-lookup+tunnel+tunnel-selector"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">peerIpv4Addr</span></i> <strong><span>redirect ipv6 recursive-lookup tunnel</span></strong> <strong><span>tunnel-selector</span></strong> <i><span class="varname">tunnel-selector-name</span></i></span><p><p>The device is configured to recurse the BGP VPN IPv4 Flow Specification route received from the specified peer to a tunnel.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li><span>(Optional) Disable the device from validating the next hop of each route that carries the redirection next-hop attribute and is received from a specified EBGP peer.</span><ol type="a"><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ipv4-flow+vpn-instance"><b><span class="cmdname">ipv4-flow vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i></span><p><p>The BGP-Flow VPN instance IPv4 address family view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer+redirect+ip+validation-disable"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <strong><span>redirect ip validation-disable</span></strong></span><p><p>The device is disabled from validating the next hop of each route that carries the redirection next-hop attribute and is received from a specified EBGP peer.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li id="EN-US_TASK_0172372348__step_2"><span id="EN-US_TASK_0172372348__cmd1367276970214101">(Optional) Configure a redirection next-hop attribute ID for BGP VPN Flow Specification routes.</span><p><p id="EN-US_TASK_0172372348__p1431070246214101">The redirection next-hop attribute ID can be 0x010C (defined in a related RFC) or 0x0800 (defined in a related draft). If a Huawei device needs to communicate with a non-Huawei device that does not support the redirection next-hop attribute ID of 0x010C or 0x0800, set the redirection next-hop attribute ID of BGP VPN Flow Specification routes as required. Perform one of the following configurations based on the ID supported by non-Huawei devices:</p>
<ul id="EN-US_TASK_0172372348__ul1796019596214101"><li id="EN-US_TASK_0172372348__li256888489214101"><p id="EN-US_TASK_0172372348__p1082704153214101"><a name="EN-US_TASK_0172372348__li256888489214101"></a><a name="li256888489214101"></a>Set the redirection next-hop attribute ID to 0x010C (defined in a related RFC) for BGP VPN Flow Specification routes.</p>
<ol type="a" id="EN-US_TASK_0172372348__ol1071680774214101"><li id="EN-US_TASK_0172372348__li1304631580214101">Run <a href="cmdqueryname=system-view"><b><span class="cmdname" id="EN-US_TASK_0172372348__cmdname805143676214101">system-view</span></b></a><p id="EN-US_TASK_0172372348__p17371533115818">The system view is displayed.</p>
</li><li id="EN-US_TASK_0172372348__li461131117214101">Run <a href="cmdqueryname=bgp"><b><span class="cmdname" id="EN-US_TASK_0172372348__cmdname374022084214101">bgp</span></b></a> <i><span class="varname" id="EN-US_TASK_0172372348__varname13601203014018">as-number</span></i><p id="EN-US_TASK_0172372348__p0915154913582">The BGP view is displayed.</p>
</li><li id="EN-US_TASK_0172372348__li853672621214101">Run <a href="cmdqueryname=ipv4-flow+vpn-instance"><b><span class="cmdname" id="EN-US_TASK_0172372348__cmdname783229053214101">ipv4-flow vpn-instance</span></b></a> <i><span class="varname" id="EN-US_TASK_0172372348__varname2791957164516">vpn-instance-name</span></i><p id="EN-US_TASK_0172372348__p1699755112220">The BGP-Flow VPN instance IPv4 address family view is displayed.</p>
</li><li id="EN-US_TASK_0172372348__li443284462214101">Run <a href="cmdqueryname=peer+redirect+ip+rfc-compatible"><b><span class="cmdname" id="EN-US_TASK_0172372348__cmdname1395248959214101">peer</span></b></a> <i><span class="varname" id="EN-US_TASK_0172372348__varname445559274214101">ipv4-address</span></i> <strong><span id="EN-US_TASK_0172372348__cmdparmname1691691176214101">redirect ip rfc-compatible</span></strong><p id="EN-US_TASK_0172372348__p1994110917312">The redirection next hop attribute ID of BGP VPN Flow Specification routes is set to 0x010C (defined in a related RFC).</p>
</li><li id="EN-US_TASK_0172372348__li99074301214101">Run <a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0172372348__cmdname892000891214101">commit</span></b></a><p id="EN-US_TASK_0172372348__p1792392619315">The configuration is committed.</p>
</li></ol>
</li><li id="EN-US_TASK_0172372348__li1003440680214101"><p id="EN-US_TASK_0172372348__p638428869214101"><a name="EN-US_TASK_0172372348__li1003440680214101"></a><a name="li1003440680214101"></a>Set the redirection next-hop attribute ID to 0x0800 (defined in a related draft) for BGP VPN Flow Specification routes.</p>
<ol type="a" id="EN-US_TASK_0172372348__ol676464294214101"><li id="EN-US_TASK_0172372348__li2127272654214101">Run <a href="cmdqueryname=system-view"><b><span class="cmdname" id="EN-US_TASK_0172372348__cmdname1470173713214101">system-view</span></b></a><p id="EN-US_TASK_0172372348__p962313471530">The system view is displayed.</p>
</li><li id="EN-US_TASK_0172372348__li897298705214101">Run <a href="cmdqueryname=bgp"><b><span class="cmdname" id="EN-US_TASK_0172372348__cmdname2060354703214101">bgp</span></b></a> <i><span class="varname" id="EN-US_TASK_0172372348__varname6603143017401">as-number</span></i><p id="EN-US_TASK_0172372348__p121231551743">The BGP view is displayed.</p>
</li><li id="EN-US_TASK_0172372348__li576269820214101">Run <a href="cmdqueryname=ipv4-flow+vpn-instance"><b><span class="cmdname" id="EN-US_TASK_0172372348__cmdname1066140901214101">ipv4-flow vpn-instance</span></b></a> <i><span class="varname" id="EN-US_TASK_0172372348__varname128425704515">vpn-instance-name</span></i><p id="EN-US_TASK_0172372348__p83247217414">The BGP-Flow VPN instance IPv4 address family view is displayed.</p>
</li><li id="EN-US_TASK_0172372348__li1112635861214101">Run <a href="cmdqueryname=peer+redirect+ip+draft-compatible"><b><span class="cmdname" id="EN-US_TASK_0172372348__cmdname353706369214101">peer</span></b></a> <i><span class="varname" id="EN-US_TASK_0172372348__varname1955671079214101">ipv4-address</span></i> <strong><span id="EN-US_TASK_0172372348__cmdparmname1622001442214101">redirect ip draft-compatible</span></strong><p id="EN-US_TASK_0172372348__p206505387410">The redirection next-hop attribute ID of BGP VPN Flow Specification routes is set to 0x0800 (defined in a related draft).</p>
</li><li id="EN-US_TASK_0172372348__li758759611214101">Run <a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0172372348__cmdname2068690819214101">commit</span></b></a><p id="EN-US_TASK_0172372348__p1570931514548">The configuration is committed.</p>
</li></ol>
</li></ul>
</p></li><li><span>(Optional) <span>Enable CAR statistics collection and packet loss statistics collection for BGP Flow Specification.</span></span><ol type="a"><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=flowspec+statistic+enable"><b><span class="cmdname">flowspec statistic enable</span></b></a></span><p><p>CAR statistics collection and packet loss statistics collection are enabled for BGP Flow Specification.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li><span>(Optional) Disable BGP Flow Specification on the interface.</span><ol type="a" id="EN-US_TASK_0172372348__en-us_task_0172372345_substeps1763623200214101"><li class="substepexpand" id="EN-US_TASK_0172372348__en-us_task_0172372345_substep1816712982214101"><span id="EN-US_TASK_0172372348__en-us_task_0172372345_cmd572595428214101">Run <a href="cmdqueryname=system-view"><b><span class="cmdname" id="EN-US_TASK_0172372348__en-us_task_0172372345_cmdname214768980214101">system-view</span></b></a></span><p><p id="EN-US_TASK_0172372348__en-us_task_0172372345_p145112487413">The system view is displayed.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0172372348__en-us_task_0172372345_substep21613653214101"><span id="EN-US_TASK_0172372348__en-us_task_0172372345_cmd335929628214101">Run <a href="cmdqueryname=interface"><b><span class="cmdname" id="EN-US_TASK_0172372348__en-us_task_0172372345_cmdname512983692214101">interface</span></b></a> <i><span class="varname" id="EN-US_TASK_0172372348__en-us_task_0172372345_varname20655823164018">interface-type</span></i> <i><span class="varname" id="EN-US_TASK_0172372348__en-us_task_0172372345_varname17655132312405">interface-number</span></i></span><p><p id="EN-US_TASK_0172372348__en-us_task_0172372345_p47444616411">The interface view is displayed.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0172372348__en-us_task_0172372345_substep1387054464214101"><span id="EN-US_TASK_0172372348__en-us_task_0172372345_cmd1289388263214101">Run <a href="cmdqueryname=flowspec+disable+ipv4+ipv6"><b><span class="cmdname" id="EN-US_TASK_0172372348__en-us_task_0172372345_cmdname371040327214101">flowspec disable</span></b></a> [ <strong><span id="EN-US_TASK_0172372348__en-us_task_0172372345_cmdparmname6175123111117">ipv4</span></strong> | <strong><span id="EN-US_TASK_0172372348__en-us_task_0172372345_cmdparmname918112317118">ipv6</span></strong> ]</span><p><p id="EN-US_TASK_0172372348__en-us_task_0172372345_p1516583017294">BGP Flow Specification is disabled on the interface.</p>
</p><p><div class="note" id="EN-US_TASK_0172372348__en-us_task_0172372345_note508989688214101"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0172372348__en-us_task_0172372345_p1162320215214101">This command cannot be configured on Eth-Trunk member interfaces. The configuration on a main interface also takes effect on its sub-interfaces.</p>
<p id="EN-US_TASK_0172372348__en-us_task_0172372345_p833412971216">If BGP Flow Specification does not need to be disabled on a sub-interface, run the <a href="cmdqueryname=flowspec+disable+ipv4+ipv6+sub-port-exclude"><b><span class="cmdname" id="EN-US_TASK_0172372348__en-us_task_0172372345_cmdname123591436201813">flowspec disable</span></b></a> [ <strong><span id="EN-US_TASK_0172372348__en-us_task_0172372345_cmdparmname987442181810">ipv4</span></strong> | <strong><span id="EN-US_TASK_0172372348__en-us_task_0172372345_cmdparmname1913210518186">ipv6</span></strong> ] <strong><span id="EN-US_TASK_0172372348__en-us_task_0172372345_cmdparmname17662165691816">sub-port-exclude</span></strong> command on the main interface to which the sub-interface belongs.</p>
</div></div>
</p></li><li class="substepexpand" id="EN-US_TASK_0172372348__en-us_task_0172372345_substep1178700715214101"><span id="EN-US_TASK_0172372348__en-us_task_0172372345_cmd2033757077214101">Run <a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0172372348__en-us_task_0172372345_cmdname1136214344214101">commit</span></b></a></span><p><p id="EN-US_TASK_0172372348__en-us_task_0172372345_p7953191115413">The configuration is committed.</p>
</p></li></ol>
</li><li><span>(Optional) Disable BGP Flow Specification protection.</span><ol type="a" id="EN-US_TASK_0172372348__en-us_task_0172372344_substeps178887814913"><li class="substepexpand" id="EN-US_TASK_0172372348__en-us_task_0172372344_substep118881485918"><span id="EN-US_TASK_0172372348__en-us_task_0172372344_cmd138883817910">Run <a href="cmdqueryname=system-view"><b><span class="cmdname" id="EN-US_TASK_0172372348__en-us_task_0172372344_cmdname039174221019">system-view</span></b></a></span><p><p id="EN-US_TASK_0172372348__en-us_task_0172372344_p13702181014128">The system view is displayed.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0172372348__en-us_task_0172372344_substep8971201512920"><span id="EN-US_TASK_0172372348__en-us_task_0172372344_cmd097114152918">Run <a href="cmdqueryname=flowspec+protocol-protect+ipv4+ipv6+disable"><b><span class="cmdname" id="EN-US_TASK_0172372348__en-us_task_0172372344_cmdname67791726161015">flowspec protocol-protect</span></b></a> { <strong><span id="EN-US_TASK_0172372348__en-us_task_0172372344_cmdparmname1422011399114">ipv4</span></strong> | <strong><span id="EN-US_TASK_0172372348__en-us_task_0172372344_cmdparmname115531043131114">ipv6</span></strong> } <strong><span id="EN-US_TASK_0172372348__en-us_task_0172372344_cmdparmname78091349181114">disable</span></strong></span><p><p id="EN-US_TASK_0172372348__en-us_task_0172372344_p12278122114127">BGP Flow Specification protection is disabled.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0172372348__en-us_task_0172372344_substep139391326123"><span id="EN-US_TASK_0172372348__en-us_task_0172372344_cmd1693913211215">Run <a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0172372348__en-us_task_0172372344_cmdname4151640101214">commit</span></b></a></span><p><p id="EN-US_TASK_0172372348__en-us_task_0172372344_p1855253571220">The configuration is committed.</p>
</p></li></ol>
</li><li><span>(Optional) Enable the device to follow RFC 5575 when dealing with BGP Flow Specification IPv4 fragmentation rules.</span><ol type="a" id="EN-US_TASK_0172372348__en-us_task_0172372344_substeps36132122442"><li class="substepexpand" id="EN-US_TASK_0172372348__en-us_task_0172372344_substep7613181218445"><span id="EN-US_TASK_0172372348__en-us_task_0172372344_cmd261315126444">Run <a href="cmdqueryname=system-view"><b><span class="cmdname" id="EN-US_TASK_0172372348__en-us_task_0172372344_cmdname139552174414">system-view</span></b></a></span><p><p id="EN-US_TASK_0172372348__en-us_task_0172372344_p194311932266">The system view is displayed.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0172372348__en-us_task_0172372344_substep54471506447"><span id="EN-US_TASK_0172372348__en-us_task_0172372344_cmd104479502441">Run <a href="cmdqueryname=flowspec+ipv4-fragment-rule+switch"><b><span class="cmdname" id="EN-US_TASK_0172372348__en-us_task_0172372344_cmdname191162010458">flowspec ipv4-fragment-rule switch</span></b></a></span><p><p id="EN-US_TASK_0172372348__en-us_task_0172372344_p11474218182617">The device is enabled to follow RFC 5575 when dealing with BGP Flow Specification IPv4 fragmentation rules.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0172372348__en-us_task_0172372344_substep10622154811452"><span id="EN-US_TASK_0172372348__en-us_task_0172372344_cmd862217481459">Run <a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0172372348__en-us_task_0172372344_cmdname19622124824510">commit</span></b></a></span><p><p id="EN-US_TASK_0172372348__en-us_task_0172372344_p6999935132613">The configuration is committed.</p>
</p></li></ol>
</li><li><span>(Optional) Enable the route policy distribution (RPD) capability for a BGP peer to support the BGP Flow Specification routes carrying the RPD attribute and delivered by the controller to forwarders.</span><ol type="a"><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ipv4-flow+vpn-instance"><b><span class="cmdname">ipv4-flow vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i></span><p><p>The BGP-Flow VPN instance IPv4 address family view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <strong><a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> </strong><em><i><span class="varname">ipv4-address</span></i> </em><strong><a href="cmdqueryname=capability-advertise"><b><span class="cmdname">capability-advertise </span></b></a></strong><strong><a href="cmdqueryname=route-policy-distribute"><b><span class="cmdname">route-policy-distribute</span></b></a> </strong><strong><strong><span>receive</span></strong></strong></span><p><p>The RPD capability is enabled for the specified BGP peer.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li><span>(Optional) Enable BGP Flow Specification to match inner packet information about the packets that leave an SRv6 TE Policy or SRv6 BE egress.</span><ol type="a" id="EN-US_TASK_0172372348__en-us_task_0172372344_substeps195639422140"><li class="substepexpand" id="EN-US_TASK_0172372348__en-us_task_0172372344_substep165631942191417"><span id="EN-US_TASK_0172372348__en-us_task_0172372344_cmd756310429148">Run <a href="cmdqueryname=system-view"><b><span class="cmdname" id="EN-US_TASK_0172372348__en-us_task_0172372344_cmdname5413124714141">system-view</span></b></a></span><p><p id="EN-US_TASK_0172372348__en-us_task_0172372344_p1188315171473">The system view is displayed.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0172372348__en-us_task_0172372344_substep92941850101419"><span id="EN-US_TASK_0172372348__en-us_task_0172372344_cmd12941050101412">Run <a href="cmdqueryname=flowspec+match+srv6-inner-ip+enable"><b><span class="cmdname" id="EN-US_TASK_0172372348__en-us_task_0172372344_cmdname655163675120">flowspec match srv6-inner-ip enable</span></b></a></span><p><p id="EN-US_TASK_0172372348__en-us_task_0172372344_p17382527114711">BGP Flow Specification is enabled to match inner packet information about the packets that leave an SRv6 TE Policy or SRv6 BE egress.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0172372348__en-us_task_0172372344_substep12814439157"><span id="EN-US_TASK_0172372348__en-us_task_0172372344_cmd62811943191514">Run <a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0172372348__en-us_task_0172372344_cmdname9864512158">commit</span></b></a></span><p><p id="EN-US_TASK_0172372348__en-us_task_0172372344_p4321538134715">The configuration is committed.</p>
</p></li></ol>
</li></ol></div>
<div class="postreq"><a name="EN-US_TASK_0172372348__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p>After the configuration is complete, verify the configuration.</p>
<ul><li><p>Run the <a href="cmdqueryname=display+bgp+flow+vpnv4+vpn-instance+peer+verbose"><b><span class="cmdname">display bgp flow</span></b></a> <strong><span>vpnv4</span></strong> <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i> <strong><span>peer</span></strong> [ [ <i><span class="varname">ipv4-address</span></i> ] <strong><span>verbose</span></strong> ] command to check information about BGP VPN Flow Specification peers.</p>
</li><li><p>Run the <a href="cmdqueryname=display+bgp+flow+vpnv4+vpn-instance+routing-table"><b><span class="cmdname">display bgp flow</span></b></a> <strong><span>vpnv4</span></strong> <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i> <strong><span>routing-table</span></strong> command to check information about BGP VPN Flow Specification routes.</p>
</li><li><p>Run the <a href="cmdqueryname=display+bgp+flow+vpnv4+vpn-instance+routing-table+peer"><b><span class="cmdname">display bgp flow</span></b></a> <strong><span>vpnv4</span></strong> <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i> <strong><span>routing-table</span></strong> [ <strong><span>peer</span></strong> <i><span class="varname">ipv4-address</span></i> { <strong><span>advertised-routes</span></strong> | <strong><span>received-routes</span></strong> [ <strong><span>active</span></strong> ] } ] <strong><span>statistics</span></strong> command to check statistics about BGP VPN Flow Specification routes.</p>
</li><li>Run the <a href="cmdqueryname=display+flowspec+rule+slot"><b><span class="cmdname" id="EN-US_TASK_0172372348__en-us_task_0172372344_cmdname75021755191414">display flowspec</span></b></a> <strong><span id="EN-US_TASK_0172372348__en-us_task_0172372344_cmdparmname322314521514">rule</span></strong> <i><span class="varname" id="EN-US_TASK_0172372348__en-us_task_0172372344_varname12472151218155">reindex-value</span></i> <strong><span id="EN-US_TASK_0172372348__en-us_task_0172372344_cmdparmname143651917111514">slot</span></strong> <i><span class="varname" id="EN-US_TASK_0172372348__en-us_task_0172372344_varname033592413157">slot-id</span></i> command to check information about combined rules in the local BGP Flow Specification rule table.</li><li>Run the <a href="cmdqueryname=display+flowspec+rule+statistics+slot"><b><span class="cmdname" id="EN-US_TASK_0172372348__en-us_task_0172372344_cmdname5910711181816">display flowspec</span></b></a> <strong><span id="EN-US_TASK_0172372348__en-us_task_0172372344_cmdparmname162965181181">rule statistics slot</span></strong> <i><span class="varname" id="EN-US_TASK_0172372348__en-us_task_0172372344_varname9665522191819">slot-id</span></i> command to check statistics about the rules for BGP Flow Specification routes to take effect.</li><li>Run the <a href="cmdqueryname=display+flowspec+resource+rule+ipv4+ipv6+slot"><b><span class="cmdname" id="EN-US_TASK_0172372348__en-us_task_0172372344_cmdname1599317291274">display flowspec resource rule</span></b></a> { <strong><span id="EN-US_TASK_0172372348__en-us_task_0172372344_cmdparmname1563703542718">ipv4</span></strong> | <strong><span id="EN-US_TASK_0172372348__en-us_task_0172372344_cmdparmname5358140192714">ipv6</span></strong> } [ <strong><span id="EN-US_TASK_0172372348__en-us_task_0172372344_cmdparmname1515184619272">slot</span></strong> <i><span class="varname" id="EN-US_TASK_0172372348__en-us_task_0172372344_varname057105116271">slot-id</span></i> ] command to check the resource usage information about BGP Flow Specification route rules.</li></ul>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_flowspec_cfg_0000.html">BGP Flow Specification Configuration
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_flowspec_cfg_0006.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_flowspec_cfg_0008.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>