
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Attack Defense for the CPU">
<meta name="abstract" content="Deploying attack defense protects the CPU against attacks and ensures normal CPU processing.">
<meta name="description" content="Deploying attack defense protects the CPU against attacks and ensures normal CPU processing.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_sysattack_cfg_0040.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="l00455378,z00805567,sysattack_ne,w00606909,h00522387,w00800033,y00852169">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="Local Attack Defense">
<meta name="featuretype" content="Security">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="Local Attack Defense">
<meta name="featuretype" content="Security">
<meta name="featurename" content="Local Attack Defense">
<meta name="featuretype" content="Security">
<meta name="featurename" content="Local Attack Defense">
<meta name="featuretype" content="Security">
<meta name="OWNER" content="z00485179">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="z00485179">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172372266">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>Example for Configuring Attack Defense for the CPU</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172372266"></a><a name="EN-US_TASK_0172372266"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Attack Defense for the CPU</h1>
<div class="taskbody"><p>Deploying attack defense protects the CPU against attacks and ensures normal CPU processing.</p>
<div class="context"><a name="EN-US_TASK_0172372266__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>As shown in <a href="#EN-US_TASK_0172372266__fig_dc_ne_sysattack_cfg_004301">Figure 1</a>, <span class="keyword">Device</span> A always receives excessive packets and thus the volume of the traffic sent to <span class="keyword">Device</span> A must be restricted.</p>
<div class="fignone" id="EN-US_TASK_0172372266__fig_dc_ne_sysattack_cfg_004301"><a name="EN-US_TASK_0172372266__fig_dc_ne_sysattack_cfg_004301"></a><a name="fig_dc_ne_sysattack_cfg_004301"></a><span class="figcap"><b>Figure 1 </b>Configuring local attack defense</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><ul><li>The configurations in this example are performed on <span class="keyword">Device</span> A, <span class="keyword">Device</span> B, and <span class="keyword">Device</span> C can function as <span class="keyword">Device</span> A, <span class="keyword">Device</span> B, and <span class="keyword">Device</span> C.</li><li>Interfaces 1 and 2 in this example represent GE <span>0/1/0</span> and GE <span>0/2/0</span>, respectively.</li></ul>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_ne_sysattack_cfg_004301.png"></span><br></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172372266__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Notes</h4><p>These functions, however, are disabled in this configuration example.</p>
</div></div>
<div class="context"><a name="EN-US_TASK_0172372266__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>On <span class="keyword">Device</span> A, define a blacklist and limit the rate of sending packets to the CPU by setting the CAR.</p>
</li><li><p>On <span class="keyword">Device</span> B, configure TCP/IP attack defense, application layer association, and attack source tracing.</p>
</li><li><p>On <span class="keyword">Device</span> C, configure management plane protection.</p>
</li></ol>
<h4 class="sectiontitle">Recommended Configuration</h4><ul><li>Collect and classify protocols on the device. The system matches traffic to be sent to the CPU in sequence and checks the TCP/IP attack packets first. If the packets match the blacklist, the system discards the packets.</li><li>Add valid protocol packets and the service packet that needs protection to the whitelist or user-define flow.</li><li>Add the attack, invalid or unknown packets to the blacklist. Minimize the bandwidth for them or directly drop them.</li></ul>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172372266__1.4.4"></a><a name="1.4.4"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>Number of the attack defense policy</p>
</li><li><p>Index of the packet to be sent to the CPU, number of the user-defined flow</p>
</li><li><p>CIR and CBS values of the packet to be sent</p>
</li><li><p>Sampling rate and file name for saving information about attack source tracing</p>
</li><li><p>Slot number of the interface board where board-level management plane protection is to be applied</p>
</li><li><p>Type and number of the interface where interface-level management plane protection is to be applied</p>
</li><li><p>Number of the interface board to which the attack defense policy is to be applied</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172372266__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure an IP address for each interface. The configuration details are not mentioned here.</span></li><li><span>Configure the sending rule for the blacklist on <span class="keyword">Device</span> A.</span><p><pre class="screen">&lt;<span class="keyword">Device</span>A&gt;<strong> system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>acl 2001</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-acl4-basic-2001] <strong>rule deny fragment-type fragment</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-acl4-basic-2001] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-acl4-basic-2001] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A]<strong> cpu-defend policy 4</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-cpu-defend-policy-4] <strong>blacklist acl 2001</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-cpu-defend-policy-4] <strong>car blacklist cir 1000</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-cpu-defend-policy-4] <strong>priority blacklist low</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-cpu-defend-policy-4] <strong>car total-packet 5000</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-cpu-defend-policy-4] <strong>alarm drop-rate blacklist enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-cpu-defend-policy-4] <strong>alarm drop-rate blacklist interval 60 threshold 1000</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-cpu-defend-policy-4] <strong>commit</strong></pre>
</p></li><li><span>On <span class="keyword">Device</span> B, configure the functions such as TCP/IP attack defense and application layer association to defend against attack packets.</span><p><p># Configure attack source tracing.</p>
<pre class="screen">&lt;<span class="keyword">Device</span>B&gt;<strong> system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B]<strong> cpu-defend policy 4</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-cpu-defend-policy-4]<strong> attack-source-trace enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-cpu-defend-policy-4]<strong> attack-source-trace sample-rate 1000</strong></pre>
<p># Configure TCP/IP attack defense.</p>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-cpu-defend-policy-4]<strong> udp-packet-defend enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-cpu-defend-policy-4]<strong> abnormal-packet-defend enable</strong></pre>
<p># Configure application layer association.</p>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-cpu-defend-policy-4]<strong> application-apperceive default-action min-to-cp</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-cpu-defend-policy-4] <strong>commit</strong></pre>
</p></li><li><span>On <span class="keyword">Device</span> C, configure management plane protection.</span><p><p># Configure global management plane protection.</p>
<pre class="screen">&lt;<span class="keyword">Device</span>C&gt;<strong> system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C]<strong> ma-defend global-policy</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-app-sec-global]<strong> protocol bgp permit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-app-sec-global]<strong> enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-app-sec-global]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C-app-sec-global]<strong> quit</strong></pre>
<p># Configure board-level management plane protection.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C]<strong> ma-defend slot-policy 4</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-app-sec-slot-4]<strong> protocol ftp permit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-app-sec-slot-4] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C-app-sec-slot-4]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C]<strong> slot <span>1</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C-slot-<span>1</span>]<strong> ma-defend-slot 4</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-slot-<span>1</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C-slot-<span>1</span>]<strong> quit</strong></pre>
<p># Configure interface-level management plane protection.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C]<strong> ma-defend interface-policy 4</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-app-sec-interface-4]<strong> protocol ospf permit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-app-sec-interface-4]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C-app-sec-interface-4]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C]<strong> interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C-GigabitEthernet<span>0/2/0</span>]<strong> ma-defend-interface 4</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-GigabitEthernet<span>0/2/0</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C-GigabitEthernet<span>0/2/0</span>]<strong> quit</strong></pre>
</p></li><li><span>Apply the attack defense policy.</span><p><p>Apply attack defense policy 4 on interface board <span>1</span> of <span class="keyword">Device</span> A.</p>
<pre class="screen">&lt;<span class="keyword">Device</span>A&gt;<strong> system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>slot <span>1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-slot-<span>1</span>] <strong>cpu-defend-policy 4</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-slot-<span>1</span>] <strong>commit</strong></pre>
<p>Apply attack defense policy 4 on interface board 1 of <span class="keyword">Device</span> B.</p>
<pre class="screen">&lt;<span class="keyword">Device</span>B&gt;<strong> system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>slot <span>1</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-slot-<span>1</span>] <strong>cpu-defend-policy 4</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-slot-<span>1</span>] <strong>commit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p># Run the <a href="cmdqueryname=display+cpu-defend+policy+4"><b><span class="cmdname">display cpu-defend policy 4</span></b></a> command to check the rules configured in attack defense policy 4.</p>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172372266__1.4.6"></a><a name="1.4.6"></a><h4 class="sectiontitle">Configuration example of User Defined Flow</h4><p>The following table lists a configuration planning for user defined flow. You can modify the list or add more items based on the actual network conditions.</p>

<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" frame="border" border="1" rules="all"><caption><b>Table 1 </b>Configuration planning for user defined flow</caption><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="16.900000000000002%" id="mcps1.4.6.3.2.6.1.1" liSelected="liSelected"><p>Class</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="17.59%" id="mcps1.4.6.3.2.6.1.2" liSelected="liSelected"><p>Matched Content</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="9.24%" id="mcps1.4.6.3.2.6.1.3" liSelected="liSelected"><p>Priority</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="28.17%" id="mcps1.4.6.3.2.6.1.4" liSelected="liSelected"><p>Protection Action</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="28.1%" id="mcps1.4.6.3.2.6.1.5" liSelected="liSelected"><p>Remarks</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" rowspan="2" valign="top" width="16.900000000000002%" headers="mcps1.4.6.3.2.6.1.1 "><p>Trusted network segment</p>
</td>
<td class="cellrowborder" rowspan="2" valign="top" width="17.59%" headers="mcps1.4.6.3.2.6.1.2 "><p>Source IP address</p>
</td>
<td class="cellrowborder" rowspan="2" valign="top" width="9.24%" headers="mcps1.4.6.3.2.6.1.3 "><p>High</p>
</td>
<td class="cellrowborder" align="justify" valign="top" width="28.17%" headers="mcps1.4.6.3.2.6.1.4 "><p>Add source IP addresses on the trusted network segment to user-defined list 1.</p>
</td>
<td class="cellrowborder" rowspan="2" valign="top" width="28.1%" headers="mcps1.4.6.3.2.6.1.5 "><p>Use ACL 3330 to filter packets containing source IP addresses on the trusted network segment.</p>
</td>
</tr>
<tr><td class="cellrowborder" align="justify" valign="top" headers="mcps1.4.6.3.2.6.1.4 "><p>Set the rate limit for user-defined list 1 to 1 Mbit/s.</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="7" valign="top" width="16.900000000000002%" headers="mcps1.4.6.3.2.6.1.1 "><p>Routing protocol</p>
</td>
<td class="cellrowborder" rowspan="2" valign="top" width="17.59%" headers="mcps1.4.6.3.2.6.1.2 "><p>BGP</p>
</td>
<td class="cellrowborder" rowspan="2" valign="top" width="9.24%" headers="mcps1.4.6.3.2.6.1.3 "><p>High</p>
</td>
<td class="cellrowborder" align="justify" valign="top" width="28.17%" headers="mcps1.4.6.3.2.6.1.4 "><p>Add BGP packets to user-defined list 2.</p>
</td>
<td class="cellrowborder" rowspan="2" align="justify" valign="top" width="28.1%" headers="mcps1.4.6.3.2.6.1.5 "><p>Use ACL 3331 to filter packets containing the IP address of the BGP peer.</p>
</td>
</tr>
<tr><td class="cellrowborder" align="justify" valign="top" headers="mcps1.4.6.3.2.6.1.4 "><p>Set the rate limit for user-defined list 2 to 1 Mbit/s.</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="2" valign="top" headers="mcps1.4.6.3.2.6.1.2 "><p>LDP</p>
</td>
<td class="cellrowborder" rowspan="2" valign="top" headers="mcps1.4.6.3.2.6.1.3 "><p>High</p>
</td>
<td class="cellrowborder" align="justify" valign="top" headers="mcps1.4.6.3.2.6.1.4 "><p>Add LDP packets to user-defined list 3.</p>
</td>
<td class="cellrowborder" rowspan="2" align="justify" valign="top" headers="mcps1.4.6.3.2.6.1.5 "><p>Use ACL 3332 to filter packets containing the source IP addresses of the LDP peer and directly connected interface.</p>
</td>
</tr>
<tr><td class="cellrowborder" align="justify" valign="top" headers="mcps1.4.6.3.2.6.1.4 "><p>Set the rate limit for user-defined list 3 to 1 Mbit/s.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.6.3.2.6.1.2 "><p>OSPF</p>
</td>
<td class="cellrowborder" rowspan="2" valign="top" headers="mcps1.4.6.3.2.6.1.3 "><p>High</p>
</td>
<td class="cellrowborder" align="justify" valign="top" headers="mcps1.4.6.3.2.6.1.4 "><p>Add OSPF and RIP packets to user-defined list 4.</p>
</td>
<td class="cellrowborder" rowspan="2" valign="top" headers="mcps1.4.6.3.2.6.1.5 "><p>Use ACL 3333 to filter packets containing the source IP address of the OSPF neighbor.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.6.3.2.6.1.2 "><p>RIP</p>
</td>
<td class="cellrowborder" align="justify" valign="top" headers="mcps1.4.6.3.2.6.1.4 "><p>Set the rate limit for user-defined list 4 to 1 Mbit/s.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.6.3.2.6.1.2 "><p>ISIS</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.6.3.2.6.1.3 "><p>NA</p>
</td>
<td class="cellrowborder" align="justify" valign="top" headers="mcps1.4.6.3.2.6.1.4 "><p>NA</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.6.3.2.6.1.5 "><p>No ACL is involved because IS-IS is a Layer 2 protocol. CPU defend policy supports basic ACL and advanced ACL, that is, only supports to filter L3 and L4 protocol.</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="2" valign="top" width="16.900000000000002%" headers="mcps1.4.6.3.2.6.1.1 "><p>Protocol ensuring reliability</p>
<p></p>
</td>
<td class="cellrowborder" rowspan="2" valign="top" width="17.59%" headers="mcps1.4.6.3.2.6.1.2 "><p>VRRP</p>
</td>
<td class="cellrowborder" rowspan="2" valign="top" width="9.24%" headers="mcps1.4.6.3.2.6.1.3 "><p>Medium</p>
</td>
<td class="cellrowborder" align="justify" valign="top" width="28.17%" headers="mcps1.4.6.3.2.6.1.4 "><p>Add VRRP packets to user-defined list 5.</p>
</td>
<td class="cellrowborder" rowspan="2" align="justify" valign="top" width="28.1%" headers="mcps1.4.6.3.2.6.1.5 "><p>Use ACL 3334 to filter VRRP packets.</p>
</td>
</tr>
<tr><td class="cellrowborder" align="justify" valign="top" headers="mcps1.4.6.3.2.6.1.4 "><p>Set the rate limit for user-defined list 5 to 1 Mbit/s.</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="4" valign="top" width="16.900000000000002%" headers="mcps1.4.6.3.2.6.1.1 "><p>Multicast protocol</p>
</td>
<td class="cellrowborder" valign="top" width="17.59%" headers="mcps1.4.6.3.2.6.1.2 "><p>PIM</p>
</td>
<td class="cellrowborder" rowspan="3" valign="top" width="9.24%" headers="mcps1.4.6.3.2.6.1.3 "><p>Medium</p>
</td>
<td class="cellrowborder" rowspan="3" align="justify" valign="top" width="28.17%" headers="mcps1.4.6.3.2.6.1.4 "><p>Add PIM, IGMP, and MSDP packets to user-defined list 6.</p>
<p>Set the rate limit for user-defined list 6 to 1 Mbit/s.</p>
</td>
<td class="cellrowborder" rowspan="3" align="justify" valign="top" width="28.1%" headers="mcps1.4.6.3.2.6.1.5 "><p>Use ACL 3335 to filter PIM, IGMP, and MSDP packets.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.6.3.2.6.1.2 "><p>IGMP</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.6.3.2.6.1.2 "><p>MSDP</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.6.3.2.6.1.2 "><p>Reserved multicast addresses</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.6.3.2.6.1.3 "><p>Medium</p>
</td>
<td class="cellrowborder" align="justify" valign="top" headers="mcps1.4.6.3.2.6.1.4 "><p>Add reserved multicast addresses to user-defined list 7. Set the rate limit for user-defined list 7 to 1 Mbit/s.</p>
</td>
<td class="cellrowborder" align="justify" valign="top" headers="mcps1.4.6.3.2.6.1.5 "><p>Use ACL 3336 to filter packets containing the following reserved multicast addresses:</p>
<ul><li><p>224.0.0.1</p>
</li><li><p>224.0.0.2</p>
</li><li><p>255.255.255.255</p>
</li></ul>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="6" valign="top" width="16.900000000000002%" headers="mcps1.4.6.3.2.6.1.1 "><p>Access protocol</p>
</td>
<td class="cellrowborder" valign="top" width="17.59%" headers="mcps1.4.6.3.2.6.1.2 "><p>SSH</p>
</td>
<td class="cellrowborder" rowspan="2" valign="top" width="9.24%" headers="mcps1.4.6.3.2.6.1.3 "><p>Medium</p>
</td>
<td class="cellrowborder" align="justify" valign="top" width="28.17%" headers="mcps1.4.6.3.2.6.1.4 "><p>Add Telnet packets to user-defined list 8.</p>
</td>
<td class="cellrowborder" rowspan="2" align="justify" valign="top" width="28.1%" headers="mcps1.4.6.3.2.6.1.5 "><p>Use ACL 3337 to filter Telnet packets.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.6.3.2.6.1.2 "><p>TELNET</p>
</td>
<td class="cellrowborder" align="justify" valign="top" headers="mcps1.4.6.3.2.6.1.4 "><p>Set the rate limit for user-defined 8 to 512 kbit/s.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.6.3.2.6.1.2 "><p>FTP</p>
</td>
<td class="cellrowborder" rowspan="2" valign="top" headers="mcps1.4.6.3.2.6.1.3 "><p>Low</p>
</td>
<td class="cellrowborder" align="justify" valign="top" headers="mcps1.4.6.3.2.6.1.4 "><p>Add FTP and TFTP packets to user-defined list 9.</p>
</td>
<td class="cellrowborder" rowspan="2" align="justify" valign="top" headers="mcps1.4.6.3.2.6.1.5 "><p>Use ACL 3338 to filter FTP and TFTP packets.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.6.3.2.6.1.2 "><p>TFTP</p>
</td>
<td class="cellrowborder" align="justify" valign="top" headers="mcps1.4.6.3.2.6.1.4 "><p>Set the rate limit for user-defined 9 to 512 kbit/s.</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="2" valign="top" headers="mcps1.4.6.3.2.6.1.2 "><p>FTP-DATA</p>
</td>
<td class="cellrowborder" rowspan="2" valign="top" headers="mcps1.4.6.3.2.6.1.3 "><p>Low</p>
</td>
<td class="cellrowborder" align="justify" valign="top" headers="mcps1.4.6.3.2.6.1.4 "><p>Add FTP-DATA to user-defined list 10.</p>
</td>
<td class="cellrowborder" rowspan="2" align="justify" valign="top" headers="mcps1.4.6.3.2.6.1.5 "><p>Use ACL 3339 to filter FTP-DATA.</p>
</td>
</tr>
<tr><td class="cellrowborder" align="justify" valign="top" headers="mcps1.4.6.3.2.6.1.4 "><p>Do not set the rate limit for user-defined list 10.</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="2" valign="top" width="16.900000000000002%" headers="mcps1.4.6.3.2.6.1.1 "><p>Network management protocols</p>
</td>
<td class="cellrowborder" rowspan="2" valign="top" width="17.59%" headers="mcps1.4.6.3.2.6.1.2 "><p>SNMP</p>
</td>
<td class="cellrowborder" rowspan="2" valign="top" width="9.24%" headers="mcps1.4.6.3.2.6.1.3 "><p>Low</p>
</td>
<td class="cellrowborder" align="justify" valign="top" width="28.17%" headers="mcps1.4.6.3.2.6.1.4 "><p>Add SNMP packets to user-defined list 11.</p>
</td>
<td class="cellrowborder" rowspan="2" align="justify" valign="top" width="28.1%" headers="mcps1.4.6.3.2.6.1.5 "><p>Use ACL 3340 to filter SNMP packets.</p>
</td>
</tr>
<tr><td class="cellrowborder" align="justify" valign="top" headers="mcps1.4.6.3.2.6.1.4 "><p>Set the rate limit for user-defined list 11 to 1 Mbit/s.</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="2" valign="top" width="16.900000000000002%" headers="mcps1.4.6.3.2.6.1.1 "><p>Service protocol</p>
</td>
<td class="cellrowborder" valign="top" width="17.59%" headers="mcps1.4.6.3.2.6.1.2 "><p>TACACS</p>
</td>
<td class="cellrowborder" rowspan="2" valign="top" width="9.24%" headers="mcps1.4.6.3.2.6.1.3 "><p>Low</p>
</td>
<td class="cellrowborder" align="justify" valign="top" width="28.17%" headers="mcps1.4.6.3.2.6.1.4 "><p>Add TACACS and NTP packets to user-defined list 12.</p>
</td>
<td class="cellrowborder" rowspan="2" align="justify" valign="top" width="28.1%" headers="mcps1.4.6.3.2.6.1.5 "><p>Use ACL 3341 to filter TACACS (including standard TACACS and Huawei TACACS) and NTP packets.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.6.3.2.6.1.2 "><p>NTP</p>
</td>
<td class="cellrowborder" align="justify" valign="top" headers="mcps1.4.6.3.2.6.1.4 "><p>Set the rate limit for user-defined 12 to 512 kbit/s.</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="2" valign="top" width="16.900000000000002%" headers="mcps1.4.6.3.2.6.1.1 "><p>Tool protocol</p>
</td>
<td class="cellrowborder" rowspan="2" valign="top" width="17.59%" headers="mcps1.4.6.3.2.6.1.2 "><p>ICMP</p>
</td>
<td class="cellrowborder" rowspan="2" valign="top" width="9.24%" headers="mcps1.4.6.3.2.6.1.3 "><p>Low</p>
</td>
<td class="cellrowborder" align="justify" valign="top" width="28.17%" headers="mcps1.4.6.3.2.6.1.4 "><p>Add ICMP packets to user-defined list 13.</p>
</td>
<td class="cellrowborder" rowspan="2" align="justify" valign="top" width="28.1%" headers="mcps1.4.6.3.2.6.1.5 "><p>Use ACL 3342 to filter ICMP TTL Exceeded packets, ICMP Port-unreachable packets, ICMP Echo packets, and ICMP Echo Reply packets.</p>
</td>
</tr>
<tr><td class="cellrowborder" align="justify" valign="top" headers="mcps1.4.6.3.2.6.1.4 "><p>Set the rate limit for user-defined list 13 to 1 Mbit/s.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="16.900000000000002%" headers="mcps1.4.6.3.2.6.1.1 "><p>Other</p>
</td>
<td class="cellrowborder" valign="top" width="17.59%" headers="mcps1.4.6.3.2.6.1.2 "><p>Unknown or attack packets</p>
</td>
<td class="cellrowborder" valign="top" width="9.24%" headers="mcps1.4.6.3.2.6.1.3 "><p>Low</p>
</td>
<td class="cellrowborder" align="justify" valign="top" width="28.17%" headers="mcps1.4.6.3.2.6.1.4 "><p>Reserve 256 KB best-effort bandwidth in the blacklist.</p>
</td>
<td class="cellrowborder" align="justify" valign="top" width="28.1%" headers="mcps1.4.6.3.2.6.1.5 "><p>Use ACL 3360 to filter unknown and attack packets.</p>
</td>
</tr>
</tbody>
</table>
</div>
<div class="notice"><span class="noticetitle"><img src="../../../../public_sys-resources/notice_3.0-en-us.png"> </span><div class="noticebody"><p>This document just introduces a configuration example. The solution and data of your actual network conditions, such as the running protocols, the IP addresses of the protocols, may be different from this example. Please check and keep them consistent with your network.</p>
<p>If your network needs more configurations, such as more BGP peer, OSPF peer, modify or add the rules in the relative ACL.</p>
</div></div>

<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" frame="border" border="1" rules="all"><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="100%" id="mcps1.4.6.5.1.2.1.1" liSelected="liSelected"><p>Configuration example of User Defined Flow</p>
</th>
</tr>
</thead>
<tbody><tr valign="top"><td class="cellrowborder" valign="top" width="100%" headers="mcps1.4.6.5.1.2.1.1 "><p><strong>1. Add the source IP addresses on the trusted network segment to ACL 3330</strong>.</p>
</td>
</tr>
<tr valign="top"><td class="cellrowborder" valign="top" width="100%" headers="mcps1.4.6.5.1.2.1.1 "><p>Source IP addresses on the trusted network segment indicate the IP addresses allowed to access the device</p>
<p>Example:</p>
<pre class="screen">acl number 3330
  rule permit ip source 10.1.1.0 0.0.0.255
  rule permit ip source 10.1.2.0 0.0.0.255
 ...
</pre>
<p>If there are new trusted network segments, add them to ACL 3330. For example, if the network maintenance engineer needs to telnet to the device to troubleshoot, the source IP address needs to be added to this ACL. It is allowed to temporally add rule permit ip instead for an urgency case. Delete the temporal command after the troubleshooting finished.</p>
<pre class="screen">acl number 3330
  rule permit ip source 10.1.1.0 0.0.0.255
  ...
  <strong>rule permit ip</strong></pre>
</td>
</tr>
<tr valign="top"><td class="cellrowborder" valign="top" width="100%" headers="mcps1.4.6.5.1.2.1.1 "><p><strong>2. Add BGP protocol to ACL 3331.</strong></p>
</td>
</tr>
<tr valign="top"><td class="cellrowborder" valign="top" width="100%" headers="mcps1.4.6.5.1.2.1.1 "><p>TCP session in BGP is established based on peer IP addresses. Therefore, add the peer IP address to the ACL. The peer IP address can be obtained from the following commands:</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>display bgp peer</strong>
 BGP local router ID : 1.1.1.33
 Local AS number : 100
 Total number of peers : 1                 Peers in established state : 1
  Peer            V    AS  MsgRcvd  MsgSent  OutQ  Up/Down       State PrefRcv
  10.1.1.31       4   100        3        3     0 00:01:16 Established       0
  10.1.1.32       4   100        3        3     0 00:05:20 Established       0
</pre>
<p></p>
<p>In the preceding information, the device has two BGP peers and the IP addresses of the BGP peers are 10.1.1.31 and 10.1.1.32. So the ACL rule is configured as follows.</p>
<p></p>
<p>Precise configuration based on source IP address and port number:</p>
<pre class="screen">acl number 3331
 rule permit tcp source 10.1.1.31 0 destination-port eq bgp
 rule permit tcp source 10.1.1.31 0 source-port eq bgp
 rule permit tcp source 10.1.1.32 0 destination-port eq bgp
 rule permit tcp source 10.1.1.32 0 source-port eq bgp
</pre>
<p>Simplified configuration based only on port-number:</p>
<pre class="screen">acl number 3331
 rule permit tcp destination-port eq bgp
 rule permit tcp source-port eq bgp
</pre>
<div class="note"><span class="notetitle"> NOTE: </span><div class="notebody"><p>If there are more BGP peers, add a rule for each peer for precise configuration.</p>
<p>Simplified configuration has less security.</p>
</div></div>
</td>
</tr>
<tr valign="top"><td class="cellrowborder" valign="top" width="100%" headers="mcps1.4.6.5.1.2.1.1 "><p><strong>3. Add LDP protocol to ACL 3332</strong>.</p>
</td>
</tr>
<tr valign="top"><td class="cellrowborder" valign="top" width="100%" headers="mcps1.4.6.5.1.2.1.1 "><p>LDP protocol uses TCP to set up session and UDP to discover peers and maintain peer relationships. This process involves not only the peer IP address, but also the IP address of the directly connected interface. These IP addresses need to be added to ACL.</p>
<ol><li><p>Collect the transport address of LDP Peer.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>display mpls ldp peer</strong>
 LDP Peer Information in Public network
 A '*' before a peer means the peer is being deleted.
 --------------------------------------------------------------------
 <strong>PeerID</strong>                 <strong>TransportAddress</strong>   DiscoverySource
 --------------------------------------------------------------------
 <strong>10.5.5.9:0</strong>                <strong>10.5.5.9</strong>              Remote Peer : 54
                                           GigabitEthernet<span>0/1/0</span>
---------------------------------------------------------------------
</pre>
<p>Get the UDP source IP addresses used to discover adjacency peers and maintain peer relationships.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>display mpls ldp adjacency peer 5.5.5.9 verbose</strong>
 LDP Adjacency Information
 ---------------------------------------------------------------------
                           LDP Peer ID : 10.5.5.9
                      VPNInstance name : -
                            CreateDate : 2010-09-14
                            CreateTime : 09:19:02
                         Adjacency Age : 0000:01:24
                         AdjacencyType : Remote Adjacency
                      Discovery-Source : -
                    UDP Source Address : 10.5.5.9
                         UDP Socket ID : 216
                          Sequence No. : 0
   Configuration Hello Hold Timer(sec) : 45
                    Hello Message Rcvd : 340
             Adjacency Deletion Status : No
 ---------------------------------------------------------------------
                            LDP Peer ID : 5.5.5.9
                      VPNInstance name : -
                            CreateDate : 2010-09-14
                            CreateTime : 09:17:55
                         Adjacency Age : 0000:01:25
                         AdjacencyType : Local Adjacency
                      Discovery-Source : GigabitEthernet<span>0/1/0</span>
                    UDP Source Address : 10.4.5.5
                         UDP Socket ID : 149
                          Sequence No. : 0
   Configuration Hello Hold Timer(sec) : 256
                    Hello Message Rcvd : 5129
             Adjacency Deletion Status : No
 ----------------------------------------------------------------------
</pre>
</li><li><p>Add the UDP source IP addresses to ACL.</p>
<p>LDP discovers the adjacency peers by sending UDP packets actively. The destination port of the UDP is 646. After the LDP session is established, LDP sends UDP packet to maintain the peer relationships. Add the UDP source IP addresses to ACL according to the following commands.</p>
<pre class="screen">acl number 3332
 rule permit udp source 10.5.5.9 0 destination-port eq 646
 rule permit udp source 10.4.5.5 0 destination-port eq 646
</pre>
</li><li><p>Add the LDP transport address to ACL.</p>
<p>LDP sent TCP packets to set up session. After the LDP session is established, LDP sends TCP Keepalive messages. The source address of the TCP is TransportAddress. The device can be LDP active end or passive end, so both the source port and destination port need to be added to ACL.</p>
<pre class="screen">acl number 3332
 rule permit tcp source 10.5.5.9 0 destination-port eq 646
 rule permit tcp source 10.5.5.9 0 source-port eq 646
</pre>
</li></ol>
<p>Configuration summary:</p>
<ul><li><p>Precise configuration based on source IP address and port number:</p>
<pre class="screen">acl number 3332
 rule permit udp source 10.5.5.9 0 destination-port eq 646
 rule permit udp source 10.4.5.5 0 destination-port eq 646
 rule permit tcp source 10.5.5.9 0 destination-port eq 646
 rule permit tcp source 10.5.5.9 0 source-port eq 646
</pre>
</li><li><p>Simplified configuration based only on port number:</p>
<pre class="screen">acl number 3332
 rule permit udp destination-port eq 646
 rule permit tcp destination-port eq 646
 rule permit tcp source-port eq 646
</pre>
</li></ul>
<div class="note"><span class="notetitle"> NOTE: </span><div class="notebody"><ul><li>If there are more LDP peers, add a rule for each peer for precise configuration.</li><li>Simplified configuration has less security.</li></ul>
</div></div>
</td>
</tr>
<tr valign="top"><td class="cellrowborder" valign="top" width="100%" headers="mcps1.4.6.5.1.2.1.1 "><p><strong>4. Add OSPF or RIP protocol to ACL 3333</strong>.</p>
</td>
</tr>
<tr valign="top"><td class="cellrowborder" valign="top" width="100%" headers="mcps1.4.6.5.1.2.1.1 "><p>OSPF sets up neighbor based on interface IP address, so the interface IP address needs to be added to ACL.</p>
<ol><li><p>Collect the information about OSPF peer.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>display ospf peer</strong>
          OSPF Process 100 with Router ID 1.1.1.33
                  Neighbors
 Area 0.0.0.0 interface 10.55.1.2(GigabitEthernet<span>0/1/1</span>.1)'s neighbors
 Router ID: 10.110.200.32    Address: <strong>10.55.1.1</strong>
   State: Full  Mode:Nbr is  Master  Priority: 1
   DR: 5.5.5.1  BDR: 5.5.5.2  MTU: 0
   Dead timer due in 42  sec
   Neighbor is up for 00:23:41
   Authentication Sequence: [ 0 ]

          OSPF Process 200 with Router ID 1.1.1.33
                  Neighbors
 Area 0.0.0.0 interface 10.66.1.2(GigabitEthernet<span>0/1/1</span>.2)'s neighbors
 Router ID: 10.110.200.32    Address: <strong>10.66.1.1</strong>
   State: Full  Mode:Nbr is  Master  Priority: 1
   DR: 6.6.6.1  BDR: None   MTU: 0
   Dead timer due in 31  sec
   Neighbor is up for 00:00:05
   Authentication Sequence: [ 0 ]
</pre>
</li><li><p>The 10.55.1.1 and 10.66.1.1 are the neighbor IP addresses. So, add these IP addresses to ACL.</p>
<p>Precise configuration based on source IP address:</p>
<pre class="screen">acl number 3333
 rule permit ospf source 10.55.1.1 0
 rule permit ospf source 10.66.1.1 0
</pre>
<p>Simplified configuration based only on port number:</p>
<pre class="screen">acl number 3333
 rule 5 permit ospf
</pre>
</li></ol>
<div class="note"><span class="notetitle"> NOTE: </span><div class="notebody"><ul><li>If there are more OSPF peers, add a rule for each peer for precise configuration.</li><li>Simplified configuration has less security.</li><li>The ACL configuration for RIP protocol is the same as OSPF.</li></ul>
</div></div>
</td>
</tr>
<tr valign="top"><td class="cellrowborder" valign="top" width="100%" headers="mcps1.4.6.5.1.2.1.1 "><p><strong>5. Add VRRP protocol to ACL 3334</strong>.</p>
</td>
</tr>
<tr valign="top"><td class="cellrowborder" valign="top" width="100%" headers="mcps1.4.6.5.1.2.1.1 "><p>VRRP is based on IP and its protocol ID is 112. VRRP peer sends packets with the peer virtual IP address. So, add the peer virtual IP address and the protocol ID to ACL.</p>
<ol><li><p>Collect information about VRRP peer.</p>
<p>Get the peer virtual IP address from the configuration of the VRRP.</p>
</li><li><p>Precise configuration based on source IP address:</p>
<pre class="screen">acl number 3334
 rule permit 112 source 10.55.1.100 0
</pre>
<p>Simplified configuration based only on port number:</p>
<pre class="screen">acl number 3334
 rule 5 permit 112
</pre>
</li></ol>
<div class="note"><span class="notetitle"> NOTE: </span><div class="notebody"><ul><li>If there are more VRRP peers, add a rule for each peer virtual IP address for precise configuration.</li><li>Simplified configuration has less security.</li></ul>
</div></div>
</td>
</tr>
<tr valign="top"><td class="cellrowborder" valign="top" width="100%" headers="mcps1.4.6.5.1.2.1.1 "><p><strong>6. Add multicast protocol to ACL 3335</strong>.</p>
</td>
</tr>
<tr valign="top"><td class="cellrowborder" valign="top" width="100%" headers="mcps1.4.6.5.1.2.1.1 "><p>Multicast protocols include PIM (protocol number 103), IGMP (protocol number 2), and MSDP (protocol number 639).</p>
<pre class="screen">acl number 3335
 rule permit 103
 rule permit igmp
 rule permit udp destination-port eq 639
 rule permit udp source-port eq 639
 rule permit tcp destination-port eq 639
 rule permit tcp source-port eq 639
</pre>
</td>
</tr>
<tr valign="top"><td class="cellrowborder" valign="top" width="100%" headers="mcps1.4.6.5.1.2.1.1 "><p><strong>7. Add reserved multicast addresses to ACL 3336</strong>.</p>
</td>
</tr>
<tr valign="top"><td class="cellrowborder" valign="top" width="100%" headers="mcps1.4.6.5.1.2.1.1 "><p>The reserved multicast addresses are 224.0.0.0/24 and 255.255.255.255/0.</p>
<pre class="screen">acl number 3336
 rule permit ip destination 224.0.0.0 0.0.0.255
 rule permit ip destination 255.255.255.255 0
</pre>
</td>
</tr>
<tr valign="top"><td class="cellrowborder" valign="top" width="100%" headers="mcps1.4.6.5.1.2.1.1 "><p><strong>8. Add Telnet and SSH protocols to ACL 3337</strong>.</p>
</td>
</tr>
<tr valign="top"><td class="cellrowborder" valign="top" width="100%" headers="mcps1.4.6.5.1.2.1.1 "><p>Telnet and SSH are TCP-based protocols used for normal login or console login. The two protocols are very important and are therefore added to an independent ACL for protection. Both source port and destination port need to be specified. The port number of SSH is 22.</p>
<p>Precise configuration based on source IP address and port number:</p>
<pre class="screen">acl number 3337
 rule permit tcp source 10.97.3.0 0.0.0.255 source-port eq telnet
 rule permit tcp source 10.97.3.0 0.0.0.255 destination-port eq telnet
 rule permit tcp source 10.97.3.0 0.0.0.255 source-port eq 22
 rule permit tcp source 10.97.3.0 0.0.0.255 destination-port eq 22
</pre>
<p>Simplified configuration based only on port number:</p>
<pre class="screen">acl number 3337
 rule permit tcp source-port eq telnet
 rule permit tcp destination-port eq telnet
 rule permit tcp source-port eq 22
 rule permit tcp destination-port eq 22
</pre>
<div class="note"><span class="notetitle"> NOTE: </span><div class="notebody"><ul><li>Simplified configuration has less security.</li><li>Make sure the source address of Telnet and SSH be correct.</li></ul>
</div></div>
</td>
</tr>
<tr valign="top"><td class="cellrowborder" valign="top" width="100%" headers="mcps1.4.6.5.1.2.1.1 "><p><strong>9. Add FTP and TFTP protocols to ACL 3338</strong>.</p>
</td>
</tr>
<tr valign="top"><td class="cellrowborder" valign="top" width="100%" headers="mcps1.4.6.5.1.2.1.1 "><p>FTP is TCP-based protocol, and TFTP is UDP-based protocol. Each source IP address of the FTP/TFTP user needs three rules, as shown in the following commands.</p>
<p>Precise configuration based on source IP address and port number:</p>
<pre class="screen">acl number 3338  
 rule permit udp source 10.97.3.0 0.0.0.255 destination-port eq tftp
 rule permit tcp source 10.97.3.0 0.0.0.255 source-port eq ftp
 rule permit tcp source 10.97.3.0 0.0.0.255 destination-port eq ftp
</pre>
<p>Simplified configuration based only on port number:</p>
<pre class="screen">acl number 3338
 rule permit udp destination-port eq tftp
 rule permit tcp source-port eq ftp
 rule permit tcp destination-port eq ftp
</pre>
<div class="note"><span class="notetitle"> NOTE: </span><div class="notebody"><p>Inaccurate configuration has less security.</p>
</div></div>
</td>
</tr>
<tr valign="top"><td class="cellrowborder" valign="top" width="100%" headers="mcps1.4.6.5.1.2.1.1 "><p><strong>10. Add FTP-DATA protocol to ACL 3339</strong>.</p>
</td>
</tr>
<tr valign="top"><td class="cellrowborder" valign="top" width="100%" headers="mcps1.4.6.5.1.2.1.1 "><p>FTP-DATA is used to transmit data. When the device gets files from remote endpoint, the data is sent to CPU. The transmission rate must be ensured, that is, the bandwidth for the FTP-DATA cannot be limit. Therefore, add FTP-DATA to an independent ACL for protection.</p>
<p>Precise configuration based on source IP address and port number:</p>
<pre class="screen">acl number 3339
 rule permit tcp source 10.97.3.0 0.0.0.255 source-port eq ftp-data
 rule permit tcp source 10.97.3.0 0.0.0.255 destination-port eq ftp-data
</pre>
<p>Simplified configuration based only on port number:</p>
<pre class="screen">acl number 3339
 rule permit tcp source-port eq ftp
 rule permit tcp destination-port eq ftp
</pre>
<div class="note"><span class="notetitle"> NOTE: </span><div class="notebody"><p>Simplified configuration has less security.</p>
</div></div>
</td>
</tr>
<tr valign="top"><td class="cellrowborder" valign="top" width="100%" headers="mcps1.4.6.5.1.2.1.1 "><p><strong>11. Add SNMP protocol to ACL 3340</strong>.</p>
</td>
</tr>
<tr valign="top"><td class="cellrowborder" valign="top" width="100%" headers="mcps1.4.6.5.1.2.1.1 "><p>An NMS is deployed on most live networks. An NMS server sends a large number of UDP request packets to devices, and devices send UDP reply packets through SNMP ports. As a large number of packets need to be exchanged, these devices need to be added to an independent ACL for protection. Configuration example:</p>
<p>Precise configuration based on source IP address and port number:</p>
<pre class="screen">acl number 3340
 rule permit udp source 10.43.48.0 0.0.0.255 destination-port eq snmp
 rule permit udp source 10.97.3.0 0.0.0.255 destination-port eq snmp
</pre>
<p>Simplified configuration based only on port number:</p>
<pre class="screen">acl number 3340
 rule permit udp destination-port eq snmp
</pre>
<div class="note"><span class="notetitle"> NOTE: </span><div class="notebody"><ul><li>The source address segment added to the ACL must be correct. Otherwise, the NMS will fail to manage some devices with source IP addresses not in the ACL.</li><li>If the device is not managed by the NMS, you can use the simplified configuration.</li></ul>
</div></div>
</td>
</tr>
<tr valign="top"><td class="cellrowborder" valign="top" width="100%" headers="mcps1.4.6.5.1.2.1.1 "><p><strong>12. Add TACACS and NTP protocol to ACL 3341</strong>.</p>
</td>
</tr>
<tr valign="top"><td class="cellrowborder" valign="top" width="100%" headers="mcps1.4.6.5.1.2.1.1 "><p>TACACS and NTP are service-oriented protocols. The NTP port number is 123. TACACS have two types: Huawei-specific TCP-based TACACS and UDP-based standard TACACS. It is recommended that you add both types to the ACL. Configuration example:</p>
<p>Precise configuration based on source IP address and port number:</p>
<pre class="screen">acl number 3341
 rule permit udp source 10.43.0.0 0.0.255.255 source-port eq 123
 rule permit udp source 10.43.0.0 0.0.255.255 destination-port eq 123
 rule permit tcp source 10.43.53.20 0 source-port eq tacacs
 rule permit tcp source 10.43.49.20 0 destination-port eq tacacs
 rule permit udp source 10.43.53.20 0 source-port eq tacacs-ds
 rule permit udp source 10.43.49.20 0 destination-port eq tacacs-ds
</pre>
<p>Simplified configuration based only on port number:</p>
<pre class="screen">acl number 3341
 rule permit udp source- port eq 123
 rule permit udp destination- port eq 123
 rule permit tcp source-port eq tacacs
 rule permit tcp destination-port eq tacacs
 rule permit udp source-port eq tacacs-ds
 rule permit udp destination-port eq tacacs-ds
</pre>
<div class="note"><span class="notetitle"> NOTE: </span><div class="notebody"><p>Simplified configuration has less security.</p>
</div></div>
</td>
</tr>
<tr valign="top"><td class="cellrowborder" valign="top" width="100%" headers="mcps1.4.6.5.1.2.1.1 "><p><strong>13. Add ICMP Ping-LSP and Tracert to ACL 3342</strong>.</p>
</td>
</tr>
<tr valign="top"><td class="cellrowborder" align="left" valign="top" width="100%" headers="mcps1.4.6.5.1.2.1.1 "><pre class="screen">acl number 3342
 rule permit icmp icmp-type echo
 rule permit icmp icmp-type echo-reply
 rule permit icmp icmp-type ttl-exceeded
 rule permit icmp icmp-type port-unreachable
 rule permit icmp icmp-type Fragmentneed-DFset
 rule permit icmp
 rule permit udp destination-port range 33434 33678     ///ping-lsp
 rule permit udp destination-port eq 3503     ///tracert
</pre>
</td>
</tr>
<tr valign="top"><td class="cellrowborder" valign="top" width="100%" headers="mcps1.4.6.5.1.2.1.1 "><p><strong>14. Add BFD protocol to ACL 3343.</strong></p>
</td>
</tr>
<tr valign="top"><td class="cellrowborder" valign="top" width="100%" headers="mcps1.4.6.5.1.2.1.1 "><p>BFD is UDP-based protocol and its port number is 3784.</p>
<p>Precise configuration based on source IP address and port number:</p>
<pre class="screen">acl number 3343
 rule permit udp source 10.43.0.0 0.0.255.255 destination -port eq 3784
 rule permit udp source 10.43.0.0 0.0.255.255 source -port eq 3784
</pre>
<p>Simplified configuration based only on port number:</p>
<pre class="screen">acl number 3343
 rule permit udp destination-port eq 3784
 rule permit udp source-port eq 3784
</pre>
<div class="note"><span class="notetitle"> NOTE: </span><div class="notebody"><p>Simplified configuration has less security.</p>
</div></div>
</td>
</tr>
</tbody>
</table>
</div>
<h4 class="sectiontitle">Example for configuring the blacklist rule</h4>
<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" frame="border" border="1" rules="all"><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="100%" id="mcps1.4.6.7.1.2.1.1" liSelected="liSelected"><p>Example for configuring the blacklist rule</p>
</th>
</tr>
</thead>
<tbody><tr valign="top"><td class="cellrowborder" valign="top" width="100%" headers="mcps1.4.6.7.1.2.1.1 "><p><strong>Add invalid or unknown protocols to ACL 3360.</strong></p>
</td>
</tr>
<tr valign="top"><td class="cellrowborder" valign="top" width="100%" headers="mcps1.4.6.7.1.2.1.1 "><p>ACL 3330 to ACL 3343 are used to filter normal protocol packets and packets on the trusted network segment. Other packets are considered invalid or unknown. Use ACL 3360 to filter invalid or unknown packets. The configuration is as follows:</p>
<pre class="screen">acl number 3360
 rule permit ip
 rule permit igmp
 rule permit 103     ///PIM protocol
 rule permit ospf
</pre>
<p>Result:</p>
<ul><li>IP packets that do not match the user-defined flow match the rule "rule permit ip".</li><li>IGMP packets that do not match the user-defined flow match the rule "rule permit igmp".</li><li>PIM packets that do not match the user-defined flow match the rule "rule permit 103".</li><li>OSPF packets that do not match the user-defined flow match the rule "rule permit ospf".</li></ul>
</td>
</tr>
<tr valign="top"><td class="cellrowborder" valign="top" width="100%" headers="mcps1.4.6.7.1.2.1.1 "><p>The packets to be sent to the CPU comply with the following match sequence by default: TCPSYN packets, packet fragments, dynamic link protection, management protocol ACL, whitelist, blacklist, and user-defined flow. In the preceding example, packets need to match against the user-defined flow before the blacklist. Therefore, run the command to adjust the match sequence as required.</p>
<pre class="screen">#
cpu-defend policy 10
 process-sequence tcpsyn-flood fragment-flood dynamic-link-protection management-acl whitelist user-defined-flow blacklist
#
</pre>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_sysattack_cfg_0040.html">Configuration Examples for Local Attack Defense
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
</div>
</div>
</body>
</html>