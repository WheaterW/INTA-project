
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring a Mirrored Port">
<meta name="abstract" content="To analyze the traffic sent or received by an interface, you can configure this interface as a mirrored port.">
<meta name="description" content="To analyze the traffic sent or received by an interface, you can configure this interface as a mirrored port.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_portmirror_cfg_0003.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_portmirror_cfg_0005.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_portmirror_cfg_0026.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="z00603461,w00800033,w00556928,portmirror_ne,w00606909,l00455378,z00805567">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="IPoE">
<meta name="featurename" content="Mirroring">
<meta name="featuretype" content="Security">
<meta name="featuretype" content="User Access">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="IPoE">
<meta name="featurename" content="Mirroring">
<meta name="featuretype" content="Security">
<meta name="featuretype" content="User Access">
<meta name="featurename" content="IPoE">
<meta name="featurename" content="Mirroring">
<meta name="featuretype" content="Security">
<meta name="featuretype" content="User Access">
<meta name="featurename" content="Mirroring">
<meta name="featuretype" content="Security">
<meta name="OWNER" content="l00311327,z00603461,w00800033,qwx715047,w00556928,w00606909">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="w00606909">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172343778">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>Configuring a Mirrored Port</title>
</head>
<body><a name="EN-US_TASK_0172343778"></a><a name="EN-US_TASK_0172343778"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring a Mirrored Port</h1>
<div class="taskbody"><p>To analyze the traffic sent or received by an interface, you can configure this interface as a mirrored port.</p>
<div class="context"><a name="EN-US_TASK_0172343778__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><div class="p">Local mirroring can be implemented in both common mode and mirroring instance mode. The characteristics of the two modes are as follows:<ul><li><p>The common mode supports interface-based mirroring, whereas the mirroring instance mode supports board-based mirroring.</p>
</li><li><p>Both modes allow you to limit the rate of mirrored traffic. In common mode, the rate limit needs to be configured on a specified interface. In mirroring instance mode, a shared CAR can be configured for a specified mirroring instance and then applied to different interfaces bound to the mirroring instance. As such, the mirroring instance mode offers simpler configuration and higher forwarding performance.</p>
</li><li><p>The mirroring instance mode supports instance sharing, so that multiple interfaces can share the same mirroring instance. This enables more interfaces to support port mirroring in scenarios with limited mirroring specifications.</p>
</li></ul>
</div>

<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" id="EN-US_TASK_0172343778__portmirror_table_0002" frame="border" border="1" rules="all"><caption><b>Table 1 </b>Interfaces supporting local mirroring</caption><thead align="left"><tr id="EN-US_TASK_0172343778__row141150647214610"><th align="left" class="cellrowborder" valign="top" width="34.4%" id="mcps1.4.1.2.2.4.1.1" liSelected="liSelected"><p id="EN-US_TASK_0172343778__p224352771214610">Interface Type</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="32.6%" id="mcps1.4.1.2.2.4.1.2" liSelected="liSelected"><p id="EN-US_TASK_0172343778__entry1754072174214610p0">Mirrored Port</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="33%" id="mcps1.4.1.2.2.4.1.3" liSelected="liSelected"><p id="EN-US_TASK_0172343778__entry405042012214610p0">Observing Port</p>
</th>
</tr>
</thead>
<tbody><tr id="EN-US_TASK_0172343778__row828503520214610"><td class="cellrowborder" align="left" valign="top" width="34.4%" headers="mcps1.4.1.2.2.4.1.1 "><p id="EN-US_TASK_0172343778__entry1051467040214610p0">Layer 3 Ethernet main interfaces (including Eth-Trunk interfaces)</p>
</td>
<td class="cellrowborder" align="left" valign="top" width="32.6%" headers="mcps1.4.1.2.2.4.1.2 "><p id="EN-US_TASK_0172343778__p1308158408214610">Supported</p>
</td>
<td class="cellrowborder" align="left" valign="top" width="33%" headers="mcps1.4.1.2.2.4.1.3 "><p id="EN-US_TASK_0172343778__p871812642214610">Supported</p>
</td>
</tr>
<tr id="EN-US_TASK_0172343778__row570867435214610"><td class="cellrowborder" valign="top" width="34.4%" headers="mcps1.4.1.2.2.4.1.1 "><p id="EN-US_TASK_0172343778__entry1552335882214610p0">BAS interfaces</p>
</td>
<td class="cellrowborder" valign="top" width="32.6%" headers="mcps1.4.1.2.2.4.1.2 "><p id="EN-US_TASK_0172343778__entry587382048214610p0">Supported</p>
<div class="note" id="EN-US_TASK_0172343778__note835206007214610"><span class="notetitle"> NOTE: </span><div class="notebody"><p id="EN-US_TASK_0172343778__p1354242857214610">A VE interface functioning as a BAS interface only supports local flow mirroring in loopback scenarios.</p>
</div></div>
</td>
<td class="cellrowborder" valign="top" width="33%" headers="mcps1.4.1.2.2.4.1.3 "><p id="EN-US_TASK_0172343778__entry630946391214610p0">Not supported</p>
</td>
</tr>
<tr id="EN-US_TASK_0172343778__row1006684963214610"><td class="cellrowborder" align="left" valign="top" width="34.4%" headers="mcps1.4.1.2.2.4.1.1 "><p id="EN-US_TASK_0172343778__entry837529676214610p0">Ethernet sub-interfaces (including Eth-Trunk sub-interfaces)</p>
</td>
<td class="cellrowborder" align="left" valign="top" width="32.6%" headers="mcps1.4.1.2.2.4.1.2 "><div class="p" id="EN-US_TASK_0172343778__p831513696214610">Supported<div class="note" id="EN-US_TASK_0172343778__note16162896506"><span class="notetitle"> NOTE: </span><div class="notebody"><p id="EN-US_TASK_0172343778__p216211935018">A sub-interface supports the mirroring function even when configured as a dot1q<span>, EVC</span><span>, BAS</span>, dot1q VLAN tag termination, or QinQ VLAN tag termination sub-interface.</p>
</div></div>
</div>
</td>
<td class="cellrowborder" align="left" valign="top" width="33%" headers="mcps1.4.1.2.2.4.1.3 "><p id="EN-US_TASK_0172343778__p865886831214610">Supported</p>
<div class="note" id="EN-US_TASK_0172343778__note1142537733214610"><span class="notetitle"> NOTE: </span><div class="notebody"><p id="EN-US_TASK_0172343778__p1980390704214610">A sub-interface functioning as a <span>BAS, </span>dot1q VLAN tag termination or QinQ VLAN tag termination sub-interface does not support observing port configuration.</p>
<p id="EN-US_TASK_0172343778__p787741972214610">An EVC sub-interface can be configured as an observing port only when it adopts the untag or dot1q encapsulation mode.</p>
<p id="EN-US_TASK_0172343778__p6859154310408">If an Eth-Trunk interface is configured as an observing port, downstream mirroring is performed, and packets are mirrored from their Layer 3 headers, the mirroring starts from the first member interface. Other traffic is mirrored among member interfaces in load balancing mode, which depends on the configured load balancing mode and hash factors.</p>
</div></div>
</td>
</tr>
<tr id="EN-US_TASK_0172343778__row484483757214610"><td class="cellrowborder" align="left" valign="top" width="34.4%" headers="mcps1.4.1.2.2.4.1.1 "><p id="EN-US_TASK_0172343778__entry1690222606214610p0">POS interfaces</p>
</td>
<td class="cellrowborder" align="left" valign="top" width="32.6%" headers="mcps1.4.1.2.2.4.1.2 "><p id="EN-US_TASK_0172343778__p476518561214610">Supported</p>
</td>
<td class="cellrowborder" align="left" valign="top" width="33%" headers="mcps1.4.1.2.2.4.1.3 "><p id="EN-US_TASK_0172343778__p1861057038214610">Supported</p>
</td>
</tr>
<tr id="EN-US_TASK_0172343778__row2138386419214610"><td class="cellrowborder" align="left" valign="top" width="34.4%" headers="mcps1.4.1.2.2.4.1.1 "><p id="EN-US_TASK_0172343778__entry1611999838214610p0">IP-Trunk interfaces</p>
</td>
<td class="cellrowborder" align="left" valign="top" width="32.6%" headers="mcps1.4.1.2.2.4.1.2 "><p id="EN-US_TASK_0172343778__p771545518214610">Supported</p>
</td>
<td class="cellrowborder" align="left" valign="top" width="33%" headers="mcps1.4.1.2.2.4.1.3 "><p id="EN-US_TASK_0172343778__p1322089753214610">Supported</p>
</td>
</tr>
<tr id="EN-US_TASK_0172343778__row1348814041214610"><td class="cellrowborder" align="left" valign="top" width="34.4%" headers="mcps1.4.1.2.2.4.1.1 "><p id="EN-US_TASK_0172343778__entry1814303139214610p0">Serial interfaces</p>
</td>
<td class="cellrowborder" align="left" valign="top" width="32.6%" headers="mcps1.4.1.2.2.4.1.2 "><p id="EN-US_TASK_0172343778__p110548484214610">Supported</p>
</td>
<td class="cellrowborder" align="left" valign="top" width="33%" headers="mcps1.4.1.2.2.4.1.3 "><p id="EN-US_TASK_0172343778__p1654716300214610">Not supported</p>
</td>
</tr>
<tr id="EN-US_TASK_0172343778__row624664097214610"><td class="cellrowborder" align="left" valign="top" width="34.4%" headers="mcps1.4.1.2.2.4.1.1 "><p id="EN-US_TASK_0172343778__entry1399790502214610p0">ATM main interfaces</p>
</td>
<td class="cellrowborder" align="left" valign="top" width="32.6%" headers="mcps1.4.1.2.2.4.1.2 "><p id="EN-US_TASK_0172343778__p875080910214610">Supported</p>
</td>
<td class="cellrowborder" align="left" valign="top" width="33%" headers="mcps1.4.1.2.2.4.1.3 "><p id="EN-US_TASK_0172343778__p1750611602214610">Not supported</p>
</td>
</tr>
<tr id="EN-US_TASK_0172343778__row438131542214610"><td class="cellrowborder" align="left" valign="top" width="34.4%" headers="mcps1.4.1.2.2.4.1.1 "><p id="EN-US_TASK_0172343778__entry2041043067214610p0">ATM sub-interfaces</p>
</td>
<td class="cellrowborder" align="left" valign="top" width="32.6%" headers="mcps1.4.1.2.2.4.1.2 "><p id="EN-US_TASK_0172343778__p2020763949214610">Supported</p>
</td>
<td class="cellrowborder" align="left" valign="top" width="33%" headers="mcps1.4.1.2.2.4.1.3 "><p id="EN-US_TASK_0172343778__p1707250245214610">Not supported</p>
</td>
</tr>
<tr id="EN-US_TASK_0172343778__row205280360214610"><td class="cellrowborder" align="left" valign="top" width="34.4%" headers="mcps1.4.1.2.2.4.1.1 "><p id="EN-US_TASK_0172343778__entry1081543412214610p0">MP-Group interfaces</p>
</td>
<td class="cellrowborder" align="left" valign="top" width="32.6%" headers="mcps1.4.1.2.2.4.1.2 "><p id="EN-US_TASK_0172343778__p1277188980214610">Supported</p>
</td>
<td class="cellrowborder" align="left" valign="top" width="33%" headers="mcps1.4.1.2.2.4.1.3 "><p id="EN-US_TASK_0172343778__p361154422214610">Not supported</p>
</td>
</tr>
</tbody>
</table>
</div>
</div></div>
<div class="steps-unordered"><a name="EN-US_TASK_0172343778__1.4.2"></a><a name="1.4.2"></a><h4 class="sectiontitle">Procedure</h4>
<ul><li><span>Mirroring in common mode</span><ol><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=observe+user-defined-filter"><b><span class="cmdname">observe user-defined-filter</span></b></a> <i><span class="varname">id</span></i> { <strong><span>offset</span></strong> <i><span class="varname">offset-value</span></i> <strong><span>value</span></strong> <i><span class="varname">value</span></i> <i><span class="varname">value-mask</span></i> } &amp;&lt;1-4&gt;</span><p><p>A user-defined any-byte matching rule is configured for mirrored packets.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=interface"><b><span class="cmdname">interface</span></b></a> <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i></span><p><p>The interface view is displayed.</p>
</p></li><li class="substepexpand"><span>According to observation requirements, run the corresponding command for configuration.</span><p><ul><li>Run the <a href="cmdqueryname=port-mirroring"><b><span class="cmdname">port-mirroring</span></b></a><span> { <strong><span>inbound</span></strong><span> [ <strong><span>cpu-packet</span></strong> ]</span> | <strong><span>outbound</span></strong> }<span> [ <strong><span>user-defined-filter</span></strong> <i><span class="varname">user-defined-filter-id</span></i> ]</span></span> command to configure the mirroring function on the interface.<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>If <strong><span>cpu-packet</span></strong> is specified, only the packets sent from the interface to the CPU are mirrored.</p>
</div></div>
</li><li>Run the <a href="cmdqueryname=port-mirroring"><b><span class="cmdname">port-mirroring</span></b></a> { <strong><span>inbound</span></strong> | <strong><span>outbound</span></strong> } <strong><span>vlan</span></strong> <i><span class="varname">vlan-id1</span></i> [ <strong><span>to</span></strong> <i><span class="varname">vlan-id2</span></i> ] command to configure VLAN-based mirroring.</li><li>Run the <a href="cmdqueryname=port-mirroring"><b><span class="cmdname">port-mirroring</span></b></a> { <strong><span>inbound</span></strong> | <strong><span>outbound</span></strong> } <strong><span>pe-vid</span></strong> <i><span class="varname">low-vid</span></i> [ <strong><span>to</span></strong> <i><span class="varname">high-vid</span></i> ] <strong><span>ce-vid</span></strong> <i><span class="varname">ce-vlan-id-begin</span></i> [ <strong><span>to</span></strong> <i><span class="varname">ce-vlan-id-end</span></i> ] command to configure mirroring based on the ranges of inner and outer VLAN IDs.</li></ul>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=port-mirroring+without-linklayer-header"><b><span class="cmdname">port-mirroring without-linklayer-header</span></b></a></span><p><p>The mirrored port is configured to mirror packets from their Layer 3 headers.</p>
</p><p><p>If this command is run on the mirrored port, the <a href="cmdqueryname=port-observing+observe-index"><b><span class="cmdname">port-observing observe-index</span></b></a> <i><span class="varname">observe-index</span></i> <strong><span>without-filter</span></strong> command needs to be run on the corresponding observing port.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li><span>Mirroring in mirroring instance mode</span><ol><li class="substepexpand"><span>To configure mirroring in mirroring instance mode for an EVC Layer 2 sub-interface, perform the following operations:</span><p><ol type="a"><li><p>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></p>
<p>The system view is displayed.</p>
</li><li><p>Run <a href="cmdqueryname=mirror+instance"><b><span class="cmdname">mirror instance</span></b></a> <i><span class="varname">instance-name</span></i> <strong><span>location</span></strong></p>
<p>A mirroring instance is created.</p>
</li><li><p>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></p>
<p>The configuration is committed.</p>
</li><li><p>Run <a href="cmdqueryname=interface"><b><span class="cmdname">interface</span></b></a> <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i><i><span class="varname">.subnum</span></i> <strong><span>mode</span></strong> <strong><span>l2</span></strong></p>
<p>The EVC Layer 2 sub-interface view is displayed.</p>
</li><li><div class="p">According to the traffic encapsulation type of the EVC Layer 2 sub-interface, run the corresponding command to observe the traffic of the sub-interface:<ul><li><p>If the traffic encapsulation type is QinQ, run the <a href="cmdqueryname=port-mirroring+instance"><b><span class="cmdname">port-mirroring instance</span></b></a> <i><span class="varname">instance-name</span></i> { <strong><span>inbound</span></strong> | <strong><span>outbound</span></strong> } <strong><span>pe-vid</span></strong> <i><span class="varname">pe-vlan-id</span></i> <strong><span>ce-vid</span></strong> <i><span class="varname">ce-vlan-id-begin</span></i> [<strong><span> to</span></strong> <i><span class="varname">ce-vlan-id-end</span></i> ] <strong><span>identifier</span></strong> { <strong><span>none</span></strong> | <strong><span>pe-vid</span></strong> | <strong><span>ce-vid</span></strong> | <strong><span>pe-ce-vid</span></strong> } [ <strong><span>group</span></strong> <i><span class="varname">group-name</span></i> ] command.</p>
</li><li><p>If the traffic encapsulation type is dot1q, run the <a href="cmdqueryname=port-mirroring+instance"><b><span class="cmdname">port-mirroring instance</span></b></a> <i><span class="varname">instance-name</span></i> { <strong><span>inbound</span></strong> | <strong><span>outbound</span></strong> } <strong><span>vid</span></strong> <i><span class="varname">vlan-id-begin</span></i> [<strong><span> to</span></strong> <i><span class="varname">vlan-id-end</span></i> ] <strong><span>identifier</span></strong> { <strong><span>none</span></strong> | <strong><span>vid</span></strong> } [ <strong><span>group</span></strong> <i><span class="varname">group-name</span></i> ] command.</p>
</li><li><p>If the traffic encapsulation type is Untag or Default, run the <a href="cmdqueryname=port-mirroring+instance"><b><span class="cmdname">port-mirroring instance</span></b></a> <i><span class="varname">instance-name</span></i> { <strong><span>inbound</span></strong> | <strong><span>outbound</span></strong> } [ <strong><span>group</span></strong> <i><span class="varname">group-name</span></i> ] command.</p>
</li></ul>
</div>
</li><li><p>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></p>
<p>The configuration is committed.</p>
</li></ol>
</p></li><li class="substepexpand"><span>To configure mirroring in mirroring instance mode for a BD, perform the following operations:</span><p><ol type="a"><li><p>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></p>
<p>The system view is displayed.</p>
</li><li><p>Run <a href="cmdqueryname=mirror+instance"><b><span class="cmdname">mirror instance</span></b></a> <i><span class="varname">instance-name</span></i> <strong><span>location</span></strong></p>
<p>A mirroring instance is created.</p>
</li><li><p>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></p>
<p>The configuration is committed.</p>
</li><li><p>Run <a href="cmdqueryname=bridge-domain"><b><span class="cmdname">bridge-domain</span></b></a> <i><span class="varname">bd-id</span></i></p>
<p>The BD view is displayed.</p>
</li><li><p>Run <a href="cmdqueryname=port-mirroring+instance"><b><span class="cmdname">port-mirroring instance</span></b></a> <i><span class="varname">instance-name</span></i> { <strong><span>inbound</span></strong> | <strong><span>outbound</span></strong> } [ <strong><span>group</span></strong> <i><span class="varname">group-name</span></i> ]</p>
<p>The traffic in the BD is observed.</p>
</li><li><p>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></p>
<p>The configuration is committed.</p>
</li></ol>
</p></li></ol>
</li></ul></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_portmirror_cfg_0003.html">Configuring Port Mirroring
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_portmirror_cfg_0005.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_portmirror_cfg_0026.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>