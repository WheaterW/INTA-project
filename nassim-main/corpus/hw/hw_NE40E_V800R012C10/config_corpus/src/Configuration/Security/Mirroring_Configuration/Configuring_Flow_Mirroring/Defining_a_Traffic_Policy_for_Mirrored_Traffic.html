
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Defining a Traffic Policy for Mirrored Traffic">
<meta name="abstract" content="This section describes how to define a traffic policy for mirrored traffic. It covers configuring a traffic classifier to define the traffic to be mirrored, specifying a traffic behavior, enabling flow mirroring, and defining a traffic policy to associate the traffic classifier with the traffic behavior.">
<meta name="description" content="This section describes how to define a traffic policy for mirrored traffic. It covers configuring a traffic classifier to define the traffic to be mirrored, specifying a traffic behavior, enabling flow mirroring, and defining a traffic policy to associate the traffic classifier with the traffic behavior.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_portmirror_cfg_0009.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_portmirror_cfg_0030.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_portmirror_cfg_0016.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="z00603461,w00800033,w00556928,portmirror_ne,w00606909,l00455378,z00805567">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="IPoE">
<meta name="featurename" content="Mirroring">
<meta name="featuretype" content="Security">
<meta name="featuretype" content="User Access">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="IPoE">
<meta name="featurename" content="Mirroring">
<meta name="featuretype" content="Security">
<meta name="featuretype" content="User Access">
<meta name="featurename" content="IPoE">
<meta name="featurename" content="Mirroring">
<meta name="featuretype" content="Security">
<meta name="featuretype" content="User Access">
<meta name="featurename" content="Mirroring">
<meta name="featuretype" content="Security">
<meta name="OWNER" content="l00311327,z00603461,w00800033,qwx715047,w00556928,w00606909">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="w00606909">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172343790">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Defining a Traffic Policy for Mirrored Traffic</title>
</head>
<body><a name="EN-US_TASK_0172343790"></a><a name="EN-US_TASK_0172343790"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Defining a Traffic Policy for Mirrored Traffic</h1>
<div class="taskbody"><p>This section describes how to define a traffic policy for mirrored traffic. It covers configuring a traffic classifier to define the traffic to be mirrored, specifying a traffic behavior, enabling flow mirroring, and defining a traffic policy to associate the traffic classifier with the traffic behavior.</p>
<div class="steps-unordered"><a name="EN-US_TASK_0172343790__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Procedure</h4>
<ul><li><span>Define a traffic classifier.</span><ol><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=traffic+classifier"><b><span class="cmdname">traffic classifier</span></b></a> <i><span class="varname">classifier-name</span></i> [ <strong><span>operator</span></strong> { <strong><span>and</span></strong> | <strong><span>or</span></strong> } ]</span><p><p>A traffic classifier is defined and its view is displayed.</p>
<p>The classifier name specified by the <i><span class="varname">classifier-name</span></i> parameter cannot be any predefined classifier name in the system. For details about traffic classifiers, see <em><span class="keyword">HUAWEI NE40E-M2 series</span> <span class="keyword">Universal Service Router</span> Configuration Guide - QoS</em>.</p>
</p></li><li class="substepexpand"><span>Define a matching rule according to network requirements.</span><p><ul><li>To define a matching rule for multi-field (MF) classification based on the 802.1p values of VLAN packets, run the <a href="cmdqueryname=if-match+8021p"><b><span class="cmdname">if-match 8021p</span></b></a> <em>8021p-value</em> command.</li><li>To define a matching rule for MF classification based on an IPv4 or IPv6 ACL list, run the <a href="cmdqueryname=if-match"><b><span class="cmdname">if-match</span></b></a><span> [ <strong><span>ipv6</span></strong> ]</span> <strong><span>acl</span></strong> { <i><span class="varname">acl-number</span></i> | <strong><span>name</span></strong> <i><span class="varname">acl-name</span></i> } command.</li><li>To define a matching rule for MF classification of all IPv4 or IPv6 packets, run the <a href="cmdqueryname=if-match"><b><span class="cmdname">if-match</span></b></a><span> [ <strong><span>ipv6</span></strong> ]</span> <strong><span>any</span></strong> command.</li><li>To define a matching rule for MF classification based on the destination MAC addresses of packets, run the <a href="cmdqueryname=if-match+destination-mac"><b><span class="cmdname">if-match destination-mac</span></b></a> <i><span class="varname">mac-address</span></i> command.</li><li>To define a matching rule for MF classification based on the destination IP addresses of IPv6 packets, run the <a href="cmdqueryname=if-match+ipv6+destination-address"><b><span class="cmdname">if-match ipv6 destination-address</span></b></a> <i><span class="varname">ipv6-address</span></i> <i><span class="varname">prefix-length</span></i> command.</li><li>To define a matching rule for MF classification based on the source IP addresses of IPv6 packets, run the <a href="cmdqueryname=if-match+ipv6+source-address"><b><span class="cmdname">if-match ipv6 source-address</span></b></a> <i><span class="varname">ipv6-address</span></i> <i><span class="varname">prefix-length</span></i> command.</li><li>To define a matching rule for MF classification based on the DSCP values of IPv4 or IPv6 packets, run the <a href="cmdqueryname=if-match"><b><span class="cmdname">if-match</span></b></a><span> [ <strong><span>ipv6</span></strong> ]</span> <strong><span>dscp</span></strong> <i><span class="varname">dscp-value</span></i> command.</li><li>To define a matching rule for MF classification based on the EXP values of MPLS packets, run the <a href="cmdqueryname=if-match+mpls-exp"><b><span class="cmdname">if-match mpls-exp</span></b></a> <i><span class="varname">exp-value</span></i> command.</li><li>To define a matching rule for MF classification based on the preference values of IP packets, run the <a href="cmdqueryname=if-match+ip-precedence"><b><span class="cmdname">if-match ip-precedence</span></b></a> <i><span class="varname">ip-precedence</span></i> command.</li><li>To define a matching rule for MF classification based on the value of the next IPv6 header, run the <a href="cmdqueryname=if-match+ipv6+next-header"><b><span class="cmdname">if-match ipv6 next-header</span></b></a> <i><span class="varname">header-number</span></i> <a href="cmdqueryname=first-next-header"><b><span class="cmdname">first-next-header</span></b></a> command.</li><li>To define a matching rule for MF classification based on the source MAC addresses of packets, run the <a href="cmdqueryname=if-match+source-mac"><b><span class="cmdname">if-match source-mac</span></b></a> <i><span class="varname">mac-address</span></i> command.</li><li>To define a matching rule for MF classification based on the SYN Flag value in the TCP header, run the <a href="cmdqueryname=if-match+tcp+syn-flag"><b><span class="cmdname">if-match tcp syn-flag</span></b></a> { <i><span class="varname">tcpflag-value</span></i> [ <strong><span>mask</span></strong> <i><span class="varname">tcpflag-mask</span></i> ] | <strong><span>bit-match</span></strong> { <strong><span>established</span></strong> | <strong><span>fin</span></strong> | <strong><span>syn</span></strong> | <strong><span>rst</span></strong> | <strong><span>psh</span></strong> | <strong><span>ack</span></strong> | <strong><span>urg</span></strong> | <strong><span>ece</span></strong> | <strong><span>cwr</span></strong> | <strong><span>ns</span></strong> } } command.</li><li id="EN-US_TASK_0172343790__li01">To define a matching rule for MF classification based on the SYN Flag value in the IPv6 TCP header, run the <a href="cmdqueryname=if-match+ipv6+tcp+syn-flag"><b><span class="cmdname" id="EN-US_TASK_0172343790__cmdname285226619213933">if-match ipv6 tcp syn-flag</span></b></a> { <i><span class="varname" id="EN-US_TASK_0172343790__varname747528290213933">tcpflag-value</span></i> [ <strong><span id="EN-US_TASK_0172343790__cmdparmname891962132213933">mask</span></strong> <i><span class="varname" id="EN-US_TASK_0172343790__varname291260538213933">tcpflag-mask</span></i> ] | <strong><span id="EN-US_TASK_0172343790__cmdparmname1413449510213933">bit-match</span></strong> { <strong><span id="EN-US_TASK_0172343790__cmdparmname880386346213933">established</span></strong> | <strong><span id="EN-US_TASK_0172343790__cmdparmname1343117882213933">fin</span></strong> | <strong><span id="EN-US_TASK_0172343790__cmdparmname2092767093213933">syn</span></strong> | <strong><span id="EN-US_TASK_0172343790__cmdparmname1257197198213933">rst</span></strong> | <strong><span id="EN-US_TASK_0172343790__cmdparmname1841430683213933">psh</span></strong> | <strong><span id="EN-US_TASK_0172343790__cmdparmname1133946731213933">ack</span></strong> | <strong><span id="EN-US_TASK_0172343790__cmdparmname62834668213933">urg</span></strong> } } command.</li></ul>
<div class="p">You can configure one or more matching rules in Step 3 as needed.<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><div class="p">If the device functions as a PE, perform the following operations:<ul><li><p>To perform MF classification based on the IP layer information of outbound packets on the public network, run the <a href="cmdqueryname=traffic-policy+match-ip-layer+mpls-pop"><b><span class="cmdname">traffic-policy match-ip-layer mpls-pop</span></b></a> command<span> in the slot view</span>.</p>
</li><li><p>To perform MF classification based on the IP layer information of inbound packets on the public network, run the <a href="cmdqueryname=traffic-policy+match-ip-layer+mpls-push"><b><span class="cmdname">traffic-policy match-ip-layer mpls-push</span></b></a> command<span> in the slot view</span>.</p>
</li></ul>
</div>
</div></div>
</div>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=return"><b><span class="cmdname">return</span></b></a></span><p><p>Return to the user view.</p>
</p></li></ol>
</li><li><span>Define a traffic behavior and enable flow mirroring.</span><ol><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=traffic+behavior"><b><span class="cmdname">traffic behavior</span></b></a> <i><span class="varname">behavior-name</span></i></span><p><p>A traffic behavior is defined and its view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=port-mirroring+enable"><b><span class="cmdname">port-mirroring enable</span></b></a></span><p><p>Flow mirroring is enabled.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=port-mirroring+car"><b><span class="cmdname">port-mirroring car</span></b></a> <strong><span>cir</span></strong> <i><span class="varname">cir-value</span></i> [ <strong><span>pir</span></strong> <i><span class="varname">pir-value</span></i> ] [ <strong><span>cbs</span></strong> <i><span class="varname">cbs-value</span></i> [ <strong><span>pbs</span></strong> <i><span class="varname">pbs-value</span></i> ] ]</span><p><p>The CAR function is implemented for mirrored traffic.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=port-mirroring+slice-size"><b><span class="cmdname">port-mirroring slice-size</span></b></a> <i><span class="varname">slice-size-value</span></i></span><p><p>The length of packet content to be mirrored is configured.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=port-mirroring+without-linklayer-header"><b><span class="cmdname">port-mirroring without-linklayer-header</span></b></a></span><p><p>The mirrored port is configured to mirror packets from their Layer 3 headers.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=return"><b><span class="cmdname">return</span></b></a></span><p><p>Return to the user view.</p>
</p></li></ol>
</li><li><span>Define a traffic policy to associate the traffic classifier with the traffic behavior.</span><ol><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=traffic+policy"><b><span class="cmdname">traffic policy</span></b></a> <i><span class="varname">policy-name</span></i></span><p><p>A traffic policy is defined and its view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=classifier"><b><span class="cmdname">classifier</span></b></a> <i><span class="varname">classifier-name</span></i> <strong><span>behavior</span></strong> <i><span class="varname">behavior-name</span></i></span><p><p>A traffic behavior is specified for the traffic classifier in the traffic policy.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li></ul></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_portmirror_cfg_0009.html">Configuring Flow Mirroring
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_portmirror_cfg_0030.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_portmirror_cfg_0016.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>