
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring OSPF GTSM">
<meta name="abstract" content="This section provides an example for configuring OSPF GTSM in order to protect devices on an OSPF network against CPU utilization attacks.">
<meta name="description" content="This section provides an example for configuring OSPF GTSM in order to protect devices on an OSPF network against CPU utilization attacks.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_gtsm_cfg_0009.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_gtsm_cfg_0011.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="z00603461,w00800033,w00556928,w00606909,gtsm,l00455378,z00805567">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="GTSM">
<meta name="featuretype" content="Security">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="GTSM">
<meta name="featuretype" content="Security">
<meta name="featurename" content="GTSM">
<meta name="featuretype" content="Security">
<meta name="featurename" content="GTSM">
<meta name="featuretype" content="Security">
<meta name="OWNER" content="y00852169">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="y00852169">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172372052">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring OSPF GTSM</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172372052"></a><a name="EN-US_TASK_0172372052"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring OSPF GTSM</h1>
<div class="taskbody"><p>This section provides an example for configuring OSPF GTSM in order to protect devices on an OSPF network against CPU utilization attacks.</p>
<div class="context"><a name="EN-US_TASK_0172372052__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0172372052__fig_dc_vrp_gtsm_cfg_001001">Figure 1</a>, OSPF runs between <span class="keyword">Router</span>s, and GTSM needs to be enabled on <span class="keyword">Device</span>C.</p>
<p>According to the network diagram, the valid TTL ranges of the packets sent from the <span class="keyword">Router</span>s to <span class="keyword">Device</span>C are as follows:</p>
<ul><li><p>For packets sent from neighbors <span class="keyword">Device</span>A and <span class="keyword">Device</span>E to <span class="keyword">Device</span>C, the valid TTL range is [255, 255].</p>
</li><li><p>For packets sent from <span class="keyword">Device</span>B, <span class="keyword">Device</span>D, and <span class="keyword">Device</span>F to <span class="keyword">Device</span>C, the valid TTL ranges are [254, 255], [253, 255], and [252, 255], respectively.</p>
</li></ul>
<div class="fignone" id="EN-US_TASK_0172372052__fig_dc_vrp_gtsm_cfg_001001"><a name="EN-US_TASK_0172372052__fig_dc_vrp_gtsm_cfg_001001"></a><a name="fig_dc_vrp_gtsm_cfg_001001"></a><span class="figcap"><b>Figure 1 </b>Network diagram of configuring OSPF GTSM</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface1 and interface2 represent GE<span>0/1/0</span> and GE<span>0/2/0</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_gtsm_cfg_001001.png" width="NaN" height="NaN"></span><br></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172372052__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Precautions</h4><p>None</p>
</div></div>
<div class="context"><a name="EN-US_TASK_0172372052__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure basic OSPF functions.</p>
</li><li><p>Enable GTSM on each <span class="keyword">Router</span> and specify valid TTL ranges.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172372052__1.4.4"></a><a name="1.4.4"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>OSPF process ID of each <span class="keyword">Router</span></p>
</li><li><p>Valid TTL range for packets transmitted between the <span class="keyword">Router</span>s</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172372052__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure IP addresses for interfaces. For detailed configurations, see Configuration Files.</span></li><li><span>Configure basic OSPF functions. For detailed configurations, see Configuration Files.</span></li><li><span>Configure OSPF GTSM.</span><p><p># Set the valid TTL range of packets sent from <span class="keyword">Device</span>C to other <span class="keyword">Router</span>s to [252, 255].</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C] <strong>ospf valid-ttl-hops 4</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C] <strong>commit</strong></pre>
<p># Set the valid TTL range of packets sent from <span class="keyword">Device</span>A to <span class="keyword">Device</span>C to [255, 255].</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A]<strong> ospf valid-ttl-hops 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
<p># Set the valid TTL range of packets sent from <span class="keyword">Device</span>B to <span class="keyword">Device</span>C to [254, 255].</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B]<strong> ospf valid-ttl-hops 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>commit</strong></pre>
<p># Set the valid TTL range of packets sent from <span class="keyword">Device</span>D to <span class="keyword">Device</span>C to [253, 255].</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>D]<strong> ospf valid-ttl-hops 3</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D] <strong>commit</strong></pre>
<p># Set the valid TTL range of packets sent from <span class="keyword">Device</span>E to <span class="keyword">Device</span>C to [255, 255].</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>E]<strong> ospf valid-ttl-hops 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>E] <strong>commit</strong></pre>
<p># Set the valid TTL range of packets sent from <span class="keyword">Device</span>F to <span class="keyword">Device</span>C to [252, 255].</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>F]<strong> ospf valid-ttl-hops 4</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>F] <strong>commit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p># Check whether OSPF neighbor relationships are properly established between the <span class="keyword">Router</span>s. Take <span class="keyword">Device</span>A as an example. The value of <strong>State</strong> in the command output is <strong>Full</strong>, indicating that the neighbor relationship has been properly established.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A]<strong> display ospf peer</strong></pre>
<pre class="screen">          OSPF Process 1 with Router ID 1.1.1.1</pre>
<pre class="screen">                  Neighbors</pre>
<pre class="screen"> Area 0.0.0.0 interface 192.168.0.1(GigabitEthernet<span>0/1/0</span>)'s neighbors</pre>
<pre class="screen"><strong>Router ID: 2.2.2.2</strong>      Address: 192.168.0.2</pre>
<pre class="screen"><strong>State: Full</strong>  Mode:Nbr is  Master  Priority: 1</pre>
<pre class="screen">   DR: None   BDR: None   MTU: 0</pre>
<pre class="screen">   Dead timer due in 36  sec</pre>
<pre class="screen">   Retrans timer interval: 5</pre>
<pre class="screen">   Neighbor is up for 00:15:04</pre>
<pre class="screen">   Authentication Sequence: [ 0 ]</pre>
<pre class="screen">                  Neighbors</pre>
<pre class="screen"> Area 0.0.0.1 interface 192.168.1.1(GigabitEthernet<span>0/2/0</span>)'s neighbors</pre>
<pre class="screen"><strong>Router ID: 3.3.3.3</strong>       Address: 192.168.1.2</pre>
<pre class="screen"><strong>State: Full</strong>  Mode:Nbr is  Master  Priority: 1</pre>
<pre class="screen">   DR: None   BDR: None   MTU: 0</pre>
<pre class="screen">   Dead timer due in 39  sec</pre>
<pre class="screen">   Retrans timer interval: 5</pre>
<pre class="screen">   Neighbor is up for 00:07:32</pre>
<pre class="screen">   Authentication Sequence: [ 0 ]</pre>
<p># Run the <strong>display gtsm statistics all</strong> command on <span class="keyword">Device</span>C to check GTSM statistics. If the default action is set to pass for the packets that do not match the specified GTSM policy and no invalid packets exist, the number of dropped packets is 0.</p>
<pre class="screen">&lt;<span class="keyword">Device</span>C&gt; <strong>display gtsm statistics all</strong></pre>
<pre class="screen">GTSM Statistics Table</pre>
<pre class="screen">----------------------------------------------------------------</pre>
<pre class="screen">SlotId  Protocol  Total Counters  Drop Counters  Pass Counters</pre>
<pre class="screen">----------------------------------------------------------------</pre>
<pre class="screen"> 1      BGP       0               0              0
 1      BGPv6     0               0              0
 1      OSPF      0               0              0
 1      LDP       0               0              0
<span> 1      OSPFv3    0               0              0 </span>
<span> 1      RIP       0               0              0 </span>
 2      BGP       0               0              0
 2      BGPv6     0               0              0
 2      OSPF      0               0              0
 2      LDP       0               0              0
<span> 2      OSPFv3    0               0              0 </span>
<span> 2      RIP       0               0              0 </span>
 3      BGP       0               0              0
 3      BGPv6     0               0              0
 3      OSPF      0               0              0
 3      LDP       0               0              0
<span> 3      OSPFv3    0               0              0 </span>
<span> 3      RIP       0               0              0 </span>
 4      BGP       0               0              0
 4      BGPv6     0               0              0
 4      OSPF      0               0              0
 4      LDP       0               0              0
<span> 4      OSPFv3    0               0              0 </span>
<span> 4      RIP       0               0              0 </span>
 5      BGP       0               0              0
 5      BGPv6     0               0              0
 5      OSPF      0               0              0
 5      LDP       0               0              0
<span> 5      OSPFv3    0               0              0 </span>
<span> 5      RIP       0               0              0 </span>
 7      BGP       0               0              0
 7      BGPv6     0               0              0
 7      OSPF      0               0              0
 7      LDP       0               0              0
<span> 7      OSPFv3    0               0              0 </span>
<span> 7      RIP       0               0              0 </span>
</pre>
<pre class="screen">----------------------------------------------------------------</pre>
<p>In this case, if the PC simulates the OSPF packets of <span class="keyword">Device</span>A to attack <span class="keyword">Device</span>C, the packets are dropped when they reach <span class="keyword">Device</span>C. This is because the TTL value is not 255. As a result, the number of dropped packets increases in the GTSM statistics about <span class="keyword">Device</span>C.</p>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172372052__1.4.6"></a><a name="1.4.6"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p><span class="keyword">Device</span>A configuration file</p>
<pre class="screen">#</pre>
<pre class="screen"> sysname <span class="keyword">Device</span>A</pre>
<pre class="screen">#</pre>
<pre class="screen">router id 1.1.1.1</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen">ip address 192.168.0.1 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/2/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen">ip address 192.168.1.1 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">ospf 1</pre>
<pre class="screen"> area 0.0.0.0</pre>
<pre class="screen">  network 192.168.0.0 0.0.0.255</pre>
<pre class="screen"> area 0.0.0.1</pre>
<pre class="screen">  network 192.168.1.0 0.0.0.255</pre>
<pre class="screen">#</pre>
<pre class="screen">ospf valid-ttl-hops 1</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p><span class="keyword">Device</span>B configuration file</p>
<pre class="screen">#</pre>
<pre class="screen"> sysname <span class="keyword">Device</span>B</pre>
<pre class="screen">#</pre>
<pre class="screen">router id 2.2.2.2</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 192.168.0.2 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/2/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen">ip address 192.168.2.1 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">ospf 1</pre>
<pre class="screen"> area 0.0.0.0</pre>
<pre class="screen">  network 192.168.0.0 0.0.0.255</pre>
<pre class="screen"> area 0.0.0.2</pre>
<pre class="screen">  network 192.168.2.0 0.0.0.255</pre>
<pre class="screen">#</pre>
<pre class="screen">ospf valid-ttl-hops 2</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p><span class="keyword">Device</span>C configuration file</p>
<pre class="screen">#</pre>
<pre class="screen"> sysname <span class="keyword">Device</span>C</pre>
<pre class="screen">#</pre>
<pre class="screen">router id 3.3.3.3</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/2/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 172.16.1.1 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 192.168.1.2 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">ospf 1</pre>
<pre class="screen"> area 0.0.0.1</pre>
<pre class="screen">  network 192.168.1.0 0.0.0.255</pre>
<pre class="screen">  network 172.16.1.0 0.0.0.255</pre>
<pre class="screen">#</pre>
<pre class="screen">ospf valid-ttl-hops 4</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p><span class="keyword">Device</span>D configuration file</p>
<pre class="screen">#</pre>
<pre class="screen"> sysname <span class="keyword">Device</span>D</pre>
<pre class="screen">#</pre>
<pre class="screen">router id 4.4.4.4</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/2/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 172.17.1.1 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen">ip address 192.168.2.2 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">ospf 1</pre>
<pre class="screen"> area 0.0.0.2</pre>
<pre class="screen">  network 192.168.2.0 0.0.0.255</pre>
<pre class="screen">  network 172.17.1.0 0.0.0.255</pre>
<pre class="screen">#</pre>
<pre class="screen">ospf valid-ttl-hops 3</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p><span class="keyword">Device</span>E configuration file</p>
<pre class="screen">#</pre>
<pre class="screen"> sysname <span class="keyword">Device</span>E</pre>
<pre class="screen">#</pre>
<pre class="screen">router id 5.5.5.5</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/2/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 172.16.1.2 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">ospf 1</pre>
<pre class="screen"> area 0.0.0.1</pre>
<pre class="screen">  network 172.16.1.0 0.0.0.255</pre>
<pre class="screen">#</pre>
<pre class="screen">ospf valid-ttl-hops 1</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p><span class="keyword">Device</span>F configuration file</p>
<pre class="screen">#</pre>
<pre class="screen"> sysname <span class="keyword">Device</span>F</pre>
<pre class="screen">#</pre>
<pre class="screen">router id 6.6.6.6</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/2/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 172.17.1.2 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">ospf 1</pre>
<pre class="screen"> area 0.0.0.2</pre>
<pre class="screen">  network 172.17.1.0 0.0.0.255</pre>
<pre class="screen">#</pre>
<pre class="screen">ospf valid-ttl-hops 4</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_gtsm_cfg_0009.html">Configuration Examples for GTSMs
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_gtsm_cfg_0011.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>