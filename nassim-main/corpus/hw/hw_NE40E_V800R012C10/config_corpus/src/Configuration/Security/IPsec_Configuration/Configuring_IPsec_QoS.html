
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring IPsec QoS">
<meta name="abstract" content="Configure the IPsec packet format or forwarding behavior to implement QoS for IPsec packets.">
<meta name="description" content="Configure the IPsec packet format or forwarding behavior to implement QoS for IPsec packets.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ipsec_cfg_0001.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ipsec_cfg_all_0017.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ipsec_cfg_all_0026.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,z00603461,ipsec,w00556928,w00606909,h00522387,l00455378,z00805567">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="IPSec">
<meta name="featuretype" content="Security">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="IPSec">
<meta name="featuretype" content="Security">
<meta name="featurename" content="IPSec">
<meta name="featuretype" content="Security">
<meta name="OWNER" content="z00485179">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="z00485179">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172372441">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>Configuring IPsec QoS</title>
</head>
<body><a name="EN-US_TASK_0172372441"></a><a name="EN-US_TASK_0172372441"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring IPsec QoS</h1>
<div class="taskbody"><p><span>C</span>onfigure the IPsec packet format or forwarding behavior to implement QoS for IPsec packets.</p>
<div class="context"><a name="EN-US_TASK_0172372441__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>IPsec QoS is used to back up session table status information between the active and standby devices. </p>
<p>Fragmentation before encryption can be configured globally or locally:</p>
<ul><li><p>Global configuration</p>
<p>The global configuration is valid to all created IPsec policies (except for policies in which this is separately configured). You can use the global configuration to improve efficiency. If a large number of IPsec policies need to use this function, you do not need to run the <a href="cmdqueryname=ipsec+df-bit+clear"><b><span class="cmdname">ipsec df-bit clear</span></b></a> command to manually configure this function for IPsec policies one by one.</p>
</li><li><p>Local configuration</p>
<p>For a specific IPsec policy, you can run the <a href="cmdqueryname=ipsec+df-bit+clear"><b><span class="cmdname">ipsec df-bit clear</span></b></a> command to separately configure this function. The local configuration takes precedence over the global configuration.</p>
</li></ul>
</div></div>
<div class="steps-unordered"><a name="EN-US_TASK_0172372441__1.4.2"></a><a name="1.4.2"></a><h4 class="sectiontitle">Procedure</h4>
<ul><li><span>Global configuration</span><ol><li class="substepexpand"><span>Run <span><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Globally enable the device to fragment IPsec packets and then encrypt them.</span><p><ol type="a"><li><p>Run the <a href="cmdqueryname=ipsec+global+df-bit+clear"><b><span class="cmdname">ipsec global df-bit clear</span></b></a> command to clear the DF flag to allow IPsec packet fragmentation.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>You can run the <a href="cmdqueryname=ipsec+global+fragmentation+aging-time"><b><span class="cmdname">ipsec global fragmentation</span></b></a> <strong><span>aging-time</span></strong> <i><span class="varname">aging-time</span></i> command to set the aging time of IPsec packet fragments. The default aging time is 5000 ms.</p>
</div></div>
</li><li><p>Run the <a href="cmdqueryname=ipsec+global+fragmentation+before-encryption"><b><span class="cmdname">ipsec global fragmentation before-encryption</span></b></a> command to enable the device to fragment and then encrypt IPsec packets.</p>
</li></ol>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li><span>Local configuration</span><ol><li class="substepexpand"><span>Run <span><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Configure IPsec QoS in the IPsec policy or IPsec policy template based on actual requirements.</span><p>
<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" frame="border" border="1" rules="all"><caption><b>Table 1 </b>Configuring IPsec QoS</caption><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="16.33%" id="mcps1.4.2.2.2.2.2.1.2.4.1.1" liSelected="liSelected"><p>Step/Item</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="41.67%" id="mcps1.4.2.2.2.2.2.1.2.4.1.2" liSelected="liSelected"><p>IPsec Policy</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="42%" id="mcps1.4.2.2.2.2.2.1.2.4.1.3" liSelected="liSelected"><p>IPsec Policy Template</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" valign="top" width="16.33%" headers="mcps1.4.2.2.2.2.2.1.2.4.1.1 "><p>Enter the IPsec policy view or IPsec policy template view.</p>
</td>
<td class="cellrowborder" valign="top" width="41.67%" headers="mcps1.4.2.2.2.2.2.1.2.4.1.2 "><p><a href="cmdqueryname=ipsec+policy+isakmp"><b><span class="cmdname">ipsec policy</span></b></a> <i><span class="varname">policy-name</span></i> <i><span class="varname">sequence-number</span></i> <strong><span>isakmp</span></strong></p>
</td>
<td class="cellrowborder" valign="top" width="42%" headers="mcps1.4.2.2.2.2.2.1.2.4.1.3 "><p><a href="cmdqueryname=ipsec+policy-template"><b><span class="cmdname">ipsec policy-template</span></b></a> <i><span class="varname">template-name</span></i> <i><span class="varname">sequence-number</span></i></p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.2.2.2.2.2.1.2.4.1.1 "><p>Set a rate limit.</p>
</td>
<td class="cellrowborder" colspan="2" valign="top" headers="mcps1.4.2.2.2.2.2.1.2.4.1.2 mcps1.4.2.2.2.2.2.1.2.4.1.3 "><p>Run the <a href="cmdqueryname=speed-limit"><b><span class="cmdname">speed-limit</span></b></a><span> { <strong><span id="EN-US_TASK_0172372441__en-us_cliref_0172383856_cmdparmname1933882517214541">inbound</span></strong> | <strong><span id="EN-US_TASK_0172372441__en-us_cliref_0172383856_cmdparmname741154207214541">outbound</span></strong> } <i><span class="varname" id="EN-US_TASK_0172372441__en-us_cliref_0172383856_varname808397350214541">speed-limit</span></i> [ <strong><span id="EN-US_TASK_0172372441__en-us_cliref_0172383856_cmdparmname232703570214541">ike</span></strong> ] [ <strong><span id="EN-US_TASK_0172372441__en-us_cliref_0172383856_cmdparmname2116956025214541">payload</span></strong> ]</span> command to set a rate limit.</p>
<p>When multiple tunnels are established on the device, traffic conflict occurs in case of heavy traffic. By running the <a href="cmdqueryname=speed-limit"><b><span class="cmdname">speed-limit</span></b></a> command, you can limit the traffic on each IPsec tunnel. The traffic beyond the limit is discarded. In this manner, traffic on each tunnel can be transmitted.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.2.2.2.2.2.1.2.4.1.1 "><p>Configure the device to fragment and then encrypt IPsec packets.</p>
</td>
<td class="cellrowborder" colspan="2" valign="top" headers="mcps1.4.2.2.2.2.2.1.2.4.1.2 mcps1.4.2.2.2.2.2.1.2.4.1.3 "><div class="p"><ol type="a"><li><p>Run the <a href="cmdqueryname=ipsec+df-bit+clear"><b><span class="cmdname">ipsec df-bit clear</span></b></a> command to clear the DF flag to allow IPsec packet fragmentation.</p>
</li><li><p>Run the <a href="cmdqueryname=ipsec+fragmentation+before-encryption"><b><span class="cmdname">ipsec fragmentation before-encryption</span></b></a> command to configure the device to fragment and then encrypt IPsec packets.</p>
</li></ol>
</div>
<div class="p"><div class="note"><span class="notetitle"> NOTE: </span><div class="notebody"><p>For the IPsec policies, the <a href="cmdqueryname=ipsec+df-bit+clear"><b><span class="cmdname">ipsec df-bit clear</span></b></a> command takes precedence over the <a href="cmdqueryname=ipsec+global+df-bit+clear"><b><span class="cmdname">ipsec global df-bit clear</span></b></a> command in the system view.</p>
</div></div>
</div>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.2.2.2.2.2.1.2.4.1.1 "><p>Configure the priority re-marking function.</p>
</td>
<td class="cellrowborder" colspan="2" valign="top" headers="mcps1.4.2.2.2.2.2.1.2.4.1.2 mcps1.4.2.2.2.2.2.1.2.4.1.3 "><ul><li><p>Run the <a href="cmdqueryname=set+dscp+af11+af12+af13+af21+af22+af23+af31+af32+af33+af41+af42"><b><span class="cmdname">set dscp</span></b></a> { <i><span class="varname">dscp-value</span></i> | <strong><span>af11</span></strong> | <strong><span>af12</span></strong> | <strong><span>af13</span></strong> | <strong><span>af21</span></strong> | <strong><span>af22</span></strong> | <strong><span>af23</span></strong> | <strong><span>af31</span></strong> | <strong><span>af32</span></strong> | <strong><span>af33</span></strong> | <strong><span>af41</span></strong> | <strong><span>af42</span></strong> | <strong><span>af43</span></strong> | <strong><span>cs1</span></strong> | <strong><span>cs2</span></strong> | <strong><span>cs3</span></strong> | <strong><span>cs4</span></strong> | <strong><span>cs5</span></strong> | <strong><span>cs6</span></strong> | <strong><span>cs7</span></strong> | <strong><span>default</span></strong> | <strong><span>ef</span></strong> } { <strong><span>inbound</span></strong> | <strong><span>outbound</span></strong> } command to set the DSCP value of IPv4 packets.</p>
</li><li><p>Run the <a href="cmdqueryname=set+service-class+af1+af2+af3+af4+be+cs6+cs7+ef+inbound+outbound"><b><span class="cmdname">set service-class</span></b></a> { <strong><span>af1</span></strong> | <strong><span>af2</span></strong> | <strong><span>af3</span></strong> | <strong><span>af4</span></strong> | <strong><span>be</span></strong> | <strong><span>cs6</span></strong> | <strong><span>cs7</span></strong> | <strong><span>ef</span></strong> } { <strong><span>inbound</span></strong> | <strong><span>outbound</span></strong> } command to set the internal service class corresponding to the EXP value in MPLS headers.</p>
<p>After a packet enters an MPLS network, both the DSCP value of IP headers and EXP value of MPLS headers in the packets are mapped to service classes by default. To allow only the EXP value of MPLS headers to be modified, run this command to set the internal service class.</p>
<p>To enable the EXP value in an MPLS packet header to inherit the DSCP value in the plaintext packet header, run the <a href="cmdqueryname=set+service-class+inherit-plain+inbound"><b><span class="cmdname">set service-class</span></b></a> <strong><span>inherit-plain</span></strong> <strong><span>inbound</span></strong> command.</p>
</li></ul>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="16.33%" headers="mcps1.4.2.2.2.2.2.1.2.4.1.1 "><p>Define a policy template.</p>
</td>
<td class="cellrowborder" valign="top" width="41.67%" headers="mcps1.4.2.2.2.2.2.1.2.4.1.2 "><p>-</p>
</td>
<td class="cellrowborder" valign="top" width="42%" headers="mcps1.4.2.2.2.2.2.1.2.4.1.3 "><p><a href="cmdqueryname=ipsec+policy+isakmp+template"><b><span class="cmdname">ipsec policy</span></b></a> <i><span class="varname">policy-name</span></i> <i><span class="varname">seq-number</span></i> <strong><span>isakmp</span></strong> [ <strong><span>template</span></strong> <i><span class="varname">template-name</span></i> ]</p>
<p>After the IPsec policy template is bound to the IPsec policy, you can apply the IPsec policy to the interface to enable functions of the IPsec policy template.</p>
<div class="note"><span class="notetitle"> NOTE: </span><div class="notebody"><p>In an IPsec policy group, only one IPsec policy can quote the IPsec policy template.</p>
<p>The names of the IPsec policy template and the IPsec policy must be different.</p>
</div></div>
</td>
</tr>
</tbody>
</table>
</div>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li></ul></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ipsec_cfg_0001.html">IPsec Configuration
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ipsec_cfg_all_0017.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ipsec_cfg_all_0026.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>