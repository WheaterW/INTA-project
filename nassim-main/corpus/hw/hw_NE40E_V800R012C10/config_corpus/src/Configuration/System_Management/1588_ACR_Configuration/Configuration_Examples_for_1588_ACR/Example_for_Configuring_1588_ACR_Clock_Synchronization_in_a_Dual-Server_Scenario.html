
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring 1588 ACR Clock Synchronization in a Dual-Server Scenario">
<meta name="abstract" content="In a 1588 ACR domain, a client sets up the client/server relationship with two remote clock servers that work in the master/slave mode, and sends a unicast negotiation request to the two clock servers to restore clock information. Once the master clock server becomes faulty, the client sends a request for establishing a connection to the slave clock server.">
<meta name="description" content="In a 1588 ACR domain, a client sets up the client/server relationship with two remote clock servers that work in the master/slave mode, and sends a unicast negotiation request to the two clock servers to restore clock information. Once the master clock server becomes faulty, the client sends a request for establishing a connection to the slave clock server.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_1588v2_cfg_5044.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_1588v2_cfg_5036.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00606909,l00587852">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="1588 ACR">
<meta name="featuretype" content="System Management">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="1588 ACR">
<meta name="featuretype" content="System Management">
<meta name="featurename" content="1588 ACR">
<meta name="featuretype" content="System Management">
<meta name="OWNER" content="w00845984">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="w00845984">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001825720917">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring 1588 ACR Clock Synchronization in a Dual-Server Scenario</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001825720917"></a><a name="EN-US_TASK_0000001825720917"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring 1588 ACR Clock Synchronization in a Dual-Server Scenario</h1>
<div class="taskbody"><p>In a 1588 ACR domain, a client sets up the client/server relationship with two remote clock servers that work in the master/slave mode, and sends a unicast negotiation request to the two clock servers to restore clock information. Once the master clock server becomes faulty, the client sends a request for establishing a connection to the slave clock server.</p>
<div class="context"><a name="EN-US_TASK_0000001825720917__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the IP RAN shown in <a href="#EN-US_TASK_0000001825720917__fig_dc_ne_1588v2_cfg_503701">Figure 1</a>, <span class="keyword">Device</span>A and <span class="keyword">Device</span>B function as clock servers that work in the master/slave mode. <span class="keyword">Device</span>C functions as a client and first sends a 1588 ACR Layer 3 unicast negotiation request to <span class="keyword">Device</span>A that functions as the master clock server to achieve clock synchronization. If the link between <span class="keyword">Device</span>C and <span class="keyword">Device</span>A goes down, <span class="keyword">Device</span>C sends a Layer 3 unicast negotiation request to <span class="keyword">Device</span>B to ensure that its clock is synchronized with that of the clock server.</p>
<div class="fignone" id="EN-US_TASK_0000001825720917__fig_dc_ne_1588v2_cfg_503701"><a name="EN-US_TASK_0000001825720917__fig_dc_ne_1588v2_cfg_503701"></a><a name="fig_dc_ne_1588v2_cfg_503701"></a><span class="figcap"><b>Figure 1 </b>Network diagram of configuring 1588 ACR clock synchronization in a dual-server scenario</span><br><span><img class="vsd" src="figure/en-us_image_0000001779081194.png" width="NaN" height="NaN"></span><br></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001825720917__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure <span class="keyword">Device</span>A as server 1.</p>
</li><li><p>Configure <span class="keyword">Device</span>B as server 2.</p>
</li><li><p>Configure <span class="keyword">Device</span>C as a client.</p>
</li><li><p>Configure unicast negotiation on servers and the client.</p>
</li><li><p>On the client, configure a PTP clock reference source.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001825720917__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>IP addresses of the servers and the IP address of the client</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001825720917__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure <span class="keyword">Device</span>A as server 1.</span><p><pre class="screen">&lt;<span class="keyword">Device</span>A&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>interface loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-Loopback0] <strong>ip address 1.1.1.1 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-Loopback0] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-Loopback0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>ptp-adaptive enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>ptp-adaptive device-type server</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>ptp-adaptive local-ip 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
</p></li><li><span>Configure <span class="keyword">Device</span>B as server 2.</span><p><pre class="screen">&lt;<span class="keyword">Device</span>B&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>interface loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-Loopback0] <strong>ip address 2.2.2.2 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-Loopback0] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-Loopback0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>ptp-adaptive enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>ptp-adaptive device-type server</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>ptp-adaptive local-ip 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>commit</strong></pre>
</p></li><li><span>Configure <span class="keyword">Device</span>C as a client.</span><p><pre class="screen">&lt;<span class="keyword">Device</span>C&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C] <strong>interface loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-Loopback0] <strong>ip address 3.3.3.3 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-Loopback0] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C-Loopback0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C] <strong>ptp-adaptive enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C] <strong>ptp-adaptive device-type client</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C] <strong>ptp-adaptive local-ip 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C] <strong>ptp-adaptive remote-server1-ip 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C] <strong>ptp-adaptive remote-server2-ip 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C] <strong>commit</strong></pre>
</p></li><li><span>Configure unicast negotiation on servers and the client.</span><p><p># Configure server 1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>ptp-adaptive acr unicast-negotiate enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
</p><p><p># Configure server 2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>ptp-adaptive acr unicast-negotiate enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
</p><p><p># Configure the client.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C] <strong>ptp-adaptive acr unicast-negotiate enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C] <strong>commit</strong></pre>
</p></li><li><span>On the client, configure a PTP clock reference source.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C] <strong>clock source ptp synchronization enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C] <strong>clock source ptp priority 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C] <strong>clock source ptp ssm prc</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C] <strong>commit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p># Check the 1588 ACR configuration on <span class="keyword">Device</span>C.</p>
<pre class="screen">&lt;<span class="keyword">Device</span>C&gt; <strong>display ptp-adaptive all</strong>
  Device config info
  ------------------------------------------------------------------------------
  Ptp adaptive state      :enable           Device type        :client
  Sync mode               :frequency        Current state      :slave
  Packet dscp             :56               Domain value       :4
  Announce interval       :11               Announce duration  :300s
  Sync interval           :3                Sync duration      :300s
  Delay_resp interval     :3                Delay_resp duration:400s
  Announce receipt timeout:3                One-way or two-way :one-way
  Local ip                :3.3.3.3          Profile            :frequency
  Client board            :<span>3</span>
  VPN                     :none

  BMCA run info
  ------------------------------------------------------------------------------
  Current trace source    :server1

  Time performance statistics
  ------------------------------------------------------------------------------
  Realtime(T2-T1)         :+0s, 23281ns
  Max(T2-T1)              :+0s, 26277ns
  Min(T2-T1)              :+0s, 21853ns

  Remote server info
  ------------------------------------------------------------------------------
  Ip address                Negotiate state    SSM    Priority    PTSF
  Server1: 1.1.1.1          Nego success       PRC    1           normal
  Server2: 2.2.2.2          Nego success       PRC    1           normal</pre>
<p># Check the 1588 ACR configuration on the server. Take the display on <span class="keyword">Device</span>A as an example.</p>
<pre class="screen">&lt;<span class="keyword">Device</span>A&gt; <strong>display ptp-adaptive all</strong>
  Device config info
  ------------------------------------------------------------------------------
  Ptp adaptive state      :enable           Device type        :server
  Sync mode               :frequency        Current state      :master
  Packet dscp             :56               Domain value       :4
  Local ip                :1.1.1.1          Profile            :frequency
  Server board            :<span>3</span>
  VPN                     :none

  Client info
      ID  Ip Address       Clock ID          Mode     Announce  Sync  Delay_resp
  ------------------------------------------------------------------------------
  1   500 3.3.3.3          00259efffed1efcf  two-way  1         -3    -3
  2   489 4.4.4.4          286ed4fffebcdc76  one-way  1         -3    -3</pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001825720917__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p><span class="keyword">Device</span>A configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname <span class="keyword">Device</span>A</pre>
<pre class="screen">#
ptp-adaptive enable
ptp-adaptive device-type server
ptp-adaptive local-ip 1.1.1.1
ptp-adaptive acr unicast-negotiate enable
#
interface Loopback0
 ip address 1.1.1.1 255.255.255.255</pre>
<pre class="screen"># </pre>
<pre class="screen">return</pre>
</li><li><p><span class="keyword">Device</span>B configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname <span class="keyword">Device</span>B</pre>
<pre class="screen">#
ptp-adaptive enable
ptp-adaptive device-type server
ptp-adaptive local-ip 2.2.2.2
ptp-adaptive acr unicast-negotiate enable
#
interface Loopback0
 ip address 2.2.2.2 255.255.255.255</pre>
<pre class="screen"># </pre>
<pre class="screen">return</pre>
</li><li><p><span class="keyword">Device</span>C configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname <span class="keyword">Device</span>C</pre>
<pre class="screen">#
ptp-adaptive enable
ptp-adaptive device-type client
ptp-adaptive local-ip 3.3.3.3
ptp-adaptive remote-server1-ip 1.1.1.1
ptp-adaptive remote-server2-ip 2.2.2.2
ptp-adaptive acr unicast-negotiate enable
clock source ptp synchronization enable
clock source ptp priority 10
clock source ptp ssm prc
#
interface Loopback0
 ip address 3.3.3.3 255.255.255.255</pre>
<pre class="screen"># </pre>
<pre class="screen">return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_1588v2_cfg_5044.html">Configuration Examples for 1588 ACR
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_1588v2_cfg_5036.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>
</body>
</html>