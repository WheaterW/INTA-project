
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="CES ACR Configuration Example - E1 Link">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/cesacr_configuration.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_clock_cfg_5017.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="CES ACR Clock Synchronization">
<meta name="featuretype" content="System Management">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="CES ACR Clock Synchronization">
<meta name="featuretype" content="System Management">
<meta name="OWNER" content="l00425560,w00845984">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="w00845984">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001779081110">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>CES ACR Configuration Example - E1 Link</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001779081110"></a><a name="EN-US_TASK_0000001779081110"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">CES ACR Configuration Example - E1 Link</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001779081110__1.3.1"></a><a name="1.3.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0000001779081110__fig_dc_ne_clock_cfg_502101">Figure 1</a>, gNodeB and PE1 are connected through an E1 link, and NGC and PE2 are connected through E1 interfaces. The encapsulation protocol is configured as TDM on the channelized serial interfaces of the E1 link. A PW is formed between PE1 and PE2 to transparently transmit TDM cells.</p>
<p>After the ACR function is configured on PE1, PE1 can transparently transmit clock signals through the PW to implement time synchronization between PE1 and PE2.</p>
<div class="fignone" id="EN-US_TASK_0000001779081110__fig_dc_ne_clock_cfg_502101"><a name="EN-US_TASK_0000001779081110__fig_dc_ne_clock_cfg_502101"></a><a name="fig_dc_ne_clock_cfg_502101"></a><span class="figcap"><b>Figure 1 </b>Typical networking for configuring ACR</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The configurations in this example are performed on PE1 and PE2. The <span class="keyword">HUAWEI NE40E-M2 series</span> can function as PE1 or PE2.</p>
<p>In this example, interface1, interface2, and interface3 represent E1 <span>0/1/0</span>, GE<span>0/2/0</span>, and GE<span>0/2/1</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0000001825840881.png"></span></div>

<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" frame="border" border="1" rules="all"><thead align="left"><tr><th align="left" class="cellrowborder" char="." valign="top" width="22.667733226677335%" id="mcps1.3.1.5.1.4.1.1" liSelected="liSelected"><p><strong>Device</strong></p>
</th>
<th align="left" class="cellrowborder" char="." valign="top" width="37.66623337666233%" id="mcps1.3.1.5.1.4.1.2" liSelected="liSelected"><p><strong>Interface</strong></p>
</th>
<th align="left" class="cellrowborder" char="." valign="top" width="39.66603339666033%" id="mcps1.3.1.5.1.4.1.3" liSelected="liSelected"><p><strong>IP Address</strong></p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" char="." valign="top" width="22.667733226677335%" headers="mcps1.3.1.5.1.4.1.1 "><p>PE1</p>
</td>
<td class="cellrowborder" char="." valign="top" width="37.66623337666233%" headers="mcps1.3.1.5.1.4.1.2 "><p>GE<span>0/2/0</span></p>
<p>Loopback0</p>
</td>
<td class="cellrowborder" char="." valign="top" width="39.66603339666033%" headers="mcps1.3.1.5.1.4.1.3 "><p>10.1.1.1/24</p>
<p>2.2.2.2/32</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" width="22.667733226677335%" headers="mcps1.3.1.5.1.4.1.1 "><p>P</p>
</td>
<td class="cellrowborder" char="." valign="top" width="37.66623337666233%" headers="mcps1.3.1.5.1.4.1.2 "><p>GE<span>0/2/0</span></p>
<p>GE<span>0/2/1</span></p>
<p>Loopback0</p>
</td>
<td class="cellrowborder" char="." valign="top" width="39.66603339666033%" headers="mcps1.3.1.5.1.4.1.3 "><p>10.1.1.2/24</p>
<p>10.2.1.1/24</p>
<p>4.4.4.4/32</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" width="22.667733226677335%" headers="mcps1.3.1.5.1.4.1.1 "><p>PE2</p>
</td>
<td class="cellrowborder" char="." valign="top" width="37.66623337666233%" headers="mcps1.3.1.5.1.4.1.2 "><p>GE<span>0/2/1</span></p>
<p>Loopback0</p>
</td>
<td class="cellrowborder" char="." valign="top" width="39.66603339666033%" headers="mcps1.3.1.5.1.4.1.3 "><p>10.2.1.2/24</p>
<p>3.3.3.3/32</p>
</td>
</tr>
</tbody>
</table>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001779081110__1.3.2"></a><a name="1.3.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure an IGP on the P and PEs to implement interworking.</p>
</li><li><p>Configure basic MPLS functions. Configure MPLS L2VPN on PE1 and PE2, and establish a remote MPLS LDP peer relationship between PE1 and PE2.</p>
</li><li><p>Configure the CES ACR function on PE1 and PE2.</p>
</li><li><p>Configure the encapsulation protocol as TDM for the serial interfaces on PE1 and PE2.</p>
</li><li><p>Configure a PW on PE1 and PE2.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001779081110__1.3.3"></a><a name="1.3.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>L2VC IDs on both ends of the PW</p>
</li><li><p>MPLS LSR IDs of PE1, P, and PE2</p>
</li><li><p>IP addresses of the loopback interfaces used to configure remote peers on PE1 and PE2</p>
</li><li><p>ID of the clock recovery domain on PE1</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001779081110__1.3.4"></a><a name="1.3.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Run an IGP on the backbone network so that devices can communicate with each other. For configuration files, see Configuration Files in this section.</span></li><li><span>Configure basic MPLS functions on the backbone network, and configure MPLS L2VPN on PEs. Establish a remote MPLS LDP peer relationship between the PEs at both ends of the PW. For configuration files, see Configuration Files in this section.</span><p><p>A remote MPLS LDP peer relationship needs to be set up only between dynamic PWs.</p>
</p></li><li><span>Configure ACR on PE1 and PE2.</span><p><ol type="a"><li><p>Configure PE1.</p>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>controller e1 <span>0/1/0</span></strong>
[<span class="keyword">*</span>PE1-E1 <span>0/1/0</span>] <strong>clock recovery-domain 1</strong>
[<span class="keyword">*</span>PE1-E1 <span>0/1/0</span>] <strong>commit</strong>
[<span class="keyword">*</span>PE1-E1 <span>0/1/0</span>] <strong>quit</strong></pre>
<p># Configure PE1 to obtain a clock source recovered by CES ACR from clock recovery domain 1 on subcard 1 of the interface board.</p>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>clock source cesacr slot 0 card 1 recovery-domain 1 synchronization enable</strong>
[<span class="keyword">*</span>PE1] <strong>clock source cesacr slot 0 card 1 recovery-domain 1 ssm prc</strong>
[<span class="keyword">*</span>PE1] <strong>clock source cesacr slot 0 card 1 recovery-domain 1 priority 1</strong>
[<span class="keyword">*</span>PE1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>quit</strong></pre>
</li></ol>
</p></li><li><span>Configure the encapsulation protocol of the serial interface as TDM.</span><p><ol type="a"><li><p>Configure PE1.</p>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>controller e1 <span>0/1/0</span></strong>
[<span class="keyword">*</span>PE1-E1 <span>0/1/0</span>] <strong>using ce1</strong>
[<span class="keyword">*</span>PE1-E1 <span>0/1/0</span>] <strong>channel-set 1 timeslot-list 1-31</strong>
[<span class="keyword">*</span>PE1-E1 <span>0/1/0</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-E1 <span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface serial<span>0/1/0</span>:1</strong>
[<span class="keyword">*</span>PE1-Serial<span>0/1/0</span>:1] <strong>link-protocol tdm</strong>
[<span class="keyword">*</span>PE1-Serial<span>0/1/0</span>:1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-Serial<span>0/1/0</span>:1] <strong>quit</strong></pre>
</li><li><p>Configure PE2.</p>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>controller e1 <span>0/1/0</span></strong>
[<span class="keyword">*</span>PE2-E1 <span>0/1/0</span>] <strong>using ce1</strong>
[<span class="keyword">*</span>PE2-E1 <span>0/1/0</span>] <strong>channel-set 1 timeslot-list 1-31</strong>
[<span class="keyword">*</span>PE2-E1 <span>0/1/0</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-E1 <span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface serial<span>0/1/0</span>:1</strong>
[<span class="keyword">*</span>PE2-Serial<span>0/1/0</span>:1] <strong>link-protocol tdm</strong>
[<span class="keyword">*</span>PE2-Serial<span>0/1/0</span>:1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-Serial<span>0/1/0</span>:1] <strong>quit</strong></pre>
</li></ol>
</p></li><li><span>Configure a PW.</span><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>PW protection is supported. If one of multiple CES PWs fails, clock recovery is automatically switched to another CES PW.</p>
</div></div>
<ol type="a"><li><p>Configure PE1.</p>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface serial<span>0/1/0</span>:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Serial<span>0/1/0</span>:1] <strong>mpls l2vc 3.3.3.3 100 control-word tdm-encapsulation-number 8</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Serial<span>0/1/0</span>:1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-Serial<span>0/1/0</span>:1] <strong>quit</strong></pre>
</li><li><p>Configure PE2.</p>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface serial<span>0/1/0</span>:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Serial<span>0/1/0</span>:1] <strong>mpls l2vc 2.2.2.2 100 control-word tdm-encapsulation-number 8</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Serial<span>0/1/0</span>:1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-Serial<span>0/1/0</span>:1] <strong>quit</strong></pre>
</li></ol>
</p></li><li><span>Verify the configuration.</span><p><p>After completing the configurations, run the <strong>display mpls l2vc interface serial<span>0/1/0</span>:1</strong> command on PE1 to check the PW status. The command output shows that the PW is in the Active state.</p>
<pre class="screen">*client interface       : Serial<span>0/1/0</span>:1 is up
  session state          : up
  AC state               : up
  VC state               : up
  VC ID                  : 100
  VC type                : CESoPSN basic mode
  destination            : 3.3.3.3
  local group ID         : 0            remote group ID      : 0
  local VC label         : 146433       remote VC label      : 146432
  TDM encapsulation number: 8
  jitter-buffer           : 20
  idle-code               : ff
  rtp-header              : disable
  local AC OAM State     : up
  local PSN State        : up
  local forwarding state : forwarding
  local status code      : 0x0
  remote AC OAM state    : up
  remote PSN state       : up
  remote forwarding state: forwarding
  remote statuscode      : 0x0
  BFD for PW             : unavailable
  manual fault           : not set
  active state           : <strong>active</strong>
  forwarding entry       : exist
  link state             : up
  local VC MTU           : 1500         remote VC MTU        : 0
  local VCCV             : alert lsp-ping bfd
  remote VCCV            : alert lsp-ping bfd
  local control word     : disable      remote control word  : disable
  tunnel policy name     : --
  traffic behavior name  : --
  PW template name       : --
  primary or secondary   : primary
  VC tunnel/token info   : 1 tunnels/tokens
    NO.0  TNL type : lsp   , TNL ID : 0x40800b
  create time            : 0 days, 0 hours, 20 minutes, 27 seconds
  up time                : 0 days, 0 hours, 6 minutes, 33 seconds
  last change time       : 0 days, 0 hours, 6 minutes, 33 seconds
  VC last up time        : 2010/02/21 17:42:25
  VC total up time       : 0 days, 0 hours, 14 minutes, 38 seconds
  CKey                   : 8
  NKey                   : 7                
  </pre>
<p>Run the <strong>display acr-dcr slot 0 card 1 recovery-domain 1</strong> command on PE1. If <strong>Master PW State</strong> is displayed as <strong>lock</strong> in the command output, PE1 has traced the clock transmitted by PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display acr-dcr slot 0 card 1 recovery-domain 1</strong></pre>
<pre class="screen">Domain info
  ----------------------------------------------------------
  E1 count:  1
  Master PW SerialPort:Serial<span>0/1/0</span>:1,    Channel ID:404
  Master PW state: <strong>lock</strong>

  E1 info
  ----------------------------------------------------------
  E1 number:20,   Port:E1 <span>0/1/0</span>,   Direction:2,
      PW SerialPortName:Serial<span>0/1/0</span>:1,   Channel ID:404      
      PW count:1</pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001779081110__1.3.5"></a><a name="1.3.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>PE1 configuration file</p>
<pre class="screen">#
sysname PE1
#
mpls lsr-id 2.2.2.2
mpls
#
mpls l2vpn
#
mpls ldp
#
mpls ldp remote-peer 3.3.3.3
 remote-ip 3.3.3.3 
#
clock source cesacr slot 0 card 1 recovery-domain 1 synchronization enable
clock source cesacr slot 0 card 1 recovery-domain 1 ssm prc
clock source cesacr slot 0 card 1 recovery-domain 1 priority 1
#
controller e1 <span>0/1/0</span>
using ce1
channel-set 1 timeslot-list 1-31
clock recovery-domain 1
undo shutdown
#
interface serial<span>0/1/0</span>:1
link-protocol tdm
mpls l2vc 3.3.3.3 100 control-word tdm-encapsulation-number 8
undo shutdown
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.1.1.1 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack0
 ip address 2.2.2.2 255.255.255.255
#
ospf 1
area 0.0.0.0
  network 2.2.2.2 0.0.0.0
  network 10.1.1.0 0.0.0.255
#
return
</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#
sysname PE2
#
mpls lsr-id 3.3.3.3
mpls
#
mpls l2vpn
#
mpls ldp
#
mpls ldp remote-peer 2.2.2.2
 remote-ip 2.2.2.2
#
interface GigabitEthernet<span>0/2/1</span>
 undo shutdown
 ip address 10.2.2.2 255.255.255.0
 mpls
 mpls ldp
#
controller e1 <span>0/1/0</span>
using ce1
channel-set 1 timeslot-list 1-31
clock recovery-domain 1
undo shutdown
#
interface Serial<span>0/1/0</span>:1                                                       
 link-protocol tdm                                                              
 mpls l2vc 2.2.2.2 100 control-word tdm-encapsulation-number 8                                               
 undo shutdown
#
interface LoopBack0
 ip address 3.3.3.3 255.255.255.255
#
ospf 1
 area 0.0.0.0
  network 3.3.3.3 0.0.0.0
  network 10.2.2.0 0.0.0.255
#
return
</pre>
</li><li><p>P configuration file</p>
<pre class="screen">#
sysname P
#
mpls lsr-id 4.4.4.4
mpls
#
mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.1.1.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/1</span>
 undo shutdown
 ip address 10.2.2.1 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack0
 ip address 4.4.4.4 255.255.255.255
#
ospf 1
 area 0.0.0.0
  network 4.4.4.4 0.0.0.0
  network 10.1.1.0 0.0.0.255
  network 10.2.2.0 0.0.0.255
#
return
</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/cesacr_configuration.html">CES ACR Configuration
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_clock_cfg_5017.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>
</body>
</html>