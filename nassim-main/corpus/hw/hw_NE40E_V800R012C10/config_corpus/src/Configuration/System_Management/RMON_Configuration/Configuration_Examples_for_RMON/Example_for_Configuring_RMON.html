
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring RMON">
<meta name="abstract" content="When the volume of traffic on an interface exceeds a configured upper threshold, an alarm is sent to the NMS.">
<meta name="description" content="When the volume of traffic on an interface exceeds a configured upper threshold, an alarm is sent to the NMS.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_rmon_cfg_0009.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,w00437000,w00556928,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="RMON">
<meta name="featuretype" content="System Management">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="RMON">
<meta name="featuretype" content="System Management">
<meta name="featurename" content="RMON">
<meta name="featuretype" content="System Management">
<meta name="featurename" content="RMON">
<meta name="OWNER" content="j00655225">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="j00655225">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172361439">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring RMON</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172361439"></a><a name="EN-US_TASK_0172361439"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring RMON</h1>
<div class="taskbody"><p>When the volume of traffic on an interface exceeds a configured upper threshold, an alarm is sent to the NMS.</p>
<div class="context"><a name="EN-US_TASK_0172361439__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0172361439__fig_dc_vrp_rmon_cfg_001001">Figure 1</a>, the subnet connected to GE <span>0/3/0</span> of the <span class="keyword">Device</span> needs to be monitored, including:</p>
<ul><li><p>Collect real-time and historical statistics about various packets.</p>
</li><li><p>Monitor broadcast and multicast traffic on the subnet and enable the alarm function for the total number of broadcast and multicast packets. When the total number of broadcast and multicast packets exceeds the configured threshold, the system actively reports alarm information to the NMS.</p>
</li></ul>
<div class="fignone" id="EN-US_TASK_0172361439__fig_dc_vrp_rmon_cfg_001001"><a name="EN-US_TASK_0172361439__fig_dc_vrp_rmon_cfg_001001"></a><a name="fig_dc_vrp_rmon_cfg_001001"></a><span class="figcap"><b>Figure 1 </b>Networking diagram for configuring RMON</span><br><span><img class="vsd" src="images/fig_dc_vrp_rmon_cfg_001001.png" width="NaN" height="NaN"></span></div>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interface 1 and Interface 2 in this example are GE <span>0/1/0</span> and GE <span>0/3/0</span> respectively.</p>
</div></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172361439__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Ensure that the <span class="keyword">Router</span> and NMS are reachable.</p>
</li><li><p>Configure SNMP and community names and ensure that the <span class="keyword">Router</span> can send trap messages to the NMS.</p>
</li><li><p>Configure the RMON statistics function and collect traffic statistics on interfaces.</p>
</li><li><p>Configure the RMON alarm function so that a trap message is sent to the NMS when the sampling value exceeds the set threshold.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172361439__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>Index (1) of the RMON statistics function</p>
</li><li><p>Owner (userA) for the RMON statistics function</p>
</li><li><p>Sampling interval (30 seconds)</p>
</li><li><p>Index (1) of the RMON alarm function</p>
</li><li><p>OID ID (1.3.6.1.2.1.2.2.1.4.3) of a monitored object</p>
</li><li><p>Upper threshold (1000) and lower threshold (100) for triggering an event</p>
</li><li><p>Owner (userA) for the RMON alarm function</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172361439__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure the <span class="keyword">Router</span> and the NMS to be reachable.</span></li><li><span>Configure the <span class="keyword">Router</span> to send trap messages to the NMS.</span><p><p># Enable SNMP to send trap messages to the NMS.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname <span class="keyword">Device</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>] <strong>snmp-agent</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>] <strong>snmp-agent trap enable</strong></pre>
<p># Configure the <span class="keyword">Router</span> to send trap messages to the specified NMS.</p>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>] <strong>snmp-agent target-host trap address udp-domain 10.1.1.1 params securityname public</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>] <strong>commit</strong></pre>
</p></li><li><span>Configure the RMON statistics function.</span><p><p># Enable the RMON statistics function.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>] <strong>interface gigabitethernet <span>0/3/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>-GigabitEthernet<span>0/3/0</span>]<strong> rmon-statistics enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>-GigabitEthernet<span>0/3/0</span>]<strong> commit</strong></pre>
<p># Configure the Ethernet statistics function.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>-GigabitEthernet<span>0/3/0</span>] <strong>rmon statistics 1 owner userA</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>-GigabitEthernet<span>0/3/0</span>] <strong>commit</strong></pre>
<p># Configure the historical traffic sampling function to sample the traffic on the subnet at an interval of 30 seconds and save the 10 most recent historical entries.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>-GigabitEthernet<span>0/3/0</span>]<strong> rmon history 1 buckets 10 interval 30 owner userA</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>-GigabitEthernet<span>0/3/0</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>-GigabitEthernet<span>0/3/0</span>]<strong> quit</strong></pre>
</p></li><li><span>Configure the RMON alarm function.</span><p><p># Configure the <span class="keyword">Router</span> to send trap messages to the NMS when RMON event 1 occurs.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>] <strong>rmon event 1 description alarmofinterface trap public owner userA</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>] <strong>commit</strong></pre>
<p># Set a sampling interval and thresholds for triggering event 1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>] <strong>rmon alarm 1 1.3.6.1.2.1.2.2.1.4.3 5 absolute rising-threshold 1000 1 falling-threshold 100 1 owner userA</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>] <strong>quit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p># Check data traffic information on the subnet.</p>
<pre class="screen">&lt;<span class="keyword">Device</span>&gt; <strong>display rmon statistics gigabitethernet <span>0/3/0</span></strong></pre>
<pre class="screen">Statistics entry 1 owned by userA is valid.
  Interface : GigabitEthernet<span>0/3/0</span>&lt;ifEntry.402653698&gt;
  Received  :
  Octets              :4294966296, Packets:316091
  Broadcast packets   :311839    , Multicast packets:666
  Undersize packets   :0         , Oversize packets :0
  Fragments packets   :0         , Jabbers packets  :0
  CRC alignment errors:0         , Collisions       :0
  Dropped packets (insufficient resources):0
  Packets received according to length (octets):
  64     :0         ,  65-127  :0         ,  128-255  :0
  256-511:0         ,  512-1023:0         ,  1024-1518:0</pre>
<p># Check historical sampling records.</p>
<pre class="screen">&lt;<span class="keyword">Device</span>&gt; <strong>display rmon history gigabitethernet <span>0/3/0</span></strong></pre>
<pre class="screen">History control entry 1 owned by userA is valid
  Sampled interface     : GigabitEthernet<span>0/3/0</span>&lt;ifEntry.402653698&gt;
  Sampling interval     : 30(sec) with 10 buckets max
  Last Sampling time    : 0days 05h:17m:26s.30th
  Latest sampled values :
  Octets               :1000      , Packets           :100
  Broadcast packets    :100       , Multicast packets :100
  Undersize packets    :0         , Oversize packets  :0
  Fragments packets    :0         , Jabbers packets   :0
  CRC alignment errors :0         , Collisions        :0
  Dropped packet       :0         , Utilization       :0
  History record:

  Record No.1 (Sample time: 0days 05h:13m:56s.56th)
  Octets               :1000      , Packets           :100
  Broadcast packets    :100       , Multicast packets :100
  Undersize packets    :0         , Oversize packets  :0
  Fragments packets    :0         , Jabbers packets   :0
  CRC alignment errors :0         , Collisions        :0
  Dropped packets       :0         , Utilization       :0</pre>
<p># Check RMON event information.</p>
<pre class="screen">&lt;<span class="keyword">Device</span>&gt; <strong>display rmon event</strong></pre>
<pre class="screen">Event table 1 owned by userA is valid.
  Description: alarmofinterface.
  Will cause snmp-trap when triggered, last triggered at 1days 04h:00m:00s.04th</pre>
<p># Check RMON alarm configurations.</p>
<pre class="screen">&lt;<span class="keyword">Device</span>&gt; <strong>display rmon alarm 1</strong></pre>
<pre class="screen">Alarm table 1 owned by userA is valid.
 Samples absolute value : 1.3.6.1.2.1.2.2.1.4.3
 Sampling interval    : 5(sec)
 Rising threshold     : 1000(linked with event 1)
 Falling threshold    : 100(linked with event 1)
 When startup enables : risingOrFallingAlarm
 Latest value         : 1500</pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172361439__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><pre class="screen">#
sysname <span class="keyword">Device</span>
#
interface GigabitEthernet<span>0/1/0</span>

 undo shutdown
 ip address 10.2.2.1 255.255.255.0
interface GigabitEthernet<span>0/3/0</span>
 undo shutdown
 ip address 10.3.3.1 255.255.255.0
 rmon-statistics enable
 rmon statistics 1 owner userA
 rmon history 1 buckets 10 interval 30 owner userA
#
ip route-static 10.1.1.0 255.255.255.0 10.2.2.2
#
snmp-agent
#
snmp-agent target-host trap address udp-domain 10.1.1.1 params securityname public
#
snmp-agent trap enable
#
rmon event 1 description alarmofinterface trap public owner userA
rmon alarm 1 1.3.6.1.2.1.2.2.1.4.3 5 absolute rising-threshold 1000 1 falling-threshold 100 1 owner userA
#
return</pre>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_rmon_cfg_0009.html">Configuration Examples for RMON
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
</div>
</div>
</body>
</html>