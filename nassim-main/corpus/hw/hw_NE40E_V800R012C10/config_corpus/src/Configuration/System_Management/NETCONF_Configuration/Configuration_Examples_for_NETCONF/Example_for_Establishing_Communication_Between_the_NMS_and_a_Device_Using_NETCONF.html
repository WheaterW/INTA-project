
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Establishing Communication Between the NMS and a Device Using NETCONF">
<meta name="abstract" content="This section provides an example for logging in to the server from the client using the NMS to perform remote configuration management.">
<meta name="description" content="This section provides an example for logging in to the server from the client using the NMS to perform remote configuration management.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_netconf_cfg_0008.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="netconf,w00800033,w00437000,w00556928,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="NETCONF">
<meta name="featuretype" content="System Management">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="NETCONF">
<meta name="featuretype" content="System Management">
<meta name="featurename" content="NETCONF">
<meta name="featuretype" content="System Management">
<meta name="featurename" content="NETCONF">
<meta name="featuretype" content="System Management">
<meta name="OWNER" content="lwx1238418,l00587852">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="m00915594">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0139427580">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Establishing Communication Between the NMS and a Device Using NETCONF</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0139427580"></a><a name="EN-US_TASK_0139427580"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Establishing Communication Between the NMS and a Device Using NETCONF</h1>
<div class="taskbody"><p>This section provides an example for logging in to the server from the client using the NMS to perform remote configuration management.</p>
<div class="context"><a name="EN-US_TASK_0139427580__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>NETCONF ensures security and extensibility. When the NMS is used to manage network devices, you can use NETCONF to ensure communication between the NMS and the devices. </p>
<p>As shown in <a href="#EN-US_TASK_0139427580__fig_dc_vrp_netconf_cfg_000901">Figure 1</a>, <span>the NMS is deployed on the client that functions as the SSH client. The server functions as the SSH server that receives connection requests from and establishes the connection with the SSH client. SSH is a security protocol at the application layer, enhancing the reliability of NETCONF. In this networking, NETCONF is used to manage the configuration of the SSH server.</span></p>
<div class="fignone" id="EN-US_TASK_0139427580__fig_dc_vrp_netconf_cfg_000901"><a name="EN-US_TASK_0139427580__fig_dc_vrp_netconf_cfg_000901"></a><a name="fig_dc_vrp_netconf_cfg_000901"></a><span class="figcap"><b>Figure 1 </b>Using NETCONF to manage the configuration</span><br><span><img class="vsd" src="images/fig_dc_vrp_netconf_cfg_000901.png" width="NaN" height="NaN"></span></div>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface1 represents <span>GigabitEthernet0/0/0</span>.</p>
</div></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0139427580__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Precautions</h4><p>An SSH user named client001 is used as an example. If the password authentication mode is used to authentication the SSH user, the server needs to generate an Elliptic Curves Cryptography (ECC) key.</p>
</div></div>
<div class="context"><a name="EN-US_TASK_0139427580__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li>Configure an IP address for the server port connecting to the NMS so that the Layer 3 route between the client and server is reachable.</li><li>Configure virtual type terminal (VTY) user interfaces on the server to support SSH so that SSH users can be managed and monitored with better connection security.</li><li><p>Deploy SSH on the server to improve NETCONF security.</p>
<ol type="a"><li>Create an SSH user with administrator rights.</li><li>Create an ECC key pair.</li><li>Configure an authentication mode for the SSH user.</li><li>Configure a service type for the SSH user.</li></ol>
</li><li>Enable NETCONF so that the client can connect to the server.</li><li>Deploy the NMS on the client to implement NMS-based network management on the client.</li><li><p>Log in to the server using the NMS to manage the configuration remotely.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0139427580__1.4.4"></a><a name="1.4.4"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>SSH username and authentication mode</p>
</li><li><p>SSH user password</p>
</li><li><p>SSH server name</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0139427580__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure an IP address for the server port connecting to the NMS.</span><p><pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname netconf-agent</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>netconf-agent] <strong>interface <span>GigabitEthernet0/0/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>netconf-agent-<span>GigabitEthernet0/0/0</span>] <strong>ip address 10.1.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>netconf-agent-<span>GigabitEthernet0/0/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>netconf-agent-<span>GigabitEthernet0/0/0</span>] <strong>quit</strong></pre>
</p></li><li><span>Configure VTY user interfaces on the server to support SSH.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>netconf-agent] <strong>user-interface vty 0 4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>netconf-agent-ui-vty0-4] <strong>authentication-mode aaa</strong></pre>
<pre class="screen">[<span class="keyword">*</span>netconf-agent-ui-vty0-4] <strong>protocol inbound ssh</strong></pre>
<pre class="screen">[<span class="keyword">*</span>netconf-agent-ui-vty0-4] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>netconf-agent-ui-vty0-4] <strong>quit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>After SSH is configured, the device automatically disables the Telnet function.</p>
</div></div>
</p></li><li><span>Deploy SSH on the server.</span><p><ol type="a"><li><p>Create an SSH user.</p>
<p># Create an SSH user named <strong>Client001</strong> and set the user password to <strong>YsHsjx_202206</strong>. </p>
<pre class="screen">[<span class="keyword">*</span>netconf-agent] <strong>aaa</strong></pre>
<pre class="screen">[<span class="keyword">*</span>netconf-agent-aaa] <strong>local-user client001 password</strong><strong> irreversible-cipher YsHsjx_202206</strong></pre>
<pre class="screen">[<span class="keyword">*</span>netconf-agent-aaa] <strong>local-user client001 user-group manage-ug</strong></pre>
<pre class="screen">[<span class="keyword">*</span>netconf-agent-aaa] <strong>local-user client001 service-type ssh</strong></pre>
<pre class="screen">[<span class="keyword">*</span>netconf-agent-aaa] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>netconf-agent-aaa] <strong>quit</strong></pre>
</li><li><p>Create an ECC key pair.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>netconf-agent] <strong>ecc local-key-pair create</strong></pre>
<pre class="screen">The key name will be: <span class="keyword">HUAWEI</span>_Host_ECC
% ECC keys defined for <span class="keyword">HUAWEI</span>_Host_ECC already exist.
Confirm to replace them? Please select [Y/N]: <strong>Y</strong>
The public key size should be (256/384/521).
NOTE: If the key modulus is greater than 256,
      it will take a few minutes.
Input the bits(256/384/521) in the modulus [default = 521] : 256</pre>
<pre class="screen">[<span class="keyword">*</span>netconf-agent] <strong>commit</strong></pre>
<p>After the ECC key pair is created, run the <a href="cmdqueryname=display+ecc+local-key-pair+public"><b><span class="cmdname">display ecc local-key-pair public</span></b></a> command to view information about the public key in the ECC key pair.</p>
</li><li><p>Configure an authentication mode for the SSH user.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>netconf-agent] <strong>ssh user client001 authentication-type password</strong></pre>
<pre class="screen">[<span class="keyword">*</span>netconf-agent] <strong>commit</strong></pre>
</li><li><p>Configure a service type for the SSH user.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>netconf-agent] <strong>ssh user client001 service-type all</strong></pre>
<pre class="screen">[<span class="keyword">*</span>netconf-agent] <strong>commit</strong></pre>
</li></ol>
</p></li><li><span>Enable NETCONF on the server.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>netconf-agent] <strong>snetconf server enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>netconf-agent] <strong>commit</strong></pre>
</p></li><li><span>Deploy the NMS on the client.</span><p><p>For installation and maintenance of the NMS, see the relevant installation instruction and usage guidelines.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0139427580__en-us_task_0139427575_p1003876343214021">If the Huawei NMS is used, creating NEs will consume specific upgrade licenses or NE resource licenses. If there are no remaining NE resources or specific upgrade licenses, the system displays a message indicating that an NE fails to be created. If this occurs, apply for NE resources or specific upgrade licenses.</p>
</div></div>
</p></li><li><span>Log in to the server from the client using the NMS.</span><p><p>For login to remote devices using the NMS, see the relevant usage guide of the NMS.</p>
<p>If a Huawei NMS is used, contact Huawei technical personnel for the NMS operation manual.</p>
</p></li><li><span>Verify the configuration.</span><p><p>After the preceding configuration is complete, you can log in to the remote device using NETCONF to manage its configuration remotely.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>All the following operations are performed on the SSH server.</p>
</div></div>
<p># Run the <a href="cmdqueryname=display+users"><b><span class="cmdname">display users</span></b></a> command to view information about users who have logged in to the server.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>netconf-agent] <strong>display users</strong></pre>
<pre class="screen">  User-Intf    Delay    Type   Network Address     AuthenStatus    AuthorcmdFlag
  100 NCA 0   00:02:50  SSH    10.2.2.2            pass            yes          Username : client001</pre>
<p># Run the <a href="cmdqueryname=display+ssh+user-information"><b><span class="cmdname">display ssh user-information</span></b></a> command to view SSH user information.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>netconf-agent] <strong>display ssh user-information</strong></pre>
<pre class="screen">--------------------------------------------------------------------------------
User Name             : client001
Authentication-Type   : password
User-public-key-name  : -
User-public-key-type  : -
Sftp-directory        : -
Service-type          : <strong>snetconf</strong>
--------------------------------------------------------------------------------
Total 1, 1 printed</pre>
<p># Run the <a href="cmdqueryname=display+local-user+user-group+manage-ug"><b><span class="cmdname">display local-user user-group manage-ug</span></b></a> command to view information about local users in user group.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>netconf-agent] <strong>display local-user user-group manage-ug</strong></pre>
<pre class="screen">---------------------------------------------------------------------
Username                         State   Type   Access-limit   Online
---------------------------------------------------------------------
client001                        Active  S                No        1
---------------------------------------------------------------------
Total 1, 1 printed</pre>
<pre class="screen">---------------------------------------------------------------------
Type: F - Ftp, T - Telnet, M - Terminal, S - Ssh
---------------------------------------------------------------------------------------------------
Username                         State   Type   Access-limit   Online   Admin-level   User-group-id 
---------------------------------------------------------------------------------------------------
client001                        Active  S              - No        1             3               1</pre>
<p># Run the <a href="cmdqueryname=display+ssh+server+status"><b><span class="cmdname">display ssh server status</span></b></a> command to view global configuration of the SSH server.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>netconf-agent] <strong>display ssh server status</strong></pre>
<pre class="screen">SSH Version                                : 2.0
SSH authentication timeout (Seconds)       : 60
SSH authentication retries (Times)         : 3
SSH server key generating interval (Hours) : 0
SSH version 1.x compatibility              : Enable
SSH server keepalive                       : Disable
SFTP IPv4 server                           : Disable
SFTP IPv6 server                           : Disable
STELNET IPv4 server                        : Enable
STELNET IPv6 server                        : Enable
SNETCONF IPv4 server                       : Enable
SNETCONF IPv6 server                       : Enable
SNETCONF IPv4 server port(830)             : Disable
SNETCONF IPv6 server port(830)             : Disable
SCP IPv4 server                            : Enable
SCP IPv6 server                            : Enable
SSH port forwarding                        : Disable
SSH IPv4 server port                       : 22
SSH IPv6 server port                       : 22
ACL name                                   :
ACL number                                 :
ACL6 name                                  : 
ACL6 number                                :
SSH server ip-block                        : Enable</pre>
<p># Run the <a href="cmdqueryname=display+netconf+capability"><b><span class="cmdname">display netconf capability</span></b></a> command to check the capabilities that the server supports.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>netconf-agent] <strong>display netconf capability</strong></pre>
<pre class="screen">--------------------------------------------------
Capability                                        
--------------------------------------------------
urn:ietf:params:netconf:base:1.0                  
urn:ietf:params:netconf:base:1.1                  
urn:ietf:params:netconf:capability:writable-running:1.0
urn:ietf:params:netconf:capability:candidate:1.0  
urn:ietf:params:netconf:capability:confirmed-commit:1.0
urn:ietf:params:netconf:capability:confirmed-commit:1.1
urn:ietf:params:netconf:capability:rollback-on-error:1.0
urn:ietf:params:netconf:capability:validate:1.0   
urn:ietf:params:netconf:capability:validate:1.1   
urn:ietf:params:netconf:capability:startup:1.0    
urn:ietf:params:netconf:capability:url:1.0?scheme=file,ftp,sftp
urn:ietf:params:netconf:capability:xpath:1.0      
urn:ietf:params:netconf:capability:notification:1.0
urn:ietf:params:netconf:capability:interleave:1.0 
urn:ietf:params:netconf:capability:with-defaults:1.0?basic-mode=report-all&amp;also-supported=report-all-tagged,trim
urn:ietf:params:netconf:capability:yang-library:1.0?revision=2016-06-21&amp;module-set-id=1903662584
--------------------------------------------------</pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0139427580__1.4.6"></a><a name="1.4.6"></a><h4 class="sectiontitle">Configuration Files</h4><pre class="screen">#
sysname netconf-agent
#
aaa
 local-user client001 password irreversible-cipher @%@%U|,(X4rFC)8izE%,QHz:$(|s@%@%
 local-user client001 service-type ssh
 local-user client001 user-group manage-ug
#
interface <span>GigabitEthernet0/0/0</span>
 undo shutdown
 ip address 10.1.1.1 255.255.255.255
#
<span>snetconf server enable
</span>ssh user client001
ssh user client001 authentication-type password
ssh user client001 service-type all
#
user-interface vty 0 4
 authentication-mode aaa
 protocol inbound ssh
#
return</pre>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_netconf_cfg_0008.html">Configuration Examples for NETCONF
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
</div>
</div>
</body>
</html>