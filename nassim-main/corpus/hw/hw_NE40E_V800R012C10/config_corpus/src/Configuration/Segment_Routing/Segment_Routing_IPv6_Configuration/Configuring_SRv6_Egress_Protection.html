
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring SRv6 Egress Protection">
<meta name="abstract" content="This section describes how to configure SRv6 egress protection to enhance SRv6 network reliability.">
<meta name="description" content="This section describes how to configure SRv6 egress protection to enhance SRv6 network reliability.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_srv6_cfg_all_0000.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_srv6_cfg_all_0240.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_srv6_cfg_all_0107.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featurename" content="EVPN">
<meta name="featurename" content="Segment Routing IPv6">
<meta name="featurename" content="Segment Routing IPv6 Policy">
<meta name="featurename" content="Segment Routing Policy">
<meta name="featuretype" content="Segment Routing">
<meta name="featuretype" content="VPN">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featurename" content="EVPN">
<meta name="featurename" content="Segment Routing IPv6">
<meta name="featurename" content="Segment Routing IPv6 Policy">
<meta name="featurename" content="Segment Routing Policy">
<meta name="featuretype" content="Segment Routing">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="Segment Routing IPv6">
<meta name="featuretype" content="Segment Routing">
<meta name="OWNER" content="l00425560">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00587852">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0181945495">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/thickbox.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/imageResize.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery-migrate-1.2.1.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery-ui.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery.mousewheel.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/thickbox.js"></script>
<title>Configuring SRv6 Egress Protection</title>
</head>
<body><a name="EN-US_TASK_0181945495"></a><a name="EN-US_TASK_0181945495"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring SRv6 Egress Protection</h1>
<div class="taskbody"><p>This section describes how to configure SRv6 egress protection to enhance SRv6 network reliability.</p>
<div class="context"><a name="EN-US_TASK_0181945495__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Pre-configuration Tasks</h4><p>Before configuring SRv6 egress protection, configure an IGP to implement network layer connectivity</p>
</div></div>
<div class="context"><a name="EN-US_TASK_0181945495__1.4.2"></a><a name="1.4.2"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>Services that recurse to an SRv6 TE Policy must be strictly forwarded through the path defined using the segment lists in the SRv6 TE Policy. In addition, given that the egress of the SRv6 TE Policy is fixed, service forwarding may fail if a single point of failure occurs on the egress. To prevent this problem, configure egress protection for the SRv6 TE Policy.</p>
<div class="p"><a href="#EN-US_TASK_0181945495__en-us_concept_0197816692_fig828945452518">Figure 1</a> shows a typical SRv6 egress protection scenario where an SRv6 TE Policy is deployed between PE3 and PE1. PE1 is the egress of the SRv6 TE Policy, and PE2 provides protection for PE1 to enhance reliability.<div class="fignone" id="EN-US_TASK_0181945495__en-us_concept_0197816692_fig828945452518"><a name="EN-US_TASK_0181945495__en-us_concept_0197816692_fig828945452518"></a><a name="en-us_concept_0197816692_fig828945452518"></a><span class="figcap"><b>Figure 1 </b>SRv6 egress protection</span><br><span><img class="imgResize" id="EN-US_TASK_0181945495__en-us_concept_0197816692_image11290195414257" src="figure/en-us_image_0250627161.png" width="500.48814375" height="419.89263750000003" title="Click to enlarge"></span></div>
</div>
<div class="p">SRv6 egress protection is implemented as follows:<ol id="EN-US_TASK_0181945495__en-us_concept_0197816692_ol11702645123714"><li id="EN-US_TASK_0181945495__en-us_concept_0197816692_li1645850164412">Locators 2001:DB8:A1::/64 and 2001:DB8:A2::/64 are configured on PE1 and PE2, respectively.</li><li id="EN-US_TASK_0181945495__en-us_concept_0197816692_li44511501447">An IPv6 VPNv4 peer relationship is established between PE3 and PE1, and another one is established between PE2 and PE1. A VPN instance <strong id="EN-US_TASK_0181945495__en-us_concept_0197816692_b10688172715121">VPN1</strong> and SRv6 VPN SIDs are configured on both PE1 and PE2. In addition, IPv4 prefix SID advertisement is enabled on the two PEs.</li><li id="EN-US_TASK_0181945495__en-us_concept_0197816692_li15461450204411">After receiving the VPN route advertised by CE2, PE1 encapsulates the route as a VPNv4 route and sends it to PE3. The route carries the VPN SID, RT, RD, and color information.</li><li id="EN-US_TASK_0181945495__en-us_concept_0197816692_li4461150154417">An End.M SID is configured on PE2 to protect PE1, generating an &lt;End.M SID, Locator&gt; mapping entry (for example, &lt;2001:DB8:A2::100, 2001:DB8:A1::&gt;).</li><li id="EN-US_TASK_0181945495__en-us_concept_0197816692_li84625094411">PE2 propagates the End.M SID through an IGP and generates a local SID entry. After receiving the End.M SID, P1 generates an FRR entry in which the next-hop address is PE2 and the action is <strong id="EN-US_TASK_0181945495__en-us_concept_0197816692_b419421862418">Push </strong><em id="EN-US_TASK_0181945495__en-us_concept_0197816692_i52001318192410">End.M SID</em>. In addition, P1 generates a low-priority route that cannot be recursed.</li><li id="EN-US_TASK_0181945495__en-us_concept_0197816692_li947145016446">BGP subscribes to End.M SID configuration. After receiving the VPNv4 route from PE1, PE2 leaks the route into the routing table of <strong id="EN-US_TASK_0181945495__en-us_concept_0197816692_b0685114678">VPN1</strong> based on the RT, and matches the VPN SID carried by the route against the local &lt;End.M SID, Locator&gt; table. If a matching locator is found according to the longest match rule, PE2 generates a &lt;Remote SRv6 VPN SID, VPN&gt; entry.</li></ol>
</div>
<div class="p">In the data forwarding phase:<ol id="EN-US_TASK_0181945495__en-us_concept_0197816692_ol1184501318383"><li id="EN-US_TASK_0181945495__en-us_concept_0197816692_li1121812552444">In normal situations, PE3 forwards traffic to the private network through the PE3-P1-PE1-CE2 path. If PE1 fails, P1 detects that the next hop PE1 is unreachable and switches traffic to the FRR path.</li><li id="EN-US_TASK_0181945495__en-us_concept_0197816692_li1621835512447">P1 pushes the End.M SID into the packet header and forwards the packet to PE2. After parsing the received packet, PE2 obtains the End.M SID, queries the local SID table, and finds that the instruction specified by the End.M SID is to query the remote SRv6 VPN SID table. As instructed, PE2 queries the remote SRv6 VPN SID table based on the VPN SID in the packet and finds the corresponding VPN instance. PE2 then searches the VPN routing table and forwards the packet to CE2.</li></ol>
</div>
<p>If PE1 fails, the peer relationship between PE2 and PE1 is interrupted. As a result, PE2 deletes the VPN route received from PE1, causing the &lt;Remote SRv6 VPN SID, VPN&gt; entry to be deleted on PE2. To prevent this, you can enable GR on PE2 and PE1 to maintain routes. Alternatively, enable delayed deletion (currently enabled by default) for the &lt;Remote SRv6 VPN SID, VPN&gt; entry on PE2.</p>
</div></div>
<div class="steps"><a name="EN-US_TASK_0181945495__1.4.3"></a><a name="1.4.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure an SRv6 TE Policy along the PE3-P1-PE1 path.</span><p><p>For details about the configuration, see <a href="dc_vrp_srv6_cfg_all_0110.html">Configuring an SRv6 TE Policy (Manual Configuration + IS-IS as an IGP)</a> and <a href="dc_vrp_srv6_cfg_all_0116.html">Configuring an SRv6 TE Policy (Dynamic Delivery by a Controller + IS-IS as an IGP)</a>.</p>
</p></li><li><span>Configure services to recurse to the SRv6 TE Policy.</span><p><p>Supported service types include BGP L3VPN, EVPN L3VPN, EVPN VPWS, and EVPN VPLS. For details about the configuration, see <a href="dc_vrp_srv6_cfg_all_0131.html">Configuring SRv6 TE Policy Services</a>.</p>
</p></li><li><span>Configure protection on PE2.</span><ol type="a"><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=segment-routing+ipv6"><b><span class="cmdname">segment-routing ipv6</span></b></a></span><p><p>SRv6 is enabled, and the SRv6 view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=locator"><b><span class="cmdname">locator</span></b></a> <i><span class="varname">locator-name</span></i> [ <strong><span>ipv6-prefix</span></strong> <i><span class="varname">ipv6-address</span></i> <i><span class="varname">prefix-length</span></i> [ <strong><span>static</span></strong> <i><span class="varname">static-length</span></i> | <strong><span>args</span></strong> <i><span class="varname">args-length</span></i> ] <sup>*</sup> ]</span></span><p><p>An SRv6 locator is configured.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=opcode"><b><span class="cmdname">opcode</span></b></a> <i><span class="varname">func-opcode</span></i> <strong><span>end-m</span></strong> <strong><span>mirror-locator</span></strong> <span><i><span class="varname">ipv6-address</span></i> <i><span class="varname">mask-length</span></i></span></span><p><p>An End.M SID opcode is configured, and the locator to be protected is specified.</p>
</p><p><p>You need to configure <a href="cmdqueryname=opcode"><b><span class="cmdname">opcode</span></b></a> <i><span class="varname">func-opcode</span></i> within the local locator range and use <strong><span>mirror-locator</span></strong> <span><i><span class="varname">ipv6-address</span></i> <span><i><span class="varname">mask-length</span></i></span></span> to specify the locator to be protected.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Exit the SRv6 locator view.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Exit the SRv6 view.</p>
</p></li></ol>
</li><li><span>Configure IPv6 IS-IS FRR on each P.</span><ol type="a"><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=isis"><b><span class="cmdname">isis</span></b></a> [ <i><span class="varname">process-id</span></i> ]</span><p><p>The IS-IS process is enabled, and the IS-IS view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ipv6+frr"><b><span class="cmdname">ipv6 frr</span></b></a></span><p><p>The IPv6 IS-IS FRR view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=loop-free-alternate"><b><span class="cmdname">loop-free-alternate</span></b></a> [ <strong><span>level-1</span></strong> | <strong><span>level-2</span></strong> | <strong><span>level-1-2</span></strong> ]</span><p><p>IPv6 IS-IS FRR is enabled, so that a loop-free backup link is generated using the LFA algorithm.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li><span>Enable IPv6 IS-IS TI-LFA FRR and microloop avoidance on the PEs and Ps.</span><ol type="a"><li class="substepexpand"><span>Run <a href="cmdqueryname=isis"><b><span class="cmdname">isis</span></b></a> [ <i><span class="varname">process-id</span></i> ]</span><p><p>The IS-IS process is enabled, and the IS-IS view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=avoid-microloop+frr-protected"><b><span class="cmdname">avoid-microloop frr-protected</span></b></a></span><p><p>IS-IS local microloop avoidance is enabled.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=avoid-microloop+frr-protected+rib-update-delay"><b><span class="cmdname">avoid-microloop frr-protected rib-update-delay</span></b></a> <i><span class="varname">delay-interval</span></i></span><p><p>A delay in IS-IS route delivery is configured.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ipv6+avoid-microloop+segment-routing"><b><span class="cmdname">ipv6 avoid-microloop segment-routing</span></b></a></span><p><p>IS-IS remote microloop avoidance is enabled.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=ipv6+avoid-microloop+segment-routing+rib-update-delay"><b><span class="cmdname">ipv6 avoid-microloop segment-routing rib-update-delay</span></b></a> <i><span class="varname">rib-update-delay</span></i></span><p><p>A delay in SRv6 IS-IS route delivery is configured.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ipv6+frr"><b><span class="cmdname">ipv6 frr</span></b></a></span><p><p>The IPv6 IS-IS FRR view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=loop-free-alternate"><b><span class="cmdname">loop-free-alternate</span></b></a> [ <strong><span>level-1</span></strong> | <strong><span>level-2</span></strong> | <strong><span>level-1-2</span></strong> ]</span><p><p>IPv6 IS-IS FRR is enabled.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ti-lfa"><b><span class="cmdname">ti-lfa</span></b></a> [ <strong><span>level-1</span></strong> | <strong><span>level-2</span></strong> | <strong><span>level-1-2</span></strong> ]</span><p><p>IS-IS SRv6 TI-LFA is enabled.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li></ol></div>
<div class="example"><a name="EN-US_TASK_0181945495__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p>After configuring SRv6 egress protection, verify the configuration.</p>
<ul><li><p>Run the <a href="cmdqueryname=display+segment-routing+ipv6+local-sid"><b><span class="cmdname">display segment-routing ipv6 local-sid</span></b></a> <strong><span>end-m</span></strong> [ <i><span class="varname">sid-value</span></i> ] <strong><span>forwarding</span></strong> command to check information about local SIDs.</p>
</li><li><p>Run the <a href="cmdqueryname=display+ipv6+routing-table+vpn-instance"><b><span class="cmdname">display ipv6 routing-table vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i> command to check information about IPv6 VPN routes received from the remote end.</p>
</li><li>Run the <a href="cmdqueryname=display+bgp+remote+prefix-sid"><b><span class="cmdname">display bgp remote prefix-sid</span></b></a> command to check the mappings between remote prefix SIDs, End.M locator routes, and local VPN instances.</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_srv6_cfg_all_0000.html">Segment Routing IPv6 Configuration
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_srv6_cfg_all_0240.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_srv6_cfg_all_0107.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>

<script language="JavaScript">
<!--
image_size('.imgResize');
var msg_imageMax = "view original image";
var msg_imageClose = "close";
//--></script></body>
</html>