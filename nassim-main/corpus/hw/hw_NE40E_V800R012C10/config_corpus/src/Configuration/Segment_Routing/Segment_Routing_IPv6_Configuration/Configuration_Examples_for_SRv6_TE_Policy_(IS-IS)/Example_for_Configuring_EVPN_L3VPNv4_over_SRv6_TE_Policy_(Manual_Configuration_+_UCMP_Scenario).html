
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring EVPN L3VPNv4 over SRv6 TE Policy (Manual Configuration + UCMP Scenario)">
<meta name="abstract" content="This section provides an example for configuring an SRv6 TE Policy to carry EVPN L3VPNv4 services.">
<meta name="description" content="This section provides an example for configuring an SRv6 TE Policy to carry EVPN L3VPNv4 services.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_srv6_cfg_all_0101.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_srv6_cfg_all_0237a.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_srv6_cfg_all_0139.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featurename" content="EVPN">
<meta name="featurename" content="Segment Routing IPv6">
<meta name="featurename" content="Segment Routing IPv6 Policy">
<meta name="featurename" content="Segment Routing Policy">
<meta name="featuretype" content="Segment Routing">
<meta name="featuretype" content="VPN">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featurename" content="EVPN">
<meta name="featurename" content="Segment Routing IPv6">
<meta name="featurename" content="Segment Routing IPv6 Policy">
<meta name="featurename" content="Segment Routing Policy">
<meta name="featuretype" content="Segment Routing">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featurename" content="EVPN">
<meta name="featurename" content="Segment Routing IPv6">
<meta name="featurename" content="Segment Routing IPv6 Policy">
<meta name="featurename" content="Segment Routing Policy">
<meta name="featuretype" content="Segment Routing">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="Segment Routing IPv6">
<meta name="featuretype" content="Segment Routing">
<meta name="OWNER" content="l00587852">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00587852">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000002030829457">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>Example for Configuring EVPN L3VPNv4 over SRv6 TE Policy (Manual Configuration + UCMP Scenario)</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000002030829457"></a><a name="EN-US_TASK_0000002030829457"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring EVPN L3VPNv4 over SRv6 TE Policy (Manual Configuration + UCMP Scenario)</h1>
<div class="taskbody"><p>This section provides an example for configuring an SRv6 TE Policy to carry EVPN L3VPNv4 services.</p>
<div class="context"><a name="EN-US_TASK_0000002030829457__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0000002030829457__fig3691666259">Figure 1</a>, PEs and Ps are in the same AS and need to run IS-IS to implement IPv6 network connectivity.</p>
<p>Configure EVPN L3VPN services to recurse to SRv6 TE Policies to ensure secure communication between users in the same VPN. Because multiple links exist between the PEs, unequal-cost multiple path (UCMP) load balancing needs to be performed on these links.</p>
<div class="fignone" id="EN-US_TASK_0000002030829457__fig3691666259"><a name="EN-US_TASK_0000002030829457__fig3691666259"></a><a name="fig3691666259"></a><span class="figcap"><b>Figure 1 </b>EVPN L3VPNv4 over SRv6 TE Policy networking</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interfaces 1 through 4 represent GE<span>0/1/0</span>, GE<span>0/2/0</span>, GE<span>0/3/0</span>, and GE<span>0/1/8</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0000002030987825.png"></span></div>

<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" frame="border" border="1" rules="all"><caption><b>Table 1 </b></caption><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="26.512651265126514%" id="mcps1.4.1.5.2.4.1.1" liSelected="liSelected"><p>Device Name</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="40.15401540154016%" id="mcps1.4.1.5.2.4.1.2" liSelected="liSelected"><p>Interface Number</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="33.33333333333333%" id="mcps1.4.1.5.2.4.1.3" liSelected="liSelected"><p>Interface IP Address</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" valign="top" width="26.512651265126514%" headers="mcps1.4.1.5.2.4.1.1 "><p>PE1</p>
</td>
<td class="cellrowborder" valign="top" width="40.15401540154016%" headers="mcps1.4.1.5.2.4.1.2 "><p>GE<span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.5.2.4.1.3 "><p>10.1.1.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="26.512651265126514%" headers="mcps1.4.1.5.2.4.1.1 "><p>PE1</p>
</td>
<td class="cellrowborder" valign="top" width="40.15401540154016%" headers="mcps1.4.1.5.2.4.1.2 "><p>GE<span>0/2/0</span></p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.5.2.4.1.3 "><p>2001:DB8:12::1/96</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="26.512651265126514%" headers="mcps1.4.1.5.2.4.1.1 "><p>PE1</p>
</td>
<td class="cellrowborder" valign="top" width="40.15401540154016%" headers="mcps1.4.1.5.2.4.1.2 "><p>GE<span>0/3/0</span></p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.5.2.4.1.3 "><p>2001:DB8:13::1/96</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="26.512651265126514%" headers="mcps1.4.1.5.2.4.1.1 "><p>PE1</p>
</td>
<td class="cellrowborder" valign="top" width="40.15401540154016%" headers="mcps1.4.1.5.2.4.1.2 "><p>GE<span>0/1/8</span></p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.5.2.4.1.3 "><p>2001:DB8:14::1/96</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="26.512651265126514%" headers="mcps1.4.1.5.2.4.1.1 "><p>PE2</p>
</td>
<td class="cellrowborder" valign="top" width="40.15401540154016%" headers="mcps1.4.1.5.2.4.1.2 "><p>GE<span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.5.2.4.1.3 "><p>10.2.1.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="26.512651265126514%" headers="mcps1.4.1.5.2.4.1.1 "><p>PE2</p>
</td>
<td class="cellrowborder" valign="top" width="40.15401540154016%" headers="mcps1.4.1.5.2.4.1.2 "><p>GE<span>0/2/0</span></p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.5.2.4.1.3 "><p>2001:DB8:22::1/96</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="26.512651265126514%" headers="mcps1.4.1.5.2.4.1.1 "><p>PE2</p>
</td>
<td class="cellrowborder" valign="top" width="40.15401540154016%" headers="mcps1.4.1.5.2.4.1.2 "><p>GE<span>0/3/0</span></p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.5.2.4.1.3 "><p>2001:DB8:23::1/96</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="26.512651265126514%" headers="mcps1.4.1.5.2.4.1.1 "><p>PE2</p>
</td>
<td class="cellrowborder" valign="top" width="40.15401540154016%" headers="mcps1.4.1.5.2.4.1.2 "><p>GE<span>0/1/8</span></p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.5.2.4.1.3 "><p>2001:DB8:24::1/96</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="26.512651265126514%" headers="mcps1.4.1.5.2.4.1.1 "><p>P1</p>
</td>
<td class="cellrowborder" valign="top" width="40.15401540154016%" headers="mcps1.4.1.5.2.4.1.2 "><p>GE<span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.5.2.4.1.3 "><p>2001:DB8:12::2/96</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="26.512651265126514%" headers="mcps1.4.1.5.2.4.1.1 "><p>P1</p>
</td>
<td class="cellrowborder" valign="top" width="40.15401540154016%" headers="mcps1.4.1.5.2.4.1.2 "><p>GE<span>0/2/0</span></p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.5.2.4.1.3 "><p>2001:DB8:22::2/96</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="26.512651265126514%" headers="mcps1.4.1.5.2.4.1.1 "><p>P2</p>
</td>
<td class="cellrowborder" valign="top" width="40.15401540154016%" headers="mcps1.4.1.5.2.4.1.2 "><p>GE<span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.5.2.4.1.3 "><p>2001:DB8:13::2/96</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="26.512651265126514%" headers="mcps1.4.1.5.2.4.1.1 "><p>P2</p>
</td>
<td class="cellrowborder" valign="top" width="40.15401540154016%" headers="mcps1.4.1.5.2.4.1.2 "><p>GE<span>0/2/0</span></p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.5.2.4.1.3 "><p>2001:DB8:23::2/96</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="26.512651265126514%" headers="mcps1.4.1.5.2.4.1.1 "><p>P3</p>
</td>
<td class="cellrowborder" valign="top" width="40.15401540154016%" headers="mcps1.4.1.5.2.4.1.2 "><p>GE<span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.5.2.4.1.3 "><p>2001:DB8:14::2/96</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="26.512651265126514%" headers="mcps1.4.1.5.2.4.1.1 "><p>P3</p>
</td>
<td class="cellrowborder" valign="top" width="40.15401540154016%" headers="mcps1.4.1.5.2.4.1.2 "><p>GE<span>0/2/0</span></p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.5.2.4.1.3 "><p>2001:DB8:24::2/96</p>
</td>
</tr>
</tbody>
</table>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000002030829457__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Precautions</h4><ol id="EN-US_TASK_0000002030829457__en-us_task_0184674100_ol11781124152416"><li id="EN-US_TASK_0000002030829457__en-us_task_0184674100_li146921550112413">SRv6 TE Policy configuration requires End or End.X SIDs. The SIDs can either be configured manually or be generated dynamically using an IGP. In scenarios where SRv6 TE Policies are configured manually, dynamic SIDs used for the SRv6 TE Policies may change after an IGP restart. In this case, you need to manually adjust the SRv6 TE Policies so that they remain up. For this reason, dynamic SIDs are not suitable for large-scale use. You are therefore advised to configure SIDs manually and not to use dynamic SIDs.</li><li id="EN-US_TASK_0000002030829457__en-us_task_0184674100_li187812443242">To implement color-based traffic steering into SRv6 TE Policies, you need to configure the color attribute using an import or export route-policy. You also need to configure a tunnel policy to allow routes to recurse to SRv6 TE Policies.<p id="EN-US_TASK_0000002030829457__en-us_task_0184674100_p23977456248"><a name="EN-US_TASK_0000002030829457__en-us_task_0184674100_li187812443242"></a><a name="en-us_task_0184674100_li187812443242"></a>After the preceding configurations are complete, if the color and next hop of a route are the same as the color and endpoint of an SRv6 TE Policy, respectively, the route can successfully recurse to the SRv6 TE Policy. This enables the traffic forwarded through the route to be steered into the SRv6 TE Policy.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0000002030829457__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Enable IPv6 forwarding and configure IPv6 addresses for interfaces on PE1, the Ps, and PE2.</p>
</li><li><p>Enable IS-IS, configure an IS-IS level, and specify a network entity title on PE1, the Ps, and PE2.</p>
</li><li><p>Configure an EVPN L3VPN instance on each PE and bind the instance to an access-side interface.</p>
</li><li><p>Establish an EBGP peer relationship between each PE and its connected CE.</p>
</li><li><p>Establish a BGP EVPN peer relationship between the PEs.</p>
</li><li>Configure SRv6 SIDs and IS-IS SRv6 on PE1, the Ps, and PE2. In addition, enable PE1 and PE2 to add the SID attribute to the VPN routes to be advertised.</li><li><p>Deploy an SRv6 TE Policy between PE1 and PE2. In addition, configure three segment lists for the candidate path of the policy, and configure weights 50, 30, and 20, respectively, for these segment lists so that they work in UCMP mode.</p>
</li><li>Configure a tunnel policy on PE1 and PE2 to import VPN traffic.</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0000002030829457__1.4.4"></a><a name="1.4.4"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>IPv6 addresses of interfaces on PE1, the Ps, and PE2</p>
</li><li><p>IS-IS process IDs of PE1, the Ps, and PE2</p>
</li><li><p>IS-IS levels of PE1, the Ps, and PE2</p>
</li><li><p>VPN instance names, RDs, and RTs on PE1 and PE2</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000002030829457__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Enable IPv6 forwarding and configure IPv6 addresses for interfaces.</span><p><p># Configure PE1. The configurations of other devices are similar to the configuration of PE1. For detailed configurations, see Configuration Files.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname PE1</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface gigabitethernet <span>0/2/0</span></strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>ipv6 enable</strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>ipv6 address 2001:DB8:12::1 96</strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface gigabitethernet <span>0/3/0</span></strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/3/0</span>] <strong>ipv6 enable</strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/3/0</span>] <strong>ipv6 address 2001:DB8:13::1 96</strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/3/0</span>] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface gigabitethernet <span>0/1/8</span></strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/8</span>] <strong>ipv6 enable</strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/8</span>] <strong>ipv6 address 2001:DB8:14::1 96</strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/8</span>] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>interface LoopBack 1</strong>
[<span class="keyword">*</span>PE1-LoopBack1] <strong>ipv6 enable</strong>
[<span class="keyword">*</span>PE1-LoopBack1] <strong>ipv6 address 2001:DB8:1::1 128</strong>
[<span class="keyword">*</span>PE1-LoopBack1] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</p></li><li><span>Configure IS-IS.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>is-level level-1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>cost-style wide</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>network-entity 10.0000.0000.0001.00</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>ipv6 enable topology ipv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>isis ipv6 enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet <span>0/3/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/3/0</span>] <strong>isis ipv6 enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/3/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet <span>0/1/8</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/8</span>] <strong>isis ipv6 enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/8</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface loopback1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack1] <strong>isis ipv6 enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure P1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P1] <strong>isis 1</strong> </pre>
<pre class="screen">[<span class="keyword">*</span>P1-isis-1] <strong>is-level level-1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-isis-1] <strong>cost-style wide</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-isis-1] <strong>network-entity 10.0000.0000.0002.00</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-isis-1] <strong>ipv6 enable topology ipv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/1/0</span>] <strong>isis ipv6 enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1] <strong>interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/2/0</span>] <strong>isis ipv6 enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1] <strong>interface loopback1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-LoopBack1] <strong>isis ipv6 enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1] <strong>commit</strong></pre>
<p># Configure P2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P2] <strong>isis 1</strong> </pre>
<pre class="screen">[<span class="keyword">*</span>P2-isis-1] <strong>is-level level-1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-isis-1] <strong>cost-style wide</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-isis-1] <strong>network-entity 10.0000.0000.0003.00</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-isis-1] <strong>ipv6 enable topology ipv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/1/0</span>] <strong>isis ipv6 enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2] <strong>interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/2/0</span>] <strong>isis ipv6 enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2] <strong>interface loopback1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-LoopBack1] <strong>isis ipv6 enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2] <strong>commit</strong></pre>
<p># Configure P3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P3] <strong>isis 1</strong> </pre>
<pre class="screen">[<span class="keyword">*</span>P3-isis-1] <strong>is-level level-1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P3-isis-1] <strong>cost-style wide</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P3-isis-1] <strong>network-entity 10.0000.0000.0004.00</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P3-isis-1] <strong>ipv6 enable topology ipv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P3-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P3] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P3-GigabitEthernet<span>0/1/0</span>] <strong>isis ipv6 enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P3-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P3] <strong>interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P3-GigabitEthernet<span>0/2/0</span>] <strong>isis ipv6 enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P3-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P3] <strong>interface loopback1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P3-LoopBack1] <strong>isis ipv6 enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P3-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P3] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1] <strong>is-level level-1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1] <strong>cost-style wide</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1] <strong>network-entity 10.0000.0000.0005.00</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1] <strong>ipv6 enable topology ipv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>isis ipv6 enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>] <strong>isis ipv6 enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface gigabitethernet <span>0/3/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/3/0</span>] <strong>isis ipv6 enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/3/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface gigabitethernet <span>0/1/8</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/8</span>] <strong>isis ipv6 enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/8</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface loopback1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-LoopBack1] <strong>isis ipv6 enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</p><p><p>After completing the configurations, perform the following operations to check whether IS-IS is successfully configured.</p>
<p># Display IS-IS neighbor information. The following uses PE1 as an example.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display isis peer</strong></pre>
<pre class="screen">                          Peer information for ISIS(1)
                         
  System Id     Interface         Circuit Id        State HoldTime Type     PRI
--------------------------------------------------------------------------------
0000.0000.0002* GE<span>0/2/0</span>           0000.0000.0001.01  Up  29s       L1       64 
0000.0000.0002* GE<span>0/3/0</span>           0000.0000.0001.02  Up  25s       L1       64 
0000.0000.0002* GE<span>0/1/8</span>           0000.0000.0004.01  Up   8s       L1       64 

Total Peer(s): 1</pre>
</p></li><li><span>Configure an EVPN L3VPN instance on each PE and bind the instance to an access-side interface.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>ip vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpna] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpna-af-ipv4] <strong>route-distinguisher 100:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpna-af-ipv4] <strong>vpn-target 1:1 evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpna-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpna] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet<span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>ip binding vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>ip address 10.1.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>ip vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-vpna] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-vpna-af-ipv4] <strong>route-distinguisher 200:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-vpna-af-ipv4] <strong>vpn-target 1:1 evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-vpna-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-vpna] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface gigabitethernet<span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>] <strong>ip binding vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>] <strong>ip address 10.2.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</p></li><li><span>Establish an EBGP peer relationship between each PE and its connected CE.</span><p><p># Configure CE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>interface gigabitethernet</strong><strong><span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>] <strong>ip address 10.1.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>interface loopbacK 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-LoopBack1] <strong>ip address 10.11.1.1 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>bgp 65410</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp] <strong>router-id 10.11.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp] <strong>peer 10.1.1.2 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp] <strong>import-route direct</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>commit</strong></pre>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp] <strong>router-id 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>ipv4-family vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-vpna] <strong>peer 10.1.1.1 as-number 65410</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-vpna] <strong>import-route direct</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-vpna] <strong>advertise l2vpn evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-vpna] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp-vpna] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp] <strong>quit</strong></pre>
<p># Configure CE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>interface gigabitethernet</strong><strong><span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>] <strong>ip address 10.2.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-LoopBack1] <strong>ip address 10.22.2.2 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>bgp 65420</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-bgp] <strong>router-id </strong><strong>10.22.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-bgp] <strong>peer 10.2.1.2 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-bgp] <strong>import-route direct</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-bgp] <strong>router-id 5.5.5.5</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>ipv4-family vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-vpna] <strong>peer 10.2.1.1 as-number 65420</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-vpna] <strong>import-route direct</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-vpna] <strong>advertise l2vpn evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-vpna] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-bgp-vpna] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-bgp] <strong>quit</strong></pre>
<p>After completing the configurations, run the <strong>display bgp vpnv4 vpn-instance peer</strong> command on the PEs to check whether BGP peer relationships have been established between the PEs and CEs. The command output shows that the BGP peer relationships have been established between the PEs and CEs and are in the <strong>Established</strong> state.</p>
<p>The following uses the peer relationship between PE1 and CE1 as an example.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display bgp vpnv4 vpn-instance vpna peer</strong>
 BGP local router ID : 1.1.1.1                                                  
 Local AS number : 100      

 VPN-Instance vpna, Router ID 1.1.1.1:                                          
 Total number of peers : 1                 Peers in established state : 1       

  Peer            V          AS  MsgRcvd  MsgSent  OutQ  Up/Down       State  PrefRcv          
  10.1.1.1        4       65410        9       10     0 00:39:40 <strong>Established</strong>        2 </pre>
</p></li><li><span>Establish a BGP EVPN peer relationship between the PEs.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp] <strong>peer 2001:DB8:5::5 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 2001:DB8:5::5 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>l2vpn-family evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-evpn] <strong>peer 2001:DB8:5::5 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-bgp] <strong>peer 2001:DB8:1::1 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>peer 2001:DB8:1::1 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>l2vpn-family evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-evpn] <strong>peer 2001:DB8:1::1 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p>After completing the configurations, run the <strong>display bgp evpn peer</strong> command on the PEs to check whether a BGP EVPN peer relationship has been established between the PEs. If the <strong>Established</strong> state is displayed in the command output, the BGP EVPN peer relationship has been established successfully.</p>
<p>The following example uses the command output on PE1.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE1] <strong>display bgp evpn peer</strong>

 BGP local router ID : 1.1.1.1
 Local AS number : 100
 Total number of peers : 1                 Peers in established state : 1

  Peer                             V          AS  MsgRcvd  MsgSent  OutQ  Up/Down       State  PrefRcv
  2001:DB8:5::5                    4         100       49       49     0 00:30:41 <strong>Established</strong>        2</pre>
</p></li><li><span>Configure SRv6 SIDs and enable the PEs to add the SID attribute to the VPN routes to be advertised.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>segment-routing ipv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing-ipv6] <strong>encapsulation source-address 2001:DB8:1::</strong><strong>1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing-ipv6] <strong>locator PE1 ipv6-prefix 2001:DB8:100:: 64 static 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing-ipv6-locator] <strong>opcode ::10 end</strong><span> <strong>psp</strong></span></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing-ipv6-locator] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>l2vpn-family evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-evpn] <strong>peer 2001:DB8:5::5 advertise encap-type srv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>ipv4-family vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-vpna] <strong>segment-routing ipv6</strong><strong> </strong><strong>traffic-engineer</strong><strong> best-effort</strong><strong> evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-vpna] <strong>segment-routing ipv6 locator PE1</strong><strong> evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-vpna] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp-vpna] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-isis-1] <strong>segment-routing ipv6 locator PE1 auto-sid-disable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-isis-1] <strong>quit</strong></pre>
<p># Configure P1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P1] <strong>segment-routing ipv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-segment-routing-ipv6] <strong>encapsulation source-address 2001:DB8:2::2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-segment-routing-ipv6] <strong>locator P1 ipv6-prefix 2001:DB8:120:: 64 static 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-segment-routing-ipv6-locator] <strong>opcode ::20 end</strong><span> <strong>psp</strong></span></pre>
<pre class="screen">[<span class="keyword">*</span>P1-segment-routing-ipv6-locator] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-segment-routing-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-isis-1] <strong>segment-routing ipv6 locator P1</strong><strong> auto-sid-disable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-isis-1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P1-isis-1] <strong>quit</strong></pre>
<p># Configure P2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P2] <strong>segment-routing ipv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-segment-routing-ipv6] <strong>encapsulation source-address 2001:DB8:3::3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-segment-routing-ipv6] <strong>locator P2 ipv6-prefix 2001:DB8:130:: 64 static 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-segment-routing-ipv6-locator] <strong>opcode ::30 end</strong><span> <strong>psp</strong></span></pre>
<pre class="screen">[<span class="keyword">*</span>P2-segment-routing-ipv6-locator] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-segment-routing-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-isis-1] <strong>segment-routing ipv6 locator P2</strong><strong> auto-sid-disable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-isis-1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P2-isis-1] <strong>quit</strong></pre>
<p># Configure P3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P3] <strong>segment-routing ipv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P3-segment-routing-ipv6] <strong>encapsulation source-address 2001:DB8:4::4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P3-segment-routing-ipv6] <strong>locator P3 ipv6-prefix 2001:DB8:140:: 64 static 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P3-segment-routing-ipv6-locator] <strong>opcode ::40 end</strong><span> <strong>psp</strong></span></pre>
<pre class="screen">[<span class="keyword">*</span>P3-segment-routing-ipv6-locator] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P3-segment-routing-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P3] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P3-isis-1] <strong>segment-routing ipv6 locator P3</strong><strong> auto-sid-disable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P3-isis-1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P3-isis-1] <strong>quit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>segment-routing ipv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-segment-routing-ipv6] <strong>encapsulation source-address 2001:DB8:5::5</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-segment-routing-ipv6] <strong>locator PE2 ipv6-prefix 2001:DB8:150:: 64 static 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-segment-routing-ipv6-locator] <strong>opcode ::50 end</strong><span> <strong>psp</strong></span></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-segment-routing-ipv6-locator] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-segment-routing-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>l2vpn-family evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-evpn] <strong>peer 2001:DB8:1::1 advertise encap-type srv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>ipv4-family vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-vpna] <strong>segment-routing ipv6</strong><strong> </strong><strong>traffic-engineer</strong><strong> best-effort evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-vpna] <strong>segment-routing ipv6 locator PE2 evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-vpna] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-bgp-vpna] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-isis-1] <strong>segment-routing ipv6 locator PE2 auto-sid-disable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-isis-1] <strong>quit</strong></pre>
<p>Run the <a href="cmdqueryname=display+segment-routing+ipv6+local-sid"><b><span class="cmdname">display segment-routing ipv6 local-sid</span></b></a> <strong><span>end</span></strong> <strong><span>forwarding</span></strong> command to check information about the SRv6 local SID table.</p>
<p>The following uses PE1 as an example.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display segment-routing ipv6 local-sid end forwarding</strong>
                    My Local-SID End Forwarding Table
                    ---------------------------------

SID         : 2001:DB8:100::10/128                         FuncType    : End
Flavor      : PSP                                          SidCompress : NO
LocatorName : PE1                                          LocatorID   : 1
ProtocolType: STATIC                                       ProcessID   : --
UpdateTime  : 2021-08-30 01:46:05.713

Total SID(s): 1</pre>
</p></li><li><span>Configure an SRv6 TE Policy.</span><p><p># Configure PE1.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE1] <strong>segment-routing ipv6</strong> 
[<font style="font-size:8pt" Face="Courier New" >~</font>PE1-segment-routing-ipv6] <strong>segment-list list1</strong>
[*PE1-segment-routing-ipv6-segment-list-list1] <strong>index 5 sid ipv6 2001:DB8:120::20</strong>
[*PE1-segment-routing-ipv6-segment-list-list1] <strong>index 10 sid ipv6 2001:DB8:150::50</strong>
[*PE1-segment-routing-ipv6-segment-list-list1] <strong>quit</strong>
[*PE1-segment-routing-ipv6] <strong>segment-list list2</strong>
[*PE1-segment-routing-ipv6-segment-list-list2] <strong>index 5 sid ipv6 2001:DB8:130::30</strong>
[*PE1-segment-routing-ipv6-segment-list-list2] <strong>index 10 sid ipv6 2001:DB8:150::50</strong>
[*PE1-segment-routing-ipv6-segment-list-list2] <strong>quit</strong>
[*PE1-segment-routing-ipv6] <strong>segment-list list3</strong>
[*PE1-segment-routing-ipv6-segment-list-list3] <strong>index 5 sid ipv6 2001:DB8:140::40</strong>
[*PE1-segment-routing-ipv6-segment-list-list3] <strong>index 10 sid ipv6 2001:DB8:150::50</strong>
[*PE1-segment-routing-ipv6-segment-list-list3] <strong>commit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>PE1-segment-routing-ipv6-segment-list-list3] <strong>quit</strong>
[*PE1-segment-routing-ipv6] <strong>srv6-te policy policy1 endpoint 2001:DB8:5::5 color 101</strong>
[*PE1-segment-routing-ipv6-policy-policy1] <strong>candidate-path preference 100</strong>
[*PE1-segment-routing-ipv6-policy-policy1-path] <strong>segment-list list1</strong> <strong>weight 50</strong>
[*PE1-segment-routing-ipv6-policy-policy1-path] <strong>segment-list list2</strong> <strong>weight 30</strong>
[*PE1-segment-routing-ipv6-policy-policy1-path] <strong>segment-list list3</strong> <strong>weight 20</strong>
[*PE1-segment-routing-ipv6-policy-policy1-path] <strong>commit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>PE1-segment-routing-ipv6-policy-policy1-path] <strong>quit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>PE1-segment-routing-ipv6-policy-policy1] <strong>quit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>PE1-segment-routing-ipv6] <strong>quit</strong></pre>
</p><p><p># Configure PE2.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE2] <strong>segment-routing ipv6</strong> 
[<font style="font-size:8pt" Face="Courier New" >~</font>PE2-segment-routing-ipv6] <strong>segment-list list1</strong> 
[*PE2-segment-routing-ipv6-segment-list-list1] <strong>index 5 sid ipv6 2001:DB8:120::20</strong>
[*PE2-segment-routing-ipv6-segment-list-list1] <strong>index 10 sid ipv6 2001:DB8:100::10</strong>
[*PE2-segment-routing-ipv6-segment-list-list1] <strong>quit</strong>
[*PE2-segment-routing-ipv6] <strong>segment-list list2</strong> 
[*PE2-segment-routing-ipv6-segment-list-list2] <strong>index 5 sid ipv6 2001:DB8:130::30</strong>
[*PE2-segment-routing-ipv6-segment-list-list2] <strong>index 10 sid ipv6 2001:DB8:100::10</strong>
[*PE2-segment-routing-ipv6-segment-list-list2] <strong>quit</strong>
[*PE2-segment-routing-ipv6] <strong>segment-list list3</strong> 
[*PE2-segment-routing-ipv6-segment-list-list3] <strong>index 5 sid ipv6 2001:DB8:140::40</strong>
[*PE2-segment-routing-ipv6-segment-list-list3] <strong>index 10 sid ipv6 2001:DB8:100::10</strong>
[*PE2-segment-routing-ipv6-segment-list-list3] <strong>commit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>PE2-segment-routing-ipv6-segment-list-list3] <strong>quit</strong>
[*PE2-segment-routing-ipv6] <strong>srv6-te policy policy1 endpoint 2001:DB8:1::1 color 101</strong>
[*PE2-segment-routing-ipv6-policy-policy1] <strong>candidate-path preference 100</strong>
[*PE2-segment-routing-ipv6-policy-policy1-path] <strong>segment-list list1</strong> <strong>weight 50</strong> 
[*PE2-segment-routing-ipv6-policy-policy1-path] <strong>segment-list list2</strong> <strong>weight 30</strong>
[*PE2-segment-routing-ipv6-policy-policy1-path] <strong>segment-list list3</strong> <strong>weight 20</strong>
[*PE2-segment-routing-ipv6-policy-policy1-path] <strong>commit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>PE2-segment-routing-ipv6-policy-policy1-path] <strong>quit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>PE2-segment-routing-ipv6-policy-policy1] <strong>quit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>PE2-segment-routing-ipv6] <strong>quit</strong></pre>
<p>After completing the configurations, run the <a href="cmdqueryname=display+srv6-te+policy"><b><span class="cmdname">display srv6-te policy</span></b></a> command to check SRv6 TE Policy information.</p>
<p>The following example uses the command output on PE1.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE1] <strong>display srv6-te policy </strong>
PolicyName : policy1
Color                   : 101                            Endpoint             : 2001:DB8:5::5
TunnelId                : 1                              
TunnelType              : SRv6-TE Policy                 DelayTimerRemain     : -
Policy State            : Up                             State Change Time    : 2020-12-30 07:02:14
Admin State             : Up                             Traffic Statistics   : Disable
Backup Hot-Standby      : Disable                        BFD                  : Disable
Interface Index         : -                              Interface Name       : - 
Interface State         : -                              Encapsulation Mode   : Insert
Binding SID             : -
Candidate-path Count    : 1                   

 Candidate-path Preference : 100
 Path State             : Active                         Path Type            : Primary
 Protocol-Origin        : Configuration(30)              Originator           : 0, 0.0.0.0
 Discriminator          : 100                            Binding SID          : -
 GroupId                : 1                              Policy Name          : policy1
 Template ID            : 0                              Path Verification    : Disable
 DelayTimerRemain       : -                              Network Slice ID     : -
 Segment-List Count     : 3
  Segment-List          : list1
   Segment-List ID      : 1                              XcIndex              : 1  
   List State           : Up                             DelayTimerRemain     : -  
   Verification State   : -                              SuppressTimeRemain   : -
   PMTU                 : 9600                           Active PMTU          : 9600
   Weight               : 50                             BFD State            : - 
   Loop Detection State : Up                             BFD Delay Remain     : - 
   Network Slice ID     : -
   Binding SID          : -
   Reverse Binding ID   : -
   SID :  
         2001:DB8:120::20
         2001:DB8:150::50
  Segment-List          : list2
   Segment-List ID      : 2                              XcIndex              : 2  
   List State           : Up                             DelayTimerRemain     : -  
   Verification State   : -                              SuppressTimeRemain   : -
   PMTU                 : 9600                           Active PMTU          : 9600
   Weight               : 3                              BFD State            : - 
   Loop Detection State : Up                             BFD Delay Remain     : - 
   Network Slice ID     : -
   Binding SID          : -
   Reverse Binding ID   : -
   SID :  
         2001:DB8:130::30
         2001:DB8:150::50
  Segment-List          : list3
   Segment-List ID      : 3                              XcIndex              : 3  
   List State           : Up                             DelayTimerRemain     : -  
   Verification State   : -                              SuppressTimeRemain   : -
   PMTU                 : 9600                           Active PMTU          : 9600
   Weight               : 20                             BFD State            : - 
   Loop Detection State : Up                             BFD Delay Remain     : - 
   Network Slice ID     : -
   Binding SID          : -
   Reverse Binding ID   : -
   SID :  
         2001:DB8:140::40
         2001:DB8:150::50</pre>
</p></li><li><span>Configure a tunnel policy to import VPN traffic.</span><p><p># Configure PE1.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE1] <strong>route-policy p1 permit node 10</strong>
[*PE1-route-policy] <strong>apply extcommunity color 0:101</strong>
[*PE1-route-policy] <strong>quit</strong>
[*PE1] <strong>bgp 100</strong>
[*PE1-bgp] <strong>l2vpn-family evpn</strong>
[*PE1-bgp-af-evpn] <strong>peer 2001:DB8:5::5 route-policy p1 import</strong> 
[*PE1-bgp-af-evpn] <strong>quit</strong>
[*PE1-bgp] <strong>quit</strong>
[*PE1] <strong>tunnel-policy p1</strong>
[*PE1-tunnel-policy-p1] <strong>tunnel select-seq ipv6 srv6-te-policy load-balance-number 1</strong>
[*PE1-tunnel-policy-p1] <strong>quit</strong>
[*PE1] <strong>ip vpn-instance vpna</strong>
[*PE1-vpn-instance-vpna] <strong>ipv4-family</strong>
[*PE1-vpn-instance-vpna-af-ipv4] <strong>tnl-policy p1 evpn</strong>
[*PE1-vpn-instance-vpna-af-ipv4] <strong>commit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>PE1-vpn-instance-vpna-af-ipv4] <strong>quit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>PE1-vpn-instance-vpna] <strong>quit</strong></pre>
</p><p><p># Configure PE2.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE2] <strong>route-policy p1 permit node 10</strong>
[*PE2-route-policy] <strong>apply extcommunity color 0:101</strong>
[*PE2-route-policy] <strong>quit</strong>
[*PE2] <strong>bgp 100</strong>
[*PE2-bgp] <strong>l2vpn-family evpn</strong>
[*PE2-bgp-af-evpn] <strong>peer 2001:DB8:1::1 route-policy p1 import</strong> 
[*PE2-bgp-af-evpn] <strong>quit</strong>
[*PE2-bgp] <strong>quit</strong>
[*PE2] <strong>tunnel-policy p1</strong>
[*PE2-tunnel-policy-p1] <strong>tunnel select-seq ipv6 srv6-te-policy load-balance-number 1</strong>
[*PE2-tunnel-policy-p1] <strong>quit</strong>
[*PE2] <strong>ip vpn-instance vpna</strong>
[*PE2-vpn-instance-vpna] <strong>ipv4-family</strong>
[*PE2-vpn-instance-vpna-af-ipv4] <strong>tnl-policy p1 evpn</strong>
[*PE2-vpn-instance-vpna-af-ipv4] <strong>commit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>PE2-vpn-instance-vpna-af-ipv4] <strong>quit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>PE2-vpn-instance-vpna] <strong>quit</strong></pre>
<p>After completing the configurations, run the <strong>display ip routing-table vpn-instance vpna</strong> command to check the IPv4 routing table of the specified VPN instance. The command output shows that the VPN route has successfully recursed to the SRv6 TE Policy.</p>
<p>The following example uses the command output on PE1.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE1] <strong>display ip routing-table vpn-instance vpna</strong>
Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route                 
------------------------------------------------------------------------------  
Routing Table : vpna        
         Destinations : 8        Routes : 8                                     

Destination/Mask    Proto   Pre  Cost        Flags NextHop         Interface    

       10.1.1.0/24  Direct  0    0             D   10.1.1.2        GigabitEthernet<span>0/1/0</span>
       10.1.1.2/32  Direct  0    0             D   127.0.0.1       GigabitEthernet<span>0/1/0</span>
     10.1.1.255/32  Direct  0    0             D   127.0.0.1       GigabitEthernet<span>0/1/0</span>
       10.2.1.0/24  IBGP    255  0             RD  2001:DB8:5::5   policy1 
      10.11.1.1/32  EBGP    255  0             RD  10.1.1.1        GigabitEthernet<span>0/1/0</span>
      10.22.2.2/32  IBGP    255  0             RD  2001:DB8:5::5   <strong>policy1</strong>  
      127.0.0.0/8   Direct  0    0             D   127.0.0.1       InLoopBack0  
255.255.255.255/32  Direct  0    0             D   127.0.0.1       InLoopBack0  </pre>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE1] <strong>display ip routing-table vpn-instance vpna 10.22.2.2 verbose</strong> 
Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route 
------------------------------------------------------------------------------  
Routing Table : vpna        
Summary Count : 1           

Destination: 10.22.2.2/32    
     Protocol: IBGP               Process ID: 0                                 
   Preference: 255                      Cost: 0                                 
      NextHop: 2001:DB8:5::5       Neighbour: 2001:DB8:5::5                     
        State: Active Adv Relied         Age: 00h49m52s                         
          Tag: 0                    Priority: low                               
        Label: NULL                  QoSInfo: 0x0                               
   IndirectID: 0x10000DF            Instance:                                   
 RelayNextHop: ::                  Interface: <strong>policy1</strong>                    
     TunnelID: 0x000000003400000001    Flags: RD 
   RouteColor: 0 </pre>
</p></li><li><span>Verify the configuration.</span><p><p>Check that CEs belonging to the same VPN instance can ping each other. For example:</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>CE1] <strong>ping -a 10.11.1.1 10.22.2.2</strong>                                                 
  PING 22.2.2.2: 56  data bytes, press CTRL_C to break                          
    Reply from 10.22.2.2: bytes=56 Sequence=1 ttl=253 time=32 ms                 
    Reply from 10.22.2.2: bytes=56 Sequence=2 ttl=253 time=24 ms                 
    Reply from 10.22.2.2: bytes=56 Sequence=3 ttl=253 time=27 ms                 
    Reply from 10.22.2.2: bytes=56 Sequence=4 ttl=253 time=35 ms                 
    Reply from 10.22.2.2: bytes=56 Sequence=5 ttl=253 time=28 ms                 

  --- 10.22.2.2 ping statistics ---                                              
    5 packet(s) transmitted 
    5 packet(s) received    
    0.00% packet loss       
    round-trip min/avg/max = 24/29/35 ms </pre>
</p><p><p>Ping the SRv6 TE Policy from a PE. The command output shows that each segment list can be pinged.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE1]ping srv6-te policy  policy-name policy1
  PING srv6-te policy : 100  data bytes, press CTRL_C to break
  srv6-te policy's segment list:
  Preference: 100; Path Type: primary; Protocol-Origin: local; Originator: 0, 0.0.0.0; Discriminator: 100; Segment-List ID: 1; Xcindex: 1
    Reply from 2001:DB8:150::50
    bytes=100 Sequence=1 time=3 ms
    Reply from 2001:DB8:150::50
    bytes=100 Sequence=2 time=2 ms
    Reply from 2001:DB8:150::50
    bytes=100 Sequence=3 time=2 ms
    Reply from 2001:DB8:150::50
    bytes=100 Sequence=4 time=2 ms
    Reply from 2001:DB8:150::50
    bytes=100 Sequence=5 time=2 ms

  --- srv6-te policy ping statistics ---
    5 packet(s) transmitted
    5 packet(s) received
    0.00% packet loss
    round-trip min/avg/max = 2/2/3 ms

  srv6-te policy's segment list:
  Preference: 100; Path Type: primary; Protocol-Origin: local; Originator: 0, 0.0.0.0; Discriminator: 100; Segment-List ID: 2; Xcindex: 2
    Reply from 2001:DB8:150::50
    bytes=100 Sequence=1 time=3 ms
    Reply from 2001:DB8:150::50
    bytes=100 Sequence=2 time=2 ms
    Reply from 2001:DB8:150::50
    bytes=100 Sequence=3 time=2 ms
    Reply from 2001:DB8:150::50
    bytes=100 Sequence=4 time=2 ms
    Reply from 2001:DB8:150::50
    bytes=100 Sequence=5 time=2 ms

  --- srv6-te policy ping statistics ---
    5 packet(s) transmitted
    5 packet(s) received
    0.00% packet loss
    round-trip min/avg/max = 2/2/3 ms

  srv6-te policy's segment list:
  Preference: 100; Path Type: primary; Protocol-Origin: local; Originator: 0, 0.0.0.0; Discriminator: 100; Segment-List ID: 3; Xcindex: 3
    Reply from 2001:DB8:150::50
    bytes=100 Sequence=1 time=3 ms
    Reply from 2001:DB8:150::50
    bytes=100 Sequence=2 time=2 ms
    Reply from 2001:DB8:150::50
    bytes=100 Sequence=3 time=2 ms
    Reply from 2001:DB8:150::50
    bytes=100 Sequence=4 time=2 ms
    Reply from 2001:DB8:150::50
    bytes=100 Sequence=5 time=2 ms

  --- srv6-te policy ping statistics ---
    5 packet(s) transmitted
    5 packet(s) received
    0.00% packet loss
    round-trip min/avg/max = 2/2/3 ms</pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000002030829457__1.4.6"></a><a name="1.4.6"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>PE1 configuration file</p>
<pre class="screen">#
sysname PE1
#
ip vpn-instance vpna
 ipv4-family
  route-distinguisher 100:1
  apply-label per-instance
  vpn-target 1:1 export-extcommunity evpn
  vpn-target 1:1 import-extcommunity evpn
  tnl-policy p1 evpn      
#               
segment-routing ipv6
 encapsulation source-address 2001:DB8:1::1
 locator PE1 ipv6-prefix 2001:DB8:100:: 64 static 32
  opcode ::10 end<span> psp</span>
 segment-list list1
  index 5 sid ipv6 2001:DB8:120::20
  index 10 sid ipv6 2001:DB8:150::50
 segment-list list2
  index 5 sid ipv6 2001:DB8:130::30
  index 10 sid ipv6 2001:DB8:150::50
 segment-list list3
  index 5 sid ipv6 2001:DB8:140::40
  index 10 sid ipv6 2001:DB8:150::50
 srv6-te policy policy1 endpoint 2001:DB8:5::5 color 101
  candidate-path preference 100
   segment-list list1 weight 50
   segment-list list2 weight 30
   segment-list list3 weight 20
#               
isis 1          
 is-level level-1
 cost-style wide
 network-entity 10.0000.0000.0001.00
 #              
 ipv6 enable topology ipv6
 segment-routing ipv6 locator PE1 auto-sid-disable
 #              
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown  
 ip binding vpn-instance vpna
 ip address 10.1.1.2 255.255.255.0
#               
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown  
 ipv6 enable    
 ipv6 address 2001:DB8:12::1/96
 isis ipv6 enable 1 
#
interface GigabitEthernet<span>0/3/0</span>
 undo shutdown  
 ipv6 enable    
 ipv6 address 2001:DB8:13::1/96
 isis ipv6 enable 1 
#    
interface GigabitEthernet<span>0/1/8</span>
 undo shutdown  
 ipv6 enable    
 ipv6 address 2001:DB8:14::1/96
 isis ipv6 enable 1 
#    
interface LoopBack1
 ipv6 enable    
 ipv6 address 2001:DB8:1::1/128
 isis ipv6 enable 1
#               
bgp 100         
 router-id 1.1.1.1
 peer 2001:DB8:5::5 as-number 100
 peer 2001:DB8:5::5 connect-interface LoopBack1
 #              
 ipv4-family unicast
  undo synchronization
 #              
 ipv4-family vpn-instance vpna
  import-route direct
  advertise l2vpn evpn
  segment-routing ipv6 locator PE1 evpn
  segment-routing ipv6 traffic-engineer best-effort evpn
  peer 10.1.1.1 as-number 65410
 #              
 l2vpn-family evpn
  policy vpn-target
  peer 2001:DB8:5::5 enable
  peer 2001:DB8:5::5 route-policy p1 import
  peer 2001:DB8:5::5 advertise encap-type srv6
#               
route-policy p1 permit node 10
 apply extcommunity color 0:101
#               
tunnel-policy p1
 tunnel select-seq ipv6 srv6-te-policy load-balance-number 1
#               
return </pre>
</li><li><p>P1 configuration file</p>
<pre class="screen">#
sysname P1
#               
segment-routing ipv6
 encapsulation source-address 2001:DB8:2::2
 locator P1 ipv6-prefix 2001:DB8:120:: 64 static 32
  opcode ::20 end<span> psp</span>
#               
isis 1          
 is-level level-1
 cost-style wide
 network-entity 10.0000.0000.0002.00
 #              
 ipv6 enable topology ipv6
 segment-routing ipv6 locator P1 auto-sid-disable
 #              
#               
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown  
 ipv6 enable    
 ipv6 address 2001:DB8:12::2/96
 isis ipv6 enable 1
#               
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown  
 ipv6 enable    
 ipv6 address 2001:DB8:22::2/96
 isis ipv6 enable 1
#               
interface LoopBack1
 ipv6 enable    
 ipv6 address 2001:DB8:2::2/128
 isis ipv6 enable 1
#               
return </pre>
</li><li><p>P2 configuration file</p>
<pre class="screen">#
sysname P2
#               
segment-routing ipv6
 encapsulation source-address 2001:DB8:3::3
 locator P2 ipv6-prefix 2001:DB8:130:: 64 static 32
  opcode ::30 end<span> psp</span>
#               
isis 1          
 is-level level-1
 cost-style wide
 network-entity 10.0000.0000.0003.00
 #              
 ipv6 enable topology ipv6
 segment-routing ipv6 locator P2 auto-sid-disable
 #              
#               
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown  
 ipv6 enable    
 ipv6 address 2001:DB8:13::2/96
 isis ipv6 enable 1
#               
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown  
 ipv6 enable    
 ipv6 address 2001:DB8:23::2/96
 isis ipv6 enable 1
#               
interface LoopBack1
 ipv6 enable    
 ipv6 address 2001:DB8:3::3/128
 isis ipv6 enable 1
#               
return </pre>
</li><li><p>P3 configuration file</p>
<pre class="screen">#
sysname P3
#               
segment-routing ipv6
 encapsulation source-address 2001:DB8:4::4
 locator P3 ipv6-prefix 2001:DB8:140:: 64 static 32
  opcode ::40 end<span> psp</span>
#               
isis 1          
 is-level level-1
 cost-style wide
 network-entity 10.0000.0000.0004.00
 #              
 ipv6 enable topology ipv6
 segment-routing ipv6 locator P3 auto-sid-disable
 #              
#               
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown  
 ipv6 enable    
 ipv6 address 2001:DB8:14::2/96
 isis ipv6 enable 1
#               
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown  
 ipv6 enable    
 ipv6 address 2001:DB8:24::2/96
 isis ipv6 enable 1
#               
interface LoopBack1
 ipv6 enable    
 ipv6 address 2001:DB8:4::4/128
 isis ipv6 enable 1
#               
return </pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#
sysname PE2
#
ip vpn-instance vpna
 ipv4-family
  route-distinguisher 200:1
  apply-label per-instance
  vpn-target 1:1 export-extcommunity evpn
  vpn-target 1:1 import-extcommunity evpn
  tnl-policy p1 evpn        
#               
segment-routing ipv6
 encapsulation source-address 2001:DB8:5::5
 locator PE2 ipv6-prefix 2001:DB8:150:: 64 static 32
  opcode ::50 end<span> psp</span>
 segment-list list1
  index 5 sid ipv6 2001:DB8:120::20
  index 10 sid ipv6 2001:DB8:100::10
 segment-list list2
  index 5 sid ipv6 2001:DB8:130::30
  index 10 sid ipv6 2001:DB8:100::10
 segment-list list3
  index 5 sid ipv6 2001:DB8:140::40
  index 10 sid ipv6 2001:DB8:100::10
 srv6-te policy policy1 endpoint 2001:DB8:1::1 color 101
  candidate-path preference 100
   segment-list list1 weight 50
   segment-list list2 weight 30
   segment-list list3 weight 20
#               
isis 1          
 is-level level-1
 cost-style wide
 network-entity 10.0000.0000.0005.00
 #              
 ipv6 enable topology ipv6
 segment-routing ipv6 locator PE2 auto-sid-disable
 #              
#               
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown  
 ip binding vpn-instance vpna
 ip address 10.2.1.2 255.255.255.0 
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown  
 ipv6 enable    
 ipv6 address 2001:DB8:22::1/96
 isis ipv6 enable 1  
#               
interface GigabitEthernet<span>0/3/0</span>
 undo shutdown  
 ipv6 enable    
 ipv6 address 2001:DB8:23::1/96
 isis ipv6 enable 1  
#  
interface GigabitEthernet<span>0/1/8</span>
 undo shutdown  
 ipv6 enable    
 ipv6 address 2001:DB8:24::1/96
 isis ipv6 enable 1  
#      
interface LoopBack1
 ipv6 enable    
 ipv6 address 2001:DB8:5::5/128
 isis ipv6 enable 1
#               
bgp 100         
 router-id 5.5.5.5
 peer 2001:DB8:1::1 as-number 100
 peer 2001:DB8:1::1 connect-interface LoopBack1
 #              
 ipv4-family unicast
  undo synchronization
 #              
 ipv4-family vpn-instance vpna
  import-route direct
  advertise l2vpn evpn
  segment-routing ipv6 locator PE2 evpn
  segment-routing ipv6 traffic-engineer best-effort evpn
  peer 10.2.1.1 as-number 65420
 #              
 l2vpn-family evpn
  policy vpn-target
  peer 2001:DB8:1::1 enable
  peer 2001:DB8:1::1 route-policy p1 import
  peer 2001:DB8:1::1 advertise encap-type srv6
#               
route-policy p1 permit node 10
 apply extcommunity color 0:101
#               
tunnel-policy p1
 tunnel select-seq ipv6 srv6-te-policy load-balance-number 1
#               
return</pre>
</li><li><p>CE1 configuration file</p>
<pre class="screen">#
sysname CE1
#               
interface  GigabitEthernet<span>0/1/0</span>
 undo shutdown  
 ip address 10.1.1.1 255.255.255.0
#               
interface LoopBack1
 ip address 10.11.1.1 32
#               
bgp 65410       
 router-id 10.11.1.1
 peer 10.1.1.2 as-number 100
 #              
 ipv4-family unicast
  undo synchronization
  import-route direct
  peer 10.1.1.2 enable
#  
return </pre>
</li><li><p>CE2 configuration file</p>
<pre class="screen">#
sysname CE2
#               
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown  
 ip address 10.2.1.1 255.255.255.0
#               
interface LoopBack1
 ip address 10.22.2.2 32
#               
bgp 65420       
 router-id 10.22.2.2
 peer 10.2.1.2 as-number 100
 #              
 ipv4-family unicast
  undo synchronization
  import-route direct
  peer 10.2.1.2 enable
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_srv6_cfg_all_0101.html">Configuration Examples for SRv6 TE Policy (IS-IS)
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_srv6_cfg_all_0237a.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_srv6_cfg_all_0139.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>