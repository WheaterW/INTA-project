
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring IS-IS SR-MPLS BE over GRE">
<meta name="abstract" content="This section provides an example for configuring IS-IS SR-MPLS BE over GRE, which involves enabling IS-IS on each device, specifying network segments in different processes, configuring GRE tunnels, and enabling IS-IS SR-MPLS BE over GRE.">
<meta name="description" content="This section provides an example for configuring IS-IS SR-MPLS BE over GRE, which involves enabling IS-IS on each device, specifying network segments in different processes, configuring GRE tunnels, and enabling IS-IS SR-MPLS BE over GRE.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_sr-be_cfg_0007.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_sr_all_cfg_0251.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00606909,l00587852">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="Segment Routing MPLS">
<meta name="featuretype" content="Segment Routing">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="Segment Routing MPLS">
<meta name="featuretype" content="Segment Routing">
<meta name="featurename" content="Segment Routing MPLS">
<meta name="featuretype" content="Segment Routing">
<meta name="featurename" content="Segment Routing MPLS">
<meta name="featuretype" content="Segment Routing">
<meta name="OWNER" content="l00468467">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00468467">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001478015170">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/thickbox.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/imageResize.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery-migrate-1.2.1.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery-ui.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery.mousewheel.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/thickbox.js"></script>
<title>Example for Configuring IS-IS SR-MPLS BE over GRE</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001478015170"></a><a name="EN-US_TASK_0000001478015170"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring IS-IS SR-MPLS BE over GRE</h1>
<div class="taskbody"><p>This section provides an example for configuring IS-IS SR-MPLS BE over GRE, which involves enabling IS-IS on each device, specifying network segments in different processes, configuring GRE tunnels, and enabling IS-IS SR-MPLS BE over GRE.</p>
<div class="context"><a name="EN-US_TASK_0000001478015170__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0000001478015170__fig127031455165813">Figure 1</a>, enable IS-IS and configure SR-MPLS BE. In addition, set the cost of the GRE tunnel between DeviceA and DeviceB to 100 and that of the other links to 10. The optimal path from DeviceA to DeviceD is DeviceA â DeviceD. Configure TI-LFA FRR on DeviceA to implement local protection. In this way, if the link between DeviceA and DeviceD fails, traffic can be rapidly switched to the backup path DeviceA â DeviceB â DeviceC â DeviceD. The traffic between DeviceA and DeviceB is forwarded over a GRE tunnel, which is bound to the link DeviceA â DeviceE â DeviceF â DeviceB.</p>
<div class="fignone" id="EN-US_TASK_0000001478015170__fig127031455165813"><a name="EN-US_TASK_0000001478015170__fig127031455165813"></a><a name="fig127031455165813"></a><span class="figcap"><b>Figure 1 </b>Configuring IS-IS SR-MPLS BE over GRE</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 and 2 in this example represent GE<span>0/1/0</span> and GE<span>0/2/0</span>, respectively.</p>
</div></div>
<br><span><img class="imgResize" src="figure/en-us_image_0000001478174794.png" width="522.37828125" height="252.46761234187503" title="Click to enlarge"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001478015170__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Precautions</h4><p>None</p>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001478015170__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li>Configure IS-IS on the entire network to implement interworking between devices.</li><li>Configure SR and establish an SR-MPLS BE tunnel.</li><li>Establish a GRE tunnel between DeviceA and DeviceB and bind the tunnel to the other process.</li><li>Set costs for links to ensure that the link DeviceA â DeviceD is preferentially used for traffic forwarding.</li><li>Configure TI-LFA FRR.</li><li>Configure IS-IS SR-MPLS BE over GRE.</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001478015170__1.4.4"></a><a name="1.4.4"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li>DeviceA: subnets 10.1.1.0/24 and 10.7.1.0/24 for IS-IS process 1 and subnet 10.2.1.0/24 for IS-IS process 2</li><li>DeviceB: subnets 10.6.1.0/24 and 10.7.1.0/24 for IS-IS process 1 and subnet 10.4.1.0/24 for IS-IS process 2</li><li>DeviceC: subnets 10.6.1.0/24 and 10.5.1.0/24 for IS-IS process 1</li><li>DeviceD: subnets 10.1.1.0/24 and 10.5.1.0/24 for IS-IS process 1</li><li>DeviceE: subnets 10.2.1.0/24 and 10.3.1.0/24 for IS-IS process 2</li><li>DeviceF: subnets 10.3.1.0/24 and 10.4.1.0/24 for IS-IS process 2</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001478015170__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure IP addresses for interfaces.</span><p><p># Configure <span class="keyword">Device</span>A.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname <span class="keyword">Device</span>A</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>interface loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-LoopBack0] <strong>ip address 2.2.2.9 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-LoopBack0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A]<strong> interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/0</span>] <strong>ip address 10.2.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A]<strong> interface gigabitethernet<span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-GigabitEthernet<span>0/2/0</span>] <strong>ip address 10.1.1.2 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
<p>The configurations of other devices are similar to the configuration of <span class="keyword">Device</span>A. For configuration details, see the configuration files.</p>
</p></li><li><span>Configure IS-IS to implement interworking.</span><p><p># Configure <span class="keyword">Device</span>A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>isis 1 </strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-isis-1] <strong>network-entity 10.0000.0000.0001.00</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>isis 2 </strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-isis-2] <strong>network-entity 11.0000.0000.0021.00</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-isis-2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A]<strong> interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/0</span>] <strong>isis enable 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A]<strong> interface gigabitethernet<span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-GigabitEthernet<span>0/2/0</span>] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
<p>The configurations of other devices are similar to the configuration of <span class="keyword">Device</span>A. For configuration details, see the configuration files.</p>
</p></li><li><span>Configure SR and establish an SR-MPLS BE tunnel.</span><p><p># Configure <span class="keyword">Device</span>A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>segment-routing </strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-segment-routing] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-isis-1] <strong>cost-style wide</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-isis-1] <strong>segment-routing mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-isis-1] <strong>segment-routing global-block 16000 16999</strong> </pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-isis-1] <strong>quit</strong> </pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>interface LoopBack0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-LoopBack0] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-LoopBack0] <strong>isis prefix-sid index 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-LoopBack0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The SRGB range varies according to the device. The range specified in this example is for reference only.</p>
</div></div>
<p>The configurations of <span class="keyword">Device</span>B, <span class="keyword">Device</span>C, and <span class="keyword">Device</span>D are similar to the configuration of <span class="keyword">Device</span>A. For configuration details, see the configuration files.</p>
<p># After completing the configuration, run the <strong>display segment-routing prefix mpls forwarding</strong> command on each device. The command output shows that SR-MPLS BE LSPs have been established. DeviceA is used as an example.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>display segment-routing prefix mpls forwarding</strong></pre>
<pre class="screen">                 Segment Routing Prefix MPLS Forwarding Information
             --------------------------------------------------------------
             Role : I-Ingress, T-Transit, E-Egress, I&amp;T-Ingress And Transit
 
Prefix             Label      OutLabel   Interface         NextHop          Role  MPLSMtu   Mtu     State          
------------------------------------------------------------------------------------------------------------
2.2.2.9/32        16100      NULL       Loop0            127.0.0.1        E     ---       1500    Active          
5.5.5.9/32        16200      19200      GE<span>0/2/0</span>          10.1.1.1         I&amp;T   ---       1500    Active          
6.6.6.9/32        16300      19300      GE<span>0/2/0</span>          10.1.1.1         I&amp;T   ---       1500    Active          
1.1.1.9/32        16400      3          GE<span>0/2/0</span>          10.1.1.1         I&amp;T   ---       1500    Active          </pre>
</p></li><li><span>Establish a GRE tunnel.</span><p><p># Configure <span class="keyword">Device</span>A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>interface Tunnel1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-Tunnel1] <strong>ip address 10.7.1.1</strong><strong> 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-Tunnel1] <strong>tunnel-protocol gre</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-Tunnel1] <strong>source 10.2.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-Tunnel1] <strong>destination 10.4.1.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-Tunnel1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A]<strong> interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/0</span>] <strong>binding tunnel gre</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
<p># Configure <span class="keyword">Device</span>B.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>interface Tunnel1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-Tunnel1] <strong>ip address 10.7.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-Tunnel1] <strong>tunnel-protocol gre</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-Tunnel1] <strong>source 10.4.1.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-Tunnel1] <strong>destination 10.2.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-Tunnel1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B]<strong> interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/0</span>] <strong>binding tunnel gre</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>commit</strong></pre>
</p></li><li><span>Set costs for links to ensure that the link DeviceA â DeviceD is preferentially used for traffic forwarding.</span><p><p># Configure DeviceA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A]<strong> interface Tunnel1</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-Tunnel1] <strong>isis cost 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-Tunnel1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
<p>The configuration of DeviceB is similar to that of DeviceA. For configuration details, see the configuration file.</p>
</p></li><li><span>Configure TI-LFA FRR.</span><p><p># Configure <span class="keyword">Device</span>A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-isis-1] <strong>frr</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-isis-1-frr] <strong>loop-free-alternate</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-isis-1-frr] <strong>ti-lfa</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-isis-1-frr] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
</p></li><li><span>Configure SR-MPLS BE over GRE.</span><p><p># Configure <span class="keyword">Device</span>A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-isis-1] <strong>segment-routing mpls over gre</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
<p>The configuration of DeviceB is similar to that of DeviceA. For configuration details, see the configuration file.</p>
<p>After completing the configuration, run the <strong>display isis route</strong> command on DeviceA to check route information.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>display isis 1 route 1.1.1.9 verbose</strong>

                        Route information for ISIS(1)
                         -----------------------------

                        ISIS(1) Level-1 Forwarding Table
                        --------------------------------


 IPV4 Dest  : 1.1.1.9/32         Int. Cost : 10            Ext. Cost : NULL
 Admin Tag  : -                  Src Count : 1             Flags     : A/-/L/-
 Priority   : Medium             Age       : 00:25:36
 NextHop    :                    Interface :               ExitIndex :
    10.1.1.1                           GE<span>0/2/0</span>                   0x00000009
 TI-LFA:
 Interface  : Tun2
 NextHop    : 10.7.1.2            LsIndex    : --          ProtectType: L
 Backup Label Stack (Top -&gt; Bottom): {}


 Prefix-sid : 16400              Weight    : 0             Flags     : -/N/-/-/-/-/A/L
 SR NextHop :                    Interface :               OutLabel  :
    10.1.1.1                           GE<span>0/2/0</span>                   3
 TI-LFA:
 Interface  : Tun2
 NextHop    : 10.7.1.2            LsIndex    : --          ProtectType: L
 Backup Label Stack (Top -&gt; Bottom): {}

     Flags: D-Direct, A-Added to URT, L-Advertised in LSPs, S-IGP Shortcut,
            U-Up/Down Bit Set, LP-Local Prefix-Sid
     Protect Type: L-Link Protect, N-Node Protect


                        ISIS(1) Level-2 Forwarding Table
                        --------------------------------


 IPV4 Dest  : 1.1.1.9/32         Int. Cost : 10            Ext. Cost : NULL
 Admin Tag  : -                  Src Count : 3             Flags     : -/-/-/-
 Priority   : Medium             Age       : 00:00:00
 NextHop    :                    Interface :               ExitIndex :
                                       -                


     Flags: D-Direct, A-Added to URT, L-Advertised in LSPs, S-IGP Shortcut,
            U-Up/Down Bit Set, LP-Local Prefix-Sid
     Protect Type: L-Link Protect, N-Node Protect</pre>
<p>The command output shows that DeviceA has generated a backup link â which uses a GRE tunnel interface as the outbound interface â through FRR computation.</p>
</p></li><li><span>Verify the configuration.</span><p><p># Run the <strong>tracert</strong> command on <span class="keyword">Device</span>A to check the connectivity of the SR-MPLS BE tunnel to <span class="keyword">Device</span>D. For example:</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>tracert lsp segment-routing ip 1.1.1.9 32 version draft2</strong></pre>
<pre class="screen"> LSP Trace Route FEC: SEGMENT ROUTING IPV4 PREFIX 1.1.1.9/32 , press CTRL_C to break.
  TTL    Replier            Time    Type      Downstream
  0                                 Ingress   10.1.1.1/[3 ]
  1      1.1.1.9           9 ms    Egress  </pre>
<p># Run the <strong>shutdown</strong> command on GE<span>0/2/0</span> of <span class="keyword">Device</span>A to simulate a link failure between <span class="keyword">Device</span>A and <span class="keyword">Device</span>D.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A]<strong> interface </strong><strong>gigabitethernet<span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-GigabitEthernet<span>0/2/0</span>] <strong>shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
<p># Run the <strong>tracert</strong> command on <span class="keyword">Device</span>A again to check the connectivity of the SR-MPLS BE tunnel. For example:</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>tracert lsp segment-routing ip 1.1.1.9 32 version draft2</strong></pre>
<pre class="screen"> LSP Trace Route FEC: SEGMENT ROUTING IPV4 PREFIX 1.1.1.9/32 , press CTRL_C to break.
  TTL    Replier            Time    Type      Downstream
  0                                 Ingress   10.7.1.2/[17400 ]
  1      10.7.1.2           125 ms  Transit   10.6.1.2/[18400 ]
  2      10.6.1.2           130 ms  Transit   10.5.1.1/[3 ]
  3      1.1.1.9            24 ms   Egress  </pre>
<p>The preceding command output shows that the SR-MPLS BE tunnel has been switched to the TI-LFA FRR backup path, which uses a GRE tunnel interface as the outbound interface.</p>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001478015170__1.4.6"></a><a name="1.4.6"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p><span class="keyword">Device</span>A configuration file</p>
<pre class="screen">#
sysname <span class="keyword">Device</span>A
# 
segment-routing 
# 
isis 1
 cost-style wide
 network-entity 10.0000.0000.0001.00
 segment-routing mpls
 segment-routing global-block 16000 16999
 segment-routing mpls over gre
 frr
  loop-free-alternate level-1
  loop-free-alternate level-2
  ti-lfa level-1
  ti-lfa level-2
# 
isis 2
 network-entity 11.0000.0000.0021.00
#
interface Tunnel1 
 ip address 10.7.1.1 255.255.255.0 
 tunnel-protocol gre 
 source 10.2.1.1 
 destination 10.4.1.2 
 isis enable 1
 isis cost 100 
# 
interface LoopBack0 
 ip address 2.2.2.9 255.255.255.255 
 isis enable 1
 isis prefix-sid index 100 
# 
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown 
 ip address 10.2.1.1 255.255.255.0 
 isis enable 2 
 binding tunnel gre 
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown 
 ip address 10.1.1.2 255.255.255.0 
 isis enable 1
#
return</pre>
</li><li><p><span class="keyword">Device</span>B configuration file</p>
<pre class="screen">#
sysname <span class="keyword">Device</span>B
# 
segment-routing 
# 
isis 1
 cost-style wide
 network-entity 10.0000.0000.0002.00
 segment-routing mpls
 segment-routing global-block 17000 17999
 segment-routing mpls over gre
# 
isis 2
 network-entity 11.0000.0000.0022.00
#
interface GigabitEthernet<span>0/1/0</span> 
 undo shutdown 
 ip address 10.4.1.2 255.255.255.0 
 isis enable 2
 binding tunnel gre 
# 
interface GigabitEthernet<span>0/2/0</span> 
 undo shutdown 
 ip address 10.6.1.1 255.255.255.0 
 isis enable 1
# 
interface Tunnel1 
 ip address 10.7.1.2 255.255.255.0 
 tunnel-protocol gre 
 source 10.4.1.2 
 destination 10.2.1.1 
 isis enable 1
 isis cost 100 
# 
interface LoopBack0 
 ip address 5.5.5.9 255.255.255.255 
 isis enable 1 
 isis prefix-sid index 200 
# 
return</pre>
</li><li><p><span class="keyword">Device</span>C configuration file</p>
<pre class="screen">#
sysname <span class="keyword">Device</span>C
#                
segment-routing 
# 
isis 1
 cost-style wide
 network-entity 10.0000.0000.0003.00
 segment-routing mpls
 segment-routing global-block 18000 18999 
# 
interface GigabitEthernet<span>0/1/0</span> 
 undo shutdown 
 ip address 10.6.1.2 255.255.255.0 
 isis enable 1
# 
interface GigabitEthernet<span>0/2/0</span> 
 undo shutdown 
 ip address 10.5.1.2 255.255.255.0 
 isis enable 1
# 
interface LoopBack0 
 ip address 6.6.6.9 255.255.255.255 
 isis enable 1
 isis prefix-sid index 300 
# 
return</pre>
</li><li><p><span class="keyword">Device</span>D configuration file</p>
<pre class="screen">#
sysname <span class="keyword">Device</span>D
# 
segment-routing 
# 
isis 1
 cost-style wide
 network-entity 10.0000.0000.0004.00
 segment-routing mpls
 segment-routing global-block 19000 19999 
#
interface GigabitEthernet<span>0/1/0</span> 
 undo shutdown 
 ip address 10.1.1.1 255.255.255.0 
 isis enable 1 
# 
interface GigabitEthernet<span>0/2/0</span> 
 undo shutdown 
 ip address 10.5.1.1 255.255.255.0 
 isis enable 1 
# 
interface LoopBack0 
 ip address 1.1.1.9 255.255.255.0 
 isis enable 1 
 isis prefix-sid index 400 
# 
return</pre>
</li><li><p><span class="keyword">Device</span>E configuration file</p>
<pre class="screen">#
sysname <span class="keyword">Device</span>E
#
isis 2
network-entity 11.0000.0000.0005.00
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.2.1.2 255.255.255.0
 isis enable 2
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.3.1.1 255.255.255.0
 isis enable 2
#
return</pre>
</li><li><p><span class="keyword">Device</span>F configuration file</p>
<pre class="screen">#
sysname <span class="keyword">Device</span>F
#
isis 2
 network-entity 11.0000.0000.0006.00
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.3.1.2 255.255.255.0
 isis enable 2
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.4.1.1 255.255.255.0
 isis enable 2
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_sr-be_cfg_0007.html">Configuring Examples for SR-MPLS BE
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_sr_all_cfg_0251.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>

<script language="JavaScript">
<!--
image_size('.imgResize');
var msg_imageMax = "view original image";
var msg_imageClose = "close";
//--></script></body>
</html>