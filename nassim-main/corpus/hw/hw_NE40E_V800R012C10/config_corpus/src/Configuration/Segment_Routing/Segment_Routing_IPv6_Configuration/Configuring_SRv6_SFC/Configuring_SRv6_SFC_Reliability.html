
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring SRv6 SFC Reliability">
<meta name="abstract" content="This section describes how to configure SRv6 SFC reliability.">
<meta name="description" content="This section describes how to configure SRv6 SFC reliability.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_srv6_cfg_all_0225.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_srv6_cfg_all_0221.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_srv6_cfg_all_0282.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featurename" content="EVPN">
<meta name="featurename" content="Segment Routing IPv6">
<meta name="featurename" content="Segment Routing IPv6 Policy">
<meta name="featurename" content="Segment Routing Policy">
<meta name="featuretype" content="Segment Routing">
<meta name="featuretype" content="VPN">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featurename" content="EVPN">
<meta name="featurename" content="Segment Routing IPv6">
<meta name="featurename" content="Segment Routing IPv6 Policy">
<meta name="featurename" content="Segment Routing Policy">
<meta name="featuretype" content="Segment Routing">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featurename" content="EVPN">
<meta name="featurename" content="Segment Routing IPv6">
<meta name="featurename" content="Segment Routing IPv6 Policy">
<meta name="featurename" content="Segment Routing Policy">
<meta name="featuretype" content="Segment Routing">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="Segment Routing IPv6">
<meta name="featuretype" content="Segment Routing">
<meta name="OWNER" content="l00425560">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00587852">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0221082341">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/thickbox.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/imageResize.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery-migrate-1.2.1.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery-ui.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery.mousewheel.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/thickbox.js"></script>
<title>Configuring SRv6 SFC Reliability</title>
</head>
<body><a name="EN-US_TASK_0221082341"></a><a name="EN-US_TASK_0221082341"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring SRv6 SFC Reliability</h1>
<div class="taskbody"><p>This section describes how to configure SRv6 SFC reliability.</p>
<div class="prereq" style="margin-left:0"><a name="EN-US_TASK_0221082341__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Prerequisites</h4>
<div class="p"><p>Before configuring SRv6 SFC reliability, complete the following tasks:</p>
<ul><li><a href="dc_vrp_srv6_cfg_all_0221.html">Configure basic SRv6 SFC functions.</a></li></ul>
</div></div>
<div class="context"><a name="EN-US_TASK_0221082341__1.4.2"></a><a name="1.4.2"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>SFC services are forwarded in serial mode, meaning that a single link or node failure causes SFC service interruptions. To improve service reliability, SRv6 SFC provides backup link protection and bypass link protection.</p>
<ul><li>In backup link protection, an SF is dual-homed to two SFFs, with one as the master and the other as the backup. The backup SFF is used to protect the primary SFF. If the primary SFF becomes unreachable, services are switched to the backup SFF for processing.</li><li>In bypass link protection, if an SF is unreachable, SFC traffic is switched to the bypass service path, without being processed by the current SF. An SFF usually discards SFC packets if an SF is unreachable. After bypass protection is configured, SFC packets can continue to be forwarded as follows:<ol><li>If no bypass SF is available for the current SF, SRv6 forwarding for SFC packets is implemented.</li><li>If the current SF has a bypass SF to provide protection, SFC packets are switched to the bypass SF for processing.</li></ol>
</li></ul>
<p>These protection schemes can be selected according to specific SFC networking scenarios. The following describes how to configure SRv6 SFC reliability, using the network shown in <a href="#EN-US_TASK_0221082341__fig12581023202417">Figure 1</a> as an example. In <a href="#EN-US_TASK_0221082341__fig12581023202417">Figure 1</a>, SF1 is dual-homed to SFF1 and SFF2, and has a bypass SF â SF2.</p>
<p>Configuration roadmap:</p>
<ol><li>Configure a backup path for protection. Because SF1 is dual-homed to SFF1 and SFF2, SFF1 and SFF2 can provide protection for each other. Specifically, the same SF1 Proxy SID of the End.AS type needs to be configured on SFF1 and SFF2 to implement the anycast function. (For ease of description, the SF1 Proxy SID on SFF2 in <a href="#EN-US_TASK_0221082341__fig12581023202417">Figure 1</a> is called SF1 Backup Proxy SID.) In addition, SFF1 and SFF2 need to be configured as peers of each other. The peer SID of SFF1 is the End SID of SFF2, and the peer SID of SFF2 is the End SID of SFF1.</li><li>Configure a bypass service path by using SF2 to protect SF1. Specifically, configure a bypass protection SID for the SF1 Proxy SID, and configure the SF2 Proxy SID on SFF3.</li><li>Configure U-BFD on SFF1 and SFF2 to detect SF1 reachability.<ul><li>If U-BFD on SFF1 detects that SF1 is unreachable, the SFC traffic is switched to the backup service path. SFF1 replaces the original SRv6 segment list with the SF1 Proxy Backup SID and SFF2 End SID, and forwards the SFC packet to SFF2. After receiving the packet, SFF2 identifies that both the SF1 Proxy Backup SID and SFF2 End SID are its own SIDs. SFF2 then forwards the packet to SF1 based on the SF1 Proxy Backup SID.</li><li>SFC traffic is switched to SFF2 if U-BFD on SFF1 detects that SF1 is unreachable. If U-BFD on SFF2 also detects that SF1 is unreachable, the SFC traffic is switched to the bypass service path. SFF2 removes the SRH and searches the routing table for packet forwarding, using the SF2 Proxy SID as the destination IPv6 address. After receiving the packet, SFF3 forwards the packet to SF2 based on the SF2 Proxy SID.</li></ul>
</li></ol>
<div class="fignone" id="EN-US_TASK_0221082341__fig12581023202417"><a name="EN-US_TASK_0221082341__fig12581023202417"></a><a name="fig12581023202417"></a><span class="figcap"><b>Figure 1 </b>SFC scenario with a dual-homed SF that has a bypass SF</span><br><span><img class="imgResize" src="figure/en-us_image_0221088024.png" width="523.6875" height="416.848201" title="Click to enlarge"></span></div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0221082341__1.4.3"></a><a name="1.4.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure SFF backup link protection.</span><p><p>In this example, SF1 is dual-homed to SFF1 and SFF2, which can back up each other. The configurations of SFF1 and SFF2 are symmetrical. In an SF single-homing scenario, backup link protection cannot be implemented.</p>
</p><ol type="a"><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=segment-routing+ipv6"><b><span class="cmdname">segment-routing ipv6</span></b></a></span><p><p>SRv6 is enabled, and the SRv6 view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=proxy+peer-sid"><b><span class="cmdname">proxy peer-sid</span></b></a><strong> </strong><em>peersid</em></span><p><p>A peer End SID is configured on the SFF.</p>
<p>The peer SID on SFF1 is the End SID of SFF2, and the peer SID on SFF2 is the End SID of SFF1.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=locator"><b><span class="cmdname">locator</span></b></a> <i><span class="varname">locator-name</span></i> [ <strong><span>ipv6-prefix</span></strong> <i><span class="varname">ipv6-address</span></i> <i><span class="varname">prefix-length</span></i> [ <strong><span>static</span></strong> <i><span class="varname">static-length</span></i> | <strong><span>args</span></strong> <i><span class="varname">args-length</span></i> ] <sup>*</sup> [ <strong><span>default</span></strong> ] ]</span></span><p><p>An SRv6 locator is configured, and the SRv6 locator view is displayed.</p>
</p><p><p>To implement anycast protection, the configuration must be the same on SFF1 and SFF2.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=opcode"><b><span class="cmdname">opcode</span></b></a> <em>func-opcode1</em> <strong>end-as</strong></span><p><p>A static End.AS SID's operation code (opcode) is configured, and the static SRv6 SFC proxy view is displayed.</p>
<p>To implement anycast protection, the configuration must be the same on SFF1 and SFF2.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=backup-opcode"><b><span class="cmdname">backup-opcode</span></b></a> <em>func-opcode</em></span><p><p>An opcode is configured for the static SRv6 SFC proxy backup SID.</p>
</p><p><p>This opcode and locator form a backup SID.</p>
<p>In the SF1 dual-homing scenario, the Backup SID on SFF1 is the SF1 Proxy SID on SFF2, and the Backup SID on SFF2 is the SF1 Proxy SID on SFF1. To implement anycast protection, the configuration must be the same on SFF1 and SFF2.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li><span>Configure SFF bypass protection.</span><ol type="a"><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=segment-routing+ipv6"><b><span class="cmdname">segment-routing ipv6</span></b></a></span><p><p>SRv6 is enabled, and the SRv6 view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=locator"><b><span class="cmdname">locator</span></b></a> <i><span class="varname">locator-name</span></i> [ <strong><span>ipv6-prefix</span></strong> <i><span class="varname">ipv6-address</span></i> <i><span class="varname">prefix-length</span></i> [ <strong><span>static</span></strong> <i><span class="varname">static-length</span></i> | <strong><span>args</span></strong> <i><span class="varname">args-length</span></i> ] <sup>*</sup> [ <strong><span>default</span></strong> ] ]</span></span><p><p>An SRv6 locator is configured, and the SRv6 locator view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=opcode"><b><span class="cmdname">opcode</span></b></a> <em>func-opcode1</em> <strong>end-as</strong></span><p><p>A static End.AS SID's opcode is configured, and the static SRv6 SFC proxy view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bypass+sid"><b><span class="cmdname">bypass</span></b></a> [ <strong><span>sid</span></strong> <i><span class="varname">ipv6-address</span></i> ]</span><p><p>A bypass protection path is configured to protect traffic against SF service failures.</p>
<p>When you configure a bypass protection path:</p>
<ul><li>If <strong><span>sid</span></strong> <i><span class="varname">ipv6-address</span></i> is not specified, traffic is forwarded without passing through the faulty node. This means that no backup SF exists.</li><li>If <strong><span>sid</span></strong> <i><span class="varname">ipv6-address</span></i> is specified, traffic is forwarded to the specified backup SF. In this example, <strong><span>sid</span></strong> <i><span class="varname">ipv6-address</span></i> should be set to the SF2 Proxy SID of SFF3.</li></ul>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li><span>Configure U-BFD.</span><p><p>In this example, U-BFD needs to be configured on SFF1 and SFF2. BFD can detect only Layer 3 IP links. If Layer 2 forwarding is used from the SFFs to SFs, BFD cannot be used.</p>
</p><ol type="a"><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bfd"><b><span class="cmdname">bfd</span></b></a></span><p><p>BFD is enabled.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Exit the BFD view.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bfd"><b><span class="cmdname">bfd</span></b></a> <i><span class="varname">sessname-value</span></i> <strong><span>bind peer-ip</span></strong> <i><span class="varname">ip-address</span></i> [ <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-name</span></i> ] <strong><span>interface</span></strong> <i><span class="varname">interface-name</span></i> [ <strong><span>source-ip</span></strong> <i><span class="varname">ip-address</span></i> ] <strong><span>one-arm-echo</span></strong> <strong><span>destination-ip</span></strong> <i><span class="varname">ip-address</span></i></span><p><p>A U-BFD session is created, and the BFD session view is displayed.</p>
</p><p><p>Pay attention to the following parameters:</p>
<ul><li>If an SF is dual-homed to two SFFs that provide anycast protection, the SF may return BFD packets to an unexpected SFF, causing a BFD failure. To address this issue, <strong><span>destination-ip</span></strong> <i><span class="varname">ip-address</span></i> must be set to the address of the target SFF's loopback interface on the public network. The SF then returns BFD response packets to this address.</li><li>If the SF is on a VPN, <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-name</span></i> must be specified. To ensure that the address specified using <strong><span>destination-ip</span></strong> <i><span class="varname">ip-address</span></i> is reachable, the route to this address must be configured in the corresponding VPN instance.</li></ul>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=discriminator"><b><span class="cmdname">discriminator</span></b></a> <strong><span>local</span></strong> <i><span class="varname">discr-value</span></i></span><p><p>A local BFD session discriminator is configured. You only need to configure the local discriminator because the BFD Echo function can be configured only on the device supporting BFD.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=process-pst"><b><span class="cmdname">process-pst</span></b></a></span><p><p>The BFD session is allowed to modify the port state table (PST) or link state table when a fault is detected.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li></ol></div>
<div class="postreq"><a name="EN-US_TASK_0221082341__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Verifying the Configuration</h4><div class="p">After completing the configuration, run the following command to verify the configuration:<ul><li>Run the <a href="cmdqueryname=display+bfd+session"><b><span class="cmdname">display bfd session</span></b></a> { <strong><span>all</span></strong> | <strong><span>peer-ip</span></strong> <i><span class="varname">peer-ip</span></i> [ <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-name</span></i> ] } [ <strong><span>verbose</span></strong> ] command to check the BFD session information.</li></ul>
</div>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_srv6_cfg_all_0225.html">Configuring SRv6 SFC
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_srv6_cfg_all_0221.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_srv6_cfg_all_0282.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>

<script language="JavaScript">
<!--
image_size('.imgResize');
var msg_imageMax = "view original image";
var msg_imageClose = "close";
//--></script></body>
</html>