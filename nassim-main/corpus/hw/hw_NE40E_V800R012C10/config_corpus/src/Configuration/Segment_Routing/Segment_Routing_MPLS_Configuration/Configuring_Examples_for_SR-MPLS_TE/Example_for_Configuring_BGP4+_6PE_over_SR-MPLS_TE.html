
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring BGP4+ 6PE over SR-MPLS TE">
<meta name="abstract" content="This section provides an example for configuring an SR-MPLS TE tunnel to carry BGP4+ 6PE services.">
<meta name="description" content="This section provides an example for configuring an SR-MPLS TE tunnel to carry BGP4+ 6PE services.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_sr-te_cfg_0090.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_sr_all_cfg_0160A.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_dci_cfg_0036a.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="l00587852">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="EVPN">
<meta name="featurename" content="Segment Routing MPLS">
<meta name="featuretype" content="Segment Routing">
<meta name="featuretype" content="VPN">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="Segment Routing MPLS">
<meta name="featuretype" content="Segment Routing">
<meta name="featurename" content="Segment Routing MPLS">
<meta name="featuretype" content="Segment Routing">
<meta name="featurename" content="Segment Routing MPLS">
<meta name="featuretype" content="Segment Routing">
<meta name="OWNER" content="l00468467">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00468467">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001939977813">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/thickbox.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/imageResize.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery-migrate-1.2.1.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery-ui.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery.mousewheel.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/thickbox.js"></script>
<title>Example for Configuring BGP4+ 6PE over SR-MPLS TE</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001939977813"></a><a name="EN-US_TASK_0000001939977813"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring BGP4+ 6PE over SR-MPLS TE</h1>
<div class="taskbody"><p>This section provides an example for configuring an SR-MPLS TE tunnel to carry BGP4+ 6PE services.</p>
<div class="context"><a name="EN-US_TASK_0000001939977813__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>BGP4+ 6PE over SR-MPLS TE enables non-contiguous IPv6 networks to communicate over an SR network.</p>
<p>As shown in <a href="#EN-US_TASK_0000001939977813__en-us_task_0172370670_fig_dc_vrp_dci_cfg_003501">Figure 1</a>, there is no direct link between the IPv6 networks where CE1 and CE2 reside. CE1 and CE2 are expected to communicate over an SR network. To achieve this, you can establish a 6PE peer relationship between PE1 and PE2. The 6PE peers use MP-BGP to send IPv6 routes learned from their respective CEs and use SR-MPLS TE tunnels to forward IPv6 data.</p>
<div class="fignone" id="EN-US_TASK_0000001939977813__en-us_task_0172370670_fig_dc_vrp_dci_cfg_003501"><a name="EN-US_TASK_0000001939977813__en-us_task_0172370670_fig_dc_vrp_dci_cfg_003501"></a><a name="en-us_task_0172370670_fig_dc_vrp_dci_cfg_003501"></a><span class="figcap"><b>Figure 1 </b>BGP4+ 6PE over SR-MPLS TE networking</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface1 and interface2 represent GigabitEthernet<span>0/1/0</span> and GigabitEthernet<span>0/2/0</span>, respectively.</p>
</div></div>
<br><span><img class="imgResize" src="figure/en-us_image_0000001902018642.png" width="523.6875" height="409.67431400000004" title="Click to enlarge"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001939977813__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Precautions</h4><p>During the configuration, note the following:</p>
<ul><li><p>Using the local loopback address of each PE as the source address of the PE is recommended.</p>
</li><li>This example uses an explicit path with specified adjacency SIDs to establish the SR-MPLS TE tunnel. Adjacency SIDs that are dynamically generated may change after a device restart, meaning that they need to be reconfigured if adjacency SIDs are specified for the involved explicit path and the involved device is restarted. To facilitate the use of explicit paths, you are advised to run the <strong>ipv4 adjacency</strong> command to manually configure adjacency SIDs for such paths.</li></ul>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001939977813__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure IP addresses for interfaces.</p>
</li><li><p>Configure an IGP to enable PE1, PE2, and the P to communicate with each other.</p>
</li><li><p>Configure an SR-MPLS TE tunnel on the backbone network.</p>
</li><li><p>Establish an MP-IBGP peer relationship between the PEs and enable them to advertise labeled routes.</p>
</li><li><p>Configure a tunnel selection policy on each PE.</p>
</li><li><p>Establish EBGP peer relationships between the CEs and PEs for them to exchange routing information.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001939977813__1.4.4"></a><a name="1.4.4"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>MPLS LSR IDs on the PEs and P</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001939977813__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure addresses for interfaces connecting the PEs and the P according to <a href="#EN-US_TASK_0000001939977813__en-us_task_0172370670_fig_dc_vrp_dci_cfg_003501">Figure 1</a>.</span><p><p># Configure PE1.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname PE1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack1] <strong>ip address 1.1.1.1 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> interface gigabitethernet<span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>ip address 10.1.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure the P.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname P</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-LoopBack1] <strong>ip address 2.2.2.2 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P]<strong> interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/0</span>] <strong>ip address 10.1.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P]<strong> interface gigabitethernet<span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/2/0</span>] <strong>ip address 10.2.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname PE2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-LoopBack1] <strong>ip address 3.3.3.3 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> interface gigabitethernet<span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>]<strong> ip address 10.2.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> commit</strong></pre>
</p></li><li><span>Configure an IGP to enable PE1, PE2, and the P to communicate with each other. IS-IS is used as the IGP in this example.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>is-level level-2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>network-entity 00.1111.1111.1111.00</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack1] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface GigabitEthernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure the P.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-isis-1] <strong>is-level level-2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-isis-1] <strong>network-entity 00.1111.1111.2222.00</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-LoopBack1] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>interface GigabitEthernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/0</span>] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>interface GigabitEthernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/2/0</span>] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1] <strong>is-level level-2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1] <strong>network-entity 00.1111.1111.3333.00</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-LoopBack1] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface GigabitEthernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p>After completing the configuration, run the <strong>display isis peer</strong> command to check whether an IS-IS neighbor relationship has been established between PE1 and the P and between PE2 and the P. If the <strong>Up</strong> state is displayed in the command output, the neighbor relationship has been successfully established. Run the <strong>display ip routing-table</strong> command. The command output shows that the PEs have learned the routes to Loopback1 of each other.</p>
<p>The following example uses the command output on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display isis peer</strong></pre>
<pre class="screen">                          Peer information for ISIS(1)
                         
  System Id     Interface          Circuit Id        State HoldTime Type     PRI
--------------------------------------------------------------------------------
1111.1111.2222  GE<span>0/2/0</span>            1111.1111.2222.01  Up   8s       L2       64 

Total Peer(s): 1</pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display ip routing-table</strong></pre>
<pre class="screen"><span class="keyword">Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route</span>
------------------------------------------------------------------------------
Routing Table : _public_
         Destinations : 11       Routes : 11        

Destination/Mask    Proto   Pre  Cost        Flags NextHop         Interface

        1.1.1.1/32  Direct  0    0             D   127.0.0.1       LoopBack1
        2.2.2.2/32  ISIS-L2 15   10            D   10.1.1.2        GigabitEthernet<span>0/2/0</span>
        3.3.3.3/32  ISIS-L2 15   20            D   10.1.1.2        GigabitEthernet<span>0/2/0</span>
       10.1.1.0/24  Direct  0    0             D   10.1.1.1        GigabitEthernet<span>0/2/0</span>
       10.1.1.1/32  Direct  0    0             D   127.0.0.1       GigabitEthernet<span>0/2/0</span>
     10.1.1.255/32  Direct  0    0             D   127.0.0.1       GigabitEthernet<span>0/2/0</span>
       10.2.1.0/24  ISIS-L2 15   20            D   10.1.1.2        GigabitEthernet<span>0/2/0</span>
      127.0.0.0/8   Direct  0    0             D   127.0.0.1       InLoopBack0
      127.0.0.1/32  Direct  0    0             D   127.0.0.1       InLoopBack0
127.255.255.255/32  Direct  0    0             D   127.0.0.1       InLoopBack0
255.255.255.255/32  Direct  0    0             D   127.0.0.1       InLoopBack0</pre>
</p></li><li><span>Configure an SR-MPLS TE tunnel on the backbone network.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>mpls lsr-id 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>segment-routing</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>cost-style wide</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>traffic-eng level-2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>segment-routing mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>segment-routing global-block 153616 153800</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0000001939977813__en-us_task_0172368860_p969181111187">The SRGB range varies according to the device. The range specified in this example is for reference only.</p>
</div></div>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack1] <strong>isis prefix-sid absolute 153700</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>segment-routing</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing] <strong>ipv4 adjacency local-ip-addr 10.1.1.1 remote-ip-addr 10.1.1.2 sid 330121</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>explicit-path pe1tope2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-explicit-path-pe1tope2] <strong>next sid label 330121 type adjacency</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-explicit-path-pe1tope2] <strong>next sid label 330120 type adjacency</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-explicit-path-pe1tope2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface tunnel1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel1] <strong>ip address unnumbered interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel1] <strong>tunnel-protocol mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel1] <strong>destination 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel1] <strong>mpls te tunnel-id 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel1] <strong>mpls te signal-protocol segment-routing</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel1] <strong>mpls te path explicit-path pe1tope2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel1] <strong>mpls te reserved-for-binding</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure the P.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P] <strong>mpls lsr-id 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-mpls] <strong> mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>segment-routing</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-segment-routing] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-isis-1] <strong>cost-style wide</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-isis-1] <strong>traffic-eng level-2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-isis-1] <strong>segment-routing mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-isis-1] <strong>segment-routing global-block 153616 153800</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0000001939977813__en-us_task_0172368860_p969181111187_1">The SRGB range varies according to the device. The range specified in this example is for reference only.</p>
</div></div>
<pre class="screen">[<span class="keyword">*</span>P-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-LoopBack1] <strong>isis prefix-sid absolute 153710</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>segment-routing</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-segment-routing] <strong>ipv4 adjacency local-ip-addr 10.1.1.2 remote-ip-addr 10.1.1.1 sid 330221</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-segment-routing] <strong>ipv4 adjacency local-ip-addr 10.2.1.1 remote-ip-addr 10.2.1.2 sid 330120</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-segment-routing] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>mpls lsr-id 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>segment-routing</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-segment-routing] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1] <strong>cost-style wide</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1] <strong>traffic-eng level-2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1] <strong>segment-routing mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1] <strong>segment-routing global-block 153616 153800</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0000001939977813__en-us_task_0172368860_p969181111187_2">The SRGB range varies according to the device. The range specified in this example is for reference only.</p>
</div></div>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-LoopBack1] <strong>isis prefix-sid absolute 153720</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>segment-routing</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-segment-routing] <strong>ipv4 adjacency local-ip-addr 10.2.1.2 remote-ip-addr 10.2.1.1 sid 330220</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-segment-routing] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>explicit-path pe2tope1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-explicit-path-pe2tope1] <strong>next sid label 330220 type adjacency</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-explicit-path-pe2tope1] <strong>next sid label 330221 type adjacency</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-explicit-path-pe2tope1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface tunnel1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Tunnel1] <strong>ip address unnumbered interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Tunnel1] <strong>tunnel-protocol mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Tunnel1] <strong>destination 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Tunnel1] <strong>mpls te tunnel-id 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Tunnel1] <strong>mpls te signal-protocol segment-routing</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Tunnel1] <strong>mpls te path explicit-path pe2tope1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Tunnel1] <strong>mpls te reserved-for-binding</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Tunnel1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p>After completing the configuration, run the <strong>display tunnel-info all</strong> command. The command output shows that an SR-MPLS TE tunnel has been established. The following example uses the command output on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display tunnel-info all</strong>
Tunnel ID            Type                Destination                             Status   
----------------------------------------------------------------------------------------
0x000000000300000001 sr-te               3.3.3.3                                 UP</pre>
<p>Run the <strong>display mpls te tunnel-interface</strong> command. The command output shows that the tunnel status is up. The following example uses the command output on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> display mpls te tunnel-interface</strong>

    Tunnel Name       : Tunnel1                                
    Signalled Tunnel Name: -                                   
    Tunnel State Desc : <strong>CR-LSP is Up</strong>                           
    Tunnel Attributes   :                                      
    Active LSP          : Primary LSP                          
    Traffic Switch      : -                                    
    Session ID          : 1                                    
    Ingress LSR ID      : 1.1.1.1               Egress LSR ID: 3.3.3.3
    Admin State         : UP                    Oper State   : UP                       
    Signaling Protocol  : <strong>Segment-Routing</strong>                      
    FTid                : 1                                    
    Tie-Breaking Policy : None                  Metric Type  : TE 
    Bfd Cap             : None                                 
    Reopt               : Disabled              Reopt Freq   : - 
    Auto BW             : Disabled              Threshold    : - 
    Current Collected BW: -                     Auto BW Freq : - 
    Min BW              : -                     Max BW       : -
    Offload             : Disabled              Offload Freq : - 
    Low Value           : -                     High Value   : - 
    Readjust Value      : -                                    
    Offload Explicit Path Name: -                              
    Tunnel Group        : Primary                              
    Interfaces Protected: - 
    Excluded IP Address : -                                    
    Referred LSP Count  : 0                                    
    Primary Tunnel      : -                     Pri Tunn Sum : - 
    Backup Tunnel       : -                                    
    Group Status        : Up                    Oam Status   : None 
    IPTN InLabel        : -                     Tunnel BFD Status : -                                                          
    BackUp LSP Type     : None                  BestEffort   : -                                
    Secondary HopLimit  : -                                    
    BestEffort HopLimit  : -                                   
    Secondary Explicit Path Name: -                            
    Secondary Affinity Prop/Mask: 0x0/0x0                      
    BestEffort Affinity Prop/Mask: -                           
    IsConfigLspConstraint: -                                   
    Hot-Standby Revertive Mode:  Revertive                     
    Hot-Standby Overlap-path:  Disabled                        
    Hot-Standby Switch State:  CLEAR                           
    Bit Error Detection:  Disabled                             
    Bit Error Detection Switch Threshold:  -                   
    Bit Error Detection Resume Threshold:  -                   
    Ip-Prefix Name    : -                                      
    P2p-Template Name : -                                      
    PCE Delegate      : No                     LSP Control Status : Local control
    Path Verification : No                                     
    Entropy Label     : -                                      
    Associated Tunnel Group ID: -              Associated Tunnel Group Type: -
    Auto BW Remain Time   : -                  Reopt Remain Time     : - 
    Segment-Routing Remote Label   : -                         
    Binding Sid       : -                     Reverse Binding Sid : - 
    FRR Attr Source   : -                     Is FRR degrade down : -
    Color             : - 

    Primary LSP ID      : 1.1.1.1:1                            
    LSP State           : UP                    LSP Type     : Primary 
    Configured Attribute Information: 
    Setup Priority      : 7                     Hold Priority: 7 
    IncludeAll          : 0x0                                  
    IncludeAny          : 0x0                                  
    ExcludeAny          : 0x0                                  
    Affinity Prop/Mask  : 0x0/0x0               Resv Style   :  SE
    SidProtectType      : - 
    Actual Attribute Information: 
    Setup Priority      : 7                     Hold Priority: 7 
    IncludeAll          : 0x0  
    IncludeAny          : 0x0   
    ExcludeAny          : 0x0   
    SidProtectType      : - 
    Configured Bandwidth Information:                          
    CT0 Bandwidth(Kbit/sec): 0               CT1 Bandwidth(Kbit/sec): 0
    CT2 Bandwidth(Kbit/sec): 0               CT3 Bandwidth(Kbit/sec): 0 
    CT4 Bandwidth(Kbit/sec): 0               CT5 Bandwidth(Kbit/sec): 0 
    CT6 Bandwidth(Kbit/sec): 0               CT7 Bandwidth(Kbit/sec): 0
    Actual Bandwidth Information:                              
    CT0 Bandwidth(Kbit/sec): 0               CT1 Bandwidth(Kbit/sec): 0
    CT2 Bandwidth(Kbit/sec): 0               CT3 Bandwidth(Kbit/sec): 0 
    CT4 Bandwidth(Kbit/sec): 0               CT5 Bandwidth(Kbit/sec): 0 
    CT6 Bandwidth(Kbit/sec): 0               CT7 Bandwidth(Kbit/sec): 0 
    Explicit Path Name  : pe1tope2                         Hop Limit: - 
    Record Route        : -                     Record Label : -
    Route Pinning       : -                                    
    FRR Flag            : -                                    
    IdleTime Remain     : -                                    
    BFD Status          : -                                    
    Soft Preemption     : -                                    
    Reroute Flag        : -                                    
    Pce Flag            : Normal                               
    Path Setup Type     : EXPLICIT                             
    Create Modify LSP Reason: -  </pre>
</p></li><li><span>Establish an MP-IBGP peer relationship between the PEs and enable them to advertise labeled routes.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 3.3.3.3 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 3.3.3.3 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>ipv6-family unicast</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-ipv6] <strong>peer 3.3.3.3 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-ipv6] <strong>peer 3.3.3.3 label-route-capability</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-ipv6] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp-af-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp] <strong>quit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>peer 1.1.1.1 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>peer 1.1.1.1 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>ipv6-family unicast</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-ipv6] <strong>peer 1.1.1.1 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-ipv6] <strong>peer 1.1.1.1 label-route-capability</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-ipv6] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-bgp-af-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-bgp] <strong>quit</strong></pre>
<p>After completing the configuration, run the <strong>display bgp ipv6 peer</strong> command on the PEs to check whether the BGP peer relationship has been established. If the <strong>Established</strong> state is displayed in the command output, the BGP peer relationship has been established successfully. The following example uses the command output on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display bgp ipv6 peer</strong></pre>
<pre class="screen"> BGP local router ID : 10.1.1.1
 Local AS number : 100
 Total number of peers : 1                 Peers in established state : 1

  Peer            V          AS  MsgRcvd  MsgSent  OutQ  Up/Down       State  PrefRcv
  3.3.3.3         4         100        6        7     0 00:01:16 Established        0</pre>
</p></li><li><span>Configure a tunnel selection policy on the PEs so that the specified SR-MPLS TE tunnel can be preferentially selected.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>tunnel-policy p1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-tunnel-policy-p1] <strong>tunnel binding destination 3.3.3.3 te Tunnel1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-tunnel-policy-p1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>ipv6-family unicast</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-ipv6] <strong>peer 3.3.3.3 tnl-policy p1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>tunnel-policy p1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-tunnel-policy-p1] <strong>tunnel binding destination 1.1.1.1 te Tunnel1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-tunnel-policy-p1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>ipv6-family unicast</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-ipv6] <strong>peer 1.1.1.1 tnl-policy p1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</p></li><li><span>Establish an EBGP peer relationship between each CE-PE pair.</span><p><p># Configure CE1.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname CE1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-LoopBack1] <strong>ipv6 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-LoopBack1] <strong>ipv6 address 2001:db8:1:1::1 128</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1]<strong> interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>] <strong>ipv6 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>] <strong>ipv6 address 2001:db8::1:1 96</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>bgp 65410</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp] <strong>router-id 10.10.10.10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp] <strong>peer 2001:db8::1:2 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp] <strong>ipv6-family</strong><strong> unicast</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp-af-ipv6] <strong>peer 2001:db8::1:2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp-af-ipv6] <strong>network 2001:db8:1:1::1 128</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp-af-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>commit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The configuration of CE2 is similar to the configuration of CE1. For detailed configurations, see Configuration Files.</p>
</div></div>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp] <strong>peer 2001:db8::1:1 as-number 65410</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>ipv6-family unicast</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-ipv6] <strong>peer 2001:db8::1:1 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-ipv6] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp-af-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp] <strong>quit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The configuration of PE2 is similar to the configuration of PE1. For detailed configurations, see Configuration Files.</p>
</div></div>
<p>After completing the configuration, run the <strong>display bgp ipv6 peer</strong> command on the PEs to check whether the BGP4+ peer relationships have been established between the PEs and CEs. If the <strong>Established</strong> state is displayed in the command output, the BGP4+ peer relationships have been established successfully.</p>
<p>The following example uses the peer relationship between PE1 and CE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display bgp ipv6 peer</strong>
 BGP local router ID : 10.1.1.1
 Local AS number : 100
 Total number of peers : 2                 Peers in established state : 2


  Peer                   V          AS  MsgRcvd  MsgSent  OutQ  Up/Down       State  PrefRcv
  3.3.3.3                4         100     1074     1069     0 15:26:52 Established        1
  2001:DB8::1:1          4       65410     1073     1079     0 15:28:39 <strong>Established</strong>        1</pre>
</p></li><li><span>Verify the configuration.</span><p><p>After completing the configuration, run the <strong>display ipv6 routing-table</strong> command on each PE to check information about the loopback interface route toward a CE.</p>
<p>The following example uses the command output on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display ipv6 routing-table</strong>
Routing Table : _public_                                                
         Destinations : 8        Routes : 8                             

Destination  : ::1                                     PrefixLength : 128       
NextHop      : ::1                                     Preference   : 0 
Cost         : 0                                       Protocol     : Direct    
RelayNextHop : ::                                      TunnelID     : 0x0       
Interface    : InLoopBack0                             Flags        : D 

Destination  : ::FFFF:127.0.0.0                        PrefixLength : 104       
NextHop      : ::FFFF:127.0.0.1                        Preference   : 0 
Cost         : 0                                       Protocol     : Direct    
RelayNextHop : ::                                      TunnelID     : 0x0       
Interface    : InLoopBack0                             Flags        : D 

Destination  : ::FFFF:127.0.0.1                        PrefixLength : 128       
NextHop      : ::1                                     Preference   : 0 
Cost         : 0                                       Protocol     : Direct    
RelayNextHop : ::                                      TunnelID     : 0x0       
Interface    : InLoopBack0                             Flags        : D 


Destination  : 2001:DB8::                              PrefixLength : 96
NextHop      : 2001:DB8::1:2                           Preference   : 0 
Cost         : 0                                       Protocol     : Direct    
RelayNextHop : ::                                      TunnelID     : 0x0       
Interface    : GigabitEthernet<span>0/2/0</span>                    Flags        : D 

Destination  : 2001:DB8::1:2                           PrefixLength : 128       
NextHop      : ::1                                     Preference   : 0 
Cost         : 0                                       Protocol     : Direct    
RelayNextHop : ::                                      TunnelID     : 0x0       
Interface    : GigabitEthernet<span>0/2/0</span>                    Flags        : D 

Destination  : 2001:DB8:1:1::1                         PrefixLength : 128       
NextHop      : 2001:DB8::1:1                           Preference   : 255       
Cost         : 0                                       Protocol     : EBGP      
RelayNextHop : 2001:DB8::1:1                           TunnelID     : 0x0       
Interface    : GigabitEthernet<span>0/2/0</span>                    Flags        : RD

Destination  : 2001:DB8:2:2::2                         PrefixLength : 128       
NextHop      : ::FFFF:3.3.3.3                          Preference   : 255       
Cost         : 0                                       Protocol     : IBGP      
RelayNextHop : ::FFFF:0.0.0.0                          TunnelID     : 0x000000000300000001
Interface    : Tunnel1                                 Flags        : RD

Destination  : FE80::                                  PrefixLength : 10
NextHop      : ::                                      Preference   : 0 
Cost         : 0                                       Protocol     : Direct    
RelayNextHop : ::                                      TunnelID     : 0x0       
Interface    : NULL0                                   Flags        : DB</pre>
<p>Run the <strong>display ipv6 routing-table verbose</strong> command on each PE to check details about the loopback interface route toward a CE.</p>
<p>The following example uses the command output on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display ipv6 routing-table 2001:db8:2:2::2 verbose</strong>
Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route
------------------------------------------------------------------------------  
Routing Table : _public_    
Summary Count : 1           

Destination  : 2001:DB8:2:2::2                         PrefixLength : 128       
NextHop      : ::FFFF:3.3.3.3                          Preference   : 255       
Neighbour    : ::3.3.3.3                               ProcessID    : 0         
Label        : 48122                                   Protocol     : IBGP      
State        : Active Adv Relied                       Cost         : 0         
Entry ID     : 0                                       EntryFlags   : 0x00000000
Reference Cnt: 0                                       Tag          : 0         
Priority     : low                                     Age          : 2012sec   
IndirectID   : 0x10000C2                               Instance     :           
RelayNextHop : ::FFFF:0.0.0.0                          TunnelID     : <strong>0x000000000300000001</strong>                                          
<strong>Interface    : Tunnel1                              Flags        : RD </strong>       
RouteColor   : 0                                       QoSInfo      : 0x0 </pre>
<p>The preceding command output shows that the BGP4+ route has successfully recursed to the SR-MPLS TE tunnel.</p>
<p>Check that the CEs can ping each other. For example, CE1 can ping CE2 at 2001:db8:2:2::2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>ping ipv6 -a 2001:db8:1:1::1 2001:db8:2:2::2</strong>
  PING 2001:DB8:2:2::2 : 56  data bytes, press CTRL_C to break
    Reply from 2001:DB8:2:2::2  
    bytes=56 Sequence=1 hop limit=61 time=3 ms
    Reply from 2001:DB8:2:2::2  
    bytes=56 Sequence=2 hop limit=61 time=3 ms
    Reply from 2001:DB8:2:2::2  
    bytes=56 Sequence=3 hop limit=61 time=3 ms
    Reply from 2001:DB8:2:2::2  
    bytes=56 Sequence=4 hop limit=61 time=3 ms
    Reply from 2001:DB8:2:2::2  
    bytes=56 Sequence=5 hop limit=61 time=3 ms

  --- 2001:DB8:2:2::2 ping statistics---      
    5 packet(s) transmitted     
    5 packet(s) received        
    0.00% packet loss           
    round-trip min/avg/max=3/3/3 ms</pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001939977813__1.4.6"></a><a name="1.4.6"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>PE1 configuration file</p>
<pre class="screen">#
sysname PE1
#
mpls lsr-id 1.1.1.1
#
mpls
 mpls te
#
explicit-path pe1tope2
 next sid label 330121 type adjacency index 1
 next sid label 330120 type adjacency index 2
#
segment-routing
 ipv4 adjacency local-ip-addr 10.1.1.1 remote-ip-addr 10.1.1.2 sid 330121
#
isis 1
 is-level level-2
 cost-style wide
 network-entity 00.1111.1111.1111.00
 traffic-eng level-2
 segment-routing mpls
 segment-routing global-block 153616 153800
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown 
 ipv6 enable
 ipv6 address 2001:DB8::1:2/96
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.1.1.1 255.255.255.0
 isis enable 1
#
interface LoopBack1
 ip address 1.1.1.1 255.255.255.255
 isis enable 1
 isis prefix-sid absolute 153700 
#
interface Tunnel1
 ip address unnumbered interface LoopBack1
 tunnel-protocol mpls te
 destination 3.3.3.3
 mpls te signal-protocol segment-routing
 mpls te reserved-for-binding
 mpls te tunnel-id 1
 mpls te path explicit-path pe1tope2  
#
bgp 100
 peer 3.3.3.3 as-number 100
 peer 3.3.3.3 connect-interface LoopBack1
 peer 2001:DB8::1:1 as-number 65410
 #
 ipv4-family unicast
  undo synchronization
  peer 3.3.3.3 enable
 #              
 ipv6-family unicast
  undo synchronization
  peer 3.3.3.3 enable
  peer 3.3.3.3 label-route-capability
  peer 3.3.3.3 tnl-policy p1
  peer 2001:DB8::1:1 enable
#
tunnel-policy p1
 tunnel binding destination 3.3.3.3 te Tunnel1
#
return</pre>
</li><li><p>P configuration file</p>
<pre class="screen">#
sysname P
#
mpls lsr-id 2.2.2.2
#
mpls
 mpls te
#
segment-routing
 ipv4 adjacency local-ip-addr 10.1.1.2 remote-ip-addr 10.1.1.1 sid 330221
 ipv4 adjacency local-ip-addr 10.2.1.1 remote-ip-addr 10.2.1.2 sid 330120
#
isis 1
 is-level level-2
 cost-style wide
 network-entity 00.1111.1111.2222.00
 traffic-eng level-2
 segment-routing mpls
 segment-routing global-block 153616 153800
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.1.2 255.255.255.0
 isis enable 1
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.2.1.1 255.255.255.0
 isis enable 1
#
interface LoopBack1
 ip address 2.2.2.2 255.255.255.255
 isis enable 1
 isis prefix-sid absolute 153710 
#
return</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#
sysname PE2
#
mpls lsr-id 3.3.3.3
#
mpls
 mpls te
#
explicit-path pe2tope1
 next sid label 330220 type adjacency index 1
 next sid label 330221 type adjacency index 2
#
segment-routing
 ipv4 adjacency local-ip-addr 10.2.1.2 remote-ip-addr 10.2.1.1 sid 330220
#
isis 1
 is-level level-2
 cost-style wide
 network-entity 00.1111.1111.3333.00
 traffic-eng level-2
 segment-routing mpls
 segment-routing global-block 153616 153800
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown 
 ipv6 enable
 ipv6 address 2001:DB8::2:2/96
#               
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.2.1.2 255.255.255.0
 isis enable 1
#
interface LoopBack1
 ip address 3.3.3.3 255.255.255.255
 isis enable 1
 isis prefix-sid absolute 153720 
#
interface Tunnel1
 ip address unnumbered interface LoopBack1
 tunnel-protocol mpls te
 destination 1.1.1.1
 mpls te signal-protocol segment-routing
 mpls te reserved-for-binding
 mpls te tunnel-id 1
 mpls te path explicit-path pe2tope1  
#
bgp 100
 peer 1.1.1.1 as-number 100
 peer 1.1.1.1 connect-interface LoopBack1
 peer 2001:DB8::2:1 as-number 65420
 #
 ipv4-family unicast
  undo synchronization
  peer 1.1.1.1 enable
 #              
 ipv6-family unicast
  undo synchronization
  peer 1.1.1.1 enable
  peer 1.1.1.1 label-route-capability
  peer 1.1.1.1 tnl-policy p1
  peer 2001:DB8::2:1 enable
#
tunnel-policy p1
 tunnel binding destination 1.1.1.1 te Tunnel1
#
return</pre>
</li><li><p>CE1 configuration file</p>
<pre class="screen">#
sysname CE1
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ipv6 enable
 ipv6 address 2001:DB8::1:1/96
#
interface LoopBack1
 ipv6 enable
 ipv6 address 2001:DB8:1:1::1/128
#
bgp 65410
 router-id 10.10.10.10
 peer 2001:DB8::1:2 as-number 100
 #
 ipv6-family unicast
  undo synchronization
  network 2001:DB8:1:1::1 128
  peer 2001:DB8::1:2 enable
#
return</pre>
</li><li><p>CE2 configuration file</p>
<pre class="screen">#
sysname CE2
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ipv6 enable
 ipv6 address 2001:DB8::2:1/96
#
interface LoopBack1
 ipv6 enable
 ipv6 address 2001:DB8:2:2::2/128
#
bgp 65420
 router-id 10.20.20.20
 peer 2001:DB8::2:2 as-number 100
 #
 ipv6-family unicast
  undo synchronization
  network 2001:DB8:2:2::2 128
  peer 2001:DB8::2:2 enable
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_sr-te_cfg_0090.html">Configuring Examples for SR-MPLS TE
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_sr_all_cfg_0160A.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_dci_cfg_0036a.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>

<script language="JavaScript">
<!--
image_size('.imgResize');
var msg_imageMax = "view original image";
var msg_imageClose = "close";
//--></script></body>
</html>