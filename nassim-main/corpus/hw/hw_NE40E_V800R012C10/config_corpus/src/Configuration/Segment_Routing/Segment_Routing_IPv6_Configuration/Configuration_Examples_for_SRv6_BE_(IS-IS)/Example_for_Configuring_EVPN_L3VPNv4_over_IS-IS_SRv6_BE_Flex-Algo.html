
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring EVPN L3VPNv4 over IS-IS SRv6 BE Flex-Algo">
<meta name="abstract" content="This section provides an example for configuring EVPN L3VPNv4 over SRv6 BE Flex-Algo.">
<meta name="description" content="This section provides an example for configuring EVPN L3VPNv4 over SRv6 BE Flex-Algo.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_srv6_cfg_all_0010.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_srv6_cfg_all_0135.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_srv6_cfg_all_0260.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featurename" content="EVPN">
<meta name="featurename" content="Segment Routing IPv6">
<meta name="featurename" content="Segment Routing IPv6 Policy">
<meta name="featurename" content="Segment Routing Policy">
<meta name="featuretype" content="Segment Routing">
<meta name="featuretype" content="VPN">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featurename" content="EVPN">
<meta name="featurename" content="Segment Routing IPv6">
<meta name="featurename" content="Segment Routing IPv6 Policy">
<meta name="featurename" content="Segment Routing Policy">
<meta name="featuretype" content="Segment Routing">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featurename" content="EVPN">
<meta name="featurename" content="Segment Routing IPv6">
<meta name="featurename" content="Segment Routing IPv6 Policy">
<meta name="featurename" content="Segment Routing Policy">
<meta name="featuretype" content="Segment Routing">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="Segment Routing IPv6">
<meta name="featuretype" content="Segment Routing">
<meta name="OWNER" content="l00587852">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00587852">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0311166329">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring EVPN L3VPNv4 over IS-IS SRv6 BE Flex-Algo</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0311166329"></a><a name="EN-US_TASK_0311166329"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring EVPN L3VPNv4 over IS-IS SRv6 BE Flex-Algo</h1>
<div class="taskbody"><p>This section provides an example for configuring EVPN L3VPNv4 over SRv6 BE Flex-Algo.</p>
<div class="context"><a name="EN-US_TASK_0311166329__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><div class="p">On the network shown in <a href="#EN-US_TASK_0311166329__fig_dc_vrp_srv6_cfg_all_001101">Figure 1</a>:<ul><li><p>PE1, the Ps, and PE2 are in the same AS and run IS-IS to implement IPv6 network connectivity.</p>
</li><li><p>PE1, the Ps, and PE2 are Level-1 devices that belong to IS-IS process 1.</p>
</li></ul>
</div>
<p>It is required that a bidirectional SRv6 BE path be deployed between PE1 and PE2 on the public network to carry EVPN L3VPNv4 services. Though PE1 and PE2 have multiple links in between, the service traffic needs to be forwarded over the PE1-P1-PE2 link with the lowest delay.</p>
<p>In this example, static delay attributes are defined to meet the service requirements of vpn1.</p>
<div class="fignone" id="EN-US_TASK_0311166329__fig_dc_vrp_srv6_cfg_all_001101"><a name="EN-US_TASK_0311166329__fig_dc_vrp_srv6_cfg_all_001101"></a><a name="fig_dc_vrp_srv6_cfg_all_001101"></a><span class="figcap"><b>Figure 1 </b>EVPN L3VPNv4 over SRv6 BE Flex-Algo networking</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 through 3 in this example represent GE <span>0/1/0</span>, GE <span>0/2/0</span>, and GE <span>0/3/0</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0311166333.png"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0311166329__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Precautions</h4><p>During the configuration process, note the following:</p>
<ul><li><p>After a VPN instance is bound to a PE interface connected to a CE, Layer 3 configurations on this interface, such as IP address and routing protocol configurations, are automatically deleted. Add these configurations again if necessary.</p>
</li><li><p>To ensure that delay attributes can be transmitted between devices, you need to run the <a href="cmdqueryname=ipv6+traffic-eng"><b><span class="cmdname">ipv6 traffic-eng</span></b></a> command to enable IS-IS TE and the <a href="cmdqueryname=ipv6+metric-delay+advertisement+enable"><b><span class="cmdname">ipv6 metric-delay advertisement enable</span></b></a> command to enable IPv6 delay advertisement.</p>
</li><li>In SRv6 Flex-Algo scenarios, locators must be configured on both PEs and Ps, and IS-IS SRv6 must be enabled using the <a href="cmdqueryname=segment-routing+ipv6"><b><span class="cmdname">segment-routing ipv6</span></b></a> <strong>locator</strong> <em>locator-name</em> command in the IS-IS view. Otherwise, SRv6 locator routes cannot be advertised, and PEs at both ends cannot learn locator routes from each other.</li></ul>
</div></div>
<div class="context"><a name="EN-US_TASK_0311166329__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Enable IPv6 forwarding and configure an IPv6 address for each interface on PE1, P1, PE2, and P2.</p>
</li><li><p>Enable IS-IS, configure an IS-IS level, and specify a network entity title (NET) on PE1, P1, PE2, and P2.</p>
</li><li>Configure delay attributes for Flex-Algo links.</li><li>Configure FADs.</li><li>Enable IS-IS-based Flex-Algo advertisement, IS-IS TE, and IS-IS-based IPv6 link delay advertisement.</li><li><p>Configure EVPN L3VPN instances on PE1 and PE2.</p>
</li><li><p>Establish an EBGP peer relationship between each PE and its connected CE.</p>
</li><li><p>Establish a BGP EVPN peer relationship between the PEs.</p>
</li><li>Establish a Flex-Algo-based SRv6 BE path between the PEs.</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0311166329__1.4.4"></a><a name="1.4.4"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>IPv6 address of each interface on PE1, P1, PE2, and P2</p>
</li><li><p>IS-IS process IDs of PE1, P1, PE2, and P2</p>
</li><li><p>IS-IS levels of PE1, P1, PE2, and P2</p>
</li><li><p>VPN instance names, RDs, and RTs on PE1 and PE2</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0311166329__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Enable IPv6 forwarding and configure an IPv6 address for each interface. The following example uses the configuration of PE1. The configurations of other devices are similar to the configuration of PE1. For configuration details, see <a href="#EN-US_TASK_0311166329__section_dc_vrp_srv6_cfg_all_001105">Configuration Files</a> in this section.</span><p><pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname PE1</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface gigabitethernet <span>0/1/0</span></strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>ipv6 enable</strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>ipv6 address 2001:db8:1::1 96</strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet <span>0/3/0</span></strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/3/0</span>] <strong>ipv6 enable</strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/3/0</span>] <strong>ipv6 address 2001:db8:3::1 96</strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/3/0</span>] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>interface LoopBack 1</strong>
[<span class="keyword">*</span>PE1-LoopBack1] <strong>ipv6 enable</strong>
[<span class="keyword">*</span>PE1-LoopBack1] <strong>ipv6 address 2001:db8:11::1 128</strong>
[<span class="keyword">*</span>PE1-LoopBack1] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</p></li><li><span>Configure IS-IS.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>isis 1</strong>
[<span class="keyword">*</span>PE1-isis-1] <strong>is-level level-1</strong>
[<span class="keyword">*</span>PE1-isis-1] <strong>cost-style wide</strong>
[<span class="keyword">*</span>PE1-isis-1] <strong>network-entity 10.0000.0000.0001.00</strong>
[<span class="keyword">*</span>PE1-isis-1] <strong>ipv6 enable topology ipv6</strong>
[<span class="keyword">*</span>PE1-isis-1] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet <span>0/1/0</span></strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>isis ipv6 enable 1</strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet <span>0/3/0</span></strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/3/0</span>] <strong>isis ipv6 enable 1</strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/3/0</span>] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>interface loopback1</strong>
[<span class="keyword">*</span>PE1-LoopBack1] <strong>isis ipv6 enable 1</strong>
[<span class="keyword">*</span>PE1-LoopBack1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-LoopBack1] <strong>quit</strong></pre>
<p># Configure P1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P1] <strong>isis 1</strong> 
[<span class="keyword">*</span>P1-isis-1] <strong>is-level level-1</strong>
[<span class="keyword">*</span>P1-isis-1] <strong>cost-style wide</strong>
[<span class="keyword">*</span>P1-isis-1] <strong>network-entity 10.0000.0000.0002.00</strong>
[<span class="keyword">*</span>P1-isis-1] <strong>ipv6 enable topology ipv6</strong>
[<span class="keyword">*</span>P1-isis-1] <strong>quit</strong>
[<span class="keyword">*</span>P1] <strong>interface gigabitethernet <span>0/1/0</span></strong>
[<span class="keyword">*</span>P1-GigabitEthernet<span>0/1/0</span>] <strong>isis ipv6 enable 1</strong>
[<span class="keyword">*</span>P1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong>
[<span class="keyword">*</span>P1] <strong>interface gigabitethernet <span>0/2/0</span></strong>
[<span class="keyword">*</span>P1-GigabitEthernet<span>0/2/0</span>] <strong>isis ipv6 enable 1</strong>
[<span class="keyword">*</span>P1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong>
[<span class="keyword">*</span>P1] <strong>interface loopback1</strong>
[<span class="keyword">*</span>P1-LoopBack1] <strong>isis ipv6 enable 1</strong>
[<span class="keyword">*</span>P1-LoopBack1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P1-LoopBack1] <strong>quit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>isis 1</strong>
[<span class="keyword">*</span>PE2-isis-1] <strong>is-level level-1</strong>
[<span class="keyword">*</span>PE2-isis-1] <strong>cost-style wide</strong>
[<span class="keyword">*</span>PE2-isis-1] <strong>network-entity 10.0000.0000.0003.00</strong>
[<span class="keyword">*</span>PE2-isis-1] <strong>ipv6 enable topology ipv6</strong>
[<span class="keyword">*</span>PE2-isis-1] <strong>quit</strong>
[<span class="keyword">*</span>PE2] <strong>interface gigabitethernet <span>0/1/0</span></strong>
[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>isis ipv6 enable 1</strong>
[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong>
[<span class="keyword">*</span>PE2] <strong>interface gigabitethernet <span>0/3/0</span></strong>
[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/3/0</span>] <strong>isis ipv6 enable 1</strong>
[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/3/0</span>] <strong>quit</strong>
[<span class="keyword">*</span>PE2] <strong>interface loopback1</strong>
[<span class="keyword">*</span>PE2-LoopBack1] <strong>isis ipv6 enable 1</strong>
[<span class="keyword">*</span>PE2-LoopBack1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-LoopBack1] <strong>quit</strong></pre>
</p><p><p># Configure P2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P2] <strong>isis 1</strong> 
[<span class="keyword">*</span>P2-isis-1] <strong>is-level level-1</strong>
[<span class="keyword">*</span>P2-isis-1] <strong>cost-style wide</strong>
[<span class="keyword">*</span>P2-isis-1] <strong>network-entity 10.0000.0000.0004.00</strong>
[<span class="keyword">*</span>P2-isis-1] <strong>ipv6 enable topology ipv6</strong>
[<span class="keyword">*</span>P2-isis-1] <strong>quit</strong>
[<span class="keyword">*</span>P2] <strong>interface gigabitethernet <span>0/1/0</span></strong>
[<span class="keyword">*</span>P2-GigabitEthernet<span>0/1/0</span>] <strong>isis ipv6 enable 1</strong>
[<span class="keyword">*</span>P2-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong>
[<span class="keyword">*</span>P2] <strong>interface gigabitethernet <span>0/2/0</span></strong>
[<span class="keyword">*</span>P2-GigabitEthernet<span>0/2/0</span>] <strong>isis ipv6 enable 1</strong>
[<span class="keyword">*</span>P2-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong>
[<span class="keyword">*</span>P2] <strong>interface loopback1</strong>
[<span class="keyword">*</span>P2-LoopBack1] <strong>isis ipv6 enable 1</strong>
[<span class="keyword">*</span>P2-LoopBack1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P2-LoopBack1] <strong>quit</strong></pre>
<p>After the configuration is complete, perform the following operations to check whether IS-IS is successfully configured:</p>
<p># Display IS-IS neighbor information. The following example uses the command output on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display isis peer</strong>

                          Peer information for ISIS(1)       

  System Id     Interface          Circuit Id        State HoldTime Type     PRI     
--------------------------------------------------------------------------------     
0000.0000.0002* GE<span>0/1/0</span>            0000.0000.0002.01  Up   6s       L1       64      
0000.0000.0004* GE<span>0/3/0</span>            0000.0000.0004.01  Up   9s       L1       64      

Total Peer(s): 2 </pre>
<p># Display IS-IS routing table information. The following example uses the command output on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display isis route</strong>
                         Route information for ISIS(1)       
                         -----------------------------       

                        ISIS(1) Level-1 Forwarding Table     
                        --------------------------------     
 IPV6 Dest.        ExitInterface      NextHop                    Cost     Flags         
--------------------------------------------------------------------------------     
2001:DB8:1::/96    GE<span>0/1/0</span>            Direct                     10       D/-/L/-       
2001:DB8:2::/96    GE<span>0/1/0</span>            FE80::3A5D:67FF:FE31:307   20       A/-/-/-       
2001:DB8:3::/96    GE<span>0/3/0</span>            Direct                     10       D/-/L/-       
2001:DB8:4::/96    GE<span>0/3/0</span>            FE80::3A5D:67FF:FE41:305   20       A/-/-/-  
2001:DB8:11::1/128 Loop1              Direct                     0        D/-/L/-       
2001:DB8:12::2/128 GE<span>0/1/0</span>            FE80::3A5D:67FF:FE31:307   10       A/-/-/-       
2001:DB8:13::3/128 GE<span>0/1/0</span>            FE80::3A5D:67FF:FE31:307   20       A/-/-/-       
                   GE<span>0/3/0</span>            FE80::3A5D:67FF:FE41:305  
2001:DB8:14::4/128 GE<span>0/3/0</span>            FE80::3A5D:67FF:FE41:305   10       A/-/-/- 
     Flags: D-Direct, A-Added to URT, L-Advertised in LSPs, S-IGP Shortcut,          
            U-Up/Down Bit Set, LP-Local Prefix-Sid           
     Protect Type: L-Link Protect, N-Node Protect   </pre>
</p></li><li><span>Configure delay attributes for Flex-Algo links.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>te attribute enable</strong>            
[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet<span>0/1/0</span></strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>te link-attribute-application flex-algo</strong>  
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>-te-link-attribute-application] <strong>delay 10</strong>      
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>-te-link-attribute-application] <strong>quit</strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong> 
[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet<span>0/3/0</span></strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/3/0</span>] <strong>te link-attribute-application flex-algo</strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/3/0</span>-te-link-attribute-application] <strong>delay 20</strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/3/0</span>-te-link-attribute-application] <strong>quit</strong>                           
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/3/0</span>] <strong>quit</strong>                                       
[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure P1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P1] <strong>te attribute enable</strong>            
[<span class="keyword">*</span>P1] <strong>interface gigabitethernet<span>0/1/0</span></strong>
[<span class="keyword">*</span>P1-GigabitEthernet<span>0/1/0</span>] <strong>te link-attribute-application flex-algo</strong>  
[<span class="keyword">*</span>P1-GigabitEthernet<span>0/1/0</span>-te-link-attribute-application] <strong>delay 10</strong>      
[<span class="keyword">*</span>P1-GigabitEthernet<span>0/1/0</span>-te-link-attribute-application] <strong>quit</strong>
[<span class="keyword">*</span>P1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong> 
[<span class="keyword">*</span>P1] <strong>interface gigabitethernet</strong><strong><span>0/2/0</span></strong>
[<span class="keyword">*</span>P1-GigabitEthernet<span>0/2/0</span>] <strong>te link-attribute-application flex-algo</strong>
[<span class="keyword">*</span>P1-GigabitEthernet<span>0/2/0</span>-te-link-attribute-application] <strong>delay 10</strong>
[<span class="keyword">*</span>P1-GigabitEthernet<span>0/2/0</span>-te-link-attribute-application] <strong>quit</strong>                           
[<span class="keyword">*</span>P1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong>                                       
[<span class="keyword">*</span>P1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>te attribute enable</strong>            
[<span class="keyword">*</span>PE2] <strong>interface gigabitethernet<span>0/1/0</span></strong>
[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>te link-attribute-application flex-algo</strong>  
[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>-te-link-attribute-application] <strong>delay 10</strong>      
[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>-te-link-attribute-application] <strong>quit</strong>
[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong> 
[<span class="keyword">*</span>PE2] <strong>interface gigabitethernet<span>0/3/0</span></strong>
[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/3/0</span>] <strong>te link-attribute-application flex-algo</strong>
[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/3/0</span>-te-link-attribute-application] <strong>delay 20</strong>
[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/3/0</span>-te-link-attribute-application] <strong>quit</strong>                           
[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/3/0</span>] <strong>quit</strong>                                       
[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure P2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P2] <strong>te attribute enable</strong>            
[<span class="keyword">*</span>P2] <strong>interface gigabitethernet<span>0/1/0</span></strong>
[<span class="keyword">*</span>P2-GigabitEthernet<span>0/1/0</span>] <strong>te link-attribute-application flex-algo</strong>  
[<span class="keyword">*</span>P2-GigabitEthernet<span>0/1/0</span>-te-link-attribute-application] <strong>delay 20</strong>      
[<span class="keyword">*</span>P2-GigabitEthernet<span>0/1/0</span>-te-link-attribute-application] <strong>quit</strong>
[<span class="keyword">*</span>P2-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong> 
[<span class="keyword">*</span>P2] <strong>interface gigabitethernet</strong><strong><span>0/2/0</span></strong>
[<span class="keyword">*</span>P2-GigabitEthernet<span>0/2/0</span>] <strong>te link-attribute-application flex-algo</strong>
[<span class="keyword">*</span>P2-GigabitEthernet<span>0/2/0</span>-te-link-attribute-application] <strong>delay 20</strong>
[<span class="keyword">*</span>P2-GigabitEthernet<span>0/2/0</span>-te-link-attribute-application] <strong>quit</strong>                           
[<span class="keyword">*</span>P2-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong>                                       
[<span class="keyword">*</span>P2] <strong>commit</strong></pre>
</p></li><li><span>Configure FADs.</span><p><p>You can select one or two devices in the same IGP domain to configure FADs. To improve reliability, you are advised to select two devices.</p>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>flex-algo identifier 128</strong> 
[<span class="keyword">*</span>PE1-flex-algo-128] <strong>priority 100</strong>   
[<span class="keyword">*</span>PE1-flex-algo-128] <strong>metric-type delay</strong>
[<span class="keyword">*</span>PE1-flex-algo-128] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>flex-algo identifier 128</strong> 
[<span class="keyword">*</span>PE2-flex-algo-128] <strong>priority 100</strong>   
[<span class="keyword">*</span>PE2-flex-algo-128] <strong>metric-type delay</strong>
[<span class="keyword">*</span>PE2-flex-algo-128] <strong>quit</strong>
[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</p></li><li><span>Enable IS-IS-based Flex-Algo advertisement, IS-IS TE, and IS-IS-based IPv6 link delay advertisement.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>isis 1</strong>
[<span class="keyword">*</span>PE1-isis-1] <strong>flex-algo 128 level-1</strong>
[<span class="keyword">*</span>PE1-isis-1] <strong>ipv6 traffic-eng level-1</strong>
[<span class="keyword">*</span>PE1-isis-1] <strong>ipv6 metric-delay advertisement enable level-1</strong>
[<span class="keyword">*</span>PE1-isis-1] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure P1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P1] <strong>isis 1</strong>
[<span class="keyword">*</span>P1-isis-1] <strong>flex-algo 128 level-1</strong>
[<span class="keyword">*</span>P1-isis-1] <strong>ipv6 traffic-eng level-1</strong>
[<span class="keyword">*</span>P1-isis-1] <strong>ipv6 metric-delay advertisement enable level-1</strong>
[<span class="keyword">*</span>P1-isis-1] <strong>quit</strong>
[<span class="keyword">*</span>P1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>isis 1</strong>
[<span class="keyword">*</span>PE2-isis-1] <strong>flex-algo 128 level-1</strong>
[<span class="keyword">*</span>PE2-isis-1] <strong>ipv6 traffic-eng level-1</strong>
[<span class="keyword">*</span>PE2-isis-1] <strong>ipv6 metric-delay advertisement enable level-1</strong>
[<span class="keyword">*</span>PE2-isis-1] <strong>quit</strong>
[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure P2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P2] <strong>isis 1</strong>
[<span class="keyword">*</span>P2-isis-1] <strong>flex-algo 128 level-1</strong>
[<span class="keyword">*</span>P2-isis-1] <strong>ipv6 traffic-eng level-1</strong>
[<span class="keyword">*</span>P2-isis-1] <strong>ipv6 metric-delay advertisement enable level-1</strong>
[<span class="keyword">*</span>P2-isis-1] <strong>quit</strong>
[<span class="keyword">*</span>P2] <strong>commit</strong></pre>
</p></li><li><span>Configure EVPN L3VPN instances on the PEs and connect CEs to the PEs.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>ip vpn-instance vpn1</strong>
[<span class="keyword">*</span>PE1-vpn-instance-vpn1] <strong>ipv4-family</strong>
[<span class="keyword">*</span>PE1-vpn-instance-vpn1-af-ipv4] <strong>route-distinguisher 100:1</strong>
[<span class="keyword">*</span>PE1-vpn-instance-vpn1-af-ipv4] <strong>vpn-target 111:1 both evpn</strong>
[<span class="keyword">*</span>PE1-vpn-instance-vpn1-af-ipv4] <strong>quit</strong>
[<span class="keyword">*</span>PE1-vpn-instance-vpn1] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet <span>0/2/0</span></strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>ip binding vpn-instance vpn1</strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>ip address 10.1.1.2 24</strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>ip vpn-instance vpn1</strong>
[<span class="keyword">*</span>PE2-vpn-instance-vpn1] <strong>ipv4-family</strong>
[<span class="keyword">*</span>PE2-vpn-instance-vpn1-af-ipv4] <strong>route-distinguisher 200:1</strong>
[<span class="keyword">*</span>PE2-vpn-instance-vpn1-af-ipv4] <strong>vpn-target 111:1 both evpn</strong>
[<span class="keyword">*</span>PE2-vpn-instance-vpn1-af-ipv4] <strong>quit</strong>
[<span class="keyword">*</span>PE2-vpn-instance-vpn1] <strong>quit</strong>
[<span class="keyword">*</span>PE2] <strong>interface gigabitethernet <span>0/2/0</span></strong>
[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>] <strong>ip binding vpn-instance vpn1</strong>
[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>] <strong>ip address 10.2.1.2 24</strong>
[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong>
[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure an IP address for each interface on the CEs, as shown in <a href="#EN-US_TASK_0311166329__fig_dc_vrp_srv6_cfg_all_001101">Figure 1</a>. For configuration details, see <a href="#EN-US_TASK_0311166329__section_dc_vrp_srv6_cfg_all_001105">Configuration Files</a> in this section.</p>
<p>After the configuration is complete, run the <strong>display ip vpn-instance verbose</strong> command on the PEs to check VPN instance configurations. Check that each PE can successfully ping its connected CE.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>If a PE has multiple interfaces bound to the same VPN instance, specify a source IP address using the <strong>-a</strong> <em>source-ip-address</em> parameter in the <strong>ping -vpn-instance</strong> <em>vpn-instance-name</em> <strong>-a</strong> <em>source-ip-address dest-ip-address</em> command to ping the CE that is connected to the remote PE. If the source IP address is not specified, the ping operation may fail.</p>
</div></div>
</p></li><li><span>Establish an EBGP peer relationship between each PE and its connected CE.</span><p><p># Configure CE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>interface loopback 1</strong>
[<span class="keyword">*</span>CE1-LoopBack1] <strong>ip address 10.11.1.1 32</strong>
[<span class="keyword">*</span>CE1-LoopBack1] <strong>quit</strong>
[<span class="keyword">*</span>CE1] <strong>bgp 65410</strong>
[<span class="keyword">*</span>CE1-bgp] <strong>peer 10.1.1.2 as-number 100</strong>
[<span class="keyword">*</span>CE1-bgp] <strong>network 10.11.1.1 32</strong>
[<span class="keyword">*</span>CE1-bgp] <strong>quit</strong>
[<span class="keyword">*</span>CE1] <strong>commit</strong></pre>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong>
[<span class="keyword">*</span>PE1-bgp] <strong>router-id 1.1.1.1</strong>
[<span class="keyword">*</span>PE1-bgp] <strong>ipv4-family vpn-instance vpn1</strong>
[<span class="keyword">*</span>PE1-bgp-vpn1] <strong>peer 10.1.1.1 as-number 65410</strong>
[<span class="keyword">*</span>PE1-bgp-vpn1] <strong>import-route direct</strong>
[<span class="keyword">*</span>PE1-bgp-vpn1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp-vpn1] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp] <strong>quit</strong></pre>
<p># Configure CE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>interface loopback 1</strong>
[<span class="keyword">*</span>CE2-LoopBack1] <strong>ip address 10.22.2.2 32</strong>
[<span class="keyword">*</span>CE2-LoopBack1] <strong>quit</strong>
[<span class="keyword">*</span>CE2] <strong>bgp 65420</strong>
[<span class="keyword">*</span>CE2-bgp] <strong>peer 10.2.1.2 as-number 100</strong>
[<span class="keyword">*</span>CE2-bgp] <strong>network 10.22.2.2 32</strong>
[<span class="keyword">*</span>CE2-bgp] <strong>quit</strong>
[<span class="keyword">*</span>CE2] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>bgp 100</strong>
[<span class="keyword">*</span>PE2-bgp] <strong>router-id 2.2.2.2</strong>
[<span class="keyword">*</span>PE2-bgp] <strong>ipv4-family vpn-instance vpn1</strong>
[<span class="keyword">*</span>PE2-bgp-vpn1] <strong>peer 10.2.1.1 as-number 65420</strong>
[<span class="keyword">*</span>PE2-bgp-vpn1] <strong>import-route direct</strong>
[<span class="keyword">*</span>PE2-bgp-vpn1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-bgp-vpn1] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-bgp] <strong>quit</strong></pre>
<p>After the configuration is complete, run the <strong>display bgp vpnv4 vpn-instance peer</strong> command on the PEs to check whether BGP peer relationships have been established between the PEs and CEs. If the <strong>Established</strong> state is displayed in the command output, the BGP peer relationships have been established successfully.</p>
<p>The following example uses the peer relationship between PE1 and CE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display bgp vpnv4 vpn-instance vpn1 peer</strong>

 BGP local router ID : 1.1.1.1                                                                                                      
 Local AS number : 100                                                                                                              

 VPN-Instance vpn1, Router ID 1.1.1.1:                                                                                              
 Total number of peers : 1                 Peers in established state : 1                                                           

  Peer                             V          AS  MsgRcvd  MsgSent  OutQ  Up/Down       State  PrefRcv                              
  10.1.1.1                         4       65410      310      318     0 04:26:42 Established        1  </pre>
</p></li><li><span>Establish a BGP EVPN peer relationship between the PEs.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp] <strong>peer 2001:db8:13::3 as-number 100</strong>
[<span class="keyword">*</span>PE1-bgp] <strong>peer 2001:db8:13::3 connect-interface loopback 1</strong>
[<span class="keyword">*</span>PE1-bgp] <strong>l2vpn-family evpn</strong>                                                                                   
[<span class="keyword">*</span>PE1-bgp-af-evpn] <strong>peer 2001:db8:13::3 enable</strong>                                                                   
[<span class="keyword">*</span>PE1-bgp-af-evpn] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp-af-evpn] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp] <strong>quit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>bgp 100</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-bgp] <strong>peer 2001:db8:11::1 as-number 100</strong>
[<span class="keyword">*</span>PE2-bgp] <strong>peer 2001:db8:11::1 connect-interface loopback 1</strong>
[<span class="keyword">*</span>PE2-bgp] <strong>l2vpn-family evpn</strong>                                                                                   
[<span class="keyword">*</span>PE2-bgp-af-evpn] <strong>peer 2001:db8:11::1 enable</strong>                                                                    
[<span class="keyword">*</span>PE2-bgp-af-evpn] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-bgp-af-evpn] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-bgp] <strong>quit</strong></pre>
<p>After the configuration is complete, run the <strong>display bgp evpn peer</strong> command on the PEs to check whether the BGP peer relationship has been established. If the <strong>Established</strong> state is displayed in the command output, the BGP peer relationship has been established successfully. The following example uses the command output on PE1.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE1] <strong>display bgp evpn peer</strong> 

 BGP local router ID : 1.1.1.1
 Local AS number : 100       
 Total number of peers : 1                 Peers in established state : 1

  Peer                             V          AS  MsgRcvd  MsgSent  OutQ  Up/Down       State  PrefRcv
  2001:DB8:13::3                   4         100      314      311     0 04:27:06 Established        2 </pre>
</p></li><li><span>Establish a Flex-Algo-based SRv6 BE path between the PEs.</span><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0311166329__en-us_task_0172368972_p13414842202714">An End.DT4 SID can be either dynamically allocated through BGP or manually configured. If a dynamically allocated SID and a manually configured SID both exist, the latter takes effect. If you want to run the <span><a href="cmdqueryname=segment-routing+ipv6+locator"><b><span class="cmdname" id="EN-US_TASK_0311166329__en-us_task_0172368972_cmdname175640204576">segment-routing ipv6 locator</span></b></a> <i><span class="varname" id="EN-US_TASK_0311166329__en-us_task_0172368972_varname165646206572">locator-name</span></i></span> command to enable dynamic End.DT4 SID allocation through BGP or the <span><a href="cmdqueryname=segment-routing+ipv6+locator"><b><span class="cmdname" id="EN-US_TASK_0311166329__en-us_task_0172368972_cmdname5915391314">segment-routing ipv6 locator</span></b></a> <i><span class="varname" id="EN-US_TASK_0311166329__en-us_task_0172368972_varname7925361319">locator-name</span></i></span> <a href="cmdqueryname=end-dt46"><b><span class="cmdname" id="EN-US_TASK_0311166329__en-us_task_0172368972_cmdname15469174113155">end-dt46</span></b></a> command to enable dynamic End.DT46 SID allocation through BGP in the future, you do not need to run the <strong id="EN-US_TASK_0311166329__en-us_task_0172368972_b14130427277">opcode</strong> <em id="EN-US_TASK_0311166329__en-us_task_0172368972_i10413164212710">func-opcode</em> <strong id="EN-US_TASK_0311166329__en-us_task_0172368972_b54130425272">end-dt4</strong> <strong id="EN-US_TASK_0311166329__en-us_task_0172368972_b1541314222715">vpn-instance</strong> <em id="EN-US_TASK_0311166329__en-us_task_0172368972_i1741314219275">vpn-instance-name</em> or <strong id="EN-US_TASK_0311166329__en-us_task_0172368972_b10930145741911">opcode</strong> <em id="EN-US_TASK_0311166329__en-us_task_0172368972_i1393025781918">func-opcode</em> <strong id="EN-US_TASK_0311166329__en-us_task_0172368972_b1193020571190">end-dt46</strong> <strong id="EN-US_TASK_0311166329__en-us_task_0172368972_b19930105751920">vpn-instance</strong> <em id="EN-US_TASK_0311166329__en-us_task_0172368972_i393014571194">vpn-instance-name</em> command to configure an opcode for static SIDs.</p>
<p id="EN-US_TASK_0311166329__en-us_task_0172368972_p722259122814">In this example, SIDs are dynamically allocated through BGP.</p>
</div></div>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>segment-routing ipv6</strong>
[<span class="keyword">*</span>PE1-segment-routing-ipv6] <strong>encapsulation source-address 2001:db8:11::1</strong>
[<span class="keyword">*</span>PE1-segment-routing-ipv6] <strong>locator PE1 ipv6-prefix <span>2001:db8:100::</span> 64 static 32 flex-algo 128</strong>
[<span class="keyword">*</span>PE1-segment-routing-ipv6-locator] <strong>quit</strong>
[<span class="keyword">*</span>PE1-segment-routing-ipv6] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>bgp 100</strong>
[<span class="keyword">*</span>PE1-bgp] <strong>l2vpn-family evpn</strong>                                                                                   
[<span class="keyword">*</span>PE1-bgp-af-evpn] <strong>peer 2001:db8:13::3 advertise encap-type srv6</strong> 
[<span class="keyword">*</span>PE1-bgp-af-evpn] <strong>quit</strong>
[<span class="keyword">*</span>PE1-bgp] <strong>ipv4-family vpn-instance vpn1</strong>
[<span class="keyword">*</span>PE1-bgp-vpn1] <strong>advertise l2vpn evpn</strong>
[<span class="keyword">*</span>PE1-bgp-vpn1] <strong>segment-routing ipv6 best-effort evpn</strong>
[<span class="keyword">*</span>PE1-bgp-vpn1] <strong>segment-routing ipv6 locator PE1 evpn</strong>
[<span class="keyword">*</span>PE1-bgp-vpn1] <strong>quit</strong>
[<span class="keyword">*</span>PE1-bgp] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>isis 1</strong>
[<span class="keyword">*</span>PE1-isis-1] <strong>segment-routing ipv6 locator PE1</strong>
[<span class="keyword">*</span>PE1-isis-1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-isis-1] <strong>quit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>segment-routing ipv6</strong>
[<span class="keyword">*</span>PE2-segment-routing-ipv6] <strong>encapsulation source-address 2001:db8:13::3</strong>
[<span class="keyword">*</span>PE2-segment-routing-ipv6] <strong>locator PE2 ipv6-prefix <span>2001:db8:300::</span> 64 static 32 flex-algo 128</strong>
[<span class="keyword">*</span>PE2-segment-routing-ipv6-locator] <strong>quit</strong>
[<span class="keyword">*</span>PE2-segment-routing-ipv6] <strong>quit</strong>
[<span class="keyword">*</span>PE2] <strong>bgp 100</strong>
[<span class="keyword">*</span>PE2-bgp] <strong>l2vpn-family evpn</strong>                                                                                   
[<span class="keyword">*</span>PE2-bgp-af-evpn] <strong>peer 2001:db8:11::1 advertise encap-type srv6</strong> 
[<span class="keyword">*</span>PE2-bgp-af-evpn] <strong>quit</strong>
[<span class="keyword">*</span>PE2-bgp] <strong>ipv4-family vpn-instance vpn1</strong>
[<span class="keyword">*</span>PE2-bgp-vpn1] <strong>advertise l2vpn evpn</strong>
[<span class="keyword">*</span>PE2-bgp-vpn1] <strong>segment-routing ipv6 best-effort evpn</strong>
[<span class="keyword">*</span>PE2-bgp-vpn1] <strong>segment-routing ipv6 locator PE2 evpn</strong>
[<span class="keyword">*</span>PE2-bgp-vpn1] <strong>quit</strong>
[<span class="keyword">*</span>PE2-bgp] <strong>quit</strong>
[<span class="keyword">*</span>PE2] <strong>isis 1</strong>
[<span class="keyword">*</span>PE2-isis-1] <strong>segment-routing ipv6 locator PE2</strong>
[<span class="keyword">*</span>PE2-isis-1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-isis-1] <strong>quit</strong></pre>
<p># Configure P1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P1] <strong>segment-routing ipv6</strong>
[<span class="keyword">*</span>P1-segment-routing-ipv6] <strong>locator P1 ipv6-prefix <span><span>2001:db8:</span>200::</span> 64 static 32 flex-algo 128</strong>
[<span class="keyword">*</span>P1-segment-routing-ipv6-locator] <strong>quit</strong>
[<span class="keyword">*</span>P1-segment-routing-ipv6] <strong>quit</strong>
[<span class="keyword">*</span>P1] <strong>isis 1</strong>
[<span class="keyword">*</span>P1-isis-1] <strong>segment-routing ipv6 locator P1</strong>
[<span class="keyword">*</span>P1-isis-1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P1-isis-1] <strong>quit</strong></pre>
<p># Configure P2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P2] <strong>segment-routing ipv6</strong>
[<span class="keyword">*</span>P2-segment-routing-ipv6] <strong>locator P2 ipv6-prefix <span>2001:db8:</span><span>400::</span> 64 static 32 flex-algo 128</strong>
[<span class="keyword">*</span>P2-segment-routing-ipv6-locator] <strong>quit</strong>
[<span class="keyword">*</span>P2-segment-routing-ipv6] <strong>quit</strong>
[<span class="keyword">*</span>P2] <strong>isis 1</strong>
[<span class="keyword">*</span>P2-isis-1] <strong>segment-routing ipv6 locator P2</strong>
[<span class="keyword">*</span>P2-isis-1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P2-isis-1] <strong>quit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p>Run the <a href="cmdqueryname=display+segment-routing+ipv6+locator"><b><span class="cmdname">display segment-routing ipv6 locator</span></b></a> [ <i><span class="varname">locator-name</span></i> ] <strong><span>verbose</span></strong> command to check SRv6 locator information. The following example uses the command output on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display segment-routing ipv6 locator verbose</strong>
                        Locator Configuration Table                          
                        ---------------------------                          

LocatorName   : PE1                                       LocatorID     : 3  
IPv6Prefix    : 2001:DB8:100::                            PrefixLength  : 64 
Block         : --                                        BlockLength   : 0  
NodeID        : --                                        NodeIdLength  : 0  
ComprStaticLen: 0                                         StaticLength  : 32 
ArgsLength    : 0                                         Reference     : 0  
Algorithm     : 128                                       ComprDynLength: 0  
AutoCSIDPoolID: 0
AutoCSIDBegin : --    
AutoCSIDEnd   : --    
StaticCSIDBegin: --   
StaticCSIDEnd : --    
AutoSIDPoolID : 8194                                      DynLength     : 32 
AutoSIDBegin  : 2001:DB8:100::1:0:0                                          
AutoSIDEnd    : 2001:DB8:100:0:FFFF:FFFF:FFFF:FFFF                           
StaticSIDBegin: 2001:DB8:100::1                                              
StaticSIDEnd  : 2001:DB8:100::FFFF:FFFF
GIB:LIB       : --

Total Locator(s): 1</pre>
<p>Run the <a href="cmdqueryname=display+segment-routing+ipv6+local-sid"><b><span class="cmdname">display segment-routing ipv6 local-sid</span></b></a> <strong><span>end-dt4</span></strong> <strong><span>forwarding</span></strong> command to check information about the SRv6 local SID table. The following example uses the command output on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display segment-routing ipv6 local-sid end-dt4 forwarding</strong>

                    My Local-SID End.DT4 Forwarding Table                                                                           
                    -------------------------------------                                                                           

SID        : 2001:DB8:100::1:0:3C/128                     FuncType    : End.DT4       
VPN Name   : vpn1                                         VPN ID      : 3       
LocatorName: PE1                                          LocatorID   : 1    
Flavor     : NO-FLAVOR                                    SidCompress : NO   
UpdateTime : 2023-05-10 01:46:05.713

Total SID(s): 1  </pre>
<p>Run the <strong>display isis route ipv6 flex-algo 128</strong> command on the PEs to check routing information about IS-IS Flex-Algo 128. The following example uses the command output on PE1.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE1] <strong>display isis route ipv6 flex-algo 128</strong>
                         Route information for ISIS(1)                
                         ----------------------------- 

                   ISIS(1) Level-1 Flex-Algo Forwarding Table        
                   ------------------------------------------ 
 IPV6 Dest.       ExitInterface      NextHop                    Cost     Flags             
--------------------------------------------------------------------------------                              
2001:DB8:100::/64 NULL0              -                          0        A/-/-/-
2001:DB8:200::/64 GE<span>0/1/0</span>            FE80::3A5D:67FF:FE31:307   10       A/-/-/-
2001:DB8:300::/64 GE<span>0/1/0</span>            FE80::3A5D:67FF:FE31:307   20       A/-/-/-
2001:DB8:400::/64 GE<span>0/3/0</span>            FE80::3A5D:67FF:FE41:305   20       A/-/-/-
                                                                                                                                 
     Flags: D-Direct, A-Added to URT, L-Advertised in LSPs, S-IGP Shortcut,
            U-Up/Down Bit Set, LP-Local Prefix-Sid
     Protect Type: L-Link Protect, N-Node Protect</pre>
<p>The command output shows that the outbound interface of the locator route 2001:DB8:300::/64 is GE <span>0/1/0</span>, indicating that data traffic is forwarded along the PE1-P1-PE2 link with a low delay.</p>
<p>Run the <strong>display bgp evpn all routing-table</strong> command on the PEs to check BGP EVPN routing information. The following example uses the command output on PE1.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE1] <strong>display bgp evpn all routing-table</strong>                        


 Local AS number : 100

 BGP Local router ID is 1.1.1.1                                            
 Status codes: * - valid, &gt; - best, d - damped, x - best external, a - add path,
               h - history,  i - internal, s - suppressed, S - Stale 
               Origin : i - IGP, e - EGP, ? - incomplete                   


 EVPN address family:  
 Number of Ip Prefix Routes: 4                                  
 Route Distinguisher: 100:1                                  
       Network(EthTagId/IpPrefix/IpPrefixLen)                 NextHop
 *&gt;    0:10.1.1.0:24                                          0.0.0.0 
 *&gt;    0:10.11.1.1:32                                         10.1.1.1
 Route Distinguisher: 200:1
       Network(EthTagId/IpPrefix/IpPrefixLen)                 NextHop
 *&gt;i   0:10.2.1.0:24                                          2001:DB8:13::3
 *&gt;i   0:10.22.2.2:32                                         2001:DB8:13::3</pre>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE1] <strong>display bgp evpn all routing-table prefix-route 0:10.22.2.2:32</strong>

 BGP local router ID : 1.1.1.1 
 Local AS number : 100                                       
 Total routes of Route Distinguisher(200:1): 1 
 BGP routing table entry information of 0:10.22.2.2:32: 
 Label information (Received/Applied): 3/NULL
 From: 2001:DB8:13::3 (2.2.2.2) 
 Route Duration: 0d04h42m41s                                                     
 Relay IP Nexthop: FE80::3A5D:67FF:FE31:307 
 Relay IP Out-Interface: GigabitEthernet<span>0/1/0</span> 
 Relay Tunnel Out-Interface:
 Original nexthop: 2001:DB8:13::3 
 Qos information : 0x0 
 Ext-Community: RT &lt;111 : 1&gt; 
 Prefix-sid: 2001:DB8:300::1:0:3E                               
 AS-path 65420, origin igp, MED 0, localpref 100, pref-val 0, valid, internal, best, select, pre 255, IGP cost 20 
 Route Type: 5 (Ip Prefix Route) 
 Ethernet Tag ID: 0, IP Prefix/Len: 10.22.2.2/32, ESI: 0000.0000.0000.0000.0000, GW IP Address: 0.0.0.0     
 Not advertised to any peer yet </pre>
<p>Run the <strong>display ip routing-table</strong> <strong>vpn-instance vpn1</strong> command on the PEs to check VPN routing table information. The following example uses the command output on PE1.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE1] <strong>display ip routing-table vpn-instance vpn1</strong> 
Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route                                              
------------------------------------------------------------------------------                                                      
Routing Table : vpn1                                                                                                                
         Destinations : 8        Routes : 8                                                                                         

Destination/Mask    Proto   Pre  Cost        Flags NextHop               Interface                                                        

       10.1.1.0/24  Direct  0    0             D   10.1.1.2              GigabitEthernet<span>0/2/0</span>
       10.1.1.2/32  Direct  0    0             D   127.0.0.1             GigabitEthernet<span>0/2/0</span>              
     10.1.1.255/32  Direct  0    0             D   127.0.0.1             GigabitEthernet<span>0/2/0</span>           
       10.2.1.0/24  IBGP    255  0             RD  2001:DB8:300::1:0:3E  GigabitEthernet<span>0/1/0</span>    
      10.11.1.1/32  EBGP    255  0             RD  10.1.1.1              GigabitEthernet<span>0/2/0</span>           
      10.22.2.2/32  IBGP    255  0             RD  2001:DB8:300::1:0:3E  GigabitEthernet<span>0/1/0</span>    
      127.0.0.0/8   Direct  0    0             D   127.0.0.1             InLoopBack0                                                      
255.255.255.255/32  Direct  0    0             D   127.0.0.1             InLoopBack0  </pre>
<p>Run the <a href="cmdqueryname=display+ip+routing-table+vpn-instance+vpn1"><b><span class="cmdname">display ip routing-table vpn-instance vpn1</span></b></a> <i><span class="varname">ip-address</span></i> <strong><span>verbose</span></strong> command on the PEs to check detailed routing table information about the specified VPN instance. The following example uses the command output on PE1.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE1] <strong>display ip routing-table vpn-instance vpn1 10.22.2.2 verbose</strong>
Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route                                              
------------------------------------------------------------------------------                                                      
Routing Table : vpn1                                                                                                                
Summary Count : 1                                                                                                                   

Destination: 10.22.2.2/32 
     Protocol: IBGP               Process ID: 0 
   Preference: 255                      Cost: 0 
      NextHop: 2001:DB8:300::1:0:3E Neighbour: 2001:DB8:13::3 
        State: Active Adv Relied         Age: 03h36m34s  
          Tag: 0                    Priority: low 
        Label: NULL                  QoSInfo: 0x0
   IndirectID: 0x10000E3            Instance: 
 RelayNextHop: FE80::3A00:10FF:FE03:5 Interface: GigabitEthernet<span>0/1/0</span>
     TunnelID: 0x0                     Flags: RD 
   RouteColor: 0 </pre>
<p>Check that CEs belonging to the same VPN instance can ping each other. The following example uses the command output on CE1.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>CE1] <strong>ping -a 10.11.1.1 10.22.2.2</strong>
  PING 10.22.2.2: 56  data bytes, press CTRL_C to break                                                                             
    Reply from 10.22.2.2: bytes=56 Sequence=1 ttl=253 time=3 ms                                                                     
    Reply from 10.22.2.2: bytes=56 Sequence=2 ttl=253 time=3 ms                                                                     
    Reply from 10.22.2.2: bytes=56 Sequence=3 ttl=253 time=3 ms                                                                     
    Reply from 10.22.2.2: bytes=56 Sequence=4 ttl=253 time=3 ms                                                                     
    Reply from 10.22.2.2: bytes=56 Sequence=5 ttl=253 time=3 ms                                                                     

  --- 10.22.2.2 ping statistics ---                                                                                                 
    5 packet(s) transmitted                                                                                                         
    5 packet(s) received                                                                                                            
    0.00% packet loss                                                                                                               
    round-trip min/avg/max = 3/3/3 ms  </pre>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0311166329__section_dc_vrp_srv6_cfg_all_001105"><a name="EN-US_TASK_0311166329__section_dc_vrp_srv6_cfg_all_001105"></a><a name="section_dc_vrp_srv6_cfg_all_001105"></a><a name="EN-US_TASK_0311166329__1.4.6"></a><a name="1.4.6"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>PE1 configuration file</p>
<pre class="screen">#
sysname PE1
#
ip vpn-instance vpn1
 ipv4-family
  route-distinguisher 100:1
  apply-label per-instance
  vpn-target 111:1 export-extcommunity evpn
  vpn-target 111:1 import-extcommunity evpn
# 
te attribute enable
#   
flex-algo identifier 128
 priority 100
 metric-type delay
#               
segment-routing ipv6
 encapsulation source-address 2001:db8:11::1
 locator PE1 ipv6-prefix 2001:db8:100:: 64 static 32 flex-algo 128
#               
isis 1          
 is-level level-1
 cost-style wide
 network-entity 10.0000.0000.0001.00
 flex-algo 128 level-1
 #              
 ipv6 enable topology ipv6
 ipv6 traffic-eng level-1
 ipv6 metric-delay advertisement enable level-1
 segment-routing ipv6 locator PE1
 #
#               
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown  
 ipv6 enable
 ipv6 address 2001:db8:1::1/96
 isis ipv6 enable 1  
 te link-attribute-application flex-algo
  delay 10 
#               
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown  
 ip binding vpn-instance vpn1
 ip address 10.1.1.2 255.255.255.0
#               
interface GigabitEthernet<span>0/3/0</span>
 undo shutdown  
 ipv6 enable
 ipv6 address 2001:db8:3::1/96
 isis ipv6 enable 1 
 te link-attribute-application flex-algo                 
  delay 20 
#               
interface LoopBack1
 ipv6 enable
 ipv6 address 2001:db8:11::1/128
 isis ipv6 enable 1 
#               
bgp 100         
 router-id 1.1.1.1
 peer 2001:db8:13::3 as-number 100
 peer 2001:db8:13::3 connect-interface LoopBack1
 #              
 ipv4-family unicast
  undo synchronization
 #              
 ipv6-family unicast
  undo synchronization
 #              
 ipv4-family vpn-instance vpn1
  import-route direct
  advertise l2vpn evpn
  segment-routing ipv6 locator PE1 evpn
  segment-routing ipv6 best-effort evpn
  peer 10.1.1.1 as-number 65410
 #              
 l2vpn-family evpn
  policy vpn-target
  peer 2001:db8:13::3 enable
  peer 2001:db8:13::3 advertise encap-type srv6
#
return </pre>
</li><li><p>P1 configuration file</p>
<pre class="screen">#
sysname P1
# 
te attribute enable
#               
segment-routing ipv6
 locator P1 ipv6-prefix 2001:db8:200:: 64 static 32 flex-algo 128
#               
isis 1          
 is-level level-1
 cost-style wide
 network-entity 10.0000.0000.0002.00 
 flex-algo 128 level-1
 #              
 ipv6 enable topology ipv6
 ipv6 traffic-eng level-1
 ipv6 metric-delay advertisement enable level-1
 segment-routing ipv6 locator P1
 #
#               
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown  
 ipv6 enable
 ipv6 address 2001:db8:1::2/96
 isis ipv6 enable 1  
 te link-attribute-application flex-algo                 
  delay 10
#               
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown  
 ipv6 enable
 ipv6 address 2001:db8:2::1/96
 isis ipv6 enable 1  
 te link-attribute-application flex-algo                 
  delay 10
#               
interface LoopBack1
 ipv6 enable
 ipv6 address 2001:db8:12::2/128
 isis ipv6 enable 1 
#
return  </pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#
sysname PE2
#
ip vpn-instance vpn1
 ipv4-family
  route-distinguisher 200:1
  apply-label per-instance
  vpn-target 111:1 export-extcommunity evpn
  vpn-target 111:1 import-extcommunity evpn
# 
te attribute enable            
#               
flex-algo identifier 128
 priority 100
 metric-type delay
#               
segment-routing ipv6
 encapsulation source-address 2001:db8:13::3
 locator PE2 ipv6-prefix 2001:db8:300:: 64 static 32 flex-algo 128 
#               
isis 1          
 is-level level-1
 cost-style wide
 network-entity 10.0000.0000.0003.00
 flex-algo 128 level-1
 #              
 ipv6 enable topology ipv6
 ipv6 traffic-eng level-1
 ipv6 metric-delay advertisement enable level-1
 segment-routing ipv6 locator PE2
 #
#               
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown  
 ipv6 enable
 ipv6 address 2001:db8:2::2/96
 isis ipv6 enable 1  
 te link-attribute-application flex-algo
  delay 20 
#               
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown  
 ip binding vpn-instance vpn1
 ip address 10.2.1.2 255.255.255.0
#               
interface GigabitEthernet<span>0/3/0</span>
 undo shutdown  
 ipv6 enable
 ipv6 address 2001:db8:4::2/96
 isis ipv6 enable 1  
 te link-attribute-application flex-algo                 
  delay 10
#               
interface LoopBack1
 ipv6 enable
 ipv6 address 2001:db8:13::3/128
 isis ipv6 enable 1                                                                                            
#               
bgp 100         
 router-id 2.2.2.2
 peer 2001:db8:11::1 as-number 100
 peer 2001:db8:11::1 connect-interface LoopBack1
 #              
 ipv4-family unicast
  undo synchronization
 #              
 ipv6-family unicast
  undo synchronization
 #              
 ipv4-family vpn-instance vpn1
  import-route direct
  advertise l2vpn evpn
  segment-routing ipv6 locator PE2 evpn
  segment-routing ipv6 best-effort evpn
  peer 10.2.1.1 as-number 65420
 #              
 l2vpn-family evpn
  policy vpn-target
  peer 2001:db8:11::1 enable
  peer 2001:db8:11::1 advertise encap-type srv6
#
return</pre>
</li><li><p>P2 configuration file</p>
<pre class="screen">#
sysname P2
# 
te attribute enable
#               
segment-routing ipv6
 locator P2 ipv6-prefix 2001:db8:400:: 64 static 32 flex-algo 128
#               
isis 1          
 is-level level-1
 cost-style wide
 network-entity 10.0000.0000.0004.00
 flex-algo 128 level-1
 #              
 ipv6 enable topology ipv6
 ipv6 traffic-eng level-1
 ipv6 metric-delay advertisement enable level-1
 segment-routing ipv6 locator P2
 #
#               
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown  
 ipv6 enable
 ipv6 address 2001:db8:3::2/96
 isis ipv6 enable 1  
 te link-attribute-application flex-algo
  delay 20 
#               
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown  
 ipv6 enable
 ipv6 address 2001:db8:4::1/96
 isis ipv6 enable 1  
 te link-attribute-application flex-algo      
  delay 20 
#               
interface LoopBack1
 ipv6 enable
 ipv6 address 2001:db8:14::4/128
 isis ipv6 enable 1
#
return</pre>
</li><li><p>CE1 configuration file</p>
<pre class="screen">#
sysname CE1
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.1.1 255.255.255.0
#
interface LoopBack1
 ip address 10.11.1.1 255.255.255.255
#
bgp 65410
 peer 10.1.1.2 as-number 100
 network 10.11.1.1 255.255.255.255
 #
 ipv4-family unicast
  peer 10.1.1.2 enable
#
return</pre>
</li><li><p>CE2 configuration file</p>
<pre class="screen">#
sysname CE2
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.2.1.1 255.255.255.0
#
interface LoopBack1
 ip address 10.22.2.2 255.255.255.255
#
bgp 65420
 peer 10.2.1.2 as-number 100
 network 10.22.2.2 255.255.255.255
 #
 ipv4-family unicast
  peer 10.2.1.2 enable
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_srv6_cfg_all_0010.html">Configuration Examples for SRv6 BE (IS-IS)
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_srv6_cfg_all_0135.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_srv6_cfg_all_0260.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>