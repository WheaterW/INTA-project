
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring EVPN L3VPNv6 over OSPFv3 SRv6 BE">
<meta name="abstract" content="This section provides an example for configuring SRv6 BE to carry EVPN L3VPNv6 services.">
<meta name="description" content="This section provides an example for configuring SRv6 BE to carry EVPN L3VPNv6 services.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_srv6_cfg_all_1008.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_srv6_cfg_all_1010.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_srv6_cfg_all_1012.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,f00454608,w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featurename" content="EVPN">
<meta name="featurename" content="Segment Routing IPv6">
<meta name="featurename" content="Segment Routing IPv6 Policy">
<meta name="featurename" content="Segment Routing Policy">
<meta name="featuretype" content="Segment Routing">
<meta name="featuretype" content="VPN">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featurename" content="EVPN">
<meta name="featurename" content="Segment Routing IPv6">
<meta name="featurename" content="Segment Routing IPv6 Policy">
<meta name="featurename" content="Segment Routing Policy">
<meta name="featuretype" content="Segment Routing">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featurename" content="EVPN">
<meta name="featurename" content="Segment Routing IPv6">
<meta name="featurename" content="Segment Routing IPv6 Policy">
<meta name="featurename" content="Segment Routing Policy">
<meta name="featuretype" content="Segment Routing">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="Segment Routing IPv6">
<meta name="featuretype" content="Segment Routing">
<meta name="OWNER" content="l00587852">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00587852">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001142686298">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring EVPN L3VPNv6 over OSPFv3 SRv6 BE</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001142686298"></a><a name="EN-US_TASK_0000001142686298"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring EVPN L3VPNv6 over OSPFv3 SRv6 BE</h1>
<div class="taskbody"><p>This section provides an example for configuring SRv6 BE to carry EVPN L3VPNv6 services.</p>
<div class="context"><a name="EN-US_TASK_0000001142686298__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0000001142686298__fig_dc_vrp_evpn_cfg_015101">Figure 1</a>, PE1, the P, and PE2 are in the same AS and need to run OSPFv3 to implement IPv6 network connectivity. In addition, a bidirectional SRv6 BE path needs to be deployed between PE1 and PE2 to carry EVPN L3VPNv6 services.</p>
<div class="fignone" id="EN-US_TASK_0000001142686298__fig_dc_vrp_evpn_cfg_015101"><a name="EN-US_TASK_0000001142686298__fig_dc_vrp_evpn_cfg_015101"></a><a name="fig_dc_vrp_evpn_cfg_015101"></a><span class="figcap"><b>Figure 1 </b>EVPN L3VPNv6 over SRv6 BE networking</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 and 2 in this example represent GE <span>0/1/0</span> and GE <span>0/2/0</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0000001142846130.png"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001142686298__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Enable IPv6 forwarding and configure an IPv6 address for each interface on PE1, the P, and PE2.</p>
</li><li><p>Enable OSPFv3 on PE1, the P, and PE2.</p>
</li><li><p>Configure an EVPN L3VPN instance on each PE and bind the EVPN L3VPN instance to an access-side interface.</p>
</li><li>Establish a BGP EVPN peer relationship between the PEs.</li><li><p>Configure SRv6 BE on the PEs and enable OSPFv3 SRv6.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001142686298__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>L3VPN instance name: vpn1</p>
</li><li><p>RD and RT values of the L3VPN instance: 100:1 and 1:1</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001142686298__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Enable IPv6 forwarding and configure an IPv6 address for each interface. The following example uses the configuration of PE1. The configurations of other devices are similar to the configuration of PE1. For configuration details, see <a href="#EN-US_TASK_0000001142686298__section_dc_vrp_evpn_cfg_015105">Configuration Files</a> in this section.</span><p><pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname PE1</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface gigabitethernet <span>0/1/0</span></strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>ipv6 enable</strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>ipv6 address 2001:DB8:10::1 64</strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>interface LoopBack 1</strong>
[<span class="keyword">*</span>PE1-LoopBack1] <strong>ipv6 enable</strong>
[<span class="keyword">*</span>PE1-LoopBack1] <strong>ipv6 address 2001:DB8:1::1 128</strong>
[<span class="keyword">*</span>PE1-LoopBack1] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</p></li><li><span>Configure OSPFv3.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> ospfv3</strong><strong> 1</strong>
[<span class="keyword">*</span>PE1-ospfv3-1] <strong>router-id 1.1.1.1</strong>
[<span class="keyword">*</span>PE1-ospfv3-1] <strong>area 0 </strong>
[<span class="keyword">*</span>PE1-ospfv3-1-area-0.0.0.0] <strong>quit</strong>
[<span class="keyword">*</span>PE1-ospfv3-1] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet <span>0/1/0</span></strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>ospfv3 1 area 0.0.0.0</strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>interface loopback1</strong>
[<span class="keyword">*</span>PE1-LoopBack1] <strong>ospfv3 1 area 0.0.0.0</strong>
[<span class="keyword">*</span>PE1-LoopBack1] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure the P.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P]<strong> ospfv3</strong><strong> 1</strong>
[<span class="keyword">*</span>P-ospfv3-1] <strong>router-id 2.2.2.2</strong>
[<span class="keyword">*</span>P-ospfv3-1] <strong>area 0 </strong>
[<span class="keyword">*</span>P-ospfv3-1-area-0.0.0.0] <strong>quit</strong>
[<span class="keyword">*</span>P-ospfv3-1] <strong>quit</strong>
[<span class="keyword">*</span>P] <strong>interface gigabitethernet <span>0/1/0</span></strong>
[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/0</span>] <strong>ospfv3 1 area 0.0.0.0</strong>
[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong>
[<span class="keyword">*</span>P] <strong>interface gigabitethernet <span>0/2/0</span></strong>
[<span class="keyword">*</span>P-GigabitEthernet<span>0/2/0</span>] <strong>ospfv3 1 area 0.0.0.0</strong>
[<span class="keyword">*</span>P-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong>
[<span class="keyword">*</span>P] <strong>interface loopback1</strong>
[<span class="keyword">*</span>P-LoopBack1] <strong>ospfv3 1 area 0.0.0.0</strong>
[<span class="keyword">*</span>P-LoopBack1] <strong>quit</strong>
[<span class="keyword">*</span>P] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2]<strong> ospfv3</strong><strong> 1</strong>
[<span class="keyword">*</span>PE2-ospfv3-1] <strong>router-id 3.3.3.3</strong>
[<span class="keyword">*</span>PE2-ospfv3-1] <strong>area 0 </strong>
[<span class="keyword">*</span>PE2-ospfv3-1-area-0.0.0.0] <strong>quit</strong>
[<span class="keyword">*</span>PE2-ospfv3-1] <strong>quit</strong>
[<span class="keyword">*</span>PE2] <strong>interface gigabitethernet <span>0/1/0</span></strong>
[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>ospfv3 1 area 0.0.0.0</strong>
[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong>
[<span class="keyword">*</span>PE2] <strong>interface loopback1</strong>
[<span class="keyword">*</span>PE2-LoopBack1] <strong>ospfv3 1 area 0.0.0.0</strong>
[<span class="keyword">*</span>PE2-LoopBack1] <strong>quit</strong>
[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</p><p><p>After the configuration is complete, perform the following operations to check whether OSPFv3 is successfully configured:</p>
<p># Display OSPFv3 neighbor information. The following example uses the command output on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display ospfv3 peer</strong>

OSPFv3 Process (1)   
Total number of peer(s): 1 
 Peer(s) in full state: 1 
OSPFv3 Area (0.0.0.0)                   
Neighbor ID      Pri State            Dead Time  Interface          Instance ID       
2.2.2.2            1 Full/Backup      00:00:37   GE<span>0/1/0</span>               0 </pre>
</p></li><li><span>Configure an EVPN L3VPN instance on each PE and bind the EVPN L3VPN instance to an access-side interface.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>ip vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpn1] <strong>ipv6-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpn1-af-ipv6] <strong>route-distinguisher 100:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpn1-af-ipv6] <strong>vpn-target 1:1 evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpn1-af-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpn1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet<span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>ip binding vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>ipv6 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>ipv6 address 2001:DB8:11::1 64</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>ipv6-family vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-6-vpn1] <strong>import-route direct</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-6-vpn1] <strong>advertise l2vpn evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-6-vpn1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>ip vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-vpn1] <strong>ipv6-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-vpn1-af-ipv6] <strong>route-distinguisher 200:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-vpn1-af-ipv6] <strong>vpn-target 1:1 evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-vpn1-af-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-vpn1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface gigabitethernet<span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>] <strong>ip binding vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>] <strong>ipv6 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>] <strong>ipv6 address 2001:DB8:22::1 64</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>ipv6-family vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-6-vpn1] <strong>import-route direct</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-6-vpn1] <strong>advertise l2vpn evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-6-vpn1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</p></li><li><span>Establish an EBGP peer relationship between each PE and its connected CE.</span><p><p># Configure CE1.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>CE1] <strong>interface LoopBack1</strong>
[*CE1-LoopBack1] <strong>ipv6 enable</strong>
[*CE1-LoopBack1] <strong>ipv6 address 2001:DB8:111::111 128</strong>
[*CE1-LoopBack1] <strong>quit</strong>               
[*CE1] <strong>bgp 65410</strong>   
[*CE1-bgp]<strong> router-id 11.11.11.11</strong>    
[*CE1-bgp] <strong>peer 2001:DB8:11::1 as-number 100</strong>
[*CE1-bgp] <strong>ipv6-family unicast</strong>
[*CE1-bgp-af-ipv6] <strong>import-route direct</strong>
[*CE1-bgp-af-ipv6] <strong>peer 2001:DB8:11::1 enable</strong>
[*CE1-bgp-af-ipv6] <strong>commit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>CE1-bgp-af-ipv6] <strong>quit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>CE1-bgp] <strong>quit</strong></pre>
<p># Configure PE1.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE1] <strong>bgp 100</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>PE1-bgp] <strong>router-id 1.1.1.1</strong>
[*PE1-bgp] <strong>ipv6-family vpn-instance vpn1</strong>
[*PE1-bgp-6-vpn1] <strong>peer 2001:DB8:11::2 as-number 65410</strong>
[*PE1-bgp-6-vpn1] <strong>import-route direct</strong>
[*PE1-bgp-6-vpn1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp-6-vpn1] <strong>quit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>PE1-bgp] <strong>quit</strong></pre>
<p># Configure CE2.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>CE2] <strong>interface LoopBack1</strong>
[*CE2-LoopBack1] <strong>ipv6 enable</strong>
[*CE2-LoopBack1] <strong>ipv6 address 2001:DB8:222::222 128</strong>
[*CE2-LoopBack1] <strong>quit</strong>               
[*CE2] <strong>bgp 65420</strong>   
[*CE2-bgp]<strong> router-id 22.22.22.22</strong>    
[*CE2-bgp] <strong>peer 2001:DB8:22::1 as-number 100</strong>
[*CE2-bgp] <strong>ipv6-family unicast</strong>
[*CE2-bgp-af-ipv6] <strong>import-route direct</strong>
[*CE2-bgp-af-ipv6] <strong>peer 2001:DB8:22::1 enable</strong>
[*CE2-bgp-af-ipv6] <strong>commit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>CE2-bgp-af-ipv6] <strong>quit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>CE2-bgp] <strong>quit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE2] <strong>bgp 100</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>PE2-bgp] <strong>router-id 3.3.3.3</strong>
[*PE2-bgp] <strong>ipv6-family vpn-instance vpn1</strong>
[*PE2-bgp-6-vpn1] <strong>peer 2001:DB8:22::2 as-number 65420</strong>
[*PE2-bgp-6-vpn1] <strong>import-route direct</strong>
[*PE2-bgp-6-vpn1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-bgp-6-vpn1] <strong>quit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>PE2-bgp] <strong>quit</strong></pre>
<p>After the configuration is complete, run the <strong>display bgp vpnv6 vpn-instance peer</strong> command on each PE to check whether a BGP peer relationship has been established between the PE and its connected CE. If the <strong>Established</strong> state is displayed in the command output, the BGP peer relationship has been established successfully.</p>
<p>The following example uses the peer relationship between PE1 and CE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display bgp vpnv6 vpn-instance vpn1 peer</strong>

 BGP local router ID : 1.1.1.1          
 Local AS number : 100                  
 Total number of peers : 1                 Peers in established state : 1             

  VPN-Instance vpn1, Router ID 1.1.1.1:
  Peer                             V          AS  MsgRcvd  MsgSent  OutQ  Up/Down       State  PrefRcv                              
  2001:DB8:11::2                   4       65410      868      873     0 12:34:11 <strong>Established</strong>        2 </pre>
</p></li><li><span>Establish a BGP EVPN peer relationship between the PEs.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 2001:DB8:3::3 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 2001:DB8:3::3 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>l2vpn-family evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-evpn] <strong>peer 2001:DB8:3::3 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>peer 2001:DB8:1::1 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>peer 2001:DB8:1::1 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>l2vpn-family evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-evpn] <strong>peer 2001:DB8:1::1 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p>After the configuration is complete, run the <strong>display bgp evpn peer</strong> command on the PEs to check whether a BGP EVPN peer relationship has been established between the PEs. If the <strong>Established</strong> state is displayed in the command output, the BGP EVPN peer relationship has been established successfully.</p>
<p>The following example uses the peer relationship between PE1 and CE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display bgp evpn peer</strong>

 BGP local router ID : 1.1.1.1          
 Local AS number : 100                  
 Total number of peers : 1                 Peers in established state : 1             

  Peer                             V          AS  MsgRcvd  MsgSent  OutQ  Up/Down       State  PrefRcv                              
  2001:DB8:3::3                    4         100      921      921     0 13:16:00 <strong>Established</strong>        4 </pre>
</p></li><li><span>Configure SRv6 BE on the PEs.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>segment-routing ipv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing-ipv6] <strong>encapsulation source-address 2001:DB8:1::1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing-ipv6] <strong>locator PE1 ipv6-prefix 2001:DB8:100:: 64 static 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing-ipv6-locator] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>ospfv3 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospfv3-1] <strong>segment-routing ipv6 locator PE1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospfv3-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>l2vpn-family evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-evpn] <strong>peer 2001:DB8:3::3 advertise encap-type srv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>ipv6-family vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-6-vpn1] <strong>segment-routing ipv6 locator PE1 evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-6-vpn1] <strong>segment-routing ipv6 best-effort evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-6-vpn1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>segment-routing ipv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-segment-routing-ipv6] <strong>encapsulation source-address 2001:DB8:3::3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-segment-routing-ipv6] <strong>locator PE2 ipv6-prefix 2001:DB8:130:: 64 static 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-segment-routing-ipv6-locator] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-segment-routing-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>ospfv3 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospfv3-1] <strong>segment-routing ipv6 locator PE2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospfv3-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>l2vpn-family evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-evpn] <strong>peer 2001:DB8:1::1 advertise encap-type srv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>ipv6-family vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-6-vpn1] <strong>segment-routing ipv6 locator PE2 evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-6-vpn1] <strong>segment-routing ipv6 best-effort evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-6-vpn1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p>Run the <strong>display bgp evpn all routing-table prefix-route</strong> command on each PE. The command output shows IP prefix route information sent from the peer end. The following example uses the command output on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display bgp evpn all routing-table prefix-route</strong>
 Local AS number : 100                  

 BGP Local router ID is 1.1.1.1         
 Status codes: * - valid, &gt; - best, d - damped, x - best external, a - add path,      
               h - history,  i - internal, s - suppressed, S - Stale                  
               Origin : i - IGP, e - EGP, ? - incomplete                              


 EVPN address family:                   
 Number of Ip Prefix Routes: 5          
 Route Distinguisher: 100:1             
       Network(EthTagId/IpPrefix/IpPrefixLen)                 NextHop               
 *&gt;    0:[2001:DB8:11::]:64                                   ::                      
 *                                                            2001:DB8:11::2         
 *&gt;    0:[2001:DB8:111::111]:128                              2001:DB8:11::2    
 Route Distinguisher: 200:1           
       Network(EthTagId/IpPrefix/IpPrefixLen)                 NextHop               
 *&gt;i   0:[2001:DB8:22::]:64                                   2001:DB8:3::3   
 *&gt;i   0:[2001:DB8:222::222]:128                              2001:DB8:3::3  </pre>
<p>Run the <strong>display ipv6 routing-table vpn-instance vpn1</strong> command on each PE. The command output shows VPN route information sent from the peer end. The following example uses the command output on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display ipv6 routing-table vpn-instance vpn1</strong>
Routing Table : vpn1                    
         Destinations : 6        Routes : 6                                           

Destination  : 2001:DB8:111::111                       PrefixLength : 128             
NextHop      : 2001:DB8:11::2                          Preference   : 255             
Cost         : 0                                       Protocol     : EBGP            
RelayNextHop : 2001:DB8:11::2                          TunnelID     : 0x0             
Interface    : GigabitEthernet<span>0/2/0</span>                    Flags        : RD              

Destination  : 2001:DB8:222::222                       PrefixLength : 128             
NextHop      : 2001:DB8:130::1:0:3C                    Preference   : 255             
Cost         : 0                                       Protocol     : IBGP            
RelayNextHop : 2001:DB8:130::1:0:3C                    TunnelID     : 0x0             
Interface    : GigabitEthernet<span>0/1/0</span>                    Flags        : RD              

Destination  : 2001:DB8:11::                           PrefixLength : 64              
NextHop      : 2001:DB8:11::1                          Preference   : 0               
Cost         : 0                                       Protocol     : Direct          
RelayNextHop : ::                                      TunnelID     : 0x0             
Interface    : GigabitEthernet<span>0/2/0</span>                    Flags        : D               

Destination  : 2001:DB8:11::1                          PrefixLength : 128             
NextHop      : ::1                                     Preference   : 0 
Cost         : 0                                       Protocol     : Direct          
RelayNextHop : ::                                      TunnelID     : 0x0             
Interface    : GigabitEthernet<span>0/2/0</span>                    Flags        : D               

Destination  : 2001:DB8:22::                           PrefixLength : 64              
NextHop      : 2001:DB8:130::1:0:3C                    Preference   : 255             
Cost         : 0                                       Protocol     : IBGP            
RelayNextHop : 2001:DB8:130::1:0:3C                    TunnelID     : 0x0             
Interface    : GigabitEthernet<span>0/1/0</span>                    Flags        : RD 

Destination  : FE80::                                  PrefixLength : 10              
NextHop      : ::                                      Preference   : 0               
Cost         : 0                                       Protocol     : Direct          
RelayNextHop : ::                                      TunnelID     : 0x0             
Interface    : NULL0                                   Flags        : DB  </pre>
<p>Run the <a href="cmdqueryname=display+segment-routing+ipv6+local-sid"><b><span class="cmdname">display segment-routing ipv6 local-sid</span></b></a> <strong><span>end-dt6</span></strong> <strong><span>forwarding</span></strong> command to check information about the SRv6 local SID table. The following example uses the command output on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display segment-routing ipv6 local-sid end-dt6 forwarding</strong>

                    My Local-SID End.DT6 Forwarding Table
                    -------------------------------------                             

SID        : 2001:DB8:100::1:0:3C/128                     FuncType    : End.DT6          
VPN Name   : vpn1                                         VPN ID      : 3                
LocatorName: PE1                                          LocatorID   : 1
Flavor     : NO-FLAVOR                                    SidCompress : NO
UpdateTime : 2023-05-10 01:46:05.713

Total SID(s): 1 </pre>
<p>Check that CEs belonging to the same VPN instance can ping each other. For example:</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>ping ipv6 -a 2001:DB8:111::111 2001:DB8:222::222</strong>
  PING 2001:DB8:222::222 : 56  data bytes, press CTRL_C to break                                 
    Reply from 2001:DB8:222::222                   
    bytes=56 Sequence=1 hop limit=62 time=3 ms                                        
    Reply from 2001:DB8:222::222                   
    bytes=56 Sequence=2 hop limit=62 time=2 ms                                        
    Reply from 2001:DB8:222::222                   
    bytes=56 Sequence=3 hop limit=62 time=2 ms                                        
    Reply from 2001:DB8:222::222                   
    bytes=56 Sequence=4 hop limit=62 time=3 ms                                        
    Reply from 2001:DB8:222::222                   
    bytes=56 Sequence=5 hop limit=62 time=3 ms                                        

  --- 2001:DB8:222::222 ping statistics---         
    5 packet(s) transmitted             
    5 packet(s) received                
    0.00% packet loss                   
    round-trip min/avg/max=2/2/3 ms  </pre>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0000001142686298__section_dc_vrp_evpn_cfg_015105"><a name="EN-US_TASK_0000001142686298__section_dc_vrp_evpn_cfg_015105"></a><a name="section_dc_vrp_evpn_cfg_015105"></a><a name="EN-US_TASK_0000001142686298__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>PE1 configuration file</p>
<pre class="screen">#
sysname PE1
#
ip vpn-instance vpn1
 ipv6-family
  route-distinguisher 100:1
<span>  apply-label per-instance</span>
  vpn-target 1:1 export-extcommunity evpn
  vpn-target 1:1 import-extcommunity evpn
#
segment-routing ipv6
 encapsulation source-address 2001:DB8:1::1
 locator PE1 ipv6-prefix 2001:DB8:100:: 64 static 32
#
ospfv3 1
 router-id 1.1.1.1
 segment-routing ipv6 locator PE1
 area 0.0.0.0
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ipv6 enable
 ipv6 address 2001:DB8:10::1/64
 ospfv3 1 area 0.0.0.0
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip binding vpn-instance vpn1
 ipv6 enable
 ipv6 address 2001:DB8:11::1/64
#
interface LoopBack1
 ipv6 enable
 ipv6 address 2001:DB8:1::1/128
 ospfv3 1 area 0.0.0.0
#
bgp 100
 router-id 1.1.1.1
 peer 2001:DB8:3::3 as-number 100
 peer 2001:DB8:3::3 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
 #
 ipv6-family vpn-instance vpn1
  import-route direct
  advertise l2vpn evpn
  segment-routing ipv6 locator PE1 evpn
  segment-routing ipv6 best-effort evpn
  peer 2001:DB8:11::2 as-number 65410
 #
 l2vpn-family evpn
  policy vpn-target
  peer 2001:DB8:3::3 enable
  peer 2001:DB8:3::3 advertise encap-type srv6
#
return</pre>
</li><li><p>P configuration file</p>
<pre class="screen">#
sysname P
#
ospfv3 1
 router-id 2.2.2.2
 area 0.0.0.0
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ipv6 enable
 ipv6 address 2001:DB8:10::2/64
 ospfv3 1 area 0.0.0.0
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ipv6 enable
 ipv6 address 2001:DB8:20::1/64
 ospfv3 1 area 0.0.0.0
#
interface LoopBack1
 ipv6 enable
 ipv6 address 2001:DB8:2::2/128
 ospfv3 1 area 0.0.0.0
#
return</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#
sysname PE2
#
ip vpn-instance vpn1
 ipv6-family
  route-distinguisher 200:1
<span>  apply-label per-instance</span>
  vpn-target 1:1 export-extcommunity evpn
  vpn-target 1:1 import-extcommunity evpn
#
segment-routing ipv6
 encapsulation source-address 2001:DB8:3::3
 locator PE2 ipv6-prefix 2001:DB8:130:: 64 static 32
#
ospfv3 1
 router-id 3.3.3.3
 segment-routing ipv6 locator PE2
 area 0.0.0.0
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown  
 ipv6 enable
 ipv6 address 2001:DB8:20::2/64
 ospfv3 1 area 0.0.0.0
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip binding vpn-instance vpn1
 ipv6 enable
 ipv6 address 2001:DB8:22::1/64
#
interface LoopBack1
 ipv6 enable
 ipv6 address 2001:DB8:3::3/128
 ospfv3 1 area 0.0.0.0
#
bgp 100
 router-id 3.3.3.3
 peer 2001:DB8:1::1 as-number 100
 peer 2001:DB8:1::1 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
 #
 ipv6-family vpn-instance vpn1
  import-route direct
  advertise l2vpn evpn
  segment-routing ipv6 locator PE2 evpn
  segment-routing ipv6 best-effort evpn
  peer 2001:DB8:22::2 as-number 65420
 #
 l2vpn-family evpn
  policy vpn-target
  peer 2001:DB8:1::1 enable
  peer 2001:DB8:1::1 advertise encap-type srv6
#
return</pre>
</li><li><p>CE1 configuration file</p>
<pre class="screen">#
sysname CE1
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown  
 ipv6 enable    
 ipv6 address 2001:DB8:11::2/64
#               
interface LoopBack1
 ipv6 enable    
 ipv6 address 2001:DB8:111::111/128
#               
bgp 65410       
 router-id 11.11.11.11
 peer 2001:DB8:11::1 as-number 100
 #              
 ipv4-family unicast
  undo synchronization
 #              
 ipv6-family unicast
  undo synchronization
  import-route direct
  peer 2001:DB8:11::1 enable
#               
return </pre>
</li><li><p>CE2 configuration file</p>
<pre class="screen">#
sysname CE2
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ipv6 enable    
 ipv6 address 2001:DB8:22::2/64
#
interface LoopBack1
 ipv6 enable    
 ipv6 address 2001:DB8:222::222/128
#
bgp 65420       
 router-id 22.22.22.22
 peer 2001:DB8:22::1 as-number 100
 #              
 ipv4-family unicast
  undo synchronization
 #              
 ipv6-family unicast
  undo synchronization
  import-route direct
  peer 2001:DB8:22::1 enable
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_srv6_cfg_all_1008.html">Configuration Examples for SRv6 BE (OSPFv3)
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_srv6_cfg_all_1010.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_srv6_cfg_all_1012.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>