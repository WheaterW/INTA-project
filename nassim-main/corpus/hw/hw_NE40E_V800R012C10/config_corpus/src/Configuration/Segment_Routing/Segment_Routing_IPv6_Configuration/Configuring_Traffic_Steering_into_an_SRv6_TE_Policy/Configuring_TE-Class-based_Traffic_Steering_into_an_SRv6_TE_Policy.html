
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring TE-Class-based Traffic Steering into an SRv6 TE Policy">
<meta name="abstract" content="You can configure TE-Class-based traffic steering to recurse a route to an SRv6 TE Policy based on TE-Class IDs, so that traffic can be forwarded through a path in the SRv6 TE Policy.">
<meta name="description" content="You can configure TE-Class-based traffic steering to recurse a route to an SRv6 TE Policy based on TE-Class IDs, so that traffic can be forwarded through a path in the SRv6 TE Policy.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_srv6_cfg_all_0290.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_srv6_cfg_all_0293.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_srv6_cfg_all_0114.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featurename" content="EVPN">
<meta name="featurename" content="Segment Routing IPv6">
<meta name="featurename" content="Segment Routing IPv6 Policy">
<meta name="featurename" content="Segment Routing Policy">
<meta name="featuretype" content="Segment Routing">
<meta name="featuretype" content="VPN">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featurename" content="EVPN">
<meta name="featurename" content="Segment Routing IPv6">
<meta name="featurename" content="Segment Routing IPv6 Policy">
<meta name="featurename" content="Segment Routing Policy">
<meta name="featuretype" content="Segment Routing">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featurename" content="EVPN">
<meta name="featurename" content="Segment Routing IPv6">
<meta name="featurename" content="Segment Routing IPv6 Policy">
<meta name="featurename" content="Segment Routing Policy">
<meta name="featuretype" content="Segment Routing">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="Segment Routing IPv6">
<meta name="featuretype" content="Segment Routing">
<meta name="OWNER" content="l00587852">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00587852">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001172810210">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring TE-Class-based Traffic Steering into an SRv6 TE Policy</title>
</head>
<body><a name="EN-US_TASK_0000001172810210"></a><a name="EN-US_TASK_0000001172810210"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring TE-Class-based Traffic Steering into an SRv6 TE Policy</h1>
<div class="taskbody"><p>You can configure TE-Class-based traffic steering to recurse a route to an SRv6 TE Policy based on TE-Class IDs, so that traffic can be forwarded through a path in the SRv6 TE Policy.</p>
<div class="prereq" style="margin-left:0"><a name="EN-US_TASK_0000001172810210__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Prerequisites</h4>
<div class="p"><p>Before configuring TE-Class-based traffic steering into an SRv6 TE Policy, complete the following tasks:</p>
<ul><li>Configure a traffic classifier.</li><li>Configure an SRv6 TE Policy.</li></ul>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001172810210__1.4.2"></a><a name="1.4.2"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>After an SRv6 TE Policy is configured, traffic needs to be steered into it for forwarding. This process is called traffic steering. Currently, SRv6 TE Policies can be used for various services, such as BGP L3VPN and EVPN services. This section describes how to configure services to recurse to an SRv6 TE Policy through a specified tunnel policy.</p>
<p>Smart policy routing (SPR) is a route selection mechanism that proactively detects link quality and selects the optimal link to forward service data according to service quality requirements, implementing intelligent traffic steering.</p>
<p>TE-Class IDs can be used to identify flows, helping differentiate the flows and steer them into different SRv6 TE Policies, SPR paths, or native IP links.</p>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001172810210__1.4.3"></a><a name="1.4.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure TE-Class IDs for traffic.</span><ol type="a"><li class="substepexpand"><span>Configure a traffic classifier. For details, see <a href="../ne/dc_ne_qos_cfg_0037.html">Class-based QoS Configuration</a>.</span></li><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=traffic+behavior"><b><span class="cmdname">traffic behavior</span></b></a> <i><span class="varname">behavior-name</span></i></span><p><p>A traffic behavior is created, and the traffic behavior view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=remark+te-class"><b><span class="cmdname">remark te-class</span></b></a><strong> </strong><em>classid</em></span><p><p>A TE-Class ID is configured.</p>
</p><p><p>In SPR traffic steering, multi-field (MF) classification needs to be performed to set different TE-class IDs for different flows based on 5-tuple information. Then, the device queries the FIB based on the destination address of this flow to obtain a mapping policy, in which the path matching the specified TE-Class ID is used for forwarding.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Return to the system view.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=traffic+policy"><b><span class="cmdname">traffic policy</span></b></a> <i><span class="varname">policy-name</span></i></span><p><p>A traffic policy is configured, and the traffic policy view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=classifier"><b><span class="cmdname">classifier</span></b></a> <i><span class="varname">classifier-name</span></i> <strong><span>behavior</span></strong> <i><span class="varname">behavior-name</span></i> [ <strong><span>precedence</span></strong> <i><span class="varname">precedence-value</span></i> ]</span><p><p>A traffic behavior is specified for the traffic classifier in the traffic policy, and a policy-based matching priority is set.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=statistics+enable"><b><span class="cmdname">statistics enable</span></b></a></span><p><p>The statistics collection function is enabled for the traffic policy.</p>
</p><p><p>To conserve memory resources, the statistics collection function of traffic policies is disabled by default. To check traffic policy statistics, run the <a href="cmdqueryname=statistics+enable"><b><span class="cmdname">statistics enable</span></b></a> command to enable the statistics collection function for the traffic policy.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=share-mode"><b><span class="cmdname">share-mode</span></b></a></span><p><p>The traffic policy is enabled to be shared.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Return to the system view.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=interface"><b><span class="cmdname">interface</span></b></a> <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i></span><p><p>The interface view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=traffic-policy"><b><span class="cmdname">traffic-policy</span></b></a> <i><span class="varname">policy-name</span></i> { <strong><span>inbound</span></strong> | <strong><span>outbound</span></strong> }</span><p><p>The traffic policy is applied to a Layer 3 interface.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Return to the system view.</p>
</p></li></ol>
</li><li><span>Configure SPR.</span><ol type="a"><li class="substepexpand"><span>Run <a href="cmdqueryname=segment-routing+ipv6"><b><span class="cmdname">segment-routing ipv6</span></b></a></span><p><p>The SRv6 view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=smart-policy-route"><b><span class="cmdname">smart-policy-route</span></b></a></span><p><p>SPR is configured, and the SRv6 smart policy route view is displayed.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <strong>refresh-period </strong><em>time-value</em></span><p><p>An update period is configured for SPR route selection.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <strong>measure count </strong>{ <strong>one-way</strong> | <strong>two-way-average</strong> }</span><p><p>An SPR switching mode is configured.</p>
</p><p><p>In one-way switching, the forward tunnel's data is used for calculation. In two-way switching, the forward and reverse tunnels' data is used for calculation.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=spr-policy"><b><span class="cmdname">spr-policy </span></b></a><em>name-value</em></span><p><p>An SPR policy template is created, and the SRv6 SPR policy view is displayed.</p>
</p><p><p>According to service flow characteristics, traffic is classified and internal priorities (TE-Class) are set, with different internal priorities being mapped to different SPR policies. Intelligent traffic steering is implemented for service flows based on policy configurations.</p>
</p></li><li class="substepexpand"><span>(Optional) Configure SPR policy parameters.</span><p><ul><li>Run the <strong>switch-period </strong><em>time-value</em> command to configure an SPR switching period.<p>SPR determines whether to perform a link switchover based on the SLA detection result, which it obtains periodically. If the optimal link computed based on the obtained SLA detection result is different from the currently used link, the switching period timer starts. The timer is reset if the two links are the same before the expiration of the switching period and restarts when the next link inconsistency occurs. If link inconsistency persists during the switching period, SPR performs a link switchover.</p>
<p>Configure a switching period based on service characteristics. For example, configure a short switching period for voice services because they have high requirements on real-time performance.</p>
</li><li>Run the <strong>wait-to-restore-period </strong><em>time-value</em> command to configure an SPR switchback wait-to-restore (WTR) period.<p>If traffic is switched from an abnormal high-priority link to a low-priority link, SPR immediately switches traffic back to the high-priority link when this link recovers. This causes traffic loss if key services are being transmitted over the low-priority link. After an SPR switchback WTR period is configured, the device does not switch traffic back to the high-priority link when detecting that the link recovers. This ensures the reliable transmission of key services over the low-priority link during this period.</p>
<p>After an SPR switchback WTR period is configured, the device starts the timer when the high-priority link recovers following a traffic switchover to the low-priority link through SPR. If the high-priority link remains normal within the configured switchback period, SPR switches traffic from the low-priority link back to the high-priority link after the switchback period expires. If the device detects that the high-priority link does not meet traffic forwarding requirements within the configured switchback WTR period, it restarts the timer when detecting that the high-priority link recovers next time.</p>
</li><li>Run the <strong>cmi threshold </strong><em>value</em> command to configure a composite measure indicator (CMI) threshold for services in SPR.<p>The CMI is calculated using the formula D (Delay) + J (Jitter) + L (Loss). A smaller CMI value indicates better link quality.</p>
<p>Many services have requirements for link indicators including the delay, jitter, and packet loss rate. As such, you need to configure a CMI threshold based on service characteristics. If the value calculated using the preceding formula is greater than the configured CMI threshold, the link CMI does not meet service requirements.</p>
</li><li>Run the <strong>delay threshold </strong><em>time-value</em> command to configure a delay threshold for services in SPR.<p>The service delay threshold is the maximum delay allowed by services. It needs to be specified for services that have link delay requirements. If the delay of a link exceeds the threshold, the link does not meet the delay requirements of services.</p>
</li><li>Run the <strong>jitter threshold </strong><em>time-value</em> command to configure a jitter threshold for services in SPR.<p>The service jitter threshold is the maximum jitter allowed by services. It needs to be specified for services that have link jitter requirements. If the jitter of a link exceeds the threshold, the link does not meet the jitter requirements of services.</p>
</li><li>Run the <strong>loss threshold </strong><em>value</em> command to configure a threshold for the packet loss rate of services in SPR.<p>The packet loss rate threshold is the maximum packet loss rate allowed by services. It needs to be specified for services that have requirements for the packet loss rate. If the packet loss rate of a link exceeds the threshold, the link does not meet the packet loss rate requirements of services.</p>
</li></ul>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=srv6-te-policy+color+priority"><b><span class="cmdname">srv6-te-policy color</span></b></a><strong> </strong><em>color-value</em><strong> priority </strong><em>priority-value</em></span><p><p>An SRv6 TE Policy is configured for SPR.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Return to the SRv6 view.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Return to the system view.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li><span>Configure TE-Class-based traffic steering into an SRv6 TE Policy.</span><ol type="a"><li class="substepexpand"><span>Run <a href="cmdqueryname=segment-routing+ipv6"><b><span class="cmdname">segment-routing ipv6</span></b></a></span><p><p>The SRv6 view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=mapping-policy"><b><span class="cmdname">mapping-policy</span></b></a><strong> </strong><em>name-value</em> <strong><span>color</span></strong><strong> </strong><em>color-value</em></span><p><p>An SRv6 mapping policy is created, and the SRv6 mapping policy view is displayed.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=description"><b><span class="cmdname">description </span></b></a><em>description-value</em></span><p><p>A description is configured for the SRv6 mapping policy.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=match-type+te-class"><b><span class="cmdname">match-type te-class</span></b></a></span><p><p>The mapping type of the SRv6 mapping policy is set to TE-Class.</p>
</p></li><li class="substepexpand"><span>Configure a rule for the mapping between SPR policies, SRv6 TE Policies, or native IP links in an SRv6 TE flow group and TE-Class values.</span><p><ul><li>Configure a rule for the mapping between SPR policies in an SRv6 TE flow group and TE-Class values.<p><a href="cmdqueryname=index+te-class+match"><b><span class="cmdname">index</span></b></a><strong> </strong><em>index-value</em> <strong>te-class</strong> <em>te-class-id</em> <strong>match</strong> <strong>spr-policy</strong> <em>spr-name</em></p>
<p><strong><a href="cmdqueryname=default+match+spr-policy"><b><span class="cmdname">default match spr-policy</span></b></a> </strong><em>spr-name</em></p>
</li></ul>
<ul><li>Configure a rule for the mapping between SRv6 TE Policies in an SRv6 TE flow group and TE-Class values.<p><strong><a href="cmdqueryname=index+te-class+match"><b><span class="cmdname">index</span></b></a> </strong><em>index-value</em> <strong>te-class</strong> <em>te-class-id</em> <strong>match</strong> <strong>srv6-te-policy</strong> <strong>color</strong> <em>color-value</em></p>
<p><a href="cmdqueryname=default+match+srv6-te-policy+color"><b><span class="cmdname">default match srv6-te-policy color</span></b></a> <em>color-value</em></p>
</li></ul>
<ul><li>Configure a rule for the mapping between native IP links in an SRv6 TE flow group and TE-Class values.<p><strong><a href="cmdqueryname=index+te-class+match"><b><span class="cmdname">index</span></b></a> </strong><em>index-value</em> <strong>te-class</strong> <em>te-class-id</em> <strong>match</strong> <strong>native-ip</strong></p>
<p><a href="cmdqueryname=default+match+native-ip"><b><span class="cmdname">default match native-ip</span></b></a></p>
</li></ul>
<p>Each SRv6 TE Policy in an SRv6 TE flow group has its own color attribute.</p>
<p>The <a href="cmdqueryname=index+te-class+match"><b><span class="cmdname">index te-class match</span></b></a> and <a href="cmdqueryname=default+match"><b><span class="cmdname">default match</span></b></a> commands are used together to specify the mapping between color and TE-Class values.</p>
<p>In an SRv6 TE flow group, TE-Class values and SRv6 TE Policies are associated using the color attribute. IP packets can then be steered into the specified SRv6 TE Policy based on their TE-Class values.</p>
<ul><li>The <a href="cmdqueryname=index+te-class+match+spr-policy"><b><span class="cmdname">index te-class match spr-policy</span></b></a> and <a href="cmdqueryname=default+match+spr-policy"><b><span class="cmdname">default match spr-policy</span></b></a> <i><span class="varname">spr-name</span></i> commands configure the mapping between SPR policies and TE-Class values.</li><li>The <a href="cmdqueryname=index+te-class+match+srv6-te-policy+color"><b><span class="cmdname">index te-class match srv6-te-policy color</span></b></a> and <a href="cmdqueryname=default+match+srv6-te-policy+color"><b><span class="cmdname">default match srv6-te-policy color</span></b></a> <i><span class="varname">color-value</span></i> commands configure the mapping between SRv6 TE Policies and TE-Class values.</li><li>The <a href="cmdqueryname=index+te-class+match+native-ip"><b><span class="cmdname">index te-class match native-ip</span></b></a> and <a href="cmdqueryname=default+match+native-ip"><b><span class="cmdname">default match native-ip</span></b></a> commands configure the mapping between native IP links and TE-Class values.</li></ul>
<p>During forwarding, IP packets are steered into the specified SRv6 TE Policy based on their TE-Class values. If no SRv6 TE Policy matching a specified TE-Class value is found, the packets are steered into the SRv6 TE Policy specified using the <a href="cmdqueryname=default+match"><b><span class="cmdname">default match</span></b></a> command.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Return to the SRv6 view.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Return to the system view.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=tunnel-policy"><b><span class="cmdname">tunnel-policy</span></b></a> <i><span class="varname">policy-name</span></i></span><p><p>A tunnel policy is created, and its view is displayed.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=description"><b><span class="cmdname">description</span></b></a> <i><span class="varname">description-text</span></i></span><p><p>A description is configured for the tunnel policy.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=tunnel+select-seq"><b><span class="cmdname">tunnel select-seq</span></b></a> <strong><span>ipv6</span></strong> <strong><span>srv6-te-flow-group</span></strong> <strong><span>load-balance-number</span></strong> <em>loadBalanceNumber</em></span><p><p>A tunnel selection policy is configured.</p>
</p><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Because there can be only one effective SRv6 TE Policy with the endpoint and color specified, load balancing is not involved.</p>
</div></div>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li></ol></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_srv6_cfg_all_0290.html">Configuring Traffic Steering into an SRv6 TE Policy
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_srv6_cfg_all_0293.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_srv6_cfg_all_0114.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>