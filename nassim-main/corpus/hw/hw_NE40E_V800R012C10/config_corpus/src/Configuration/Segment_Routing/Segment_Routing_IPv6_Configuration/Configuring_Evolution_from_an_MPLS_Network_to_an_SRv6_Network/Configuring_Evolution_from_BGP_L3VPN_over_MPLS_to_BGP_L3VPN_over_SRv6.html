
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring Evolution from BGP L3VPN over MPLS to BGP L3VPN over SRv6">
<meta name="abstract" content="In IPv4/IPv6 dual-stack scenarios, you can configure VPN over MPLS/VPN over SRv6 dual-stack tunnels to prevent traffic interruption caused by direct switching from an IPv4 MPLS network to an SRv6 network.">
<meta name="description" content="In IPv4/IPv6 dual-stack scenarios, you can configure VPN over MPLS/VPN over SRv6 dual-stack tunnels to prevent traffic interruption caused by direct switching from an IPv4 MPLS network to an SRv6 network.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_srv6_cfg_all_0215.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0189_a.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featurename" content="EVPN">
<meta name="featurename" content="Segment Routing IPv6">
<meta name="featurename" content="Segment Routing IPv6 Policy">
<meta name="featurename" content="Segment Routing Policy">
<meta name="featuretype" content="Segment Routing">
<meta name="featuretype" content="VPN">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featurename" content="EVPN">
<meta name="featurename" content="Segment Routing IPv6">
<meta name="featurename" content="Segment Routing IPv6 Policy">
<meta name="featurename" content="Segment Routing Policy">
<meta name="featuretype" content="Segment Routing">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featurename" content="EVPN">
<meta name="featurename" content="Segment Routing IPv6">
<meta name="featurename" content="Segment Routing IPv6 Policy">
<meta name="featurename" content="Segment Routing Policy">
<meta name="featuretype" content="Segment Routing">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="Segment Routing IPv6">
<meta name="featuretype" content="Segment Routing">
<meta name="OWNER" content="l00425560">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00415692">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001751784621">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/thickbox.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/imageResize.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery-migrate-1.2.1.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery-ui.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery.mousewheel.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/thickbox.js"></script>
<title>Configuring Evolution from BGP L3VPN over MPLS to BGP L3VPN over SRv6</title>
</head>
<body><a name="EN-US_TASK_0000001751784621"></a><a name="EN-US_TASK_0000001751784621"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring Evolution from BGP L3VPN over MPLS to BGP L3VPN over SRv6</h1>
<div class="taskbody"><p>In IPv4/IPv6 dual-stack scenarios, you can configure VPN over MPLS/VPN over SRv6 dual-stack tunnels to prevent traffic interruption caused by direct switching from an IPv4 MPLS network to an SRv6 network.</p>
<div class="context"><a name="EN-US_TASK_0000001751784621__1.4.1"></a><a name="1.4.1"></a>
<div class="p" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_context2024816478214050"><h4 class="sectiontitle">Usage Scenario</h4><p id="EN-US_TASK_0000001751784621__en-us_task_0176299498_p173005615473">As IPv4 addresses are gradually depleted, the deployment of IPv6 networks has become a trend. However, network evolution cannot be completed at once, and IPv4 and IPv6 dual-stack services will coexist for some time.</p>
<p id="EN-US_TASK_0000001751784621__en-us_task_0176299498_p20730956114712">To prevent impact on existing services, L3VPN supports MPLS/SRv6 dual-stack tunnels. If the next hop address of a route is an IPv4 address, the route can recurse to an MPLS tunnel. If the next hop address of a route is an IPv6 address, the route can recurse to an SRv6 tunnel. Routes recurse to different tunnels based on their next hop address types, significantly improving the feasibility of transition from IPv4 MPLS networks to SRv6 networks.</p>
<p id="EN-US_TASK_0000001751784621__en-us_task_0176299498_p1560113162610">On the network shown in <a href="#EN-US_TASK_0000001751784621__en-us_task_0176299498_fig9952391436">Figure 1</a>, the transition process is essentially as follows:</p>
<ol id="EN-US_TASK_0000001751784621__en-us_task_0176299498_ol162393119816"><li id="EN-US_TASK_0000001751784621__en-us_task_0176299498_li62313311288">Initially, IPv4 MPLS is configured on the public network, and only L3VPN over MPLS services exist.</li><li id="EN-US_TASK_0000001751784621__en-us_task_0176299498_li12310311989">During the transition, L3VPN over MPLS and L3VPN over SRv6 dual-stack tunnels coexist. Routes are selected based on the priorities of next hop addresses. PEs preferentially select SRv6 VPNv4 routes.</li><li id="EN-US_TASK_0000001751784621__en-us_task_0176299498_li723103114816">Finally, IPv4 MPLS is deleted from the public network, and only L3VPN over SRv6 services remain.</li></ol>
<div class="fignone" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_fig9952391436"><a name="EN-US_TASK_0000001751784621__en-us_task_0176299498_fig9952391436"></a><a name="en-us_task_0176299498_fig9952391436"></a><span class="figcap"><b>Figure 1 </b>Evolution from L3VPN over MPLS to L3VPN over SRv6</span><br><span><img class="imgResize" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_image995539437" src="figure/en-us_image_0000001751847525.png" width="523.6875" height="301.98913500000003" title="Click to enlarge"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001751784621__1.4.2"></a><a name="1.4.2"></a>
<div class="p" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_context546392778214050"><h4 class="sectiontitle">Pre-configuration Tasks</h4><p id="EN-US_TASK_0000001751784621__en-us_task_0176299498_p141152517214050">Before configuring VPN MPLS/VPN SRv6 dual-stack tunnels, complete the following tasks:</p>
<ul id="EN-US_TASK_0000001751784621__en-us_task_0176299498_ul538917145517"><li id="EN-US_TASK_0000001751784621__en-us_task_0176299498_li123891514195112"><p id="EN-US_TASK_0000001751784621__en-us_task_0176299498_p103891914145119"><a name="EN-US_TASK_0000001751784621__en-us_task_0176299498_li123891514195112"></a><a name="en-us_task_0176299498_li123891514195112"></a>Configure an IGP for the MPLS backbone network of each AS to ensure the IP connectivity of the backbone network in each AS.</p>
</li></ul>
<ul id="EN-US_TASK_0000001751784621__en-us_task_0176299498_ul1883387550214050"><li id="EN-US_TASK_0000001751784621__en-us_task_0176299498_li101711622145118"><p id="EN-US_TASK_0000001751784621__en-us_task_0176299498_p1117102212517"><a name="EN-US_TASK_0000001751784621__en-us_task_0176299498_li101711622145118"></a><a name="en-us_task_0176299498_li101711622145118"></a>Configure basic MPLS capabilities and MPLS LDP in each AS on the MPLS backbone network.</p>
</li><li id="EN-US_TASK_0000001751784621__en-us_task_0176299498_li68204268513">Establish an IBGP peer relationship between the PE and ASBR in each AS.</li><li id="EN-US_TASK_0000001751784621__en-us_task_0176299498_li226754916518"><a href="dc_vrp_mpls-l3vpn-v4_cfg_0155.html">Configure a VPN instance</a> on each PE that connects to a CE and <a href="dc_vrp_mpls-l3vpn-v4_cfg_0156.html">bind the PE interface that connects to the CE to the VPN instance</a>.</li><li id="EN-US_TASK_0000001751784621__en-us_task_0176299498_li159704212525">Configure an IP address for each CE interface that connects to a PE.</li><li id="EN-US_TASK_0000001751784621__en-us_task_0176299498_li124614145524">Configure inter-AS VPN. For example, configure <a href="dc_vrp_mpls-l3vpn-v4_cfg_0136.html">inter-AS VPN option C (solution 1)</a>.</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001751784621__1.4.3"></a><a name="1.4.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol id="EN-US_TASK_0000001751784621__en-us_task_0176299498_steps1788816364128"><li id="EN-US_TASK_0000001751784621__en-us_task_0176299498_step16888173671212"><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmd12888136161217">Configure priority-based route selection on each PE.</span><p><ol type="a" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_ol266924211218"><li id="EN-US_TASK_0000001751784621__en-us_task_0176299498_li5669134219219"><p id="EN-US_TASK_0000001751784621__en-us_task_0176299498_p14669742142114"><a name="EN-US_TASK_0000001751784621__en-us_task_0176299498_li5669134219219"></a><a name="en-us_task_0176299498_li5669134219219"></a>Run the <a href="cmdqueryname=system-view"><b><span class="cmdname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdname265664111516">system-view</span></b></a> command to enter the system view.</p>
</li><li id="EN-US_TASK_0000001751784621__en-us_task_0176299498_li1766919429213"><p id="EN-US_TASK_0000001751784621__en-us_task_0176299498_p9669142182118"><a name="EN-US_TASK_0000001751784621__en-us_task_0176299498_li1766919429213"></a><a name="en-us_task_0176299498_li1766919429213"></a>Run the <a href="cmdqueryname=bgp"><b><span class="cmdname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdname36681645185">bgp</span></b></a><strong id="EN-US_TASK_0000001751784621__en-us_task_0176299498_b12693145041716"> </strong><i><span class="varname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_varname1388710113184">as-number</span></i> command to enter the BGP view.</p>
</li><li id="EN-US_TASK_0000001751784621__en-us_task_0176299498_li1566974202118"><p id="EN-US_TASK_0000001751784621__en-us_task_0176299498_p66691242102114"><a name="EN-US_TASK_0000001751784621__en-us_task_0176299498_li1566974202118"></a><a name="en-us_task_0176299498_li1566974202118"></a>Run the <a href="cmdqueryname=ipv4-family+vpnv4"><b><span class="cmdname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdname1922831615">ipv4-family vpnv4</span></b></a> command to enter the BGP-VPNv4 address family view.</p>
</li><li id="EN-US_TASK_0000001751784621__en-us_task_0176299498_li567054217216"><p id="EN-US_TASK_0000001751784621__en-us_task_0176299498_p11670184217211"><a name="EN-US_TASK_0000001751784621__en-us_task_0176299498_li567054217216"></a><a name="en-us_task_0176299498_li567054217216"></a>Run the <a href="cmdqueryname=peer+high-priority+%28BGP-VPNv4+address+family+view%29"><b><span class="cmdname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdname12169110131914">peer</span></b></a> <i><span class="varname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_varname1842115165197">ipv4-address</span></i> <strong><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdparmname7109172331914">high-priority</span></strong> or <a href="cmdqueryname=peer+high-priority+%28BGP-VPNv4+address+family+view%29"><b><span class="cmdname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdname10718535114715">peer</span></b></a> <i><span class="varname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_varname147181735134720">peerGroupName</span></i> <strong><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdparmname57182358478">high-priority</span></strong> command to enable BGP VPNv4 routes learned from the IPv4 peer (group) to participate in route selection based on priorities. In a dual-stack scenario, if routes with the same prefix are learned from BGP VPNv4 IPv4 and IPv6 peers, you can run this command for the IPv4 peer to ensure that the routes learned from the specified peer are preferred.</p>
</li><li id="EN-US_TASK_0000001751784621__en-us_task_0176299498_li11670242192114"><p id="EN-US_TASK_0000001751784621__en-us_task_0176299498_p2067094210217"><a name="EN-US_TASK_0000001751784621__en-us_task_0176299498_li11670242192114"></a><a name="en-us_task_0176299498_li11670242192114"></a>Run the <a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdname13732815215">commit</span></b></a> command to commit the configuration.</p>
</li></ol>
</p></li><li id="EN-US_TASK_0000001751784621__en-us_task_0176299498_step955920217145"><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmd1855915210140">Configure a VPN instance with the IPv4 address family enabled on each PE.</span><ol type="a" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_substeps2077134417191"><li class="substepexpand" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_substep20770744141919"><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmd12770174461916">Run the <a href="cmdqueryname=system-view"><b><span class="cmdname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdname19145137192218">system-view</span></b></a> command to enter the system view.</span></li><li class="substepexpand" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_substep107271313222"><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmd127281315224">Run the <a href="cmdqueryname=ip+vpn-instance"><b><span class="cmdname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdname1198318378237">ip vpn-instance</span></b></a> <i><span class="varname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_varname319324419230">vpn-instance-name</span></i> command to create a VPN instance and enter its view.</span></li><li class="substepexpand" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_substep5583182882220"><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmd185831628172211">Run the <a href="cmdqueryname=ipv4-family"><b><span class="cmdname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdname633135718234">ipv4-family</span></b></a> command to configure the VPN instance IPv4 address family and enter its view.</span></li><li class="substepexpand" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_substep17899183492212"><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmd38991347225">Run the <a href="cmdqueryname=route-distinguisher"><b><span class="cmdname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdname1150717242274">route-distinguisher</span></b></a> <i><span class="varname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_varname1050183432710">route-distinguisher</span></i> command to configure an RD for the VPN instance IPv4 address family.</span></li><li class="substepexpand" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_substep27721540192216"><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmd1772134012211">Run the <a href="cmdqueryname=vpn-target"><b><span class="cmdname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdname16274194612275">vpn-target</span></b></a> <i><span class="varname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_varname151071558192717">vpn-target</span></i> &amp;&lt;1-8&gt; [ <strong><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdparmname123071229172815">both</span></strong> | <strong><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdparmname8115173420283">export-extcommunity</span></strong> | <strong><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdparmname27231739142815">import-extcommunity</span></strong> ] command to configure VPN targets for the VPN instance IPv4 address family.</span></li><li class="substepexpand" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_substep87074732219"><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmd1701747142215">Run the <a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdname558674811287">commit</span></b></a> command to commit the configuration.</span></li><li class="substepexpand" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_substep152709546223"><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmd1227013543229">Run the <a href="cmdqueryname=quit"><b><span class="cmdname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdname757011552289">quit</span></b></a> command to exit the VPN instance IPv4 address family view.</span></li><li class="substepexpand" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_substep2025325162311"><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmd7253753239">Run the <a href="cmdqueryname=quit"><b><span class="cmdname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdname10757640618">quit</span></b></a> command to exit the VPN instance view.</span></li><li class="substepexpand" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_substep17806295230"><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmd16807199152314">Run the <a href="cmdqueryname=interface"><b><span class="cmdname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdname119461810162918">interface</span></b></a> <i><span class="varname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_varname1288342462916">interface-type</span></i> <i><span class="varname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_varname0111193222915">interface-number</span></i> command to enter the view of the interface to be bound to the VPN instance.</span></li><li class="substepexpand" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_substep201143117241"><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmd1410312240">Run the <a href="cmdqueryname=ip+binding+vpn-instance"><b><span class="cmdname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdname1495094115292">ip binding vpn-instance</span></b></a> <i><span class="varname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_varname16176749162918">vpn-instance-name</span></i> command to bind the interface to the VPN instance. </span><p><div class="p" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_p0685041152713"><div class="note" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_note94163619283"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0000001751784621__en-us_task_0176299498_p10957413142812">The <a href="cmdqueryname=ip+binding+vpn-instance"><b><span class="cmdname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdname813024512515">ip binding vpn-instance</span></b></a> command deletes IPv4 and IPv6 Layer 3 features on the interface, such as the configured IP address and routing protocol. You have to reconfigure them if they are required.</p>
</div></div>
</div>
</p></li><li class="substepexpand" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_substep728535619242"><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmd428512563243">Run the <a href="cmdqueryname=ip+address"><b><span class="cmdname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdname128661913123019">ip address</span></b></a> <i><span class="varname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_varname8594112563018">ip-address </span></i>{ <i><span class="varname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_varname39242041173015">mask</span></i> | <i><span class="varname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_varname1640555213305">mask-length </span></i>} command to configure an IP address for the interface.</span><p><p id="EN-US_TASK_0000001751784621__en-us_task_0176299498_p7339116152614">Layer 3 features such as PE-CE route exchange can be configured only after an IP address is configured for the PE interface that connects to a CE.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_substep1651319278270"><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmd20513202782710">Run the <a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdname18658708319">commit</span></b></a> command to commit the configuration.</span></li><li class="substepexpand" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_substep0648183992816"><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmd19648173914289">Run the <a href="cmdqueryname=quit"><b><span class="cmdname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdname635731012315">quit</span></b></a> command to exit the interface view.</span></li></ol>
</li><li id="EN-US_TASK_0000001751784621__en-us_task_0176299498_step11928719101416"><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmd1692818193145">Configure IPv4 route exchange between the PE and CE in each AS. For configuration details, see <a href="dc_vrp_mpls-l3vpn-v4_cfg_0158.html">Configuring the PE and CE to Exchange Routes</a>.</span></li><li id="EN-US_TASK_0000001751784621__en-us_task_0176299498_step13640145641719"><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmd15640856191710">Establish an MP-IBGP peer relationship between PEs that use IPv6 addresses.</span><p><p id="EN-US_TASK_0000001751784621__en-us_task_0176299498_p192193811331">VPNv4 peers using IPv4 addresses are used for L3VPN over MPLS services. VPNv4 peers using IPv6 addresses are used for L3VPN over SRv6 services.</p>
<p id="EN-US_TASK_0000001751784621__en-us_task_0176299498_p188998216312">The Add-Path function must be enabled for VPNv4 peers using IPv6 addresses to ensure that VPNv4 routes with the same destination address but different next hops can be preferentially selected and advertised to the peer PE.</p>
</p><ol type="a" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_substeps14640115619173"><li class="substepexpand" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_substep8640105617175"><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmd156401956101717">Run the <a href="cmdqueryname=bgp"><b><span class="cmdname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdname8640756111716">bgp</span></b></a><strong id="EN-US_TASK_0000001751784621__en-us_task_0176299498_b67794743"> </strong><i><span class="varname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_varname705810778">as-number</span></i> command to enter the BGP view.</span></li><li class="substepexpand" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_substep8640125631718"><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmd13640115681712">Run the <a href="cmdqueryname=router-id"><b><span class="cmdname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdname146406569175">router-id</span></b></a> <i><span class="varname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_varname146401856121715">ipv4-address</span></i> command to configure a router ID.</span></li><li class="substepexpand" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_substep364075619173"><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmd106401956111715">Run the <a href="cmdqueryname=peer+as-number+%28BGP+view%29"><b><span class="cmdname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdname18764357113420">peer</span></b></a> <i><span class="varname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_varname190825578353918">ipv4-address </span></i><strong><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdparmname82270584353918">as-number</span></strong> <i><span class="varname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_varname117066910253918">as-number</span></i> command to specify a remote PE as a peer.</span></li><li class="substepexpand" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_substep10640115612178"><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmd176401056171712">Run the <a href="cmdqueryname=peer+connect-interface+%28BGP+view%29"><b><span class="cmdname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdname4640175661713">peer</span></b></a> <i><span class="varname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_varname18641115631715">ipv4-address</span></i> <strong><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdparmname4641205661714">connect-interface</span></strong> <strong><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdparmname3641105618173">loopback </span></strong><i><span class="varname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_varname126411756101719">interface-number</span></i> command to specify the interface for setting up a TCP connection for BGP.</span></li><li class="substepexpand" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_substep3641856111717"><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmd11641115620172">Run the <a href="cmdqueryname=peer+as-number+%28BGP+view%29+%28IPv6%29"><b><span class="cmdname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdname3641175615174">peer</span></b></a> <i><span class="varname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_varname7641056111710">ipv6-address</span></i> <strong><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdparmname126411056101716">as-number</span></strong> <i><span class="varname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_varname56415566171">as-number</span></i> command to specify a remote PE as a peer.</span></li><li class="substepexpand" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_substep864185612171"><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmd186414568178">Run the <a href="cmdqueryname=peer+connect-interface+%28BGP+view%29+%28IPv6%29"><b><span class="cmdname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdname2641956151718">peer</span></b></a> <i><span class="varname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_varname364111565174">ipv6-address</span></i> <strong><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdparmname1064120561174">connect-interface</span></strong> <strong><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdparmname106417569173">loopback </span></strong><i><span class="varname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_varname19641165661710">interface-number</span></i> command to specify the interface for setting up a TCP connection for BGP.</span></li><li class="substepexpand" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_substep1264125611711"><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmd36418566179">Run the <a href="cmdqueryname=ipv4-family+vpnv4"><b><span class="cmdname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdname1164125618178">ipv4-family vpnv4</span></b></a> command to enter the BGP-VPNv4 address family view.</span></li><li class="substepexpand" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_substep72011253141910"><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmd2020195391914">Run the <a href="cmdqueryname=bestroute+add-path+path-number"><b><span class="cmdname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdname1864319421227">bestroute add-path path-number</span></b></a> <i><span class="varname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_varname37521447202213">path-number</span></i> command to enable the Add-Path function and set the number of preferred routes. The Add-Path function ensures that VPNv4 routes with IPv6 next hop addresses can also be advertised.</span></li><li class="substepexpand" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_substep76418569175"><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmd2064115564176">Run the <a href="cmdqueryname=peer+enable+%28BGP-VPNv4+address+family+view%29"><b><span class="cmdname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdname16641956131713">peer</span></b></a> <i><span class="varname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_varname46419564175">ipv4-address</span></i> <strong><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdparmname196417567175">enable</span></strong> command to enable the capability to exchange VPN-IPv4 routes with peers that use IPv4 addresses.</span></li><li class="substepexpand" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_substep4641135601714"><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmd14641185611176">Run the <a href="cmdqueryname=peer+enable+%28BGP-VPNv4+address+family+view%29+%28IPv6%29"><b><span class="cmdname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdname1264115614171">peer</span></b></a> <i><span class="varname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_varname156411656141718">ipv6-address</span></i> <strong><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdparmname18641155612178">enable</span></strong> command to enable the capability to exchange VPN-IPv4 routes with peers that use IPv6 addresses.</span></li><li class="substepexpand" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_substep57644206241"><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmd276442092419">Run the <a href="cmdqueryname=peer+capability-advertise+add-path"><b><span class="cmdname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdname17385124418251">peer</span></b></a><strong id="EN-US_TASK_0000001751784621__en-us_task_0176299498_b194159399252"> </strong><em id="EN-US_TASK_0000001751784621__en-us_task_0176299498_i188291424192414">ipv6-address</em><strong><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdparmname1191172362519"> capability-advertise</span></strong><strong><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdparmname1479192912510"> add-path</span></strong> <strong><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdparmname9391936192514">both</span></strong> command to enable the device to advertise and receive Add-Path routes.</span><p><p id="EN-US_TASK_0000001751784621__en-us_task_0176299498_p5968154892812">Configure the Add-Path capability for only peers that use IPv6 addresses. This capability does not need to be configured for peers that use IPv4 addresses. If you do so, a service interruption may occur when such peers restart.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_substep1412034012619"><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmd1312018402265">Run the <a href="cmdqueryname=peer"><b><span class="cmdname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdname1680411108233">peer</span></b></a> <em id="EN-US_TASK_0000001751784621__en-us_task_0176299498_i527785572612">ipv6-address</em> <strong><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdparmname6804141012236">advertise add-path path-number</span></strong> <i><span class="varname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_varname8804111011237">path-number</span></i> command to set the number of Add-Path preferred routes to be advertised to a specified peer.</span></li><li class="substepexpand" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_substep86416567173"><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmd56411256141710">Run the <a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdname196415562170">commit</span></b></a> command to commit the configuration.</span></li><li class="substepexpand" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_substep4642145613174"><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmd76421256191713">Run the <a href="cmdqueryname=quit"><b><span class="cmdname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdname6642145611175">quit</span></b></a> command to exit the BGP-VPNv4 address family view.</span></li><li class="substepexpand" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_substep56421956101718"><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmd15642125615179">Run the <a href="cmdqueryname=quit"><b><span class="cmdname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdname9642135613177">quit</span></b></a> command to exit the BGP view.</span></li></ol>
</li><li id="EN-US_TASK_0000001751784621__en-us_task_0176299498_step19214947153316"><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmd62141472336">Establish an SRv6 BE tunnel between PEs.</span><ol type="a" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_substeps1329012592339"><li class="substepexpand" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_substep6709913173415"><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmd970918137347">Run the <a href="cmdqueryname=segment-routing+ipv6"><b><span class="cmdname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdname209827472468">segment-routing ipv6</span></b></a> command to enable SR on the IPv6 forwarding plane and enter the SRv6 view.</span></li><li class="substepexpand" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_substep2476191613342"><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmd1747821673411">Run the <a href="cmdqueryname=encapsulation+source-address"><b><span class="cmdname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdname7832187164713">encapsulation source-address</span></b></a> <i><span class="varname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_varname1032101511473">ipv6-address</span></i> [ <strong><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdparmname1812515225472">ip-ttl</span></strong> <i><span class="varname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_varname1856118353471">ttl-value</span></i> ] command to specify a source address for SRv6 VPN encapsulation.</span></li><li class="substepexpand" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_substep566312983410"><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmd46711829163415">Run the <a href="cmdqueryname=locator"><b><span class="cmdname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdname18504623125012">locator</span></b></a> <i><span class="varname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_varname12806153625014">locator-name</span></i><em id="EN-US_TASK_0000001751784621__en-us_task_0176299498_i1176882711507"> </em>[ <strong><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdparmname1842164620503">ipv6-prefix</span></strong> <i><span class="varname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_varname7475175185111">ipv6-address prefix-length</span></i> [ <strong><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdparmname0853216205111">static</span></strong> <i><span class="varname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_varname36206275510">static-length</span></i> | <strong><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdparmname167241234195113">args</span></strong> <i><span class="varname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_varname17333164311517">args-length</span></i> ] <sup id="EN-US_TASK_0000001751784621__en-us_task_0176299498_sup667102903415">*</sup> ] command to configure a SID node route locator and enter the SRv6 locator view.</span></li><li class="substepexpand" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_substep10993832163412"><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmd13998143214343">Run the <a href="cmdqueryname=opcode+end-dt4"><b><span class="cmdname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdname20354219135216">opcode</span></b></a> <i><span class="varname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_varname141631252523">func-opcode</span></i> <strong><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdparmname82881712155311">end-dt4</span></strong> <strong><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdparmname4862113531">vpn-instance</span></strong> <i><span class="varname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_varname182782615315">vpn-instance-name</span></i> command to configure the opcode of a static SID.</span></li><li class="substepexpand" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_substep158041834103417"><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmd16805103415344">Run the <a href="cmdqueryname=quit"><b><span class="cmdname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdname461412473453">quit</span></b></a> command to exit the SRv6 locator view.</span></li><li class="substepexpand" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_substep11235636153415"><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmd132365362340">Run the <a href="cmdqueryname=quit"><b><span class="cmdname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdname72041919121010">quit</span></b></a> command to exit the SRv6 view.</span></li><li class="substepexpand" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_substep91337389342"><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmd8136338143412">Run the <a href="cmdqueryname=bgp"><b><span class="cmdname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdname725514549535">bgp</span></b></a><strong id="EN-US_TASK_0000001751784621__en-us_task_0176299498_b11943162114018"> </strong><i><span class="varname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_varname39438218015">as-number</span></i> command to enter the BGP view.</span></li><li class="substepexpand" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_substep11768184315344"><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmd8770114323417">Run the <a href="cmdqueryname=ipv4-family+vpnv4"><b><span class="cmdname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdname146320217542">ipv4-family vpnv4</span></b></a> command to enter the BGP-VPNv4 address family view.</span></li><li class="substepexpand" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_substep124911463349"><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmd1449404615340">Run the <a href="cmdqueryname=peer+prefix-sid+%28BGP-VPNv4+address+family+view%29+%28IPv6%29"><b><span class="cmdname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdname4671193519546">peer</span></b></a> <i><span class="varname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_varname182359545546">ipv6-address</span></i> <strong><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdparmname277740135515">prefix-sid</span></strong> command to enable the device to exchange IPv4 prefix SID information with a specified IPv6 peer.</span></li><li class="substepexpand" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_substep640411486348"><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmd6406048103420">Run the <a href="cmdqueryname=quit"><b><span class="cmdname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdname14309855124510">quit</span></b></a> command to exit the BGP-VPNv4 address family view.</span></li><li class="substepexpand" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_substep979311144225"><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_en-us_task_0172368959_cmd4239140203310">Configure the device to add SIDs to VPN routes. Note that you need to perform configurations only in one of the following two views. If you perform configurations in both views, the configurations in these views are mutually exclusive.</span><p><ul id="EN-US_TASK_0000001751784621__en-us_task_0176299498_en-us_task_0172368959_ul152411240193320"><li id="EN-US_TASK_0000001751784621__en-us_task_0176299498_en-us_task_0172368959_li8685185120348">Configurations in the BGP-VPN instance IPv4 address family view<ol class="substepthirdol" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_en-us_task_0172368959_ol697213138182"><li id="EN-US_TASK_0000001751784621__en-us_task_0176299498_en-us_task_0172368959_li19731613141814">Run the <a href="cmdqueryname=ipv4-family"><b><span class="cmdname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_en-us_task_0172368959_cmdname195814633514">ipv4-family</span></b></a> <strong><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_en-us_task_0172368959_cmdparmname165816663510">vpn-instance</span></strong> <i><span class="varname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_en-us_task_0172368959_varname1158116653517">vpn-instance-name</span></i> command to enter the BGP-VPN instance IPv4 address family view.</li><li id="EN-US_TASK_0000001751784621__en-us_task_0176299498_en-us_task_0172368959_li92161123171819">Run the <span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_en-us_task_0172368959_ph158560437245"><a href="cmdqueryname=segment-routing+ipv6+locator"><b><span class="cmdname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_en-us_task_0172368959_cmdname1085610434249">segment-routing ipv6 locator</span></b></a> <i><span class="varname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_en-us_task_0172368959_varname4856124362411">locator-name</span></i> [ <strong><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_en-us_task_0172368959_cmdparmname1585684319243">auto-sid-disable</span></strong> ]</span> command to enable the device to add SIDs to VPN routes.<p id="EN-US_TASK_0000001751784621__en-us_task_0176299498_en-us_task_0172368959_p12661554161810">If <strong><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_en-us_task_0172368959_cmdparmname128561436249">auto-sid-disable</span></strong> is not specified, the device supports dynamic SID allocation. If there are static SIDs in the range of the locator specified using <i><span class="varname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_en-us_task_0172368959_varname585624317243">locator-name</span></i>, the static SIDs are used. Otherwise, dynamically allocated SIDs are used.</p>
<p id="EN-US_TASK_0000001751784621__en-us_task_0176299498_en-us_task_0172368959_p826725419187">If <strong><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_en-us_task_0172368959_cmdparmname5856114319243">auto-sid-disable</span></strong> is specified, BGP does not dynamically allocate SIDs.</p>
</li></ol>
</li><li id="EN-US_TASK_0000001751784621__en-us_task_0176299498_en-us_task_0172368959_li62656718365">Configurations in the BGP-VPN instance view<ol class="substepthirdol" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_en-us_task_0172368959_ol85026147199"><li id="EN-US_TASK_0000001751784621__en-us_task_0176299498_en-us_task_0172368959_li11502714161913">Run the <a href="cmdqueryname=vpn-instance"><b><span class="cmdname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_en-us_task_0172368959_cmdname87223213288">vpn-instance</span></b></a> <i><span class="varname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_en-us_task_0172368959_varname46654893611">vpn-instance-name</span></i> command to create a BGP-VPN instance and enter its view.</li><li id="EN-US_TASK_0000001751784621__en-us_task_0176299498_en-us_task_0172368959_li03341721181911">Run the <a href="cmdqueryname=segment-routing+ipv6+locator"><b><span class="cmdname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_en-us_task_0172368959_cmdname137109216447">segment-routing ipv6 locator</span></b></a> <i><span class="varname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_en-us_task_0172368959_varname67104219449">locator-name</span></i> <strong><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_en-us_task_0172368959_cmdparmname1656920319446">end-dt46</span></strong> command to enable the device to add SIDs to VPN routes.</li><li id="EN-US_TASK_0000001751784621__en-us_task_0176299498_en-us_task_0172368959_li323322611911">Run the <a href="cmdqueryname=quit"><b><span class="cmdname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_en-us_task_0172368959_cmdname215812542514">quit</span></b></a> command to exit the BGP-VPN instance view.</li><li id="EN-US_TASK_0000001751784621__en-us_task_0176299498_en-us_task_0172368959_li580053519304">Run the <a href="cmdqueryname=ipv4-family+vpn-instance"><b><span class="cmdname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_en-us_task_0172368959_cmdname1853071483115">ipv4-family vpn-instance</span></b></a> <i><span class="varname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_en-us_task_0172368959_varname8891125515301">vpn-instance-name</span></i> command to enter the BGP-VPN instance IPv4 address family view.</li></ol>
</li></ul>
</p></li><li class="substepexpand" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_substep0923491421"><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmd59231896422">(Optional) Run the <a href="cmdqueryname=bestroute+nexthop-priority"><b><span class="cmdname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdname49241594429">bestroute nexthop-priority </span></b></a>{ <strong><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdparmname89241598426">ipv4</span></strong> | <strong><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdparmname1892420919420">ipv6</span></strong> } [ <strong><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdparmname1192459154211">high-level</span></strong> ] command to configure the device to prefer routes with IPv4 or IPv6 next hop addresses. In a dual-stack scenario, if routes with the same prefix are learned from both IPv4 and IPv6 peers, the route whose next hop is of the specified IP address type is preferred.</span></li><li class="substepexpand" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_substep188504563342"><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmd2851175616349">Run the <a href="cmdqueryname=segment-routing+ipv6+best-effort"><b><span class="cmdname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdname51455155616">segment-routing ipv6 best-effort</span></b></a> command to enable the device to recurse VPN routes based on the SIDs carried in the routes.</span></li><li class="substepexpand" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_substep2290125914334"><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmd429011594339">Run the <a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdname814943184612">commit</span></b></a> command to commit the configuration.</span></li></ol>
</li><li id="EN-US_TASK_0000001751784621__en-us_task_0176299498_step194197174358"><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmd134181175359">On the PE, disable BGP VPNv4 routes learned from IPv4 peers from participating in route selection based on the high priority and enable BGP VPNv4 routes learned from IPv6 peers to do so, so that user traffic is switched to the SRv6 tunnel.</span><ol type="a" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_substeps855153117351"><li id="EN-US_TASK_0000001751784621__en-us_task_0176299498_substep16874259193517"><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmd687616595359">Run the <a href="cmdqueryname=system-view"><b><span class="cmdname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdname7263153013462">system-view</span></b></a> command to enter the system view.</span></li><li id="EN-US_TASK_0000001751784621__en-us_task_0176299498_substep88881415368"><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmd11890119361">Run the <a href="cmdqueryname=bgp"><b><span class="cmdname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdname11460143616588">bgp</span></b></a><strong id="EN-US_TASK_0000001751784621__en-us_task_0176299498_b594513210013"> </strong><i><span class="varname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_varname494514216012">as-number</span></i> command to enter the BGP view.</span></li><li id="EN-US_TASK_0000001751784621__en-us_task_0176299498_substep1790410353612"><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmd1990616393618">Run the <a href="cmdqueryname=ipv4-family+vpnv4"><b><span class="cmdname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdname15792484589">ipv4-family vpnv4</span></b></a> command to enter the BGP-VPNv4 address family view.</span></li><li id="EN-US_TASK_0000001751784621__en-us_task_0176299498_substep16671411103616"><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmd1667041123614">Run the <a href="cmdqueryname=peer+high-priority+%28BGP-VPNv4+address+family+view%29"><b><span class="cmdname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdname8923181455919">undo peer</span></b></a> <i><span class="varname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_varname1867743695912">ipv4-address</span></i><em id="EN-US_TASK_0000001751784621__en-us_task_0176299498_i321481935910"> </em><strong><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdparmname97961945175914">high-priority</span></strong> command to disable BGP VPNv4 routes learned from the IPv4 peer from participating in route selection based on the high priority.</span></li><li id="EN-US_TASK_0000001751784621__en-us_task_0176299498_substep456132022016"><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmd1856116206208">Run the <a href="cmdqueryname=peer+high-priority+%28BGP-VPNv4+address+family+view%29"><b><span class="cmdname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdname4139146103">peer</span></b></a> <i><span class="varname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_varname79481961817">ipv6-address</span></i> <strong><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdparmname54321313216">high-priority</span></strong> or <a href="cmdqueryname=peer+high-priority+%28BGP-VPNv4+address+family+view%29"><b><span class="cmdname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdname773120162497">peer</span></b></a> <i><span class="varname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_varname573115162492">peerGroupName</span></i> <strong><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdparmname47315162493">high-priority</span></strong> command to enable BGP VPNv4 routes learned from the IPv6 peer (group) to participate in route selection based on priorities.</span></li><li id="EN-US_TASK_0000001751784621__en-us_task_0176299498_substep235612334203"><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmd2356183372011">Run the <a href="cmdqueryname=quit"><b><span class="cmdname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdname13356173352017">quit</span></b></a> command to exit the BGP-VPNv4 address family view.</span></li><li id="EN-US_TASK_0000001751784621__en-us_task_0176299498_substep162602214205"><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmd42610223206">Run the <a href="cmdqueryname=ipv4-family"><b><span class="cmdname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdname17261838101915">ipv4-family</span></b></a> <strong><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdparmname1372643891910">vpn-instance</span></strong> <i><span class="varname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_varname1726173841919">vpn-instance-name</span></i> command to enter the BGP-VPN instance IPv4 address family view.</span></li><li id="EN-US_TASK_0000001751784621__en-us_task_0176299498_substep528641142320"><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmd2028611110232">(Optional) Run the <a href="cmdqueryname=bestroute+nexthop-priority"><b><span class="cmdname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdname13286611172318">bestroute nexthop-priority</span></b></a> <strong><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdparmname328616116239">ipv6</span></strong> [ <strong><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdparmname2028611192315">high-level</span></strong> ] command to configure the device to prefer routes with IPv6 next hop addresses. In a dual-stack scenario, if routes with the same prefix are learned from both IPv4 and IPv6 peers, the route whose next hop is of the specified IPv6 address type is preferred.</span></li><li id="EN-US_TASK_0000001751784621__en-us_task_0176299498_substep14550133173513"><span id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmd13550231113510">Run the <a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdname1097411854612">commit</span></b></a> command to commit the configuration.</span></li></ol>
</li></ol></div>
<div class="example" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_example1489993133813"><a name="EN-US_TASK_0000001751784621__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p id="EN-US_TASK_0000001751784621__en-us_task_0176299498_p13844122111502">After the configuration is complete:</p>
<ul id="EN-US_TASK_0000001751784621__en-us_task_0176299498_ul174873524499"><li id="EN-US_TASK_0000001751784621__en-us_task_0176299498_li74881852164915">Run the <a href="cmdqueryname=display+bgp+vpnv4+all+routing-table"><b><span class="cmdname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdname561713379138">display bgp vpnv4 all routing-table</span></b></a> command in the system view to check BGP VPNv4 routes and BGP VPN routes.</li><li id="EN-US_TASK_0000001751784621__en-us_task_0176299498_li82718775013">Run the <a href="cmdqueryname=display+bgp+vpnv4+all+peer"><b><span class="cmdname" id="EN-US_TASK_0000001751784621__en-us_task_0176299498_cmdname20623744141316">display bgp vpnv4 all peer</span></b></a> command in the system view to check BGP peers.</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_srv6_cfg_all_0215.html">Configuring Evolution from an MPLS Network to an SRv6 Network
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0189_a.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>

<script language="JavaScript">
<!--
image_size('.imgResize');
var msg_imageMax = "view original image";
var msg_imageClose = "close";
//--></script></body>
</html>