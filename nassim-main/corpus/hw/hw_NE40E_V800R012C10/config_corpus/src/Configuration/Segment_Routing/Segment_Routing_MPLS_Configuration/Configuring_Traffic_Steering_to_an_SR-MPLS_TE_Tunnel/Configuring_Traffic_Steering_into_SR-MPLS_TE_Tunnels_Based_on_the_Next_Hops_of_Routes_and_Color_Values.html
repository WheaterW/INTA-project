
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring Traffic Steering into SR-MPLS TE Tunnels Based on the Next Hops of Routes and Color Values">
<meta name="abstract" content="This section describes how to configure traffic steering into SR-MPLS TE tunnels based on the next hops of routes and color values.">
<meta name="description" content="This section describes how to configure traffic steering into SR-MPLS TE tunnels based on the next hops of routes and color values.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_sr_all_cfg_0145.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_sr_all_cfg_0119.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00604599,l00587852,w00606909,w00800033">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="Segment Routing MPLS">
<meta name="featuretype" content="Segment Routing">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="Segment Routing MPLS">
<meta name="featuretype" content="Segment Routing">
<meta name="featurename" content="Segment Routing MPLS">
<meta name="featuretype" content="Segment Routing">
<meta name="featurename" content="Segment Routing MPLS">
<meta name="featuretype" content="Segment Routing">
<meta name="OWNER" content="l00468467">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00468467">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001254900009">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring Traffic Steering into SR-MPLS TE Tunnels Based on the Next Hops of Routes and Color Values</title>
</head>
<body><a name="EN-US_TASK_0000001254900009"></a><a name="EN-US_TASK_0000001254900009"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring Traffic Steering into SR-MPLS TE Tunnels Based on the Next Hops of Routes and Color Values</h1>
<div class="taskbody"><p>This section describes how to configure traffic steering into SR-MPLS TE tunnels based on the next hops of routes and color values.</p>
<div class="context"><a name="EN-US_TASK_0000001254900009__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>Currently, BGP L3VPNv4, BGP L3VPNv6, EVPN L3VPNv4, and EVPN L3VPNv6 services support SR-MPLS TE tunnels with the color attribute. If you want services to be transmitted over SR-MPLS TE tunnels with the color attribute, specify the <strong><span>colored-sr-te</span></strong> parameter in the <a href="cmdqueryname=tunnel+select-seq"><b><span class="cmdname">tunnel select-seq</span></b></a> command when configuring a tunnel policy. If the route of the services carries the color attribute, the involved device selects the SR-MPLS TE tunnel whose destination address and color attribute match the next hop and color attribute of the route, respectively. However, if the route does not carry the color attribute, the device cannot select any tunnel carrying this attribute. Instead, it can only select an SR-MPLS TE tunnel that does not carry the color attribute and whose destination address matches the next hop of the route.</p>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001254900009__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Pre-configuration Tasks</h4><p>Before configuring traffic steering into SR-MPLS TE tunnels, complete the following tasks:</p>
<ul><li><p>Configure an SR-MPLS TE tunnel.</p>
</li><li><p>Configure BGP L3VPNv4, BGP L3VPNv6, and EVPN L3VPNv4/L3VPNv6 services.</p>
</li><li><p>Configure a filter, such as an IP prefix list, if you want to restrict the routes that can recurse to SR-MPLS TE tunnels.</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001254900009__1.4.3"></a><a name="1.4.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure the color attribute for the specified SR-MPLS TE tunnel.</span><ol type="a"><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=interface+tunnel"><b><span class="cmdname">interface tunnel</span></b></a> <i><span class="varname">tunnel-number</span></i></span><p><p>The SR-MPLS TE tunnel interface view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=color"><b><span class="cmdname">color</span></b></a> <i><span class="varname">color-value</span></i></span><p><p>The color attribute is configured for the SR-MPLS TE tunnel.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Exit the SR-MPLS TE tunnel interface view.</p>
</p></li></ol>
</li><li><span>Configure a route-policy.</span><ol type="a"><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=route-policy"><b><span class="cmdname">route-policy</span></b></a> <i><span class="varname">route-policy-name</span></i> { <strong><span>deny</span></strong> | <strong><span>permit</span></strong> } <strong><span>node</span></strong> <i><span class="varname">node</span></i></span><p><p>A route-policy with a specified node is created, and the route-policy view is displayed.</p>
</p></li><li class="substepexpand"><span>(Optional) Configure an if-match clause for the route-policy. The community attributes of routes can be added or modified only if the routes match specified if-match clauses.</span><p><p>For configuration details, see <a href="dc_vrp_route-policy_cfg_0009.html">(Optional) Configuring an if-match Clause</a>.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=apply+extcommunity"><b><span class="cmdname">apply extcommunity</span></b></a> <strong><span>color</span></strong> <i><span class="varname">color</span></i></span><p><p>The BGP color extended community is configured.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Exit the route-policy view.</p>
</p></li></ol>
</li><li><span>Apply the route-policy to add the color attribute to routes.</span><ul><li>Apply the route-policy to a BGP VPNv4 peer.<ol type="a"><li>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a><p>The system view is displayed.</p>
</li><li>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i><p>The BGP view is displayed.</p>
</li><li><p>Run <a href="cmdqueryname=peer+as-number"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>as-number</span></strong> { <i><span class="varname">as-number-plain</span></i> | <i><span class="varname">as-number-dot</span></i> }</p>
<p>A BGP peer is created.</p>
</li><li>Run <a href="cmdqueryname=ipv4-family"><b><span class="cmdname">ipv4-family</span></b></a> <strong><span>vpnv4</span></strong><p>The BGP VPNv4 address family view is displayed.</p>
</li><li><p>Run <a href="cmdqueryname=peer+enable"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>enable</span></strong></p>
<p>The BGP VPNv4 peer relationship is enabled.</p>
</li><li><p>Run <a href="cmdqueryname=peer+route-policy"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <a href="cmdqueryname=route-policy"><b><span class="cmdname">route-policy</span></b></a> <i><span class="varname">route-policy-name</span></i> { <strong><span>import</span></strong> | <strong><span>export</span></strong> }</p>
<p>A BGP import or export route-policy is configured.</p>
</li><li>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a><p>The configuration is committed.</p>
</li></ol>
</li><li>Apply the route-policy to a BGP VPNv6 peer.<ol type="a"><li>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a><p>The system view is displayed.</p>
</li><li>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i><p>The BGP view is displayed.</p>
</li><li><p>Run <a href="cmdqueryname=peer+as-number"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>as-number</span></strong> { <i><span class="varname">as-number-plain</span></i> | <i><span class="varname">as-number-dot</span></i> }</p>
<p>A BGP peer is created.</p>
</li><li>Run <a href="cmdqueryname=ipv6-family"><b><span class="cmdname">ipv6-family</span></b></a> <strong><span>vpnv6</span></strong><p>The BGP VPNv6 address family view is displayed.</p>
</li><li><p>Run <a href="cmdqueryname=peer+enable"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>enable</span></strong></p>
<p>The BGP VPNv6 peer relationship is enabled.</p>
</li><li><p>Run <a href="cmdqueryname=peer+route-policy"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <a href="cmdqueryname=route-policy"><b><span class="cmdname">route-policy</span></b></a> <i><span class="varname">route-policy-name</span></i> { <strong><span>import</span></strong> | <strong><span>export</span></strong> }</p>
<p>A BGP import or export route-policy is configured.</p>
</li><li>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a><p>The configuration is committed.</p>
</li></ol>
</li><li>Apply the route-policy to a BGP EVPN peer.<ol type="a"><li>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a><p>The system view is displayed.</p>
</li><li>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i><p>The BGP view is displayed.</p>
</li><li>Run <a href="cmdqueryname=l2vpn-family+evpn"><b><span class="cmdname">l2vpn-family evpn</span></b></a><p>The BGP EVPN address family view is displayed.</p>
</li><li><p>Run <a href="cmdqueryname=peer+enable"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>enable</span></strong></p>
<p>The BGP EVPN peer relationship is enabled.</p>
</li><li><p>Run <a href="cmdqueryname=peer+route-policy"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <a href="cmdqueryname=route-policy"><b><span class="cmdname">route-policy</span></b></a> <i><span class="varname">route-policy-name</span></i> { <strong><span>import</span></strong> | <strong><span>export</span></strong> }</p>
<p>A BGP EVPN import or export route-policy is configured.</p>
</li><li>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a><p>The configuration is committed.</p>
</li></ol>
</li><li>Apply the route-policy to a VPN instance IPv4 address family.<ol type="a"><li>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a><p>The system view is displayed.</p>
</li><li>Run <a href="cmdqueryname=ip+vpn-instance"><b><span class="cmdname">ip vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i><p>The VPN instance view is displayed.</p>
</li><li>Run <a href="cmdqueryname=ipv4-family"><b><span class="cmdname">ipv4-family</span></b></a><p>The VPN instance IPv4 address family view is displayed.</p>
</li><li>Run <a href="cmdqueryname=import+route-policy"><b><span class="cmdname">import route-policy</span></b></a> <i><span class="varname">policy-name</span></i><p>The import route-policy is applied to the VPN instance IPv4 address family.</p>
</li><li>Run <a href="cmdqueryname=export+route-policy"><b><span class="cmdname">export route-policy</span></b></a> <i><span class="varname">policy-name</span></i><p>The export route-policy is applied to the VPN instance IPv4 address family.</p>
</li><li>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a><p>The configuration is committed.</p>
</li></ol>
</li><li>Apply the route-policy to a VPN instance IPv6 address family.<ol type="a"><li>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a><p>The system view is displayed.</p>
</li><li>Run <a href="cmdqueryname=ip+vpn-instance"><b><span class="cmdname">ip vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i><p>The VPN instance view is displayed.</p>
</li><li>Run <a href="cmdqueryname=ipv6-family"><b><span class="cmdname">ipv6-family</span></b></a><p>The VPN instance IPv6 address family view is displayed.</p>
</li><li>Run <a href="cmdqueryname=import+route-policy"><b><span class="cmdname">import route-policy</span></b></a> <i><span class="varname">policy-name</span></i><p>The import route-policy is applied to the VPN instance IPv6 address family.</p>
</li><li>Run <a href="cmdqueryname=export+route-policy"><b><span class="cmdname">export route-policy</span></b></a> <i><span class="varname">policy-name</span></i><p>The export route-policy is applied to the VPN instance IPv6 address family.</p>
</li><li>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a><p>The configuration is committed.</p>
</li></ol>
</li></ul>
</li><li><span>Configure a tunnel policy.</span><p><ol type="a"><li>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a><p>The system view is displayed.</p>
</li><li>Run <a href="cmdqueryname=tunnel-policy"><b><span class="cmdname">tunnel-policy</span></b></a> <i><span class="varname">policy-name</span></i><p>A tunnel policy is created, and the tunnel policy view is displayed.</p>
</li><li>(Optional) Run <a href="cmdqueryname=description"><b><span class="cmdname">description</span></b></a> <i><span class="varname">description-information</span></i><p>A description is configured for the tunnel policy.</p>
</li><li>Run <a href="cmdqueryname=tunnel+select-seq"><b><span class="cmdname">tunnel select-seq</span></b></a> <strong><span>colored-sr-te</span></strong> <strong><span>load-balance-number</span></strong> <i><span class="varname">load-balance-number</span></i> <strong><span>unmix</span></strong><p>The tunnel selection sequence and the number of tunnels used for load balancing are configured.</p>
</li><li>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a><p>The configuration is committed.</p>
</li><li>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a><p>Exit the tunnel policy view.</p>
</li></ol>
</p></li><li><span>Configure service recursion to SR-MPLS TE tunnels.</span><ul><li><p>Configure BGP L3VPN service recursion to SR-MPLS TE tunnels.</p>
<div class="p">For configuration details about BGP L3VPN services, see <a href="dc_vrp_mpls-l3vpn-v4_cfg_0000.html">BGP/MPLS IP VPN Configuration</a>. For configuration details about BGP L3VPNv6 services, see <a href="dc_vrp_mpls-l3vpn-v6_cfg_2000.html">BGP/MPLS IPv6 VPN Configuration</a>.<ol type="a"><li>Run <a href="cmdqueryname=ip+vpn-instance"><b><span class="cmdname">ip vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i><p>The VPN instance view is displayed.</p>
</li><li>Run <a href="cmdqueryname=ipv4-family"><b><span class="cmdname">ipv4-family</span></b></a><span> or <a href="cmdqueryname=ipv6-family"><b><span class="cmdname">ipv6-family</span></b></a></span><p>The VPN instance IPv4<span>/IPv6</span> address family view is displayed.</p>
</li><li>Run <a href="cmdqueryname=tnl-policy"><b><span class="cmdname">tnl-policy</span></b></a> <i><span class="varname">policy-name</span></i><p>The specified tunnel policy is applied to the VPN instance IPv4<span>/IPv6</span> address family.</p>
</li><li><p>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></p>
<p>The configuration is committed.</p>
</li></ol>
</div>
</li><li><div class="p">Configure EVPN L3VPN service recursion to SR-MPLS TE tunnels.<ol type="a"><li>Run <a href="cmdqueryname=ip+vpn-instance"><b><span class="cmdname">ip vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i><p>The VPN instance view is displayed.</p>
</li><li>Run <a href="cmdqueryname=ipv4-family"><b><span class="cmdname">ipv4-family</span></b></a><span> or <a href="cmdqueryname=ipv6-family"><b><span class="cmdname">ipv6-family</span></b></a></span><p>The VPN instance IPv4<span>/IPv6</span> address family view is displayed.</p>
</li><li>Run <a href="cmdqueryname=tnl-policy"><b><span class="cmdname">tnl-policy</span></b></a> <i><span class="varname">policy-name</span></i> <strong><span>evpn</span></strong><p>The specified tunnel policy is applied to the EVPN L3VPN instance.</p>
</li><li><p>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></p>
<p>The configuration is committed.</p>
</li></ol>
</div>
</li></ul>
</li></ol></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_sr_all_cfg_0145.html">Configuring Traffic Steering to an SR-MPLS TE Tunnel
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_sr_all_cfg_0119.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>
</body>
</html>