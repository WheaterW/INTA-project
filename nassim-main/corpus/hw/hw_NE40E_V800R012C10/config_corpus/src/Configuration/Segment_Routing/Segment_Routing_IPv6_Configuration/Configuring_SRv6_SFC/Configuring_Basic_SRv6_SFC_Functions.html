
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring Basic SRv6 SFC Functions">
<meta name="abstract" content="This section describes how to configure basic Service Function Chaining (SFC) functions based on SRv6 TE Policy.">
<meta name="description" content="This section describes how to configure basic Service Function Chaining (SFC) functions based on SRv6 TE Policy.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_srv6_cfg_all_0225.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_srv6_cfg_all_0223.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featurename" content="EVPN">
<meta name="featurename" content="Segment Routing IPv6">
<meta name="featurename" content="Segment Routing IPv6 Policy">
<meta name="featurename" content="Segment Routing Policy">
<meta name="featuretype" content="Segment Routing">
<meta name="featuretype" content="VPN">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featurename" content="EVPN">
<meta name="featurename" content="Segment Routing IPv6">
<meta name="featurename" content="Segment Routing IPv6 Policy">
<meta name="featurename" content="Segment Routing Policy">
<meta name="featuretype" content="Segment Routing">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featurename" content="EVPN">
<meta name="featurename" content="Segment Routing IPv6">
<meta name="featurename" content="Segment Routing IPv6 Policy">
<meta name="featurename" content="Segment Routing Policy">
<meta name="featuretype" content="Segment Routing">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="Segment Routing IPv6">
<meta name="featuretype" content="Segment Routing">
<meta name="OWNER" content="l00425560">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00587852">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0219099856">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/thickbox.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/imageResize.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery-migrate-1.2.1.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery-ui.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery.mousewheel.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/thickbox.js"></script>
<title>Configuring Basic SRv6 SFC Functions</title>
</head>
<body><a name="EN-US_TASK_0219099856"></a><a name="EN-US_TASK_0219099856"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring Basic SRv6 SFC Functions</h1>
<div class="taskbody"><p>This section describes how to configure basic Service Function Chaining (SFC) functions based on SRv6 TE Policy.</p>
<div class="prereq" style="margin-left:0"><a name="EN-US_TASK_0219099856__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Prerequisites</h4>
<div class="p"><p>Before configuring basic SRv6 SFC functions, complete the following task:</p>
<ul><li>Configure IS-IS to ensure IPv6 connectivity between the SC, SFFs, and tail end.</li><li>(Optional) Configure VPN instances for SRv6 nodes as needed.</li><li>Configure basic SRv6 functions on the network, a static End SID for each SRv6 node, and End.DT4 SIDs for the IPv4 public network instances or VPN instances on the SC and tail end.</li></ul>
</div></div>
<div class="context"><a name="EN-US_TASK_0219099856__1.4.2"></a><a name="1.4.2"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>SFC logically connects services on network devices to provide an ordered service set for the application layer. By adding service function path (SFP) information in original packets, SFC enables packets to pass through service functions (SFs) along a specified path.</p>
<p>By using segment lists, an SRv6 TE Policy instructs network devices to forward traffic along a specified path. This mechanism is suitable for implementing SFC. Specifically, if a data packet is steered into an SRv6 TE Policy, the headend adds the segment lists of the SRv6 TE Policy to the data packet, and other devices on the network execute the instructions embedded in the segment lists.</p>
<p>On the network shown in <a href="#EN-US_TASK_0219099856__fig17829184811218">Figure 1</a>, SF1 and SF2 are SRv6-unaware SFs. To implement SFC, SF proxy must be configured on SFF1 and SFF2, and SRv6 SIDs must be allocated to SF1 and SF2 proxies. On the SC, the SF1 Proxy SID, SF2 Proxy SID, and Tail End SID form a segment list of an SRv6 TE Policy. The SRv6 TE Policy functions as an SFP.</p>
<div class="fignone" id="EN-US_TASK_0219099856__fig17829184811218"><a name="EN-US_TASK_0219099856__fig17829184811218"></a><a name="fig17829184811218"></a><span class="figcap"><b>Figure 1 </b>SRv6 TE Policy-based SFC forwarding</span><br><span><img class="imgResize" src="figure/en-us_image_0221084505.png" width="523.6875" height="272.05602200000004" title="Click to enlarge"></span></div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0219099856__1.4.3"></a><a name="1.4.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Manually configure an SRv6 TE Policy on the SC or use a controller to deliver an SRv6 TE Policy to the SC. The segment list of the SRv6 TE Policy consists of the SF1 Proxy SID, SF2 Proxy SID, and Tail-End SID.</span></li><li><span>Configure a traffic policy on the SC to redirect traffic to the SRv6 TE Policy.</span><ol type="a"><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=traffic+classifier"><b><span class="cmdname">traffic classifier</span></b></a> <i><span class="varname">classifier-name</span></i> [ <strong><span>operator</span></strong> { <strong><span>and</span></strong> | <strong><span>or</span></strong> } ]</span><p><p>A traffic classifier is configured and its view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <strong>if-match</strong></span><p><p>A match condition is specified for the traffic classifier.</p>
</p><p><p>Currently, SRv6 SFC supports only IPv4 services. Therefore, the match condition must be set based on IPv4 packets.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Exit the traffic classifier view.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=traffic+behavior"><b><span class="cmdname">traffic behavior</span></b></a> <i><span class="varname">behavior-name</span></i></span><p><p>A traffic behavior is defined and its view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=redirect+srv6-te+policy"><b><span class="cmdname">redirect srv6-te policy</span></b></a> <i><span class="varname">endpoint</span></i> <i><span class="varname">color </span></i>[ <strong><span>sid</span></strong> <i><span class="varname">sid-ip </span></i>]</span><p><p>IPv4 traffic is redirected to SRv6 TE Policies.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Exit the traffic behavior view.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=traffic+policy"><b><span class="cmdname">traffic policy</span></b></a> <i><span class="varname">policy-name</span></i></span><p><p>A traffic policy is defined and its view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=classifier"><b><span class="cmdname">classifier</span></b></a> <i><span class="varname">classifier-name</span></i> <strong><span>behavior</span></strong> <i><span class="varname">behavior-name</span></i></span><p><p>The traffic behavior is specified for the traffic classifier in the traffic policy.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Exit the traffic policy view.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=interface"><b><span class="cmdname">interface</span></b></a> <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i> [ <i><span class="varname">.subinterface-number</span></i> ]</span><p><p>The interface view is displayed.</p>
</p><p><p>Currently, only VBDIF interfaces are supported.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=traffic-policy"><b><span class="cmdname">traffic-policy</span></b></a> <i><span class="varname">policy-name</span></i> <strong><span>inbound</span></strong></span><p><p>The traffic policy is applied to the interface.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li><span>Configure an SFF.</span><ol type="a"><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=segment-routing+ipv6"><b><span class="cmdname">segment-routing ipv6</span></b></a></span><p><p>SRv6 is enabled, and the SRv6 view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=locator"><b><span class="cmdname">locator</span></b></a> <i><span class="varname">locator-name</span></i> [ <strong><span>ipv6-prefix</span></strong> <i><span class="varname">ipv6-address</span></i> <i><span class="varname">prefix-length</span></i> [ <strong><span>static</span></strong> <i><span class="varname">static-length</span></i> | <strong><span>args</span></strong> <i><span class="varname">args-length</span></i> ] <sup>*</sup> ]</span></span><p><p>An SRv6 locator is configured, and the SRv6 locator view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=opcode"><b><span class="cmdname">opcode</span></b></a> <em>func-opcode1</em> <strong>end-as</strong></span><p><p>An operation code (opcode) is configured for static End.AS SIDs, and the static SRv6 SFC proxy view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=inner-type+ipv4"><b><span class="cmdname">inner-type ipv4</span></b></a></span><p><p>The type of the original packets to be sent from the SFF to an SF is configured.</p>
</p><p><p>Currently, SRv6 SFC supports only IPv4 packets, which are required to contain only IPv4 headers and payloads.</p>
</p></li><li class="substepexpand"><span>Run either of the following commands to configure the SFF-to-SF packet forwarding mode:</span><p><p>The following commands are mutually exclusive and cannot both be configured. Select a proper packet forwarding mode and set proper parameters based on the network environment of the target SF.</p>
<ul><li>To configure Layer 3 IP forwarding from the SFF to the SF, run the <a href="cmdqueryname=encapsulation+ipv4+nexthop"><b><span class="cmdname">encapsulation ipv4 nexthop</span></b></a><strong> </strong><em>nexthop-addr</em> <strong>out-interface</strong> { <em>outInfName</em> | <em>outInfType</em> <em>outInfNumber</em> } <strong>in-interface</strong> { <em>inInfName</em> | <em>inInfType</em> <em>inInfNumber</em> } [ <strong><span>symmetric-index</span></strong> <em>index-value</em> ] command.<p>In the command, both <strong>out-interface</strong> and <strong>in-interface</strong> specify interfaces on the SFF, where <strong>out-interface</strong> is used for sending traffic to the SF and <strong>in-interface</strong> is used for receiving traffic from the SF. Currently, <strong>out-interface</strong> and <strong>in-interface</strong> can only be VBDIF interfaces. VBDIF interfaces usually need to be bound to VPN instances for service isolation.</p>
</li><li>To configure Layer 2 forwarding from the SFF to the SF, run the <a href="cmdqueryname=encapsulation+eth+out-interface"><b><span class="cmdname">encapsulation eth out-interface</span></b></a><strong> </strong>{ <em>outIntfname</em> | <em>outInfType</em> <em>outInfNum</em> } [ <strong>out-vlan</strong> <em>out-vlan-id</em> [ <strong>ce-vid</strong> <em>out-cevid</em> ] ] <strong>in-interface</strong> { <em>inIntfname</em> | <em>inInfType</em> <em>inInfNum</em> } [ <strong>in-vlan</strong> <em>in-vlan-id</em> [ <strong>ce-vid</strong> <em>in-cevid</em> ] ] [ <strong><span>dest-mac </span></strong><i><span class="varname">destMac</span></i> ] command.<p>In the command, both <strong>out-interface</strong> and <strong>in-interface</strong> specify interfaces on the SFF, where <strong>out-interface</strong> is used for sending traffic to the SF and <strong>in-interface</strong> is used for receiving traffic from the SF. Currently, <strong>out-interface</strong> and <strong>in-interface</strong> can only be EVC sub-interfaces. The VLAN IDs, including those configured using <strong>out-vlan</strong> <em>out-vlan-id</em> and <strong>in-vlan</strong> <em>in-vlan-id</em> must be the same as the VLAN IDs configured using the <a href="cmdqueryname=encapsulation+dot1q+vid"><b><span class="cmdname">encapsulation dot1q vid</span></b></a> command on the EVC sub-interfaces.</p>
</li></ul>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=cache+source-address"><b><span class="cmdname">cache source-address</span></b></a><strong> </strong><em>ipv6-address</em></span><p><p>A source IPv6 address is configured for the SFF to re-encapsulate this address into the SRv6 SFC packets returned from the SF.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=cache+list"><b><span class="cmdname">cache list</span></b></a><strong> </strong>{ <em>ipv6-address</em> } &amp;&lt;1-11&gt;</span><p><p>An SRH is configured for the SFF to re-encapsulate this SRH into the SRv6 SFC packets returned from the SF.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=diffserv-mode"><b><span class="cmdname">diffserv-mode</span></b></a><strong> </strong>{<strong> pipe </strong><em>service-class</em> <em>color</em> | <strong><span>uniform</span></strong> }</span><p><p>A DiffServ mode is configured for the SFC packets returned from the SF to the SFF.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=ttl-mode"><b><span class="cmdname">ttl-mode</span></b></a><strong> </strong>{<strong> pipe </strong><em>ttl-value</em> |<strong> uniform</strong> }</span><p><p>A TTL processing mode is configured for the SFC packets returned from the SF to the SFF.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li><span>Configure the tail end.</span><ol type="a"><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=segment-routing+ipv6"><b><span class="cmdname">segment-routing ipv6</span></b></a></span><p><p>SRv6 is enabled, and the SRv6 view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=locator"><b><span class="cmdname">locator</span></b></a> <i><span class="varname">locator-name</span></i> [ <strong><span>ipv6-prefix</span></strong> <i><span class="varname">ipv6-address</span></i> <i><span class="varname">prefix-length</span></i> [ <strong><span>static</span></strong> <i><span class="varname">static-length</span></i> | <strong><span>args</span></strong> <i><span class="varname">args-length</span></i> ] <sup>*</sup> ]</span></span><p><p>An SRv6 locator is configured, and the SRv6 locator view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=opcode"><b><span class="cmdname">opcode</span></b></a><strong> </strong><em>func-opcode</em> <strong>end-dt4</strong> [ <strong>vpn-instance</strong> <em>vpn-name</em> ]</span><p><p>A static End.DT4 SID's operation code (Opcode) is configured.</p>
</p><p><p>If <strong>vpn-instance</strong> <em>vpn-name</em> is specified, the tail end forwards packets to the specified VPN instance. If <strong>vpn-instance</strong> <em>vpn-name</em> is not specified, the tail end searches the public IP routing table to forward the packets.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li></ol></div>
<div class="postreq"><a name="EN-US_TASK_0219099856__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Verifying the Configuration</h4><div class="p">After completing the SRv6 SFC configuration, run the following commands to verify the configuration:<ul><li>Run the <a href="cmdqueryname=display+segment-routing+ipv6+local-sid+end-as"><b><span class="cmdname">display segment-routing ipv6 local-sid end-as</span></b></a> [ <em>sid-value</em> ] <strong>forwarding</strong> command to check the SRv6 local SID table containing End.AS SIDs.</li><li>Run the <a href="cmdqueryname=display+segment-routing+ipv6+local-sid+end-dt4"><b><span class="cmdname">display segment-routing ipv6 local-sid end-dt4</span></b></a> [ <em>sid-value</em> | <strong>vpn-instance</strong> <em>vpn-name</em> ] <strong>forwarding</strong> command to check the SRv6 local SID table containing End.DT4 SIDs.</li></ul>
</div>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_srv6_cfg_all_0225.html">Configuring SRv6 SFC
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_srv6_cfg_all_0223.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>

<script language="JavaScript">
<!--
image_size('.imgResize');
var msg_imageMax = "view original image";
var msg_imageClose = "close";
//--></script></body>
</html>