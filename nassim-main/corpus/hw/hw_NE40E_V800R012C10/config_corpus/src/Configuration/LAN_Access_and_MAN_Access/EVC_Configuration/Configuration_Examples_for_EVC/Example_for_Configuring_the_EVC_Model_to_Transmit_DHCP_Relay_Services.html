
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring the EVC Model to Transmit DHCP Relay Services">
<meta name="abstract" content="This section describes how to configure an EVC to transmit DHCP relay services in a typical Layer 2 accessing Layer 3 EVC networking scenario.">
<meta name="description" content="This section describes how to configure an EVC to transmit DHCP relay services in a typical Layer 2 accessing Layer 3 EVC networking scenario.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evc_cfg_0018.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evc_cfg_0025.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mstp_cfg_0055.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="h00847023,y00852169">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="EVC">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="EVC">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="featurename" content="EVC">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="featurename" content="EVC">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="OWNER" content="p00915595">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="h00847023">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172363423">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring the EVC Model to Transmit DHCP Relay Services</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172363423"></a><a name="EN-US_TASK_0172363423"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring the EVC Model to Transmit DHCP Relay Services</h1>
<div class="taskbody"><p>This section describes how to configure an EVC to transmit DHCP relay services in a typical Layer 2 accessing Layer 3 EVC networking scenario.</p>
<div class="context"><a name="EN-US_TASK_0172363423__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>In <a href="#EN-US_TASK_0172363423__fig_dc_vrp_evc_cfg_004201">Figure 1</a>, the DHCP clients belong to VLAN 100. The CE connects to the PE through a sub-interface. The PE communicates with the DHCP server through a Layer 3 network. To allow the DHCP clients to automatically apply for IP addresses from the DHCP server, create a VBDIF interface on the PE and configure the DHCP relay function on the VBDIF interface.</p>
<div class="fignone" id="EN-US_TASK_0172363423__fig_dc_vrp_evc_cfg_004201"><a name="EN-US_TASK_0172363423__fig_dc_vrp_evc_cfg_004201"></a><a name="fig_dc_vrp_evc_cfg_004201"></a><span class="figcap"><b>Figure 1 </b>Example for configuring an EVC to transmit DHCP relay services</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interface1, interface2, and subinterface1.1 in this example stand for GE <span>0/1/1</span>, GE <span>0/1/2</span>, and GE <span>0/1/1</span>.1, respectively.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_evc_cfg_004201.png" width="NaN" height="NaN"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172363423__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><ol><li>Create a VLAN and configure Layer 2 forwarding on the CE, so that the CE sends single-tagged packets to the PE.</li><li>Create an EVC model on the PE:<ol type="a"><li>Create a BD.</li><li>Configure an EVC Layer 2 sub-interface and specify a traffic encapsulation type and behavior, so that the EVC Layer 2 sub-interface removes the VLAN tag from its received packets.</li><li>Add the EVC Layer 2 sub-interface to the BD and create a VBDIF interface for the BD, so that the Layer 2 traffic accesses Layer 3.</li></ol>
</li><li>Configure an interface IP address for the PE and DHCP server and configure a routing protocol to allow them to communicate at Layer 3.</li><li>Configure the DHCP relay function on the PE's VBDIF interface and specify the DHCP server's IP address, so that the DHCP clients in the BD can automatically request IP addresses from the DHCP server.</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172363423__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><div class="p">To complete the configuration, you need the following data:<ol><li>VLAN ID to which the DHCP clients belong: 100</li><li>BD ID: 10</li><li>IP address of the VBDIF interface: 1.1.1.1</li><li>IP address of the DHCP server: 2.2.2.2</li></ol>
</div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172363423__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Create a VLAN and configure Layer 2 forwarding on the CE.</span><p><pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname CE</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE] <strong>vlan 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-vlan100] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE] <strong>interface GigabitEthernet<span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-GigabitEthernet<span>0/1/1</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-GigabitEthernet<span>0/1/1</span>] <strong>portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-GigabitEthernet<span>0/1/1</span>] <strong>port link-type access</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-GigabitEthernet<span>0/1/1</span>] <strong>port default vlan 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE] <strong>interface GigabitEthernet<span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-GigabitEthernet<span>0/1/2</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-GigabitEthernet<span>0/1/2</span>] <strong>portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-GigabitEthernet<span>0/1/2</span>] <strong>port link-type trunk</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-GigabitEthernet<span>0/1/2</span>] <strong>port trunk allow-pass vlan 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE] <strong>commit</strong></pre>
</p></li><li><span>Create an EVC model on the PE.</span><p><pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname PE</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE] <strong>vlan 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-vlan100] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE] <strong>bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-bd10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE] <strong>interface </strong><strong>GigabitEthernet</strong><strong><span>0/1/1</span>.1 mode l2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-gigabitethernet<span>0/1/1</span>.1] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-gigabitethernet<span>0/1/1</span>.1] <strong>encapsulation dot1q vid 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-gigabitethernet<span>0/1/1</span>.1] <strong>rewrite pop single</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-gigabitethernet<span>0/1/1</span>.1] <strong>bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-gigabitethernet<span>0/1/1</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE] <strong>interface vbdif10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-vbdif10] <strong>ip address 1.1.1.1 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-vbdif10] <strong>commit</strong></pre>
</p></li><li><span>Configure an interface IP address for the PE and DHCP server and configure a routing protocol to allow them to communicate at Layer 3. The configuration details are omitted.</span></li><li><span>Configure the DHCP relay function on the PE's VBDIF interface and specify the DHCP server's IP address.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-vbdif10] <strong>dhcp select relay</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-vbdif10] <strong>ip relay address 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-vbdif10] <strong>commit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p>Run the <a href="cmdqueryname=display+bridge-domain"><b><span class="cmdname">display bridge-domain</span></b></a> command on the PE. The command output shows the BD to which the Layer 2 EVC sub-interface is added and the BD status.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE] <strong>display bridge-domain</strong></pre>
<pre class="screen">--------------------------------------------------------------------------------
MAC_LRN: MAC learning;         STAT: Statistics;         SPLIT: Split-horizon;
BC: Broadcast;                 MC: Unknown multicast;    UC: Unknown unicast;
*down: Administratively down;  FWD: Forward;             DSD: Discard;
U: Up;         D: Down;
--------------------------------------------------------------------------------

BDID         Ports                                                          
--------------------------------------------------------------------------------
10           Eth<span>0/1/1</span>.1(U)                                                      

BDID  State MAC-LRN STAT    BC  MC  UC  SPLIT   Description
--------------------------------------------------------------------------------
10    up    enable  disable FWD FWD FWD disable </pre>
<p>Run the <a href="cmdqueryname=display+dhcp+relay+address"><b><span class="cmdname">display dhcp relay address</span></b></a> command on the PE. The command output shows the IP addresses of the DHCP relay agent and DHCP server.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE] <strong>display dhcp relay address all</strong></pre>
<pre class="screen">    **  Vbdif10 DHCP Relay Address  **
 Dhcp Option          Relay Agent IP       Server IP
 *                    -                    2.2.2.2  </pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172363423__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>PE configuration file</p>
<pre class="screen">#
sysname PE
#
vlan batch 100
#
bridge-domain 10
#
interface Vbdif10
 ip address 1.1.1.1 255.255.255.0
 dhcp select relay
 ip relay address 2.2.2.2
#
interface GigabitEthernet<span>0/1/1</span>.1 mode l2
 encapsulation dot1q vid 100
 rewrite pop single
 bridge-domain 10
#</pre>
</li><li><p>CE configuration file</p>
<pre class="screen">#
sysname CE
#
vlan batch 100
#
interface GigabitEthernet<span>0/1/1</span>
 portswitch
 undo shutdown
 port link-type access
 port default vlan 100
#
interface GigabitEthernet<span>0/1/2</span>
 portswitch
 undo shutdown
 port link-type trunk
 port trunk allow-pass vlan 100
#</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evc_cfg_0018.html">Configuration Examples for EVC
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evc_cfg_0025.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mstp_cfg_0055.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>