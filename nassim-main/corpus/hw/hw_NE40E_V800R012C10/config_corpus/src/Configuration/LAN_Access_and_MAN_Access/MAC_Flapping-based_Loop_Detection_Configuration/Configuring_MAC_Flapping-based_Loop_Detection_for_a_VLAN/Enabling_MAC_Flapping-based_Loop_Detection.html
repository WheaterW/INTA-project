
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Enabling MAC Flapping-based Loop Detection">
<meta name="abstract" content="After MAC flapping-based loop detection is enabled on devices, the devices can detect loops based on MAC address entry flapping and block interfaces or pseudo wires (PWs) to eliminate the loops.">
<meta name="description" content="After MAC flapping-based loop detection is enabled on devices, the devices can detect loops based on MAC address entry flapping and block interfaces or pseudo wires (PWs) to eliminate the loops.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mflp_cfg_0101.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mflp_cfg_0103.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="wwx1238417">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="MAC-Flapping">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="MAC-Flapping">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="featurename" content="MAC-Flapping">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="featurename" content="MAC-Flapping">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="OWNER" content="c00648116,w00437000">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="wwx1238417">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172363513">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Enabling MAC Flapping-based Loop Detection</title>
</head>
<body><a name="EN-US_TASK_0172363513"></a><a name="EN-US_TASK_0172363513"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Enabling MAC Flapping-based Loop Detection</h1>
<div class="taskbody"><p>After MAC flapping-based loop detection is enabled on devices, the devices can detect loops based on MAC address entry flapping and block interfaces or pseudo wires (PWs) to eliminate the loops.</p>
<div class="steps"><a name="EN-US_TASK_0172363513__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Run <span><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span></span><p><p>The system view is displayed.</p>
</p></li><li><span>Run <span><a href="cmdqueryname=vlan"><b><span class="cmdname">vlan</span></b></a> <i><span class="varname">vlan-id</span></i></span></span><p><p>The VLAN view is displayed.</p>
</p></li><li><span>Run <a href="cmdqueryname=loop-detect+eth-loop"><b><span class="cmdname">loop-detect eth-loop</span></b></a> <strong><span>loop-times</span></strong> <i><span class="varname">loop-times</span></i> <strong><span>detect-cycle</span></strong> <i><span class="varname">detect-cycle-time</span></i> <strong><span>cycles</span></strong> <i><span class="varname">cycles</span></i> { <strong><span>alarm-only</span></strong> | <strong><span>retry-times</span></strong> <i><span class="varname">retry-times</span></i> <strong><span>block-time</span></strong> <i><span class="varname">block-time</span></i> }</span><p><p>MAC flapping-based loop detection is enabled for the VLAN, and its parameters are configured.</p>
</p><p><div class="p"><strong><span id="EN-US_TASK_0172363513__en-us_cliref_0172378238_cmdparmname1223203893214446">retry-times</span></strong> <i><span class="varname" id="EN-US_TASK_0172363513__en-us_cliref_0172378238_varname1461328152214446">retry-times</span></i> and <strong><span id="EN-US_TASK_0172363513__en-us_cliref_0172378238_cmdparmname267646233214446">block-time</span></strong> <i><span class="varname" id="EN-US_TASK_0172363513__en-us_cliref_0172378238_varname258239063214446">block-time</span></i> must both be specified. For example, <i><span class="varname" id="EN-US_TASK_0172363513__en-us_cliref_0172378238_varname862125529214446">retry-times</span></i> is specified as 2 and <i><span class="varname" id="EN-US_TASK_0172363513__en-us_cliref_0172378238_varname241824831214446">block-time</span></i> as 100s. When detecting loops in the VSI, the device blocks interfaces using the following methods:<ol type="a" id="EN-US_TASK_0172363513__en-us_cliref_0172378238_ol735544200214446"><li id="EN-US_TASK_0172363513__en-us_cliref_0172378238_li321123321214446">When detecting a loop on an interface for the first time, the device keeps the interface blocked for 100s.</li><li id="EN-US_TASK_0172363513__en-us_cliref_0172378238_li920291403214446">During the first detection cycle (specified by <i><span class="varname" id="EN-US_TASK_0172363513__en-us_cliref_0172378238_varname1283746882214446">detect-cycle-time</span></i>) after the first blocking period ends (the blocked interface recovers), if the device detects a loop, it keeps the interface blocked for 2 x 100s.</li><li id="EN-US_TASK_0172363513__en-us_cliref_0172378238_li1846032747214446">During the second detection cycle (specified by <i><span class="varname" id="EN-US_TASK_0172363513__en-us_cliref_0172378238_varname816544595214446">detect-cycle-time</span></i>) after the second blocking period ends, if the device detects a loop, it keeps the interface blocked for 4 x 100s.</li><li id="EN-US_TASK_0172363513__en-us_cliref_0172378238_li468429468214446">During the third detection cycle (specified by <i><span class="varname" id="EN-US_TASK_0172363513__en-us_cliref_0172378238_varname261563660214446">detect-cycle-time</span></i>) after the third blocking period ends, if the device detects a loop, it keeps the interface blocked permanently. The reason for the permanent blocking is that three loops occur after the first blocking period ends, which exceeds the maximum number of loops specified by <i><span class="varname" id="EN-US_TASK_0172363513__en-us_cliref_0172378238_varname355151351214446">retry-times</span></i>.</li></ol>
<div class="note" id="EN-US_TASK_0172363513__en-us_cliref_0172378238_note2123735147214446"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0172363513__en-us_cliref_0172378238_p290918842214446">If no loops are detected during <i><span class="varname" id="EN-US_TASK_0172363513__en-us_cliref_0172378238_varname12565471214446">detect-cycle-time</span></i>*30, the blocking count is cleared. If a loop is detected later <i><span class="varname" id="EN-US_TASK_0172363513__en-us_cliref_0172378238_varname1639576591214446">block-time</span></i> is restored.</p>
</div></div>
</div>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>On an STP-capable Layer 2 network, packets with the same source MAC address may form loops. To prevent loops, an interface must be blocked, and an alarm must be reported to the NMS. To allow both STP and MAC flapping-based loop detection to be enabled, run the <a href="cmdqueryname=loop-detect+eth-loop+assist-stp+enable"><b><span class="cmdname">loop-detect eth-loop assist-stp enable</span></b></a> command.</p>
<p>STP and MAC flapping-based loop detection have different blocking principles and may block different interfaces on a network, leading to temporary traffic interruptions. Therefore, exercise caution when running the <a href="cmdqueryname=loop-detect+eth-loop+assist-stp+enable"><b><span class="cmdname">loop-detect eth-loop assist-stp enable</span></b></a> command.</p>
</div></div>
</p></li><li><span>Run <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span></span><p><p>The configuration is committed.</p>
</p></li></ol></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mflp_cfg_0101.html">Configuring MAC Flapping-based Loop Detection for a VLAN
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mflp_cfg_0103.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>