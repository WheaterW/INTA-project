
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring an E-Trunk for VPLS Dual-Homing Access">
<meta name="abstract" content="This section provides an example for configuring an E-Trunk on PEs to implement device-level reliability when a CE is dual-homed to the PEs through Eth-Trunk interfaces.">
<meta name="description" content="This section provides an example for configuring an E-Trunk on PEs to implement device-level reliability when a CE is dual-homed to the PEs through Eth-Trunk interfaces.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ethtrunk_cfg_0060.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ethtrunk_cfg_0065.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ethtrunk_cfg_0067.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="wwx1238417">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="Eth-Trunk">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="Eth-Trunk">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="featurename" content="Eth-Trunk">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="featurename" content="Eth-Trunk">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="OWNER" content="c00648116,w00437000">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="wwx1238417">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172362938">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring an E-Trunk for VPLS Dual-Homing Access</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172362938"></a><a name="EN-US_TASK_0172362938"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring an E-Trunk for VPLS Dual-Homing Access</h1>
<div class="taskbody"><p>This section provides an example for configuring an E-Trunk on PEs to implement device-level reliability when a CE is dual-homed to the PEs through Eth-Trunk interfaces.</p>
<div class="context"><a name="EN-US_TASK_0172362938__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>Eth-Trunk implements link reliability between single devices. However, if a device fails, Eth-Trunk ceases to take effect.</p>
<p>To further improve network reliability, device redundancy with one master device and one backup device can be used. If the master device or primary link fails, the backup device can take over user services. In this situation, another device must be dual-homed to the master and backup devices, and inter-device link reliability must be ensured.</p>
<p>In dual-homing networking, Virtual Router Redundancy Protocol (VRRP) can be used to ensure device-level reliability, and Eth-Trunk can be used to ensure link reliability. In some cases, however, traffic cannot be switched to the backup device and secondary link simultaneously if the master device or primary link fails. As a result, traffic is interrupted. To address this issue, use Enhanced Trunk (E-Trunk) to implement both device-level and link reliability.</p>
<p>On the network shown in <a href="#EN-US_TASK_0172362938__fig_dc_vrp_ethtrunk_cfg_004701">Figure 1</a>, the CE is dual-homed to the PEs on the virtual private LAN service (VPLS) network using Eth-Trunk interfaces working in static LACP mode. To prevent service interruptions, deploy E-Trunk on PE1 and PE2 with PE1 as the master device and PE2 as the backup device. If PE1 or the Eth-Trunk link between PE1 and the CE fails, traffic from the CE is switched to PE2 and the CE enjoys non-stop communication with devices on the VPLS network through PE2. If PE1 or the Eth-Trunk link between the CE and PE1 recovers, traffic is switched back to PE1. In this manner, E-Trunk provides backup between PE1 and PE2, improving network reliability.</p>
<div class="fignone" id="EN-US_TASK_0172362938__fig_dc_vrp_ethtrunk_cfg_004701"><a name="EN-US_TASK_0172362938__fig_dc_vrp_ethtrunk_cfg_004701"></a><a name="fig_dc_vrp_ethtrunk_cfg_004701"></a><span class="figcap"><b>Figure 1 </b>Configuring an E-Trunk for VPLS access</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface 1 and interface 2 represent GE<span>0/1/1</span> and GE<span>0/2/1</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_ethtrunk_cfg_004701.png"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172362938__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Precautions</h4><p>E-Trunk is used to perform link protection in the networking where a CE is dual-homed to two PEs on a VPLS network and prevent service interruptions when a PE becomes faulty.</p>
</div></div>
<div class="context"><a name="EN-US_TASK_0172362938__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Create Eth-Trunk interfaces working in static LACP mode on the CE and PEs and add member interfaces to the Eth-Trunk interfaces to implement Layer 2 forwarding and improve link reliability.</p>
</li><li><p>Configure an E-Trunk on PE1 and PE2 to improve device-level reliability.</p>
<ol type="a"><li><p>Create an E-Trunk on PE1 and PE2 and add the Eth-Trunk interfaces in static LACP mode on the PEs to the E-Trunk.</p>
</li><li><p>Bind a BFD session to the E-Trunk on PE1 and PE2 so that BFD can fast detect faults on the links between PE1 and PE2.</p>
</li><li><div class="p">Configure E-Trunk parameters to ensure reliable communication in the E-Trunk.<ul><li><p>LACP system IDs and LACP priorities of the member Eth-Trunk interfaces in the E-Trunk</p>
</li><li><p>Priorities of the E-Trunk</p>
</li><li><p>Interval for sending Hello packets by the E-Trunk</p>
</li><li><p>Time multiplier for detecting Hello packets by the E-Trunk</p>
</li><li><p>Descriptions of the E-Trunk</p>
</li><li>E-Trunk security-key</li></ul>
</div>
</li></ol>
</li><li><p>Configure VPLS on PE1 and PE2 for users to communicate over the VPLS network.</p>
<ol type="a"><li><p>Configure a routing protocol on PE1 and PE2 to ensure Layer 3 network connectivity.</p>
<p>OSPF is used in this example.</p>
</li><li><p>Configure basic MPLS functions and MPLS LDP, and set up LDP LSPs on PE1 and PE2.</p>
</li><li><p>Enable MPLS L2VPN on PE1 and PE2 so that the MPLS network transparently transmits user packets.</p>
</li><li><p>Configure a virtual switch instance (VSI) on each of PE1 and PE2 and bind the AC sub-interface on each PE to the VSI on that PE, so that the CE can access the VPLS network through these sub-interfaces.</p>
</li></ol>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172362938__1.4.4"></a><a name="1.4.4"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>VSI IDs on each PE (VSI IDs on the PEs must be the same.)</p>
</li><li><p>MPLS LSR ID of each PE</p>
</li><li><p>Names of the VSIs on PE1 and PE2</p>
</li><li><p>Interfaces to which VSIs are bound</p>
</li><li><p>Eth-Trunk interface ID</p>
</li><li><p>Local and peer IP addresses</p>
</li><li><p>LACP system IDs and LACP priorities of the member Eth-Trunk interfaces in the E-Trunk</p>
</li><li><p>Priorities of the E-Trunk</p>
</li><li><p>Period for sending Hello packets and time multiplier for detecting Hello packets</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172362938__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure the Layer 2 forwarding function on the CE and PEs.</span><p><ul><li><p>Configure the CE.</p>
<p># Configure an Eth-Trunk in static LACP mode and add it to VLAN 1.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname CE</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE]<strong> interface eth-trunk 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-Eth-Trunk10]<strong> portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-Eth-Trunk10]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE]<strong> vlan 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-vlan1]<strong> port eth-trunk 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-vlan1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE]<strong> interface eth-trunk 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-Eth-Trunk10]<strong> port link-type trunk</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-Eth-Trunk10]<strong> port trunk allow-pass vlan 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-Eth-Trunk10]<strong> mode lacp-static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-Eth-Trunk10]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE] <strong>commit</strong></pre>
<p># Add member interfaces to Eth-Trunk 10.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-GigabitEthernet<span>0/1/1</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-GigabitEthernet<span>0/1/1</span>]<strong> eth-trunk 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-GigabitEthernet<span>0/1/1</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE]<strong> interface gigabitethernet <span>0/2/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-GigabitEthernet<span>0/2/1</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-GigabitEthernet<span>0/2/1</span>]<strong> eth-trunk 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-GigabitEthernet<span>0/2/1</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE] <strong>commit</strong></pre>
</li><li><p>Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> interface eth-trunk 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Eth-Trunk10]<strong> mode lacp-static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Eth-Trunk10]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet <span>0/2/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/1</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/1</span>]<strong> eth-trunk 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/1</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</li><li><p>Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2]<strong> interface eth-trunk 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Eth-Trunk10]<strong> mode lacp-static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Eth-Trunk10]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>]<strong> eth-trunk 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</li></ul>
</p></li><li><span>Configure an E-Trunk.</span><p><ol type="a"><li><p>Configure an E-Trunk and add the Eth-Trunk in static LACP mode to the E-Trunk.</p>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> e-trunk 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-e-trunk-1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> interface eth-trunk 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Eth-Trunk10]<strong> e-trunk 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Eth-Trunk10]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2]<strong> e-trunk 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-e-trunk-1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> interface eth-trunk 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Eth-Trunk10]<strong> e-trunk 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Eth-Trunk10]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</li><li><p>Bind the E-Trunk to a BFD session.</p>
<ol class="substepthirdol"><li><p>Configure IP addresses for the local and peer ends of the E-Trunk.</p>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> e-trunk 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-e-trunk-1]<strong> peer-address 2.2.2.9 source-address 1.1.1.9</strong>
[<span class="keyword">*</span>PE1-e-trunk-1]<strong> security-key cipher YsHsjx_202206</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-e-trunk-1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2]<strong> e-trunk 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-e-trunk-1]<strong> peer-address 1.1.1.9 source-address 2.2.2.9</strong>
[<span class="keyword">*</span>PE2-e-trunk-1]<strong> </strong><strong>security-key cipher YsHsjx_202206</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-e-trunk-1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</li><li><p>Create a BFD session.</p>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> bfd</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bfd]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> bfd hello bind peer-ip 2.2.2.9 source-ip 1.1.1.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bfd-session-hello]<strong> discriminator local 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bfd-session-hello]<strong> discriminator remote 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bfd-session-hello]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bfd-session-hello]<strong> quit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2]<strong> bfd</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bfd]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> bfd hello bind peer-ip 1.1.1.9 source-ip 2.2.2.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bfd-session-hello]<strong> discriminator local 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bfd-session-hello]<strong> discriminator remote 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bfd-session-hello]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-bfd-session-hello]<strong> quit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The IP addresses of the local and peer ends of a BFD session must be the same as that of the E-Trunk.</p>
</div></div>
</li><li><p>Bind the E-Trunk to a BFD session.</p>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> e-trunk 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-e-trunk-1]<strong> e-trunk track bfd-session session-name hello</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-e-trunk-1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2]<strong> e-trunk 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-e-trunk-1]<strong> e-trunk track bfd-session session-name hello</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-e-trunk-1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p>After the preceding configurations are complete, run the <a href="cmdqueryname=display+bfd+session+all+verbose"><b><span class="cmdname">display bfd session all verbose</span></b></a> command on PE1 and PE2. The command output shows that the BFD session has been created and is in the up state.</p>
<p>The following example uses the command output on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> display bfd session all verbose</strong></pre>
<pre class="screen"><span>(w): State in WTR 
(*): State is invalid</span>
--------------------------------------------------------------------------------
  (Multi Hop) State : <strong>Up</strong>                    Name : hello
--------------------------------------------------------------------------------
  Local Discriminator    : 1                Remote Discriminator   : 2
  Session Detect Mode    : Asynchronous Mode Without Echo Function
  BFD Bind Type          : Peer IP Address
  Bind Session Type      : Static
  Bind Peer IP Address   : 2.2.2.9
  Bind Interface         : -
  Track Interface        : -
  Bind Source IP Address : 1.1.1.9
  FSM Board Id           : 9                TOS-EXP                : 7
  Min Tx Interval (ms)   : 10               Min Rx Interval (ms)   : 10
  Actual Tx Interval (ms): 10               Actual Rx Interval (ms): 10
  Local Detect Multi     : 3                Detect Interval (ms)   : 30
  Echo Passive           : Disable          Acl Number             : -
  Destination Port       : 4784             TTL                    : 254
  Proc Interface Status  : Disable          Process PST            : Disable
  WTR Interval (ms)      : -                Config PST             : Disable
  Active Multi           : 3
  Last Local Diagnostic  : Neighbor Signaled Session Down(Receive AdminDown)
  Bind Application       : E-TRUNK
  Session TX TmrID       : -                Session Detect TmrID   : -
  Session Init TmrID     : -                Session WTR TmrID      : -
  Session Echo Tx TmrID  : -
  Session Description    : -
<span>  Track Group Name       : -</span>
--------------------------------------------------------------------------------

    Total UP/DOWN Session Number : 1/0</pre>
</li></ol>
</li><li><p>Configure E-Trunk parameters.</p>
<ul><li><p>Configure LACP priorities and LACP system IDs for the member Eth-Trunk interfaces in the E-Trunk.</p>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> lacp e-trunk priority 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> lacp e-trunk system-id 00e0-fc12-3458</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2]<strong> lacp e-trunk priority 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> lacp e-trunk system-id 00e0-fc12-3458</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p>Member Eth-Trunk interfaces in the same E-Trunk must have the same LACP priority and LACP system ID.</p>
</li><li><p>Configure E-Trunk priorities.</p>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> e-trunk 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-e-trunk-1]<strong> priority 10</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2]<strong> e-trunk 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-e-trunk-1]<strong> priority 20</strong></pre>
</li><li><p>Configure the interval for sending Hello packets by the E-Trunk.</p>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword">*</span>PE1-e-trunk-1]<strong> timer hello 9</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword">*</span>PE2-e-trunk-1]<strong> timer hello 9</strong></pre>
</li><li><p>Configure the time multiplier for detecting Hello packets by the E-Trunk.</p>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword">*</span>PE1-e-trunk-1]<strong> timer hold-on-failure multiplier 30</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword">*</span>PE2-e-trunk-1]<strong> timer hold-on-failure multiplier 30</strong></pre>
</li><li><p>Configure the description of the E-Trunk.</p>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword">*</span>PE1-e-trunk-1]<strong> description PE1_to_PE2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-e-trunk-1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword">*</span>PE2-e-trunk-1]<strong> description PE2_to_PE1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-e-trunk-1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</li></ul>
</li></ol>
</p></li><li><span>Configure VPLS.</span><p><ol type="a"><li><p>Configure OSPF on PE1 and PE2.</p>
<p># Assign an IP address to each member interface on each PE as shown in <a href="#EN-US_TASK_0172362938__fig_dc_vrp_ethtrunk_cfg_004701">Figure 1</a>. After OSPF is enabled, the 32-bit loopback address of each PE must be advertised.</p>
<p># Configure PE1.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname PE1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack1] <strong>ip address 1.1.1.9 255.255.255.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>]<strong> ip address 10.1.1.1 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>ospf</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1-area-0.0.0.0] <strong>network 1.1.1.9 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1-area-0.0.0.0] <strong>network 10.1.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname PE2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-LoopBack1] <strong>ip address 2.2.2.9 255.255.255.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> interface gigabitethernet <span>0/2/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/1</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/1</span>]<strong> ip address 192.168.1.1 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/1</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>ospf</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-1] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-1-area-0.0.0.0] <strong>network 2.2.2.9 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-1-area-0.0.0.0] <strong>network 192.168.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-1-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p>After the configuration is complete, PE1 and PE2 can discover IP routes of the peer loopback1 by OSPF. The IP addresses in these routes can ping each other.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> ping 2.2.2.9</strong></pre>
<pre class="screen">  PING 2.2.2.9: 56  data bytes, press CTRL_C to break
    Reply from 2.2.2.9: bytes=56 Sequence=1 ttl=254 time=5 ms
    Reply from 2.2.2.9: bytes=56 Sequence=2 ttl=254 time=2 ms
    Reply from 2.2.2.9: bytes=56 Sequence=3 ttl=254 time=2 ms
    Reply from 2.2.2.9: bytes=56 Sequence=4 ttl=254 time=2 ms
    Reply from 2.2.2.9: bytes=56 Sequence=5 ttl=254 time=2 ms

  --- 2.2.2.9 ping statistics ---
    5 packet(s) transmitted
    5 packet(s) received
    0.00% packet loss
    round-trip min/avg/max = 2/2/5 ms</pre>
</li><li><p>Enable basic MPLS functions and LDP on the MPLS backbone network.</p>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>mpls lsr-id 1.1.1.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2]<strong> mpls lsr-id 2.2.2.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> interface gigabitethernet <span>0/2/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/1</span>]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/1</span>]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/1</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p>After the configuration is complete, an LDP session is set up between the PEs. Run the <a href="cmdqueryname=display+mpls+ldp+session"><b><span class="cmdname">display mpls ldp session</span></b></a> command. The command output shows that <strong>Status</strong> is <strong>Operational</strong>.</p>
<p>The following example uses the command output on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> display mpls ldp session</strong></pre>
<pre class="screen"> LDP Session(s) in Public Network
 Codes: LAM(Label Advertisement Mode), SsnAge Unit(DDDD:HH:MM)
<span> An asterisk (*) before a session means the session is being deleted.</span>
--------------------------------------------------------------------------
 PeerID             Status      LAM  SsnRole  SsnAge       KASent/Rcv
--------------------------------------------------------------------------
 2.2.2.9:0          Operational DU   Passive  0000:00:00   1/1
--------------------------------------------------------------------------
TOTAL: 1 Session(s) Found.</pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>If the PEs are indirectly connected, run the <a href="cmdqueryname=mpls+ldp+remote-peer"><b><span class="cmdname">mpls ldp remote-peer</span></b></a> and <a href="cmdqueryname=remote-ip"><b><span class="cmdname">remote-ip</span></b></a> commands to set up a remote LDP session between them.</p>
</div></div>
</li><li><p>Enable MPLS L2VPN.</p>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-l2vpn]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2]<strong> mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-l2vpn]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</li><li><p>Configure VSIs and bind the VSIs to AC sub-interfaces.</p>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> vsi ldp1 static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-ldp1]<strong> pwsignal ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-ldp1-ldp]<strong> vsi-id 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-ldp1-ldp]<strong> peer 2.2.2.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-ldp1-ldp]<strong> mac-withdraw enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-ldp1-ldp]<strong> interface-status-change mac-withdraw enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-ldp1-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-ldp1]<strong> ignore-ac-state</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-ldp1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> interface Eth-Trunk 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Eth-Trunk10]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> interface Eth-Trunk 10.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Eth-Trunk10.1]<strong> vlan-type dot1q 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Eth-Trunk10.1]<strong> l2 binding vsi ldp1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Eth-Trunk10.1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2]<strong> vsi ldp1 static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-ldp1]<strong> pwsignal ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-ldp1-ldp]<strong> vsi-id 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-ldp1-ldp]<strong> peer 1.1.1.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-ldp1-ldp]<strong> mac-withdraw enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-ldp1-ldp]<strong> interface-status-change mac-withdraw enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-ldp1-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-ldp1]<strong> ignore-ac-state</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-ldp1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> interface Eth-Trunk 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Eth-Trunk10]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> interface Eth-Trunk 10.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Eth-Trunk10.1]<strong> vlan-type dot1q 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Eth-Trunk10.1]<strong> l2 binding vsi ldp1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Eth-Trunk10.1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<div class="notice"><span class="noticetitle"><img src="../../../../public_sys-resources/notice_3.0-en-us.png"> </span><div class="noticebody"><p>In scenarios where a CE accesses a VPLS network through dual-homing, if the peer end on the primary link cannot promptly update its MAC address entries of the involved VSI when AC status changes, partial traffic loss occurs. To prevent traffic loss, run the <a href="cmdqueryname=mac-withdraw+enable"><b><span class="cmdname">mac-withdraw enable</span></b></a> and <a href="cmdqueryname=interface-status-change+mac-withdraw+enable"><b><span class="cmdname">interface-status-change mac-withdraw enable</span></b></a> commands. These commands enable the function to send MAC Withdraw messages to the peer end over the primary link when AC status changes. The peer end then clears the learned MAC addresses.</p>
<p>To enable a VSI to ignore AC status changes, run the <a href="cmdqueryname=ignore-ac-state"><b><span class="cmdname">ignore-ac-state</span></b></a> command. After this command is run, the VSI can be up even if no AC interface is bound to it. Exercise caution when running this command.</p>
</div></div>
<p># Run the <a href="cmdqueryname=display+vsi+name+ldp1+verbose"><b><span class="cmdname">display vsi name ldp1 verbose</span></b></a> command. The command output shows PW information.</p>
<p>The following example uses the command output on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display vsi name ldp1 verbose</strong></pre>
<pre class="screen"> ***VSI Name               : ldp1
    Administrator VSI      : no
    Isolate Spoken         : disable
    VSI Index              : 1
    PW Signaling           : ldp
    Member Discovery Style : static
    Bridge-domain Mode     : disable
    PW MAC Learn Style     : unqualify
    Encapsulation Type     : vlan
    MTU                    : 1500
    Ignore AcState         : enable
    P2P VSI                : disable
    Create Time            : 0 days, 0 hours, 41 minutes, 35 seconds
    VSI State              : <strong>up</strong>
    Resource Status        : -- 

VSI ID                 : 2
   *Peer Router ID         : 2.2.2.9
    primary or secondary   : primary
    ignore-standby-state   : no
    VC Label               : 32828
    Peer Type              : dynamic
    Session                : <strong>up</strong>
    Tunnel ID              :0x0000000001004c4b42
    Broadcast Tunnel ID    : --
    Broad BackupTunnel ID  : --
    CKey                   : 1
    NKey                   : 3607101554
    Stp Enable             : 0
    PwIndex                : 1
<span>    Control Word           : disable</span>

    Interface Name         : Eth-Trunk10.1
    State                  : <strong>up</strong>
    Access Port            : false
    Last Up Time           : 2013/07/05 15:32:50
    Total Up Time          : 0 days, 0 hours, 8 minutes, 22 seconds

   **PW Information:

   *Peer Ip Address        : <strong>2.2.2.9</strong>
    PW State               : <strong>up</strong>
    Local VC Label         : 19456
    Remote VC Label        : 19456
<span>    Remote Control Word    : disable</span>
    PW Type                : label
    Tunnel ID              : 0x0000000001004c4b42
    Broadcast Tunnel ID    : --
    Broad BackupTunnel ID  : --
    Ckey                   : 0x2
    Nkey                   : 0x1
    Main PW Token          : 0x801002
    Slave PW Token         : 0x0
    Tnl Type               : ldp
    OutInterface           : GigabitEthernet<span>0/1/1</span>
    Stp Enable             : 0
    Mac Flapping           : 0 
    PW Last Up Time        : 2013/07/05 15:12:13
    PW Total Up Time       : 0 days, 0 hours, 26 minutes, 39 seconds</pre>
<p>The command output shows that a PW is set up between the VSI <strong>ldp1</strong> and PE2. The VSI and PW are up, and the Eth-Trunk sub-interface bound to the VSI is also up.</p>
</li></ol>
</p></li><li><span>Verify the configuration.</span><p><p># Run the <a href="cmdqueryname=display+eth-trunk"><b><span class="cmdname">display eth-trunk</span></b></a> command on the CE to check the Eth-Trunk interface configuration.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE]<strong> display eth-trunk 10</strong></pre>
<pre class="screen">Eth-Trunk10's state information is:
Local:
LAG ID: 10                  WorkingMode: STATIC
Preempt Delay: Disabled     Hash arithmetic: According to flow
System Priority: 32768      System ID: 00e0-fc12-3459
Least Active-linknumber: 1  Max Active-linknumber: xx
Operate status: up          Number Of Up Port In Trunk: 1
<span>Timeout Period: Slow</span>
--------------------------------------------------------------------------------
ActorPortName                 Status   PortType PortPri PortNo PortKey PortState Weight
GigabitEthernet<span>0/1/1</span>          <strong>Selected</strong> 100M     32768   128    2593    11111100  1
GigabitEthernet<span>0/2/1</span>          <strong>Unselect</strong> 100M     32768   129    2593    11100010  1

Partner:
--------------------------------------------------------------------------------
ActorPortName              SysPri    SystemID       PortPri PortNo  PortKey   PortState
GigabitEthernet<span>0/1/1</span>          1      00e0-fc12-3458  32768  129     2593      11111100
GigabitEthernet<span>0/2/1</span>          1      00e0-fc12-3458  32768  32896   2593      11010000</pre>
<p>The command output shows that the CE's Eth-Trunk member interfaces GigabitEthernet<span>0/1/1</span> and GigabitEthernet<span>0/2/1</span> are in the <strong>Selected</strong> and <strong>Unselect</strong> states, respectively.</p>
<p># Run the <a href="cmdqueryname=display+e-trunk"><b><span class="cmdname">display e-trunk</span></b></a> command to check E-Trunk information.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> display e-trunk 1</strong></pre>
<pre class="screen">                            The E-Trunk information
E-TRUNK-ID : 1                          Revert-Delay-Time (s) : 120
Priority : <strong>10</strong>                           System-ID : 00e0-fc12-3457
Peer-IP : 2.2.2.9                       Source-IP : 1.1.1.9
State : Master                          Causation : PRI
Send-Period (100ms) : 9                 Fail-Time (100ms) : 270
Receive : 1149                          Send : 1182
RecDrop : 0                             SndDrop : 0
Peer-Priority : 20                      Peer-System-ID : 00e0-fc12-3456
Peer-Fail-Time (100ms) : 270            BFD-Session : hello
Description : PE1_to_PE2
--------------------------------------------------------------------------------
                            The Member information
Type      ID  LocalPhyState  Work-Mode     State   Causation        Remote-ID
Eth-Trunk 10  Up             auto          <strong>Master</strong>  PEER_MEMBER_DOWN 10</pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2]<strong> display e-trunk 1</strong></pre>
<pre class="screen">                            The E-Trunk information
E-TRUNK-ID : 1                          Revert-Delay-Time (s) : 120
Priority : <strong>20</strong>                           System-ID : 00e0-fc12-3456
Peer-IP : 1.1.1.9                       Source-IP : 2.2.2.9
State : Backup                          Causation : PRI
Send-Period (100ms) : 9                 Fail-Time (100ms) : 270
Receive : 1435                          Send : 1438
RecDrop : 35                            SndDrop : 0
Peer-Priority : 10                      Peer-System-ID : 00e0-fc12-3457
Peer-Fail-Time (100ms) : 270            BFD-Session : hello
Description : PE2_to_PE1
--------------------------------------------------------------------------------
                            The Member information
Type      ID  LocalPhyState  Work-Mode     State   Causation        Remote-ID
Eth-Trunk 10  Down           auto          <strong>Backup</strong>  PEER_MEMBER_UP   10</pre>
<p>The command output shows priority of the E-Trunk on PE1 is 10 and the E-Trunk is in the Master state. The priority of the E-Trunk on PE2 is 20 and the E-Trunk is in the Backup state. In this manner, the device backup is implemented.</p>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172362938__1.4.6"></a><a name="1.4.6"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>CE configuration file</p>
<pre class="screen">#
sysname CE
#
vlan  1
 port eth-trunk 10
#
interface Eth-Trunk10
 portswitch
 port link-type trunk 
 port trunk allow-pass vlan 1
 mode lacp-static
 #
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 eth-trunk 10
#
interface GigabitEthernet<span>0/2/1</span>
 undo shutdown
 eth-trunk 10
#
return</pre>
</li><li><p>PE1 configuration file</p>
<pre class="screen">#
sysname PE1
#
lacp e-trunk system-id 00e0-fc12-3458
lacp e-trunk priority 1
#
bfd
#
mpls lsr-id 1.1.1.9
#
mpls
#
mpls l2vpn
#
vsi ldp1 static
 pwsignal ldp
  vsi-id 2
  mac-withdraw enable
  interface-status-change mac-withdraw enable
  peer 2.2.2.9
 ignore-ac-state
#
mpls ldp
#
mpls ldp remote-peer 2.2.2.9
#
mpls ldp remote-peer PE2
 remote-ip 2.2.2.9
#
e-trunk 1
 priority 10
 peer-address 2.2.2.9 source-address 1.1.1.9
 timer hello 9
 timer hold-on-failure multiplier 30
 e-trunk track bfd-session session-name hello
 description PE1_to_PE2
 security-key cipher ***
#
interface Eth-Trunk10
 mode lacp-static
 e-trunk 1
#
interface Eth-Trunk10.1
 vlan-type dot1q 1
 l2 binding vsi ldp1
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 10.1.1.1 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/1</span>
 undo shutdown
 eth-trunk 10
#
interface LoopBack1
 ip address 1.1.1.9 255.255.255.255
#
bfd hello bind peer-ip 2.2.2.9 source-ip 1.1.1.9
 discriminator local 1
 discriminator remote 2
#
ospf 1
 area 0.0.0.0
  network 1.1.1.9 0.0.0.0
  network 10.1.1.0 0.0.0.255
#
return</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#
sysname PE2
lacp e-trunk system-id 00e0-fc12-3458
lacp e-trunk priority 1
#
bfd
#
mpls lsr-id 2.2.2.9
#
mpls
#
mpls l2vpn
#
vsi ldp1 static
 pwsignal ldp
  vsi-id 2
  mac-withdraw enable
  interface-status-change mac-withdraw enable
  peer 1.1.1.9
 ignore-ac-state
#
mpls ldp
#
mpls ldp remote-peer PE1
 remote-ip 1.1.1.9
#
e-trunk 1
 priority 20
 peer-address 1.1.1.9 source-address 2.2.2.9
 timer hello 9
 timer hold-on-failure multiplier 30
 e-trunk track bfd-session session-name hello
 description PE2_to_PE1
 security-key cipher ***
#
interface Eth-Trunk10
 mode lacp-static
 e-trunk 1
#
interface Eth-Trunk10.1
 vlan-type dot1q 1
 l2 binding vsi ldp1
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 eth-trunk 10
#
interface GigabitEthernet<span>0/2/1</span>
 undo shutdown
 ip address 192.168.1.1 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 2.2.2.9 255.255.255.255
#
bfd hello bind peer-ip 1.1.1.9 source-ip 2.2.2.9
 discriminator local 2
 discriminator remote 1
#
ospf 1
 area 0.0.0.0
  network 2.2.2.9 0.0.0.0
  network 192.168.1.0 0.0.0.255
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ethtrunk_cfg_0060.html">Configuration Examples for Eth-Trunk Interfaces
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ethtrunk_cfg_0065.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ethtrunk_cfg_0067.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>