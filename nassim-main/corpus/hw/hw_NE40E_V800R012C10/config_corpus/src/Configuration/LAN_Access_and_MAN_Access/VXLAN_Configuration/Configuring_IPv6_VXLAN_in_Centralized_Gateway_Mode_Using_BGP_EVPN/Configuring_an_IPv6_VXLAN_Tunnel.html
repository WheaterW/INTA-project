
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring an IPv6 VXLAN Tunnel">
<meta name="abstract" content="Using BGP EVPN to establish an IPv6 VXLAN tunnel between VTEPs involves a series of operations. These include establishing a BGP EVPN peer relationship, configuring an EVPN instance, and configuring ingress replication.">
<meta name="description" content="Using BGP EVPN to establish an IPv6 VXLAN tunnel between VTEPs involves a series of operations. These include establishing a BGP EVPN peer relationship, configuring an EVPN instance, and configuring ingress replication.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vxlan6_cfg_0001.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vxlan6_cfg_0002.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vxlan6_cfg_0004.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="h00847023">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="OWNER" content="p00915595">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="p00915595">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0229407588">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring an IPv6 VXLAN Tunnel</title>
</head>
<body><a name="EN-US_TASK_0229407588"></a><a name="EN-US_TASK_0229407588"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring an IPv6 VXLAN Tunnel</h1>
<div class="taskbody"><p>Using BGP EVPN to establish an IPv6 VXLAN tunnel between VTEPs involves a series of operations. These include establishing a BGP EVPN peer relationship, configuring an EVPN instance, and configuring ingress replication.</p>
<div class="context"><a name="EN-US_TASK_0229407588__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><div class="p">To enable BGP EVPN to establish IPv6 VXLAN tunnels in centralized gateway scenarios, complete the following tasks on the involved gateways:<ol><li><p>Configure a BGP EVPN peer relationship. After the gateways on an IPv6 VXLAN establish such a relationship, they can exchange EVPN routes. If an RR is deployed on the network, each gateway only needs to establish a BGP EVPN peer relationship with the RR.</p>
</li><li><p>(Optional) Configure an RR. The deployment of RRs simplifies configurations because fewer BGP EVPN peer relationships need to be established. An existing device can be configured to also function as an RR, or a new device can be deployed for this specific purpose. Layer 3 gateways on an IPv6 VXLAN are generally used as RRs, and Layer 2 gateways used as RR clients.</p>
</li><li><p>Configure an EVPN instance. EVPN instances can be used to manage EVPN routes received from and advertised to BGP EVPN peers.</p>
</li><li><p>Configure ingress replication. After ingress replication is configured on an IPv6 VXLAN gateway, the gateway uses BGP EVPN to construct a list of remote VTEP peers that share the same VNI with itself. After the gateway receives BUM packets, its sends a copy of the BUM packets to each gateway in the list.</p>
</li></ol>
</div>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Currently, BUM packets can be forwarded only through ingress replication. This means that non-Huawei devices must have ingress replication configured to establish IPv6 VXLAN tunnels with Huawei devices. If ingress replication is not configured, the tunnels fail to be established.</p>
</div></div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0229407588__1.4.2"></a><a name="1.4.2"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li id="EN-US_TASK_0229407588__bgp_evpn_peer"><span id="EN-US_TASK_0229407588__">Configure a BGP EVPN peer relationship.</span><ol type="a"><li class="substepexpand"><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span><p><p>BGP is enabled, and its view is displayed.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=router-id"><b><span class="cmdname">router-id</span></b></a> <i><span class="varname">router-id-value</span></i></span><p><p>A BGP router ID is set.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer+as-number+%28BGP+view%29+%28IPv6%29"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv6-address</span></i> <strong><span>as-number</span></strong> <i><span class="varname">as-number</span></i></span><p><p>An IPv6 BGP peer is specified.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=peer+connect-interface+%28BGP+view%29+%28IPv6%29"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv6-address</span></i> <strong><span>connect-interface</span></strong> <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i> [ <i><span class="varname">ipv6-source-address</span></i> ]</span><p><p>A source interface and a source IPv6 address used to set up a TCP connection with the BGP peer are specified.</p>
</p><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>If loopback interfaces are used to establish a BGP connection, you are advised to run the <a href="cmdqueryname=peer+connect-interface+%28BGP+view%29+%28IPv6%29"><b><span class="cmdname">peer connect-interface</span></b></a> command on both ends of the link to ensure connectivity. If this command is run on only one end, the BGP connection may fail to be established.</p>
</div></div>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=peer+ebgp-max-hop+%28BGP+view%29+%28IPv6%29"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv6-address</span></i> <a href="cmdqueryname=ebgp-max-hop"><b><span class="cmdname">ebgp-max-hop</span></b></a> [ <i><span class="varname">hop-count</span></i> ]</span><p><p>The maximum number of hops allowed for establishing an EBGP EVPN peer relationship is configured.</p>
</p><p><p>The default value of <i><span class="varname">hop-count</span></i> is 255. In most cases, a directly connected physical link must be available between EBGP EVPN peers. If you want to establish EBGP EVPN peer relationships between indirectly connected devices, run the <a href="cmdqueryname=peer+ebgp-max-hop+%28BGP+view%29+%28IPv6%29"><b><span class="cmdname">peer ebgp-max-hop</span></b></a> command. This command allows the devices to establish a TCP connection across multiple hops.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>When loopback interfaces are used to establish an EBGP EVPN peer relationship, the <a href="cmdqueryname=peer+ebgp-max-hop+%28BGP+view%29+%28IPv6%29"><b><span class="cmdname">peer ebgp-max-hop</span></b></a> command must be run, with <i><span class="varname">hop-count</span></i> being at least 2. Otherwise, the peer relationship fails to be established.</p>
</div></div>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=l2vpn-family+evpn"><b><span class="cmdname">l2vpn-family evpn</span></b></a></span><p><p>The BGP-EVPN address family view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer+enable+%28BGP-EVPN+address+family+view%29+%28IPv6%29"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">group-name</span></i> | <i><span class="varname">ipv6-address</span></i> } <strong><span>enable</span></strong></span><p><p>The device is enabled to exchange EVPN routes with a specified peer or peer group.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer+advertise+encap-type"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">group-name</span></i> | <i><span class="varname">ipv6-address</span></i> } <strong><span>advertise encap-type vxlan</span></strong></span><p><p>The device is enabled to advertise EVPN routes that carry the VXLAN encapsulation attribute to the peer or peer group.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=peer+route-policy+export+%28BGP-EVPN+address+family+view%29+%28IPv6%29"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">group-name</span></i> | <i><span class="varname">ipv6-address</span></i> } <strong><span>route-policy</span></strong> <i><span class="varname">route-policy-name</span></i> { <strong><span>import</span></strong> | <strong><span>export</span></strong> }</span><p><p>A route-policy is specified for routes to be received from or advertised to the BGP EVPN peer or peer group.</p>
</p><p><p>The route-policy helps the device import or advertise only desired routes. This reduces the routing table size and system resource consumption, facilitating route management.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=peer+route-limit+%28BGP-EVPN+address+family+view%29"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">group-name</span></i> | <i><span class="varname">ipv6-address</span></i> } <a href="cmdqueryname=mac-limit"><b><span class="cmdname">mac-limit</span></b></a> <i><span class="varname">number</span></i> [ <i><span class="varname">percentage</span></i> ] [ <strong><span>alert-only</span></strong> | <strong><span>idle-forever</span></strong> | <strong><span>idle-timeout</span></strong> <i><span class="varname">times</span></i> ]</span><p><p>The maximum number of MAC advertisement routes that can be imported from the peer or peer group is configured.</p>
</p><p><p>If an EVPN instance imports many inapplicable MAC advertisement routes from a peer or peer group and they account for a large proportion of the total number of MAC advertisement routes, you are advised to run the <a href="cmdqueryname=peer+route-limit+%28BGP-EVPN+address+family+view%29"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">group-name</span></i> | <i><span class="varname">ipv6-address</span></i> } <a href="cmdqueryname=mac-limit"><b><span class="cmdname">mac-limit</span></b></a> <i><span class="varname">number</span></i> [ <i><span class="varname">percentage</span></i> ] [ <strong><span>alert-only</span></strong> | <strong><span>idle-forever</span></strong> | <strong><span>idle-timeout</span></strong> <i><span class="varname">times</span></i> ] command. This command limits the maximum number of MAC advertisement routes that can be imported. If the imported MAC advertisement routes exceed the specified maximum number, the device displays an alarm, prompting you to check the validity of the MAC advertisement routes imported to the EVPN instance.</p>
</p></li><li class="substepexpand"><span>(Optional) Perform the following operations to enable the device to advertise routes with the large-community attribute to BGP EVPN peers.</span><p><p>The large-community attribute includes a 2-byte or 4-byte AS number and two 4-byte <strong>LocalData</strong> fields, allowing the administrator to flexibly use route-policies. Before enabling the function to advertise the routes carrying the large-community attribute to BGP EVPN peers, <a href="dc_vrp_bgp_cfg_4059.html">configure the route-policy related to the large-community attribute</a> and use the route-policy to set the large-community attribute.</p>
</p><p><ol class="substepthirdol"><li><p>Run the <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">peerIpv6Addr</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>route-policy</span></strong> <i><span class="varname">route-policy-name</span></i> <strong><span>export</span></strong> command to apply an export route-policy to filter routes to be advertised to a specified BGP EVPN peer or peer group.</p>
</li><li><p>Run the <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">peerIpv6Addr</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>advertise-large-community</span></strong> command to enable the device to advertise routes with the large-community attribute to a specified BGP EVPN peer or peer group.</p>
<p>If the routes with the large-community attribute do not need to be advertised to a BGP EVPN peer in the peer group, run the <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">peerIpv6Addr</span></i> <strong><span>advertise-large-community</span></strong> <strong><span>disable</span></strong> command.</p>
</li></ol>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">peerIpv6Addr</span></i> <strong><span>graceful-restart</span></strong> <strong><span>static-timer</span></strong> <i><span class="varname">restart-time</span></i></span><p><p>The maximum hold-off time for re-establishing BGP peer relationships, namely, the maximum duration from the time the local device finds that the peer device restarts to the time the local device re-establishes a BGP peer relationship with the peer device, is configured.</p>
</p><p><div class="p">Graceful restart (GR) prevents traffic interruption caused by the re-establishment of BGP peer relationships. To set the maximum hold-off time, run either of the following commands:<ul><li><p>To set the maximum hold-off time for re-establishing all BGP peer relationships, run the <a href="cmdqueryname=graceful-restart+timer+restart"><b><span class="cmdname">graceful-restart timer restart</span></b></a> command in the BGP view. The hold-off time can be set to 3600s at the most.</p>
</li><li><p>To set the maximum hold-off time for re-establishing a BGP EVPN peer relationship, run the <a href="cmdqueryname=peer+graceful-restart+static-timer"><b><span class="cmdname">peer graceful-restart static-timer</span></b></a> command in the BGP view. Use this command if you want to set a hold-off time longer than 3600s.</p>
</li></ul>
</div>
<p>If both the <a href="cmdqueryname=graceful-restart+timer+restart"><b><span class="cmdname">graceful-restart timer restart</span></b></a> <i><span class="varname">time</span></i> and <a href="cmdqueryname=peer+graceful-restart+static-timer"><b><span class="cmdname">peer graceful-restart static-timer</span></b></a> commands are run, the <a href="cmdqueryname=peer+graceful-restart+static-timer"><b><span class="cmdname">peer graceful-restart static-timer</span></b></a> command configuration takes precedence.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>This step can be performed only after GR has been enabled using the <a href="cmdqueryname=graceful-restart"><b><span class="cmdname">graceful-restart</span></b></a> command in the BGP view.</p>
</div></div>
</p></li><li class="substepexpand" id="EN-US_TASK_0229407588__substep938824612817"><span id="EN-US_TASK_0229407588__cmd73881546380">(Optional) Run the <a href="cmdqueryname=peer+path-attribute-treat+%28BGP-EVPN+address+family+view%29+%28IPv6%29"><b><span class="cmdname" id="EN-US_TASK_0229407588__cmdname15960276127">peer</span></b></a> <i><span class="varname" id="EN-US_TASK_0229407588__varname52531425162812">peerIpv6Addr</span></i> <strong><span id="EN-US_TASK_0229407588__cmdparmname1253172592818">path-attribute-treat</span></strong> <strong><span id="EN-US_TASK_0229407588__cmdparmname1425312251280">attribute-id</span></strong> { <i><span class="varname" id="EN-US_TASK_0229407588__varname1525313257282">id</span></i> [ <strong><span id="EN-US_TASK_0229407588__cmdparmname18254172542819">to</span></strong> <i><span class="varname" id="EN-US_TASK_0229407588__varname19254225192819">id2</span></i> ] } &amp;&lt;1-255&gt; { <strong><span id="EN-US_TASK_0229407588__cmdparmname325412562818">discard</span></strong> | <strong><span id="EN-US_TASK_0229407588__cmdparmname1525422518287">withdraw</span></strong> | <strong><span id="EN-US_TASK_0229407588__cmdparmname3254925152813">treat-as-unknown</span></strong> } command to configure a special mode for processing BGP EVPN path attributes. Alternatively, run the <a href="cmdqueryname=peer"><b><span class="cmdname" id="EN-US_TASK_0229407588__cmdname93005531399">peer</span></b></a> <i><span class="varname" id="EN-US_TASK_0229407588__varname123001853203916">peerIpv6Addr</span></i> <strong><span id="EN-US_TASK_0229407588__cmdparmname163001053133910">treat-with-error</span></strong> <strong><span id="EN-US_TASK_0229407588__cmdparmname1930011539391">attribute-id</span></strong> <i><span class="varname" id="EN-US_TASK_0229407588__varname15300165313911">id</span></i> <strong><span id="EN-US_TASK_0229407588__cmdparmname1230095363919">accept-zero-value</span></strong> command to configure a mode for processing incorrect BGP EVPN path attributes.</span><p><p id="EN-US_TASK_0229407588__p853610510717">A BGP EVPN Update message contains various path attributes. If a local device receives Update messages containing malformed path attributes, the involved BGP EVPN sessions may flap. To enhance reliability, you can perform this step to configure a processing mode for specified BGP EVPN path attributes or incorrect path attributes.</p>
<div class="p" id="EN-US_TASK_0229407588__p18357962720">The <strong id="EN-US_TASK_0229407588__b19133258351">path-attribute-treat</strong> parameter specifies a path attribute processing mode, which can be any of the following ones:<ul id="EN-US_TASK_0229407588__ul8357461570"><li id="EN-US_TASK_0229407588__li4357168712"><p id="EN-US_TASK_0229407588__p16357176170"><a name="EN-US_TASK_0229407588__li4357168712"></a><a name="li4357168712"></a>Discarding specified attributes</p>
</li><li id="EN-US_TASK_0229407588__li335796579"><p id="EN-US_TASK_0229407588__p173579615716"><a name="EN-US_TASK_0229407588__li335796579"></a><a name="li335796579"></a>Withdrawing the routes with specified attributes</p>
</li><li id="EN-US_TASK_0229407588__li63577614715"><p id="EN-US_TASK_0229407588__p18357561571"><a name="EN-US_TASK_0229407588__li63577614715"></a><a name="li63577614715"></a>Processing specified attributes as unknown attributes</p>
</li></ul>
</div>
<p id="EN-US_TASK_0229407588__p13276172704120">The <strong id="EN-US_TASK_0229407588__b19680190123618">treat-with-error</strong> parameter specifies a processing mode for incorrect path attributes. The mode can be as follows:</p>
<ul id="EN-US_TASK_0229407588__ul11473124810447"><li id="EN-US_TASK_0229407588__li12473748144418"><p id="EN-US_TASK_0229407588__p04730483447"><a name="EN-US_TASK_0229407588__li12473748144418"></a><a name="li12473748144418"></a>Accepting the path attributes with a value of 0.</p>
</li></ul>
</p></li></ol>
</li><li><span>(Optional) Configure the Layer 3 gateway as an RR on the IPv6 VXLAN. If an RR is configured, each VXLAN gateway only needs to <a href="#EN-US_TASK_0229407588__bgp_evpn_peer">establish a BGP EVPN peer relationship</a> with the RR. This simplifies configurations because fewer BGP EVPN peer relationships need to be established.</span><ol type="a"><li class="substepexpand"><span>Run <a href="cmdqueryname=peer+reflect-client+%28BGP-EVPN+address+family+view%29+%28IPv6%29"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv6-address</span></i> | <i><span class="varname">group-name</span></i> } <a href="cmdqueryname=reflect-client"><b><span class="cmdname">reflect-client</span></b></a></span><p><p>The device is configured as an RR, and RR clients are specified.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=peer+next-hop-invariable+%28BGP-EVPN+address+family+view%29+%28IPv6%29"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">group-name</span></i> | <i><span class="varname">ipv6-address</span></i> } <strong><span>next-hop-invariable</span></strong></span><p><p>The device is enabled to keep the next hop address of a route unchanged when advertising the route to an EBGP EVPN peer.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=undo+policy+vpn-target"><b><span class="cmdname">undo policy vpn-target</span></b></a></span><p><p>The device is disabled from filtering received EVPN routes based on VPN targets. If you do not perform this step, the RR will fail to receive and reflect the routes sent by clients.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Exit the BGP-EVPN address family view.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Exit the BGP view.</p>
</p></li></ol>
</li><li><span>Configure an EVPN instance.</span><ol type="a"><li class="substepexpand"><span>Run <a href="cmdqueryname=evpn+vpn-instance"><b><span class="cmdname">evpn vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i> <strong><span>bd-mode</span></strong></span><p><p>A BD EVPN instance is created, and its view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=route-distinguisher"><b><span class="cmdname">route-distinguisher</span></b></a> <i><span class="varname">route-distinguisher</span></i></span><p><p>An RD is configured for the EVPN instance.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=vpn-target"><b><span class="cmdname">vpn-target</span></b></a> <i><span class="varname">vpn-target</span></i> &amp;&lt;1-8&gt; [ <strong><span>both</span></strong> | <strong><span>export-extcommunity</span></strong> | <strong><span>import-extcommunity</span></strong> ]</span><p><p>VPN targets are configured for the EVPN instance. The import and export VPN targets of the local end must be the same as the export and import VPN targets of the remote end, respectively.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=import+route-policy"><b><span class="cmdname">import route-policy</span></b></a> <i><span class="varname">policy-name</span></i></span><p><p>The EVPN instance is associated with an import route-policy.</p>
</p><p><p>Perform this step to associate the EVPN instance with an import route-policy and set attributes for eligible routes. This enables you to control routes to be imported into the EVPN instance more precisely.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=export+route-policy"><b><span class="cmdname">export route-policy</span></b></a> <i><span class="varname">policy-name</span></i></span><p><p>The EVPN instance is associated with an export route-policy.</p>
</p><p><p>Perform this step to associate the EVPN instance with an export route-policy and set attributes for eligible routes. This enables you to control routes to be advertised more precisely.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=mac+limit"><b><span class="cmdname">mac limit</span></b></a> <i><span class="varname">number</span></i> { <strong><span>simply-alert</span></strong> | <strong><span>mac-unchanged</span></strong> }</span><p><p>The maximum number of MAC addresses allowed in the EVPN instance is set.</p>
</p><p><p>A device consumes more system resources as it learns more MAC addresses, meaning that the device may fail to operate when busy processing services. To limit the maximum number of MAC addresses allowed in an EVPN instance and thereby improving device security and reliability, run the <a href="cmdqueryname=mac+limit"><b><span class="cmdname">mac limit</span></b></a> command. After this configuration, if the number of MAC addresses exceeds the preset value, an alarm is triggered to prompt you to check the validity of existing MAC addresses.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=mac-route+no-advertise"><b><span class="cmdname">mac-route no-advertise</span></b></a></span><p><p>The device is disabled from sending local MAC routes with the current VNI to the EVPN peer.</p>
</p><p><p>In Layer 3 VXLAN gateway scenarios where Layer 2 traffic forwarding is not involved, perform this step to disable local MAC routes from being advertised to the EVPN peer. This configuration prevents the EVPN peer from receiving MAC routes, thereby conserving device resources.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=local+mac-only-route+no-generate"><b><span class="cmdname">local mac-only-route no-generate</span></b></a></span><p><p>The device is disabled from generating an EVPN MAC route when the local MAC address exists in both a MAC address entry and an ARP/ND entry.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=mac-ip+route+generate-mac"><b><span class="cmdname">mac-ip route generate-mac</span></b></a></span><p><p>The function to generate MAC address entries based on MAC/IP routes is enabled.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Exit the EVPN instance view.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bridge-domain"><b><span class="cmdname">bridge-domain</span></b></a> <i><span class="varname">bd-id</span></i></span><p><p>The BD view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=vxlan+vni"><b><span class="cmdname">vxlan vni</span></b></a> <i><span class="varname">vni-id</span></i> <strong><span>split-horizon-mode</span></strong></span><p><p>A VNI is created and associated with the BD, and split horizon is specified for packet forwarding.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=evpn+binding+vpn-instance"><b><span class="cmdname">evpn binding vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i><span> [ <strong><span>bd-tag</span></strong> <i><span class="varname">bd-tag</span></i> ]</span></span><p><p>A specified EVPN instance is bound to the BD. <span>By specifying different <i><span class="varname">bd-tag</span></i> values, you can bind multiple BDs to the same EVPN instance. In this way, VLAN services of different BDs can access the same EVPN instance while being isolated.</span></p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Return to the system view.</p>
</p></li></ol>
</li><li><span>Configure ingress replication.</span><ol type="a"><li class="substepexpand"><span>Run <a href="cmdqueryname=interface"><b><span class="cmdname">interface</span></b></a> <strong><span>nve</span></strong> <i><span class="varname">nve-number</span></i></span><p><p>An NVE interface is created, and its view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=source+%28NVE+interface+view%29+%28IPv6%29"><b><span class="cmdname">source</span></b></a> <i><span class="varname">ipv6-address</span></i></span><p><p>An IPv6 address is configured for the source VTEP.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=vni"><b><span class="cmdname">vni</span></b></a> <i><span class="varname">vni-id</span></i> <strong><span>head-end peer-list protocol bgp</span></strong></span><p><p>Ingress replication is configured.</p>
</p><p><p>With this function, the ingress of an IPv6 VXLAN tunnel replicates and sends a copy of any received BUM packets to each VTEP in the ingress replication list (a collection of remote VTEP IPv6 addresses).</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Return to the system view.</p>
</p></li></ol>
</li><li><span>(Optional) Enable the device to add its router ID (a private extended community attribute) to locally generated EVPN routes.</span><ol type="a"><li class="substepexpand"><span>Run <a href="cmdqueryname=evpn+%28system+view%29"><b><span class="cmdname">evpn</span></b></a></span><p><p>The global EVPN configuration view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=router-id-extend+private+enable"><b><span class="cmdname">router-id-extend private enable</span></b></a></span><p><p>The device is enabled to add its router ID to locally generated EVPN routes.</p>
</p><p><p>If both IPv4 and IPv6 VXLAN tunnels need to be established between two devices, one device's IP address is repeatedly added to the ingress replication list of the other device while the IPv4 and IPv6 VXLAN tunnels are being established. As a result, each device forwards two copies of BUM traffic to its peer, leading to duplicate traffic. To address this problem, run the <a href="cmdqueryname=router-id-extend+private+enable"><b><span class="cmdname">router-id-extend private enable</span></b></a> command on each device. This enables the device to add its router ID to EVPN routes. After receiving the EVPN routes, the peer device checks whether they carry the same router ID. If they do, the EVPN routes are from the same device. In this case, the peer device adds only the IP address of the device whose EVPN routes carry the IPv4 VXLAN tunnel identifier to the ingress replication list, thereby preventing duplicate traffic.</p>
</p></li></ol>
</li><li><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vxlan6_cfg_0001.html">Configuring IPv6 VXLAN in Centralized Gateway Mode Using BGP EVPN
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vxlan6_cfg_0002.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vxlan6_cfg_0004.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>