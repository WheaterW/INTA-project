
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Basic RSTP Functions">
<meta name="abstract" content="This example shows how to configure basic Rapid Spanning Tree Protocol (RSTP) functions.">
<meta name="description" content="This example shows how to configure basic Rapid Spanning Tree Protocol (RSTP) functions.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_stp_cfg_0032.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_stp_cfg_0033.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="wwx1238417">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="STP/RSTP">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="STP/RSTP">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="featurename" content="STP/RSTP">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="featurename" content="STP/RSTP">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="OWNER" content="c00648116,w00437000">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="wWX1238417">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172363571">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring Basic RSTP Functions</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172363571"></a><a name="EN-US_TASK_0172363571"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Basic RSTP Functions</h1>
<div class="taskbody"><p>This example shows how to configure basic Rapid Spanning Tree Protocol (RSTP) functions.</p>
<div class="context"><a name="EN-US_TASK_0172363571__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On a complex network, loops are inevitable. With the requirement for network redundancy backup, network designers tend to deploy multiple physical links between two devices, one of which is the master and the others are the backup. In such a situation, loops are prone to happen, potentially leading to broadcast storms and flapping MAC address entries on network devices.</p>
<p>RSTP can be deployed on a network to eliminate loops by blocking some ports, and it is developed to implement the rapid convergence based on STP but outperforms STP. On the network shown in <a href="#EN-US_TASK_0172363571__fig_dc_vrp_stp_cfg_0034_01">Figure 1</a>, after <span class="keyword">Device</span>A, <span class="keyword">Device</span>B, <span class="keyword">Device</span>C, and <span class="keyword">Device</span>D running RSTP discover loops on the network by exchanging information with each other, they trim the ring topology into a loop-free tree topology by blocking a certain port. In this manner, replication and circular propagation of packets are prevented on the network and the devices are released from processing duplicated packets, thereby improving their processing performance.</p>
<div class="fignone" id="EN-US_TASK_0172363571__fig_dc_vrp_stp_cfg_0034_01"><a name="EN-US_TASK_0172363571__fig_dc_vrp_stp_cfg_0034_01"></a><a name="fig_dc_vrp_stp_cfg_0034_01"></a><span class="figcap"><b>Figure 1 </b>Configuring basic RSTP functions</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interfaces 1 through 3 represent GE<span>0/1/1</span>, GE<span>0/1/2</span>, and GE<span>0/1/3</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_stp_cfg_0034_01.png" width="NaN" height="NaN"></span><br></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172363571__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><div class="p">The configuration roadmap is as follows:<ol><li><div class="p">Configure basic RSTP functions, including:<ol type="a"><li><p>Configure the RSTP mode for the ring network.</p>
</li><li><p>Configure primary and secondary root bridges.</p>
</li><li><p>Set path costs for ports in each MSTI to block certain ports.</p>
</li><li><div class="p">Enable RSTP to eliminate loops, including:<ul><li><p>Enable RSTP globally.</p>
</li><li><p>Enable RSTP on all the interfaces except the interfaces connected to terminals.</p>
</li></ul>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>RSTP is not required on the interfaces connected to terminals because these interfaces do not need to participate in RSTP calculation.</p>
<p>By default, RSTP is enabled on a Layer 2 interface.</p>
</div></div>
</div>
</li></ol>
</div>
</li><li><p>Configure RSTP protection functions, for example, root protection on a designated port of a root bridge in each MSTI.</p>
</li></ol>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172363571__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><div class="p">To complete the configuration, you need the following data.<ul><li><p>GE interface numbers, as shown in <a href="#EN-US_TASK_0172363571__fig_dc_vrp_stp_cfg_0034_01">Figure 1</a></p>
</li><li><p>Primary root bridge <span class="keyword">Device</span>A and secondary root bridge <span class="keyword">Device</span>D</p>
</li><li><p>Path cost of a port to be blocked (20000 is used in this example)</p>
</li></ul>
</div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172363571__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure basic RSTP functions.</span><p><ol type="a"><li><p>Configure the RSTP mode for the devices on the ring network.</p>
<p># Configure the RSTP mode on <span class="keyword">Device</span>A.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname <span class="keyword">Device</span>A</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>stp mode rstp</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
<p># Configure the RSTP mode on <span class="keyword">Device</span>B.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname <span class="keyword">Device</span>B</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>stp mode rstp</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>commit</strong></pre>
<p># Configure the RSTP mode on <span class="keyword">Device</span>C.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname <span class="keyword">Device</span>C</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C] <strong>stp mode rstp</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C] <strong>commit</strong></pre>
<p># Configure the RSTP mode on <span class="keyword">Device</span>D.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname <span class="keyword">Device</span>D</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D] <strong>stp mode rstp</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D] <strong>commit</strong></pre>
</li><li><p>Configure primary and secondary root bridges.</p>
<p># Configure <span class="keyword">Device</span>A as a primary root bridge.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>stp root primary</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
<p># Configure <span class="keyword">Device</span>D as a secondary root bridge.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>D] <strong>stp root secondary</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D] <strong>commit</strong></pre>
</li><li><p>Set path costs for ports in each spanning tree to block certain ports.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><ul><li><p>The values of path costs depend on path cost calculation methods. Use the Huawei proprietary calculation method as an example to set the path costs of the ports to be blocked to 20000.</p>
</li><li><p>All devices on a network must use the same path cost calculation method.</p>
</li></ul>
</div></div>
<p># On <span class="keyword">Device</span>A, configure the path cost calculation method as the Huawei proprietary method.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>stp pathcost-standard legacy</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
<p># On <span class="keyword">Device</span>B, configure the path cost calculation method as the Huawei proprietary method.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>stp pathcost-standard legacy</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>commit</strong></pre>
<p># On <span class="keyword">Device</span>C, configure the path cost calculation method as the Huawei proprietary method and set the path cost of GE <span>0/1/1</span> to 20000.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C] <strong>stp pathcost-standard legacy</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-GigabitEthernet<span>0/1/1</span>] <strong>stp cost 20000</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-GigabitEthernet<span>0/1/1</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<p># On <span class="keyword">Device</span>D, configure the path cost calculation method as the Huawei proprietary method.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>D] <strong>stp pathcost-standard legacy</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D] <strong>commit</strong></pre>
</li><li><p>Enable RSTP to eliminate loops.</p>
<ul><li><p>Disable RSTP on interfaces connected to PCs.</p>
<p># Disable RSTP on GE <span>0/1/2</span> on <span class="keyword">Device</span>B.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/2</span>] <strong>stp disable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/2</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<p># Disable RSTP on GE <span>0/1/2</span> on <span class="keyword">Device</span>C.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C] <strong>interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C-GigabitEthernet<span>0/1/2</span>] <strong>stp disable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-GigabitEthernet<span>0/1/2</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
</li><li><p>Enable RSTP globally.</p>
<p># Enable RSTP globally on <span class="keyword">Device</span>A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>stp enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
<p># Enable RSTP globally on <span class="keyword">Device</span>B.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>stp enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>commit</strong></pre>
<p># Enable RSTP globally on <span class="keyword">Device</span>C.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C] <strong>stp enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C] <strong>commit</strong></pre>
<p># Enable RSTP globally on <span class="keyword">Device</span>D.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>D] <strong>stp enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D] <strong>commit</strong></pre>
</li><li><p>Enable RSTP on all the interfaces except the interfaces connected to terminals.</p>
<p># Enable RSTP on GE <span>0/1/1</span> and GE <span>0/1/2</span> on <span class="keyword">Device</span>A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/1</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/1</span>] <strong>portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/1</span>] <strong>stp enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/2</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/2</span>] <strong>portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/2</span>] <strong>stp enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/2</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<p># Enable RSTP on GE <span>0/1/1</span> and GE <span>0/1/3</span> on <span class="keyword">Device</span>B.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/1</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/1</span>] <strong>portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/1</span>] <strong>stp enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>interface gigabitethernet <span>0/1/3</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/3</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/3</span>] <strong>portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/3</span>] <strong>stp enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/3</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/3</span>] <strong>quit</strong></pre>
<p># Enable RSTP on GE <span>0/1/1</span> and GE <span>0/1/3</span> on <span class="keyword">Device</span>C.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C-GigabitEthernet<span>0/1/1</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-GigabitEthernet<span>0/1/1</span>] <strong>portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-GigabitEthernet<span>0/1/1</span>] <strong>stp enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C] <strong>interface gigabitethernet <span>0/1/3</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-GigabitEthernet<span>0/1/3</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-GigabitEthernet<span>0/1/3</span>] <strong>portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-GigabitEthernet<span>0/1/3</span>] <strong>stp enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-GigabitEthernet<span>0/1/3</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C-GigabitEthernet<span>0/1/3</span>] <strong>quit</strong></pre>
<p># Enable RSTP on GE <span>0/1/1</span> and GE <span>0/1/2</span> on <span class="keyword">Device</span>D.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>D] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>D-GigabitEthernet<span>0/1/1</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-GigabitEthernet<span>0/1/1</span>] <strong>portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-GigabitEthernet<span>0/1/1</span>] <strong>stp enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D] <strong>interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-GigabitEthernet<span>0/1/2</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-GigabitEthernet<span>0/1/2</span>] <strong>portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-GigabitEthernet<span>0/1/2</span>] <strong>stp enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-GigabitEthernet<span>0/1/2</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>D-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
</li></ul>
</li></ol>
</p></li><li><span>Configure RSTP protection functions, for example, root protection on a designated port of a root bridge in each MSTI.</span><p><p># Enable root protection on GE <span>0/1/1</span> on <span class="keyword">Device</span>A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/1</span>] <strong>stp root-protection</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/1</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<p># Enable root protection on GE <span>0/1/2</span> on <span class="keyword">Device</span>A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/2</span>] <strong>stp root-protection</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/2</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p>After the previous configurations, run the following commands to verify the configuration when the network is stable:</p>
<p># Run the <a href="cmdqueryname=display+stp+brief"><b><span class="cmdname">display stp brief</span></b></a> command on <span class="keyword">Device</span>A to view the interface status and protection type. The displayed information is as follows:</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>display stp brief</strong>
 MSTID  Port                        Role  STP State     Protection
   0    GigabitEthernet<span>0/1/1</span>        <strong>DESI</strong>  FORWARDING    <strong>ROOT</strong>
   0    GigabitEthernet<span>0/1/2</span>        <strong>DESI</strong>  FORWARDING    <strong>ROOT</strong></pre>
<p>After <span class="keyword">Device</span>A is configured as a root bridge, GE <span>0/1/2</span> and GE <span>0/1/1</span> connected to <span class="keyword">Device</span>B and <span class="keyword">Device</span>D respectively are elected as designated ports in spanning tree calculation. The root protection function is enabled on the designated ports.</p>
<p># Run the <strong>display stp interface gigabitethernet <span>0/1/1</span> brief</strong> command on <span class="keyword">Device</span>B to view status of GE <span>0/1/1</span>. The displayed information is as follows:</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>display stp interface gigabitethernet <span>0/1/1</span> brief</strong>
 MSTID  Port                        Role  STP State     Protection
   0    GigabitEthernet<span>0/1/1</span>        <strong>DESI</strong>  FORWARDING    <strong>NONE</strong>      </pre>
<p>GE <span>0/1/1</span> is elected as a designated port in spanning tree calculation and is in the Forwarding state.</p>
<p># Run the <strong>display stp interface gigabitethernet <span>0/1/3</span> brief</strong> command on <span class="keyword">Device</span>C to view status of GE <span>0/1/3</span>. The displayed information is as follows:</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C] <strong>display stp interface gigabitethernet <span>0/1/3</span> brief</strong>
 MSTID  Port                        Role  STP State     Protection
   0    GigabitEthernet<span>0/1/3</span>        <strong>ROOT</strong>  FORWARDING    <strong>NONE</strong>      </pre>
<p>GE <span>0/1/3</span> is elected as a designated port in spanning tree calculation and is in the Forwarding state.</p>
<p># Run the <a href="cmdqueryname=display+stp"><b><span class="cmdname">display stp</span></b></a> command on <span class="keyword">Device</span>D to view detailed information about the interface status. The displayed information is as follows:</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>D] <strong>display stp</strong></pre>
<pre class="screen">-------[CIST Global Info][Mode <strong>RSTP</strong>]-------
CIST Bridge         :4096 .00e0-fc12-3456
Bridge Times        :Hello 2s MaxAge 20s FwDly 15s MaxHop 20
CIST Root/ERPC      :0    .00e0-fc12-3456 / 20000
CIST RegRoot/IRPC   :<strong>4096</strong> .00e0-fc12-3456 / 0
CIST RootPortId     :128.1
BPDU-Protection     :Disabled
CIST Root Type      :SECONDARY root
TC or TCN received  :4
TC count per hello  :0
STP Converge Mode   :Normal
Time since last TC :0 days 0h:5m:44s
----[Port1(GigabitEthernet<span>0/1/1</span>)][<strong>FORWARDING</strong>]----
 Port Protocol       :enabled
 Port Role           :<strong>Root Port</strong>
 Port Priority       :128
 Port Cost(Dot1T )   :Config=auto / Active=20000
 Desg. Bridge/Port   :0.00e0-fc12-3456 / 128.1
 Port Edged          :Config=default / Active=disabled
 Point-to-point      :Config=auto / Active=true
 Transit Limit       :147 packets/hello-time
 Protection Type     :None
 Port Stp Mode       :<strong>RSTP</strong>
 Port Protocol Type  :Config=auto / Active=dot1s
 BPDU Encapsulation  :Config=stp / Active=stp
 PortTimes           :Hello 2s MaxAge 20s FwDly 15s RemHop 0
 TC or TCN send  :4
 TC or TCN received  :2
 BPDU Sent           :5
          TCN: 0, Config: 0, RST: 5, MST: 0
 BPDU Received       :177
          TCN: 0, Config: 0, RST: 177, MST: 0
----[Port2(GigabitEthernet<span>0/1/2</span>)][FORWARDING]----
 Port Protocol       :enabled
 Port Role           :<strong>Designated Port</strong>
 Port Priority       :128
 Port Cost(Dot1T )   :Config=auto / Active=<strong>20000</strong>
 Desg. Bridge/Port   :4096.00e0-fc12-3456 / 128.2
 Port Edged          :Config=default / Active=disabled
 Point-to-point      :Config=auto / Active=true
 Transit Limit       :147 packets/hello-time
 Protection Type     :None
 Port Stp Mode       :RSTP
 Port Protocol Type  :Config=auto / Active=dot1s
 BPDU Encapsulation  :Config=stp / Active=stp
 PortTimes           :Hello 2s MaxAge 20s FwDly 15s RemHop 20
 TC or TCN send  :2
 TC or TCN received  :2
 BPDU Sent           :165
          TCN: 0, Config: 0, RST: 165, MST: 0
 BPDU Received       :2
          TCN: 0, Config: 0, RST: 2, MST: 0</pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172363571__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>Configuration file of <span class="keyword">Device</span>A</p>
<pre class="screen">#
 sysname <span class="keyword">Device</span>A                                                                
#                                                                               
 stp mode rstp                                                                  
 stp instance 0 root primary                                                    
 stp pathcost-standard legacy                                                   
 stp enable                                                                     
#                                                                               
interface GigabitEthernet<span>0/1/1</span>                                                  
 portswitch
 undo shutdown
 stp root-protection                                                            
#                                                                               
interface GigabitEthernet<span>0/1/2</span>                                                  
 portswitch
 undo shutdown
 stp root-protection                                                            
#
return</pre>
</li><li><p>Configuration file of <span class="keyword">Device</span>B</p>
<pre class="screen">#                                                                               
 sysname <span class="keyword">Device</span>B                                                                
#                                                                               
 stp mode rstp                                                                  
 stp pathcost-standard legacy                                                   
 stp enable                                                                     
#                                                                               
interface GigabitEthernet<span>0/1/1</span>                                                  
 portswitch
 undo shutdown
 stp enable                                                            
#                                                                               
interface GigabitEthernet<span>0/1/2</span>                                                  
 stp disable                                                                    
#                                                                               
interface GigabitEthernet<span>0/1/3</span>                                                  
 portswitch
 undo shutdown
 stp enable                                                            
#                                                                               
return                    </pre>
</li><li><p>Configuration file of <span class="keyword">Device</span>C</p>
<pre class="screen">#                                                                               
 sysname <span class="keyword">Device</span>C                                                                
#                                                                               
 stp mode rstp                                                                  
 stp pathcost-standard legacy                                                   
 stp enable                                                                     
#                                                                               
interface GigabitEthernet<span>0/1/1</span>                                                  
 stp instance 0 cost 20000                                                      
 portswitch
 undo shutdown
 stp enable                                                            
#                                                                               
interface GigabitEthernet<span>0/1/2</span>                                                  
 stp disable                                                                    
#                                                                               
interface GigabitEthernet<span>0/1/3</span>                                                  
 portswitch
 undo shutdown
 stp enable                                                            
#                                                                               
return           
</pre>
</li><li><p>Configuration file of <span class="keyword">Device</span>D</p>
<pre class="screen">#                                                                               
 sysname <span class="keyword">Device</span>D                                                                
#                                                                               
 stp mode rstp                                                                  
 stp instance 0 root secondary                                                  
 stp pathcost-standard legacy                                                   
 stp enable                                                                     
#                                                                               
interface GigabitEthernet<span>0/1/1</span>                                                  
 undo shutdown
 portswitch
 stp enable                                                                     
#                                                                               
interface GigabitEthernet<span>0/1/2</span>                                                  
 undo shutdown
 portswitch
 stp enable                                                                     
#                                                                               
return                        
</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_stp_cfg_0032.html">Configuration Examples for STP/RSTP
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_stp_cfg_0033.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>
</body>
</html>