
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring VXLAN in Centralized Gateway Mode Using BGP EVPN">
<meta name="abstract" content="This section provides an example for configuring VXLAN in centralized gateway mode for dynamic tunnel establishment so that users on the same subnet or different subnets can communicate.">
<meta name="description" content="This section provides an example for configuring VXLAN in centralized gateway mode for dynamic tunnel establishment so that users on the same subnet or different subnets can communicate.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vxlan_cfg_1015.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vxlan_cfg_1026.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vxlan_cfg_1300.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="h00847023">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="OWNER" content="p00915595">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="p00915595">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172363833">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring VXLAN in Centralized Gateway Mode Using BGP EVPN</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172363833"></a><a name="EN-US_TASK_0172363833"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring VXLAN in Centralized Gateway Mode Using BGP EVPN</h1>
<div class="taskbody"><p>This section provides an example for configuring VXLAN in centralized gateway mode for dynamic tunnel establishment so that users on the same subnet or different subnets can communicate.</p>
<div class="context"><a name="EN-US_TASK_0172363833__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0172363833__fig_dc_vrp_vxlan_cfg_105901">Figure 1</a>, an enterprise has VMs deployed in different areas of a DC. VM1 on Server1 belongs to VLAN 10, VM1 on Server2 belongs to VLAN 20, and VM1 on Server3 belongs to VLAN 30. Server1 and Server2 reside on different subnets, whereas Server2 and Server3 reside on the same subnet. To allow VM1s on different servers to communicate with each other, configure IPv6 VXLAN in centralized gateway mode.</p>
<div class="fignone" id="EN-US_TASK_0172363833__fig_dc_vrp_vxlan_cfg_105901"><a name="EN-US_TASK_0172363833__fig_dc_vrp_vxlan_cfg_105901"></a><a name="fig_dc_vrp_vxlan_cfg_105901"></a><span class="figcap"><b>Figure 1 </b>Network diagram of configuring users on different subnets to communicate through a Layer 3 VXLAN gateway</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interfaces 1 through 3 represent GigabitEthernet<span>0/1/1</span>, GigabitEthernet<span>0/1/2</span>, and GigabitEthernet<span>0/1/3</span>, respectively.</p>
</div></div>
<p><span><img class="vsd" src="images/fig_dc_vrp_vxlan_cfg_105901.png"></span></p>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172363833__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><div class="p">The configuration roadmap is as follows:<ol><li><p>Configure a routing protocol on Device 1, Device 2, and Device 3 to allow them to communicate at Layer 3.</p>
</li><li><p>Configure a service access point on Device 1 and Device 3 to differentiate service traffic.</p>
</li><li><p>Configure a BGP EVPN peer relationship.</p>
</li><li><p>Configure EVPN instances.</p>
</li><li><p>Configure ingress replication.</p>
</li><li><p>Configure Device 2 as a Layer 3 VXLAN gateway.</p>
</li></ol>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172363833__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data.</p>
<ul><li><p>VMs' VLAN IDs (10, 20, and 30)</p>
</li><li><p>IP addresses of interfaces connecting devices</p>
</li><li><p>Interior Gateway Protocol (IGP) running between devices (OSPF in this example)</p>
</li><li>BD IDs (10 and 20)</li><li>VNI IDs (5010 and 5020)</li><li>EVPN instances' RDs (11:1, 12:1, 21:1, 23:1, and 31:2) and RTs (1:1 and 2:2)</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172363833__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure a routing protocol.</span><p><p>Assign an IP address to each interface on Device1, Device2, and Device3 according to <a href="#EN-US_TASK_0172363833__fig_dc_vrp_vxlan_cfg_105901">Figure 1</a>.</p>
<div class="p"># Configure Device 1.<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname Device1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Device1]<strong> interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Device1-LoopBack1]<strong> ip address 2.2.2.2 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Device1-LoopBack1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Device1]<strong> interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>Device1-GigabitEthernet<span>0/1/1</span>]<strong> ip address 192.168.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Device1-GigabitEthernet<span>0/1/1</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Device1]<strong> ospf</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Device1-ospf-1]<strong> area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Device1-ospf-1-area-0.0.0.0]<strong> network 2.2.2.2 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Device1-ospf-1-area-0.0.0.0]<strong> network 192.168.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Device1-ospf-1-area-0.0.0.0]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Device1-ospf-1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Device1]<strong> commit</strong></pre>
</div>
<p>The configurations of Device 2 and Device 3 are similar to that of Device 1. For detailed configurations, see <a href="#EN-US_TASK_0172363833__section_dc_vrp_vxlan_cfg_105901">Configuration Files</a>.</p>
<div class="p">After OSPF is configured, the devices can use OSPF to learn the IP addresses of each other's loopback interfaces and successfully ping each other. The following example shows the command output on Device 1 after it pings Device 3:<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Device1] <strong>ping 4.4.4.4</strong></pre>
<pre class="screen">  PING 4.4.4.4: 56  data bytes, press CTRL_C to break
    Reply from 4.4.4.4: bytes=56 Sequence=1 ttl=254 time=5 ms
    Reply from 4.4.4.4: bytes=56 Sequence=2 ttl=254 time=2 ms
    Reply from 4.4.4.4: bytes=56 Sequence=3 ttl=254 time=2 ms
    Reply from 4.4.4.4: bytes=56 Sequence=4 ttl=254 time=3 ms
    Reply from 4.4.4.4: bytes=56 Sequence=5 ttl=254 time=3 ms

  --- 4.4.4.4 ping statistics ---
    5 packet(s) transmitted
    5 packet(s) received
    0.00% packet loss
    round-trip min/avg/max = 2/3/5 ms</pre>
</div>
</p></li><li><span>Configure a service access point on Device 1 and Device 3.</span><p><div class="p"># Configure Device 1.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Device1] <strong>bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Device1-bd10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Device1] <strong>interface gigabitethernet<span>0/1/2</span>.1 mode l2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Device1-GigabitEthernet<span>0/1/2</span>.1] <strong>encapsulation dot1q vid 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Device1-GigabitEthernet<span>0/1/2</span>.1] <strong>rewrite pop single</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Device1-GigabitEthernet<span>0/1/2</span>.1] <strong>bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Device1-GigabitEthernet<span>0/1/2</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Device1] <strong>bridge-domain 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Device1-bd20] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Device1] <strong>interface gigabitethernet<span>0/1/3</span>.1 mode l2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Device1-GigabitEthernet<span>0/1/3</span>.1] <strong>encapsulation dot1q vid 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Device1-GigabitEthernet<span>0/1/3</span>.1] <strong>rewrite pop single</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Device1-GigabitEthernet<span>0/1/3</span>.1] <strong>bridge-domain 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Device1-GigabitEthernet<span>0/1/3</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Device1] <strong>commit</strong></pre>
</div>
<p>The configuration of Device 3 is similar to that of Device 1. For detailed configurations, see <a href="#EN-US_TASK_0172363833__section_dc_vrp_vxlan_cfg_105901">Configuration Files</a>.</p>
</p></li><li><span>Configure a BGP EVPN peer relationship.</span><p><p># Configure Device 1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Device1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Device1-bgp] <strong>peer 3.3.3.3 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Device1-bgp] <strong>peer 3.3.3.3 connect-interface LoopBack1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Device1-bgp] <strong>peer 4.4.4.4 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Device1-bgp] <strong>peer 4.4.4.4 connect-interface LoopBack1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Device1-bgp] <strong>l2vpn-family evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Device1-bgp-af-evpn] <strong>peer 3.3.3.3 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Device1-bgp-af-evpn] <strong>peer 3.3.3.3 advertise encap-type vxlan</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Device1-bgp-af-evpn] <strong>peer 4.4.4.4 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Device1-bgp-af-evpn] <strong>peer 4.4.4.4 advertise encap-type vxlan</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Device1-bgp-af-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Device1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Device1] <strong>commit</strong></pre>
<p>The configurations of Device 2 and Device 3 are similar to that of Device 1. For detailed configurations, see <a href="#EN-US_TASK_0172363833__section_dc_vrp_vxlan_cfg_105901">Configuration Files</a>.</p>
</p></li><li><span>Configure an EVPN instance on Device 1, Device 2, and Device 3.</span><p><div class="p"># Configure Device 1.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Device1] <strong>evpn vpn-instance evrf3 bd-mode</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Device1-evpn-instance-evrf3] <strong>route-distinguisher 11:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Device1-evpn-instance-evrf3] <strong>vpn-target 1:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Device1-evpn-instance-evrf3] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Device1] <strong>bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Device1-bd10] <strong>vxlan vni 5010 split-horizon-mode</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Device1-bd10] <strong>evpn binding vpn-instance evrf3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Device1-bd10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Device1] <strong>evpn vpn-instance evrf4 bd-mode</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Device1-evpn-instance-evrf4] <strong>route-distinguisher 12:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Device1-evpn-instance-evrf4] <strong>vpn-target 2:2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Device1-evpn-instance-evrf4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Device1] <strong>bridge-domain 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Device1-bd20] <strong>vxlan vni 5020 split-horizon-mode</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Device1-bd20] <strong>evpn binding vpn-instance evrf4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Device1-bd20] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Device1] <strong>commit</strong></pre>
</div>
<p>The configurations of Device 2 and Device 3 are similar to that of Device 1. For detailed configurations, see <a href="#EN-US_TASK_0172363833__section_dc_vrp_vxlan_cfg_105901">Configuration Files</a>.</p>
</p></li><li><span>Configure an ingress replication list.</span><p><div class="p"># Configure Device 1.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Device1] <strong>interface nve 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Device1-Nve1] <strong>source 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Device1-Nve1] <strong>vni 5010 head-end peer-list protocol bgp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Device1-Nve1] <strong>vni 5020 head-end peer-list protocol bgp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Device1-Nve1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Device1] <strong>commit</strong></pre>
</div>
<p>The configuration of Device 3 is similar to that of Device 1. For detailed configurations, see <a href="#EN-US_TASK_0172363833__section_dc_vrp_vxlan_cfg_105901">Configuration Files</a>.</p>
</p></li><li><span>Configure Device 2 as a Layer 3 VXLAN gateway.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Device2] <strong>interface vbdif 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Device2-Vbdif10] <strong>ip address 192.168.10.10 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Device2-Vbdif10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Device2] <strong>interface vbdif 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Device2-Vbdif20] <strong>ip address 192.168.20.10 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Device2-Vbdif20] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Device2-Vbdif20] <strong>commit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p>After completing the configurations, run the <a href="cmdqueryname=display+vxlan+tunnel"><b><span class="cmdname">display vxlan tunnel</span></b></a> and <a href="cmdqueryname=display+vxlan+vni"><b><span class="cmdname">display vxlan vni</span></b></a> commands on Device 1, Device 2, and Device 3 to check the VXLAN tunnel and VNI information, respectively. The VNIs are Up. The following example shows the command output on Device 1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Device1] <strong>display vxlan tunnel</strong></pre>
<pre class="screen">Number of vxlan tunnel : 2
Tunnel ID   Source           Destination      State  Type     Uptime
-------------------------------------------------------------------
4026531843  2.2.2.2          4.4.4.4          up     dynamic  0035h21m
4026531844  2.2.2.2          3.3.3.3          up     dynamic  0036h10m</pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Device1] <strong>display vxlan vni</strong></pre>
<pre class="screen">Number of vxlan vni : 2
VNI            BD-ID            State
---------------------------------------
5010           10               up
5020           20               up</pre>
<p>Run the <a href="cmdqueryname=display+bgp+evpn+all+routing-table"><b><span class="cmdname">display bgp evpn all routing-table</span></b></a> command to check EVPN route information.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Device1] <strong>display bgp evpn all routing-table</strong></pre>
<pre class="screen"> Local AS number : 100

 BGP Local router ID is 2.2.2.2
 Status codes: * - valid, &gt; - best, d - damped, x - best external, a - add path,
               h - history,  i - internal, s - suppressed, S - Stale
               Origin : i - IGP, e - EGP, ? - incomplete


 EVPN address family:
 Number of Mac Routes: 5
 Route Distinguisher: 11:1
       Network(EthTagId/MacAddrLen/MacAddr/IpAddrLen/IpAddr)  NextHop
 *&gt;    0:48:fc73-fb8c-7ef6:0:0.0.0.0                          0.0.0.0                                      
 Route Distinguisher: 12:1
       Network(EthTagId/MacAddrLen/MacAddr/IpAddrLen/IpAddr)  NextHop
 *&gt;    0:48:c4b8-b4aa-a9e3:0:0.0.0.0                          0.0.0.0                                      
 Route Distinguisher: 21:1
       Network(EthTagId/MacAddrLen/MacAddr/IpAddrLen/IpAddr)  NextHop
 *&gt;i   0:48:cc89-5e8f-5541:0:0.0.0.0                          3.3.3.3                                      
 Route Distinguisher: 23:1
       Network(EthTagId/MacAddrLen/MacAddr/IpAddrLen/IpAddr)  NextHop
 *&gt;i   0:48:cc89-5e8f-5541:0:0.0.0.0                          3.3.3.3                                      
 Route Distinguisher: 31:2
       Network(EthTagId/MacAddrLen/MacAddr/IpAddrLen/IpAddr)  NextHop
 *&gt;i   0:48:2019-1219-0226:0:0.0.0.0                          4.4.4.4                                      


 EVPN-Instance evrf3:
 Number of Mac Routes: 2
       Network(EthTagId/MacAddrLen/MacAddr/IpAddrLen/IpAddr)  NextHop
 *&gt;i   0:48:cc89-5e8f-5541:0:0.0.0.0                          3.3.3.3                                      
 *&gt;    0:48:fc73-fb8c-7ef6:0:0.0.0.0                          0.0.0.0                                      


 EVPN-Instance evrf4:
 Number of Mac Routes: 3
       Network(EthTagId/MacAddrLen/MacAddr/IpAddrLen/IpAddr)  NextHop
 *&gt;i   0:48:2019-1219-0226:0:0.0.0.0                          4.4.4.4                                      
 *&gt;    0:48:c4b8-b4aa-a9e3:0:0.0.0.0                          0.0.0.0                                      
 *&gt;i   0:48:cc89-5e8f-5541:0:0.0.0.0                          3.3.3.3                                      

 EVPN address family:
 Number of Inclusive Multicast Routes: 5
 Route Distinguisher: 11:1
       Network(EthTagId/IpAddrLen/OriginalIp)                 NextHop
 *&gt;    0:32:2.2.2.2                                           0.0.0.0
 Route Distinguisher: 12:1
       Network(EthTagId/IpAddrLen/OriginalIp)                 NextHop
 *&gt;    0:32:2.2.2.2                                           0.0.0.0
 Route Distinguisher: 21:1
       Network(EthTagId/IpAddrLen/OriginalIp)                 NextHop
 *&gt;i   0:32:3.3.3.3                                           3.3.3.3
 Route Distinguisher: 23:1
       Network(EthTagId/IpAddrLen/OriginalIp)                 NextHop
 *&gt;i   0:32:3.3.3.3                                           3.3.3.3
 Route Distinguisher: 31:2
       Network(EthTagId/IpAddrLen/OriginalIp)                 NextHop
 *&gt;i   0:32:4.4.4.4                                           4.4.4.4


 EVPN-Instance evrf3:
 Number of Inclusive Multicast Routes: 2
       Network(EthTagId/IpAddrLen/OriginalIp)                 NextHop
 *&gt;    0:32:2.2.2.2                                           0.0.0.0                                      
 *&gt;i   0:32:3.3.3.3                                           3.3.3.3                                      


 EVPN-Instance evrf4:
 Number of Inclusive Multicast Routes: 3
       Network(EthTagId/IpAddrLen/OriginalIp)                 NextHop
 *&gt;    0:32:2.2.2.2                                           0.0.0.0                                      
 *&gt;i   0:32:3.3.3.3                                           3.3.3.3                                      
 *&gt;i   0:32:4.4.4.4                                           4.4.4.4</pre>
<p>VM1s on different servers can communicate. For example, you can ping VM1 of Server 1 on the Layer 3 gateway Device 2.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>Device2] <strong>ping 192.168.10.1</strong>
  PING 192.168.10.1: 56  data bytes, press CTRL_C to break
    Reply from 192.168.10.1: bytes=56 Sequence=1 ttl=254 time=15 ms
    Reply from 192.168.10.1: bytes=56 Sequence=2 ttl=254 time=5 ms
    Reply from 192.168.10.1: bytes=56 Sequence=3 ttl=254 time=5 ms
    Reply from 192.168.10.1: bytes=56 Sequence=4 ttl=254 time=10 ms
    Reply from 192.168.10.1: bytes=56 Sequence=5 ttl=254 time=10 ms

  --- 192.168.10.1 ping statistics ---
    5 packet(s) transmitted
    5 packet(s) received
    0.00% packet loss
    round-trip min/avg/max = 5/10/15 ms</pre>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0172363833__section_dc_vrp_vxlan_cfg_105901"><a name="EN-US_TASK_0172363833__section_dc_vrp_vxlan_cfg_105901"></a><a name="section_dc_vrp_vxlan_cfg_105901"></a><a name="EN-US_TASK_0172363833__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>Device 1 configuration file</p>
<pre class="screen">#
sysname Device1
#
evpn vpn-instance evrf3 bd-mode
 route-distinguisher 11:1
 vpn-target 1:1 export-extcommunity
 vpn-target 1:1 import-extcommunity
#
bridge-domain 10
 vxlan vni 5010 split-horizon-mode
 evpn binding vpn-instance evrf3
#
evpn vpn-instance evrf4 bd-mode
 route-distinguisher 12:1
 vpn-target 2:2 export-extcommunity
 vpn-target 2:2 import-extcommunity
#
bridge-domain 20
 vxlan vni 5020 split-horizon-mode
 evpn binding vpn-instance evrf4
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 192.168.1.1 255.255.255.0
#
interface GigabitEthernet<span>0/1/2</span>.1 mode l2
 encapsulation dot1q vid 10
 rewrite pop single
 bridge-domain 10
#
interface GigabitEthernet<span>0/1/3</span>.1 mode l2
 encapsulation dot1q vid 30
 rewrite pop single
 bridge-domain 20
#
interface LoopBack1
 ip address 2.2.2.2 255.255.255.255
#
interface Nve1
 source 2.2.2.2
 vni 5010 head-end peer-list protocol bgp
 vni 5020 head-end peer-list protocol bgp
#
bgp 100
 peer 3.3.3.3 as-number 100
 peer 3.3.3.3 connect-interface LoopBack1
 peer 4.4.4.4 as-number 100
 peer 4.4.4.4 connect-interface LoopBack1
 #
 ipv4-family unicast
  peer 3.3.3.3 enable
  peer 4.4.4.4 enable
 #
 l2vpn-family evpn
  undo policy vpn-target
  peer 3.3.3.3 enable
  peer 3.3.3.3 advertise encap-type vxlan
  peer 4.4.4.4 enable
  peer 4.4.4.4 advertise encap-type vxlan
#
ospf 1
 area 0.0.0.0
  network 2.2.2.2 0.0.0.0
  network 192.168.1.0 0.0.0.255
#
return</pre>
</li><li><p>Device 2 configuration file</p>
<pre class="screen">#
sysname Device2
#
evpn vpn-instance evrf3 bd-mode
 route-distinguisher 21:1
 vpn-target 1:1 export-extcommunity
 vpn-target 1:1 import-extcommunity
#
bridge-domain 10
 vxlan vni 5010 split-horizon-mode
 evpn binding vpn-instance evrf3
#
evpn vpn-instance evrf4 bd-mode
 route-distinguisher 23:1
 vpn-target 2:2 export-extcommunity
 vpn-target 2:2 import-extcommunity
#
bridge-domain 20
 vxlan vni 5020 split-horizon-mode
 evpn binding vpn-instance evrf4
#
interface Vbdif10
 ip address 192.168.10.10 255.255.255.0
#
interface Vbdif20
 ip address 192.168.20.10 255.255.255.0
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 192.168.1.2 255.255.255.0
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ip address 192.168.2.1 255.255.255.0
#
interface LoopBack1
 ip address 3.3.3.3 255.255.255.255
#
interface Nve1
 source 3.3.3.3
 vni 5010 head-end peer-list protocol bgp
 vni 5020 head-end peer-list protocol bgp
#
bgp 100
 peer 2.2.2.2 as-number 100
 peer 2.2.2.2 connect-interface LoopBack1
 peer 4.4.4.4 as-number 100
 peer 4.4.4.4 connect-interface LoopBack1
 #
 ipv4-family unicast
  peer 2.2.2.2 enable
  peer 4.4.4.4 enable
 #
 l2vpn-family evpn
  peer 2.2.2.2 enable
  peer 2.2.2.2 advertise encap-type vxlan
  peer 4.4.4.4 enable
  peer 4.4.4.4 advertise encap-type vxlan
#
ospf 1
 area 0.0.0.0
  network 3.3.3.3 0.0.0.0
  network 192.168.1.0 0.0.0.255
  network 192.168.2.0 0.0.0.255
#
return</pre>
</li><li><p>Device 3 configuration file</p>
<pre class="screen">#
sysname Device3
#
evpn vpn-instance evrf4 bd-mode
 route-distinguisher 31:2
 vpn-target 2:2 export-extcommunity
 vpn-target 2:2 import-extcommunity 
#
bridge-domain 20
 vxlan vni 5020 split-horizon-mode
 evpn binding vpn-instance evrf4
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 192.168.2.2 255.255.255.0
#
interface GigabitEthernet<span>0/1/2</span>.1 mode l2
 encapsulation dot1q vid 20
 rewrite pop single
 bridge-domain 20
#
interface LoopBack1
 ip address 4.4.4.4 255.255.255.255
#
interface Nve1
 source 4.4.4.4
 vni 5020 head-end peer-list protocol bgp
#
bgp 100
 peer 2.2.2.2 as-number 100
 peer 2.2.2.2 connect-interface LoopBack1
 peer 3.3.3.3 as-number 100
 peer 3.3.3.3 connect-interface LoopBack1
 #
 ipv4-family unicast
  peer 2.2.2.2 enable
  peer 3.3.3.3 enable
 #
 l2vpn-family evpn
  undo policy vpn-target
  peer 2.2.2.2 enable
  peer 2.2.2.2 advertise encap-type vxlan
  peer 3.3.3.3 enable
  peer 3.3.3.3 advertise encap-type vxlan
#
ospf 1
 area 0.0.0.0
  network 4.4.4.4 0.0.0.0
  network 192.168.2.0 0.0.0.255
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vxlan_cfg_1015.html">Configuration Examples for VXLAN
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vxlan_cfg_1026.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vxlan_cfg_1300.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>