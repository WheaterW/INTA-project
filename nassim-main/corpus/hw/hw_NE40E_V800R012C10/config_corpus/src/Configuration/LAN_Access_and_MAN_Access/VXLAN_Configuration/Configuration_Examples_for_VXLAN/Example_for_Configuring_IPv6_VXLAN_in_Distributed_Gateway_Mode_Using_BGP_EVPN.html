
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring IPv6 VXLAN in Distributed Gateway Mode Using BGP EVPN">
<meta name="abstract" content="This section provides an example for deploying IPv6 VXLAN in distributed gateway mode using BGP EVPN.">
<meta name="description" content="This section provides an example for deploying IPv6 VXLAN in distributed gateway mode using BGP EVPN.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vxlan_cfg_1015.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vxlan_cfg_1300.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vxlan_cfg_1223.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="h00847023">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="OWNER" content="p00915595">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="p00915595">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0240585735">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>Example for Configuring IPv6 VXLAN in Distributed Gateway Mode Using BGP EVPN</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0240585735"></a><a name="EN-US_TASK_0240585735"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring IPv6 VXLAN in Distributed Gateway Mode Using BGP EVPN</h1>
<div class="taskbody"><p>This section provides an example for deploying IPv6 VXLAN in distributed gateway mode using BGP EVPN.</p>
<div class="context"><a name="EN-US_TASK_0240585735__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>In IPv6 VXLAN, distributed gateways can be configured to address problems that occur in centralized gateway networking. Such problems include sub-optimal forwarding paths and bottlenecks on Layer 3 gateways in terms of ARP or ND entry specifications.</p>
<p>On the network shown in <a href="#EN-US_TASK_0240585735__fig738758184115">Figure 1</a>, an enterprise deploys IPv4 VMs in different areas of an IPv6 DC. On Server1, IPv4 VM1 belongs to VLAN 10, and IPv4 VM2 belongs to VLAN 20. Similarly, on Server2, IPv4 VM1 belongs to VLAN 10, and IPv4 VM2 belongs to VLAN 20. The gateways for VLAN 10 and VLAN 20 are located on different subnets. IPv6 VXLAN in distributed gateway mode is required for communication between IPv4 VMs on different servers.</p>
<div class="fignone" id="EN-US_TASK_0240585735__fig738758184115"><a name="EN-US_TASK_0240585735__fig738758184115"></a><a name="fig738758184115"></a><span class="figcap"><b>Figure 1 </b>Network diagram of configuring IPv6 VXLAN in distributed gateway mode</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface1 and interface2 represent GigabitEthernet<span>0/1/0</span> and GigabitEthernet<span>0/1/1</span>, respectively.</p>
</div></div>
<p><span><img class="vsd" src="images/fig_dc_vrp_vxlan_cfg_106101.png"></span></p>
</div>

<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" frame="border" border="1" rules="all"><caption><b>Table 1 </b>Interface IP addresses and masks</caption><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="33.223322332233224%" id="mcps1.4.1.5.2.4.1.1" liSelected="liSelected"><p>Device</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="33.55335533553355%" id="mcps1.4.1.5.2.4.1.2" liSelected="liSelected"><p>Interface</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="33.223322332233224%" id="mcps1.4.1.5.2.4.1.3" liSelected="liSelected"><p>IP Address and Mask</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" rowspan="3" valign="middle" width="33.223322332233224%" headers="mcps1.4.1.5.2.4.1.1 "><p>Device1</p>
</td>
<td class="cellrowborder" valign="top" width="33.55335533553355%" headers="mcps1.4.1.5.2.4.1.2 "><p>GigabitEthernet<span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" width="33.223322332233224%" headers="mcps1.4.1.5.2.4.1.3 "><p>2001:DB8:3::2/64</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.2 "><p>GigabitEthernet<span>0/1/1</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.3 "><p>2001:DB8:2::2/64</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.2 "><p>LoopBack0</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.3 "><p>2001:DB8:11::1/128</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="2" valign="middle" width="33.223322332233224%" headers="mcps1.4.1.5.2.4.1.1 "><p>Device2</p>
</td>
<td class="cellrowborder" valign="top" width="33.55335533553355%" headers="mcps1.4.1.5.2.4.1.2 "><p>GigabitEthernet<span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" width="33.223322332233224%" headers="mcps1.4.1.5.2.4.1.3 "><p>2001:DB8:2::1/64</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.2 "><p>LoopBack0</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.3 "><p>2001:DB8:22::2/128</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="2" valign="middle" width="33.223322332233224%" headers="mcps1.4.1.5.2.4.1.1 "><p>Device3</p>
</td>
<td class="cellrowborder" valign="top" width="33.55335533553355%" headers="mcps1.4.1.5.2.4.1.2 "><p>GigabitEthernet<span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" width="33.223322332233224%" headers="mcps1.4.1.5.2.4.1.3 "><p>2001:DB8:3::1/64</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.2 "><p>LoopBack0</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.3 "><p>2001:DB8:33::3/128</p>
</td>
</tr>
</tbody>
</table>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0240585735__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><div class="p">The configuration roadmap is as follows:<ol><li>Configure OSPFv3 to run between Device1 and Device2 and between Device1 and Device3.</li><li>Configure a service access point on Device2 and Device3 to differentiate service traffic.</li><li>Configure Device2 and Device3 to establish BGP EVPN peer relationships with Device1.</li><li>Configure Device1 to establish BGP EVPN peer relationships with Device2 and Device3. Then, configure Device1 as the RR.</li><li>Configure a VPN instance and an EVPN instance on Device2 and Device3.</li><li>Enable ingress replication on Device2 and Device3.</li><li>Configure an IPv6 VXLAN Layer 3 gateway on Device2 and Device3, and configure an IPv4 address for the gateway interface.</li><li>Configure BGP to advertise IRB routes between Device1 and Device2 and between Device1 and Device3.</li></ol>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0240585735__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li>Router IDs of Device1, Device2, and Device3 used by OSPFv3 (1.1.1.1, 2.2.2.2, and 3.3.3.3)</li><li>VM1 VLAN IDs (10 and 20)</li><li>IPv6 addresses of interconnection interfaces between network devices and IPv4 address of the VBDIF interface that functions as the Layer 3 gateway interface</li><li>BD IDs (10 and 20)</li><li>IPv6 VNI IDs (10 and 20)</li><li>VNI ID in the VPN instance (100)</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0240585735__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Assign an IPv6 address for each interface.</span><p><p>Assign an IPv6 address to each interface on Device1, Device2, and Device3 according to <a href="#EN-US_TASK_0240585735__fig738758184115">Figure 1</a>. For detailed configurations, see <a href="#EN-US_TASK_0240585735__section_dc_vrp_vxlan_cfg_106101">Configuration Files</a>.</p>
</p></li><li><span>Configure OSPFv3.</span><p><p># Configure <span class="keyword">Device</span>1.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname Device1</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Device1] <strong>ospfv3 1</strong>
[<span class="keyword">*</span>Device1-ospfv3-1] <strong>router-id 1.1.1.1</strong>
[<span class="keyword">*</span>Device1-ospfv3-1] <strong>area 0.0.0.0</strong>
[<span class="keyword">*</span>Device1-ospfv3-1-area-0.0.0.0] <strong>quit</strong>
[<span class="keyword">*</span>Device1-ospfv3-1] <strong>quit</strong>
[<span class="keyword">*</span>Device1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Device1] <strong>interface loopback 0</strong>
[<span class="keyword">*</span>Device1-LoopBack0] <strong>ospfv3 1 area 0.0.0.0</strong>
[<span class="keyword">*</span>Device1-LoopBack0] <strong>quit</strong>
[<span class="keyword">*</span>Device1] <strong>interface GigabitEthernet<span>0/1/0</span></strong>
[<span class="keyword">*</span>Device1-GigabitEthernet<span>0/1/0</span>] <strong>ospfv3 1 area 0.0.0.0</strong>
[<span class="keyword">*</span>Device1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong>
[<span class="keyword">*</span>Device1] <strong>interface GigabitEthernet<span>0/1/1</span></strong>
[<span class="keyword">*</span>Device1-GigabitEthernet<span>0/1/1</span>] <strong>ospfv3 1 area 0.0.0.0</strong>
[<span class="keyword">*</span>Device1-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong>
[<span class="keyword">*</span>Device1] <strong>commit</strong></pre>
<p>The configuration of Device2 and Device3 is similar to the configuration of Device1. For detailed configurations, see <a href="#EN-US_TASK_0240585735__section_dc_vrp_vxlan_cfg_106101">Configuration Files</a>.</p>
</p></li><li><span>Configure a service access point on Device2 and Device3.</span><p><p># Configure Device2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Device2] <strong>bridge-domain 10</strong>
[<span class="keyword">*</span>Device2-bd10] <strong>quit</strong>
[<span class="keyword">*</span>Device2] <strong>interface GigabitEthernet<span>0/1/1</span>.1 mode l2</strong>
[<span class="keyword">*</span>Device2-GigabitEthernet<span>0/1/1</span>.1] <strong>encapsulation dot1q vid 10</strong>
[<span class="keyword">*</span>Device2-GigabitEthernet<span>0/1/1</span>.1] <strong>rewrite pop single</strong>
[<span class="keyword">*</span>Device2-GigabitEthernet<span>0/1/1</span>.1] <strong>bridge-domain 10</strong>
[<span class="keyword">*</span>Device2-GigabitEthernet<span>0/1/1</span>.1] <strong>quit</strong>
[<span class="keyword">*</span>Device2] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Device2] <strong>bridge-domain 20</strong>
[<span class="keyword">*</span>Device2-bd20] <strong>quit</strong>
[<span class="keyword">*</span>Device2] <strong>interface GigabitEthernet<span>0/1/1</span>.2 mode l2</strong>
[<span class="keyword">*</span>Device2-GigabitEthernet<span>0/1/1</span>.2] <strong>encapsulation dot1q vid 20</strong>
[<span class="keyword">*</span>Device2-GigabitEthernet<span>0/1/1</span>.2] <strong>rewrite pop single</strong>
[<span class="keyword">*</span>Device2-GigabitEthernet<span>0/1/1</span>.2] <strong>bridge-domain 20</strong>
[<span class="keyword">*</span>Device2-GigabitEthernet<span>0/1/1</span>.2] <strong>quit</strong>
[<span class="keyword">*</span>Device2] <strong>commit</strong></pre>
<p>The configuration of Device3 is similar to that of Device2. For detailed configurations, see <a href="#EN-US_TASK_0240585735__section_dc_vrp_vxlan_cfg_106101">Configuration Files</a>.</p>
</p></li><li><span>Configure Device2 and Device3 to establish BGP EVPN peer relationships with Device1.</span><p><p># Configure a BGP EVPN peer relationship on Device2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Device2] <strong>bgp 100</strong>
[<span class="keyword">*</span>Device2-bgp] <strong>peer 2001:DB8:11::1 as-number 100</strong>
[<span class="keyword">*</span>Device2-bgp] <strong>peer 2001:DB8:11::1 connect-interface LoopBack0</strong>
[<span class="keyword">*</span>Device2-bgp] <strong>l2vpn-family evpn</strong>
[<span class="keyword">*</span>Device2-bgp-af-evpn] <strong>policy vpn-target</strong>
[<span class="keyword">*</span>Device2-bgp-af-evpn] <strong>peer 2001:DB8:11::1 enable</strong>
[<span class="keyword">*</span>Device2-bgp-af-evpn] <strong>peer 2001:DB8:11::1 advertise encap-type vxlan</strong>
[<span class="keyword">*</span>Device2-bgp-af-evpn] <strong>quit</strong>
[<span class="keyword">*</span>Device2-bgp] <strong>quit</strong>
[<span class="keyword">*</span>Device2] <strong>commit</strong></pre>
<p>The configuration of Device3 is similar to that of Device2. For detailed configurations, see <a href="#EN-US_TASK_0240585735__section_dc_vrp_vxlan_cfg_106101">Configuration Files</a>.</p>
</p></li><li><span>Configure Device1 to establish BGP EVPN peer relationships with Device2 and Device3. Then configure Device1 as the RR and Device2 and Device3 as the RR clients.</span><p><p># Configure Device1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Device1] <strong>bgp 100</strong>
[<span class="keyword">*</span>Device1-bgp] <strong>peer 2001:DB8:22::2 as-number 100</strong>
[<span class="keyword">*</span>Device1-bgp] <strong>peer 2001:DB8:22::2 connect-interface LoopBack0</strong>
[<span class="keyword">*</span>Device1-bgp] <strong>peer 2001:DB8:33::3 as-number 100</strong>
[<span class="keyword">*</span>Device1-bgp] <strong>peer 2001:DB8:33::3 connect-interface LoopBack0</strong>
[<span class="keyword">*</span>Device1-bgp] <strong>l2vpn-family evpn</strong>
[<span class="keyword">*</span>Device1-bgp-af-evpn] <strong>peer 2001:DB8:22::2 enable</strong>
[<span class="keyword">*</span>Device1-bgp-af-evpn] <strong>peer 2001:DB8:22::2 advertise encap-type vxlan</strong>
[<span class="keyword">*</span>Device1-bgp-af-evpn] <strong>peer 2001:DB8:22::2 reflect-client</strong>
[<span class="keyword">*</span>Device1-bgp-af-evpn] <strong>peer 2001:DB8:33::3 enable</strong>
[<span class="keyword">*</span>Device1-bgp-af-evpn] <strong>peer 2001:DB8:33::3 advertise encap-type vxlan</strong>
[<span class="keyword">*</span>Device1-bgp-af-evpn] <strong>peer 2001:DB8:33::3 reflect-client</strong>
[<span class="keyword">*</span>Device1-bgp-af-evpn] <strong>undo policy vpn-target</strong>
[<span class="keyword">*</span>Device1-bgp-af-evpn] <strong>quit</strong>
[<span class="keyword">*</span>Device1-bgp] <strong>quit</strong>
[<span class="keyword">*</span>Device1] <strong>commit</strong></pre>
</p></li><li><span>Configure VPN and EVPN instances on Device2 and Device3.</span><p><p># Configure Device2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Device2] <strong>ip vpn-instance vpn1</strong>
[<span class="keyword">*</span>Device2-vpn-instance-vpn1] <strong>vxlan vni 100</strong>
[<span class="keyword">*</span>Device2-vpn-instance-vpn1] <strong>ipv4-family</strong>
[<span class="keyword">*</span>Device2-vpn-instance-vpn1-af-ipv4] <strong>route-distinguisher 11:11</strong>
[<span class="keyword">*</span>Device2-vpn-instance-vpn1-af-ipv4] <strong>vpn-target 11:1 evpn</strong>
[<span class="keyword">*</span>Device2-vpn-instance-vpn1-af-ipv4] <strong>quit</strong>
[<span class="keyword">*</span>Device2-vpn-instance-vpn1] <strong>quit</strong>
[<span class="keyword">*</span>Device2] <strong>evpn vpn-instance evrf1 bd-mode</strong>
[<span class="keyword">*</span>Device2-evpn-instance-evrf1] <strong>route-distinguisher 10:1</strong>
[<span class="keyword">*</span>Device2-evpn-instance-evrf1] <strong>vpn-target 10:1</strong>
[<span class="keyword">*</span>Device2-evpn-instance-evrf1] <strong>vpn-target 11:1</strong><strong> export-extcommunity</strong>
[<span class="keyword">*</span>Device2-evpn-instance-evrf1] <strong>quit</strong>
[<span class="keyword">*</span>Device2] <strong>bridge-domain 10</strong>
[<span class="keyword">*</span>Device2-bd10] <strong>vxlan vni 10 split-horizon-mode</strong>
[<span class="keyword">*</span>Device2-bd10] <strong>evpn binding vpn-instance evrf1</strong>
[<span class="keyword">*</span>Device2-bd10] <strong>quit</strong>
[<span class="keyword">*</span>Device2] <strong>commit</strong>
[<span class="keyword">*</span>Device2] <strong>evpn vpn-instance evrf2 bd-mode</strong>
[<span class="keyword">*</span>Device2-evpn-instance-evrf2] <strong>route-distinguisher 20:1</strong>
[<span class="keyword">*</span>Device2-evpn-instance-evrf2] <strong>vpn-target 20:1</strong>
[<span class="keyword">*</span>Device2-evpn-instance-evrf2]<strong> vpn-target 11:1 export-extcommunity</strong>
[<span class="keyword">*</span>Device2-evpn-instance-evrf2] <strong>quit</strong>
[<span class="keyword">*</span>Device2] <strong>bridge-domain 20</strong>
[<span class="keyword">*</span>Device2-bd20] <strong>vxlan vni 20 split-horizon-mode</strong>
[<span class="keyword">*</span>Device2-bd20] <strong>evpn binding vpn-instance evrf2</strong>
[<span class="keyword">*</span>Device2-bd20] <strong>quit</strong>
[<span class="keyword">*</span>Device2] <strong>commit</strong></pre>
<p>The configuration of Device3 is similar to that of Device2. For detailed configurations, see <a href="#EN-US_TASK_0240585735__section_dc_vrp_vxlan_cfg_106101">Configuration Files</a>.</p>
</p></li><li><span>Enable ingress replication on Device2 and Device3.</span><p><p># Enable ingress replication on Device2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Device2] <strong>interface nve 1</strong>
[<span class="keyword">*</span>Device2-Nve1] <strong>source 2001:DB8:22::2</strong>
[<span class="keyword">*</span>Device2-Nve1] <strong>vni 10 head-end peer-list protocol bgp</strong>
[<span class="keyword">*</span>Device2-Nve1] <strong>vni 20 head-end peer-list protocol bgp</strong>
[<span class="keyword">*</span>Device2-Nve1] <strong>quit</strong>
[<span class="keyword">*</span>Device2] <strong>commit</strong></pre>
<p>The configuration of Device3 is similar to that of Device2. For detailed configurations, see <a href="#EN-US_TASK_0240585735__section_dc_vrp_vxlan_cfg_106101">Configuration Files</a>.</p>
</p></li><li><span>Configure Device2 and Device3 as Layer 3 VXLAN gateways.</span><p><p># Configure Device2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Device2] <strong>interface Vbdif10</strong>
[<span class="keyword">*</span>Device2-Vbdif10] <strong>ip binding vpn-instance vpn1</strong>
[<span class="keyword">*</span>Device2-Vbdif10] <strong>ip address 10.1.1.1 255.255.255.0</strong>
[<span class="keyword">*</span>Device2-Vbdif10] <strong>vxlan anycast-gateway enable</strong>
[<span class="keyword">*</span>Device2-Vbdif10] <strong>arp collect host enable</strong>
[<span class="keyword">*</span>Device2-Vbdif10] <strong>quit</strong>
[<span class="keyword">*</span>Device2] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Device2] <strong>interface Vbdif20</strong>
[<span class="keyword">*</span>Device2-Vbdif20] <strong>ip binding vpn-instance vpn1</strong>
[<span class="keyword">*</span>Device2-Vbdif20] <strong>ip address 10.2.1.1 255.255.255.0</strong>
[<span class="keyword">*</span>Device2-Vbdif20] <strong>vxlan anycast-gateway enable</strong>
[<span class="keyword">*</span>Device2-Vbdif20] <strong>arp collect host enable</strong>
[<span class="keyword">*</span>Device2-Vbdif20] <strong>quit</strong>
[<span class="keyword">*</span>Device2] <strong>commit</strong></pre>
<p>The configuration of Device3 is similar to that of Device2. For detailed configurations, see <a href="#EN-US_TASK_0240585735__section_dc_vrp_vxlan_cfg_106101">Configuration Files</a>.</p>
</p></li><li><span>Configure BGP to advertise IRB routes between Device1 and Device2 and between Device1 and Device3.</span><p><p># Configure Device1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Device1] <strong>bgp 100</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Device1-bgp] <strong>l2vpn-family evpn</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Device1-bgp-af-evpn] <strong>peer 2001:DB8:22::2 advertise irb</strong>
[<span class="keyword">*</span>Device1-bgp-af-evpn] <strong>peer 2001:DB8:33::3 advertise irb</strong>
[<span class="keyword">*</span>Device1-bgp-af-evpn] <strong>quit</strong>
[<span class="keyword">*</span>Device1-bgp] <strong>quit</strong>
[<span class="keyword">*</span>Device1] <strong>commit</strong></pre>
<p># Configure Device2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Device2] <strong>bgp 100</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Device2-bgp] <strong>l2vpn-family evpn</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Device2-bgp-af-evpn] <strong>peer 2001:DB8:11::1 advertise irb</strong>
[<span class="keyword">*</span>Device2-bgp-af-evpn] <strong>quit</strong>
[<span class="keyword">*</span>Device2-bgp] <strong>quit</strong>
[<span class="keyword">*</span>Device2] <strong>commit</strong></pre>
<p>The configuration of Device3 is similar to that of Device2. For detailed configurations, see <a href="#EN-US_TASK_0240585735__section_dc_vrp_vxlan_cfg_106101">Configuration Files</a>.</p>
</p></li><li><span>Verify the configuration.</span><p><p>After completing the configurations, run the <a href="cmdqueryname=display+vxlan+tunnel"><b><span class="cmdname">display vxlan tunnel</span></b></a> command on Device2 and Device3 to check VXLAN tunnel information. The following example uses the command output on Device2.</p>
<pre class="screen">[<span class="keyword">*</span>Device2] <strong>display vxlan tunnel</strong></pre>
<pre class="screen">Number of vxlan tunnel : 1
Tunnel ID   Source           Destination      State  Type     Uptime
--------------------------------------------------------------------
4026531879  2001:DB8:22::2   2001:DB8:33::3   up     dynamic  00:44:18</pre>
<p>After the configuration is complete, VMs belonging to different servers on different subnets can communicate. On the distributed gateway Device2, use the vbdif1 gateway address to ping VM2 on Server2.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>Device2] <strong>ping </strong><strong>-vpn-instance vpn1</strong><strong> âa 10.1.1.1 </strong><strong>10.2.1.10 </strong>
  PING 10.2.1.10: 300  data bytes, press CTRL_C to break
    Reply from 10.2.1.10: bytes=300 Sequence=1 ttl=254 time=30 ms
    Reply from 10.2.1.10: bytes=300 Sequence=2 ttl=254 time=30 ms
    Reply from 10.2.1.10: bytes=300 Sequence=3 ttl=254 time=30 ms
    Reply from 10.2.1.10: bytes=300 Sequence=4 ttl=254 time=30 ms
    Reply from 10.2.1.10: bytes=300 Sequence=5 ttl=254 time=30 ms

  --- 10.2.1.10 ping statistics ---
    5 packet(s) transmitted
    5 packet(s) received
    0.00% packet loss
    round-trip min/avg/max = 30/30/30 ms</pre>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0240585735__section_dc_vrp_vxlan_cfg_106101"><a name="EN-US_TASK_0240585735__section_dc_vrp_vxlan_cfg_106101"></a><a name="section_dc_vrp_vxlan_cfg_106101"></a><a name="EN-US_TASK_0240585735__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>Device1 configuration file</p>
<pre class="screen">#
sysname Device1
#
ospfv3 1
 router-id 1.1.1.1
 area 0.0.0.0
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ipv6 enable
 ipv6 address 2001:DB8:3::2/64
 ospfv3 1 area 0.0.0.0
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ipv6 enable
 ipv6 address 2001:DB8:2::2/64
 ospfv3 1 area 0.0.0.0
#
interface LoopBack0
 ipv6 enable
 ipv6 address 2001:DB8:11::1/128
 ospfv3 1 area 0.0.0.0
#
bgp 100
 peer 2001:DB8:22::2 as-number 100
 peer 2001:DB8:22::2 connect-interface LoopBack0
 peer 2001:DB8:33::3 as-number 100
 peer 2001:DB8:33::3 connect-interface LoopBack0
 #
 l2vpn-family evpn
  undo policy vpn-target
  peer 2001:DB8:22::2 enable
  peer 2001:DB8:22::2 advertise encap-type vxlan
  peer 2001:DB8:22::2 advertise irb
  peer 2001:DB8:22::2 reflect-client
  peer 2001:DB8:33::3 enable
  peer 2001:DB8:33::3 advertise encap-type vxlan
  peer 2001:DB8:33::3 advertise irb
  peer 2001:DB8:33::3 reflect-client
#
return</pre>
</li><li><p>Device2 configuration file</p>
<pre class="screen">#
sysname Device2
#
evpn vpn-instance evrf1 bd-mode
 route-distinguisher 10:1
 vpn-target 10:1 export-extcommunity
 vpn-target 11:1 export-extcommunity
 vpn-target 10:1 import-extcommunity
#
evpn vpn-instance evrf2 bd-mode
 route-distinguisher 20:1
 vpn-target 20:1 export-extcommunity
 vpn-target 11:1 export-extcommunity
 vpn-target 20:1 import-extcommunity
#
ip vpn-instance vpn1
 ipv4-family
  route-distinguisher 11:11
<span>  apply-label per-instance</span>
  vpn-target 11:1 export-extcommunity evpn
  vpn-target 11:1 import-extcommunity evpn
 vxlan vni 100
#
bridge-domain 10
 vxlan vni 10 split-horizon-mode
 evpn binding vpn-instance evrf1
#
bridge-domain 20
 vxlan vni 20 split-horizon-mode
 evpn binding vpn-instance evrf2
#
ospfv3 1
 router-id 2.2.2.2
 area 0.0.0.0
#
interface Vbdif10
 ip binding vpn-instance vpn1
 ip address 10.1.1.1 255.255.255.0
 arp collect host enable
 vxlan anycast-gateway enable
#
interface Vbdif20
 ip binding vpn-instance vpn1
 ip address 10.2.1.1 255.255.255.0
 arp collect host enable
 vxlan anycast-gateway enable
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ipv6 enable
 ipv6 address 2001:DB8:2::1/64
 ospfv3 1 area 0.0.0.0
#
interface GigabitEthernet<span>0/1/1</span>.1 mode l2
 encapsulation dot1q vid 10
 rewrite pop single
 bridge-domain 10
#
interface GigabitEthernet<span>0/1/1</span>.2 mode l2
 encapsulation dot1q vid 20
 rewrite pop single
 bridge-domain 20
#
interface LoopBack0
 ipv6 enable
 ipv6 address 2001:DB8:22::2/128
 ospfv3 1 area 0.0.0.0
#
interface Nve1
 source 2001:DB8:22::2
 vni 10 head-end peer-list protocol bgp
 vni 20 head-end peer-list protocol bgp
#
bgp 100
 peer 2001:DB8:11::1 as-number 100
 peer 2001:DB8:11::1 connect-interface LoopBack0
 #
 l2vpn-family evpn
  policy vpn-target
  peer 2001:DB8:11::1 enable
  peer 2001:DB8:11::1 advertise encap-type vxlan
  peer 2001:DB8:11::1 advertise irb
#
return</pre>
</li><li><p>Device3 configuration file</p>
<pre class="screen">#
sysname Device3
#
evpn vpn-instance evrf1 bd-mode
 route-distinguisher 30:1
 vpn-target 10:1 export-extcommunity
 vpn-target 11:1 export-extcommunity
 vpn-target 10:1 import-extcommunity
#
evpn vpn-instance evrf2 bd-mode
 route-distinguisher 40:1
 vpn-target 20:1 export-extcommunity
 vpn-target 11:1 export-extcommunity
 vpn-target 20:1 import-extcommunity
#
ip vpn-instance vpn1
 ipv4-family
  route-distinguisher 22:22
  apply-label per-instance
  vpn-target 11:1 export-extcommunity evpn
  vpn-target 11:1 import-extcommunity evpn
 vxlan vni 100
#
bridge-domain 10
 vxlan vni 10 split-horizon-mode
 evpn binding vpn-instance evrf1
#
bridge-domain 20
 vxlan vni 20 split-horizon-mode
 evpn binding vpn-instance evrf2
#
ospfv3 1
 router-id 3.3.3.3
 area 0.0.0.0
#
interface Vbdif10
 ip binding vpn-instance vpn1
 ip address 10.1.1.2 255.255.255.0
 arp collect host enable
 vxlan anycast-gateway enable
#
interface Vbdif20
 ip binding vpn-instance vpn1
 ip address 10.2.1.2 255.255.255.0
 arp collect host enable
 vxlan anycast-gateway enable
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ipv6 enable
 ipv6 address 2001:DB8:3::1/64
 ospfv3 1 area 0.0.0.0
#
interface GigabitEthernet<span>0/1/1</span>.1 mode l2
 encapsulation dot1q vid 10
 rewrite pop single
 bridge-domain 10
#
interface GigabitEthernet<span>0/1/1</span>.2 mode l2
 encapsulation dot1q vid 20
 rewrite pop single
 bridge-domain 20
#
interface LoopBack0
 ipv6 enable
 ipv6 address 2001:DB8:33::3/128
 ospfv3 1 area 0.0.0.0
#
interface Nve1
 source 2001:DB8:33::3
 vni 20 head-end peer-list protocol bgp
#
bgp 100
 peer 2001:DB8:11::1 as-number 100
 peer 2001:DB8:11::1 connect-interface LoopBack0
 #
 l2vpn-family evpn
  policy vpn-target
  peer 2001:DB8:11::1 enable
  peer 2001:DB8:11::1 advertise encap-type vxlan
  peer 2001:DB8:11::1 advertise irb
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vxlan_cfg_1015.html">Configuration Examples for VXLAN
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vxlan_cfg_1300.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vxlan_cfg_1223.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>