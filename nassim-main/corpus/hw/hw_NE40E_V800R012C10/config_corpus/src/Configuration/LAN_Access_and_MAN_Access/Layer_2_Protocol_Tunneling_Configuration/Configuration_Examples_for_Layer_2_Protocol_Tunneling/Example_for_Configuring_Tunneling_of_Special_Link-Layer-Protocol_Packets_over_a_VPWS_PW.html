
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Tunneling of Special Link-Layer-Protocol Packets over a VPWS PW">
<meta name="abstract" content="CE1 and CE2 are non-Huawei devices. Both CEs support the Cisco Discovery Protocol (CDP). To ensure that these CEs can work with NE40Es, you must establish a VPWS PW between PE1 and PE2. In this manner, CE1 and CE2 can transparently transmit CDP packets between each other over the PW and use CDP to discover each other.">
<meta name="description" content="CE1 and CE2 are non-Huawei devices. Both CEs support the Cisco Discovery Protocol (CDP). To ensure that these CEs can work with NE40Es, you must establish a VPWS PW between PE1 and PE2. In this manner, CE1 and CE2 can transparently transmit CDP packets between each other over the PW and use CDP to discover each other.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2bptnl_cfg_0017.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2bptnl_cfg_0029.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_vpls_cfg_5003.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="wwx1238417">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="Layer 2 Protocol Tunneling">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="Layer 2 Protocol Tunneling">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="featurename" content="Layer 2 Protocol Tunneling">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="featurename" content="Layer 2 Protocol Tunneling">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="OWNER" content="c00648116,w00437000">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="wwx1238417">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172363039">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>Example for Configuring Tunneling of Special Link-Layer-Protocol Packets over a VPWS PW</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172363039"></a><a name="EN-US_TASK_0172363039"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Tunneling of Special Link-Layer-Protocol Packets over a VPWS PW</h1>
<div class="taskbody"><p>CE1 and CE2 are non-Huawei devices. Both CEs support the Cisco Discovery Protocol (CDP). To ensure that these CEs can work with <span class="keyword">NE40E</span>s, you must establish a VPWS PW between PE1 and PE2. In this manner, CE1 and CE2 can transparently transmit CDP packets between each other over the PW and use CDP to discover each other.</p>
<div class="context"><a name="EN-US_TASK_0172363039__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>As shown in <a href="#EN-US_TASK_0172363039__fig_dc_ne_vpws_cfg_500301">Figure 1</a>, CE1 and CE2 are connected to PE1 and PE2 respectively through VLANs.</p>
<p>An LDP VPWS is set up between CE1 and CE2.</p>
<p>CE1 and CE2 are non-Huawei devices. Both CEs support CDP. To ensure that these CEs can work with <span class="keyword">NE40E</span>s, you must establish a VPWS PW between PE1 and PE2. In this manner, CE1 and CE2 can transparently transmit CDP packets between each other over the PW and use CDP to discover each other.</p>
<div class="fignone" id="EN-US_TASK_0172363039__fig_dc_ne_vpws_cfg_500301"><a name="EN-US_TASK_0172363039__fig_dc_ne_vpws_cfg_500301"></a><a name="fig_dc_ne_vpws_cfg_500301"></a><span class="figcap"><b>Figure 1 </b>Networking for tunneling of special link-layer-protocol packets over an LDP VPWS PW</span><br><span><img src="images/fig_dc_ne_vpws_cfg_500301.png"></span></div>

<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" frame="border" border="1" rules="all"><thead align="left"><tr><th align="left" class="cellrowborder" char="." valign="top" width="33.33333333333333%" id="mcps1.4.1.6.1.4.1.1" liSelected="liSelected"><p>Device Name</p>
</th>
<th align="left" class="cellrowborder" char="." valign="top" width="33.33333333333333%" id="mcps1.4.1.6.1.4.1.2" liSelected="liSelected"><p>Interface</p>
</th>
<th align="left" class="cellrowborder" char="." valign="top" width="33.33333333333333%" id="mcps1.4.1.6.1.4.1.3" liSelected="liSelected"><p>IP Address</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" char="." valign="top" width="33.33333333333333%" headers="mcps1.4.1.6.1.4.1.1 "><p>CE1</p>
</td>
<td class="cellrowborder" char="." valign="top" width="33.33333333333333%" headers="mcps1.4.1.6.1.4.1.2 "><p>GE <span>0/1/0</span>.1</p>
</td>
<td class="cellrowborder" char="." valign="top" width="33.33333333333333%" headers="mcps1.4.1.6.1.4.1.3 "><p>10.10.1.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" width="33.33333333333333%" headers="mcps1.4.1.6.1.4.1.1 "><p>PE1</p>
</td>
<td class="cellrowborder" char="." valign="top" width="33.33333333333333%" headers="mcps1.4.1.6.1.4.1.2 "><p>GE <span>0/1/0</span>.1</p>
</td>
<td class="cellrowborder" char="." valign="top" width="33.33333333333333%" headers="mcps1.4.1.6.1.4.1.3 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" width="33.33333333333333%" headers="mcps1.4.1.6.1.4.1.1 "><p>PE1</p>
</td>
<td class="cellrowborder" char="." valign="top" width="33.33333333333333%" headers="mcps1.4.1.6.1.4.1.2 "><p>GE <span>0/2/0</span></p>
</td>
<td class="cellrowborder" char="." valign="top" width="33.33333333333333%" headers="mcps1.4.1.6.1.4.1.3 "><p>10.1.1.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" width="33.33333333333333%" headers="mcps1.4.1.6.1.4.1.1 "><p>PE1</p>
</td>
<td class="cellrowborder" char="." valign="top" width="33.33333333333333%" headers="mcps1.4.1.6.1.4.1.2 "><p>Loopback 1</p>
</td>
<td class="cellrowborder" char="." valign="top" width="33.33333333333333%" headers="mcps1.4.1.6.1.4.1.3 "><p>1.1.1.9/32</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" width="33.33333333333333%" headers="mcps1.4.1.6.1.4.1.1 "><p>P</p>
</td>
<td class="cellrowborder" char="." valign="top" width="33.33333333333333%" headers="mcps1.4.1.6.1.4.1.2 "><p>GE <span>0/1/0</span></p>
</td>
<td class="cellrowborder" char="." valign="top" width="33.33333333333333%" headers="mcps1.4.1.6.1.4.1.3 "><p>10.2.2.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" width="33.33333333333333%" headers="mcps1.4.1.6.1.4.1.1 "><p>P</p>
</td>
<td class="cellrowborder" char="." valign="top" width="33.33333333333333%" headers="mcps1.4.1.6.1.4.1.2 "><p>GE <span>0/2/0</span></p>
</td>
<td class="cellrowborder" char="." valign="top" width="33.33333333333333%" headers="mcps1.4.1.6.1.4.1.3 "><p>10.1.1.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" width="33.33333333333333%" headers="mcps1.4.1.6.1.4.1.1 "><p>P</p>
</td>
<td class="cellrowborder" char="." valign="top" width="33.33333333333333%" headers="mcps1.4.1.6.1.4.1.2 "><p>Loopback 1</p>
</td>
<td class="cellrowborder" char="." valign="top" width="33.33333333333333%" headers="mcps1.4.1.6.1.4.1.3 "><p>2.2.2.9/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" width="33.33333333333333%" headers="mcps1.4.1.6.1.4.1.1 "><p>PE2</p>
</td>
<td class="cellrowborder" char="." valign="top" width="33.33333333333333%" headers="mcps1.4.1.6.1.4.1.2 "><p>GE<span>0/1/0</span>.1</p>
</td>
<td class="cellrowborder" char="." valign="top" width="33.33333333333333%" headers="mcps1.4.1.6.1.4.1.3 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" width="33.33333333333333%" headers="mcps1.4.1.6.1.4.1.1 "><p>PE2</p>
</td>
<td class="cellrowborder" char="." valign="top" width="33.33333333333333%" headers="mcps1.4.1.6.1.4.1.2 "><p>GE <span>0/2/0</span></p>
</td>
<td class="cellrowborder" char="." valign="top" width="33.33333333333333%" headers="mcps1.4.1.6.1.4.1.3 "><p>10.2.2.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" width="33.33333333333333%" headers="mcps1.4.1.6.1.4.1.1 "><p>PE2</p>
</td>
<td class="cellrowborder" char="." valign="top" width="33.33333333333333%" headers="mcps1.4.1.6.1.4.1.2 "><p>Loopback 1</p>
</td>
<td class="cellrowborder" char="." valign="top" width="33.33333333333333%" headers="mcps1.4.1.6.1.4.1.3 "><p>3.3.3.9/32</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" width="33.33333333333333%" headers="mcps1.4.1.6.1.4.1.1 "><p>CE2</p>
</td>
<td class="cellrowborder" char="." valign="top" width="33.33333333333333%" headers="mcps1.4.1.6.1.4.1.2 "><p>GE <span>0/1/0</span>.1</p>
</td>
<td class="cellrowborder" char="." valign="top" width="33.33333333333333%" headers="mcps1.4.1.6.1.4.1.3 "><p>10.10.1.2/24</p>
</td>
</tr>
</tbody>
</table>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172363039__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure a routing protocol on PEs and the P on the backbone network to achieve connectivity between these devices and enable MPLS on them.</p>
</li><li><p>Establish an LSP between PEs to transmit data. The default tunnel policy is used in this example.</p>
</li><li><p>Enable MPLS L2VPN on PEs and create VCs.</p>
</li><li><p>Configure VLAN sub-interfaces so that CEs can access PEs through VLANs.</p>
</li><li><p>Enable transparent transmission of CDP packets on the AC interface on each PE connecting the PE to a CE.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172363039__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>VLAN sub-interface numbers</p>
</li><li><p>Name of the remote peer of each PE</p>
</li><li><p>VC IDs</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172363039__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure CEs.</span><p><p># Configure CE1.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname CE1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1]<strong> interface gigabitethernet <span>0/1/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>.1] <strong>vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>.1] <strong>ip address 10.10.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>commit</strong></pre>
<p># Configure CE2.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname CE2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>interface gigabitethernet <span>0/1/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>.1] <strong>vlan-type dot1q 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>.1] <strong>ip address 10.10.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>commit</strong></pre>
</p></li><li><span>Configure an IGP on the MPLS backbone network. OSPF is used in this example.</span><p><p>As shown in <a href="#EN-US_TASK_0172363039__fig_dc_ne_vpws_cfg_500301">Figure 1</a>, assign an IP address to each interface on PEs and the P. When configuring OSPF, advertise the 32-bit IP addresses of loopback interfaces, which are used as LSR IDs, on PEs and the P.</p>
<p>The configuration details are not provided here.</p>
<p>After the configuration is complete, OSPF neighbor relationships can be set up between PE1, the P, and PE2. Run the <strong>display ospf peer</strong> command. The command output shows that the neighbor status is <strong>Full</strong>. Run the <strong>display ip routing-table</strong> command. The command output shows that PEs have learned the routes to Loopback1 from each other.</p>
</p></li><li><span>Configure basic MPLS functions and LDP on the MPLS backbone network.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls lsr-id 1.1.1.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure the P.</p>
<pre class="screen">[<span class="keyword">*</span>P] <strong>mpls lsr-id 2.2.2.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-mpls-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P]<strong> interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/2/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/2/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>mpls lsr-id 3.3.3.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</p></li><li><span>Set up remote LDP sessions between PEs.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> mpls ldp remote-peer 3.3.3.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp-remote-3.3.3.9] <strong>remote-ip 3.3.3.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp-remote-3.3.3.9] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> mpls ldp remote-peer 1.1.1.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-ldp-remote-1.1.1.9]<strong> remote-ip 1.1.1.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-ldp-remote-1.1.1.9]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p>After the configuration is complete, run the <strong>display mpls ldp session</strong> command on PE1 to check LDP session information. The command output shows that PE1 has established an LDP session with PE2.</p>
<p>The command output on PE1 is used as an example.</p>
<pre class="screen">&lt;PE1&gt; <strong>display mpls ldp session</strong></pre>
<pre class="screen">               LDP Session(s) in Public Network</pre>
<pre class="screen"> ------------------------------------------------------------------------------</pre>
<pre class="screen"> Peer-ID            Status      LAM  SsnRole  SsnAge      KA-Sent/Rcv</pre>
<pre class="screen"> ------------------------------------------------------------------------------</pre>
<pre class="screen"> 2.2.2.9:0          <strong>Operational</strong> DU   Passive  0000:00:09   40/40</pre>
<pre class="screen"> 3.3.3.9:0          <strong>Operational</strong> DU   Passive  0000:00:09   37/37</pre>
<pre class="screen"> ------------------------------------------------------------------------------</pre>
<pre class="screen">TOTAL: 2 session(s) Found.</pre>
<pre class="screen"> LAM : Label Advertisement Mode      SsnAge Unit : DDDD:HH:MM </pre>
</p></li><li><span>Enable MPLS L2VPN on PEs and create VCs.</span><p><p># Configure PE1: Create a VC on GE <span>0/1/0</span>.1 that is connected to CE1.</p>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-l2vpn] <strong>mpls l2vpn default martini</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-l2vpn]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet <span>0/1/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1] <strong>vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1] <strong>mpls l2vc 3.3.3.9 101</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2: Create a VC on GE <span>0/1/0</span>.1 that is connected to CE2.</p>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-l2vpn] <strong>mpls l2vpn default martini</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface gigabitethernet <span>0/1/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>.1] <strong>vlan-type dot1q 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>.1] <strong>mpls l2vc 1.1.1.9 101</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</p></li><li><span>Enable transparent transmission of CDP packets on the PEs.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet <span>0/1/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1] <strong>link-protocol transport cdp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface gigabitethernet <span>0/1/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>.1] <strong>link-protocol transport cdp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p>Check L2VPN connections on PEs. You can view that an L2VC connection has been set up and is Up.</p>
<p>The command output on PE1 is used as an example.</p>
<pre class="screen">&lt;PE1&gt; <strong>display mpls l2vc interface gigabitethernet <span>0/1/0</span>.1</strong></pre>
<pre class="screen"> *client interface       : GigabitEthernet<span>0/1/0</span>.1 is up</pre>
<pre class="screen">  session state          : up</pre>
<pre class="screen">  AC state               : up</pre>
<pre class="screen">  VC state               : <strong>up</strong></pre>
<pre class="screen">  VC ID                  : 101</pre>
<pre class="screen">  VC type                : VLAN</pre>
<pre class="screen">  destination            : 3.3.3.9</pre>
<pre class="screen">  local group ID         : 0            remote group ID      : 0</pre>
<pre class="screen">  local VC label         : 21504        remote VC label      : 21504</pre>
<pre class="screen">  local AC OAM State     : up</pre>
<pre class="screen">  local PSN State        : up</pre>
<pre class="screen">  local forwarding state : forwarding</pre>
<pre class="screen">  remote AC OAM state    : up</pre>
<pre class="screen">  remote PSN state       : up</pre>
<pre class="screen">  remote forwarding state: forwarding</pre>
<pre class="screen">  BFD for PW             : disable</pre>
<pre class="screen">  manual fault           : not set</pre>
<pre class="screen">  active state           : active</pre>
<pre class="screen">  forwarding entry       : exist</pre>
<pre class="screen">  link state             : up</pre>
<pre class="screen">  local VC MTU           : 1500         remote VC MTU        : 1500</pre>
<pre class="screen">  local VCCV             : Disable</pre>
<pre class="screen">  remote VCCV            : Disable</pre>
<pre class="screen">  local control word     : disable      remote control word  : disable</pre>
<pre class="screen">  tunnel policy name     : --</pre>
<pre class="screen">  traffic behavior name  : --</pre>
<pre class="screen">  PW template name       : --</pre>
<pre class="screen">  primary or secondary   : primary</pre>
<pre class="screen">  VC tunnel/token info   : 1 tunnels/tokens</pre>
<pre class="screen">    NO.0  TNL type : lsp   , TNL ID : 0x2002003</pre>
<pre class="screen">  create time            : 0 days, 0 hours, 4 minutes, 19 seconds</pre>
<pre class="screen">  up time                : 0 days, 0 hours, 2 minutes, 40 seconds</pre>
<pre class="screen">  last change time       : 0 days, 0 hours, 2 minutes, 40 seconds</pre>
<pre class="screen">  VC last up time : 2008-07-24 12:31:31
  VC total up time: 0 days, 2 hours, 12 minutes, 51 seconds
</pre>
<p>CE1 and CE2 can ping each other successfully.</p>
<p>The command output on CE1 is used as an example.</p>
<pre class="screen">&lt;CE1&gt;<strong> ping 10.10.1.2</strong></pre>
<pre class="screen">  PING 10.10.1.2: 56  data bytes, press CTRL_C to break</pre>
<pre class="screen">    Reply from 10.10.1.2: bytes=56 Sequence=1 ttl=255 time=31 ms</pre>
<pre class="screen">    Reply from 10.10.1.2: bytes=56 Sequence=2 ttl=255 time=10 ms</pre>
<pre class="screen">    Reply from 10.10.1.2: bytes=56 Sequence=3 ttl=255 time=5 ms</pre>
<pre class="screen">    Reply from 10.10.1.2: bytes=56 Sequence=4 ttl=255 time=2 ms</pre>
<pre class="screen">    Reply from 10.10.1.2: bytes=56 Sequence=5 ttl=255 time=28 ms</pre>
<pre class="screen">  --- 10.10.1.2 ping statistics ---</pre>
<pre class="screen">    5 packet(s) transmitted</pre>
<pre class="screen">    5 packet(s) received</pre>
<pre class="screen">    0.00% packet loss</pre>
<pre class="screen">    round-trip min/avg/max = 2/15/31 ms </pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172363039__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>Configuration file of CE1</p>
<pre class="screen">#</pre>
<pre class="screen"> sysname CE1</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span>.1</pre>
<pre class="screen"> vlan-type dot1q 10</pre>
<pre class="screen"> ip address 10.10.1.1 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p>Configuration file of PE1</p>
<pre class="screen">#</pre>
<pre class="screen"> sysname PE1</pre>
<pre class="screen">#</pre>
<pre class="screen"> mpls lsr-id 1.1.1.9</pre>
<pre class="screen"> mpls</pre>
<pre class="screen">#</pre>
<pre class="screen"> mpls l2vpn</pre>
<pre class="screen">  mpls l2vpn default martini</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls ldp</pre>
<pre class="screen">#</pre>
<pre class="screen"> mpls ldp remote-peer 3.3.3.9</pre>
<pre class="screen"> remote-ip 3.3.3.9</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span>.1</pre>
<pre class="screen"> vlan-type dot1q 10</pre>
<pre class="screen"> link-protocol transport cdp</pre>
<pre class="screen"> mpls l2vc 3.3.3.9 101</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/2/0</span></pre>
<pre class="screen"> ip address 10.1.1.1 255.255.255.0</pre>
<pre class="screen"> mpls</pre>
<pre class="screen"> mpls ldp</pre>
<pre class="screen">#</pre>
<pre class="screen">interface LoopBack1</pre>
<pre class="screen"> ip address 1.1.1.9 255.255.255.255</pre>
<pre class="screen">#</pre>
<pre class="screen">ospf 1</pre>
<pre class="screen"> area 0.0.0.0</pre>
<pre class="screen">  network 1.1.1.9 0.0.0.0</pre>
<pre class="screen">  network 10.1.1.0 0.0.0.255</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p>Configuration file of the P</p>
<pre class="screen">#</pre>
<pre class="screen"> sysname P</pre>
<pre class="screen">#</pre>
<pre class="screen"> mpls lsr-id 2.2.2.9</pre>
<pre class="screen"> mpls</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls ldp</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> ip address 10.2.2.2 255.255.255.0</pre>
<pre class="screen"> mpls</pre>
<pre class="screen"> mpls ldp</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/2/0</span></pre>
<pre class="screen"> ip address 10.1.1.2 255.255.255.0</pre>
<pre class="screen"> mpls</pre>
<pre class="screen"> mpls ldp</pre>
<pre class="screen">#</pre>
<pre class="screen">interface LoopBack1</pre>
<pre class="screen"> ip address 2.2.2.9 255.255.255.255</pre>
<pre class="screen">#</pre>
<pre class="screen">ospf 1</pre>
<pre class="screen"> area 0.0.0.0</pre>
<pre class="screen">  network 2.2.2.9 0.0.0.0</pre>
<pre class="screen">  network 10.1.1.0 0.0.0.255</pre>
<pre class="screen">  network 10.2.2.0 0.0.0.255</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p>Configuration file of PE2</p>
<pre class="screen">#</pre>
<pre class="screen"> sysname PE2</pre>
<pre class="screen">#</pre>
<pre class="screen"> mpls lsr-id 3.3.3.9</pre>
<pre class="screen"> mpls</pre>
<pre class="screen">#</pre>
<pre class="screen"> mpls l2vpn</pre>
<pre class="screen">  mpls l2vpn default martini</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls ldp</pre>
<pre class="screen">#</pre>
<pre class="screen"> mpls ldp remote-peer 1.1.1.9</pre>
<pre class="screen"> remote-ip 1.1.1.9</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span>.1</pre>
<pre class="screen"> vlan-type dot1q 20</pre>
<pre class="screen"> link-protocol transport cdp</pre>
<pre class="screen"> mpls l2vc 1.1.1.9 101</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/2/0</span></pre>
<pre class="screen"> ip address 10.2.2.1 255.255.255.0</pre>
<pre class="screen"> mpls</pre>
<pre class="screen"> mpls ldp</pre>
<pre class="screen">#</pre>
<pre class="screen">interface LoopBack1</pre>
<pre class="screen"> ip address 3.3.3.9 255.255.255.255</pre>
<pre class="screen">#</pre>
<pre class="screen">ospf 1</pre>
<pre class="screen"> area 0.0.0.0</pre>
<pre class="screen">  network 3.3.3.9 0.0.0.0</pre>
<pre class="screen">  network 10.2.2.0 0.0.0.255</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p>Configuration file of CE2</p>
<pre class="screen">#</pre>
<pre class="screen"> sysname CE2</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span>.1</pre>
<pre class="screen"> vlan-type dot1q 20</pre>
<pre class="screen"> ip address 10.10.1.2 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2bptnl_cfg_0017.html">Configuration Examples for Layer 2 Protocol Tunneling
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2bptnl_cfg_0029.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_vpls_cfg_5003.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>