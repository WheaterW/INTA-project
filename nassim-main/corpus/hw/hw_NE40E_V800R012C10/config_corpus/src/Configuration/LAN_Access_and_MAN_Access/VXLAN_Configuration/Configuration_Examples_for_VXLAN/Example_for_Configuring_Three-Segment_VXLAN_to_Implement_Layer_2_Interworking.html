
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Three-Segment VXLAN to Implement Layer 2 Interworking">
<meta name="abstract" content="This section provides an example for configuring three-segment VXLAN tunnels to enable Layer 2 communication between VMs that belong to the different DCs.">
<meta name="description" content="This section provides an example for configuring three-segment VXLAN tunnels to enable Layer 2 communication between VMs that belong to the different DCs.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vxlan_cfg_1015.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vxlan_cfg_1223.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vxlan_dci_cfg_0022.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="h00847023">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="OWNER" content="p00915595">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="p00915595">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172363836">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>Example for Configuring Three-Segment VXLAN to Implement Layer 2 Interworking</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172363836"></a><a name="EN-US_TASK_0172363836"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Three-Segment VXLAN to Implement Layer 2 Interworking</h1>
<div class="taskbody"><p>This section provides an example for configuring three-segment VXLAN tunnels to enable Layer 2 communication between VMs that belong to the different DCs.</p>
<div class="context"><a name="EN-US_TASK_0172363836__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0172363836__fig_dc_vrp_vxlan_cfg_120501">Figure 1</a>, BGP EVPN is configured within DC A and DC B to establish VXLAN tunnels. BGP EVPN is also configured on Leaf2 and Leaf3 to establish a VXLAN tunnel between them. To enable communication between VM1 and VM2, implement Layer 2 interworking between DC A and DC B. In this example, the VXLAN tunnel in DC A uses VNI 10, and that in DC B uses VNI 20. VNI conversion must be performed before a VXLAN tunnel is established between Transit Leaf1 and Transit Leaf2.</p>
<div class="fignone" id="EN-US_TASK_0172363836__fig_dc_vrp_vxlan_cfg_120501"><a name="EN-US_TASK_0172363836__fig_dc_vrp_vxlan_cfg_120501"></a><a name="fig_dc_vrp_vxlan_cfg_120501"></a><span class="figcap"><b>Figure 1 </b>Network diagram of configuring three-segment VXLAN to implement Layer 2 interworking</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface1 and interface2 represent GE<span>0/1/0</span> and GE<span>0/2/0</span>, respectively.</p>
</div></div>
<p><span><img class="vsd" src="images/fig_dc_vrp_vxlan_cfg_120401.png"></span></p>
</div>

<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" frame="border" border="1" rules="all"><caption><b>Table 1 </b>Interface IP addresses</caption><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="11.403508771929825%" id="mcps1.4.1.4.2.7.1.1" liSelected="liSelected"><p>Device</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="23.30827067669173%" id="mcps1.4.1.4.2.7.1.2" liSelected="liSelected"><p>Interface</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="16.41604010025063%" id="mcps1.4.1.4.2.7.1.3" liSelected="liSelected"><p>IP Address</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="11.403508771929825%" id="mcps1.4.1.4.2.7.1.4" liSelected="liSelected"><p>Device</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="21.17794486215539%" id="mcps1.4.1.4.2.7.1.5" liSelected="liSelected"><p>Interface</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="16.290726817042607%" id="mcps1.4.1.4.2.7.1.6" liSelected="liSelected"><p>IP Address</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" rowspan="2" valign="middle" width="11.403508771929825%" headers="mcps1.4.1.4.2.7.1.1 "><p>Spine1</p>
</td>
<td class="cellrowborder" valign="top" width="23.30827067669173%" headers="mcps1.4.1.4.2.7.1.2 "><p>GE<span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" width="16.41604010025063%" headers="mcps1.4.1.4.2.7.1.3 "><p>192.168.10.1/24</p>
</td>
<td class="cellrowborder" rowspan="2" valign="middle" width="11.403508771929825%" headers="mcps1.4.1.4.2.7.1.4 "><p>Spine2</p>
</td>
<td class="cellrowborder" valign="top" width="21.17794486215539%" headers="mcps1.4.1.4.2.7.1.5 "><p>GE<span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" width="16.290726817042607%" headers="mcps1.4.1.4.2.7.1.6 "><p>192.168.30.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.7.1.2 "><p>GE<span>0/2/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.7.1.3 "><p>192.168.20.1/24</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.7.1.5 "><p>GE<span>0/2/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.7.1.6 "><p>192.168.40.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="3" valign="middle" width="11.403508771929825%" headers="mcps1.4.1.4.2.7.1.1 "><p>Leaf1</p>
</td>
<td class="cellrowborder" valign="top" width="23.30827067669173%" headers="mcps1.4.1.4.2.7.1.2 "><p>GE<span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" width="16.41604010025063%" headers="mcps1.4.1.4.2.7.1.3 "><p>192.168.10.2/24</p>
</td>
<td class="cellrowborder" rowspan="3" valign="middle" width="11.403508771929825%" headers="mcps1.4.1.4.2.7.1.4 "><p>Leaf4</p>
</td>
<td class="cellrowborder" valign="top" width="21.17794486215539%" headers="mcps1.4.1.4.2.7.1.5 "><p>GE<span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" width="16.290726817042607%" headers="mcps1.4.1.4.2.7.1.6 "><p>192.168.40.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.7.1.2 "><p>GE<span>0/2/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.7.1.3 "><p>-</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.7.1.5 "><p>GE<span>0/2/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.7.1.6 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.7.1.2 "><p>LoopBack1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.7.1.3 "><p>1.1.1.1/32</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.7.1.5 "><p>LoopBack1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.7.1.6 "><p>4.4.4.4/32</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="3" valign="middle" width="11.403508771929825%" headers="mcps1.4.1.4.2.7.1.1 "><p>Leaf2</p>
</td>
<td class="cellrowborder" valign="top" width="23.30827067669173%" headers="mcps1.4.1.4.2.7.1.2 "><p>GE<span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" width="16.41604010025063%" headers="mcps1.4.1.4.2.7.1.3 "><p>192.168.20.2/24</p>
</td>
<td class="cellrowborder" rowspan="3" valign="middle" width="11.403508771929825%" headers="mcps1.4.1.4.2.7.1.4 "><p>Leaf3</p>
</td>
<td class="cellrowborder" valign="top" width="21.17794486215539%" headers="mcps1.4.1.4.2.7.1.5 "><p>GE<span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" width="16.290726817042607%" headers="mcps1.4.1.4.2.7.1.6 "><p>192.168.30.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.7.1.2 "><p>GE<span>0/2/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.7.1.3 "><p>192.168.50.1/24</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.7.1.5 "><p>GE<span>0/2/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.7.1.6 "><p>192.168.50.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.7.1.2 "><p>LoopBack1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.7.1.3 "><p>2.2.2.2/32</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.7.1.5 "><p>LoopBack1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.7.1.6 "><p>3.3.3.3/32</p>
</td>
</tr>
</tbody>
</table>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172363836__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Assign an IP address to each interface.</p>
</li><li><p>Configure an IGP to allow devices to communicate with each other.</p>
</li><li><p>Configure static routes to achieve interworking between DCs.</p>
</li><li><p>Configure BGP EVPN within DC A and DC B to establish VXLAN tunnels.</p>
</li><li><p>Configure BGP EVPN on Leaf2 and Leaf3 to establish a VXLAN tunnel between them.</p>
</li><li><p>Configure Leaf2 and Leaf3 to advertise routes that are re-originated by the EVPN address family to BGP EVPN peers.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172363836__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>VLAN IDs of the VMs</p>
</li><li><p>BD IDs</p>
</li><li><p>VNI IDs associated with BDs within DC A and DC B</p>
</li><li><p>Number of the AS to which DC A and DC B belong</p>
</li><li><p>Name of the SHG to which Leaf2 and Leaf3 belong</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172363836__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Assign an IP address to each interface (including the loopback interface) on each node.</span><p><p>For details about how to configure interface IP addresses and masks, see <a href="#EN-US_TASK_0172363836__dc_vrp_vxlan_cfg_1205_section">Configuration Files</a>.</p>
</p></li><li><span>Configure an IGP. In this example, OSPF is used.</span><p><p>For detailed configurations, see <a href="#EN-US_TASK_0172363836__dc_vrp_vxlan_cfg_1205_section">Configuration Files</a>.</p>
</p></li><li><span>Configure static routes to achieve interworking between DCs.</span><p><p>For detailed configurations, see <a href="#EN-US_TASK_0172363836__dc_vrp_vxlan_cfg_1205_section">Configuration Files</a>.</p>
</p></li><li><span>Configure BGP EVPN within DC A and DC B to create VXLAN tunnels.</span><ol type="a"><li class="substepexpand"><span>Configuring service access points on Leaf1 and Leaf4.</span><p><p># Configure Leaf1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf1] <strong>bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-bd10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1] <strong>interface GE <span>0/2/0</span>.1 mode l2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-GE<span>0/2/0</span>.1] <strong>encapsulation dot1q vid 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-GE<span>0/2/0</span>.1] <strong>rewrite pop single</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-GE<span>0/2/0</span>.1] <strong>bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-GE<span>0/2/0</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1] <strong>commit</strong></pre>
<p>The configuration of Leaf4 is similar to that of Leaf1. For detailed configurations, see <a href="#EN-US_TASK_0172363836__dc_vrp_vxlan_cfg_1205_section">Configuration Files</a>.</p>
</p></li><li class="substepexpand"><span>Configure BGP EVPN peer relationships between Leaf1 and Leaf2 in DC A and between Leaf3 and Leaf4 in DC B.</span><p><p># Configure a BGP EVPN peer relationship on Leaf1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-bgp] <strong>peer 2.2.2.2 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-bgp] <strong>peer 2.2.2.2 connect-interface LoopBack 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-bgp] <strong>l2vpn-family evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-bgp-af-evpn] <strong>peer 2.2.2.2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-bgp-af-evpn] <strong>peer 2.2.2.2 advertise encap-type vxlan</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-bgp-af-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1] <strong>commit</strong></pre>
<p>The configurations of Leaf2, Leaf3, and Leaf4 are similar to that of Leaf1. For detailed configurations, see <a href="#EN-US_TASK_0172363836__dc_vrp_vxlan_cfg_1205_section">Configuration Files</a>.</p>
</p></li><li class="substepexpand"><span>Configure an EVPN instance on each leaf node.</span><p><p># Configure Leaf1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf1] <strong>evpn vpn-instance evrf1 bd-mode</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-evpn-instance-evrf1] <strong>route-distinguisher 10:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-evpn-instance-evrf1] <strong>vpn-target 11:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-evpn-instance-evrf1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1] <strong>bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-bd10] <strong>vxlan vni 10 split-horizon-mode</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-bd10] <strong>evpn binding vpn-instance evrf1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-bd10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1] <strong>commit</strong></pre>
<p>The configurations of Leaf2, Leaf3, and Leaf4 are similar to that of Leaf1. For detailed configurations, see <a href="#EN-US_TASK_0172363836__dc_vrp_vxlan_cfg_1205_section">Configuration Files</a>.</p>
</p></li><li class="substepexpand"><span>Configure an ingress replication list on each leaf node.</span><p><p># Configure Leaf1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf1] <strong>interface nve 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-Nve1] <strong>source 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-Nve1] <strong>vni 10 head-end peer-list protocol bgp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-Nve1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1] <strong>commit</strong></pre>
<p>The configurations of Leaf2, Leaf3, and Leaf4 are similar to that of Leaf1. For detailed configurations, see <a href="#EN-US_TASK_0172363836__dc_vrp_vxlan_cfg_1205_section">Configuration Files</a>.</p>
</p></li></ol>
</li><li><span>Configure BGP EVPN on Leaf2 and Leaf3 to establish a VXLAN tunnel between them.</span><ol type="a"><li class="substepexpand"><span>Configure a BGP EVPN peer relationship.</span><p><p># Configure Leaf2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf2] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-bgp] <strong>peer 3.3.3.3 as-number 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-bgp] <strong>peer 3.3.3.3 connect-interface LoopBack 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-bgp] <strong>peer 3.3.3.3 ebgp-max-hop 255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-bgp] <strong>network 2.2.2.2 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-bgp] <strong>l2vpn-family evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-bgp-af-evpn] <strong>peer 3.3.3.3 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-bgp-af-evpn] <strong>peer 3.3.3.3 advertise encap-type vxlan</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-bgp-af-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2] <strong>commit</strong></pre>
<p># Configure Leaf3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf3] <strong>bgp 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf3-bgp] <strong>peer 2.2.2.2 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf3-bgp] <strong>peer 2.2.2.2 connect-interface LoopBack 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf3-bgp] <strong>peer 2.2.2.2 ebgp-max-hop 255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf3-bgp] <strong>network 3.3.3.3 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf3-bgp] <strong>l2vpn-family evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf3-bgp-af-evpn] <strong>peer 2.2.2.2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf3-bgp-af-evpn] <strong>peer 2.2.2.2 advertise encap-type vxlan</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf3-bgp-af-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf3-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf3] <strong>commit</strong></pre>
</p></li></ol>
</li><li><span>Configure Leaf2 and Leaf3 to advertise routes that are re-originated by the EVPN address family to BGP EVPN peers.</span><ol type="a"><li class="substepexpand"><span>Configure an SHG to which the BGP EVPN peers belong.</span><p><p># Configure Leaf2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf2] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf2-bgp] <strong>l2vpn-family evpn</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf2-bgp-af-evpn] <strong>peer 3.3.3.3 split-group sg1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-bgp-af-evpn] <strong>commit</strong></pre>
<p># Configure Leaf3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf3] <strong>bgp 200</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf3-bgp] <strong>l2vpn-family evpn</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf3-bgp-af-evpn] <strong>peer 2.2.2.2 split-group sg1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf3-bgp-af-evpn] <strong>commit</strong></pre>
</p></li><li class="substepexpand"><span>Enable the function of re-originating EVPN MAC routes.</span><p><p># Configure Leaf2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf2-bgp-af-evpn] <strong>peer 1.1.1.1 import reoriginate</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-bgp-af-evpn] <strong>peer 1.1.1.1 advertise route-reoriginated evpn mac</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-bgp-af-evpn] <strong>peer 3.3.3.3 import reoriginate</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-bgp-af-evpn] <strong>peer 3.3.3.3 advertise route-reoriginated evpn mac</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-bgp-af-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2] <strong>commit</strong></pre>
<p># Configure Leaf3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf3-bgp-af-evpn] <strong>peer 4.4.4.4 import reoriginate</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf3-bgp-af-evpn] <strong>peer 4.4.4.4 advertise route-reoriginated evpn mac</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf3-bgp-af-evpn] <strong>peer 2.2.2.2 import reoriginate</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf3-bgp-af-evpn] <strong>peer 2.2.2.2 advertise route-reoriginated evpn mac</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf3-bgp-af-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf3-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf3] <strong>commit</strong></pre>
</p></li></ol>
</li><li><span>Verify the configuration.</span><p><p>Run the <a href="cmdqueryname=display+vxlan+tunnel"><b><span class="cmdname">display vxlan tunnel</span></b></a> command on each leaf node to view information about the VXLAN tunnels. The following example uses the command output on Leaf2. The command output shows that the VXLAN tunnels are up.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf2] <strong>display vxlan tunnel</strong></pre>
<pre class="screen">Number of vxlan tunnel : 2
Tunnel ID   Source                Destination           State  Type     Uptime
-----------------------------------------------------------------------------------
4026531924  2.2.2.2               1.1.1.1               up     dynamic  00:39:19  
4026531925  2.2.2.2               3.3.3.3               up     dynamic  00:39:09 </pre>
<p>Run the <a href="cmdqueryname=display+vxlan+peer"><b><span class="cmdname">display vxlan peer</span></b></a> command on Leaf2 to check information about VXLAN peers.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf2] <strong>display vxlan peer</strong></pre>
<pre class="screen">Number of peers : 2
Vni ID    Source                  Destination            Type      Out Vni ID
-------------------------------------------------------------------------------
10        2.2.2.2                 1.1.1.1                dynamic   10         
10        2.2.2.2                 3.3.3.3                dynamic   20</pre>
<p>After the preceding configurations are complete, Layer 2 communication can be implemented between VM 1 and VM 2.</p>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0172363836__dc_vrp_vxlan_cfg_1205_section"><a name="EN-US_TASK_0172363836__dc_vrp_vxlan_cfg_1205_section"></a><a name="dc_vrp_vxlan_cfg_1205_section"></a><a name="EN-US_TASK_0172363836__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>Spine 1 configuration file</p>
<pre class="screen">#
sysname Spine1
#
interface GE<span>0/1/0</span>
 undo shutdown  
 ip address 192.168.10.1 255.255.255.0
#               
interface GE<span>0/2/0</span>
 undo shutdown  
 ip address 192.168.20.1 255.255.255.0
#               
ospf 1          
 area 0.0.0.0   
  network 192.168.10.0 0.0.0.255
  network 192.168.20.0 0.0.0.255
#               
return </pre>
</li><li><p>Leaf1 configuration file</p>
<pre class="screen">#
sysname Leaf1
#
evpn vpn-instance evrf1 bd-mode
 route-distinguisher 10:1
 vpn-target 11:1 export-extcommunity
 vpn-target 11:1 import-extcommunity
#
bridge-domain 10
 vxlan vni 10 split-horizon-mode
 evpn binding vpn-instance evrf1
#               
interface GE<span>0/1/0</span>
 undo shutdown  
 ip address 192.168.10.2 255.255.255.0
#               
interface GE<span>0/2/0</span>
 undo shutdown       
#               
interface GE<span>0/2/0</span>.1 mode l2
 encapsulation dot1q vid 10
 rewrite pop single
 bridge-domain 10
#               
interface LoopBack1
 ip address 1.1.1.1 255.255.255.255
#               
interface Nve1  
 source 1.1.1.1 
 vni 10 head-end peer-list protocol bgp
#               
bgp 100
 peer 2.2.2.2 as-number 100
 peer 2.2.2.2 connect-interface LoopBack1
 #
 ipv4-family unicast
  peer 2.2.2.2 enable
 #              
 l2vpn-family evpn
  undo policy vpn-target
  peer 2.2.2.2 enable
  peer 2.2.2.2 advertise encap-type vxlan
#               
ospf 1          
 area 0.0.0.0   
  network 1.1.1.1 0.0.0.0
  network 192.168.10.0 0.0.0.255
#               
return</pre>
</li><li><p>Leaf2 configuration file</p>
<pre class="screen">#
sysname Leaf2
#
evpn vpn-instance evrf1 bd-mode
 route-distinguisher 10:1
 vpn-target 11:1 export-extcommunity
 vpn-target 11:1 import-extcommunity
#
bridge-domain 10
 vxlan vni 10 split-horizon-mode
 evpn binding vpn-instance evrf1
#                         
interface GE<span>0/1/0</span>
 undo shutdown  
 ip address 192.168.20.2 255.255.255.0
#               
interface GE<span>0/2/0</span>
 undo shutdown  
 ip address 192.168.50.1 255.255.255.0
#               
interface LoopBack1
 ip address 2.2.2.2 255.255.255.255
#               
interface Nve1  
 source 2.2.2.2 
 vni 10 head-end peer-list protocol bgp
#               
bgp 100
 peer 1.1.1.1 as-number 100
 peer 1.1.1.1 connect-interface LoopBack1
 peer 3.3.3.3 as-number 200
 peer 3.3.3.3 ebgp-max-hop 255
 peer 3.3.3.3 connect-interface LoopBack1
 #
 ipv4-family unicast
  network 2.2.2.2 255.255.255.255
  peer 1.1.1.1 enable
  peer 3.3.3.3 enable
 #              
 l2vpn-family evpn
  undo policy vpn-target
  peer 1.1.1.1 enable
  peer 1.1.1.1 advertise encap-type vxlan
  peer 1.1.1.1 import reoriginate
  peer 1.1.1.1 advertise route-reoriginated evpn mac
  peer 3.3.3.3 enable
  peer 3.3.3.3 advertise encap-type vxlan
  peer 3.3.3.3 import reoriginate
  peer 3.3.3.3 advertise route-reoriginated evpn mac
  peer 3.3.3.3 split-group sg1
#
ospf 1          
 area 0.0.0.0   
  network 2.2.2.2 0.0.0.0
  network 192.168.20.0 0.0.0.255
#
ip route-static 3.3.3.3 255.255.255.255 192.168.50.2
#               
return  </pre>
</li><li><p>Spine 2 configuration file</p>
<pre class="screen">#
sysname Spine2
#
interface GE<span>0/1/0</span>
 undo shutdown  
 ip address 192.168.30.1 255.255.255.0
#               
interface GE<span>0/2/0</span>
 undo shutdown  
 ip address 192.168.40.1 255.255.255.0
#               
ospf 1          
 area 0.0.0.0   
  network 192.168.30.0 0.0.0.255
  network 192.168.40.0 0.0.0.255
#               
return</pre>
</li><li><p>Leaf3 configuration file</p>
<pre class="screen">#
sysname Leaf3
#
evpn vpn-instance evrf1 bd-mode
 route-distinguisher 10:1
 vpn-target 11:1 export-extcommunity
 vpn-target 11:1 import-extcommunity
#
bridge-domain 10
 vxlan vni 20 split-horizon-mode
 evpn binding vpn-instance evrf1
#               
interface GE<span>0/1/0</span>
 undo shutdown  
 ip address 192.168.30.2 255.255.255.0
#               
interface GE<span>0/2/0</span>
 undo shutdown  
 ip address 192.168.50.2 255.255.255.0

#               
interface LoopBack1
 ip address 3.3.3.3 255.255.255.255
#               
interface Nve1  
 source 3.3.3.3 
 vni 20 head-end peer-list protocol bgp
#               
bgp 200
 peer 2.2.2.2 as-number 100
 peer 2.2.2.2 ebgp-max-hop 255
 peer 2.2.2.2 connect-interface LoopBack1
 peer 4.4.4.4 as-number 200
 peer 4.4.4.4 connect-interface LoopBack1
 #
 ipv4-family unicast
  network 3.3.3.3 255.255.255.255
  peer 2.2.2.2 enable
  peer 4.4.4.4 enable
 #              
 l2vpn-family evpn
  undo policy vpn-target
  peer 2.2.2.2 enable
  peer 2.2.2.2 advertise encap-type vxlan
  peer 2.2.2.2 import reoriginate
  peer 2.2.2.2 advertise route-reoriginated evpn mac
  peer 2.2.2.2 split-group sg1
  peer 4.4.4.4 enable
  peer 4.4.4.4 advertise encap-type vxlan
  peer 4.4.4.4 import reoriginate
  peer 4.4.4.4 advertise route-reoriginated evpn mac
#               
ospf 1          
 area 0.0.0.0   
  network 3.3.3.3 0.0.0.0
  network 192.168.30.0 0.0.0.255
#
ip route-static 2.2.2.2 255.255.255.255 192.168.50.1
#               
return</pre>
</li><li><p>Leaf4 configuration file</p>
<pre class="screen">#
sysname Leaf4
#
evpn vpn-instance evrf1 bd-mode
 route-distinguisher 10:1
 vpn-target 11:1 export-extcommunity
 vpn-target 11:1 import-extcommunity
#
bridge-domain 10
 vxlan vni 20 split-horizon-mode
 evpn binding vpn-instance evrf1
#               
interface GE<span>0/1/0</span>
 undo shutdown  
 ip address 192.168.40.2 255.255.255.0
#                              
interface GE<span>0/2/0</span>
 undo shutdown       
#               
interface GE<span>0/2/0</span>.1 mode l2
 encapsulation dot1q vid 10
 rewrite pop single
 bridge-domain 10
#               
interface LoopBack1
 ip address 4.4.4.4 255.255.255.255
#               
interface Nve1  
 source 4.4.4.4 
 vni 20 head-end peer-list protocol bgp
#               
bgp 200
 peer 3.3.3.3 as-number 200
 peer 3.3.3.3 connect-interface LoopBack1
 #
 ipv4-family unicast
  peer 3.3.3.3 enable
 #              
 l2vpn-family evpn
  undo policy vpn-target
  peer 3.3.3.3 enable
  peer 3.3.3.3 advertise encap-type vxlan
#               
ospf 1          
 area 0.0.0.0   
  network 4.4.4.4 0.0.0.0
  network 192.168.40.0 0.0.0.255
#               
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vxlan_cfg_1015.html">Configuration Examples for VXLAN
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vxlan_cfg_1223.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vxlan_dci_cfg_0022.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>