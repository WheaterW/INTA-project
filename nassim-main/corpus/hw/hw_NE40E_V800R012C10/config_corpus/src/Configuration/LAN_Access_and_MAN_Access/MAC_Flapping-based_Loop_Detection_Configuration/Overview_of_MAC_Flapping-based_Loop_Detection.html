
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="concept">
<meta name="DC.Title" content="Overview of MAC Flapping-based Loop Detection">
<meta name="abstract" content="This section describes the MAC flapping-based loop detection application on a virtual private LAN service (VPLS) network in terms of background, introduction, and basic concepts.">
<meta name="description" content="This section describes the MAC flapping-based loop detection application on a virtual private LAN service (VPLS) network in terms of background, introduction, and basic concepts.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mflp_cfg_0000.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/spec/MAC-Flapping_limitation.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="wwx1238417">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="MAC-Flapping">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="MAC-Flapping">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="featurename" content="MAC-Flapping">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="OWNER" content="c00648116,w00437000">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="wwx1238417">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_CONCEPT_0172363495">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Overview of MAC Flapping-based Loop Detection</title>
</head>
<body><a name="EN-US_CONCEPT_0172363495"></a><a name="EN-US_CONCEPT_0172363495"></a>

<div class="articleBoxWithoutHead">

<h1 class="topicTitle-h1">Overview of MAC Flapping-based Loop Detection</h1>



<div><p>This section describes the MAC flapping-based loop detection application on a virtual private LAN service (VPLS) network in terms of background, introduction, and basic concepts.</p>

<div class="section"><h4 class="sectiontitle">Background</h4><p>Generally, redundant links are used on an Ethernet network
to provide link backup and enhance network reliability. Redundant
links, however, may produce loops and cause broadcast storms and MAC
address entry flapping. As a result, the communication quality deteriorates,
and communication services may even be interrupted. To eliminate loops
on the network, the spanning tree protocols or Layer 2 loop detection
technology was introduced. If you want to apply a spanning tree protocol,
the protocol must be supported and you need to configure it on each
user network device. If you want to apply the Layer 2 loop detection
technology, user network devices must allow Layer 2 loop detection
packets to pass. Therefore, the spanning tree protocols or the Layer
2 loop detection technology cannot be used to eliminate loops on user
networks with unknown connections or user networks that do not support
the spanning tree protocols or Layer 2 loop detection technology.</p>
<p>MAC flapping-based loop detection is introduced to address
this problem. It does not require protocol packet negotiation between
devices. A device independently checks whether a loop occurs on the
network based on MAC address entry flapping.</p>
</div>

<div class="section"><h4 class="sectiontitle">Introduction</h4><p>Devices can block redundant links based on the frequency of MAC address entry flapping to eliminate loops on the network.</p>
<p>On the virtual private LAN service (VPLS) network shown
in <a href="feature_0003992559.html#EN-US_CONCEPT_0172352701__fig_dc_vrp_mflp_feature_000801">Figure 1</a>, pseudo wires
(PWs) are established over Multiprotocol Label Switching (MPLS) tunnels
between virtual private network (VPN) sites to transparently transmit
Layer 2 packets. When forwarding packets, the provider edges (PEs)
learn the source MAC addresses of the packets, create MAC address
entries, and establish mapping between the MAC addresses and AC interfaces
and mapping between the MAC addresses and PWs.</p>
<div class="fignone"><span class="figcap"><b>Figure 1 </b>VPLS network with MAC flapping-based loop detection enabled</span>

<br><span><img class="vsd" id="EN-US_CONCEPT_0172363495__en-us_concept_0172352701_image879790450214253" src="images/fig_feature_image_0003993364.png"></span><br>
</div>
<div class="p">On the network shown in <a href="feature_0003992559.html#EN-US_CONCEPT_0172352701__fig_dc_vrp_mflp_feature_000801">Figure 1</a>, CE2 and CE3 are connected
to PE1 to provide redundant links. This deployment may generate loops
because the connections on the user network of CE2 and CE3 are unknown.
Specifically, if CE2 and CE3 are connected, PE1 interfaces connected
to CE2 and CE3 may receive user packets with the same source MAC address,
causing MAC address entry flapping or even damaging MAC address entries.
In this situation, you can deploy MAC flapping-based loop detection
on PE1 and configure a blocking policy for AC interfaces to prevent
such loops. The blocking policy can be either of the following:<ul id="EN-US_CONCEPT_0172363495__en-us_concept_0172352701_ul710255145214253"><li id="EN-US_CONCEPT_0172363495__en-us_concept_0172352701_li1697808775214253">Blocking interfaces based on their blocking priorities: If a device
detects a loop, it blocks the interface with a lower blocking priority.</li><li id="EN-US_CONCEPT_0172363495__en-us_concept_0172352701_li986617713214253">Blocking interfaces based on their trusted or untrusted states:
If a device detects a loop, it blocks the untrusted interface.</li></ul>
</div>
<p>MAC flapping-based loop detection can also detect PW-side
loops. The principles of blocking PWs are similar to those of blocking
AC interfaces.</p>
<div class="notice"><span class="noticetitle"><img src="../../../../public_sys-resources/notice_3.0-en-us.png"> </span><div class="noticebody"><p>After MAC flapping-based loop detection
is configured on a device and the device receives packets with fake
source MAC addresses from attackers, the device may mistakenly conclude
that a loop has occurred and block an interface based on the configured
blocking policy. Therefore, key user traffic may be blocked. It is
recommended that you disable MAC flapping-based loop detection on
properly running devices. If you have to use MAC flapping-based loop
detection to detect whether links operate properly during site deployment,
be sure to disable this function after this stage.</p>
</div></div>
</div>

<div class="section"><h4 class="sectiontitle">Basic Concepts</h4><div class="p">The basic concepts for MAC flapping-based loop detection are as follows:<ul id="EN-US_CONCEPT_0172363495__en-us_concept_0172352696_ul973220244214009"><li id="EN-US_CONCEPT_0172363495__en-us_concept_0172352696_li583927770214009"><p id="EN-US_CONCEPT_0172363495__en-us_concept_0172352696_p73763600214009"><a name="EN-US_CONCEPT_0172363495__en-us_concept_0172352696_li583927770214009"></a><a name="en-us_concept_0172352696_li583927770214009"></a><strong id="EN-US_CONCEPT_0172363495__en-us_concept_0172352696_b1331070914214253">Detection cycle</strong></p>
<p id="EN-US_CONCEPT_0172363495__en-us_concept_0172352696_p1598298104214009">If a device detects a specified number of MAC address entry flaps within a detection cycle, the device concludes that a loop has occurred. The detection cycle is configurable.</p>
</li><li id="EN-US_CONCEPT_0172363495__en-us_concept_0172352696_li1796650801214009"><p id="EN-US_CONCEPT_0172363495__en-us_concept_0172352696_p542451940214009"><a name="EN-US_CONCEPT_0172363495__en-us_concept_0172352696_li1796650801214009"></a><a name="en-us_concept_0172352696_li1796650801214009"></a><strong id="EN-US_CONCEPT_0172363495__en-us_concept_0172352696_b352755379214253">Temporary blocking</strong></p>
<p id="EN-US_CONCEPT_0172363495__en-us_concept_0172352696_p1930632536214009">If a device concludes that a loop has occurred, it blocks an interface or PW for a specified period of time.</p>
</li><li id="EN-US_CONCEPT_0172363495__en-us_concept_0172352696_li868644435214009"><p id="EN-US_CONCEPT_0172363495__en-us_concept_0172352696_p713186739214009"><a name="EN-US_CONCEPT_0172363495__en-us_concept_0172352696_li868644435214009"></a><a name="en-us_concept_0172352696_li868644435214009"></a><strong id="EN-US_CONCEPT_0172363495__en-us_concept_0172352696_b1049285302214253">Permanent blocking</strong></p>
<p id="EN-US_CONCEPT_0172363495__en-us_concept_0172352696_p1518958282214009">After an interface or a PW is blocked and then unblocked, if the total number of times that loops occur exceeds the configured allowed maximum number, the interface or PW is permanently blocked.</p>
<p id="EN-US_CONCEPT_0172363495__en-us_concept_0172352696_p1494699654214009">An interface or PW that is permanently blocked can be unblocked only manually.</p>
</li><li id="EN-US_CONCEPT_0172363495__en-us_concept_0172352696_li1386146331214009"><p id="EN-US_CONCEPT_0172363495__en-us_concept_0172352696_p1058782461214009"><a name="EN-US_CONCEPT_0172363495__en-us_concept_0172352696_li1386146331214009"></a><a name="en-us_concept_0172352696_li1386146331214009"></a><strong id="EN-US_CONCEPT_0172363495__en-us_concept_0172352696_b1276734619214253">Blocking policy</strong></p>
<div class="p" id="EN-US_CONCEPT_0172363495__en-us_concept_0172352696_p_001">MAC flapping-based loop detection has the following blocking policies:<ul id="EN-US_CONCEPT_0172363495__en-us_concept_0172352696_ul1648038648214009"><li id="EN-US_CONCEPT_0172363495__en-us_concept_0172352696_li1143264726214009"><p id="EN-US_CONCEPT_0172363495__en-us_concept_0172352696_p1314060173214009"><a name="EN-US_CONCEPT_0172363495__en-us_concept_0172352696_li1143264726214009"></a><a name="en-us_concept_0172352696_li1143264726214009"></a>Blocking interfaces based on their blocking priorities</p>
<p id="EN-US_CONCEPT_0172363495__en-us_concept_0172352696_p1381790581214009">The blocking priority of an interface can be configured. When detecting a loop, a device blocks the interface with a lower blocking priority.</p>
</li><li id="EN-US_CONCEPT_0172363495__en-us_concept_0172352696_li349110314214009"><p id="EN-US_CONCEPT_0172363495__en-us_concept_0172352696_p571723794214009"><a name="EN-US_CONCEPT_0172363495__en-us_concept_0172352696_li349110314214009"></a><a name="en-us_concept_0172352696_li349110314214009"></a>Blocking interfaces based on their trusted or untrusted states (accurate blocking)</p>
<p id="EN-US_CONCEPT_0172363495__en-us_concept_0172352696_p626161605214009">If a dynamic MAC address entry remains the same in the MAC address table within a specified period and is not deleted, the outbound interface in the MAC address entry is trusted. When detecting a loop, a device blocks an interface that is not trusted.</p>
</li></ul>
</div>
</li><li id="EN-US_CONCEPT_0172363495__en-us_concept_0172352696_li1161125315214009"><p id="EN-US_CONCEPT_0172363495__en-us_concept_0172352696_p849268916214009"><a name="EN-US_CONCEPT_0172363495__en-us_concept_0172352696_li1161125315214009"></a><a name="en-us_concept_0172352696_li1161125315214009"></a><strong id="EN-US_CONCEPT_0172363495__en-us_concept_0172352696_b1210918026214253">Accurate blocking</strong></p>
<p id="EN-US_CONCEPT_0172363495__en-us_concept_0172352696_p_003">After MAC flapping-based loop detection is deployed on a device and the device detects a loop, the device blocks an AC interface with a lower blocking priority by default. However, MAC address entries of interfaces without loops may change due to the impact from a remote loop, and traffic over the interfaces with lower blocking priorities is interrupted. To address this problem, deploy accurate blocking of MAC flapping-based loop detection. Accurate blocking determines trusted and untrusted interfaces by analyzing the frequency of MAC address entry flapping. When a MAC address entry changes repeatedly, accurate blocking can accurately locate and block the interface with a loop, which is an untrusted interface.</p>
<p id="EN-US_CONCEPT_0172363495__en-us_concept_0172352696_p6575819184218">For PWs, accurate blocking in the MAC flapping-based loop detection function records trusted PWs. When the MAC address table corresponding to a PW flaps, this function can quickly locate the point where a loop occurs and block the PW.</p>
</li></ul>
</div>
</div>

</div>


</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mflp_cfg_0000.html">MAC Flapping-based Loop Detection Configuration
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/spec/MAC-Flapping_limitation.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>