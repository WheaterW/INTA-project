
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring QinQ-based BPDU Tunneling">
<meta name="abstract" content="In this example, provider edges (PEs) function as aggregation devices. When the PEs are connected to a large number of user networks, you can configure 802.1Q in 802.1Q (QinQ)-based bridge protocol data unit (BPDU) tunneling. QinQ-based BPDU tunneling enables the customer edges (CEs) to allocate different virtual local area network (VLAN) tags to BPDUs and enables the PEs to allocate different outer VLAN tags to the BPDUs based on the CE VLAN IDs. QinQ-based BPDU tunneling differentiates BPDUs from different user networks and saves VLAN ID resources for the carrier network.">
<meta name="description" content="In this example, provider edges (PEs) function as aggregation devices. When the PEs are connected to a large number of user networks, you can configure 802.1Q in 802.1Q (QinQ)-based bridge protocol data unit (BPDU) tunneling. QinQ-based BPDU tunneling enables the customer edges (CEs) to allocate different virtual local area network (VLAN) tags to BPDUs and enables the PEs to allocate different outer VLAN tags to the BPDUs based on the CE VLAN IDs. QinQ-based BPDU tunneling differentiates BPDUs from different user networks and saves VLAN ID resources for the carrier network.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bpdu-tunnel_cfg_0022.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bpdu-tunnel_cfg_0025.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="wwx1238417">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="BPDU Tunnel">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BPDU Tunnel">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="featurename" content="BPDU Tunnel">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="featurename" content="BPDU Tunnel">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="OWNER" content="c00648116,w00437000">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="wwx1238417">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172363732">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring QinQ-based BPDU Tunneling</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172363732"></a><a name="EN-US_TASK_0172363732"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring QinQ-based BPDU Tunneling</h1>
<div class="taskbody"><p>In this example, provider edges (PEs) function as aggregation devices. When the PEs are connected to a large number of user networks, you can configure 802.1Q in 802.1Q (QinQ)-based bridge protocol data unit (BPDU) tunneling. QinQ-based BPDU tunneling enables the customer edges (CEs) to allocate different virtual local area network (VLAN) tags to BPDUs and enables the PEs to allocate different outer VLAN tags to the BPDUs based on the CE VLAN IDs. QinQ-based BPDU tunneling differentiates BPDUs from different user networks and saves VLAN ID resources for the carrier network.</p>
<div class="context"><a name="EN-US_TASK_0172363732__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0172363732__fig_dc_vrp_bpdu-tunnel_cfg_002601">Figure 1</a>, the CEs are connected to the PEs, BPDUs sent by CE1 and CE2 to the PEs carry the VLAN ID 100, and BPDUs sent by CE3 and CE4 to the PEs carry the VLAN ID 200. In this situation, you can configure QinQ-based BPDU tunneling on the PEs to achieve the following:</p>
<ul><li><p>The devices in VLAN 100 can complete the spanning tree calculation together.</p>
</li><li><p>The devices in VLAN 200 can complete the spanning tree calculation together.</p>
</li></ul>
<p>To save public VLAN ID resources, configure VLAN stacking on the PEs. This configuration enables the PEs to add the outer VLAN ID 10 to BPDUs carrying VLAN ID 100 and VLAN ID 200 received from the CEs. Therefore, each BPDU transmitted over the carrier network carries two VLAN tags.</p>
<p>This example describes the configuration on devices with different roles.</p>
<ul><li><p>The CEs are configured as customers. The default well-known destination MAC address of BPDUs sent by the CEs is 0180-C200-0000.</p>
</li><li><p>The PEs are configured as providers. The default well-known destination MAC address of BPDUs sent by the PEs is 0180-C200-0008.</p>
</li></ul>
<div class="fignone" id="EN-US_TASK_0172363732__fig_dc_vrp_bpdu-tunnel_cfg_002601"><a name="EN-US_TASK_0172363732__fig_dc_vrp_bpdu-tunnel_cfg_002601"></a><a name="fig_dc_vrp_bpdu-tunnel_cfg_002601"></a><span class="figcap"><b>Figure 1 </b>Networking for configuring QinQ-based BPDU tunneling</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 through 3 in this example are GE <span>0/1/1</span>, GE <span>0/1/2</span>, GE <span>0/1/3</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_bpdu-tunnel_cfg_002601.png"></span><br></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172363732__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Enable the spanning tree calculation on the CEs and PEs.</p>
</li><li><p>Configure the CEs to add specified VLAN IDs to BPDUs before sending them to the PEs.</p>
</li><li><p>Disable the spanning tree calculation on the PE interfaces that are connected to the CEs, and configure the PEs as providers to transparently transmit BPDUs.</p>
</li><li><p>Enable VLAN stacking on the Layer 2 interfaces of the PEs so that the PEs add the outer VLAN ID 10 to BPDUs with the specified VLAN IDs received from the CEs before forwarding them over the carrier network.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172363732__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>Inner VLAN IDs of BPDUs sent by the CEs to the PEs</p>
</li><li><p>Outer VLAN ID that the PEs add to received BPDUs</p>
</li><li><p>IDs of the VLANs to which the interfaces on the PEs and CEs belong</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172363732__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Switch the interfaces on the PEs and CEs that transmit BPDUs to Layer 2 interfaces.</span><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>If an interface is a Layer 2 interface, skip this step.</p>
</div></div>
<p>Run the <a href="cmdqueryname=portswitch"><b><span class="cmdname">portswitch</span></b></a> command to switch all the PE and CE interfaces in <a href="#EN-US_TASK_0172363732__fig_dc_vrp_bpdu-tunnel_cfg_002601">Figure 1</a> to Layer 2 interfaces. For configuration details, see "Configuration Files" in this section.</p>
</p></li><li><span>Enable the spanning tree calculation on the CEs and PEs.</span><p><p># Configure CE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>stp enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>commit</strong></pre>
<p># Configure CE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>stp enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>commit</strong></pre>
<p># Configure CE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE3] <strong>stp enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3] <strong>commit</strong></pre>
<p># Configure CE4.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE4]<strong> stp enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE4] <strong>commit</strong></pre>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>stp enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>stp enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</p></li><li><span>Configure CE1 and CE2 to add the VLAN ID 100 to BPDUs before sending them to the PEs. Configure CE3 and CE4 to add the VLAN ID 200 to BPDUs before sending them to the PEs.</span><p><p># Configure CE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>vlan 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-vlan100] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1-vlan100] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1]<strong> interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1-GigabitEthernet<span>0/1/1</span>]<strong> port trunk allow-pass vlan 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/1</span>]<strong> stp bpdu vlan 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/1</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<p># Configure CE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>vlan 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-vlan100] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2-vlan100] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2]<strong> interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2-GigabitEthernet<span>0/1/1</span>]<strong> port trunk allow-pass vlan 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>]<strong> stp bpdu vlan 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2-GigabitEthernet<span>0/1/1</span>]<strong> quit</strong></pre>
<p># Configure CE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE3]<strong> vlan 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-vlan200] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE3-vlan200] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE3] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE3-GigabitEthernet<span>0/1/1</span>]<strong> port trunk allow-pass vlan 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-GigabitEthernet<span>0/1/1</span>]<strong> stp bpdu vlan 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-GigabitEthernet<span>0/1/1</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE3-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<p># Configure CE4.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE4]<strong> vlan 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE4-vlan200] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE4-vlan200] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE4]<strong> interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE4-GigabitEthernet<span>0/1/1</span>]<strong> port trunk allow-pass vlan 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE4-GigabitEthernet<span>0/1/1</span>]<strong> stp bpdu vlan 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE4-GigabitEthernet<span>0/1/1</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE4-GigabitEthernet<span>0/1/1</span>]<strong> quit</strong></pre>
</p></li><li><span>Configure the PEs as providers.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bpdu-tunnel stp bridge role provider</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>bpdu-tunnel stp bridge role provider</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</p></li><li><span>Configure VLAN stacking on the PEs so that the PEs add the outer VLAN ID 10 to BPDUs with the VLAN IDs 100 and 200 received from the CEs before forwarding them over the carrier network.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>vlan 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Vlan10]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-Vlan10]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> interface gigabitethernet <span>0/1/3</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/3</span>]<strong> port trunk allow-pass vlan 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/3</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>]<strong> port vlan-stacking vlan 100 stack-vlan 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>]<strong> stp disable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/2</span>]<strong> port vlan-stacking vlan 200 stack-vlan 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/2</span>]<strong> stp disable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>vlan 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Vlan10]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-Vlan10]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2]<strong> interface gigabitethernet <span>0/1/3</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-GigabitEthernet<span>0/1/3</span>]<strong> port trunk allow-pass vlan 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/3</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>]<strong> port vlan-stacking vlan 100 stack-vlan 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>]<strong> stp disable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/2</span>]<strong> port vlan-stacking vlan 200 stack-vlan 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/2</span>]<strong> stp disable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> commit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p>Run the <a href="cmdqueryname=display+stp"><b><span class="cmdname">display stp</span></b></a> command on CE1 and CE2 to view the root bridge selected by the Multiple Spanning Tree Protocol (MSTP). The command output shows that CE1 and CE2 have completed the spanning tree calculation and that GE<span>0/1/1</span> on CE1 is the <strong>Root</strong> interface and GE<span>0/1/1</span> on CE2 is the <strong>Designated</strong> interface.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>display stp</strong></pre>
<pre class="screen">-------[CIST Global Info] [Mode MSTP] -------
CIST Bridge         :32768.00e0-fc9f-3257
Bridge Times        :Hello 2s MaxAge 20s FwDly 15s MaxHop 20
Active Times        :Hello 2s MaxAge 20s FwDly 15s MaxHop 19
CIST Root/ERPC      :<strong>32768.00e0-fc12-3458 / 199999</strong>
CIST RegRoot/IRPC   :<strong>32768.00e0-fc12-3456 / 0</strong>
CIST RootPortId     :128.82
BPDU-Protection     :disabled
TC or TCN received  :6
TC count per hello  :0
STP Converge Mode   :Normal
Time since last TC received :0 days 2h:24m:36s
Number of TC        :2
Last  TC  occurred  :GigabitEthernet<span>0/1/1</span>
----[Port1(GigabitEthernet<span>0/1/1</span>)] [FORWARDING] ----
Port Protocol       :Enabled
 Port Role           :<strong>CIST Root Port</strong>
 Port Priority       :128
 Port Cost(Dot1T )   :Config=auto / Active=200000000
 Desg. Bridge/Port   :32768.00e0-fc9a-4315 / 128.82
 Port Edged          :Config=disabled / Active=disabled
 Point-to-point      :Config=auto / Active=true
 Transit Limit       :147 packets/hello-time
 Protection Type     :None
 Port STP Mode       :MSTP
  Port Protocol Type  :Config=auto / Active=dot1s
 BPDU Encapsulation  :Config=stp / Active=stp
 PortTimes           :Hello 2s MaxAge 20s FwDly 15s RemHop 20
 TC or TCN send      :2
 TC or TCN received  :0
 BPDU Sent           :7
          TCN: 0, Config: 0, RST: 0, MST: 7
 BPDU Received       :105
          TCN: 0, Config: 0, RST: 0, MST: 105</pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>display stp</strong></pre>
<pre class="screen">-------[CIST Global Info] [Mode MSTP] -------
CIST Bridge         :32768.00e0-fc9a-4315
Bridge Times        :Hello 2s MaxAge 20s FwDly 15s MaxHop 20
Active Times        :Hello 2s MaxAge 20s FwDly 15s MaxHop 19
CIST Root/ERPC      :<strong>32768.00e0-fc12-3458 / 0</strong>
CIST RegRoot/IRPC   :<strong>32768.00e0-fc12-3458 / 0</strong>
CIST RootPortId     :0.0
BPDU-Protection     :disabled
TC or TCN received  :3
TC count per hello  :0
STP Converge Mode   :Normal
Time since last TC received :0 days 2h:26m:42s
Number of TC        :1
Last TC occurred    :GigabitEthernet<span>0/1/1</span>
----[Port1(GigabitEthernet<span>0/1/1</span>)] [FORWARDING] ----
 Port Protocol       :enabled
 Port Role           :<strong>CIST Designated Port</strong>
 Port Priority       :128
 Port Cost(Dot1T )   :Config=auto / Active=199999
 Desg. Bridge/Port   :32768.00e0-fc9a-4315 / 128.82
 Port Edged          :Config=disabled / Active=disabled
 Point-to-point      :Config=auto / Active=true
 Transit Limit       :3 packets/hello-time
 Protection Type     :None
 Port STP Mode       :MSTP
 Port Protocol Type  :Config=auto / Active=dot1s
 BPDU Encapsulation  :Config=stp / Active=stp
 PortTimes           :Hello 2s MaxAge 20s FwDly 15s RemHop 19
 TC or TCN send      :0
 TC or TCN received  :0
 BPDU Sent           :82
          TCN: 0, Config: 0, RST: 0, MST: 82
 BPDU Received       :0
          TCN: 0, Config: 0, RST: 0, MST: 0</pre>
<p>Run the <strong>display stp</strong> command on CE3 and CE4 to view the root bridge selected by MSTP. The command output shows that CE3 and CE4 have completed the spanning tree calculation. GE0/1/1 on CE3 is the <strong>Root</strong> interface and GE0/1/1 on CE4 is the <strong>Designated</strong> interface.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE3] <strong>display stp</strong></pre>
<pre class="screen">-------[CIST Global Info][Mode MSTP]-------
CIST Bridge         :32768.00e0-fc12-3459
Bridge Times        :Hello 2s MaxAge 20s FwDly 15s MaxHop 20
Active Times        :Hello 2s MaxAge 20s FwDly 15s MaxHop 19
CIST Root/ERPC      :<strong>32768.00e0-fc12-3457 / 199999</strong>
CIST RegRoot/IRPC   :<strong>32768.00e0-fc12-3459 / 0</strong>
CIST RootPortId     :128.82
BPDU-Protection     :disabled
TC or TCN received  :0
TC count per hello  :0
STP Converge Mode   :Normal
Time since last TC received :0 days 10h:54m:37s   
Number of TC        :1
Last TC occurred    :GigabitEthernet<span>0/1/1</span>
----[Port1(GigabitEthernet<span>0/1/1</span>)][FORWARDING]----
 Port Protocol       :enabled
 Port Role           :<strong>CIST Root Port</strong>
 Port Priority       :128
 Port Cost(Dot1T )   :Config=auto / Active=199999
 Desg. Bridge/Port   :32768.00e0-fc12-3457 / 128.82
 Port Edged          :Config=disabled / Active=disabled
 Point-to-point      :Config=auto / Active=true
 Transit Limit       :3 packets/hello-time
 Protection Type     :None
 Port STP Mode       :MSTP
 Port Protocol Type  :Config=auto / Active=dot1s
 BPDU Encapsulation  :Config=stp / Active=stp
 PortTimes           :Hello 2s MaxAge 20s FwDly 15s RemHop 20
 TC or TCN send      :2
 TC or TCN received  :0
 BPDU Sent           :7
          TCN: 0, Config: 0, RST: 0, MST: 7
 BPDU Received       :105
          TCN: 0, Config: 0, RST: 0, MST: 105</pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE4] <strong>display stp</strong></pre>
<pre class="screen">-------[CIST Global Info][Mode MSTP]-------
CIST Bridge         :32768.00e0-fc12-3457
Bridge Times        :Hello 2s MaxAge 20s FwDly 15s MaxHop 20
Active Times        :Hello 2s MaxAge 20s FwDly 15s MaxHop 19
CIST Root/ERPC      :32768.00e0-fc12-3457 / 0
CIST RegRoot/IRPC   :<strong>32768.00e0-fc12-3457 / 0</strong>
CIST RootPortId     :0.0
BPDU-Protection     :disabled
TC or TCN received  :4
TC count per hello  :0
STP Converge Mode   :Normal
Time since last TC received :0 days 8h:59m:18s
Number of TC        :1
Last TC occurred    :GigabitEthernet<span>0/1/1</span>
----[Port1(GigabitEthernet<span>0/1/1</span>)][FORWARDING]----
 Port Protocol       :enabled
 Port Role           :CIST Designated Port
 Port Priority       :128
 Port Cost(Dot1T )   :Config=auto / Active=199999
 Desg. Bridge/Port   :32768.00e0-fc12-3457 / 128.82
 Port Edged          :Config=disabled / Active=disabled
 Point-to-point      :Config=auto / Active=true
 Transit Limit       :3 packets/hello-time
 Protection Type     :None
 Port STP Mode       :MSTP
 Port Protocol Type  :Config=auto / Active=dot1s
 BPDU Encapsulation  :Config=stp / Active=stp
 PortTimes           :Hello 2s MaxAge 20s FwDly 15s RemHop 20
 TC or TCN send      :2
 TC or TCN received  :0
 BPDU Sent           :7
          TCN: 0, Config: 0, RST: 0, MST: 7
 BPDU Received       :105
          TCN: 0, Config: 0, RST: 0, MST: 105</pre>
<p>Run the <a href="cmdqueryname=display+vlan"><b><span class="cmdname">display vlan</span></b></a> command on the PEs to view VLAN stacking information.</p>
<p>The command output on PE1 is used as an example. </p>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>display vlan 10 verbose</strong></pre>
<pre class="screen">  VLAN ID      : 10</pre>
<pre class="screen">  VLAN Type    : Common</pre>
<pre class="screen">  Description  : VLAN 0010</pre>
<pre class="screen">  Status       : Enable</pre>
<pre class="screen">  Broadcast    : Enable</pre>
<pre class="screen">  MAC learning : Enable</pre>
<pre class="screen">  Statistics   : Disable</pre>
<pre class="screen">  ----------------</pre>
<pre class="screen">  Tagged     Port: GigabitEthernet<span>0/1/3</span></pre>
<pre class="screen">  ----------------</pre>
<pre class="screen">  QinQ-stack Port: GigabitEthernet<span>0/1/1</span>       GigabitEthernet<span>0/1/2</span></pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172363732__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>CE1 configuration file</p>
<pre class="screen">#</pre>
<pre class="screen"> sysname CE1</pre>
<pre class="screen">#</pre>
<pre class="screen"> vlan batch 100</pre>
<pre class="screen">#</pre>
<pre class="screen"> stp enable</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/1</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> portswitch</pre>
<pre class="screen"> port trunk allow-pass vlan 100</pre>
<pre class="screen"> stp bpdu vlan 100</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p>CE2 configuration file</p>
<pre class="screen">#</pre>
<pre class="screen"> sysname CE2</pre>
<pre class="screen">#</pre>
<pre class="screen"> vlan batch 100</pre>
<pre class="screen">#</pre>
<pre class="screen"> stp enable</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/1</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> portswitch</pre>
<pre class="screen"> port trunk allow-pass vlan 100</pre>
<pre class="screen"> stp bpdu vlan 100</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p>CE3 configuration file</p>
<pre class="screen">#</pre>
<pre class="screen"> sysname CE3</pre>
<pre class="screen">#</pre>
<pre class="screen"> vlan batch 200</pre>
<pre class="screen">#</pre>
<pre class="screen"> stp enable</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/1</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> portswitch</pre>
<pre class="screen"> port trunk allow-pass vlan 200</pre>
<pre class="screen"> stp bpdu vlan 200</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p>CE4 configuration file</p>
<pre class="screen">#</pre>
<pre class="screen"> sysname CE4</pre>
<pre class="screen">#</pre>
<pre class="screen"> vlan batch 200</pre>
<pre class="screen">#</pre>
<pre class="screen"> stp enable</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/1</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> portswitch</pre>
<pre class="screen"> port trunk allow-pass vlan 200</pre>
<pre class="screen"> stp bpdu vlan 200</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p>PE1 configuration file</p>
<pre class="screen">#</pre>
<pre class="screen"> sysname PE1</pre>
<pre class="screen">#</pre>
<pre class="screen"> vlan batch 100</pre>
<pre class="screen">#</pre>
<pre class="screen"> bpdu-tunnel stp bridge role provider</pre>
<pre class="screen">#</pre>
<pre class="screen"> stp enable</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/1</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> portswitch</pre>
<pre class="screen"> port vlan-stacking vlan 100 stack-vlan 10</pre>
<pre class="screen"> stp disable</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/2</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> portswitch</pre>
<pre class="screen"> port vlan-stacking vlan 200 stack-vlan 10</pre>
<pre class="screen"> stp disable</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/3</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> portswitch</pre>
<pre class="screen"> port trunk allow-pass vlan 10</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#</pre>
<pre class="screen"> sysname PE2</pre>
<pre class="screen">#</pre>
<pre class="screen"> vlan batch 100</pre>
<pre class="screen">#</pre>
<pre class="screen"> bpdu-tunnel stp bridge role provider</pre>
<pre class="screen">#</pre>
<pre class="screen"> stp enable</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/1</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> portswitch</pre>
<pre class="screen"> port vlan-stacking vlan 100 stack-vlan 10</pre>
<pre class="screen"> stp disable</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/2</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> portswitch</pre>
<pre class="screen"> port vlan-stacking vlan 200 stack-vlan 10</pre>
<pre class="screen"> stp disable</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/3</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> portswitch</pre>
<pre class="screen"> port trunk allow-pass vlan 10</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bpdu-tunnel_cfg_0022.html">Configuration Examples for BPDU Tunneling
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bpdu-tunnel_cfg_0025.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>
</body>
</html>