
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring a VXLAN Tunnel">
<meta name="abstract" content="To allow VXLAN tunnel establishment between VTEPs using EVPN, establish a BGP EVPN peer relationship, configure an EVPN instance, and configure ingress replication.">
<meta name="description" content="To allow VXLAN tunnel establishment between VTEPs using EVPN, establish a BGP EVPN peer relationship, configure an EVPN instance, and configure ingress replication.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vxlan_cfg_0017b.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vxlan6_cfg_0018b.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vxlan_cfg_1215.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="h00847023">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="OWNER" content="p00915595">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="p00915595">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172363801">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring a VXLAN Tunnel</title>
</head>
<body><a name="EN-US_TASK_0172363801"></a><a name="EN-US_TASK_0172363801"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring a VXLAN Tunnel</h1>
<div class="taskbody"><p>To allow VXLAN tunnel establishment between VTEPs using EVPN, establish a BGP EVPN peer relationship, configure an EVPN instance, and configure ingress replication.</p>
<div class="context"><a name="EN-US_TASK_0172363801__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><div class="p">In centralized VXLAN gateway scenarios, perform the following steps on the Layer 2 and Layer 3 VXLAN gateways to use EVPN for establishing VXLAN tunnels:<ol><li><p>Configure a BGP EVPN peer relationship. Configure VXLAN gateways to establish BGP EVPN peer relationships so that they can exchange EVPN routes. If an RR has been deployed, each VXLAN gateway only needs to establish a BGP EVPN peer relationship with the RR.</p>
</li><li><p>(Optional) Configure an RR. After an RR is configured, each VXLAN gateway only needs to establish a BGP EVPN peer relationship with the RR. RR deployment reduces the number of BGP EVPN peer relationships to be established, simplifying configurations. A live-network device can be used as an RR, or a standalone RR can be deployed. Layer 3 VXLAN gateways are generally used as RRs, and Layer 2 VXLAN gateways as RR clients.</p>
</li><li><p>Configure an EVPN instance. EVPN instances can be used to manage EVPN routes received from and advertised to BGP EVPN peers.</p>
</li><li><p>Configure ingress replication. After ingress replication is configured for a VNI, the system uses BGP EVPN to construct a list of remote VTEPs. After a VXLAN gateway receives BUM packets, its sends a copy of the BUM packets to every VXLAN gateway in the list.</p>
</li></ol>
</div>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>BUM packet forwarding is implemented only using ingress replication. To establish a VXLAN tunnel between a Huawei device and a non-Huawei device, ensure that the non-Huawei device also has ingress replication configured. Otherwise, communication fails.</p>
</div></div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172363801__1.4.2"></a><a name="1.4.2"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li id="EN-US_TASK_0172363801__bgp_evpn_peer"><span id="EN-US_TASK_0172363801__">Configure a BGP EVPN peer relationship.</span><ol type="a"><li class="substepexpand"><span>Run <span><a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span></span><p><p>BGP is enabled, and the BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=router-id"><b><span class="cmdname">router-id</span></b></a> <i><span class="varname">router-id-value</span></i></span><p><p>A BGP router ID is set.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <strong><span>as-number</span></strong> <i><span class="varname">as-number</span></i></span></span><p><p>The peer device is configured as a BGP peer.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <span><a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <strong><span>connect-interface</span></strong> <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i> [ <i><span class="varname">ipv4-source-address</span></i> ]</span></span><p><p>A source interface and a source address are specified to set up a TCP connection with the BGP peer.</p>
</p><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>When loopback interfaces are used to establish a BGP connection, running the <a href="cmdqueryname=peer+connect-interface"><b><span class="cmdname">peer connect-interface</span></b></a> command on both ends is recommended to ensure the connectivity. If this command is run on only one end, the BGP connection may fail to be established.</p>
</div></div>
</p></li><li class="substepexpand"><span>(Optional) Run <span><a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <a href="cmdqueryname=ebgp-max-hop"><b><span class="cmdname">ebgp-max-hop</span></b></a> [ <i><span class="varname">hop-count</span></i> ]</span></span><p><p>The maximum number of hops is set for an EBGP EVPN connection.</p>
</p><p><p>In most cases, a directly connected physical link must be available between EBGP EVPN peers. If you want to establish EBGP EVPN peer relationships between indirectly connected devices, run the <a href="cmdqueryname=peer+ebgp-max-hop"><b><span class="cmdname">peer ebgp-max-hop</span></b></a> command. The command also can configure the maximum number of hops for an EBGP EVPN TCP connection.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>When a loopback interface is used to establish an EBGP EVPN peer relationship, run the <a href="cmdqueryname=peer+ebgp-max-hop"><b><span class="cmdname">peer ebgp-max-hop</span></b></a> command (of which the value of <i><span class="varname">hop-count</span></i> is not less than 2). Otherwise, the peer relationship fails to be established.</p>
</div></div>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=l2vpn-family+evpn"><b><span class="cmdname">l2vpn-family evpn</span></b></a></span></span><p><p>The BGP-EVPN address family view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">group-name</span></i> | <i><span class="varname">ipv4-address</span></i> } <strong><span>enable</span></strong></span></span><p><p>The device is enabled to exchange EVPN routes with a specified peer or peer group.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">group-name</span></i> | <i><span class="varname">ipv4-address</span></i> } <strong><span>advertise encap-type vxlan</span></strong></span><p><p>The device is enabled to advertise EVPN routes that carry the VXLAN encapsulation attribute to the peer or peer group.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <span><a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">group-name</span></i> | <i><span class="varname">ipv4-address</span></i> } <strong><span>route-policy</span></strong> <i><span class="varname">route-policy-name</span></i> { <strong><span>import</span></strong> | <strong><span>export</span></strong> }</span></span><p><p>A routing policy is specified for routes received from or to be advertised to a BGP EVPN peer or peer group.</p>
</p><p><p>After the routing policy is applied, the routes received from or to be advertised to a specified BGP EVPN peer or peer group will be filtered, ensuring that only desired routes are imported or advertised. This configuration helps manage routes and reduce required routing entries and system resources.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <span><a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">group-name</span></i> | <i><span class="varname">ipv4-address</span></i> } <a href="cmdqueryname=mac-limit"><b><span class="cmdname">mac-limit</span></b></a> <i><span class="varname">number</span></i> [ <i><span class="varname">percentage</span></i> ] [ <strong><span>alert-only</span></strong> | <strong><span>idle-forever</span></strong> | <strong><span>idle-timeout</span></strong> <i><span class="varname">times</span></i> ]</span></span><p><p>The maximum number of MAC advertisement routes that can be received from each peer is configured.</p>
<p>If an EVPN instance may import many invalid MAC advertisement routes from peers and these routes occupy a large proportion of the total MAC advertisement routes. If the received MAC advertisement routes exceed the specified maximum number, the system displays an alarm, instructing users to check the validity of the MAC advertisement routes received in the EVPN instance.</p>
</p></li><li class="substepexpand"><span>(Optional) Perform the following operations to enable the function to advertise the routes carrying the large-community attribute to BGP EVPN peers:</span><p><p>The large-community attribute includes a 2-byte or 4-byte AS number and two 4-byte <strong>LocalData</strong> fields, allowing the administrator to flexibly use route-policies. Before enabling the function to advertise the routes carrying the large-community attribute to BGP EVPN peers, <a href="dc_vrp_bgp_cfg_4059.html">configure the route-policy related to the large-community attribute</a> and use the route-policy to set the large-community attribute.</p>
</p><p><ol class="substepthirdol"><li><p>Run <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>route-policy</span></strong> <i><span class="varname">route-policy-name</span></i> <strong><span>export</span></strong></p>
<p>The outbound route-policy of the BGP EVPN peer is configured.</p>
</li><li><p>Run <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>advertise-large-community</span></strong></p>
<p>The device is enabled to advertise the routes carrying the large-community attribute to BGP EVPN peers or peer groups.</p>
<p>If the routes carrying the large-community attribute does not need to be advertised to one BGP EVPN peer in the peer group, run the <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <strong><span>advertise-large-community</span></strong> <strong><span>disable</span></strong> command.</p>
</li></ol>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <strong><span>graceful-restart static-timer</span></strong> <i><span class="varname">restart-time</span></i></span><p><p>The maximum duration from the time the local device finds that the peer device is restarted to the time a BGP EVPN session is re-established is set.</p>
</p><p><p>BGP GR prevents traffic interruptions caused by re-establishment of a BGP peer relationship. You can run either the <strong>graceful-restart timer restart</strong> <em>time</em> or <strong>peer graceful-restart static-timer</strong> command to set this maximum wait time.</p>
<ul><li><p>To set the maximum wait time for re-establishing all BGP peer relationships, run the <strong>graceful-restart timer restart</strong> command in the BGP view. The maximum wait time can be set to 3600s at most.</p>
</li><li><p>To set the maximum wait time for re-establishing a specified BGP-EVPN peer relationship, run the <strong>peer graceful-restart static-timer</strong> command in the BGP EVPN view. The maximum wait time can be set to a value greater than 3600s.</p>
</li></ul>
<p>If both the <strong>graceful-restart timer restart </strong><em>time</em> and <strong>peer graceful-restart static-timer</strong> commands are run, the latter configuration takes effect.</p>
</p><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>This step can be performed only after GR has been enabled using the <strong>graceful-restart</strong> command in the BGP view.</p>
</div></div>
</p></li><li class="substepexpand"><span>(Optional) Run the <a href="cmdqueryname=peer+path-attribute-treat+%28BGP-EVPN+address+family+view%29"><b><span class="cmdname" id="EN-US_TASK_0172363801__en-us_task_0172363808_cmdname15960276127">peer</span></b></a> <i><span class="varname" id="EN-US_TASK_0172363801__en-us_task_0172363808_varname1783073510365">peerIpv4Addr</span></i> <strong><span id="EN-US_TASK_0172363801__en-us_task_0172363808_cmdparmname683113517361">path-attribute-treat</span></strong> <strong><span id="EN-US_TASK_0172363801__en-us_task_0172363808_cmdparmname1983183573616">attribute-id</span></strong> { <i><span class="varname" id="EN-US_TASK_0172363801__en-us_task_0172363808_varname4831103511362">id</span></i> [ <strong><span id="EN-US_TASK_0172363801__en-us_task_0172363808_cmdparmname19831153518368">to</span></strong> <i><span class="varname" id="EN-US_TASK_0172363801__en-us_task_0172363808_varname1383143518366">id2</span></i> ] } &amp;&lt;1-255&gt; { <strong><span id="EN-US_TASK_0172363801__en-us_task_0172363808_cmdparmname16831835123618">discard</span></strong> | <strong><span id="EN-US_TASK_0172363801__en-us_task_0172363808_cmdparmname1383193503615">withdraw</span></strong> | <strong><span id="EN-US_TASK_0172363801__en-us_task_0172363808_cmdparmname683163517367">treat-as-unknown</span></strong> } command to configure a special mode for processing BGP EVPN path attributes. Alternatively, run the <a href="cmdqueryname=peer"><b><span class="cmdname" id="EN-US_TASK_0172363801__en-us_task_0172363808_cmdname93005531399">peer</span></b></a> <i><span class="varname" id="EN-US_TASK_0172363801__en-us_task_0172363808_varname230045313911">peerIpv4Addr</span></i> <strong><span id="EN-US_TASK_0172363801__en-us_task_0172363808_cmdparmname163001053133910">treat-with-error</span></strong> <strong><span id="EN-US_TASK_0172363801__en-us_task_0172363808_cmdparmname1930011539391">attribute-id</span></strong> <i><span class="varname" id="EN-US_TASK_0172363801__en-us_task_0172363808_varname15300165313911">id</span></i> <strong><span id="EN-US_TASK_0172363801__en-us_task_0172363808_cmdparmname1230095363919">accept-zero-value</span></strong> command to configure a mode for processing incorrect BGP EVPN path attributes.</span><p><p id="EN-US_TASK_0172363801__en-us_task_0172363808_p853610510717">A BGP EVPN Update message contains various path attributes. If a local device receives Update messages containing malformed path attributes, the involved BGP EVPN sessions may flap. To enhance reliability, you can perform this step to configure a processing mode for specified BGP EVPN path attributes or incorrect path attributes.</p>
<div class="p" id="EN-US_TASK_0172363801__en-us_task_0172363808_p18357962720">The <strong id="EN-US_TASK_0172363801__en-us_task_0172363808_b186811949103539">path-attribute-treat</strong> parameter specifies a path attribute processing mode, which can be any of the following ones:<ul id="EN-US_TASK_0172363801__en-us_task_0172363808_ul8357461570"><li id="EN-US_TASK_0172363801__en-us_task_0172363808_li4357168712"><p id="EN-US_TASK_0172363801__en-us_task_0172363808_p16357176170"><a name="EN-US_TASK_0172363801__en-us_task_0172363808_li4357168712"></a><a name="en-us_task_0172363808_li4357168712"></a>Discarding specified attributes</p>
</li><li id="EN-US_TASK_0172363801__en-us_task_0172363808_li335796579"><p id="EN-US_TASK_0172363801__en-us_task_0172363808_p173579615716"><a name="EN-US_TASK_0172363801__en-us_task_0172363808_li335796579"></a><a name="en-us_task_0172363808_li335796579"></a>Withdrawing the routes with specified attributes</p>
</li><li id="EN-US_TASK_0172363801__en-us_task_0172363808_li63577614715"><p id="EN-US_TASK_0172363801__en-us_task_0172363808_p18357561571"><a name="EN-US_TASK_0172363801__en-us_task_0172363808_li63577614715"></a><a name="en-us_task_0172363808_li63577614715"></a>Processing specified attributes as unknown attributes</p>
</li></ul>
</div>
<p id="EN-US_TASK_0172363801__en-us_task_0172363808_p13276172704120">The <strong id="EN-US_TASK_0172363801__en-us_task_0172363808_b678658331103615">treat-with-error</strong> parameter specifies a processing mode for incorrect path attributes. The mode can be as follows:</p>
<ul id="EN-US_TASK_0172363801__en-us_task_0172363808_ul11473124810447"><li id="EN-US_TASK_0172363801__en-us_task_0172363808_li12473748144418"><p id="EN-US_TASK_0172363801__en-us_task_0172363808_p04730483447"><a name="EN-US_TASK_0172363801__en-us_task_0172363808_li12473748144418"></a><a name="en-us_task_0172363808_li12473748144418"></a>Accepting the path attributes with a value of 0.</p>
</li></ul>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span></span><p><p>Exit the BGP-EVPN address family view.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span></span><p><p>Exit the BGP view.</p>
</p></li></ol>
</li><li><span>(Optional) Configure a Layer 3 VXLAN gateway as an RR. If an RR is configured, each VXLAN gateway only needs to <a href="#EN-US_TASK_0172363801__bgp_evpn_peer">establish a BGP EVPN peer relationship</a> with the RR, reducing the number of BGP EVPN peer relationships to be established and simplifying configuration.</span><ol type="a"><li class="substepexpand"><span>Run <span><a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span></span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=l2vpn-family+evpn"><b><span class="cmdname">l2vpn-family evpn</span></b></a></span></span><p><p>The BGP-EVPN address family view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>enable</span></strong></span></span><p><p>The device is enabled to exchange EVPN routes with a specified peer or peer group.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <span><a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>next-hop-invariable</span></strong></span></span><p><p>The device is prevented from changing the next hop address of a route when advertising the route to an EBGP peer.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <a href="cmdqueryname=reflect-client"><b><span class="cmdname">reflect-client</span></b></a></span></span><p><p>The device is configured as an RR and an RR client is specified.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=undo+policy+vpn-target"><b><span class="cmdname">undo policy vpn-target</span></b></a></span></span><p><p>The function to filter received EVPN routes based on VPN targets is disabled. If you do not perform this step, the RR will fail to receive and reflect the routes sent by clients.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span></span><p><p>Exit the BGP-EVPN address family view.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span></span><p><p>Exit the BGP view.</p>
</p></li></ol>
</li><li><span>Configure an EVPN instance.</span><ol type="a"><li class="substepexpand"><span>Run <span><a href="cmdqueryname=evpn+vpn-instance"><b><span class="cmdname">evpn vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i> <strong><span>bd-mode</span></strong></span></span><p><p>A BD EVPN instance is created, and the EVPN instance view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=route-distinguisher"><b><span class="cmdname">route-distinguisher</span></b></a> <i><span class="varname">route-distinguisher</span></i></span></span><p><p>An RD is configured for the EVPN instance.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=vpn-target"><b><span class="cmdname">vpn-target</span></b></a> <i><span class="varname">vpn-target</span></i> &amp;&lt;1-8&gt; [ <strong><span>both</span></strong> | <strong><span>export-extcommunity</span></strong> | <strong><span>import-extcommunity</span></strong> ]</span></span><p><p>VPN targets are configured for the EVPN instance. The export VPN target of the local end must be the same as the import VPN target of the remote end, and the import VPN target of the local end must be the same as the export VPN target of the remote end.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <span><a href="cmdqueryname=import+route-policy"><b><span class="cmdname">import route-policy</span></b></a> <i><span class="varname">policy-name</span></i></span></span><p><p>The current EVPN instance is associated with an import routing policy.</p>
<p>To control route import more precisely, perform this step to associate the EVPN instance with an import routing policy and set attributes for eligible routes.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <span><a href="cmdqueryname=export+route-policy"><b><span class="cmdname">export route-policy</span></b></a> <i><span class="varname">policy-name</span></i></span></span><p><p>The current EVPN instance is associated with an export routing policy.</p>
<p>To control route export more precisely, perform this step to associate the EVPN instance with an export routing policy and set attributes for eligible routes.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <span><a href="cmdqueryname=tnl-policy"><b><span class="cmdname">tnl-policy</span></b></a> <i><span class="varname">policy-name</span></i></span></span><p><p>The EVPN instance is associated with a tunnel policy.</p>
<p>This configuration allows data packets between PEs to be forwarded through a TE tunnel.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <span><a href="cmdqueryname=mac+limit"><b><span class="cmdname">mac limit</span></b></a> <i><span class="varname">number</span></i> { <strong><span>simply-alert</span></strong> | <strong><span>mac-unchanged</span></strong> }</span></span><p><p>The maximum number of MAC addresses allowed by an EVPN instance is configured.</p>
<p>After a device learns a large number of MAC addresses, system performance may deteriorate when the device is busy processing services. This is because MAC addresses consume system resources. To improve system security and reliability, run the <a href="cmdqueryname=mac+limit"><b><span class="cmdname">mac limit</span></b></a> command to configure the maximum number of MAC addresses allowed by an EVPN instance. If the number of MAC addresses learned by an EVPN instance exceeds the maximum number, the system displays an alarm message, instructing you to check the validity of MAC addresses in the EVPN instance.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=mac-route+no-advertise"><b><span class="cmdname">mac-route no-advertise</span></b></a></span><p><p>The device is disabled from sending local MAC routes with the current VNI to the EVPN peer.</p>
</p><p><p>In Layer 3 VXLAN gateway scenarios where Layer 2 traffic forwarding is not involved, perform this step to disable local MAC routes from being advertised to the EVPN peer. This configuration prevents the EVPN peer from receiving MAC routes, thereby conserving device resources.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=local+mac-only-route+no-generate"><b><span class="cmdname">local mac-only-route no-generate</span></b></a></span><p><p>The device is disabled from generating an EVPN MAC route when the local MAC address exists in both a MAC address entry and an ARP/ND entry.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=mac-ip+route+generate-mac"><b><span class="cmdname">mac-ip route generate-mac</span></b></a></span><p><p>The function to generate MAC address entries based on MAC/IP routes is enabled.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span></span><p><p>Exit the EVPN instance view.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=bridge-domain"><b><span class="cmdname">bridge-domain</span></b></a> <i><span class="varname">bd-id</span></i></span></span><p><p>The BD view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=vxlan+vni"><b><span class="cmdname">vxlan vni</span></b></a> <i><span class="varname">vni-id</span></i> <strong><span>split-horizon-mode</span></strong></span></span><p><p>A VNI is created and associated with the BD, and split horizon is applied to the BD.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=evpn+binding+vpn-instance"><b><span class="cmdname">evpn binding vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i><span> [ <strong><span>bd-tag</span></strong> <i><span class="varname">bd-tag</span></i> ]</span></span></span><p><p>A specified EVPN instance is bound to the BD. <span>By specifying different <i><span class="varname">bd-tag</span></i> values, you can bind multiple BDs with different VLANs to the same EVPN instance and isolate services in the BDs.</span></p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span></span><p><p>Exit the BD view to return to the system view.</p>
</p></li></ol>
</li><li><span>Configure ingress replication.</span><ol type="a"><li class="substepexpand"><span>Run <span><a href="cmdqueryname=interface"><b><span class="cmdname">interface</span></b></a> <strong><span>nve</span></strong> <i><span class="varname">nve-number</span></i></span></span><p><p>An NVE interface is created, and the NVE interface view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=source"><b><span class="cmdname">source</span></b></a> <i><span class="varname">ip-address</span></i></span></span><p><p>An IP address is configured for the source VTEP.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=vni"><b><span class="cmdname">vni</span></b></a> <i><span class="varname">vni-id</span></i> <strong><span>head-end peer-list protocol bgp</span></strong></span></span><p><p>An ingress replication list is configured.</p>
</p><p><p>After the ingress of a VXLAN tunnel receives broadcast, unknown unicast, and multicast (BUM) packets, it replicates these packets and sends a copy to each VTEP in the ingress replication list. The ingress replication list is a collection of remote VTEP IP addresses to which the ingress of a VXLAN tunnel should send replicated BUM packets.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span></span><p><p>Return to the system view.</p>
</p></li></ol>
</li><li><span>Run <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span></span><p><p>The configuration is committed.</p>
</p></li></ol></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vxlan_cfg_0017b.html">Configuring VXLAN in Centralized Gateway Mode Using BGP EVPN
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vxlan6_cfg_0018b.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vxlan_cfg_1215.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>