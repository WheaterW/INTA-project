
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="(Optional) Configuring a VPN Instance for Route Leaking with an EVPN Instance">
<meta name="abstract" content="To enable communication between VMs on different subnets, configure a VPN instance for route leaking with an EVPN instance. This configuration enables Layer 3 connectivity. To isolate multiple tenants, you can use different VPN instances.">
<meta name="description" content="To enable communication between VMs on different subnets, configure a VPN instance for route leaking with an EVPN instance. This configuration enables Layer 3 connectivity. To isolate multiple tenants, you can use different VPN instances.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vxlan_cfg_1216.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vxlan_cfg_1062.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vxlan_cfg_1217.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="h00847023">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="OWNER" content="p00915595">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="p00915595">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0276943627">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>(Optional) Configuring a VPN Instance for Route Leaking with an EVPN Instance</title>
</head>
<body><a name="EN-US_TASK_0276943627"></a><a name="EN-US_TASK_0276943627"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">(Optional) Configuring a VPN Instance for Route Leaking with an EVPN Instance</h1>
<div class="taskbody"><p>To enable communication between VMs on different subnets, configure a VPN instance for route leaking with an EVPN instance. This configuration enables Layer 3 connectivity. To isolate multiple tenants, you can use different VPN instances.</p>
<div class="steps-unordered"><a name="EN-US_TASK_0276943627__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Procedure</h4>
<ul><li><span>For an IPv4 overlay network, perform the following operations:</span><ol><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ip+vpn-instance"><b><span class="cmdname">ip vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i></span><p><p>A VPN instance is created, and the VPN instance view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=vxlan+vni"><b><span class="cmdname">vxlan vni</span></b></a> <i><span class="varname">vni-id</span></i></span><p><p>A VNI is created and associated with the VPN instance.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ipv4-family"><b><span class="cmdname">ipv4-family</span></b></a></span><p><p>The VPN instance IPv4 address family is enabled, and its view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=route-distinguisher"><b><span class="cmdname">route-distinguisher</span></b></a> <i><span class="varname">route-distinguisher</span></i></span><p><p>An RD is configured for the VPN instance IPv4 address family.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=vpn-target"><b><span class="cmdname">vpn-target</span></b></a> <i><span class="varname">vpn-target</span></i> &amp;&lt;1-8&gt; [ <strong><span>both</span></strong> | <strong><span>export-extcommunity</span></strong> | <strong><span>import-extcommunity</span></strong> ]</span><p><p>VPN targets are configured for the VPN instance IPv4 address family.</p>
</p><p><p>If the current node needs to exchange L3VPN routes with other nodes in the same VPN instance, perform this step to configure VPN targets for the VPN instance.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=vpn-target"><b><span class="cmdname">vpn-target</span></b></a> <i><span class="varname">vpn-target</span></i> &amp;&lt;1-8&gt; [ <strong><span>both</span></strong> | <strong><span>export-extcommunity</span></strong> | <strong><span>import-extcommunity</span></strong> ] <strong><span>evpn</span></strong></span><p><p>The VPN target extended community attribute for EVPN routes is configured for the VPN instance IPv4 address family.</p>
</p><p><p>When the local device advertises an EVPN IP prefix route to a peer, the route carries all the VPN targets in the export VPN target list configured for EVPN routes in this step. When the local device advertises an EVPN IRB route to a peer, the route carries all the VPN targets in the export VPN target list of the EVPN instance in BD mode.</p>
<p>The IRB route or IP prefix route received by the local device can be added to the routing table of the local VPN instance IPv4 address family only when the VPN targets carried in the IRB route or IP prefix route overlap those in the import VPN target list configured for EVPN routes in this step.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=import+route-policy"><b><span class="cmdname">import route-policy</span></b></a> <i><span class="varname">policy-name</span></i> <strong><span>evpn</span></strong></span><p><p>The VPN instance IPv4 address family is associated with an import route-policy that is used to filter EVPN routes imported to the VPN instance IPv4 address family.</p>
</p><p><p>To control import of EVPN routes to the VPN instance IPv4 address family more precisely, perform this step to associate the VPN instance IPv4 address family with an import route-policy and set attributes for eligible EVPN routes.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=export+route-policy"><b><span class="cmdname">export route-policy</span></b></a> <i><span class="varname">policy-name</span></i> <strong><span>evpn</span></strong></span><p><p>The VPN instance IPv4 address family is associated with an export route-policy that is used to filter EVPN routes advertised by this address family.</p>
</p><p><p>Perform this step to more precisely control EVPN routes to be advertised by the VPN instance IPv4 address family and set attributes for eligible EVPN routes.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Exit the VPN instance IPv4 address family view.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Exit the VPN instance view.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li><span>For an IPv6 overlay network, perform the following operations:</span><ol><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ip+vpn-instance"><b><span class="cmdname">ip vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i></span><p><p>A VPN instance is created, and its view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=vxlan+vni"><b><span class="cmdname">vxlan vni</span></b></a> <i><span class="varname">vni-id</span></i></span><p><p>A VNI is created and associated with the VPN instance.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ipv6-family"><b><span class="cmdname">ipv6-family</span></b></a></span><p><p>The VPN instance IPv6 address family is enabled and its view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=route-distinguisher"><b><span class="cmdname">route-distinguisher</span></b></a> <i><span class="varname">route-distinguisher</span></i></span><p><p>An RD is configured for the VPN instance IPv6 address family.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=vpn-target"><b><span class="cmdname">vpn-target</span></b></a> <i><span class="varname">vpn-target</span></i> &amp;&lt;1-8&gt; [ <strong><span>both</span></strong> | <strong><span>export-extcommunity</span></strong> | <strong><span>import-extcommunity</span></strong> ]</span><p><p>VPN targets are configured for the VPN instance IPv6 address family.</p>
</p><p><p>If the current node needs to exchange L3VPN routes with other nodes in the same VPN instance, perform this step to configure VPN targets for the VPN instance.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=vpn-target"><b><span class="cmdname">vpn-target</span></b></a> <i><span class="varname">vpn-target</span></i> &amp;&lt;1-8&gt; [ <strong><span>both</span></strong> | <strong><span>export-extcommunity</span></strong> | <strong><span>import-extcommunity</span></strong> ] <strong><span>evpn</span></strong></span><p><p>The VPN target extended community attribute for EVPN routes is configured for the VPN instance IPv6 address family.</p>
</p><p><p>When the local device advertises an EVPN IPv6 prefix route to a peer, the route carries all the VPN targets in the export VPN target list configured for EVPN routes in this step. When the local device advertises an EVPN IRBv6 route to a peer, the route carries all the VPN targets in the export VPN target list of the EVPN instance in BD mode.</p>
<p>The IRBv6 route or IPv6 prefix route received by the local device can be added to the routing table of the local VPN instance IPv6 address family only when the VPN targets carried in the IRBv6 route or IPv6 prefix route overlap those in the import VPN target list configured for EVPN routes in this step.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=import+route-policy"><b><span class="cmdname">import route-policy</span></b></a> <i><span class="varname">policy-name</span></i> <strong><span>evpn</span></strong></span><p><p>The VPN instance IPv6 address family is associated with an import route-policy that is used to filter EVPN routes imported to the VPN instance IPv6 address family.</p>
</p><p><p>To control import of EVPN routes to the VPN instance IPv6 address family more precisely, perform this step to associate the VPN instance IPv6 address family with an import route-policy and set attributes for eligible EVPN routes.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=export+route-policy"><b><span class="cmdname">export route-policy</span></b></a> <i><span class="varname">policy-name</span></i> <strong><span>evpn</span></strong></span><p><p>The VPN instance IPv6 address family is associated with an export route-policy that is used to filter EVPN routes to be advertised by this address family. Perform this step to more precisely control EVPN routes to be advertised by this address family and set attributes for eligible EVPN routes. </p>
</p><p></p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Exit the VPN instance IPv6 address family view.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Exit the VPN instance view.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li></ul></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vxlan_cfg_1216.html">Configuring VXLAN in Distributed Gateway Mode Using BGP EVPN
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vxlan_cfg_1062.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vxlan_cfg_1217.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>