
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring an ERPS Ring">
<meta name="abstract" content="A ring is the basic ERPS unit. After an ERPS ring is configured, ERPS runs to block redundant links and eliminate loops on Layer 2 networks.">
<meta name="description" content="A ring is the basic ERPS unit. After an ERPS ring is configured, ERPS runs to block redundant links and eliminate loops on Layer 2 networks.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_erps_cfg_0004.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_erps_cfg_0007.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="wwx1238417">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="ERPS(G.8032)">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="ERPS(G.8032)">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="featurename" content="ERPS(G.8032)">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="featurename" content="ERPS">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="OWNER" content="c00648116,w00437000">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="wWX1238417">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172363463">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring an ERPS Ring</title>
</head>
<body><a name="EN-US_TASK_0172363463"></a><a name="EN-US_TASK_0172363463"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring an ERPS Ring</h1>
<div class="taskbody"><p>A ring is the basic ERPS unit. After an ERPS ring is configured, ERPS runs to block redundant links and eliminate loops on Layer 2 networks.</p>
<div class="context"><a name="EN-US_TASK_0172363463__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><div class="p">Perform the following operations to configure an ERPS ring:<ol><li>Create an ERPS ring.</li><li>(Optional) Configure a description for the ERPS ring. The description can contain the ERPS ring ID.</li><li><p id="EN-US_TASK_0172363463__en-us_task_0172363473_p1041601314214029">Configure a control VLAN for the ERPS ring. A control VLAN is different from a data VLAN that transmits service packets. On ERPS rings, a control VLAN is used to transmit Ring Auto Protection Switching (R-APS) Protocol Data Units (PDUs), also called the ERPS protocol packets. A control VLAN does not transmit service packets, enhancing ERPS security.</p>
<p id="EN-US_TASK_0172363463__en-us_task_0172363473_p2084295182214029">All <span class="keyword" id="EN-US_TASK_0172363463__en-us_task_0172363473_keyword1767441879214313">devices</span> on an ERPS ring must use the same control VLAN. Different ERPS rings cannot have the same control VLAN.</p>
</li><li>Configure an ERP instance and map the instance to a VLAN. Ports can be added to an ERPS ring only after an ERP instance is configured for the ring. VLANs can be mapped to protection instances for load balancing.</li><li><p>Add Layer 2 ports to the ERPS rings and specify <span>Port Role</span>.</p>
<div class="p">Before adding a port to an ERPS ring, ensure that:<ul><li><p>No spanning tree protocol is enabled on the port. If a spanning tree protocol has been enabled for a port, run the <a href="cmdqueryname=stp+disable"><b><span class="cmdname" id="EN-US_TASK_0172363463__en-us_task_0172363473_cmdname1225703727214029">stp disable</span></b></a> command in the interface view to disable the spanning tree protocol.</p>
</li><li><p>The port is not a Layer 3 port. If the port is a Layer 3 port, run the <a href="cmdqueryname=portswitch"><b><span class="cmdname" id="EN-US_TASK_0172363463__en-us_task_0172363473_cmdname922087121214029">portswitch</span></b></a> command to switch the port to the Layer 2 mode.</p>
</li><li><p>A control VLAN and an ERP instance have been configured for the ERPS ring to which the port will be added.</p>
</li></ul>
</div>
</li></ol>
</div>
<div class="note" id="EN-US_TASK_0172363463__note_00"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0172363463__p636239732214029">A ring can either has STP or ERPS enabled. If you enable ERPS, the control VLAN and data VLAN must be mapped to an Ethernet Ring Protection (ERP) instance. Otherwise, a loop may occur because STP is disabled.</p>
</div></div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172363463__1.4.2"></a><a name="1.4.2"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Run <span><a href="cmdqueryname=system-view"><b><span class="cmdname" id="EN-US_TASK_0172363463__en-us_task_0172363473_cmdname1171129859214313">system-view</span></b></a></span></span><p><p id="EN-US_TASK_0172363463__en-us_task_0172363473_p708327214214313">The system view is displayed.</p>
</p></li><li><span>Run <span><a href="cmdqueryname=erps+ring"><b><span class="cmdname">erps ring</span></b></a> <i><span class="varname">ring-id</span></i></span></span><p><p>An ERPS ring is created, and its view is displayed.</p>
</p><p><p>An ERPS ring can be deleted only if it does not have any port. If you attempt to delete an ERPS ring that has a port, the system prompts a deletion failure. Before deleting an ERPS ring that has a port, run the <a href="cmdqueryname=undo+erps+ring"><b><span class="cmdname">undo erps ring</span></b></a> command in the interface view of the port or the <a href="cmdqueryname=undo+port"><b><span class="cmdname">undo port</span></b></a> command in the ERPS ring view to remove the port from the ERPS ring. Then run the <a href="cmdqueryname=undo+erps+ring"><b><span class="cmdname">undo erps ring</span></b></a> command to delete the ERPS ring.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>If only one port is added to the ERPS ring, the port is set to the Discarding state.</p>
</div></div>
</p></li><li><span>(Optional) Run <a href="cmdqueryname=description"><b><span class="cmdname" id="EN-US_TASK_0172363463__en-us_task_0172363473_cmdname5429112511433">description</span></b></a> <i><span class="varname" id="EN-US_TASK_0172363463__en-us_task_0172363473_varname1442919253434">text</span></i></span><p><p id="EN-US_TASK_0172363463__en-us_task_0172363473_p2518891375">A description is configured for the ERPS ring.</p>
</p></li><li><span>Run <span><a href="cmdqueryname=control-vlan"><b><span class="cmdname" id="EN-US_TASK_0172363463__en-us_task_0172363473_cmdname858064675214313">control-vlan</span></b></a> <i><span class="varname" id="EN-US_TASK_0172363463__en-us_task_0172363473_varname467188230214313">vlan-id</span></i></span></span><p><p id="EN-US_TASK_0172363463__en-us_task_0172363473_p827650432214029">A control VLAN is configured for the ERPS ring.</p>
<p id="EN-US_TASK_0172363463__en-us_task_0172363473_p1509381922214313">The control VLAN specified by <i><span class="varname" id="EN-US_TASK_0172363463__en-us_task_0172363473_varname1037580505214313">vlan-id</span></i> must not be one that has been created or used in Smart Link protocol, VLAN mapping, VLAN stacking, <a href="cmdqueryname=port+trunk+allow-pass"><b><span class="cmdname" id="EN-US_TASK_0172363463__en-us_task_0172363473_cmdname1683219768214313">port trunk allow-pass</span></b></a>, or <a href="cmdqueryname=port+default+vlan"><b><span class="cmdname" id="EN-US_TASK_0172363463__en-us_task_0172363473_cmdname267767759214313">port default vlan</span></b></a> applications.</p>
<ul id="EN-US_TASK_0172363463__en-us_task_0172363473_ul428698762214029"><li id="EN-US_TASK_0172363463__en-us_task_0172363473_li2004018096214029"><p id="EN-US_TASK_0172363463__en-us_task_0172363473_p398619924214029"><a name="EN-US_TASK_0172363463__en-us_task_0172363473_li2004018096214029"></a><a name="en-us_task_0172363473_li2004018096214029"></a>The control VLAN for an ERPS ring cannot be modified after a port is added to the ring. Before deleting the control VLAN for an ERPS ring that has a port, run the <a href="cmdqueryname=undo+erps+ring"><b><span class="cmdname" id="EN-US_TASK_0172363463__en-us_task_0172363473_cmdname6427124161319">undo erps ring</span></b></a> command in the interface view of the port or the <a href="cmdqueryname=undo+port"><b><span class="cmdname" id="EN-US_TASK_0172363463__en-us_task_0172363473_cmdname1542724151310">undo port</span></b></a> command in the ERPS ring view to remove the port from the ERPS ring. Then run the <a href="cmdqueryname=undo+control-vlan"><b><span class="cmdname" id="EN-US_TASK_0172363463__en-us_task_0172363473_cmdname542718420133">undo control-vlan</span></b></a> command to delete the control VLAN.</p>
</li><li id="EN-US_TASK_0172363463__en-us_task_0172363473_li1627972502214029"><p id="EN-US_TASK_0172363463__en-us_task_0172363473_p244694687214029"><a name="EN-US_TASK_0172363463__en-us_task_0172363473_li1627972502214029"></a><a name="en-us_task_0172363473_li1627972502214029"></a>If an ERPS ring does not have any port, you can run the <a href="cmdqueryname=control-vlan"><b><span class="cmdname" id="EN-US_TASK_0172363463__en-us_task_0172363473_cmdname281581541214313">control-vlan</span></b></a> command more than once, but only the latest configuration takes effect.</p>
</li><li id="EN-US_TASK_0172363463__en-us_task_0172363473_li_1"><p id="EN-US_TASK_0172363463__en-us_task_0172363473_p1016870296214029"><a name="EN-US_TASK_0172363463__en-us_task_0172363473_li_1"></a><a name="en-us_task_0172363473_li_1"></a>After a control VLAN is configured, the <a href="cmdqueryname=vlan+batch"><b><span class="cmdname" id="EN-US_TASK_0172363463__en-us_task_0172363473_cmdname1136939239214313">vlan batch</span></b></a> <i><span class="varname" id="EN-US_TASK_0172363463__en-us_task_0172363473_varname1655467214313">vlan-id1</span></i> [ <strong><span id="EN-US_TASK_0172363463__en-us_task_0172363473_cmdparmname1451523378214313">to</span></strong> <i><span class="varname" id="EN-US_TASK_0172363463__en-us_task_0172363473_varname1518943111214313">vlan-id2</span></i> ] &amp;&lt;1-10&gt; command, instead of the <a href="cmdqueryname=control-vlan"><b><span class="cmdname" id="EN-US_TASK_0172363463__en-us_task_0172363473_cmdname2121925510214313">control-vlan</span></b></a> command, is saved in the configuration file.</p>
<p id="EN-US_TASK_0172363463__en-us_task_0172363473_p588759698214029">After a port is added to an ERPS ring that has a control VLAN configured, the port is automatically added to the control VLAN, and the <strong><span id="EN-US_TASK_0172363463__en-us_task_0172363473_cmdparmname254301019214313">port trunk allow-pass vlan</span></strong> <i><span class="varname" id="EN-US_TASK_0172363463__en-us_task_0172363473_varname850447046214313">vlan-id</span></i> command configuration is automatically generated in the interface view of this port in the configuration file.</p>
</li></ul>
</p></li><li><span>Run <span><a href="cmdqueryname=protected-instance"><b><span class="cmdname" id="EN-US_TASK_0172363463__en-us_task_0172363473_cmdname2010289664214313">protected-instance</span></b></a> { <strong><span id="EN-US_TASK_0172363463__en-us_task_0172363473_cmdparmname584255329214313">all</span></strong> | { <i><span class="varname" id="EN-US_TASK_0172363463__en-us_task_0172363473_varname243116925214313">instance-id1</span></i> [ <strong><span id="EN-US_TASK_0172363463__en-us_task_0172363473_cmdparmname957113551214313">to</span></strong> <i><span class="varname" id="EN-US_TASK_0172363463__en-us_task_0172363473_varname173060052214313">instance-id2</span></i> ] &amp;&lt;1-10&gt; } }</span></span><p><p id="EN-US_TASK_0172363463__en-us_task_0172363473_p357817315192">An ERP instance is configured for the ERPS ring.</p>
</p><p><p id="EN-US_TASK_0172363463__en-us_task_0172363473_p527491187214313">If you run the <a href="cmdqueryname=protected-instance"><b><span class="cmdname" id="EN-US_TASK_0172363463__en-us_task_0172363473_cmdname6428035214313">protected-instance</span></b></a> command for an ERPS ring several times, all the configured ERP instances take effect.</p>
<p id="EN-US_TASK_0172363463__en-us_task_0172363473_p981949676214313">ERP instances for an ERPS ring cannot be modified after a port is added to the ring. Before deleting an ERP instance for an ERPS ring that has a port, run the <a href="cmdqueryname=undo+erps+ring"><b><span class="cmdname" id="EN-US_TASK_0172363463__en-us_task_0172363473_cmdname672781901214313">undo erps ring</span></b></a> command in the interface view of the port or the <a href="cmdqueryname=undo+port"><b><span class="cmdname" id="EN-US_TASK_0172363463__en-us_task_0172363473_cmdname154816278214313">undo port</span></b></a> command in the ERPS ring view to remove the port from the ERPS ring. Then run the <a href="cmdqueryname=undo+protected-instance"><b><span class="cmdname" id="EN-US_TASK_0172363463__en-us_task_0172363473_cmdname1329777353214313">undo protected-instance</span></b></a> command to delete the ERP instance.</p>
</p></li><li><span>Perform either of the following operations to configure the mapping between the ERP instance and VLANs and ensure that the control VLAN belongs to the configured ERP instance:</span><p><ul id="EN-US_TASK_0172363463__en-us_task_0172363473_ul941962149214029"><li id="EN-US_TASK_0172363463__en-us_task_0172363473_li1275698902214029"><p id="EN-US_TASK_0172363463__en-us_task_0172363473_p194714266214029"><a name="EN-US_TASK_0172363463__en-us_task_0172363473_li1275698902214029"></a><a name="en-us_task_0172363473_li1275698902214029"></a>Configure the mapping between the instance and VLANs in the MST region view.</p>
<ol type="a" id="EN-US_TASK_0172363463__en-us_task_0172363473_ol1867366133214029"><li id="EN-US_TASK_0172363463__en-us_task_0172363473_li1692813247214029">Run the <a href="cmdqueryname=stp+region-configuration"><b><span class="cmdname" id="EN-US_TASK_0172363463__en-us_task_0172363473_cmdname1451762465214313">stp region-configuration</span></b></a> command to enter the MST region view.</li><li id="EN-US_TASK_0172363463__en-us_task_0172363473_li361921067214029">Run the <a href="cmdqueryname=instance"><b><span class="cmdname" id="EN-US_TASK_0172363463__en-us_task_0172363473_cmdname167638464214313">instance</span></b></a> <i><span class="varname" id="EN-US_TASK_0172363463__en-us_task_0172363473_varname1294933667214313">instance-id</span></i> <strong><span id="EN-US_TASK_0172363463__en-us_task_0172363473_cmdparmname1448973501214313">vlan</span></strong> { <i><span class="varname" id="EN-US_TASK_0172363463__en-us_task_0172363473_varname161426990214313">vlan-id1</span></i> [ <strong><span id="EN-US_TASK_0172363463__en-us_task_0172363473_cmdparmname1696349746214313">to</span></strong> <i><span class="varname" id="EN-US_TASK_0172363463__en-us_task_0172363473_varname819893746214313">vlan-id2</span></i> ] } &amp;&lt;1-10&gt; command to map VLANs to an MSTI.</li></ol>
<div class="note" id="EN-US_TASK_0172363463__en-us_task_0172363473_note1217052570214029"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0172363463__en-us_task_0172363473_p220806315214029">A VLAN cannot be mapped to multiple MSTIs. If you map a VLAN that has already been mapped to an MSTI to another MSTI, the original mapping will be canceled.</p>
<p id="EN-US_TASK_0172363463__en-us_task_0172363473_p608045457214029">The <a href="cmdqueryname=vlan-mapping+modulo"><b><span class="cmdname" id="EN-US_TASK_0172363463__en-us_task_0172363473_cmdname1367266188214313">vlan-mapping modulo</span></b></a> <i><span class="varname" id="EN-US_TASK_0172363463__en-us_task_0172363473_varname1095463348214313">modulo</span></i> command configures the mapping between MSTIs and VLANs based on a default algorithm. However, the mapping configured using this command cannot always meet the actual demand. Therefore, running this command is not recommended.</p>
</div></div>
</li><li id="EN-US_TASK_0172363463__en-us_task_0172363473_li143868470214029"><p id="EN-US_TASK_0172363463__en-us_task_0172363473_p2078272415214029"><a name="EN-US_TASK_0172363463__en-us_task_0172363473_li143868470214029"></a><a name="en-us_task_0172363473_li143868470214029"></a>Configure the mapping between the instance and VLANs in the VLAN instance view.</p>
<ol type="a" id="EN-US_TASK_0172363463__en-us_task_0172363473_ol1348741003214029"><li id="EN-US_TASK_0172363463__en-us_task_0172363473_li671336771214029">Run the <a href="cmdqueryname=vlan+instance"><b><span class="cmdname" id="EN-US_TASK_0172363463__en-us_task_0172363473_cmdname2043492161214313">vlan instance</span></b></a> command to enter the VLAN instance view.</li><li id="EN-US_TASK_0172363463__en-us_task_0172363473_li279790321214029"><p id="EN-US_TASK_0172363463__en-us_task_0172363473_p1594221764214029"><a name="EN-US_TASK_0172363463__en-us_task_0172363473_li279790321214029"></a><a name="en-us_task_0172363473_li279790321214029"></a>Run the <a href="cmdqueryname=instance"><b><span class="cmdname" id="EN-US_TASK_0172363463__en-us_task_0172363473_cmdname969708896214313">instance</span></b></a> <i><span class="varname" id="EN-US_TASK_0172363463__en-us_task_0172363473_varname1712553714214313">instance-id</span></i> <strong><span id="EN-US_TASK_0172363463__en-us_task_0172363473_cmdparmname1810910222214313">vlan</span></strong> { <i><span class="varname" id="EN-US_TASK_0172363463__en-us_task_0172363473_varname1633352759214313">vlan-id1</span></i> [ <strong><span id="EN-US_TASK_0172363463__en-us_task_0172363473_cmdparmname1551216468214313">to</span></strong> <i><span class="varname" id="EN-US_TASK_0172363463__en-us_task_0172363473_varname209125071214313">vlan-id2</span></i> ] }&amp;&lt;1-10&gt; command to map VLANs to the VLAN instance.</p>
<div class="note" id="EN-US_TASK_0172363463__en-us_task_0172363473_note1771614056214029"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0172363463__en-us_task_0172363473_p656673537214029">The <a href="cmdqueryname=vlan+instance"><b><span class="cmdname" id="EN-US_TASK_0172363463__en-us_task_0172363473_cmdname394523587214313">vlan instance</span></b></a> and <a href="cmdqueryname=stp+region-configuration"><b><span class="cmdname" id="EN-US_TASK_0172363463__en-us_task_0172363473_cmdname147478917214313">stp region-configuration</span></b></a> commands are mutually exclusive. If the mapping between an MSTI and VLANs has been configured in the MST region view displayed by the <a href="cmdqueryname=stp+region-configuration"><b><span class="cmdname" id="EN-US_TASK_0172363463__en-us_task_0172363473_cmdname1584794458214313">stp region-configuration</span></b></a> command, you must delete the configured mapping before using the <a href="cmdqueryname=vlan+instance"><b><span class="cmdname" id="EN-US_TASK_0172363463__en-us_task_0172363473_cmdname107359265214313">vlan instance</span></b></a> command.</p>
</div></div>
</li><li id="EN-US_TASK_0172363463__en-us_task_0172363473_li218233824214029">(Optional) Run the <a href="cmdqueryname=check+vlan+instance+mapping"><b><span class="cmdname" id="EN-US_TASK_0172363463__en-us_task_0172363473_cmdname663962921214313">check vlan instance mapping</span></b></a> command to check the configured mapping.</li></ol>
</li></ul>
</p></li><li><span>Run either of the following commands to add a port to an ERPS ring and specify the port role.</span><p><div class="p"><ul><li><p>Run the <a href="cmdqueryname=port"><b><span class="cmdname">port</span></b></a> <i><span class="varname">interface-type interface-number</span></i> [ <strong><span>rpl owner</span></strong> ] command in the ERPS ring view.</p>
</li><li><p>Run the <a href="cmdqueryname=erps+ring"><b><span class="cmdname">erps ring</span></b></a> <i><span class="varname">ring-id</span></i> [ <strong><span>rpl owner</span></strong> ] command in the interface view.</p>
</li></ul>
</div>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>As MAC address updates cannot be separately sent currently, configuring the direct link between two upstream nodes as the RPL is not recommended.</p>
<p>Before changing the port role, run the <a href="cmdqueryname=shutdown"><b><span class="cmdname">shutdown</span></b></a> command to shut down the port. Then change the port role and run the <a href="cmdqueryname=undo+shutdown"><b><span class="cmdname">undo shutdown</span></b></a> command to enable the port.</p>
</div></div>
</p></li><li><span>Run <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span></span><p><p>The configuration is committed.</p>
</p></li></ol></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_erps_cfg_0004.html">Configuring ERPSv1
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_erps_cfg_0007.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>