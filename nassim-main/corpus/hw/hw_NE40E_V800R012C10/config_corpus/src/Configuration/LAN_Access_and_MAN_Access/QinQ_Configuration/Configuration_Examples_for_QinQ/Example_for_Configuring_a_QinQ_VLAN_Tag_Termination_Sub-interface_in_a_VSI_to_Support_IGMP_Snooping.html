
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring a QinQ VLAN Tag Termination Sub-interface in a VSI to Support IGMP Snooping">
<meta name="abstract" content="You can configure a QinQ VLAN tag termination sub-interface to support Internet Group Management Protocol (IGMP) snooping on only Layer 2 interfaces rather than Layer 3 interfaces.">
<meta name="description" content="You can configure a QinQ VLAN tag termination sub-interface to support Internet Group Management Protocol (IGMP) snooping on only Layer 2 interfaces rather than Layer 3 interfaces.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_qinq_cfg_0023_1.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_qinq_cfg_0037.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_qinq_cfg_0044.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="wwx1238417">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="QinQ">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="QinQ">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="featurename" content="QinQ">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="featurename" content="QinQ">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="OWNER" content="c00648116,w00437000">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="wwx1238417">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172363323">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>Example for Configuring a QinQ VLAN Tag Termination Sub-interface in a VSI to Support IGMP Snooping</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172363323"></a><a name="EN-US_TASK_0172363323"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring a QinQ VLAN Tag Termination Sub-interface in a VSI to Support IGMP Snooping</h1>
<div class="taskbody"><p>You can configure a QinQ VLAN tag termination sub-interface to support Internet Group Management Protocol (IGMP) snooping on only Layer 2 interfaces rather than Layer 3 interfaces.</p>
<div class="context"><a name="EN-US_TASK_0172363323__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0172363323__fig_dc_vrp_qinq_cfg_004301">Figure 1</a>, Multicast protocol packets are labeled with an outer tag and an inner tag on CE1 and CE2 respectively, and then sent to PE1. After receiving the packets, PE1 terminates two tags, and then accesses the virtual private LAN service (VPLS) network in an asymmetrical manner. PE2 terminates the pseudowire (PW), joins the related multicast VLAN, and accesses the multicast source.</p>
<p>PE2 functions as a Superstratum PE (SPE) device, and PE1 functions an Underlayer PE (UPE) device. When the hierarchical virtual private LAN service (HVPLS) is deployed, multicast packets are broadcast in a virtual switching instance (VSI) if PE1 and PE2 do not support IGMP snooping. This wastes network resources.</p>
<p>After IGMP snooping is configured, multicast packets are sent to only access devices of multicast receivers.</p>
<p>On the network with a stable topology, the PW on PE1 is configured as a static router interface in the VSI. Therefore, receivers can steadily receive multicast data.</p>
<p>To reduce the number of IGMP Query packets from the upstream <span class="keyword">Router</span>, you are advised to configure PE2 as a querier. This saves bandwidths.</p>
<div class="fignone" id="EN-US_TASK_0172363323__fig_dc_vrp_qinq_cfg_004301"><a name="EN-US_TASK_0172363323__fig_dc_vrp_qinq_cfg_004301"></a><a name="fig_dc_vrp_qinq_cfg_004301"></a><span class="figcap"><b>Figure 1 </b>Networking diagram for configuring the QinQ VLAN tag termination sub-interface to support IGMP snooping over VPLS</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interfaces 1 and 2 represent GE<span>0/1/1</span> and GE<span>0/1/2</span>, respectively.</p>
</div></div>
<br><span><img src="images/fig_dc_vrp_qinq_cfg_004301.png"></span></div>

<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" frame="border" border="1" rules="all"><thead align="left"><tr><th align="left" class="cellrowborder" char="." valign="top" width="17.608239176082392%" id="mcps1.4.1.8.1.4.1.1" liSelected="liSelected"><p>Device</p>
</th>
<th align="left" class="cellrowborder" char="." valign="top" width="41.195880411958804%" id="mcps1.4.1.8.1.4.1.2" liSelected="liSelected"><p>Interface</p>
</th>
<th align="left" class="cellrowborder" char="." valign="top" width="41.195880411958804%" id="mcps1.4.1.8.1.4.1.3" liSelected="liSelected"><p>IP Address</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" rowspan="3" char="." valign="top" width="17.608239176082392%" headers="mcps1.4.1.8.1.4.1.1 "><p>PE1</p>
</td>
<td class="cellrowborder" char="." valign="top" width="41.195880411958804%" headers="mcps1.4.1.8.1.4.1.2 "><p>GE<span>0/1/2</span></p>
</td>
<td class="cellrowborder" char="." valign="top" width="41.195880411958804%" headers="mcps1.4.1.8.1.4.1.3 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.8.1.4.1.2 "><p>GE<span>0/1/1</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.8.1.4.1.3 "><p>192.168.12.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.8.1.4.1.2 "><p>Loopback1</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.8.1.4.1.3 "><p>1.1.1.1/32</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="3" char="." valign="top" width="17.608239176082392%" headers="mcps1.4.1.8.1.4.1.1 "><p>P</p>
</td>
<td class="cellrowborder" char="." valign="top" width="41.195880411958804%" headers="mcps1.4.1.8.1.4.1.2 "><p>GE<span>0/1/0</span></p>
</td>
<td class="cellrowborder" char="." valign="top" width="41.195880411958804%" headers="mcps1.4.1.8.1.4.1.3 "><p>192.168.12.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.8.1.4.1.2 "><p>GE<span>0/1/1</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.8.1.4.1.3 "><p>192.168.23.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.8.1.4.1.2 "><p>Loopback 2</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.8.1.4.1.3 "><p>2.2.2.2/32</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="3" char="." valign="top" width="17.608239176082392%" headers="mcps1.4.1.8.1.4.1.1 "><p>PE2</p>
</td>
<td class="cellrowborder" char="." valign="top" width="41.195880411958804%" headers="mcps1.4.1.8.1.4.1.2 "><p>GE<span>0/1/2</span></p>
</td>
<td class="cellrowborder" char="." valign="top" width="41.195880411958804%" headers="mcps1.4.1.8.1.4.1.3 "><p>192.168.23.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.8.1.4.1.2 "><p>GE<span>0/1/1</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.8.1.4.1.3 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.8.1.4.1.2 "><p>Loopback3</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.8.1.4.1.3 "><p>3.3.3.3/32</p>
</td>
</tr>
</tbody>
</table>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172363323__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure a QinQ VLAN tag termination sub-interface on PE1.</p>
</li><li><p>Configure basic VPLS functions.</p>
</li><li><p>Enable global IGMP snooping and IGMP snooping for a VSI.</p>
</li><li><p>Bind a VSI to an AC interface on PE1 and PE2 respectively.</p>
</li><li><p>Configure a PW on PE1, P, and PE2, and PE1, P, and PE2 accesses the VPLS network in asymmetrical mode.</p>
</li><li><p>Configure static router ports and configure PE2 as a querier.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172363323__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>Multicast VLAN ID: 10</p>
</li><li><p>CE1's VLAN ID: 20; CE2's VLAN ID: 100</p>
</li><li><p>VSI name: v123; VSI ID: 123</p>
</li><li><p>PE1's Multiprotocol Label Switching (MPLS) LSR ID: 1.1.1.1; P's MPLS LSR ID: 2.2.2.2; PE2's MPLS LSR ID: 3.3.3.3</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172363323__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure QinQ termination on PE1.</span><p><pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>sysname PE1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface gigabitethernet <span>0/1/2</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/2</span>.1] <strong>control-vid 10 qinq-termination</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/2</span>.1] <strong>qinq termination l2 asymmetry </strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/2</span>.1] <strong>qinq termination pe-vid 20 ce-vid 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/2</span>.1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/2</span>.1] <strong>quit</strong></pre>
</p></li><li><span>Configure an IGP on the MPLS backbone network. In this example, OSPF is adopted to advertise routes. When configuring OSPF, advertise the 32-bit loopback interface addresses of PE1 and PE2.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack1]<strong> ip address 1.1.1.1 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>]<strong> ip address 192.168.12.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> ospf</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1]<strong> area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1-area-0.0.0.0]<strong> network 1.1.1.1 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1-area-0.0.0.0]<strong> network 192.168.12.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1-area-0.0.0.0]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-ospf-1]<strong> quit</strong></pre>
<p># Configure P.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>sysname P</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P] <strong>interface loopback 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-LoopBack2]<strong> ip address 2.2.2.2 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-LoopBack2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/0</span>]<strong> ip address 192.168.12.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/0</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P]<strong> interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/1</span>]<strong> ip address 192.168.23.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/1</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/1</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P]<strong> ospf</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-ospf-1]<strong> area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-ospf-1-area-0.0.0.0]<strong> network 2.2.2.2 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-ospf-1-area-0.0.0.0]<strong> network 192.168.12.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-ospf-1-area-0.0.0.0]<strong> network 192.168.23.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-ospf-1-area-0.0.0.0]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-ospf-1]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P-ospf-1]<strong> quit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>sysname PE2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2]<strong> interface loopback 3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-LoopBack3]<strong> ip address 3.3.3.3 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-LoopBack3]<strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/2</span>]<strong> ip address 192.168.23.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/2</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/2</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> ospf</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-1]<strong> area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-1-area-0.0.0.0]<strong> network 3.3.3.3 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-1-area-0.0.0.0]<strong> network 192.168.23.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-1-area-0.0.0.0]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-1]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-ospf-1]<strong> quit</strong></pre>
</p></li><li><span>Configure basic MPLS functions and LDP.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> mpls lsr-id 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> mpls </strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>]<strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/1</span>]<strong>quit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> mpls lsr-id 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> mpls </strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/2</span>]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/2</span>]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/2</span>]<strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-GigabitEthernet<span>0/1/2</span>]<strong>quit</strong></pre>
<p># Configure P.</p>
<pre class="screen">[<span class="keyword">*</span>P]<strong> mpls lsr-id 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P]<strong> mpls </strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-mpls]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-mpls-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/0</span>]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/0</span>]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P]<strong> interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/1</span>]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/1</span>]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/1</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P-GigabitEthernet<span>0/1/1</span>]<strong> quit</strong></pre>
</p></li><li><span>Enable MPLS L2VPN and configure a VSI.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-l2vpn]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> vsi v123 static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-v123]<strong> pwsignal ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-v123-ldp]<strong> vsi-id 123</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-v123-ldp]<strong> peer 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-v123-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-v123]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-vsi-v123]<strong> quit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-l2vpn]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> vsi v123 static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-v123]<strong> pwsignal ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-v123-ldp]<strong> vsi-id 123</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-v123-ldp]<strong> peer 1.1.1.1 upe</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-v123-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-v123]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-vsi-v123]<strong> quit</strong></pre>
</p></li><li><span>Configure remote MPLS LDP sessions for PE1 and PE2.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls ldp remote-peer PE2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp-remote-PE2] <strong>remote-ip 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp-remote-PE2] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-mpls-ldp-remote-PE2] <strong>quit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>mpls ldp remote-peer PE1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-ldp-remote-PE1] <strong>remote-ip 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-ldp-remote-PE1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-mpls-ldp-remote-PE1] <strong>quit</strong></pre>
</p></li><li><span>Bind the interface to the VSI on a PE.</span><p><p># Configure PE1. The configurations of GE <span>0/1/1</span> on PE2 are similar to the configuration of PE1, and are not mentioned here.</p>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> vlan 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vlan10]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> interface gigabitethernet <span>0/1/2</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/2</span>.1]<strong> l2 binding vsi v123</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/2</span>.1]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/2</span>.1]<strong> quit</strong></pre>
</p></li><li><span>Enable global IGMP snooping on the PE1 and PE2 and IGMP snooping in the VSI.</span><p><p># Configure PE1. The configurations of PE2 are similar to the configuration of PE1 and are not mentioned here.</p>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> igmp-snooping enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> vsi v123</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-v123]<strong> igmp-snooping enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-v123]<strong> igmp-snooping version 3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-v123]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-vsi-v123]<strong> quit</strong></pre>
</p></li><li><span>Configure the PW on PE1 as a static router port, and configure the querier on PE2. The default values are used for the querier and therefore no special configuration is required.</span><p><p># Configure PE1. </p>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> vsi v123</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-v123]<strong> igmp-snooping static-router-port remote-peer 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-v123]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-vsi-v123]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> quit</strong></pre>
<p># Configure PE2. </p>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> igmp-snooping send-query enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> vsi v123</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-v123]<strong> igmp-snooping querier enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-v123]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface Gigabitethernet<span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>] <strong>portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>] <strong>port default vlan 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>] <strong>igmp-snooping static-router-port vlan 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface Gigabitethernet<span>0/1/1</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>.1] <strong>vlan-type dot1q 11</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>.1] <strong>l2 binding vsi v123</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>.1] <strong>igmp-snooping static-router-port vsi v123</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>quit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p>Run the <a href="cmdqueryname=display+qinq+information+termination+interface"><b><span class="cmdname">display qinq information termination interface</span></b></a> command on PE1, and you can view information about the configured QinQ sub-interface.</p>
<pre class="screen">&lt;PE1&gt; <strong>display qinq information termination interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">  GigabitEthernet <span>0/1/2</span>.1
    VSI bound
    Total QinQ Num: 1
      qinq termination pe-vid 20 ce-vid 100
    Total vlan-group Num: 0
    encapsulation qinq-termination</pre>
<p>Run the <a href="cmdqueryname=display+mpls+ldp+session"><b><span class="cmdname">display mpls ldp session</span></b></a> command, and you view that MPLS LDP sessions on PE1, P, and PE2 are in the <strong>Operational</strong> state.</p>
<p>The following uses the command output on PE1 as an example.</p>
<pre class="screen">&lt;PE1&gt;<strong>display mpls ldp session</strong></pre>
<pre class="screen"> LDP Session(s) in Public Network
 Codes: LAM(Label Advertisement Mode), SsnAge Unit(DDDD:HH:MM)
<span> An asterisk (*) before a session means the session is being deleted.</span>
--------------------------------------------------------------------------
 PeerID             Status       LAM  SsnRole  SsnAge       KASent/Rcv
--------------------------------------------------------------------------
 2.2.2.2:0          <strong>Operational</strong> DU   Passive  0000:03:11   767/767
 3.3.3.3:0          <strong>Operational</strong> DU   Passive  0000:03:05   743/743
--------------------------------------------------------------------------
TOTAL: 2 Session(s) Found.</pre>
<p>Run the <a href="cmdqueryname=display+igmp-snooping+querier+vsi"><b><span class="cmdname">display igmp-snooping querier vsi</span></b></a> command on PE2, and you can check whether the configuration of the querier succeeds. If the <strong>Enable</strong> state is displayed in the following output, it indicates that the querier is enabled for VSI v123.</p>
<pre class="screen">&lt;PE2&gt; <strong>display igmp-snooping querier vsi v123</strong></pre>
<pre class="screen">VSI                             Querier-state Querier
---------------------------------------------------------------
v123                            <strong>Enable</strong>       192.168.0.1</pre>
<p>Run the <a href="cmdqueryname=display+igmp-snooping+router-port+vsi"><b><span class="cmdname">display igmp-snooping router-port vsi</span></b></a> command on PE1, and you can check whether the configuration of the static router port succeeds. If <strong>STATIC</strong> is displayed as shown in the following output, it indicates that PW (1.1.1.1/123) is configured as a static router port.</p>
<pre class="screen">&lt;PE1&gt; <strong>display igmp-snooping router-port vsi v123</strong></pre>
<pre class="screen"> Port Name                            UpTime        Expires       Flags
 --------------------------------------------------------------------------
 VSI v123, 1 router-port(s)
 PW(3.3.3.3/123)                      00:49:14      --            <strong>STATIC</strong></pre>
<p>Run the <a href="cmdqueryname=display+igmp-snooping+port-info"><b><span class="cmdname">display igmp-snooping port-info</span></b></a> command on PE1 to check information about the Layer 2 multicast interface.</p>
<pre class="screen">&lt;PE1&gt; <strong>display igmp-snooping port-info</strong></pre>
<pre class="screen"> -------------------------------------------------------------------------------
  Flag: S:Static     D:Dynamic     M:Ssm-mapping
        A:Active     P:Protocol    F:Fast-channel                                
                    (Source, Group)  Port                                      Flag
 -------------------------------------------------------------------------------
 VSI v123, 1 Entry(s)
                (1.1.1.1, 234.1.1.1)                                        P--
                                      GE<span>0/1/2</span>.1(PE:20/CE:100)               S--
                                                        1 port(s) include
 -------------------------------------------------------------------------------</pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172363323__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>PE1 configuration file</p>
<pre class="screen">#
sysname PE1
#
vlan batch 10
#
igmp-snooping enable
igmp-snooping send-query enable
#
mpls lsr-id 1.1.1.1
#
mpls
#
mpls l2vpn
#
vsi v123 static
 pwsignal ldp
  vsi-id 123
  peer 3.3.3.3
 igmp-snooping enable
 igmp-snooping version 3
 igmp-snooping static-router-port remote-peer 3.3.3.3
#
mpls ldp
#
mpls ldp remote-peer pe2
 remote-ip 3.3.3.3
#
interface Gigabitethernet<span>0/1/2</span>.1
 encapsulation qinq-termination
 qinq termination pe-vid 20 ce-vid 100
 l2 binding vsi v123
 l2-multicast static-group source-address 1.1.1.1 group-address 234.1.1.1 qinq pe-vid 20 ce-vid 100 vsi v123
#
interface Gigabitethernet<span>0/1/1</span>
 undo shutdown
 ip address 192.168.12.1 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 1.1.1.1 255.255.255.255
#
ospf 1
 area 0.0.0.0
  network 1.1.1.1 0.0.0.0
  network 192.168.12.0 0.0.0.255
#
return</pre>
</li><li><p>P configuration file</p>
<pre class="screen">#
sysname P
#
mpls lsr-id 2.2.2.2
#
mpls
#
mpls ldp
#
interface Gigabitethernet<span>0/1/0</span>
 undo shutdown
 ip address 192.168.12.2 255.255.255.0
 mpls
 mpls ldp
#
interface Gigabitethernet<span>0/1/1</span>
 undo shutdown
 ip address 192.168.23.1 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack2
 ip address 2.2.2.2 255.255.255.255
#
ospf 1
 area 0.0.0.0
  network 2.2.2.2 0.0.0.0
  network 192.168.12.0 0.0.0.255
  network 192.168.23.0 0.0.0.255
#
return</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#
sysname PE2
#
vlan batch 10
#
igmp-snooping enable
igmp-snooping send-query enable
#
mpls lsr-id 3.3.3.3
#
mpls
#
mpls l2vpn
#
vsi v123 static
 pwsignal ldp
  vsi-id 123
  peer 1.1.1.1 upe
 igmp-snooping enable
 igmp-snooping querier enable
#
mpls ldp
#
mpls ldp remote-peer pe1
 remote-ip 1.1.1.1
#
interface Gigabitethernet<span>0/1/2</span>
 undo shutdown
 ip address 192.168.23.2 255.255.255.0
 mpls
 mpls ldp
 <span>dcn</span>
#
interface Gigabitethernet<span>0/1/1</span>
 portswitch
 undo shutdown
 port default vlan 10
 igmp-snooping static-router-port vlan 10
#
interface Gigabitethernet<span>0/1/1</span>.1
 vlan-type dot1q 11
 l2 binding vsi v123
 igmp-snooping static-router-port vsi v123
#
interface LoopBack3
 ip address 3.3.3.3 255.255.255.255
#
ospf 1
 area 0.0.0.0
  network 3.3.3.3 0.0.0.0
  network 192.168.23.0 0.0.0.255
#
return</pre>
</li><li><p>CE1 configuration file</p>
<pre class="screen">#
 sysname CE1
#
 vlan batch 20
#
interface Gigabitethernet<span>0/1/2</span>
 portswitch
 port vlan-stacking vlan 100 stack-vlan 20
#
interface Gigabitethernet<span>0/1/1</span>
 portswitch
 port trunk allow-pass vlan 20
#
return </pre>
</li><li><p>CE2 configuration file</p>
<pre class="screen">#
 sysname CE2
#
 vlan batch 100
#
interface Gigabitethernet<span>0/1/2</span>
 portswitch
 port default vlan 100
#
interface Gigabitethernet<span>0/1/1</span>
 portswitch
 port trunk allow-pass vlan 100
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_qinq_cfg_0023_1.html">Configuration Examples for QinQ
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_qinq_cfg_0037.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_qinq_cfg_0044.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>