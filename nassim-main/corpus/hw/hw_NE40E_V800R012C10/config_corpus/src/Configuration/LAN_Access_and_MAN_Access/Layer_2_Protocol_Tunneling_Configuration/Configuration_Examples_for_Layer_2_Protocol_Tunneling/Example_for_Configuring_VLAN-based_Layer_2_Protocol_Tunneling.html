
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring VLAN-based Layer 2 Protocol Tunneling">
<meta name="abstract" content="When backbone network edge devices receive Layer 2 protocol data units (PDUs) that carry a single VLAN tag from user networks, configure VLAN-based Layer 2 protocol tunneling to allow the Layer 2 PDUs to be tunneled across the backbone network. Layer 2 PDUs from the user networks then travel through different Layer 2 tunnels to reach the destinations to perform Layer 2 protocol calculation. This example uses the Spanning Tree Protocol (STP).">
<meta name="description" content="When backbone network edge devices receive Layer 2 protocol data units (PDUs) that carry a single VLAN tag from user networks, configure VLAN-based Layer 2 protocol tunneling to allow the Layer 2 PDUs to be tunneled across the backbone network. Layer 2 PDUs from the user networks then travel through different Layer 2 tunnels to reach the destinations to perform Layer 2 protocol calculation. This example uses the Spanning Tree Protocol (STP).">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2bptnl_cfg_0017.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2bptnl_cfg_0027.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2bptnl_cfg_0029.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="wwx1238417">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="Layer 2 Protocol Tunneling">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="Layer 2 Protocol Tunneling">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="featurename" content="Layer 2 Protocol Tunneling">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="featurename" content="Layer 2 Protocol Tunneling">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="OWNER" content="c00648116,w00437000">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="wwx1238417">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172363036">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring VLAN-based Layer 2 Protocol Tunneling</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172363036"></a><a name="EN-US_TASK_0172363036"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring VLAN-based Layer 2 Protocol Tunneling</h1>
<div class="taskbody"><p>When backbone network edge devices receive Layer 2 protocol data units (PDUs) that carry a single VLAN tag from user networks, configure VLAN-based Layer 2 protocol tunneling to allow the Layer 2 PDUs to be tunneled across the backbone network. Layer 2 PDUs from the user networks then travel through different Layer 2 tunnels to reach the destinations to perform Layer 2 protocol calculation. This example uses the Spanning Tree Protocol (STP).</p>
<div class="context"><a name="EN-US_TASK_0172363036__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>When each edge device interface on a backbone network connects to more than one user network and Layer 2 PDUs from the user networks carry a single VLAN tag, configure VLAN-based Layer 2 protocol tunneling to allow the Layer 2 PDUs from the user networks to be tunneled across the backbone network. Layer 2 PDUs from the user networks then travel through different Layer 2 tunnels to reach the destinations to perform Layer 2 protocol calculation.</p>
<p>On the network shown in <a href="#EN-US_TASK_0172363036__fig_dc_vrp_l2bptnl_cfg_002801">Figure 1</a>, CEs are connected to PEs and run STP. Bridge protocol data units (BPDUs) from the CEs must traverse the backbone network on which the PEs reside. PE interfaces are aggregation interfaces, and the PEs use VLAN tags carried in BPDUs to identify users. To achieve the following requirements, configure VLAN-based Layer 2 protocol tunneling on the PEs:</p>
<ul><li><p>Devices in VLAN 100 build a spanning tree.</p>
</li><li><p>Devices in VLAN 200 build a spanning tree.</p>
</li></ul>
<p>The default multicast destination MAC address 0180-C200-0000 of BPDUs is used in this example.</p>
<div class="fignone" id="EN-US_TASK_0172363036__fig_dc_vrp_l2bptnl_cfg_002801"><a name="EN-US_TASK_0172363036__fig_dc_vrp_l2bptnl_cfg_002801"></a><a name="fig_dc_vrp_l2bptnl_cfg_002801"></a><span class="figcap"><b>Figure 1 </b>VLAN-based Layer 2 protocol tunneling networking</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 through 3 in this example represent GE<span>0/1/1</span>, GE<span>0/1/2</span>, GE<span>0/1/3</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_l2bptnl_cfg_001901.png"></span><br></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172363036__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Switch the interfaces on the CEs, Ls, PEs, and the P to Layer 2 interfaces.</p>
</li><li>Enable STP on the CEs and PEs.</li><li>Configure Layer 2 forwarding on the CEs so that the CEs send tagged BPDUs to the PEs.</li><li>Configure Layer 2 forwarding on the aggregation devices L1 and L2 to allow BPDUs that carry specific VLAN IDs to pass through.</li><li><p>Configure VLAN-based Layer 2 protocol tunneling on the PEs:</p>
<ol type="a"><li>Configure Layer 2 forwarding on the PEs to allow BPDUs that carry specific VLAN IDs to pass through.</li><li>Disable STP on PEs' user-side interfaces and enable Layer 2 protocol tunneling on tagged interfaces.</li><li>Configure the PEs to replace the multicast destination MAC address in the BPDUs from the CEs. </li></ol>
</li><li>Configure Layer 2 forwarding on the P to allow BPDUs that carry specific VLAN IDs to pass through.</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172363036__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li>Types and numbers of the interfaces that connect the CEs and Ls, that connect the PEs and Ls, and that connect the PEs and the P</li><li>VLAN IDs of the CEs</li><li>VLAN IDs of BPDUs that are allowed to pass through the Ls and PEs</li><li>Specified multicast MAC address to replace the multicast destination MAC address in BPDUs</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172363036__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Run the <a href="cmdqueryname=portswitch"><b><span class="cmdname">portswitch</span></b></a> command to switch each involved interface from Layer 3 mode to Layer 2 mode.</span><p><p>Switch all interfaces on the CEs, Ls, PEs, and the P in the <a href="#EN-US_TASK_0172363036__fig_dc_vrp_l2bptnl_cfg_002801">Figure 1</a> to Layer 2 interfaces.</p>
</p></li><li><span>Enable STP on the CEs and PEs.</span><p><p># Configure CE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>stp enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>commit</strong></pre>
<p># Configure CE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>stp enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>commit</strong></pre>
<p># Configure CE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE3] <strong>stp enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3] <strong>commit</strong></pre>
<p># Configure CE4.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE4] <strong>stp enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE4] <strong>commit</strong></pre>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>stp enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>stp enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</p></li><li><span>Configure Layer 2 forwarding on the CEs so that the CEs send tagged BPDUs to the PEs.</span><p><p># Configure CE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>vlan 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-vlan100] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/1</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/1</span>] <strong>port link-type trunk</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/1</span>] <strong>port trunk allow-pass vlan 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/1</span>] <strong>stp bpdu vlan 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>commit</strong></pre>
<p># Configure CE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>vlan 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-vlan100] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>] <strong>port link-type trunk</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>] <strong>port trunk allow-pass vlan 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>] <strong>stp bpdu vlan 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>commit</strong></pre>
<p># Configure CE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE3] <strong>vlan 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-vlan200] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-GigabitEthernet<span>0/1/1</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-GigabitEthernet<span>0/1/1</span>] <strong>port link-type trunk</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-GigabitEthernet<span>0/1/1</span>] <strong>port trunk allow-pass vlan 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-GigabitEthernet<span>0/1/1</span>] <strong>stp bpdu vlan 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3] <strong>commit</strong></pre>
<p># Configure CE4.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE4] <strong>vlan 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE4-vlan200] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE4] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE4-GigabitEthernet<span>0/1/1</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE4-GigabitEthernet<span>0/1/1</span>] <strong>port link-type trunk</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE4-GigabitEthernet<span>0/1/1</span>] <strong>port trunk allow-pass vlan 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE4-GigabitEthernet<span>0/1/1</span>] <strong>stp bpdu vlan 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE4-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE4] <strong>commit</strong></pre>
</p></li><li><span>Configure Layer 2 forwarding on the aggregation devices L1 and L2 to allow BPDUs that carry specific VLAN IDs to pass through.</span><p><p># Configure L1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>L1] <strong>vlan batch 100 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L1] <strong>interface gigabitethernet <span>0/1/3</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>L1-GigabitEthernet<span>0/1/3</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L1-GigabitEthernet<span>0/1/3</span>] <strong>port link-type trunk</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L1-GigabitEthernet<span>0/1/3</span>] <strong>port trunk allow-pass vlan 100 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L1-GigabitEthernet<span>0/1/3</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L1] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>L1-GigabitEthernet<span>0/1/1</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L1-GigabitEthernet<span>0/1/1</span>] <strong>port link-type trunk</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L1-GigabitEthernet<span>0/1/1</span>] <strong>port trunk allow-pass vlan 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L1-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L1] <strong>interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>L1-GigabitEthernet<span>0/1/2</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L1-GigabitEthernet<span>0/1/2</span>] <strong>port link-type trunk</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L1-GigabitEthernet<span>0/1/2</span>] <strong>port trunk allow-pass vlan 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L1-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L1] <strong>commit</strong></pre>
<p># Configure L2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>L2] <strong>vlan batch 100 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2] <strong>interface gigabitethernet <span>0/1/3</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2-GigabitEthernet<span>0/1/3</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2-GigabitEthernet<span>0/1/3</span>] <strong>port link-type trunk</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2-GigabitEthernet<span>0/1/3</span>] <strong>port trunk allow-pass vlan 100 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2-GigabitEthernet<span>0/1/3</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2-GigabitEthernet<span>0/1/1</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2-GigabitEthernet<span>0/1/1</span>] <strong>port link-type trunk</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2-GigabitEthernet<span>0/1/1</span>] <strong>port trunk allow-pass vlan 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2] <strong>interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2-GigabitEthernet<span>0/1/2</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2-GigabitEthernet<span>0/1/2</span>] <strong>port link-type trunk</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2-GigabitEthernet<span>0/1/2</span>] <strong>port trunk allow-pass vlan 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>L2] <strong>commit</strong></pre>
</p></li><li><span>Configure VLAN-based Layer 2 protocol tunneling on the PEs.</span><p><ol type="a"><li><p>Configure Layer 2 forwarding on the PEs.</p>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>vlan batch 100 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/2</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/2</span>] <strong>port link-type trunk</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/2</span>] <strong>port trunk allow-pass vlan 100 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>port link-type trunk</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>port trunk allow-pass vlan 100 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>vlan batch 100 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/2</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/2</span>] <strong>port link-type trunk</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/2</span>] <strong>port trunk allow-pass vlan 100 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>] <strong>port link-type trunk</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>] <strong>port trunk allow-pass vlan 100 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</li><li><p>Disable STP on PEs' user-side interfaces and enable Layer 2 protocol tunneling on tagged interfaces.</p>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>stp disable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>l2protocol-tunnel stp enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>] <strong>stp disable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>] <strong>l2protocol-tunnel stp enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</li><li><p>Configure the PEs to replace the multicast destination MAC address in the BPDUs from the CEs. </p>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>l2protocol-tunnel stp group-mac 0100-5e00-0011</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>l2protocol-tunnel stp group-mac 0100-5e00-0011</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</li></ol>
</p></li><li><span>Configure Layer 2 forwarding on the P.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P] <strong>vlan batch 100 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/2</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/2</span>] <strong>port link-type trunk</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/2</span>] <strong>port trunk allow-pass vlan 100 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/1</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/1</span>] <strong>port link-type trunk</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/1</span>] <strong>port trunk allow-pass vlan 100 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>commit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p>After completing the configurations, run the <a href="cmdqueryname=display+l2protocol-tunnel+group-mac"><b><span class="cmdname">display l2protocol-tunnel group-mac</span></b></a> command on the PEs to view Layer 2 protocol tunneling information, such as the tunneled Layer 2 protocol names, protocol types, multicast destination MAC addresses, and specified multicast MAC addresses (group MAC addresses).</p>
<p>The following example uses the command output on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display l2protocol-tunnel group-mac stp</strong></pre>
<pre class="screen">Protocol         Protocol-MAC   Group-MAC       
-----------------------------------------------------------------------------
stp              0180-c200-0000 0100-5e00-0011 </pre>
<p>After completing the configurations, run the <a href="cmdqueryname=display+stp"><b><span class="cmdname">display stp</span></b></a> <strong><span>brief</span></strong> command on the CEs to view the MSTP port role. The following example uses the command output on CE3 and CE4. The command output shows that GE <span>0/1/1</span> on CE3 is the root port and GE <span>0/1/1</span> on CE4 is the designated port.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE3] <strong>display stp brief</strong></pre>
<pre class="screen"> MSTID  Port                        Role  STP State     Protection   Cost   Edged
     0  GigabitEthernet<span>0/1/1</span>        <strong>ROOT</strong>  forwarding    none       199999   disable</pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE4] <strong>display stp brief</strong></pre>
<pre class="screen"> MSTID  Port                        Role  STP State     Protection   Cost   Edged
     0  GigabitEthernet<span>0/1/1</span>        <strong>DESI</strong>  forwarding    none       199999   disable</pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172363036__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>CE1 configuration file</p>
<pre class="screen">#
sysname CE1
#
vlan batch 100
#
stp enable
#
interface GigabitEthernet<span>0/1/1</span>
 <span>portswitch</span>
 port link-type trunk
 port trunk allow-pass vlan 100
 stp bpdu vlan 100
#
return</pre>
</li><li><p>CE2 configuration file</p>
<pre class="screen">#
sysname CE2
#
vlan batch 100
#
stp enable
#
interface GigabitEthernet<span>0/1/1</span>
 <span>portswitch</span>
 port link-type trunk
 port trunk allow-pass vlan 100
 stp bpdu vlan 100
#
return</pre>
</li><li><p>CE3 configuration file</p>
<pre class="screen">#
sysname CE3
#
vlan batch 200
#
stp enable
#
interface GigabitEthernet<span>0/1/1</span>
 <span>portswitch</span>
 port link-type trunk
 port trunk allow-pass vlan 200
 stp bpdu vlan 200
#
return</pre>
</li><li><p>CE4 configuration file</p>
<pre class="screen">#
sysname CE4
#
vlan batch 200
#
stp enable
#
interface GigabitEthernet<span>0/1/1</span>
 <span>portswitch</span>
 port link-type trunk
 port trunk allow-pass vlan 200
 stp bpdu vlan 200
#
return</pre>
</li><li><p>PE1 configuration file</p>
<pre class="screen">#
sysname PE1
#
vlan batch 100 200
#
l2protocol-tunnel stp group-mac 0100-5e00-0011
#
interface GigabitEthernet<span>0/1/1</span>
 <span>portswitch</span>
 port link-type dot1q-tunnel
 port default vlan 100 200
 stp disable
 l2protocol-tunnel stp enable
#
interface GigabitEthernet<span>0/1/2</span>
 <span>portswitch</span>
 port link-type trunk
 port trunk allow-pass vlan 100 200
#
return</pre>
</li><li><p>P configuration file</p>
<pre class="screen">#
sysname P
#
vlan batch 100 200
#
interface GigabitEthernet<span>0/1/1</span>
 <span>portswitch</span>
 port link-type trunk
 port trunk allow-pass vlan 100 200
#
interface GigabitEthernet<span>0/1/2</span>
 <span>portswitch</span>
 port link-type trunk
 port trunk allow-pass vlan 100 200
#
return</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#
sysname PE2
#
vlan batch 100 200
#
l2protocol-tunnel stp group-mac 0100-5e00-0011
#
interface GigabitEthernet<span>0/1/1</span>
 <span>portswitch</span>
 port link-type trunk
 port trunk allow-pass vlan 100 200
 stp disable
 l2protocol-tunnel stp enable
#
interface GigabitEthernet<span>0/1/2</span>
 <span>portswitch</span>
 port link-type trunk
 port trunk allow-pass vlan 100 200
#
return</pre>
</li><li><p>L1 configuration file</p>
<pre class="screen">#
sysname L1
#
vlan batch 100 200
#
interface GigabitEthernet<span>0/1/1</span>
 <span>portswitch</span>
 port link-type trunk
 port trunk allow-pass vlan 100
#
interface GigabitEthernet<span>0/1/2</span>
 <span>portswitch</span>
 port link-type trunk
 port trunk allow-pass vlan 200
#
interface GigabitEthernet<span>0/1/3</span>
 <span>portswitch</span>
 port link-type trunk
 port trunk allow-pass vlan 100 200
#
return</pre>
</li><li><p>L2 configuration file</p>
<pre class="screen">#
sysname L2
#
vlan batch 100 200
#
interface GigabitEthernet<span>0/1/1</span>
 <span>portswitch</span>
 port link-type trunk
 port trunk allow-pass vlan 100
#
interface GigabitEthernet<span>0/1/2</span>
 <span>portswitch</span>
 port link-type trunk
 port trunk allow-pass vlan 200
#
interface GigabitEthernet<span>0/1/3</span>
 <span>portswitch</span>
 port link-type trunk
 port trunk allow-pass vlan 100 200
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2bptnl_cfg_0017.html">Configuration Examples for Layer 2 Protocol Tunneling
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2bptnl_cfg_0027.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2bptnl_cfg_0029.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>