
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring a Dot1q VLAN Tag Termination Sub-interface to Support DHCP Relay">
<meta name="abstract" content="This example shows how to configure the dot1q VLAN tag termination sub-interface to support Dynamic Host Configuration Protocol (DHCP) relay so that the DHCP relay agent transmits DHCP request packets from DHCP clients to a DHCP server. This configuration enables the clients to dynamically obtain IP addresses from the DHCP server.">
<meta name="description" content="This example shows how to configure the dot1q VLAN tag termination sub-interface to support Dynamic Host Configuration Protocol (DHCP) relay so that the DHCP relay agent transmits DHCP request packets from DHCP clients to a DHCP server. This configuration enables the clients to dynamically obtain IP addresses from the DHCP server.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_qinq_cfg_0023_1.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_qinq_cfg_0033.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_qinq_cfg_0035.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="wwx1238417">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="QinQ">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="QinQ">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="featurename" content="QinQ">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="featurename" content="QinQ">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="OWNER" content="c00648116,w00437000">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="wWX1238417">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172363315">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring a Dot1q VLAN Tag Termination Sub-interface to Support DHCP Relay</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172363315"></a><a name="EN-US_TASK_0172363315"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring a Dot1q VLAN Tag Termination Sub-interface to Support DHCP Relay</h1>
<div class="taskbody"><p>This example shows how to configure the dot1q VLAN tag termination sub-interface to support Dynamic Host Configuration Protocol (DHCP) relay so that the DHCP relay agent transmits DHCP request packets from DHCP clients to a DHCP server. This configuration enables the clients to dynamically obtain IP addresses from the DHCP server.</p>
<div class="context"><a name="EN-US_TASK_0172363315__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>If the DHCP client and DHCP server belong to different sub-nets, you need to deploy a DHCP relay agent to forward DHCP request packets from the client to the server so that the client can dynamically obtain IP addresses from the DHCP server.</p>
<p id="EN-US_TASK_0172363315__p_1">If a DHCP client connects to a DHCP relay agent through a VLAN tag termination sub-interface, you need to configure the sub-interface to support DHCP relay on the DHCP relay agent. Without the configuration, the DHCP relay agent considers the received user packets with VLAN tags to be invalid. As a result, the DHCP client cannot dynamically obtain IP addresses from a DHCP server.</p>
<p>On the network shown in <a href="#EN-US_TASK_0172363315__fig_dc_vrp_qinq_cfg_003401">Figure 1</a>, a DHCP client and a DHCP server belong to different network segments. The DHCP client is connected to a DHCP relay agent through a CE and then connected to the DHCP server through the DHCP relay agent. The packets sent from the CE to the DHCP relay agent carry one VLAN tag. On the DHCP relay agent, the dot1q VLAN tag termination sub-interface needs to be configured to support DHCP relay, ensuring that the DHCP client can dynamically obtain an IP address from the DHCP server.</p>
<div class="fignone" id="EN-US_TASK_0172363315__fig_dc_vrp_qinq_cfg_003401"><a name="EN-US_TASK_0172363315__fig_dc_vrp_qinq_cfg_003401"></a><a name="fig_dc_vrp_qinq_cfg_003401"></a><span class="figcap"><b>Figure 1 </b>Typical networking for configuring the dot1q VLAN tag termination sub-interface to support DHCP relay</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interfaces 1 and 2 and sub-interface1.1 represent GE<span>0/1/1</span>, GE<span>0/1/2</span>, and GE<span>0/1/1</span>.1, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0000001591624810.png" width="NaN" height="NaN"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172363315__1.4.2"></a><a name="1.4.2"></a>
<div class="p" id="EN-US_TASK_0172363315__context_1"><h4 class="sectiontitle">Precautions</h4><p id="EN-US_TASK_0172363315__p1231499520214028">If the DHCP client sends broadcast packets, the interface that has DHCP relay enabled must support broadcast.</p>
</div></div>
<div class="context"><a name="EN-US_TASK_0172363315__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Create a VLAN and configure the Layer 2 forwarding function on the CE so that the packets sent from the CE to the DHCP relay agent carry one VLAN tag.</p>
</li><li><p>Configure DHCP relay on the DHCP relay agent and configure the dot1q VLAN tag termination sub-interface to support DHCP relay so that the DHCP client and server can communicate using DHCP packets.</p>
</li><li><p>Enable basic DHCP functions and configure an address pool on the DHCP server so that the DHCP server can assign IP addresses correctly.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172363315__1.4.4"></a><a name="1.4.4"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li>User VLAN ID</li><li>Names of the interfaces that connect the CE and the DHCP client</li><li>Names and IP addresses of the interfaces that connect the DHCP relay agent and the CE</li><li>Names and IP addresses of the interfaces that connect the DHCP relay agent and the DHCP server</li><li>IP address pool range of the DHCP server</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172363315__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Create a VLAN and configure the Layer 2 forwarding function on the CE.</span><p><pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname CE</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE] <strong>vlan 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-vlan10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-GigabitEthernet<span>0/1/1</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-GigabitEthernet<span>0/1/1</span>] <strong>portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-GigabitEthernet<span>0/1/1</span>] <strong>port link-type access</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-GigabitEthernet<span>0/1/1</span>] <strong>port default vlan 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE] <strong>interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-GigabitEthernet<span>0/1/2</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-GigabitEthernet<span>0/1/2</span>] <strong>portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-GigabitEthernet<span>0/1/2</span>] <strong>port link-type trunk</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-GigabitEthernet<span>0/1/2</span>] <strong>port trunk allow-pass vlan 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE] <strong>commit</strong></pre>
</p></li><li><span>Configure DHCP relay on the DHCP relay agent, and configure the dot1q VLAN tag termination sub-interface to support DHCP relay.</span><p><p># Enable DHCP.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname DHCP-Relay</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DHCP-Relay] <strong>dhcp enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DHCP-Relay] <strong>commit</strong></pre>
<p># Assign an IP address to the network-side GE <span>0/1/2</span> on the DHCP relay agent.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DHCP-Relay] <strong>interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>DHCP-Relay-GigabitEthernet<span>0/1/2</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DHCP-Relay-GigabitEthernet<span>0/1/2</span>] <strong>ip address 192.168.2.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DHCP-Relay-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DHCP-Relay] <strong>commit</strong></pre>
<p># Assign an IP address to the user-side GE <span>0/1/1</span>.1 on the DHCP relay agent. This IP address must be on the same network segment as the IP address of the DHCP client.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DHCP-Relay] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>DHCP-Relay-GigabitEthernet<span>0/1/1</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DHCP-Relay-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DHCP-Relay] <strong>interface gigabitethernet <span>0/1/1</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DHCP-Relay-GigabitEthernet<span>0/1/1</span>.1] <strong>ip address 192.168.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DHCP-Relay-GigabitEthernet<span>0/1/1</span>.1] <strong>ip relay address 192.168.3.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DHCP-Relay-GigabitEthernet<span>0/1/1</span>.1] <strong>dhcp select relay</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DHCP-Relay-GigabitEthernet<span>0/1/1</span>.1] <strong>commit</strong></pre>
<p># Configure the dot1q VLAN tag termination sub-interface to support DHCP relay.</p>
<pre class="screen">[<span class="keyword">*</span>DHCP-Relay] <strong>interface gigabitethernet <span>0/1/1</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DHCP-Relay-GigabitEthernet<span>0/1/1</span>.1] <strong>control-vid 1 dot1q-termination</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DHCP-Relay-GigabitEthernet<span>0/1/1</span>.1] <strong>dot1q termination vid 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DHCP-Relay-GigabitEthernet<span>0/1/1</span>.1] <strong>arp broadcast enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DHCP-Relay-GigabitEthernet<span>0/1/1</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DHCP-Relay] <strong>commit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><ul><li><p>If Option82 is not configured on the dot1q VLAN tag termination sub-interface on the DHCP relay agent, the sub-interface encapsulates only the smallest VLAN ID configured on it in DHCP packets and forwards the packets to DHCP clients.</p>
<p>In this example, if <strong><span>dot1q termination vid 10</span></strong> and <strong><span>dot1q termination vid 20</span></strong> are configured on the dot1q VLAN tag termination sub-interface, the sub-interface encapsulates VLAN 10 in the DHCP packets and forwards the packets to the DHCP client. In this case, DHCP clients in VLAN 20 cannot obtain IP addresses.</p>
</li><li><p>If Option82 is configured on the dot1q VLAN tag termination sub-interface on the DHCP relay agent, the sub-interface encapsulates the corresponding VLAN IDs in the DHCP packets and forwards the packets to DHCP clients.</p>
</li></ul>
</div></div>
</p></li><li id="EN-US_TASK_0172363315__step_1"><span id="EN-US_TASK_0172363315__cmd811675002214028">Configure a DHCP server.</span><p><p id="EN-US_TASK_0172363315__p1602593954214028">The configuration details are not provided here.</p>
<ul id="EN-US_TASK_0172363315__ul1655938214028"><li id="EN-US_TASK_0172363315__li905856316214028">When configuring the DHCP server, ensure that an IP address pool is configured on the DHCP server so that the DHCP server can assign IP addresses to DHCP clients.</li><li id="EN-US_TASK_0172363315__li1102917177214028">It is recommended that the address pool lease be configured to improve IP address utilization.</li></ul>
</p></li><li><span>Verify the configuration.</span><p><p>After the configurations are complete, run the <strong>display dhcp relay address</strong> command on the DHCP relay agent to view the DHCP configuration on the interface that has DHCP relay enabled.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DHCP-Relay] <strong>display dhcp relay address all</strong></pre>
<pre class="screen">** GigabitEthernet<span>0/1/1</span>.1 DHCP Relay Address  **
 Dhcp Option          Relay Agent IP       Server IP     
 *                    -                   <strong> 192.168.3.1</strong></pre>
<p>The DHCP client can obtain an IP address from the DHCP server through the DHCP relay agent.</p>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172363315__1.4.6"></a><a name="1.4.6"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>DHCP relay agent configuration file</p>
<pre class="screen">#
 sysname DHCP-Relay
#
dhcp enable
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
#
interface GigabitEthernet<span>0/1/1</span>.1
 encapsulation dot1q-termination
 dot1q termination vid 10
 ip address 192.168.1.1 255.255.255.0
 ip relay address 192.168.3.1
 dhcp select relay
 arp broadcast enable
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ip address 192.168.2.1 255.255.255.0
#
return</pre>
</li><li><p>CE configuration file</p>
<pre class="screen">#
 sysname CE
#
 vlan batch 10
#
interface GigabitEthernet<span>0/1/2</span>
 portswitch
 undo shutdown
 port link-type trunk
 port trunk allow-pass vlan 10
#
interface GigabitEthernet<span>0/1/1</span>
 portswitch
 undo shutdown
 port link-type access
 port default vlan 10
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_qinq_cfg_0023_1.html">Configuration Examples for QinQ
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_qinq_cfg_0033.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_qinq_cfg_0035.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>