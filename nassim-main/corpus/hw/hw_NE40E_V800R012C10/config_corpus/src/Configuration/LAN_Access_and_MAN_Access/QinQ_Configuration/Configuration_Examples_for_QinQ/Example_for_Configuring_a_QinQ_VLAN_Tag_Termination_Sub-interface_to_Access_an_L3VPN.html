
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring a QinQ VLAN Tag Termination Sub-interface to Access an L3VPN">
<meta name="abstract" content="This section describes how to configure a QinQ VLAN tag termination sub-interface to provide Layer 3 virtual private network (L3VPN) access and how to ensure that users communicate over the L3VPN using double-tagged packets.">
<meta name="description" content="This section describes how to configure a QinQ VLAN tag termination sub-interface to provide Layer 3 virtual private network (L3VPN) access and how to ensure that users communicate over the L3VPN using double-tagged packets.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_qinq_cfg_0023_1.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_qinq_cfg_0030.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_qinq_cfg_0032.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="wwx1238417">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="QinQ">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="QinQ">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="featurename" content="QinQ">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="featurename" content="QinQ">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="OWNER" content="c00648116,w00437000">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="wwx1238417">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172363307">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring a QinQ VLAN Tag Termination Sub-interface to Access an L3VPN</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172363307"></a><a name="EN-US_TASK_0172363307"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring a QinQ VLAN Tag Termination Sub-interface to Access an L3VPN</h1>
<div class="taskbody"><p>This section describes how to configure a QinQ VLAN tag termination sub-interface to provide Layer 3 virtual private network (L3VPN) access and how to ensure that users communicate over the L3VPN using double-tagged packets.</p>
<div class="context"><a name="EN-US_TASK_0172363307__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>When a VLAN tag termination sub-interface is used to access an L3VPN network, this sub-interface needs to be bound to a VPN instance to enable Layer 3 communication.</p>
<p>On the network shown in <a href="#EN-US_TASK_0172363307__fig_dc_vrp_qinq_cfg_003101">Figure 1</a>, the CEs connect to the PEs through the <span class="keyword">Router</span>s, and the <span class="keyword">Router</span>s access the L3VPN through QinQ VLAN tag termination sub-interfaces. Packets sent by the <span class="keyword">Router</span>s to the PEs carry two VLAN tags. To ensure that user networks on which CE1 and CE2 reside can communicate and that user networks on which CE3 and CE4 reside can communicate, configure QinQ VLAN tag termination sub-interfaces on PE1 and PE2 and bind these sub-interfaces to virtual private network (VPN) instances to provide L3VPN access.</p>
<div class="fignone" id="EN-US_TASK_0172363307__fig_dc_vrp_qinq_cfg_003101"><a name="EN-US_TASK_0172363307__fig_dc_vrp_qinq_cfg_003101"></a><a name="fig_dc_vrp_qinq_cfg_003101"></a><span class="figcap"><b>Figure 1 </b>Typical networking for configuring the QinQ VLAN tag termination sub-interface to provide L3VPN access</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interfaces 1 through 3, subinterface1.1, and subinterface1.2 represent GE<span>0/1/1</span>, GE<span>0/1/2</span>, GE<span>0/1/3</span>, GE<span>0/1/1</span>.1, and GE<span>0/1/1</span>.2, respectively.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_qinq_cfg_003101.png"></span><br></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172363307__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure the Layer 2 forwarding function on the CEs so that the packets sent by the CEs to the <span class="keyword">Router</span>s carry one VLAN tag.</p>
</li><li><p>Configure the QinQ and Layer 2 forwarding functions on <span class="keyword">Device</span> A and <span class="keyword">Device</span> B so that packets sent by <span class="keyword">Device</span> A to PE1 and packets sent by <span class="keyword">Device</span> B to PE2 carry two VLAN tags.</p>
</li><li><p>Configure L3VPN services on PE1, the P, and PE2, configure QinQ VLAN tag termination sub-interfaces on PE1 and PE2, and bind these sub-interfaces to VPN instances so that users can communicate over the L3VPN.</p>
<ol type="a"><li><p>Configure a routing protocol on PE1, the P, and PE2 to ensure Layer 3 connectivity.</p>
<p>Open Shortest Path First (OSPF) is used in this example.</p>
</li><li>Configure basic Multiprotocol Label Switching (MPLS) functions and MPLS Label Distribution Protocol (LDP) on PE1, the P, and PE2 and set up MPLS Label Switched Paths (LSPs) between these devices.</li><li>Configure VPN instances and QinQ VLAN tag termination sub-interfaces on PE1 and PE2, bind these sub-interfaces to the VPN instances to provide L3VPN access.</li><li>Establish a Multiprotocol Internal Border Gateway Protocol (MP-IBGP) peer relationship between the PEs so that users in the same VPN instance can communicate.</li><li>Establish External BGP (EBGP) peer relationships between the PEs and CEs to exchange VPN routes so that the CEs can communicate.</li></ol>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172363307__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li>Users' VLAN IDs and IP addresses</li><li>Names and IP addresses of the interfaces that connect the <span class="keyword">Router</span>s to the CEs</li><li>VLAN IDs in the outer VLAN tags of packets sent by <span class="keyword">Device</span> A to PE1 and packets sent by <span class="keyword">Device</span> B to PE2</li><li>Names and IP addresses of the interfaces that connect the PEs and the <span class="keyword">Router</span>s</li><li>Names and IP addresses of the interfaces that connect PE1 and PE2</li><li>MPLS LSR IDs of the PEs and P, names of VPN instances on the PEs, and VPN targets of VPN routes</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172363307__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure Layer 2 forwarding on the CEs.</span><p><p># Configure CE1.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname CE1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>vlan 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-vlan10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/1</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>interface gigabitethernet <span>0/1/1</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/1</span>.1] <strong>ip address 10.1.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/1</span>.1] <strong>vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/1</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>commit</strong></pre>
<p># Configure CE2.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname CE2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>vlan 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-vlan10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>interface gigabitethernet <span>0/1/1</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>.1] <strong>ip address 10.2.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>.1] <strong>vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>commit</strong></pre>
<p># Configure CE3.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname CE3</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE3] <strong>vlan 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-vlan20] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-GigabitEthernet<span>0/1/1</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3] <strong>interface gigabitethernet <span>0/1/1</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-GigabitEthernet<span>0/1/1</span>.1] <strong>ip address 10.3.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-GigabitEthernet<span>0/1/1</span>.1] <strong>vlan-type dot1q 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-GigabitEthernet<span>0/1/1</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3] <strong>commit</strong></pre>
<p># Configure CE4.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname CE4</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE4] <strong>vlan 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE4-vlan20] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE4] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE4-GigabitEthernet<span>0/1/1</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE4-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE4] <strong>interface gigabitethernet <span>0/1/1</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE4-GigabitEthernet<span>0/1/1</span>.1] <strong>ip address 10.4.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE4-GigabitEthernet<span>0/1/1</span>.1] <strong>vlan-type dot1q 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE4-GigabitEthernet<span>0/1/1</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE4] <strong>commit</strong></pre>
</p></li><li><span>Configure the QinQ and Layer 2 forwarding functions on the <span class="keyword">Router</span>s.</span><p><p># Configure <span class="keyword">Device</span> A.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname <span class="keyword">Device</span>A</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>vlan 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-vlan100] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/1</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/1</span>] <strong>portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/1</span>] <strong>port vlan-stacking vlan 10 stack-vlan 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/2</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/2</span>] <strong>portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/2</span>] <strong>port vlan-stacking vlan 20 stack-vlan 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>interface gigabitethernet <span>0/1/3</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/3</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/3</span>] <strong>portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/3</span>] <strong>port link-type trunk</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/3</span>] <strong>port trunk allow-pass vlan 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/3</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
<p># Configure <span class="keyword">Device</span> B.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname <span class="keyword">Device</span>B</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>vlan 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-vlan100] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/1</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/1</span>] <strong>portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/1</span>] <strong>port vlan-stacking vlan 10 stack-vlan 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/2</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/2</span>] <strong>portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/2</span>] <strong>port vlan-stacking vlan 20 stack-vlan 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>interface gigabitethernet <span>0/1/3</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/3</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/3</span>] <strong>portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/3</span>] <strong>port link-type trunk</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/3</span>] <strong>port trunk allow-pass vlan 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/3</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>commit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0172363307__en-us_task_0172363299_p637825194214028">If the device does not support the <strong><span id="EN-US_TASK_0172363307__en-us_task_0172363299_cmdparmname516997901214028">port vlan-stacking</span></strong> command, you can run the <a href="cmdqueryname=port+link-type+dot1q-tunnel"><b><span class="cmdname" id="EN-US_TASK_0172363307__en-us_task_0172363299_cmdname1201003618214028">port link-type dot1q-tunnel</span></b></a> command and <a href="cmdqueryname=port+default+vlan"><b><span class="cmdname" id="EN-US_TASK_0172363307__en-us_task_0172363299_cmdname1581172039214028">port default vlan</span></b></a> command on the interface to configure the QinQ function.</p>
</div></div>
</p></li><li><span>Configure an L3VPN.</span><p><ol type="a"><li><p id="EN-US_TASK_0172363307__en-us_task_0172363305_p381083222214028">Configure OSPF on PE1, the P, and PE2.</p>
<p id="EN-US_TASK_0172363307__en-us_task_0172363305_p258452210214028">Assign an IP address to each interface on the PEs and P. Make sure that the 32-bit loopback addresses of PE1, the P, and PE2 are advertised after OSPF is enabled.</p>
<p id="EN-US_TASK_0172363307__en-us_task_0172363305_p94732186214028"># Configure PE1.</p>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen456140600214028">&lt;<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1302012325214028">HUAWEI</span>&gt; <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b716248751214028">system-view</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1002542927214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword292392310214028"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword794969834214028">HUAWEI</span>] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1299012935214028">sysname PE1</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen513812479214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword17216492214028">*</span><span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1594772346214028">HUAWEI</span>] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b2114687732214028">commit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1891436406214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword555553527214028"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b293592769214028">interface loopback 1</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen964408160214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword501696788214028">*</span>PE1-LoopBack1] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1743866217214028">ip address 1.1.1.9 32</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen3802698214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1039159696214028">*</span>PE1-LoopBack1] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b2017271055214028">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1417192011214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1076116345214028">*</span>PE1] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1730889844214028">interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen557767646214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword972081120214028">*</span>PE1-GigabitEthernet<span>0/1/2</span>] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1993496909214028">ip address 192.168.1.1 24</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen172010763214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword648192982214028">*</span>PE1-GigabitEthernet<span>0/1/2</span>] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1516454144214028">undo shutdown</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1980620975214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword432634981214028">*</span>PE1-GigabitEthernet<span>0/1/2</span>] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b236972621214028">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen895133091214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1898151237214028">*</span>PE1] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b593124108214028">ospf</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen559867141214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword818573914214028">*</span>PE1-ospf-1] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b170197492214028">area 0</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1385544061214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword341106742214028">*</span>PE1-ospf-1-area-0.0.0.0] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b780399136214028">network 1.1.1.9 0.0.0.0</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen468748392214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1458884086214028">*</span>PE1-ospf-1-area-0.0.0.0] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1781777319214028">network 192.168.1.0 0.0.0.255</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1084309022214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword896702808214028">*</span>PE1-ospf-1-area-0.0.0.0] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b2117604151214028">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen397987597214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword467708677214028">*</span>PE1-ospf-1] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1863901065214028">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen875726504214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword761299327214028">*</span>PE1] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1263710460214028">commit</strong></pre>
<p id="EN-US_TASK_0172363307__en-us_task_0172363305_p1635916874214028"># Configure the P.</p>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen412408737214028">&lt;<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword162987062214028">HUAWEI</span>&gt; <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1065435049214028">system-view</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1622780258214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1674428767214028"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1498576681214028">HUAWEI</span>] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b2108114302214028">sysname P</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen940715474214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1550505122214028">*</span><span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1773012756214028">HUAWEI</span>] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b588108372214028">commit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen947809950214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword865618422214028"><font style="font-size:8pt" Face="Courier New" >~</font></span>P] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1301069874214028">interface LoopBack 1</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen957064735214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword755324849214028">*</span>P-LoopBack1] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b2076683328214028">ip address 2.2.2.9 32</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1372047515214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword752537770214028">*</span>P-LoopBack1] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1632067739214028">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1047710751214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1718750561214028">*</span>P] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b351685080214028">interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen396395494214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1096672064214028">*</span>P-GigabitEthernet<span>0/1/1</span>] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1783187570214028">ip address 192.168.1.2 24</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1722684374214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword482657602214028">*</span>P-GigabitEthernet<span>0/1/1</span>] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1784893232214028">undo shutdown</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1737286939214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword700233804214028">*</span>P-GigabitEthernet<span>0/1/1</span>] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1249532110214028">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen2068592607214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword202048031214028">*</span>P] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b207064422214028">interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen645186393214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword161678880214028">*</span>P-GigabitEthernet<span>0/1/2</span>] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1377042807214028">ip address 192.168.2.1 24</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen24131188214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword203553351214028">*</span>P-GigabitEthernet<span>0/1/2</span>] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b621933121214028">undo shutdown</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen234754700214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword2135055189214028">*</span>P-GigabitEthernet<span>0/1/2</span>] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b211945794214028">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen2037977346214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword813295450214028">*</span>P] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1288277702214028">ospf</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen934673045214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword2096670077214028">*</span>P-ospf-1] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b847272605214028">area 0</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen893350137214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword125358366214028">*</span>P-ospf-1-area-0.0.0.0] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b405619920214028">network 2.2.2.9 0.0.0.0</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen222496571214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1758314397214028">*</span>P-ospf-1-area-0.0.0.0] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1377965311214028">network 192.168.1.0 0.0.0.255</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen315573116214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1451885401214028">*</span>P-ospf-1-area-0.0.0.0] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b611805131214028">network 192.168.2.0 0.0.0.255</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1516939648214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword95763110214028">*</span>P-ospf-1-area-0.0.0.0] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1449789241214028">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen74946719214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1386946756214028">*</span>P-ospf-1] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1195245768214028">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1310394584214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword373972381214028">*</span>P] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1768181016214028">commit</strong></pre>
<p id="EN-US_TASK_0172363307__en-us_task_0172363305_p1892741491214028"># Configure PE2.</p>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen543181496214028">&lt;<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1168523380214028">HUAWEI</span>&gt; <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b80163945214028">system-view</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen30344869214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword2039581469214028"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1111776069214028">HUAWEI</span>] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b57475626214028">sysname PE2</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1537993122214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword960532567214028">*</span><span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1036279070214028">HUAWEI</span>] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1646813598214028">commit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen354354856214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword2096008853214028"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b970909301214028">interface loopback 1</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen2021142082214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword2124621392214028">*</span>PE2-LoopBack1] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1171097902214028">ip address 3.3.3.9 32</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1563759929214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword531662587214028">*</span>PE2-LoopBack1] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1572932323214028">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1430894841214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword967672335214028">*</span>PE2] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1273958149214028">interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1370380498214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1334555109214028">*</span>PE2-GigabitEthernet<span>0/1/2</span>] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1722202950214028">ip address 192.168.2.2 24</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1667812948214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword464830430214028">*</span>PE2-GigabitEthernet<span>0/1/2</span>] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b89192854214028">undo shutdown</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1574827836214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword544878774214028">*</span>PE2-GigabitEthernet<span>0/1/2</span>] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1239929805214028">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen5341717214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1372385394214028">*</span>PE2] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b443987373214028">ospf</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen16997178214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword426910485214028">*</span>PE2-ospf-1] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b2001511345214028">area 0</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen568554280214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword924557036214028">*</span>PE2-ospf-1-area-0.0.0.0] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1133101975214028">network 3.3.3.9 0.0.0.0</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1142790406214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword679616160214028">*</span>PE2-ospf-1-area-0.0.0.0] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1015227558214028">network 192.168.2.0 0.0.0.255</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen947701753214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword878366473214028">*</span>PE2-ospf-1-area-0.0.0.0] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b80603976214028">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1543149228214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword485233680214028">*</span>PE2-ospf-1] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b2146987412214028">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen742386763214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1614445923214028">*</span>PE2] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1692587512214028">commit</strong></pre>
<p id="EN-US_TASK_0172363307__en-us_task_0172363305_p1218106089214028">After the configurations are complete, PE1 and PE2 have OSPF routes to the loopback interface of each other. PE1 and PE2 can ping each other.</p>
<p id="EN-US_TASK_0172363307__en-us_task_0172363305_p1440495101214028">The following example uses the command output on PE1.</p>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen894656416214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword233501062214028"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b482239627214028">display ip routing-table</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1912474872214028"><span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1577429055214028">Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route</span>
------------------------------------------------------------------------------
Routing Table : _public_
         Destinations : 11       Routes : 11

Destination/Mask    Proto  Pre  Cost        Flags NextHop         Interface

        1.1.1.9/32  Direct 0    0             D  127.0.0.1       LoopBack1
        2.2.2.9/32  OSPF   10   1             D  192.168.1.2     GigabitEthernet<span>0/1/2</span>
        3.3.3.9/32  OSPF   10   2             D  192.168.1.2     GigabitEthernet<span>0/1/2</span>
    192.168.1.0/24  Direct 0    0             D  192.168.1.1     GigabitEthernet<span>0/1/2</span>
    192.168.1.1/32  Direct 0    0             D  127.0.0.1       GigabitEthernet<span>0/1/2</span>
  192.168.1.255/32  Direct 0    0             D  127.0.0.1       GigabitEthernet<span>0/1/2</span>
    192.168.2.0/24  OSPF   10   2             D  192.168.1.2     GigabitEthernet<span>0/1/2</span>
       127.0.0.0/8  Direct 0    0             D  127.0.0.1       InLoopBack0
      127.0.0.1/32  Direct 0    0             D  127.0.0.1       InLoopBack0
127.255.255.255/32  Direct 0    0             D  127.0.0.1       InLoopBack0
255.255.255.255/32  Direct 0    0             D  127.0.0.1       InLoopBack0</pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1479178899214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1379766611214028">*</span>PE1] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b353760283214028">ping 192.168.2.2</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen340849752214028">  PING 192.168.2.2: 56  data bytes, press CTRL_C to break
    Reply from 192.168.2.2: bytes=56 Sequence=1 ttl=254 time=5 ms
    Reply from 192.168.2.2: bytes=56 Sequence=2 ttl=254 time=2 ms
    Reply from 192.168.2.2: bytes=56 Sequence=3 ttl=254 time=2 ms
    Reply from 192.168.2.2: bytes=56 Sequence=4 ttl=254 time=2 ms
    Reply from 192.168.2.2: bytes=56 Sequence=5 ttl=254 time=2 ms

  --- 192.168.2.2 ping statistics ---
    5 packet(s) transmitted
    5 packet(s) received
    0.00% packet loss
    round-trip min/avg/max = 2/2/5 ms</pre>
</li><li><p id="EN-US_TASK_0172363307__en-us_task_0172363305_p996218979214028">Enable basic MPLS functions and MPLS LDP.</p>
<p id="EN-US_TASK_0172363307__en-us_task_0172363305_p8382444214028"># Configure PE1.</p>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen307077180214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword99731129214028">*</span>PE1] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b252717557214028">mpls lsr-id 1.1.1.9</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1015168217214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1841299326214028">*</span>PE1] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1399177494214028">mpls</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1676021342214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword445433578214028">*</span>PE1-mpls] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1320308413214028">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen671805981214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1722475085214028">*</span>PE1] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1745071551214028">mpls ldp</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen2083283602214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword176111399214028">*</span>PE1-mpls-ldp] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1913963310214028">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen825864690214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1348923952214028">*</span>PE1] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b41701017214028">interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen829241271214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1340819865214028">*</span>PE1-GigabitEthernet<span>0/1/2</span>] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b2078402241214028">mpls</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1402177858214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword52919664214028">*</span>PE1-GigabitEthernet<span>0/1/2</span>] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1878929242214028">mpls ldp</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1224486446214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1542165068214028">*</span>PE1-GigabitEthernet<span>0/1/2</span>] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1902531227214028">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1015510920214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword541234260214028">*</span>PE1] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b918485961214028">commit</strong></pre>
<p id="EN-US_TASK_0172363307__en-us_task_0172363305_p1611665972214028"># Configure the P.</p>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen391885909214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1448121506214028"><font style="font-size:8pt" Face="Courier New" >~</font></span>P] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1850681741214028">mpls lsr-id 2.2.2.9</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1649447955214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1412977250214028">*</span>P] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b347062656214028">mpls</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen251969806214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword2061804844214028">*</span>P-mpls] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1637726700214028">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1505400591214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword20519751214028">*</span>P] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1416885065214028">mpls ldp</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1080584416214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword2110149683214028">*</span>P-mpls-ldp] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b2046172680214028">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1044052204214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1331778697214028">*</span>P] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b213820625214028">interface gigabitethernet<span>0/1/1</span></strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen526280331214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1466717169214028">*</span>P-GigabitEthernet<span>0/1/1</span>] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b120770321214028">mpls</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1927753509214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1415379237214028">*</span>P-GigabitEthernet<span>0/1/1</span>] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1657344115214028">mpls ldp</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen170066422214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword2120215558214028">*</span>P-GigabitEthernet<span>0/1/1</span>] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b822163349214028">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen901595345214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1033959426214028">*</span>P] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1988178529214028">interface gigabitethernet<span>0/1/2</span></strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen2118046398214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword810718816214028">*</span>P-GigabitEthernet<span>0/1/2</span>] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1956835651214028">mpls</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen627565148214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1038649295214028">*</span>P-GigabitEthernet<span>0/1/2</span>] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b373549618214028">mpls ldp</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1102614052214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1236207737214028">*</span>P-GigabitEthernet<span>0/1/2</span>] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1416992819214028">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen485352584214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword792271781214028">*</span>P] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1462408450214028">commit</strong></pre>
<p id="EN-US_TASK_0172363307__en-us_task_0172363305_p1878782166214028"># Configure PE2.</p>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1113399384214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword625613092214028"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b762543894214028">mpls lsr-id 3.3.3.9</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen384049567214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1246658773214028">*</span>PE2] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1223407638214028">mpls</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1503185764214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1213017926214028">*</span>PE2-mpls] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b2070283556214028">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1686652651214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword168250426214028">*</span>PE2] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1911658738214028">mpls ldp</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen174110548214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword808129400214028">*</span>PE2-mpls-ldp] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1738310809214028">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1978300415214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1872193115214028">*</span>PE2] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b695708408214028">interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1676397959214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1233897478214028">*</span>PE2-GigabitEthernet<span>0/1/2</span>] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b138966597214028">mpls</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1707599027214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword100937770214028">*</span>PE2-GigabitEthernet<span>0/1/2</span>] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1130776373214028">mpls ldp</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen2123801043214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1400952830214028">*</span>PE2-GigabitEthernet<span>0/1/2</span>] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b640013740214028">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1590932083214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword609499178214028">*</span>PE2] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1608890391214028">commit</strong></pre>
<p id="EN-US_TASK_0172363307__en-us_task_0172363305_p852409058214028">After the configurations are complete, LDP sessions are set up between PE1 and the P and between PE2 and the P. Run the <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b177210148214028">display mpls ldp session</strong> command. The command output shows that the LDP session status is <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b14835144712304">Operational</strong>.</p>
<p id="EN-US_TASK_0172363307__en-us_task_0172363305_p2095449094214028">The following example uses the command output on PE1.</p>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen2128932920214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword863228911214028"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1318928852214028">display mpls ldp session</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1954823147214028"> LDP Session(s) in Public Network
 Codes: LAM(Label Advertisement Mode), SsnAge Unit(DDDD:HH:MM)
 <span> An asterisk (*) before a session means the session is being deleted.</span>
-------------------------------------------------------------------------
 PeerID             Status      LAM  SsnRole  SsnAge       KASent/Rcv
--------------------------------------------------------------------------
 2.2.2.9:0         <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1541483080214028">Operational</strong>  DU   Passive  0000:00:00   5/5
 3.3.3.9:0         <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b690613947214028">Operational</strong>  DU   Passive  0000:00:00   1/1
--------------------------------------------------------------------------
TOTAL: 2 Session(s) Found.</pre>
</li><li><p>Configure VPN instances and bind the VPN instances to the QinQ VLAN tag termination sub-interface.</p>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>ip vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpn1] <strong>route-distinguisher 100:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpn1-af-ipv4] <strong>vpn-target 100:1 both</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpn1-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpn1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet <span>0/1/1</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>.1] <strong>control-vid 1 qinq-termination</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>.1] <strong>qinq termination pe-vid 100 ce-vid 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>.1] <strong>ip binding vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>.1] <strong>ip address 10.1.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>.1] <strong>arp broadcast enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>ip vpn-instance vpn2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpn2] <strong>route-distinguisher 200:2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpn2-af-ipv4] <strong>vpn-target 200:2 both</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpn2-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpn2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet <span>0/1/1</span>.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>.2] <strong>control-vid 2 qinq-termination</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>.2] <strong>qinq termination pe-vid 100 ce-vid 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>.2] <strong>ip binding vpn-instance vpn2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>.2] <strong>ip address 10.3.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>.2] <strong>arp broadcast enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>.2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>ip vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-vpn1] <strong>route-distinguisher 100:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-vpn1-af-ipv4] <strong>vpn-target 100:1 both</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-vpn1-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-vpn1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface gigabitethernet <span>0/1/1</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>.1] <strong>control-vid 1 qinq-termination</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>.1] <strong>qinq termination pe-vid 100 ce-vid 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>.1] <strong>ip binding vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>.1] <strong>ip address 10.2.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>.1] <strong>arp broadcast enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>ip vpn-instance vpn2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-vpn2] <strong>route-distinguisher 200:2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-vpn2-af-ipv4] <strong>vpn-target 200:2 both</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-vpn2-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-vpn2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface gigabitethernet <span>0/1/1</span>.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>.2] <strong>control-vid 2 qinq-termination</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>.2] <strong>qinq termination pe-vid 100 ce-vid 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>.2] <strong>ip binding vpn-instance vpn2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>.2] <strong>ip address 10.4.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>.2] <strong>arp broadcast enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>.2] <strong>quit</strong></pre>
<div class="note" id="EN-US_TASK_0172363307__note_1"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0172363307__p577660652214028">When you run the <strong id="EN-US_TASK_0172363307__b990890360214028">qinq termination</strong> command on an interface, if the <em id="EN-US_TASK_0172363307__i1562836517214028">pe-vid</em> values of the two different sub-interfaces are the same, make sure that the <em id="EN-US_TASK_0172363307__i2074358658214028">ce-vid</em> values are different.</p>
</div></div>
<p>After the configurations are complete, run the <a href="cmdqueryname=display+ip+vpn-instance+verbose"><b><span class="cmdname">display ip vpn-instance verbose</span></b></a> command on the PEs to view the configurations of VPN instances.</p>
<p>Use the command output on PE1 as an example.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display ip vpn-instance verbose</strong></pre>
<pre class="screen"> Total VPN-Instances configured : 2
 Total IPv4 VPN-Instances configured : 2
 Total IPv6 VPN-Instances configured : 0

 VPN-Instance Name and ID : vpn1, 1
  Interfaces : GigabitEthernet<span>0/1/1</span>.1
 Address family ipv4
  Create date : 2012-07-18 14:34:48
  Up time : 0 days, 00 hours, 07 minutes and 54 seconds
  Vrf Status : UP
  Route Distinguisher : 100:1
  Export VPN Targets : 100:1
  Import VPN Targets : 100:1
  Label Policy : label per route
  The diffserv-mode Information is : uniform
  The ttl-mode Information is : pipe

 VPN-Instance Name and ID : vpn2, 2
  Interfaces : GigabitEthernet<span>0/1/1</span>.2
 Address family ipv4
  Create date : 2012-07-18 14:38:44
  Up time : 0 days, 00 hours, 03 minutes and 58 seconds
  Route Distinguisher : 200:2
  Export VPN Targets : 200:2
  Import VPN Targets : 200:2
  Label Policy : label per route
  The diffserv-mode Information is : uniform
  The ttl-mode Information is : pipe</pre>
</li><li><p id="EN-US_TASK_0172363307__en-us_task_0172363305_p1875415123214028">Set up an MP-IBGP peer relationship between the PEs.</p>
<p id="EN-US_TASK_0172363307__en-us_task_0172363305_p278451448214028"># Configure PE1.</p>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1235193663214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword771967713214028">*</span>PE1] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1043588062214028">bgp 100</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen876373983214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword665798902214028">*</span>PE1-bgp] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1969733640214028">peer 3.3.3.9 as-number 100</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen508497678214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1804006449214028">*</span>PE1-bgp] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b209310155214028">peer 3.3.3.9 connect-interface loopback 1</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1770822077214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword437372880214028">*</span>PE1-bgp] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b491787653214028">ipv4-family vpnv4</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen239957577214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1990230937214028">*</span>PE1-bgp-af-vpnv4] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b745351288214028">peer 3.3.3.9 enable</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1746290939214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1225167002214028">*</span>PE1-bgp-af-vpnv4] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1179127719214028">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen205206787214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1876784401214028">*</span>PE1-bgp] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1995306853214028">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen237343647214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword764960377214028">*</span>PE1] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b16627061214028">commit</strong></pre>
<p id="EN-US_TASK_0172363307__en-us_task_0172363305_p1776530547214028"># Configure PE2.</p>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1548656197214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1605431983214028"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b124805883214028">bgp 100</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1711705084214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1509192616214028">*</span>PE2-bgp] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1268387258214028">peer 1.1.1.9 as-number 100</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen915462704214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword454669763214028">*</span>PE2-bgp] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b2062867649214028">peer 1.1.1.9 connect-interface loopback 1</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1678373192214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword761209249214028">*</span>PE2-bgp] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1991964341214028">ipv4-family vpnv4</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1020483708214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1688902949214028">*</span>PE2-bgp-af-vpnv4] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b644096275214028">peer 1.1.1.9 enable</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen783300122214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1074068823214028">*</span>PE2-bgp-af-vpnv4] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b624818788214028">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen781284405214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1169196811214028">*</span>PE2-bgp] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b908350325214028">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1309162301214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword846018438214028">*</span>PE2] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b134983144214028">commit</strong></pre>
<p id="EN-US_TASK_0172363307__en-us_task_0172363305_p425997408214028">After the configurations are complete, run the <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1724519460214028">display bgp peer</strong> command on the PEs. The command outputs show that a BGP peer relationship is established between the PEs and is in the <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b440029526214028">Established</strong> state.</p>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1650465201214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword2033251022214028"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b373044204214028">display bgp peer</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1017452173214028"> BGP local router ID : 1.1.1.9
 Local AS number : 100
 Total number of peers : 1                 Peers in established state : 1

  Peer            V          AS  MsgRcvd  MsgSent  OutQ  Up/Down       State   PrefRcv
  3.3.3.9         4         100        4        4     0 00:00:33 <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b799401103214028">Established</strong>    0</pre>
</li><li><p id="EN-US_TASK_0172363307__en-us_task_0172363305_p492956891214028">Set up EBGP peer relationships between the PEs and CEs and import VPN routes.</p>
<p id="EN-US_TASK_0172363307__en-us_task_0172363305_p197722886214028"># Configure CE1.</p>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen192679557214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1606715319214028"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b508957418214028">bgp 65410</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen48913031214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1952316302214028">*</span>CE1-bgp] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b259686102214028">peer 10.1.1.1 as-number 100</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1006312253214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword2020752708214028">*</span>CE1-bgp] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1276965665214028">import-route direct</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen233790952214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1533228480214028">*</span>CE1-bgp] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b2098754666214028">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1333135572214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword935990940214028">*</span>CE1] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b2082292541214028">commit</strong></pre>
<p id="EN-US_TASK_0172363307__en-us_task_0172363305_p236552424214028"># Configure CE2.</p>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1359066022214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1018791392214028"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b607689406214028">bgp 65420</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen737176454214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword494742726214028">*</span>CE2-bgp] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1885405913214028">peer 10.2.1.1 as-number 100</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1176964756214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1560579264214028">*</span>CE2-bgp] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1307066568214028">import-route direct</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen667007117214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1816621053214028">*</span>CE2-bgp] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b442230392214028">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1317192079214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1355832467214028">*</span>CE2] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1722007942214028">commit</strong></pre>
<p id="EN-US_TASK_0172363307__en-us_task_0172363305_p1837485153214028"># Configure CE3.</p>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1656842493214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1784192545214028"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE3] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b2127783925214028">bgp 65411</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen302977148214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1945286731214028">*</span>CE3-bgp] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1932714708214028">peer 10.3.1.1 as-number 100</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1722465293214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1706370679214028">*</span>CE3-bgp] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1864043143214028">import-route direct</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen72275143214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword961967543214028">*</span>CE3-bgp] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1872039153214028">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1080240914214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1050790086214028">*</span>CE3] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1535896273214028">commit</strong></pre>
<p id="EN-US_TASK_0172363307__en-us_task_0172363305_p1219239471214028"># Configure CE4.</p>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen498611518214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword473362350214028"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE4] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1093608858214028">bgp 65421</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen590759812214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword2135356202214028">*</span>CE4-bgp] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1522291241214028">peer 10.4.1.1 as-number 100</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1612450175214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1096422112214028">*</span>CE4-bgp] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1038821355214028">import-route direct</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen671275234214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1107342093214028">*</span>CE4-bgp] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1355157294214028">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen83404935214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1439081515214028">*</span>CE4] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b946646682214028">commit</strong></pre>
<p id="EN-US_TASK_0172363307__en-us_task_0172363305_p1510426748214028"># Configure PE1.</p>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1254550381214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword495867915214028">*</span>PE1] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1611178739214028">bgp 100</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1355826122214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword417914635214028">*</span>PE1-bgp] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1547387913214028">ipv4-family vpn-instance vpn1</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1021107336214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword932439264214028">*</span>PE1-bgp-vpn1] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b782547030214028">peer 10.1.1.2 as-number 65410</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen953920735214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1172103934214028">*</span>PE1-bgp-vpn1] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b2044970740214028">import-route direct</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen2055343491214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1461563867214028">*</span>PE1-bgp-vpn1] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b633835817214028">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen889265866214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword182229579214028">*</span>PE1-bgp] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1623326646214028">ipv4-family vpn-instance vpn2</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen963585842214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword736051008214028">*</span>PE1-bgp-vpn2] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1187274905214028">peer 10.3.1.2 as-number 65411</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1979094787214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1734416713214028">*</span>PE1-bgp-vpn2] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b314736851214028">import-route direct</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen488950416214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword498905552214028">*</span>PE1-bgp-vpn2] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1723195444214028">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen519994457214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1547233553214028">*</span>PE1-bgp] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b649640384214028">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen429147043214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1770386063214028">*</span>PE1] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1903761785214028">commit</strong></pre>
<p id="EN-US_TASK_0172363307__en-us_task_0172363305_p752448207214028"># Configure PE2.</p>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1806186859214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword872120763214028"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b340914095214028">bgp 100</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen6720013214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1387947292214028">*</span>PE2-bgp] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1823164856214028">ipv4-family vpn-instance vpn1</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1242521560214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1551764001214028">*</span>PE2-bgp-vpn1] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b884183461214028">peer 10.2.1.2 as-number 65420</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1659380997214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword69110271214028">*</span>PE2-bgp-vpn1] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b397960515214028">import-route direct</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1957249520214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1514134496214028">*</span>PE2-bgp-vpn1] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1192084910214028">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen730671426214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword505631833214028">*</span>PE2-bgp] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1991994693214028">ipv4-family vpn-instance vpn2</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1954522532214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1578960678214028">*</span>PE2-bgp-vpn2] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b320306057214028">peer 10.4.1.2 as-number 65421</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen572602743214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword641947001214028">*</span>PE2-bgp-vpn2] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1324307913214028">import-route direct</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1495749486214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword10131401214028">*</span>PE2-bgp-vpn2] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b168215535214028">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen870201962214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword685742211214028">*</span>PE2-bgp] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1441701128214028">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1160989353214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword1184091660214028">*</span>PE2] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1965312681214028">commit</strong></pre>
<p id="EN-US_TASK_0172363307__en-us_task_0172363305_p147008268214028">After the configurations are complete, run the <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b883641858214028">display bgp vpnv4 vpn-instance peer</strong> command on the PEs. The command outputs show that BGP peer relationships have been established between the PEs and CEs and are in the <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1759020604214028">Established</strong> state.</p>
<p id="EN-US_TASK_0172363307__en-us_task_0172363305_p500625582214028">Use the BGP peer relationship between PE1 and CE1 as an example.</p>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1598082811214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword490815073214028"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b192729514214028">display bgp vpnv4 vpn-instance vpn1 peer</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen2107685175214028">BGP local router ID : 1.1.1.9
Local AS number : 100

 VPN-Instance vpn1, router ID 1.1.1.9:
 Total number of peers : 1                 Peers in established state : 1

  Peer            V          AS    MsgRcvd  MsgSent  OutQ  Up/Down     State         PrefRcv
  10.1.1.2        4         65410     6        7       0 00:02:58      <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1217297449214028">Established</strong>    1</pre>
<p id="EN-US_TASK_0172363307__en-us_task_0172363305_p341099920214028">After the configurations are complete, the PEs can ping the CEs connected to them.</p>
<div class="note" id="EN-US_TASK_0172363307__en-us_task_0172363305_note27081817214028"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0172363307__en-us_task_0172363305_p2045048802214028">If multiple interfaces on a PE are bound to the same VPN instance, to ping the CE connected to the PE, specify the source IP address (namely, <strong><span id="EN-US_TASK_0172363307__en-us_task_0172363305_cmdparmname195418291277">-a</span></strong> <i><span class="varname" id="EN-US_TASK_0172363307__en-us_task_0172363305_varname5542132918272">source-ip-address</span></i>) in the <a href="cmdqueryname=ping+-vpn-instance"><b><span class="cmdname" id="EN-US_TASK_0172363307__en-us_task_0172363305_cmdname8542729112718">ping -vpn-instance</span></b></a> <i><span class="varname" id="EN-US_TASK_0172363307__en-us_task_0172363305_varname105421529132718">vpn-instance-name</span></i> <strong><span id="EN-US_TASK_0172363307__en-us_task_0172363305_cmdparmname13542202902712">-a</span></strong> <i><span class="varname" id="EN-US_TASK_0172363307__en-us_task_0172363305_varname154218296279">source-ip-address</span></i> <i><span class="varname" id="EN-US_TASK_0172363307__en-us_task_0172363305_varname15542329142711">dest-ip-address</span></i> command. If you do not specify the source IP address, the ping operation may fail.</p>
</div></div>
<p id="EN-US_TASK_0172363307__en-us_task_0172363305_p1560409625214028">The following example uses the command output on PE1.</p>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen1438400615214028">[<span class="keyword" id="EN-US_TASK_0172363307__en-us_task_0172363305_keyword774962490214028">*</span>PE1] <strong id="EN-US_TASK_0172363307__en-us_task_0172363305_b1779234413214028">ping -vpn-instance vpn1 10.1.1.2</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363307__en-us_task_0172363305_screen588893164214028">  PING 10.1.1.2: 56  data bytes, press CTRL_C to break
    Reply from 10.1.1.2: bytes=56 Sequence=1 ttl=255 time=50 ms
    Reply from 10.1.1.2: bytes=56 Sequence=2 ttl=255 time=60 ms
    Reply from 10.1.1.2: bytes=56 Sequence=3 ttl=255 time=60 ms
    Reply from 10.1.1.2: bytes=56 Sequence=4 ttl=255 time=40 ms
    Reply from 10.1.1.2: bytes=56 Sequence=5 ttl=255 time=60 ms

  --- 10.1.1.2 ping statistics ---
    5 packet(s) transmitted
    5 packet(s) received
    0.00% packet loss
    round-trip min/avg/max = 40/54/60 ms</pre>
</li></ol>
</p></li><li><span>Verify the configuration.</span><p><p>Run the <a href="cmdqueryname=display+qinq+information+termination"><b><span class="cmdname">display qinq information termination</span></b></a> command to view information about QinQ VLAN tag termination sub-interfaces. The command output shows that the sub-interfaces are bound to the L3VPN.</p>
<p>Use the command output on PE1 as an example.</p>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>display qinq information termination interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">  GigabitEthernet<span>0/1/1</span>.1
    <strong>L3VPN bound</strong>
    Total QinQ Num: 1
      qinq termination pe-vid 100 ce-vid 10
    Total vlan-group Num: 0
    encapsulation qinq-termination
  GigabitEthernet<span>0/1/1</span>.2
    <strong>L3VPN bound</strong>
    Total QinQ Num: 1
      qinq termination pe-vid 100 ce-vid 20
    Total vlan-group Num: 0
    encapsulation qinq-termination</pre>
<p>Verify that the following conditions are true:</p>
<p>a. Hosts attached to CE1 and CE2 can ping each other.</p>
<p>b. Hosts attached to CE3 and CE4 can ping each other.</p>
<p>c. CE1 and CE2 cannot communicate with CE3 and CE4.</p>
<p>On the PEs, you can view the corresponding ARP entries. Use PE1 as an example.</p>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>display arp dynamic</strong></pre>
<pre class="screen">IP ADDRESS      MAC ADDRESS     EXPIRE(M) TYPE        INTERFACE   VPN-INSTANCE  VLAN/CEVLAN PVC
------------------------------------------------------------------------------------------------------
192.168.1.1     00e0-fc12-3458            I -         GE<span>0/1/2</span>
192.168.1.2     00e0-fc12-3457  20        D-9         GE<span>0/1/2</span>
10.1.1.1        00e0-fc12-3459            I -         GE<span>0/1/1</span>.1       vpn1
10.1.1.2        00e0-fc12-3456  20        D-9         GE<span>0/1/1</span>.1       vpn1            100/10
10.3.1.1        00e0-fc12-3459            I -         GE<span>0/1/1</span>.2       vpn2
10.3.1.2        00e0-fc12-3456  20        D-9         GE<span>0/1/1</span>.2       vpn2            100/20
-----------------------------------------------------------------------------------------------------
Total:6         Dynamic:3       Static:0    Interface:3 </pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172363307__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>CE1 configuration file</p>
<pre class="screen">#
 sysname CE1
#
vlan batch 10
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
#
interface GigabitEthernet<span>0/1/1</span>.1
 vlan-type dot1q 10
 ip address 10.1.1.2 255.255.255.0
#
bgp 65410
 peer 10.1.1.1 as-number 100
 #
 ipv4-family unicast
 undo synchronization 
 import-route direct
  peer 10.1.1.1 enable
#
return</pre>
</li><li><p>CE2 configuration file</p>
<pre class="screen">#
 sysname CE2
#
vlan batch 10
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
#
interface GigabitEthernet<span>0/1/1</span>.1
 vlan-type dot1q 10
 ip address 10.2.1.2 255.255.255.0
#
bgp 65420
 peer 10.2.1.1 as-number 100
 #
 ipv4-family unicast
 undo synchronization 
 import-route direct
  peer 10.2.1.1 enable
#
return</pre>
</li><li><p>CE3 configuration file</p>
<pre class="screen">#
 sysname CE3
#
vlan batch 20
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
#
interface GigabitEthernet<span>0/1/1</span>.1
 vlan-type dot1q 20
 ip address 10.3.1.2 255.255.255.0
#
bgp 65411
 peer 10.3.1.1 as-number 100
 #
 ipv4-family unicast
  undo synchronization
  import-route direct
  peer 10.3.1.1 enable
#
return</pre>
</li><li><p>CE4 configuration file</p>
<pre class="screen">#
 sysname CE4
#
vlan batch 20
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
#
interface GigabitEthernet<span>0/1/1</span>.1
 vlan-type dot1q 20
 ip address 10.4.1.2 255.255.255.0
#
bgp 65421
 peer 10.4.1.1 as-number 100
 #
 ipv4-family unicast
  undo synchronization
  import-route direct
  peer 10.4.1.1 enable
#
return</pre>
</li><li><p>PE1 configuration file</p>
<pre class="screen">#
 sysname PE1
#
ip vpn-instance vpn1
 route-distinguisher 100:1
 apply-label per-instance
 vpn-target 100:1 export-extcommunity
 vpn-target 100:1 import-extcommunity
#
ip vpn-instance vpn2
 route-distinguisher 200:2
 apply-label per-instance
 vpn-target 200:2 export-extcommunity
 vpn-target 200:2 import-extcommunity
#
 mpls lsr-id 1.1.1.9
#
 mpls
#
mpls ldp
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
#
interface GigabitEthernet<span>0/1/1</span>.1
 ip binding vpn-instance vpn1
 ip address 10.1.1.1 255.255.255.0
 encapsulation qinq-termination
 qinq termination pe-vid 100 ce-vid 10
 arp broadcast enable
#
interface GigabitEthernet<span>0/1/1</span>.2
 ip binding vpn-instance vpn2
 ip address 10.3.1.1 255.255.255.0
 encapsulation qinq-termination
 qinq termination pe-vid 100 ce-vid 20
 arp broadcast enable
#
interface GigabitEthernet<span>0/1/2</span>
 ip address 192.168.1.1 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 1.1.1.9 255.255.255.255
#
bgp 100
 peer 3.3.3.9 as-number 100
 peer 3.3.3.9 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 3.3.3.9 enable
 #
 ipv4-family vpnv4
  policy vpn-target
  peer 3.3.3.9 enable
 #
 ipv4-family vpn-instance vpn1
  import-route direct
  peer 10.1.1.2 as-number 65410
 #
 ipv4-family vpn-instance vpn2
  import-route direct
  peer 10.3.1.2 as-number 65411
#
ospf 1
 area 0.0.0.0
  network 1.1.1.9 0.0.0.0
  network 192.168.1.0 0.0.0.255
#
return</pre>
</li><li><p>P configuration file</p>
<pre class="screen">#
 sysname P
#
 mpls lsr-id 2.2.2.9
#
 mpls
#
mpls ldp
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 192.168.1.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ip address 192.168.2.1 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 2.2.2.9 255.255.255.255
#
ospf 1
 area 0.0.0.0
  network 2.2.2.9 0.0.0.0
  network 192.168.1.0 0.0.0.255
  network 192.168.2.0 0.0.0.255
#
return</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#
 sysname PE2
#
ip vpn-instance vpn1
 route-distinguisher 100:1
 apply-label per-instance
 vpn-target 100:1 export-extcommunity
 vpn-target 100:1 import-extcommunity
#
ip vpn-instance vpn2
 route-distinguisher 200:2
 apply-label per-instance
 vpn-target 200:2 export-extcommunity
 vpn-target 200:2 import-extcommunity
#
 mpls lsr-id 3.3.3.9
#
 mpls
#
mpls ldp
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
#
interface GigabitEthernet<span>0/1/1</span>.1
 ip binding vpn-instance vpn1
 ip address 10.2.1.1 255.255.255.0
 encapsulation qinq-termination
 qinq termination pe-vid 100 ce-vid 10
 arp broadcast enable
#
interface GigabitEthernet<span>0/1/1</span>.2
 ip binding vpn-instance vpn2
 ip address 10.4.1.1 255.255.255.0
 encapsulation qinq-termination
 qinq termination pe-vid 100 ce-vid 20
 arp broadcast enable
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ip address 192.168.2.2 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 3.3.3.9 255.255.255.255
#
bgp 100
 peer 1.1.1.9 as-number 100
 peer 1.1.1.9 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 1.1.1.9 enable
 #
 ipv4-family vpnv4
  policy vpn-target
  peer 1.1.1.9 enable
 #
 ipv4-family vpn-instance vpn1
  import-route direct
  peer 10.2.1.2 as-number 65420
 #
 ipv4-family vpn-instance vpn2
  import-route direct
  peer 10.4.1.2 as-number 65421
#
ospf 1
 area 0.0.0.0
  network 3.3.3.9 0.0.0.0
  network 192.168.2.0 0.0.0.255
#
return</pre>
</li><li><p><span class="keyword">Device</span> A configuration file</p>
<pre class="screen">#
 sysname <span class="keyword">Device</span>A
#
 vlan batch 100
#
interface GigabitEthernet<span>0/1/3</span>
 portswitch
 undo shutdown
 port link-type trunk
 port trunk allow-pass vlan 100
#
interface GigabitEthernet<span>0/1/1</span>
 portswitch
 undo shutdown
 port vlan-stacking vlan 10 stack-vlan 100
#
interface GigabitEthernet<span>0/1/2</span>
 portswitch
 undo shutdown
 port vlan-stacking vlan 20 stack-vlan 100
#
return</pre>
</li><li><p><span class="keyword">Device</span> B configuration file</p>
<pre class="screen">#
 sysname <span class="keyword">Device</span>B
#
 vlan batch 100
#
interface GigabitEthernet<span>0/1/3</span>
 portswitch
 undo shutdown
 port link-type trunk
 port trunk allow-pass vlan 100
#
interface GigabitEthernet<span>0/1/1</span>
 portswitch
 undo shutdown
 port vlan-stacking vlan 10 stack-vlan 100
#
interface GigabitEthernet<span>0/1/2</span>
 portswitch
 undo shutdown
 port vlan-stacking vlan 20 stack-vlan 100
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_qinq_cfg_0023_1.html">Configuration Examples for QinQ
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_qinq_cfg_0030.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_qinq_cfg_0032.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>