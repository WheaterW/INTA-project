
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Users on the Same Subnet to Communicate Through a VXLAN Tunnel">
<meta name="abstract" content="This section provides an example for configuring users on the same subnet to communicate through a VXLAN tunnel.">
<meta name="description" content="This section provides an example for configuring users on the same subnet to communicate through a VXLAN tunnel.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vxlan_cfg_1015.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vxlan_cfg_1026.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="h00847023">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="featurename" content="VXLAN">
<meta name="featuretype" content="LAN Access and MAN Access">
<meta name="OWNER" content="p00915595">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="p00915595">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172363829">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring Users on the Same Subnet to Communicate Through a VXLAN Tunnel</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172363829"></a><a name="EN-US_TASK_0172363829"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Users on the Same Subnet to Communicate Through a VXLAN Tunnel</h1>
<div class="taskbody"><p>This section provides an example for configuring users on the same subnet to communicate through a VXLAN tunnel.</p>
<div class="context"><a name="EN-US_TASK_0172363829__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0172363829__fig_dc_vrp_vxlan_cfg_101601">Figure 1</a>, an enterprise has VMs deployed in different DCs. VM1 on Server1 belongs to VLAN10, and VM1 on Server2 belongs to VLAN20. VM1 on Server1 and VM1 on Server2 reside on the same subnet. To allow VM1s in different DCs to communicate with each other, configure a VXLAN tunnel between the two DCs.</p>
<div class="fignone" id="EN-US_TASK_0172363829__fig_dc_vrp_vxlan_cfg_101601"><a name="EN-US_TASK_0172363829__fig_dc_vrp_vxlan_cfg_101601"></a><a name="fig_dc_vrp_vxlan_cfg_101601"></a><span class="figcap"><b>Figure 1 </b>Network diagram of configuring users on the same subnet to communicate through a VXLAN tunnel</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interfaces 1 and 2 represent GE<span>0/1/1</span> and GE<span>0/1/2</span>, respectively.</p>
</div></div>
<p><span><img class="vsd" src="figure/en-us_image_0000002126361157.png"></span></p>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172363829__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><div class="p">The configuration roadmap is as follows:<ol><li id="EN-US_TASK_0172363829__li_1">Configure a routing protocol on Device1, Device2, and Device3 to allow them to communicate at Layer 3.</li><li>Configure a service access point on Device1 and Device3 to differentiate service traffic.</li><li>Configure a VXLAN tunnel on Device1 and Device3 to forward service traffic.</li></ol>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172363829__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li id="EN-US_TASK_0172363829__li_2">VMs' VLAN IDs (10 and 20)</li><li id="EN-US_TASK_0172363829__li_3">IP addresses of interfaces connecting devices</li><li id="EN-US_TASK_0172363829__li_4">Interior Gateway Protocol (IGP) running between devices (OSPF in this example)</li><li>BD ID (10)</li><li>VNI ID (5010)</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172363829__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure a routing protocol.</span><p><p>Assign an IP address to each interface on Device1, Device2, and Device3 according to <a href="#EN-US_TASK_0172363829__fig_dc_vrp_vxlan_cfg_101601">Figure 1</a>.</p>
<div class="p" id="EN-US_TASK_0172363829__p_step1_1"># Configure Device1.<pre class="screen" id="EN-US_TASK_0172363829__screen1009444964214030">&lt;<span class="keyword" id="EN-US_TASK_0172363829__keyword1754103457214030">HUAWEI</span>&gt; <strong id="EN-US_TASK_0172363829__b1696311532214030">system-view</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363829__screen1977887766214030">[<span class="keyword" id="EN-US_TASK_0172363829__keyword2008044027214030"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword" id="EN-US_TASK_0172363829__keyword1490449184214030">HUAWEI</span>] <strong id="EN-US_TASK_0172363829__b6758133214030">sysname Device1</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363829__screen1861433114214030">[<span class="keyword" id="EN-US_TASK_0172363829__keyword1271323668214030">*</span><span class="keyword" id="EN-US_TASK_0172363829__keyword1822084073214030">HUAWEI</span>] <strong id="EN-US_TASK_0172363829__b1660673701214030">commit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363829__screen981541334214030">[<span class="keyword" id="EN-US_TASK_0172363829__keyword97609094214030"><font style="font-size:8pt" Face="Courier New" >~</font></span>Device1]<strong id="EN-US_TASK_0172363829__b703125658214030"> interface loopback 1</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363829__screen1803947171214030">[<span class="keyword" id="EN-US_TASK_0172363829__keyword1718979239214030">*</span>Device1-LoopBack1]<strong id="EN-US_TASK_0172363829__b2066057789214030"> ip address 2.2.2.2 32</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363829__screen1591329324214030">[<span class="keyword" id="EN-US_TASK_0172363829__keyword1044364143214030">*</span>Device1-LoopBack1]<strong id="EN-US_TASK_0172363829__b829472804214030"> quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363829__screen2068177197214030">[<span class="keyword" id="EN-US_TASK_0172363829__keyword2107783962214030">*</span>Device1]<strong id="EN-US_TASK_0172363829__b526390258214030"> interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen" id="EN-US_TASK_0172363829__screen1066046674214030">[<span class="keyword" id="EN-US_TASK_0172363829__keyword1192581439214030">*</span>Device1-GigabitEthernet<span>0/1/1</span>]<strong id="EN-US_TASK_0172363829__b701812664214030"> ip address 192.168.1.1 24</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363829__screen1102567741214030">[<span class="keyword" id="EN-US_TASK_0172363829__keyword1995328822214030">*</span>Device1-GigabitEthernet<span>0/1/1</span>]<strong id="EN-US_TASK_0172363829__b946955807214030"> quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363829__screen691719559214030">[<span class="keyword" id="EN-US_TASK_0172363829__keyword1731357971214030">*</span>Device1]<strong id="EN-US_TASK_0172363829__b2124677720214030"> ospf</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363829__screen1730582951214030">[<span class="keyword" id="EN-US_TASK_0172363829__keyword1230107508214030">*</span>Device1-ospf-1]<strong id="EN-US_TASK_0172363829__b1676373352214030"> area 0</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363829__screen1770010674214030">[<span class="keyword" id="EN-US_TASK_0172363829__keyword102552843214030">*</span>Device1-ospf-1-area-0.0.0.0]<strong id="EN-US_TASK_0172363829__b292086529214030"> network 2.2.2.2 0.0.0.0</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363829__screen2085367216214030">[<span class="keyword" id="EN-US_TASK_0172363829__keyword126513407214030">*</span>Device1-ospf-1-area-0.0.0.0]<strong id="EN-US_TASK_0172363829__b1561727772214030"> network 192.168.1.0 0.0.0.255</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363829__screen1740825476214030">[<span class="keyword" id="EN-US_TASK_0172363829__keyword1409424720214030">*</span>Device1-ospf-1-area-0.0.0.0]<strong id="EN-US_TASK_0172363829__b479106610214030"> quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363829__screen1641043809214030">[<span class="keyword" id="EN-US_TASK_0172363829__keyword1893858457214030">*</span>Device1-ospf-1]<strong id="EN-US_TASK_0172363829__b1052287849214030"> quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363829__screen316517849214030">[<span class="keyword" id="EN-US_TASK_0172363829__keyword1643453522214030">*</span>Device1]<strong id="EN-US_TASK_0172363829__b429446051214030"> commit</strong></pre>
</div>
<p>The configurations of Device2 and Device3 are similar to that of Device1. For detailed configurations, see <a href="#EN-US_TASK_0172363829__section_dc_vrp_vxlan_cfg_101601">Configuration Files</a>.</p>
<div class="p" id="EN-US_TASK_0172363829__p_step1_2">After OSPF is configured, the devices can use OSPF to learn the IP addresses of each other's loopback interfaces and successfully ping each other. The following example shows the command output on Device1 after it pings Device3:<pre class="screen" id="EN-US_TASK_0172363829__screen2029428847214030">[<span class="keyword" id="EN-US_TASK_0172363829__keyword1564046996214030"><font style="font-size:8pt" Face="Courier New" >~</font></span>Device1] <strong id="EN-US_TASK_0172363829__b871456550214030">ping 4.4.4.4</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363829__screen107104801214030">  PING 4.4.4.4: 56  data bytes, press CTRL_C to break
    Reply from 4.4.4.4: bytes=56 Sequence=1 ttl=254 time=5 ms
    Reply from 4.4.4.4: bytes=56 Sequence=2 ttl=254 time=2 ms
    Reply from 4.4.4.4: bytes=56 Sequence=3 ttl=254 time=2 ms
    Reply from 4.4.4.4: bytes=56 Sequence=4 ttl=254 time=3 ms
    Reply from 4.4.4.4: bytes=56 Sequence=5 ttl=254 time=3 ms

  --- 4.4.4.4 ping statistics ---
    5 packet(s) transmitted
    5 packet(s) received
    0.00% packet loss
    round-trip min/avg/max = 2/3/5 ms</pre>
</div>
</p></li><li><span>Configure a service access point on Device1 and Device3.</span><p><div class="p" id="EN-US_TASK_0172363829__p_step2_1"># Configure Device1.<pre class="screen" id="EN-US_TASK_0172363829__screen1711166752214030">[<span class="keyword" id="EN-US_TASK_0172363829__keyword1507975665214030"><font style="font-size:8pt" Face="Courier New" >~</font></span>Device1] <strong id="EN-US_TASK_0172363829__b1176434984214030">bridge-domain 10</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363829__screen1480907231214030">[<span class="keyword" id="EN-US_TASK_0172363829__keyword1312028652214030">*</span>Device1-bd10] <strong id="EN-US_TASK_0172363829__b1856585486214030">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363829__screen702539258214030">[<span class="keyword" id="EN-US_TASK_0172363829__keyword174077622214030">*</span>Device1] <strong id="EN-US_TASK_0172363829__b779755983214030">interface gigabitethernet<span>0/1/2</span>.1 mode l2</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363829__screen1011569766214030">[<span class="keyword" id="EN-US_TASK_0172363829__keyword1228661831214030">*</span>Device1-GigabitEthernet<span>0/1/2</span>.1] <strong id="EN-US_TASK_0172363829__b1884324028214030">encapsulation dot1q vid 10</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363829__screen1692521314214030">[<span class="keyword" id="EN-US_TASK_0172363829__keyword61687216214030">*</span>Device1-GigabitEthernet<span>0/1/2</span>.1] <strong id="EN-US_TASK_0172363829__b1624335825214030">rewrite pop single</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363829__screen1336175398214030">[<span class="keyword" id="EN-US_TASK_0172363829__keyword911037370214030">*</span>Device1-GigabitEthernet<span>0/1/2</span>.1] <strong id="EN-US_TASK_0172363829__b2013678837214030">bridge-domain 10</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363829__screen536190993214030">[<span class="keyword" id="EN-US_TASK_0172363829__keyword518634338214030">*</span>Device1-GigabitEthernet<span>0/1/2</span>.1] <strong id="EN-US_TASK_0172363829__b1167652975214030">quit</strong></pre>
<pre class="screen" id="EN-US_TASK_0172363829__screen1396482392214030">[<span class="keyword" id="EN-US_TASK_0172363829__keyword52737973214030">*</span>Device1] <strong id="EN-US_TASK_0172363829__b686279985214030">commit</strong></pre>
</div>
<p>The configuration of Device 3 is similar to that of Device 1. For detailed configurations, see <a href="#EN-US_TASK_0172363829__section_dc_vrp_vxlan_cfg_101601">Configuration Files</a>.</p>
</p></li><li><span>Configure a VXLAN tunnel on Device1 and Device3.</span><p><div class="p"># Configure Device1.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Device1] <strong>bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Device1-bd10] <strong>vxlan vni 5010</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Device1-bd10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Device1] <strong>interface nve 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Device1-Nve1] <strong>source 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Device1-Nve1] <strong>vni 5010 head-end peer-list 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Device1-Nve1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Device1] <strong>commit</strong></pre>
</div>
<p>The configuration of Device 3 is similar to that of Device 1. For detailed configurations, see <a href="#EN-US_TASK_0172363829__section_dc_vrp_vxlan_cfg_101601">Configuration Files</a>.</p>
</p></li><li><span>Verify the configuration.</span><p><p>After the configuration is complete, run the <a href="cmdqueryname=display+vxlan+vni"><b><span class="cmdname">display vxlan vni</span></b></a> and <a href="cmdqueryname=display+vxlan+tunnel"><b><span class="cmdname">display vxlan tunnel</span></b></a> commands on Device1 and Device3 to check the VNI status and VXLAN tunnel information, respectively. The VNIs are Up on Device1 and Device3. The following example shows the command output on Device1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Device1] <strong>display vxlan vni</strong></pre>
<pre class="screen">Number of vxlan vni: 1
VNI            BD-ID            <strong>State</strong>
---------------------------------------
5010           10               up</pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Device1] <strong>display vxlan tunnel</strong></pre>
<pre class="screen">Number of vxlan tunnel : 1
Tunnel ID   Source           Destination      State  Type    Uptime
-------------------------------------------------------------------
4026531842  2.2.2.2          4.4.4.4          up     static 0028h16m</pre>
<p>By now, users on the same network can communicate through the VXLAN tunnel.</p>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0172363829__section_dc_vrp_vxlan_cfg_101601"><a name="EN-US_TASK_0172363829__section_dc_vrp_vxlan_cfg_101601"></a><a name="section_dc_vrp_vxlan_cfg_101601"></a><a name="EN-US_TASK_0172363829__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>Device1 configuration file</p>
<pre class="screen">#
sysname Device1
#
bridge-domain 10
 vxlan vni 5010
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 192.168.1.1 255.255.255.0
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
#
interface GigabitEthernet<span>0/1/2</span>.1 mode l2
 encapsulation dot1q vid 10
 rewrite pop single
 bridge-domain 10
#
interface LoopBack1
 ip address 2.2.2.2 255.255.255.255
#
interface Nve1
 source 2.2.2.2
 vni 5010 head-end peer-list 4.4.4.4
#
ospf 1
 area 0.0.0.0
  network 2.2.2.2 0.0.0.0
  network 192.168.1.0 0.0.0.255
#
return</pre>
</li><li><p>Device2 configuration file</p>
<pre class="screen">#
sysname Device2
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 192.168.1.2 255.255.255.0
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ip address 192.168.2.1 255.255.255.0
#
interface LoopBack1
 ip address 3.3.3.3 255.255.255.255
#
ospf 1
 area 0.0.0.0
  network 3.3.3.3 0.0.0.0
  network 192.168.1.0 0.0.0.255
  network 192.168.2.0 0.0.0.255
#
return</pre>
</li><li><p>Device3 configuration file</p>
<pre class="screen">#
sysname Device3
#
bridge-domain 10
 vxlan vni 5010
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 192.168.2.2 255.255.255.0
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
#
interface GigabitEthernet<span>0/1/2</span>.1 mode l2
 encapsulation dot1q vid 20
 rewrite pop single
 bridge-domain 10
#
interface LoopBack1
 ip address 4.4.4.4 255.255.255.255
#
interface Nve1
 source 4.4.4.4
 vni 5010 head-end peer-list 2.2.2.2
#
ospf 1
 area 0.0.0.0
  network 4.4.4.4 0.0.0.0
  network 192.168.2.0 0.0.0.255
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vxlan_cfg_1015.html">Configuration Examples for VXLAN
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vxlan_cfg_1026.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>