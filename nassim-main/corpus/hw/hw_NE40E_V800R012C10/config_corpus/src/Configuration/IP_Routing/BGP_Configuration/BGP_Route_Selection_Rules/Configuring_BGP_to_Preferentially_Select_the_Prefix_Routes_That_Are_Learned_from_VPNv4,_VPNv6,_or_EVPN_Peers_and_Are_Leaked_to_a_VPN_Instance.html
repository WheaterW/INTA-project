
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring BGP to Preferentially Select the Prefix Routes That Are Learned from VPNv4, VPNv6, or EVPN Peers and Are Leaked to a VPN Instance">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_path_selection_0001.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_5019.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Route">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Route">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Route">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing Basis">
<meta name="OWNER" content="w00604599">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00615954">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001245086319">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring BGP to Preferentially Select the Prefix Routes That Are Learned from VPNv4, VPNv6, or EVPN Peers and Are Leaked to a VPN Instance</title>
</head>
<body><a name="EN-US_TASK_0000001245086319"></a><a name="EN-US_TASK_0000001245086319"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring BGP to Preferentially Select the Prefix Routes That Are Learned from VPNv4, VPNv6, or EVPN Peers and Are Leaked to a VPN Instance</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001245086319__1.3.1"></a><a name="1.3.1"></a>
<div class="p"><h4 class="sectiontitle">Usage Scenario</h4><p>When VPNv4 and EVPN L3VPNv4 services, or VPNv6 and EVPN L3VPNv6 services coexist, a BGP IPv4/IPv6 VPN instance may have two routes with the same prefix but different VPN address family types, with one route learned from a VPNv4 or VPNv6 peer and leaked to a VPN instance, and the other learned from an EVPNv4 or EVPNv6 peer and leaked to a VPN instance. In this case, you can configure BGP to preferentially select either type of the preceding routes.</p>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001245086319__1.3.2"></a><a name="1.3.2"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li><span>Run <a href="cmdqueryname=ip+vpn-instance"><b><span class="cmdname">ip vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i></span><p><p>A VPN instance is created and its view is displayed.</p>
</p></li><li><span>Run <a href="cmdqueryname=ipv4-family"><b><span class="cmdname">ipv4-family</span></b></a></span><p><p>The VPN instance IPv4 address family is enabled, and the view of this address family is displayed.</p>
<p>Or run <a href="cmdqueryname=ipv6-family"><b><span class="cmdname">ipv6-family</span></b></a></p>
<p>The VPN instance IPv6 address family is enabled, and the view of this address family is displayed.</p>
</p></li><li><span>Run <a href="cmdqueryname=route-distinguisher"><b><span class="cmdname">route-distinguisher</span></b></a> <i><span class="varname">route-distinguisher</span></i></span><p><p>An RD is configured.</p>
</p></li><li><span>Run <a href="cmdqueryname=vpn-target+both+export-extcommunity+import-extcommunity"><b><span class="cmdname">vpn-target</span></b></a> <i><span class="varname">vpn-target</span></i> &amp;&lt;1-8&gt; [ <strong><span>both</span></strong> | <strong><span>export-extcommunity</span></strong> | <strong><span>import-extcommunity</span></strong> ]</span><p><p>VPN targets are configured.</p>
</p></li><li><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>The VPN instance view is displayed.</p>
</p></li><li><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span><p><p>The BGP view is displayed.</p>
</p></li><li><span>Run <a href="cmdqueryname=ipv4-family+vpn-instance"><b><span class="cmdname">ipv4-family</span></b></a> <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i></span><p><p>The BGP VPN instance IPv4 address family view is displayed.</p>
<p>Or run <a href="cmdqueryname=ipv6-family+vpn-instance"><b><span class="cmdname">ipv6-family</span></b></a> <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i></p>
<p>The BGP VPN instance IPv6 address family view is displayed.</p>
</p></li><li><span>Perform the following configurations as required:</span><p><ul><li>To configure BGP to compare the VPN address family types of routes when selecting the optimal route and preferentially select the IPv4 prefix routes leaked from VPNv4 over those leaked from EVPNv4, run the <a href="cmdqueryname=bestroute+address-family-priority+vpnv4+high-level"><b><span class="cmdname">bestroute address-family-priority vpnv4 high-level</span></b></a> command in the BGP VPN instance IPv4 address family view.</li><li>To configure BGP to compare the VPN address family types of routes when selecting the optimal route and preferentially select the IPv4 prefix routes leaked from EVPNv4 over those leaked from VPNv4, run the <a href="cmdqueryname=bestroute+address-family-priority+evpnv4+high-level"><b><span class="cmdname">bestroute address-family-priority evpnv4 high-level</span></b></a> command in the BGP VPN instance IPv4 address family view.</li><li>To configure BGP to compare the VPN address family types of routes when selecting the optimal route and preferentially select the IPv6 prefix routes leaked from VPNv6 over those leaked from EVPNv6, run the <a href="cmdqueryname=bestroute+address-family-priority+vpnv6+high-level"><b><span class="cmdname">bestroute address-family-priority vpnv6 high-level</span></b></a> command in the BGP VPN instance IPv6 address family view.</li><li>To configure BGP to compare the VPN address family types of routes when selecting the optimal route and preferentially select the IPv6 prefix routes leaked from EVPNv6 over those leaked from VPNv6, run the <a href="cmdqueryname=bestroute+address-family-priority+evpnv6+high-level"><b><span class="cmdname">bestroute address-family-priority evpnv6 high-level</span></b></a> command in the BGP VPN instance IPv6 address family view.</li></ul>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>If there are a large number of BGP IPv4 VPN instances and the <a href="cmdqueryname=bestroute+address-family-priority+vpnv4+evpnv4+high-level"><b><span class="cmdname">bestroute address-family-priority</span></b></a> { <strong><span>vpnv4</span></strong> | <strong><span>evpnv4</span></strong> } <strong><span>high-level</span></strong> command needs to be run for each instance, you can run the <a href="cmdqueryname=bestroute+address-family-priority+vpnv4+evpnv4"><b><span class="cmdname">bestroute address-family-priority </span></b></a>{ <strong><span>vpnv4</span></strong> | <strong><span>evpnv4</span></strong> } <strong><span>high-level all-vpn-instance</span></strong> command instead to simplify the configuration because the latter command takes effect for all BGP IPv4 VPN address families.</p>
<p>If there are a large number of BGP IPv6 VPN instances and the <a href="cmdqueryname=bestroute+address-family-priority+vpnv6+evpnv6+high-level"><b><span class="cmdname">bestroute address-family-priority</span></b></a> { <strong><span>vpnv6</span></strong> | <strong><span>evpnv6</span></strong> } <strong><span>high-level</span></strong> command needs to be run for each instance, you can run the <a href="cmdqueryname=bestroute+address-family-priority+vpnv6+evpnv6+high-level"><b><span class="cmdname">bestroute address-family-priority</span></b></a> { <strong><span>vpnv6</span></strong> | <strong><span>evpnv6</span></strong> } <strong><span>high-level</span></strong><strong><span> all-vpn-instance</span></strong> command instead to simplify the configuration because the latter command takes effect for all BGP IPv6 VPN address families.</p>
</div></div>
</p></li><li><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol></div>
<div class="postreq"><a name="EN-US_TASK_0000001245086319__1.3.3"></a><a name="1.3.3"></a><h4 class="sectiontitle">Verifying the Configuration</h4><ul><li>Run the <a href="cmdqueryname=display+bgp+vpnv4+vpn-instance+routing-table"><b><span class="cmdname">display bgp vpnv4</span></b></a> <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i> <strong><span>routing-table</span></strong><em> </em><i><span class="varname">ipv4-address</span></i> [ <i><span class="varname">mask-length</span></i> | <i><span class="varname">mask</span></i> ] command to check the BGP routes of an IPv4 VPN instance.</li><li>Run the <a href="cmdqueryname=display+bgp+vpnv6+vpn-instance+routing-table"><b><span class="cmdname">display bgp vpnv6</span></b></a> <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i> <strong><span>routing-table</span></strong><em> </em><i><span class="varname">ipv6-address</span></i> [ <i><span class="varname">prefix-length</span></i> ] command to check the BGP routes of an IPv6 VPN instance.</li></ul>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_path_selection_0001.html">BGP Route Selection Rules
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_5019.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>
</body>
</html>