
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Setting the AS_Path Attribute">
<meta name="abstract" content="The AS_Path attribute is used to prevent routing loops and control route selection.">
<meta name="description" content="The AS_Path attribute is used to prevent routing loops and control route selection.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp6_cfg_0019.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp6_cfg_0024.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp6_cfg_0103.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="BGP IPv6">
<meta name="featuretype" content="IP Route">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP IPv6">
<meta name="featuretype" content="IP Route">
<meta name="featurename" content="BGP IPv6">
<meta name="featuretype" content="IP Route">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing Basis">
<meta name="OWNER" content="l00425560">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00615954">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172366447">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Setting the AS_Path Attribute</title>
</head>
<body><a name="EN-US_TASK_0172366447"></a><a name="EN-US_TASK_0172366447"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Setting the AS_Path Attribute</h1>
<div class="taskbody"><p>The AS_Path attribute is used to prevent routing loops and control route selection.</p>
<div class="steps-unordered"><a name="EN-US_TASK_0172366447__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Procedure</h4>
<ul><li><span>Set the AS_Path attribute in the IPv6 address family view.</span><p><p>Perform the following steps on a BGP4+ device:</p>
</p><ol><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ipv6-family"><b><span class="cmdname">ipv6-family</span></b></a> <strong><span>unicast</span></strong></span><p><p>The IPv6 unicast address family view is displayed.</p>
</p></li><li class="substepexpand"><span>Run the following commands to configure the AS_Path attribute as required:</span><p><ul><li><p>To enable the device to accept the routes that contain the local AS number if the number of repetitions in the route is within the configured limit, run the <a href="cmdqueryname=peer+allow-as-loop"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv6-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>allow-as-loop</span></strong> [ <i><span class="varname">number</span></i> ] command.</p>
</li><li><p>To prevent the AS_Path attribute from being used for route selection, run the <a href="cmdqueryname=bestroute+as-path-ignore"><b><span class="cmdname">bestroute as-path-ignore</span></b></a> command.</p>
</li><li><p>To configure the AS_Path attribute to carry only public network AS numbers, run the <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv6-address</span></i> | <i><span class="varname">group-name</span></i> } <a href="cmdqueryname=public-as-only+force+replace+include-peer-as+limited+replace"><b><span class="cmdname">public-as-only</span></b></a><span> [ <strong><span>force</span></strong></span><span> [ <strong><span>replace</span></strong> ] [ <strong><span>include-peer-as</span></strong> ] | <strong><span>limited</span></strong> [ <strong><span>replace</span></strong> ] [ <strong><span>include-peer-as</span></strong> ]</span><span> ]</span> or <a href="cmdqueryname=peer+public-as-only+import+force"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv6-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>public-as-only</span></strong> <strong><span>import</span></strong><span> [ <strong><span>force</span></strong></span> ] command.</p>
</li></ul>
<p>The commands in Step 4 are optional and can be used in random order.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li><span>Configure a fake AS number.</span><p><p>Perform the following steps on a BGP4+ device:</p>
</p><ol><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer+dual-as+prepend-global-as+prepend-local-as+prepend-fake-as"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv6-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>fake-as</span></strong> <i><span class="varname">fake-as-value</span></i> [ <strong><span>dual-as</span></strong> ] [ <strong><span>prepend-global-as</span></strong> ] [ <span><strong><span>prepend-fake-as</span></strong></span> ]</span><p><p>A fake AS number is configured.</p>
</p><p><p>This command hides the actual AS number. In this case, EBGP peers in other ASs can learn only this fake AS number of the local end and consider the fake AS number as the AS number of the local peer.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>This command is applicable only to EBGP peers.</p>
</div></div>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li><span>Substitute the AS numbers in the AS_Path attribute.</span><p><p>In a BGP/MPLS IP VPN scenario, if the ASs to which two VPN sites belong use private AS numbers, the AS numbers of the two VPN sites may be the same. If a CE in a VPN site sends a VPN route to the connected PE (EBGP peer) and this route is advertised to the remote PE and then to the remote CE, the remote CE will discard the route due to AS number repetition. As a result, different sites of the same VPN cannot communicate with each other. In this case, you need to run the <a href="cmdqueryname=peer+substitute-as"><b><span class="cmdname">peer substitute-as</span></b></a> command on the PE to enable AS number substitution. That is, the PE replaces the AS number of the VPN site where the CE resides in the received VPN route with the local AS number. This prevents the remote CE from discarding routes due to duplicate AS numbers.</p>
<p>In a BGP public network scenario, when two devices with the same AS number learn a BGP route from each other through the same EBGP peer, the route may be discarded because the AS_Path attribute contains duplicate AS numbers. To prevent this problem, run the <a href="cmdqueryname=peer+substitute-as"><b><span class="cmdname">peer substitute-as</span></b></a> command on the EBGP peer shared by the two devices to enable AS number substitution.</p>
<div class="notice"><span class="noticetitle"><img src="../../../../public_sys-resources/notice_3.0-en-us.png"> </span><div class="noticebody"><p>Exercise caution when running the <a href="cmdqueryname=peer+substitute-as"><b><span class="cmdname">peer substitute-as</span></b></a> command because improper use of the command may cause routing loops.</p>
</div></div>
</p><ol><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ipv6-family"><b><span class="cmdname">ipv6-family</span></b></a> <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i></span><p><p>The BGP-VPN instance IPv6 address family view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv6-address</span></i> | <i><span class="varname">group-name</span></i> } <b><span class="cmdname">substitute-as</span></b></span><p><p>The device is configured to replace the AS number in the AS_Path attribute.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li><span>Enable BGP to check, or disable BGP from checking, the first AS number in the AS_Path attribute of each Update message received from a specified EBGP peer or peer group.</span><ol><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=ipv6-family"><b><span class="cmdname">ipv6-family</span></b></a> <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i></span><p><p>The BGP-VPN instance IPv6 address family view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv6-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>check-first-as</span></strong> { <strong><span>enable</span></strong> | <strong><span>disable</span></strong> }</span><p><p>The device is enabled to check or disabled from checking the first AS number in the AS_Path attribute contained in the update messages received from a specified EBGP peer or peer group.</p>
</p><p><p>If the <b><span class="cmdname" id="EN-US_TASK_0172366447__en-us_cliref_0172379895_cmdname1361805844214504">peer check-first-as enable</span></b> command is run, the device checks whether the first AS number in the AS_Path attribute contained in the update messages received from the specified EBGP peer or peer group is the number of the AS where the EBGP peer or peer group resides. If the two AS numbers are different, the local device discards the update messages. If the <b><span class="cmdname" id="EN-US_TASK_0172366447__en-us_cliref_0172379895_cmdname858193481214504">peer check-first-as disable</span></b> command is run, the device accepts all update messages received from the specified EBGP peer or peer group, regardless whether the two AS numbers are the same. If the <b><span class="cmdname" id="EN-US_TASK_0172366447__en-us_cliref_0172379895_cmdname593766707214504">undo peer check-first-as disable</span></b> command is run, the default configuration takes effect.</p>
<p>The check function can be configured for a specified EBGP peer, peer group, or for BGP as a whole. If the function is not configured for a specified EBGP peer, the device checks whether the function is configured for the related peer group; if the function is not configured for the peer group, the device checks whether the function is configured in the BGP view.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
<p>After the configuration is complete, if you want to check the received routes again, run the <a href="cmdqueryname=refresh+bgp"><b><span class="cmdname">refresh bgp</span></b></a> command.</p>
</p></li></ol>
</li></ul></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp6_cfg_0019.html">Controlling BGP4+ Route Selection
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp6_cfg_0024.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp6_cfg_0103.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>