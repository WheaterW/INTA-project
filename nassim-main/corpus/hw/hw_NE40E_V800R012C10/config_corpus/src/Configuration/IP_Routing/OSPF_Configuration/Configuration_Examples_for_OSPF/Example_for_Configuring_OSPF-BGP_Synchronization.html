
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring OSPF-BGP Synchronization">
<meta name="abstract" content="This section describes how to configure OSPF-BGP synchronization to minimize the impact of Router restart on BGP services on the network.">
<meta name="description" content="This section describes how to configure OSPF-BGP synchronization to minimize the impact of Router restart on BGP services on the network.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ospf_cfg_0093.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ospf_cfg_0102.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ospf_cfg_0104.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="OSPF">
<meta name="featuretype" content="IP Route">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="OSPF">
<meta name="featuretype" content="IP Route">
<meta name="featurename" content="OSPF">
<meta name="featuretype" content="IP Route">
<meta name="featurename" content="OSPF">
<meta name="featuretype" content="IP Routing Basis">
<meta name="OWNER" content="z00875216">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="z00875216">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172365674">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring OSPF-BGP Synchronization</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172365674"></a><a name="EN-US_TASK_0172365674"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring OSPF-BGP Synchronization</h1>
<div class="taskbody"><p>This section describes how to configure OSPF-BGP synchronization to minimize the impact of <span class="keyword">Router</span> restart on BGP services on the network.</p>
<div class="context"><a name="EN-US_TASK_0172365674__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0172365674__fig_dc_vrp_ospf_cfg_010301">Figure 1</a>, all <span class="keyword">Router</span>s run BGP. An EBGP connection is set up between <span class="keyword">Device</span>D and <span class="keyword">Device</span>E. IBGP connections are set up between devices in AS 10, and OSPF is used as an IGP protocol.</p>
<p>OSPF-BGP synchronization is required on <span class="keyword">Device</span>B so that the restart of <span class="keyword">Device</span>B does not interrupt the traffic from <span class="keyword">Device</span>A to AS 20.</p>
<div class="fignone" id="EN-US_TASK_0172365674__fig_dc_vrp_ospf_cfg_010301"><a name="EN-US_TASK_0172365674__fig_dc_vrp_ospf_cfg_010301"></a><a name="fig_dc_vrp_ospf_cfg_010301"></a><span class="figcap"><b>Figure 1 </b>Networking for configuring OSPF-BGP synchronization</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 through 3 in this example represent GE<span>0/1/0</span>, GE<span>0/2/0</span>, and GE<span>0/3/0</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_ospf_cfg_010301.png" width="NaN" height="NaN"></span><br></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172365674__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Precautions</h4><p>To improve security, OSPF area authentication or interface authentication is recommended. For details, see "Improving OSPF Network Security". OSPF area authentication is used as an example. For details, see Example for Configuring Basic OSPF Functions.</p>
</div></div>
<div class="context"><a name="EN-US_TASK_0172365674__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Enable OSPF on <span class="keyword">Device</span>A, <span class="keyword">Device</span>B, <span class="keyword">Device</span>C, and <span class="keyword">Device</span>D (except 10.2.1.1/30) and specify the same area for all OSPF interfaces.</p>
</li><li><p>Set up IBGP connections between <span class="keyword">Device</span>A, <span class="keyword">Device</span>B, <span class="keyword">Device</span>C, and <span class="keyword">Device</span>D (except 10.2.1.1/30).</p>
</li><li><p>Configure the OSPF cost on <span class="keyword">Device</span>C.</p>
</li><li><p>Set up EBGP connections between <span class="keyword">Device</span>D and <span class="keyword">Device</span>E.</p>
</li><li><p>Configure BGP to import direct routes and OSPF processes on <span class="keyword">Device</span>D.</p>
</li><li><p>Configure BGP on <span class="keyword">Device</span>E.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172365674__1.4.4"></a><a name="1.4.4"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>Data of <span class="keyword">Device</span>A, including the router ID (1.1.1.1), number of the AS to which <span class="keyword">Device</span>A belongs (10), OSPF process ID (1), network segment addresses of area 0 (10.1.1.0/30 and 10.1.2.0/30), and loopback0 IP address (1.1.1.1/32)</p>
</li><li><p>Data of <span class="keyword">Device</span>B, including the router ID (2.2.2.2), number of the AS to which <span class="keyword">Device</span>B belongs (10), OSPF process ID (1), network segment addresses of area 0 (10.1.1.0/30 and 10.1.3.0/30), and loopback0 IP address (2.2.2.2/32)</p>
</li><li><p>Data of <span class="keyword">Device</span>C, including the router ID (3.3.3.3), number of the AS to which <span class="keyword">Device</span>C belongs (10), OSPF process ID (1), network segment addresses of area 0 (10.1.2.0/30 and 10.1.4.0/30), and loopback0 IP address (3.3.3.3/32)</p>
</li><li><p>Data of <span class="keyword">Device</span>D, including the router ID (4.4.4.4), number of the AS to which <span class="keyword">Device</span>D belongs (10), OSPF process ID (1), network segment addresses of area 0 (10.1.3.0/30 and 10.1.4.0/30), and loopback0 IP address (4.4.4.4/32)</p>
</li><li><p>Data of <span class="keyword">Device</span>E, including the router ID (5.5.5.5), number of the AS to which <span class="keyword">Device</span>E belongs (20), and loopback0 IP address (5.5.5.5/32)</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172365674__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Assign an IP address to each interface. For configuration details, see <a href="#EN-US_TASK_0172365674__section_dc_vrp_ospf_cfg_010306">Configuration Files</a> in this section.</span></li><li><span>Configure basic OSPF functions. For details, see <a href="dc_vrp_ospf_cfg_0094.html">Example for Configuring Basic OSPF Functions</a>.</span></li><li><span>Set up IBGP connections.</span><p><p># Configure <span class="keyword">Device</span>A.</p>
<pre class="screen">&lt;<span class="keyword">Device</span>A&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>interface loopback 0</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-LoopBack0]<strong> ip address 1.1.1.1 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-LoopBack0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A]<strong> bgp 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp]<strong> router-id 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp] <strong>peer 2.2.2.2 as-number 10</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp] <strong>peer 2.2.2.2 connect-interface LoopBack 0</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp] <strong>peer 3.3.3.3 as-number 10</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp] <strong>peer 3.3.3.3 connect-interface LoopBack 0</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp] <strong>peer 4.4.4.4 as-number 10</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp] <strong>peer 4.4.4.4 connect-interface LoopBack 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
<p># Configure <span class="keyword">Device</span>B.</p>
<pre class="screen">&lt;<span class="keyword">Device</span>B&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>interface loopback 0</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-LoopBack0]<strong> ip address 2.2.2.2 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-LoopBack0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B]<strong> bgp 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp]<strong> router-id 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp] <strong>peer 1.1.1.1 as-number 10</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp] <strong>peer 1.1.1.1 connect-interface LoopBack 0</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp] <strong>peer 3.3.3.3 as-number 10</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp] <strong>peer 3.3.3.3 connect-interface LoopBack 0</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp] <strong>peer 4.4.4.4 as-number 10</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp] <strong>peer 4.4.4.4 connect-interface LoopBack 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>commit</strong></pre>
<p># Configure <span class="keyword">Device</span>C.</p>
<pre class="screen">&lt;<span class="keyword">Device</span>C&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C] <strong>interface loopback 0</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C-LoopBack0]<strong> ip address 3.3.3.3 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-LoopBack0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C]<strong> bgp 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp]<strong> router-id 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp] <strong>peer 1.1.1.1 as-number 10</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp] <strong>peer 1.1.1.1 connect-interface LoopBack 0</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp] <strong>peer 2.2.2.2 as-number 10</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp] <strong>peer 2.2.2.2 connect-interface LoopBack 0</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp] <strong>peer 4.4.4.4 as-number 10</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp] <strong>peer 4.4.4.4 connect-interface LoopBack 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C] <strong>commit</strong></pre>
<p># Configure <span class="keyword">Device</span>D.</p>
<pre class="screen">&lt;<span class="keyword">Device</span>D&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>D] <strong>interface loopback 0</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>D-LoopBack0]<strong> ip address 4.4.4.4 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-LoopBack0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D]<strong> bgp 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-bgp]<strong> router-id 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-bgp] <strong>peer 1.1.1.1 as-number 10</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>D-bgp] <strong>peer 1.1.1.1 connect-interface LoopBack 0</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>D-bgp] <strong>peer 2.2.2.2 as-number 10</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>D-bgp] <strong>peer 2.2.2.2 connect-interface LoopBack 0</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>D-bgp] <strong>peer 3.3.3.3 as-number 10</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>D-bgp] <strong>peer 3.3.3.3 connect-interface LoopBack 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D] <strong>commit</strong></pre>
</p></li><li><span>Set up EBGP connections.</span><p><p># Configure <span class="keyword">Device</span>D.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>D] <strong>bgp 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-bgp]<strong> peer 10.2.1.2 as-number 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-bgp]<strong> import-route direct</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-bgp]<strong> import-route ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-bgp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D]<strong> commit</strong></pre>
<p># Configure <span class="keyword">Device</span>E.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>E] <strong>bgp 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>E-bgp]<strong> peer 10.2.1.1 as-number 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>E-bgp]<strong> ipv4-family unicast</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>E-bgp-af-ipv4] <strong>network 10.3.1.0 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>E-bgp-af-ipv4]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>E-bgp]<strong> commit</strong></pre>
</p></li><li><span>Configure the OSPF cost on <span class="keyword">Device</span>C.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-GigabitEthernet<span>0/1/0</span>] <strong>ospf cost 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C] <strong>interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-GigabitEthernet<span>0/2/0</span>] <strong>ospf cost 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-GigabitEthernet<span>0/2/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>After the OSPF cost is set to 2 on <span class="keyword">Device</span>C, <span class="keyword">Device</span>A selects only <span class="keyword">Device</span>B as the intermediate device to the network segment 10.2.1.0, and <span class="keyword">Device</span>C becomes a backup of <span class="keyword">Device</span>B.</p>
</div></div>
<p># Display the routing table on <span class="keyword">Device</span>A. As shown in the routing table, the route to the network segment 10.3.1.0 is learned through BGP, and the outbound interface is GigabitEthernet<span>0/1/0</span>.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>display ip routing-table</strong></pre>
<pre class="screen"><span class="keyword">Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route</span>
------------------------------------------------------------------------------
Routing Table: _public_
         Destinations : 20       Routes : 20

    Destination/Mask       Proto    Pre  Cost    Flags NextHop         Interface

        1.1.1.1/32         Direct   0    0       D     127.0.0.1       InLoopBack0
      1.1.1.255/32         Direct   0    0       D     127.0.0.1       InLoopBack0
        2.2.2.2/32         OSPF     10   3       D     10.1.1.2        GigabitEthernet<span>0/1/0</span>
        4.4.4.0/24         BGP      255  0       RD    4.4.4.4         GigabitEthernet<span>0/1/0</span>
        4.4.4.4/32         OSPF     10   3       D     10.1.1.2        GigabitEthernet<span>0/1/0</span>
        5.5.5.0/24         BGP      255  0       RD    10.2.1.2        GigabitEthernet<span>0/1/0</span>
       10.1.1.0/30         Direct   0    0       D     10.1.1.1        GigabitEthernet<span>0/1/0</span>
       10.1.1.3/32         Direct   0    0       D     10.1.1.1        GigabitEthernet<span>0/1/0</span>
       10.1.1.1/32         Direct   0    0       D     127.0.0.1       InLoopBack0
     10.1.1.255/32         Direct   0    0       D     127.0.0.1       InLoopBack0
     10.1.1.255/32         Direct   0    0       D     10.1.1.2        GigabitEthernet<span>0/1/0</span>
       10.1.1.2/32         Direct   0    0       D     10.1.1.2        GigabitEthernet<span>0/1/0</span>
     10.1.1.255/32         Direct   0    0       D     10.1.1.2        GigabitEthernet<span>0/1/0</span>
       10.1.2.0/30         Direct   0    0       D     10.1.2.1        GigabitEthernet<span>0/2/0</span>
       10.1.2.3/32         Direct   0    0       D     10.1.2.1        GigabitEthernet<span>0/2/0</span>
       10.1.2.1/32         Direct   0    0       D     127.0.0.1       InLoopBack0
     10.1.2.255/32         Direct   0    0       D     127.0.0.1       InLoopBack0
       10.1.2.2/32         Direct   0    0       D     10.1.2.2        GigabitEthernet<span>0/2/0</span>
     10.1.2.255/32         Direct   0    0       D     10.1.2.2        GigabitEthernet<span>0/2/0</span>
      127.0.0.0/8          Direct   0    0       D     127.0.0.1       InLoopBack0
      127.0.0.1/32         Direct   0    0       D     127.0.0.1       InLoopBack0
    127.0.0.255/32         Direct   0    0       D     127.0.0.1       InLoopBack0
<strong>      10.3.1.0/30</strong>          OSPF     10   2       D     10.1.1.2        <strong><span>GigabitEthernet</span><span>0/1/0</span></strong>
       10.1.3.1/32         BGP      255  0       RD    4.4.4.4         GigabitEthernet<span>0/1/0</span>
       10.1.4.0/30         OSPF     10   3       D     10.1.1.2        GigabitEthernet<span>0/1/0</span>
                           OSPF     10   3       D     10.1.2.2        GigabitEthernet<span>0/2/0</span>
       10.1.4.1/32         BGP      255  0       RD    4.4.4.4         GigabitEthernet<span>0/1/0</span>
       10.2.1.0/30         BGP      255  0       RD    4.4.4.4         GigabitEthernet<span>0/1/0</span>
       10.2.1.2/32         BGP      255  0       RD    4.4.4.4         GigabitEthernet<span>0/1/0</span>
       10.3.1.0/30         BGP      255  0       RD    4.4.4.4         GigabitEthernet<span>0/1/0</span>
255.255.255.255/32         Direct   0    0       D     127.0.0.1       InLoopBack0</pre>
<p># Display the routing table on <span class="keyword">Device</span>B.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>display ip routing-table</strong></pre>
<pre class="screen"><span class="keyword">Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route</span>
------------------------------------------------------------------------------
Routing Table: _public_
         Destinations : 19       Routes : 19

    Destination/Mask       Proto    Pre  Cost      Flags NextHop         Interface

        2.2.2.2/32         Direct   0    0           D   127.0.0.1        InLoopBack0
      2.2.2.255/32         Direct   0    0           D   127.0.0.1        InLoopBack0
        1.1.1.1/32         OSPF     10   2           D   10.1.1.1         GigabitEthernet<span>0/1/0</span>
        4.4.4.0/24         BGP      255  0           RD  10.1.3.2         GigabitEthernet<span>0/2/0</span>
        4.4.4.4/32         OSPF     10   2           D   10.1.3.2         GigabitEthernet<span>0/2/0</span>
        5.5.5.0/24         BGP      255  0           RD  10.2.1.2         GigabitEthernet<span>0/2/0</span>
       10.1.1.0/30         Direct   0    0           D   10.1.1.2         GigabitEthernet<span>0/1/0</span>
       10.1.1.3/32         Direct   0    0           D   10.1.1.2         GigabitEthernet<span>0/1/0</span>
       10.1.1.1/32         Direct   0    0           D   10.1.1.1         GigabitEthernet<span>0/1/0</span>
     10.1.1.255/32         Direct   0    0           D   10.1.1.1         GigabitEthernet<span>0/1/0</span>
       10.1.1.2/32         Direct   0    0           D   127.0.0.1        InLoopBack0
     10.1.1.255/32         Direct   0    0           D   127.0.0.1        InLoopBack0
       10.1.2.0/30         OSPF     10   2           D   10.1.1.1         GigabitEthernet<span>0/1/0</span>
       10.1.3.0/30         Direct   0    0           D   10.1.3.1         GigabitEthernet<span>0/2/0</span>
       10.1.3.3/32         Direct   0    0           D   10.1.3.1         GigabitEthernet<span>0/2/0</span>
       10.1.3.1/32         Direct   0    0           D   127.0.0.1        InLoopBack0
     10.1.3.255/32         Direct   0    0           D   127.0.0.1        InLoopBack0
       10.1.3.2/32         Direct   0    0           D   10.1.3.2         GigabitEthernet<span>0/2/0</span>
     10.1.3.255/32         Direct   0    0           D   10.1.3.2         GigabitEthernet<span>0/2/0</span>
      127.0.0.0/8          Direct   0    0           D   127.0.0.1        InLoopBack0
      127.0.0.1/32         Direct   0    0           D   127.0.0.1        InLoopBack0
    127.0.0.255/32         Direct   0    0           D   127.0.0.1        InLoopBack0
       10.1.4.0/30         OSPF     10   2           D   10.1.3.2         GigabitEthernet<span>0/2/0</span>
       10.1.4.1/32         BGP      255  0           RD  10.1.3.2         GigabitEthernet<span>0/2/0</span>
       10.2.1.0/30         BGP      255  0           RD  10.1.3.2         GigabitEthernet<span>0/2/0</span>
       10.2.1.2/32         BGP      255  0           RD  10.1.3.2         GigabitEthernet<span>0/2/0</span>
<strong>      10.3.1.0/30</strong>         BGP       255  0          RD  10.1.3.2         <strong><span>GigabitEthernet</span><span>0/2/0</span></strong>
255.255.255.255/32         Direct   0    0           D   127.0.0.1        InLoopBack0</pre>
<p>As shown in the routing table, <span class="keyword">Device</span>B learns the route to 10.3.1.0 through BGP, and the outbound interface is GE <span>0/2/0</span>. The routes to 10.1.2.0 and 10.1.4.0 can be learned through OSPF. The costs of these routes are both 2.</p>
</p></li><li><span>Enable OSPF-BGP synchronization on <span class="keyword">Device</span>B.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-ospf-1] <strong>stub-router on-startup</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-ospf-1] <strong>commit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p># Restart <span class="keyword">Router</span> <span class="keyword">Device</span>B.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Exercise caution when running this command because it may lead to a temporary network crash. In addition, save the configuration file of the <span class="keyword">Router</span> before restarting it.</p>
</div></div>
<pre class="screen">&lt;<span class="keyword">Device</span>B&gt; <strong>reboot</strong></pre>
<pre class="screen">System will reboot! Continue?[Y/N] <strong>y</strong></pre>
<p># Display the routing table on <span class="keyword">Device</span>A. As shown in the routing table, BGP learns the route to 10.3.1.0, and the outbound interface is GigabitEthernet<span>0/2/0</span>.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>display ip routing-table</strong></pre>
<pre class="screen"><span class="keyword">Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route</span>
------------------------------------------------------------------------------
Routing Table: _public_
         Destinations : 20       Routes : 20

Destination/Mask    Proto  Pre  Cost      Flags NextHop         Interface

        1.1.1.1/32  Direct 0    0           D   127.0.0.1        InLoopBack0
        2.2.2.2/32  OSPF   10   4           D   10.1.2.2         GigabitEthernet<span>0/2/0</span>
        4.4.4.0/24  BGP    255  0           RD  4.4.4.4          GigabitEthernet<span>0/2/0</span>
        4.4.4.4/32  OSPF   10   4           D   10.1.2.2         GigabitEthernet<span>0/2/0</span>
        5.5.5.0/24  BGP    255  0           RD  10.2.1.2         GigabitEthernet<span>0/2/0</span>
       10.1.1.0/30  Direct 0    0           D   10.1.1.1         GigabitEthernet<span>0/1/0</span>
       10.1.1.1/32  Direct 0    0           D   127.0.0.1        InLoopBack0
       10.1.1.2/32  Direct 0    0           D   10.1.1.2         GigabitEthernet<span>0/1/0</span>
       10.1.2.0/30  Direct 0    0           D   10.1.2.1         GigabitEthernet<span>0/2/0</span>
       10.1.2.1/32  Direct 0    0           D   127.0.0.1        InLoopBack0
       10.1.2.2/32  Direct 0    0           D   10.1.2.2         GigabitEthernet<span>0/2/0</span>
      127.0.0.0/8   Direct 0    0           D   127.0.0.1        InLoopBack0
      127.0.0.1/32  Direct 0    0           D   127.0.0.1        InLoopBack0
       10.1.3.0/30  OSPF   10   2           D   10.1.1.2         GigabitEthernet<span>0/1/0</span>
       10.1.3.1/32  BGP    255  0           RD  4.4.4.4          GigabitEthernet<span>0/2/0</span>
       10.1.4.0/30  OSPF   10   3           D   10.1.2.2         GigabitEthernet<span>0/2/0</span>
       10.1.4.1/32  BGP    255  0           RD  4.4.4.4          GigabitEthernet<span>0/2/0</span>
       10.2.1.0/30  BGP    255  0           RD  4.4.4.4          GigabitEthernet<span>0/2/0</span>
       10.2.1.2/32  BGP    255  0           RD  4.4.4.4          GigabitEthernet<span>0/2/0</span>
<strong>      10.3.1.0/30</strong>   BGP   255  0            RD  4.4.4.4          <strong>GigabitEthernet<span>0/2/0</span></strong></pre>
<p># Display the routing table on <span class="keyword">Device</span>B. As shown in the routing table, only OSPF routes exist in the routing table because IGP routes converge faster than BGP routes do. The costs of the OSPF routes are 65535.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>display ip routing-table</strong></pre>
<pre class="screen"><span class="keyword">Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route</span>
------------------------------------------------------------------------------
Routing Table: _public_
         Destinations : 15       Routes : 15

Destination/Mask    Proto  Pre  Cost      Flags NextHop        Interface

       1.1.1.1/32   <strong>OSPF</strong>   10   <strong>65536</strong>       D  10.1.1.1        GigabitEthernet<span>0/1/0</span>
        2.2.2.2/32  Direct 0    0           D  127.0.0.1       InLoopBack0
       4.4.4.4/32   <strong>OSPF</strong>   10   <strong>65536</strong>       D  10.1.3.2        GigabitEthernet<span>0/2/0</span>
       10.1.1.0/30  Direct 0    0           D  10.1.1.2        GigabitEthernet<span>0/1/0</span>
       10.1.1.1/32  Direct 0    0           D  10.1.1.1        GigabitEthernet<span>0/1/0</span>
       10.1.1.2/32  Direct 0    0           D  127.0.0.1       InLoopBack0
      10.1.2.0/30   <strong>OSPF</strong>   10   <strong>65536</strong>       D  10.1.1.1        GigabitEthernet<span>0/1/0</span>
       10.1.3.0/30  Direct 0    0           D  10.1.3.1        GigabitEthernet<span>0/2/0</span>
       10.1.3.1/32  Direct 0    0           D  127.0.0.1       InLoopBack0
       10.1.3.2/32  Direct 0    0           D  10.1.3.2        GigabitEthernet<span>0/2/0</span>
      127.0.0.0/8   Direct 0    0           D  127.0.0.1       InLoopBack0
      127.0.0.1/32  Direct 0    0           D  127.0.0.1       InLoopBack0
      10.1.4.0/30   <strong>OSPF</strong>   10   <strong>65536</strong>       D  10.1.3.2        GigabitEthernet<span>0/2/0</span>
      127.0.0.0/8   Direct 0    0           D  127.0.0.1       InLoopBack0
      127.0.0.1/32  Direct 0    0           D  127.0.0.1       InLoopBack0</pre>
<p># Display the routing table on <span class="keyword">Device</span>B again.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>display ip routing-table</strong></pre>
<pre class="screen"><span class="keyword">Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route</span>
------------------------------------------------------------------------------
Routing Table: _public_
         Destinations : 19       Routes : 19

Destination/Mask    Proto  Pre  Cost       Flags NextHop       Interface

        2.2.2.2/32  Direct 0    0           D    127.0.0.1        InLoopBack0
        1.1.1.1/32  OSPF   10   2           D    10.1.1.1         GigabitEthernet<span>0/1/0</span>
        4.4.4.0/24  BGP    255  0           RD   10.1.3.2         GigabitEthernet<span>0/2/0</span>
        4.4.4.4/32  OSPF   10   2           D    10.1.3.2         GigabitEthernet<span>0/2/0</span>
        5.5.5.0/24  BGP    255  0           RD   10.2.1.2         GigabitEthernet<span>0/2/0</span>
       10.1.1.0/30  Direct 0    0           D    10.1.1.2         GigabitEthernet<span>0/1/0</span>
       10.1.1.1/32  Direct 0    0           D    10.1.1.1         GigabitEthernet<span>0/1/0</span>
       10.1.1.2/32  Direct 0    0           D    127.0.0.1        InLoopBack0
       10.1.2.0/30  OSPF   10   2           D    10.1.1.1         GigabitEthernet<span>0/1/0</span>
       10.1.3.0/30  Direct 0    0           D    10.1.3.1         GigabitEthernet<span>0/2/0</span>
       10.1.3.1/32  Direct 0    0           D    127.0.0.1        InLoopBack0
       10.1.3.2/32  Direct 0    0           D    10.1.3.2         GigabitEthernet<span>0/2/0</span>
      127.0.0.0/8   Direct 0    0           D    127.0.0.1        InLoopBack0
      127.0.0.1/32  Direct 0    0           D    127.0.0.1        InLoopBack0
       10.1.4.0/30  OSPF   10   2           D    10.1.3.2         GigabitEthernet<span>0/2/0</span>
       10.1.4.1/32  BGP    255  0           RD   10.1.3.2         GigabitEthernet<span>0/2/0</span>
       10.2.1.0/30  BGP    255  0           RD   10.1.3.2         GigabitEthernet<span>0/2/0</span>
       10.2.1.2/32  BGP    255  0           RD   10.1.3.2         GigabitEthernet<span>0/2/0</span>
       10.3.1.0/30  BGP    255  0           RD   10.1.3.2         GigabitEthernet<span>0/2/0</span></pre>
<p>As shown in the routing table, BGP routes on <span class="keyword">Device</span>B have converged, and the routing information is the same as that displayed before the restart.</p>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0172365674__section_dc_vrp_ospf_cfg_010306"><a name="EN-US_TASK_0172365674__section_dc_vrp_ospf_cfg_010306"></a><a name="section_dc_vrp_ospf_cfg_010306"></a><a name="EN-US_TASK_0172365674__1.4.6"></a><a name="1.4.6"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p><span class="keyword">Device</span>A configuration file</p>
<pre class="screen">#
 sysname <span class="keyword">Device</span>A
#
router id 1.1.1.1
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.1.1 255.255.255.252
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.1.2.1 255.255.255.252
#
interface LoopBack0
 ip address 1.1.1.1 255.255.255.255
#
bgp 10
 router-id 1.1.1.1
 peer 2.2.2.2 as-number 10
 peer 2.2.2.2 connect-interface LoopBack 0
 peer 3.3.3.3 as-number 10
 peer 3.3.3.3 connect-interface LoopBack 0
 peer 4.4.4.4 as-number 10
 peer 4.4.4.4 connect-interface LoopBack 0
#
ospf 1
 area 0.0.0.0
  network 1.1.1.1 0.0.0.0
  network 10.1.1.0 0.0.0.3
  network 10.1.2.0 0.0.0.3
#
return</pre>
</li><li><p><span class="keyword">Device</span>B configuration file</p>
<pre class="screen">#
sysname <span class="keyword">Device</span>B
#
router id 2.2.2.2
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.1.2 255.255.255.252
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.1.3.1 255.255.255.252
#
interface LoopBack0
 ip address 2.2.2.2 255.255.255.255
#
bgp 10
 router-id 2.2.2.2
 peer 1.1.1.1 as-number 10
 peer 1.1.1.1 connect-interface LoopBack 0
 peer 3.3.3.3 as-number 10
 peer 3.3.3.3 connect-interface LoopBack 0
 peer 4.4.4.4 as-number 10
 peer 4.4.4.4 connect-interface LoopBack 0
#
ospf 1
 stub-router on-startup
 area 0.0.0.0
  network 10.1.1.0 0.0.0.3
  network 10.1.3.0 0.0.0.3
  network 2.2.2.2 0.0.0.0
#
return</pre>
</li><li><p><span class="keyword">Device</span>C configuration file</p>
<pre class="screen">#
 sysname <span class="keyword">Device</span>C
#
router id 3.3.3.3
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.4.1 255.255.255.252
 ospf cost 2
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.1.2.2 255.255.255.252
 ospf cost 2
#
interface LoopBack0
 ip address 3.3.3.3 255.255.255.255
#
bgp 10
 router-id 3.3.3.3
 peer 1.1.1.1 as-number 10
 peer 1.1.1.1 connect-interface LoopBack 0
 peer 2.2.2.2 as-number 10
 peer 2.2.2.2 connect-interface LoopBack 0
 peer 4.4.4.4 as-number 10
 peer 4.4.4.4 connect-interface LoopBack 0
#
ospf 1
 area 0.0.0.0
  network 10.1.2.0 0.0.0.3
  network 10.1.4.0 0.0.0.3
  network 3.3.3.3 0.0.0.0
#
return</pre>
</li><li><p><span class="keyword">Device</span>D configuration file</p>
<pre class="screen">#
 sysname <span class="keyword">Device</span>D
#
router id 4.4.4.4
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.4.2 255.255.255.252
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.1.3.2 255.255.255.252
#
interface GigabitEthernet<span>0/3/0</span>
 undo shutdown
 ip address 10.2.1.1 255.255.255.252
#
interface LoopBack0
 ip address 4.4.4.4 255.255.255.255
#
bgp 10
 router-id 4.4.4.4
 peer 10.2.1.2 as-number 20
 peer 1.1.1.1 as-number 10
 peer 1.1.1.1 connect-interface LoopBack 0
 peer 2.2.2.2 as-number 10
 peer 2.2.2.2 connect-interface LoopBack 0
 peer 3.3.3.3 as-number 10
 peer 3.3.3.3 connect-interface LoopBack 0
 #
ipv4-family unicast
  undo synchronization
  import-route direct
  import-route ospf 1
  peer 10.2.1.2 enable
#
ospf 1
 area 0.0.0.0
  network 4.4.4.4 0.0.0.0
  network 10.1.3.0 0.0.0.3
  network 10.1.4.0 0.0.0.3
#
return</pre>
</li><li><p><span class="keyword">Device</span>E configuration file</p>
<pre class="screen">#
 sysname <span class="keyword">Device</span>E
#
router id 5.5.5.5
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.2.1.2 255.255.255.252
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.3.1.1 255.255.255.252
#
interface LoopBack0
 ip address 5.5.5.5 255.255.255.255
#
bgp 20
 router-id 5.5.5.5
 peer 10.2.1.1 as-number 10
#
ipv4-family unicast
  undo synchronization
  network 10.3.1.0 255.255.255.252
  peer 10.2.1.1 enable
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ospf_cfg_0093.html">Configuration Examples for OSPF
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ospf_cfg_0102.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ospf_cfg_0104.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>