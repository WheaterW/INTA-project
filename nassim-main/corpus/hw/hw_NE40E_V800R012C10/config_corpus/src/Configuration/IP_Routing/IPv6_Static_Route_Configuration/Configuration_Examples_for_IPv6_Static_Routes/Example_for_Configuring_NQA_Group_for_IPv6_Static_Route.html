
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring NQA Group for IPv6 Static Route">
<meta name="abstract" content="NQA group for IPv6 static route allows an NQA group to be associated with multiple NQA test instances to monitor multiple links, rapidly detect network faults, and control advertisement of IPv6 static routes, thereby implementing service switching.">
<meta name="description" content="NQA group for IPv6 static route allows an NQA group to be associated with multiple NQA test instances to monitor multiple links, rapidly detect network faults, and control advertisement of IPv6 static routes, thereby implementing service switching.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_static-route_disjoin_cfg_0050.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_static-route_disjoin_cfg_0042.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_static-route_disjoin_cfg_0047.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="Static Route">
<meta name="featuretype" content="IP Route">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="Static Route">
<meta name="featuretype" content="IP Route">
<meta name="featurename" content="Static Route">
<meta name="featuretype" content="IP Route">
<meta name="featurename" content="Static Route">
<meta name="featuretype" content="IP Routing Basis">
<meta name="OWNER" content="h00414125">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="s00826690">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001366316504">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>Example for Configuring NQA Group for IPv6 Static Route</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001366316504"></a><a name="EN-US_TASK_0000001366316504"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring NQA Group for IPv6 Static Route</h1>
<div class="taskbody"><p>NQA group for IPv6 static route allows an NQA group to be associated with multiple NQA test instances to monitor multiple links, rapidly detect network faults, and control advertisement of IPv6 static routes, thereby implementing service switching.</p>
<div class="context"><a name="EN-US_TASK_0000001366316504__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>NQA group for IPv6 static route monitors the link status of an IPv6 static route through association between the static route and an NQA group that consists of multiple NQA test instances. The RM module determines whether the IPv6 static route is active based on the test result of the NQA group. If the IPv6 static route is inactive, the RM module deletes it from the IP routing table and selects an available backup link for data forwarding, which prevents lengthy service interruptions.</p>
<div class="p"><a href="#EN-US_TASK_0000001366316504__fig_dc_vrp_static-route_feature_001301">Figure 1</a> shows a network with redundant links.<ul><li>BGP peer relationships are established between <span class="keyword">Device</span> A and <span class="keyword">Device</span> B and between <span class="keyword">Device</span> A and <span class="keyword">Device</span> C.</li><li>On <span class="keyword">Device</span> B and <span class="keyword">Device</span> C, default static routes are configured and imported into BGP, and different PrefVal values are configured so that <span class="keyword">Device</span> B and <span class="keyword">Device</span> C function as the master device and backup device, respectively.</li><li><span class="keyword">Device</span> B and <span class="keyword">Device</span> D are connected through two links by way of <span class="keyword">Device</span> B1 and <span class="keyword">Device</span> B2.</li><li>In normal cases, traffic is transmitted along the primary link (<span class="keyword">Device</span> B -&gt; <span class="keyword">Device</span> D).</li><li>If the primary link fails (the NQA group bound to the IPv6 default static route of <span class="keyword">Device</span> B considers the IPv6 static route inactive when monitoring the two links from <span class="keyword">Device</span> B to <span class="keyword">Device</span> D), traffic is switched to the backup link (<span class="keyword">Device</span> C -&gt; <span class="keyword">Device</span> D).</li></ul>
</div>
<div class="fignone" id="EN-US_TASK_0000001366316504__fig_dc_vrp_static-route_feature_001301"><a name="EN-US_TASK_0000001366316504__fig_dc_vrp_static-route_feature_001301"></a><a name="fig_dc_vrp_static-route_feature_001301"></a><span class="figcap"><b>Figure 1 </b>Network diagram of NQA group for IPv6 static route</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface1, interface2, and interface3 represent GE <span>0/1/0</span>, GE <span>0/1/1</span>, and GE <span>0/1/2</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0000001366476728.png"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001366316504__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Create NQA test instances of the ICMP type to detect faults on the primary link.</p>
<p>Create two NQA test instances of the ICMP type between <span class="keyword">Device</span> B and <span class="keyword">Device</span> B1 and between <span class="keyword">Device</span> B and <span class="keyword">Device</span> B2 to correspond to the two links between <span class="keyword">Device</span> B and <span class="keyword">Device</span> D and to check whether the primary link (<span class="keyword">Device</span> B -&gt; <span class="keyword">Device</span> D) is running properly.</p>
</li><li>Create an NQA group.<p>Bind the two NQA test instances of the ICMP type to the NQA group.</p>
</li><li><p>Configure static routes and associate the static route along the primary link with the NQA group.</p>
<p>Configure IPv6 static routes to loopback0 interfaces between <span class="keyword">Device</span> A and <span class="keyword">Device</span> B, and between <span class="keyword">Device</span> A and <span class="keyword">Device</span> C. Configure default IPv6 static routes on <span class="keyword">Device</span> B and <span class="keyword">Device</span> C. Associate the IPv6 static route configured on <span class="keyword">Device</span> B with the NQA group, which collects the detection results of two NQA test instances to determine its status. When the NQA group goes down, the device determines that the current link is faulty and instructs the RM module to delete the IPv6 static route from the IP routing table.</p>
</li><li><p>Configure BGP.</p>
<p>Configure BGP on <span class="keyword">Device</span> A, <span class="keyword">Device</span> B, and <span class="keyword">Device</span> C so that they can learn routes from each other.</p>
</li><li><p>Configure BGP to import IPv6 static routes and set a larger PrefVal value for the primary link.</p>
<p>Configure BGP on <span class="keyword">Device</span> B and <span class="keyword">Device</span> C to import IPv6 static routes, and set a larger PrefVal value for the IPv6 static route imported by <span class="keyword">Device</span> B. When <span class="keyword">Device</span> A learns routes to the same destination from <span class="keyword">Device</span> B and <span class="keyword">Device</span> C, it preferentially selects the link (<span class="keyword">Device</span> B -&gt; <span class="keyword">Device</span> D), which has a larger PrefVal value.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001366316504__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li>IP address of each interface</li><li>NQA-related configurations (for details, see <a href="#EN-US_TASK_0000001366316504__table_02">Table 1</a>)
<div class="tableBorder"><a name="EN-US_TASK_0000001366316504__table_02"></a><a name="table_02"></a><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" id="EN-US_TASK_0000001366316504__table_02" frame="border" border="1" rules="all"><caption><b>Table 1 </b>NQA parameter values</caption><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="50%" id="mcps1.4.3.3.2.2.2.3.1.1" liSelected="liSelected"><p>Item</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="50%" id="mcps1.4.3.3.2.2.2.3.1.2" liSelected="liSelected"><p>Value</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.3.3.2.2.2.3.1.1 "><p>Administrator name</p>
</td>
<td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.3.3.2.2.2.3.1.2 "><p>user1, user2</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.3.3.2.2.2.3.1.1 "><p>Test instance name</p>
</td>
<td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.3.3.2.2.2.3.1.2 "><p>test1, test2</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.3.3.2.2.2.3.1.1 "><p>Test type</p>
</td>
<td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.3.3.2.2.2.3.1.2 "><p>ICMP</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.3.3.2.2.2.3.1.1 "><p>Destination address</p>
</td>
<td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.3.3.2.2.2.3.1.2 "><p>2001::db8:3::2/64, 2001::db8:4::2/64</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.3.3.2.2.2.3.1.1 "><p>Test interval</p>
</td>
<td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.3.3.2.2.2.3.1.2 "><p>10s</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.3.3.2.2.2.3.1.1 "><p>Number of probes</p>
</td>
<td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.3.3.2.2.2.3.1.2 "><p>2</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.3.3.2.2.2.3.1.1 "><p>Interval at which packets are sent</p>
</td>
<td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.3.3.2.2.2.3.1.2 "><p>5s</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.3.3.2.2.2.3.1.1 "><p>Timeout period</p>
</td>
<td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.3.3.2.2.2.3.1.2 "><p>4s</p>
</td>
</tr>
</tbody>
</table>
</div>
</li><li>Operation type between test instances in the NQA group: OR</li><li>BGP AS numbers (the same) and router IDs of <span class="keyword">Device</span> A, <span class="keyword">Device</span> B, and <span class="keyword">Device</span> C (1.1.1.1, 2.2.2.2, and 3.3.3.3, respectively)</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001366316504__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure IP addresses. For details, see <a href="#EN-US_TASK_0000001366316504__title_01">Configuration Files</a>.</span></li><li><span>On <span class="keyword">Device</span> B, configure two NQA test instances of the ICMP type between <span class="keyword">Device</span> B and <span class="keyword">Device</span> B1 and between <span class="keyword">Device</span> B and <span class="keyword">Device</span> B2.</span><p><pre class="screen">&lt;<span class="keyword">Device</span>B&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B]<strong> nqa test-instance user1 test1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-nqa-user1-test1]<strong> test-type icmp</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-nqa-user1-test1]<strong> destination-address ipv6 2001:db8:3::2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-nqa-user1-test1]<strong> frequency 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-nqa-user1-test1]<strong> probe-count 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-nqa-user1-test1]<strong> interval seconds 5</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-nqa-user1-test1]<strong> timeout 4</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-nqa-user1-test1]<strong> start now</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-nqa-user1-test1]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-nqa-user1-test1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B]<strong> nqa test-instance user2 test2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-nqa-user2-test2]<strong> test-type icmp</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-nqa-user1-test1]<strong> destination-address ipv6 2001:db8:4::2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-nqa-user2-test2]<strong> frequency 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-nqa-user2-test2]<strong> probe-count 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-nqa-user2-test2]<strong> interval seconds 5</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-nqa-user2-test2]<strong> timeout 4</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-nqa-user2-test2]<strong> start now</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-nqa-user2-test2]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-nqa-user2-test2]<strong> quit</strong></pre>
</p></li><li><span>Create an NQA group and bind the two NQA test instances of the ICMP type to the group.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B]<strong> nqa group group1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-nqa-group-group1]<strong> nqa test-instance user1 test1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-nqa-group-group1]<strong> nqa test-instance user2 test2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-nqa-group-group1]<strong> operator or</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-nqa-group-group1]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-nqa-group-group1]<strong> quit</strong></pre>
</p></li><li><span>Configure static routes.</span><p><p># Configure static routes to loopback interfaces between <span class="keyword">Device</span> A and <span class="keyword">Device</span> B, and between <span class="keyword">Device</span> A and <span class="keyword">Device</span> C.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>ipv6 route-static 2::2 128 GigabitEthernet <span>0/1/0</span> 2001:db8:1::2 </strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>ipv6 route-static 3::3 128 GigabitEthernet <span>0/1/1</span> 2001:db8:2::2 </strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
<p># Configure a static route to the loopback interface of <span class="keyword">Device</span> A on <span class="keyword">Device</span> B.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>ipv6 route-static 1::1 128 GigabitEthernet <span>0/1/0</span> 2001:db8:1::1 </strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>commit</strong></pre>
<p># Configure a static route to the loopback interface of <span class="keyword">Device</span> A on <span class="keyword">Device</span> C.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C] <strong>ipv6 route-static 1::1 128 GigabitEthernet <span>0/1/1</span> 2001:db8:2::1 </strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C] <strong>commit</strong></pre>
<p># Configure a default static route on <span class="keyword">Device</span> B and associate it with the NQA group.</p>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>ipv6 route-static :: 128 NULL0 track nqa-group group1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>commit</strong></pre>
<p># Configure a default static route on <span class="keyword">Device</span> C.</p>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C] <strong>ipv6 route-static :: 128 NULL0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C] <strong>commit</strong></pre>
</p></li><li><span>Configure BGP on <span class="keyword">Device</span> A, <span class="keyword">Device</span> B, and <span class="keyword">Device</span> C.</span><p><p># Configure BGP on <span class="keyword">Device</span> A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp] <strong>peer 2::2 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp] <strong>peer 2::2 connect-interface LoopBack0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp] <strong>peer 3::3 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp] <strong>peer 3::3 connect-interface LoopBack0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
<p># Configure BGP on <span class="keyword">Device</span> B.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp] <strong>peer 1::1 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp] <strong>peer 1::1 connect-interface LoopBack0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>commit</strong></pre>
<p># Configure BGP on <span class="keyword">Device</span> C.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp] <strong>peer 1::1 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp] <strong>peer 1::1 connect-interface LoopBack0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C] <strong>commit</strong></pre>
</p></li><li><span>Configure BGP on <span class="keyword">Device</span> B and <span class="keyword">Device</span> C to import IPv6 static routes, and set a larger PrefVal value for the primary link.</span><p><p># Configure BGP on <span class="keyword">Device</span> B to import IPv6 static routes, and set the PrefVal value to 200.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp] <strong>import-route static</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp] <strong>ipv6-family unicast</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp-af-ipv6] <strong>peer 1::1 preferred-value 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp-af-ipv6] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-bgp-af-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-bgp] <strong>quit</strong></pre>
<p># Configure BGP on <span class="keyword">Device</span> C to import IPv6 static routes, and set the PrefVal value to 100.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp] <strong>import-route static</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp] <strong>ipv6-family unicast</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp-af-ipv6] <strong>peer 1::1 preferred-value 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp-af-ipv6] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C-bgp-af-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C-bgp] <strong>quit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p># Check the results of the two NQA test instances on <span class="keyword">Device</span> B.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>display nqa results test-instance user1 test1</strong></pre>
<pre class="screen">NQA entry(user1, test1) :testflag is inactive ,testtype is icmp
  1 . Test 1 result   The test is finished
   Send operation times: 3                Receive response times: 3
   <strong>Completion:success</strong>                   RTD OverThresholds number:0
   Attempts number:1                      Drop operation number:0
   Disconnect operation number:0          Operation timeout number:0
   System busy operation number:0         Connection fail number:0
   Operation sequence errors number:0     RTT Status errors number:0
   Destination ip address:172.16.1.2
   Min/Max/Average Completion Time: 11/185/69
   Sum/Square-Sum  Completion Time: 207/34467
   Last Good Probe Time: 2022-09-24 15:08:38.6
   <strong>Lost packet ratio: 0 %</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>display nqa results test-instance user2 test2</strong></pre>
<pre class="screen">NQA entry(user2, test2) :testflag is inactive ,testtype is icmp
  1 . Test 1 result   The test is finished
   Send operation times: 3                Receive response times: 3
   <strong>Completion:success</strong>                   RTD OverThresholds number:0
   Attempts number:1                      Drop operation number:0
   Disconnect operation number:0          Operation timeout number:0
   System busy operation number:0         Connection fail number:0
   Operation sequence errors number:0     RTT Status errors number:0
   Destination ip address:172.16.2.2
   Min/Max/Average Completion Time: 9/16/11
   Sum/Square-Sum  Completion Time: 34/418
   Last Good Probe Time: 2022-09-24 15:08:50.3
   <strong>Lost packet ratio: 0 %</strong></pre>
<p>The command output shows "Lost packet ratio 0 %," indicating that the link is running properly.</p>
<p># Check the test result of the NQA group on <span class="keyword">Device</span> B.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>display nqa group</strong></pre>
<pre class="screen">NQA-group information:
------------------------------------------------------------------------
NQA-group group1
<strong>Status: UP</strong>         Operator: OR
------------------------------------------------------------------------
Admin-name                       Test-name                        Status
------------------------------------------------------------------------
user1                           test1                             <strong>UP</strong>
user2                           test2                             <strong>UP</strong></pre>
<p># Check the routing table of <span class="keyword">Device</span> A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>display ipv6 routing-table | include IBGP</strong></pre>
<pre class="screen">Routing Table : _public_
Summary Count : 1
 
Destination  : ::                                    PrefixLength : 128
NextHop      : <strong>2::2</strong>                                  Preference   : 255
Cost         : 0                                     Protocol     : IBGP
RelayNextHop : ::                                    TunnelID     : 0x0
Interface    : GigabitEthernet<span>0/1/0</span>                  Flags        : RD</pre>
<p>The command output shows that the next hop used to forward user traffic on <span class="keyword">Device</span> A is <span class="keyword">Device</span> B, indicating that user traffic is transmitted along the primary link.</p>
<p># Shut down GigabitEthernet <span>0/1/1</span> on <span class="keyword">Device</span> B to simulate a link fault.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>interface GigabitEthernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/1</span>] <strong>shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/1</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>quit</strong></pre>
<p># Check the NQA test result.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>display nqa results test-instance user1 test1</strong></pre>
<pre class="screen">NQA entry(user1, test1) :testflag is inactive ,testtype is icmp
  2 . Test 2 result   The test is finished
   Send operation times: 3                Receive response times: 0
   <strong>Completion:failed</strong>                    RTD OverThresholds number:0
   Attempts number:1                      Drop operation number:0
   Disconnect operation number:0          Operation timeout number:3
   System busy operation number:0         Connection fail number:0
   Operation sequence errors number:0     RTT Status errors number:0
   Destination ip address:172.16.1.2
   Min/Max/Average Completion Time: 0/0/0
   Sum/Square-Sum  Completion Time: 0/0
   Last Good Probe Time: 0000-00-00 00:00:00.0
   <strong>Lost packet ratio: 100 %</strong></pre>
<p>"Completion:failed" and "Lost packet ratio: 100%" are displayed, indicating that the link where GigabitEthernet <span>0/1/1</span> resides is faulty.</p>
<p># Check the test result of the NQA group on <span class="keyword">Device</span> B.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>display nqa group</strong></pre>
<pre class="screen">NQA-group information:
------------------------------------------------------------------------
NQA-group group1
Status: <strong>UP</strong>         Operator: OR
------------------------------------------------------------------------
Admin-name                       Test-name                        Status
------------------------------------------------------------------------
user1                           test1                            <strong> DOWN</strong>
user2                           test2                             <strong>UP</strong></pre>
<p>The command output shows that the status of the NQA group remains UP.</p>
<p># Check the routing table of <span class="keyword">Device</span> A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>display ipv6 routing-table | include IBGP</strong></pre>
<pre class="screen">Routing Table : _public_
Summary Count : 1
 
Destination  : ::                                    PrefixLength : 128
NextHop      : <strong>2::2</strong>                                  Preference   : 255
Cost         : 0                                     Protocol     : IBGP
RelayNextHop : ::                                    TunnelID     : 0x0
Interface    : GigabitEthernet<span>0/1/0</span>                  Flags        : RD</pre>
<p>The operation type between test instances in the NQA group is OR. Therefore, the status of the NQA group remains UP.</p>
<p># Shut down GigabitEthernet <span>0/1/2</span> on <span class="keyword">Device</span> B to simulate a link fault.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>interface GigabitEthernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/2</span>] <strong>shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/2</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>quit</strong></pre>
<p># Check the NQA test result.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>display nqa results test-instance user1 test1</strong></pre>
<pre class="screen">NQA entry(user2, test2) : testflag is active ,testtype is icmp
  1 . Test 186 result   The test is finished
   Send operation times: 2                Receive response times: 0
   <strong>Completion:failed</strong>                    RTD OverThresholds number:0
   Attempts number:1                      Drop operation number:0
   Disconnect operation number:0          Operation timeout number:2
   System busy operation number:0         Connection fail number:0
   Operation sequence errors number:0     RTT Stats errors number:0
   Destination ip address:172.16.2.2
   Min/Max/Average Completion Time: 0/0/0
   Sum/Square-Sum  Completion Time: 0/0
   Last Good Probe Time: 0000-00-00 00:00:00.0
   <strong>Lost packet ratio: 100 %</strong></pre>
<p>"Completion:failed" and "Lost packet ratio: 100%" are displayed, indicating that the link where GigabitEthernet <span>0/1/2</span> resides is faulty.</p>
<p># Check the test result of the NQA group on <span class="keyword">Device</span> B.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>display nqa group</strong></pre>
<pre class="screen">NQA-group information:
------------------------------------------------------------------------
NQA-group group1
Status: <strong>DOWN</strong>       Operator: OR
------------------------------------------------------------------------
Admin-name                       Test-name                        Status
------------------------------------------------------------------------
user1                           test1                             <strong>DOWN</strong>
user2                           test2                             <strong>DOWN</strong></pre>
<p>The command output shows that the status of the NQA group changes to DOWN.</p>
<p># Check the routing table of <span class="keyword">Device</span> A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>display ipv6 routing-table | include IBGP</strong></pre>
<pre class="screen">Routing Table : _public_
Summary Count : 1
 
Destination  : ::                                    PrefixLength : 128
NextHop      : <strong>3::3</strong>                                  Preference   : 255
Cost         : 0                                     Protocol     : IBGP
RelayNextHop : ::                                    TunnelID     : 0x0
Interface    : GigabitEthernet<span>0/1/1</span>                  Flags        : RD</pre>
<p>The command output shows that the next hop used to forward user traffic on <span class="keyword">Device</span> A changes to <span class="keyword">Device</span> C, indicating that the traffic is switched to the backup link.</p>
<p>The NQA group on <span class="keyword">Device</span> B is associated with the IPv6 static route. When the NQA group detects that both links from <span class="keyword">Device</span> B to <span class="keyword">Device</span> D fail, the NQA group goes down and rapidly notifies <span class="keyword">Device</span> B that the associated IPv6 static route is unavailable. Service traffic is then switched to the backup link.</p>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0000001366316504__title_01"><a name="EN-US_TASK_0000001366316504__title_01"></a><a name="title_01"></a><a name="EN-US_TASK_0000001366316504__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p><span class="keyword">Device</span> A configuration file</p>
<pre class="screen">#
sysname DeviceA
#
router id 1.1.1.1
#
interface LoopBack0
 ipv6 enable
 ipv6 address 1::1/128
#
interface GigabitEthernet<span>0/1/0</span>
 ipv6 enable
 ipv6 address 2001:DB8:1::1/64
#
interface GigabitEthernet<span>0/1/1</span>
 ipv6 enable
 ipv6 address 2001:DB8:2::1/64
#
bgp 100
 peer 2::2 as-number 100
 peer 2::2 connect-interface LoopBack0
 peer 3::3 as-number 100
 peer 3::3 connect-interface LoopBack0 
 #
 ipv6-family unicast
  undo synchronization
  peer 2::2 enable
  peer 3::3 enable
# 
ipv6 route-static 2::2 128 GigabitEthernet<span>0/1/0</span> 2001:DB8:1::2
ipv6 route-static 3::3 128 GigabitEthernet<span>0/1/1</span> 2001:DB8:2::2
#
return</pre>
</li><li><p><span class="keyword">Device</span> B configuration file</p>
<pre class="screen">#
sysname DeviceB
#
router id 2.2.2.2
#
interface LoopBack0
 ipv6 enable
 ipv6 address 2::2/128
#
interface GigabitEthernet<span>0/1/0</span>
 ipv6 enable
 ipv6 address 2001:DB8:1::2/64
#
interface GigabitEthernet<span>0/1/1</span>
 ipv6 enable
 ipv6 address 2001:DB8:3::1/64
#
interface GigabitEthernet<span>0/1/2</span>
 ipv6 enable
 ipv6 address 2001:DB8:4::1/64
#
bgp 100
 peer 1::1 as-number 100
 peer 1::1 connect-interface LoopBack0
 #
 ipv6-family unicast
  import-route static
  peer 1::1 preferred-value 200
#
ipv6 route-static :: 128 NULL0 track nqa-group group1
ipv6 route-static 1::1 128 GigabitEthernet<span>0/1/0</span> 2001:DB8:1::1
#
nqa test-instance user1 test1
 test-type icmp
 destination-address ipv6 2001:DB8:3::1
 interval seconds 5
 timeout 4
 probe-count 2
 frequency 10
 start now
#
nqa test-instance user2 test2
 test-type icmp
 destination-address ipv6 2001:DB8:4::1
 interval seconds 5
 timeout 4
 probe-count 2
 frequency 10
 start now
#
nqa group group1
 nqa test-instance user1 test1
 nqa test-instance user2 test2
 operator or
#
return</pre>
</li><li><p><span class="keyword">Device</span> C configuration file</p>
<pre class="screen">#
sysname DeviceC
#
router id 3.3.3.3
#
interface LoopBack0
 ipv6 enable
 ipv6 address 3::3/128
#
interface GigabitEthernet<span>0/1/0</span>
 ipv6 enable
 ipv6 address 2001:DB8:6::1/64
#
interface GigabitEthernet<span>0/1/1</span>
 ipv6 enable
 ipv6 address 2001:DB8:2::2/64
#
bgp 100
 peer 1::1 as-number 100
 peer 1::1 connect-interface LoopBack0
 #
 ipv6-family unicast
  import-route static
  peer 1::1 preferred-value 100
#
ipv6 route-static :: 128 NULL0
ipv6 route-static 1::1 128 GigabitEthernet<span>0/1/1</span> 2001:DB8:2::1
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_static-route_disjoin_cfg_0050.html">Configuration Examples for IPv6 Static Routes
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_static-route_disjoin_cfg_0042.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_static-route_disjoin_cfg_0047.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>