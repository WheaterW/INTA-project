
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring an OSPF Sham Link">
<meta name="abstract" content="This section describes how to configure an OSPF sham link so that traffic between sites of the same VPN in the same OSPF area is forwarded through the OSPF intra-area route over the MPLS VPN backbone network.">
<meta name="description" content="This section describes how to configure an OSPF sham link so that traffic between sites of the same VPN in the same OSPF area is forwarded through the OSPF intra-area route over the MPLS VPN backbone network.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ospf_cfg_0000.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ospf_cfg_2018.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ospf_cfg_0048.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="ospf,w00800033,w00556928,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="OSPF">
<meta name="featuretype" content="IP Route">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="OSPF">
<meta name="featuretype" content="IP Route">
<meta name="featurename" content="OSPF">
<meta name="featuretype" content="IP Routing Basis">
<meta name="OWNER" content="z00875216">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="z00875216">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172365606">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring an OSPF Sham Link</title>
</head>
<body><a name="EN-US_TASK_0172365606"></a><a name="EN-US_TASK_0172365606"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring an OSPF Sham Link</h1>
<div class="taskbody"><p>This section describes how to configure an OSPF sham link so that traffic between sites of the same VPN in the same OSPF area is forwarded through the OSPF intra-area route over the MPLS VPN backbone network.</p>
<div class="context"><a name="EN-US_TASK_0172365606__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Usage Scenario</h4><p>Generally, BGP peers use BGP extended community attributes to carry routing information over the BGP/MPLS IP VPN backbone network. PEs can use the routing information to exchange inter-area routes between PEs and CEs through OSPF. OSPF sham links are unnumbered P2P links between two PEs over an MPLS VPN backbone network. The source and destination IP addresses of each sham link are IP addresses with a 32-bit mask of loopback interfaces. The loopback interfaces must be bound to a VPN instance, and routes of the two IP addresses are advertised through BGP.</p>
<p>On the BGP/MPLS IP VPN backbone network, if an intra-area OSPF link exists between the network segment where the local CE resides and the network segment where the remote CE resides, the route over this intra-area OSPF link is an intra-area route and has a higher priority than the inter-area route over the BGP/MPLS IP VPN backbone network. In this case, VPN traffic is always forwarded through this intra-area route. To prevent this problem, you can set up an OSPF sham link between the PEs so that the route over the MPLS IP VPN backbone network becomes an OSPF intra-area route and ensure that this route is preferentially selected.</p>
</div></div>
<div class="context"><a name="EN-US_TASK_0172365606__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Pre-configuration Tasks</h4><p>Before configuring an OSPF sham link, complete the following tasks:</p>
<ul><li><p><a href="dc_vrp_mpls-l3vpn-v4_cfg_0154.html">Configure basic BGP/MPLS IP VPN functions</a> and configure OSPF between each PE and its corresponding CE.</p>
</li><li><p>Configure OSPF in the LAN of each CE.</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172365606__1.4.3"></a><a name="1.4.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure endpoint IP addresses for a sham link. </span><p><p>Perform the following steps on PEs at both ends of the sham link:</p>
</p><ol type="a"><li class="substepexpand"><span>Run <span><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=interface+loopback"><b><span class="cmdname">interface loopback</span></b></a> <i><span class="varname">loopback-number</span></i></span></span><p><p>A loopback interface is created, and its view is displayed.</p>
<p>Each VPN instance must have an endpoint IP address of a sham link, and the IP address is a loopback interface IP address with a 32-bit mask in the VPN address space of a PE. Sham links of the same OSPF process can share the same endpoint IP address. The endpoint IP addresses of sham links of different OSPF processes must be different.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=ip+binding+vpn-instance"><b><span class="cmdname">ip binding vpn-instance</span></b></a><i><span class="varname"> vpn-instance-name</span></i></span></span><p><p>A VPN instance is bound to the loopback interface.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ip+address"><b><span class="cmdname">ip address</span></b></a> <i><span class="varname">ip-address</span></i> { <i><span class="varname">mask</span></i> | <i><span class="varname">mask-length</span></i> }</span><p><p>An IP address is configured for the loopback interface.</p>
</p><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The mask of the configured IP address must be 32 bits (255.255.255.255).</p>
</div></div>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span></span><p><p>The configuration is committed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span></span><p><p>Return to the system view.</p>
</p></li></ol>
</li><li><span>Advertise routes of the sham link's endpoint IP addresses.</span><p><p>Perform the following steps on PEs at both ends of the sham link:</p>
</p><ol type="a"><li class="substepexpand"><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <em>as-number</em></span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=ipv4-family"><b><span class="cmdname">ipv4-family</span></b></a><strong><span> vpn-instance</span></strong><i><span class="varname"> vpn-instance-name</span></i></span></span><p><p>The BGP-VPN instance IPv4 address family view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=import-route"><b><span class="cmdname">import-route</span></b></a> <strong><span>direct</span></strong></span></span><p><p>Configure the device to import direct routes (routes of the sham link's endpoint IP addresses in this case) to BGP.</p>
<p>Routes of the sham link's endpoint IP addresses are advertised as VPN IPv4 routes by BGP.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Ensure that routes of the sham link's endpoint IP addresses are not advertised to the remote PE through the VPN OSPF process.</p>
<p>If routes of the sham link's endpoint IP addresses are advertised to the remote PE through the VPN OSPF process, the remote PE has two routes to the endpoint of the sham link. One of the routes is learned through the VPN OSPF process, and the other is learned through the MP-BGP connection. Because the OSPF route has a higher priority than the BGP route, the OSPF route is selected, causing a sham link establishment failure.</p>
</div></div>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span></span><p><p>The configuration is committed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span></span><p><p>Return to the BGP view.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span></span><p><p>Return to the system view.</p>
</p></li></ol>
</li><li><span>Create an OSPF sham link.</span><p><p>Perform the following steps on PEs at both ends of the sham link:</p>
</p><ol type="a"><li class="substepexpand"><span>Run <a href="cmdqueryname=ospf"><b><span class="cmdname">ospf</span></b></a> [ <i><span class="varname">process-id</span></i> ] [ <strong><span>router-id</span></strong> <i><span class="varname">router-id</span></i> | <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i> ] <sup>*</sup></span><p><p>The OSPF multi-instance view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=area"><b><span class="cmdname">area</span></b></a><i><span class="varname"> area-id</span></i></span></span><p><p>The OSPF area view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <strong><a href="cmdqueryname=sham-link"><b><span class="cmdname">sham-link</span></b></a> </strong><em>source-ip-address</em><em>destination-ip-address</em> [ <strong>smart-discover</strong> | <strong>cost</strong><em>cost-interval</em> | <strong>dead</strong><em>dead-interval</em> | <strong>hello</strong><em>hello-interval</em> | <strong>retransmit</strong><em>retransmit-interval</em> | <strong>trans-delay</strong><em>trans-delay-interval</em> | [ <strong>simple</strong> [ <strong>plain</strong><em>SPlainText</em> | <strong>cipher</strong><em>SCipherText</em> | <em>SCipherText</em> ] | { <strong>md5</strong> | <strong>hmac-md5</strong> | <strong>hmac-sha256</strong> } [ <em>key-id</em> { <strong>plain</strong><em>MPlainText</em> | <strong>cipher</strong><em>MCipherText</em> | <em>MCipherText</em> } ] | <strong>authentication-null</strong> | <strong>keychain</strong><em>keychain-name</em> ] ] <sup>*</sup></span><p><p>A sham link is configured.</p>
</p><p><p>The authentication modes at both ends of the sham link must be the same. If packet authentication is configured, only the OSPF packets that pass the authentication are accepted; if the authentication fails, the OSPF neighbor relationship cannot be established.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>To ensure that VPN traffic is forwarded over the MPLS backbone network, ensure that the cost of the sham link is smaller than that of the OSPF route used to forward the traffic over the user network when configuring the sham link using the <a href="cmdqueryname=sham-link"><b><span class="cmdname">sham-link</span></b></a> command. In most cases, you need to change the cost of the interfaces on the user network to ensure that the cost of the OSPF route used to forward the traffic over the user network is greater than that of the sham link.</p>
<p>It is recommended that the password be at least eight characters long and contain at least two of the following character types: uppercase letters, lowercase letters, digits, and special characters.</p>
</div></div>
</p></li></ol>
</li></ol></div>
<div class="postreq"><a name="EN-US_TASK_0172365606__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p>After configuring the OSPF sham link, run the following commands to check the configurations.</p>
<ul><li>Run the <a href="cmdqueryname=display+ip+routing-table+vpn-instance"><b><span class="cmdname">display ip routing-table vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i> command to check the VPN routing table on the PE.</li><li>Run the <a href="cmdqueryname=display+ip+routing-table"><b><span class="cmdname">display ip routing-table</span></b></a> command to check the routing table on the CE.</li><li>Run the <a href="cmdqueryname=tracert"><b><span class="cmdname">tracert</span></b></a> <i><span class="varname">host</span></i> command on the CE to check the nodes through which data is transmitted to the peer end.</li><li>Run the <a href="cmdqueryname=display+ospf"><b><span class="cmdname">display ospf</span></b></a> <i><span class="varname">process-id</span></i> <strong><span>sham-link</span></strong> [ <strong><span>area</span></strong> <i><span class="varname">area-id</span></i> ] command to check the sham link status on the PE.</li><li>Run the <a href="cmdqueryname=display+ospf+routing"><b><span class="cmdname">display ospf routing</span></b></a> command to check OSPF routes on the CE.</li></ul>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ospf_cfg_0000.html">OSPF Configuration
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ospf_cfg_2018.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ospf_cfg_0048.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>