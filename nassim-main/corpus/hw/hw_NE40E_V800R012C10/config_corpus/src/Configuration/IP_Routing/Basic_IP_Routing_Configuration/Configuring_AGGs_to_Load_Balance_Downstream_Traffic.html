
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring AGGs to Load Balance Downstream Traffic">
<meta name="abstract" content="This section describes how to configure access aggregation gateways (AGGs) to load-balance downstream traffic. The load balancing configuration can improve network resource utilization and reliability.">
<meta name="description" content="This section describes how to configure access aggregation gateways (AGGs) to load-balance downstream traffic. The load balancing configuration can improve network resource utilization and reliability.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ip-route_cfg_0000.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ip-route_cfg_0059.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ip-route_cfg_0055.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,w00556928,ip-routevrp,s00526617,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="IP Routing Basis">
<meta name="featuretype" content="IP Route">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="IP Routing Basis">
<meta name="featuretype" content="IP Route">
<meta name="featurename" content="IP Routing Basis">
<meta name="featuretype" content="IP Routing Basis">
<meta name="OWNER" content="z00809835">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="z00809835">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172365353">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring AGGs to Load Balance Downstream Traffic</title>
</head>
<body><a name="EN-US_TASK_0172365353"></a><a name="EN-US_TASK_0172365353"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring AGGs to Load Balance Downstream Traffic</h1>
<div class="taskbody"><p>This section describes how to configure access aggregation gateways (AGGs) to load-balance downstream traffic. The load balancing configuration can improve network resource utilization and reliability.</p>
<div class="context"><a name="EN-US_TASK_0172365353__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Usage Scenario</h4><p><a href="#EN-US_TASK_0172365353__fig_dc_vrp_ip-route_cfg_005201">Figure 1</a> shows a typical networking for an L2VPN accessing an L3VPN. An L2VPN connection is set up between each AGG and CSG, whereas a BGP VPNv4 peer relationship is set up between each AGG and RSG; L3VE sub-interfaces are configured on each AGG, each L3VE sub-interface is bound to one VPN instance, and the CSGs access the L3VPN. To properly use network resources and improve network reliability, the customer requires that AGG1 forward downstream traffic destined for CSG1 and CSG2 and that AGG2 forward downstream traffic destined for CSG3 and CSG4.</p>
<div class="fignone" id="EN-US_TASK_0172365353__fig_dc_vrp_ip-route_cfg_005201"><a name="EN-US_TASK_0172365353__fig_dc_vrp_ip-route_cfg_005201"></a><a name="fig_dc_vrp_ip-route_cfg_005201"></a><span class="figcap"><b>Figure 1 </b>Networking for an L2VPN accessing an L3VPN</span><br><span><img class="vsd" src="images/fig_dc_vrp_ip-route_cfg_005201.png" width="NaN" height="NaN"></span></div>
<div class="p">To meet the preceding requirements, perform the following steps on each AGG:<ol><li>Run the <a href="cmdqueryname=direct-route+cost"><b><span class="cmdname">direct-route cost</span></b></a><span> or <a href="cmdqueryname=direct-route+ipv6+cost"><b><span class="cmdname">direct-route ipv6 cost</span></b></a></span> command to configure a cost for ARP Vlink routes and direct subnet routes on the L3VE sub-interface corresponding to the secondary PW.</li><li>Configure a static route to each base station and allow the static route to inherit the cost of the route to which the static route recurses.<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>After this configuration is complete, each static route recurses to a direct subnet route on an L3VE interface, and the static route inherits the cost of the direct subnet route. Because the <a href="cmdqueryname=direct-route+cost"><b><span class="cmdname">direct-route cost</span></b></a><span> or <a href="cmdqueryname=direct-route+ipv6+cost"><b><span class="cmdname">direct-route ipv6 cost</span></b></a></span> command is not run on the L3VE sub-interface corresponding to the primary PW, the default cost 0 is used as the cost of the generated direct routes. After a static route recurses to one of the direct routes, the cost of the static route also becomes 0.</p>
</div></div>
</li><li>Import the static routes into the BGP routing table.<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>After a static route is imported into the BGP routing table, the cost is changed to the BGP route MED. Because the costs of the static routes are different, the BGP route MED values are also different.</p>
</div></div>
</li></ol>
</div>
<p>After the preceding configurations are complete, each AGG advertises the routes destined for base stations to its VPNv4 peer (RSG). The RSG can then select routes based on MED values. For routes with the same prefix advertised by AGG1 and AGG2, RSGs select the routes advertised by AGG1 as the primary routes to CSG1 and CSG2 and the routes advertised by AGG2 as the primary routes to CSG3 and CSG4. In this manner, downstream traffic is load balanced between AGGs.</p>
</div></div>
<div class="context"><a name="EN-US_TASK_0172365353__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Pre-configuration Tasks</h4><p>Before configuring AGGs to load-balance downstream traffic, configure link-layer protocol parameters and IP addresses for interfaces and ensure that the link layer protocol on each interface is up.</p>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172365353__1.4.3"></a><a name="1.4.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Set a cost for routes to the directly connected network segment.</span><ol type="a"><li class="substepexpand"><span>Run <span><a href="cmdqueryname=interface+virtual-ethernet"><b><span class="cmdname">interface virtual-ethernet</span></b></a> <i><span class="varname">interface-number</span></i></span></span><p><p>A VE interface is created, and the VE interface view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=ve-group"><b><span class="cmdname">ve-group</span></b></a> <i><span class="varname">ve-group-id</span></i> <span><strong><span>l3-access</span></strong></span></span></span><p><p>The VE interface is configured as an L3VE interface that accesses a BGP/MPLS IP VPN and bound to a VE-group.</p>
</p><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>L2VPN access can be implemented only if the L2VE and L3VE interfaces are bound to the same VE-group and reside on the same board.</p>
</div></div>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span></span><p><p>Return to the system view.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=interface+virtual-ethernet"><b><span class="cmdname">interface virtual-ethernet</span></b></a> <i><span class="varname">interface-number.subinterface-number</span></i></span></span><p><p>A VE sub-interface is created, and the VE sub-interface view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=direct-route+cost"><b><span class="cmdname">direct-route cost</span></b></a> <i><span class="varname">cost</span></i><span> or <a href="cmdqueryname=direct-route+ipv6+cost"><b><span class="cmdname">direct-route ipv6 cost</span></b></a> <i><span class="varname">cost</span></i></span></span><p><p>A cost is configured for direct subnet routes on the L3VE sub-interface.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span></span><p><p>Return to the system view.</p>
</p></li></ol>
</li><li><span>Run <a href="cmdqueryname=ip+route-static+vpn-instance"><b><span class="cmdname">ip route-static vpn-instance</span></b></a> <i><span class="varname">vpn-source-name</span></i> <i><span class="varname">destination-address</span></i> { <i><span class="varname">mask</span></i> | <i><span class="varname">mask-length</span></i> } <i><span class="varname">nexthop-address</span></i> [ <strong><span>preference</span></strong> <i><span class="varname">preference</span></i> | <strong><span>tag</span></strong> <i><span class="varname">tag</span></i> ] <sup>*</sup> <strong><span>inherit-cost</span></strong> [ <strong><span>description</span></strong> <i><span class="varname">text</span></i> ]</span><p><p>A static route is configured for the VPN instance, and the static route is configured to inherit the cost of the recursive route.</p>
</p><p><p><i><span class="varname">vpn-source-name</span></i> specifies the name of the VPN instance bound to the L3VE sub-interface. <i><span class="varname">nexthop-address</span></i> specifies the IP address of the interface connecting the base station to the AGG.</p>
</p></li><li><span>Perform either of the following operations to configure BGP to import static routes. After the configuration is complete, the costs of the static routes are changed to the MED values of BGP routes.</span><ul><li><p>To import static routes to the BGP routing table automatically, run the <a href="cmdqueryname=import-route"><b><span class="cmdname">import-route</span></b></a> <strong><span>static</span></strong> command.</p>
</li><li><p>To import static routes to the BGP routing table manually, run the <a href="cmdqueryname=network"><b><span class="cmdname">network</span></b></a> command.</p>
</li></ul>
<p><p>If you run the <a href="cmdqueryname=import-route"><b><span class="cmdname">import-route</span></b></a> <strong><span>static</span></strong> command, some unneeded static routes may be imported to the BGP routing table. To import a static route with a specific prefix and mask to the BGP routing table, run the <a href="cmdqueryname=network"><b><span class="cmdname">network</span></b></a> command.</p>
</p></li><li><span>Run <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span></span><p><p>The configuration is committed.</p>
</p></li></ol></div>
<div class="postreq"><a name="EN-US_TASK_0172365353__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p>After the configuration is complete, if the L3VE sub-interface is up, run the <a href="cmdqueryname=display+ip+routing-table+vpn-instance"><b><span class="cmdname">display ip routing-table vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i> [ <i><span class="varname">ip-address</span></i> ] [ <strong><span>verbose</span></strong> ]<span> or <a href="cmdqueryname=display+ipv6+routing-table+vpn-instance"><b><span class="cmdname">display ipv6 routing-table vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i> [ <i><span class="varname">ip-address</span></i> ] [ <strong><span>verbose</span></strong> ]</span> command on the AGG. The command output shows that the cost of direct subnet routes on the L3VE sub-interface is changed to the configured cost.</p>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ip-route_cfg_0000.html">Basic IP Routing Configuration
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ip-route_cfg_0059.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ip-route_cfg_0055.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>