
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring BGP-LS">
<meta name="abstract" content="BGP-LS provides a simple and efficient method of collecting topology information.">
<meta name="description" content="BGP-LS provides a simple and efficient method of collecting topology information.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_3000.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_4096.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_5001.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Route">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Route">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing Basis">
<meta name="OWNER" content="l00425560">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00615954">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172366280">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring BGP-LS</title>
</head>
<body><a name="EN-US_TASK_0172366280"></a><a name="EN-US_TASK_0172366280"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring BGP-LS</h1>
<div class="taskbody"><p>BGP-LS provides a simple and efficient method of collecting topology information.</p>
<div class="context"><a name="EN-US_TASK_0172366280__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Usage Scenario</h4><div class="p">Without BGP-LS, the <span class="keyword">Router</span> uses an IGP (OSPF, OSPFv3, or IS-IS) to collect network topology information and report the topology information of each area to the controller separately. This method has the following disadvantages:<ul><li>The controller must have high computing capabilities and support the IGP and its algorithm.</li><li>The controller cannot gain the complete inter-area topology information and therefore is unable to calculate optimal E2E paths.</li><li>Different IGPs report topology information separately to the controller, which complicates the controller's analysis and processing.</li></ul>
</div>
<div class="p">With powerful route selection capabilities of BGP, BGP-LS has the following advantages:<ul><li>Reduces computing capability requirements and spares the necessity of IGPs on the controller.</li><li>Facilitates route selection and calculation on the controller by using BGP to summarize process or AS topology information and report the complete information to the controller.</li><li>Requires only one routing protocol (BGP) to report topology information to the controller.</li></ul>
</div>
<p>BGP-LS needs to be deployed on the devices connected to the controller.</p>
</div></div>
<div class="context"><a name="EN-US_TASK_0172366280__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Pre-configuration Tasks</h4><p>Before configuring BGP-LS, complete the following tasks:</p>
<ul><li><a href="dc_vrp_isis_cfg_1000.html">Configure basic IPv4 IS-IS functions</a> or <a href="dc_vrp_ospf_cfg_0003.html">basic OSPF functions</a> or <a href="dc_vrp_ospfv3_cfg_2000.html">basic OSPFv3 functions</a>.</li></ul>
</div></div>
<div class="context"><a name="EN-US_TASK_0172366280__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Procedure</h4><ol><li>Enable IGP topology advertisement to BGP. You can determine to enable IS-IS topology advertisement to BGP or OSPF topology advertisement to BGP based on network configurations.<ul><li>Enable IS-IS topology advertisement to BGP.<ol type="a"><li>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a><p>The system view is displayed.</p>
</li><li>Run <a href="cmdqueryname=isis"><b><span class="cmdname">isis</span></b></a> [ <i><span class="varname">process-id</span></i> ]<p>An IS-IS process is configured.</p>
</li><li>Run <a href="cmdqueryname=bgp-ls+enable+level-1+level-2+level-1-2+level-1"><b><span class="cmdname">bgp-ls enable</span></b></a> [ <strong><span>level-1</span></strong> | <strong><span>level-2</span></strong> | <strong><span>level-1-2</span></strong> ] [ <strong><span>exclude-prefix</span></strong> ]<p>IS-IS topology advertisement is enabled.</p>
<p>To enable IS-IS to advertise topology information of Level-1 areas and filter the route prefixes leaked from Level-2 areas to Level-1 areas, run the <a href="cmdqueryname=bgp-ls+enable+level-1+level-2-leaking-route-ignore"><b><span class="cmdname">bgp-ls enable</span></b></a> <strong><span>level-1</span></strong> <strong><span>level-2-leaking-route-ignore</span></strong> command.</p>
</li><li>(Optional) Run <a href="cmdqueryname=bgp-ls+identifier"><b><span class="cmdname">bgp-ls identifier</span></b></a> <i><span class="varname">identifier-value</span></i><p>A BGP-LS identifier is configured for IS-IS.</p>
</li><li><p>(Optional) Run <a href="cmdqueryname=bgp-ls+report-exclude+metric-delay-average"><b><span class="cmdname">bgp-ls report-exclude</span></b></a> { <strong><span>metric-delay-average</span></strong> | <strong><span>metric-delay-variation</span></strong> | <strong><span>link-msd</span></strong> } <sup>*</sup></p>
<p>Filtering of IS-IS topology information to be advertised is configured.</p>
</li><li>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a><p>The configuration is committed.</p>
</li></ol>
</li></ul>
<ul><li id="EN-US_TASK_0172366280__li1859352118214038">Enable OSPF topology advertisement.<ol type="a" id="EN-US_TASK_0172366280__ol2106748974214038"><li id="EN-US_TASK_0172366280__li457080826214038">Run <a href="cmdqueryname=system-view"><b><span class="cmdname" id="EN-US_TASK_0172366280__cmdname1835435874214038">system-view</span></b></a><p id="EN-US_TASK_0172366280__p26833589229">The system view is displayed.</p>
</li><li id="EN-US_TASK_0172366280__li1604452557214038">Run <a href="cmdqueryname=ospf+router-id+vpn-instance"><b><span class="cmdname" id="EN-US_TASK_0172366280__cmdname1134789113214038">ospf</span></b></a> [ <i><span class="varname" id="EN-US_TASK_0172366280__varname755443878214038">process-id</span></i> | <strong><span id="EN-US_TASK_0172366280__cmdparmname1796274236214038">router-id</span></strong> <i><span class="varname" id="EN-US_TASK_0172366280__varname1811224544214038">router-id</span></i> | <strong><span id="EN-US_TASK_0172366280__cmdparmname293501177214038">vpn-instance</span></strong> <i><span class="varname" id="EN-US_TASK_0172366280__varname884132924214038">vpn-instance-name</span></i> ] <sup id="EN-US_TASK_0172366280__sup1937581778214038">*</sup><p id="EN-US_TASK_0172366280__p12165921142318">An OSPF process is configured.</p>
</li><li id="EN-US_TASK_0172366280__li197936638214038">Run <a href="cmdqueryname=bgp-ls+enable"><b><span class="cmdname" id="EN-US_TASK_0172366280__cmdname1191884753214038">bgp-ls enable</span></b></a><p id="EN-US_TASK_0172366280__p17741222411">OSPF topology advertisement is enabled.</p>
</li><li id="EN-US_TASK_0172366280__li431639421214038">(Optional) Run <a href="cmdqueryname=bgp-ls+identifier"><b><span class="cmdname" id="EN-US_TASK_0172366280__cmdname1532738411214038">bgp-ls identifier</span></b></a> <i><span class="varname" id="EN-US_TASK_0172366280__varname1899144903214038">identifier-value</span></i><p id="EN-US_TASK_0172366280__p66360589249">A BGP-LS identifier is configured for OSPF.</p>
</li><li id="EN-US_TASK_0172366280__li5809234119"><p id="EN-US_TASK_0172366280__p115281150162111"><a name="EN-US_TASK_0172366280__li5809234119"></a><a name="li5809234119"></a>(Optional) Run <a href="cmdqueryname=bgp-ls+report-exclude+metric-delay-average"><b><span class="cmdname" id="EN-US_TASK_0172366280__cmdname950051120117">bgp-ls report-exclude</span></b></a> {<strong><span id="EN-US_TASK_0172366280__cmdparmname1068819567121"> metric-delay-average</span></strong> | <strong><span id="EN-US_TASK_0172366280__cmdparmname1725312081320">metric-delay-variation</span></strong> } <sup id="EN-US_TASK_0172366280__sup18764368172">*</sup></p>
<p id="EN-US_TASK_0172366280__li5809234119p0">Filtering of the OSPF topology information to be advertised is configured.</p>
</li><li id="EN-US_TASK_0172366280__li650035354214038">Run <a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0172366280__cmdname1460331982214038">commit</span></b></a><p id="EN-US_TASK_0172366280__p149481256267">The configuration is committed.</p>
</li></ol>
</li><li id="EN-US_TASK_0172366280__li353993432414">Enable OSPFv3 topology advertisement.<ol type="a" id="EN-US_TASK_0172366280__ol5540234132418"><li id="EN-US_TASK_0172366280__li166171640172219">Run <a href="cmdqueryname=system-view"><b><span class="cmdname" id="EN-US_TASK_0172366280__cmdname8617194018222">system-view</span></b></a><p id="EN-US_TASK_0172366280__p1066234934712">The system view is displayed.</p>
</li><li id="EN-US_TASK_0172366280__li1618104016224">Run <a href="cmdqueryname=ospfv3+vpn-instance"><b><span class="cmdname" id="EN-US_TASK_0172366280__cmdname661844052218">ospfv3</span></b></a> [ <i><span class="varname" id="EN-US_TASK_0172366280__varname36181740122210">process-id</span></i> ] [ <strong><span id="EN-US_TASK_0172366280__cmdparmname9191031112319">vpn-instance</span></strong> <i><span class="varname" id="EN-US_TASK_0172366280__varname2197312239">vpn-instance-name</span></i> ]<p id="EN-US_TASK_0172366280__p19134857164714">An OSPFv3 process is created.</p>
</li><li id="EN-US_TASK_0172366280__li061844011225">Run <a href="cmdqueryname=bgp-ls+enable"><b><span class="cmdname" id="EN-US_TASK_0172366280__cmdname26181040112213">bgp-ls enable</span></b></a><p id="EN-US_TASK_0172366280__p17774037483">OSPFv3 topology advertisement is enabled.</p>
</li><li id="EN-US_TASK_0172366280__li1661874052219">(Optional) Run <a href="cmdqueryname=bgp-ls+identifier"><b><span class="cmdname" id="EN-US_TASK_0172366280__cmdname1461844082213">bgp-ls identifier</span></b></a> <i><span class="varname" id="EN-US_TASK_0172366280__varname15618540182217">identifier-value</span></i><p id="EN-US_TASK_0172366280__p1167216101485">A BGP-LS identifier is configured for OSPFv3.</p>
</li><li id="EN-US_TASK_0172366280__li17636651005"><p id="EN-US_TASK_0172366280__p19134524132214"><a name="EN-US_TASK_0172366280__li17636651005"></a><a name="li17636651005"></a>(Optional) Run <a href="cmdqueryname=bgp-ls+report-exclude+metric-delay+metric-delay-average"><b><span class="cmdname" id="EN-US_TASK_0172366280__cmdname9105112717212">bgp-ls report-exclude</span></b></a> {<strong><span id="EN-US_TASK_0172366280__cmdparmname2011318312218"> metric-delay</span></strong> | <strong><span id="EN-US_TASK_0172366280__cmdparmname39913345213">metric-delay-average</span></strong> | <strong><span id="EN-US_TASK_0172366280__cmdparmname981893818220">metric-delay-variation</span></strong> } <sup id="EN-US_TASK_0172366280__sup1850910582219">*</sup></p>
<p id="EN-US_TASK_0172366280__p943111710463">Filtering of the OSPFv3 topology information to be advertised is configured.</p>
<p id="EN-US_TASK_0172366280__p12589195719313">After BGP-LS is configured, the device collects OSPFv3 topology information and reports it to the controller. The collected information includes the maximum, minimum, and average delays and delay variation. If you want the device not to report some of the information, you can configure the topology advertisement filtering function.</p>
</li><li id="EN-US_TASK_0172366280__li454023462414">Run <a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0172366280__cmdname15618134082218">commit</span></b></a><p id="EN-US_TASK_0172366280__p11270202213489">The configuration is committed.</p>
</li></ol>
</li></ul>
</li><li><p>Enable BGP-LS.</p>
<ol type="a"><li>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a><p>The system view is displayed.</p>
</li><li>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i><p>BGP is enabled, and the BGP view is displayed.</p>
</li><li><p>Run <a href="cmdqueryname=peer+as-number"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">group-name</span></i> | <i><span class="varname">ipv4-address</span></i> } <strong><span>as-number</span></strong> <i><span class="varname">as-number</span></i></p>
<p>The IP address and AS number of a BGP peer are specified.</p>
</li><li>Run <a href="cmdqueryname=link-state-family+unicast"><b><span class="cmdname">link-state-family unicast</span></b></a><p>BGP-LS is enabled, and the BGP-LS address family view is displayed.</p>
</li><li>Run <a href="cmdqueryname=peer+enable"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">group-name</span></i> | <i><span class="varname">ipv4-address</span></i> } <strong><span>enable</span></strong><p>BGP-LS route exchange with the specified peer or peer group is enabled.</p>
</li><li><p>(Optional) Run <a href="cmdqueryname=domain+identifier"><b><span class="cmdname">domain identifier</span></b></a> <i><span class="varname">domain-id</span></i></p>
<p>A BGP-LS domain ID is configured.</p>
<p>A BGP-LS domain ID identifies a device with BGP-LS enabled. If no BGP-LS domain ID is configured, a BGP router ID is used as the BGP-LS domain ID by default. The same BGP-LS domain ID can be configured for multiple devices so that the controller calculates routes based on the combined topology information reported by the devices.</p>
</li><li><p>(Optional) Run <a href="cmdqueryname=domain+as"><b><span class="cmdname">domain as</span></b></a> <i><span class="varname">domain-asNum</span></i></p>
<p>A BGP-LS domain AS number is configured.</p>
<p>Two devices with different BGP AS numbers must have the same BGP-LS domain AS number configured using the <a href="cmdqueryname=domain+as"><b><span class="cmdname">domain as</span></b></a> command so that the controller can obtain combined topology information about the two ASs for route calculation.</p>
</li><li><p>(Optional) Run <a href="cmdqueryname=peer+reflect-client"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">group-name</span></i> | <i><span class="varname">ipv4-address</span></i> } <strong><span>reflect-client</span></strong></p>
<p>An RR is configured, and a client is specified.</p>
<p>The <span class="keyword">Router</span> on which the <a href="cmdqueryname=peer+reflect-client"><b><span class="cmdname">peer reflect-client</span></b></a> command is run functions as the RR, and the specified peer or peer group functions as a client.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>If the clients of an RR are fully meshed, you can run the <a href="cmdqueryname=undo+reflect+between-clients"><b><span class="cmdname">undo reflect between-clients</span></b></a> command to disable route reflection among these clients through the RR to reduce bandwidth consumption.</p>
<p>If a cluster has multiple RRs configured, you can run the <a href="cmdqueryname=reflector+cluster-id"><b><span class="cmdname">reflector cluster-id</span></b></a> <i><span class="varname">cluster-id</span></i> command to configure the same cluster ID for all the RRs. This command is applicable only to RRs.</p>
</div></div>
</li><li><p>(Optional) Run <a href="cmdqueryname=peer+route-limit+alert-only+idle-forever+idle-timeout"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">group-name</span></i> | <i><span class="varname">ipv4-address</span></i> } <strong><span>route-limit</span></strong> <i><span class="varname">limit</span></i> [ <i><span class="varname">percentage</span></i> ] [ <strong><span>alert-only</span></strong> | <strong><span>idle-forever</span></strong> | <strong><span>idle-timeout</span></strong> <i><span class="varname">minutes</span></i> ]</p>
<p>The maximum number of BGP-LS routes that the local device can accept from a specified peer is set.</p>
<p>Generally, a BGP-LS routing table contains a large number of routes. If a large number of routes are received from peers, excessive system resources are consumed. To prevent this problem, run this command to set the maximum number of routes that a BGP device is allowed to accept from a peer. If <strong><span>idle-forever</span></strong> is configured, the peer relationship will be interrupted and will not be automatically re-established after the number of received routes exceeds the threshold. Therefore, configuring <strong><span>idle-forever</span></strong> is not recommended.</p>
</li><li><p>(Optional) Run <a href="cmdqueryname=peer+route-policy+import+export"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">group-name</span></i> | <i><span class="varname">ipv4-address</span></i> } <strong><span>route-policy</span></strong> <i><span class="varname">route-policy-name</span></i> { <strong><span>import</span></strong> | <strong><span>export</span></strong> }</p>
<p>A route-policy is specified for the BGP-LS routes to be received from or advertised to a specified BGP peer or peer group.</p>
<p>After a route-policy is created, you can run the <a href="cmdqueryname=peer+route-policy"><b><span class="cmdname">peer route-policy</span></b></a> command to use the route-policy to filter the BGP-LS routes to be received from or advertised to a specified BGP peer or peer group. The command configuration ensures that only desired routes are accepted or advertised, which helps manage routes and reduces the BGP-LS routing table size and system resource consumption.</p>
</li><li><p>(Optional) Run <a href="cmdqueryname=peer+route-update-interval"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">group-name</span></i> | <i><span class="varname">ipv4-address</span></i> } <strong><span>route-update-interval</span></strong> <i><span class="varname">interval</span></i></p>
<p>An interval at which the device sends Update messages carrying the same route prefix to a specified peer or peer group is set.</p>
<p>When BGP-LS routes change, the <span class="keyword">Router</span> sends Update messages to notify its peers. If a route changes frequently, to prevent the <span class="keyword">Router</span> from sending Update messages for every change, run this command to set an interval at which the <span class="keyword">Router</span> sends Update messages carrying the same route prefix to a specified peer or peer group.</p>
</li><li><p>(Optional) Run <a href="cmdqueryname=peer+allow-as-loop"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">group-name</span></i> | <i><span class="varname">ipv4-address</span></i> } <strong><span>allow-as-loop</span></strong> <i><span class="varname">num</span></i></p>
<p>The maximum number of AS number repetitions in the AS_Path attribute allowed by a peer or peer group is configured.</p>
</li><li>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a><p>The configuration is committed.</p>
</li></ol>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172366280__1.4.4"></a><a name="1.4.4"></a>
<div class="p"><h4 class="sectiontitle">Verifying the Configuration</h4><p>After the configuration is complete, verify it.</p>
<ul><li>Run the <a href="cmdqueryname=display+bgp+link-state+unicast+peer"><b><span class="cmdname">display bgp link-state unicast peer</span></b></a> command to check information about BGP-LS peers and their status.</li><li>Run the <a href="cmdqueryname=display+bgp+link-state+unicast+routing-table"><b><span class="cmdname">display bgp link-state unicast routing-table</span></b></a> command to check BGP-LS route information.</li><li>Run the <a href="cmdqueryname=display+bgp+link-state+unicast+routing-table+statistics"><b><span class="cmdname">display bgp link-state unicast routing-table statistics</span></b></a> command to check BGP-LS route statistics.</li></ul>
</div></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_3000.html">BGP Configuration
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_4096.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_5001.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>