
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Setting the AS_Path Attribute">
<meta name="abstract" content="The AS_Path attribute is used to prevent routing loops and control route selection.">
<meta name="description" content="The AS_Path attribute is used to prevent routing loops and control route selection.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_3010.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_4015.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_4100.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Route">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Route">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Route">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing Basis">
<meta name="OWNER" content="l00425560">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00615954">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172366171">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Setting the AS_Path Attribute</title>
</head>
<body><a name="EN-US_TASK_0172366171"></a><a name="EN-US_TASK_0172366171"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Setting the AS_Path Attribute</h1>
<div class="taskbody"><p>The AS_Path attribute is used to prevent routing loops and control route selection.</p>
<div class="steps-unordered"><a name="EN-US_TASK_0172366171__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Procedure</h4>
<ul><li><span>Enable a BGP device to accept the routes that contain the local AS number if the number of repetitions in each route is within a configured limit.</span><p><p>Generally, BGP uses AS numbers to detect routing loops. In the Hub and Spoke networking, if EBGP runs between a Hub-PE and a Hub-CE at a Hub site, a route sent from the Hub-PE to the Hub-CE carries the AS number of the Hub-PE. If the Hub-CE sends an Update message that contains the AS number of the Hub-PE to the Hub-PE, the Hub-PE will deny it.</p>
<p>To ensure proper route transmission in the Hub and Spoke networking, configure all the BGP peers on the path, along which the Hub-CE advertises VPN routes to the Spoke-CE, to allow the routes with the local AS number repeated once in the AS_Path attribute to pass through.</p>
</p><ol><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ipv4-family+unicast"><b><span class="cmdname">ipv4-family</span></b></a> <strong><span>unicast</span></strong></span><p><p>The IPv4 unicast address family view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer+allow-as-loop"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <a href="cmdqueryname=peer+allow-as-loop"><b><span class="cmdname">allow-as-loop</span></b></a> [ <i><span class="varname">number</span></i> ]</span><p><p>Repetitions of the local AS number are allowed.</p>
</p><p><p>In most cases, a BGP device checks the AS_Path attribute of a route received from a peer. If the AS_Path carries the local AS number, the BGP device discards this route to avoid routing loops.</p>
<p>In some special applications, you can use this command to allow the AS_Path attribute of a route received from a peer to contain the local AS number and set the allowed repetition count of the local AS number.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li><span>Disable the device from comparing AS_Path attributes during route selection.</span><ol><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ipv4-family+unicast"><b><span class="cmdname">ipv4-family</span></b></a> <strong><span>unicast</span></strong></span><p><p>The BGP-IPv4 unicast address family view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bestroute+as-path-ignore"><b><span class="cmdname">bestroute as-path-ignore</span></b></a></span><p><p>The local device is disabled from comparing AS_Path attributes during route selection.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li><span>Configure a fake AS number.</span><ol><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer+fake-as"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <a href="cmdqueryname=peer+fake-as"><b><span class="cmdname">fake-as</span></b></a> <i><span class="varname">fake-as-value</span></i> [ <strong><span>dual-as</span></strong> ] [ <strong><span>prepend-global-as</span></strong> ] [ <strong><span>prepend-fake-as</span></strong> ]</span><p><p>A fake AS number is configured.</p>
</p><p><p>This command hides the actual AS number. In this case, EBGP peers in other ASs can learn only this fake AS number of the local end and set the fake AS number as the AS number of the local peer when establishing peer relationships with the local end.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The <a href="cmdqueryname=peer+fake-as"><b><span class="cmdname">peer fake-as</span></b></a> command is applicable only to EBGP peers.</p>
</div></div>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li><span>Substitute the AS numbers in the AS_Path attribute.</span><p><p>In a BGP/MPLS IP VPN scenario, if the ASs to which two VPN sites belong use private AS numbers, the AS numbers of the two VPN sites may be the same. If a CE in a VPN site sends a VPN route to the connected PE (EBGP peer) and this route is advertised to the remote PE and then to the remote CE, the remote CE will discard the route due to AS number repetition. As a result, different sites of the same VPN cannot communicate with each other. In this case, you need to run the <a href="cmdqueryname=peer+substitute-as"><b><span class="cmdname">peer substitute-as</span></b></a> command on the PE to enable AS number substitution. That is, the PE replaces the AS number of the VPN site where the CE resides in the received VPN route with the local AS number. This prevents the remote CE from discarding routes due to AS number repetition.</p>
<p>In a BGP public network scenario, when two devices with the same AS number learn a BGP route from each other through the same EBGP peer, the route may be discarded because the AS_Path attribute contains duplicate AS numbers. To prevent this problem, run the <a href="cmdqueryname=peer+substitute-as"><b><span class="cmdname">peer substitute-as</span></b></a> command on the EBGP peer shared by the two devices to enable AS number substitution.</p>
<div class="notice"><span class="noticetitle"><img src="../../../../public_sys-resources/notice_3.0-en-us.png"> </span><div class="noticebody"><p>Exercise caution when running the <a href="cmdqueryname=peer+substitute-as"><b><span class="cmdname">peer substitute-as</span></b></a> command because improper use of the command may cause routing loops.</p>
</div></div>
</p><ol><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ipv4-family+unicast"><b><span class="cmdname">ipv4-family</span></b></a> <strong><span>unicast</span></strong></span><p><p>The BGP-IPv4 unicast address family view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer+substitute-as"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <a href="cmdqueryname=peer+substitute-as"><b><span class="cmdname">substitute-as</span></b></a></span><p><p>AS number substitution is enabled on the device.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li><span>Configure the AS_Path attribute to carry only public AS numbers.</span><ol><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ipv4-family+unicast"><b><span class="cmdname">ipv4-family</span></b></a> <strong><span>unicast</span></strong></span><p><p>The IPv4 unicast address family view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer+public-as-only"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i>  } <a href="cmdqueryname=peer+public-as-only"><b><span class="cmdname">public-as-only</span></b></a><span> [ <strong><span>force</span></strong></span><span> [ <strong><span>replace</span></strong> ] [ <strong><span>include-peer-as</span></strong> ] | <strong><span>limited</span></strong> [ <strong><span>replace</span></strong> ] [ <strong><span>include-peer-as</span></strong> ]</span> ]</span><p><p>The AS_Path attribute in the BGP Update messages to be sent is configured to carry only public AS numbers. You can also run the <a href="cmdqueryname=peer+public-as-only"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <a href="cmdqueryname=peer+public-as-only"><b><span class="cmdname">public-as-only</span></b></a> <strong><span>import</span></strong><span> [ <strong><span>force</span></strong></span> ] command to configure the AS_Path attribute not to carry private AS numbers in accepted BGP Update messages.</p>
</p><p><p>Generally, AS numbers range from 1 to 4294967295, including public AS numbers, private AS numbers, and reserved AS numbers. Private AS numbers range from 64512 to 65534 and from 4200000000 to 4294967294 (or from 64086.59904 to 65535.65534). The AS numbers 65535 and 4294967295 are reserved for special applications. Other AS numbers are public AS numbers.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>If the 4-byte private AS number capability is disabled using the <a href="cmdqueryname=private-4-byte-as+disable"><b><span class="cmdname">private-4-byte-as disable</span></b></a> command, private AS numbers range from 64512 to 65534; the AS number 65535 is reserved, and others are public AS numbers.</p>
</div></div>
<p>Public AS numbers can be used on the Internet, and are assigned and managed by the Internet Assigned Number Authority (IANA). Private AS numbers cannot be advertised to the Internet, and are used only within ASs.</p>
<p>Generally, BGP routes to be advertised to peers carry either public or private AS numbers, or both. In certain cases, private AS numbers do not need to be advertised. In this case, you can run this command to configure the AS_Path attribute to carry only public AS numbers.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li><span>Set the maximum number of AS numbers in the AS_Path attribute.</span><ol><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=as-path-limit"><b><span class="cmdname">as-path-limit</span></b></a> <i><span class="varname">limit</span></i></span><p><p>The maximum number of AS numbers allowed in the AS_Path attribute is set.</p>
<p>After the <a href="cmdqueryname=as-path-limit"><b><span class="cmdname">as-path-limit</span></b></a> command is run, a device checks whether the number of AS numbers in the AS_Path attribute of a received route exceeds the maximum value. If the number of AS numbers exceeds the maximum value, the device discards the route. Therefore, if the maximum number of AS numbers allowed in the AS_Path attribute is set to an excessively small value, routes may be easily discarded.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li><span>Disable the BGP device from checking the first AS number contained in the AS_Path attribute of each Update message received from an EBGP peer.</span><ol><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=undo+check-first-as"><b><span class="cmdname">undo check-first-as</span></b></a></span><p><p>The BGP device is disabled from checking the first AS number in the AS_Path attribute that is carried in each Update message received from an EBGP peer.</p>
</p><p><div class="notice"><span class="noticetitle"><img src="../../../../public_sys-resources/notice_3.0-en-us.png"> </span><div class="noticebody"><p>Exercise caution when running the <a href="cmdqueryname=undo+check-first-as"><b><span class="cmdname">undo check-first-as</span></b></a> command because use of this command may cause routing loops.</p>
</div></div>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p><p><p>After the check function is enabled, to enable the device to recheck received routes, run the <a href="cmdqueryname=refresh+bgp"><b><span class="cmdname">refresh bgp</span></b></a> command.</p>
</p></li></ol>
</li><li><span>Enable BGP to check, or disable BGP from checking, the first AS number in the AS_Path attribute of each Update message received from a specified EBGP peer or peer group.</span><ol><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer+check-first-as"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">group-name</span></i> | <i><span class="varname">ipv4-address</span></i> } <a href="cmdqueryname=peer+check-first-as"><b><span class="cmdname">check-first-as</span></b></a> { <strong><span>enable</span></strong> | <strong><span>disable</span></strong> }</span><p><p>The device is enabled to check or disabled from checking the first AS number in the AS_Path attribute contained in each Update message received from a specified EBGP peer or peer group.</p>
</p><p><p>If the <a href="cmdqueryname=peer+check-first-as"><b><span class="cmdname">peer check-first-as enable</span></b></a> command is run, BGP checks whether the first AS number in the AS_Path attribute of each Update message received from the specified EBGP peer or peer group is the same as the number of the AS where the EBGP peer or peer group resides. The two AS numbers must be the same. If the AS numbers are different, the Update message is rejected. If the <a href="cmdqueryname=peer+check-first-as"><b><span class="cmdname">peer check-first-as disable</span></b></a> command is run, BGP accepts Update messages received from the specified EBGP peer or peer group, regardless of whether the first AS number in the AS_Path attribute of the messages is the same as the number of the AS where the EBGP peer or peer group resides. If the undo command is run, the related configuration for the specified EBGP peer or peer group is deleted, and the default configuration is used.</p>
<p>The check on the first AS number in the AS_Path attribute of each received Update message can be configured for a specified EBGP peer, the peer group that the EBGP peer belongs to, or the entire BGP process. The configuration takes effect in descending order of priority as follows: EBGP peer &gt; peer group &gt; entire BGP process.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p><p><p>After the check function is enabled, to enable the device to recheck received routes, run the <a href="cmdqueryname=refresh+bgp"><b><span class="cmdname">refresh bgp</span></b></a> command.</p>
</p></li></ol>
</li></ul></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_3010.html">Configuring BGP Route Attributes
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_4015.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_4100.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>