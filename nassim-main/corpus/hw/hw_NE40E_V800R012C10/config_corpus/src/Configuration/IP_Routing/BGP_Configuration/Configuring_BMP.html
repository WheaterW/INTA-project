
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring BMP">
<meta name="abstract" content="BGP Monitoring Protocol (BMP) allows the BGP running status and route processing records and on network devices to be monitored in real time.">
<meta name="description" content="BGP Monitoring Protocol (BMP) allows the BGP running status and route processing records and on network devices to be monitored in real time.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_3000.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_3091.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_4051.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,bgpvrp,w00556928,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Route">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Route">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing Basis">
<meta name="OWNER" content="w00604599">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00615954">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172366278">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring BMP</title>
</head>
<body><a name="EN-US_TASK_0172366278"></a><a name="EN-US_TASK_0172366278"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring BMP</h1>
<div class="taskbody"><p>BGP Monitoring Protocol (BMP) allows the BGP running status and route processing records and  on network devices to be monitored in real time.</p>
<div class="context"><a name="EN-US_TASK_0172366278__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Usage Scenario</h4><p>BMP is mainly used in networking scenarios where monitoring servers exist and need to monitor the BGP running status and route processing records and  on network devices in real time. The running status includes the establishment and disconnection of peer relationships and update of routing information. BGP route processing records indicate the process of processing BGP routes on a device, for example, processing of the routes that match an import or export policy. Without BMP, only manual query can be used to obtain the BGP running status and processing records. The emergence of BMP eliminates this restriction and significantly improves network monitoring efficiency.</p>
</div></div>
<div class="context"><a name="EN-US_TASK_0172366278__1.4.2"></a><a name="1.4.2"></a>
<div class="p" id="EN-US_TASK_0172366278__context100135211214038"><h4 class="sectiontitle">Pre-configuration Tasks</h4><p id="EN-US_TASK_0172366278__p796120797214038">Before configuring BMP, complete the following tasks:</p>
<ul id="EN-US_TASK_0172366278__ul1572290157214038"><li id="EN-US_TASK_0172366278__li1226323950214038"><a href="dc_vrp_bgp_cfg_3004.html">Configure basic BGP functions.</a></li></ul>
</div></div>
<div class="steps-unordered"><a name="EN-US_TASK_0172366278__1.4.3"></a><a name="1.4.3"></a><h4 class="sectiontitle">Procedure</h4>
<ul><li><span>Configure BMP to report the BGP running status to a monitoring server.</span><ol><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bmp"><b><span class="cmdname">bmp</span></b></a></span><p><p>BMP is enabled, and the BMP view is displayed.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=statistics-timer"><b><span class="cmdname">statistics-timer</span></b></a> <i><span class="varname">time</span></i></span><p><p>The interval at which BMP sends BGP running statistics to a monitoring server is configured.</p>
<p>Configure the interval based on BGP stability requirements. In the case of high BGP stability requirements, configure a short interval. However, if the device frequently sends BGP running statistics, a large number of bandwidth resources will be consumed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bmp-session+vpn-instance+alias"><b><span class="cmdname">bmp-session</span></b></a> [ <strong><span>vpn-instance</span></strong> <i><span class="varname">vrf-name</span></i> ] <i><span class="varname">ipv4-address</span></i> [ <strong><span>alias</span></strong> <i><span class="varname">alias-name</span></i> ]</span><p><p>An IPv4 session address is set for the TCP connection between the BMP device and the monitoring server.</p>
</p><p><p><strong><span>alias</span></strong> <i><span class="varname">alias-name</span></i> specifies an alias for a BMP session. If the device needs to establish TCP connections with monitoring servers that have the same destination IP address but different destination port numbers, specify different values for the <strong><span>alias</span></strong> <i><span class="varname">alias-name</span></i> parameter to differentiate the connections.</p>
</p></li><li class="substepexpand"><span>Configure the BMP device to send statistics about routes of specific types to the monitoring server.</span><p><ul><li>Configure the BMP device to send statistics about RIB-in routes (all received routes or only accepted routes) of BGP peers in a specified address family to the monitoring server.<ol type="a"><li>Run one of the following commands to enter the BMP-Monitor view:<ul><li><a href="cmdqueryname=monitor+public"><b><span class="cmdname">monitor public</span></b></a>: displays the BMP-Monitor view and allows the BGP running status of all BGP peers in the public network address family to be monitored.</li><li><a href="cmdqueryname=monitor+all-vpn-instance"><b><span class="cmdname">monitor all-vpn-instance</span></b></a>: displays the BMP-Monitor view and allows the BGP running status of BGP peers in all VPN instance address families to be monitored.</li><li><a href="cmdqueryname=monitor+peer"><b><span class="cmdname">monitor peer</span></b></a>: displays the BMP-Monitor view and allows the BGP running status of a specified BGP peer in the public address family to be monitored.</li><li><a href="cmdqueryname=monitor+vpn-instance"><b><span class="cmdname">monitor vpn-instance</span></b></a>: displays the BMP-Monitor view and allows the BGP running status of all BGP peers in a specified VPN instance address family to be monitored.</li><li><a href="cmdqueryname=monitor+vpn-instance+peer"><b><span class="cmdname">monitor vpn-instance peer</span></b></a>: displays the BMP-Monitor view and allows the BGP running status of a specified BGP peer in a specified VPN instance address family to be monitored.</li></ul>
</li><li><p>Run <a href="cmdqueryname=route-mode+ipv4-family+unicast+ipv4-family+vpnv4+adj-rib-in"><b><span class="cmdname">route-mode</span></b></a> { <strong><span>ipv4-family</span></strong> <strong><span>unicast</span></strong><span> | <strong><span>ipv4-family</span></strong> <strong><span>labeled-unicast</span></strong></span> | <strong><span>ipv4-family</span></strong> <strong><span>vpnv4</span></strong> } <strong><span>adj-rib-in</span></strong> { <strong><span>pre-policy</span></strong> | <strong><span>post-policy</span></strong> }</p>
<p>The BMP device is configured to send statistics about RIB-in routes of BGP peers in a specified address family and the BGP running status of these peers to the monitoring server.</p>
<p>To configure the device to send statistics about all received routes to the monitoring server, specify <strong><span>pre-policy</span></strong> in the command. To configure the device to send statistics about only the routes that match the import policy (those delivered to the routing table) to the monitoring server, specify <strong><span>post-policy</span></strong> in the command.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>If <strong><span>pre-policy</span></strong> is specified in the command, run the <a href="cmdqueryname=keep-all-routes"><b><span class="cmdname">keep-all-routes</span></b></a> command in the BGP view to save the routes carried in the BGP Update messages that are received from all BGP peers or peer groups after BGP connections are established, or run the <a href="cmdqueryname=peer+keep-all-routes"><b><span class="cmdname">peer keep-all-routes</span></b></a> command to save the routes carried in the BGP Update messages that are received from a specified BGP peer or peer group after the BGP connection is established.</p>
</div></div>
</li></ol>
</li><li>Configure the BMP device to send statistics about RIB-out routes of BGP peers in a specified address family to the monitoring server.<ol type="a"><li>Run one of the following commands to enter the BMP-Monitor view:<ul><li><a href="cmdqueryname=monitor+public"><b><span class="cmdname">monitor public</span></b></a>: displays the BMP-Monitor view and allows the BGP running status of all BGP peers in the public network address family to be monitored.</li><li><a href="cmdqueryname=monitor+all-vpn-instance"><b><span class="cmdname">monitor all-vpn-instance</span></b></a>: displays the BMP-Monitor view and allows the BGP running status of BGP peers in all VPN instance address families to be monitored.</li><li><a href="cmdqueryname=monitor+peer"><b><span class="cmdname">monitor peer</span></b></a>: displays the BMP-Monitor view and allows the BGP running status of a specified BGP peer in the public address family to be monitored.</li><li><a href="cmdqueryname=monitor+vpn-instance"><b><span class="cmdname">monitor vpn-instance</span></b></a>: displays the BMP-Monitor view and allows the BGP running status of all BGP peers in a specified VPN instance address family to be monitored.</li><li><a href="cmdqueryname=monitor+vpn-instance+peer"><b><span class="cmdname">monitor vpn-instance peer</span></b></a>: displays the BMP-Monitor view and allows the BGP running status of a specified BGP peer in a specified VPN instance address family to be monitored.</li></ul>
</li><li>Run the <a href="cmdqueryname=route-mode+ipv4-family+unicast+ipv4-family+vpnv4+adj-rib-out"><b><span class="cmdname">route-mode</span></b></a> { <strong><span>ipv4-family</span></strong> <strong><span>unicast</span></strong><span> | <strong><span>ipv4-family</span></strong> <strong><span>labeled-unicast</span></strong></span> | <strong><span>ipv4-family</span></strong> <strong><span>vpnv4</span></strong> } <strong><span>adj-rib-out</span></strong> { <strong><span>pre-policy</span></strong> | <strong><span>post-policy</span></strong> } command to configure the BMP device to send statistics about RIB-out routes of BGP peers in a specified address family and the BGP running status of these peers to the monitoring server.</li></ol>
<p>If you want the monitoring server to monitor all the routes to be advertised, regardless of whether they match the export policy, specify <strong><span>pre-policy</span></strong> in the command. If you want the monitoring server to monitor only the routes that match the export policy, specify <strong><span>post-policy</span></strong> in the command.</p>
</li><li>Configure the BMP device to send statistics about Local-RIB routes of BGP peers in a specified address family to the monitoring server.<ol type="a"><li>Run one of the following commands to enter the BMP-Monitor view:<ul><li><a href="cmdqueryname=monitor+public"><b><span class="cmdname">monitor public</span></b></a>: displays the BMP-Monitor view and allows the BGP running status of all BGP peers in the public network address family to be monitored.</li><li><a href="cmdqueryname=monitor+vpn-instance"><b><span class="cmdname">monitor vpn-instance</span></b></a>: displays the BMP-Monitor view and allows the BGP running status of all BGP peers in a specified VPN instance address family to be monitored.</li></ul>
</li><li>Run the <a href="cmdqueryname=route-mode+ipv4-family+unicast+ipv4-family+vpnv4+local-rib"><b><span class="cmdname">route-mode</span></b></a> { <strong><span>ipv4-family</span></strong> <strong><span>unicast</span></strong><span> | <strong><span>ipv4-family</span></strong> <strong><span>labeled-unicast</span></strong></span> | <strong><span>ipv4-family</span></strong> <strong><span>vpnv4</span></strong> } <strong><span>local-rib</span></strong> [ <strong><span>add-path</span></strong> | <strong><span>all</span></strong> ] [ <strong><span>path-marking</span></strong> ] command to configure the BMP device to send statistics about Local-RIB routes of BGP peers in a specified address family and the BGP running status of these peers to the monitoring server.</li></ol>
</li></ul>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Return to the BMP session view.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=tcp+connect+port+password+md5+keychain"><b><span class="cmdname">tcp</span></b></a> <strong><span>connect</span></strong> <strong><span>port</span></strong> <i><span class="varname">port-number</span></i> [ <strong><span>password md5</span></strong> <i><span class="varname">cipher-password</span></i> | <strong><span>keychain</span></strong> <i><span class="varname">keychain-name</span></i> ]</span><p><p>Parameters for the TCP connection to be established between the device and the monitoring server are configured.</p>
</p><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>For security purposes, you are advised not to use weak security algorithms in this feature. If you need to use such an algorithm, run the <a href="cmdqueryname=undo+crypto+weak-algorithm+disable"><b><span class="cmdname">undo crypto weak-algorithm disable</span></b></a> command to enable the weak security algorithm function first.</p>
<p>The MD5 algorithm is not recommended if high security is required.</p>
</div></div>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=ssl-policy+name"><b><span class="cmdname">ssl-policy name</span></b></a> <i><span class="varname">policy-name</span></i></span><p><p>An SSL policy is configured for BMP.</p>
</p><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Ensure that the specified SSL policy has been created using the <a href="cmdqueryname=ssl+policy"><b><span class="cmdname">ssl policy</span></b></a> <i><span class="varname">policy-name</span></i> command in the system view.</p>
</div></div>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=connect-interface"><b><span class="cmdname">connect-interface</span></b></a> { <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i> | <i><span class="varname">ipv4-source-address</span></i> | <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i> <i><span class="varname">ipv4-source-address</span></i> }</span><p><p>The source interface for sending BMP messages is specified.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>If a configuration of a BMP session is changed and the new configuration needs to take effect immediately, run the <a href="cmdqueryname=reset+bmp+session"><b><span class="cmdname">reset bmp session</span></b></a> command to reset the BMP session.</p>
</div></div>
</p></li></ol>
</li><li><span>Configure BMP to report the processing records of IPv4 public network unicast routes to the monitoring server.</span><ol><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bmp"><b><span class="cmdname">bmp</span></b></a></span><p><p>BMP is enabled, and the BMP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bmp-session+vpn-instance+alias"><b><span class="cmdname">bmp-session</span></b></a> [ <strong><span>vpn-instance</span></strong> <i><span class="varname">vrf-name</span></i> ] <i><span class="varname">ipv4-address</span></i> [ <strong><span>alias</span></strong> <i><span class="varname">alias-name</span></i> ]</span><p><p>An IPv4 BMP session address is specified for the TCP connection to be established between the device and monitoring server.</p>
</p><p><p><strong><span>alias</span></strong> <i><span class="varname">alias-name</span></i> specifies an alias for a session. If the device needs to establish TCP connections with monitoring servers that have the same destination IP address but different destination port numbers, specify different values for the <strong><span>alias</span></strong> <i><span class="varname">alias-name</span></i> parameter to differentiate the connections.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ipv4+unicast"><b><span class="cmdname">ipv4 unicast</span></b></a></span><p><p>The BMP session IPv4 unicast view is created and displayed.</p>
</p></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=trace-prefix+all"><b><span class="cmdname">trace-prefix all</span></b></a> command to monitor the processing records of all IPv4 public network unicast routes, or run the <a href="cmdqueryname=trace-prefix"><b><span class="cmdname">trace-prefix </span></b></a><i><span class="varname">ipv4-address</span></i> <i><span class="varname">mask-length</span></i> command to monitor the processing records of a specified IPv4 public network unicast route.</span></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li><span>Configure BMP to report the trace data of VPNv4 routes and the IPv4 VPN unicast routes (transformed from the VPNv4 routes) to the monitoring server.</span><ol><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bmp"><b><span class="cmdname">bmp</span></b></a></span><p><p>BMP is enabled, and the BMP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bmp-session"><b><span class="cmdname">bmp-session</span></b></a> [ <strong><span>vpn-instance</span></strong> <i><span class="varname">vrf-name</span></i> ] <i><span class="varname">ipv4-address</span></i> [ <strong><span>alias</span></strong> <i><span class="varname">alias-name</span></i> ]</span><p><p>An IPv4 BMP session address is specified for the TCP connection to be established between the device and monitoring server.</p>
</p><p><p><strong><span>alias</span></strong> <i><span class="varname">alias-name</span></i> specifies an alias for a session. If the device needs to establish TCP connections with monitoring servers that have the same destination IP address but different destination port numbers, specify different values for the <strong><span>alias</span></strong> <i><span class="varname">alias-name</span></i> parameter to differentiate the connections.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ipv4+vpn"><b><span class="cmdname">ipv4 vpn</span></b></a></span><p><p>The BMP session IPv4 VPN view is created and displayed.</p>
</p></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=trace-prefix+route-distinguisher+all"><b><span class="cmdname">trace-prefix route-distinguisher</span></b></a> <i><span class="varname">vrfRD</span></i> <strong><span>all</span></strong> command to configure the function of monitoring the processing records of all VPNv4 routes and IPv4 VPN unicast routes based on a specified RD. Alternatively, run the <a href="cmdqueryname=trace-prefix+route-distinguisher"><b><span class="cmdname">trace-prefix route-distinguisher</span></b></a> <i><span class="varname">vrfRD</span></i> <i><span class="varname">ipv4-address</span></i> <i><span class="varname">mask-length</span></i> command to configure the function of monitoring the processing records of the VPNv4 route and IPv4 VPN unicast route based on a specified RD and route prefix.</span></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li></ul></div>
<div class="example"><a name="EN-US_TASK_0172366278__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p>After the configuration is complete, verify it.</p>
<ul><li>Run the <a href="cmdqueryname=display+bmp+session+vpn-instance+alias+verbose"><b><span class="cmdname">display bmp session</span></b></a> [ <strong><span>vpn-instance</span></strong> <i><span class="varname">vrf-name</span></i> ] [ <i><span class="varname">ipv4-address</span></i> [ <strong><span>alias</span></strong> <i><span class="varname">alias-name</span></i> ] <strong><span>verbose</span></strong> ] command to check BMP session configurations.</li><li>Run the <a href="cmdqueryname=display+bgp+bmp-monitor+all+ipv4+vpnv4+vpn-instance+vpnv4"><b><span class="cmdname">display bgp bmp-monitor</span></b></a> { <strong><span>all</span></strong> | { <strong><span>ipv4</span></strong> | <strong><span>vpnv4</span></strong> <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i> | <strong><span>vpnv4</span></strong> } <i><span class="varname">ipv4-address</span></i> } command to check information about BGP peers monitored through BMP in all address families or in a specified address family.</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_3000.html">BGP Configuration
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_3091.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_4051.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>