
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring BGP Load Balancing">
<meta name="abstract" content="Configuring load balancing can fully utilize network resources and reduce network congestion.">
<meta name="description" content="Configuring load balancing can fully utilize network resources and reduce network congestion.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_3070.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_3080.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_3082.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,bgpvrp,w00556928,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Route">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Route">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Route">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing Basis">
<meta name="OWNER" content="w00604599">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00615954">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172366391">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring BGP Load Balancing</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172366391"></a><a name="EN-US_TASK_0172366391"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring BGP Load Balancing</h1>
<div class="taskbody"><p>Configuring load balancing can fully utilize network resources and reduce network congestion.</p>
<div class="context"><a name="EN-US_TASK_0172366391__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>In <a href="#EN-US_TASK_0172366391__fig_dc_vrp_bgp_cfg_308101">Figure 1</a>, all <span class="keyword">Router</span>s run BGP; <span class="keyword">Device</span> A resides in AS 100; <span class="keyword">Device</span> B and <span class="keyword">Device</span> C reside in AS 300; <span class="keyword">Device</span> D resides in AS 200. EBGP connections are established between <span class="keyword">Device</span> A and <span class="keyword">Device</span> B, between <span class="keyword">Device</span> A and <span class="keyword">Device</span> C, between <span class="keyword">Device</span> D and <span class="keyword">Device</span> B, and between <span class="keyword">Device</span> D and <span class="keyword">Device</span> C. On <span class="keyword">Device</span> A, there are two BGP routes to 172.16.1.0/24. Traffic to 172.16.1.0/24 can reach the destination through <span class="keyword">Device</span> B and <span class="keyword">Device</span> C. It is required that BGP load balancing be configured to fully utilize network resources and reduce network congestion.</p>
<div class="fignone" id="EN-US_TASK_0172366391__fig_dc_vrp_bgp_cfg_308101"><a name="EN-US_TASK_0172366391__fig_dc_vrp_bgp_cfg_308101"></a><a name="fig_dc_vrp_bgp_cfg_308101"></a><span class="figcap"><b>Figure 1 </b>Configuring BGP load balancing</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 through 2 in this example are GE <span>0/1/0</span> and GE <span>0/2/0</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_bgp_cfg_308101.png"></span><br></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172366391__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Precautions</h4><p>During the configuration process, note the following:</p>
<ul><li><p>Route load balancing can be implemented by configuring BGP attributes, for example, configuring the device to ignore the comparison of IGP metrics. Ensure that no routing loops occur when configuring BGP attributes to implement load balancing.</p>
</li><li>To improve security, you are advised to deploy BGP security measures. For details, see "Configuring BGP Security." Keychain authentication is used as an example. For details, see "Example for Configuring BGP Keychain."</li></ul>
</div></div>
<div class="context"><a name="EN-US_TASK_0172366391__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Establish EBGP connections between <span class="keyword">Device</span> A and <span class="keyword">Device</span> B, and between <span class="keyword">Device</span> A and <span class="keyword">Device</span> C, and establish an IBGP connection between <span class="keyword">Device</span> B and <span class="keyword">Device</span> C.</p>
</li><li><p>Establish EBGP connections between <span class="keyword">Device</span> D and <span class="keyword">Device</span> B, and between <span class="keyword">Device</span> D and <span class="keyword">Device</span> C.</p>
</li><li><p>Configure load balancing on <span class="keyword">Device</span> A and then check routes.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172366391__1.4.4"></a><a name="1.4.4"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>Router IDs and AS numbers of <span class="keyword">Device</span> A, <span class="keyword">Device</span> B, <span class="keyword">Device</span> C, and <span class="keyword">Device</span> D</p>
</li><li><p>Number of routes for load balancing</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172366391__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure an IP address for each interface. For configuration details, see Configuration Files in this section.</span></li><li><span>Configure BGP connections.</span><p><p># Configure <span class="keyword">Device</span> A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A]<strong> bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp]<strong> router-id 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp] <strong>peer 10.1.1.2 as-number 300</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp]<strong> peer 10.1.2.2 as-number 300</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-bgp]<strong> quit</strong></pre>
<p># Configure <span class="keyword">Device</span> B.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B]<strong> bgp 300</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp]<strong> router-id 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp] <strong>peer 10.1.1.1 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp] <strong>peer 10.1.3.1 as-number 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-bgp] <strong>quit</strong></pre>
<p># Configure <span class="keyword">Device</span> C.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C]<strong> bgp 300</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp]<strong> router-id 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp] <strong>peer 10.1.2.1 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp] <strong>peer 10.1.4.1 as-number 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C-bgp] <strong>quit</strong></pre>
<p># Configure <span class="keyword">Device</span> D.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>D]<strong> bgp 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-bgp]<strong> router-id 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-bgp] <strong>peer 10.1.3.2 as-number 300</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-bgp] <strong>peer 10.1.4.2 as-number 300</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-bgp] <strong>ipv4-family unicast</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-bgp-af-ipv4] <strong>network 172.16.1.0 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-bgp-af-ipv4] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>D-bgp-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>D-bgp]<strong> quit</strong></pre>
<p># Check the routing table of <span class="keyword">Device</span> A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>display bgp routing-table 172.16.1.0 24</strong>

 BGP local router ID : 1.1.1.1
 Local AS number : 100
 Paths : 2 available, <strong>1 best</strong>, <strong>1 select</strong>
 BGP routing table entry information of 172.16.1.0/24:
 From: 10.1.1.2 (2.2.2.2)
 Route Duration: 0d00h00m50s
 Direct Out-interface: GigabitEthernet<span>0/1/0</span>
 Original nexthop: 10.1.1.2
 Qos information : 0x0
 AS-path 200 300, origin igp, pref-val 0, valid, external, <strong>best</strong>, <strong>select</strong>, pre 255
 Advertised to such 2 peers:
    10.1.1.2
    10.1.2.2

 BGP routing table entry information of 172.16.1.0/24:
 From: 10.1.2.2 (3.3.3.3)
 Route Duration: 0d00h00m51s
 Direct Out-interface: GigabitEthernet<span>0/2/0</span>
 Original nexthop: 10.1.2.2
 Qos information : 0x0
 AS-path 200 300, origin igp, pref-val 0, valid, external, pre 255, not preferred for router ID
 Not advertised to any peers yet</pre>
<p>The command output shows that there are two valid routes from <span class="keyword">Device</span> A to 172.16.1.0/24. The route with the next hop 10.1.1.2 is the optimal route because the router ID of <span class="keyword">Device</span> B is smaller.</p>
</p></li><li><span>Configure load balancing.</span><p><p># Configure load balancing on <span class="keyword">Device</span> A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp] <strong>ipv4-family unicast</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp-af-ipv4] <strong>maximum load-balancing 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp-af-ipv4] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-bgp-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-bgp] <strong>quit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p># Check the routing table of <span class="keyword">Device</span> A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>display bgp routing-table 172.16.1.0 24</strong>

 BGP local router ID : 1.1.1.1
 Local AS number : 100
 Paths : 2 available, <strong>1 best</strong>, <strong>2 select</strong>
 BGP routing table entry information of 172.16.1.0/24:
 From: 10.1.1.2 (2.2.2.2)
 Route Duration: 0d00h03m55s
 Direct Out-interface: GigabitEthernet<span>0/1/0</span>
 Original nexthop: 10.1.1.2
 Qos information : 0x0
 AS-path 200 300, origin igp, pref-val 0, valid, external, <strong>best</strong>, <strong>select</strong>, pre 255
 Advertised to such 2 peers
    10.1.1.2
    10.1.2.2

 BGP routing table entry information of 172.16.1.0/24:
 From: 10.1.2.2 (3.3.3.3)
 Route Duration: 0d00h03m56s
 Direct Out-interface: GigabitEthernet<span>0/2/0</span>
 Original nexthop: 10.1.2.2
 Qos information : 0x0
 AS-path 200 300, origin igp, pref-val 0, valid, external,<strong> select</strong>, pre 255, not preferred for router ID
 Not advertised to any peers yet</pre>
<p>The routing table shows that the BGP route 172.16.1.0/24 has two next hops: 10.1.1.2 and 10.1.2.2.</p>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172366391__1.4.6"></a><a name="1.4.6"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p><span class="keyword">Device</span> A configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname <span class="keyword">Device</span>A</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.1.1.1 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/2/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.1.2.1 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">bgp 100</pre>
<pre class="screen"> router-id 1.1.1.1</pre>
<pre class="screen"> peer 10.1.1.2 as-number 300</pre>
<pre class="screen"> peer 10.1.2.2 as-number 300</pre>
<pre class="screen"> #</pre>
<pre class="screen"> ipv4-family unicast</pre>
<pre class="screen">  maximum load-balancing 2</pre>
<pre class="screen">  peer 10.1.1.2 enable</pre>
<pre class="screen">  peer 10.1.2.2 enable</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p><span class="keyword">Device</span> B configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname <span class="keyword">Device</span>B</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.1.1.2 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/2/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.1.3.2 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">bgp 300</pre>
<pre class="screen"> router-id 2.2.2.2</pre>
<pre class="screen"> peer 10.1.1.1 as-number 100</pre>
<pre class="screen"> peer 10.1.3.1 as-number 200</pre>
<pre class="screen"> #</pre>
<pre class="screen"> ipv4-family unicast</pre>
<pre class="screen">  undo synchronization 
  peer 10.1.1.1 enable</pre>
<pre class="screen">  peer 10.1.3.1 enable</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p><span class="keyword">Device</span> C configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname <span class="keyword">Device</span>C</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.1.4.2 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/2/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.1.2.2 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">bgp 300</pre>
<pre class="screen"> router-id 3.3.3.3</pre>
<pre class="screen"> peer 10.1.2.1 as-number 100</pre>
<pre class="screen"> peer 10.1.4.1 as-number 200</pre>
<pre class="screen"> #</pre>
<pre class="screen"> ipv4-family unicast</pre>
<pre class="screen">  undo synchronization 
  peer 10.1.2.1 enable</pre>
<pre class="screen">  peer 10.1.4.1 enable</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p><span class="keyword">Device</span> D configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname <span class="keyword">Device</span>D</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.1.4.1 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/2/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.1.3.1 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/3/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 172.16.1.1 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">bgp 200</pre>
<pre class="screen"> router-id 4.4.4.4</pre>
<pre class="screen"> peer 10.1.3.2 as-number 300</pre>
<pre class="screen"> peer 10.1.4.2 as-number 300</pre>
<pre class="screen"> #</pre>
<pre class="screen"> ipv4-family unicast</pre>
<pre class="screen">  undo synchronization 
  network 172.16.1.0 255.255.255.0</pre>
<pre class="screen">  peer 10.1.3.2 enable</pre>
<pre class="screen">  peer 10.1.4.2 enable</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_3070.html">Configuration Examples for BGP
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_3080.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_3082.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>