
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring BGP Route Dampening">
<meta name="abstract" content="Configuring BGP route dampening can improve network stability.">
<meta name="description" content="Configuring BGP route dampening can improve network stability.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_3070.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_4078.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_3080.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,bgpvrp,w00556928,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Route">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Route">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Route">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing Basis">
<meta name="OWNER" content="w00604599">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00615954">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172366385">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring BGP Route Dampening</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172366385"></a><a name="EN-US_TASK_0172366385"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring BGP Route Dampening</h1>
<div class="taskbody"><p>Configuring BGP route dampening can improve network stability.</p>
<div class="context"><a name="EN-US_TASK_0172366385__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>In <a href="#EN-US_TASK_0172366385__fig_dc_vrp_bgp_cfg_307901">Figure 1</a>, all routers are configured with BGP; <span class="keyword">Device</span>A resides in AS 100; <span class="keyword">Device</span>B resides in AS 200; <span class="keyword">Device</span>C resides in AS 300; <span class="keyword">Device</span>D resides in AS 400. EBGP runs between <span class="keyword">Device</span> C and <span class="keyword">Device</span> A, between <span class="keyword">Device</span> C and <span class="keyword">Device</span> B, and between <span class="keyword">Device</span> C and <span class="keyword">Device</span> D. For routes from different EBGP peers, <span class="keyword">Device</span>C applies different route dampening policies. BGP route dampening suppresses unstable routes and improves network stability.</p>
<div class="fignone" id="EN-US_TASK_0172366385__fig_dc_vrp_bgp_cfg_307901"><a name="EN-US_TASK_0172366385__fig_dc_vrp_bgp_cfg_307901"></a><a name="fig_dc_vrp_bgp_cfg_307901"></a><span class="figcap"><b>Figure 1 </b>Configuring BGP route dampening</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface1, interface2, and interface3 represent GE<span>0/1/0</span>, GE<span>0/2/0</span>, and GE<span>0/3/0</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_bgp_cfg_307901.png"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172366385__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Precautions</h4><p>During the configuration, note the following:</p>
<ul><li><p>BGP route dampening takes effect only on EBGP routes.</p>
</li><li><p>Set a small <strong>MaxSuppressTime</strong> value for routes with smaller destination address masks.</p>
</li><li>To improve security, you are advised to deploy BGP security measures. For details, see "Configuring BGP Security." Keychain authentication is used as an example. For details, see "Example for Configuring BGP Keychain."</li></ul>
</div></div>
<div class="context"><a name="EN-US_TASK_0172366385__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Establish EBGP connections between <span class="keyword">Device</span>A and <span class="keyword">Device</span>C, between <span class="keyword">Device</span>B and <span class="keyword">Device</span>C, and between <span class="keyword">Device</span>D and <span class="keyword">Device</span>C.</p>
</li><li><p>Configure route dampening policies on <span class="keyword">Device</span> C and then check routes.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172366385__1.4.4"></a><a name="1.4.4"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>Router IDs and AS numbers of <span class="keyword">Device</span> A, <span class="keyword">Device</span> B, <span class="keyword">Device</span> C, and <span class="keyword">Device</span> D</p>
</li><li><p>Name of the route flap dampening policy to be applied to <span class="keyword">Device</span> C</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172366385__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure an IP address for each interface. For configuration details, see Configuration Files in this section.</span></li><li><span>Configure BGP connections.</span><p><p># Configure <span class="keyword">Device</span> A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A]<strong> bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp]<strong> router-id 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp] <strong>peer 10.10.1.2 as-number 300</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp] <strong>ipv4-family unicast</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp-af-ipv4] <strong>network 172.16.1.0 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp-af-ipv4]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-bgp-af-ipv4]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-bgp]<strong> quit</strong></pre>
<p># Configure <span class="keyword">Device</span> B.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B]<strong> bgp 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp]<strong> router-id 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp] <strong>peer 10.10.2.2 as-number 300</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp] <strong>ipv4-family unicast</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp-af-ipv4] <strong>network 192.168.1.0 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp-af-ipv4]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-bgp-af-ipv4]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-bgp] <strong>quit</strong></pre>
<p># Configure <span class="keyword">Device</span> C.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C]<strong> bgp 300</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp]<strong> router-id 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp] <strong>peer 10.10.1.1 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp] <strong>peer 10.10.2.1 as-number 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp] <strong>peer 10.10.3.1 as-number 400</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C-bgp] <strong>quit</strong></pre>
<p># Configure <span class="keyword">Device</span> D.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>D]<strong> bgp 400</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-bgp]<strong> router-id 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-bgp] <strong>peer 10.10.3.2 as-number 300</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-bgp] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>D-bgp] <strong>quit</strong></pre>
<p># Check the BGP peers of <span class="keyword">Device</span> C.</p>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C] <strong>display bgp peer</strong>

 BGP local router ID : 3.3.3.3
 Local AS number : 300
 Total number of peers : 3         Peers in established state : 3

  Peer            V          AS  MsgRcvd  MsgSent  OutQ  Up/Down       State  PrefRcv
  10.10.1.1       4         100        3        3     0 00:00:01 <strong>Established</strong>    0
  10.10.2.1       4         200        3        3     0 00:00:00 <strong>Established</strong>    0
  10.10.3.1       4         400        3        3     0 00:00:01 <strong>Established</strong>    0</pre>
<p>The command output on <span class="keyword">Device</span>C shows that the BGP connection status of with each peer is <strong>Established</strong>.</p>
</p></li><li><span>Configure BGP route dampening policies.</span><p><p># Configure an IP prefix list named <strong>prefix-a</strong> on <span class="keyword">Device</span>C to permit the routes with prefix 172.16.1.0/24.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C] <strong>ip ip-prefix prefix-a index 10 permit 172.16.1.0 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C] <strong>commit</strong></pre>
<p># Configure an IP prefix list named <strong>prefix-b</strong> on <span class="keyword">Device</span>C to permit the routes with prefix 192.168.1.0/24.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C] <strong>ip ip-prefix prefix-b index 20 permit 192.168.1.0 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C] <strong>commit</strong></pre>
<p># Configure a route-policy named <strong>dampen-policy</strong> on <span class="keyword">Device</span> C and then apply different route dampening policies to the routes with different prefix lengths.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C] <strong>route-policy dampen-policy permit node 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-route-policy] <strong>if-match ip-prefix prefix-a</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-route-policy] <strong>apply dampening 10 1000 2000 5000</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-route-policy] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C-route-policy] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C] <strong>route-policy dampen-policy permit node 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-route-policy] <strong>if-match ip-prefix prefix-b</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-route-policy] <strong>apply dampening 10 800 3000 10000</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-route-policy] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C-route-policy] <strong>quit</strong></pre>
<p># Apply route dampening policies to flapping routes.</p>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C] <strong>bgp 300</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp] <strong>ipv4-family unicast</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp-af-ipv4] <strong>dampening route-policy dampen-policy</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp-af-ipv4] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C-bgp] <strong>quit</strong></pre>
<p># Check the configured route dampening parameters on <span class="keyword">Device</span>C.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C] <strong>display bgp routing-table dampening parameter</strong>

 Maximum Suppress Time(in second) : 3973
 Ceiling Value                    : 16000
 Reuse Value                      : 750
 HalfLife Time(in  second)        : 900
 Suppress-Limit                   : 2000
 <strong>Route-policy                     : dampen-policy</strong></pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172366385__1.4.6"></a><a name="1.4.6"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p><span class="keyword">Device</span> A configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname <span class="keyword">Device</span>A</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.10.1.1 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/2/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 172.16.1.1 255.0.0.0</pre>
<pre class="screen">#</pre>
<pre class="screen">bgp 100</pre>
<pre class="screen"> router-id 1.1.1.1</pre>
<pre class="screen"> peer 10.10.1.2 as-number 300</pre>
<pre class="screen"> #</pre>
<pre class="screen"> ipv4-family unicast</pre>
<pre class="screen">  undo synchronization 
  network 172.16.1.0 255.255.255.0</pre>
<pre class="screen">  peer 10.10.1.2 enable</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p><span class="keyword">Device</span> B configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname <span class="keyword">Device</span>B</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.10.2.1 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/2/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 192.168.1.1 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">bgp 200</pre>
<pre class="screen"> router-id 2.2.2.2</pre>
<pre class="screen"> peer 10.10.2.2 as-number 300</pre>
<pre class="screen"> #</pre>
<pre class="screen"> ipv4-family unicast</pre>
<pre class="screen">  undo synchronization 
  network 192.168.1.0 255.255.255.0</pre>
<pre class="screen">  peer 10.10.2.2 enable</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p><span class="keyword">Device</span> C configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname <span class="keyword">Device</span>C</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.10.1.2 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/2/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.10.2.2 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/3/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.10.3.2 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">bgp 300</pre>
<pre class="screen"> router-id 3.3.3.3</pre>
<pre class="screen"> peer 10.10.1.1 as-number 100</pre>
<pre class="screen"> peer 10.10.2.1 as-number 200</pre>
<pre class="screen"> peer 10.10.3.1 as-number 400</pre>
<pre class="screen"> #</pre>
<pre class="screen"> ipv4-family unicast</pre>
<pre class="screen">  undo synchronization 
  dampening route-policy dampen-policy</pre>
<pre class="screen">  peer 10.10.1.1 enable</pre>
<pre class="screen">  peer 10.10.2.1 enable</pre>
<pre class="screen">  peer 10.10.3.1 enable</pre>
<pre class="screen">#</pre>
<pre class="screen">ip ip-prefix prefix-a index 10 permit 172.16.1.0 24</pre>
<pre class="screen">#</pre>
<pre class="screen">ip ip-prefix prefix-b index 20 permit 192.168.1.0 24</pre>
<pre class="screen">#</pre>
<pre class="screen">route-policy dampen-policy permit node 10</pre>
<pre class="screen"> if-match ip-prefix prefix-a</pre>
<pre class="screen"> apply dampening 10 1000 2000 5000</pre>
<pre class="screen">#</pre>
<pre class="screen">route-policy dampen-policy permit node 20</pre>
<pre class="screen"> if-match ip-prefix prefix-b</pre>
<pre class="screen"> apply dampening 10 800 3000 10000</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p><span class="keyword">Device</span> D configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname <span class="keyword">Device</span>D</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/2/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.10.3.1 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">bgp 400</pre>
<pre class="screen"> router-id 4.4.4.4</pre>
<pre class="screen"> peer 10.10.3.2 as-number 300</pre>
<pre class="screen"> #</pre>
<pre class="screen"> ipv4-family unicast</pre>
<pre class="screen">  undo synchronization 
  peer 10.10.3.2 enable</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_3070.html">Configuration Examples for BGP
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_4078.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_3080.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>