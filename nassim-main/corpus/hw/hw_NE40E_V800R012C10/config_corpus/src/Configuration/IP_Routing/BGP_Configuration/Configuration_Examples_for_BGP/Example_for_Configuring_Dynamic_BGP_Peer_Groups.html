
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Dynamic BGP Peer Groups">
<meta name="abstract" content="Configuring dynamic BGP peer groups reduces network maintenance workload.">
<meta name="description" content="Configuring dynamic BGP peer groups reduces network maintenance workload.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_3070.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_4090.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_multiinstance_0002.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Route">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Route">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Route">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing Basis">
<meta name="OWNER" content="w00604599">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00615954">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0243366746">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring Dynamic BGP Peer Groups</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0243366746"></a><a name="EN-US_TASK_0243366746"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Dynamic BGP Peer Groups</h1>
<div class="taskbody"><p>Configuring dynamic BGP peer groups reduces network maintenance workload.</p>
<div class="context"><a name="EN-US_TASK_0243366746__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On a BGP network, multiple peers may frequently change, causing the establishment of peer relationships to change accordingly. If you configure peers in static mode, you need to frequently add or delete peer configurations on the local device, which increases the maintenance workload. To address this problem, configure the dynamic BGP peer function to enable BGP to listen for BGP connection requests from a specified network segment, dynamically establish BGP peer relationships, and add these peers to the same dynamic peer group. This spares you from adding or deleting BGP peer configurations in response to each change in BGP peers.</p>
<p>On the network shown in <a href="#EN-US_TASK_0243366746__fig_dc_vrp_bgp_cfg_407901">Figure 1</a>, <span class="keyword">Device</span>A, <span class="keyword">Device</span>D, and <span class="keyword">Device</span>E are in AS 65008, and <span class="keyword">Device</span>B and <span class="keyword">Device</span>C are in AS 65009. Because many devices are on the same network segment in an AS, you can configure dynamic peer groups on <span class="keyword">Device</span>A.</p>
<div class="fignone" id="EN-US_TASK_0243366746__fig_dc_vrp_bgp_cfg_407901"><a name="EN-US_TASK_0243366746__fig_dc_vrp_bgp_cfg_407901"></a><a name="fig_dc_vrp_bgp_cfg_407901"></a><span class="figcap"><b>Figure 1 </b>Network diagram of configuring dynamic BGP peer groups</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface 1, interface 2, interface 3, and interface 4 represent GE<span></span><span>0/1/1</span>, GE<span></span><span>0/1/2</span>, GE<span></span><span>0/1/3</span>, and GE<span></span><span>0/1/4</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0243366776.png"></span><p></p>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0243366746__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Precautions</h4><p>To improve security, you are advised to deploy BGP security measures. For details, see "Configuring BGP Security." Keychain authentication is used as an example. For details, see "Example for Configuring BGP Keychain."</p>
</div></div>
<div class="context"><a name="EN-US_TASK_0243366746__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure a dynamic IBGP peer group on <span class="keyword">Device</span>A to listen for BGP connection requests from network segment 10.2.0.0/16.</p>
</li><li><p>Configure a dynamic EBGP peer group on <span class="keyword">Device</span>A to listen for BGP connection requests from network segment 10.1.0.0/16.</p>
</li><li><p>Configure IBGP connections between <span class="keyword">Device</span>D and <span class="keyword">Device</span>A, and between <span class="keyword">Device</span>E and <span class="keyword">Device</span>A.</p>
</li><li><p>Configure EBGP connections between <span class="keyword">Device</span>B and <span class="keyword">Device</span>A, and between <span class="keyword">Device</span>C and <span class="keyword">Device</span>A.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0243366746__1.4.4"></a><a name="1.4.4"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>AS numbers of <span class="keyword">Device</span>A, <span class="keyword">Device</span>D, and <span class="keyword">Device</span>E</p>
</li><li><p>AS numbers of <span class="keyword">Device</span>B and <span class="keyword">Device</span>C</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0243366746__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Assign an IP address to each interface. For configuration details, see <a href="#EN-US_TASK_0243366746__section_dc_vrp_bgp_cfg_407105">Configuration Files</a> in this section.</span></li><li><span>Configure dynamic BGP peer groups.</span><p><p># Configure dynamic BGP peer groups on <span class="keyword">Device</span>A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A]<strong> bgp 65008</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp]<strong> bgp dynamic-session-limit 5</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp]<strong> group a listen internal</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp]<strong> peer a listen-net 10.2.0.0 16</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp]<strong> group b listen external</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp]<strong> peer b listen-as 65009</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp]<strong> peer b listen-net 10.1.0.0 16</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-bgp]<strong> quit</strong></pre>
</p></li><li><span>Configure IBGP connections.</span><p><p># Configure <span class="keyword">Device</span>D.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>D]<strong> bgp 65008</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-bgp]<strong> peer 10.2.1.1 as-number 65008</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-bgp]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>D-bgp]<strong> quit</strong></pre>
<p># Configure <span class="keyword">Device</span>E.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>E]<strong> bgp 65008</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>E-bgp]<strong> peer 10.2.2.1 as-number 65008</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>E-bgp]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>E-bgp]<strong> quit</strong></pre>
</p></li><li><span>Configure EBGP connections.</span><p><p># Configure <span class="keyword">Device</span>B.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B]<strong> bgp 65009</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp] <strong>peer 10.1.1.1 as-number 65008</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-bgp]<strong> quit</strong></pre>
<p># Configure <span class="keyword">Device</span>C.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C]<strong> bgp 65009</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp]<strong> peer 10.1.2.1 as-number 65008</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C-bgp]<strong> quit</strong></pre>
<p># Check the status of BGP connections.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>display bgp peer</strong>
 <strong>Status codes: * - Dynamic</strong>
 BGP local router ID        : 10.1.1.1
 Local AS number            : 65008
 Total number of peers      : 4                 Peers in established state : 4
 Total number of dynamic peers : 4

  Peer            V          AS  MsgRcvd  MsgSent  OutQ  Up/Down       State  PrefRcv
  *10.1.1.2       4       65009        8        7     0 00:04:16 Established        0
  *10.1.2.2       4       65009        5        5     0 00:02:01 Established        0
  *10.2.1.2       4       65008        5        5     0 00:02:01 Established        0
  *10.2.2.2       4       65008        5        5     0 00:02:01 Established        0</pre>
<p>The command output shows that <span class="keyword">Device</span>A has established BGP connections with other <span class="keyword">Router</span>s and the connection status is <strong>Established</strong>.</p>
<p># Check information about BGP peer groups.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>display bgp group a</strong>
 BGP peer-group                       : a
 Remote AS                            : 65008
 Authentication type configured       : None
 Type                                 : listen internal
 Configured hold timer value   : 180
 Keepalive timer value         : 60
 Connect-retry timer value     : 32
 Minimum route advertisement interval is 15 seconds
 PeerSession Members                  :
 10.2.1.2                                10.2.2.2
  
 Peer Preferred Value: 0
 No routing policy is configured
 Peer Members:
  Peer            V          AS    MsgRcvd  MsgSent  OutQ  Up/Down       State  PrefRcv
  *10.2.1.2       4       65008          3        4     0 00:00:20 Established        0
  *10.2.2.2       4       65008          3        4     0 00:00:21 Established        0</pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>display bgp group b</strong>
 BGP peer-group                       : b
 Remote AS                            : 65009
 Authentication type configured       : None
 Type                                 : listen external
 Configured hold timer value   : 180
 Keepalive timer value         : 60
 Connect-retry timer value     : 32
 Minimum route advertisement interval is 15 seconds
 PeerSession Members                  :
 10.1.1.2                                10.1.2.2
  
 Peer Preferred Value: 0
 No routing policy is configured
 Peer Members:
  Peer            V          AS    MsgRcvd  MsgSent  OutQ  Up/Down       State  PrefRcv
  *10.1.1.2       4       65009          3        4     0 00:00:20 Established        0
  *10.1.2.2       4       65009          3        4     0 00:00:21 Established        0</pre>
<p>The command output shows that two dynamic peer groups <strong>a</strong> and <strong>b</strong> exist on <span class="keyword">Device</span>A and each dynamic peer group has two peers, indicating that the dynamic peer groups are properly established.</p>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0243366746__section_dc_vrp_bgp_cfg_407105"><a name="EN-US_TASK_0243366746__section_dc_vrp_bgp_cfg_407105"></a><a name="section_dc_vrp_bgp_cfg_407105"></a><a name="EN-US_TASK_0243366746__1.4.6"></a><a name="1.4.6"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p><span class="keyword">Device</span>A configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname <span class="keyword">Device</span>A</pre>
<pre class="screen">#</pre>
<pre class="screen">interface <span>GigabitEthernet</span><span></span><span>0/1/1</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.1.1.1 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">interface <span>GigabitEthernet</span><span></span><span>0/1/2</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.1.2.1 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">interface <span>GigabitEthernet</span><span></span><span>0/1/3</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.2.1.1 255.255.255.0</pre>
<pre class="screen">interface <span>GigabitEthernet</span><span></span><span>0/1/4</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.2.2.1 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">bgp 65008</pre>
<pre class="screen"> bgp dynamic-session-limit 5</pre>
<pre class="screen"> group a listen internal</pre>
<pre class="screen"> peer a listen-net 10.2.0.0 255.255.0.0</pre>
<pre class="screen"> group b listen external</pre>
<pre class="screen"> peer b listen-as 65009</pre>
<pre class="screen"> peer b listen-net 10.1.0.0 255.255.0.0</pre>
<pre class="screen"> #</pre>
<pre class="screen"> ipv4-family unicast</pre>
<pre class="screen">  peer a enable</pre>
<pre class="screen">  peer b enable</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p><span class="keyword">Device</span>B configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname <span class="keyword">Device</span>B</pre>
<pre class="screen">#</pre>
<pre class="screen">interface <span>GigabitEthernet</span><span></span><span>0/1/1</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.1.1.2 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">bgp 65009</pre>
<pre class="screen"> peer 10.1.1.1 as-number 65008</pre>
<pre class="screen">#</pre>
<pre class="screen"> ipv4-family unicast</pre>
<pre class="screen">  peer 10.1.1.1 enable</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p><span class="keyword">Device</span>C configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname <span class="keyword">Device</span>C</pre>
<pre class="screen">#</pre>
<pre class="screen">interface <span></span><span>GigabitEthernet</span><span>0/1/1</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.1.2.2 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">bgp 65009</pre>
<pre class="screen"> peer 10.1.2.1 as-number 65008</pre>
<pre class="screen">#</pre>
<pre class="screen"> ipv4-family unicast</pre>
<pre class="screen">  peer 10.1.2.1 enable</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p><span class="keyword">Device</span>D configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname <span class="keyword">Device</span>D</pre>
<pre class="screen">#</pre>
<pre class="screen">interface <span>GigabitEthernet</span><span></span><span>0/1/1</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.2.1.2 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">bgp 65008</pre>
<pre class="screen"> peer 10.2.1.1 as-number 65008</pre>
<pre class="screen">#</pre>
<pre class="screen"> ipv4-family unicast</pre>
<pre class="screen">  peer 10.2.1.1 enable</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p><span class="keyword">Device</span>E configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname <span class="keyword">Device</span>E</pre>
<pre class="screen">#</pre>
<pre class="screen">interface <span>GigabitEthernet</span><span></span><span>0/1/1</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.2.2.2 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">bgp 65008</pre>
<pre class="screen"> peer 10.2.2.1 as-number 65008</pre>
<pre class="screen">#</pre>
<pre class="screen"> ipv4-family unicast</pre>
<pre class="screen">  peer 10.2.2.1 enable</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_3070.html">Configuration Examples for BGP
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_4090.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_multiinstance_0002.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>