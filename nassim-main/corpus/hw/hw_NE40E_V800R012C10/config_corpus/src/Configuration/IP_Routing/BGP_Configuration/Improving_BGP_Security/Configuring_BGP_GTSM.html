
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring BGP GTSM">
<meta name="abstract" content="To apply BGP GTSM, you need to configure GTSM on both ends of the corresponding BGP peer relationship.">
<meta name="description" content="To apply BGP GTSM, you need to configure GTSM on both ends of the corresponding BGP peer relationship.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_3062.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_tcp-ao.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_30991.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="z00603461,w00800033,w00556928,w00606909,gtsm,l00455378,z00805567">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Route">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Route">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Route">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing Basis">
<meta name="OWNER" content="y00852169">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="y00852169">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172366287">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring BGP GTSM</title>
</head>
<body><a name="EN-US_TASK_0172366287"></a><a name="EN-US_TASK_0172366287"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring BGP GTSM</h1>
<div class="taskbody"><p>To apply BGP GTSM, you need to configure GTSM on both ends of the corresponding BGP peer relationship.</p>
<div class="context"><a name="EN-US_TASK_0172366287__1.4.1"></a><a name="1.4.1"></a>
<div class="p" id="EN-US_TASK_0172366287__en-us_task_0172372045_context361421984214100"><h4 class="sectiontitle">Usage Scenario</h4><p id="EN-US_TASK_0172366287__en-us_task_0172372045_p1435996854214100">GTSM checks TTL values to defend against attacks. Attackers may simulate BGP messages and continuously send them to a <span class="keyword" id="EN-US_TASK_0172366287__en-us_task_0172372045_keyword2052361343214100">Router</span>. After receiving these messages, an interface board on the <span class="keyword" id="EN-US_TASK_0172366287__en-us_task_0172372045_keyword1135499470214100">Router</span> sends them directly to the control plane for BGP processing, without validating them, if they are destined for the device. Consequently, the <span class="keyword" id="EN-US_TASK_0172366287__en-us_task_0172372045_keyword1549490094214100">Router</span> becomes extremely busy, and CPU usage is high because the control plane needs to process these unverified messages.</p>
<p id="EN-US_TASK_0172366287__en-us_task_0172372045_p1534391553214100">GTSM protects the <span class="keyword" id="EN-US_TASK_0172366287__en-us_task_0172372045_keyword58363960214100">Router</span> by checking whether the TTL value in the IP header is within a predefined range, thereby improving system security.</p>
<div class="note" id="EN-US_TASK_0172366287__en-us_task_0172372045_note441686338214100"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><ul id="EN-US_TASK_0172366287__en-us_task_0172372045_ul1718798734214100"><li id="EN-US_TASK_0172366287__en-us_task_0172372045_li1575467765214100"><p id="EN-US_TASK_0172366287__en-us_task_0172372045_p413358845214100"><a name="EN-US_TASK_0172366287__en-us_task_0172372045_li1575467765214100"></a><a name="en-us_task_0172372045_li1575467765214100"></a>GTSM supports only unicast addresses. Therefore, it needs to be configured on all the <span class="keyword" id="EN-US_TASK_0172366287__en-us_task_0172372045_keyword388080129214100">Router</span>s running routing protocols.</p>
</li></ul>
</div></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172366287__1.4.2"></a><a name="1.4.2"></a>
<div class="p" id="EN-US_TASK_0172366287__en-us_task_0172372045_context778933588214100"><h4 class="sectiontitle">Pre-configuration Tasks</h4><p id="EN-US_TASK_0172366287__en-us_task_0172372045_p1566102416214100">Before configuring BGP GTSM, complete the following task:</p>
<ul id="EN-US_TASK_0172366287__en-us_task_0172372045_ul1731534975214100"><li id="EN-US_TASK_0172366287__en-us_task_0172372045_li1511898615214100"><p id="EN-US_TASK_0172366287__en-us_task_0172372045_p1453511001214100"><a name="EN-US_TASK_0172366287__en-us_task_0172372045_li1511898615214100"></a><a name="en-us_task_0172372045_li1511898615214100"></a><a href="dc_vrp_bgp_cfg_3004.html">Configure basic BGP functions</a>.</p>
</li></ul>
<p id="EN-US_TASK_0172366287__en-us_task_0172372045_p774886894214100">Perform the following steps on both ends of the peer relationship for which GTSM is to be enabled:</p>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172366287__1.4.3"></a><a name="1.4.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol id="EN-US_TASK_0172366287__en-us_task_0172372045_steps441476595214100"><li id="EN-US_TASK_0172366287__en-us_task_0172372045_step_5"><span id="EN-US_TASK_0172366287__en-us_task_0172372045_cmd1732034027214100">Configure basic BGP GTSM functions.</span><ol type="a" id="EN-US_TASK_0172366287__en-us_task_0172372045_substeps51745508214100"><li class="substepexpand" id="EN-US_TASK_0172366287__en-us_task_0172372045_substep1435946109214100"><span id="EN-US_TASK_0172366287__en-us_task_0172372045_cmd_01">Run the <a href="cmdqueryname=system-view"><b><span class="cmdname" id="EN-US_TASK_0172366287__en-us_task_0172372045_cmdname742276223214100">system-view</span></b></a> command to enter the system view.</span></li><li class="substepexpand" id="EN-US_TASK_0172366287__en-us_task_0172372045_substep1294051445214100"><span id="EN-US_TASK_0172366287__en-us_task_0172372045_cmd_02">Run the <a href="cmdqueryname=bgp"><b><span class="cmdname" id="EN-US_TASK_0172366287__en-us_task_0172372045_cmdname77681612214100">bgp</span></b></a> <i><span class="varname" id="EN-US_TASK_0172366287__en-us_task_0172372045_varname996195243214100">as-number</span></i> command to enter the BGP view.</span></li><li class="substepexpand" id="EN-US_TASK_0172366287__en-us_task_0172372045_substep1151598001214100"><span id="EN-US_TASK_0172366287__en-us_task_0172372045_cmd_03">Run the <a href="cmdqueryname=peer"><b><span class="cmdname" id="EN-US_TASK_0172366287__en-us_task_0172372045_cmdname1255765107214100">peer</span></b></a> { <i><span class="varname" id="EN-US_TASK_0172366287__en-us_task_0172372045_varname592738505214100">group-name</span></i> | <i><span class="varname" id="EN-US_TASK_0172366287__en-us_task_0172372045_varname102923122214100">ipv4-address</span></i> } <strong><span id="EN-US_TASK_0172366287__en-us_task_0172372045_cmdparmname1632363980214100">valid-ttl-hops</span></strong> [ <i><span class="varname" id="EN-US_TASK_0172366287__en-us_task_0172372045_varname101934123214100">hops</span></i> ] command to configure BGP GTSM.</span><p><p id="EN-US_TASK_0172366287__en-us_task_0172372045_p233522223214100">The valid TTL range of checked messages is [255 â <i><span class="varname" id="EN-US_TASK_0172366287__en-us_task_0172372045_varname1493994115214100">hops</span></i> + 1, 255]. For example, the value of <i><span class="varname" id="EN-US_TASK_0172366287__en-us_task_0172372045_varname1335860507214100">hops</span></i> is 1 for an EBGP direct route, and the valid TTL value is 255. </p>
<div class="note" id="EN-US_TASK_0172366287__en-us_task_0172372045_note1418520841214100"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><ul id="EN-US_TASK_0172366287__en-us_task_0172372045_ul1863809340214100"><li id="EN-US_TASK_0172366287__en-us_task_0172372045_li223713034214100">After GTSM is configured in the BGP view, the configuration also takes effect in the MP-BGP VPNv4 address family view because BGP and MP-BGP VPNv4 use the same TCP connection.</li><li id="EN-US_TASK_0172366287__en-us_task_0172372045_li289477409214100">Because GTSM and EBGP-MAX-HOP both affect the TTL values in sent BGP messages, only one of them can be configured for a peer or peer group.</li></ul>
</div></div>
<p id="EN-US_TASK_0172366287__en-us_task_0172372045_p1923347367214100">After a BGP GTSM policy is enabled, the involved interface board checks the TTL values in all the BGP messages and drops the messages whose TTL values are not within the range specified in the GTSM policy. This prevents bogus BGP messages from consuming CPU resources.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0172366287__en-us_task_0172372045_substep1308180105214100"><span id="EN-US_TASK_0172366287__en-us_task_0172372045_cmd_04">Run the <a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0172366287__en-us_task_0172372045_cmdname1562632362214100">commit</span></b></a> command to commit the configuration.</span></li></ol>
</li><li id="EN-US_TASK_0172366287__en-us_task_0172372045_step_6"><span id="EN-US_TASK_0172366287__en-us_task_0172372045_cmd1620546895214100">Set a default action for the messages that do not match the specified GTSM policy.</span><p><p id="EN-US_TASK_0172366287__en-us_task_0172372045_p386302501214100">GTSM checks the TTL values of only the messages that match the specified GTSM policy. For messages that do not match the policy, you can set the default action taken on them as either pass or drop. When drop is configured as the default action, you must configure TTL values for all the messages from valid peers in the GTSM policy. Otherwise, the device drops the messages and cannot establish a connection to the peer.</p>
<p id="EN-US_TASK_0172366287__en-us_task_0172372045_p1150435477214100">To facilitate fault locating, you can enable the device to log information about dropped messages.</p>
<p id="EN-US_TASK_0172366287__en-us_task_0172372045_p98802287214100">Perform the following steps on a GTSM-enabled <span class="keyword" id="EN-US_TASK_0172366287__en-us_task_0172372045_keyword634509065214100">Router</span>:</p>
</p><ol type="a" id="EN-US_TASK_0172366287__en-us_task_0172372045_default_01"><li class="substepexpand" id="EN-US_TASK_0172366287__en-us_task_0172372045_substep1445317723214100"><span id="EN-US_TASK_0172366287__en-us_task_0172372045_cmd_05">Run the <a href="cmdqueryname=system-view"><b><span class="cmdname" id="EN-US_TASK_0172366287__en-us_task_0172372045_cmdname1635538118214100">system-view</span></b></a> command to enter the system view.</span></li><li class="substepexpand" id="EN-US_TASK_0172366287__en-us_task_0172372045_substep1259563513214100"><span id="EN-US_TASK_0172366287__en-us_task_0172372045_cmd_06">Run the <a href="cmdqueryname=gtsm+default-action"><b><span class="cmdname" id="EN-US_TASK_0172366287__en-us_task_0172372045_cmdname140602031214100">gtsm default-action</span></b></a> { <strong><span id="EN-US_TASK_0172366287__en-us_task_0172372045_cmdparmname2007963889214100">drop</span></strong> | <strong><span id="EN-US_TASK_0172366287__en-us_task_0172372045_cmdparmname652484850214100">pass</span></strong> } command to set a default action for the messages that do not match the GTSM policy.</span><p><div class="note" id="EN-US_TASK_0172366287__en-us_task_0172372045_note760244747214100"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0172366287__en-us_task_0172372045_p2053246826214100">If the default action is configured but no GTSM policy is configured, GTSM does not take effect.</p>
<p id="EN-US_TASK_0172366287__en-us_task_0172372045_p8625412214100">This command is supported only on the Admin-VS and cannot be configured in other VSs. This command takes effect on all VSs.</p>
</div></div>
</p></li><li class="substepexpand" id="EN-US_TASK_0172366287__en-us_task_0172372045_substep458111747214100"><span id="EN-US_TASK_0172366287__en-us_task_0172372045_cmd_07">Run the <a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0172366287__en-us_task_0172372045_cmdname415032453214100">commit</span></b></a> command to commit the configuration.</span></li></ol>
</li></ol></div>
<div class="postreq"><a name="EN-US_TASK_0172366287__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p id="EN-US_TASK_0172366287__en-us_task_0172372045_p867573582214100">After the configuration is complete, verify the configuration.</p>
<ul id="EN-US_TASK_0172366287__en-us_task_0172372045_ul59536548214100"><li id="EN-US_TASK_0172366287__en-us_task_0172372045_li1798731117214100"><p id="EN-US_TASK_0172366287__en-us_task_0172372045_p1146584600214100"><a name="EN-US_TASK_0172366287__en-us_task_0172372045_li1798731117214100"></a><a name="en-us_task_0172372045_li1798731117214100"></a>Run the <a href="cmdqueryname=display+gtsm+statistics"><b><span class="cmdname" id="EN-US_TASK_0172366287__en-us_task_0172372045_cmdname6363131552817">display gtsm statistics</span></b></a> { <i><span class="varname" id="EN-US_TASK_0172366287__en-us_task_0172372045_varname13181182082816">slot-id</span></i> | <strong><span id="EN-US_TASK_0172366287__en-us_task_0172372045_cmdparmname73841025142810">all</span></strong> } command to check GTSM statistics.</p>
<div class="note" id="EN-US_TASK_0172366287__en-us_task_0172372045_note929587511214100"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0172366287__en-us_task_0172372045_p633765452214100"><span>In VS mode, this command is supported only by the admin VS.</span></p>
</div></div>
</li></ul>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_3062.html">Improving BGP Security
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_tcp-ao.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_30991.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>