
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring Delayed Response to BGP Next Hop Recursion Changes">
<meta name="abstract" content="Configuring delayed response to BGP next hop recursion changes can minimize traffic loss during route changes.">
<meta name="description" content="Configuring delayed response to BGP next hop recursion changes can minimize traffic loss during route changes.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_3000.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_4057.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_4052_1.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,bgpvrp,w00556928,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Route">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Route">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing Basis">
<meta name="OWNER" content="w00604599">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00615954">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172366257">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring Delayed Response to BGP Next Hop Recursion Changes</title>
</head>
<body><a name="EN-US_TASK_0172366257"></a><a name="EN-US_TASK_0172366257"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring Delayed Response to BGP Next Hop Recursion Changes</h1>
<div class="taskbody"><p>Configuring delayed response to BGP next hop recursion changes can minimize traffic loss during route changes.</p>
<div class="context"><a name="EN-US_TASK_0172366257__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Usage Scenario</h4><p>As shown in <a href="#EN-US_TASK_0172366257__fig_dc_vrp_bgp_cfg_410201">Figure 1</a>, PE1, PE2, and PE3 are the clients of the RR. CE2 is dual-homed to PE1 and PE2. PE1 and PE2 advertise their routes destined for CE2 to the RR. The RR advertises the route from PE1 to PE3. PE3 has only one route to CE2 and advertises this route to CE1. After the route exchange, CE1 and CE2 can communicate. If PE1 fails, PE3 detects that the next hop is unreachable and instructs CE1 to delete the route to CE2. Traffic is interrupted. After BGP route convergence is complete, the RR selects the route advertised by PE2 and sends a route update message to PE3. PE3 then advertises this route to CE1, and traffic forwarding is restored. A high volume of traffic will be lost during traffic interruption because BGP route convergence is rather slow.</p>
<p>If delayed response to BGP next hop recursion changes is enabled on PE3, PE3 does not reselect a route or instruct CE1 to delete the corresponding route immediately after detecting that the route to PE1 is unreachable. After BGP convergence is complete, the RR selects the route advertised by PE2 and sends the route to PE3. PE3 then reselects a route and sends a route update message to CE1. Traffic forwarding is restored. After delayed response to BGP next hop recursion changes is enabled on PE3, PE3 does not need to delete the route or instruct CE1 to delete the route. This delayed response speeds up BGP route convergence and minimizes traffic loss.</p>
<div class="fignone" id="EN-US_TASK_0172366257__fig_dc_vrp_bgp_cfg_410201"><a name="EN-US_TASK_0172366257__fig_dc_vrp_bgp_cfg_410201"></a><a name="fig_dc_vrp_bgp_cfg_410201"></a><span class="figcap"><b>Figure 1 </b>Networking diagram for configuring the BGP next hop recursion change delayed response</span><br><span><img class="vsd" src="images/fig_dc_vrp_bgp_cfg_410201.png" width="NaN" height="NaN"></span><br></div>
<p>There are two links between DeviceA and DeviceD, and traffic passes through link DeviceA -&gt; DeviceB -&gt; DeviceC -&gt; DeviceD.</p>
<ul><li>On the network shown in <a href="#EN-US_TASK_0172366257__fig1523333211323">Figure 2</a>, if the link between DeviceB and DeviceC fails, BGP cannot find the next hop route or tunnel for recursion to DeviceC. As a result, traffic is interrupted and is switched to the link DeviceA -&gt; DeviceE -&gt; DeviceF -&gt; DeviceD. In this case, when the next hop recursion changes, the reachability also changes. This is called a critical recursion change.<div class="fignone" id="EN-US_TASK_0172366257__fig1523333211323"><a name="EN-US_TASK_0172366257__fig1523333211323"></a><a name="fig1523333211323"></a><span class="figcap"><b>Figure 2 </b>Networking diagram for a critical recursion change</span><br><span><img class="vsd" src="figure/en-us_image_0000001385732317.png" width="NaN" height="NaN"></span></div>
</li></ul>
<ul><li>On the network shown in <a href="#EN-US_TASK_0172366257__fig1519121912531">Figure 3</a>, when the link between DeviceB and DeviceC is normal, the cost of this link is increased. Due to route selection, traffic is switched to the link DeviceA -&gt; DeviceE -&gt; DeviceF -&gt; DeviceD. In this case, the next hop recursion result changes, but the reachability remains unchanged. This is called a non-critical recursion result change.<div class="fignone" id="EN-US_TASK_0172366257__fig1519121912531"><a name="EN-US_TASK_0172366257__fig1519121912531"></a><a name="fig1519121912531"></a><span class="figcap"><b>Figure 3 </b>Networking diagram for a non-critical recursion change</span><br><span><img class="vsd" src="figure/en-us_image_0000001385087357.png" width="NaN" height="NaN"></span></div>
</li></ul>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Delayed response to BGP next hop recursion changes applies only to scenarios where multiple links exist between the downstream device and the same destination. If there is only one link between the downstream device and the destination, configuring delayed response to BGP next hop recursion changes may cause heavier traffic loss when the link fails because link switching is impossible.</p>
</div></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172366257__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Pre-configuration Tasks</h4><p>Before configuring the BGP next hop recursion change delayed response, complete the following task:</p>
<ul><li><p><a href="dc_vrp_bgp_cfg_3004.html">Configure basic BGP functions.</a></p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172366257__1.4.3"></a><a name="1.4.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Run <span><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span></span><p><p>The system view is displayed.</p>
</p></li><li><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span><p><p>The BGP view is displayed.</p>
</p></li><li><span>Configure delayed response to next hop recursion changes.</span><ul><li>To configure a delay in responding to next hop recursion changes, run the <a href="cmdqueryname=nexthop+recursive-lookup+delay"><b><span class="cmdname">nexthop recursive-lookup delay</span></b></a> [ <i><span class="varname">delay-time</span></i> ] [ <strong><span>include-tunnel</span></strong> ] command. <span>After the command is run, the system delays to respond to both critical and non-critical next hop recursion changes</span>.</li><li>To configure a delay in responding to non-critical next hop recursion changes, run the <a href="cmdqueryname=nexthop+recursive-lookup+non-critical-event+delay"><b><span class="cmdname">nexthop recursive-lookup non-critical-event delay</span></b></a><strong> </strong>[ <em><i><span class="varname">nonCrit-delay-time</span></i></em> ] command.</li><li>To configure a delay in responding to critical next hop recursion changes (from unreachability to reachability), run the <span><a href="cmdqueryname=nexthop+recursive-lookup+critical-event-reachable+delay"><b><span class="cmdname">nexthop recursive-lookup critical-event-reachable delay</span></b></a><strong> </strong>[ <em><i><span class="varname">critReach-delay-time</span></i></em> ] [ <strong><strong><span>include-tunnel</span></strong></strong> ]</span> command.</li></ul>
<p><p><span>These commands can be configured separately or together. If they are all configured, the first command has a lower priority than the <span><a href="cmdqueryname=nexthop+recursive-lookup+non-critical-event+delay"><b><span class="cmdname">nexthop recursive-lookup non-critical-event delay</span></b></a><strong> </strong>[ <em><i><span class="varname">nonCrit-delay-time</span></i></em> ] command</span> or the <span><span><a href="cmdqueryname=nexthop+recursive-lookup+critical-event-reachable+delay"><b><span class="cmdname">nexthop recursive-lookup critical-event-reachable delay</span></b></a><strong> </strong><strong> </strong>[ <em><i><span class="varname">critReach-delay-time</span></i></em> ] [ <strong><strong><span>include-tunnel</span></strong></strong> ] command</span></span>.</span></p>
</p></li><li><span>Run <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span></span><p><p>The configuration is committed.</p>
</p></li></ol></div>
<div class="postreq"><a name="EN-US_TASK_0172366257__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p>After configuring delayed response to BGP next hop recursion changes, you can run the <a href="cmdqueryname=display+current-configuration+configuration+bgp+%7C+include"><b><span class="cmdname">display current-configuration</span></b></a> <strong><span>configuration</span></strong> <strong><span>bgp</span></strong> <strong><span>|</span></strong> <strong><span>include</span></strong> <strong><span>nexthop recursive-lookup</span></strong> command to view the delay in responding to BGP next hop recursion changes.</p>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_3000.html">BGP Configuration
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_4057.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_4052_1.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>