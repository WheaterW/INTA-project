
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Enabling OSPF IP FRR">
<meta name="abstract" content="With OSPF IP FRR and loop-free backup links, a device can switch traffic to a backup link immediately if the primary link fails.">
<meta name="description" content="With OSPF IP FRR and loop-free backup links, a device can switch traffic to a backup link immediately if the primary link fails.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ospf_cfg_2009.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ospf_cfg_2011.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="OSPF">
<meta name="featuretype" content="IP Route">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="OSPF">
<meta name="featuretype" content="IP Route">
<meta name="featurename" content="OSPF">
<meta name="featuretype" content="IP Route">
<meta name="featurename" content="OSPF">
<meta name="featuretype" content="IP Routing Basis">
<meta name="OWNER" content="z00875216">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="z00875216">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172365618">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Enabling OSPF IP FRR</title>
</head>
<body><a name="EN-US_TASK_0172365618"></a><a name="EN-US_TASK_0172365618"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Enabling OSPF IP FRR</h1>
<div class="taskbody"><p>With OSPF IP FRR and loop-free backup links, a device can switch traffic to a backup link immediately if the primary link fails.</p>
<div class="context"><a name="EN-US_TASK_0172365618__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>Perform the following steps on the <span class="keyword">Router</span>:</p>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172365618__1.4.2"></a><a name="1.4.2"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Run <span><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span></span><p><p>The system view is displayed.</p>
</p></li><li><span>Run <span><a href="cmdqueryname=ospf"><b><span class="cmdname">ospf</span></b></a> [ <i><span class="varname">process-id</span></i> | <strong><span>router-id</span></strong> <i><span class="varname">router-id</span></i> | <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i> ] <sup>*</sup></span></span><p><p>An OSPF process is started, and the OSPF view is displayed.</p>
</p></li><li><span>Run <span><a href="cmdqueryname=frr"><b><span class="cmdname">frr</span></b></a></span></span><p><p>The OSPF FRR view is displayed.</p>
</p></li><li><span>Run <a href="cmdqueryname=loop-free-alternate"><b><span class="cmdname">loop-free-alternate</span></b></a></span><p><p>OSPF IP FRR is enabled to generate a loop-free backup link.</p>
</p></li><li><span>(Optional) Run <span><a href="cmdqueryname=frr-policy+route"><b><span class="cmdname">frr-policy route</span></b></a> <span>{ </span><strong><span>route-policy</span></strong> <i><span class="varname">route-policy-name</span></i><span> | <strong><span>route-filter</span></strong> <i><span class="varname">route-filter-name</span></i> }</span></span></span><p><p>An OSPF IP FRR filtering policy is configured.</p>
<p>After the OSPF IP FRR filtering policy is configured, only the OSPF backup routes that match the filtering conditions of the policy can be added to the forwarding table.</p>
</p></li><li><span>To configure remote LFA OSPF IP FRR, perform the following steps:</span><p></p><ol type="a"><li class="substepexpand"><span>Run <span><a href="cmdqueryname=remote-lfa"><b><span class="cmdname">remote-lfa</span></b></a> <strong><span>tunnel</span></strong> <strong><span>ldp</span></strong> [ <strong><span>maximum-reachable-cost</span></strong> <i><span class="varname">cost-value</span></i> ]</span></span><p><p>Remote LFA OSPF IP FRR is enabled.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <span><a href="cmdqueryname=remote-lfa+available-tunnel-destination"><b><span class="cmdname">remote-lfa available-tunnel-destination</span></b></a> <strong><span>ip-prefix</span></strong> <i><span class="varname">ip-prefix-name</span></i></span></span><p><p>A filtering policy is configured to filter PQ nodes.</p>
<p>After a filtering policy is configured, only the nodes that meet the filtering conditions become PQ nodes, which facilitates network optimization.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Return to the OSPF view.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <span><a href="cmdqueryname=avoid-microloop+frr-protected"><b><span class="cmdname">avoid-microloop frr-protected</span></b></a></span></span><p><p>The OSPF microloop avoidance is enabled.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <span><a href="cmdqueryname=avoid-microloop+frr-protected+rib-update-delay"><b><span class="cmdname">avoid-microloop frr-protected rib-update-delay</span></b></a> <i><span class="varname">rib-update-delay</span></i></span></span><p><p>The delay after which OSPF delivers routes is configured.</p>
<p>If OSPF remote LFA FRR is enabled and the primary link fails, traffic is switched to the backup link. If route convergence occurs again, traffic is switched from the backup link to a new primary link. During the switchover, microloop may occur. To prevent this problem, OSPF anti-microloop is enabled and delays the switching. To configure the delay, run the <a href="cmdqueryname=avoid-microloop+frr-protected+rib-update-delay"><b><span class="cmdname">avoid-microloop frr-protected rib-update-delay</span></b></a> command. After the command is run, OSPF does not switch traffic to the backup link until the delay elapses.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=frr"><b><span class="cmdname">frr</span></b></a></span><p><p>The OSPF FRR view is displayed.</p>
</p></li></ol>
</li><li><span>(Optional) Run <a href="cmdqueryname=tiebreaker"><b><span class="cmdname">tiebreaker</span></b></a> { <strong><span>node-protecting</span></strong> | <strong><span>lowest-cost</span></strong> | <strong><span>ldp-sync hold-max-cost</span></strong> | <strong><span>srlg-disjoint</span></strong> } <strong><span>preference</span></strong> <i><span class="varname">value</span></i></span><p><p>The solution of selecting a backup path for OSPF IP FRR is set.</p>
</p><p></p><p><div class="p">By default, the solution of selecting a backup path for OSPF IP FRR is node-protection path first. In actual networking scenarios, the solution may need to be changed to smallest-cost path first due to considerations such as the interface forwarding capability and link cost. In <a href="#EN-US_TASK_0172365618__en-us_cliref_0172379289_fig_tiebreaker_ospf">Figure 1</a>, the primary path is Link-1 (DeviceS -&gt; DeviceE -&gt; DeviceD), and Link-2 and Link-3 (DeviceS -&gt; DeviceN -&gt; DeviceD) are backup path candidates. By default, Link-3 is selected as the backup path. To change the solution of selecting a backup path for OSPF IP FRR to smallest-cost path first so that Link-2 is selected as the backup path, perform this step.<div class="fignone" id="EN-US_TASK_0172365618__en-us_cliref_0172379289_fig_tiebreaker_ospf"><a name="EN-US_TASK_0172365618__en-us_cliref_0172379289_fig_tiebreaker_ospf"></a><a name="en-us_cliref_0172379289_fig_tiebreaker_ospf"></a><span class="figcap"><b>Figure 1 </b>Solution of selecting a backup path for OSPF IP FRR</span><br><span><img class="vsd" src="figure/en-us_image_0000001229453511.png" width="NaN" height="NaN"></span></div>
</div>
<div class="p"><a href="#EN-US_TASK_0172365618__en-us_cliref_0172379289_fig_tiebreaker_ospf02">Figure 2</a> shows an inter-board scenario, where Link-1 (Device A -&gt; Device D) is the primary path, and Link-2 (Device A -&gt; Device E -&gt; Device D) is the backup path. After the primary path Link-1 fails, Link-2 becomes the new primary path, and the new backup path is Link-3 (Device A-&gt;Device B-&gt;Device C-&gt;Device D). If Link-1 goes up again but the LDP session has not gone up, OSPF enters the Hold-max-cost state. Consequently, the primary path is still Link-2, and the backup path is still Link-3. If the LDP session goes up but <strong><span>ldp-sync hold-max-cost</span></strong> is not configured, OSPF exits the Hold-max-cost state when the timer used to delay sending an LDP session Up message expires. In this case, OSPF switches the primary path back to Link-1. Because the upstream and downstream entries reside on different boards and the downstream entry has not been updated when downstream traffic arrives, packet loss occurs. To resolve the problem, configure <strong><span>ldp-sync hold-max-cost</span></strong> so that OSPF preferentially selects the path with the maximum cost set by LDP-IGP synchronization when OSPF is in the Hold-max-cost state. The backup path is switched to Link-1, and backup forwarding entries are delivered in advance. When the timer used to delay sending an LDP session Up message expires, OSPF exits the Hold-max-cost state and switches the primary path to Link-1. Because the downstream backup entry is available, no packet loss occurs.<div class="fignone" id="EN-US_TASK_0172365618__en-us_cliref_0172379289_fig_tiebreaker_ospf02"><a name="EN-US_TASK_0172365618__en-us_cliref_0172379289_fig_tiebreaker_ospf02"></a><a name="en-us_cliref_0172379289_fig_tiebreaker_ospf02"></a><span class="figcap"><b>Figure 2 </b>Maximum-cost (set by LDP-IGP synchronization) path first solution</span><br><span><img class="vsd" src="figure/en-us_image_0000001184213782.png" width="NaN" height="NaN"></span></div>
</div>
</p></li><li><span>Run <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span></span><p><p>The configuration is committed.</p>
</p></li></ol></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ospf_cfg_2009.html">Configuring OSPF IP FRR
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ospf_cfg_2011.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>