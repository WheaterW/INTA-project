
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Importing IPv4 ARP Vlink Direct Routes to BGP">
<meta name="abstract" content="By importing IPv4 ARP Vlink direct routes to BGP, you can enable the remote device to obtain information about detailed routes in the VLAN, allowing precise control of data traffic.">
<meta name="description" content="By importing IPv4 ARP Vlink direct routes to BGP, you can enable the remote device to obtain information about detailed routes in the VLAN, allowing precise control of data traffic.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ip-route_cfg_0023.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ip-route_cfg_0033.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ip-route_cfg_0058.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,w00556928,ip-routevrp,s00526617,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="IP Routing Basis">
<meta name="featuretype" content="IP Route">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="IP Routing Basis">
<meta name="featuretype" content="IP Route">
<meta name="featurename" content="IP Routing Basis">
<meta name="featuretype" content="IP Route">
<meta name="featurename" content="IP Routing Basis">
<meta name="featuretype" content="IP Routing Basis">
<meta name="OWNER" content="z00809835">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="s00826690">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172365388">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Importing IPv4 ARP Vlink Direct Routes to BGP</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172365388"></a><a name="EN-US_TASK_0172365388"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Importing IPv4 ARP Vlink Direct Routes to BGP</h1>
<div class="taskbody"><p>By importing IPv4 ARP Vlink direct routes to BGP, you can enable the remote device to obtain information about detailed routes in the VLAN, allowing precise control of data traffic.</p>
<div class="context"><a name="EN-US_TASK_0172365388__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>As networks develop, the VLAN technology is widely used. If a user outside a VLAN needs to communicate with users within the VLAN, advertising routes destined for the network segment of the VLAN can achieve this purpose. When users outside the VLAN need to know the IPv4 ARP Vlink direct routes of the VLAN, and apply different traffic policies to routes of the VLAN users, advertising the routes destined for the network segment of the VLAN cannot meet this requirement.</p>
<p>In this case, you can enable the function of IPv4 ARP Vlink direct route advertisement. As shown in <a href="#EN-US_TASK_0172365388__fig_dc_vrp_ip-route_cfg_005701">Figure 1</a>, <span class="keyword">Device</span> C is connected to two VLAN sites through VLANIF interfaces. <span class="keyword">Device</span> D communicates with <span class="keyword">Device</span> B, but not with <span class="keyword">Device</span> A. To meet the communication requirement, you can enable the function of IPv4 ARP Vlink direct route advertisement on <span class="keyword">Device</span> C, and use a route-policy to filter out the routes to the network segment of the VLAN and the route to <span class="keyword">Device</span> A.</p>
<div class="fignone" id="EN-US_TASK_0172365388__fig_dc_vrp_ip-route_cfg_005701"><a name="EN-US_TASK_0172365388__fig_dc_vrp_ip-route_cfg_005701"></a><a name="fig_dc_vrp_ip-route_cfg_005701"></a><span class="figcap"><b>Figure 1 </b>Networking diagram of importing IPv4 ARP Vlink direct routes to BGP</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 through 3 in this example represent GE <span>0/1/0</span>, GE <span>0/2/0</span>, and GE <span>0/3/0</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_ip-route_cfg_005701.png"></span><br></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172365388__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Create VLANIF interfaces on Switch A and <span class="keyword">Device</span> C and assign IP addresses to the VLANIF interfaces, and ensure that <span class="keyword">Device</span> A, <span class="keyword">Device</span> B, Switch A, and <span class="keyword">Device</span> C can communicate with each other.</p>
</li><li>Enable BGP on <span class="keyword">Device</span> C and <span class="keyword">Device</span> D, ensuring that <span class="keyword">Device</span> C and <span class="keyword">Device</span> D are able to advertise IP routes to each other.</li><li><p>Enable the function of IPv4 ARP Vlink direct route advertisement on <span class="keyword">Device</span> C.</p>
</li><li><p>Configure a route-policy on <span class="keyword">Device</span> C, allowing routes only from <span class="keyword">Device</span> B to pass through.</p>
</li><li><p>Enable BGP on <span class="keyword">Device</span> C to import direct routes, and use the route-policy to import routes only from <span class="keyword">Device</span> B.</p>
</li><li><p>Associate BGP with the route-policy on <span class="keyword">Device</span> C to filter out the network segment route of the VLAN so that <span class="keyword">Device</span> D cannot learn the network segment route and can communicate with VLAN users based only on IPv4 ARP Vlink direct routes.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172365388__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>ID of the VLAN in which Switch A and <span class="keyword">Device</span> C reside (the VLAN ID is 10 in this example)</p>
</li><li><p>Router IDs and AS numbers of <span class="keyword">Device</span>s C and D (router ID of <span class="keyword">Device</span> C is 3.3.3.3 and router ID of <span class="keyword">Device</span> D is 4.4.4.4, and <span class="keyword">Device</span>s C and D are in AS 100 in this example)</p>
</li><li><p>Route-policy used to filter direct routes (the route-policy is policy1 in this example)</p>
</li><li><p>Route-policy used to advertise BGP routes on <span class="keyword">Device</span> C (the route-policy is policy2 in this example)</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172365388__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure an IP address for each interface.</span><p><p># Configure <span class="keyword">Device</span> A.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt;<strong> system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>]<strong> sysname <span class="keyword">Device</span>A</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A]<strong> interface GigabitEthernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/0</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/0</span>]<strong> ip address 10.1.1.3 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/0</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/0</span>]<strong> quit</strong></pre>
<p># Configure <span class="keyword">Device</span> B.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt;<strong> system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>]<strong> sysname <span class="keyword">Device</span>B</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B]<strong> interface GigabitEthernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/0</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/0</span>]<strong> ip address 10.1.1.4 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/0</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/0</span>]<strong> quit</strong></pre>
<p># Configure <span class="keyword">Device</span> C.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt;<strong> system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>]<strong> sysname <span class="keyword">Device</span>C</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C]<strong> interface GigabitEthernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-GigabitEthernet<span>0/2/0</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-GigabitEthernet<span>0/2/0</span>]<strong> ip address 10.2.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-GigabitEthernet<span>0/2/0</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C-GigabitEthernet<span>0/2/0</span>]<strong> quit</strong></pre>
<p># Configure <span class="keyword">Device</span> D.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt;<strong> system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>]<strong> sysname <span class="keyword">Device</span>D</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>D]<strong> interface GigabitEthernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-GigabitEthernet<span>0/1/0</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-GigabitEthernet<span>0/1/0</span>]<strong> ip address 10.2.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-GigabitEthernet<span>0/1/0</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>D-GigabitEthernet<span>0/1/0</span>]<strong> quit</strong></pre>
</p></li><li><span>Configure basic VLAN functions. Create VLANIF 10 on Switch A and <span class="keyword">Device</span> C and assign IP addresses to the VLANIF interfaces.</span><p><p># Configure Switch A.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt;<strong> system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>]<strong> sysname SwitchA</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SwitchA]<strong> vlan 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SwitchA-vlan10]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SwitchA]<strong> interface GigabitEthernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>SwitchA-GigabitEthernet<span>0/1/0</span>]<strong> portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SwitchA-GigabitEthernet<span>0/1/0</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SwitchA-GigabitEthernet<span>0/1/0</span>]<strong> port link-type access</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SwitchA-GigabitEthernet<span>0/1/0</span>]<strong> port default vlan 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SwitchA-GigabitEthernet<span>0/1/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SwitchA]<strong> interface GigabitEthernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>SwitchA-GigabitEthernet<span>0/2/0</span>]<strong> portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SwitchA-GigabitEthernet<span>0/2/0</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SwitchA-GigabitEthernet<span>0/2/0</span>]<strong> port link-type access</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SwitchA-GigabitEthernet<span>0/2/0</span>]<strong> port default vlan 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SwitchA-GigabitEthernet<span>0/2/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SwitchA]<strong> interface GigabitEthernet <span>0/3/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>SwitchA-GigabitEthernet<span>0/3/0</span>]<strong> portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SwitchA-GigabitEthernet<span>0/3/0</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SwitchA-GigabitEthernet<span>0/3/0</span>]<strong> port link-type access</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SwitchA-GigabitEthernet<span>0/3/0</span>]<strong> port default vlan 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SwitchA-GigabitEthernet<span>0/3/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SwitchA]<strong> interface Vlanif 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SwitchA-Vlanif10]<strong> ip address 10.1.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SwitchA-Vlanif10]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SwitchA-Vlanif10]<strong> quit</strong></pre>
<p># Configure <span class="keyword">Device</span> C.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C]<strong> vlan 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-vlan10]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C]<strong> interface GigabitEthernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-GigabitEthernet<span>0/1/0</span>]<strong> portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-GigabitEthernet<span>0/1/0</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-GigabitEthernet<span>0/1/0</span>]<strong> port link-type access</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-GigabitEthernet<span>0/1/0</span>]<strong> port default vlan 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-GigabitEthernet<span>0/1/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C]<strong> interface Vlanif 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-Vlanif10]<strong> ip address 10.1.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-Vlanif10]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C-Vlanif10]<strong> quit</strong></pre>
</p></li><li><span>Configure BGP between <span class="keyword">Device</span> C and <span class="keyword">Device</span> D.</span><p><p># Configure <span class="keyword">Device</span> C.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C]<strong> bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp]<strong> router-id 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp]<strong> peer 10.2.1.2 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C-bgp]<strong> quit</strong></pre>
<p># Configure <span class="keyword">Device</span> D.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>D]<strong> bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-bgp]<strong> router-id 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-bgp]<strong> peer 10.2.1.1 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-bgp]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>D-bgp]<strong> quit</strong></pre>
</p></li><li><span>Configure BGP on <span class="keyword">Device</span> C and import direct routes to BGP. Then view the routing tables of <span class="keyword">Device</span>s C and D.</span><p><p># Configure <span class="keyword">Device</span> C.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C]<strong> bgp 100</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C-bgp]<strong> import-route direct</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C-bgp]<strong> quit</strong></pre>
<p># Display the BGP routing table of <span class="keyword">Device</span> C.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C]<strong> display bgp routing-table</strong></pre>
<pre class="screen"> BGP Local router ID is 3.3.3.3
 Status codes: * - valid, &gt; - best, d - damped,<span> x - best external,</span><span> a - add path,</span>
               h - history,  i - internal, s - suppressed, S - Stale
               Origin : i - IGP, e - EGP, ? - incomplete
<span> RPKI validation codes: V - valid, I - invalid, N - not-found</span>

 Total Number of Routes: 9
      Network            NextHop        MED        LocPrf    PrefVal Path/Ogn

 *&gt;   10.1.1.0/24        0.0.0.0         0                     0      ?
 *&gt;   10.1.1.1/32        0.0.0.0         0                     0      ?
 *&gt;   10.1.1.2/32        0.0.0.0         0                     0      ?
 *&gt;   10.2.1.0/24        0.0.0.0         0                     0      ?
 *&gt;   10.2.1.1/32        0.0.0.0         0                     0      ?
 *&gt;   127.0.0.0          0.0.0.0         0                     0      ?
 *&gt;   127.0.0.1/32       0.0.0.0         0                     0      ?
</pre>
<p># Display the BGP routing table of <span class="keyword">Device</span> D.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>D]<strong> display bgp routing-table</strong></pre>
<pre class="screen"> BGP Local router ID is 4.4.4.4
 Status codes: * - valid, &gt; - best, d - damped,<span> x - best external,</span><span> a - add path,</span>
               h - history,  i - internal, s - suppressed, S - Stale
               Origin : i - IGP, e - EGP, ? - incomplete
<span> RPKI validation codes: V - valid, I - invalid, N - not-found</span>

 Total Number of Routes: 2
      Network            NextHop        MED        LocPrf    PrefVal Path/Ogn

 *&gt;i  10.1.1.0/24        10.2.1.1        0          100        0      ?
   i  10.2.1.0/24        10.2.1.1        0          100        0      ?
</pre>
<p>You can see that <span class="keyword">Device</span> D has not learned the two IPv4 ARP Vlink direct routes 10.1.1.3/32 and 10.1.1.4/32.</p>
</p></li><li><span>Enable the function of IPv4 ARP Vlink direct route advertisement on <span class="keyword">Device</span> C and configure the route-policy <strong>policy1</strong> to filter out the routes to the network segment of the VLAN and the IPv4 ARP Vlink direct route from <span class="keyword">Device</span> A, 10.1.1.3/32.</span><p><p># Configure <span class="keyword">Device</span> C.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C]<strong> ip ip-prefix prefix1 permit 10.1.1.4 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C]<strong> route-policy policy1 permit node 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-route-policy]<strong> if-match ip-prefix prefix1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-route-policy]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C]<strong> arp vlink-direct-route advertise route-policy policy1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C]<strong> commit</strong></pre>
<p># Display the BGP routing table of <span class="keyword">Device</span> C.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C]<strong> display bgp routing-table</strong></pre>
<pre class="screen"> BGP Local router ID is 3.3.3.3
 Status codes: * - valid, &gt; - best, d - damped,<span> x - best external,</span><span> a - add path,</span>
               h - history,  i - internal, s - suppressed, S - Stale
               Origin : i - IGP, e - EGP, ? - incomplete
<span> RPKI validation codes: V - valid, I - invalid, N - not-found</span>

 Total Number of Routes: 9
      Network            NextHop        MED        LocPrf    PrefVal Path/Ogn

 *&gt;   10.1.1.0/24        0.0.0.0         0                     0      ?
 *&gt;   10.1.1.1/32        0.0.0.0         0                     0      ?
 *&gt;   10.1.1.2/32        0.0.0.0         0                     0      ?
 *&gt;   10.1.1.3/32        0.0.0.0         0                     0      ?
 *&gt;   10.1.1.4/32        0.0.0.0         0                     0      ?
 *&gt;   10.2.1.0/24        0.0.0.0         0                     0      ?
 *&gt;   10.2.1.1/32        0.0.0.0         0                     0      ?
 *&gt;   127.0.0.0          0.0.0.0         0                     0      ?
 *&gt;   127.0.0.1/32       0.0.0.0         0                     0      ?
</pre>
<p># Display the BGP routing table of <span class="keyword">Device</span> D.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>D]<strong> display bgp routing-table</strong></pre>
<pre class="screen"> BGP Local router ID is 4.4.4.4
 Status codes: * - valid, &gt; - best, d - damped,<span> x - best external,</span><span> a - add path,</span>
               h - history,  i - internal, s - suppressed, S - Stale
               Origin : i - IGP, e - EGP, ? - incomplete
<span> RPKI validation codes: V - valid, I - invalid, N - not-found</span>

 Total Number of Routes: 3
      Network            NextHop        MED        LocPrf    PrefVal Path/Ogn

 *&gt;i  10.1.1.0/24        10.2.1.1        0          100        0      ?
 *&gt;i  10.1.1.4/32        10.2.1.1        0          100        0      ?
   i  10.2.1.0/24        10.2.1.1        0          100        0      ?
</pre>
<p>You can see that <span class="keyword">Device</span> D has learned the IPv4 ARP Vlink direct route 10.1.1.4/32, whereas the route 10.1.1.3/32 has been filtered out.</p>
</p></li><li><span>Use the route-policy <strong>policy2</strong> to filter out the network segment route 10.1.1.0/24 on <span class="keyword">Device</span> C when BGP routes are advertised.</span><p><p># Configure <span class="keyword">Device</span> C.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C]<strong> ip ip-prefix prefix2 index 10 deny 10.1.1.0 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C]<strong> ip ip-prefix prefix2 index 20 permit 0.0.0.0 0 less-equal 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C]<strong> route-policy policy2 permit node 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-route-policy]<strong> if-match ip-prefix prefix2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-route-policy]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C]<strong> bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp]<strong> peer 10.2.1.2 route-policy policy2 export</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C-bgp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C]<strong> quit</strong></pre>
<pre class="screen">&lt;<span class="keyword">Device</span>C&gt;<strong> refresh bgp all export</strong></pre>
<p># Display the BGP routing table of <span class="keyword">Device</span> D.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>D]<strong> display bgp routing-table</strong></pre>
<pre class="screen"> BGP Local router ID is 4.4.4.4
 Status codes: * - valid, &gt; - best, d - damped,<span> x - best external,</span><span> a - add path,</span>
               h - history,  i - internal, s - suppressed, S - Stale
               Origin : i - IGP, e - EGP, ? - incomplete
<span> RPKI validation codes: V - valid, I - invalid, N - not-found</span>

 Total Number of Routes: 2
      Network            NextHop        MED        LocPrf    PrefVal Path/Ogn

 *&gt;i  10.1.1.4/32        10.2.1.1        0          100        0      ?
   i  10.2.1.0/24        10.2.1.1        0          100        0      ?
</pre>
<p>You can find that the route 10.1.1.0/24 does not exist in the BGP routing table of <span class="keyword">Device</span> D. As a result, <span class="keyword">Device</span> D can communicate with <span class="keyword">Device</span> B, but cannot communicate with <span class="keyword">Device</span> A.</p>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172365388__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>Switch A configuration file</p>
<pre class="screen">#
sysname SwitchA
#
vlan batch 10
#
interface Vlanif10
 ip address 10.1.1.2 255.255.255.0
#
interface GigabitEthernet<span>0/1/0</span>
 portswitch
 undo shutdown
 port link-type access
 port default vlan 10
#
interface GigabitEthernet<span>0/2/0</span>
 portswitch
 undo shutdown
 port link-type access
 port default vlan 10
#
interface GigabitEthernet<span>0/3/0</span>
 portswitch
 undo shutdown
 port link-type access
 port default vlan 10
#
return</pre>
</li><li><p><span class="keyword">Device</span> A configuration file</p>
<pre class="screen">#
sysname <span class="keyword">Device</span>A
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.1.3 255.255.255.0
#
return</pre>
</li><li><p><span class="keyword">Device</span> B configuration file</p>
<pre class="screen">#
sysname <span class="keyword">Device</span>B
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.1.4 255.255.255.0
#
return</pre>
</li><li><p><span class="keyword">Device</span> C configuration file</p>
<pre class="screen">#
sysname <span class="keyword">Device</span>C
#
ip ip-prefix prefix1 index 10 permit 10.1.1.4 32
ip ip-prefix prefix2 index 10 deny 10.1.1.0 24
ip ip-prefix prefix2 index 20 permit 0.0.0.0 0 less-equal 32
#
route-policy policy1 permit node 10
 if-match ip-prefix prefix1
#
route-policy policy2 permit node 10
 if-match ip-prefix prefix2
#
arp vlink-direct-route advertise route-policy policy1
#
vlan batch 10
#
interface Vlanif10
 ip address 10.1.1.1 255.255.255.0
#
interface GigabitEthernet<span>0/1/0</span>
 portswitch
 undo shutdown
 port link-type access
 port default vlan 10
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.2.1.1 255.255.255.0
#
bgp 100
 router-id 3.3.3.3
 peer 10.2.1.2 as-number 100
 #
 ipv4-family unicast
  undo synchronization 
  import-route direct
  peer 10.2.1.2 enable
  peer 10.2.1.2 route-policy policy2 export
#
return
</pre>
</li><li><p><span class="keyword">Device</span> D configuration file</p>
<pre class="screen">#
sysname <span class="keyword">Device</span>D
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.2.1.2 255.255.255.0
#
#
bgp 100
 router-id 4.4.4.4
 peer 10.2.1.1 as-number 100
 #
 ipv4-family unicast
  undo synchronization 
  peer 10.2.1.1 enable
#
return
</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ip-route_cfg_0023.html">Configuration Examples for IP Routing Basis
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ip-route_cfg_0033.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ip-route_cfg_0058.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>