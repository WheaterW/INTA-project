
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="AS_Path">
<meta name="abstract" content="BGP prefers the route with the shortest AS_Path length (the number of included ASs) during BGP route selection.">
<meta name="description" content="BGP prefers the route with the shortest AS_Path length (the number of included ASs) during BGP route selection.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_path_selection_0003.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_path_selection_0008.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_path_selection_0010.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Route">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Route">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Route">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Route">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing Basis">
<meta name="OWNER" content="l00425560">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00615954">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_CONCEPT_0172366326">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>AS_Path</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_CONCEPT_0172366326"></a><a name="EN-US_CONCEPT_0172366326"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">AS_Path</h1>
<div><p>BGP prefers the route with the shortest AS_Path length (the number of included ASs) during BGP route selection.</p>
<p>Four types of AS_Path attributes are available: AS_Sequence, AS_Set, AS_Confed_Sequence, and AS_Confed_Set.</p>
<ul><li><p>AS_Sequence: records in reverse order all the ASs through which a route passes from the local device to the destination.</p>
</li><li><p>AS_Set: records in random order all the ASs through which a route passes from the local device to the destination. The AS_Set attribute is used in route summarization scenarios.</p>
</li><li><p>AS_Confed_Sequence: records in reverse order all the sub-ASs within a BGP confederation through which a route passes from the local device to the destination.</p>
</li><li><p>AS_Confed_Set: records in random order all the sub-ASs within a BGP confederation through which a route passes from the local device to the destination.</p>
</li></ul>
<div class="p"><a href="#EN-US_CONCEPT_0172366326__table_dc_vrp_path_selection_000901">Table 1</a> describes the AS_Path-based route selection rules.
<div class="tableBorder"><a name="EN-US_CONCEPT_0172366326__table_dc_vrp_path_selection_000901"></a><a name="table_dc_vrp_path_selection_000901"></a><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" id="EN-US_CONCEPT_0172366326__table_dc_vrp_path_selection_000901" frame="border" border="1" rules="all"><caption><b>Table 1 </b>AS_Path-based route selection rules</caption><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="35%" id="mcps1.4.3.2.2.3.1.1" liSelected="liSelected"><p>Item</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="65%" id="mcps1.4.3.2.2.3.1.2" liSelected="liSelected"><p>Description</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" valign="top" width="35%" headers="mcps1.4.3.2.2.3.1.1 "><p>AS_Set</p>
</td>
<td class="cellrowborder" valign="top" width="65%" headers="mcps1.4.3.2.2.3.1.2 "><p>Regardless of how many AS numbers are contained in an AS_Set, BGP considers its length to be 1 during route selection.</p>
<div class="p">When the <a href="cmdqueryname=aggregate+%28BGP%29+as-set"><b><span class="cmdname">aggregate (BGP)</span></b></a> command is run to manually generate a summary route, if <strong><span>as-set</span></strong> is specified in the command, an AS_Set will be carried in the summary route. Otherwise, no AS_Set will be carried. When an AS_Set is generated:<ul><li>If the routes to be summarized have the same AS_Sequence, the AS_Sequence of the summary route also contains this AS_Sequence, and the AS_Set of the summary route is null.</li><li>If the routes to be summarized have different AS_Sequences, all the AS numbers in the AS_Sequences are included in the AS_Set after summarization.</li></ul>
</div>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="35%" headers="mcps1.4.3.2.2.3.1.1 "><p>AS_Confed_Sequence and AS_Confed_Set</p>
</td>
<td class="cellrowborder" valign="top" width="65%" headers="mcps1.4.3.2.2.3.1.2 "><p>BGP ignores AS_Confed_Sequence and AS_Confed_Set when calculating the AS_Path length.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="35%" headers="mcps1.4.3.2.2.3.1.1 "><p><a href="cmdqueryname=bestroute+as-path-ignore"><b><span class="cmdname">bestroute as-path-ignore</span></b></a></p>
</td>
<td class="cellrowborder" valign="top" width="65%" headers="mcps1.4.3.2.2.3.1.2 "><p>After the command is run, BGP does not compare the AS_Path attributes during route selection.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="35%" headers="mcps1.4.3.2.2.3.1.1 "><p><a href="cmdqueryname=apply+as-path"><b><span class="cmdname">apply as-path</span></b></a></p>
</td>
<td class="cellrowborder" valign="top" width="65%" headers="mcps1.4.3.2.2.3.1.2 "><p>You can run this command in a route-policy to clear, replace, or add AS numbers.</p>
<div class="note"><span class="notetitle"> NOTE: </span><div class="notebody"><p>The configuration of the <a href="cmdqueryname=apply+as-path"><b><span class="cmdname">apply as-path</span></b></a> command may change the traffic forwarding path, or cause routing loops or route selection errors. Therefore, exercise caution when configuring the command.</p>
</div></div>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="35%" headers="mcps1.4.3.2.2.3.1.1 "><p><a href="cmdqueryname=peer+public-as-only"><b><span class="cmdname">peer public-as-only</span></b></a></p>
</td>
<td class="cellrowborder" valign="top" width="65%" headers="mcps1.4.3.2.2.3.1.2 "><p>After the command is run, BGP removes all the private AS numbers (if any) from the AS_Path attribute in each Update message to be sent. The private AS number ranges from 64512 to 65534 and from 4200000000 to 4294967294 (or from 64086.59904 to 65535.65534).</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="35%" headers="mcps1.4.3.2.2.3.1.1 "><p><a href="cmdqueryname=peer+public-as-only+import"><b><span class="cmdname">peer public-as-only import</span></b></a></p>
</td>
<td class="cellrowborder" valign="top" width="65%" headers="mcps1.4.3.2.2.3.1.2 "><p>After the command is run, BGP removes all the private AS numbers (if any) from the AS_Path attribute in each received Update message. The private AS number ranges from 64512 to 65534 and from 4200000000 to 4294967294 (or from 64086.59904 to 65535.65534).</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="35%" headers="mcps1.4.3.2.2.3.1.1 "><p><a href="cmdqueryname=peer+fake-as"><b><span class="cmdname">peer fake-as</span></b></a></p>
</td>
<td class="cellrowborder" valign="top" width="65%" headers="mcps1.4.3.2.2.3.1.2 "><p>After the command is run, BGP can use a fake AS number to set up a BGP peer relationship.</p>
<p>If the local device uses the actual AS number to establish an EBGP peer relationship with a remote device, the actual AS number is carried in the AS_Path of the route sent to the remote device. If the local device uses the fake AS number to establish the EBGP peer relationship, the fake AS number is carried in the AS_Path of the route to be sent to the remote device.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="35%" headers="mcps1.4.3.2.2.3.1.1 "><p><a href="cmdqueryname=peer+substitute-as"><b><span class="cmdname">peer substitute-as</span></b></a></p>
</td>
<td class="cellrowborder" valign="top" width="65%" headers="mcps1.4.3.2.2.3.1.2 "><div class="p">After the command is run, if the AS_Path attribute in the route that a PE will send to a peer (CE) contains an AS number the same as that of the CE, the PE replaces the AS number in the AS_Path attribute with its local AS number before advertising this route.<div class="note"><span class="notetitle"> NOTE: </span><div class="notebody"><p>The <a href="cmdqueryname=peer+substitute-as"><b><span class="cmdname">peer substitute-as</span></b></a> command applies only to PEs in BGP MPLS IP/VPN scenarios and may cause routing loops if it is improperly configured. Therefore, exercise caution when using the command.</p>
</div></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>During BGP route selection, BGP compares the AS_Path length by calculating the number of ASs included in the AS_Sequence if AS_Sequence is carried in a route. If both AS_Sequence and AS_Set are carried in the route, BGP considers the AS_Path length to be the number of ASs included in the AS_Sequence plus 1. The following describes some common commands in detail by using examples.</p>
<div class="section"><h4 class="sectiontitle">Deleting Private AS Numbers</h4><div class="p">As public AS resources are limited, carriers generally use private AS numbers when deploying VPNs. Private AS numbers, however, must not be advertised to the Internet because they may cause routing loops. In <a href="#EN-US_CONCEPT_0172366326__fig_dc_vrp_bgp_path_selection_000901">Figure 1</a>, both ISP1 and ISP2 use 65001 as a private AS number.<div class="fignone" id="EN-US_CONCEPT_0172366326__fig_dc_vrp_bgp_path_selection_000901"><a name="EN-US_CONCEPT_0172366326__fig_dc_vrp_bgp_path_selection_000901"></a><a name="fig_dc_vrp_bgp_path_selection_000901"></a><span class="figcap"><b>Figure 1 </b>Networking in which a private AS needs to be deleted</span><br><span><img class="vsd" src="images/fig_dc_vrp_bgp_path_selection_000901.png" width="NaN" height="NaN"></span></div>
</div>
<p>In <a href="#EN-US_CONCEPT_0172366326__fig_dc_vrp_bgp_path_selection_000901">Figure 1</a>, <span class="keyword">Device</span> A advertises the route 10.0.0.0/8 to <span class="keyword">Device</span> D through ISP1 and ISP2. After receiving this route, <span class="keyword">Device</span> D checks the AS_Path attribute. This AS_Path attribute carries AS 65001, which is the same as the AS number of <span class="keyword">Device</span> D. As a result, <span class="keyword">Device</span> D discards this route.</p>
<p>To address this problem, run the <a href="cmdqueryname=peer+public-as-only"><b><span class="cmdname">peer public-as-only</span></b></a> command on <span class="keyword">Device</span> B so that <span class="keyword">Device</span> B in ISP1 deletes AS 65001 (private AS number) before adding AS 100 (its own AS number) to the AS_Path attribute and advertising the route to <span class="keyword">Device</span> C in ISP2.</p>
<div class="p">Before using the <a href="cmdqueryname=peer+public-as-only"><b><span class="cmdname">peer public-as-only</span></b></a> command, note the following restrictions: BGP does not remove private AS numbers in the following scenarios:<ul><li><p>The AS_Path of a route carries the AS number of the remote peer. In this case, deleting private AS numbers may lead to a routing loop.</p>
</li><li><p>The AS_Path carries both public and private AS numbers, which indicates that the route has passed through the public network. In this case, deleting private AS numbers may lead to incorrect traffic forwarding.</p>
</li></ul>
The preceding limitations also apply to confederation scenarios.</div>
</div>
<div class="section"><h4 class="sectiontitle">Adding AS Numbers</h4><div class="p">In <a href="#EN-US_CONCEPT_0172366326__fig_dc_vrp_bgp_path_selection_000902">Figure 2</a>, AS 65005 imports three routes and advertises them to AS 65001 through two paths.<div class="fignone" id="EN-US_CONCEPT_0172366326__fig_dc_vrp_bgp_path_selection_000902"><a name="EN-US_CONCEPT_0172366326__fig_dc_vrp_bgp_path_selection_000902"></a><a name="fig_dc_vrp_bgp_path_selection_000902"></a><span class="figcap"><b>Figure 2 </b>Networking in which new AS numbers are added to the AS_Path</span><br><span><img class="vsd" src="images/fig_dc_vrp_bgp_path_selection_000902.png" width="NaN" height="NaN"></span></div>
</div>
<p>Run the <a href="cmdqueryname=display+bgp+routing-table"><b><span class="cmdname">display bgp routing-table</span></b></a> [ <i><span class="varname">ip-address</span></i> ] command to verify the configuration.</p>
<p># Display the routing table of <span class="keyword">Device</span>A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>display bgp routing-table</strong></pre>
<pre class="screen"> BGP Local router ID is 10.1.1.1
 Status codes: * - valid, &gt; - best, d - damped, x - best external, a - add path,
               h - history,  i - internal, s - suppressed, S - Stale
               Origin : i - IGP, e - EGP, ? - incomplete
 RPKI validation codes: V - valid, I - invalid, N - not-found

 Total Number of Routes: 6
      Network            NextHop        MED        LocPrf    PrefVal Path/Ogn

 *&gt;   172.16.1.0/24      10.1.3.2                              0      65003 65005?
 *                       10.1.1.2                              0      65002 65004 65005?
 *&gt;   172.16.2.0/24      10.1.3.2                              0      65003 65005?
 *                       10.1.1.2                              0      65002 65004 65005?
 *&gt;   172.16.3.0/24      10.1.3.2                              0      65003 65005?
 *                       10.1.1.2                              0      65002 65004 65005?</pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>display bgp routing-table 172.16.1.0</strong></pre>
<pre class="screen"> BGP local router ID : 10.1.1.1
 Local AS number : 65001
 Paths:   2 available, 1 best, 1 select
 BGP routing table entry information of 172.16.1.0/24:
 From: 10.1.3.2 (10.1.5.1)
 Route Duration: 00h00m56s
 Direct Out-interface: GigabitEthernet<span>0/1/0</span>
 Original nexthop: 10.1.3.2
 Qos information : 0x0
 <strong>AS-path 65003 65005</strong>, origin incomplete, pref-val 0, valid, external, <strong>best</strong>, select, active, pre 255
 Advertised to such 2 peers:
    10.1.3.2
    10.1.1.2
 BGP routing table entry information of 172.16.1.0/24:
 From: 10.1.1.2 (10.1.1.2)
 Route Duration: 00h34m43s
 Direct Out-interface: GigabitEthernet<span>0/2/0</span>
 Original nexthop: 10.1.1.2
 Qos information : 0x0
 <strong>AS-path 65002 65004 65005</strong>, origin incomplete, pref-val 0, valid, external, pre 255, <strong>not preferred for AS-Path</strong>
 Not advertised to any peer yet</pre>
<p>The preceding command output shows that <span class="keyword">Device</span>A selects the route learned from <span class="keyword">Device</span>C because this route has a shorter AS_Path length than that learned from <span class="keyword">Device</span>B. To enable <span class="keyword">Device</span>A to select the route learned from <span class="keyword">Device</span>B, configure <span class="keyword">Device</span>B to reduce the AS_Path length of the route or configure <span class="keyword">Device</span>C to increase the AS_Path length of the route. In the following example, <span class="keyword">Device</span>C is configured to increase the AS_Path length of the route. The detailed configurations on <span class="keyword">Device</span>C are as follows:</p>
<pre class="screen">#
bgp 65003
 #
 ipv4-family unicast
  undo synchronization
   peer 10.1.3.1 route-policy add_asn export            //Apply export policy named add_asn to the routes to be advertised to BGP peer 10.1.3.1.
  #
route-policy add_asn permit node 10                     //Define the first node of add_asn.
 if-match ip-prefix prefix1                             //Configure IP prefix list named prefix1.
 apply as-path 65003 65003 65003 additive               //Add 65003, 65003, 65003 to the AS_Path of the route that matches the IP prefix list prefix1.
#
route-policy add_asn permit node 20                     //Define the second node of add_asn to permit all other routes.
#
ip ip-prefix prefix1 index 10 permit 172.16.1.0 24      //Define the first index of prefix1 to match the route 172.16.1.0/24.
ip ip-prefix prefix1 index 20 permit 172.16.2.0 24      //Define the second index of prefix1 to match the route 172.16.2.0/24.
ip ip-prefix prefix1 index 30 permit 172.16.3.0 24      //Define the third index of prefix1 to match the route 172.16.3.0/24.
#</pre>
<p>Run the <a href="cmdqueryname=display+bgp+routing-table"><b><span class="cmdname">display bgp routing-table</span></b></a> [ <i><span class="varname">ip-address</span></i> ] command to verify the configuration.</p>
<p># Display the routing table of <span class="keyword">Device</span>A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>display bgp routing-table</strong></pre>
<pre class="screen"> BGP Local router ID is 10.1.1.1
 Status codes: * - valid, &gt; - best, d - damped, x - best external, a - add path,
               h - history,  i - internal, s - suppressed, S - Stale
               Origin : i - IGP, e - EGP, ? - incomplete
 RPKI validation codes: V - valid, I - invalid, N - not-found

 Total Number of Routes: 6
      Network            NextHop        MED        LocPrf    PrefVal Path/Ogn

 *&gt;   172.16.1.0/24      10.1.1.2                              0      65002 65004 65005?
 *                       10.1.3.2                              0      65003 65003 65003 65003 65005?
 *&gt;   172.16.2.0/24      10.1.1.2                              0      65002 65004 65005?
 *                       10.1.3.2                              0      65003 65003 65003 65003 65005?
 *&gt;   172.16.3.0/24      10.1.1.2                              0      65002 65004 65005?
 *                       10.1.3.2                              0      65003 65003 65003 65003 65005?</pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>display bgp routing-table 172.16.1.0</strong></pre>
<pre class="screen"> BGP local router ID : 10.1.1.1
 Local AS number : 65001
 Paths:   2 available, 1 best, 1 select
 BGP routing table entry information of 172.16.1.0/24:
 From: 10.1.1.2 (10.1.1.2)
 Route Duration: 00h33m30s
 Direct Out-interface: GigabitEthernet<span>0/1/0</span>
 Original nexthop: 10.1.1.2
 Qos information : 0x0
 <strong>AS-path 65002 65004 65005</strong>, origin incomplete, pref-val 0, valid, external, <strong>best</strong>, select, active, pre 255
 Advertised to such 2 peers:
    10.1.3.2
    10.1.1.2
 BGP routing table entry information of 172.16.1.0/24:
 From: 10.1.3.2 (10.1.5.1)
 Route Duration: 00h02m12s
 Direct Out-interface: GigabitEthernet<span>0/2/0</span>
 Original nexthop: 10.1.3.2
 Qos information : 0x0
 <strong>AS-path 65003 65003 65003 65003 65005</strong>, origin incomplete, pref-val 0, valid, external, pre 255, <strong>not preferred for AS-Path</strong>
 Not advertised to any peer yet</pre>
<div class="p">The preceding command output shows that the AS_Path length of the route learned from <span class="keyword">Device</span>B is shorter than that of the route learned from <span class="keyword">Device</span>C and that the route learned from <span class="keyword">Device</span>B is selected as the optimal route. <a href="#EN-US_CONCEPT_0172366326__tab_dc_vrp_bgp_path_selection_000902">Table 2</a> shows the attribute comparison of the routes that <span class="keyword">Device</span>A learns from <span class="keyword">Device</span>B and <span class="keyword">Device</span>C.
<div class="tableBorder"><a name="EN-US_CONCEPT_0172366326__tab_dc_vrp_bgp_path_selection_000902"></a><a name="tab_dc_vrp_bgp_path_selection_000902"></a><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" id="EN-US_CONCEPT_0172366326__tab_dc_vrp_bgp_path_selection_000902" frame="border" border="1" rules="all"><caption><b>Table 2 </b>Attribute comparison of the routes that <span class="keyword">Device</span>A learns from <span class="keyword">Device</span>B and <span class="keyword">Device</span>C</caption><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="25%" id="mcps1.4.6.17.8.2.5.1.1" liSelected="liSelected"><p>Route Attribute</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="25%" id="mcps1.4.6.17.8.2.5.1.2" liSelected="liSelected"><p>Route Learned from <span class="keyword">Device</span>B</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="25%" id="mcps1.4.6.17.8.2.5.1.3" liSelected="liSelected"><p>Route Learned from <span class="keyword">Device</span>C</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="25%" id="mcps1.4.6.17.8.2.5.1.4" liSelected="liSelected"><p>Comparison</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" valign="top" width="25%" headers="mcps1.4.6.17.8.2.5.1.1 "><p>PrefVal</p>
</td>
<td class="cellrowborder" valign="top" width="25%" headers="mcps1.4.6.17.8.2.5.1.2 "><p>0</p>
</td>
<td class="cellrowborder" valign="top" width="25%" headers="mcps1.4.6.17.8.2.5.1.3 "><p>0</p>
</td>
<td class="cellrowborder" valign="top" width="25%" headers="mcps1.4.6.17.8.2.5.1.4 "><p>The same.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="25%" headers="mcps1.4.6.17.8.2.5.1.1 "><p>Local_Pref</p>
</td>
<td class="cellrowborder" valign="top" width="25%" headers="mcps1.4.6.17.8.2.5.1.2 "><p>-</p>
</td>
<td class="cellrowborder" valign="top" width="25%" headers="mcps1.4.6.17.8.2.5.1.3 "><p>-</p>
</td>
<td class="cellrowborder" valign="top" width="25%" headers="mcps1.4.6.17.8.2.5.1.4 "><p>The same.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="25%" headers="mcps1.4.6.17.8.2.5.1.1 "><p>Route type</p>
</td>
<td class="cellrowborder" valign="top" width="25%" headers="mcps1.4.6.17.8.2.5.1.2 "><p>Learned from a peer</p>
</td>
<td class="cellrowborder" valign="top" width="25%" headers="mcps1.4.6.17.8.2.5.1.3 "><p>Learned from a peer</p>
</td>
<td class="cellrowborder" valign="top" width="25%" headers="mcps1.4.6.17.8.2.5.1.4 "><p>The same.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="25%" headers="mcps1.4.6.17.8.2.5.1.1 "><p>AIGP</p>
</td>
<td class="cellrowborder" valign="top" width="25%" headers="mcps1.4.6.17.8.2.5.1.2 "><p>-</p>
</td>
<td class="cellrowborder" valign="top" width="25%" headers="mcps1.4.6.17.8.2.5.1.3 "><p>-</p>
</td>
<td class="cellrowborder" valign="top" width="25%" headers="mcps1.4.6.17.8.2.5.1.4 "><p>The same.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="25%" headers="mcps1.4.6.17.8.2.5.1.1 "><p>AS_Path</p>
</td>
<td class="cellrowborder" valign="top" width="25%" headers="mcps1.4.6.17.8.2.5.1.2 "><p>65002 65004 65005</p>
</td>
<td class="cellrowborder" valign="top" width="25%" headers="mcps1.4.6.17.8.2.5.1.3 "><p>65003 65003 65003 65003 65005</p>
</td>
<td class="cellrowborder" valign="top" width="25%" headers="mcps1.4.6.17.8.2.5.1.4 "><p>The route learned from <span class="keyword">Device</span>B is optimal.</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>AS numbers can be added to the AS_Path as required. However, if an AS number is added to the AS_Path of a route, the route cannot be received by devices in this AS. Therefore, the local AS number is added in most cases. For example in <a href="#EN-US_CONCEPT_0172366326__fig_dc_vrp_bgp_path_selection_000902">Figure 2</a>, if <span class="keyword">Device</span>C adds AS 65001 to the AS_Path of a route before advertising the route to <span class="keyword">Device</span>A, <span class="keyword">Device</span>A will discard the route upon receipt because the route carries <span class="keyword">Device</span>A's AS number.</p>
</div>
<div class="section"><h4 class="sectiontitle">Replacing AS Numbers</h4><div class="p">If <strong><span>overwrite</span></strong> is specified in the <a href="cmdqueryname=apply+as-path+overwrite"><b><span class="cmdname">apply as-path</span></b></a> command, the AS numbers in the AS_Path attribute can be replaced. AS number replacement can be flexibly applied to serve the following purposes:<ul><li><p>Shield the actual path information.</p>
</li><li><p>Prevent a route from being discarded by replacing the AS_Path attribute of the route with a shorter one if the <a href="cmdqueryname=as-path-limit"><b><span class="cmdname">as-path-limit</span></b></a> command is run on the device that receives this route.</p>
</li><li><p>Shorten the AS_Path length so that the route is preferentially selected.</p>
</li></ul>
</div>
<p>AS number replacement can also be used for the purpose of load balancing. Generally, BGP requires that the AS_Path attributes of the routes be the same so that load balancing can be implemented. To meet load balancing requirements, AS numbers can be replaced. For example in <a href="#EN-US_CONCEPT_0172366326__fig_dc_vrp_bgp_path_selection_000902">Figure 2</a>, the <strong>apply as-path 65002 65004 65005 overwrite</strong> command can be run on <span class="keyword">Device</span>A to replace the AS_Path of the route learned from <span class="keyword">Device</span>C so that the route has the same AS_Path as that of the route learned from <span class="keyword">Device</span>B, and the two routes are used to load-balance traffic. Detailed configurations on <span class="keyword">Device</span>A are as follows:</p>
<pre class="screen">#
bgp 65001
 #
 ipv4-family unicast
  undo synchronization
   peer 10.1.3.2 route-policy replace_asn import        //Apply export policy named replace_asn to routes to be advertised to BGP peer 10.1.3.2.
  #
route-policy replace_asn permit node 10                 //Define the first node of replace_asn.
 if-match as-path-filter filter1                        //Configure AS_Path filter named filter1.
 apply as-path 65002 65004 65005 overwrite              //Replace the AS_Path of the route that matches filter1 with 65002, 65004, 65005.
#
route-policy replace_asn permit node 20                 //Define the second node of replace_asn to permit all other routes.
#
ip as-path-filter filter1 permit ^65003                 //Define AS_Path filter named filter1 to match all the routes learned from AS 65003.
#</pre>
<p>Run the <a href="cmdqueryname=display+bgp+routing-table"><b><span class="cmdname">display bgp routing-table</span></b></a> [ <i><span class="varname">ip-address</span></i> ] command to verify the configuration.</p>
<p># Display the routing table of <span class="keyword">Device</span>A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>display bgp routing-table</strong></pre>
<pre class="screen"> BGP Local router ID is 10.1.1.1
 Status codes: * - valid, &gt; - best, d - damped, x - best external, a - add path,
               h - history,  i - internal, s - suppressed, S - Stale
               Origin : i - IGP, e - EGP, ? - incomplete
 RPKI validation codes: V - valid, I - invalid, N - not-found

 Total Number of Routes: 6
      Network            NextHop        MED        LocPrf    PrefVal Path/Ogn

 *&gt;   172.16.1.0/24      10.1.1.2                              0      65002 65004 65005?
 *                       10.1.3.2                              0      65002 65004 65005?
 *&gt;   172.16.2.0/24      10.1.1.2                              0      65002 65004 65005?
 *                       10.1.3.2                              0      65002 65004 65005?
 *&gt;   172.16.3.0/24      10.1.1.2                              0      65002 65004 65005?
 *                       10.1.3.2                              0      65002 65004 65005?</pre>
<p>The preceding command output shows that the AS_Path of the route received from AS 65003 has been replaced. In this case, the routes sent from AS 65002 and AS 65003 have the same AS_Path, which meets the load balancing conditions. Run the <strong>maximum load-balancing 2</strong> command on <span class="keyword">Device</span>A to set the maximum number of routes for load balancing to 2. Then, check the detailed BGP route information. The route 172.16.1.0/24 is used in the following example:</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>display bgp routing-table 172.16.1.0</strong></pre>
<pre class="screen"> BGP local router ID : 10.1.1.1
 Local AS number : 65001
 Paths:   2 available, 1 best, 2 select
 BGP routing table entry information of 172.16.1.0/24:
 From: 10.1.1.2 (10.1.1.2)
 Route Duration: 19h57m51s
 Direct Out-interface: GigabitEthernet<span>0/1/0</span>
 Original nexthop: 10.1.1.2
 Qos information : 0x0
 AS-path 65002 65004 65005, origin incomplete, pref-val 0, valid, external, <strong>best</strong>, <strong>select</strong>, active, pre 255
 Advertised to such 2 peers:
    10.1.1.2
    10.1.3.2
 BGP routing table entry information of 172.16.1.0/24:
 From: 10.1.3.2 (10.1.5.1)
 Route Duration: 00h10m21s
 Direct Out-interface: GigabitEthernet<span>0/2/0</span>
 Original nexthop: 10.1.3.2
 Qos information : 0x0
 AS-path 65002 65004 65005, origin incomplete, pref-val 0, valid, external, <strong>select</strong>, active, pre 255, <strong>not preferred for router ID</strong>
 Not advertised to any peer yet</pre>
<p>The preceding command output shows that the route learned from <span class="keyword">Device</span>B is optimal and is used by BGP along with the route learned from <span class="keyword">Device</span>C (not optimal) for load balancing. Check the information about the route 172.16.1.0/24 in the IP routing table.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>display ip routing-table</strong></pre>
<pre class="screen"><span class="keyword">Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route</span>
------------------------------------------------------------------------------
Routing Table : _Public_
         Destinations : 9        Routes : 12

Destination/Mask    Proto   Pre  Cost      Flags NextHop         Interface

       10.1.1.0/30  Direct  0    0           D   10.1.1.1        GigabitEtherne<span>0/2/0</span>
       10.1.1.1/32  Direct  0    0           D   127.0.0.1       GigabitEthernet<span>0/2/0</span>
       10.1.3.0/30  Direct  0    0           D   10.1.3.1        GigabitEthernet<span>0/1/0</span>
       10.1.3.1/32  Direct  0    0           D   127.0.0.1       GigabitEthernet<span>0/1/0</span>
      127.0.0.0/8   Direct  0    0           D   127.0.0.1       InLoopBack0
      127.0.0.1/32  Direct  0    0           D   127.0.0.1       InLoopBack0
     172.16.1.0/24  EBGP    255  0           D   10.1.1.2        GigabitEthernet<span>0/2/0</span>
                    EBGP    255  0           D   10.1.3.2        GigabitEthernet<span>0/1/0</span>
     172.16.2.0/24  EBGP    255  0           D   10.1.1.2        GigabitEthernet<span>0/2/0</span>
                    EBGP    255  0           D   10.1.3.2        GigabitEthernet<span>0/1/0</span>
     172.16.3.0/24  EBGP    255  0           D   10.1.1.2        GigabitEthernet<span>0/2/0</span>
                    EBGP    255  0           D   10.1.3.2        GigabitEthernet<span>0/1/0</span></pre>
<p>The preceding command output shows that BGP has delivered the two routes with the same route prefix to the IP routing table for load balancing.</p>
</div>
<div class="section"><h4 class="sectiontitle">Clearing the AS_Path</h4><p>If <strong><span>none</span></strong> <strong><span>overwrite</span></strong> is specified in the <a href="cmdqueryname=apply+as-path+none+overwrite"><b><span class="cmdname">apply as-path</span></b></a> command, the device clears the AS_Path attribute to shield the actual path information and shorten the AS_Path length. If the AS_Path attribute is empty, BGP considers its length as 0 during route selection.</p>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_path_selection_0003.html">Route Attributes
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_path_selection_0008.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_path_selection_0010.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>