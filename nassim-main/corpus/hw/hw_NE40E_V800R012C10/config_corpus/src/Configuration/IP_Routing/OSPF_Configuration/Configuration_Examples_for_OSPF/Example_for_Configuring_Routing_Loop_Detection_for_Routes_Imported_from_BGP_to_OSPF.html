
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Routing Loop Detection for Routes Imported from BGP to OSPF">
<meta name="abstract" content="This section describes how to configure routing loop detection for routes imported from BGP to OSPF.">
<meta name="description" content="This section describes how to configure routing loop detection for routes imported from BGP to OSPF.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ospf_cfg_0093.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ospf_cfg_0103.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ospf_cfg_0115.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="OSPF">
<meta name="featuretype" content="IP Route">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="OSPF">
<meta name="featuretype" content="IP Route">
<meta name="featurename" content="OSPF">
<meta name="featuretype" content="IP Route">
<meta name="featurename" content="OSPF">
<meta name="featuretype" content="IP Routing Basis">
<meta name="OWNER" content="z00875216">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="z00875216">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001208254515">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/thickbox.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/imageResize.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery-migrate-1.2.1.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery-ui.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery.mousewheel.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/thickbox.js"></script>
<title>Example for Configuring Routing Loop Detection for Routes Imported from BGP to OSPF</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001208254515"></a><a name="EN-US_TASK_0000001208254515"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Routing Loop Detection for Routes Imported from BGP to OSPF</h1>
<div class="taskbody"><p>This section describes how to configure routing loop detection for routes imported from BGP to OSPF.</p>
<div class="context"><a name="EN-US_TASK_0000001208254515__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the live network, OSPF routes can be imported to a BGP process for redistribution. In such a scenario, routing policies are usually configured on multiple devices to prevent routing loops. If routing policies are incorrectly configured on the devices that import routes, routing loops may occur. To prevent this problem, configure routing loop detection for the routes imported to OSPF.</p>
<p>On the network shown in <a href="#EN-US_TASK_0000001208254515__fig1261541011544">Figure 1</a>, IBGP peer relationships are established between <span class="keyword">Device</span>A and <span class="keyword">Device</span>B, between <span class="keyword">Device</span>B and <span class="keyword">Device</span>C, between <span class="keyword">Device</span>C and <span class="keyword">Device</span>D, and between <span class="keyword">Device</span>B and <span class="keyword">Device</span>D; an OSPF process is configured on <span class="keyword">Device</span>C and <span class="keyword">Device</span>D. OSPF is configured to import BGP routes on <span class="keyword">Device</span>C, and BGP is configured to import OSPF routes on <span class="keyword">Device</span>D.</p>
<div class="fignone" id="EN-US_TASK_0000001208254515__fig1261541011544"><a name="EN-US_TASK_0000001208254515__fig1261541011544"></a><a name="fig1261541011544"></a><span class="figcap"><b>Figure 1 </b>Routing loop detection for routes imported from BGP to OSPF</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface1, interface2, and interface3 represent GE<span>0/1/0</span>, GE<span>0/2/0</span>, and GE<span>0/3/0</span>, respectively.</p>
</div></div>
<br><span><img class="imgResize" src="figure/en-us_image_0000001208533273.png" width="521.383275" height="320.5593062175001" title="Click to enlarge"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001208254515__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Precautions</h4><p>To improve security, OSPF area authentication or interface authentication is recommended. For details, see "Improving OSPF Network Security". OSPF area authentication is used as an example. For details, see Example for Configuring Basic OSPF Functions.</p>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001208254515__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure IP addresses for interfaces on each device.</p>
</li><li><p>Enable OSPF and BGP, and configure basic OSPF and BGP functions.</p>
</li><li>Configure route import to construct a routing loop.</li><li><p>Check whether a routing loop occurs.</p>
</li><li>Enable routing loop detection to check whether the routing loop is eliminated.</li></ol>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001208254515__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Assign an IP address to each interface.</span><p><p><span class="keyword">Device</span>A is used as an example.</p>
<pre class="screen">&lt;<span class="keyword">Device</span>A&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>interface</strong> <strong>gigabitethernet <span>0/1/0</span></strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/0</span>] <strong>ip address 10.12.1.1 24</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
<p>The configurations of other devices are similar to those of <span class="keyword">Device</span>A. For configuration details, see <a href="#EN-US_TASK_0000001208254515__section_dc_vrp_isis_cfg_201205">Configuration Files</a> in this section.</p>
<p>In addition, configure a static route on <span class="keyword">Device</span>A to simulate a looped route.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>ip route-static 10.0.0.0 255.255.255.255 NULL0</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
</p></li><li><span>Enable OSPF and BGP, and configure basic OSPF and BGP functions to implement intra-AS communication.</span><p><p># Enable BGP on <span class="keyword">Device</span>A, and establish an IBGP peer relationship between <span class="keyword">Device</span>A and <span class="keyword">Device</span>B.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>bgp 100</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp] <strong>router-id 1.11.1.1</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp] <strong>peer 10.12.1.2 as-number 100</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp] <strong>ipv4-family unicast</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp-af-ipv4] <strong>peer 10.12.1.2 enable</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp] <strong>quit</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
<p># Enable BGP on <span class="keyword">Device</span>B and establish IBGP peer relationships between <span class="keyword">Device</span>B and <span class="keyword">Device</span>A, between <span class="keyword">Device</span>B and <span class="keyword">Device</span>C, and between <span class="keyword">Device</span>B and <span class="keyword">Device</span>D.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>bgp 100</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp] <strong>router-id 2.22.2.2</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp] <strong>peer 10.12.1.1 as-number 100</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp] <strong>peer 10.23.1.3 as-number 100</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp] <strong>peer 10.24.1.4 as-number 100</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp] <strong>ipv4-family unicast</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp-af-ipv4] <strong>peer 10.12.1.1 enable</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp-af-ipv4] <strong>peer 10.23.1.3 enable</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp-af-ipv4] <strong>peer 10.24.1.4 enable</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp-af-ipv4] <strong>peer 10.23.1.3 reflect-client</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp] <strong>quit</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>commit</strong></pre>
<p># Enable BGP on <span class="keyword">Device</span>C, and establish an IBGP peer relationship between <span class="keyword">Device</span>C and <span class="keyword">Device</span>B.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C] <strong>bgp 100</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp] <strong>router-id 3.33.3.3</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp] <strong>peer 10.23.1.2 as-number 100</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp] <strong>ipv4-family unicast</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp-af-ipv4] <strong>peer 10.23.1.2 enable</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp] <strong>quit</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>C] <strong>commit</strong></pre>
<p># Enable BGP on <span class="keyword">Device</span>D, and establish an IBGP peer relationship between <span class="keyword">Device</span>D and <span class="keyword">Device</span>B.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>D] <strong>bgp 100</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>D-bgp] <strong>router-id 4.44.4.4</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>D-bgp] <strong>peer 10.24.1.2 as-number 100</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>D-bgp] <strong>ipv4-family unicast</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>D-bgp-af-ipv4] <strong>peer 10.24.1.2 enable</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>D-bgp] <strong>quit</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>D] <strong>commit</strong></pre>
<p># Configure OSPF on <span class="keyword">Device</span>C and <span class="keyword">Device</span>D. <span class="keyword">Device</span>C is used as an example.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C] <strong>ospf 1 router-id 3.33.3.3</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>C-ospf-1] <strong>area 0</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>C-ospf-1-area-0.0.0.0] <strong>network 10.34.1.0 0.0.0.255</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>C-ospf-1-area-0.0.0.0] <strong>quit</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>C-ospf-1] <strong>quit</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>C] <strong>commit</strong></pre>
</p></li><li><span>Configure route import.</span><p><p># Configure OSPF on <span class="keyword">Device</span>C to import BGP routes.</p>
</p><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C] <strong>ospf 1</strong> <strong>router-id 3.33.3.3</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>C-ospf-1] <strong>import-route bgp permit-ibgp</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>C-ospf-1] <strong>opaque-capability enable</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>C-ospf-1] <strong>quit</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>C] <strong>commit</strong></pre>
<p># Configure BGP on <span class="keyword">Device</span>D to import OSPF routes.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>D] <strong>bgp 100</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>D-bgp] <strong>ipv4-family unicast</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>D-bgp-af-ipv4] <strong>import-route ospf 1</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>D-bgp] <strong>quit</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>D] <strong>commit</strong></pre>
</p></li><li><span>View the routing table on each device to check whether a routing loop occurs.</span><p><p># Check BGP peer information on <span class="keyword">Device</span>B.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>display bgp peer</strong></pre>
<pre class="screen"> BGP local router ID : 2.22.2.2
 Local AS number : 100
 Total number of peers : 3                 Peers in established state : 3

  Peer                              V          AS  MsgRcvd  MsgSent  OutQ  Up/Down       State   PrefRcv
  <strong>10.12.1.1</strong>                         4         100      453      458     0 06:30:47 <strong>Established</strong>        1
  <strong>10.23.1.3</strong>                         4         100      452      458     0 06:30:46 <strong>Established</strong>        0
  <strong>10.24.1.4</strong>                         4         100      451      457     0 06:29:39 <strong>Established</strong>        3</pre>
<p># Check OSPF neighbor information on <span class="keyword">Device</span>C.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C] <strong>display ospf peer</strong></pre>
<pre class="screen">(M) Indicates MADJ neighbor


          OSPF Process 1 with Router ID 3.33.3.3
                Neighbors

 Area 0.0.0.0 interface 10.34.1.3 (GigabitEthernet<span>0/1/0</span>)'s neighbors
 <strong>Router ID: 4.44.4.4             Address: 10.34.1.4</strong>
   <strong>State: Full</strong>           Mode:Nbr is Master     Priority: 1
   DR: 10.34.1.4          BDR: 10.34.1.3          MTU: 0
   Dead timer due in  31  sec
   Retrans timer interval: 5
   Neighbor is up for 06h28m21s
   Neighbor Up Time : 2021-08-27 02:59:32
   Authentication Sequence: [ 0 ]</pre>
<p># Check OSPF neighbor information on <span class="keyword">Device</span>D.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>D] <strong>display ospf peer</strong></pre>
<pre class="screen">(M) Indicates MADJ neighbor


          OSPF Process 1 with Router ID 4.44.4.4
                Neighbors

 Area 0.0.0.0 interface 10.34.1.4 (GigabitEthernet<span>0/2/0</span>)'s neighbors
 R<strong>outer ID: 3.33.3.3             Address: 10.34.1.3</strong>
   <strong>State: Full</strong>           Mode:Nbr is Slave      Priority: 1
   DR: 10.34.1.4          BDR: 10.34.1.3          MTU: 0
   Dead timer due in  32  sec
   Retrans timer interval: 5
   Neighbor is up for 06h28m25s
   Neighbor Up Time : 2021-08-27 02:59:32
   Authentication Sequence: [ 0 ]</pre>
<p>The preceding command outputs show that BGP peer relationships and OSPF neighbor relationships have been established between the devices.</p>
<p># Check the BGP routing table on <span class="keyword">Device</span>B.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>display bgp routing-table 10.0.0.0</strong></pre>
<pre class="screen"> BGP local router ID : 2.22.2.2
 Local AS number : 100
 Paths:   2 available, 1 best, 1 select, 0 best-external, 0 add-path
 BGP routing table entry information of 10.0.0.0/32:
 RR-client route.
 <strong>From: 10.24.1.4 (4.44.4.4)</strong>
 Route Duration: 0d00h00m52s
 Relay IP Nexthop: 10.24.1.4
 Relay IP Out-Interface: GigabitEthernet<span>0/1/0</span>
 Original nexthop: 10.24.1.4
 Qos information : 0x0
 AS-path Nil, origin incomplete, MED 1, localpref 100, pref-val 0, valid, internal, best, select, pre 255
 Advertised to such 3 peers:
    10.23.1.3
    10.24.1.4
    10.12.1.1

 BGP routing table entry information of 10.0.0.0/32:
 From: 10.12.1.1 (1.11.1.1)
 Route Duration: 0d22h53m22s
 Relay IP Nexthop: 10.12.1.1
 Relay IP Out-Interface:GigabitEthernet<span>0/2/0</span>
 Original nexthop: 10.12.1.1
 Qos information : 0x0
 AS-path 10, origin incomplete, MED 0, localpref 100, pref-val 0, valid, internal, pre 255, not preferred for AS-Path
 Not advertised to any peer yet</pre>
<p>The preceding command output shows that <span class="keyword">Device</span>B has learned the BGP route distributed by <span class="keyword">Device</span>D.</p>
<p># Check the BGP routing table of <span class="keyword">Device</span>C.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C] <strong>display bgp routing-table 10.0.0.0</strong></pre>
<pre class="screen"> BGP local router ID : 3.33.3.3
 Local AS number : 100
 Paths:   1 available, 1 best, 1 select, 0 best-external, 0 add-path
 BGP routing table entry information of 10.0.0.0/32:
<strong> From: 10.23.1.2 (2.22.2.2)</strong>
 Route Duration: 0d07h12m30s
 Relay IP Nexthop: 0.0.0.0
 Relay IP Out-Interface: NULL0
 Original nexthop: 10.12.1.1
 Qos information : 0x0
 AS-path 10, origin incomplete, MED 0, localpref 100, pref-val 0, valid, internal, best, select, pre 255
 Originator: 1.11.1.1
 Cluster list: 2.22.2.2
 Not advertised to any peer yet</pre>
<p>The preceding command output shows that <span class="keyword">Device</span>C has learned the BGP route distributed by <span class="keyword">Device</span>B.</p>
<p># Check the routing table of <span class="keyword">Device</span>D.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>D] <strong>display ospf routing 10.0.0.0</strong></pre>
<pre class="screen">          OSPF Process 1 with Router ID 4.44.4.4

 Destination    : 10.0.0.0/32
 AdverRouter    : 3.33.3.3                 Tag                 : 1
 Cost           : 1                        Type                : Type2
 NextHop        : <strong>10.34.1.3</strong>               Interface           : GigabitEthernet<span>0/2/0</span>
 Priority       : Medium                   Age                 : 01h31m18s</pre>
<p>The preceding command output shows that <span class="keyword">Device</span>D has learned the OSPF route distributed by <span class="keyword">Device</span>C.</p>
</p><p><p>This means that a routing loop occurs among <span class="keyword">Device</span>B, <span class="keyword">Device</span>C, and <span class="keyword">Device</span>D.</p>
</p></li><li><span>Enable routing loop detection on each device.</span><p><p># Enable routing loop detection for routes imported to OSPF and BGP. <span class="keyword">Device</span>A is used as an example.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>route loop-detect ospf enable</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>route loop-detect bgp enable</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
</p><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In the case of inter-protocol route import, if a routing protocol with a higher preference detects a routing loop, although this protocol increases the cost of the corresponding route, the cost increase will not render the route inactive. As a result, the routing loop cannot be eliminated. If the routing protocol with a lower preference is used for such processing, this route competes with the originally imported route during route selection. In this case, the routing loop can be eliminated. OSPF has a higher preference than BGP. Therefore, to eliminate the routing loop, BGP needs to reduce the preference of the corresponding route.</p>
</div></div>
</p></li><li><span>Check whether the routing loop is eliminated.</span><p><p># Check the BGP routing table on <span class="keyword">Device</span>B.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>display bgp routing-table 10.0.0.0</strong></pre>
<pre class="screen"> BGP local router ID : 2.22.2.2
 Local AS number : 100
 Paths:   1 available, 1 best, 1 select, 0 best-external, 0 add-path
 BGP routing table entry information of 10.0.0.0/32:
 <strong>From:</strong> <strong>10.12.1.1 (1.11.1.1)</strong>
 Route Duration: 1d00h10m02s
 Relay IP Nexthop: 10.12.1.1
 Relay IP Out-Interface: GigabitEthernet<span>0/2/0</span>
 Original nexthop: 10.12.1.1
 Qos information : 0x0
 AS-path 10, origin incomplete, MED 0, localpref 100, pref-val 0, valid, internal, best, select, pre 255
 Advertised to such 2 peers:
    10.23.1.3
    10.24.1.4</pre>
<p>The preceding command output shows that <span class="keyword">Device</span>B has learned the route distributed by <span class="keyword">Device</span>A and that <span class="keyword">Device</span>B no longer prefers the route distributed by <span class="keyword">Device</span>D. This means that the routing loop among <span class="keyword">Device</span>B, <span class="keyword">Device</span>C, and <span class="keyword">Device</span>D is eliminated.</p>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0000001208254515__section_dc_vrp_isis_cfg_201205"><a name="EN-US_TASK_0000001208254515__section_dc_vrp_isis_cfg_201205"></a><a name="section_dc_vrp_isis_cfg_201205"></a><a name="EN-US_TASK_0000001208254515__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p><span class="keyword">Device</span>A configuration file</p>
<pre class="screen">#
sysname <span class="keyword">Device</span>A
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.12.1.1 255.255.255.0
#
bgp 100
 router-id 1.11.1.1
 private-4-byte-as enable
 peer 10.12.1.2 as-number 100
 #
 ipv4-family unicast
  undo synchronization
  import-route static
  peer 10.12.1.2 enable
#
ip route-static 10.0.0.0 255.255.255.255 NULL0
#
route loop-detect ospf enable
#
route loop-detect bgp enable
#
return</pre>
</li><li><p><span class="keyword">Device</span>B configuration file</p>
<pre class="screen">#
sysname <span class="keyword">Device</span>B
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.12.1.2 255.255.255.0
#
interface GigabitEthernet<span>0/3/0</span>
 undo shutdown
 ip address 10.24.1.2 255.255.255.0
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.23.1.2 255.255.255.0
#
bgp 100
 router-id 2.22.2.2
 private-4-byte-as enable
 peer 10.12.1.1 as-number 100
 peer 10.23.1.3 as-number 100
 peer 10.24.1.4 as-number 100
 #
 ipv4-family unicast
  undo synchronization
  peer 10.12.1.1 enable
  peer 10.23.1.3 enable
  peer 10.23.1.3 reflect-client
  peer 10.24.1.4 enable
  peer 10.24.1.4 reflect-client
#
route loop-detect ospf enable
#
route loop-detect bgp enable
#
return</pre>
</li><li><p><span class="keyword">Device</span>C configuration file</p>
<pre class="screen">#
sysname <span class="keyword">Device</span>C
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.34.1.3 255.255.255.0
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.23.1.3 255.255.255.0
#
bgp 100
 router-id 3.33.3.3
 private-4-byte-as enable
 peer 10.23.1.2 as-number 100
 #
 ipv4-family unicast
  undo synchronization
  peer 10.23.1.2 enable
#
ospf 1 router-id 3.33.3.3
 import-route bgp permit-ibgp
 opaque-capability enable
 area 0.0.0.0
  network 10.34.1.0 0.0.0.255
#
route loop-detect ospf enable
#
route loop-detect bgp enable
#
return</pre>
</li><li><p><span class="keyword">Device</span>D configuration file</p>
<pre class="screen">#
sysname <span class="keyword">Device</span>D
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.34.1.4 255.255.255.0
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.24.1.4 255.255.255.0
#
bgp 100
 router-id 4.44.4.4
 private-4-byte-as enable
 peer 10.24.1.2 as-number 100
 #
 ipv4-family unicast
  undo synchronization
  import-route ospf 1
  peer 10.24.1.2 enable
#
ospf 1 router-id 4.44.4.4
 opaque-capability enable
 area 0.0.0.0
  network 10.34.1.0 0.0.0.255
#
route loop-detect ospf enable
#
route loop-detect bgp enable
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ospf_cfg_0093.html">Configuration Examples for OSPF
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ospf_cfg_0103.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ospf_cfg_0115.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>

<script language="JavaScript">
<!--
image_size('.imgResize');
var msg_imageMax = "view original image";
var msg_imageClose = "close";
//--></script></body>
</html>