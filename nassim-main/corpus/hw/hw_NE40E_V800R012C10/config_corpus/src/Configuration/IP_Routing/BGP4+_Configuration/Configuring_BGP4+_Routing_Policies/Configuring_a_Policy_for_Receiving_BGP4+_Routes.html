
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring a Policy for Receiving BGP4+ Routes">
<meta name="abstract" content="BGP4+ filters received routes using a policy. Only the routes that match the policy can be added to a routing table.">
<meta name="description" content="BGP4+ filters received routes using a policy. Only the routes that match the policy can be added to a routing table.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp6_cfg_0027.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp6_cfg_0030.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp6_cfg_0032.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="BGP IPv6">
<meta name="featuretype" content="IP Route">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP IPv6">
<meta name="featuretype" content="IP Route">
<meta name="featurename" content="BGP IPv6">
<meta name="featuretype" content="IP Route">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing Basis">
<meta name="OWNER" content="l00425560">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00615954">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172366454">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring a Policy for Receiving BGP4+ Routes</title>
</head>
<body><a name="EN-US_TASK_0172366454"></a><a name="EN-US_TASK_0172366454"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring a Policy for Receiving BGP4+ Routes</h1>
<div class="taskbody"><p>BGP4+ filters received routes using a policy. Only the routes that match the policy can be added to a routing table.</p>
<div class="context"><a name="EN-US_TASK_0172366454__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>BGP4+ can apply a routing policy to all received routes or only routes received from a specific peer (group). If multiple filter policies are configured, BGP accepts only routes that match all the filter policies.</p>
<p>If a BGP4+ <span class="keyword">Router</span> is maliciously attacked or network configuration errors occur, the device will receive a large number of routes from its peers. As a result, a large number of resources are consumed on the device. To prevent this issue, the administrator must limit the resources to be consumed during device operation based on the network planning and <span class="keyword">Router</span> capacity. BGP4+ provides peer-specific route control to limit the number of routes sent from a peer or peer group.</p>
</div></div>
<div class="steps-unordered"><a name="EN-US_TASK_0172366454__1.4.2"></a><a name="1.4.2"></a><h4 class="sectiontitle">Procedure</h4>
<ul><li><span>Configure BGP4+ to filter all received routes.</span><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>BGP4+ acceptance policies take effect in the following sequence:</p>
<ol><li>Globally received routes:<p>To configure a basic ACL-based acceptance policy, run the <a href="cmdqueryname=filter-policy+acl6-name+import"><b><span class="cmdname">filter-policy</span></b></a> { <i><span class="varname">acl6-number</span></i> | <strong><span>acl6-name</span></strong> <i><span class="varname">acl6-name</span></i>} <strong><span>import</span></strong> command.</p>
<p>To configure an IP prefix list-based acceptance policy, run the <a href="cmdqueryname=filter-policy+ipv6-prefix+import"><b><span class="cmdname">filter-policy</span></b></a> <strong><span>ipv6-prefix</span></strong> <i><span class="varname">ipv6-prefix-name</span></i> <strong><span>import</span></strong> command.</p>
</li><li>To configure a basic ACL-based policy for accepting routes from a specified peer or peer group, run the <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">ipv6-address</span></i> | <i><span class="varname">group-name</span></i> } <a href="cmdqueryname=filter-policy+acl6-name+import"><b><span class="cmdname">filter-policy</span></b></a> { <i><span class="varname">acl6-number</span></i> | <strong><span>acl6-name</span></strong> <i><span class="varname">acl6-name</span></i> } <strong><span>import</span></strong> command.</li><li>To configure an AS_Path filter-based policy for accepting routes from a specified peer or peer group, run the <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">ipv6-address</span></i> | <i><span class="varname">group-name</span></i> } <a href="cmdqueryname=as-path-filter+import"><b><span class="cmdname">as-path-filter</span></b></a> { <i><span class="varname">number</span></i> | <i><span class="varname">name</span></i> } <strong><span>import</span></strong> command.</li><li>To configure an IP prefix list-based policy for accepting routes from a specified peer or peer group, run the <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">ipv6-address</span></i> | <i><span class="varname">group-name</span></i> } <a href="cmdqueryname=ipv6-prefix+import"><b><span class="cmdname">ipv6-prefix</span></b></a> <i><span class="varname">ipv6-prefix-name</span></i> <strong><span>import</span></strong> command.</li><li>To configure a route-policy-based policy for accepting routes from a specified peer or peer group, run the <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">ipv6-address</span></i> | <i><span class="varname">group-name</span></i> } <a href="cmdqueryname=route-policy+import"><b><span class="cmdname">route-policy</span></b></a> <i><span class="varname">route-policy-name</span></i> <strong><span>import</span></strong> command.</li></ol>
</div></div>
</p><ol><li class="substepexpand"><span>Run <span><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span></span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=ipv6-family"><b><span class="cmdname">ipv6-family</span></b></a> <strong><span>unicast</span></strong></span></span><p><p>The IPv6 unicast address family view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=filter-policy+acl6-name+ipv6-prefix"><b><span class="cmdname">filter-policy</span></b></a> { <i><span class="varname">acl6-number</span></i> | <strong><span>acl6-name</span></strong> <i><span class="varname">acl6-name</span></i> | <strong><span>ipv6-prefix</span></strong> <i><span class="varname">ipv6-prefix-name</span></i> } <a href="cmdqueryname=import"><b><span class="cmdname">import</span></b></a></span></span><p><p>A policy is configured to filter all received BGP4+ routes.</p>
<p>Only the routes that match the policy are accepted by BGP4+ and added to the routing table.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li><span>Apply a routing policy to the routes received from a specified peer or peer group.</span><ol><li class="substepexpand"><span>Run <span><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span></span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=ipv6-family"><b><span class="cmdname">ipv6-family</span></b></a> <strong><span>unicast</span></strong></span></span><p><p>The IPv6 unicast address family view is displayed.</p>
</p></li><li class="substepexpand"><span>Filter the routes received from peers based on different filters:</span><p><ul><li>Based on a basic ACL:<ol type="a"><li>Run <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">ipv6-address</span></i> | <i><span class="varname">group-name</span></i> } <a href="cmdqueryname=filter-policy+acl6-name+import"><b><span class="cmdname">filter-policy</span></b></a> { <i><span class="varname">acl6-number</span></i> | <strong><span>acl6-name</span></strong> <i><span class="varname">acl6-name</span></i> } <strong><span>import</span></strong><p>The routes to be received from the specified peer or peer group are filtered.</p>
</li><li><p>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></p>
<p>Return to the BGP view.</p>
</li><li><p>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></p>
<p>Return to the system view.</p>
</li><li>Run <span><a href="cmdqueryname=acl+ipv6+name+basic+number+match-order+config+auto"><b><span class="cmdname">acl ipv6</span></b></a> { <strong><span>name</span></strong> <i><span class="varname">basic-acl6-name</span></i> <strong><span>basic</span></strong> | [ <strong><span>number</span></strong> ] <i><span class="varname">basic-acl6-number</span></i> } [ <strong><span>match-order</span></strong> { <strong><span>config</span></strong> | <strong><span>auto</span></strong> } ]</span><p>The ACL view is displayed.</p>
</li><li><p>Run <a href="cmdqueryname=rule+name+deny+permit"><b><span class="cmdname">rule</span></b></a> [ <i><span class="varname">rule-id</span></i> ] [ <strong><span>name</span></strong> <i><span class="varname">rule-name</span></i> ] { <strong><span>deny</span></strong> | <strong><span>permit</span></strong> }</p>
<p>An ACL rule is configured.</p>
<p>When the <a href="cmdqueryname=rule"><b><span class="cmdname">rule</span></b></a> command is used to configure a filtering rule for a named ACL, only the configurations specified by <strong><span>source</span></strong> and <strong><span>time-range</span></strong> take effect.</p>
<div class="p">When a filter-policy of a routing protocol is used to filter routes:<ul><li><p>If the action specified in an ACL rule is <strong>permit</strong>, a route matching the rule will be accepted or advertised by the system.</p>
</li><li><p>If the action specified in an ACL rule is <strong>deny</strong>, a route matching the rule will not be accepted or advertised by the system.</p>
</li><li><p>If the network segment of a route is not within the range specified in an ACL rule, the route will not be accepted or advertised by the system.</p>
</li><li><p>If an ACL does not contain any rules, none of the routes matched against the filter-policy that uses this ACL will be accepted or advertised by the system.</p>
</li><li><p>Routes can be filtered using a blacklist or whitelist:</p>
<p>If ACL rules are used for matching in configuration order, the system matches the rules in ascending order of their IDs.</p>
<p>Filtering using a blacklist: Configure a rule with a smaller ID and specify the action <strong>deny</strong> in this rule to filter out the unwanted routes. Then, configure another rule with a larger ID in the same ACL and specify the action <strong>permit</strong> in this rule to accept or advertise the other routes.</p>
<p>Filtering using a whitelist: Configure a rule with a smaller ID and specify the action <strong>permit</strong> in this rule to permit the routes to be accepted or advertised. Then, configure another rule with a larger ID in the same ACL and specify the action <strong>deny</strong> in this rule to filter out the unwanted routes.</p>
</li></ul>
</div>
</li></ol>
</li><li><p>To use the AS_Path filter for route filtering, run the <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">ipv6-address</span></i> | <i><span class="varname">group-name</span></i> } <a href="cmdqueryname=as-path-filter+import"><b><span class="cmdname">as-path-filter</span></b></a> { <i><span class="varname">number</span></i> | <i><span class="varname">name</span></i> } <strong><span>import</span></strong> command.</p>
</li><li><p>To use an IP prefix list for route filtering, run the <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">ipv6-address</span></i> | <i><span class="varname">group-name</span></i> } <a href="cmdqueryname=ipv6-prefix+import"><b><span class="cmdname">ipv6-prefix</span></b></a> <i><span class="varname">ipv6-prefix-name</span></i> <strong><span>import</span></strong> command.</p>
</li><li><p>To use a route-policy for route filtering, run the <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">ipv6-address</span></i> | <i><span class="varname">group-name</span></i> } <a href="cmdqueryname=route-policy+import"><b><span class="cmdname">route-policy</span></b></a> <i><span class="varname">route-policy-name</span></i> <strong><span>import</span></strong> command.</p>
</li></ul>
<p>The import routing policy applied to a peer in a peer group can be different from that applied to the peer group. Specifically, a unique policy can be used to filter the routes to be received from each peer in the peer group.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li><span>Limit the number of routes received from peers.</span><ol><li class="substepexpand"><span>Run <span><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span></span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=ipv6-family"><b><span class="cmdname">ipv6-family</span></b></a> <strong><span>unicast</span></strong></span></span><p><p>The IPv6 unicast address family view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">group-name</span></i> | <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">ipv6-address</span></i> } <a href="cmdqueryname=route-limit+alert-only+idle-forever+idle-timeout"><b><span class="cmdname">route-limit</span></b></a> <i><span class="varname">limit</span></i> [ <i><span class="varname">percentage</span></i> ] [ <strong><span>alert-only</span></strong> | <strong><span>idle-forever</span></strong> | <strong><span>idle-timeout</span></strong> <i><span class="varname">times</span></i> ]</span><p><p>The maximum number of routes that the device is allowed to accept from the specified peer or peer group is set.</p>
</p><p><p>This command provides route control based on peers. You can specify parameters as needed to control the processing if the number of the routes accepted from a peer exceeds the limit specified.</p>
<ul><li><p>If <strong><span>alert-only</span></strong> is set, the peer relationship is not interrupted and no more routes are accepted after the route limit is reached. In this case, an alarm is generated, and a log is recorded.</p>
</li><li><p>If <strong><span>idle-forever</span></strong> is set, the peer relationship is interrupted and the system does not automatically attempt to re-establish the connection. In this case, an alarm is generated, and a log is recorded. In this case, the peer status is Idle in the <a href="cmdqueryname=display+bgp+peer+verbose"><b><span class="cmdname">display bgp peer</span></b></a> [ <strong><span>verbose</span></strong> ] command output. To restore the BGP connection, run the <a href="cmdqueryname=reset+bgp"><b><span class="cmdname">reset bgp</span></b></a> command. Configuring this parameter is not recommended.</p>
</li><li><p>If <strong><span>idle-timeout</span></strong> is set, the peer relationship is interrupted. The device retries setting up a connection after the timer expires. An alarm is generated, and a log is recorded. In this case, the peer status is Idle in the <a href="cmdqueryname=display+bgp+peer+verbose"><b><span class="cmdname">display bgp peer</span></b></a> [ <strong><span>verbose</span></strong> ] command output. To restore the BGP connection before the timer expires, run the <a href="cmdqueryname=reset+bgp"><b><span class="cmdname">reset bgp</span></b></a> command.</p>
</li><li><p>If none of the preceding parameters is set, the peer relationship is disconnected. The device retries setting up a connection in 30 seconds. An alarm is generated, and a log is recorded.</p>
</li></ul>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>If the number of routes received by the local <span class="keyword">Router</span> exceeds the upper limit and the <a href="cmdqueryname=peer+route-limit+alert-only"><b><span class="cmdname">peer route-limit</span></b></a> command is used for the first time, the local <span class="keyword">Router</span> and its peer reestablish the peer relationship, regardless of whether <strong><span>alert-only</span></strong> is set.</p>
</div></div>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li></ul></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp6_cfg_0027.html">Configuring BGP4+ Routing Policies
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp6_cfg_0030.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp6_cfg_0032.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>