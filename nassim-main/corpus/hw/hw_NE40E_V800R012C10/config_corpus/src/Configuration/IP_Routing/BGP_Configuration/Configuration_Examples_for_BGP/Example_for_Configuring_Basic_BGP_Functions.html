
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Basic BGP Functions">
<meta name="abstract" content="Before building BGP networks, you need to configure basic BGP functions.">
<meta name="description" content="Before building BGP networks, you need to configure basic BGP functions.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_3070.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_4073.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,bgpvrp,w00556928,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Route">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Route">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Route">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing Basis">
<meta name="OWNER" content="w00604599">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00615954">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172366356">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>Example for Configuring Basic BGP Functions</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172366356"></a><a name="EN-US_TASK_0172366356"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Basic BGP Functions</h1>
<div class="taskbody"><p>Before building BGP networks, you need to configure basic BGP functions.</p>
<div class="context"><a name="EN-US_TASK_0172366356__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>If multiple ASs want to access each other, these ASs must exchange their local routes. If multiple <span class="keyword">Router</span>s exist in the ASs, a great deal of routing information will be exchanged between ASs, which consumes lots of bandwidth resources. To address this issue, you can configure basic BGP functions.</p>
<p>In <a href="#EN-US_TASK_0172366356__fig_dc_vrp_bgp_cfg_407101">Figure 1</a>, <span class="keyword">Device</span> A is in AS 65008. <span class="keyword">Device</span> B, <span class="keyword">Device</span> C, and <span class="keyword">Device</span> D are in AS 65009. The routing tables of these routers store many routes, and the routes change frequently. After BGP is enabled on the <span class="keyword">Router</span>s, they can exchange routing information. If routes of one <span class="keyword">Router</span> changes, the <span class="keyword">Router</span> sends Update messages carrying only changed routing information to its peers, which greatly reduces bandwidth consumption.</p>
<div class="fignone" id="EN-US_TASK_0172366356__fig_dc_vrp_bgp_cfg_407101"><a name="EN-US_TASK_0172366356__fig_dc_vrp_bgp_cfg_407101"></a><a name="fig_dc_vrp_bgp_cfg_407101"></a><span class="figcap"><b>Figure 1 </b>Configuring basic BGP functions</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 through 3 in this example are GE <span>0/1/0</span>, GE <span>0/2/0</span>, and GE <span>0/3/0</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_bgp_cfg_407101.png" width="NaN" height="NaN"></span><div class="p">
<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" frame="border" border="1" rules="all"><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="33.223322332233224%" id="mcps1.4.1.4.4.1.1.4.1.1" liSelected="liSelected"><p>Device Name</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="33.223322332233224%" id="mcps1.4.1.4.4.1.1.4.1.2" liSelected="liSelected"><p>Interface</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="33.55335533553355%" id="mcps1.4.1.4.4.1.1.4.1.3" liSelected="liSelected"><p>IP Address</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" rowspan="3" valign="top" width="33.223322332233224%" headers="mcps1.4.1.4.4.1.1.4.1.1 "><p><span class="keyword">Device</span> A</p>
</td>
<td class="cellrowborder" valign="top" width="33.223322332233224%" headers="mcps1.4.1.4.4.1.1.4.1.2 "><p>Loopback 0</p>
</td>
<td class="cellrowborder" valign="top" width="33.55335533553355%" headers="mcps1.4.1.4.4.1.1.4.1.3 "><p>1.1.1.1/32</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.4.1.1.4.1.2 "><p>GE <span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.4.1.1.4.1.3 "><p>172.16.0.1/16</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.4.1.1.4.1.2 "><p>GE <span>0/2/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.4.1.1.4.1.3 "><p>192.168.0.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="4" valign="top" width="33.223322332233224%" headers="mcps1.4.1.4.4.1.1.4.1.1 "><p><span class="keyword">Device</span> B</p>
</td>
<td class="cellrowborder" valign="top" width="33.223322332233224%" headers="mcps1.4.1.4.4.1.1.4.1.2 "><p>Loopback 0</p>
</td>
<td class="cellrowborder" valign="top" width="33.55335533553355%" headers="mcps1.4.1.4.4.1.1.4.1.3 "><p>2.2.2.2/32</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.4.1.1.4.1.2 "><p>GE <span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.4.1.1.4.1.3 "><p>10.1.1.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.4.1.1.4.1.2 "><p>GE <span>0/2/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.4.1.1.4.1.3 "><p>192.168.0.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.4.1.1.4.1.2 "><p>GE <span>0/3/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.4.1.1.4.1.3 "><p>10.1.3.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="3" valign="top" width="33.223322332233224%" headers="mcps1.4.1.4.4.1.1.4.1.1 "><p><span class="keyword">Device</span> C</p>
</td>
<td class="cellrowborder" valign="top" width="33.223322332233224%" headers="mcps1.4.1.4.4.1.1.4.1.2 "><p>Loopback 0</p>
</td>
<td class="cellrowborder" valign="top" width="33.55335533553355%" headers="mcps1.4.1.4.4.1.1.4.1.3 "><p>3.3.3.3/32</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.4.1.1.4.1.2 "><p>GE <span>0/2/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.4.1.1.4.1.3 "><p>10.1.2.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.4.1.1.4.1.2 "><p>GE <span>0/3/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.4.1.1.4.1.3 "><p>10.1.3.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="3" valign="top" width="33.223322332233224%" headers="mcps1.4.1.4.4.1.1.4.1.1 "><p><span class="keyword">Device</span> D</p>
</td>
<td class="cellrowborder" valign="top" width="33.223322332233224%" headers="mcps1.4.1.4.4.1.1.4.1.2 "><p>Loopback 0</p>
</td>
<td class="cellrowborder" valign="top" width="33.55335533553355%" headers="mcps1.4.1.4.4.1.1.4.1.3 "><p>4.4.4.4/32</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.4.1.1.4.1.2 "><p>GE <span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.4.1.1.4.1.3 "><p>10.1.1.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.4.1.1.4.1.2 "><p>GE <span>0/2/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.4.1.1.4.1.3 "><p>10.1.2.2/24</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172366356__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Precautions</h4><p>During the configuration, note the following:</p>
<ul><li>Before establishing a BGP peer relationship, ensure that BGP peers are reachable to each other through IGP routes. In this way, the BGP peers can exchange routing information.</li><li><p>If the peer IP address specified during peer relationship establishment is a loopback interface address<span> or a sub-interface IP address</span>, you need to run the <strong>peer connect-interface</strong> command on both ends to ensure that the two ends are correctly connected. </p>
</li><li><p>If there is no directly connected physical link between EBGP peers, run the <strong>peer ebgp-max-hop</strong> command to allow EBGP peers to establish TCP connections through multiple hops.</p>
</li><li>To improve security, you are advised to deploy BGP security measures. For details, see "Configuring BGP Security." Keychain authentication is used as an example. For details, see "Example for Configuring BGP Keychain."</li></ul>
</div></div>
<div class="context"><a name="EN-US_TASK_0172366356__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li>Establish IGP connections among <span class="keyword">Device</span> B, <span class="keyword">Device</span> C, and <span class="keyword">Device</span> D. (OSPF is used as the IGP in this example.)</li><li><p>Establish IBGP connections between <span class="keyword">Device</span> B, <span class="keyword">Device</span> C, and <span class="keyword">Device</span> D.</p>
</li><li><p>Establish an EBGP connection between <span class="keyword">Device</span> A and <span class="keyword">Device</span> B.</p>
</li><li><p>Run the <strong>network</strong> command on <span class="keyword">Device</span> A to advertise routes, and then check the routing tables of <span class="keyword">Device</span> A, <span class="keyword">Device</span> B, and <span class="keyword">Device</span> C.</p>
</li><li><p>Configure BGP on <span class="keyword">Device</span> B to import direct routes, and then check the routing tables of <span class="keyword">Device</span> A and <span class="keyword">Device</span> C.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172366356__1.4.4"></a><a name="1.4.4"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>Router ID and AS number of <span class="keyword">Device</span> A</p>
</li><li><p>Router IDs and AS numbers of <span class="keyword">Device</span> B, <span class="keyword">Device</span> C, and <span class="keyword">Device</span> D</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172366356__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure an IP address for each interface. For configuration details, see <a href="#EN-US_TASK_0172366356__section_dc_vrp_bgp_cfg_407105">Configuration Files</a> in this section.</span></li><li><span>Configure OSPF.</span><p><p># Configure <span class="keyword">Device</span> B.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B]<strong> ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-ospf-1]<strong> area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-ospf-1-area-0.0.0.0]<strong> network 10.1.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-ospf-1-area-0.0.0.0]<strong> network 10.1.3.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-ospf-1-area-0.0.0.0]<strong> network 2.2.2.2 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-ospf-1-area-0.0.0.0]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-ospf-1-area-0.0.0.0]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-ospf-1]<strong> quit</strong></pre>
<p># Configure <span class="keyword">Device</span> C.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C]<strong> ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-ospf-1]<strong> area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-ospf-1-area-0.0.0.0]<strong> network 10.1.2.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-ospf-1-area-0.0.0.0]<strong> network 10.1.3.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-ospf-1-area-0.0.0.0]<strong> network 3.3.3.3 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-ospf-1-area-0.0.0.0]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C-ospf-1-area-0.0.0.0]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C-ospf-1]<strong> quit</strong></pre>
<p># Configure <span class="keyword">Device</span> D.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>D]<strong> ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-ospf-1]<strong> area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-ospf-1-area-0.0.0.0]<strong> network 10.1.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-ospf-1-area-0.0.0.0]<strong> network 10.1.2.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-ospf-1-area-0.0.0.0]<strong> network 4.4.4.4 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-ospf-1-area-0.0.0.0]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>D-ospf-1-area-0.0.0.0]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>D-ospf-1]<strong> quit</strong></pre>
</p></li><li><span>Configure IBGP connections.</span><p><p># Configure <span class="keyword">Device</span> B.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B]<strong> bgp 65009</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp]<strong> router-id 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp] <strong>peer 3.3.3.3 as-number 65009</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp]<strong> peer 4.4.4.4 as-number 65009</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp] <strong>peer 3.3.3.3 connect-interface LoopBack0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp]<strong> peer 4.4.4.4 connect-interface LoopBack0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-bgp]<strong> quit</strong></pre>
<p># Configure <span class="keyword">Device</span> C.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C]<strong> bgp 65009</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp]<strong> router-id 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp]<strong> peer 2.2.2.2 as-number 65009</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp]<strong> peer 4.4.4.4 as-number 65009</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp]<strong> peer 2.2.2.2 connect-interface LoopBack0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp]<strong> peer 4.4.4.4 connect-interface LoopBack0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C-bgp]<strong> quit</strong></pre>
<p># Configure <span class="keyword">Device</span> D.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>D]<strong> bgp 65009</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-bgp]<strong> router-id 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-bgp]<strong> peer 2.2.2.2 as-number 65009</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-bgp]<strong> peer 3.3.3.3 as-number 65009</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-bgp]<strong> peer 2.2.2.2 connect-interface LoopBack0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-bgp]<strong> peer 3.3.3.3 connect-interface LoopBack0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>D-bgp]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>D-bgp]<strong> quit</strong></pre>
</p></li><li><span>Configure an EBGP connection.</span><p><p># Configure <span class="keyword">Device</span> A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A]<strong> bgp 65008</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp] <strong>router-id 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp]<strong> peer 192.168.0.2 as-number 65009</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-bgp]<strong> quit</strong></pre>
<p># Configure <span class="keyword">Device</span> B.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B]<strong> bgp 65009</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp]<strong> peer 192.168.0.1 as-number 65008</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-bgp]<strong> quit</strong></pre>
<p># Check the status of BGP connections.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>display bgp peer</strong>

 BGP local router ID : 2.2.2.2
 Local AS number : 65009
 Total number of peers : 3                 Peers in established state : 3

  Peer            V    AS  MsgRcvd  MsgSent  OutQ  Up/Down       State PrefRcv
  3.3.3.3         4 65009        5        5     0 00:44:58 <strong>Established</strong>       0
  4.4.4.4         4 65009        4        4     0 00:40:54 <strong>Established</strong>       0
  192.168.0.1     4 65008        3        3     0 00:44:03 <strong>Established</strong>       0</pre>
<p>The command output shows that <span class="keyword">Device</span> B has established BGP connections with other <span class="keyword">Router</span>s and that the connection state is Established.</p>
</p></li><li><span>Configure <span class="keyword">Device</span> A to advertise the route 172.16.0.0/16.</span><p><p># Configure <span class="keyword">Device</span> A to advertise the route.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A]<strong> bgp 65008</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp] <strong>ipv4-family unicast</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp-af-ipv4] <strong>network 172.16.0.0 255.255.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp-af-ipv4] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-bgp-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-bgp] <strong>quit</strong></pre>
<p># Check the routing table of <span class="keyword">Device</span> A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>display bgp routing-table</strong>

 BGP Local router ID is 1.1.1.1
 Status codes: * - valid, &gt; - best, d - damped,<span> x - best external,</span><span> a - add path,</span>
               h - history,  i - internal, s - suppressed, S - Stale
               Origin : i - IGP, e - EGP, ? - incomplete
 RPKI validation codes: V - valid, I - invalid, N - not-found
 

 Total Number of Routes: 1
      Network            NextHop        MED        LocPrf    PrefVal Path/Ogn

 *&gt;   172.16.0.0          0.0.0.0         0                     0      i</pre>
<p># Check the routing table of <span class="keyword">Device</span> B.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>display bgp routing-table</strong>

 BGP Local router ID is 2.2.2.2
 Status codes: * - valid, &gt; - best, d - damped,<span> x - best external,</span><span> a - add path,</span>
               h - history,  i - internal, s - suppressed, S - Stale
               Origin : i - IGP, e - EGP, ? - incomplete
 RPKI validation codes: V - valid, I - invalid, N - not-found


 Total Number of Routes: 1
      Network            NextHop        MED        LocPrf    PrefVal Path/Ogn

 *&gt;   172.16.0.0          192.168.0.1    0                     0      65008i</pre>
<p># Check the routing table of <span class="keyword">Device</span> C.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C] <strong>display bgp routing-table</strong>

 BGP Local router ID is 3.3.3.3
 Status codes: * - valid, &gt; - best, d - damped,<span> x - best external,</span><span> a - add path,</span>
               h - history,  i - internal, s - suppressed, S - Stale
               Origin : i - IGP, e - EGP, ? - incomplete
 RPKI validation codes: V - valid, I - invalid, N - not-found


 Total Number of Routes: 1
      Network            NextHop        MED        LocPrf    PrefVal Path/Ogn

   i  172.16.0.0          192.168.0.1    0          100        0      65008i</pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The command output shows that <span class="keyword">Device</span> C has learned the route 172.16.0.0 from AS 65008. However, this route is invalid because the next hop 192.168.0.1 is unreachable.</p>
</div></div>
</p></li><li><span>Configure BGP to import direct routes.</span><p><p># Configure <span class="keyword">Device</span> B.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B]<strong> bgp 65009</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp] <strong>ipv4-family unicast</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp-af-ipv4] <strong>import-route direct</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp-af-ipv4] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-bgp-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-bgp] <strong>quit</strong></pre>
<p># Check the BGP routing table of <span class="keyword">Device</span> A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>display bgp routing-table</strong>

 BGP Local router ID is 1.1.1.1
 Status codes: * - valid, &gt; - best, d - damped,<span> x - best external,</span><span> a - add path,</span>
               h - history,  i - internal, s - suppressed, S - Stale
               Origin : i - IGP, e - EGP, ? - incomplete
<span> RPKI validation codes: V - valid, I - invalid, N - not-found</span>


 Total Number of Routes: 5
      Network            NextHop        MED        LocPrf    PrefVal Path/Ogn

 *&gt;   2.2.2.2/32         192.168.0.2     0                     0      65009?
 *&gt;   172.16.0.0          0.0.0.0         0                     0      i
 *&gt;   10.1.1.0/24        192.168.0.2     0                     0      65009?
 *&gt;   10.1.3.0/24        192.168.0.2     0                     0      65009?
 *&gt;   192.168.0.0        192.168.0.2     0                     0      65009?</pre>
<p># Check the routing table of <span class="keyword">Device</span> C.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C] <strong>display bgp routing-table</strong>

 BGP Local router ID is 3.3.3.3
 Status codes: * - valid, &gt; - best, d - damped,<span> x - best external,</span><span> a - add path,</span>
               h - history,  i - internal, s - suppressed, S - Stale
               Origin : i - IGP, e - EGP, ? - incomplete
<span> RPKI validation codes: V - valid, I - invalid, N - not-found</span>


 Total Number of Routes: 5
      Network            NextHop        MED        LocPrf    PrefVal Path/Ogn

   i  2.2.2.2/32         2.2.2.2         0          100        0      ?
 *&gt;i  10.1.1.0/24        2.2.2.2         0          100        0      ?
 * i  10.1.3.0/24        2.2.2.2         0          100        0      ?
 *&gt;i  172.16.0.0         192.168.0.1     0          100        0      65008i
 *&gt;i  192.168.0.0        2.2.2.2         0          100        0      ?</pre>
<p>The command output shows that the route 172.16.0.0 becomes valid and that the next hop is the address of <span class="keyword">Device</span> A.</p>
<p># Verify the configuration using the <strong>ping</strong> command.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C] <strong>ping 172.16.0.1</strong>
  PING 172.16.0.1: 56  data bytes, press CTRL_C to break
    Reply from 172.16.0.1: bytes=56 Sequence=1 ttl=254 time=31 ms
    Reply from 172.16.0.1: bytes=56 Sequence=2 ttl=254 time=47 ms
    Reply from 172.16.0.1: bytes=56 Sequence=3 ttl=254 time=31 ms
    Reply from 172.16.0.1: bytes=56 Sequence=4 ttl=254 time=16 ms
    Reply from 172.16.0.1: bytes=56 Sequence=5 ttl=254 time=31 ms
  --- 172.16.0.1 ping statistics ---
    5 packet(s) transmitted
    5 packet(s) received
    0.00% packet loss
    round-trip min/avg/max = 16/31/47 ms</pre>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0172366356__section_dc_vrp_bgp_cfg_407105"><a name="EN-US_TASK_0172366356__section_dc_vrp_bgp_cfg_407105"></a><a name="section_dc_vrp_bgp_cfg_407105"></a><a name="EN-US_TASK_0172366356__1.4.6"></a><a name="1.4.6"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p><span class="keyword">Device</span> A configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname <span class="keyword">Device</span>A</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 172.16.0.1 255.255.0.0</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/2/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 192.168.0.1 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">interface LoopBack0</pre>
<pre class="screen"> ip address 1.1.1.1 255.255.255.255</pre>
<pre class="screen">#</pre>
<pre class="screen">bgp 65008</pre>
<pre class="screen"> router-id 1.1.1.1</pre>
<pre class="screen"> peer 192.168.0.2 as-number 65009</pre>
<pre class="screen"> #</pre>
<pre class="screen"> ipv4-family unicast</pre>
<pre class="screen">  undo synchronization 
  network 172.16.0.0 255.255.0.0</pre>
<pre class="screen">  peer 192.168.0.2 enable</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p><span class="keyword">Device</span> B configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname <span class="keyword">Device</span>B</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.1.1.1 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/2/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 192.168.0.2 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/3/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.1.3.1 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">interface LoopBack0</pre>
<pre class="screen"> ip address 2.2.2.2 255.255.255.255</pre>
<pre class="screen">#</pre>
<pre class="screen">bgp 65009</pre>
<pre class="screen"> router-id 2.2.2.2</pre>
<pre class="screen"> peer 3.3.3.3 as-number 65009</pre>
<pre class="screen"> peer 3.3.3.3 connect-interface LoopBack0</pre>
<pre class="screen"> peer 4.4.4.4 as-number 65009</pre>
<pre class="screen"> peer 4.4.4.4 connect-interface LoopBack0</pre>
<pre class="screen"> peer 192.168.0.1 as-number 65008</pre>
<pre class="screen">#</pre>
<pre class="screen"> ipv4-family unicast</pre>
<pre class="screen">  undo synchronization 
  import-route direct</pre>
<pre class="screen">  peer 3.3.3.3 enable</pre>
<pre class="screen">  peer 4.4.4.4 enable </pre>
<pre class="screen">  peer 192.168.0.1 enable</pre>
<pre class="screen">#</pre>
<pre class="screen">ospf 1</pre>
<pre class="screen"> area 0.0.0.0</pre>
<pre class="screen">  network 2.2.2.2 0.0.0.0</pre>
<pre class="screen">  network 10.1.1.0 0.0.0.255</pre>
<pre class="screen">  network 10.1.3.0 0.0.0.255</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p><span class="keyword">Device</span> C configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname <span class="keyword">Device</span>C</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/2/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.1.2.1 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/3/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.1.3.2 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">interface LoopBack0</pre>
<pre class="screen"> ip address 3.3.3.3 255.255.255.255</pre>
<pre class="screen">#</pre>
<pre class="screen">bgp 65009</pre>
<pre class="screen"> router-id 3.3.3.3</pre>
<pre class="screen"> peer 2.2.2.2 as-number 65009</pre>
<pre class="screen"> peer 2.2.2.2 connect-interface LoopBack0</pre>
<pre class="screen"> peer 4.4.4.4 as-number 65009</pre>
<pre class="screen"> peer 4.4.4.4 connect-interface LoopBack0</pre>
<pre class="screen"> #</pre>
<pre class="screen"> ipv4-family unicast</pre>
<pre class="screen">  undo synchronization 
  peer 2.2.2.2 enable</pre>
<pre class="screen">  peer 4.4.4.4 enable</pre>
<pre class="screen">#</pre>
<pre class="screen">ospf 1</pre>
<pre class="screen"> area 0.0.0.0</pre>
<pre class="screen">  network 3.3.3.3 0.0.0.0</pre>
<pre class="screen">  network 10.1.2.0 0.0.0.255</pre>
<pre class="screen">  network 10.1.3.0 0.0.0.255</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p><span class="keyword">Device</span> D configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname <span class="keyword">Device</span>D</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.1.1.2 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/2/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.1.2.2 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">interface LoopBack0</pre>
<pre class="screen"> ip address 4.4.4.4 255.255.255.255</pre>
<pre class="screen">#</pre>
<pre class="screen">bgp 65009</pre>
<pre class="screen"> router-id 4.4.4.4</pre>
<pre class="screen"> peer 2.2.2.2 as-number 65009</pre>
<pre class="screen"> peer 2.2.2.2 connect-interface LoopBack0</pre>
<pre class="screen"> peer 3.3.3.3 as-number 65009</pre>
<pre class="screen"> peer 3.3.3.3 connect-interface LoopBack0</pre>
<pre class="screen"> #</pre>
<pre class="screen"> ipv4-family unicast</pre>
<pre class="screen">  undo synchronization 
  peer 2.2.2.2 enable</pre>
<pre class="screen">  peer 3.3.3.3 enable</pre>
<pre class="screen">#</pre>
<pre class="screen">ospf 1</pre>
<pre class="screen"> area 0.0.0.0</pre>
<pre class="screen">  network 4.4.4.4 0.0.0.0</pre>
<pre class="screen">  network 10.1.1.0 0.0.0.255</pre>
<pre class="screen">  network 10.1.2.0 0.0.0.255</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_3070.html">Configuration Examples for BGP
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_4073.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>