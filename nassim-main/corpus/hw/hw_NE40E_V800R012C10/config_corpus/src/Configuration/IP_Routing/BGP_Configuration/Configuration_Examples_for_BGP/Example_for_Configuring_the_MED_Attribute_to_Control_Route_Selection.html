
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring the MED Attribute to Control Route Selection">
<meta name="abstract" content="By setting the MED attribute, you can flexibly control BGP route selection.">
<meta name="description" content="By setting the MED attribute, you can flexibly control BGP route selection.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_3070.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_4073.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_4088.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,bgpvrp,w00556928,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Route">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Route">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Route">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing Basis">
<meta name="OWNER" content="w00604599">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00615954">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172366367">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring the MED Attribute to Control Route Selection</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172366367"></a><a name="EN-US_TASK_0172366367"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring the MED Attribute to Control Route Selection</h1>
<div class="taskbody"><p>By setting the MED attribute, you can flexibly control BGP route selection.</p>
<div class="context"><a name="EN-US_TASK_0172366367__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>The MED attribute equals a metric used in an IGP, and is used to determine the optimal route for traffic that enters an AS. When a BGP device obtains multiple routes to the same destination address but with different next hops from EBGP peers, the route with the smallest MED value is selected as the optimal route.</p>
<p>On the network shown in <a href="#EN-US_TASK_0172366367__fig_dc_vrp_bgp_cfg_307401">Figure 1</a>, BGP is configured on all <span class="keyword">Router</span>s, <span class="keyword">Router</span>A is in AS 65008, and <span class="keyword">Router</span>B and <span class="keyword">Router</span>C are in AS 65009. In addition, <span class="keyword">Router</span>A establishes EBGP connections with <span class="keyword">Router</span>B and <span class="keyword">Router</span>C, whereas <span class="keyword">Router</span>B establishes an IBGP connection with <span class="keyword">Router</span>C. Traffic sent by <span class="keyword">Router</span>A to 172.16.1.0 can enter AS 65009 through <span class="keyword">Router</span>B or <span class="keyword">Router</span>C. If other conditions are the same, you can configure <span class="keyword">Router</span>B or <span class="keyword">Router</span>C to change the MED value of the route advertised to <span class="keyword">Router</span>A to select the ingress for traffic to enter AS 65009.</p>
<div class="fignone" id="EN-US_TASK_0172366367__fig_dc_vrp_bgp_cfg_307401"><a name="EN-US_TASK_0172366367__fig_dc_vrp_bgp_cfg_307401"></a><a name="fig_dc_vrp_bgp_cfg_307401"></a><span class="figcap"><b>Figure 1 </b>Configuring the MED attribute to control route selection</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 through 2 in this example are GE <span>0/1/0</span> and GE <span>0/2/0</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_bgp_cfg_307401.png"></span><br></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172366367__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Precautions</h4><p>To improve security, you are advised to deploy BGP security measures. For details, see "Configuring BGP Security." Keychain authentication is used as an example. For details, see "Example for Configuring BGP Keychain."</p>
</div></div>
<div class="context"><a name="EN-US_TASK_0172366367__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Establish EBGP connections between <span class="keyword">Device</span> A and <span class="keyword">Device</span> B, and between <span class="keyword">Device</span> A and <span class="keyword">Device</span> C, and establish an IBGP connection between <span class="keyword">Device</span> B and <span class="keyword">Device</span> C.</p>
</li><li>Apply a routing policy to increase the MED value of the route sent by <span class="keyword">Device</span> B to <span class="keyword">Device</span> A so that <span class="keyword">Device</span> A will send traffic to AS 65009 through <span class="keyword">Device</span> C.</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172366367__1.4.4"></a><a name="1.4.4"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li>Router ID 1.1.1.1 and AS number 65008 of <span class="keyword">Device</span> A</li><li>Router IDs 2.2.2.2 and 3.3.3.3, and AS number 65009 of <span class="keyword">Device</span>s B and C</li><li>New MED value 100 of the route on <span class="keyword">Device</span> B</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172366367__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure an IP address for each interface. For configuration details, see Configuration Files in this section.</span></li><li><span>Configure BGP connections.</span><p><p># Configure <span class="keyword">Device</span> A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A]<strong> bgp 65008</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp]<strong> router-id 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp] <strong>peer 10.1.1.1 as-number 65009</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp]<strong> peer 10.1.2.1 as-number 65009</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-bgp]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-bgp]<strong> quit</strong></pre>
<p># Configure <span class="keyword">Device</span> B.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B]<strong> bgp 65009</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp]<strong> router-id 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp] <strong>peer 10.1.1.2 as-number 65008</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp] <strong>peer 172.16.1.2 as-number 65009</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp] <strong>ipv4-family unicast</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp-af-ipv4] <strong>network 172.16.1.0 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp-af-ipv4] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-bgp-af-ipv4]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-bgp] <strong>quit</strong></pre>
<p># Configure <span class="keyword">Device</span> C.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C]<strong> bgp 65009</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp]<strong> router-id 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp] <strong>peer 10.1.2.2 as-number 65008</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp] <strong>peer 172.16.1.1 as-number 65009</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp] <strong>ipv4-family unicast</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp-af-ipv4] <strong>network 172.16.1.0 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>C-bgp-af-ipv4] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C-bgp-af-ipv4]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>C-bgp] <strong>quit</strong></pre>
<p># Check the routing table of <span class="keyword">Device</span> A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>display bgp routing-table 172.16.1.0 24</strong>

 BGP local router ID : 1.1.1.1
 Local AS number : 65008
 Paths:   2 available, 1 best, 1 select
 BGP routing table entry information of 172.16.1.0/24:
 From: 10.1.1.1 (2.2.2.2)
 Route Duration: 0d00h00m56s
 Direct Out-interface: GigabitEthernet<span>0/1/0</span>
 Original nexthop: 10.1.1.1
 Qos information : 0x0
 AS-path 65009, origin igp, MED 0, pref-val 0, valid, external, best, select, pre 255
 Advertised to such 2 peers:
    10.1.1.1
    10.1.2.1

 BGP routing table entry information of 172.16.1.0/24:
 From: 10.1.2.1 (3.3.3.3)
 Route Duration: 0d00h00m06s
 Direct Out-interface: GigabitEthernet<span>0/2/0</span>
 Original nexthop: 10.1.2.1
 Qos information : 0x0
 AS-path 65009, origin igp, MED 0, pref-val 0, valid, external, pre 255, not preferred for router ID
 Not advertised to any peers yet</pre>
<p>The command output shows that there are two valid routes to 172.16.1.0/24. The route with 10.1.1.1 as the next hop is the optimal route because the router ID of <span class="keyword">Device</span> B is smaller.</p>
</p></li><li><span>Configure the MED attribute.</span><p><p># Set the MED value for the route sent by <span class="keyword">Device</span> B to <span class="keyword">Device</span> A based on a routing policy.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>route-policy 10 permit node 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-route-policy] <strong>apply cost 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-route-policy] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-route-policy] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>bgp 65009</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp] <strong>ipv4-family unicast</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-bgp-af-ipv4] <strong>peer 10.1.1.2 route-policy 10 export</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-bgp-af-ipv4] <strong>commit</strong></pre>
<p># Check the routing table of <span class="keyword">Device</span> A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>display bgp routing-table 172.16.1.0 24</strong>

BGP local router ID : 1.1.1.1
 Local AS number : 65008
 Paths:   2 available, 1 best, 1 select
 BGP routing table entry information of 172.16.1.0/24:
 From: 10.1.2.1 (3.3.3.3)
 Route Duration: 0d00h07m45s
 Direct Out-interface: GigabitEthernet<span>0/2/0</span>
 Original nexthop: 10.1.2.1
 Qos information : 0x0
 AS-path 65009, origin igp, MED 0, pref-val 0, valid, external, best, select, pre 255
 Advertised to such 2 peers:
    10.1.1.1
    10.1.2.1

 BGP routing table entry information of 172.16.1.0/24:
 From: 10.1.1.1 (2.2.2.2)
 Route Duration: 0d00h00m08s
 Direct Out-interface: GigabitEthernet<span>0/1/0</span>
 Original nexthop: 10.1.1.1
 Qos information : 0x0
 AS-path 65009, origin igp, MED 100, pref-val 0, valid, external, pre 255, not preferred for MED
 Not advertised to any peers yet</pre>
<p>The command output shows that the MED value of the next hop 10.1.1.1 (<span class="keyword">Device</span> B) is 100 and that the MED value of the next hop 10.1.2.1 is 0. Therefore, the route with the smaller MED value is selected.</p>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172366367__1.4.6"></a><a name="1.4.6"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p><span class="keyword">Device</span> A configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname <span class="keyword">Device</span>A</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.1.1.2 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/2/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.1.2.2 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">bgp 65008</pre>
<pre class="screen"> router-id 1.1.1.1</pre>
<pre class="screen"> peer 10.1.1.1 as-number 65009</pre>
<pre class="screen"> peer 10.1.2.1 as-number 65009</pre>
<pre class="screen"> #</pre>
<pre class="screen"> ipv4-family unicast</pre>
<pre class="screen">  peer 10.1.1.1 enable</pre>
<pre class="screen">  peer 10.1.2.1 enable</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p><span class="keyword">Device</span> B configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname <span class="keyword">Device</span>B</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 172.16.1.1 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/2/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.1.1.1 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">bgp 65009</pre>
<pre class="screen"> router-id 2.2.2.2</pre>
<pre class="screen"> peer 172.16.1.2 as-number 65009</pre>
<pre class="screen"> peer 10.1.1.2 as-number 65008</pre>
<pre class="screen"> #</pre>
<pre class="screen"> ipv4-family unicast</pre>
<pre class="screen">  undo synchronization 
  network 172.16.1.0 255.255.255.0</pre>
<pre class="screen">  peer 172.16.1.2 enable</pre>
<pre class="screen">  peer 10.1.1.2 enable</pre>
<pre class="screen">  peer 10.1.1.2 route-policy 10 export</pre>
<pre class="screen">#</pre>
<pre class="screen">route-policy 10 permit node 10</pre>
<pre class="screen"> apply cost 100</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p><span class="keyword">Device</span> C configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname <span class="keyword">Device</span>C</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 172.16.1.2 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/2/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.1.2.1 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen">bgp 65009</pre>
<pre class="screen"> router-id 3.3.3.3</pre>
<pre class="screen"> peer 172.16.1.1 as-number 65009</pre>
<pre class="screen"> peer 10.1.2.2 as-number 65008</pre>
<pre class="screen"> #</pre>
<pre class="screen"> ipv4-family unicast</pre>
<pre class="screen">  undo synchronization 
  network 172.16.1.0 255.255.255.0</pre>
<pre class="screen">  peer 172.16.1.1 enable</pre>
<pre class="screen">  peer 10.1.2.2 enable</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_3070.html">Configuration Examples for BGP
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_4073.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_4088.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>