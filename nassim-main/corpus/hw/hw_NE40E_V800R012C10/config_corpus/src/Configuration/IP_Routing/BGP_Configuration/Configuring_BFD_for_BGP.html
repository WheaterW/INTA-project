
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring BFD for BGP">
<meta name="abstract" content="BFD for BGP provides BGP with a fast fault detection mechanism, which speeds up network convergence.">
<meta name="description" content="BFD for BGP provides BGP with a fast fault detection mechanism, which speeds up network convergence.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_3000.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_3103.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_5011.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Route">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Route">
<meta name="featurename" content="BGP">
<meta name="featuretype" content="IP Routing Basis">
<meta name="OWNER" content="l00425560">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00615954">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172366255">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>Configuring BFD for BGP</title>
</head>
<body><a name="EN-US_TASK_0172366255"></a><a name="EN-US_TASK_0172366255"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring BFD for BGP</h1>
<div class="taskbody"><p>BFD for BGP provides BGP with a fast fault detection mechanism, which speeds up network convergence.</p>
<div class="context"><a name="EN-US_TASK_0172366255__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Usage Scenario</h4><p>Currently, voice and video services are widely applied. These services are quite sensitive to the packet loss and delay. BGP periodically sends Keepalive messages to a peer to monitor the peer's status, but this mechanism takes an excessively long time, more than 1 second, to detect a fault. When the data transmission rate reaches the level of Gbit/s, such slow detection will cause a large amount of data to be lost. As a result, the requirement for high reliability of carrier-class networks cannot be met.</p>
<p>To address this issue, BFD for BGP can be configured. BFD for BGP can detect faults on links between BGP peers within milliseconds. This speeds up link detection, ensures fast link switching, and reduces traffic loss.</p>
</div></div>
<div class="context"><a name="EN-US_TASK_0172366255__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Pre-configuration Tasks</h4><p>Before configuring BFD for BGP, complete the following tasks:</p>
<ul><li><p>Configure link layer protocol parameters and IP addresses for interfaces and ensure that the link layer protocol on the interfaces is up.</p>
</li><li><p><a href="dc_vrp_bgp_cfg_3004.html">Configure basic BGP functions.</a></p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172366255__1.4.3"></a><a name="1.4.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li><span>Run <a href="cmdqueryname=bfd"><b><span class="cmdname">bfd</span></b></a></span><p><p>BFD is enabled globally on the local device.</p>
</p></li><li><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Return to the system view.</p>
</p></li><li><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span><p><p>The BGP view is displayed.</p>
</p></li><li><span>Run <a href="cmdqueryname=peer+bfd+enable+single-hop-prefer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">group-name</span></i> | <i><span class="varname">ipv4-address</span></i> } <strong><span>bfd</span></strong> <strong><span>enable</span></strong> [ <strong><span>single-hop-prefer</span></strong> ]<span> [ <strong><span>compatible</span></strong> ]</span></span><p><p>BFD is configured for a peer or peer group, and default BFD parameters are used to establish a BFD session.</p>
</p><p><p>A BFD session can be established only when the peer relationship is in the Established state.</p>
<p>After BFD is enabled for a peer group, BFD sessions will be created on the peers that belong to this peer group and are not configured with the <a href="cmdqueryname=peer+bfd+block"><b><span class="cmdname">peer bfd block</span></b></a> command.</p>
<div class="p">The <strong><span>compatible</span></strong> parameter configures the compatibility mode, which ensures that the local and peer devices use the same detection mode when a Huawei device is connected to a non-Huawei device. The <strong><span>compatible</span></strong> parameter must be used together with the <strong><span>single-hop-prefer</span></strong> parameter.<ul><li>In the scenario where Huawei devices are interconnected, the same parameters must be configured on the local and peer devices. If the devices are configured with different BFD parameters, services may be affected.</li><li>In the scenario where a Huawei device is connected to a non-Huawei device, to implement BFD interworking, select a proper configuration mode from the following table to ensure consistent configurations on the local and peer devices.
<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" frame="border" border="1" rules="all"><caption><b>Table 1 </b>Configuration modes for the <strong><span>compatible</span></strong> and <strong><span>single-hop-prefer</span></strong> parameters</caption><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="16.669999999999998%" id="mcps1.4.3.5.3.3.4.2.1.2.7.1.1" liSelected="liSelected"><p>Whether <strong><span>single-hop-prefer</span></strong> Is Configured</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="16.669999999999998%" id="mcps1.4.3.5.3.3.4.2.1.2.7.1.2" liSelected="liSelected"><p>Whether <strong><span>compatible</span></strong> Is Configured</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="16.650000000000002%" id="mcps1.4.3.5.3.3.4.2.1.2.7.1.3" liSelected="liSelected"><p>Direct IBGP Scenario</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="16.68%" id="mcps1.4.3.5.3.3.4.2.1.2.7.1.4" liSelected="liSelected"><p>Multi-hop IBGP Scenario</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="16.650000000000002%" id="mcps1.4.3.5.3.3.4.2.1.2.7.1.5" liSelected="liSelected"><p>Direct EBGP Scenario</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="16.68%" id="mcps1.4.3.5.3.3.4.2.1.2.7.1.6" liSelected="liSelected"><p>Multi-hop EBGP Scenario</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" valign="top" width="16.669999999999998%" headers="mcps1.4.3.5.3.3.4.2.1.2.7.1.1 "><p>N</p>
</td>
<td class="cellrowborder" valign="top" width="16.669999999999998%" headers="mcps1.4.3.5.3.3.4.2.1.2.7.1.2 "><p>N</p>
</td>
<td class="cellrowborder" valign="top" width="16.650000000000002%" headers="mcps1.4.3.5.3.3.4.2.1.2.7.1.3 "><p>In the packets sent by BFD, the UDP port number is 4784, and the TTL is 253.</p>
</td>
<td class="cellrowborder" valign="top" width="16.68%" headers="mcps1.4.3.5.3.3.4.2.1.2.7.1.4 "><p>In the packets sent by BFD, the UDP port number is 4784, and the TTL is 253.</p>
</td>
<td class="cellrowborder" valign="top" width="16.650000000000002%" headers="mcps1.4.3.5.3.3.4.2.1.2.7.1.5 "><p>In the packets sent by BFD, the UDP port number is 3784, and the TTL is 255.</p>
</td>
<td class="cellrowborder" valign="top" width="16.68%" headers="mcps1.4.3.5.3.3.4.2.1.2.7.1.6 "><p>In the packets sent by BFD, the UDP port number is 4784, and the TTL is 253.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="16.669999999999998%" headers="mcps1.4.3.5.3.3.4.2.1.2.7.1.1 "><p>Y</p>
</td>
<td class="cellrowborder" valign="top" width="16.669999999999998%" headers="mcps1.4.3.5.3.3.4.2.1.2.7.1.2 "><p>N</p>
</td>
<td class="cellrowborder" valign="top" width="16.650000000000002%" headers="mcps1.4.3.5.3.3.4.2.1.2.7.1.3 "><p>In the packets sent by BFD, the UDP port number is 3784, and the TTL is 255.</p>
</td>
<td class="cellrowborder" valign="top" width="16.68%" headers="mcps1.4.3.5.3.3.4.2.1.2.7.1.4 "><p>In the packets sent by BFD, the UDP port number is 4784, and the TTL is 253.</p>
</td>
<td class="cellrowborder" valign="top" width="16.650000000000002%" headers="mcps1.4.3.5.3.3.4.2.1.2.7.1.5 "><p>In the packets sent by BFD, the UDP port number is 3784, and the TTL is 255.</p>
</td>
<td class="cellrowborder" valign="top" width="16.68%" headers="mcps1.4.3.5.3.3.4.2.1.2.7.1.6 "><p>In the packets sent by BFD, the UDP port number is 4784, and the TTL is 253.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="16.669999999999998%" headers="mcps1.4.3.5.3.3.4.2.1.2.7.1.1 "><p>N</p>
</td>
<td class="cellrowborder" valign="top" width="16.669999999999998%" headers="mcps1.4.3.5.3.3.4.2.1.2.7.1.2 "><p>Y</p>
</td>
<td class="cellrowborder" valign="top" width="16.650000000000002%" headers="mcps1.4.3.5.3.3.4.2.1.2.7.1.3 "><p>In the packets sent by BFD, the UDP port number is 4784, and the TTL is 255.</p>
</td>
<td class="cellrowborder" valign="top" width="16.68%" headers="mcps1.4.3.5.3.3.4.2.1.2.7.1.4 "><p>In the packets sent by BFD, the UDP port number is 4784, and the TTL is 255.</p>
</td>
<td class="cellrowborder" valign="top" width="16.650000000000002%" headers="mcps1.4.3.5.3.3.4.2.1.2.7.1.5 "><p>In the packets sent by BFD, the UDP port number is 3784, and the TTL is 255.</p>
</td>
<td class="cellrowborder" valign="top" width="16.68%" headers="mcps1.4.3.5.3.3.4.2.1.2.7.1.6 "><p>In the packets sent by BFD, the UDP port number is 4784, and the TTL is 255.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="16.669999999999998%" headers="mcps1.4.3.5.3.3.4.2.1.2.7.1.1 "><p>Y</p>
</td>
<td class="cellrowborder" valign="top" width="16.669999999999998%" headers="mcps1.4.3.5.3.3.4.2.1.2.7.1.2 "><p>Y</p>
</td>
<td class="cellrowborder" valign="top" width="16.650000000000002%" headers="mcps1.4.3.5.3.3.4.2.1.2.7.1.3 "><p>In the packets sent by BFD, the UDP port number is 3784, and the TTL is 255.</p>
</td>
<td class="cellrowborder" valign="top" width="16.68%" headers="mcps1.4.3.5.3.3.4.2.1.2.7.1.4 "><p>In the packets sent by BFD, the UDP port number is 4784, and the TTL is 255.</p>
<p>If the peer UDP port number is 3784, the local BFD session can learn the port number and change the local UDP port number to 3784.</p>
</td>
<td class="cellrowborder" valign="top" width="16.650000000000002%" headers="mcps1.4.3.5.3.3.4.2.1.2.7.1.5 "><p>In the packets sent by BFD, the UDP port number is 3784, and the TTL is 255.</p>
</td>
<td class="cellrowborder" valign="top" width="16.68%" headers="mcps1.4.3.5.3.3.4.2.1.2.7.1.6 "><p>In the packets sent by BFD, the UDP port number is 4784, and the TTL is 255.</p>
<p>If the peer UDP port number is 3784, the local BFD session can learn the port number and change the local UDP port number to 3784.</p>
</td>
</tr>
</tbody>
</table>
</div>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In the preceding table, the UDP port numbers in the packets sent by BFD are those obtained during initial negotiation. BFD has the automatic adaptation function. If the UDP port number of a received response packet is different from that of the sent packet, BFD automatically changes the UDP port number of the sent packet to be the same as that in the peer end.</p>
</div></div>
</li></ul>
</div>
</p></li><li><span>(Optional) Run <a href="cmdqueryname=peer+bfd+min-tx-interval+min-rx-interval+detect-multiplier"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">group-name</span></i> | <i><span class="varname">ipv4-address</span></i> } <strong><span>bfd</span></strong> { <strong><span>min-tx-interval</span></strong> <i><span class="varname">min-tx-interval</span></i> | <strong><span>min-rx-interval</span></strong> <i><span class="varname">min-rx-interval</span></i> | <strong><span>detect-multiplier</span></strong> <i><span class="varname">multiplier</span></i> } <sup>*</sup></span><p><p>BFD session parameters are modified.</p>
</p><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The BFD parameters of a single peer take precedence over those of a peer group. If BFD parameters are configured on peers, they will be used in BFD session establishment.</p>
</div></div>
<p> When changing the default values, pay attention to the network status and the network reliability requirement. A short interval for transmitting BFD packets can be configured for a link that has a higher reliability requirement. A long interval for transmitting BFD packets can be configured for a link that has a lower reliability requirement.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>There are three formulas: Actual interval for the local device to send BFD packets = max {Locally configured interval for transmitting BFD packets, Remotely configured interval for receiving BFD packets}, Actual interval for the local device to receive BFD packets = max {Remotely configured interval for transmitting BFD packets, Locally configured interval for receiving BFD packets}, and Local detection period = Actual interval for receiving BFD packets x Remotely configured BFD detection multiplier.</p>
<p>For example:</p>
<ul><li><p>On the local device, the configured interval for transmitting BFD packets is 200 ms, the interval for receiving BFD packets is 300 ms, and the detection multiplier is 4.</p>
</li><li><p>On the peer device, the configured interval for transmitting BFD packets is 100 ms, the interval for receiving BFD packets is 600 ms, and the detection multiplier is 5.</p>
</li></ul>
<p>Then:</p>
<ul><li><p>On the local device, the actual interval for transmitting BFD packets is 600 ms calculated by using the formula max {200 ms, 600 ms}; the interval for receiving BFD packets is 300 ms calculated by using the formula max {100 ms, 300 ms}; the detection period is 1500 ms calculated by multiplying 300 ms by 5.</p>
</li><li><p>On the peer device, the actual interval for transmitting BFD packets is 300 ms calculated by using the formula max {100 ms, 300 ms}; the interval for receiving BFD packets is 600 ms calculated by using the formula max {200 ms, 600 ms}; the detection period is 2400 ms calculated by multiplying 600 ms by 4.</p>
</li></ul>
</div></div>
</p></li><li><span>(Optional) Run <a href="cmdqueryname=peer+bfd+valid-ttl-hops"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">group-name</span></i> | <i><span class="varname">ipv4-address</span></i> } <strong><span>bfd</span></strong> <strong><span>valid-ttl-hops</span></strong> <i><span class="varname">valid-ttl-hops-value</span></i></span><p><p>A TTL value is set for checking the BFD session with a specified peer or peer group.</p>
</p><p><p>In scenarios where EBGP peers are indirectly connected, you can configure a TTL value for a BFD session so that the traffic forwarding path is quickly adjusted if BFD detects a fault on the link between the local device and the specified BGP peer. Specifically, the local interface used to establish the BFD session forwards only the packets with a TTL value greater than or equal to the configured TTL value. If the TTL value in a BFD packet is smaller than the configured TTL value, the interface discards this packet, the BFD session goes down, and BFD notifies BGP of this event. In this manner, BGP routes are re-converged so that the traffic forwarding path is adjusted.</p>
<p>The <a href="cmdqueryname=peer+bfd+valid-ttl-hops"><b><span class="cmdname">peer bfd valid-ttl-hops</span></b></a> and <a href="cmdqueryname=peer+bfd+enable+single-hop-prefer"><b><span class="cmdname">peer bfd enable single-hop-prefer</span></b></a> commands are mutually exclusive.</p>
</p><p><p>The <a href="cmdqueryname=peer+bfd+valid-ttl-hops"><b><span class="cmdname">peer bfd valid-ttl-hops</span></b></a> and <a href="cmdqueryname=peer+bfd+enable+per-link+one-arm-echo"><b><span class="cmdname">peer bfd enable per-link one-arm-echo</span></b></a> commands are mutually exclusive.</p>
</p></li><li><span>(Optional) Run <a href="cmdqueryname=peer+bfd+block"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <strong><span>bfd</span></strong> <strong><span>block</span></strong></span><p><p>A peer is prevented from inheriting the BFD function of the peer group to which it belongs.</p>
</p><p><p>After a peer is added to a peer group enabled with BFD, the peer inherits the BFD configuration of the group and creates a BFD session. To prevent the peer from inheriting the BFD function of the peer group, perform this step.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The <a href="cmdqueryname=peer+bfd+block"><b><span class="cmdname">peer bfd block</span></b></a> command and the <a href="cmdqueryname=peer+bfd+enable"><b><span class="cmdname">peer bfd enable</span></b></a> command are mutually exclusive. After the <a href="cmdqueryname=peer+bfd+block"><b><span class="cmdname">peer bfd block</span></b></a> command is run, the BFD session is automatically deleted.</p>
</div></div>
</p></li><li><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol></div>
<div class="postreq"><a name="EN-US_TASK_0172366255__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p>After BFD for BGP is configured, you can run the <a href="cmdqueryname=display+bgp+bfd+session+vpnv4+vpn-instance+peer+all"><b><span class="cmdname">display bgp bfd session</span></b></a> { [ <strong><span>vpnv4</span></strong> <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i> ] <strong><span>peer</span></strong> <i><span class="varname">ipv4-address</span></i> | <strong><span>all</span></strong> } command to view information about the BFD session established by BGP.</p>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_3000.html">BGP Configuration
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_3103.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_bgp_cfg_5011.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>