
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Applying Route-Policies">
<meta name="abstract" content="By configuring route-policies, you can flexibly control the traffic on a complex network.">
<meta name="description" content="By configuring route-policies, you can flexibly control the traffic on a complex network.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_route-policy_cfg_0028.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_route-policy_cfg_0030.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_route-policy_cfg_0044.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,w00556928,w00606909,route-policyvrp,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="Route Policy">
<meta name="featuretype" content="IP Route">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="Route Policy">
<meta name="featuretype" content="IP Route">
<meta name="featurename" content="Route Policy">
<meta name="featuretype" content="IP Route">
<meta name="featurename" content="Route Policy">
<meta name="featuretype" content="IP Routing Basis">
<meta name="OWNER" content="z00809835">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="z00809835">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172366595">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>Example for Applying Route-Policies</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172366595"></a><a name="EN-US_TASK_0172366595"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Applying Route-Policies</h1>
<div class="taskbody"><p>By configuring route-policies, you can flexibly control the traffic on a complex network.</p>
<div class="context"><a name="EN-US_TASK_0172366595__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p><a href="#EN-US_TASK_0172366595__fig_dc_vrp_route-policy_cfg_003101">Figure 1</a> shows a simplified diagram of the MPLS network that carries multiple types of L3VPN services, such as multimedia, signaling, and accounting. In <a href="#EN-US_TASK_0172366595__fig_dc_vrp_route-policy_cfg_003101">Figure 1</a>, two sites, each of which has two PEs accessing the core layer, are used as an example. The core layer is divided into two planes, each of which has three fully meshed P nodes. Nodes in different planes are connected to provide backup paths. MP-BGP is used to advertise inner tags and VPNv4 routes between the PEs. Each PE needs to establish the MP-IBGP peer relationship with a route reflector (RR).</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p><a href="#EN-US_TASK_0172366595__fig_dc_vrp_route-policy_cfg_003101">Figure 1</a> is a simplified networking diagram, in which there are two sites, one RR, and two planes with six P nodes. On the actual network, there are 14 sites with 28 PEs, and each plane has four P nodes and two RRs. Therefore, each RR needs to establish MP-IBGP connections with 28 PEs.</p>
</div></div>
<div class="fignone" id="EN-US_TASK_0172366595__fig_dc_vrp_route-policy_cfg_003101"><a name="EN-US_TASK_0172366595__fig_dc_vrp_route-policy_cfg_003101"></a><a name="fig_dc_vrp_route-policy_cfg_003101"></a><span class="figcap"><b>Figure 1 </b>Applying route-policies</span><br><span><img class="vsd" src="images/fig_dc_vrp_route-policy_cfg_003101.png" width="NaN" height="NaN"></span><br></div>
<p>In <a href="#EN-US_TASK_0172366595__fig_dc_vrp_route-policy_cfg_003101">Figure 1</a>, each PE sends BGP Update messages to the RR, and the other PEs receive BGP Update messages from different planes. Therefore, route-policies need to be applied to ensure that a VPN traffic flow is transmitted through only one plane.</p>
</div></div>
<div class="context"><a name="EN-US_TASK_0172366595__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Precautions</h4><p>When applying route-policies, note the following rules:</p>
<ul><li><p>Configure different route distinguishers (RDs) for the two PEs in the same site.</p>
</li><li><p>Assign different community attributes for the routes advertised by PEs in different planes.</p>
</li><li><p>Run the <strong>undo policy vpn-target</strong> command in the BGP-VPNv4 address family view to ensure that VPN-target-based filtering is not performed on VPNv4 routes.</p>
</li><li><p>When applying a routing policy, ensure that the routing policy name is case sensitive.</p>
</li></ul>
</div></div>
<div class="context"><a name="EN-US_TASK_0172366595__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure different RDs for two PEs in the same site to ensure that each PE can receive two routes from different BGP next hops in the remote site. When two PEs in a site advertise the routes to the same destination, configuring different RDs for the two PEs can ensure that BGP peers consider the advertised routes as two different routes. This is because BGP-VPNv4 uses the VPNv4 addresses that consist of IPv4 addresses and RDs.</p>
</li><li><p>Assign different community attributes to the routes advertised by the PE in plane A and the routes advertised by the PE in plane B.</p>
</li><li><p>Set different local priorities for routes based on the community attributes of the routes. In this manner, the PE in plane A preferentially selects the routes advertised by the remote PE in plane A, and the PE in plane B preferentially selects the routes advertised by the remote PE in plane B.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172366595__1.4.4"></a><a name="1.4.4"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data.</p>

<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" frame="border" border="1" rules="all"><caption><b>Table 1 </b>IP addresses of physical interfaces</caption><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="24.937506249375062%" id="mcps1.4.4.3.2.5.1.1" liSelected="liSelected"><p>Local Device</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="24.937506249375062%" id="mcps1.4.4.3.2.5.1.2" liSelected="liSelected"><p>Local Interface and Its IP Address</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="24.937506249375062%" id="mcps1.4.4.3.2.5.1.3" liSelected="liSelected"><p>Remote Interface and Its IP Address</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="25.187481251874814%" id="mcps1.4.4.3.2.5.1.4" liSelected="liSelected"><p>Remote Device</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" valign="top" width="24.937506249375062%" headers="mcps1.4.4.3.2.5.1.1 "><p>P1</p>
</td>
<td class="cellrowborder" valign="top" width="24.937506249375062%" headers="mcps1.4.4.3.2.5.1.2 "><p>GE <span>0/1/0</span></p>
<p>10.1.1.1/30</p>
</td>
<td class="cellrowborder" valign="top" width="24.937506249375062%" headers="mcps1.4.4.3.2.5.1.3 "><p>GE <span>0/1/0</span></p>
<p>10.1.1.2/30</p>
</td>
<td class="cellrowborder" valign="top" width="25.187481251874814%" headers="mcps1.4.4.3.2.5.1.4 "><p>P3</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="24.937506249375062%" headers="mcps1.4.4.3.2.5.1.1 "><p>P1</p>
</td>
<td class="cellrowborder" valign="top" width="24.937506249375062%" headers="mcps1.4.4.3.2.5.1.2 "><p>GE <span>0/2/0</span></p>
<p>10.1.2.1/30</p>
</td>
<td class="cellrowborder" valign="top" width="24.937506249375062%" headers="mcps1.4.4.3.2.5.1.3 "><p>GE <span>0/1/0</span></p>
<p>10.1.2.2/30</p>
</td>
<td class="cellrowborder" valign="top" width="25.187481251874814%" headers="mcps1.4.4.3.2.5.1.4 "><p>P5</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="24.937506249375062%" headers="mcps1.4.4.3.2.5.1.1 "><p>P1</p>
</td>
<td class="cellrowborder" valign="top" width="24.937506249375062%" headers="mcps1.4.4.3.2.5.1.2 "><p>GE <span>0/3/0</span></p>
<p>10.1.3.1/30</p>
</td>
<td class="cellrowborder" valign="top" width="24.937506249375062%" headers="mcps1.4.4.3.2.5.1.3 "><p>GE <span>0/1/0</span></p>
<p>10.1.3.2/30</p>
</td>
<td class="cellrowborder" valign="top" width="25.187481251874814%" headers="mcps1.4.4.3.2.5.1.4 "><p>RR</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="24.937506249375062%" headers="mcps1.4.4.3.2.5.1.1 "><p>P1</p>
</td>
<td class="cellrowborder" valign="top" width="24.937506249375062%" headers="mcps1.4.4.3.2.5.1.2 "><p>GE <span>0/1/1</span></p>
<p>10.1.4.1/30</p>
</td>
<td class="cellrowborder" valign="top" width="24.937506249375062%" headers="mcps1.4.4.3.2.5.1.3 "><p>GE <span>0/1/0</span></p>
<p>10.1.4.2/30</p>
</td>
<td class="cellrowborder" valign="top" width="25.187481251874814%" headers="mcps1.4.4.3.2.5.1.4 "><p>P2</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="24.937506249375062%" headers="mcps1.4.4.3.2.5.1.1 "><p>P1</p>
</td>
<td class="cellrowborder" valign="top" width="24.937506249375062%" headers="mcps1.4.4.3.2.5.1.2 "><p>GE <span>0/1/2</span></p>
<p>10.1.5.1/30</p>
</td>
<td class="cellrowborder" valign="top" width="24.937506249375062%" headers="mcps1.4.4.3.2.5.1.3 "><p>GE <span>0/1/0</span></p>
<p>10.1.5.2/30</p>
</td>
<td class="cellrowborder" valign="top" width="25.187481251874814%" headers="mcps1.4.4.3.2.5.1.4 "><p>PE1</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="24.937506249375062%" headers="mcps1.4.4.3.2.5.1.1 "><p>P2</p>
</td>
<td class="cellrowborder" valign="top" width="24.937506249375062%" headers="mcps1.4.4.3.2.5.1.2 "><p>GE <span>0/1/1</span></p>
<p>10.1.6.1/30</p>
</td>
<td class="cellrowborder" valign="top" width="24.937506249375062%" headers="mcps1.4.4.3.2.5.1.3 "><p>GE <span>0/1/0</span></p>
<p>10.1.6.2/30</p>
</td>
<td class="cellrowborder" valign="top" width="25.187481251874814%" headers="mcps1.4.4.3.2.5.1.4 "><p>P6</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="24.937506249375062%" headers="mcps1.4.4.3.2.5.1.1 "><p>P2</p>
</td>
<td class="cellrowborder" valign="top" width="24.937506249375062%" headers="mcps1.4.4.3.2.5.1.2 "><p>GE <span>0/3/0</span></p>
<p>10.1.7.1/30</p>
</td>
<td class="cellrowborder" valign="top" width="24.937506249375062%" headers="mcps1.4.4.3.2.5.1.3 "><p>GE <span>0/1/0</span></p>
<p>10.1.7.2/30</p>
</td>
<td class="cellrowborder" valign="top" width="25.187481251874814%" headers="mcps1.4.4.3.2.5.1.4 "><p>P4</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="24.937506249375062%" headers="mcps1.4.4.3.2.5.1.1 "><p>P2</p>
</td>
<td class="cellrowborder" valign="top" width="24.937506249375062%" headers="mcps1.4.4.3.2.5.1.2 "><p>GE <span>0/2/0</span></p>
<p>10.1.8.1/30</p>
</td>
<td class="cellrowborder" valign="top" width="24.937506249375062%" headers="mcps1.4.4.3.2.5.1.3 "><p>GE <span>0/2/0</span></p>
<p>10.1.8.2/30</p>
</td>
<td class="cellrowborder" valign="top" width="25.187481251874814%" headers="mcps1.4.4.3.2.5.1.4 "><p>RR</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="24.937506249375062%" headers="mcps1.4.4.3.2.5.1.1 "><p>P2</p>
</td>
<td class="cellrowborder" valign="top" width="24.937506249375062%" headers="mcps1.4.4.3.2.5.1.2 "><p>GE <span>0/1/2</span></p>
<p>10.1.9.1/30</p>
</td>
<td class="cellrowborder" valign="top" width="24.937506249375062%" headers="mcps1.4.4.3.2.5.1.3 "><p>GE <span>0/1/0</span></p>
<p>10.1.9.2/30</p>
</td>
<td class="cellrowborder" valign="top" width="25.187481251874814%" headers="mcps1.4.4.3.2.5.1.4 "><p>PE2</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="24.937506249375062%" headers="mcps1.4.4.3.2.5.1.1 "><p>P3</p>
</td>
<td class="cellrowborder" valign="top" width="24.937506249375062%" headers="mcps1.4.4.3.2.5.1.2 "><p>GE <span>0/2/0</span></p>
<p>10.1.10.1/30</p>
</td>
<td class="cellrowborder" valign="top" width="24.937506249375062%" headers="mcps1.4.4.3.2.5.1.3 "><p>GE <span>0/2/0</span></p>
<p>10.1.10.2/30</p>
</td>
<td class="cellrowborder" valign="top" width="25.187481251874814%" headers="mcps1.4.4.3.2.5.1.4 "><p>P5</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="24.937506249375062%" headers="mcps1.4.4.3.2.5.1.1 "><p>P3</p>
</td>
<td class="cellrowborder" valign="top" width="24.937506249375062%" headers="mcps1.4.4.3.2.5.1.2 "><p>GE <span>0/3/0</span></p>
<p>10.1.11.1/30</p>
</td>
<td class="cellrowborder" valign="top" width="24.937506249375062%" headers="mcps1.4.4.3.2.5.1.3 "><p>GE <span>0/2/0</span></p>
<p>10.1.11.2/30</p>
</td>
<td class="cellrowborder" valign="top" width="25.187481251874814%" headers="mcps1.4.4.3.2.5.1.4 "><p>P4</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="24.937506249375062%" headers="mcps1.4.4.3.2.5.1.1 "><p>P3</p>
</td>
<td class="cellrowborder" valign="top" width="24.937506249375062%" headers="mcps1.4.4.3.2.5.1.2 "><p>GE <span>0/1/1</span></p>
<p>10.1.12.1/30</p>
</td>
<td class="cellrowborder" valign="top" width="24.937506249375062%" headers="mcps1.4.4.3.2.5.1.3 "><p>GE <span>0/1/0</span></p>
<p>10.1.12.2/30</p>
</td>
<td class="cellrowborder" valign="top" width="25.187481251874814%" headers="mcps1.4.4.3.2.5.1.4 "><p>PE3</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="24.937506249375062%" headers="mcps1.4.4.3.2.5.1.1 "><p>P4</p>
</td>
<td class="cellrowborder" valign="top" width="24.937506249375062%" headers="mcps1.4.4.3.2.5.1.2 "><p>GE <span>0/3/0</span></p>
<p>10.1.13.1/30</p>
</td>
<td class="cellrowborder" valign="top" width="24.937506249375062%" headers="mcps1.4.4.3.2.5.1.3 "><p>GE <span>0/3/0</span></p>
<p>10.1.13.2/30</p>
</td>
<td class="cellrowborder" valign="top" width="25.187481251874814%" headers="mcps1.4.4.3.2.5.1.4 "><p>P6</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="24.937506249375062%" headers="mcps1.4.4.3.2.5.1.1 "><p>P4</p>
</td>
<td class="cellrowborder" valign="top" width="24.937506249375062%" headers="mcps1.4.4.3.2.5.1.2 "><p>GE <span>0/1/1</span></p>
<p>10.1.14.1/30</p>
</td>
<td class="cellrowborder" valign="top" width="24.937506249375062%" headers="mcps1.4.4.3.2.5.1.3 "><p>GE <span>0/1/0</span></p>
<p>10.1.14.2/30</p>
</td>
<td class="cellrowborder" valign="top" width="25.187481251874814%" headers="mcps1.4.4.3.2.5.1.4 "><p>PE4</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="24.937506249375062%" headers="mcps1.4.4.3.2.5.1.1 "><p>P5</p>
</td>
<td class="cellrowborder" valign="top" width="24.937506249375062%" headers="mcps1.4.4.3.2.5.1.2 "><p>GE <span>0/3/0</span></p>
<p>10.1.15.1/30</p>
</td>
<td class="cellrowborder" valign="top" width="24.937506249375062%" headers="mcps1.4.4.3.2.5.1.3 "><p>GE <span>0/2/0</span></p>
<p>10.1.15.2/30</p>
</td>
<td class="cellrowborder" valign="top" width="25.187481251874814%" headers="mcps1.4.4.3.2.5.1.4 "><p>P6</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="24.937506249375062%" headers="mcps1.4.4.3.2.5.1.1 "><p>PE1</p>
</td>
<td class="cellrowborder" valign="top" width="24.937506249375062%" headers="mcps1.4.4.3.2.5.1.2 "><p>GE <span>0/2/0</span></p>
<p>10.1.16.1/30</p>
</td>
<td class="cellrowborder" valign="top" width="24.937506249375062%" headers="mcps1.4.4.3.2.5.1.3 "><p>GE <span>0/2/0</span></p>
<p>10.1.16.2/30</p>
</td>
<td class="cellrowborder" valign="top" width="25.187481251874814%" headers="mcps1.4.4.3.2.5.1.4 "><p>PE2</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="24.937506249375062%" headers="mcps1.4.4.3.2.5.1.1 "><p>PE3</p>
</td>
<td class="cellrowborder" valign="top" width="24.937506249375062%" headers="mcps1.4.4.3.2.5.1.2 "><p>GE <span>0/2/0</span></p>
<p>10.1.17.1/30</p>
</td>
<td class="cellrowborder" valign="top" width="24.937506249375062%" headers="mcps1.4.4.3.2.5.1.3 "><p>GE <span>0/2/0</span></p>
<p>10.1.17.2/30</p>
</td>
<td class="cellrowborder" valign="top" width="25.187481251874814%" headers="mcps1.4.4.3.2.5.1.4 "><p>PE4</p>
</td>
</tr>
</tbody>
</table>
</div>

<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" frame="border" border="1" rules="all"><caption><b>Table 2 </b>IP addresses of loopback interfaces</caption><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="50%" id="mcps1.4.4.4.2.3.1.1" liSelected="liSelected"><p>Local Device</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="50%" id="mcps1.4.4.4.2.3.1.2" liSelected="liSelected"><p>IP Address of Local Loopback 0 Interface</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.4.4.2.3.1.1 "><p>P1</p>
</td>
<td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.4.4.2.3.1.2 "><p>10.1.1.9/32</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.4.4.2.3.1.1 "><p>P2</p>
</td>
<td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.4.4.2.3.1.2 "><p>10.2.2.9/32</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.4.4.2.3.1.1 "><p>P3</p>
</td>
<td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.4.4.2.3.1.2 "><p>10.3.3.9/32</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.4.4.2.3.1.1 "><p>P4</p>
</td>
<td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.4.4.2.3.1.2 "><p>10.4.4.9/32</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.4.4.2.3.1.1 "><p>P5</p>
</td>
<td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.4.4.2.3.1.2 "><p>10.5.5.9/32</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.4.4.2.3.1.1 "><p>P6</p>
</td>
<td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.4.4.2.3.1.2 "><p>10.6.6.9/32</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.4.4.2.3.1.1 "><p>PE1</p>
</td>
<td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.4.4.2.3.1.2 "><p>10.7.7.9/32</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.4.4.2.3.1.1 "><p>PE2</p>
</td>
<td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.4.4.2.3.1.2 "><p>10.8.8.9/32</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.4.4.2.3.1.1 "><p>PE3</p>
</td>
<td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.4.4.2.3.1.2 "><p>10.9.9.9/32</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.4.4.2.3.1.1 "><p>PE4</p>
</td>
<td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.4.4.2.3.1.2 "><p>10.10.10.9/32</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.4.4.2.3.1.1 "><p>RR</p>
</td>
<td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.4.4.2.3.1.2 "><p>10.11.11.9/32</p>
</td>
</tr>
</tbody>
</table>
</div>

<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" frame="border" border="1" rules="all"><caption><b>Table 3 </b>BGP parameter values</caption><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="50%" id="mcps1.4.4.5.2.3.1.1" liSelected="liSelected"><p>BGP Parameter</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="50%" id="mcps1.4.4.5.2.3.1.2" liSelected="liSelected"><p>Value</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.4.5.2.3.1.1 "><p>AS number</p>
</td>
<td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.4.5.2.3.1.2 "><p>65000</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.4.5.2.3.1.1 "><p>Router ID</p>
</td>
<td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.4.5.2.3.1.2 "><p>Same as the address of Loopback 0 interface</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.4.5.2.3.1.1 "><p>BGP community attribute</p>
</td>
<td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.4.5.2.3.1.2 "><p>Plane A: 65000:100</p>
<p>Plane B: 65000:200</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.4.5.2.3.1.1 "><p>BGP local priority</p>
</td>
<td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.4.5.2.3.1.2 "><p>Plane A: The local priority of community attribute 65000:100 is set to 200.</p>
<p>Plane B: The local priority of community attribute 65000:200 is set to 200.</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.4.5.2.3.1.1 "><p>Routing policy name</p>
</td>
<td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.4.5.2.3.1.2 "><p>Policy to filter imported routes: <strong>local_pre</strong></p>
<p>Policy to filter routes to be advertised: <strong>comm</strong></p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.4.5.2.3.1.1 "><p>Community filter name</p>
</td>
<td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.4.5.2.3.1.2 "><p>1</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.4.5.2.3.1.1 "><p>BGP peer group name</p>
</td>
<td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.4.5.2.3.1.2 "><p>Client</p>
</td>
</tr>
</tbody>
</table>
</div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172366595__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure names for devices and IP addresses for interfaces.</span><p><p>For configuration details, see <a href="#EN-US_TASK_0172366595__section_dc_vrp_cfg_00652605">Configuration Files</a> in this section.</p>
</p></li><li><span>Configure an IGP.</span><p><p>In this example, IS-IS is used. For detailed configurations, see the configuration files in this example.</p>
<p>After the configuration, run the <strong>display ip routing-table</strong> command. You can view that PEs, P nodes and PEs, and P nodes have learned the addresses of Loopback 0 interfaces from each other.</p>
</p></li><li><span>Establish MP-IBGP connections between PEs and RRs.</span><p><p># Use the configuration of PE1 as an example. Configurations of other PEs are similar to that of PE1. For configuration details, see <a href="#EN-US_TASK_0172366595__section_dc_vrp_cfg_00652605">Configuration Files</a> in this section.</p>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>bgp 65000</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp] <strong>peer 10.11.11.9 as-number 65000</strong>
[<span class="keyword">*</span>PE1-bgp] <strong>peer 10.11.11.9 connect-interface LoopBack0</strong>
[<span class="keyword">*</span>PE1-bgp] <strong>ipv4-family unicast</strong>
[<span class="keyword">*</span>PE1-bgp-af-ipv4] <strong>undo peer 10.11.11.9 enable</strong>
[<span class="keyword">*</span>PE1-bgp] <strong>ipv4-family vpnv4</strong>
[<span class="keyword">*</span>PE1-bgp-af-vpnv4] <strong>peer 10.11.11.9 enable</strong>
[<span class="keyword">*</span>PE1-bgp-af-vpnv4] <strong>commit</strong></pre>
<p># Configure the RR.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RR] <strong>bgp 65000</strong>
[<span class="keyword">*</span>RR-bgp] <strong>group client internal</strong>
[<span class="keyword">*</span>RR-bgp] <strong>peer client connect-interface LoopBack0</strong>
[<span class="keyword">*</span>RR-bgp] <strong>ipv4-family unicast</strong>
[<span class="keyword">*</span>RR-bgp-af-ipv4] <strong>undo peer client enable</strong>
[<span class="keyword">*</span>RR-bgp-af-ipv4] <strong>quit</strong>
[<span class="keyword">*</span>RR-bgp] <strong>ipv4-family vpnv4</strong>
[<span class="keyword">*</span>RR-bgp-af-vpnv4] <strong>undo policy vpn-target</strong>
[<span class="keyword">*</span>RR-bgp-af-vpnv4] <strong>peer client enable</strong>
[<span class="keyword">*</span>RR-bgp-af-vpnv4] <strong>peer 10.7.7.9 group client</strong>
[<span class="keyword">*</span>RR-bgp-af-vpnv4] <strong>peer 10.8.8.9 group client</strong>
[<span class="keyword">*</span>RR-bgp-af-vpnv4] <strong>peer 10.9.9.9 group client</strong>
[<span class="keyword">*</span>RR-bgp-af-vpnv4] <strong>peer 10.10.10.9 group client</strong>
[<span class="keyword">*</span>RR-bgp-af-vpnv4] <strong>peer client reflect-client</strong>
[<span class="keyword">*</span>RR-bgp-af-vpnv4] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RR-bgp-af-vpnv4] <strong>quit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The <strong>undo policy vpn-target</strong> command needs to be run in the BGP-VPNv4 address family view of the RR to ensure that VPN-target-based filtering is not performed on VPNv4 routes. By default, an RR performs VPN-target-based filtering on the received VPNv4 routes. The routes that match the filtering rules are added to the VPN routing table, and other routes are discarded. In this example, no VPN instances are configured on the RR. In this case, if VPN-target-based filtering is enabled, all the received VPNv4 routes will be discarded.</p>
</div></div>
<p>After the configuration, run the <strong>display bgp vpnv4 all peer</strong> command on the RR. The following command output shows that the RR has established MP-IBGP connections with all PEs.</p>
<pre class="screen">&lt;RR&gt; <strong>display bgp vpnv4 all peer</strong>
 BGP local router ID : 10.11.11.9
 Local AS number : 65000
 Total number of peers : 4                 Peers in established state : 4
  Peer          V    AS     MsgRcvd  MsgSent  OutQ  Up/Down       State       PrefRcv
  10.7.7.9      4    65000  79       82        0     00:01:31     <strong>Established</strong>      0
  10.8.8.9      4    65000  42       66        0     00:01:16     <strong>Established</strong>      0
  10.9.9.9      4    65000  21       34        0     00:00:50     <strong>Established</strong>      0
  10.10.10.9    4    65000  2         4        0     00:00:21     <strong>Established</strong>      0
</pre>
</p></li><li><span>Configure route-policies.</span><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Use the configurations of PE1, PE2, and the RR as an example. The configurations of PE3 and PE4 are similar to the configurations of PE1 and PE2 respectively. For configuration details, see <a href="#EN-US_TASK_0172366595__section_dc_vrp_cfg_00652605">Configuration Files</a> in this section.</p>
</div></div>
<p># Configure a route-policy on PE1 so that the route advertised by the PE in plane A to the RR can carry community attribute 65000:100.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>route-policy comm permit node 10</strong>
[<span class="keyword">*</span>PE1-route-policy] <strong>apply community 65000:100</strong>
[<span class="keyword">*</span>PE1-route-policy] <strong>commit</strong></pre>
<p># Configure a route-policy on PE2 so that the route advertised by the PE in plane B to the RR can carry community attribute 65000:200.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>route-policy comm permit node 10</strong>
[<span class="keyword">*</span>PE2-route-policy] <strong>apply community 65000:200</strong>
[<span class="keyword">*</span>PE2-route-policy] <strong>commit</strong></pre>
<p># On PE1, apply the route-policy to the advertised BGP VPNv4 route so that the community attribute can be advertised to the RR.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 65000</strong>
[<span class="keyword">*</span>PE1-bgp] <strong>ipv4-family vpnv4</strong>
[<span class="keyword">*</span>PE1-bgp-af-vpnv4] <strong>peer 10.11.11.9 route-policy comm export</strong>
[<span class="keyword">*</span>PE1-bgp-af-vpnv4] <strong>peer 10.11.11.9 advertise-community</strong>
[<span class="keyword">*</span>PE1-bgp-af-vpnv4] <strong>commit</strong></pre>
<p># On PE2, apply the route-policy to the advertised BGP VPNv4 route so that the community attribute can be advertised to the RR.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>bgp 65000</strong>
[<span class="keyword">*</span>PE2-bgp] <strong>ipv4-family vpnv4</strong>
[<span class="keyword">*</span>PE2-bgp-af-vpnv4] <strong>peer 10.11.11.9 route-policy comm export</strong>
[<span class="keyword">*</span>PE2-bgp-af-vpnv4] <strong>peer 10.11.11.9 advertise-community</strong>
[<span class="keyword">*</span>PE2-bgp-af-vpnv4] <strong>commit</strong></pre>
<p># Configure the RR to advertise the community attributes to the PEs.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RR] <strong>bgp 65000</strong>
[<span class="keyword">*</span>RR-bgp] <strong>ipv4-family vpnv4</strong>
[<span class="keyword">*</span>RR-bgp-af-vpnv4] <strong>peer client advertise-community</strong>
[<span class="keyword">*</span>RR-bgp-af-vpnv4] <strong>commit</strong></pre>
<p># Configure a community filter on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>ip community-filter 1 permit 65000:100</strong>
[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure a community filter on PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>ip community-filter 1 permit 65000:200</strong>
[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># On PE1, configure a route-policy and set the local preference of the route with community attribute 65000:100 to 200.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>route-policy local_pre permit node 10</strong>
[<span class="keyword">*</span>PE1-route-policy] <strong>if-match community-filter 1</strong>
[<span class="keyword">*</span>PE1-route-policy] <strong>apply local-preference 200</strong>
[<span class="keyword">*</span>PE1-route-policy] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-route-policy] <strong>quit</strong></pre>
<p># On PE2, configure a route-policy and set the local preference of the route with community attribute 65000:200 to 200.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>route-policy local_pre permit node 10</strong>
[<span class="keyword">*</span>PE2-route-policy] <strong>if-match community-filter 1</strong>
[<span class="keyword">*</span>PE2-route-policy] <strong>apply local-preference 200</strong>
[<span class="keyword">*</span>PE2-route-policy] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-route-policy] <strong>quit</strong></pre>
<p># On PE1, apply the route-policy to the imported BGP VPNv4 route so that the PE in plane A prefers the route advertised by the remote PE in plane A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 65000</strong>
[<span class="keyword">*</span>PE1-bgp] <strong>ipv4-family vpnv4</strong>
[<span class="keyword">*</span>PE1-bgp-af-vpnv4] <strong>peer 10.11.11.9 route-policy local_pre import</strong>
[<span class="keyword">*</span>PE1-bgp-af-vpnv4] <strong>commit</strong></pre>
<p># On PE2, apply the route-policy to the imported BGP VPNv4 route so that the PE in plane B prefers the route advertised by the remote PE in plane B.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>bgp 65000</strong>
[<span class="keyword">*</span>PE2-bgp] <strong>ipv4-family vpnv4</strong>
[<span class="keyword">*</span>PE2-bgp-af-vpnv4] <strong>peer 10.11.11.9 route-policy local_pre import</strong>
[<span class="keyword">*</span>PE2-bgp-af-vpnv4] <strong>commit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>After this configuration, you also need to configure MPLS, establish tunnels, configure MPLS L3VPN functions, and connect the PEs to CEs. For configuration details, see <a href="#EN-US_TASK_0172366595__section_dc_vrp_cfg_00652605">Configuration Files</a> in this section.</p>
</div></div>
</p></li><li><span>Verify the configuration.</span><p><p># Run the <strong>display bgp vpnv4 all routing-table community</strong> command on a PE to view information about the VPNv4 routes with community attributes. Use the command output on PE1 and PE2 as an example.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display bgp vpnv4 all routing-table community</strong>
Total Number of Routes from all PE: 2
BGP Local router ID is 10.7.7.9
Status codes: * - valid, &gt; - best, d - damped,
              h - history,  i - internal, s - suppressed, S - Stale
              Origin : i - IGP, e - EGP, ? - incomplete


 Route Distinguisher: 65000:10001012
       Network        NextHop        MED        LocPrf    PrefVal  Community
*&gt;   10.22.1.0/24     10.9.9.9         0           200             65000:100
*                     10.10.10.9       0           100             65000:200

 Total routes of vpn-instance NGN_Media: 2
      Network         NextHop        MED        LocPrf    PrefVal  Community
 *&gt;i  10.22.1.0/24    10.9.9.9         0           200       0     65000:100
*                     10.10.10.9       0           100       0     65000:200

[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>display bgp vpnv4 all routing-table community</strong>
Total Number of Routes from all PE: 2
BGP Local router ID is 10.8.8.9
Status codes: * - valid, &gt; - best, d - damped,
              h - history,  i - internal, s - suppressed, S - Stale
              Origin : i - IGP, e - EGP, ? - incomplete


 Route Distinguisher: 65000:10001011
       Network        NextHop        MED        LocPrf    PrefVal  Community
*&gt;   10.22.1.0/24     10.10.10.9       0          200              65000:200
*                     10.9.9.9         0          100              65000:100

 Total routes of vpn-instance NGN_Media: 2
      Network         NextHop        MED        LocPrf    PrefVal  Community
 *&gt;i  10.22.1.0/24    10.10.10.9       0         200        0      65000:200
*                     10.9.9.9         0         100        0      65000:100</pre>
<p># Run the <strong>display ip routing-table vpn-instance NGN_Media 10.22.1.0 24</strong> command on PE1. The command output shows that the next hop of the route to 10.22.1.0/24 is PE3, indicating that PE1 prefers the route advertised by PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display ip routing-table vpn-instance NGN_Media 10.22.1.0 24</strong>
<span class="keyword">Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route</span>
------------------------------------------------------------------------------
Routing Table: NGN_Media
Destination/Mask  Proto  Pre  Cost  Flags  NextHop   Interface
   10.22.1.0/24   BGP    255  0       RD   <strong>10.9.9.9</strong>  GigabitEthernet<span>0/1/0</span></pre>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0172366595__section_dc_vrp_cfg_00652605"><a name="EN-US_TASK_0172366595__section_dc_vrp_cfg_00652605"></a><a name="section_dc_vrp_cfg_00652605"></a><a name="EN-US_TASK_0172366595__1.4.6"></a><a name="1.4.6"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>P1 configuration file</p>
<pre class="screen">#
sysname P1
#
mpls lsr-id 10.1.1.9
#
mpls
#
mpls ldp
#
isis 64
 network-entity 49.0091.0100.0100.1009.00
#
interface GigabitEthernet<span>0/1/0</span>
 description toP3GE<span>0/1/0</span>
 undo shutdown
 ip address 10.1.1.1 255.255.255.252
 mpls
 mpls ldp
 isis enable 64
#
interface GigabitEthernet<span>0/2/0</span>
 description toP5GE<span>0/1/0</span>
 undo shutdown
 ip address 10.1.2.1 255.255.255.252
 mpls
 mpls ldp
 isis enable 64
#
interface GigabitEthernet<span>0/3/0</span>
 description toRRGE<span>0/1/0</span>
 undo shutdown
 ip address 10.1.3.1 255.255.255.252
 mpls
 mpls ldp
 isis enable 64
#
interface GigabitEthernet<span>0/1/1</span>
 description toP2GE<span>0/1/0</span>
 undo shutdown
 ip address 10.1.4.1 255.255.255.252
 mpls
 mpls ldp
 isis enable 64
#
interface GigabitEthernet<span>0/1/2</span>
 description toP2GE<span>0/1/0</span>
 undo shutdown
 ip address 10.1.5.1 255.255.255.252
 mpls
 mpls ldp
 isis enable 64
#
interface LoopBack0
 ip address 10.1.1.9 255.255.255.255
 isis enable 64
#
return</pre>
</li><li><p>P2 configuration file</p>
<pre class="screen">#
sysname P2
#
mpls lsr-id 10.2.2.9
#
mpls
#
mpls ldp
#
isis 64
 network-entity 49.0091.0100.0200.2009.00
#
interface GigabitEthernet<span>0/1/0</span>
 description toP1GE<span>0/1/1</span>
 undo shutdown
 ip address 10.1.4.2 255.255.255.252
 mpls
 mpls ldp
 isis enable 64
#
interface GigabitEthernet<span>0/2/0</span>
 description toRRGE<span>0/2/0</span>
 undo shutdown
 ip address 10.1.8.1 255.255.255.252
 mpls
 mpls ldp
 isis enable 64
#
interface GigabitEthernet<span>0/3/0</span>
 description toP4GE<span>0/1/0</span>
 undo shutdown
 ip address 10.1.7.1 255.255.255.252
 mpls
 mpls ldp
 isis enable 64
#
interface GigabitEthernet<span>0/1/1</span>
 description toP6GE<span>0/1/0</span>
 undo shutdown
 ip address 10.1.6.1 255.255.255.252
 mpls
 mpls ldp
 isis enable 64
#
interface GigabitEthernet<span>0/1/2</span>
 description toPE2GE<span>0/1/0</span>
 undo shutdown
 ip address 10.1.9.1 255.255.255.252
 mpls
 mpls ldp
 isis enable 64
#
interface LoopBack0
 ip address 10.2.2.9 255.255.255.255
 isis enable 64
#
return</pre>
</li><li><p>P3 configuration file</p>
<pre class="screen">#
sysname P3
#
mpls lsr-id 10.3.3.9
#
mpls
#
mpls ldp
#
isis 64
 network-entity 49.0091.0100.0300.3009.00
#
interface GigabitEthernet<span>0/1/0</span>
 description toP1GE<span>0/1/0</span>
 undo shutdown
 ip address 10.1.1.2 255.255.255.252
 mpls
 mpls ldp
 isis enable 64
#
interface GigabitEthernet<span>0/2/0</span>
 description toP5GE<span>0/2/0</span>
 undo shutdown
 ip address 10.1.10.1 255.255.255.252
 mpls
 mpls ldp
 isis enable 64
#
interface GigabitEthernet<span>0/3/0</span>
 description toP4GE<span>0/2/0</span>
 undo shutdown
 ip address 10.1.11.1 255.255.255.252
 mpls
 mpls ldp
 isis enable 64
#
interface GigabitEthernet<span>0/1/1</span>
 description toPE3GE<span>0/1/0</span>
 undo shutdown
 ip address 10.1.12.1 255.255.255.252
 mpls
 mpls ldp
 isis enable 64
#
interface LoopBack0
 ip address 10.3.3.9 255.255.255.255
 isis enable 64
#
return</pre>
</li><li><p>P4 configuration file</p>
<pre class="screen">#
sysname P4
#
mpls lsr-id 10.4.4.9
#
mpls
#
mpls ldp
#
isis 64
 network-entity 49.0091.0100.0400.4009.00
#
interface GigabitEthernet<span>0/1/0</span>
 description toP2GE<span>0/3/0</span>
 undo shutdown
 ip address 10.1.7.2 255.255.255.252
 mpls
 mpls ldp
 isis enable 64
#
interface GigabitEthernet<span>0/2/0</span>
 description toP3GE<span>0/3/0</span>
 undo shutdown
 ip address 10.1.11.2 255.255.255.252
 mpls
 mpls ldp
 isis enable 64
#
interface GigabitEthernet<span>0/3/0</span>
 description toP6GE<span>0/3/0</span>
 undo shutdown
 ip address 10.1.13.1 255.255.255.252
 mpls
 mpls ldp
 isis enable 64
#
interface GigabitEthernet<span>0/1/1</span>
 description toPE4GE<span>0/1/0</span>
 undo shutdown
 ip address 10.1.14.1 255.255.255.252
 mpls
 mpls ldp
 isis enable 64
#
interface LoopBack0
 ip address 10.4.4.9 255.255.255.255
 isis enable 64
#
return</pre>
</li><li><p>P5 configuration file</p>
<pre class="screen">#
sysname P5
#
mpls lsr-id 10.5.5.9
#
mpls
#
mpls ldp
#
isis 64
 network-entity 49.0091.0100.0500.5009.00
#
interface GigabitEthernet<span>0/1/0</span>
 description toP1GE<span>0/2/0</span>
 undo shutdown
 ip address 10.1.2.2 255.255.255.252
 mpls
 mpls ldp
 isis enable 64
#
interface GigabitEthernet<span>0/2/0</span>
 description toP3GE<span>0/2/0</span>
 undo shutdown
 ip address 10.1.10.2 255.255.255.252
 mpls
 mpls ldp
 isis enable 64
#
interface GigabitEthernet<span>0/3/0</span>
 description toP6GE<span>0/2/0</span>
 undo shutdown
 ip address 10.1.15.1 255.255.255.252
 mpls
 mpls ldp
 isis enable 64
#
interface LoopBack0
 ip address 10.5.5.9 255.255.255.255
 isis enable 64
#
return</pre>
</li><li><p>P6 configuration file</p>
<pre class="screen">#
sysname P6
#
mpls lsr-id 10.6.6.9
#
mpls
#
mpls ldp
#
isis 64
 network-entity 49.0091.0100.0600.6009.00
#
interface GigabitEthernet<span>0/1/0</span>
 description toP2GE<span>0/1/1</span>
 undo shutdown
 ip address 10.1.6.2 255.255.255.252
 mpls
 mpls ldp
 isis enable 64
#
interface GigabitEthernet<span>0/2/0</span>
 description toP5GE<span>0/3/0</span>
 undo shutdown
 ip address 10.1.15.2 255.255.255.252
 mpls
 mpls ldp
 isis enable 64
#
interface GigabitEthernet<span>0/3/0</span>
 description toP4GE<span>0/3/0</span>
 undo shutdown
 ip address 10.1.13.2 255.255.255.252
 mpls
 mpls ldp
 isis enable 64
#
interface LoopBack0
 ip address 10.6.6.9 255.255.255.255
 isis enable 64
#
return</pre>
</li><li><p>PE1 configuration file</p>
<pre class="screen">#
sysname PE1
#
ip vpn-instance NGN_Media
 route-distinguisher 65000:10001012
 apply-label per-instance
 vpn-target 65000:100 export-extcommunity
 vpn-target 65000:100 import-extcommunity
 vpn-target 65000:200 import-extcommunity
 vpn-target 65000:300 import-extcommunity
ip vpn-instance NGN_Other
 route-distinguisher 65000:30001012
 apply-label per-instance
 vpn-target 65000:300 export-extcommunity
 vpn-target 65000:100 import-extcommunity
 vpn-target 65000:200 import-extcommunity
 vpn-target 65000:300 import-extcommunity
ip vpn-instance NGN_Signaling
 route-distinguisher 65000:20001012
 apply-label per-instance
 vpn-target 65000:200 export-extcommunity
 vpn-target 65000:100 import-extcommunity
 vpn-target 65000:200 import-extcommunity
 vpn-target 65000:300 import-extcommunity
#
mpls lsr-id 10.7.7.9
#
mpls
#
mpls ldp
#
isis 64
 network-entity 49.0091.0100.0700.7009.00
#
interface GigabitEthernet<span>0/1/0</span>
 description toP1GE<span>0/1/2</span>
 undo shutdown
 ip address 10.1.5.2 255.255.255.252
 mpls
 mpls ldp
 isis enable 64
#
interface GigabitEthernet<span>0/2/0</span>
 description toPE2GE<span>0/2/0</span>
 undo shutdown
 ip address 10.1.16.1 255.255.255.252
 mpls
 mpls ldp
 isis enable 64
#
interface GigabitEthernet<span>0/3/0</span>
 undo shutdown
#
interface GigabitEthernet<span>0/3/0</span>.10
 ip binding vpn-instance NGN_Media
 vlan-type dot1q 10
 ip address 10.21.1.73 255.255.255.252
#
interface GigabitEthernet<span>0/3/0</span>.11
 ip binding vpn-instance NGN_Signaling
 vlan-type dot1q 11
 ip address 10.21.1.77 255.255.255.252
#
interface GigabitEthernet<span>0/3/0</span>.12
 ip binding vpn-instance NGN_Other
 vlan-type dot1q 12
 ip address 10.21.1.81 255.255.255.252
#
interface LoopBack0
 ip address 10.7.7.9 255.255.255.255
 isis enable 64
#
bgp 65000
 peer 10.11.11.9 as-number 65000
 peer 10.11.11.9 connect-interface LoopBack0
 #
 ipv4-family unicast
  undo synchronization 
  undo peer 10.11.11.9 enable
 #
 ipv4-family vpnv4
  policy vpn-target
  peer 10.11.11.9 enable
  peer 10.11.11.9 route-policy local_pre import
  peer 10.11.11.9 route-policy comm export
  peer 10.11.11.9 advertise-community
 #
 ipv4-family vpn-instance NGN_Media
  aggregate 10.21.1.0 255.255.255.0 detail-suppressed
  import-route direct
 #
 ipv4-family vpn-instance NGN_Other
  aggregate 10.21.1.0 255.255.255.0 detail-suppressed
  import-route direct
 #
 ipv4-family vpn-instance NGN_Signaling
  aggregate 10.21.1.0 255.255.255.0 detail-suppressed
  import-route direct
#
route-policy comm permit node 10
 apply community 65000:100
#
ip community-filter 1 permit 65000:100
#
route-policy local_pre permit node 10
 if-match community-filter 1
 apply local-preference 200
#
return</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#
sysname PE2
#
ip vpn-instance NGN_Media
 route-distinguisher 65000:10001011
 apply-label per-instance
 vpn-target 65000:100 export-extcommunity
 vpn-target 65000:100 import-extcommunity
 vpn-target 65000:200 import-extcommunity
 vpn-target 65000:300 import-extcommunity
ip vpn-instance NGN_Other
 route-distinguisher 65000:30001011
 apply-label per-instance
 vpn-target 65000:300 export-extcommunity
 vpn-target 65000:100 import-extcommunity
 vpn-target 65000:200 import-extcommunity
 vpn-target 65000:300 import-extcommunity
ip vpn-instance NGN_Signaling
 route-distinguisher 65000:20001011
 apply-label per-instance
 vpn-target 65000:200 export-extcommunity
 vpn-target 65000:100 import-extcommunity
 vpn-target 65000:200 import-extcommunity
 vpn-target 65000:300 import-extcommunity
#
mpls lsr-id 10.8.8.9
#
mpls
#
mpls ldp
#
isis 64
 network-entity 49.0091.0100.0800.8009.00
#
interface GigabitEthernet<span>0/1/0</span>
 description toP2GE<span>0/1/2</span>
 undo shutdown
 ip address 10.1.9.2 255.255.255.252
 mpls
 mpls ldp
 isis enable 64
#
interface GigabitEthernet<span>0/2/0</span>
 description toPE1GE<span>0/2/0</span>
 undo shutdown
 ip address 10.1.16.2 255.255.255.252
 mpls
 mpls ldp
 isis enable 64
#
interface GigabitEthernet<span>0/3/0</span>
 undo shutdown
#
interface GigabitEthernet<span>0/3/0</span>.10
 ip binding vpn-instance NGN_Media
 vlan-type dot1q 10
 ip address 10.21.1.13 255.255.255.252
#
interface GigabitEthernet<span>0/3/0</span>.11
 ip binding vpn-instance NGN_Signaling
 vlan-type dot1q 11
 ip address 10.21.1.17 255.255.255.252
#
interface GigabitEthernet<span>0/3/0</span>.12
 ip binding vpn-instance NGN_Other
 vlan-type dot1q 12
 ip address 10.21.1.21 255.255.255.252
#
interface LoopBack0
 ip address 10.8.8.9 255.255.255.255
 isis enable 64
#
bgp 65000
 peer 10.11.11.9 as-number 65000
 peer 10.11.11.9 connect-interface LoopBack0
 #
 ipv4-family unicast
  undo synchronization 
  undo peer 10.11.11.9 enable
 #
 ipv4-family vpnv4
  policy vpn-target
  peer 10.11.11.9 enable
  peer 10.11.11.9 route-policy local_pre import
  peer 10.11.11.9 route-policy comm export
  peer 10.11.11.9 advertise-community
 #
 ipv4-family vpn-instance NGN_Media
  aggregate 10.21.1.0 255.255.255.0 detail-suppressed
  import-route direct
 #
 ipv4-family vpn-instance NGN_Other
  aggregate 10.21.1.0 255.255.255.0 detail-suppressed
  import-route direct
 #
 ipv4-family vpn-instance NGN_Signaling
  aggregate 10.21.1.0 255.255.255.0 detail-suppressed
  import-route direct
#
route-policy comm permit node 10
 apply community 65000:200
#
ip community-filter 1 permit 65000:200
#
route-policy local_pre permit node 10
 if-match community-filter 1
 apply local-preference 200
#
return</pre>
</li><li><p>PE3 configuration file</p>
<pre class="screen">#
sysname PE3
#
ip vpn-instance NGN_Media
 route-distinguisher 65000:10000811
 apply-label per-instance
 vpn-target 65000:100 export-extcommunity
 vpn-target 65000:100 import-extcommunity
 vpn-target 65000:200 import-extcommunity
 vpn-target 65000:300 import-extcommunity
ip vpn-instance NGN_Other
 route-distinguisher 65000:30000811
 apply-label per-instance
 vpn-target 65000:300 export-extcommunity
 vpn-target 65000:100 import-extcommunity
 vpn-target 65000:200 import-extcommunity
 vpn-target 65000:300 import-extcommunity
ip vpn-instance NGN_Signaling
 route-distinguisher 65000:20000811
 apply-label per-instance
 vpn-target 65000:200 export-extcommunity
 vpn-target 65000:100 import-extcommunity
 vpn-target 65000:200 import-extcommunity
 vpn-target 65000:300 import-extcommunity
#
mpls lsr-id 10.9.9.9
#
mpls
#
mpls ldp
#
isis 64
 network-entity 49.0091.0100.0900.9009.00
#
interface GigabitEthernet<span>0/1/0</span>
 description toP3GE<span>0/1/1</span>
 undo shutdown
 ip address 10.1.12.2 255.255.255.252
 mpls
 mpls ldp
 isis enable 64
#
interface GigabitEthernet<span>0/2/0</span>
 description toPE4GE<span>0/2/0</span>
 undo shutdown
 ip address 10.1.17.1 255.255.255.252
 mpls
 mpls ldp
 isis enable 64
#
interface GigabitEthernet<span>0/3/0</span>
 undo shutdown
#
interface GigabitEthernet<span>0/3/0</span>.10
 ip binding vpn-instance NGN_Media
 vlan-type dot1q 10
 ip address 10.22.1.73 255.255.255.252
#
interface GigabitEthernet<span>0/3/0</span>.11
 ip binding vpn-instance NGN_Signaling
 vlan-type dot1q 11
 ip address 10.22.1.77 255.255.255.252
#
interface GigabitEthernet<span>0/3/0</span>.12
 ip binding vpn-instance NGN_Other
 vlan-type dot1q 12
 ip address 10.22.1.81 255.255.255.252
#
interface LoopBack0
 ip address 10.9.9.9 255.255.255.255
 isis enable 64
#
bgp 65000
 peer 10.11.11.9 as-number 65000
 peer 10.11.11.9 connect-interface LoopBack0
 #
 ipv4-family unicast
  undo synchronization 
  undo peer 10.11.11.9 enable
 #
 ipv4-family vpnv4
  policy vpn-target
  peer 10.11.11.9 enable
  peer 10.11.11.9 route-policy local_pre import
  peer 10.11.11.9 route-policy comm export
  peer 10.11.11.9 advertise-community
 #
 ipv4-family vpn-instance NGN_Media
  aggregate 10.22.1.0 255.255.255.0 detail-suppressed
  import-route direct
 #
 ipv4-family vpn-instance NGN_Other
  aggregate 10.22.1.0 255.255.255.0 detail-suppressed
  import-route direct
 #
 ipv4-family vpn-instance NGN_Signaling
  aggregate 10.22.1.0 255.255.255.0 detail-suppressed
  import-route direct
#
route-policy comm permit node 10
 apply community 65000:100
#
ip community-filter 1 permit 65000:100
#
route-policy local_pre permit node 10
 if-match community-filter 1
 apply local-preference 200
#
route-policy local_pre permit node 20
#
return</pre>
</li><li><p>PE4 configuration file</p>
<pre class="screen">#
sysname PE4
#
ip vpn-instance NGN_Media
 route-distinguisher 65000:10000712
 apply-label per-instance
 vpn-target 65000:100 export-extcommunity
 vpn-target 65000:100 import-extcommunity
 vpn-target 65000:200 import-extcommunity
 vpn-target 65000:300 import-extcommunity
#
ip vpn-instance NGN_Other
 route-distinguisher 65000:30000712
 apply-label per-instance
 vpn-target 65000:300 export-extcommunity
 vpn-target 65000:100 import-extcommunity
 vpn-target 65000:200 import-extcommunity
 vpn-target 65000:300 import-extcommunity
#
ip vpn-instance NGN_Signaling
 route-distinguisher 65000:20000712
 apply-label per-instance
 vpn-target 65000:200 export-extcommunity
 vpn-target 65000:100 import-extcommunity
 vpn-target 65000:200 import-extcommunity
 vpn-target 65000:300 import-extcommunity
#
mpls lsr-id 10.10.10.9
#
mpls
#
mpls ldp
#
isis 64
 network-entity 49.0091.0100.1001.0009.00
#
interface GigabitEthernet<span>0/1/0</span>
 description toP4GE<span>0/1/1</span>
 undo shutdown
 ip address 10.1.14.2 255.255.255.252
 mpls
 mpls ldp
 isis enable 64
#
interface GigabitEthernet<span>0/2/0</span>
 description toPE3GE<span>0/2/0</span>
 undo shutdown
 ip address 10.1.17.2 255.255.255.252
 mpls
 mpls ldp
 isis enable 64
#
interface GigabitEthernet<span>0/3/0</span>
 undo shutdown
#
interface GigabitEthernet<span>0/3/0</span>.10
 ip binding vpn-instance NGN_Media
 vlan-type dot1q 10
 ip address 10.22.1.13 255.255.255.252
#
interface GigabitEthernet<span>0/3/0</span>.11
 ip binding vpn-instance NGN_Signaling
 vlan-type dot1q 11
 ip address 10.22.1.17 255.255.255.252
#
interface GigabitEthernet<span>0/3/0</span>.12
 ip binding vpn-instance NGN_Other
 vlan-type dot1q 12
 ip address 10.22.1.21 255.255.255.252
#
interface LoopBack0
 ip address 10.10.10.9 255.255.255.255
 isis enable 64
#
bgp 65000
 peer 10.11.11.9 as-number 65000
 peer 10.11.11.9 connect-interface LoopBack0
 #
 ipv4-family unicast
  undo synchronization 
  undo peer 10.11.11.9 enable
 #
 ipv4-family vpnv4
  policy vpn-target
  peer 10.11.11.9 enable
  peer 10.11.11.9 route-policy local_pre import
  peer 10.11.11.9 route-policy comm export
  peer 10.11.11.9 advertise-community
 #
 ipv4-family vpn-instance NGN_Media
  aggregate 10.22.1.0 255.255.255.0 detail-suppressed
  import-route direct
 #
 ipv4-family vpn-instance NGN_Other
  aggregate 10.22.1.0 255.255.255.0 detail-suppressed
  import-route direct
 #
 ipv4-family vpn-instance NGN_Signaling
  aggregate 10.22.1.0 255.255.255.0 detail-suppressed
  import-route direct
#
route-policy comm permit node 10
 apply community 65000:200
#
ip community-filter 1 permit 65000:200
#
route-policy local_pre permit node 10
 if-match community-filter 1
 apply local-preference 200
#
return</pre>
</li><li><p>RR configuration file</p>
<pre class="screen">#
sysname RR
#
isis 64
 network-entity 49.0091.0100.1101.1009.00
#
interface GigabitEthernet<span>0/1/0</span>
 description toP1GE<span>0/3/0</span>
 undo shutdown
 ip address 10.1.3.2 255.255.255.252
 isis enable 64
#
interface GigabitEthernet<span>0/2/0</span>
 description toP2GE<span>0/2/0</span>
 undo shutdown
 ip address 10.1.8.2 255.255.255.252
 isis enable 64
#
interface LoopBack0
 ip address 10.11.11.9 255.255.255.255
 isis enable 64
#
bgp 65000
 group client internal
 peer client connect-interface LoopBack0
 peer 10.7.7.9 as-number 65000
 peer 10.8.8.9 as-number 65000
 peer 10.9.9.9 as-number 65000
 peer 10.10.10.9 as-number 65000
#
 ipv4-family unicast
  undo synchronization 
  undo peer client enable
  undo peer 10.7.7.9 enable
  undo peer 10.8.8.9 enable
  undo peer 10.9.9.9 enable
  undo peer 10.10.10.9 enable
 #
 ipv4-family vpnv4
  undo policy vpn-target
  peer client enable
  peer client reflect-client
  peer client advertise-community
  peer 10.7.7.9 enable
  peer 10.7.7.9 group client
  peer 10.8.8.9 enable
  peer 10.8.8.9 group client
  peer 10.9.9.9 enable
  peer 10.9.9.9 group client
  peer 10.10.10.9 enable
  peer 10.10.10.9 group client
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_route-policy_cfg_0028.html">Configuration Examples for Routing Policies
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_route-policy_cfg_0030.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_route-policy_cfg_0044.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>