
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Automatic ZTP Deployment Through DHCP">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_ztp_cfg_0009.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,ztpne,w00556928,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="ZTP">
<meta name="featuretype" content="Basic Configurations">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="ZTP">
<meta name="featuretype" content="Basic Configurations">
<meta name="featurename" content="ZTP">
<meta name="featuretype" content="Basic Configurations">
<meta name="featurename" content="ZTP">
<meta name="featuretype" content="Basic Configurations">
<meta name="OWNER" content="lwx1238418">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="m00915594">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172360197">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>Example for Configuring Automatic ZTP Deployment Through DHCP</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172360197"></a><a name="EN-US_TASK_0172360197"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Automatic ZTP Deployment Through DHCP</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0172360197__1.3.1"></a><a name="1.3.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0172360197__fig_dc_ne_ztp_cfg_0010_01">Figure 1</a>, two devices (RouterA and RouterB) with base configuration are newly added and connected to RouterC. RouterC functions as the egress gateway of RouterA and RouterB. Routes are available for RouterC, the DHCP server, and the file server to communicate with each other.</p>
<div class="p">The customer requires that RouterA and RouterB automatically load system software and configuration files after they are powered on to reduce labor costs and device deployment time.<div class="fignone" id="EN-US_TASK_0172360197__fig_dc_ne_ztp_cfg_0010_01"><a name="EN-US_TASK_0172360197__fig_dc_ne_ztp_cfg_0010_01"></a><a name="fig_dc_ne_ztp_cfg_0010_01"></a><span class="figcap"><b>Figure 1 </b>Configuring automatic ZTP deployment through DHCP</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 and 2 in this example represent GE <span>0/1/1</span> and GE <span>0/1/2</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_ne_ztp_cfg_0010_01.png"></span></div>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172360197__1.3.2"></a><a name="1.3.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><div class="p">The configuration roadmap is as follows:<ol><li><div class="p">Configure an SFTP server as the file server to save the intermediate file, system software, and configuration files.<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>File transfer through FTP is prone to security risks, and therefore the SFTP file transfer mode is recommended.</p>
</div></div>
</div>
</li><li><p>Edit the Python, INI, or CFG intermediate file to enable the routers to obtain their system software packages and configuration files according to the intermediate file.</p>
</li><li><p>Configure the DHCP server and relay agent to enable RouterA and RouterB to obtain DHCP information.</p>
</li><li><p>Power on RouterA and RouterB to start the ZTP process.</p>
</li></ol>
</div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172360197__1.3.3"></a><a name="1.3.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure a file server.</span><p><ul><li>Configure the device to function as a file server. For details, see <a href="../vrp/dc_vrp_vfm_cfg_0026.html">Example for Using SFTP to Operate Files</a>.</li><li>Configure a third-party server to function as a file server. For details, see the operation guide of the third-party server. On the PC, set the SFTP working directory to D:\ztp. After configuring the file server, save the system software and configuration file to be loaded to the D:\ztp directory.</li></ul>
</p></li><li><span>Edit the intermediate file.</span><p><p>Edit the intermediate file according to <a href="dc_ne_ztp_cfg_0004.html">Editing an Intermediate File</a>. A CFG intermediate file is used as an example. The file is named <strong>ztp_script.cfg</strong>. See <a href="dc_ne_ztp_feature_0011.html">Intermediate File in the CFG Format</a> for the file content.</p>
<p>After editing the intermediate file, save the file to the working directory <span class="filepath"><b>D:\ztp</b></span> on the file server.</p>
</p></li><li><span>Configure the DHCP server.</span><p><p># Configure the IP address pool from which the DHCP server assigns IP addresses to clients. Configure Option fields according to the instructions in <a href="#EN-US_TASK_0172360197__table_02">Table 1</a>. For configuration details, see the corresponding product documentation and DHCP server configuration section in this document.</p>

<div class="tableBorder"><a name="EN-US_TASK_0172360197__table_02"></a><a name="table_02"></a><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" id="EN-US_TASK_0172360197__table_02" frame="border" border="1" rules="all"><caption><b>Table 1 </b>Option fields to be configured on the DHCP server</caption><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="16.6%" id="mcps1.3.3.3.2.2.2.4.1.1" liSelected="liSelected"><p>Option</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="27.529999999999998%" id="mcps1.3.3.3.2.2.2.4.1.2" liSelected="liSelected"><p>Description</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="55.87%" id="mcps1.3.3.3.2.2.2.4.1.3" liSelected="liSelected"><p>Value</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" valign="top" width="16.6%" headers="mcps1.3.3.3.2.2.2.4.1.1 "><p>1</p>
</td>
<td class="cellrowborder" valign="top" width="27.529999999999998%" headers="mcps1.3.3.3.2.2.2.4.1.2 "><p>Subnet mask of an IP address</p>
</td>
<td class="cellrowborder" valign="top" width="55.87%" headers="mcps1.3.3.3.2.2.2.4.1.3 "><p>255.255.225.0</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="16.6%" headers="mcps1.3.3.3.2.2.2.4.1.1 "><p>3</p>
</td>
<td class="cellrowborder" valign="top" width="27.529999999999998%" headers="mcps1.3.3.3.2.2.2.4.1.2 "><p>Egress gateway of a DHCP client</p>
</td>
<td class="cellrowborder" valign="top" width="55.87%" headers="mcps1.3.3.3.2.2.2.4.1.3 "><p>10.1.1.1</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="16.6%" headers="mcps1.3.3.3.2.2.2.4.1.1 "><p>67</p>
</td>
<td class="cellrowborder" valign="top" width="27.529999999999998%" headers="mcps1.3.3.3.2.2.2.4.1.2 "><p>File server address and intermediate file name</p>
</td>
<td class="cellrowborder" valign="top" width="55.87%" headers="mcps1.3.3.3.2.2.2.4.1.3 "><p>sftp://client001:YsHsjx_202206@10.1.3.2/ztp_script.cfg</p>
</td>
</tr>
</tbody>
</table>
</div>
<p># Configure an IP address and gateway address for the DHCP server. Ensure that the DHCP server and gateway of RouterA and RouterB have reachable routes to each other.</p>
</p></li><li><span>Configure the DHCP relay agent.</span><p><p># On RouterC, configure the DHCP relay function and set the IP address of the interface connected to RouterA and RouterB to 10.1.1.1. Configure 10.1.1.1 as the default gateway address of RouterA and RouterB.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>]<strong> sysname RouterC</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RouterC]<strong> interface GigabitEthernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RouterC-GigabitEthernet<span>0/1/1</span>]<strong> ip address 10.2.2.1 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RouterC-GigabitEthernet<span>0/1/1</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RouterC-GigabitEthernet<span>0/1/1</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RouterC-GigabitEthernet<span>0/1/1</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RouterC]<strong> interface GigabitEthernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RouterC-GigabitEthernet<span>0/1/2</span>]<strong> ip address 10.1.1.1 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RouterC-GigabitEthernet<span>0/1/2</span>]<strong> dhcp select relay</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RouterC-GigabitEthernet<span>0/1/2</span>]<strong> ip relay address 10.1.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RouterC-GigabitEthernet<span>0/1/2</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RouterC-GigabitEthernet<span>0/1/2</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RouterC-GigabitEthernet<span>0/1/2</span>]<strong> quit</strong></pre>
</p></li><li><span>Power on RouterA and RouterB to start the ZTP process.</span></li><li><span>Verify the configuration.</span><p><div class="p"># Log in to the device and run the <a href="cmdqueryname=display+startup"><b><span class="cmdname">display startup</span></b></a> command to check whether the system software and configuration file are as expected. The example uses the command output on RouterA.<pre class="screen">&lt;RouterA&gt; <strong>display startup</strong>
MainBoard:
  Configured startup system software:        cfcard:/<strong><span class="keyword">V800R023C00SPC500</span>B140_0424_new.cc</strong>
  Startup system software:                   cfcard:/<strong><span class="keyword">V800R023C00SPC500</span>B140_0424_new.cc</strong>
  Next startup system software:              cfcard:/<strong><span class="keyword">V800R023C00SPC500</span>B140_0424_new.cc</strong>
  Startup saved-configuration file:          cfcard:/<strong>vrpcfg.cfg</strong>
  Next startup saved-configuration file:     cfcard:/<strong>vrpcfg.cfg</strong>
  Startup paf file:                          default
  Next startup paf file:                     default
  Startup patch package:                     cfcard:/<strong><span class="keyword">NE40E</span><span class="keyword">V800R023C00SPC500</span>.PAT</strong>
  Next startup patch package:                cfcard:/<strong><span class="keyword">NE40E</span><span class="keyword">V800R023C00SPC500</span>.PAT</strong></pre>
</div>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172360197__1.3.4"></a><a name="1.3.4"></a><h4 class="sectiontitle">Configuration Files</h4><p>ztp_script.cfg file</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The SHA256 checksum in the following file is only an example.</p>
</div></div>
<pre class="screen">#sha256sum="<strong id="EN-US_TASK_0172360197__en-us_concept_0172350841_b34333525213">fffcd63f5e31f0891a0349686969969c1ee429dedeaf7726ed304f2d08ce1bc7</strong>"
fileserver=<strong id="EN-US_TASK_0172360197__en-us_concept_0172350841_b1727844314343">sftp://username:password@hostname:port/path/</strong>;
mac=<strong id="EN-US_TASK_0172360197__en-us_concept_0172350841_b313669319214006">00e0-fc12-3456</strong>;esn=<strong id="EN-US_TASK_0172360197__en-us_concept_0172350841_b1816109005214006">2102351931P0C3000154</strong>;devicetype=<strong id="EN-US_TASK_0172360197__en-us_concept_0172350841_b1856126402214006">DEFAULT</strong>;system-version=<strong id="EN-US_TASK_0172360197__en-us_concept_0172350841_b38478110214006"><span class="keyword" id="EN-US_TASK_0172360197__en-us_concept_0172350841_keyword309017023214006">V800R023C00SPC500</span></strong>;boot_python_file=<strong id="EN-US_TASK_0172360197__en-us_concept_0172350841_b156252026814"><span class="keyword" id="EN-US_TASK_0172360197__en-us_concept_0172350841_keyword96259261417">V800R023C00SPC500</span></strong><strong id="EN-US_TASK_0172360197__en-us_concept_0172350841_b49112331514">.py</strong>;system-software=<strong id="EN-US_TASK_0172360197__en-us_concept_0172350841_b1511841222214006"><span class="keyword" id="EN-US_TASK_0172360197__en-us_concept_0172350841_keyword1402352322214006">V800R023C00SPC500</span>.cc</strong>;system-config=<strong id="EN-US_TASK_0172360197__en-us_concept_0172350841_b1970549851214006">test.cfg</strong>;system-pat=<strong id="EN-US_TASK_0172360197__en-us_concept_0172350841_b142227238214006"><span class="keyword" id="EN-US_TASK_0172360197__en-us_concept_0172350841_keyword644742630214006">V800R023C00SPC500</span>SPH001.PAT</strong>;</pre>
<p>vrpcfg.cfg file</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The interface IP address and static route configurations in the file are used as an example. You can modify them as required.</p>
</div></div>
<pre class="screen">#
sysname <span class="keyword">HUAWEI</span>
#
ip vpn-instance __LOCAL_OAM_VPN__
 ipv4-family
#
interface Ethernet0/0/0
 undo shutdown
 ip binding vpn-instance __LOCAL_OAM_VPN__
 ip address 192.168.130.10 255.255.255.0
#
ip route-static vpn-instance __LOCAL_OAM_VPN__ 0.0.0.0 0.0.0.0 192.168.130.20
#</pre>
<p>RouterC configuration file</p>
<pre class="screen">#
sysname RouterC
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 10.2.2.1 255.255.255.0
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ip address 10.1.1.1 255.255.255.0
 dhcp select relay
 ip relay address 10.1.2.2
#
return</pre>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_ztp_cfg_0009.html">Configuration Examples for ZTP
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
</div>
</div>
</body>
</html>