
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="concept">
<meta name="DC.Title" content="Example for Configuring VE Access for PPPoE Dual-Stack Users in an EVPN Active-Active RUI Scenario">
<meta name="abstract" content="This section provides an example for configuring VE access for PPPoE dual-stack users in an EVPN active-active RUI scenario where RADIUS authentication and accounting are performed on a BRAS.">
<meta name="description" content="This section provides an example for configuring VE access for PPPoE dual-stack users in an EVPN active-active RUI scenario where RADIUS authentication and accounting are performed on a BRAS.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_pppox_cfg_0183.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_pppox_cfg_0051_vpn.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_pppoxv6_cfg_0056.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="z50024784,z00603461,w00800033,z00588052,c00549182,w00556928,l00593348,w00606909,b00542525,w00447999">
<meta name="DC.Publisher" content="20240229">
<meta name="dcAudienceJob" content="Configuration">
<meta name="featurename" content="PPPoE Access">
<meta name="featuretype" content="User Access">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="PPPoE Access">
<meta name="featuretype" content="User Access">
<meta name="featurename" content="PPPoE Access">
<meta name="featuretype" content="User Access">
<meta name="featurename" content="PPPoE Access">
<meta name="featuretype" content="User Access">
<meta name="OWNER" content="c00549182">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="z00588052">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_CONCEPT_0195430308">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring VE Access for PPPoE Dual-Stack Users in an EVPN Active-Active RUI Scenario</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_CONCEPT_0195430308"></a><a name="EN-US_CONCEPT_0195430308"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring VE Access for PPPoE Dual-Stack Users in an EVPN Active-Active RUI Scenario</h1>
<div><p>This section provides an example for configuring VE access for PPPoE dual-stack users in an EVPN active-active RUI scenario where RADIUS authentication and accounting are performed on a BRAS.</p>
<div class="section"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_CONCEPT_0195430308__fig163420251515">Figure 1</a>, the CE is connected to PE1 and PE2 through Eth-Trunk interface. The Eth-Trunk interfaces configured on PE1 and PE2 are added to an E-Trunk to implement the EVPN active-active mode. PE1 and PE2 function as BRASs. A PPPoE dual-stack user goes online through an L3VE sub-interface on a BRAS.</p>
<div class="fignone" id="EN-US_CONCEPT_0195430308__fig163420251515"><a name="EN-US_CONCEPT_0195430308__fig163420251515"></a><a name="fig163420251515"></a><span class="figcap"><b>Figure 1 </b>Example for configuring VE access for PPPoE dual-stack users in an EVPN active-active RUI scenario</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 through 3 in this example represent GE <span>0/1/0</span>, GE <span>0/1/1</span>, and GE <span>0/1/2</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0224617343.png"></span></div>
<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary=""><tr><th valign="bottom" align="left" id="mcps1.4.1.4.1.1"><p>Device</p>
</th>
<th valign="bottom" align="left" id="mcps1.4.1.4.1.2"><p>Interface</p>
</th>
<th valign="bottom" align="left" id="mcps1.4.1.4.1.3"><p>IPv4 Address</p>
</th>
<th valign="bottom" align="left" id="mcps1.4.1.4.1.4"><p>IPv6 Address</p>
</th>
</tr>
<tr><td valign="top" headers="mcps1.4.1.4.1.1"><p>PE1</p>
</td>
<td valign="top" headers="mcps1.4.1.4.1.2"><p>Loopback 1</p>
</td>
<td valign="top" headers="mcps1.4.1.4.1.3"><p>1.1.1.1/32</p>
</td>
<td valign="top" headers="mcps1.4.1.4.1.4"><p>2001:db8:1::1/128</p>
</td>
</tr>
<tr><td valign="top" headers="mcps1.4.1.4.1.1"><p>PE1</p>
</td>
<td valign="top" headers="mcps1.4.1.4.1.2"><p>GE <span>0/1/1</span></p>
</td>
<td valign="top" headers="mcps1.4.1.4.1.3"><p>192.168.1.1/24</p>
</td>
<td valign="top" headers="mcps1.4.1.4.1.4"><p>2001:db8:2::1/64</p>
</td>
</tr>
<tr><td valign="top" headers="mcps1.4.1.4.1.1"><p>PE2</p>
</td>
<td valign="top" headers="mcps1.4.1.4.1.2"><p>Loopback 1</p>
</td>
<td valign="top" headers="mcps1.4.1.4.1.3"><p>2.2.2.2/32</p>
</td>
<td valign="top" headers="mcps1.4.1.4.1.4"><p>2001:db8:3::1/128</p>
</td>
</tr>
<tr><td valign="top" headers="mcps1.4.1.4.1.1"><p>PE2</p>
</td>
<td valign="top" headers="mcps1.4.1.4.1.2"><p>GE <span>0/1/1</span></p>
</td>
<td valign="top" headers="mcps1.4.1.4.1.3"><p>192.168.1.2 /24</p>
</td>
<td valign="top" headers="mcps1.4.1.4.1.4"><p>2001:db8:4::1/64</p>
</td>
</tr>
</table></div>
</div>
<div class="section"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li>Assign an IP address to each device interface, including loopback interfaces.</li><li>Configure an Eth-Trunk channel between the CE and each PE.</li><li><p>Configure basic MPLS functions and MPLS LDP, and set up MPLS LSPs.</p>
</li><li><p>Configure an IGP to implement interworking between PEs. In this example, OSPF is used as an IGP.</p>
</li><li><p>Configure an EVPN instance in BD mode, and bind the BD to the EVPN instance.</p>
</li><li><p>Configure an EVPN source address.</p>
</li><li><p>Configure VRRP and BFD on the access side of each PE to control the master/backup status and fault association, and add Eth-Trunk interfaces to an E-Trunk.</p>
</li><li><p>Configure fast traffic switching.</p>
</li><li><p>Configure a BGP peer for each PE, and establish an EVPN IBGP peer relationship between PEs.</p>
</li><li>Configure AAA schemes and a RADIUS server group.</li><li>Configure an IPv4 address pool and an IPv6 address pool, and bind the address pools to a domain.</li><li>Configure a remote backup service (RBS) and a remote backup policy (RBP).</li><li>Create two VE interfaces and bind them to the same VE-group.</li><li>Bind an L2VE sub-interface and an Eth-Trunk sub-interface to the same BD.</li><li>Configure BRAS access on an L3VE sub-interface.</li><li>Configure a DUID for the DHCPv6 server.</li></ol>
</div>
<div class="section"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li>Interface IP addresses</li><li>EVPN instance name</li><li>RADIUS authentication and accounting schemes and their names</li><li>RADIUS server group name and RADIUS server addresses</li><li>Names of an IPv4 address pool and an IPv6 address pool</li><li>Domain to which users belong</li></ul>
</div>
<div class="section"><h4 class="sectiontitle">Procedure</h4><ol><li>Assign an IP address to each device interface, including loopback interfaces. For configuration details, see <a href="#EN-US_CONCEPT_0195430308__section1188091525216">Configuration Files</a> in this section.</li><li>Configure an Eth-Trunk channel between the CE and each PE.<p># Configure the CE.</p>
<pre class="screen">&lt;HUAWEI&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>HUAWEI]<strong> sysname CE</strong>
[<span class="keyword">*</span>HUAWEI] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE]<strong> interface gigabitethernet <span>0/1/0</span> </strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE-GigabitEthernet<span>0/1/0</span>] <strong>portswitch</strong>
[<span class="keyword">*</span>CE-GigabitEthernet<span>0/1/0</span>]<strong> port trunk allow-pass vlan 100</strong>
[<span class="keyword">*</span>CE-GigabitEthernet<span>0/1/0</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE] <strong>interface Eth-Trunk100</strong>
[<span class="keyword">*</span>CE-Eth-Trunk100] <strong>portswitch</strong>
[<span class="keyword">*</span>CE-Eth-Trunk100]<strong> port trunk allow-pass vlan 100</strong>
[<span class="keyword">*</span>CE-Eth-Trunk100] <strong>mode lacp-static</strong>
[<span class="keyword">*</span>CE-Eth-Trunk100] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE-Eth-Trunk100] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE]<strong>interface GigabitEthernet <span>0/1/1</span></strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE-GigabitEthernet<span>0/1/1</span>] <strong>eth-trunk 100</strong>
[<span class="keyword">*</span>CE-GigabitEthernet<span>0/1/1</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE]<strong>interface GigabitEthernet <span>0/1/2</span></strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE-GigabitEthernet<span>0/1/2</span>] <strong>eth-trunk 100</strong>
[<span class="keyword">*</span>CE-GigabitEthernet<span>0/1/2</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE-GigabitEthernet<span>0/1/2</span>]<strong> quit</strong></pre>
<p># Configure PE1.</p>
<p>The configuration on PE1 is used as an example. Repeat this step for PE2. For configuration details, see <a href="#EN-US_CONCEPT_0195430308__section1188091525216">Configuration Files</a> in this section.</p>
<pre class="screen">&lt;HUAWEI&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>HUAWEI] <strong>sysname PE1</strong>
[<span class="keyword">*</span>HUAWEI] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> interface Eth-Trunk 100</strong>
[<span class="keyword">*</span>PE1-Eth-Trunk100]<strong> mode lacp-static</strong>
[<span class="keyword">*</span>PE1-Eth-Trunk100] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-Eth-Trunk100] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong>interface GigabitEthernet <span>0/1/0</span></strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/0</span>]<strong> eth-trunk 100</strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
</li><li>Configure basic MPLS functions and MPLS LDP, and set up MPLS LSPs. The configuration on PE1 is used as an example. Repeat this step for PE2. For configuration details, see <a href="#EN-US_CONCEPT_0195430308__section1188091525216">Configuration Files</a> in this section.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>mpls lsr-id 1.1.1.1</strong>
[<span class="keyword">*</span>PE1] <strong>mpls</strong>
[<span class="keyword">*</span>PE1-mpls] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-mpls] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>mpls ldp</strong>
[<span class="keyword">*</span>PE1-mpls-ldp] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface GigabitEthernet </strong><strong><span>0/1/1</span></strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/1</span>]<strong> mpls</strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>mpls ldp</strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
</li><li>Configure an IGP to implement interworking between PEs. In this example, OSPF is used as an IGP. The configuration on PE1 is used as an example. Repeat this step for PE2. For configuration details, see <a href="#EN-US_CONCEPT_0195430308__section1188091525216">Configuration Files</a> in this section.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> ospf 1</strong>
[<span class="keyword">*</span>PE1-ospf-1] <strong>default cost inherit-metric</strong>
[<span class="keyword">*</span>PE1-ospf-1] <strong>import-route direct</strong>
[<span class="keyword">*</span>PE1-ospf-1]<strong> import-route unr</strong>
[<span class="keyword">*</span>PE1-ospf-1] <strong>area 0</strong>
[<span class="keyword">*</span>PE1-ospf-1-area-0.0.0.0] <strong>network 192.168.1.0 0.0.0.255</strong>
[<span class="keyword">*</span>PE1-ospf-1-area-0.0.0.0] <strong>commi</strong><strong>t</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-ospf-1-area-0.0.0.0] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-ospf-1] <strong>quit</strong></pre>
</li><li>Configure an EVPN instance in BD mode, and bind the BD to the EVPN instance. The configuration on PE1 is used as an example. Repeat this step for PE2. For configuration details, see <a href="#EN-US_CONCEPT_0195430308__section1188091525216">Configuration Files</a> in this section.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>evpn vpn-instance evrf bd-mode</strong>
[<span class="keyword">*</span>PE1-evpn-instance-evrf] <strong>route-distinguisher 1:1</strong>
[<span class="keyword">*</span>PE1-evpn-instance-evrf] <strong>vpn-target 1:1 export-extcommunity</strong>
[<span class="keyword">*</span>PE1-evpn-instance-evrf] <strong>vpn-target 1:1 import-extcommunity</strong>
[<span class="keyword">*</span>PE1-evpn-instance-evrf] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-evpn-instance-evrf] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bridge-domain 100</strong>
[<span class="keyword">*</span>PE1-bd100] <strong>evpn binding vpn-instance evrf</strong>
[<span class="keyword">*</span>PE1-bd100] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bd100] <strong>quit</strong></pre>
</li><li>Configure an EVPN source address.<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>evpn source-address 1.1.1.1</strong>
[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>evpn source-address 2.2.2.2</strong>
[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</li><li>Configure VRRP and BFD on the access side of each PE to control the master/backup status and fault association, and add Eth-Trunk interfaces to an E-Trunk. The configuration on PE1 is used as an example. Repeat this step for PE2. For configuration details, see <a href="#EN-US_CONCEPT_0195430308__section1188091525216">Configuration Files</a> in this section.<p># Configure BFD sessions.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>e-trunk 1</strong>
[<span class="keyword">*</span>PE1-e-trunk-1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-e-trunk-1] <strong>priority 10</strong>
[<span class="keyword">*</span>PE1-e-trunk-1] <strong>peer-address 2.2.2.2 source-address 1.1.1.1</strong>
[<span class="keyword">*</span>PE1-e-trunk-1] <strong>timer hello 9</strong>
[<span class="keyword">*</span>PE1-e-trunk-1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-e-trunk-1] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bfd</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bfd] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bfd evpn_bfd1 bind peer-ip 2.2.2.2 source-ip 1.1.1.1 track-interface interface Eth-Trunk100</strong>
[<span class="keyword">*</span>PE1-bfd-session-evpn_bfd1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bfd-session-evpn_bfd1] <strong>discriminator local 5</strong>
[<span class="keyword">*</span>PE1-bfd-session-evpn_bfd1] <strong>discriminator remote 6</strong>
[<span class="keyword">*</span>PE1-bfd-session-evpn_bfd1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bfd-session-evpn_bfd1] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bfd evpn_bfd2 bind peer-ip 2.2.2.2</strong><strong> source-ip 1.1.1.1</strong>
[<span class="keyword">*</span>PE1-bfd-session-evpn_bfd] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bfd-session-evpn_bfd] <strong>discriminator local 7</strong>
[<span class="keyword">*</span>PE1-bfd-session-evpn_bfd] <strong>discriminator remote 8</strong>
[<span class="keyword">*</span>PE1-bfd-session-evpn_bfd] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bfd-session-evpn_bfd] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface Eth-Trunk 100</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-Eth-Trunk100] <strong>e-trunk 1</strong>
[<span class="keyword">*</span>PE1-Eth-Trunk100]<strong> e-trunk mode force-master</strong>
[<span class="keyword">*</span>PE1-Eth-Trunk100]<strong> es track bfd evpn_bfd2</strong>
[<span class="keyword">*</span>PE1-Eth-Trunk100] <strong>esi 0001.0002.0003.0004.0005</strong>
[<span class="keyword">*</span>PE1-Eth-Trunk100]<strong> timer es-recovery 120 </strong>
[<span class="keyword">*</span>PE1-Eth-Trunk100]<strong> commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-Eth-Trunk100] <strong>quit</strong></pre>
<div class="p"># Configure a VRRP group on an interface. (GE <span>0/1/1</span>.1 is used as an example.)<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface GigabitEthernet<span>0/1/1</span>.1</strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>.1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/1</span>.1] <strong>vlan-type dot1q 2011</strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>.1] <strong>ip address 192.168.3.1 255.255.255.0</strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>.1] <strong>vrrp vrid 100 virtual-ip 192.168.3.100</strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>.1] <strong>admin-vrrp vrid 100</strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>.1]<strong> vrrp vrid 100 priority 120</strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>.1] <strong>vrrp vrid 100 preempt-mode timer delay 1800</strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>.1] <strong>vrrp vrid 100 track bfd-session session-name evpn_bfd1</strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>.1] <strong>vrrp recover-delay</strong> <strong>20</strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>.1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/1</span>.1] <strong>quit</strong></pre>
</div>
</li><li>Configure fast traffic switching. The configuration on PE1 is used as an example. Repeat this step for PE2. For configuration details, see <a href="#EN-US_CONCEPT_0195430308__section1188091525216">Configuration Files</a> in this section.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> evpn</strong>
[<span class="keyword">*</span>PE1-evpn]<strong> commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-evpn] <strong>df-election type vlan </strong>
[<span class="keyword">*</span>PE1-evpn] <strong>vlan-extend private enable</strong>
[<span class="keyword">*</span>PE1-evpn] <strong>vlan-extend redirect enable</strong>
[<span class="keyword">*</span>PE1-evpn] <strong>local-remote frr enable</strong>
[<span class="keyword">*</span>PE1-evpn] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-evpn]<strong> mac-duplication</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-evpn-mac-dup] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-evpn] <strong>quit</strong></pre>
</li><li>Configure a BGP peer for each PE, and establish an EVPN IBGP peer relationship between PEs. The configuration on PE1 is used as an example. Repeat this step for PE2. For configuration details, see <a href="#EN-US_CONCEPT_0195430308__section1188091525216">Configuration Files</a> in this section.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> interface Loopback1</strong>
[<span class="keyword">*</span>PE1-LoopBack1]<strong> commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-LoopBack1] <strong>ipv6 enable</strong><strong> </strong>
[<span class="keyword">*</span>PE1-LoopBack1] <strong>ip address 1.1.1.1 255.255.255.255</strong>
[<span class="keyword">*</span>PE1-LoopBack1] <strong>ipv6 address 2001:db8:1::1/128</strong>
[<span class="keyword">*</span>PE1-LoopBack1] <strong>ipv6 address auto link-local</strong>
[<span class="keyword">*</span>PE1-LoopBack1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong>
[<span class="keyword">*</span>PE1-bgp] <strong>peer 2.2.2.2 as-number 100</strong>
[<span class="keyword">*</span>PE1-bgp] <strong>peer 2.2.2.2 connect-interface LoopBack1</strong>
[<span class="keyword">*</span>PE1-bgp] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp] <strong>ipv4-family unicast</strong>
[<span class="keyword">*</span>PE1-bgp-af-ipv4] <strong>undo synchronization</strong>
[<span class="keyword">*</span>PE1-bgp-af-ipv4] <strong>import-route direct</strong>
[<span class="keyword">*</span>PE1-bgp-af-ipv4] <strong>import-route unr</strong>
[<span class="keyword">*</span>PE1-bgp-af-ipv4] <strong>peer 2.2.2.2 enable</strong>
[<span class="keyword">*</span>PE1-bgp-af-ipv4] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp-af-ipv4] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp] <strong>ipv6-family unicast</strong>
[<span class="keyword">*</span>PE1-bgp-af-ipv6] <strong>undo synchronization</strong>
[<span class="keyword">*</span>PE1-bgp-af-ipv6] <strong>import-route direct</strong>
[<span class="keyword">*</span>PE1-bgp-af-ipv6] <strong>import-route unr</strong>
[<span class="keyword">*</span>PE1-bgp-af-ipv6]<strong> peer 2.2.2.2 enable</strong>
[<span class="keyword">*</span>PE1-bgp-af-ipv6]<strong> commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp-af-ipv6]<strong> quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp] <strong>l2vpn-family evpn</strong>
[<span class="keyword">*</span>PE1-bgp-af-evpn] <strong>undo policy vpn-target</strong>
[<span class="keyword">*</span>PE1-bgp-af-evpn] <strong>timer df-delay 0</strong>
[<span class="keyword">*</span>PE1-bgp-af-evpn] <strong>peer 2.2.2.2 enable</strong>
[<span class="keyword">*</span>PE1-bgp-af-evpn] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp-af-evpn] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp] <strong>quit</strong></pre>
</li><li>Configure AAA schemes and a RADIUS server group. The configuration on PE1 is used as an example. Repeat this step for PE2. For configuration details, see <a href="#EN-US_CONCEPT_0195430308__section1188091525216">Configuration Files</a> in this section.<p># Configure AAA schemes.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>aaa</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-aaa] <strong>authentication-scheme auth1</strong>
[<span class="keyword">*</span>PE1-aaa-authen-auth1] <strong>authentication-mode radius</strong>
[<span class="keyword">*</span>PE1-aaa-authen-auth1] <strong>quit</strong>
[<span class="keyword">*</span>PE1-aaa] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-aaa] <strong>accounting-scheme acct1</strong>
[<span class="keyword">*</span>PE1-aaa-accounting-acct1] <strong>accounting-mode radius</strong>
[<span class="keyword">*</span>PE1-aaa-accounting-acct1] <strong>quit</strong>
[<span class="keyword">*</span>PE1-aaa] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure a RADIUS server group.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> radius-server group rd1</strong>
[<span class="keyword">*</span>PE1-radius-rd1] <strong>radius-server authentication 192.168.7.249 1645</strong>
[<span class="keyword">*</span>PE1-radius-rd1] <strong>radius-server accounting 192.168.7.249 1646</strong>
[<span class="keyword">*</span>PE1-radius-rd1]<strong> commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-radius-rd1]<strong> radius-server shared-key-cipher YsHsjx_202206 </strong>
[<span class="keyword">*</span>PE1-radius-rd1]<strong> commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-radius-rd1]<strong> quit</strong></pre>
</li><li>Configure an IPv4 address pool and an IPv6 address pool, and bind the address pools to a domain. The configuration on PE1 is used as an example. Repeat this step for PE2. For configuration details, see <a href="#EN-US_CONCEPT_0195430308__section1188091525216">Configuration Files</a> in this section.<p># Configure address pools.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>ip pool pool_v4 bas local</strong>
[<span class="keyword">*</span>PE1-ip-pool-pool_v4] <strong>gateway 10.1.1.1 255.255.255.0</strong>
[<span class="keyword">*</span>PE1-ip-pool-pool_v4] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-ip-pool-pool_v4]<strong> section 0 10.1.1.2 10.1.1.255</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-ip-pool-pool_v4] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>ipv6 prefix pre_local local</strong>
[<span class="keyword">*</span>PE1-ipv6-prefix-pre_local] <strong>prefix 2001:db8:5::1/64</strong>
[<span class="keyword">*</span>PE1-ipv6-prefix-pre_local] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-ipv6-prefix-pre_local] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>ipv6 pool ipv6_local bas local</strong>
[<span class="keyword">*</span>PE1-ipv6-pool-ipv6_local] <strong>prefix pre_local</strong>
[<span class="keyword">*</span>PE1-ipv6-pool-ipv6_local] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-ipv6-pool-ipv6_local] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>ipv6 prefix pre_pd delegation</strong>
[<span class="keyword">*</span>PE1-ipv6-prefix-pre_pd] <strong>prefix 2001:db8::/32</strong>
[<span class="keyword">*</span>PE1-ipv6-prefix-pre_pd] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-ipv6-prefix-pre_pd] <strong>pd-unshare-only</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-ipv6-prefix-pre_pd] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>ipv6 pool pool_pd bas delegation</strong>
[<span class="keyword">*</span>PE1-ipv6-pool-pool_pd] <strong>prefix pre_pd</strong>
[<span class="keyword">*</span>PE1-ipv6-pool-pool_pd] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-ipv6-pool-pool_pd] <strong>quit</strong></pre>
<p># Bind the address pools to a domain.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>aaa</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-aaa] <strong>domain isp1</strong>
[<span class="keyword">*</span>PE1-aaa-domain-isp1] <strong>authentication-scheme auth1</strong>
[<span class="keyword">*</span>PE1-aaa-domain-isp1] <strong>accounting-scheme acct1</strong>
[<span class="keyword">*</span>PE1-aaa-domain-isp1] <strong>radius-server group rd1</strong>
[<span class="keyword">*</span>PE1-aaa-domain-isp1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-aaa-domain-isp1] <strong>ipv6 nd autoconfig managed-address-flag</strong>  
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-aaa-domain-isp1] <strong>ip-pool pool_v4</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-aaa-domain-isp1] <strong>ipv6-pool ipv6_local</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-aaa-domain-isp1] <strong>ipv6-pool pool_pd</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-aaa-domain-isp1] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-aaa] <strong>quit</strong></pre>
</li><li>Configure an RBS and an RBP. The configuration on PE1 is used as an example. Repeat this step for PE2. For configuration details, see <a href="#EN-US_CONCEPT_0195430308__section1188091525216">Configuration Files</a> in this section.<p># Configure an RBS.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>remote-backup-service rbs1</strong>
[<span class="keyword">*</span>PE1-rm-backup-srv-rbs1] <strong>peer 2.2.2.2 source 1.1.1.1 port 50000</strong>
[<span class="keyword">*</span>PE1-rm-backup-srv-rbs1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-rm-backup-srv-rbs1] <strong>track interface GigabitEthernet <span>0/1/2</span></strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-rm-backup-srv-rbs1] <strong>protect lsp-tunnel for-all-instance peer-ip 2.2.2.2</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-rm-backup-srv-rbs1] <strong>ip-pool pool_v4 metric 10</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-rm-backup-srv-rbs1] <strong>ipv6-pool ipv6_local metric 10</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-rm-backup-srv-rbs1] <strong>ipv6-pool pool_pd metric 10</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-rm-backup-srv-rbs1] <strong>quit</strong></pre>
<p># Configure an RBP.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>remote-backup-profile rbp1</strong>
[<span class="keyword">*</span>PE1-rm-backup-prf-rbp1] <strong>service-type bras</strong>
[<span class="keyword">*</span>PE1-rm-backup-prf-rbp1] <strong>backup-id 1 remote-backup-service rbs1</strong>
[<span class="keyword">*</span>PE1-rm-backup-prf-rbp1] <strong>peer-backup hot</strong>
[<span class="keyword">*</span>PE1-rm-backup-prf-rbp1] <strong>vrrp-id 100 interface GigabitEthernet <span>0/1/1</span>.1</strong>
[<span class="keyword">*</span>PE1-rm-backup-prf-rbp1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-rm-backup-prf-rbp1]<strong> rui-slave inbound without-forwarding</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-rm-backup-prf-rbp1] <strong>nas logic-port eth-Trunk 200/0/0</strong>
[<span class="keyword">*</span>PE1-rm-backup-prf-rbp1] <strong>nas logic-sysname huawei</strong>
[<span class="keyword">*</span>PE1-rm-backup-prf-rbp1]<strong> nas logic-ip 172.16.1.1</strong>
[<span class="keyword">*</span>PE1-rm-backup-prf-rbp1] <strong>acct-session-id nas-logic-sysname huawei</strong>
[<span class="keyword">*</span>PE1-rm-backup-prf-rbp1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-rm-backup-prf-rbp1] <strong>quit</strong></pre>
</li><li>Create two VE interfaces and bind them to the same VE-group. The configuration on PE1 is used as an example. Repeat this step for PE2. For configuration details, see <a href="#EN-US_CONCEPT_0195430308__section1188091525216">Configuration Files</a> in this section.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface virtual-ethernet <span>0/1/0</span></strong>
[<span class="keyword">*</span>PE1-Virtual-Ethernet<span>0/1/0</span>] <strong>ve-group 2 l2-terminate</strong>
[<span class="keyword">*</span>PE1-Virtual-Ethernet<span>0/1/0</span>] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface virtual-ethernet</strong> <strong><span>0/1/1</span></strong>
[<span class="keyword">*</span>PE1-Virtual-Ethernet<span>0/1/1</span>] <strong>ve-group 2 l3-access</strong>
[<span class="keyword">*</span>PE1-Virtual-Ethernet<span>0/1/1</span>] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</li><li>Bind an L2VE sub-interface and an Eth-Trunk sub-interface to the same BD. The configuration on PE1 is used as an example. Repeat this step for PE2. For configuration details, see <a href="#EN-US_CONCEPT_0195430308__section1188091525216">Configuration Files</a> in this section.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface Virtual-Ethernet <span>0/1/0</span>.1 mode l2</strong>
[<span class="keyword">*</span>PE1-Virtual-Ethernet<span>0/1/0</span>.1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-Virtual-Ethernet<span>0/1/0</span>.1] <strong>encapsulation dot1q vid 100</strong>
[<span class="keyword">*</span>PE1-Virtual-Ethernet<span>0/1/0</span>.1] <strong>bridge-domain 100</strong>
[<span class="keyword">*</span>PE1-Virtual-Ethernet<span>0/1/0</span>.1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-Virtual-Ethernet<span>0/1/0</span>.1] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface Eth-Trunk 100.1 mode l2</strong>
[<span class="keyword">*</span>PE1-Eth-Trunk100.1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-Eth-Trunk100.1] <strong>encapsulation dot1q vid 100</strong>
[<span class="keyword">*</span>PE1-Eth-Trunk100.1] <strong>bridge-domain 100</strong>
[<span class="keyword">*</span>PE1-Eth-Trunk100.1] <strong>split-horizon</strong>
[<span class="keyword">*</span>PE1-Eth-Trunk100.1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-Eth-Trunk100.1] <strong>quit</strong></pre>
</li><li>Configure BRAS access on an L3VE sub-interface. The configuration on PE1 is used as an example. Repeat this step for PE2. For configuration details, see <a href="#EN-US_CONCEPT_0195430308__section1188091525216">Configuration Files</a> in this section.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface virtual-template </strong><strong>1</strong>
[<span class="keyword">*</span>PE1-interface virtual-template1] <strong>ppp authentication-mode chap</strong>
[<span class="keyword">*</span>PE1-interface virtual-template1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-interface virtual-template1] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface Virtual-Ethernet <span>0/1/1</span>.1</strong>
[<span class="keyword">*</span>PE1-Virtual-Ethernet<span>0/1/1</span>.1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-Virtual-Ethernet<span>0/1/1</span>.1] <strong>pppoe-server bind virtual-template 1</strong>
[<span class="keyword">*</span>PE1-Virtual-Ethernet<span>0/1/1</span>.1]<strong> ipv6 enable</strong>
[<span class="keyword">*</span>PE1-Virtual-Ethernet<span>0/1/1</span>.1] <strong>ipv6 address auto link-local</strong>
[<span class="keyword">*</span>PE1-Virtual-Ethernet<span>0/1/1</span>.1] <strong>ipv6 nd autoconfig managed-address-flag</strong>
[<span class="keyword">*</span>PE1-Virtual-Ethernet<span>0/1/1</span>.1] <strong>remote-backup-profile rbp1</strong>
[<span class="keyword">*</span>PE1-Virtual-Ethernet<span>0/1/1</span>.1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-Virtual-Ethernet<span>0/1/1</span>.1] <strong>user-vlan 100</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-Virtual-Ethernet<span>0/1/1</span>.1-vlan-100-100]<strong> quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-Virtual-Ethernet<span>0/1/1</span>.1] <strong>bas</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-Virtual-Ethernet<span>0/1/1</span>.1-bas] <strong>access-type layer2-subscriber default-domain authentication isp1</strong>
[<span class="keyword">*</span>PE1-Virtual-Ethernet<span>0/1/1</span>.1-bas] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-Virtual-Ethernet<span>0/1/1</span>.1-bas] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-Virtual-Ethernet<span>0/1/1</span>.1] <strong>quit</strong></pre>
</li><li>Configure a DUID for the DHCPv6 server. The configuration on PE1 is used as an example. Repeat this step for PE2. For configuration details, see <a href="#EN-US_CONCEPT_0195430308__section1188091525216">Configuration Files</a> in this section.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>dhcpv6 duid llt</strong>
[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</li><li><p>Verify the configuration.</p>
<p># After completing the configurations, run the <strong>display remote-backup-profile</strong> command. The command output shows that the backup service type is <strong>bras</strong>, the backup policy <strong>profile1</strong> is bound to the user access interface Virtual-Ethernet <span>0/1/1</span>.1, and the status of PE1 is <strong>Master</strong>.</p>
<pre class="screen">&lt;PE1&gt; <strong>display remote-backup-profile rbp1</strong>
----------------------------------------------------------
 Profile-Index        : 0x802
 Profile-Name         :<strong> </strong>rbp1
 Service              : bras
 Remote-backup-service: rbs1 
 Backup-ID            : 1
 track protocol       : VRRP
 VRRP-ID              : 100
 VRRP-Interface       : GigabitEthernet<span>0/1/1</span>.1
 Access-Control       : --
 State                : <strong>Master</strong>
 Peer State           : Slave
 Interface            :
                        Virtual-Ethernet<span>0/1/1</span>.1
 Backup mode          : hot
 Slot-Number          : 1
 Card-Number          : 0
 Port-Number          : 1
 Nas logic-port       : eth-Trunk 200/0/0 
 Nas logic-ip         : 172.16.1.1
 Nas logic-sysname    : huawei 
 Traffic threshold       : 50(MB)
 Traffic interval       : 10(minutes)
 Forwarding Configured: Slave Forwarding </pre>
<p># Run the <strong>display remote-backup-service</strong> command to check the RBS configuration on PE1. The command output shows that the TCP connection state (<strong>TCP-State</strong>) of the RBS is <strong>Connected</strong>.</p>
<pre class="screen">&lt;PE1&gt; <strong>display remote-backup-service rbs1 </strong>
----------------------------------------------------------
 Service-Index    : 0
 Service-Name     : rbs1
 TCP-State        : <strong>Connected</strong>
 Peer-ip          : 2.2.2.2 
 Source-ip        : 1.1.1.1 
 TCP-Port         : 2046
 Track-BFD        : --
 Track-interface0 : GigabitEthernet<span>0/1/2</span>
                  Weight : 10
 Track-interface1 : -- 
                  Weight : -- 
 SSL-Policy-Name  : --
 SSL-State        : --
Uplink state     : 2 (1:DOWN 2:UP)
 Domain-map-list  : --
----------------------------------------------------------

 ip pool:  
         pool_v4 metric 20
 ipv6 pool: 
         ipv6_local metric 20
         pool_pd metric 20
 Failure ratio    : 100%
 Failure duration : 0 min
--------------------------------------------------------</pre>
</li></ol>
</div>
<div class="section" id="EN-US_CONCEPT_0195430308__section1188091525216"><a name="EN-US_CONCEPT_0195430308__section1188091525216"></a><a name="section1188091525216"></a><h4 class="sectiontitle">Configuration Files</h4><p># CE configuration file</p>
<pre class="screen">#
sysname CE                                                       
#
interface Eth-Trunk100
 portswitch
 port trunk allow-pass vlan 100
 mode lacp-static
#
interface GigabitEthernet<span>0/1/0</span>
 portswitch
 undo shutdown
 port trunk allow-pass vlan 100
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 eth-trunk 100
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 eth-trunk 100
#</pre>
<p># PE1 configuration file</p>
<pre class="screen">#
sysname PE1                                                         
#
dhcpv6 duid 0001000125a7625df063f9761497
#
ipv6 prefix pre_local local
 prefix 2001:db8:5::1/64
#
ipv6 pool ipv6_local bas local
 prefix pre_local
#
ipv6 prefix pre_pd delegation
 prefix 2001:db8::/32
 pd-unshare-only
#
ipv6 pool pool_pd bas delegation
 prefix pre_pd
#                                                                               
radius-server group rd1                                                         
 radius-server shared-key-cipher %^%#Iw/n)xU8oC.hNn6T==./WdM*2:1|w/iSW#T0*o55%^%#
 radius-server authentication 192.168.7.249 1645 weight 0                       
 radius-server accounting 192.168.7.249 1646 weight 0
#
evpn
 df-election type vlan
 vlan-extend private enable
 vlan-extend redirect enable
 local-remote frr enable
 #
 mac-duplication
#
evpn vpn-instance evrf bd-mode
 route-distinguisher 1:1
 vpn-target 1:1 export-extcommunity
 vpn-target 1:1 import-extcommunity
# 
mpls lsr-id 1.1.1.1
#
mpls
#               
mpls ldp
#
bridge-domain 100
 evpn binding vpn-instance evrf
#                                                                           
ip pool pool_v4 bas local                                                         
 gateway 10.1.1.1 255.255.255.0                                                
 section 0 10.1.1.2 10.1.1.255                                                 
#
e-trunk 1
 priority 10
 peer-address 2.2.2.2 source-address 1.1.1.1
 timer hello 9
# 
interface Virtual-Template1  
  ppp authentication-mode chap 
#
remote-backup-service rbs1
 peer 2.2.2.2 source 1.1.1.1 port 50000
 track interface GigabitEthernet<span>0/1/2</span>
 protect lsp-tunnel for-all-instance peer-ip 2.2.2.2
 ip-pool pool_v4 metric 10
 ipv6-pool ipv6_local metric 10
 ipv6-pool pool_pd metric 10
#
remote-backup-profile rbp1
 service-type bras
 backup-id 1 remote-backup-service rbs1
 rui-slave inbound without-forwarding
 peer-backup hot
 vrrp-id 100 interface GigabitEthernet<span>0/1/1</span>.1
 nas logic-port Eth-Trunk 200/0/0
 nas logic-sysname huawei
 nas logic-ip 172.16.1.1
 acct-session-id nas-logic-sysname huawei
#
aaa
 authentication-scheme auth1
  authentication-mode radius
#
 accounting-scheme acct1  
  accounting-mode radius
#                                                                            
 domain isp1                                                                    
  authentication-scheme auth1                                                   
  accounting-scheme acct1                                                       
  radius-server group rd1
  ipv6 nd autoconfig managed-address-flag  
  ip-pool pool_v4
  ipv6-pool ipv6_local
  ipv6-pool pool_pd
#
interface Eth-Trunk100
 mode lacp-static
 e-trunk 1
 e-trunk mode force-master
 es track bfd evpn_bfd2
 esi 0001.0002.0003.0004.0005
 timer es-recovery 120
#
interface Eth-Trunk100.1 mode l2
 encapsulation dot1q vid 100
 bridge-domain 100
 split-horizon
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 eth-trunk 100
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ipv6 enable
 ip address 192.168.1.1 255.255.255.0
 ipv6 address 2001:db8:2::1/64
 ipv6 address auto link-local
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/1</span>.1
 vlan-type dot1q 2011
 ip address 192.168.3.1 255.255.255.0
 vrrp vrid 100 virtual-ip 192.168.3.100
 admin-vrrp vrid 100
<strong> </strong>vrrp vrid 100 priority 120
 vrrp vrid 100 preempt-mode timer delay 1800
 vrrp vrid 100 track bfd-session session-name evpn_bfd1
 vrrp recover-delay 20
#                                                                              
interface LoopBack1 
 ipv6 enable
 ip address 1.1.1.1 255.255.255.255
 ipv6 address 2001:db8:1::1/128
 ipv6 address auto link-local
#
interface Virtual-Ethernet<span>0/1/0</span>
 ve-group 2 l2-terminate
#
interface Virtual-Ethernet<span>0/1/0</span>.1 mode l2
 encapsulation dot1q vid 100
 bridge-domain 100
#
interface Virtual-Ethernet<span>0/1/1</span>
 ve-group 2 l3-access
#
interface Virtual-Ethernet<span>0/1/1</span>.1
 ipv6 enable
 ipv6 address auto link-local
 statistic enable
 user-vlan 100
 pppoe-server bind Virtual-Template 1
 ipv6 nd autoconfig managed-address-flag
 remote-backup-profile rbp1
 bas
 #
  access-type layer2-subscriber default-domain authentication isp1
#
bfd evpn_bfd1 bind peer-ip 2.2.2.2 source-ip 1.1.1.1 track-interface interface Eth-Trunk100
 discriminator local 5
 discriminator remote 6
#
bfd evpn_bfd2 bind peer-ip 2.2.2.2 source-ip 1.1.1.1
 discriminator local 7
 discriminator remote 8
#
bgp 100
 peer 2.2.2.2 as-number 100
 peer 2.2.2.2 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  import-route direct
  import-route unr
  peer 2.2.2.2 enable
 #
 ipv6-family unicast
  undo synchronization
  import-route direct
  import-route unr
  peer 2.2.2.2 enable
 #
 l2vpn-family evpn
  undo policy vpn-target
  timer df-delay 0
  peer 2.2.2.2 enable
#
ospf 1
 default cost inherit-metric
 import-route direct
 import-route unr
 area 0.0.0.0
  network 192.168.1.0 0.0.0.255
#
evpn source-address 1.1.1.1
#
return</pre>
<p># PE2 configuration file</p>
<pre class="screen">#
sysname PE2                                                         
#
dhcpv6 duid llt                                                                             
# 
interface Virtual-Template1  
  ppp authentication-mode chap 
#
ipv6 prefix pre_local_slave local
 prefix 2001:db8:5::1/64
#
ipv6 pool ipv6_local_slave bas local rui-slave
 prefix pre_local_slave
#
ipv6 prefix pre_pd_slave delegation
 prefix 2001:db8::/32
 pd-unshare-only
#
ipv6 pool pool_pd_slave bas delegation rui-slave
 prefix pre_pd_slave
#                                                                               
radius-server group rd1                                                         
 radius-server shared-key-cipher %^%#Q'!i-TMV5&amp;@=QE}g/QK2ouBHee8WB|s|mB%^%
 radius-server authentication 192.168.7.249 1645 weight 0                       
 radius-server accounting 192.168.7.249 1646 weight 0
#
evpn
 df-election type vlan
 vlan-extend private enable
 vlan-extend redirect enable
 local-remote frr enable
 #
 mac-duplication
#
evpn vpn-instance evrf bd-mode
 route-distinguisher 1:1
 vpn-target 1:1 export-extcommunity
 vpn-target 1:1 import-extcommunity
# 
mpls lsr-id 2.2.2.2
#
mpls
#
bridge-domain 100
 evpn binding vpn-instance evrf
#               
mpls ldp
#                                                                           
ip pool pool_v4_slave bas local rui-slave                                                         
 gateway 10.1.1.1 255.255.255.0                                                
 section 0 10.1.1.2 10.1.1.255                                                 
#
e-trunk 1
 priority 12
 peer-address 1.1.1.1 source-address 2.2.2.2
 timer hello 9
#
remote-backup-service rbs1
 peer 1.1.1.1 source 2.2.2.2 port 50000
 track interface GigabitEthernet<span>0/1/2</span>
 protect lsp-tunnel for-all-instance peer-ip 1.1.1.1
 ip-pool pool_v4_slave metric 20
 ipv6-pool ipv6_local_slave metric 20
 ipv6-pool pool_pd_slave metric 20
#
remote-backup-profile rbp1
 service-type bras
 backup-id 1 remote-backup-service rbs1
 rui-slave inbound without-forwarding
 peer-backup hot
 vrrp-id 100 interface GigabitEthernet<span>0/1/1</span>.1
 nas logic-port Eth-Trunk 200/0/0
 nas logic-sysname huawei
 nas logic-ip 172.16.1.1
 acct-session-id nas-logic-sysname huawei
#
aaa
 authentication-scheme auth1
  authentication-mode radius
#
 accounting-scheme acct1  
  accounting-mode radius
#                                                                            
 domain isp1                                                                    
  authentication-scheme auth1                                                   
  accounting-scheme acct1                                                       
  radius-server group rd1
  ipv6 nd autoconfig managed-address-flag  
  ip-pool pool_v4_slave
  ipv6-pool ipv6_local_slave
  ipv6-pool pool_pd_slave
#
interface Eth-Trunk100
 mode lacp-static
 e-trunk 1
 e-trunk mode force-master
 es track bfd evpn_bfd1
 esi 0001.0002.0003.0004.0005
 timer es-recovery 120
#
interface Eth-Trunk100.1 mode l2
 encapsulation dot1q vid 100
 bridge-domain 100
 split-horizon
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 eth-trunk 100
#
interface GigabitEthernet<span>0/1/1</span>.1
 vlan-type dot1q 2011
 ip address<strong> </strong>192.168.3.2 255.255.255.0
 vrrp vrid 100 virtual-ip 192.168.3.100
 admin-vrrp vrid 100
 vrrp vrid 100 track bfd-session session-name evpn_bfd2
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ipv6 enable
 ip address 192.168.1.2 255.255.255.0
 ipv6 address 2001:db8:4::1/64
 ipv6 address auto link-local
 mpls
 mpls ldp
#                                                                              
interface LoopBack1 
 ipv6 enable                                                                                                                                       
 ip address 2.2.2.2 255.255.255.255
 ipv6 address 2001:db8:3::1/128
 ipv6 address auto link-local
#
interface Virtual-Ethernet<span>0/1/0</span>
 ve-group 2 l2-terminate
#
interface Virtual-Ethernet<span>0/1/0</span>.1 mode l2
 encapsulation dot1q vid 100
 bridge-domain 100
#
interface Virtual-Ethernet<span>0/1/1</span>
 ve-group 2 l3-access
#
interface Virtual-Ethernet<span>0/1/1</span>.1
 pppoe-server bind Virtual-Template 1
 ipv6 enable
 ipv6 address auto link-local
 statistic enable
 user-vlan 100
 ipv6 nd autoconfig managed-address-flag
 remote-backup-profile rbp1
 bas
 #
  access-type layer2-subscriber default-domain authentication isp1
#
bfd evpn_bfd1 bind peer-ip 1.1.1.1 source-ip 2.2.2.2
 discriminator local 6
 discriminator remote 5
#
bfd evpn_bfd2 bind peer-ip 1.1.1.1 source-ip 2.2.2.2 track-interface interface Eth-Trunk100
 discriminator local 8
 discriminator remote 7
#
bgp 100
 peer 1.1.1.1 as-number 100
 peer 1.1.1.1 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  import-route direct
  import-route unr
  peer 1.1.1.1 enable
 #
 ipv6-family unicast
  undo synchronization
  import-route direct
  import-route unr
  peer 1.1.1.1 enable
 #
 l2vpn-family evpn
  undo policy vpn-target
  timer df-delay 0
  peer 1.1.1.1 enable
#
ospf 1
 default cost inherit-metric
 import-route direct
 import-route unr
 area 0.0.0.0
  network 192.168.1.0 0.0.0.255
#
evpn source-address 2.2.2.2
#
return</pre>
<p></p>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_pppox_cfg_0183.html">PPPoE Access Configuration Examples
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_pppox_cfg_0051_vpn.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_pppoxv6_cfg_0056.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>