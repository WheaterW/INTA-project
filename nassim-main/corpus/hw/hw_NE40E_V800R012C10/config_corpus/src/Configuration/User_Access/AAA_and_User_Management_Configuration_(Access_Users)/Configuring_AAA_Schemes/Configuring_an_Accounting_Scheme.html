
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring an Accounting Scheme">
<meta name="abstract" content="You must configure an accounting scheme before implementing accounting for users.">
<meta name="description" content="You must configure an accounting scheme before implementing accounting for users.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_aaa_cfg_0515.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_aaa_cfg_0465.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_aaa_cfg_0114.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="z00588052,w00437000,w00606909,w00447999">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="AAA (Access User)">
<meta name="featurename" content="PPPoE">
<meta name="featuretype" content="User Access">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="AAA (Access User)">
<meta name="featurename" content="PPPoE">
<meta name="featuretype" content="User Access">
<meta name="featurename" content="AAA (Access User)">
<meta name="featurename" content="PPPoE">
<meta name="featuretype" content="User Access">
<meta name="featurename" content="AAA (Access User)">
<meta name="featuretype" content="User Access">
<meta name="OWNER" content="z00588052,w00437000">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="z00588052">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172373682">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring an Accounting Scheme</title>
</head>
<body><a name="EN-US_TASK_0172373682"></a><a name="EN-US_TASK_0172373682"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring an Accounting Scheme</h1>
<div class="taskbody"><p>You must configure an accounting scheme before implementing accounting for users.</p>
<div class="context"><a name="EN-US_TASK_0172373682__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>Users successfully go online after they are authenticated and authorized, and accounting starts when they access services. Accounting is performed based on online duration, traffic volume, or both. The accounting process is as follows: The <span class="keyword">NE40E</span> collects statistics about the online duration and the upstream and downstream traffic, and sends the statistics to the RADIUS server in the format specified by the RADIUS protocol. The RADIUS server then returns a message indicating whether the accounting succeeds.</p>
<p>Perform the following steps on the <span class="keyword">Router</span>:</p>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172373682__1.4.2"></a><a name="1.4.2"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li><span>Run <a href="cmdqueryname=aaa"><b><span class="cmdname">aaa</span></b></a></span><p><p>The AAA view is displayed.</p>
</p></li><li><span>(Optional) Run <a href="cmdqueryname=realtime-accounting+backup+enable"><b><span class="cmdname">realtime-accounting backup enable</span></b></a></span><p><p>Real-time accounting backup is enabled between the active and standby main control boards.</p>
</p><p><p>The <a href="cmdqueryname=realtime-accounting+backup+enable"><b><span class="cmdname">realtime-accounting backup enable</span></b></a> command needs to be run if the RADIUS server has a strict requirement on the interval at which real-time accounting packets are sent. After this command is run, the real-time accounting timer is reset on the active and standby main control boards. In this manner, even if an active/standby main control board switchover occurs during the interval for sending real-time accounting packets, the device still sends real-time accounting packets at the configured interval.</p>
</p></li><li><span>Run <a href="cmdqueryname=accounting-scheme"><b><span class="cmdname">accounting-scheme</span></b></a> <em>acct-scheme-name</em></span><p><p>An accounting scheme is created.</p>
</p><p><div class="p">The <span class="keyword">NE40E</span> provides two fixed accounting schemes, namely default0 and default1, which can be modified but not deleted.<ul><li>In the default0 accounting scheme, non-accounting is performed by default.</li><li>In the default1 and user-defined accounting schemes, RADIUS accounting is performed by default.</li></ul>
</div>
</p></li><li><span>Run <a href="cmdqueryname=accounting-mode"><b><span class="cmdname">accounting-mode</span></b></a> { <span><strong><span>hwtacacs</span></strong> | </span><strong><span>none</span></strong> | <strong><span>radius</span></strong> }</span><p><p>An accounting mode is configured.</p>
</p><p><p>The <span class="keyword">NE40E</span> supports RADIUS accounting, HWTACACS accounting, and none accounting.</p>
<div class="p"><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>HWTACACS accounting can be performed for administrative users only.</p>
</div></div>
</div>
</p></li><li><span>(Optional) Run <a href="cmdqueryname=accounting+interim+interval"><b><span class="cmdname">accounting interim interval</span></b></a> <i><span class="varname">interval</span></i> [ <strong><span>second</span></strong> ]<span> [ <strong><span>traffic</span></strong> ]</span><span> [ <strong><span>hash</span></strong> ]</span></span><p><p>The interval for performing real-time accounting<span>, conditions for sending real-time accounting packets,</span><span> and hash processing of real-time accounting packets</span> are configured.</p>
</p><p><p>Real-time accounting indicates that the <span class="keyword">NE40E</span> periodically generates accounting packets and send them to the remote accounting server when a user is online. Real-time accounting minimizes loss of accounting information when the communication between the <span class="keyword">NE40E</span> and the remote server is interrupted.</p>
<p>The interval for real-time accounting can be set to minutes or seconds.</p>
</p></li><li><span>(Optional) Run <a href="cmdqueryname=accounting+interim+no-send+remain-time"><b><span class="cmdname">accounting interim no-send remain-time</span></b></a> <i><span class="varname">time-value</span></i></span><p><p>The device is configured not to send real-time accounting packets when the remaining time quota of a user is less than or equal to the configured interval.</p>
</p></li><li><span>(Optional) Run <a href="cmdqueryname=accounting+start-fail"><b><span class="cmdname">accounting start-fail</span></b></a> { <strong><span>offline</span></strong> | <strong><span>online</span></strong> <span>[ <strong><span>keep-accounting</span></strong> ]</span> }</span><p><p>The policy for handling accounting start failures is configured.</p>
</p><p><p>If the <span class="keyword">NE40E</span> does not receive any response after sending an Accounting Start packet to the remote accounting server, the <span class="keyword">NE40E</span> adopts the policy for handling accounting start failures. This policy may keep the user online or log the user out.</p>
</p></li><li><span>(Optional) Run <a href="cmdqueryname=accounting+interim-fail"><b><span class="cmdname">accounting interim-fail</span></b></a> [ <strong><span>max-times</span></strong> <i><span class="varname">times</span></i> ] { <strong><span>offline</span></strong> | <strong><span>online</span></strong> }</span><p><p>The policy for handling real-time accounting failures is configured.</p>
</p><p><p>If the <span class="keyword">NE40E</span> does not receive any response packet after re-sending a real-time accounting packet to the remote accounting server for a specified number of times, the <span class="keyword">NE40E</span> adopts the policy for handling real-time accounting failures. This policy may keep the user online or log the user out.</p>
<p>If RADIUS/HWTACACS accounting is used, it is recommended that the number of retransmissions of real-time accounting packets be greater than the number of retransmissions of RADIUS/HWTACACS packets.</p>
</p></li><li><span>(Optional) Run <a href="cmdqueryname=accounting+send-update"><b><span class="cmdname">accounting send-update</span></b></a></span><p><p>The <span class="keyword">NE40E</span> is configured to send a real-time accounting packet immediately after receiving an Accounting Start response.</p>
</p><p><p>After receiving an Accounting Start response from the accounting server, the <span class="keyword">NE40E</span> determines whether to immediately send real-time accounting packets according to the configuration.</p>
</p></li><li><span>(Optional) Enable the device to send Accounting Start packets for users after a specified delay.</span><ol type="a"><li class="substepexpand"><span>Run the <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a> command to return to the AAA view.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=domain"><b><span class="cmdname">domain</span></b></a> <i><span class="varname">domain-name</span></i> command to enter the domain view.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=accounting-start-delay"><b><span class="cmdname">accounting-start-delay </span></b></a><i><span class="varname">delay-time</span></i> <strong><span>online</span></strong> <strong><span>user-type</span></strong> { <strong><span>ppp</span></strong> | <strong><span>ipoe</span></strong> | <strong><span>l2tp</span></strong> | <strong><span>static</span></strong> } <sup>*</sup> or <a href="cmdqueryname=accounting-start-delay"><b><span class="cmdname">accounting-start-delay </span></b></a><i><span class="varname">delay-time</span></i> <strong><span>offline</span></strong> [ <strong><span>user-type</span></strong> { <strong><span>ppp</span></strong> | <strong><span>ipoe</span></strong> | <strong><span>l2tp</span></strong> | <strong><span>static</span></strong> } <sup>*</sup> ] command to configure the device to send Accounting Start packets after a delay.</span><p></p></li><li class="substepexpand"><span>(Optional) Run the <a href="cmdqueryname=accounting-start-delay+ipv4+start-accounting+immediately"><b><span class="cmdname">accounting-start-delay ipv4 start-accounting immediately</span></b></a> command to configure the device to send an Accounting Start packet immediately after a dual-stack user goes online through the IPv4 stack.</span><p><p>In a scenario where delayed accounting is enabled for a dual-stack user, if the dual-stack user goes online through the IPv4 stack first, an Accounting Start packet carrying the IPv4 address of the user is immediately sent. If the dual-stack user goes online through the IPv6 stack first, the device sends an Accounting Start packet after the dual-stack user also goes online through the IPv4 stack or the timeout period expires.</p>
</p></li><li class="substepexpand"><span>(Optional) Run the <a href="cmdqueryname=accounting-start-delay+traffic-forward+before-start-accounting"><b><span class="cmdname">accounting-start-delay traffic-forward before-start-accounting</span></b></a> command to configure the device to allow a dual-stack user who goes online only from the IPv4 or IPv6 stack to access the network before accounting is started.</span><p><p>If delayed accounting is enabled for a dual-stack user and the user does not go online through the second stack for quite some time, the user is allowed to access the network using the IP protocol stack through which the user has gone online.</p>
</p></li><li class="substepexpand"><span>(Optional) Run the <a href="cmdqueryname=accounting-start-delay+traffic-statistics+before-start-accounting"><b><span class="cmdname">accounting-start-delay traffic-statistics before-start-accounting</span></b></a> command to configure the device to collect statistics about user traffic before Accounting Start packets are sent and report the statistics to the accounting server in a scenario where delayed accounting is enabled.</span><p><p>If delayed accounting is enabled for a dual-stack user and the user goes online from the IPv4 or IPv6 stack, the device can collect statistics about user traffic before Accounting Start packets are sent and report the statistics to the accounting server.</p>
</p></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a> command to commit the configuration.</span></li></ol>
</li><li><span>(Optional) Run <a href="cmdqueryname=accounting-stop-packet+include+all-stack-ip+user-type+ipoe"><b><span class="cmdname">accounting-stop-packet include all-stack-ip user-type ipoe</span></b></a></span><p><p>The device is configured to add all the assigned IP addresses to an Accounting Stop packet to be sent to the RADIUS server for an IPoE user. This prevents accounting failures caused by incomplete IP information carried in an Accounting Stop packet when a dual-stack user goes offline only from the IPv4 or IPv6 stack.</p>
</p></li><li><span>(Optional) Configure an accounting copy scheme.</span><ol type="a"><li class="substepexpand"><span>Run the <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a> command to enter the AAA view.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=accounting-copy-group"><b><span class="cmdname">accounting-copy-group</span></b></a> <i><span class="varname">group-name</span></i> command to create an accounting copy group and enter its view.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=radius-server+group"><b><span class="cmdname">radius-server group</span></b></a> <em>group-name</em> [ <strong><span>interval</span></strong> <em>interval-value</em> ] command to configure an accounting copy server group and the interval at which accounting copy packet information is sent to the accounting copy server group.</span><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>You are advised to set <strong><span>interval</span></strong> <em>interval-value</em> to a value greater than or equal to 60.</p>
</div></div>
</p></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a> command to commit the configuration.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a> command to enter the AAA view.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=domain"><b><span class="cmdname">domain</span></b></a> <i><span class="varname">domain-name</span></i> command to enter the domain view.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=accounting-copy-group"><b><span class="cmdname">accounting-copy-group</span></b></a> <i><span class="varname">group-name</span></i> command to bind the accounting copy group to the domain.</span></li></ol>
</li><li><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_aaa_cfg_0515.html">Configuring AAA Schemes
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_aaa_cfg_0465.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_aaa_cfg_0114.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>