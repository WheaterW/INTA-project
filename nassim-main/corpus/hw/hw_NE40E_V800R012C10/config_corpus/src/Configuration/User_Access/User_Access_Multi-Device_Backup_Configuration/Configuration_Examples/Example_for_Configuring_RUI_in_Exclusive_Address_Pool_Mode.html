
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring RUI in Exclusive Address Pool Mode">
<meta name="abstract" content="This section provides an example for configuring Redundancy User Information (RUI) in exclusive address pool mode. A networking diagram is provided to help you understand the configuration procedure. This example covers networking requirements, configuration roadmap, configuration procedure, and configuration files.">
<meta name="description" content="This section provides an example for configuring Redundancy User Information (RUI) in exclusive address pool mode. A networking diagram is provided to help you understand the configuration procedure. This example covers networking requirements, configuration roadmap, configuration procedure, and configuration files.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cfg_rui_0050.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cfg_rui_0058.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="z00588052,w00606909,w00447999">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="UP Multi-Device Backup">
<meta name="featurename" content="User Access Multi-Device Backup">
<meta name="featuretype" content="User Access">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="UP Multi-Device Backup">
<meta name="featurename" content="User Access Multi-Device Backup">
<meta name="featuretype" content="User Access">
<meta name="featurename" content="UP Multi-Device Backup">
<meta name="featurename" content="User Access Multi-Device Backup">
<meta name="featuretype" content="User Access">
<meta name="featurename" content="User Access Multi-Device Backup">
<meta name="featuretype" content="User Access">
<meta name="OWNER" content="l00425560">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="z00588052">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172374395">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring RUI in Exclusive Address Pool Mode</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172374395"></a><a name="EN-US_TASK_0172374395"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring RUI in Exclusive Address Pool Mode</h1>
<div class="taskbody"><p>This section provides an example for configuring Redundancy User Information (RUI) in exclusive address pool mode. A networking diagram is provided to help you understand the configuration procedure. This example covers networking requirements, configuration roadmap, configuration procedure, and configuration files.</p>
<div class="context"><a name="EN-US_TASK_0172374395__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><div class="p"><h4 class="sectiontitle">Usage Scenario</h4><p>High reliability is a basic requirement for carrier-grade devices. The <span class="keyword">NE40E</span> is an edge router used to carry multiple services. It plays a vital role on a network. It is uplinked to the core layer to implement the Layer 3 routing function and downlinked to the aggregation layer to terminate Layer 2 user packets for user access. Additionally, it carries multiple services including Triple Play services (HSI, VoIP, and IPTV), requiring high reliability. The <span class="keyword">NE40E</span> provides service-level high-reliability technologies. Non-stop data flow forwarding does not mean that user services are not interrupted. Instead, when user traffic is switched to a backup device after a network node or link fails, user services are still interrupted if user information is not synchronized to the backup device. High reliability has been considered when the <span class="keyword">NE40E</span> is designed to function as a network edge service aggregation and control device. This ensures that users' HSI, IPTV, and VoIP services are not interrupted if a network node or link fault occurs. Dual-device hot backup is designed based on this reliability scenario.</p>
<h4 class="sectiontitle">Requirements on Hardware</h4><p>A board that supports user access is installed on the device.</p>
<h4 class="sectiontitle">Requirements on Interconnected Devices</h4><ul><li>Upstream device: There are no special requirements. The upstream device is generally a core-layer CR that can exchange routes normally and supports MPLS and MPLS L3VPN. It is recommended that the upstream device be able to provide MPLS L2VPN capabilities. In multi-device hot backup scenarios, MPLS tunnels are best suited to function as protection tunnels. This is because an MPLS protection tunnel can be established from the IP core network if a direct link cannot be deployed between <span class="keyword">NE40E</span>s.<div class="note" id="EN-US_TASK_0172374395__n_01"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0172374395__p1361260258214109">If the upstream device is a firewall, disable the IP spoofing attack defense function on the firewall.</p>
</div></div>
</li><li>Downstream device: An aggregation switch is used as the downstream device to learn MAC addresses from Layer 2 VLAN packets.</li></ul>
<h4 class="sectiontitle">Solution Limitations</h4><ul><li>An exclusive address pool is an address pool or address segment exclusively used by a backup group or link. Generally, an exclusive address pool is used for services that can be assigned private IP addresses, such as VoIP services. To avoid wasting IP addresses, do not use this type of address pool for services that use public IP addresses, such as HSI services.</li><li>In exclusive address pool mode, the master and backup devices cannot advertise the same network segment route. Advertising the same network segment route will cause load balancing on the upstream CRs and network-to-user traffic forwarding errors.</li><li>In a dual-device hot backup scenario, Internet access traffic may be interrupted during a failover. After the failover is complete, traffic recovers. In this example, the VRRP+BFD solution is used to implement millisecond-level failover. This solution depends on the function of configuring BFD for the downstream Layer 3 aggregation switch. If the switch does not support this function, delete the BFD configuration in this example. After a fault occurs, a failover is performed in seconds.</li></ul>
<h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0172374395__fig_dc_ne_cfg_01043201">Figure 1</a>, users access <span class="keyword">Device</span> A and <span class="keyword">Device</span> B through a LAN switch. The two devices run VRRP to determine the master/backup status. Basic user access functions are configured on <span class="keyword">Device</span> A and <span class="keyword">Device</span> B, allowing the users to go online through the master device. If the master device or the link on the network or user side of the master device fails, service traffic needs to be quickly switched to the backup device.</p>
<p>In exclusive address pool mode, an exclusively used address pool is bound to each RBP (the address pools bound to the RBPs of <span class="keyword">Device</span> A and <span class="keyword">Device</span> B must have the same address segment). Network-side traffic is sent back through an advertised network-side route. If the master/backup status of <span class="keyword">Device</span> A and <span class="keyword">Device</span> B changes, the network-side route of <span class="keyword">Device</span> A is withdrawn. <span class="keyword">Device</span> B then advertises a network-side route.</p>
<div class="fignone" id="EN-US_TASK_0172374395__fig_dc_ne_cfg_01043201"><a name="EN-US_TASK_0172374395__fig_dc_ne_cfg_01043201"></a><a name="fig_dc_ne_cfg_01043201"></a><span class="figcap"><b>Figure 1 </b>Configuring RUI in exclusive address pool mode</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interfaces 1 and 2 represent GE<span>0/1/0</span> and GE<span>0/2/2</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_ne_cfg_rui_000001.png" width="NaN" height="NaN"></span><div class="tableBorder"><table cellpadding="4" cellspacing="0" summary=""><tr><td valign="top" width="30.999999999999996%"><p>Device</p>
</td>
<td valign="top" width="34.666666666666664%"><p>Interface</p>
</td>
<td valign="top" width="34.33333333333333%"><p>IP Address</p>
</td>
</tr>
<tr><td valign="top"><p><span class="keyword">Device</span> A</p>
</td>
<td valign="top"><p><span>Eth-Trunk3.4001</span></p>
</td>
<td valign="top"><p>192.168.254.2/29</p>
</td>
</tr>
<tr><td valign="top"><p><span class="keyword">Device</span> A</p>
</td>
<td valign="top"><p><span>Eth-Trunk3.2001</span></p>
</td>
<td valign="top"><p>192.168.254.10/29</p>
</td>
</tr>
<tr><td valign="top"><p><span class="keyword">Device</span> A</p>
</td>
<td valign="top"><p>Loopback0</p>
</td>
<td valign="top"><p>172.20.1.1/32</p>
</td>
</tr>
<tr><td valign="top"><p><span class="keyword">Device</span> A</p>
</td>
<td valign="top"><p>Loopback10</p>
</td>
<td valign="top"><p>172.20.1.3/32</p>
</td>
</tr>
<tr><td valign="top"><p><span class="keyword">Device</span> A</p>
</td>
<td valign="top"><p>GE<span>0/1/0</span></p>
</td>
<td valign="top"><p>172.20.0.33/30</p>
</td>
</tr>
<tr><td valign="top"><p><span class="keyword">Device</span> A</p>
</td>
<td valign="top"><p>GE<span>0/2/2</span></p>
</td>
<td valign="top"><p>172.20.0.57/30</p>
</td>
</tr>
<tr><td valign="top"><p><span class="keyword">Device</span> B</p>
</td>
<td valign="top"><p><span>Eth-Trunk3.4001</span></p>
</td>
<td valign="top"><p>192.168.254.3/29</p>
</td>
</tr>
<tr><td valign="top"><p><span class="keyword">Device</span> B</p>
</td>
<td valign="top"><p>Loopback0</p>
</td>
<td valign="top"><p>172.20.1.1/32</p>
</td>
</tr>
<tr><td valign="top"><p><span class="keyword">Device</span> B</p>
</td>
<td valign="top"><p>Loopback10</p>
</td>
<td valign="top"><p>172.20.1.2/32</p>
</td>
</tr>
<tr><td valign="top"><p><span class="keyword">Device</span> B</p>
</td>
<td valign="top"><p>GE<span>0/1/0</span></p>
</td>
<td valign="top"><p>172.20.0.37/30</p>
</td>
</tr>
<tr><td valign="top"><p><span class="keyword">Device</span> B</p>
</td>
<td valign="top"><p>GE<span>0/2/2</span></p>
</td>
<td valign="top"><p>172.20.0.61/30</p>
</td>
</tr>
<tr><td valign="top"><p>Lan switch</p>
</td>
<td valign="top"><p>Eth-Trunk1.2001</p>
</td>
<td valign="top"><p>192.168.254.11/29</p>
</td>
</tr>
</table></div>
</div>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172374395__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure interfaces and assign IP addresses to them.</p>
</li><li><p>Establish a multi-device backup platform.</p>
</li><li><p>Configure IP address pool binding.</p>
</li><li><p>Bind an RBP to an interface through which the user goes online.</p>
</li><li><p>Configure routes to ensure IP connectivity between devices. For details, see "IP Routing" in <em><span class="keyword">HUAWEI NE40E-M2 series</span> <span class="keyword">Universal Service Router</span> Configuration Guide</em>.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172374395__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>VRRP ID</p>
</li><li><p>Interface IP addresses of <span class="keyword">Router</span>s that back up each other</p>
</li><li><p>Backup ID, which works together with an RBS to identify an RBP to which users belong</p>
</li><li>User authentication mode (RADIUS authentication)</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172374395__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure device interfaces and IP addresses.</span><p><p>The configuration on <span class="keyword">Device</span> A is used as an example. The configuration of <span class="keyword">Device</span> B is similar to the configuration of <span class="keyword">Device</span> A.</p>
<pre class="screen">&lt;<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A&gt;<strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A]<strong>interface Eth-Trunk3</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-Eth-Trunk3]<strong> description ToJiaohuanji </strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-Eth-Trunk3]<strong> commit </strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-Eth-Trunk3]<strong> quit </strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A]<strong>interface GigabitEthernet<span>0/1/3</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/3</span>]<strong> description ToJiaohuanji </strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/3</span>]<strong>undo shutdown </strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/3</span>]<strong> eth-trunk 3</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/3</span>]<strong> commit </strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/3</span>]<strong> quit </strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A]<strong> interface Eth-Trunk3.4001</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-Eth-Trunk3.4001]<strong> control-vid 4001 dot1q-termination</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-Eth-Trunk3.4001] <strong>dot1q termination vid 4001</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-Eth-Trunk3.4001] <strong>ip address 192.168.254.2 255.255.255.248</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-Eth-Trunk3.4001]<strong> commit </strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-Eth-Trunk3.4001]<strong> quit </strong></pre>
</p></li><li><span>Configure IP addresses for loopback interfaces.</span><p><p>The configuration on <span class="keyword">Device</span> A is used as an example. The configuration of <span class="keyword">Device</span> B is similar to that of <span class="keyword">Device</span> A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A]<strong>interface loopback10</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-Loopback10]<strong>ip address 172.20.1.3 255.255.255.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-Loopback10]<strong> commit </strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-Loopback10]<strong> quit </strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A]<strong>interface loopback0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-Loopback0]<strong>ip address 172.20.1.1 255.255.255.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-Loopback0]<strong> commit </strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-Loopback0]<strong> quit </strong></pre>
</p></li><li><span>Configure BFD sessions to rapidly detect interface or link faults and trigger a master/backup VRRP switchover.</span><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>If the access-side aggregation switch does not support BFD, skip this step. This example describes only the configuration on this product. For details about how to configure BFD sessions on the switch, see the related manual.</p>
</div></div>
<p># Configure a BFD session named <strong>bfd-peer</strong> between Device A and Device B. The BFD session shares the same link with the access-side VRRP. The following uses Device A as an example. The configuration of Device B is similar to that of Device A. 192.168.254.3 is the IP address of Eth-Trunk3.4001 on Device B.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceA] <strong>bfd</strong>
[*DeviceA-bfd] <strong>quit</strong>
[*DeviceA] <strong>bfd bfd-peer bind peer-ip 192.168.254.3 source-ip 192.168.254.2</strong>
[*DeviceA-bfd-session-bfd-peer] <strong>discriminator local 2 </strong>
[*DeviceA-bfd-session-bfd-peer] <strong>discriminator remote 2</strong>
[*DeviceA-bfd-session-bfd-peer] <strong>commit </strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceA-bfd-session-bfd-peer]<strong> quit </strong></pre>
<p># Configure a BFD session <strong>bfd-link</strong> between Device A and Lan switch. 192.168.254.11 is the IP address of Eth-Trunk1.2001 on the Lan switch.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceA]<strong> bfd </strong><strong>bfd-link</strong><strong> bind peer-ip 192.168.254.</strong><strong>1</strong><strong>1</strong><strong> source-ip 192.168.254.</strong><strong>1</strong><strong>0</strong>
[*DeviceA-bfd-session-bfd-link]<strong> discriminator local </strong><strong>3</strong><strong> </strong>
[*DeviceA-bfd-session-bfd-link]<strong> discriminator remote 3 </strong>
[*DeviceA-bfd-session-bfd-link]<strong> commit </strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceA-bfd-session-bfd-link]<strong> quit </strong></pre>
</p></li><li><span>Establish a multi-device backup platform.</span><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, only the RUI-related configuration is described. For other configurations, see the corresponding configuration guide.</p>
</div></div>
<p># Configure a VRRP group on Eth-Trunk 3.4001, and configure the VRRP group to track the BFD session and network-side interface.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceA] <strong>interface Eth-Trunk3.4001</strong>
[*DeviceA-Eth-Trunk3.4001]<strong> vrrp vrid 3 virtual-ip 192.168.254.1</strong>
[*DeviceA-Eth-Trunk3.4001]<strong> vrrp vrid 3 priority 120</strong>
[*DeviceA-Eth-Trunk3.4001]<strong> vrrp vrid 3 preempt-mode timer delay 1200</strong>
[*DeviceA-Eth-Trunk3.4001] <strong>vrrp vrid 3 track interface GigabitEthernet<span>0/1/0</span> reduced 30</strong>
[*DeviceA-Eth-Trunk3.4001]<strong> vrrp vrid 3 track bfd-session 3 link</strong>
[*DeviceA-Eth-Trunk3.4001]<strong> commit </strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceA-Eth-Trunk3.4001]<strong> quit</strong></pre>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceB]<strong> interface Eth-Trunk3.4001</strong>
[*DeviceB-Eth-Trunk3.4001]<strong> vrrp vrid 3 virtual-ip 192.168.254.1</strong>
[*DeviceB-Eth-Trunk3.4001] <strong>vrrp vrid 3 priority</strong><strong> 100</strong>
[*DeviceB-Eth-Trunk3.4001]<strong> vrrp vrid 3 track bfd-session 2 peer</strong>
[*DeviceB-Eth-Trunk3.4001]<strong> commit </strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>DeviceB-Eth-Trunk3.4001]<strong> quit </strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Different priorities must be configured for devices in a VRRP group. The device with a higher priority is the master device.</p>
</div></div>
<p># Configure an RBS. The configuration of Device A is used as an example. The configuration of Device B is similar to that of Device A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A]<strong> remote-backup-service rbs_qhmd </strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-rm-backup-rbs_qhmd]<strong> peer 172.20.1.2 source 172.20.1.3 port 2046</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-rm-backup-rbs_qhmd]<strong> track interface GigabitEthernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-rm-backup-rbs_qhmd] <strong>track interface GigabitEthernet<span>0/2/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-rm-backup-rbs_qhmd<strong>] commit </strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-rm-backup-rbs_qhmd]<strong> quit </strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Ensure that the master and backup devices can ping each other.</p>
</div></div>
<p># Configure an RBP. The configuration of Device A is used as an example. The configuration of Device B is similar to that of Device A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A]<strong> remote-backup-profile rbp3 </strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-rm-backup-prf-rbp3]<strong> service-type bras </strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-rm-backup-prf-rbp3]<strong> backup-id 3 remote-backup-service rbs_qhmd</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-rm-backup-prf-rbp3]<strong> peer-backup hot </strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-rm-backup-prf-rbp3]<strong> vrrp-id 3 interface Eth-Trunk3.4001</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-rm-backup-prf-rbp3]<strong> nas logic-port Gigabitethernet <span>0/1/3</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-rm-backup-prf-rbp3]<strong> </strong><strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-rm-backup-prf-rbp3]<strong> nas logic-sysname masterdevice</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-rm-backup-prf-rbp3]<strong> nas logic-ip 172.20.1.1</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-rm-backup-prf-rbp3]<strong> quit </strong></pre>
</p></li><li><span>Configure IP address pool binding. The configuration on <span class="keyword">Device</span> A is used as an example. The configuration of <span class="keyword">Device</span> B is similar to that of <span class="keyword">Device</span> A.</span><p><p># Configure an address pool.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>ip pool dmtjs_xi bas local</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-ip-pool-dmtjs_xi] <strong>gateway 10.1.1.1 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-ip-pool-dmtjs_xi] <strong>section 0 10.1.1.2 10.1.1.254 </strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-ip-pool-dmtjs_xi] <strong>dns-server 192.168.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-ip-pool-dmtjs_xi] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-ip-pool-dmtjs_xi] <strong>quit</strong></pre>
<p># Bind the address pool to the RBP.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A]<strong> remote-backup-profile rbp3 </strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-rm-backup-prf-rbp3]<strong> ip-pool dmtjs_xi</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-rm-backup-prf-rbp3] <strong>quit</strong></pre>
</p></li><li><span>Configure a RADIUS server group.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>radius-server group rd</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-radius-rd]<strong> radius-server authentication 10.7.66.66 1812</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-radius-rd] <strong>radius-server accounting 10.7.66.66 1813</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-radius-rd] <strong>radius-server shared-key-cipher YsHsjx_202206</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-radius-rd] <strong>radius-server retransmit 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-radius-rd] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-radius-rd] <strong>quit</strong></pre>
</p></li><li><span>Configure authentication and accounting policies for user access. The configuration on <span class="keyword">Device</span> A is used as an example. The configuration of <span class="keyword">Device</span> B is similar to that of <span class="keyword">Device</span> A.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>aaa</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-aaa]<strong> authentication-scheme wu</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-aaa-authen-wu] <strong>authentication-mode radius</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-aaa-authen-wu] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-aaa-authen-wu] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-aaa] <strong>accounting-scheme wu</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-aaa-accounting-wu] <strong>accounting-mode none</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-aaa-accounting-wu] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-aaa-accounting-wu] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-aaa] <strong> domain dmtjs_xi</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-aaa-domain-dmtjs_xi] <strong>authentication-scheme wu</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-aaa-domain-dmtjs_xi] <strong>accounting-scheme wu</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-aaa-domain-dmtjs_xi] <strong>radius-server group rd</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-aaa-domain-dmtjs_xi] <strong>ip-pool dmtjs_xi</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-aaa-domain-dmtjs_xi] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-aaa-domain-dmtjs_xi] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-aaa] <strong>quit</strong></pre>
</p></li><li><span>Bind the RBP to <span>Eth-Trunk3.501</span> through which users go online. The configuration of <span class="keyword">Device</span> B is similar to that of <span class="keyword">Device</span> A.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A]<strong> interface <span>Eth-Trunk3.501</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-<span>Eth-Trunk3.501</span>]<strong> user-vlan 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-<span>Eth-Trunk3.501</span>-vlan-1-1]<strong> </strong><strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-<span>Eth-Trunk3.501</span>-vlan-1-1]<strong> </strong><strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-<span>Eth-Trunk3.501</span>]<strong> remote-backup-profile rbp3 </strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-<span>Eth-Trunk3.501</span>]<strong> </strong><strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-<span>Eth-Trunk3.501</span>]<strong> bas</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-<span>Eth-Trunk3.501</span>-bas]<strong> access-type layer2-subscriber default-domain authentication dmtjs_xi</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-<span>Eth-Trunk3.501</span>-bas]<strong> authentication-method bind</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-<span>Eth-Trunk3.501</span>-bas]<strong> quit </strong></pre>
</p></li><li><span>Configure advertisement of address pool routes. The configuration on <span class="keyword">Device</span> A is used as an example. The configuration of <span class="keyword">Device</span> B is similar to that of <span class="keyword">Device</span> A.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A]<strong> ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-ospf-1]<strong> import-route unr</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-ospf-1]<strong> area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-ospf-1-area-0.0.0.0]<strong> network 172.20.1.1 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-ospf-1-area-0.0.0.0]<strong> network 172.20.1.3 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-ospf-1-area-0.0.0.0]<strong> network 172.20.0.33 0.0.0.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-ospf-1-area-0.0.0.0]<strong> network 172.20.0.57 0.0.0.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-ospf-1-area-0.0.0.0]<strong> commit </strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-ospf-1-area-0.0.0.0]<strong> quit </strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-ospf-1]<strong> quit </strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p>After successfully configuring the RBP, run the <strong>display remote-backup-profile</strong> command. The command output shows that the RBS type is <strong>bras</strong>, the RBP named <strong>rbp3</strong> is bound to <strong>Eth-Trunk3.501</strong> through which users go online, and <span class="keyword">Device</span> A is in the <strong>Master</strong> state.</p>
<pre class="screen">&lt;<span class="keyword">Device</span>A&gt; <strong>display remote-backup-profile rbp3</strong>
-----------------------------------------------
 Profile-Index        : 0x802
 Profile-Name         : rbp3
 <strong>Service            : bras</strong>
 Remote-backup-service: rbs_qhmd
 Backup-ID            : 10
 track protocol       : VRRP
 VRRP-ID              : 3
 VRRP-Interface       : Eth-Trunk3.4001
 <strong>Interface          : Eth-Trunk3.501</strong>
 <strong>State              : Master</strong>
 <strong>Peer-state         : Slave</strong>
 Backup mode          : hot
 Slot-Number          : 1
 Card-Number          : 0
 Port-Number          : 0
 Nas logic-port       : Gigabitethernet <span>0/1/3</span>
 Nas logic-ip         : 172.20.1.1
 Nas logic-sysname    : masterdevice
IP-Pool               :
                       dmtjs_xi
 Traffic interval     : 20(minutes)</pre>
<p>After the RBS is configured successfully, the TCP connection status becomes <strong>Connected</strong>.</p>
<pre class="screen">&lt;<span class="keyword">Device</span>A&gt; <strong>display remote-backup-service rbs_qhmd </strong>
----------------------------------------------------------
 Service-Index    : 0
 Service-Name     : rbs_qhmd
 <strong>TCP-State        : Connected</strong>
 Peer-ip          : 172.20.1.2 
 Source-ip        : 172.20.1.3 
 TCP-Port         : 2046
 Track-BFD        : --
 Track-interface0 : <span>0/1/0</span>
 Track-interface1 : <span>0/2/2</span>
 Last up time     : 2016-06-02 16:15:8 
 Last down time   : 2016-06-02 16:3:36 
 Last down reason : TCP closed for packet error. 
--------------------------------------------------------</pre>
<p>After users go online, run the <strong>display backup-user</strong> command to check information about backup users.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>display backup-user</strong></pre>
<pre class="screen">  Remote-backup-service: rbs_qhmd
  Total Users Numer: 3
------------------------------------------------------------------------
 101  102  103
------------------------------------------------------------------------
  Local Users Number: 1
  Remote Users Number: 0</pre>
<p>Run the <strong>display access-user interface</strong> command to view online user information on a specified interface.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>display access-user interface Eth-Trunk3.501</strong></pre>
<pre class="screen">------------------------------------------------------------------------------
  UserID  Username                Interface      IP address       MAC          IPv6 address
  ------------------------------------------------------------------------------
  --------------------------------------------------------------------------
  100      user1@dmtjs_xi                Eth-Trunk3.501      192.168.1.10         00e0-fc12-3456          -
  101      user2@dmtjs_xi                Eth-Trunk3.501      192.168.1.9          00e0-fc12-3457          -
  102      user3@dmtjs_xi                Eth-Trunk3.501      192.168.1.8          00e0-fc12-3458          -
  --------------------------------------------------------------------------
  Total users                        :3</pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172374395__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p><span class="keyword">Device</span> A configuration file</p>
<pre class="screen">#
 sysname <span class="keyword">Device</span>A
#
router id 172.20.1.3
#
vlan batch 2 to 9 11 to 504 506 to 3999 4001 to 4094
#
bfd
#
ip pool dmtjs_xi bas local 
gateway 10.1.1.1 255.255.255.0
section 0 10.1.1.2 10.1.1.254 
dns-server 192.168.1.1
#
radius-server group rd                                                       
 radius-server authentication 10.7.66.66 1812 weight 0 
 radius-server accounting 10.7.66.66 1813 weight 0
 radius-server shared-key-cipher %^%#h{FXVBLZX9#`VI]EWUUaOSHGd5E!.1DGeVYEie=%^% 
 radius-server retransmit 2                                                    
# 
aaa
 authentication-scheme wu
  authentication-mode radius
#
 accounting-scheme wu 
  accounting-mode none
#
 domain dmtjs_xi 
 authentication-scheme wu 
 accounting-scheme wu
 radius-server group rd
 ip-pool dmtjs_xi 
#
bfd bfd-peer bind peer-ip 192.168.254.3 source-ip 192.168.254.2
 discriminator local 2
 discriminator remote 2
#
bfd bfd-link bind peer-ip 192.168.254.11 source-ip 192.168.254.10
 discriminator local 3
 discriminator remote 3
#
interface Eth-Trunk3
 description ToJiaohuanji
#
interface <span>Eth-Trunk3.501</span>
 user-vlan 1 
 remote-backup-profile rbp3 
 bas 
  access-type layer2-subscriber default-domain authentication dmtjs_xi
  authentication-method bind 
 #
#
interface Eth-Trunk3.2001
 control-vid 2001 dot1q-termination
 dot1q termination vid 2001
 ip address 192.168.254.10 255.255.255.248
#
interface Eth-Trunk3.4001
 control-vid 4001 dot1q-termination
 dot1q termination vid 4001
 ip address 192.168.254.2 255.255.255.248
 vrrp vrid 3 virtual-ip 192.168.254.1
 vrrp vrid 3 priority 120 
 vrrp vrid 3 preempt-mode timer delay 1200
 vrrp vrid 3 track bfd-session 3 link
 vrrp vrid 3 track interface GigabitEthernet<span>0/1/0</span> reduced 30
#
interface LoopBack0
 ip address 172.20.1.1 255.255.255.255
#
interface LoopBack10
 ip address 172.20.1.3 255.255.255.255
#
interface GigabitEthernet<span>0/1/3</span>
 description ToJiaohuanji
 undo shutdown
 eth-trunk 3
#
interface GigabitEthernet<span>0/1/0</span>
undo shutdown
 ip address 172.20.0.33 255.255.255.252
#
interface GigabitEthernet<span>0/2/2</span>
undo shutdown
 ip address 172.20.0.57 255.255.255.252
#
remote-backup-service rbs_qhmd
 peer 172.20.1.2 source 172.20.1.3 port 2046
 track interface gigabitethernet <span>0/1/0</span> 
 track interface gigabitethernet <span>0/2/2</span> 
#
remote-backup-profile rbp3 
 service-type bras
 backup-id 3 remote-backup-service rbs_qhmd
 peer-backup hot 
 vrrp-id 3 interface Eth-Trunk3.4001
 nas logic-port gigabitethernet<span>0/1/3</span> 
 nas logic-sysname masterdevice 
 nas logic-ip 172.20.1.1 
 ip-pool dmtjs_xi
#
ospf 1
 import-route unr
 area 0.0.0.0
  network 172.20.0.32 0.0.0.3
  network 172.20.0.56 0.0.0.3
  network 172.20.1.1 0.0.0.0
  network 172.20.1.3 0.0.0.0
#
 return </pre>
</li><li><p><span class="keyword">Device</span> B configuration file</p>
<pre class="screen">#
 sysname <span class="keyword">Device</span>B
#
router id 172.20.1.2
#
vlan batch 2 to 9 11 to 504 506 to 3999 4001 to 4094
#
bfd
#
ip pool dmtjs_xi bas local 
gateway 10.1.1.1 255.255.255.0
section 0 10.1.1.2 10.1.1.254 
dns-server 192.168.1.1
#
radius-server group rd 
 radius-server authentication 10.7.66.66 1812 weight 0 
 radius-server accounting 10.7.66.66 1813 weight 0
 radius-server shared-key-cipher %^%#h{FXVBLZX9#`VI]EWUUaOSHGd5E!.1DGeVYEie=%^% 
 radius-server retransmit 2 
# 
aaa
 authentication-scheme wu
  authentication-mode radius
#
 accounting-scheme wu 
  accounting-mode none
 domain dmtjs_xi 
  authentication-scheme wu 
  accounting-scheme wu
  radius-server group rd
  ip-pool dmtjs_xi 
#
bfd  bfd-peer bind peer-ip 192.168.254.2 source-ip 192.168.254.3
 discriminator local 2
 discriminator remote 2 
#
interface Eth-Trunk3
 description ToJiaohuanji
#
interface <span>Eth-Trunk3.501</span>
 user-vlan 1 
 remote-backup-profile rbp3 
 bas 
 #
  access-type layer2-subscriber default-domain authentication dmtjs_xi
  authentication-method bind 
 #
#
interface Eth-Trunk3.4001
 control-vid 4001 dot1q-termination
 dot1q termination vid 4001
 ip address 192.168.254.3 255.255.255.248
 vrrp vrid 3 virtual-ip 192.168.254.1
 vrrp vrid 3 track bfd-session 2 peer
#
interface GigabitEthernet<span>0/1/3</span>
 description ToJiaohuanji
 undo shutdown
 eth-trunk 3
#
interface LoopBack0
 ip address 172.20.1.1 255.255.255.255
#
interface LoopBack10
 ip address 172.20.1.2 255.255.255.255
#
interface GigabitEthernet<span>0/1/0</span>
undo shutdown
 ip address 172.20.0.37 255.255.255.252
#
interface GigabitEthernet<span>0/2/2</span>
undo shutdown
 ip address 172.20.0.61 255.255.255.252
#
remote-backup-service rbs_qhmd
 peer 172.20.1.3 source 172.20.1.2 port 2046
 track interface gigabitethernet <span>0/1/0</span>
 track interface gigabitethernet <span>0/2/2</span>
#
remote-backup-profile rbp3 
 service-type bras
 backup-id 3 remote-backup-service rbs_qhmd
 peer-backup hot 
 vrrp-id 3 interface Eth-Trunk3.4001
 nas logic-port gigabitethernet<span>0/1/3</span>
 nas logic-sysname masterdevice 
 nas logic-ip 172.20.1.1 
 ip-pool dmtjs_xi
#
ospf 1
 import-route unr
 area 0.0.0.0
  network 172.20.0.36 0.0.0.3
  network 172.20.0.60 0.0.0.3
  network 172.20.1.1 0.0.0.0
  network 172.20.1.2 0.0.0.0
#
 return </pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cfg_rui_0050.html">Configuration Examples
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cfg_rui_0058.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>