
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Controlling Advertisement of Shared Address Pool UNRs">
<meta name="abstract" content="If BRASs work in load balancing mode, the BRASs must be configured to control advertisement of UNRs of configured address pools.">
<meta name="description" content="If BRASs work in load balancing mode, the BRASs must be configured to control advertisement of UNRs of configured address pools.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cfg_rui_0004.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cfg_rui_0007.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cfg_rui_0009.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="z50024784,z00603461,w00800033,z00588052,rui_ne,c00549182,w00556928,l00593348,w00606909,w00447999,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="UP Multi-Device Backup">
<meta name="featurename" content="User Access Multi-Device Backup">
<meta name="featuretype" content="User Access">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="UP Multi-Device Backup">
<meta name="featurename" content="User Access Multi-Device Backup">
<meta name="featuretype" content="User Access">
<meta name="featurename" content="UP Multi-Device Backup">
<meta name="featurename" content="User Access Multi-Device Backup">
<meta name="featuretype" content="User Access">
<meta name="featurename" content="User Access Multi-Device Backup">
<meta name="featuretype" content="User Access">
<meta name="OWNER" content="l00593348">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="z00588052">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172374353">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Controlling Advertisement of Shared Address Pool UNRs</title>
</head>
<body><a name="EN-US_TASK_0172374353"></a><a name="EN-US_TASK_0172374353"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Controlling Advertisement of Shared Address Pool UNRs</h1>
<div class="taskbody"><p>If BRASs work in load balancing mode, the BRASs must be configured to control advertisement of UNRs of configured address pools.</p>
<div class="context"><a name="EN-US_TASK_0172374353__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><div class="p">In a dual-system hot backup scenario, BRASs control the advertisement of UNRs of configured address pools in either of the following modes:<ul><li>Manual control: If two BRASs work in load balancing mode, each BRAS is configured with two address pools. One is the primary address pool and the other is the secondary address pool. The primary address pool on one BRAS is the secondary address pool on the other BRAS. The cost value of the primary address pool must be smaller than that of the secondary address pool. The cost values can be set in a routing policy, which allows the UNR of the primary address pool to have higher route precedence than that of the secondary address pool. For detailed configurations, see <a href="../vrp/dc_vrp_route-policy_cfg_0000.html">Configuring a Routing Policy</a> in <i><cite><span class="keyword">HUAWEI NE40E-M2 series</span> <span class="keyword">Universal Service Router</span> Configuration Guide - IP Routing</cite></i>.</li><li>Automatic control: This mode can be more easily deployed than manual control. Automatic control prevents the problem where UNRs cannot be advertised in time after a master/backup switchover is triggered by a BRAS fault and then the fault is rectified, improving link reliability. The default route cost can be used to control route preference. In dual-BRAS hot backup scenarios, the cost value of the UNR imported by a routing protocol is trusted to ensure that the host route has a higher priority.</li></ul>
</div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172374353__1.4.2"></a><a name="1.4.2"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Run <span><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span></span><p><p>The system view is displayed.</p>
</p></li><li><span>Run <span><a href="cmdqueryname=peer-backup+route-cost"><b><span class="cmdname">peer-backup route-cost</span></b></a> <strong><span>auto-advertising</span></strong></span></span><p><p>The BRAS is configured to use the default route cost to control route preference during route generation. The route can be an address pool UNR or a route to a loopback interface of the LAC on an L2TP tunnel.</p>
</p><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Address pool UNRs are not updated in real time no matter whether the BRAS is configured to use the default route cost to control route preference. Route control takes effect only when the address pool is re-bound to the RBS.</p>
</div></div>
</p></li><li><span>Run <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span></span><p><p>The configuration is committed.</p>
</p></li><li><span>(Optional) Run <a href="cmdqueryname=track+interface"><b><span class="cmdname">track interface</span></b></a> { <i><span class="varname">interface-name</span></i> | <i><span class="varname">interface-type interface-number</span></i> } [ <strong><span>weight</span></strong> <i><span class="varname">weight</span></i> ]</span><p><p>The RBS is enabled to track the network-side interface status so that it can adjust the policy for advertising shared address pool UNR when a fault or fault recovery event is detected. If devices have multiple uplinks with different bandwidth, configure different weights for uplink interfaces based on the uplink bandwidths, and implement on-demand switchovers with the help of switching policies. If the interfaces have different rates, configure the weights based on their rates. For example, configure a larger weight for a 10GE interface than a GE interface. If interface A is 10GE, and the bandwidth planned for RUI is 5 Gbit/s; interface B is GE, and the bandwidth planned for RUI is 1 Gbit/s; interface C is GE, and the bandwidth planned for RUI is 0.5 Gbit/s, when interface B is chosen as a reference interface with a configured weight 10, the weight of interface A is 50 and that of interface C is 5.</p>
</p><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The formula is as follows: Fault rate = Total weight of faulty interfaces/Total weight of interfaces x 100%. If interfaces B and C are faulty, fault rate = (10 + 5)/(50 + 10 + 5) x 100% = 23%. If interface A is faulty, fault rate = 50/(50 + 10 + 5) x 100% = 77%.</p>
</div></div>
</p></li><li><span>(Optional) Run <a href="cmdqueryname=switchover+uplink"><b><span class="cmdname">switchover uplink</span></b></a> { <strong><span>failure-ratio</span></strong> <i><span class="varname">failure-ratio</span></i> | <strong><span>duration</span></strong> <i><span class="varname">duration</span></i> } <sup>*</sup></span><p><p>The threshold for a primary/backup path switchover due to uplink failures and the duration before the switchover are configured.</p>
</p><p><p>When you run the <a href="cmdqueryname=track+interface"><b><span class="cmdname">track interface</span></b></a> command, the weights specified must comply with the rules of the master/backup VRRP switchover. If a primary/backup path switchover is performed based on the fault rate of uplinks but a master/backup VRRP switchover is not performed, the backup device forwards the network-side traffic back to the master device for processing after receiving the traffic. In this case, the master device is congested with traffic because the primary/backup path switchover is not performed at the same time as the master/backup VRRP switchover.</p>
<p>When you configure a primary/backup path switchover to be performed based on the fault rate of uplinks, also run the <a href="cmdqueryname=peer-backup+route-cost+auto-advertising"><b><span class="cmdname">peer-backup route-cost auto-advertising</span></b></a> command in the system view. In this situation, when a primary/backup path switchover is performed based on the fault rate of uplinks, the priority of a UNR is reduced, but no UNRs are withdrawn. This configuration prevents downlink traffic from being interrupted.</p>
</p></li><li><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li><li><span>(Optional) Run <a href="cmdqueryname=track+monitor-group"><b><span class="cmdname">track monitor-group</span></b></a> <i><span class="varname">group-name</span></i> <strong><span>switchover </span></strong><strong><span>failure-ratio</span></strong> <i><span class="varname">percent</span></i></span><p><p>The RBS is enabled to track the status of the interface group. After you run the <strong>track interface-group</strong> command in the RBS view in which the <a href="cmdqueryname=track+interface"><b><span class="cmdname">track interface</span></b></a> command has been run, the device automatically deletes the <a href="cmdqueryname=track+interface"><b><span class="cmdname">track interface</span></b></a> and <a href="cmdqueryname=switchover+uplink"><b><span class="cmdname">switchover uplink</span></b></a> configurations and then determines whether to perform service switching based on the <strong>track monitor-group</strong> configuration.</p>
</p><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Before running the <strong>track monitor-group switchover failure-ratio</strong> command, you must have run the <strong>monitor-group</strong> command to create an interface monitoring group.</p>
</div></div>
</p></li><li><span>(Optional) Run <a href="cmdqueryname=track+route-monitor-group"><b><span class="cmdname">track route-monitor-group</span></b></a> <i><span class="varname">group-name</span></i> <strong><span>switchover </span></strong><strong><span>failure-ratio</span></strong> <i><span class="varname">percent</span></i></span><p><p>The RBS is configured to track the status of the route monitoring group, and an uplink fault rate threshold for triggering a primary/backup path switchover is configured.</p>
</p><p><p>If the <a href="cmdqueryname=track+interface"><b><span class="cmdname">track interface</span></b></a> command has been run in the RBS view, the device automatically deletes the <a href="cmdqueryname=track+interface"><b><span class="cmdname">track interface</span></b></a> configuration after the <a href="cmdqueryname=track+route-monitor-group+switchover+failure-ratio"><b><span class="cmdname">track route-monitor-group switchover failure-ratio</span></b></a> command is run. Then, the device determines whether to perform a service switchover based on the <a href="cmdqueryname=track+route-monitor-group+switchover+failure-ratio"><b><span class="cmdname">track route-monitor-group switchover failure-ratio</span></b></a> configuration.</p>
</p></li></ol></div>
<div class="postreq"><a name="EN-US_TASK_0172374353__1.4.3"></a><a name="1.4.3"></a><h4 class="sectiontitle">Follow-up Procedure</h4>
<div class="p"><div class="p">To use a routing policy to allow the UNR to have the highest preference, perform any of the following operations:<ul><li>Run the <a href="cmdqueryname=import-route"><b><span class="cmdname">import-route</span></b></a> <strong><span>unr route-policy</span></strong> <i><span class="varname">route-policy-name</span></i> command in the IS-IS view.</li><li>Run the <a href="cmdqueryname=import-route"><b><span class="cmdname">import-route</span></b></a> <strong><span>unr route-policy</span></strong> <i><span class="varname">route-policy-name</span></i> command in the OSPF view.</li><li>Run the <a href="cmdqueryname=import-route"><b><span class="cmdname">import-route</span></b></a> <strong><span>unr route-policy</span></strong> <i><span class="varname">route-policy-name</span></i> command in the BGP view.</li></ul>
</div>
<div class="p">To reserve the cost values of UNRs imported by a routing protocol, perform any of the following operations based on the type of the routing protocol:<ul><li>Run the <a href="cmdqueryname=import-route"><b><span class="cmdname">import-route</span></b></a> <strong><span>unr inherit-cost</span></strong> command in the IS-IS view.</li><li>Run the following commands in the OSPF view:<ol><li><a href="cmdqueryname=default"><b><span class="cmdname">default</span></b></a> <strong><span>cost inherit-metric</span></strong></li><li><a href="cmdqueryname=import-route"><b><span class="cmdname">import-route</span></b></a> <strong><span>unr</span></strong></li></ol>
</li><li>Run the <a href="cmdqueryname=import-route"><b><span class="cmdname">import-route</span></b></a> <strong><span>unr</span></strong> command in the BGP view.</li></ul>
</div>
</div></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cfg_rui_0004.html">Configuring Multi-Device Backup for IPv4 User Information
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cfg_rui_0007.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cfg_rui_0009.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>