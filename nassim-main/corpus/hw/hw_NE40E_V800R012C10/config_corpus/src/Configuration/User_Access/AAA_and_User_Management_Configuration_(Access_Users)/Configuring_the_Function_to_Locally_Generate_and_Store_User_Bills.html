
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring the Function to Locally Generate and Store User Bills">
<meta name="abstract" content="If RADIUS is used to implement accounting, configure the function to locally generate and store user bills, so that user accounting information is still correct if an interworking RADIUS server fails to respond upon user login or logout.">
<meta name="description" content="If RADIUS is used to implement accounting, configure the function to locally generate and store user bills, so that user accounting information is still correct if an interworking RADIUS server fails to respond upon user login or logout.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_aaa_cfg_0035.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_aaa_cfg_0600.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_aaa_cfg_0050.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="z00588052,w00437000,w00606909,w00447999">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="AAA (Access User)">
<meta name="featurename" content="PPPoE">
<meta name="featuretype" content="User Access">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="AAA (Access User)">
<meta name="featurename" content="PPPoE">
<meta name="featuretype" content="User Access">
<meta name="featurename" content="AAA (Access User)">
<meta name="featuretype" content="User Access">
<meta name="OWNER" content="z00588052,w00437000">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="z00588052">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172373708">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring the Function to Locally Generate and Store User Bills</title>
</head>
<body><a name="EN-US_TASK_0172373708"></a><a name="EN-US_TASK_0172373708"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring the Function to Locally Generate and Store User Bills</h1>
<div class="taskbody"><p>If RADIUS is used to implement accounting, configure the function to locally generate and store user bills, so that user accounting information is still correct if an interworking RADIUS server fails to respond upon user login or logout.</p>
<div class="context"><a name="EN-US_TASK_0172373708__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><div class="p">If a RADIUS server is configured to implement accounting for access users, the <span class="keyword">Router</span> can be enabled to generate local bills in the following scenarios:<ul><li>The RADIUS server fails to respond to an accounting stop request: The <span class="keyword">Router</span> generates a local bill to record the accounting information and considers that the user is offline.</li><li>User login is allowed even if accounting fails to start for the user (this function is configured using the <a href="cmdqueryname=accounting+start-fail"><b><span class="cmdname">accounting start-fail</span></b></a> <strong><span>online</span></strong> command): The <span class="keyword">Router</span> generates a local bill when the user goes offline to record the accounting information.</li></ul>
</div>
<p>Local bills can be transferred to a bill server for account reconciliation on the RADIUS server.</p>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172373708__1.4.2"></a><a name="1.4.2"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Run <span><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span></span><p><p>The system view is displayed.</p>
</p></li><li><span>Run <span><a href="cmdqueryname=local-aaa-server"><b><span class="cmdname">local-aaa-server</span></b></a></span></span><p><p>The local AAA server view is displayed.</p>
</p></li><li><span>Run <span><a href="cmdqueryname=local-bill-pool+enable"><b><span class="cmdname">local-bill-pool enable</span></b></a></span></span><p><p>A local bill pool is created.</p>
</p></li><li><span>Run <span><a href="cmdqueryname=bill-server"><b><span class="cmdname">bill-server</span></b></a> <i><span class="varname">ip-address</span></i> <strong><span>filename</span></strong> <i><span class="varname">file-name</span></i> [ <strong><span>user-name</span></strong> <i><span class="varname">user-name</span></i> <strong><span>password</span></strong> <strong><span>cipher</span></strong> <i><span class="varname">cipher-password</span></i> <i><span class="varname">port</span></i> ]</span></span><p><p>A bill server is specified.</p>
</p><p><p>User bills stored in the local bill pool or CF card can be transferred to the specified bill server to release the local space.</p>
</p></li><li><span>Configure a bill transfer mode and transfer trigger conditions.</span><p><ul><li>Configure a transfer mode for bills stored in the local bill pool or CF card.<ol type="a"><li><p>To configure the automatic bill transfer mode for bills in the local bill pool, run the <span><a href="cmdqueryname=local-bill"><b><span class="cmdname">local-bill</span></b></a> <strong><span>cache</span></strong> <strong><span>backup-mode</span></strong> { <strong><span>cfcard</span></strong> | <strong><span>none</span></strong> | <strong><span>tftp</span></strong> | <strong><span>sftp</span></strong> }</span> command.</p>
<p>If <strong><span>none</span></strong> is specified, bills in the local bill pool are not transferred. If you want bill transfer to be performed before the automatic bill transfer condition is met, run the <a href="cmdqueryname=local-bill"><b><span class="cmdname">local-bill</span></b></a> <strong><span>cache</span></strong> <strong><span>backup</span></strong> command to manually transfer local bills to the CF card or bill server.</p>
</li><li><p>To configure the automatic bill transfer mode for bills in the CF card, run the <span><a href="cmdqueryname=local-bill"><b><span class="cmdname">local-bill</span></b></a> <strong><span>cfcard</span></strong> <strong><span>backup-mode</span></strong> { <strong><span>tftp</span></strong> | <strong><span>sftp</span></strong> }</span> command.</p>
<p>The <span class="keyword">Router</span> also supports manual bill transfer from the CF card to the bill server using the <a href="cmdqueryname=local-bill"><b><span class="cmdname">local-bill</span></b></a> <strong><span>cfcard</span></strong> <strong><span>backup</span></strong> command.</p>
</li></ol>
</li><li>Configure the transfer trigger conditions for local bill transfer from the local bill pool or CF card to the bill server.<ol type="a"><li><p>To configure an automatic transfer interval as the trigger condition, run the <span><a href="cmdqueryname=local-bill"><b><span class="cmdname">local-bill</span></b></a> { <strong><span>cache</span></strong> | <strong><span>cfcard</span></strong> } <strong><span>backup-interval</span></strong> <i><span class="varname">interval</span></i></span> command.</p>
<p>After a transfer interval is specified, bills in the local bill pool or CF card are automatically transferred to the bill server at the specified interval.</p>
</li><li><p>To configure a transfer alarm threshold as the trigger condition, run the <span><a href="cmdqueryname=local-bill"><b><span class="cmdname">local-bill</span></b></a> { <strong><span>cache</span></strong> | <strong><span>cfcard</span></strong> } <strong><span>alarm-threshold</span></strong> <i><span class="varname">threshold</span></i></span> command.</p>
<p>After a transfer alarm threshold is specified, if automatic bill transfer is enabled, bills in the local bill pool or CF card are automatically transferred to the bill server when the alarm threshold is reached. If automatic bill transfer is disabled, an alarm is reported when the threshold is reached, informing you to clear unneeded local bills in time.</p>
</li></ol>
</li></ul>
</p></li><li><span>(Optional) Run <span><a href="cmdqueryname=local-bill"><b><span class="cmdname">local-bill</span></b></a> <strong><span>cfcard</span></strong> <strong><span>reset</span></strong></span><span></span></span><p><p>Bills in the CF card are cleared.</p>
</p><p><p>When the CF card storage space is insufficient and the bill server is faulty, run the preceding command to clear local bills. Otherwise, new bills will be dropped.</p>
<div class="notice"><span class="noticetitle"><img src="../../../../public_sys-resources/notice_3.0-en-us.png"> </span><div class="noticebody"><p>Bills cannot be restored after they are deleted from the CF card. Exercise caution when running this command.</p>
</div></div>
</p></li><li><span>Run <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span></span><p><p>The configuration is committed.</p>
</p></li></ol></div>
<div class="result"><a name="EN-US_TASK_0172373708__1.4.3"></a><a name="1.4.3"></a><h4 class="sectiontitle">Result</h4>
<div class="p"><div class="p">After configuring the function to locally generate and store user bills, perform the following checks:<ul><li>Run the <a href="cmdqueryname=display+local-bill+configuration"><b><span class="cmdname">display local-bill configuration</span></b></a> command to check the configuration of the local bill transfer function.</li><li>Run the <a href="cmdqueryname=display+local-bill+information"><b><span class="cmdname">display local-bill information</span></b></a> command to check the usage of the CF card or local bill pool.</li><li>Run the <a href="cmdqueryname=display+local-bill+cache"><b><span class="cmdname">display local-bill cache</span></b></a> <i><span class="varname">start-num</span></i> <i><span class="varname">count</span></i> command to check the information about specified bills in the local bill pool.</li></ul>
</div>
</div></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_aaa_cfg_0035.html">AAA and User Management Configuration (Access Users)
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_aaa_cfg_0600.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_aaa_cfg_0050.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>