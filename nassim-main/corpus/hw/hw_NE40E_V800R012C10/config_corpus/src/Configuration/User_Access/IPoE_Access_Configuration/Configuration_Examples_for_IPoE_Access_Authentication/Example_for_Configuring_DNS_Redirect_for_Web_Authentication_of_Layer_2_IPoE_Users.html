
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring DNS Redirect for Web Authentication of Layer 2 IPoE Users">
<meta name="abstract" content="This section provides an example for configuring DNS redirect for web authentication of Layer 2 IPoE users. The example provides the networking requirements, configuration roadmap, configuration procedure, and configuration files.">
<meta name="description" content="This section provides an example for configuring DNS redirect for web authentication of Layer 2 IPoE users. The example provides the networking requirements, configuration roadmap, configuration procedure, and configuration files.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_ipox_cfg_0083.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cfg_1005.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cfg_014457.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="z50024784,z00603461,w00800033,z00588052,ipoxne,c00549182,w00556928,l00593348,w00606909,w00447999,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="IPoE">
<meta name="featuretype" content="User Access">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="IPoE">
<meta name="featuretype" content="User Access">
<meta name="featurename" content="IPoE">
<meta name="featuretype" content="User Access">
<meta name="featurename" content="IPoE">
<meta name="featuretype" content="User Access">
<meta name="OWNER" content="c00549182">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="z00588052">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172374069">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring DNS Redirect for Web Authentication of Layer 2 IPoE Users</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172374069"></a><a name="EN-US_TASK_0172374069"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring DNS Redirect for Web Authentication of Layer 2 IPoE Users</h1>
<div class="taskbody"><p>This section provides an example for configuring DNS redirect for web authentication of Layer 2 IPoE users. The example provides the networking requirements, configuration roadmap, configuration procedure, and configuration files.</p>
<div class="context"><a name="EN-US_TASK_0172374069__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0172374069__fig_dc_ne_cfg_01444801">Figure 1</a>, web authentication is performed for the user in the domain <strong>isp1</strong>. DNS redirect, RADIUS authentication scheme, and RADIUS accounting scheme are configured. The user accesses the Internet in Layer 2 IPoE access mode through GE <span>0/1/2</span> of DeviceA.</p>
<div class="fignone" id="EN-US_TASK_0172374069__fig_dc_ne_cfg_01444801"><a name="EN-US_TASK_0172374069__fig_dc_ne_cfg_01444801"></a><a name="fig_dc_ne_cfg_01444801"></a><span class="figcap"><b>Figure 1 </b>Configuring DNS redirect for web authentication of Layer 2 IPoE users</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interface1 and interface2 in this example represent GE <span>0/1/2</span>.1 and GE <span>0/1/1</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_ne_cfg_014455.png" width="NaN" height="NaN"></span><p></p>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172374069__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows: (All the configurations are performed on <span class="keyword">Device</span>A.)</p>
<ol><li><p>Configure a user group.</p>
</li><li><p>Configure an address pool.</p>
</li><li><p>Configure authentication and accounting schemes.</p>
</li><li><p>Configure a RADIUS server group.</p>
</li><li><p>Configure web pre-authentication and authentication domains.</p>
</li><li><p>Configure a web authentication server.</p>
</li><li><p>Configure ACL rules and a traffic policy.</p>
</li><li><p>Configure whitelists.</p>
</li><li><p>Configure a BAS interface and an upstream interface.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172374069__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>Authentication scheme name and authentication mode</p>
</li><li><p>Accounting scheme name and accounting mode</p>
</li><li><p>RADIUS server group name, RADIUS authentication server's IP address and port number, and RADIUS accounting server's IP address and port number</p>
</li><li><p>Address pool name, gateway address, and DNS server address</p>
</li><li><p>Domain names</p>
</li><li><p>Address of the web server and web authentication server (in this example, the two servers are deployed on the same device that supports DNS)</p>
</li><li><p>ACL rules</p>
</li><li><p>Traffic policies</p>
</li><li><p>Whitelist configuration</p>
</li><li><p>BAS interface parameters</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172374069__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure a user group.</span><p><pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname <span class="keyword">Device</span>A</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>user-group huawei</strong></pre>
</p></li><li><span>Configure a local address pool on the <span class="keyword">Device</span>.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>ip pool huawei bas local</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-ip-pool-huawei] <strong>gateway 10.10.10.1 24</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-ip-pool-huawei] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-ip-pool-huawei] <strong>section 0 10.10.10.2 10.10.10.200</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-ip-pool-huawei] <strong>quit</strong></pre>
</p></li><li><span>Configure AAA schemes.</span><p><p># Configure an authentication scheme.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>aaa</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-aaa] <strong>authentication-scheme auth2</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-aaa-authen-auth2] <strong>authentication-mode radius</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-aaa-authen-auth2] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-aaa-authen-auth2] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-aaa]<strong> authentication-scheme none</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-aaa-authen-none] <strong>authentication-mode none</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-aaa-authen-none]<strong> commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-aaa-authen-none] <strong>quit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In insecure network environments, you are advised to use a secure authentication mode. For details, see <a href="dc_ne_ipox_cfg_0148.html">Example for Configuring Layer 3 IPoE Access (Web Authentication)</a>.</p>
</div></div>
<p># Configure an accounting scheme.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-aaa] <strong>accounting-scheme acct2</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-aaa-accounting-acct2] <strong>accounting-mode radius</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-aaa-accounting-acct2] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-aaa-accounting-acct2] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-aaa] <strong>accounting-scheme</strong> <strong>none</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-aaa-accounting-none] <strong>accounting-mode none </strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-aaa-accounting-none] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-aaa-accounting-none] <strong>quit</strong></pre>
</p><p><p># Configure the IPoE user password.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-aaa]<strong> </strong><strong>default-password cipher YsHsjx_202206</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-aaa]<strong> commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-aaa]<strong> quit</strong></pre>
</p></li><li><span>Configure a RADIUS server group.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A]<strong> radius-server group rd2</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-radius-rd2]<strong> radius-server authentication 192.168.8.249 1812</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-radius-rd2]<strong> radius-server accounting 192.168.8.249 1813</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-radius-rd2]<strong> radius-server shared-key Huawei</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-radius-rd2]<strong> commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-radius-rd2]<strong> quit</strong></pre>
</p></li><li><span>Configure domains and DNS redirect.</span><p><p># Configure a web pre-authentication domain named <strong>web_before</strong>. Then, configure DNS redirect.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A]<strong> aaa</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-aaa]<strong> domain web_before</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-aaa-domain-web_before]<strong> authentication-scheme none</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-aaa-domain-web_before]<strong> accounting-scheme none</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-aaa-domain-web_before]<strong> commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-aaa-domain-web_before]<strong> user-group huawei</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-aaa-domain-web_before] <strong>dns primary-ip 1.1.1.1</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-aaa-domain-web_before]<strong> dns-redirect web-server 192.168.8.251</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-aaa-domain-web_before]<strong> commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-aaa-domain-web_before]<strong> ip-pool huawei</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-aaa-domain-web_before]<strong> quit</strong></pre>
<p># Configure a web authentication domain named <strong>isp1</strong>.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-aaa]<strong> domain isp1</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-aaa-domain-isp1]<strong> authentication-scheme auth2</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-aaa-domain-isp1]<strong> accounting-scheme acct2</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-aaa-domain-isp1]<strong> </strong><strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-aaa-domain-isp1]<strong> radius-server group rd2</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-aaa-domain-isp1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-aaa-domain-isp1]<strong> quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-aaa]<strong> quit</strong></pre>
</p></li><li><span>Configure a loopback interface.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A]<strong> interface LoopBack 0</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-LoopBack0]<strong> ip address 192.168.8.1 32 </strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-LoopBack0] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-LoopBack0]<strong> quit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The loopback interface must be routable to the DNS server.</p>
</div></div>
</p></li><li><span>Configure a web authentication server.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A]<strong> web-auth-server enable</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A]<strong> web-auth-server source interface LoopBack0</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A]<strong> web-auth-server source-ip 192.168.8.1</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A]<strong> web-auth-server 192.168.8.251 key cipher Huawei</strong></pre>
</p></li><li><span>Configure traffic policies.</span><ol type="a"><li class="substepexpand"><span>Configure ACLs.</span><p><p># Configure an ACL numbered 6000.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>acl 6000</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-acl-ucl-6000] <strong>rule 5 permit ip source user-group huawei destination ip-address 1.1.1.1 0</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-acl-ucl-6000] <strong>rule 15 permit ip source user-group huawei destination ip-address 192.168.8.251</strong> <strong>0</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-acl-ucl-6000] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-acl-ucl-6000] <strong>quit</strong></pre>
<p># Configure an ACL numbered 6001.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>acl 6001</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-acl-ucl-6001] <strong>rule 5 permit ip source user-group huawei</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-acl-ucl-6001] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-acl-ucl-6001] <strong>quit</strong></pre>
<p># Configure an ACL numbered 6002.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>acl 6002</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-acl-ucl-6002] <strong>rule 5 permit udp source-port eq dns destination user-group huawei</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-acl-ucl-6002] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-acl-ucl-6002] <strong>quit</strong></pre>
</p></li><li class="substepexpand"><span>Configure traffic classifiers.</span><p><p># Configure a traffic classifier named <strong>c1</strong> and apply ACL 6000 to the classifier.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>traffic classifier c1</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-classifier-c1] <strong>if-match acl 6000</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-classifier-c1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-classifier-c1] <strong>quit</strong></pre>
<p># Configure a traffic classifier named <strong>c2</strong> and apply ACL 6001 to the classifier.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>traffic classifier c2</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-classifier-c2] <strong>if-match acl 6001</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-classifier-c2] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-classifier-c2] <strong>quit</strong></pre>
<p># Configure a traffic classifier named <strong>c3</strong> and apply ACL 6002 to the classifier.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>traffic classifier c3</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-classifier-c3] <strong>if-match acl 6002</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-classifier-c3] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-classifier-c3] <strong>quit</strong></pre>
</p></li><li class="substepexpand"><span>Configure traffic behaviors.</span><p><p># Configure a traffic behavior named <strong>b1</strong>.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>traffic behavior b1</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-behavior-b1] <strong>permit</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-behavior-b1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-behavior-b1] <strong>quit</strong></pre>
<p># Configure a traffic behavior named <strong>b2</strong>.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>traffic behavior b2</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-behavior-b2] <strong>deny</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-behavior-b2] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-behavior-b2] <strong>quit</strong></pre>
<p># Configure a traffic behavior named <strong>b3</strong>.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>traffic behavior b3</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-behavior-b3] <strong>dns-redirect </strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-behavior-b3] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-behavior-b3] <strong>quit</strong></pre>
</p></li><li class="substepexpand"><span>Configure traffic policies.</span><p><p># Configure a traffic policy named <strong>p1</strong>.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>traffic policy p1</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-trafficpolicy-p1] <strong>classifier c1 behavior b1</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-trafficpolicy-p1] <strong>classifier c2 behavior b2</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-trafficpolicy-p1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-trafficpolicy-p1] <strong>quit</strong></pre>
<p># Configure a traffic policy named <strong>p2</strong>.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>traffic policy p2</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-trafficpolicy-p2] <strong>classifier c3 behavior b3</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-trafficpolicy-p2] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-trafficpolicy-p2] <strong>quit</strong></pre>
</p></li><li class="substepexpand"><span>Apply the traffic policies.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>traffic-policy p1 inbound</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>traffic-policy p2 outbound</strong></pre>
</p></li></ol>
</li><li><span>Configure whitelists.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>dns-url permit www.huawei.com</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>dns-url permit 192.168.2.1</strong></pre>
</p></li><li><span>Configure interfaces.</span><p><p># Configure a BAS interface.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>interface GigabitEthernet <span>0/1/2</span>.1</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/2</span>.1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/2</span>.1] <strong>user-vlan 1</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/2</span>.1-vlan-1-1] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/2</span>.1] <strong>bas</strong> 
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/2</span>.1-bas]<strong> access-type layer2-subscriber default-domain pre-authentication web_before authentication isp1</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/2</span>.1-bas] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/2</span>.1-bas]<strong> authentication-method web</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/2</span>.1-bas]<strong> quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/2</span>.1]<strong> quit</strong></pre>
<p># Configure an upstream interface connecting the device to the Internet.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>interface GigabitEthernet <span>0/1/1</span></strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/1</span>]<strong> ip address 192.168.2.1 255.255.255.0</strong>
[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/1</span>]<strong> commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/1</span>]<strong> quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A]<strong> quit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p>After completing the configurations, have the user go online. Then, run the <strong>display access-user domain</strong> command to check information about the user in the domain. The command output shows that the user has gone online successfully.</p>
<pre class="screen">&lt;<span class="keyword">Device</span>A&gt; <strong>display access-user domain web_before</strong></pre>
<pre class="screen">------------------------------------------------------------------------------
  UserID  Username                Interface      IP address       MAC
          Vlan          IPv6 address             Access type
  ------------------------------------------------------------------------------
  20      user1@web_before        GE<span>0/1/2</span>.1      10.10.10.200    00e0-fc12-3456
          1/-           -                        IPOE 
   ------------------------------------------------------------------------------
  </pre>
<p>Normally, after the user opens a browser on the PC and enters an HTTP or HTTPS address in the address bar, a web authentication page is displayed. The user then enters the username and password. After being authenticated, the user can enter the authentication domain.</p>
<pre class="screen">&lt;<span class="keyword">Device</span>A&gt; <strong>display access-user domain isp1</strong></pre>
<pre class="screen">------------------------------------------------------------------------------
  UserID  Username                Interface      IP address       MAC
          Vlan          IPv6 address             Access type
  ------------------------------------------------------------------------------
  20      user1@isp1         GE<span>0/1/2</span>.1      10.10.10.200     00e0-fc12-3456
          1/-           -                        IPOE 
   ------------------------------------------------------------------------------
  </pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172374069__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><pre class="screen">#
sysname <span class="keyword">Device</span>A
#
radius-server group rd2
 radius-server shared-key-cipher %^%#`E)v.Q@BHVzxxZ;ij{&gt;&amp;_M0!TGP7YRA@8a7mq&lt;\/%^%#
 radius-server authentication 192.168.8.249 1812 weight 0
 radius-server accounting 192.168.8.249 1813 weight 0      
#
ip pool huawei bas local
 gateway 10.10.10.1 255.255.255.0
 section 0 10.10.10.2 10.10.10.200 
#
user-group huawei
#
acl number 6000
 rule 5 permit ip source user-group huawei destination ip-address 1.1.1.1 0
 rule 15 permit ip source user-group huawei destination ip-address 192.168.8.251 0
#
acl number 6001
 rule 5 permit ip source user-group huawei 
#
acl number 6002
 rule 5 permit udp source-port eq dns destination user-group huawei 
#
traffic classifier c1 operator or
 if-match acl 6000 precedence 8
#
traffic classifier c2 operator or
 if-match acl 6001 precedence 9
#
traffic classifier c3 operator or
 if-match acl 6002 precedence 10
#
traffic behavior b1
#
traffic behavior b2
 deny
#
traffic behavior b3
 dns-redirect
#
traffic policy p1
 classifier c1 behavior b1 precedence 1
 classifier c2 behavior b2 precedence 2
#
traffic policy p2
 classifier c3 behavior b3 precedence 1
#
aaa 
 default-password cipher $$e:TY%^%glhJ;yPG#$=tC&amp;(Is%q!S_";(k.Ef$%^%#:978 
 # 
 authentication-scheme none
  authentication-mode none
 #
 authentication-scheme auth2
 #
 accounting-scheme acct2
 #
 accounting-scheme none
  accounting-mode none
 #
 domain isp1
  authentication-scheme auth2
  accounting-scheme acct2
  radius-server group rd2
 #  
 domain web_before
  authentication-scheme none
  accounting-scheme none
  ip-pool huawei
  dns primary-ip 1.1.1.1 
  user-group huawei
  dns-redirect web-server 192.168.8.251
#
interface GigabitEthernet<span>0/1/1</span>
 ip address 192.168.2.1 255.255.255.0
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
#
interface GigabitEthernet<span>0/1/2</span>.1
 user-vlan 1 
 bas
 #
  access-type layer2-subscriber default-domain pre-authentication web_before authentication isp1
  authentication-method web
 #
#
interface LoopBack0
 ip address 192.168.8.1 255.255.255.255
#
web-auth-server enable
web-auth-server source interface LoopBack0 
web-auth-server 192.168.8.251 port 50100 key cipher %^%#`E)v.Q@BHVzxxZ;ij{&gt;&amp;_M0!TGP7YRA@8a7mq&lt;\/%^%#
<span>#</span>
<span>undo web-auth-server source-ip all</span>
<span>web-auth-server source-ip 192.168.8.1</span>
<span>#</span>
<span>undo web-auth-server source-ipv6 all</span>
#
dns-url permit 192.168.2.1
dns-url permit www.huawei.com
#
traffic-policy p1 inbound
traffic-policy p2 outbound
#
return</pre>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_ipox_cfg_0083.html">Configuration Examples for IPoE Access Authentication
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cfg_1005.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cfg_014457.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>